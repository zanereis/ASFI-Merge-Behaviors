[{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1855007265","html_url":"https://github.com/apache/ratis/pull/989#issuecomment-1855007265","issue_url":"https://api.github.com/repos/apache/ratis/issues/989","id":1855007265,"node_id":"IC_kwDOBMxbGc5ukSoh","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-14T02:22:46Z","updated_at":"2023-12-14T02:22:46Z","author_association":"CONTRIBUTOR","body":"The `failAllAsyncRequests` may fail with a different exception (`AlreadyClosedException` may work, or we should add a new `AlreadyFailedException`).  For that exception, do not `resetSlidingWindow`.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1855007265/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1855114073","html_url":"https://github.com/apache/ratis/pull/993#issuecomment-1855114073","issue_url":"https://api.github.com/repos/apache/ratis/issues/993","id":1855114073,"node_id":"IC_kwDOBMxbGc5ukstZ","user":{"login":"nandakumar131","id":8871229,"node_id":"MDQ6VXNlcjg4NzEyMjk=","avatar_url":"https://avatars.githubusercontent.com/u/8871229?v=4","gravatar_id":"","url":"https://api.github.com/users/nandakumar131","html_url":"https://github.com/nandakumar131","followers_url":"https://api.github.com/users/nandakumar131/followers","following_url":"https://api.github.com/users/nandakumar131/following{/other_user}","gists_url":"https://api.github.com/users/nandakumar131/gists{/gist_id}","starred_url":"https://api.github.com/users/nandakumar131/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nandakumar131/subscriptions","organizations_url":"https://api.github.com/users/nandakumar131/orgs","repos_url":"https://api.github.com/users/nandakumar131/repos","events_url":"https://api.github.com/users/nandakumar131/events{/privacy}","received_events_url":"https://api.github.com/users/nandakumar131/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-14T04:33:38Z","updated_at":"2023-12-14T04:33:38Z","author_association":"CONTRIBUTOR","body":"Thanks for the review @adoroszlai &  @szetszwo.\r\n\r\n@szetszwo, sure. will do.\r\n\r\nFYI: The scope of the junit dependencies are of scope `test`, so it will not be part of Ratis's transitive dependencies.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1855114073/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1855240130","html_url":"https://github.com/apache/ratis/pull/993#issuecomment-1855240130","issue_url":"https://api.github.com/repos/apache/ratis/issues/993","id":1855240130,"node_id":"IC_kwDOBMxbGc5ulLfC","user":{"login":"nandakumar131","id":8871229,"node_id":"MDQ6VXNlcjg4NzEyMjk=","avatar_url":"https://avatars.githubusercontent.com/u/8871229?v=4","gravatar_id":"","url":"https://api.github.com/users/nandakumar131","html_url":"https://github.com/nandakumar131","followers_url":"https://api.github.com/users/nandakumar131/followers","following_url":"https://api.github.com/users/nandakumar131/following{/other_user}","gists_url":"https://api.github.com/users/nandakumar131/gists{/gist_id}","starred_url":"https://api.github.com/users/nandakumar131/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nandakumar131/subscriptions","organizations_url":"https://api.github.com/users/nandakumar131/orgs","repos_url":"https://api.github.com/users/nandakumar131/repos","events_url":"https://api.github.com/users/nandakumar131/events{/privacy}","received_events_url":"https://api.github.com/users/nandakumar131/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-14T06:45:25Z","updated_at":"2023-12-14T06:45:25Z","author_association":"CONTRIBUTOR","body":"@szetszwo, I have been working on limiting the changes just to `ratis-common`, but the test compilation started failing on `ratis-server`, `ratis-test` & `ratis-examples` as they extend `BaseTest` from `ratis-common`.\r\n\r\nI will try to limit the changes on each PR to make the review process easier.\r\n\r\nThis PR will only update the parent `pom.xml` and `ratis-common`'s `pom.xml`\r\n\r\nTest-case changes will happen in follow-up PRs.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1855240130/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1856166385","html_url":"https://github.com/apache/ratis/pull/994#issuecomment-1856166385","issue_url":"https://api.github.com/repos/apache/ratis/issues/994","id":1856166385,"node_id":"IC_kwDOBMxbGc5uotnx","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-14T16:31:15Z","updated_at":"2023-12-14T16:31:15Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for review, suggestions on how to change `LifeCycle`, and merging it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1856166385/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1857075903","html_url":"https://github.com/apache/ratis/pull/993#issuecomment-1857075903","issue_url":"https://api.github.com/repos/apache/ratis/issues/993","id":1857075903,"node_id":"IC_kwDOBMxbGc5usLq_","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-15T00:24:43Z","updated_at":"2023-12-15T00:24:43Z","author_association":"CONTRIBUTOR","body":"> FYI: The scope of the junit dependencies are of scope test, so it will not be part of Ratis's transitive dependencies.\r\n\r\n@nandakumar131 , I understand that the test dependencies are not transitive.  That's a good point!\r\n\r\nIt is usually hard to remove dependencies.  So I really oppose adding unused dependencies.  Moreover, we have to handle it in case of CVEs.\r\n\r\nPlease include some change to use the dependencies in this pull requests.  ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1857075903/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1857357520","html_url":"https://github.com/apache/ratis/pull/990#issuecomment-1857357520","issue_url":"https://api.github.com/repos/apache/ratis/issues/990","id":1857357520,"node_id":"IC_kwDOBMxbGc5utQbQ","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-15T06:39:43Z","updated_at":"2023-12-15T06:39:43Z","author_association":"CONTRIBUTOR","body":"@szetszwo can you have a look?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1857357520/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1857600004","html_url":"https://github.com/apache/ratis/pull/989#issuecomment-1857600004","issue_url":"https://api.github.com/repos/apache/ratis/issues/989","id":1857600004,"node_id":"IC_kwDOBMxbGc5uuLoE","user":{"login":"symious","id":14933944,"node_id":"MDQ6VXNlcjE0OTMzOTQ0","avatar_url":"https://avatars.githubusercontent.com/u/14933944?v=4","gravatar_id":"","url":"https://api.github.com/users/symious","html_url":"https://github.com/symious","followers_url":"https://api.github.com/users/symious/followers","following_url":"https://api.github.com/users/symious/following{/other_user}","gists_url":"https://api.github.com/users/symious/gists{/gist_id}","starred_url":"https://api.github.com/users/symious/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/symious/subscriptions","organizations_url":"https://api.github.com/users/symious/orgs","repos_url":"https://api.github.com/users/symious/repos","events_url":"https://api.github.com/users/symious/events{/privacy}","received_events_url":"https://api.github.com/users/symious/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-15T10:04:02Z","updated_at":"2023-12-15T10:04:02Z","author_association":"CONTRIBUTOR","body":"@szetszwo I think `failAllAsyncRequests` is not invoked here, the slidingWindow is reset, then CompletionException(e) is thrown and `failAllAsyncRequests` is skipped. (Correct me if I'm wrong.)","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1857600004/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1859198411","html_url":"https://github.com/apache/ratis/pull/986#issuecomment-1859198411","issue_url":"https://api.github.com/repos/apache/ratis/issues/986","id":1859198411,"node_id":"IC_kwDOBMxbGc5u0R3L","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-17T15:12:24Z","updated_at":"2023-12-17T15:12:24Z","author_association":"CONTRIBUTOR","body":"> Looks like the failing tests, e.g. `TestRetryCacheWithGrpc#testInvalidateRepliedCalls`, are not very stable even on master.\r\n\r\nCreated RATIS-1980 for `TestRetryCacheWithGrpc#testInvalidateRepliedCalls`.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1859198411/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1859225462","html_url":"https://github.com/apache/ratis/pull/995#issuecomment-1859225462","issue_url":"https://api.github.com/repos/apache/ratis/issues/995","id":1859225462,"node_id":"IC_kwDOBMxbGc5u0Yd2","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-17T17:05:43Z","updated_at":"2023-12-17T17:05:43Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for reviewing and merging this.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1859225462/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1862584539","html_url":"https://github.com/apache/ratis/pull/987#issuecomment-1862584539","issue_url":"https://api.github.com/repos/apache/ratis/issues/987","id":1862584539,"node_id":"IC_kwDOBMxbGc5vBMjb","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-19T11:25:41Z","updated_at":"2023-12-19T11:25:41Z","author_association":"MEMBER","body":"@szetszwo Thanks very much for the detailed review! I'll fix them today. Sorry for the delay earlier.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1862584539/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1862665959","html_url":"https://github.com/apache/ratis/pull/987#issuecomment-1862665959","issue_url":"https://api.github.com/repos/apache/ratis/issues/987","id":1862665959,"node_id":"IC_kwDOBMxbGc5vBgbn","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-19T12:25:05Z","updated_at":"2023-12-19T12:25:05Z","author_association":"MEMBER","body":"@szetszwo I've applied patch and addressed the issues. Please take a look again when you are convenient, thanks! ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1862665959/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1863637861","html_url":"https://github.com/apache/ratis/pull/990#issuecomment-1863637861","issue_url":"https://api.github.com/repos/apache/ratis/issues/990","id":1863637861,"node_id":"IC_kwDOBMxbGc5vFNtl","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-20T00:04:16Z","updated_at":"2023-12-20T00:04:16Z","author_association":"CONTRIBUTOR","body":"The change assume \r\n- `processClientRequest` completes before `evictCache`\r\n\r\nThis is not necessarily true -- when the log can be fast but the `StateMachine` is slow, `evictCache` can happen before `processClientRequest`.\r\n\r\nAlso, it needs a separated map in `RaftLogZeroCopyCleaner` to manage all the `ReferenceCountedClosable`.  It is not needed since we may release the buffer when the reference count becomes zero.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1863637861/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1863647417","html_url":"https://github.com/apache/ratis/pull/990#issuecomment-1863647417","issue_url":"https://api.github.com/repos/apache/ratis/issues/990","id":1863647417,"node_id":"IC_kwDOBMxbGc5vFQC5","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-20T00:16:02Z","updated_at":"2023-12-20T00:16:02Z","author_association":"CONTRIBUTOR","body":"@duongkame , I suggest to do the following:\r\n- Wrap the `Closable` with `ReferenceCountedObject`, `retain()` (i.e. refCount=1) and pass it around.\r\n\r\n  1. When the request log is added to the cache, `retain()` (i.e. refCount=2).\r\n  2. When the log is evicted from the cache, `release()`.\r\n  3. When the request is processed, `release()`.\r\n  4. When refCount becomes zero, close the `Closable`.\r\n\r\nNote that (ii) and (iii) can happen in any order.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1863647417/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1864715275","html_url":"https://github.com/apache/ratis/pull/996#issuecomment-1864715275","issue_url":"https://api.github.com/repos/apache/ratis/issues/996","id":1864715275,"node_id":"IC_kwDOBMxbGc5vJUwL","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-20T15:47:11Z","updated_at":"2023-12-20T15:47:11Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for reviewing and merging this.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1864715275/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1866251827","html_url":"https://github.com/apache/ratis/pull/997#issuecomment-1866251827","issue_url":"https://api.github.com/repos/apache/ratis/issues/997","id":1866251827,"node_id":"IC_kwDOBMxbGc5vPL4z","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-21T13:33:24Z","updated_at":"2023-12-21T13:42:17Z","author_association":"MEMBER","body":" > have we observed a significant drop in Ratis logs when nodes go down since the current PR was introduced\r\n\r\n@OneSizeFitsQuorum Yes. if we use a batch duration of 5 secs, on average 20 logs will be batched on my PC. You can refer to the screenshot [here](https://private-user-images.githubusercontent.com/48054931/291905508-cd7bbba1-0f4f-4b9b-8d78-43ed8689bffa.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTEiLCJleHAiOjE3MDMxNjU1NzEsIm5iZiI6MTcwMzE2NTI3MSwicGF0aCI6Ii80ODA1NDkzMS8yOTE5MDU1MDgtY2Q3YmJiYTEtMGY0Zi00YjliLThkNzgtNDNlZDg2ODliZmZhLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFJV05KWUFYNENTVkVINTNBJTJGMjAyMzEyMjElMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjMxMjIxVDEzMjc1MVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTgwNWUzOWYxYmY4N2FiNDAzYTUxYWQwMTYyYmUwMDViNTczYjhhNGZkMzVjMGY4Zjg4NmQyNDZkNjEzOGRmNmUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.9LLMa_jjafAgfQXxpeJqR_8Vx1lsvthZbinTpGknfak)\r\n\r\n> Are there other logs that print a lotï¼Ÿ\r\n\r\nCurrently the only two log messages that print a lot are fixed in this PR. If we observe other log messages that can be batched, it's easy to batch them after `BatchLogger` being merged.\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1866251827/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1866268306","html_url":"https://github.com/apache/ratis/pull/997#issuecomment-1866268306","issue_url":"https://api.github.com/repos/apache/ratis/issues/997","id":1866268306,"node_id":"IC_kwDOBMxbGc5vPP6S","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-21T13:42:23Z","updated_at":"2023-12-21T13:42:23Z","author_association":"MEMBER","body":"@szetszwo Thanks for the review and patch! I've made changes on code.\r\nThe patch is tested again and everything works just fine. PTAL~","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1866268306/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1867157686","html_url":"https://github.com/apache/ratis/pull/990#issuecomment-1867157686","issue_url":"https://api.github.com/repos/apache/ratis/issues/990","id":1867157686,"node_id":"IC_kwDOBMxbGc5vSpC2","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-22T02:35:49Z","updated_at":"2023-12-22T02:35:49Z","author_association":"CONTRIBUTOR","body":"> This is not necessarily true -- when the log can be fast but the `StateMachine` is slow, `evictCache` can happen before `processClientRequest`.\r\n\r\nThat's the reason why we need to keep the buffer sorted by log index, so if some entry is missed because `evictCache` happens before `processClientRequest`, it'll be caught by the next `evictCache`.  All buffers ready to release can be easily addressed from a log index. This approach is way cleaner than managing each buffer separately. \r\n\r\nAlso, `evictCache` only happens when [the cache capacity is about to be filled](https://github.com/apache/ratis/blob/master/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLogCache.java#L445-L454). There may be (very) few occurences of  `evictCache` before `processClientRequest` returns, but not the majority. \r\n\r\nPlus, as discussed as per RATIS-1979, in the case of stateMachineCachingEnabled, we may consider releasing zero-copy buffers much earlier than cache evict. The ability to release all zero copy buffers up to a certain log index seems to be crucial. \r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1867157686/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1868017586","html_url":"https://github.com/apache/ratis/pull/990#issuecomment-1868017586","issue_url":"https://api.github.com/repos/apache/ratis/issues/990","id":1868017586,"node_id":"IC_kwDOBMxbGc5vV6-y","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-22T19:37:58Z","updated_at":"2023-12-22T19:37:58Z","author_association":"CONTRIBUTOR","body":"> That's the reason why we need to keep the buffer sorted by log index, so if some entry is missed because evictCache happens before processClientRequest, it'll be caught by the next evictCache.\r\n\r\nConsider `evictCache` happens before `processClientRequest` below:\r\n1. evictCache(`LogSegment(11, 20)`) -> release(groupId, 11, 20) \r\n2.  processClientRequest(`reply(20)`) -> watch(`reply(20)`) -> group.put(20)\r\n\r\nHow could 20 be released later on?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1868017586/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1868020746","html_url":"https://github.com/apache/ratis/pull/990#issuecomment-1868020746","issue_url":"https://api.github.com/repos/apache/ratis/issues/990","id":1868020746,"node_id":"IC_kwDOBMxbGc5vV7wK","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-22T19:43:10Z","updated_at":"2023-12-22T19:43:10Z","author_association":"CONTRIBUTOR","body":"> ...  we may consider releasing zero-copy buffers much earlier than cache evict. The ability to release all zero copy buffers up to a certain log index seems to be crucial.\r\n\r\nLet's don't mix the buffer releasing logic with the `RaftLog` index.  Why the releasing buffer at index 10 has any relation to the buffer at index 11?\r\n\r\nUse ref count described in https://github.com/apache/ratis/pull/990#issuecomment-1863647417 can solve the problem.  Netty uses a similar approach which works very well.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1868020746/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1872376874","html_url":"https://github.com/apache/ratis/pull/999#issuecomment-1872376874","issue_url":"https://api.github.com/repos/apache/ratis/issues/999","id":1872376874,"node_id":"IC_kwDOBMxbGc5vmjQq","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-29T22:43:59Z","updated_at":"2023-12-29T22:43:59Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for reviewing and merging this.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1872376874/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1872734279","html_url":"https://github.com/apache/ratis/pull/1000#issuecomment-1872734279","issue_url":"https://api.github.com/repos/apache/ratis/issues/1000","id":1872734279,"node_id":"IC_kwDOBMxbGc5vn6hH","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-12-31T07:00:13Z","updated_at":"2023-12-31T07:00:13Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for reviewing and merging this.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1872734279/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1873268744","html_url":"https://github.com/apache/ratis/pull/1001#issuecomment-1873268744","issue_url":"https://api.github.com/repos/apache/ratis/issues/1001","id":1873268744,"node_id":"IC_kwDOBMxbGc5vp9AI","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-01T10:38:41Z","updated_at":"2024-01-01T10:38:41Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for reviewing and merging this.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1873268744/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1873420165","html_url":"https://github.com/apache/ratis/pull/1002#issuecomment-1873420165","issue_url":"https://api.github.com/repos/apache/ratis/issues/1002","id":1873420165,"node_id":"IC_kwDOBMxbGc5vqh-F","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-01T17:58:56Z","updated_at":"2024-01-01T17:58:56Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for the review.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1873420165/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1876500256","html_url":"https://github.com/apache/ratis/pull/990#issuecomment-1876500256","issue_url":"https://api.github.com/repos/apache/ratis/issues/990","id":1876500256,"node_id":"IC_kwDOBMxbGc5v2R8g","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-04T06:44:40Z","updated_at":"2024-01-04T06:47:36Z","author_association":"CONTRIBUTOR","body":"@szetszwo My basic assumption is that hat when applied and follower indices reach a particular point, x, we can safely clean up any zero-copy for write/appendEntries up to x (0-x).  I did that in the Ozone PoC and that works fine. But I'm not sure if it's correct universally for any use-cases.\r\n\r\nI think your suggestion is a better approach. Only concern is that it may lead to a more complex change as we need to pass the `ReferenceCountedObject` from GRPC to raft internal. E.g. for ClientServiceProtocol (appendEntries) we may need to change the `RaftServerAsynchronousProtocol.appendEntriesAsync` because now it only accepts a protobuf object. \r\nAnyway, I think it's viable. And I just saw https://github.com/apache/ratis/pull/998 which should help this. Thanks. \r\n\r\nClosed this PR for now. Will submit a new one for the new implementation. \r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1876500256/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1880034349","html_url":"https://github.com/apache/ratis/pull/1004#issuecomment-1880034349","issue_url":"https://api.github.com/repos/apache/ratis/issues/1004","id":1880034349,"node_id":"IC_kwDOBMxbGc5wDwwt","user":{"login":"huangzhaobo99","id":63718681,"node_id":"MDQ6VXNlcjYzNzE4Njgx","avatar_url":"https://avatars.githubusercontent.com/u/63718681?v=4","gravatar_id":"","url":"https://api.github.com/users/huangzhaobo99","html_url":"https://github.com/huangzhaobo99","followers_url":"https://api.github.com/users/huangzhaobo99/followers","following_url":"https://api.github.com/users/huangzhaobo99/following{/other_user}","gists_url":"https://api.github.com/users/huangzhaobo99/gists{/gist_id}","starred_url":"https://api.github.com/users/huangzhaobo99/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/huangzhaobo99/subscriptions","organizations_url":"https://api.github.com/users/huangzhaobo99/orgs","repos_url":"https://api.github.com/users/huangzhaobo99/repos","events_url":"https://api.github.com/users/huangzhaobo99/events{/privacy}","received_events_url":"https://api.github.com/users/huangzhaobo99/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-07T11:43:02Z","updated_at":"2024-01-07T11:43:02Z","author_association":"CONTRIBUTOR","body":"Hi @szetszwo, Could you kindly help to take a review when you have time, Thanks.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1880034349/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1881627677","html_url":"https://github.com/apache/ratis/pull/1003#issuecomment-1881627677","issue_url":"https://api.github.com/repos/apache/ratis/issues/1003","id":1881627677,"node_id":"IC_kwDOBMxbGc5wJ1wd","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-08T18:39:48Z","updated_at":"2024-01-08T18:39:48Z","author_association":"CONTRIBUTOR","body":"@nandakumar131 , thanks a lot for working on this!  There are some errors; see https://github.com/apache/ratis/actions/runs/7419717296/job/20189737873?pr=1003#step:6:816\r\n\r\nBTW, it would be great if this can be split into a few JIRAs.  The first one could change the POM and include one or two test changes.  The following JIRAs could then mechanically change the other tests.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1881627677/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1881868429","html_url":"https://github.com/apache/ratis/pull/998#issuecomment-1881868429","issue_url":"https://api.github.com/repos/apache/ratis/issues/998","id":1881868429,"node_id":"IC_kwDOBMxbGc5wKwiN","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-08T21:43:22Z","updated_at":"2024-01-08T21:43:22Z","author_association":"CONTRIBUTOR","body":"@duongkame , thanks for reviewing this!  Just have pushed a commit addressing your comments.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1881868429/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1882124371","html_url":"https://github.com/apache/ratis/pull/1004#issuecomment-1882124371","issue_url":"https://api.github.com/repos/apache/ratis/issues/1004","id":1882124371,"node_id":"IC_kwDOBMxbGc5wLvBT","user":{"login":"huangzhaobo99","id":63718681,"node_id":"MDQ6VXNlcjYzNzE4Njgx","avatar_url":"https://avatars.githubusercontent.com/u/63718681?v=4","gravatar_id":"","url":"https://api.github.com/users/huangzhaobo99","html_url":"https://github.com/huangzhaobo99","followers_url":"https://api.github.com/users/huangzhaobo99/followers","following_url":"https://api.github.com/users/huangzhaobo99/following{/other_user}","gists_url":"https://api.github.com/users/huangzhaobo99/gists{/gist_id}","starred_url":"https://api.github.com/users/huangzhaobo99/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/huangzhaobo99/subscriptions","organizations_url":"https://api.github.com/users/huangzhaobo99/orgs","repos_url":"https://api.github.com/users/huangzhaobo99/repos","events_url":"https://api.github.com/users/huangzhaobo99/events{/privacy}","received_events_url":"https://api.github.com/users/huangzhaobo99/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-09T01:27:30Z","updated_at":"2024-01-09T01:27:30Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo your nice comments, have fixed.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1882124371/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1884049847","html_url":"https://github.com/apache/ratis/pull/998#issuecomment-1884049847","issue_url":"https://api.github.com/repos/apache/ratis/issues/998","id":1884049847,"node_id":"IC_kwDOBMxbGc5wTFG3","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-10T01:30:28Z","updated_at":"2024-01-10T01:30:28Z","author_association":"CONTRIBUTOR","body":"@duongkame , @SzyWilliam , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1884049847/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1884089254","html_url":"https://github.com/apache/ratis/pull/1007#issuecomment-1884089254","issue_url":"https://api.github.com/repos/apache/ratis/issues/1007","id":1884089254,"node_id":"IC_kwDOBMxbGc5wTOum","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-10T02:26:07Z","updated_at":"2024-01-10T02:26:07Z","author_association":"CONTRIBUTOR","body":"@szetszwo please have a look. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1884089254/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1884313924","html_url":"https://github.com/apache/ratis/pull/1005#issuecomment-1884313924","issue_url":"https://api.github.com/repos/apache/ratis/issues/1005","id":1884313924,"node_id":"IC_kwDOBMxbGc5wUFlE","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-10T07:21:27Z","updated_at":"2024-01-10T07:21:27Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo, @SzyWilliam for the review.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1884313924/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1884670594","html_url":"https://github.com/apache/ratis/pull/1003#issuecomment-1884670594","issue_url":"https://api.github.com/repos/apache/ratis/issues/1003","id":1884670594,"node_id":"IC_kwDOBMxbGc5wVcqC","user":{"login":"nandakumar131","id":8871229,"node_id":"MDQ6VXNlcjg4NzEyMjk=","avatar_url":"https://avatars.githubusercontent.com/u/8871229?v=4","gravatar_id":"","url":"https://api.github.com/users/nandakumar131","html_url":"https://github.com/nandakumar131","followers_url":"https://api.github.com/users/nandakumar131/followers","following_url":"https://api.github.com/users/nandakumar131/following{/other_user}","gists_url":"https://api.github.com/users/nandakumar131/gists{/gist_id}","starred_url":"https://api.github.com/users/nandakumar131/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nandakumar131/subscriptions","organizations_url":"https://api.github.com/users/nandakumar131/orgs","repos_url":"https://api.github.com/users/nandakumar131/repos","events_url":"https://api.github.com/users/nandakumar131/events{/privacy}","received_events_url":"https://api.github.com/users/nandakumar131/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-10T11:29:06Z","updated_at":"2024-01-10T11:29:06Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam, thanks for taking a look at the failures. I will fix them.\r\n\r\n\r\n> BTW, it would be great if this can be split into a few JIRAs. \r\n\r\n@szetszwo, sure, will do.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1884670594/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1885456203","html_url":"https://github.com/apache/ratis/pull/1006#issuecomment-1885456203","issue_url":"https://api.github.com/repos/apache/ratis/issues/1006","id":1885456203,"node_id":"IC_kwDOBMxbGc5wYcdL","user":{"login":"jojochuang","id":2691807,"node_id":"MDQ6VXNlcjI2OTE4MDc=","avatar_url":"https://avatars.githubusercontent.com/u/2691807?v=4","gravatar_id":"","url":"https://api.github.com/users/jojochuang","html_url":"https://github.com/jojochuang","followers_url":"https://api.github.com/users/jojochuang/followers","following_url":"https://api.github.com/users/jojochuang/following{/other_user}","gists_url":"https://api.github.com/users/jojochuang/gists{/gist_id}","starred_url":"https://api.github.com/users/jojochuang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jojochuang/subscriptions","organizations_url":"https://api.github.com/users/jojochuang/orgs","repos_url":"https://api.github.com/users/jojochuang/repos","events_url":"https://api.github.com/users/jojochuang/events{/privacy}","received_events_url":"https://api.github.com/users/jojochuang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-10T19:03:57Z","updated_at":"2024-01-10T19:03:57Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo. The PR looks reasonable to me but there are a few test failures that need some attention. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1885456203/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1885914071","html_url":"https://github.com/apache/ratis/pull/1007#issuecomment-1885914071","issue_url":"https://api.github.com/repos/apache/ratis/issues/1007","id":1885914071,"node_id":"IC_kwDOBMxbGc5waMPX","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-10T23:21:24Z","updated_at":"2024-01-10T23:21:24Z","author_association":"CONTRIBUTOR","body":"> Do we really need `zeroCopyEnabled`? It seems that there are no reason disabling it.\r\n\r\nZero-Copy may not be naturally compatible with all use cases. One edge case I found is that a StateMachine may cache LogEntry's data and use it outside the Ratis control. If zero-copy LogEntry data is cached and then used after Ratis releases the backing buffer, the JVM will crash with memory corruption.\r\nThe feature should be deliberately enabled per use case. Maybe we need to update `configurations.md` too.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1885914071/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886122737","html_url":"https://github.com/apache/ratis/pull/1006#issuecomment-1886122737","issue_url":"https://api.github.com/repos/apache/ratis/issues/1006","id":1886122737,"node_id":"IC_kwDOBMxbGc5wa_Lx","user":{"login":"jojochuang","id":2691807,"node_id":"MDQ6VXNlcjI2OTE4MDc=","avatar_url":"https://avatars.githubusercontent.com/u/2691807?v=4","gravatar_id":"","url":"https://api.github.com/users/jojochuang","html_url":"https://github.com/jojochuang","followers_url":"https://api.github.com/users/jojochuang/followers","following_url":"https://api.github.com/users/jojochuang/following{/other_user}","gists_url":"https://api.github.com/users/jojochuang/gists{/gist_id}","starred_url":"https://api.github.com/users/jojochuang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jojochuang/subscriptions","organizations_url":"https://api.github.com/users/jojochuang/orgs","repos_url":"https://api.github.com/users/jojochuang/repos","events_url":"https://api.github.com/users/jojochuang/events{/privacy}","received_events_url":"https://api.github.com/users/jojochuang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-11T02:45:53Z","updated_at":"2024-01-11T02:45:53Z","author_association":"CONTRIBUTOR","body":"The test passed locally so I suppose it's unrelated. +1","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886122737/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886154471","html_url":"https://github.com/apache/ratis/pull/1008#issuecomment-1886154471","issue_url":"https://api.github.com/repos/apache/ratis/issues/1008","id":1886154471,"node_id":"IC_kwDOBMxbGc5wbG7n","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-11T03:15:24Z","updated_at":"2024-01-11T03:15:24Z","author_association":"MEMBER","body":"> or should we first update the source to more closely match the current website?\r\n\r\nThe source contains all the features, changes and bug fixes, how about just use this source?\r\n+1 the change looks good to me.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886154471/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886233950","html_url":"https://github.com/apache/ratis/pull/1006#issuecomment-1886233950","issue_url":"https://api.github.com/repos/apache/ratis/issues/1006","id":1886233950,"node_id":"IC_kwDOBMxbGc5wbaVe","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-11T04:43:13Z","updated_at":"2024-01-11T17:04:56Z","author_association":"CONTRIBUTOR","body":"> The test passed locally so I suppose it's unrelated. ...\r\n\r\nYes, it is not related to this change.\r\n\r\nIt looks like that the `RaftServerImpl.close()` method was called  by anther thread in the middle of `LeaderStateImpl.stepDown(..)`.  Synchronize the `close()` method should be able to fix it.\r\n\r\n```java\r\nCaused by: java.lang.NullPointerException: leaderState == null\r\n\tat org.apache.ratis.server.impl.RoleInfo.shutdownLeaderState(RoleInfo.java:90)\r\n\tat org.apache.ratis.server.impl.RaftServerImpl.changeToFollower(RaftServerImpl.java:579)\r\n\t...\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886233950/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886267903","html_url":"https://github.com/apache/ratis/pull/1007#issuecomment-1886267903","issue_url":"https://api.github.com/repos/apache/ratis/issues/1007","id":1886267903,"node_id":"IC_kwDOBMxbGc5wbin_","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-11T05:27:27Z","updated_at":"2024-01-11T05:27:27Z","author_association":"CONTRIBUTOR","body":"> ... a StateMachine may cache LogEntry's data and use it outside the Ratis control. ...\r\n\r\nWe should pass the `ReferenceCountedObject` in this case.  Indeed, Ozone currently cache log entries in datanode. We should make it work.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886267903/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886366066","html_url":"https://github.com/apache/ratis/pull/1007#issuecomment-1886366066","issue_url":"https://api.github.com/repos/apache/ratis/issues/1007","id":1886366066,"node_id":"IC_kwDOBMxbGc5wb6ly","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-11T06:19:06Z","updated_at":"2024-01-11T06:19:06Z","author_association":"CONTRIBUTOR","body":"> > ... a StateMachine may cache LogEntry's data and use it outside the Ratis control. ...\r\n> \r\n> We should pass the `ReferenceCountedObject` in this case. Indeed, Ozone currently cache log entries in datanode. We should make it work.\r\n\r\nYeah, it's where I'm from. Agree, I filed RATIS-1997 for this. Btw, for backward compatibility, we need to disable zero copy by default. When applications enable zero-copy, a migration to use the new versions of StateMachine API is needed. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886366066/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886429253","html_url":"https://github.com/apache/ratis/pull/1006#issuecomment-1886429253","issue_url":"https://api.github.com/repos/apache/ratis/issues/1006","id":1886429253,"node_id":"IC_kwDOBMxbGc5wcKBF","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-11T07:12:55Z","updated_at":"2024-01-11T07:12:55Z","author_association":"CONTRIBUTOR","body":"`synchronized close()` did not work.  Complete the future exceptionally and then handle it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886429253/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886433448","html_url":"https://github.com/apache/ratis/pull/1007#issuecomment-1886433448","issue_url":"https://api.github.com/repos/apache/ratis/issues/1007","id":1886433448,"node_id":"IC_kwDOBMxbGc5wcLCo","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-11T07:16:34Z","updated_at":"2024-01-11T07:16:34Z","author_association":"CONTRIBUTOR","body":"For backward compatibility, we will provide two APIs.  For examples, there are two `StateMachine.DataChannel.write(..)` methods:\r\n```java\r\n//StateMachine.DataChannel\r\n    default int write(ByteBuffer buffer) throws IOException {...}\r\n\r\n    default int write(ReferenceCountedObject<ByteBuffer> referenceCountedBuffer) throws IOException {...}\r\n```\r\nAn implementation can choose to override either one of them.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886433448/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886495012","html_url":"https://github.com/apache/ratis/pull/1007#issuecomment-1886495012","issue_url":"https://api.github.com/repos/apache/ratis/issues/1007","id":1886495012,"node_id":"IC_kwDOBMxbGc5wcaEk","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-11T07:37:18Z","updated_at":"2024-01-11T07:37:18Z","author_association":"CONTRIBUTOR","body":"> For backward compatibility, we will provide two APIs.  For examples, there are two `StateMachine.DataChannel.write(..)` methods:\n> \n> ```java\n> \n> //StateMachine.DataChannel\n> \n>     default int write(ByteBuffer buffer) throws IOException {...}\n> \n> \n> \n>     default int write(ReferenceCountedObject<ByteBuffer> referenceCountedBuffer) throws IOException {...}\n> \n> ```\n> \n> An implementation can choose to override either one of them.\n\nThanks @szetszwo, totally agree with the API suggestion. We will achive code compatibility with that. \nBy backward compatibility, I meant for exsting applications, they have to make a code change to implement the new API before enabling zero copy safely or may crash in runtime. Releasing a version of Ratis with zero-copy implicitly enabled doesn't seem backward compatible in that sense. We need a flag that is off by default, or zero copy is released in a new major version with clear release notes stating the needed migration. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886495012/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886518456","html_url":"https://github.com/apache/ratis/pull/1007#issuecomment-1886518456","issue_url":"https://api.github.com/repos/apache/ratis/issues/1007","id":1886518456,"node_id":"IC_kwDOBMxbGc5wcfy4","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-11T07:45:11Z","updated_at":"2024-01-11T07:45:11Z","author_association":"CONTRIBUTOR","body":"> ... for exsting applications, they have to make a code change to implement the new API before enabling zero copy safely or may crash in runtime.\r\n\r\nWe will have zero copy enabled and  copy log object before passing it in the old API (i.e. the method without `ReferenceCountedObject`).  For the new API with `ReferenceCountedObject`, we will not copy it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886518456/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886533938","html_url":"https://github.com/apache/ratis/pull/1007#issuecomment-1886533938","issue_url":"https://api.github.com/repos/apache/ratis/issues/1007","id":1886533938,"node_id":"IC_kwDOBMxbGc5wcjky","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-11T07:50:12Z","updated_at":"2024-01-11T07:50:48Z","author_association":"CONTRIBUTOR","body":"The code looks like below:\r\n```java\r\n default int write(LogEntryProto entry) throws IOException {\r\n    throw new UnsupportedOperationException();\r\n }\r\n\r\n default int write(ReferenceCountedObject<LogEntryProto> referenceCountedEntry) throws IOException {\r\n    LogEntryProto copied = copy(referenceCountedEntry.get())\r\n    return write(copied);\r\n }\r\n```\r\nApplications can override either of the methods.  The ratis code will call `write(ReferenceCountedObject<LogEntryProto>)`.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886533938/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886967129","html_url":"https://github.com/apache/ratis/pull/1008#issuecomment-1886967129","issue_url":"https://api.github.com/repos/apache/ratis/issues/1008","id":1886967129,"node_id":"IC_kwDOBMxbGc5weNVZ","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-11T11:45:56Z","updated_at":"2024-01-11T11:45:56Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo, @SzyWilliam for the review.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1886967129/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1887799851","html_url":"https://github.com/apache/ratis/pull/1007#issuecomment-1887799851","issue_url":"https://api.github.com/repos/apache/ratis/issues/1007","id":1887799851,"node_id":"IC_kwDOBMxbGc5whYor","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-11T19:14:54Z","updated_at":"2024-01-11T19:22:43Z","author_association":"CONTRIBUTOR","body":"> > ... for exsting applications, they have to make a code change to implement the new API before enabling zero copy safely or may crash in runtime.\r\n> \r\n> We will have zero copy enabled and copy log object before passing it in the old API (i.e. the method without `ReferenceCountedObject`). For the new API with `ReferenceCountedObject`, we will not copy it.\r\n\r\nOk, that path makes sense, thanks. I removed the config flag.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1887799851/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1888097768","html_url":"https://github.com/apache/ratis/pull/1007#issuecomment-1888097768","issue_url":"https://api.github.com/repos/apache/ratis/issues/1007","id":1888097768,"node_id":"IC_kwDOBMxbGc5wihXo","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-11T22:56:15Z","updated_at":"2024-01-11T22:58:31Z","author_association":"CONTRIBUTOR","body":"The `TestMessageStreamApiWithGrpc.testStream` seems to become flaky after this chance. The failure looks quite serious. \r\nThe test looks like below:\r\n```\r\n   // stream multiple parts\r\n    final int numParts = 9;\r\n    final int endOfRequest = 6;\r\n    final StringBuilder key = new StringBuilder();\r\n    try(RaftClient client = cluster.createClient();\r\n        MessageOutputStream out = client.getMessageStreamApi().stream()) {\r\n      for (int i = 1; i <= numParts; i++) {\r\n        key.append(i);\r\n        SimpleMessage message = new SimpleMessage(i + \"\");\r\n        boolean end = i == endOfRequest;\r\n        LOG.info(\"Sending: {}, end = {}\",  message.messageId, end);\r\n        out.sendAsync(message, end);\r\n      }\r\n    }\r\n    // check if all the parts are streamed as a single message.\r\n```\r\nI think two messages `123456` and `789` is supposed to be committed.\r\nHowever, the logs of the failures show that other messages are committed, e.g.\r\n\r\n```\r\n2024-01-11 14:46:46,921 [Time-limited test] INFO  grpc.TestMessageStreamApiWithGrpc (MessageStreamApiTests.java:runTestStream(71)) - Sending: 1, end = false\r\n2024-01-11 14:46:46,931 [Time-limited test] INFO  grpc.TestMessageStreamApiWithGrpc (MessageStreamApiTests.java:runTestStream(71)) - Sending: 2, end = false\r\n2024-01-11 14:46:46,931 [Time-limited test] INFO  grpc.TestMessageStreamApiWithGrpc (MessageStreamApiTests.java:runTestStream(71)) - Sending: 3, end = false\r\n2024-01-11 14:46:46,932 [Time-limited test] INFO  grpc.TestMessageStreamApiWithGrpc (MessageStreamApiTests.java:runTestStream(71)) - Sending: 4, end = false\r\n2024-01-11 14:46:46,932 [Time-limited test] INFO  grpc.TestMessageStreamApiWithGrpc (MessageStreamApiTests.java:runTestStream(71)) - Sending: 5, end = false\r\n2024-01-11 14:46:46,932 [Time-limited test] INFO  grpc.TestMessageStreamApiWithGrpc (MessageStreamApiTests.java:runTestStream(71)) - Sending: 6, end = true\r\n2024-01-11 14:46:46,932 [Time-limited test] INFO  grpc.TestMessageStreamApiWithGrpc (MessageStreamApiTests.java:runTestStream(71)) - Sending: 7, end = false\r\n2024-01-11 14:46:46,932 [Time-limited test] INFO  grpc.TestMessageStreamApiWithGrpc (MessageStreamApiTests.java:runTestStream(71)) - Sending: 8, end = false\r\n2024-01-11 14:46:46,932 [Time-limited test] INFO  grpc.TestMessageStreamApiWithGrpc (MessageStreamApiTests.java:runTestStream(71)) - Sending: 9, end = false\r\n....\r\n2024-01-11 14:46:46,995 [s0@group-F60956FB3D4A-StateMachineUpdater] INFO  impl.SimpleStateMachine4Testing (SimpleStateMachine4Testing.java:put(205)) - s0: put 1, 623456 -> (t:1, i:1), STATEMACHINELOGENTRY, 46@client-B3C3E9191731\r\n2024-01-11 14:46:46,998 [s0@group-F60956FB3D4A-StateMachineUpdater] INFO  impl.SimpleStateMachine4Testing (SimpleStateMachine4Testing.java:put(205)) - s0: put 2, 789 -> (t:1, i:2), STATEMACHINELOGENTRY, 50@client-B3C3E9191731\r\n2024-01-11 14:46:47,012 [s2@group-F60956FB3D4A-StateMachineUpdater] INFO  impl.SimpleStateMachine4Testing (SimpleStateMachine4Testing.java:put(205)) - s2: put 1, 623456 -> (t:1, i:1), STATEMACHINELOGENTRY, 46@client-B3C3E9191731\r\n2024-01-11 14:46:47,012 [s1@group-F60956FB3D4A-StateMachineUpdater] INFO  impl.SimpleStateMachine4Testing (SimpleStateMachine4Testing.java:put(205)) - s1: put 1, 623456 -> (t:1, i:1), STATEMACHINELOGENTRY, 46@client-B3C3E9191731\r\n2024-01-11 14:46:47,023 [s2@group-F60956FB3D4A-StateMachineUpdater] INFO  impl.SimpleStateMachine4Testing (SimpleStateMachine4Testing.java:put(205)) - s2: put 2, 789 -> (t:1, i:2), STATEMACHINELOGENTRY, 50@client-B3C3E9191731\r\n2024-01-11 14:46:47,023 [s1@group-F60956FB3D4A-StateMachineUpdater] INFO  impl.SimpleStateMachine4Testing (SimpleStateMachine4Testing.java:put(205)) - s1: put 2, 789 -> (t:1, i:2), STATEMACHINELOGENTRY, 50@client-B3C3E9191731\r\n```\r\nI'm debugging to understand the issue, but it'll be very helpful if you can have a quick look.  @szetszwo \r\nIt's reproducible locally when repeating `TestMessageStreamApiWithGrpc.testStream` (Repeat until failure mode). ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1888097768/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1888177344","html_url":"https://github.com/apache/ratis/pull/1007#issuecomment-1888177344","issue_url":"https://api.github.com/repos/apache/ratis/issues/1007","id":1888177344,"node_id":"IC_kwDOBMxbGc5wi0zA","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-12T00:10:26Z","updated_at":"2024-01-12T00:10:26Z","author_association":"CONTRIBUTOR","body":"@duongkame , the grpc tests keep failing.  This failure seems related to buffer corruption https://github.com/apache/ratis/actions/runs/7493450746/job/20404797679?pr=1007#step:6:656","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1888177344/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1888386731","html_url":"https://github.com/apache/ratis/pull/1007#issuecomment-1888386731","issue_url":"https://api.github.com/repos/apache/ratis/issues/1007","id":1888386731,"node_id":"IC_kwDOBMxbGc5wjn6r","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-12T03:43:30Z","updated_at":"2024-01-12T04:40:31Z","author_association":"CONTRIBUTOR","body":"> @duongkame , the grpc tests keep failing. This failure seems related to buffer corruption https://github.com/apache/ratis/actions/runs/7493450746/job/20404797679?pr=1007#step:6:656\r\n\r\nTurns out, it's specific to MessageStream API. `MessageStreamRequests.PendingStream` keeps a raw reference to the message buffer of all the pending request.\r\n\r\nIn `MessageStreamRequests.PendingStream.append`:\r\n```\r\nsynchronized CompletableFuture<ByteString> append(long messageId, Message message) {\r\n      ...\r\n      bytes = bytes.concat(message.getContent());\r\n      return CompletableFuture.completedFuture(bytes);\r\n    }\r\n```\r\nThe `bytes.concat(message.getContent())` only creates a wrapper of the two `ByteStrings` (RopeByteString). And this makes the resulting `bytes` keep references to all of the pending message request buffers without reference counting.\r\n\r\nWe can either just copy the message. \r\n```bytes = bytes.concat(copy(message.getContent()));```\r\nor make PendingStream keeping all the counters to all the previous requests in the stream. Working on a fix now. \r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1888386731/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1888402397","html_url":"https://github.com/apache/ratis/pull/1006#issuecomment-1888402397","issue_url":"https://api.github.com/repos/apache/ratis/issues/1006","id":1888402397,"node_id":"IC_kwDOBMxbGc5wjrvd","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-12T04:07:54Z","updated_at":"2024-01-12T04:07:54Z","author_association":"CONTRIBUTOR","body":"> ... If we allow a low replication level (e.g.1), we can turn ratis into some async data replication service ;)\r\n\r\nThis is an interesting idea!  The leader may response once it has persisted the request.  However, the leader cannot yet apply it to the state machine.  This is okay for some stateless servers such as a data replication service as you mentioned..\r\n\r\n@jojochuang , @SzyWilliam , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1888402397/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1889808953","html_url":"https://github.com/apache/ratis/pull/1007#issuecomment-1889808953","issue_url":"https://api.github.com/repos/apache/ratis/issues/1007","id":1889808953,"node_id":"IC_kwDOBMxbGc5wpDI5","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-12T19:04:33Z","updated_at":"2024-01-12T19:04:33Z","author_association":"CONTRIBUTOR","body":"> @duongkame , thanks for the update! We need to release `pendingRefs` when the map is being cleared; see the comments inlined and also https://issues.apache.org/jira/secure/attachment/13065937/1007_review.patch\r\n\r\nThanks a lot for the review @szetszwo. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1889808953/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1890272317","html_url":"https://github.com/apache/ratis/pull/1007#issuecomment-1890272317","issue_url":"https://api.github.com/repos/apache/ratis/issues/1007","id":1890272317,"node_id":"IC_kwDOBMxbGc5wq0Q9","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-13T03:03:02Z","updated_at":"2024-01-13T03:03:02Z","author_association":"CONTRIBUTOR","body":"@duongkame , thanks a lot for working on this hard problem!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1890272317/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1890824094","html_url":"https://github.com/apache/ratis/pull/1011#issuecomment-1890824094","issue_url":"https://api.github.com/repos/apache/ratis/issues/1011","id":1890824094,"node_id":"IC_kwDOBMxbGc5ws6-e","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-14T02:13:06Z","updated_at":"2024-01-14T02:13:06Z","author_association":"CONTRIBUTOR","body":"c.c @szetszwo ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1890824094/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1891606341","html_url":"https://github.com/apache/ratis/pull/1009#issuecomment-1891606341","issue_url":"https://api.github.com/repos/apache/ratis/issues/1009","id":1891606341,"node_id":"IC_kwDOBMxbGc5wv59F","user":{"login":"ivandika3","id":36403683,"node_id":"MDQ6VXNlcjM2NDAzNjgz","avatar_url":"https://avatars.githubusercontent.com/u/36403683?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandika3","html_url":"https://github.com/ivandika3","followers_url":"https://api.github.com/users/ivandika3/followers","following_url":"https://api.github.com/users/ivandika3/following{/other_user}","gists_url":"https://api.github.com/users/ivandika3/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandika3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandika3/subscriptions","organizations_url":"https://api.github.com/users/ivandika3/orgs","repos_url":"https://api.github.com/users/ivandika3/repos","events_url":"https://api.github.com/users/ivandika3/events{/privacy}","received_events_url":"https://api.github.com/users/ivandika3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-15T08:52:27Z","updated_at":"2024-01-15T08:52:27Z","author_association":"CONTRIBUTOR","body":"Thank you for the review and merge @szetszwo ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1891606341/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1892264146","html_url":"https://github.com/apache/ratis/pull/1012#issuecomment-1892264146","issue_url":"https://api.github.com/repos/apache/ratis/issues/1012","id":1892264146,"node_id":"IC_kwDOBMxbGc5wyajS","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-15T14:20:27Z","updated_at":"2024-01-15T14:20:27Z","author_association":"CONTRIBUTOR","body":"@kaijchen please review if you have time","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1892264146/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1892534119","html_url":"https://github.com/apache/ratis/pull/1012#issuecomment-1892534119","issue_url":"https://api.github.com/repos/apache/ratis/issues/1012","id":1892534119,"node_id":"IC_kwDOBMxbGc5wzcdn","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-15T17:09:52Z","updated_at":"2024-01-15T17:09:52Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for reviewing and merging this.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1892534119/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1892686416","html_url":"https://github.com/apache/ratis/pull/1011#issuecomment-1892686416","issue_url":"https://api.github.com/repos/apache/ratis/issues/1011","id":1892686416,"node_id":"IC_kwDOBMxbGc5w0BpQ","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-15T19:36:19Z","updated_at":"2024-01-15T19:36:19Z","author_association":"CONTRIBUTOR","body":"Moved back to draft to debug a relevant error. Somehow TestRaftWithSimulatedRpc (testWithLoad and testOldLeaderNotCommit) creates a situation which two log entries (different terms) come to a server for the same index. The later fails because the TransactionContext has already already created and cached for the first one. \r\nThis seems to be always the case, but now starts to be exposed because now we apply referent count for appendEntries. \r\n@szetszwo \r\n\r\n```\r\nCaused by: java.lang.IllegalStateException: entry.term: expected == 4 but computed == 5\r\n\tat org.apache.ratis.util.Preconditions.assertTrue(Preconditions.java:76)\r\n\tat org.apache.ratis.util.Preconditions.assertSame(Preconditions.java:81)\r\n\tat org.apache.ratis.statemachine.TransactionContext.wrap(TransactionContext.java:104)\r\n\tat org.apache.ratis.statemachine.impl.TransactionContextImpl.wrap(TransactionContextImpl.java:136)\r\n\tat org.apache.ratis.server.raftlog.segmented.SegmentedRaftLog.appendEntryImpl(SegmentedRaftLog.java:434)\r\n\tat org.apache.ratis.server.raftlog.RaftLogBase.lambda$appendEntry$11(RaftLogBase.java:351)\r\n\tat org.apache.ratis.server.raftlog.RaftLogSequentialOps$Runner.runSequentially(RaftLogSequentialOps.java:78)\r\n\tat org.apache.ratis.server.raftlog.RaftLogBase.appendEntry(RaftLogBase.java:351)\r\n\tat org.apache.ratis.server.raftlog.segmented.SegmentedRaftLog.appendImpl(SegmentedRaftLog.java:477)\r\n\tat org.apache.ratis.server.raftlog.RaftLogBase.lambda$append$12(RaftLogBase.java:358)\r\n\tat org.apache.ratis.server.raftlog.RaftLogSequentialOps$Runner.runSequentially(RaftLogSequentialOps.java:69)\r\n\tat org.apache.ratis.server.raftlog.RaftLogBase.append(RaftLogBase.java:358)\r\n\tat org.apache.ratis.server.impl.RaftServerImpl.appendEntriesAsync(RaftServerImpl.java:1653)\r\n\tat org.apache.ratis.server.impl.RaftServerImpl.appendEntriesAsync(RaftServerImpl.java:1517)\r\n\tat org.apache.ratis.server.impl.RaftServerImpl.appendEntries(RaftServerImpl.java:1500)\r\n\tat org.apache.ratis.server.impl.RaftServerProxy.appendEntries(RaftServerProxy.java:663)\r\n\tat org.apache.ratis.server.simulation.SimulatedServerRpc$1.handleRequest(SimulatedServerRpc.java:163)\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1892686416/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1892706861","html_url":"https://github.com/apache/ratis/pull/1011#issuecomment-1892706861","issue_url":"https://api.github.com/repos/apache/ratis/issues/1011","id":1892706861,"node_id":"IC_kwDOBMxbGc5w0Got","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-15T19:58:22Z","updated_at":"2024-01-15T19:58:22Z","author_association":"CONTRIBUTOR","body":"> ... TestRaftWithSimulatedRpc (testWithLoad and testOldLeaderNotCommit) creates a situation ...\r\n\r\nCould we fix `TestRaftWithSimulatedRpc`?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1892706861/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1892710458","html_url":"https://github.com/apache/ratis/pull/1011#issuecomment-1892710458","issue_url":"https://api.github.com/repos/apache/ratis/issues/1011","id":1892710458,"node_id":"IC_kwDOBMxbGc5w0Hg6","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-15T20:02:28Z","updated_at":"2024-01-15T20:02:28Z","author_association":"CONTRIBUTOR","body":"> Could we fix `TestRaftWithSimulatedRpc`?\r\n\r\nI'm working on it, will republish this PR after fixing it. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1892710458/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1892744486","html_url":"https://github.com/apache/ratis/pull/1013#issuecomment-1892744486","issue_url":"https://api.github.com/repos/apache/ratis/issues/1013","id":1892744486,"node_id":"IC_kwDOBMxbGc5w0P0m","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-15T20:42:41Z","updated_at":"2024-01-15T20:42:41Z","author_association":"CONTRIBUTOR","body":"@adoroszlai , Thanks for reviewing this!  Yes, we should also fix `helloReplies`.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1892744486/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1893240678","html_url":"https://github.com/apache/ratis/pull/1012#issuecomment-1893240678","issue_url":"https://api.github.com/repos/apache/ratis/issues/1012","id":1893240678,"node_id":"IC_kwDOBMxbGc5w2I9m","user":{"login":"kaijchen","id":5821159,"node_id":"MDQ6VXNlcjU4MjExNTk=","avatar_url":"https://avatars.githubusercontent.com/u/5821159?v=4","gravatar_id":"","url":"https://api.github.com/users/kaijchen","html_url":"https://github.com/kaijchen","followers_url":"https://api.github.com/users/kaijchen/followers","following_url":"https://api.github.com/users/kaijchen/following{/other_user}","gists_url":"https://api.github.com/users/kaijchen/gists{/gist_id}","starred_url":"https://api.github.com/users/kaijchen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaijchen/subscriptions","organizations_url":"https://api.github.com/users/kaijchen/orgs","repos_url":"https://api.github.com/users/kaijchen/repos","events_url":"https://api.github.com/users/kaijchen/events{/privacy}","received_events_url":"https://api.github.com/users/kaijchen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-16T08:06:41Z","updated_at":"2024-01-16T08:06:41Z","author_association":"CONTRIBUTOR","body":"> @kaijchen please review if you have time\r\n\r\nGreat work, thanks for the fix @adoroszlai.\r\nI didn't notice this message because I had my github email notification turned off. \r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1893240678/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1894058959","html_url":"https://github.com/apache/ratis/pull/1010#issuecomment-1894058959","issue_url":"https://api.github.com/repos/apache/ratis/issues/1010","id":1894058959,"node_id":"IC_kwDOBMxbGc5w5QvP","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-16T16:11:32Z","updated_at":"2024-01-16T16:11:32Z","author_association":"CONTRIBUTOR","body":"@adoroszlai , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1894058959/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1894374538","html_url":"https://github.com/apache/ratis/pull/1011#issuecomment-1894374538","issue_url":"https://api.github.com/repos/apache/ratis/issues/1011","id":1894374538,"node_id":"IC_kwDOBMxbGc5w6dyK","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-16T19:25:24Z","updated_at":"2024-01-16T19:37:30Z","author_association":"CONTRIBUTOR","body":"@szetszwo  Regarding `TestRaftWithSimulatedRpc`. What happened is:\r\n1. `s2` was the leader of term `2`.\r\n2. `s2` received a client request, added to log as `(t:2, i:1475)`.\r\n3. `s0` received `appendEntries` from `s2` for `(t:2, i:1475)`. A `TransactionContext` is [created](https://github.com/apache/ratis/blob/master/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLog.java#L477) for `(t:2, i:1475)` during `appendEntries` (I think this is wrong). \r\n4. `1475` hadn't been replcated to majority of nodes,  `s0` hadn't applied it yet.\r\n5. Leader changed to `s1`. (`s1` hadn't received `appendEntries` for `(t:2, i:1475)`).\r\n6. `s1` received a client request, appended it as `1475`\r\n7. `s1` decreased `s0`'s `nextIndex`: `s1@group-9EAE5FF30820->s0: decreaseNextIndex nextIndex: updateUnconditionally 1475 -> 1474`\r\n8. `s0` received `appendEntries` from `s2` for `(t:2, i:1475)`, it looked up `TransactionContext` and saw one created per 3. Assertion `Preconditions.assertSame(getLogEntry().getTerm(), entry.getTerm(), \"entry.term\");` fails.\r\n\r\nI believe the problem is from the fact that TransactionContext is [created](https://github.com/apache/ratis/blob/master/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLog.java#L477) during `appendEntries`.\r\n\r\n``` \r\n    // in SegmentedRaftLog#appendImpl\r\n     for (int i = index; i < entries.size(); i++) {\r\n        final LogEntryProto entry = entries.get(i);\r\n        futures.add(appendEntry(entry, server.getTransactionContext(entry, true)));\r\n      }\r\n```\r\n`appendEntries` should lookup `TransactionContext` only.\r\n``` \r\n        futures.add(appendEntry(entry, server.getTransactionContext(entry, false)));\r\n```\r\nOr the `term` assertion shouldn't be there. \r\n\r\nLook at the failing test per https://github.com/apache/ratis/actions/runs/7516329635/artifacts/1167720078, `org.apache.ratis.server.simulation.TestRaftWithSimulatedRpc-output.txt`.\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1894374538/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1894758227","html_url":"https://github.com/apache/ratis/pull/1011#issuecomment-1894758227","issue_url":"https://api.github.com/repos/apache/ratis/issues/1011","id":1894758227,"node_id":"IC_kwDOBMxbGc5w77dT","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-17T00:54:22Z","updated_at":"2024-01-17T00:54:22Z","author_association":"CONTRIBUTOR","body":"> Regarding TestRaftWithSimulatedRpc. What happened is: ...\r\n\r\n@duongkame , Thanks a lot for digging it up!  Could you file a bug?  Please assign it to me (unless you like to work on it.)","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1894758227/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1894793295","html_url":"https://github.com/apache/ratis/pull/1011#issuecomment-1894793295","issue_url":"https://api.github.com/repos/apache/ratis/issues/1011","id":1894793295,"node_id":"IC_kwDOBMxbGc5w8EBP","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-17T01:36:24Z","updated_at":"2024-01-17T01:36:24Z","author_association":"CONTRIBUTOR","body":" > Could you file a bug? Please assign it to me (unless you like to work on it.)\r\nSure, filed [RATIS-2001](https://issues.apache.org/jira/browse/RATIS-2001) and assigned it to you. @szetszwo \r\n\r\nI temporarily removed the same term assertion to unblock this PR.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1894793295/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1896123571","html_url":"https://github.com/apache/ratis/pull/1015#issuecomment-1896123571","issue_url":"https://api.github.com/repos/apache/ratis/issues/1015","id":1896123571,"node_id":"IC_kwDOBMxbGc5xBIyz","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-17T16:06:17Z","updated_at":"2024-01-17T16:06:17Z","author_association":"CONTRIBUTOR","body":"> ... exciting to see the new issue â€œcenturyâ€!\r\n\r\nDefinitely!\r\n\r\n@SzyWilliam , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1896123571/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1896126585","html_url":"https://github.com/apache/ratis/pull/1011#issuecomment-1896126585","issue_url":"https://api.github.com/repos/apache/ratis/issues/1011","id":1896126585,"node_id":"IC_kwDOBMxbGc5xBJh5","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-17T16:07:51Z","updated_at":"2024-01-17T16:07:51Z","author_association":"CONTRIBUTOR","body":"> ... Sure, filed RATIS-2001 ...\r\n\r\nRATIS-2001 is merged.  Please update this with master.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1896126585/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1896431299","html_url":"https://github.com/apache/ratis/pull/1011#issuecomment-1896431299","issue_url":"https://api.github.com/repos/apache/ratis/issues/1011","id":1896431299,"node_id":"IC_kwDOBMxbGc5xCT7D","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-17T18:44:12Z","updated_at":"2024-01-17T18:44:12Z","author_association":"CONTRIBUTOR","body":"> [RATIS-2001](https://issues.apache.org/jira/browse/RATIS-2001) is merged. Please update this with master.\r\n\r\nThanks a lot for the quick fix and the detailed review. @szetszwo \r\nI've updated the code with the latest master and addressed your comments. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1896431299/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1897570860","html_url":"https://github.com/apache/ratis/pull/1017#issuecomment-1897570860","issue_url":"https://api.github.com/repos/apache/ratis/issues/1017","id":1897570860,"node_id":"IC_kwDOBMxbGc5xGqIs","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T00:50:52Z","updated_at":"2024-01-18T00:51:04Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for the suggestion, applied.  It's much simpler this way.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1897570860/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1897574961","html_url":"https://github.com/apache/ratis/pull/1019#issuecomment-1897574961","issue_url":"https://api.github.com/repos/apache/ratis/issues/1019","id":1897574961,"node_id":"IC_kwDOBMxbGc5xGrIx","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T00:54:51Z","updated_at":"2024-01-18T00:54:51Z","author_association":"CONTRIBUTOR","body":"> We should add a `return` as below.\r\n> \r\n> ```java\r\n> +++ b/ratis-examples/src/main/java/org/apache/ratis/examples/filestore/cli/DataStream.java\r\n> @@ -117,6 +117,7 @@ public class DataStream extends Client {\r\n>    protected void operation(List<FileStoreClient> clients) throws IOException, ExecutionException, InterruptedException {\r\n>      if (!checkParam()) {\r\n>        close(clients);\r\n> +      return;\r\n>      }\r\n>  \r\n>      final ExecutorService executor = Executors.newFixedThreadPool(getNumThread());\r\n> ```\r\n\r\nIf I'm not missing something, it's already there in the patch:\r\n\r\nhttps://github.com/apache/ratis/blob/703480fd7a4bb84c9ec508b96c35832f8392838d/ratis-examples/src/main/java/org/apache/ratis/examples/filestore/cli/DataStream.java#L116-L123","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1897574961/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1897576922","html_url":"https://github.com/apache/ratis/pull/1018#issuecomment-1897576922","issue_url":"https://api.github.com/repos/apache/ratis/issues/1018","id":1897576922,"node_id":"IC_kwDOBMxbGc5xGrna","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T00:56:57Z","updated_at":"2024-01-18T00:56:57Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for reviewing and merging this.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1897576922/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1897753319","html_url":"https://github.com/apache/ratis/pull/1003#issuecomment-1897753319","issue_url":"https://api.github.com/repos/apache/ratis/issues/1003","id":1897753319,"node_id":"IC_kwDOBMxbGc5xHWrn","user":{"login":"nandakumar131","id":8871229,"node_id":"MDQ6VXNlcjg4NzEyMjk=","avatar_url":"https://avatars.githubusercontent.com/u/8871229?v=4","gravatar_id":"","url":"https://api.github.com/users/nandakumar131","html_url":"https://github.com/nandakumar131","followers_url":"https://api.github.com/users/nandakumar131/followers","following_url":"https://api.github.com/users/nandakumar131/following{/other_user}","gists_url":"https://api.github.com/users/nandakumar131/gists{/gist_id}","starred_url":"https://api.github.com/users/nandakumar131/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nandakumar131/subscriptions","organizations_url":"https://api.github.com/users/nandakumar131/orgs","repos_url":"https://api.github.com/users/nandakumar131/repos","events_url":"https://api.github.com/users/nandakumar131/events{/privacy}","received_events_url":"https://api.github.com/users/nandakumar131/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T04:00:30Z","updated_at":"2024-01-18T04:00:30Z","author_association":"CONTRIBUTOR","body":"@szetszwo, can you take a look at it again?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1897753319/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1898040101","html_url":"https://github.com/apache/ratis/pull/1019#issuecomment-1898040101","issue_url":"https://api.github.com/repos/apache/ratis/issues/1019","id":1898040101,"node_id":"IC_kwDOBMxbGc5xIcsl","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T08:47:25Z","updated_at":"2024-01-18T08:47:25Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for reviewing and merging this.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1898040101/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1898040905","html_url":"https://github.com/apache/ratis/pull/1017#issuecomment-1898040905","issue_url":"https://api.github.com/repos/apache/ratis/issues/1017","id":1898040905,"node_id":"IC_kwDOBMxbGc5xIc5J","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T08:47:40Z","updated_at":"2024-01-18T08:47:40Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for reviewing and merging this.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1898040905/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1898780302","html_url":"https://github.com/apache/ratis/pull/1016#issuecomment-1898780302","issue_url":"https://api.github.com/repos/apache/ratis/issues/1016","id":1898780302,"node_id":"IC_kwDOBMxbGc5xLRaO","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T16:09:20Z","updated_at":"2024-01-18T16:09:20Z","author_association":"CONTRIBUTOR","body":"> Let's take this chance to move the iterator code to an inner class\r\n\r\nThanks @szetszwo for the review.  I agree that extracting to inner class improves the code.\r\n\r\nThere is one piece from the review patch that I omitted: extracting the `FileChunkProto readFileChunk(FileInfo info)` method.  The rest of the refactoring is straightforward, but I don't think I understand the reason `fileIndex++` can be incremented outside the `if (chunk.getDone())` block.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1898780302/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1898849617","html_url":"https://github.com/apache/ratis/pull/1011#issuecomment-1898849617","issue_url":"https://api.github.com/repos/apache/ratis/issues/1011","id":1898849617,"node_id":"IC_kwDOBMxbGc5xLiVR","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T16:48:53Z","updated_at":"2024-01-18T16:48:53Z","author_association":"CONTRIBUTOR","body":"Thanks for the review @szetszwo ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1898849617/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899166436","html_url":"https://github.com/apache/ratis/pull/1020#issuecomment-1899166436","issue_url":"https://api.github.com/repos/apache/ratis/issues/1020","id":1899166436,"node_id":"IC_kwDOBMxbGc5xMvrk","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T20:35:30Z","updated_at":"2024-01-18T20:35:30Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for reviewing and merging this.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899166436/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899167622","html_url":"https://github.com/apache/ratis/pull/1014#issuecomment-1899167622","issue_url":"https://api.github.com/repos/apache/ratis/issues/1014","id":1899167622,"node_id":"IC_kwDOBMxbGc5xMv-G","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T20:36:30Z","updated_at":"2024-01-18T20:36:30Z","author_association":"CONTRIBUTOR","body":"A test is failing because log entries for configuration has it zero-copy buffer released too early ppening on #1021 for a fix.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899167622/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899168082","html_url":"https://github.com/apache/ratis/pull/1021#issuecomment-1899168082","issue_url":"https://api.github.com/repos/apache/ratis/issues/1021","id":1899168082,"node_id":"IC_kwDOBMxbGc5xMwFS","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T20:36:53Z","updated_at":"2024-01-18T20:36:53Z","author_association":"CONTRIBUTOR","body":"@szetszwo can you have a look?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899168082/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899168314","html_url":"https://github.com/apache/ratis/pull/1014#issuecomment-1899168314","issue_url":"https://api.github.com/repos/apache/ratis/issues/1014","id":1899168314,"node_id":"IC_kwDOBMxbGc5xMwI6","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T20:37:04Z","updated_at":"2024-01-18T20:37:04Z","author_association":"CONTRIBUTOR","body":"@szetszwo can you have a look?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899168314/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899178794","html_url":"https://github.com/apache/ratis/pull/1014#issuecomment-1899178794","issue_url":"https://api.github.com/repos/apache/ratis/issues/1014","id":1899178794,"node_id":"IC_kwDOBMxbGc5xMysq","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T20:45:58Z","updated_at":"2024-01-18T20:45:58Z","author_association":"CONTRIBUTOR","body":"@duongkame , The peer ids are corrupted; see https://github.com/apache/ratis/actions/runs/7573336528/job/20625244115?pr=1014#step:6:739","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899178794/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899182134","html_url":"https://github.com/apache/ratis/pull/1014#issuecomment-1899182134","issue_url":"https://api.github.com/repos/apache/ratis/issues/1014","id":1899182134,"node_id":"IC_kwDOBMxbGc5xMzg2","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T20:48:46Z","updated_at":"2024-01-18T20:49:36Z","author_association":"CONTRIBUTOR","body":"\r\n\r\n> @duongkame , The peer ids are corrupted; see https://github.com/apache/ratis/actions/runs/7573336528/job/20625244115?pr=1014#step:6:739\r\n\r\nYeah, pending fix https://github.com/apache/ratis/pull/1021. @szetszwo ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899182134/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899201104","html_url":"https://github.com/apache/ratis/pull/1007#issuecomment-1899201104","issue_url":"https://api.github.com/repos/apache/ratis/issues/1007","id":1899201104,"node_id":"IC_kwDOBMxbGc5xM4JQ","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T21:04:11Z","updated_at":"2024-01-18T21:04:11Z","author_association":"CONTRIBUTOR","body":"```\r\norg.apache.ratis.grpc.TestWatchRequestWithGrpc.testWatchRequestAsyncChangeLeader  Time elapsed: 34.557 s  <<< ERROR!\r\njava.util.concurrent.TimeoutException\r\n\tat java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1784)\r\n\tat java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1928)\r\n\tat org.apache.ratis.WatchRequestTests.checkMajority(WatchRequestTests.java:274)\r\n\tat org.apache.ratis.WatchRequestTests.runTestWatchRequestAsyncChangeLeader(WatchRequestTests.java:360)\r\n\tat org.apache.ratis.WatchRequestTests.runTest(WatchRequestTests.java:153)\r\n\tat org.apache.ratis.WatchRequestTests.lambda$testWatchRequestAsyncChangeLeader$6(WatchRequestTests.java:337)\r\n\tat org.apache.ratis.server.impl.MiniRaftCluster$Factory$Get.runWithNewCluster(MiniRaftCluster.java:140)\r\n\tat org.apache.ratis.server.impl.MiniRaftCluster$Factory$Get.runWithNewCluster(MiniRaftCluster.java:120)\r\n\tat org.apache.ratis.WatchRequestTests.testWatchRequestAsyncChangeLeader(WatchRequestTests.java:336)\r\n\t...\r\n```\r\n`testWatchRequestAsyncChangeLeader` may timeout as above.  In the log, it has the following error.  Will fix it in RATIS-2000.\r\n```\r\n2024-01-18 01:41:51,651 [grpc-default-executor-0] ERROR impl.OrderedAsync (OrderedAsync.java:lambda$sendRequest$9(247)) - client-6F96E8AE8714: Failed* RaftClientRequest:client-6F96E8AE8714->s2@group-4F85081496F8, cid=64, seq=20, RW, m7\r\njava.util.concurrent.CompletionException: java.io.IOException: java.lang.IllegalStateException: Failed to retain: object has already been completely released.\r\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)\r\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)\r\n\tat java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:607)\r\n\tat java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:591)\r\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)\r\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1990)\r\n\tat org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.completeReplyExceptionally(GrpcClientProtocolClient.java:394)\r\n\tat org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.access$000(GrpcClientProtocolClient.java:300)\r\n\tat org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers$1.onError(GrpcClientProtocolClient.java:331)\r\n\tat org.apache.ratis.thirdparty.io.grpc.stub.ClientCalls$StreamObserverToCallListenerAdapter.onClose(ClientCalls.java:481)\r\n\tat org.apache.ratis.thirdparty.io.grpc.PartialForwardingClientCallListener.onClose(PartialForwardingClientCallListener.java:39)\r\n\tat org.apache.ratis.thirdparty.io.grpc.ForwardingClientCallListener.onClose(ForwardingClientCallListener.java:23)\r\n\tat org.apache.ratis.grpc.metrics.intercept.client.MetricClientCallListener.onClose(MetricClientCallListener.java:47)\r\n\tat org.apache.ratis.thirdparty.io.grpc.internal.ClientCallImpl.closeObserver(ClientCallImpl.java:567)\r\n\tat org.apache.ratis.thirdparty.io.grpc.internal.ClientCallImpl.access$300(ClientCallImpl.java:71)\r\n\tat org.apache.ratis.thirdparty.io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInternal(ClientCallImpl.java:735)\r\n\tat org.apache.ratis.thirdparty.io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInContext(ClientCallImpl.java:716)\r\n\tat org.apache.ratis.thirdparty.io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)\r\n\tat org.apache.ratis.thirdparty.io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:750)\r\nCaused by: java.io.IOException: java.lang.IllegalStateException: Failed to retain: object has already been completely released.\r\n\tat org.apache.ratis.grpc.GrpcUtil.unwrapException(GrpcUtil.java:103)\r\n\tat org.apache.ratis.grpc.GrpcUtil.unwrapIOException(GrpcUtil.java:163)\r\n\tat org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers$1.onError(GrpcClientProtocolClient.java:330)\r\n\t... 13 more\r\nCaused by: java.lang.IllegalStateException: Failed to retain: object has already been completely released.\r\n\tat org.apache.ratis.util.ReferenceCountedObject$4.retain(ReferenceCountedObject.java:183)\r\n\tat org.apache.ratis.server.impl.RaftServerProxy.submitClientRequestAsync(RaftServerProxy.java:450)\r\n\tat org.apache.ratis.grpc.server.GrpcClientProtocolService$RequestStreamObserver.processClientRequest(GrpcClientProtocolService.java:248)\r\n\tat org.apache.ratis.grpc.server.GrpcClientProtocolService$OrderedRequestStreamObserver.processClientRequest(GrpcClientProtocolService.java:364)\r\n\tat org.apache.ratis.util.SlidingWindow$Server.processRequestsFromHead(SlidingWindow.java:459)\r\n\tat org.apache.ratis.util.SlidingWindow$Server.receivedRequest(SlidingWindow.java:451)\r\n\tat org.apache.ratis.grpc.server.GrpcClientProtocolService$OrderedRequestStreamObserver.processClientRequest(GrpcClientProtocolService.java:389)\r\n\tat org.apache.ratis.grpc.server.GrpcClientProtocolService$RequestStreamObserver.onNext(GrpcClientProtocolService.java:272)\r\n\tat org.apache.ratis.grpc.server.GrpcClientProtocolService$RequestStreamObserver.onNext(GrpcClientProtocolService.java:191)\r\n\tat org.apache.ratis.thirdparty.io.grpc.stub.ServerCalls$StreamingServerCallHandler$StreamingServerCallListener.onMessage(ServerCalls.java:262)\r\n\tat org.apache.ratis.thirdparty.io.grpc.ForwardingServerCallListener.onMessage(ForwardingServerCallListener.java:33)\r\n\tat org.apache.ratis.thirdparty.io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.messagesAvailableInternal(ServerCallImpl.java:329)\r\n\tat org.apache.ratis.thirdparty.io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.messagesAvailable(ServerCallImpl.java:314)\r\n\tat org.apache.ratis.thirdparty.io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1MessagesAvailable.runInContext(ServerImpl.java:833)\r\n\t... 5 more\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899201104/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899274464","html_url":"https://github.com/apache/ratis/pull/1022#issuecomment-1899274464","issue_url":"https://api.github.com/repos/apache/ratis/issues/1022","id":1899274464,"node_id":"IC_kwDOBMxbGc5xNKDg","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T21:53:05Z","updated_at":"2024-01-18T21:53:38Z","author_association":"CONTRIBUTOR","body":"In https://github.com/apache/ratis/actions/runs/7575888844?pr=1022 , there is a warning:\r\n\r\n- [findbugs](https://github.com/apache/ratis/actions/runs/7575888844/job/20634123845#step:6:11)\r\n```\r\nNo files were found with the provided path: target/findbugs. No artifacts will be uploaded.\r\n```\r\n\r\nIs it expected?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899274464/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899346530","html_url":"https://github.com/apache/ratis/pull/1021#issuecomment-1899346530","issue_url":"https://api.github.com/repos/apache/ratis/issues/1021","id":1899346530,"node_id":"IC_kwDOBMxbGc5xNbpi","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T22:52:49Z","updated_at":"2024-01-18T22:53:02Z","author_association":"CONTRIBUTOR","body":"I also just attempted to solve the following test failure in this PR.  @szetszwo \r\n\r\n```\r\n   org.apache.ratis.grpc.TestWatchRequestWithGrpc.testWatchRequestAsyncChangeLeader  Time elapsed: 34.557 s  <<< ERROR!\r\n   java.util.concurrent.TimeoutException\r\n        at java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1784)\r\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:1928)\r\n        at org.apache.ratis.WatchRequestTests.checkMajority(WatchRequestTests.java:274)\r\n        at org.apache.ratis.WatchRequestTests.runTestWatchRequestAsyncChangeLeader(WatchRequestTests.java:360)\r\n        at org.apache.ratis.WatchRequestTests.runTest(WatchRequestTests.java:153)\r\n        at org.apache.ratis.WatchRequestTests.lambda$testWatchRequestAsyncChangeLeader$6(WatchRequestTests.java:337)\r\n        at org.apache.ratis.server.impl.MiniRaftCluster$Factory$Get.runWithNewCluster(MiniRaftCluster.java:140)\r\n        at org.apache.ratis.server.impl.MiniRaftCluster$Factory$Get.runWithNewCluster(MiniRaftCluster.java:120)\r\n        at org.apache.ratis.WatchRequestTests.testWatchRequestAsyncChangeLeader(WatchRequestTests.java:336)\r\n        ...\r\n   ```\r\n   `testWatchRequestAsyncChangeLeader` may timeout as above.  In the log, it has\r\n   ```\r\n   2024-01-18 01:41:51,651 [grpc-default-executor-0] ERROR impl.OrderedAsync (OrderedAsync.java:lambda$sendRequest$9(247)) - client-6F96E8AE8714: Failed* RaftClientRequest:client-6F96E8AE8714->s2@group-4F85081496F8, cid=64, seq=20, RW, m7\r\n   java.util.concurrent.CompletionException: java.io.IOException: java.lang.IllegalStateException: Failed to retain: object has already been completely released.\r\n        at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:292)\r\n        at java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:308)\r\n        at java.util.concurrent.CompletableFuture.uniApply(CompletableFuture.java:607)\r\n        at java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:591)\r\n        at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)\r\n        at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:1990)\r\n        at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.completeReplyExceptionally(GrpcClientProtocolClient.java:394)\r\n        at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers.access$000(GrpcClientProtocolClient.java:300)\r\n        at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers$1.onError(GrpcClientProtocolClient.java:331)\r\n        at org.apache.ratis.thirdparty.io.grpc.stub.ClientCalls$StreamObserverToCallListenerAdapter.onClose(ClientCalls.java:481)\r\n        at org.apache.ratis.thirdparty.io.grpc.PartialForwardingClientCallListener.onClose(PartialForwardingClientCallListener.java:39)\r\n        at org.apache.ratis.thirdparty.io.grpc.ForwardingClientCallListener.onClose(ForwardingClientCallListener.java:23)\r\n        at org.apache.ratis.grpc.metrics.intercept.client.MetricClientCallListener.onClose(MetricClientCallListener.java:47)\r\n        at org.apache.ratis.thirdparty.io.grpc.internal.ClientCallImpl.closeObserver(ClientCallImpl.java:567)\r\n        at org.apache.ratis.thirdparty.io.grpc.internal.ClientCallImpl.access$300(ClientCallImpl.java:71)\r\n        at org.apache.ratis.thirdparty.io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInternal(ClientCallImpl.java:735)\r\n        at org.apache.ratis.thirdparty.io.grpc.internal.ClientCallImpl$ClientStreamListenerImpl$1StreamClosed.runInContext(ClientCallImpl.java:716)\r\n        at org.apache.ratis.thirdparty.io.grpc.internal.ContextRunnable.run(ContextRunnable.java:37)\r\n        at org.apache.ratis.thirdparty.io.grpc.internal.SerializingExecutor.run(SerializingExecutor.java:133)\r\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n        at java.lang.Thread.run(Thread.java:750)\r\n   Caused by: java.io.IOException: java.lang.IllegalStateException: Failed to retain: object has already been completely released.\r\n        at org.apache.ratis.grpc.GrpcUtil.unwrapException(GrpcUtil.java:103)\r\n        at org.apache.ratis.grpc.GrpcUtil.unwrapIOException(GrpcUtil.java:163)\r\n        at org.apache.ratis.grpc.client.GrpcClientProtocolClient$AsyncStreamObservers$1.onError(GrpcClientProtocolClient.java:330)\r\n        ... 13 more\r\n   Caused by: java.lang.IllegalStateException: Failed to retain: object has already been completely released.\r\n        at org.apache.ratis.util.ReferenceCountedObject$4.retain(ReferenceCountedObject.java:183)\r\n        at org.apache.ratis.server.impl.RaftServerProxy.submitClientRequestAsync(RaftServerProxy.java:450)\r\n        at org.apache.ratis.grpc.server.GrpcClientProtocolService$RequestStreamObserver.processClientRequest(GrpcClientProtocolService.java:248)\r\n        at org.apache.ratis.grpc.server.GrpcClientProtocolService$OrderedRequestStreamObserver.processClientRequest(GrpcClientProtocolService.java:364)\r\n        at org.apache.ratis.util.SlidingWindow$Server.processRequestsFromHead(SlidingWindow.java:459)\r\n        at org.apache.ratis.util.SlidingWindow$Server.receivedRequest(SlidingWindow.java:451)\r\n        at org.apache.ratis.grpc.server.GrpcClientProtocolService$OrderedRequestStreamObserver.processClientRequest(GrpcClientProtocolService.java:389)\r\n        at org.apache.ratis.grpc.server.GrpcClientProtocolService$RequestStreamObserver.onNext(GrpcClientProtocolService.java:272)\r\n        at org.apache.ratis.grpc.server.GrpcClientProtocolService$RequestStreamObserver.onNext(GrpcClientProtocolService.java:191)\r\n        at org.apache.ratis.thirdparty.io.grpc.stub.ServerCalls$StreamingServerCallHandler$StreamingServerCallListener.onMessage(ServerCalls.java:262)\r\n        at org.apache.ratis.thirdparty.io.grpc.ForwardingServerCallListener.onMessage(ForwardingServerCallListener.java:33)\r\n        at org.apache.ratis.thirdparty.io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.messagesAvailableInternal(ServerCallImpl.java:329)\r\n        at org.apache.ratis.thirdparty.io.grpc.internal.ServerCallImpl$ServerStreamListenerImpl.messagesAvailable(ServerCallImpl.java:314)\r\n        at org.apache.ratis.thirdparty.io.grpc.internal.ServerImpl$JumpToApplicationThreadServerStreamListener$1MessagesAvailable.runInContext(ServerImpl.java:833)\r\n        ... 5 more\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899346530/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899872421","html_url":"https://github.com/apache/ratis/pull/1014#issuecomment-1899872421","issue_url":"https://api.github.com/repos/apache/ratis/issues/1014","id":1899872421,"node_id":"IC_kwDOBMxbGc5xPcCl","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-19T07:02:20Z","updated_at":"2024-01-19T07:02:20Z","author_association":"CONTRIBUTOR","body":"RATIS-2009 is done. Merge from master fixed the problem with peer ids corrupted. @szetszwo ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899872421/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899884041","html_url":"https://github.com/apache/ratis/pull/1022#issuecomment-1899884041","issue_url":"https://api.github.com/repos/apache/ratis/issues/1022","id":1899884041,"node_id":"IC_kwDOBMxbGc5xPe4J","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-19T07:12:42Z","updated_at":"2024-01-19T07:12:42Z","author_association":"CONTRIBUTOR","body":"> In https://github.com/apache/ratis/actions/runs/7575888844?pr=1022 , there is a warning:\r\n> \r\n> * [findbugs](https://github.com/apache/ratis/actions/runs/7575888844/job/20634123845#step:6:11)\r\n> \r\n> ```\r\n> No files were found with the provided path: target/findbugs. No artifacts will be uploaded.\r\n> ```\r\n> \r\n> Is it expected?\r\n\r\nYes, the same also happens on `master` ([example](https://github.com/apache/ratis/actions/runs/6922173476/job/18828596492#step:6:10)).  The problem is that the CI environment does not have `spotbugs` installed, so it cannot post-process the results for upload.  The check still catches violations.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899884041/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899900359","html_url":"https://github.com/apache/ratis/pull/1022#issuecomment-1899900359","issue_url":"https://api.github.com/repos/apache/ratis/issues/1022","id":1899900359,"node_id":"IC_kwDOBMxbGc5xPi3H","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-19T07:29:21Z","updated_at":"2024-01-19T07:29:21Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for reviewing and merging this.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1899900359/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1904388220","html_url":"https://github.com/apache/ratis/pull/1025#issuecomment-1904388220","issue_url":"https://api.github.com/repos/apache/ratis/issues/1025","id":1904388220,"node_id":"IC_kwDOBMxbGc5xgqh8","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-22T16:40:16Z","updated_at":"2024-01-22T16:40:16Z","author_association":"CONTRIBUTOR","body":"> ... but there is a [test failure](https://github.com/apache/ratis/actions/runs/7609811295/job/20721813016?pr=1025#step:6:746) in `TestExceptionDependentRetry.testExceptionRetryAttempts`\r\n\r\nThe tests also fail in the master branch in my machine.  Filed RATIS-2013 to fix it separately.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1904388220/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1904507041","html_url":"https://github.com/apache/ratis/pull/1023#issuecomment-1904507041","issue_url":"https://api.github.com/repos/apache/ratis/issues/1023","id":1904507041,"node_id":"IC_kwDOBMxbGc5xhHih","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-22T17:47:46Z","updated_at":"2024-01-22T17:47:46Z","author_association":"CONTRIBUTOR","body":"> @duongkame , the changes (adding linked lists and overriding `finalize()`) in `ReferenceCountedObject` will make it expensive. Should we enable them only in tests?\r\n\r\nSorry @szetszwo, this is quite wip, I'm still making refactoring around. And yes, it's intended for test only. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1904507041/reactions","total_count":1,"+1":0,"-1":0,"laugh":1,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1904882997","html_url":"https://github.com/apache/ratis/pull/1026#issuecomment-1904882997","issue_url":"https://api.github.com/repos/apache/ratis/issues/1026","id":1904882997,"node_id":"IC_kwDOBMxbGc5xijU1","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-22T21:51:04Z","updated_at":"2024-01-22T21:51:04Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for the patch, makes sense to me.  (16 attempts for 5 retries looked like magic.)","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1904882997/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1904888104","html_url":"https://github.com/apache/ratis/pull/1025#issuecomment-1904888104","issue_url":"https://api.github.com/repos/apache/ratis/issues/1025","id":1904888104,"node_id":"IC_kwDOBMxbGc5xikko","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-22T21:54:32Z","updated_at":"2024-01-22T21:54:32Z","author_association":"CONTRIBUTOR","body":"I tried this with RATIS-2013, but `testExceptionRetryAttempts` is still failing with `expected:<6> but was:<4>`.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1904888104/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1904944437","html_url":"https://github.com/apache/ratis/pull/1026#issuecomment-1904944437","issue_url":"https://api.github.com/repos/apache/ratis/issues/1026","id":1904944437,"node_id":"IC_kwDOBMxbGc5xiyU1","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-22T22:32:03Z","updated_at":"2024-01-22T22:32:03Z","author_association":"CONTRIBUTOR","body":"> 16 attempts for 5 retries looked like magic.\r\n\r\nYes, it is magic.  I am not sure why it seems to have a fixed 16 attempts with the bug.\r\n\r\nThanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1904944437/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1905116625","html_url":"https://github.com/apache/ratis/pull/1025#issuecomment-1905116625","issue_url":"https://api.github.com/repos/apache/ratis/issues/1025","id":1905116625,"node_id":"IC_kwDOBMxbGc5xjcXR","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-23T01:14:23Z","updated_at":"2024-01-23T17:31:55Z","author_association":"CONTRIBUTOR","body":">  failing with `expected:<6> but was:<4>`.\r\n\r\n`OrderedAsync` calls `newClientRetryEvent` twice so it increments the exception count twice per retry.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1905116625/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1906623278","html_url":"https://github.com/apache/ratis/pull/1025#issuecomment-1906623278","issue_url":"https://api.github.com/repos/apache/ratis/issues/1025","id":1906623278,"node_id":"IC_kwDOBMxbGc5xpMMu","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-23T18:01:25Z","updated_at":"2024-01-23T18:01:25Z","author_association":"CONTRIBUTOR","body":"@adoroszlai , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1906623278/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1907189559","html_url":"https://github.com/apache/ratis/pull/1024#issuecomment-1907189559","issue_url":"https://api.github.com/repos/apache/ratis/issues/1024","id":1907189559,"node_id":"IC_kwDOBMxbGc5xrWc3","user":{"login":"ivandika3","id":36403683,"node_id":"MDQ6VXNlcjM2NDAzNjgz","avatar_url":"https://avatars.githubusercontent.com/u/36403683?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandika3","html_url":"https://github.com/ivandika3","followers_url":"https://api.github.com/users/ivandika3/followers","following_url":"https://api.github.com/users/ivandika3/following{/other_user}","gists_url":"https://api.github.com/users/ivandika3/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandika3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandika3/subscriptions","organizations_url":"https://api.github.com/users/ivandika3/orgs","repos_url":"https://api.github.com/users/ivandika3/repos","events_url":"https://api.github.com/users/ivandika3/events{/privacy}","received_events_url":"https://api.github.com/users/ivandika3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-24T01:18:29Z","updated_at":"2024-01-24T01:18:29Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thank you for the review. I have updated it accordingly. PTAL.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1907189559/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1907205419","html_url":"https://github.com/apache/ratis/pull/1027#issuecomment-1907205419","issue_url":"https://api.github.com/repos/apache/ratis/issues/1027","id":1907205419,"node_id":"IC_kwDOBMxbGc5xraUr","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-24T01:38:06Z","updated_at":"2024-01-24T01:38:06Z","author_association":"CONTRIBUTOR","body":"@szetszwo Please have a look.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1907205419/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1907205959","html_url":"https://github.com/apache/ratis/pull/1023#issuecomment-1907205959","issue_url":"https://api.github.com/repos/apache/ratis/issues/1023","id":1907205959,"node_id":"IC_kwDOBMxbGc5xradH","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-24T01:38:48Z","updated_at":"2024-01-25T05:57:59Z","author_association":"CONTRIBUTOR","body":"Please have a look? @szetszwo \r\nFailing tests are pending fixed by #1027.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1907205959/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1909205902","html_url":"https://github.com/apache/ratis/pull/1024#issuecomment-1909205902","issue_url":"https://api.github.com/repos/apache/ratis/issues/1024","id":1909205902,"node_id":"IC_kwDOBMxbGc5xzCuO","user":{"login":"ivandika3","id":36403683,"node_id":"MDQ6VXNlcjM2NDAzNjgz","avatar_url":"https://avatars.githubusercontent.com/u/36403683?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandika3","html_url":"https://github.com/ivandika3","followers_url":"https://api.github.com/users/ivandika3/followers","following_url":"https://api.github.com/users/ivandika3/following{/other_user}","gists_url":"https://api.github.com/users/ivandika3/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandika3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandika3/subscriptions","organizations_url":"https://api.github.com/users/ivandika3/orgs","repos_url":"https://api.github.com/users/ivandika3/repos","events_url":"https://api.github.com/users/ivandika3/events{/privacy}","received_events_url":"https://api.github.com/users/ivandika3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-25T01:41:34Z","updated_at":"2024-01-25T01:41:34Z","author_association":"CONTRIBUTOR","body":"Thank you for the review and merge @szetszwo ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1909205902/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1909535701","html_url":"https://github.com/apache/ratis/pull/1028#issuecomment-1909535701","issue_url":"https://api.github.com/repos/apache/ratis/issues/1028","id":1909535701,"node_id":"IC_kwDOBMxbGc5x0TPV","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-25T07:43:05Z","updated_at":"2024-01-25T07:43:05Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for the review.  (Note: there is a [similar PR](https://github.com/apache/ratis-thirdparty/pull/49) in `ratis-thirdparty`.)","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1909535701/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]