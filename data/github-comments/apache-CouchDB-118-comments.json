[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1578492468","html_url":"https://github.com/apache/couchdb/issues/4369#issuecomment-1578492468","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4369","id":1578492468,"node_id":"IC_kwDOAAMmUc5eFeI0","user":{"login":"viveksc1994","id":10026278,"node_id":"MDQ6VXNlcjEwMDI2Mjc4","avatar_url":"https://avatars.githubusercontent.com/u/10026278?v=4","gravatar_id":"","url":"https://api.github.com/users/viveksc1994","html_url":"https://github.com/viveksc1994","followers_url":"https://api.github.com/users/viveksc1994/followers","following_url":"https://api.github.com/users/viveksc1994/following{/other_user}","gists_url":"https://api.github.com/users/viveksc1994/gists{/gist_id}","starred_url":"https://api.github.com/users/viveksc1994/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/viveksc1994/subscriptions","organizations_url":"https://api.github.com/users/viveksc1994/orgs","repos_url":"https://api.github.com/users/viveksc1994/repos","events_url":"https://api.github.com/users/viveksc1994/events{/privacy}","received_events_url":"https://api.github.com/users/viveksc1994/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-06T11:07:56Z","updated_at":"2023-06-06T11:07:56Z","author_association":"NONE","body":"Hurray, Got it working! (CouchDB - v3.3.2 and Clouseau - v2.21.6)\r\n\r\nWhat I have done to fix this\r\n\r\nclouseau folder\r\nremove file:  slf4j-api-1.7.32.jar\r\nadd files: slf4j-api-2.0.7.jar, slf4j-simple-2.0.7.jar (download from https://download.jar-download.com/cache_jars/org.slf4j/slf4j-simple/2.0.7/jar_files.zip)\r\n\r\nchange in file clouseau.ini \r\ncookie=monster\r\n(change `monster` to we can get cookie value from `\\etc\\vm.args` setcookie's value)\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1578492468/reactions","total_count":6,"+1":6,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1586059022","html_url":"https://github.com/apache/couchdb/pull/4636#issuecomment-1586059022","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4636","id":1586059022,"node_id":"IC_kwDOAAMmUc5eiVcO","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-11T07:40:23Z","updated_at":"2023-06-11T07:40:23Z","author_association":"MEMBER","body":"An alternative expression is `r=w=⌊n/2⌋+1` but perhaps is too subtle.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1586059022/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1587671324","html_url":"https://github.com/apache/couchdb/issues/4639#issuecomment-1587671324","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4639","id":1587671324,"node_id":"IC_kwDOAAMmUc5eofEc","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-12T16:30:38Z","updated_at":"2023-06-12T16:30:38Z","author_association":"CONTRIBUTOR","body":"As `{error,req_timedout}` indicates a timeout.  Try to increase the replication connection timeout.\r\n\r\nhttps://docs.couchdb.org/en/stable/config/replicator.html#replicator/connection_timeout\r\n\r\nThe `instance_start_time` change, to return a db creation timestamp instead of `0` is a 3.3 change . We did mention it in the [release notes](https://docs.couchdb.org/en/stable/whatsnew/3.3.html#bugfixes) but did not update the documentation. https://github.com/apache/couchdb/issues/3901\r\n\r\nIn all of the 3.x versions, `_ensure_full_commit` doesn't actually do anything, it's a compatibility no-op. All the documents updates are now committed during doc update operation. The only thing the API endpoint returns is the database instance start time value. So, it is a bit strange that `_ensure_full_commit` is timing out, unless the endpoint is not a 3.x Apache CouchDB version but an older version or another couch implementation.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1587671324/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1587697490","html_url":"https://github.com/apache/couchdb/issues/4639#issuecomment-1587697490","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4639","id":1587697490,"node_id":"IC_kwDOAAMmUc5eoldS","user":{"login":"jdai1","id":44037521,"node_id":"MDQ6VXNlcjQ0MDM3NTIx","avatar_url":"https://avatars.githubusercontent.com/u/44037521?v=4","gravatar_id":"","url":"https://api.github.com/users/jdai1","html_url":"https://github.com/jdai1","followers_url":"https://api.github.com/users/jdai1/followers","following_url":"https://api.github.com/users/jdai1/following{/other_user}","gists_url":"https://api.github.com/users/jdai1/gists{/gist_id}","starred_url":"https://api.github.com/users/jdai1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdai1/subscriptions","organizations_url":"https://api.github.com/users/jdai1/orgs","repos_url":"https://api.github.com/users/jdai1/repos","events_url":"https://api.github.com/users/jdai1/events{/privacy}","received_events_url":"https://api.github.com/users/jdai1/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-12T16:48:51Z","updated_at":"2023-06-12T16:48:51Z","author_association":"NONE","body":"Hi Nick! Thank you so much for your help. I believe the source database of the replication is an older version of CouchDB. I will definitely try increasing the connection timeout. Another quick question, if I change the replication config in the local.ini file, will it apply the config if I send a new replication HTTP request, even if the new replication task is a continuation of the existing replication? ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1587697490/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1587718519","html_url":"https://github.com/apache/couchdb/issues/4639#issuecomment-1587718519","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4639","id":1587718519,"node_id":"IC_kwDOAAMmUc5eoql3","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-12T17:00:48Z","updated_at":"2023-06-12T17:00:48Z","author_association":"CONTRIBUTOR","body":"If you change the config the replication will not pick the new value. You'd have to restart the replication job (delete the document and re-create it). The configuration may also be applied per replication job, or cluster-wide in the *.ini file. \r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1587718519/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1587750283","html_url":"https://github.com/apache/couchdb/issues/4639#issuecomment-1587750283","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4639","id":1587750283,"node_id":"IC_kwDOAAMmUc5eoyWL","user":{"login":"jdai1","id":44037521,"node_id":"MDQ6VXNlcjQ0MDM3NTIx","avatar_url":"https://avatars.githubusercontent.com/u/44037521?v=4","gravatar_id":"","url":"https://api.github.com/users/jdai1","html_url":"https://github.com/jdai1","followers_url":"https://api.github.com/users/jdai1/followers","following_url":"https://api.github.com/users/jdai1/following{/other_user}","gists_url":"https://api.github.com/users/jdai1/gists{/gist_id}","starred_url":"https://api.github.com/users/jdai1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdai1/subscriptions","organizations_url":"https://api.github.com/users/jdai1/orgs","repos_url":"https://api.github.com/users/jdai1/repos","events_url":"https://api.github.com/users/jdai1/events{/privacy}","received_events_url":"https://api.github.com/users/jdai1/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-12T17:21:52Z","updated_at":"2023-06-12T17:21:52Z","author_association":"NONE","body":"Also, on my active_tasks page, it is still saying I have many bulk_get_attempts, even though my bulk_get_attempts is set to false in my configuration file.\r\n\r\n<img width=\"569\" alt=\"Screenshot 2023-06-12 at 1 20 43 PM\" src=\"https://github.com/apache/couchdb/assets/44037521/9b8607d6-744e-4626-9723-13a767f0a1c2\">\r\n<img width=\"853\" alt=\"Screenshot 2023-06-12 at 1 21 33 PM\" src=\"https://github.com/apache/couchdb/assets/44037521/624d1ec6-f5c0-47a7-bb0b-6e47119b4906\">\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1587750283/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1587757088","html_url":"https://github.com/apache/couchdb/issues/4639#issuecomment-1587757088","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4639","id":1587757088,"node_id":"IC_kwDOAAMmUc5eo0Ag","user":{"login":"jdai1","id":44037521,"node_id":"MDQ6VXNlcjQ0MDM3NTIx","avatar_url":"https://avatars.githubusercontent.com/u/44037521?v=4","gravatar_id":"","url":"https://api.github.com/users/jdai1","html_url":"https://github.com/jdai1","followers_url":"https://api.github.com/users/jdai1/followers","following_url":"https://api.github.com/users/jdai1/following{/other_user}","gists_url":"https://api.github.com/users/jdai1/gists{/gist_id}","starred_url":"https://api.github.com/users/jdai1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdai1/subscriptions","organizations_url":"https://api.github.com/users/jdai1/orgs","repos_url":"https://api.github.com/users/jdai1/repos","events_url":"https://api.github.com/users/jdai1/events{/privacy}","received_events_url":"https://api.github.com/users/jdai1/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-12T17:25:45Z","updated_at":"2023-06-12T17:25:45Z","author_association":"NONE","body":"Oh and finally, do you have any suggestions as to how I can replicate from the outdated couchdb instance when faced with the timeout request on the _ensure_full_commit endpoint? Thank you so much!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1587757088/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1587815799","html_url":"https://github.com/apache/couchdb/issues/4639#issuecomment-1587815799","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4639","id":1587815799,"node_id":"IC_kwDOAAMmUc5epCV3","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-12T18:00:41Z","updated_at":"2023-06-12T18:00:41Z","author_association":"CONTRIBUTOR","body":"Not sure about [use_bulk_get](https://docs.couchdb.org/en/stable/config/replicator.html#replicator/use_bulk_get). It should not attempt to use to use the  _bulk_get endpoint if it's set to `false`. Would you be able to create a smaller repoducer script?\r\n\r\nI had tried it locally I saw no bulk_get attempts made with:\r\n\r\n```\r\nhttp put $DB/a\r\nhttp put $DB/a/doc1 a=b\r\nhttp put $DB/a/doc2 a=b\r\nhttp put $DB/a/doc3 a=b\r\nhttp put $DB/_replicator/ab source=$DB/a target=$DB/c continuous:='true' use_bulk_get:='false' create_target:='true'\r\n\r\nhttp $DB/_scheduler/jobs\r\n{\r\n    \"jobs\": [\r\n        {\r\n            \"database\": \"_replicator\",\r\n            \"doc_id\": \"ab\",\r\n            \"history\": [\r\n                {\r\n                    \"timestamp\": \"2023-06-12T17:58:16Z\",\r\n                    \"type\": \"started\"\r\n                },\r\n                {\r\n                    \"timestamp\": \"2023-06-12T17:58:16Z\",\r\n                    \"type\": \"added\"\r\n                }\r\n            ],\r\n            \"id\": \"3738529f4ee2354407f06fc91e383d4a+continuous+create_target\",\r\n            \"info\": {\r\n                \"bulk_get_attempts\": 0,\r\n                \"bulk_get_docs\": 0,\r\n                \"changes_pending\": null,\r\n                \"checkpointed_source_seq\": \"0\",\r\n                \"doc_write_failures\": 0,\r\n                \"docs_read\": 3,\r\n                \"docs_written\": 3,\r\n                \"missing_revisions_found\": 3,\r\n                \"revisions_checked\": 3,\r\n                \"source_seq\": \"3-g1AAAACTeJzLYWBgYMpgTmHgz8tPSTV0MDQy1zMAQsMckEQiQ1L9____szKYE5lygQLsqWYGaZaJRpjKcRqRxwIkGRqA1H-oSYxgk8wMzVJNEs0wdWUBAFZWJEc\",\r\n                \"through_seq\": \"3-g1AAAACTeJzLYWBgYMpgTmHgz8tPSTV0MDQy1zMAQsMckEQiQ1L9____szKYE5lygQLsqWYGaZaJRpjKcRqRxwIkGRqA1H-oSYxgk8wMzVJNEs0wdWUBAFZWJEc\"\r\n            },\r\n            \"node\": \"node1@127.0.0.1\",\r\n            \"pid\": \"<0.2518.0>\",\r\n            \"source\": \"http://127.0.0.1:15984/a/\",\r\n            \"start_time\": \"2023-06-12T17:58:16Z\",\r\n            \"target\": \"http://127.0.0.1:15984/c/\",\r\n            \"user\": null\r\n        }\r\n    ],\r\n    \"offset\": 0,\r\n    \"total_rows\": 1\r\n}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1587815799/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1587824167","html_url":"https://github.com/apache/couchdb/issues/4639#issuecomment-1587824167","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4639","id":1587824167,"node_id":"IC_kwDOAAMmUc5epEYn","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-12T18:05:28Z","updated_at":"2023-06-12T18:05:28Z","author_association":"CONTRIBUTOR","body":"> Oh and finally, do you have any suggestions as to how I can replicate from the outdated couchdb instance when faced with the timeout request on the _ensure_full_commit endpoint? Thank you so much!\r\n\r\nYou can try disable bulk_get usage, increase the timeout, and reduce the number of workers a bit. 200 concurrent workers may be a bit too much for the endpoint to handle? Try reducing their number to say 10 and see what it does. Try reducing your batch size as well a bit.\r\n\r\nReplicating in general implies being able to update the _local checkpoint document on the source endpoint. If the source endpoint doesn't allow that, depending how that's implemented it may manifest as a timeout (if they just close the connection and don't respond). In that case you can try disable checkpointing altogether with: https://docs.couchdb.org/en/stable/config/replicator.html#replicator/use_checkpoints As the option implies this would disable checkpointing so on failure, it will retry to scan all the docs again next time it tries to run.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1587824167/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1589094752","html_url":"https://github.com/apache/couchdb/issues/4640#issuecomment-1589094752","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4640","id":1589094752,"node_id":"IC_kwDOAAMmUc5et6lg","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-13T11:17:23Z","updated_at":"2023-06-13T11:17:23Z","author_association":"MEMBER","body":"decoded the last three;\r\n\r\n```\r\n[{couchdb@localhost,[0,536870911],                                                                                                                                                                                                         {4,<<\"ebc4fe9\">>,couchdb@localhost}},                                                                                                                                                               {couchdb@localhost,[536870912,1073741823],\r\n                     {4,{split,<<\"5cb6670\">>},couchdb@localhost}},\r\n  {couchdb@localhost,[1073741824,1610612735],\r\n                     {0,<<\"09a8278\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[1610612736,2147483647],\r\n                     {3,<<\"a9557bb\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[2147483648,2684354559],\r\n                     {4,<<\"66b10a8\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[2684354560,3221225471],\r\n                     {0,<<\"23a7175\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[3221225472,3758096383],\r\n                     {6,{split,<<\"65e487d\">>},couchdb@localhost}},\r\n  {couchdb@localhost,[3758096384,4294967295],\r\n                     {6,{split,<<\"65e487d\">>},couchdb@localhost}}],\r\n\r\n\r\n{couchdb@localhost,[0,536870911],\r\n                     {4,<<\"ebc4fe9\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[536870912,1073741823],\r\n                     {4,{split,<<\"5cb6670\">>},couchdb@localhost}},\r\n  {couchdb@localhost,[1073741824,1610612735],\r\n                     {0,<<\"09a8278\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[1610612736,2147483647],\r\n                     {3,<<\"a9557bb\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[2147483648,2684354559],\r\n                     {4,<<\"66b10a8\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[2684354560,3221225471],\r\n                     {0,<<\"23a7175\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[3221225472,3758096383],\r\n                     {6,<<\"c1fac62\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[3758096384,4294967295],\r\n                     {6,{split,<<\"65e487d\">>},couchdb@localhost}}],\r\n\r\n\r\n{couchdb@localhost,[0,536870911],\r\n                     {4,<<\"ebc4fe9\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[536870912,1073741823],\r\n                     {4,{split,<<\"5cb6670\">>},couchdb@localhost}},\r\n  {couchdb@localhost,[1073741824,1610612735],\r\n                     {0,<<\"09a8278\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[1610612736,2147483647],\r\n                     {3,<<\"a9557bb\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[2147483648,2684354559],\r\n                     {4,<<\"66b10a8\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[2684354560,3221225471],\r\n                     {0,<<\"23a7175\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[3221225472,3758096383],\r\n                     {6,<<\"c1fac62\">>,couchdb@localhost}},\r\n  {couchdb@localhost,[3758096384,4294967295],\r\n                     {1,<<\"8321e28\">>,couchdb@localhost}}]\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1589094752/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1591787968","html_url":"https://github.com/apache/couchdb/issues/4639#issuecomment-1591787968","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4639","id":1591787968,"node_id":"IC_kwDOAAMmUc5e4MHA","user":{"login":"jdai1","id":44037521,"node_id":"MDQ6VXNlcjQ0MDM3NTIx","avatar_url":"https://avatars.githubusercontent.com/u/44037521?v=4","gravatar_id":"","url":"https://api.github.com/users/jdai1","html_url":"https://github.com/jdai1","followers_url":"https://api.github.com/users/jdai1/followers","following_url":"https://api.github.com/users/jdai1/following{/other_user}","gists_url":"https://api.github.com/users/jdai1/gists{/gist_id}","starred_url":"https://api.github.com/users/jdai1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdai1/subscriptions","organizations_url":"https://api.github.com/users/jdai1/orgs","repos_url":"https://api.github.com/users/jdai1/repos","events_url":"https://api.github.com/users/jdai1/events{/privacy}","received_events_url":"https://api.github.com/users/jdai1/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-14T18:31:22Z","updated_at":"2023-06-14T18:31:22Z","author_association":"NONE","body":"Sorry to keep bothering you, would you happen to know why I also get these errors?\r\n```\r\n{\"error\":\"error\",\"reason\":\"max_backoff\"}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1591787968/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1591810915","html_url":"https://github.com/apache/couchdb/issues/4639#issuecomment-1591810915","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4639","id":1591810915,"node_id":"IC_kwDOAAMmUc5e4Rtj","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-14T18:50:37Z","updated_at":"2023-06-14T18:50:37Z","author_association":"CONTRIBUTOR","body":"@jdai1 no problem at all, thanks for reaching out. \r\n\r\nThe `max_backoff` error indicates that some replicator API request was throttled too much and it exceeded a max retry interval before the job crashes and restarts.\r\n\r\nThose errors are usually emitted if a [429 error code](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status/429) is returned from an HTTP API endpoint. Replication jobs would retry individual requests with an exponential backoff, and in the case of 429 errors it will use the [AIMD](https://en.wikipedia.org/wiki/Additive_increase/multiplicative_decrease) - additive increase, multiplicative decrease algorithm, similar to TCP to try to match the throttling rate. But, there is a limit to those failures as well, and if those requests keep getting throttled, it will crash the whole job, and restart it with a simpler configuration. It will apply these setting to those jobs:\r\n\r\n```\r\n[\r\n        {checkpoint_interval, 5000},\r\n        {worker_processes, 2},\r\n        {worker_batch_size, 100},\r\n        {http_connections, 5}\r\n ]\r\n```\r\n\r\nand re-schedule the job to run again.\r\n\r\nEven if the replication jobs will keep crashing (they are in the `crashing` state), they should still be restarting from time to time, trying as hard as they can to make some progress.\r\n\r\nSo, to summarize, individual replication API requests are retried on failure, and then the whole replication job is continuously restarted as well. See the advanced replication [guide](https://docs.couchdb.org/en/stable/replication/replicator.html#replication-states) for more info about the various job states.\r\n\r\nThe suggestion is to then use some settings closer those lower capacity setting when replicating to/from those endpoints (not sure which on of your endpoint is throttled, source, target or both). \r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1591810915/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1592276755","html_url":"https://github.com/apache/couchdb/issues/4639#issuecomment-1592276755","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4639","id":1592276755,"node_id":"IC_kwDOAAMmUc5e6DcT","user":{"login":"jdai1","id":44037521,"node_id":"MDQ6VXNlcjQ0MDM3NTIx","avatar_url":"https://avatars.githubusercontent.com/u/44037521?v=4","gravatar_id":"","url":"https://api.github.com/users/jdai1","html_url":"https://github.com/jdai1","followers_url":"https://api.github.com/users/jdai1/followers","following_url":"https://api.github.com/users/jdai1/following{/other_user}","gists_url":"https://api.github.com/users/jdai1/gists{/gist_id}","starred_url":"https://api.github.com/users/jdai1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jdai1/subscriptions","organizations_url":"https://api.github.com/users/jdai1/orgs","repos_url":"https://api.github.com/users/jdai1/repos","events_url":"https://api.github.com/users/jdai1/events{/privacy}","received_events_url":"https://api.github.com/users/jdai1/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-15T03:09:34Z","updated_at":"2023-06-15T03:09:34Z","author_association":"NONE","body":"Thanks so much Nick! That is a big help, once again. It turns out the problem was the use_checkpoints. I am trying to clone the npm registry from https://replicate.npmjs.com/, which is a massive database, so I'm running into quite a few bugs. \r\n<img width=\"667\" alt=\"Screenshot 2023-06-14 at 11 02 38 PM\" src=\"https://github.com/apache/couchdb/assets/44037521/0970baf4-f966-4a52-9897-7ad9a4012003\">\r\nThis is my current config for replication, which does not give me any checkpoint failures (I guess the couchdb for the npm registry was blocking any checkpoints). However, now, the replications crash with a new error!\r\n```\r\n{\"error\":\"error\",\"reason\":\"{worker_died,<0.5879.61>,{process_died,<0.7372.75>,kaboom}}\"}\r\n```\r\nSince I disabled checkpointing, each time the replication task fails, it restarts, so as a result, the progress is super slow. I did see this thread[https://github.com/apache/couchdb/issues/745], and I was wondering if you guys have found a workaround for this bug.\r\nMy database currently looks like this:\r\n```\r\n\"doc_del_count\":165197,\"doc_count\":1565\r\n```\r\nand the actual database looks like this:\r\n```\r\n\"doc_count\":3279735,\"doc_del_count\":671697\r\n```\r\nSo there is still a ways to go! What do you think would be best?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1592276755/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1593175564","html_url":"https://github.com/apache/couchdb/issues/4642#issuecomment-1593175564","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4642","id":1593175564,"node_id":"IC_kwDOAAMmUc5e9e4M","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-15T14:27:35Z","updated_at":"2023-06-15T19:13:57Z","author_association":"CONTRIBUTOR","body":"> since the PUT method will try to create the _users database. The correct HTTP method is POST.\r\n\r\nPUT should not create a new database but a new user document\r\n\r\nThe URL is `http://localhost:5984/_users/org.couchdb.user:jan` `_users` is the database and `org.couchdb.user:jan` is the document ID. PUT is also the correct method in this case as we're creating or replacing a resource and we're identifying it by its resource URL path.\r\n\r\nMaybe we should assert or include that we are assuming in the documentation that `_users` db has already been created  and the `jan` user has not been added to it yet.\r\n\r\nGood point however that this needs an admin user and admin password. That is mentioned above in [Authentication Database](https://docs.couchdb.org/en/stable/intro/security.html#authentication-database) but that may be easy to miss so showing it in the example would make it easier to see.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1593175564/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1593209456","html_url":"https://github.com/apache/couchdb/issues/4633#issuecomment-1593209456","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4633","id":1593209456,"node_id":"IC_kwDOAAMmUc5e9nJw","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-15T14:46:28Z","updated_at":"2023-06-15T14:46:28Z","author_association":"CONTRIBUTOR","body":"@sergey-safarov that would work in some cases but CPU load might be tricky to figure out in various environments (windows, linux, k8s, vms). \r\n\r\nOften a proxy for system is overload is when internal process message queues start filling up and stay relatively high. That can be detected by `http $DB/_node/$nodename/_system` endpoint. It shows some of the `message_queues` and their length.\r\n\r\n```\r\nhttp $DB/_node/_local/_system | jq '.message_queues'\r\n{\r\n  \"couch_file\": {},\r\n  \"couch_db_updater\": {},\r\n  \"couch_server\": 0,\r\n  \"index_server\": 0,\r\n   ...\r\n}\r\n```\r\n\r\nSpecifically `couch_db_updater` is one to look for during document writes as it could back up. But that could also indicate a slow disk IO issue not necessary a CPU overload issue.\r\n\r\nErlang VM also does some busy waiting, that is keeps schedulers working for a bit longer than necessary to trade-off CPU usage for latency. That can make it seem like it's running out of CPUs capacity as the OS visible CPU usage would be higher, but it may still be doing fine in that state. You can disable busy waiting with: `+sbwt none`   `+sbwtdcpu none`  `+sbwtdio none` `vm.args` settings.\r\n\r\nHowever, in general, it could be dangerous to automatically put nodes in maintenance mode. There are good chances whatever is causing it on one node, will start happening on another node as well. Especially if it now has to also process API requests from the nodes which are already put in maintenance mode. So it all could lead to a cascading failure until none of the nodes can access traffic.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1593209456/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1593384045","html_url":"https://github.com/apache/couchdb/issues/4639#issuecomment-1593384045","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4639","id":1593384045,"node_id":"IC_kwDOAAMmUc5e-Rxt","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-15T16:31:45Z","updated_at":"2023-06-15T22:34:27Z","author_association":"CONTRIBUTOR","body":"That error means a worker had exhausted their number of retries and crashed.\r\n\r\nIt looks like one of the endpoints, the source most likely (sorry I am not familiar with npms very much), probably doesn't want to rate limit its API. Instead of using rather aggressive settings like 20 workers, and 40 concurrent http connection, try to use a bit simpler settings - 1 worker, 100 batch size, 5 http connections or something like that.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1593384045/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1593507302","html_url":"https://github.com/apache/couchdb/issues/4640#issuecomment-1593507302","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4640","id":1593507302,"node_id":"IC_kwDOAAMmUc5e-v3m","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-15T17:59:29Z","updated_at":"2023-06-15T22:46:14Z","author_association":"CONTRIBUTOR","body":"Thanks for creating the issue @jcoglan !\r\n\r\n> to the captured seq value returns results out of order\r\n\r\nHow did we determine they are out of order? Is that based on the `N-...` first part of the sequence number?\r\n\r\n> The descending value of the numeric part of the seq value looked curious to me so I ran these values through a parser tool and obtained:\r\n```\r\noriginal: '30-g1AAAAKVeJzLYWBg4MhgTmEQTM4vTc5ISXLIyU9OzMnILy7JAUoxJTIkyf___z8rgzmRJRcowJ6alGySlmqJTQMeY5IUgGSSPcykDKYUBtbigpzMErCZpslJZmbmBqSa6QAyMx5qJgPYJAPLRAsjcwtSTUoAmVRPVdflsQBJhgYgBTR2PshcNjRzzUxTTSzMU8gydwHE3P0InxsZJ5obmpuSZdoBiGn3qe3KBxBz_5NobhYAREXOrQ',\r\n  parsed: [\r\n    [ 'couchdb@localhost-00000000-1fffffff', 4 ],\r\n    [ 'couchdb@localhost-20000000-3fffffff', 4 ],\r\n    [ 'couchdb@localhost-40000000-5fffffff', 0 ],\r\n    [ 'couchdb@localhost-60000000-7fffffff', 4 ],\r\n    [ 'couchdb@localhost-80000000-9fffffff', 6 ],\r\n    [ 'couchdb@localhost-a0000000-bfffffff', 0 ],\r\n    [ 'couchdb@localhost-c0000000-dfffffff', 6 ],\r\n    [ 'couchdb@localhost-e0000000-ffffffff', 6 ]\r\n  ]\r\n```\r\n```\r\n  original: '23-g1AAAAKBeJzLYWBg4MhgTmEQTM4vTc5ISXLIyU9OzMnILy7JAUoxJTIkyf___z8rgzmRJRcowJ6alGySlmqJTQMeY5IUgGSSPdQkBohJQGMMTA1INckBZFI8ikkGlokWRuYWpJqUADKpHmoSI9ikREtTU_OkJBJNymMBkgwNQApo2HyQaWwZTCkMrMUFOZklYHPNTFNNLMxTyDJ3AcTc_Qj_Ghknmhuam5Jl2gGIafep7coHEHP_k2huFgBjZMkL',\r\n  parsed: [\r\n    [ 'couchdb@localhost-00000000-1fffffff', 4 ],\r\n    [ 'couchdb@localhost-20000000-3fffffff', 0 ],\r\n    [ 'couchdb@localhost-40000000-5fffffff', 0 ],\r\n    [ 'couchdb@localhost-60000000-7fffffff', 1 ],\r\n    [ 'couchdb@localhost-80000000-9fffffff', 6 ],\r\n    [ 'couchdb@localhost-a0000000-bfffffff', 0 ],\r\n    [ 'couchdb@localhost-c0000000-dfffffff', 6 ],\r\n    [ 'couchdb@localhost-e0000000-ffffffff', 6 ]\r\n  ]\r\n```\r\n\r\nI think the parser tool is ignoring an important `split` marker and just shows the sequence number. Let's see what it's hiding:\r\n\r\n```\r\nfabric_view_changes:decode_seq(<<\"30-g1AAAAKVeJzLYWBg4MhgTmEQTM4vTc5ISXLIyU9OzMnILy7JAUoxJTIkyf___z8rgzmRJRcowJ6alGySlmqJTQMeY5IUgGSSPcykDKYUBtbigpzMErCZpslJZmbmBqSa6QAyMx5qJgPYJAPLRAsjcwtSTUoAmVRPVdflsQBJhgYgBTR2PshcNjRzzUxTTSzMU8gydwHE3P0InxsZJ5obmpuSZdoBiGn3qe3KBxBz_5NobhYAREXOrQ\">>).\r\n[{couchdb@localhost,[0,536870911],\r\n                    {4,<<\"ebc4fe9\">>,couchdb@localhost}},\r\n {couchdb@localhost,[536870912,1073741823],\r\n                    {4,{split,<<\"5cb6670\">>},couchdb@localhost}},\r\n {couchdb@localhost,[1073741824,1610612735],\r\n                    {0,<<\"09a8278\">>,couchdb@localhost}},\r\n {couchdb@localhost,[1610612736,2147483647],\r\n                    {4,{split,<<\"5cb6670\">>},couchdb@localhost}},\r\n {couchdb@localhost,[2147483648,2684354559],\r\n                    {6,{split,<<\"65e487d\">>},couchdb@localhost}},\r\n {couchdb@localhost,[2684354560,3221225471],\r\n                    {0,<<\"23a7175\">>,couchdb@localhost}},\r\n {couchdb@localhost,[3221225472,3758096383],\r\n                    {6,{split,<<\"65e487d\">>},couchdb@localhost}},\r\n {couchdb@localhost,[3758096384,4294967295],\r\n                    {6,{split,<<\"65e487d\">>},couchdb@localhost}}]\r\n```\r\n\r\nWe notice how `{4,{split,<<\"5cb6670\">>},couchdb@localhost}}` looks a bit different than `{0,<<\"09a8278\">>,couchdb@localhost}}`. Specifically the `{split,<<\"5cb6670\">>}` part. That part shows a split \"marker\", that it looks that particular range was likely the result of a split from the original sequence with (Q=2) with original since seq node uuid for the now missing (split) range. The `4` part shows the original sequence from the Q=2 sequence.\r\n\r\nIn general looking at the `N-....` is not too helpful. To make the sequences look \"nicer\" we could avoid adding the sequence to the total sum when computing `N` if the sequence is a split marker. That would make the `N-` value increment \"nicer\". But that value is effectively meaningless and it is thrown away when we parse the sequence.\r\n\r\nIt would still be a nice minor ergonomic fix but so far nothing here violates correctness, we're not throwing changes away or returning them out of order.\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1593507302/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1593516205","html_url":"https://github.com/apache/couchdb/issues/4640#issuecomment-1593516205","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4640","id":1593516205,"node_id":"IC_kwDOAAMmUc5e-yCt","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-15T18:06:41Z","updated_at":"2023-06-15T18:06:41Z","author_association":"CONTRIBUTOR","body":"> The first two _changes requests return an empty results array as expected, showing that a seq value continues to work after one round of splitting. \r\n\r\nAh, that's good to know that it works after one round of splitting. \r\n\r\n> The final one, where a seq captured while q=2 is used when q=8 returns the entire history, with events out of order.\r\n\r\nSo rewinding after two rounds of splitting is a more interesting issue. We may want make two separate issues: 1) make the `N-...` look a prettier after a split 2) \"try to avoid rewinds after two rounds of splitting\". The second one seems more pressing and harder solve.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1593516205/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1593888274","html_url":"https://github.com/apache/couchdb/pull/4643#issuecomment-1593888274","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4643","id":1593888274,"node_id":"IC_kwDOAAMmUc5fAM4S","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-16T00:41:14Z","updated_at":"2023-06-16T00:41:14Z","author_association":"CONTRIBUTOR","body":"Using the script from https://github.com/apache/couchdb/issues/4640 to test it as well:\r\n\r\n```shell\r\n#!/bin/bash\r\n\r\nCDB_AUTH='adm:pass'\r\nCDB_HOST='127.0.0.1'\r\nCDB_PORT=15984\r\n\r\ncdb () {\r\n  curl -gs -H 'Content-Type: application/json' \"$(cdb-host)$1\" \"${@:2}\"\r\n}\r\n\r\ncdb-host () {\r\n  echo \"http://${CDB_AUTH}@${CDB_HOST}:${CDB_PORT}\"\r\n}\r\n\r\nstop-jobs () {\r\n  cdb '/_reshard/jobs' | jq -r '.jobs[] | .id' | while read -r id ; do\r\n    cdb \"/_reshard/jobs/$id\" -X DELETE\r\n  done\r\n}\r\n\r\nsplit-shards () {\r\n  local db=\"$1\"\r\n\r\n  cdb \"/$db/_shards\" | jq -r '.shards | keys[]' | while read -r range ; do\r\n    cdb '/_reshard/jobs' -X POST \\\r\n        -d '{ \"type\": \"split\", \"db\": \"'$db'\", \"range\": \"'$range'\" }'\r\n  done\r\n}\r\n\r\nwait-for-q () {\r\n  local db=\"$1\"\r\n  local q=\"$2\"\r\n\r\n  while [[ $(cdb \"/$db\" | jq -r '.cluster.q') != $q ]] ; do\r\n    sleep 1\r\n  done\r\n}\r\n\r\ndb='test-db'\r\n\r\ncdb \"/$db\" -X DELETE\r\ncdb \"/$db?q=2\" -X PUT\r\n\r\nfor n in {1..10} ; do\r\n  cdb \"/$db/doc-$n\" -X PUT -d '{ \"n\": '$n' }'\r\ndone\r\n\r\nlast_seq_q2=\"$(cdb \"/$db/_changes\" | jq -r '.last_seq')\"\r\n\r\nstop-jobs\r\nsplit-shards \"$db\"\r\nwait-for-q \"$db\" 4\r\n\r\nlast_seq_q4=\"$(cdb \"/$db/_changes\" | jq -r '.last_seq')\"\r\n\r\ncdb \"/$db/_changes?since=$last_seq_q2\" | jq\r\n\r\nstop-jobs\r\nsplit-shards \"$db\"\r\nwait-for-q \"$db\" 8\r\n\r\nlast_seq_q8=\"$(cdb \"/$db/_changes\" | jq -r '.last_seq')\"\r\n\r\ncdb \"/$db/_changes?since=$last_seq_q4\" | jq\r\ncdb \"/$db/_changes?since=$last_seq_q2\" | jq\r\n```\r\n\r\n```\r\n./repro.sh\r\n{\"error\":\"not_found\",\"reason\":\"Database does not exist.\"}\r\n{\"ok\":true}\r\n{\"ok\":true,\"id\":\"doc-1\",\"rev\":\"1-731bef401491606a3b246ed178e697c1\"}\r\n{\"ok\":true,\"id\":\"doc-2\",\"rev\":\"1-43a36d04d31d38efc5b9245c53e00627\"}\r\n{\"ok\":true,\"id\":\"doc-3\",\"rev\":\"1-2acff5ec499bf1cf4a478896765b824e\"}\r\n{\"ok\":true,\"id\":\"doc-4\",\"rev\":\"1-2371fbbf6336dcb0ff571e1f4f449ad0\"}\r\n{\"ok\":true,\"id\":\"doc-5\",\"rev\":\"1-16599e9b349642aef785eac10b9f94a3\"}\r\n{\"ok\":true,\"id\":\"doc-6\",\"rev\":\"1-cd1f7574f3318036b66bb76bd4f7ed91\"}\r\n{\"ok\":true,\"id\":\"doc-7\",\"rev\":\"1-f996a2834eb8c362514d171f99324abd\"}\r\n{\"ok\":true,\"id\":\"doc-8\",\"rev\":\"1-817027c9296c2d2d688c568237e89624\"}\r\n{\"ok\":true,\"id\":\"doc-9\",\"rev\":\"1-46d26f2360296f940c344ef881b52066\"}\r\n{\"ok\":true,\"id\":\"doc-10\",\"rev\":\"1-6829757f6498d33021e0a764f0a492af\"}\r\n[{\"ok\":true,\"id\":\"001-486d0ee2a74434c94bec8f9a7034842bd5882af99ea9edee32c9f8222ff916e8\",\"node\":\"node1@127.0.0.1\",\"shard\":\"shards/00000000-7fffffff/test-db.1686875897\"}]\r\n[{\"ok\":true,\"id\":\"001-bafee5292431febf513fedab86c793bf770513576f812b3f032d55aca0f1a83d\",\"node\":\"node1@127.0.0.1\",\"shard\":\"shards/80000000-ffffffff/test-db.1686875897\"}]\r\n{\r\n  \"results\": [],\r\n  \"last_seq\": \"20-g1AAAAEjeJzLYWBgYMlgTmHgz8tPSTV0MDQy1zMAQsMcoARTIkOS_f___7MymBNZcoEC7IbG5gZmhmaYynEakeQAJJPqUUxJSzY0tUgxJsGUPBYgydAApIAG7QeZxAY2ydjCOMUkKY1kkw5ATPqPMMk8JdnEMjEVU1cWACVXR8c\",\r\n  \"pending\": 0\r\n}\r\n{\"ok\":true}\r\n{\"ok\":true}\r\n[{\"ok\":true,\"id\":\"001-c48499ca13a5a9602e6bf1a23c9f38744f71fa0bf9c4d949de3414f90e69b82f\",\"node\":\"node1@127.0.0.1\",\"shard\":\"shards/00000000-3fffffff/test-db.1686875897\"}]\r\n[{\"ok\":true,\"id\":\"001-a6b3d236b0e1e865dcd90fed71de21871828ebfa080ca9e80b3891f96a302515\",\"node\":\"node1@127.0.0.1\",\"shard\":\"shards/40000000-7fffffff/test-db.1686875897\"}]\r\n[{\"ok\":true,\"id\":\"001-d0c624fb555c48d3aa45b99750d5093703b9ea31ac3d69701995ccf9b70c9945\",\"node\":\"node1@127.0.0.1\",\"shard\":\"shards/80000000-bfffffff/test-db.1686875897\"}]\r\n[{\"ok\":true,\"id\":\"001-6e67e89cb8171afd46d59b9208ee69d2c8f80085ae320d1ced00e30139bec65e\",\"node\":\"node1@127.0.0.1\",\"shard\":\"shards/c0000000-ffffffff/test-db.1686875897\"}]\r\n{  \"results\": [],\r\n  \"last_seq\": \"34-g1AAAAJDeJyV0FEKwjAMANDihvrnEfQE0s5lXb_cTbRZK2PMeQS9id5Eb6I3qZkV5hh-lEACafNo2jDG5lVk2KI9GSsKkcg1pxANHUw0w6Vzrq4iHR-pMUuMzfgBxtf_EriijNuBYkACbLIQpeiU3VeJPkoq-SYXZYiy75TzQJHaKmVD3tLGlNmFCkHXfivgkKMMl25euveS1oh5kgZLDy89O2nq_yhVtgQVLL285H4kQK6sGE_Vb5jejjE\",\r\n  \"pending\": 0\r\n}\r\n{  \"results\": [\r\n    {\r\n      \"seq\": \"2-g1AAAAKJeJzLYWBg4MhgTmHgz8tPSTV0MDQy1zMAQsMcoARTIkOS_P___7MymBOZcoEC7EYpqWYGaaaYynEakaQAJJPsoaawZDClMLAWF-RkloDNM0k0NjK0TCXFPAeQefHUMy8BZF491czLYwGSDA1ACmjkfJCZbGhmJpqbJVumWZJs5gKImfupaeYBiJn3qWnmA4iZ_0kyMwsA0VGkAA\",\r\n      \"id\": \"doc-3\",\r\n      \"changes\": [\r\n        {\r\n          \"rev\": \"1-2acff5ec499bf1cf4a478896765b824e\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"seq\": \"3-g1AAAAJ_eJzLYWBg4MhgTmHgz8tPSTV0MDQy1zMAQsMcoARTIkOS_P___7MymBOZcoEC7EYpqWYGaaaYynEakaQAJJPsoaawZDClMLAWF-RkloDNM0k0NjK0TCXFPAeQefHUMy8BZF491czLYwGSDA1ACmjkfJCZbGhmJpqbJVumWZJs5gKImfupaeYBiJn3qWnmA4iZ4PBkhISiaZKBZaohpq4sAF0RoL0\",\r\n      \"id\": \"doc-1\",\r\n      \"changes\": [\r\n        {\r\n          \"rev\": \"1-731bef401491606a3b246ed178e697c1\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"seq\": \"5-g1AAAAJreJzLYWBg4MhgTmHgz8tPSTV0MDQy1zMAQsMcoARTIkOS_P___7MymBNZcoEC7EYpqWYGaaaYynEakaQAJJPsoaYwgE1JMTU3NTU2I8UUB5Ap8SimmJgbGFsYJpNiSgLIlHqYjzKYUhhYiwtyMksg5iUaGxlappJgXh4LkGRoAFJAI-eDzGRDMzPR3CzZMs2SZDMXQMzcT00zD0DMvE9NMx9AzASHJyMkFE2TDCxTDTF1ZQEAnFiaZA\",\r\n      \"id\": \"doc-7\",\r\n      \"changes\": [\r\n        {\r\n          \"rev\": \"1-f996a2834eb8c362514d171f99324abd\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"seq\": \"7-g1AAAAJreJzLYWBg4MhgTmHgz8tPSTV0MDQy1zMAQsMcoARTIkOS_P___7MymBNZcoEC7EYpqWYGaaaYynEakaQAJJPsoaYwgE1JMTU3NTU2I8UUB5Ap8SimmJgbGFsYJpNiSgLIlHqYjzKYUhhYiwtyMksg5iUaGxlappJgXh4LkGRoAFJAI-eDzGRDMzPR3CzZMs2SZDMXQMzcT00zD0DMvE9NMx9AzASHJzMkFE2TDCxTDTF1ZQEAnJiaZg\",\r\n      \"id\": \"doc-5\",\r\n      \"changes\": [\r\n        {\r\n          \"rev\": \"1-16599e9b349642aef785eac10b9f94a3\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"seq\": \"8-g1AAAAJheJzLYWBg4MhgTmHgz8tPSTV0MDQy1zMAQsMcoARTIkOS_P___7MymBNZcoEC7EYpqWYGaaaYynEakaQAJJPsoaYwgE1JMTU3NTU2I8UUB5Ap8SimmJgbGFsYJpNiSgLIlHqoKYxgU8wTUy0tU0lxSx4LkGRoAFJAg-aDTGLLYEphYC0uyMksAZuZaG6WbJlmSbKZCyBm7qemmQcgZt6nppkPIGaCQ5EZEhemSQaWqYaYurIASVGXpQ\",\r\n      \"id\": \"doc-2\",\r\n      \"changes\": [\r\n        {\r\n          \"rev\": \"1-43a36d04d31d38efc5b9245c53e00627\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"seq\": \"10-g1AAAAJheJzLYWBg4MhgTmHgz8tPSTV0MDQy1zMAQsMcoARTIkOS_P___7MymBNZcoEC7EYpqWYGaaaYynEakaQAJJPsoaYwgE1JMTU3NTU2I8UUB5Ap8SimmJgbGFsYJpNiSgLIlHqoKYxgU8wTUy0tU0lxSx4LkGRoAFJAg-aDTGLLYEphYC0uyMksAZuZaG6WbJlmSbKZCyBm7qemmQcgZt6nppkPIGaCQ5EVEhemSQaWqYaYurIASZGXpw\",\r\n      \"id\": \"doc-9\",\r\n      \"changes\": [\r\n        {\r\n          \"rev\": \"1-46d26f2360296f940c344ef881b52066\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"seq\": \"12-g1AAAAJheJzLYWBg4MhgTmHgz8tPSTV0MDQy1zMAQsMcoARTIkOS_P___7MymBNZcoEC7EYpqWYGaaaYynEakaQAJJPsoaYwgE1JMTU3NTU2I8UUB5Ap8SimmJgbGFsYJpNiSgLIlHqoKcxgU8wTUy0tU0lxSx4LkGRoAFJAg-aDTGLLYEphYC0uyMksAZuZaG6WbJlmSbKZCyBm7qemmQcgZt6nppkPIGaCQ5EVEhemSQaWqYaYurIATF2XqQ\",\r\n      \"id\": \"doc-6\",\r\n      \"changes\": [\r\n        {\r\n          \"rev\": \"1-cd1f7574f3318036b66bb76bd4f7ed91\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"seq\": \"18-g1AAAAJNeJyV0EsOwiAQBuBJH-rOI-gJDLSllJW9iUKhqU2tJrrXm-hN9CZ6k0qhiTGNC0IyJAN8-ZkGAGaVL2HeHqTCOY7oCumFG33gcRCLruvqyufBXjemkVQpKsn4-l9CLHUV60EBo0hCCYlTFyXvlc2PklAUZ7hwUba9chkU3yiUK8aUS5Y20BWuetPQrZcmlSchPB2b3dmYnKYFK5mzebfm4_tHzoXIosRZelrpZdLZaSVMFcQ909tKZmKhlYhATOHxq_oDFP6Rjg\",\r\n      \"id\": \"doc-10\",\r\n      \"changes\": [\r\n        {\r\n          \"rev\": \"1-6829757f6498d33021e0a764f0a492af\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"seq\": \"20-g1AAAAJDeJyV0N0NgjAQAOAL4M-bI-gEpgWO0ifZRFtaQwjiCLqJbqKb6CbYHxJjiA_NJXfJtf3Suw4Alk2sYNWflaYVTdmWmKCdOYgEyPUwDG0Ti-RkGotU6YIccXr9LyE3JsvdqIBTFDLErAhRKqvsf5SckaykdYhysMplVGKnMKE51yF_6ROT4WqKgW5WipyEBEvJwqW7lx7fyYSQskzzYOnppZeV5n5HOdc18mDp7SW3p5mXUBKu6fRV-wGH-I4j\",\r\n      \"id\": \"doc-4\",\r\n      \"changes\": [\r\n        {\r\n          \"rev\": \"1-2371fbbf6336dcb0ff571e1f4f449ad0\"\r\n        }\r\n      ]\r\n    },\r\n    {\r\n      \"seq\": \"22-g1AAAAJDeJyV0N0NgjAQB_CL4MebI-gEpgWO0ifZRHu0hhDEEXQT3UQ30U2wUBJiiA9Nk2vSa3-5_msAWJWBhnVz0YbnPBI7ZhevbWOmgDZt21ZloMKzPVhG2qTshNPrfwna2kr7QYFe0SgQ49RHyTvl8KMkgsUZL3yUY6dcByXoFaGMlMZnlia0FW52s9B9zAYZZiT8pYeTnuPPlCLKosRbejnp3UkLl1EiTYHSW_o4qc9p7iQkJg2fvqq-ifSOJQ\",\r\n      \"id\": \"doc-8\",\r\n      \"changes\": [\r\n        {\r\n          \"rev\": \"1-817027c9296c2d2d688c568237e89624\"\r\n        }\r\n      ]\r\n    }\r\n  ],\r\n  \"last_seq\": \"22-g1AAAAJDeJyV0N0NgjAQB_CL4MebI-gEpgWO0ifZRHu0hhDEEXQT3UQ30U2wUBJiiA9Nk2vSa3-5_msAWJWBhnVz0YbnPBI7ZhevbWOmgDZt21ZloMKzPVhG2qTshNPrfwna2kr7QYFe0SgQ49RHyTvl8KMkgsUZL3yUY6dcByXoFaGMlMZnlia0FW52s9B9zAYZZiT8pYeTnuPPlCLKosRbejnp3UkLl1EiTYHSW_o4qc9p7iQkJg2fvqq-ifSOJQ\",\r\n  \"pending\": 0\r\n}\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1593888274/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1593888779","html_url":"https://github.com/apache/couchdb/issues/4640#issuecomment-1593888779","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4640","id":1593888779,"node_id":"IC_kwDOAAMmUc5fANAL","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-16T00:42:17Z","updated_at":"2023-06-16T00:42:17Z","author_association":"CONTRIBUTOR","body":"This should fix the apparent incorrect order https://github.com/apache/couchdb/pull/4643 ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1593888779/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1594152433","html_url":"https://github.com/apache/couchdb/issues/4633#issuecomment-1594152433","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4633","id":1594152433,"node_id":"IC_kwDOAAMmUc5fBNXx","user":{"login":"sergey-safarov","id":2562241,"node_id":"MDQ6VXNlcjI1NjIyNDE=","avatar_url":"https://avatars.githubusercontent.com/u/2562241?v=4","gravatar_id":"","url":"https://api.github.com/users/sergey-safarov","html_url":"https://github.com/sergey-safarov","followers_url":"https://api.github.com/users/sergey-safarov/followers","following_url":"https://api.github.com/users/sergey-safarov/following{/other_user}","gists_url":"https://api.github.com/users/sergey-safarov/gists{/gist_id}","starred_url":"https://api.github.com/users/sergey-safarov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sergey-safarov/subscriptions","organizations_url":"https://api.github.com/users/sergey-safarov/orgs","repos_url":"https://api.github.com/users/sergey-safarov/repos","events_url":"https://api.github.com/users/sergey-safarov/events{/privacy}","received_events_url":"https://api.github.com/users/sergey-safarov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-16T06:02:50Z","updated_at":"2023-06-16T06:02:50Z","author_association":"NONE","body":"Thanks, @nickva for clarification.\r\nI will collect monitoring system data (CPU and IO load) when the issue happens and will provide `/_node/_local/_system` information.\r\nOur installation use CouchDB 2.3.1 version. If it can help understand the issue I can provide an error log also.\r\nThis happens not often and maybe required a timer to reproduce it again.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1594152433/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1597137785","html_url":"https://github.com/apache/couchdb/pull/4645#issuecomment-1597137785","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4645","id":1597137785,"node_id":"IC_kwDOAAMmUc5fMmN5","user":{"login":"jiahuili430","id":54631519,"node_id":"MDQ6VXNlcjU0NjMxNTE5","avatar_url":"https://avatars.githubusercontent.com/u/54631519?v=4","gravatar_id":"","url":"https://api.github.com/users/jiahuili430","html_url":"https://github.com/jiahuili430","followers_url":"https://api.github.com/users/jiahuili430/followers","following_url":"https://api.github.com/users/jiahuili430/following{/other_user}","gists_url":"https://api.github.com/users/jiahuili430/gists{/gist_id}","starred_url":"https://api.github.com/users/jiahuili430/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiahuili430/subscriptions","organizations_url":"https://api.github.com/users/jiahuili430/orgs","repos_url":"https://api.github.com/users/jiahuili430/repos","events_url":"https://api.github.com/users/jiahuili430/events{/privacy}","received_events_url":"https://api.github.com/users/jiahuili430/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-19T12:53:51Z","updated_at":"2023-06-19T12:53:51Z","author_association":"CONTRIBUTOR","body":"Thanks for helping me merge the PR, @nickva ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1597137785/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1597753853","html_url":"https://github.com/apache/couchdb/issues/2448#issuecomment-1597753853","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2448","id":1597753853,"node_id":"IC_kwDOAAMmUc5fO8n9","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-19T21:01:18Z","updated_at":"2023-06-19T21:01:18Z","author_association":"NONE","body":"uploading multiple attachments to couch is rather difficult. \"multipart/related\" is arcane.\r\n\r\nI'm aborting this after spending several hours on it and will just ping-pong a new HTTP PUT for each file. \r\n\r\n```\r\n2023-06-19 15:53:26 [error] 2023-06-19T20:53:26.670055Z nonode@nohost emulator -------- Error in process <0.4577.3> with exit value:\r\n2023-06-19 15:53:26 {{nocatch,<<\"expected more data\">>},[{chttpd_db,receive_request_data,2,[{file,\"src/chttpd_db.erl\"},{line,1415}]},{couch_httpd,read_until,3,[{file,\"src/couch_httpd.erl\"},{line,1263}]},{couch_httpd,parse_multipart_request,3,[{file,\"src/couch_httpd.erl\"},{line,1222}]},{couch_httpd_multipart,'-decode_multipart_stream/3-fun-1-',4,[{file,\"src/couch_httpd_multipart.erl\"},{line,33}]}]}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1597753853/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1597764832","html_url":"https://github.com/apache/couchdb/issues/1042#issuecomment-1597764832","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1042","id":1597764832,"node_id":"IC_kwDOAAMmUc5fO_Tg","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-19T21:06:22Z","updated_at":"2023-06-19T21:06:22Z","author_association":"NONE","body":"The client sending the request knows the length of each file, so you will have that info. ...That's not to say you're going to get `multipart/related` to work, but you can enjoy trying.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1597764832/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598028192","html_url":"https://github.com/apache/couchdb/issues/4649#issuecomment-1598028192","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4649","id":1598028192,"node_id":"IC_kwDOAAMmUc5fP_mg","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T02:33:36Z","updated_at":"2023-06-20T02:33:36Z","author_association":"CONTRIBUTOR","body":"The response of a `PUT $db/$docid` or `POST $db` is not really a document, it's a just a json grouping of fields.\r\n\r\nThe convention is used in the [_bulk_get](https://docs.couchdb.org/en/stable/api/database/bulk-api.html#db-bulk-get) endpoint as well: since we're not sending document bodies we use `id` and `rev` as is, without the `_` prefix.\r\n\r\nWe can argue that it might have been better to use `_id` and `_rev` always but it seems a small enough difference that it's not worth breaking backward compatibility over.\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598028192/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598030503","html_url":"https://github.com/apache/couchdb/issues/4649#issuecomment-1598030503","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4649","id":1598030503,"node_id":"IC_kwDOAAMmUc5fQAKn","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T02:37:55Z","updated_at":"2023-06-20T02:39:49Z","author_association":"NONE","body":"You could return both, with `_` and without, so as to maintain backward compatability for a period of time; maybe with a warning message? The thing is, `_rev` is key to many operations against CouchDB.\r\n\r\nBTW, for what it's worth, I think the underscore should be omitted alltogether. `id` and `rev` would be best, but if we're gonna use the underscore be consistent. \r\n\r\nCouchDB is a great product though. Just trying to help.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598030503/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598153323","html_url":"https://github.com/apache/couchdb/issues/4650#issuecomment-1598153323","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4650","id":1598153323,"node_id":"IC_kwDOAAMmUc5fQeJr","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T05:47:13Z","updated_at":"2023-06-20T05:47:13Z","author_association":"CONTRIBUTOR","body":"Going by https://github.com/open-telemetry/oteps/blob/main/text/0149-exponential-histogram.md and https://opentelemetry.io/blog/2022/exponential-histograms/ it seems exponential base 2 histograms are popular. \r\n\r\nThe scheme to replace Folsom sliding window histogram could be based on persistent terms and counters.\r\n\r\n```\r\npersistent_term:put(Histogram, counters:new(1024, [write_concurrency])).\r\n```\r\n\r\n```\r\nRef = persistent_term:get(histogram_now(Histogram, NowSec)),\r\ncounters:add(Ref, bucket(Value), Value),\r\n```\r\n\r\nbucket index can be computed with a simple hack of starting with a simple float representation:\r\n\r\n```\r\nexp(N) when is_integer(N) ->\r\n    exp(float(N));\r\nexp(F) when is_float(F), F < 0.0 ->\r\n    0;\r\nexp(F) when is_float(F) ->\r\n    <<0:1,Exp:11,Mantissa:52>> = <<F:64/float>>,\r\n    Exp.\r\n```\r\n\r\nExponent then can be scaled by a precision value by shifting left (`bsl 4`, for instance) and combining with the most significant bits of the mantissa (aka the significand). `Index = (Exp bsl 4) bor (Mantissa bsr (52-4))`.\r\n\r\nThe temporal (windowing) aspect can be implementing by having 15 or so counter arrays and writing to the `NowSec % 15`th one. We'll need a similar auto-cleanup / trim process to recycle and clean old entries.\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598153323/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598415563","html_url":"https://github.com/apache/couchdb/issues/1042#issuecomment-1598415563","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1042","id":1598415563,"node_id":"IC_kwDOAAMmUc5fReLL","user":{"login":"flimzy","id":8555063,"node_id":"MDQ6VXNlcjg1NTUwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8555063?v=4","gravatar_id":"","url":"https://api.github.com/users/flimzy","html_url":"https://github.com/flimzy","followers_url":"https://api.github.com/users/flimzy/followers","following_url":"https://api.github.com/users/flimzy/following{/other_user}","gists_url":"https://api.github.com/users/flimzy/gists{/gist_id}","starred_url":"https://api.github.com/users/flimzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flimzy/subscriptions","organizations_url":"https://api.github.com/users/flimzy/orgs","repos_url":"https://api.github.com/users/flimzy/repos","events_url":"https://api.github.com/users/flimzy/events{/privacy}","received_events_url":"https://api.github.com/users/flimzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T09:16:42Z","updated_at":"2023-06-20T09:18:06Z","author_association":"MEMBER","body":"> The client sending the request knows the length of each file\r\n\r\nNot necissarily.  \r\n\r\n> That's not to say you're going to get multipart/related to work, but you can enjoy trying.\r\n\r\nI have it working. It just requires the non-optimal overhead of calculating that size, and for _all_ attachments, before sending any data.  In some cases it's just a nusiance. In other cases, it means buffering huge amounts of data before sending anything to the server.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598415563/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598925316","html_url":"https://github.com/apache/couchdb/issues/1042#issuecomment-1598925316","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1042","id":1598925316,"node_id":"IC_kwDOAAMmUc5fTaoE","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T14:40:44Z","updated_at":"2023-06-20T14:40:44Z","author_association":"NONE","body":"In what case / scenario are file sizes not known by the source/client machine?\r\n\r\nDo you have this working in JavaScript? If so, any chance you could share your code here?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598925316/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598937902","html_url":"https://github.com/apache/couchdb/issues/1042#issuecomment-1598937902","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1042","id":1598937902,"node_id":"IC_kwDOAAMmUc5fTdsu","user":{"login":"flimzy","id":8555063,"node_id":"MDQ6VXNlcjg1NTUwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8555063?v=4","gravatar_id":"","url":"https://api.github.com/users/flimzy","html_url":"https://github.com/flimzy","followers_url":"https://api.github.com/users/flimzy/followers","following_url":"https://api.github.com/users/flimzy/following{/other_user}","gists_url":"https://api.github.com/users/flimzy/gists{/gist_id}","starred_url":"https://api.github.com/users/flimzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flimzy/subscriptions","organizations_url":"https://api.github.com/users/flimzy/orgs","repos_url":"https://api.github.com/users/flimzy/repos","events_url":"https://api.github.com/users/flimzy/events{/privacy}","received_events_url":"https://api.github.com/users/flimzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T14:47:43Z","updated_at":"2023-06-20T14:47:43Z","author_association":"MEMBER","body":"> In what case / scenario are file sizes not known by the source/client machine?\r\n\r\nAt the risk of soundind trite, any time the source is not a raw disk file. A common example would be reading an HTTP POST or PUT request.  But the file size will not be known prior to reading the file in many other scenarios, as well, such as reading from an archive or compressed file. It can happen when generating the file on the fly, such as when converting between formats, or creating a dump file.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598937902/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598959478","html_url":"https://github.com/apache/couchdb/issues/1042#issuecomment-1598959478","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1042","id":1598959478,"node_id":"IC_kwDOAAMmUc5fTi92","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T14:57:01Z","updated_at":"2023-06-20T14:57:24Z","author_association":"NONE","body":"If you're reading an HTTP POST/PUT you're acting as a proxy in front of CouchDB. The machine that sent that HTTP request knows the file length / type and that's where you would want to build out the `multipart/mixed` body - on the client. I'm not sure I follow regarding streaming multiple files in a single HTTP PUT to Couch.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598959478/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598966917","html_url":"https://github.com/apache/couchdb/issues/1042#issuecomment-1598966917","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1042","id":1598966917,"node_id":"IC_kwDOAAMmUc5fTkyF","user":{"login":"flimzy","id":8555063,"node_id":"MDQ6VXNlcjg1NTUwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8555063?v=4","gravatar_id":"","url":"https://api.github.com/users/flimzy","html_url":"https://github.com/flimzy","followers_url":"https://api.github.com/users/flimzy/followers","following_url":"https://api.github.com/users/flimzy/following{/other_user}","gists_url":"https://api.github.com/users/flimzy/gists{/gist_id}","starred_url":"https://api.github.com/users/flimzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flimzy/subscriptions","organizations_url":"https://api.github.com/users/flimzy/orgs","repos_url":"https://api.github.com/users/flimzy/repos","events_url":"https://api.github.com/users/flimzy/events{/privacy}","received_events_url":"https://api.github.com/users/flimzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T15:00:41Z","updated_at":"2023-06-20T15:00:41Z","author_association":"MEMBER","body":"> The machine that sent that HTTP request knows the file length \r\n\r\nAgain, not necissarily.\r\n\r\nI gather that you've not done a lot of stream-based programming over HTTP or otherwise.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598966917/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598969548","html_url":"https://github.com/apache/couchdb/issues/1042#issuecomment-1598969548","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1042","id":1598969548,"node_id":"IC_kwDOAAMmUc5fTlbM","user":{"login":"flimzy","id":8555063,"node_id":"MDQ6VXNlcjg1NTUwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8555063?v=4","gravatar_id":"","url":"https://api.github.com/users/flimzy","html_url":"https://github.com/flimzy","followers_url":"https://api.github.com/users/flimzy/followers","following_url":"https://api.github.com/users/flimzy/following{/other_user}","gists_url":"https://api.github.com/users/flimzy/gists{/gist_id}","starred_url":"https://api.github.com/users/flimzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flimzy/subscriptions","organizations_url":"https://api.github.com/users/flimzy/orgs","repos_url":"https://api.github.com/users/flimzy/repos","events_url":"https://api.github.com/users/flimzy/events{/privacy}","received_events_url":"https://api.github.com/users/flimzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T15:02:09Z","updated_at":"2023-06-20T15:02:09Z","author_association":"MEMBER","body":"@ronnieroyston I'm curious the point you're trying to make here?  Is it just that you don't see a need for this feature?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1598969548/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599197142","html_url":"https://github.com/apache/couchdb/issues/4650#issuecomment-1599197142","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4650","id":1599197142,"node_id":"IC_kwDOAAMmUc5fUc_W","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T17:13:42Z","updated_at":"2023-06-20T17:13:42Z","author_association":"CONTRIBUTOR","body":"@nickva nicely done demonstrating the lock collision overhead for the histograms. That said, it seems like the underlying histogram implementation is orthogonal to the issue of concurrent updates to the same histogram inducing locks. Your example for a histogram creates a single global histogram that would be concurrently updated just like we do with Folsom. So how do the alternatives to Folsom address the issue of concurrent lock collisions?\r\n\r\nFor bucketing based histograms, given the same accuracy and range, they should be additive in theory. Were you hoping to achieve that with the histograms you linked? \r\n\r\nIt's possible we could use a counter based ets backend for creating bucketing histograms, but counters are designed to be incremented and decremented, whereas with the sampling based histogram we use with Folsom will directly and go set the histogram reservoir values based on the current sample.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599197142/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599213702","html_url":"https://github.com/apache/couchdb/issues/4650#issuecomment-1599213702","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4650","id":1599213702,"node_id":"IC_kwDOAAMmUc5fUhCG","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T17:24:23Z","updated_at":"2023-06-20T17:24:23Z","author_association":"CONTRIBUTOR","body":"It's also worth remembering that the Folsom histograms are front loaded on the number of samples actually collected (for better or worse) which means that the percentage of couch_stats histogram updates that actually triggers an ets update goes down as the number of requests per second goes up. I personally think this is not great as the default bucket size of 1024 entries in a given one second \"moment\", leaves huge amounts of data on the floor; for example, if 100k histogram updates are called in a given second, the last update will have something like a 1:99k chance of actually impacting the histogram.\r\n\r\nSo one thing to watch out for is that switching to a bucketing based histogram that is explicitly accurate in incrementing a bucket for every histogram update, we will drastically increase the amount of lock contention happening. In our example above, all 100k requests will actually modify the histogram, as opposed to Folsom's sampling based approach which has a chance to update the histogram inversely proportional to the number of requests made in the current moment.\r\n\r\nSo again, I believe the fundamental issue at hand is concurrent updates to histograms, and any implementation we run with needs to address that issue directly.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599213702/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599233435","html_url":"https://github.com/apache/couchdb/issues/4650#issuecomment-1599233435","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4650","id":1599233435,"node_id":"IC_kwDOAAMmUc5fUl2b","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T17:37:27Z","updated_at":"2023-06-20T18:22:34Z","author_association":"CONTRIBUTOR","body":"I tried to compare the two approaches:\r\n\r\n```erlang\r\n-module(upstats).\r\n\r\n-export([go/0, go/1, go/2]).\r\n\r\ngo() ->\r\n    go(1000, 10000).\r\n\r\ngo(N) ->\r\n    go(N, 10000).\r\n\r\ngo(N, X) ->\r\n    T0 = erlang:monotonic_time(),\r\n    Workers = [spawn_monitor(fun() ->\r\n        rand:seed(default, os:timestamp()),\r\n        upstat(X)\r\n    end) || _ <- lists:seq(1, N)],\r\n    {_Pids, Refs} = lists:unzip(Workers),\r\n    WorkersSet = sets:from_list(Refs, [{version,2}]),\r\n    ok = wait_workers(WorkersSet),\r\n    Dt = erlang:monotonic_time() - T0,\r\n    erlang:convert_time_unit(Dt, native, millisecond).\r\n\r\nupstat(0) ->\r\n    ok;\r\nupstat(Times) ->\r\n    Hist = case rand:uniform(5) of\r\n        1 -> [couchdb, request_time];\r\n        2 -> [couchdb, dbinfo];\r\n        3 -> [couchdb, httpd, bulk_docs];\r\n        4 -> [fsync, time];\r\n        5 -> [couchdb, db_open_time]\r\n    end,\r\n    couch_stats:update_histogram(Hist, 100),\r\n    upstat(Times - 1).\r\n\r\nwait_workers(Workers) when is_map(Workers) ->\r\n    case sets:size(Workers) of\r\n        0 ->\r\n            ok;\r\n        _ ->\r\n            receive\r\n                {'DOWN', Ref, process, _, normal} ->\r\n                    Workers1 = sets:del_element(Ref, Workers),\r\n                    wait_workers(Workers1);\r\n                {'DOWN', Ref, process, _, Err} ->\r\n                    Workers1 = sets:del_element(Ref, Workers),\r\n                    io:format(\"~n worker ~p crashed: ~p~n\", [Ref, Err]),\r\n                    wait_workers(Workers1)\r\n            end\r\n    end.\r\n```\r\n\r\nWith an example counters update:\r\n\r\n```erlang\r\n-module(upstats_counter).\r\n\r\n-export([go/0, go/1, go/2]).\r\n\r\ngo() ->\r\n    go(1000, 10000).\r\n\r\ngo(N) ->\r\n    go(N, 10000).\r\n\r\ngo(N, X) ->\r\n    Ref = counters:new(1024, [write_concurrency]),\r\n    persistent_term:put(term, Ref),\r\n    T0 = erlang:monotonic_time(),\r\n    Workers = [spawn_monitor(fun() ->\r\n        rand:seed(default, os:timestamp()),\r\n        upstat(X)\r\n    end) || _ <- lists:seq(1, N)],\r\n    {_Pids, Refs} = lists:unzip(Workers),\r\n    WorkersSet = sets:from_list(Refs, [{version,2}]),\r\n    ok = wait_workers(WorkersSet),\r\n    Dt = erlang:monotonic_time() - T0,\r\n    erlang:convert_time_unit(Dt, native, millisecond).\r\n\r\nupstat(0) ->\r\n    ok;\r\nupstat(Times) ->\r\n    Ref = persistent_term:get(term),\r\n    counters:add(Ref, rand:uniform(1024), 100),\r\n    upstat(Times - 1).\r\n\r\nwait_workers(Workers) when is_map(Workers) ->\r\n    case sets:size(Workers) of\r\n        0 ->\r\n            ok;\r\n        _ ->\r\n            receive\r\n                {'DOWN', Ref, process, _, normal} ->\r\n                    Workers1 = sets:del_element(Ref, Workers),\r\n                    wait_workers(Workers1);\r\n                {'DOWN', Ref, process, _, Err} ->\r\n                    Workers1 = sets:del_element(Ref, Workers),\r\n                    io:format(\"~n worker ~p crashed: ~p~n\", [Ref, Err]),\r\n                    wait_workers(Workers1)\r\n            end\r\n    end.\r\n```\r\n\r\n```erlang\r\n(node1@127.0.0.1)18> upstats_counter:go(50000, 1000).\r\n1385\r\n(node1@127.0.0.1)19> upstats_counter:go(50000, 1000).\r\n1425\r\n(node1@127.0.0.1)20> upstats_counter:go(50000, 1000).\r\n1427\r\n(node1@127.0.0.1)21> upstats_counter:go(50000, 1000).\r\n1438\r\n(node1@127.0.0.1)22> upstats:go(50000, 1000).\r\n15131\r\n(node1@127.0.0.1)23> upstats:go(50000, 1000).\r\n16075\r\n(node1@127.0.0.1)24> upstats:go(50000, 1000).\r\n14869\r\n```\r\n\r\nEven with folsom front loading and updating only 1024 values per second it's till 10x slower!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599233435/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599234776","html_url":"https://github.com/apache/couchdb/issues/4650#issuecomment-1599234776","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4650","id":1599234776,"node_id":"IC_kwDOAAMmUc5fUmLY","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T17:38:33Z","updated_at":"2023-06-20T17:38:33Z","author_association":"CONTRIBUTOR","body":"> For bucketing based histograms, given the same accuracy and range, they should be additive in theory. Were you hoping to achieve that with the histograms you linked?\r\n\r\nThe base-2 histograms would be additive and would record every single update.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599234776/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599240107","html_url":"https://github.com/apache/couchdb/issues/4650#issuecomment-1599240107","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4650","id":1599240107,"node_id":"IC_kwDOAAMmUc5fUner","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T17:41:37Z","updated_at":"2023-06-20T17:41:37Z","author_association":"CONTRIBUTOR","body":"I chatted with @nickva directly and he mentioned that `write_concurrency` option to Erlang `counters` implementation results in per scheduler counter tracking, avoiding the concurrent updates I was concerned with! So while a bucket approach that records every histogram entry would result in more updates than a sampling based approach, it sounds like we can completely avoid the locking issue with Erlang `counters`.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599240107/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599240199","html_url":"https://github.com/apache/couchdb/issues/4650#issuecomment-1599240199","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4650","id":1599240199,"node_id":"IC_kwDOAAMmUc5fUngH","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T17:41:42Z","updated_at":"2023-06-20T17:56:18Z","author_association":"CONTRIBUTOR","body":"> So one thing to watch out for is that switching to a bucketing based histogram that is explicitly accurate in incrementing a bucket for every histogram update, we will drastically increase the amount of lock contention happening.\r\n\r\nThat's why I thought counters might work here. With `[write_concurrency]` it does auto-stripping across schedulers\r\nhttps://www.erlang.org/doc/man/counters.html#new-2\r\n\r\n> This is an optimization to achieve very efficient concurrent [add](https://www.erlang.org/doc/man/counters.html#add-3) and [sub](https://www.erlang.org/doc/man/counters.html#sub-3) operations at the expense of potential read inconsistency and memory consumption per counters. Read operations may see sequentially inconsistent results with regard to concurrent write operations. Even if write operation A is done sequentially before write operation B, a concurrent reader may see any combination of A and B, including only B. A read operation is only guaranteed to see all writes done sequentially before the read. No writes are ever lost, but will eventually all be seen.\r\n\r\n> The typical use case for write_concurrency is when concurrent calls to [add](https://www.erlang.org/doc/man/counters.html#add-3) and [sub](https://www.erlang.org/doc/man/counters.html#sub-3) toward the same counters are very frequent, while calls to [get ](https://www.erlang.org/doc/man/counters.html#get-2)and [put](https://www.erlang.org/doc/man/counters.html#put-3) are much less frequent. The lack of absolute read consistency must also be acceptable\r\n\r\nSeems to check out based on OTP [source](https://github.com/erlang/otp/blob/f820bad7bed34cc4365bb9cac56eaa84c9a5bddc/erts/emulator/beam/erl_bif_counters.c#L40-L47)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599240199/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599446014","html_url":"https://github.com/apache/couchdb/issues/1042#issuecomment-1599446014","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1042","id":1599446014,"node_id":"IC_kwDOAAMmUc5fVZv-","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T20:22:46Z","updated_at":"2023-06-20T20:22:46Z","author_association":"NONE","body":"Multipart transfer (like `multipart/related`) lets you upload metadata and data in the same request and is used when the total payload is small enough to upload again, in its entirety, if the connection fails.\r\n\r\nAre you looking for [HTTP 1.1 resumable upload](https://datatracker.ietf.org/doc/draft-ietf-httpbis-resumable-upload/) support?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599446014/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599464366","html_url":"https://github.com/apache/couchdb/issues/4648#issuecomment-1599464366","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4648","id":1599464366,"node_id":"IC_kwDOAAMmUc5fVeOu","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-20T20:39:57Z","updated_at":"2023-06-20T20:39:57Z","author_association":"NONE","body":"BTW, Project Fauxton does not support (illustrate) multi file uploads. In other words, there does not seem to be a working example available.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1599464366/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1600298442","html_url":"https://github.com/apache/couchdb/issues/1042#issuecomment-1600298442","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1042","id":1600298442,"node_id":"IC_kwDOAAMmUc5fYp3K","user":{"login":"flimzy","id":8555063,"node_id":"MDQ6VXNlcjg1NTUwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8555063?v=4","gravatar_id":"","url":"https://api.github.com/users/flimzy","html_url":"https://github.com/flimzy","followers_url":"https://api.github.com/users/flimzy/followers","following_url":"https://api.github.com/users/flimzy/following{/other_user}","gists_url":"https://api.github.com/users/flimzy/gists{/gist_id}","starred_url":"https://api.github.com/users/flimzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flimzy/subscriptions","organizations_url":"https://api.github.com/users/flimzy/orgs","repos_url":"https://api.github.com/users/flimzy/repos","events_url":"https://api.github.com/users/flimzy/events{/privacy}","received_events_url":"https://api.github.com/users/flimzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-21T07:09:08Z","updated_at":"2023-06-21T07:10:31Z","author_association":"MEMBER","body":"No. I'm looking for exactly what the issue describes. The ability to use `multipart/related` without specifying a file size for each attachment in the JSON preamble.\r\n\r\nI'm still unsure what point you're trying to make with these comments.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1600298442/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1601999483","html_url":"https://github.com/apache/couchdb/issues/1042#issuecomment-1601999483","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1042","id":1601999483,"node_id":"IC_kwDOAAMmUc5ffJJ7","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-22T04:38:39Z","updated_at":"2023-06-22T04:38:39Z","author_association":"NONE","body":"I'm building out a Node.js proxy for CouchDB to add Authentication, Authorization, and Accounting (AAA) / role-based controls for browser-based applications (via JWTs). It's basically done but I got to the part where I'm implementing browser uploading multiple files at once and stumbled across this `multipart/related` + JSON request body, and this issue.\r\n\r\nAt this point my main interest is in your code. You said you had multiple file uploads via this mechanism working.\r\n\r\nIs your code in JavaScript? If so, is it published on GitHub, or can you share it?\r\n\r\nHave you noticed that their Fauxton (web admin tool) does not support multi file uploads?\r\n\r\nWould you mind sharing your code?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1601999483/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1602122873","html_url":"https://github.com/apache/couchdb/issues/1042#issuecomment-1602122873","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1042","id":1602122873,"node_id":"IC_kwDOAAMmUc5ffnR5","user":{"login":"flimzy","id":8555063,"node_id":"MDQ6VXNlcjg1NTUwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8555063?v=4","gravatar_id":"","url":"https://api.github.com/users/flimzy","html_url":"https://github.com/flimzy","followers_url":"https://api.github.com/users/flimzy/followers","following_url":"https://api.github.com/users/flimzy/following{/other_user}","gists_url":"https://api.github.com/users/flimzy/gists{/gist_id}","starred_url":"https://api.github.com/users/flimzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flimzy/subscriptions","organizations_url":"https://api.github.com/users/flimzy/orgs","repos_url":"https://api.github.com/users/flimzy/repos","events_url":"https://api.github.com/users/flimzy/events{/privacy}","received_events_url":"https://api.github.com/users/flimzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-22T07:11:08Z","updated_at":"2023-06-22T07:11:08Z","author_association":"MEMBER","body":"No, my code is in Go. But you are of course welcome to see it. The core logic is here: https://github.com/go-kivik/couchdb/blob/3d79fc7e4318319774faa359810f07fda77577ca/db.go#L448","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1602122873/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1602517606","html_url":"https://github.com/apache/couchdb/pull/4518#issuecomment-1602517606","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4518","id":1602517606,"node_id":"IC_kwDOAAMmUc5fhHpm","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-22T12:03:18Z","updated_at":"2023-06-22T12:03:18Z","author_association":"MEMBER","body":">  This change means a user will now get an error when previously they got success (with no rows).\r\n\r\nWith more of these cleanups coming in (thanks @jiahuili430!) we may have to bite the bullet and think about API versioning. We have discussed several approaches in the past but nothing has ever stuck.\r\n\r\nIt might be worth bringing this up in the next developer meeting for a high-level discussion. Until we have a better idea, the best idea I’d have is to put this (and other improvements) behind a `[chttpd] strict_api = false | true` or some such config flag, but it might be better to hold this PR until we have a general solution for this.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1602517606/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1602598896","html_url":"https://github.com/apache/couchdb/pull/4518#issuecomment-1602598896","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4518","id":1602598896,"node_id":"IC_kwDOAAMmUc5fhbfw","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-22T13:00:46Z","updated_at":"2023-06-22T13:00:46Z","author_association":"MEMBER","body":"I like the idea of a flag but wouldn't we need a roadmap for the full set of changes first? (in a python 2/3 way)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1602598896/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1602627708","html_url":"https://github.com/apache/couchdb/pull/4518#issuecomment-1602627708","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4518","id":1602627708,"node_id":"IC_kwDOAAMmUc5fhih8","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-22T13:19:49Z","updated_at":"2023-06-22T13:19:49Z","author_association":"MEMBER","body":"the flag would be a stopgap until we have proper versioning, it’d be a toggle between version 0 and 1, and later we allow versions 2, 3, 4 etc. once we know what these look like. — I wouldn’t mind parking this PR until we have a proper system set up and skip the binary flag for now, but if we would want the PR to land quickly, that’d be the fasted way there, but yeah, we probably want a complete scrub before we introduce even the toggle.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1602627708/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1602752888","html_url":"https://github.com/apache/couchdb/issues/1524#issuecomment-1602752888","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1524","id":1602752888,"node_id":"IC_kwDOAAMmUc5fiBF4","user":{"login":"gray-heron","id":7032646,"node_id":"MDQ6VXNlcjcwMzI2NDY=","avatar_url":"https://avatars.githubusercontent.com/u/7032646?v=4","gravatar_id":"","url":"https://api.github.com/users/gray-heron","html_url":"https://github.com/gray-heron","followers_url":"https://api.github.com/users/gray-heron/followers","following_url":"https://api.github.com/users/gray-heron/following{/other_user}","gists_url":"https://api.github.com/users/gray-heron/gists{/gist_id}","starred_url":"https://api.github.com/users/gray-heron/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gray-heron/subscriptions","organizations_url":"https://api.github.com/users/gray-heron/orgs","repos_url":"https://api.github.com/users/gray-heron/repos","events_url":"https://api.github.com/users/gray-heron/events{/privacy}","received_events_url":"https://api.github.com/users/gray-heron/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-22T14:35:26Z","updated_at":"2023-06-22T14:36:02Z","author_association":"NONE","body":"I second to @TheRook . This single issue prevents a plethora of highly distributed, possibly even backendless use cases! Most of then are probably yet-to-be-invented, as very few other storage solutions have such capabilities.\r\n\r\n@janl @wohali Are there any news on this?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1602752888/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603005683","html_url":"https://github.com/apache/couchdb/issues/4650#issuecomment-1603005683","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4650","id":1603005683,"node_id":"IC_kwDOAAMmUc5fi-zz","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-22T16:52:10Z","updated_at":"2023-06-22T16:52:10Z","author_association":"CONTRIBUTOR","body":"The basic idea for preserving the windowed updates with 10 second windows, and 1 second granularity, like we have currently, could be to use at 10 counter arrays (in a tuple for instance, to allow quick iteration), one per second:\r\n\r\n```\r\nCounters = {counters:new(NumberOfBins), counters:new(NumberOfBins), ....}\r\n```\r\n\r\nSo `update(#hist{}, Val)` would do something like `TimeIndex = erlang:monotonic_time(second) rem tuple_size(Counters) + 1`, `CounterRef = element(TimeIndex, Counters)`.\r\n\r\nIn order to for the trimmer/cleaner process to not step on the toes of current updaters, we'd create 15 or 20 counters, to allow plenty of time in between when the trimmer process resets the old counters and some delayed updaters still updating it. Using monotonic time prevents the updaters from going backwards but there could be some time between them reading the monotonic time and the update itself.\r\n\r\nIn this way we avoid the need to modify (delete old and create new) counter arrays in a persistent term. The persistent histogram term structure remains immutable. The only thing that gets updated are the counter values themselves which should be efficient.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603005683/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603124736","html_url":"https://github.com/apache/couchdb/issues/4651#issuecomment-1603124736","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4651","id":1603124736,"node_id":"IC_kwDOAAMmUc5fjb4A","user":{"login":"mohmesflir","id":42147617,"node_id":"MDQ6VXNlcjQyMTQ3NjE3","avatar_url":"https://avatars.githubusercontent.com/u/42147617?v=4","gravatar_id":"","url":"https://api.github.com/users/mohmesflir","html_url":"https://github.com/mohmesflir","followers_url":"https://api.github.com/users/mohmesflir/followers","following_url":"https://api.github.com/users/mohmesflir/following{/other_user}","gists_url":"https://api.github.com/users/mohmesflir/gists{/gist_id}","starred_url":"https://api.github.com/users/mohmesflir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mohmesflir/subscriptions","organizations_url":"https://api.github.com/users/mohmesflir/orgs","repos_url":"https://api.github.com/users/mohmesflir/repos","events_url":"https://api.github.com/users/mohmesflir/events{/privacy}","received_events_url":"https://api.github.com/users/mohmesflir/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-22T18:24:39Z","updated_at":"2023-06-22T18:24:39Z","author_association":"NONE","body":"Just tested 3.2.3 and it is loading the values correctly","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603124736/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603141648","html_url":"https://github.com/apache/couchdb/issues/4651#issuecomment-1603141648","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4651","id":1603141648,"node_id":"IC_kwDOAAMmUc5fjgAQ","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-22T18:40:06Z","updated_at":"2023-06-22T18:40:06Z","author_association":"CONTRIBUTOR","body":"Thank you for your report @mohmesflir. That does look like a bug. We'll try to investigate and have fix in the next release.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603141648/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603205176","html_url":"https://github.com/apache/couchdb/issues/4650#issuecomment-1603205176","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4650","id":1603205176,"node_id":"IC_kwDOAAMmUc5fjvg4","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-22T19:30:38Z","updated_at":"2023-06-22T19:35:02Z","author_association":"CONTRIBUTOR","body":"To go with float base-2 exponential binning (to capture as much range as possible in each counters array) threw this together:\r\n\r\n```erlang\r\n-define(EXPONENT_BIAS, 1023).\r\n-define(MANTISSA_BITS, 52).\r\n-define(EXPONENT_BITS, 11).\r\n​\r\nbin_index(Val, Scale) when is_integer(Val) ->\r\n    bin_index(float(Val), Scale);\r\nbin_index(Val, Scale) when is_float(Val), is_integer(Scale), Scale >=0, Scale < ?MANTISSA_BITS ->\r\n    {Exponent, Mantissa} = exp(Val),\r\n    ExponentBits = Exponent bsl Scale,\r\n    MantissaBits = Mantissa bsr (?MANTISSA_BITS - Scale),\r\n    ExponentBits bor MantissaBits.\r\n​\r\nexp(Val) when is_float(Val) ->\r\n    <<0:1, Exponent:?EXPONENT_BITS, Mantissa:?MANTISSA_BITS>> = <<Val/float>>,\r\n    {Exponent - ?EXPONENT_BIAS, Mantissa}.\r\n```\r\n\r\nAt first thought of using just the exponent part directly, however the bins are spaced out a bit too much. So then used the idea from https://github.com/newrelic-experimental/newrelic-sketch-java/tree/main/src/main/java/com/newrelic/nrsketch/indexer to add some more precision from the mantissa part into the bin index.\r\n\r\nFirst exponent is shifted a bit \"to make some room\" for the extra bits `Exponent bsl Scale`. `eeee bsl 2` => `eeee00`. Now we have a place for the 2 extra precision bits.\r\n\r\nThen, we shift the mantissa bits to the right and leave only its two top most significant bits. For example, `mmmmmm... bsr (52 -2)` => `0000mm`. And finally, combine it by OR-ing into the shifted exponent part to get the index `eeee00 bor 0000mm` => `eeeemm`.\r\n\r\nThis is a bit of a low-level bit hack, here is a good reminder of the structure of the floating point encoding: https://fabiensanglard.net/floating_point_visually_explained/","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603205176/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603262201","html_url":"https://github.com/apache/couchdb/issues/4651#issuecomment-1603262201","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4651","id":1603262201,"node_id":"IC_kwDOAAMmUc5fj9b5","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-22T20:18:24Z","updated_at":"2023-06-22T20:18:24Z","author_association":"CONTRIBUTOR","body":"@mohmesflir this PR should fix the issue https://github.com/apache/couchdb/pull/4653","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603262201/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603273117","html_url":"https://github.com/apache/couchdb/pull/4653#issuecomment-1603273117","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4653","id":1603273117,"node_id":"IC_kwDOAAMmUc5fkAGd","user":{"login":"mohmesflir","id":42147617,"node_id":"MDQ6VXNlcjQyMTQ3NjE3","avatar_url":"https://avatars.githubusercontent.com/u/42147617?v=4","gravatar_id":"","url":"https://api.github.com/users/mohmesflir","html_url":"https://github.com/mohmesflir","followers_url":"https://api.github.com/users/mohmesflir/followers","following_url":"https://api.github.com/users/mohmesflir/following{/other_user}","gists_url":"https://api.github.com/users/mohmesflir/gists{/gist_id}","starred_url":"https://api.github.com/users/mohmesflir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mohmesflir/subscriptions","organizations_url":"https://api.github.com/users/mohmesflir/orgs","repos_url":"https://api.github.com/users/mohmesflir/repos","events_url":"https://api.github.com/users/mohmesflir/events{/privacy}","received_events_url":"https://api.github.com/users/mohmesflir/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-22T20:28:19Z","updated_at":"2023-06-22T20:28:19Z","author_association":"NONE","body":"The string of ; separated values that I have been using do not have a space or tab preceding the ;.  So this is not working in 3.3.x.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603273117/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603274602","html_url":"https://github.com/apache/couchdb/pull/4653#issuecomment-1603274602","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4653","id":1603274602,"node_id":"IC_kwDOAAMmUc5fkAdq","user":{"login":"mohmesflir","id":42147617,"node_id":"MDQ6VXNlcjQyMTQ3NjE3","avatar_url":"https://avatars.githubusercontent.com/u/42147617?v=4","gravatar_id":"","url":"https://api.github.com/users/mohmesflir","html_url":"https://github.com/mohmesflir","followers_url":"https://api.github.com/users/mohmesflir/followers","following_url":"https://api.github.com/users/mohmesflir/following{/other_user}","gists_url":"https://api.github.com/users/mohmesflir/gists{/gist_id}","starred_url":"https://api.github.com/users/mohmesflir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mohmesflir/subscriptions","organizations_url":"https://api.github.com/users/mohmesflir/orgs","repos_url":"https://api.github.com/users/mohmesflir/repos","events_url":"https://api.github.com/users/mohmesflir/events{/privacy}","received_events_url":"https://api.github.com/users/mohmesflir/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-22T20:29:32Z","updated_at":"2023-06-22T20:29:32Z","author_association":"NONE","body":"It does work in versions prior to and including 3.2.3 but not in 3.3.1 or 3.3.2","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603274602/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603277653","html_url":"https://github.com/apache/couchdb/pull/4653#issuecomment-1603277653","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4653","id":1603277653,"node_id":"IC_kwDOAAMmUc5fkBNV","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-22T20:32:23Z","updated_at":"2023-06-22T20:32:23Z","author_association":"CONTRIBUTOR","body":"> The string of ; separated values that I have been using do not have a space or tab preceding the ;. So this is not working in 3.3.x.\r\n\r\nThat makes sense. The PR should fix it. If you're able to compile and make release yourself let us know if it work. \r\n\r\nThanks for reaching out and reporting the issue.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603277653/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603982048","html_url":"https://github.com/apache/couchdb/issues/4650#issuecomment-1603982048","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4650","id":1603982048,"node_id":"IC_kwDOAAMmUc5fmtLg","user":{"login":"pgj","id":277835,"node_id":"MDQ6VXNlcjI3NzgzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/277835?v=4","gravatar_id":"","url":"https://api.github.com/users/pgj","html_url":"https://github.com/pgj","followers_url":"https://api.github.com/users/pgj/followers","following_url":"https://api.github.com/users/pgj/following{/other_user}","gists_url":"https://api.github.com/users/pgj/gists{/gist_id}","starred_url":"https://api.github.com/users/pgj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgj/subscriptions","organizations_url":"https://api.github.com/users/pgj/orgs","repos_url":"https://api.github.com/users/pgj/repos","events_url":"https://api.github.com/users/pgj/events{/privacy}","received_events_url":"https://api.github.com/users/pgj/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-23T09:13:36Z","updated_at":"2023-06-23T09:13:36Z","author_association":"CONTRIBUTOR","body":"> This is a bit of a low-level bit hack, here is a good reminder of the structure of the floating point encoding: https://fabiensanglard.net/floating_point_visually_explained/\r\n\r\nhttps://floating-point-gui.de/formats/fp/ also has some links to pages with visualization:\r\n- [Float Toy](http://evanw.github.io/float-toy/)\r\n- [IEEE 754 Visualization](https://bartaz.github.io/ieee754-visualization/)\r\n- [Floats Exposed](https://float.exposed/0x40490fdb)\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1603982048/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1604182819","html_url":"https://github.com/apache/couchdb/issues/4634#issuecomment-1604182819","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4634","id":1604182819,"node_id":"IC_kwDOAAMmUc5fneMj","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-23T12:01:08Z","updated_at":"2023-06-23T12:01:08Z","author_association":"CONTRIBUTOR","body":"Hi,\r\n\r\ncan't help you much with docker, but which version did you use? If I look at the crash dump, there is Erlang/OTP 20, which is old and I don't know, when we release a CouchDB version with this Erlang version. Maybe check your volumes/images and try again with the latest version?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1604182819/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1604207200","html_url":"https://github.com/apache/couchdb/issues/4590#issuecomment-1604207200","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4590","id":1604207200,"node_id":"IC_kwDOAAMmUc5fnkJg","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-23T12:22:37Z","updated_at":"2023-06-23T12:22:37Z","author_association":"CONTRIBUTOR","body":"Hey,\r\n\r\nthe secret needs to be the same on each node, details at section [2.2.3 (Point 4 & 5)](https://docs.couchdb.org/en/stable/setup/cluster.html#preparing-couchdb-nodes-to-be-joined-into-a-cluster).\r\n\r\n> I will try opton one. Did you why is not the [`chttpd_auth.secret`](https://docs.couchdb.org/en/stable/config/auth.html#chttpd_auth/secret) is used as auth base?\r\n\r\nIt is used for Cookie and Proxy authentication!\r\nhttps://github.com/apache/couchdb/blob/85e1fa7913b5a564c1731ad86fbba294a9d9a16c/src/couch/src/couch_httpd_auth.erl#L350","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1604207200/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1604882336","html_url":"https://github.com/apache/couchdb/issues/4650#issuecomment-1604882336","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4650","id":1604882336,"node_id":"IC_kwDOAAMmUc5fqI-g","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-23T20:06:40Z","updated_at":"2023-06-23T20:06:40Z","author_association":"CONTRIBUTOR","body":"Thinking more about how we compute the `bin_index`: Since Erlang support bitstrings, we can avoid doing all the shifting and and OR-ing gymnastics and just pick exponent + top msb bits from the mantissa directly.\r\n\r\n```erlang\r\nbin_index(Val) ->\r\n    <<0:1, BinIndex:?INDEX_BITS, _/bitstring>> = <<Val/float>>,\r\n    BinIndex.\r\n```\r\n\r\n```\r\nINDEX_BITS = EXPONENT_BITS + SCALE = 11 + 3 = 14\r\n```\r\n\r\nThis however returns the unbiased exponent, but since already have to handle an offset to transform bin indices [1, ... MaxBins] range, we'll just have a large offset now (8000 or so)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1604882336/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1604886453","html_url":"https://github.com/apache/couchdb/issues/4650#issuecomment-1604886453","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4650","id":1604886453,"node_id":"IC_kwDOAAMmUc5fqJ-1","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-23T20:09:22Z","updated_at":"2023-06-23T20:09:22Z","author_association":"CONTRIBUTOR","body":"A quick proof of concept: https://gist.github.com/nickva/d1e5a086107e2f0e824e1c49ff177507\r\n\r\n\r\n```erlang\r\ntest_speed() ->\r\n    H = new(15),\r\n    timer:tc(fun() -> lists:foreach(fun(I) -> fhist:update(H, I, 10000.0) end, lists:seq(1, 1000000)) end).\r\n```\r\n\r\n```erlang\r\n> fhist:test_speed().\r\n{243211,ok}\r\n```\r\n\r\nWe can do a bin selection (normally a `math:log/1` operation), a counter time index selection, and a counter update in about 200 nanoseconds.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1604886453/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1605866503","html_url":"https://github.com/apache/couchdb/issues/1042#issuecomment-1605866503","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1042","id":1605866503,"node_id":"IC_kwDOAAMmUc5ft5QH","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-25T04:34:03Z","updated_at":"2023-06-25T04:34:03Z","author_association":"NONE","body":"If you're interested https://github.com/ronnieroyston/couch-behind-node\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1605866503/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1612240666","html_url":"https://github.com/apache/couchdb/issues/4650#issuecomment-1612240666","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4650","id":1612240666,"node_id":"IC_kwDOAAMmUc5gGNca","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-28T23:36:19Z","updated_at":"2023-06-28T23:38:37Z","author_association":"CONTRIBUTOR","body":"Since the main goal is improve performance during higher concurrency, and avoid the bottleneck-ing on a single ETS lock, created a benchmark which compares old (Folsom) histogram updates with the new ones under concurrency.\r\n\r\nhttps://gist.github.com/nickva/c057ee081e59359aca3c6e78ffb3d263\r\n\r\nAt 10k concurrency level:\r\n\r\n```\r\n> upstats_new_hist:go_new_hist(10000, 10000).\r\n6083\r\n> upstats_new_hist:go_new_hist(10000, 10000).\r\n6541\r\n> upstats_new_hist:go_new_hist(10000, 10000).\r\n6509\r\n\r\n> upstats_new_hist:go_folsom_hist(10000, 10000).\r\n156323\r\n> upstats_new_hist:go_folsom_hist(10000, 10000).\r\n154118\r\n> upstats_new_hist:go_folsom_hist(10000, 10000).\r\n166647\r\n```\r\n\r\nTaking the best times:\r\n\r\n```\r\n1> 154118 / 6083.\r\n25.335854019398322\r\n```\r\nThe new histogram implementation is **25**x faster at **10k** concurrency\r\n\r\nAt 1k concurrency level:\r\n\r\n```\r\n> upstats_new_hist:go_new_hist(1000, 10000).\r\n567\r\n> upstats_new_hist:go_new_hist(1000, 10000).\r\n563\r\n> upstats_new_hist:go_new_hist(1000, 10000).\r\n573\r\n\r\n> upstats_new_hist:go_folsom_hist(1000, 10000).\r\n12807\r\n> upstats_new_hist:go_folsom_hist(1000, 10000).\r\n12221\r\n> upstats_new_hist:go_folsom_hist(1000, 10000).\r\n12459\r\n```\r\n\r\nUsing best times:\r\n```\r\n> 12221 / 563.\r\n21.706927175843695\r\n```\r\n\r\nThe new histogram implementation is **20x** faster at **1k** concurrency. Which confirms that the new histogram implementation is faster and is less of a bottleneck during concurrent updates.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1612240666/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1612866418","html_url":"https://github.com/apache/couchdb/issues/4656#issuecomment-1612866418","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4656","id":1612866418,"node_id":"IC_kwDOAAMmUc5gImNy","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-29T10:48:44Z","updated_at":"2023-06-29T10:48:44Z","author_association":"CONTRIBUTOR","body":"Hi,\r\n\r\nI think something might wrong with your setup. Please check your config, I didn’t saw this „any“ before…","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1612866418/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1614358860","html_url":"https://github.com/apache/couchdb/issues/2791#issuecomment-1614358860","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2791","id":1614358860,"node_id":"IC_kwDOAAMmUc5gOSlM","user":{"login":"sergey-safarov","id":2562241,"node_id":"MDQ6VXNlcjI1NjIyNDE=","avatar_url":"https://avatars.githubusercontent.com/u/2562241?v=4","gravatar_id":"","url":"https://api.github.com/users/sergey-safarov","html_url":"https://github.com/sergey-safarov","followers_url":"https://api.github.com/users/sergey-safarov/followers","following_url":"https://api.github.com/users/sergey-safarov/following{/other_user}","gists_url":"https://api.github.com/users/sergey-safarov/gists{/gist_id}","starred_url":"https://api.github.com/users/sergey-safarov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sergey-safarov/subscriptions","organizations_url":"https://api.github.com/users/sergey-safarov/orgs","repos_url":"https://api.github.com/users/sergey-safarov/repos","events_url":"https://api.github.com/users/sergey-safarov/events{/privacy}","received_events_url":"https://api.github.com/users/sergey-safarov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-30T09:02:17Z","updated_at":"2023-06-30T09:02:17Z","author_association":"NONE","body":"Sorry for the long delay\r\nI have reproduced the issue.\r\nIn my installation, I have 3  node cluster that works IPv6 only (on the server no IPv4 address on the network interface card).\r\nBut when I try to replicate the database from another server I can see \"A\" DNS requests.\r\nTo start replications on my filesystem created `/tmp/json.txt` with content\r\n```\r\n{\r\n  \"source\": {\r\n    \"headers\": {},\r\n    \"url\": \"http://admin:pass@example.com:5984/alerts\"\r\n  },\r\n  \"target\": {\r\n    \"headers\": {},\r\n    \"url\": \"http://admin:pass@127.0.0.1:5984/alerts\"\r\n  },\r\n  \"continuous\": false,\r\n  \"create_target\": false\r\n}\r\n```\r\nAnd then use curl command to start replication\r\n```\r\ncurl -s -S \\\r\n  -H 'Content-Type: application/json' \\\r\n  -H 'Accept: application/json, text/javascript' \\\r\n  --data-binary @/tmp/json.txt \\\r\n  http://admin:pass@127.0.0.1:5984/_replicate\r\n```\r\nand in the response has\r\n```\r\n{\"error\":\"replication_auth_error\",\"reason\":\"{session_request_failed,\\\"http://source.local:5984/_session\\\",\\\"admin\\\",\\n                        {conn_failed,{error,nxdomain}}}\"}\r\n```\r\nTested on 2.3.1 and will recheck on the latest docker image","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1614358860/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1614535494","html_url":"https://github.com/apache/couchdb/issues/4656#issuecomment-1614535494","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4656","id":1614535494,"node_id":"IC_kwDOAAMmUc5gO9tG","user":{"login":"till","id":27003,"node_id":"MDQ6VXNlcjI3MDAz","avatar_url":"https://avatars.githubusercontent.com/u/27003?v=4","gravatar_id":"","url":"https://api.github.com/users/till","html_url":"https://github.com/till","followers_url":"https://api.github.com/users/till/followers","following_url":"https://api.github.com/users/till/following{/other_user}","gists_url":"https://api.github.com/users/till/gists{/gist_id}","starred_url":"https://api.github.com/users/till/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/till/subscriptions","organizations_url":"https://api.github.com/users/till/orgs","repos_url":"https://api.github.com/users/till/repos","events_url":"https://api.github.com/users/till/events{/privacy}","received_events_url":"https://api.github.com/users/till/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-30T11:43:32Z","updated_at":"2023-06-30T11:43:32Z","author_association":"NONE","body":"@big-r81 I see `any` in many places:\r\nhttps://github.com/apache/couchdb/blob/16f47d758c6d630c391cf35c78c6959240ff4f1d/src/couch/src/couch_httpd.erl#L131-L137\r\n\r\n(Search the code base for `bind_address`.)\r\n\r\nI don't know enough Erlang to find out what `any` maps to. But it seems like a type?\r\n\r\nI used some env vars when I started the container (`COUCHDB_USERNAME`, `NODENAME`, etc.) and I put one `.ini` file into it myself. Otherwise, it's all stock.\r\n\r\n```ini\r\n;/opt/couchdb/etc/local.d/setup.ini\r\n[couchdb]\r\nsingle_node=true\r\n```\r\n\r\nThe (official) Docker image also creates a `10-docker-default.ini`:\r\n\r\n```ini\r\n; CouchDB Configuration Settings\r\n\r\n; Custom settings should be made in this file. They will override settings\r\n; in default.ini, but unlike changes made to default.ini, this file won't be\r\n; overwritten on server upgrade.\r\n\r\n[chttpd]\r\nbind_address = any\r\n```\r\n\r\nMore any. :)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1614535494/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1615162895","html_url":"https://github.com/apache/couchdb/pull/4657#issuecomment-1615162895","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4657","id":1615162895,"node_id":"IC_kwDOAAMmUc5gRW4P","user":{"login":"pgj","id":277835,"node_id":"MDQ6VXNlcjI3NzgzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/277835?v=4","gravatar_id":"","url":"https://api.github.com/users/pgj","html_url":"https://github.com/pgj","followers_url":"https://api.github.com/users/pgj/followers","following_url":"https://api.github.com/users/pgj/following{/other_user}","gists_url":"https://api.github.com/users/pgj/gists{/gist_id}","starred_url":"https://api.github.com/users/pgj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgj/subscriptions","organizations_url":"https://api.github.com/users/pgj/orgs","repos_url":"https://api.github.com/users/pgj/repos","events_url":"https://api.github.com/users/pgj/events{/privacy}","received_events_url":"https://api.github.com/users/pgj/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-30T20:27:53Z","updated_at":"2023-06-30T20:28:33Z","author_association":"CONTRIBUTOR","body":"This is not about the ordering of elements.  One of the key properties of mappings is that they do not lose elements (assuming that the function used for mapping is total, i.e. it always produces an answer).  The folding-based approach does not exclude this possibility.  For example, it can turn the elements of the list into any other data structure, even some scalar, or exclude elements from the input.  It may take a while for the reader to see that it is just about extending the indexes with their prefixes and prefix differences on the field ranges.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1615162895/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1615169763","html_url":"https://github.com/apache/couchdb/pull/4657#issuecomment-1615169763","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4657","id":1615169763,"node_id":"IC_kwDOAAMmUc5gRYjj","user":{"login":"pgj","id":277835,"node_id":"MDQ6VXNlcjI3NzgzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/277835?v=4","gravatar_id":"","url":"https://api.github.com/users/pgj","html_url":"https://github.com/pgj","followers_url":"https://api.github.com/users/pgj/followers","following_url":"https://api.github.com/users/pgj/following{/other_user}","gists_url":"https://api.github.com/users/pgj/gists{/gist_id}","starred_url":"https://api.github.com/users/pgj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgj/subscriptions","organizations_url":"https://api.github.com/users/pgj/orgs","repos_url":"https://api.github.com/users/pgj/repos","events_url":"https://api.github.com/users/pgj/events{/privacy}","received_events_url":"https://api.github.com/users/pgj/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-30T20:35:31Z","updated_at":"2023-06-30T20:35:31Z","author_association":"CONTRIBUTOR","body":"> I think we'd need to fix the tests as some assume a particular results order. We could potentially generalize those by sorted the results before comparing?\r\n\r\nWith a mapping, this is not required, I believe.  It should just maintain the original ordering as it walks the list and applies the function on each element.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1615169763/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1615180766","html_url":"https://github.com/apache/couchdb/pull/4657#issuecomment-1615180766","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4657","id":1615180766,"node_id":"IC_kwDOAAMmUc5gRbPe","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-30T20:46:39Z","updated_at":"2023-06-30T20:46:39Z","author_association":"CONTRIBUTOR","body":"> This is not about the ordering of elements. \r\n\r\nThe test is failing because the order of the elements changes. So we should at least fix that part.\r\n\r\n```\r\n[2023-06-30T16:40:36.458Z] module 'mango_cursor_view'\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: viewcbargs_test...ok\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: maybe_replace_max_json_test...ok\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: base_opts_test...ok\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: apply_opts_empty_test...ok\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: apply_opts_r_test...ok\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: apply_opts_conflicts_test...ok\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: apply_opts_sort_test...ok\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: apply_opts_stale_test...ok\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: apply_opts_stable_test...ok\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: apply_opts_update_test...ok\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: apply_opts_partition_test...[0.006 s] ok\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: consider_index_coverage_positive_test...[0.007 s] ok\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: consider_index_coverage_negative_test...ok\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: derive_doc_from_index_test...ok\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: derive_doc_from_index_partitioned_test...ok\r\n[2023-06-30T16:40:36.458Z]   mango_cursor_view: composite_indexes_test...*failed*\r\n[2023-06-30T16:40:36.458Z] in function mango_cursor_view:composite_indexes_test/0 (src/mango_cursor_view.erl, line 903)\r\n[2023-06-30T16:40:36.458Z] in call from eunit_test:'-mf_wrapper/2-fun-0-'/2 (eunit_test.erl, line 273)\r\n[2023-06-30T16:40:36.458Z] in call from eunit_test:run_testfun/1 (eunit_test.erl, line 71)\r\n[2023-06-30T16:40:36.458Z] in call from eunit_proc:run_test/1 (eunit_proc.erl, line 531)\r\n[2023-06-30T16:40:36.458Z] in call from eunit_proc:with_timeout/3 (eunit_proc.erl, line 356)\r\n[2023-06-30T16:40:36.458Z] in call from eunit_proc:handle_test/2 (eunit_proc.erl, line 514)\r\n[2023-06-30T16:40:36.458Z] in call from eunit_proc:tests_inorder/3 (eunit_proc.erl, line 456)\r\n[2023-06-30T16:40:36.458Z] in call from eunit_proc:with_timeout/3 (eunit_proc.erl, line 346)\r\n[2023-06-30T16:40:36.458Z] **error:{assertEqual,[{module,mango_cursor_view},\r\n[2023-06-30T16:40:36.458Z]               {line,903},\r\n[2023-06-30T16:40:36.458Z]               {expression,\"composite_indexes ( Indexes , Ranges )\"},\r\n[2023-06-30T16:40:36.458Z]               {expected,[{{idx,undefined,undefined,undefined,<<\"json\">>,\r\n[2023-06-30T16:40:36.458Z]                                {[{<<...>>,...}]},\r\n[2023-06-30T16:40:36.458Z]                                undefined,undefined},\r\n[2023-06-30T16:40:36.458Z]                           [range3,range4],\r\n[2023-06-30T16:40:36.458Z]                           1},\r\n[2023-06-30T16:40:36.458Z]                          {{idx,undefined,undefined,undefined,<<\"json\">>,\r\n[2023-06-30T16:40:36.458Z]                                {[{...}]},\r\n[2023-06-30T16:40:36.458Z]                                undefined,undefined},\r\n[2023-06-30T16:40:36.458Z]                           [range1,range3,range4],\r\n[2023-06-30T16:40:36.458Z]                           0},\r\n[2023-06-30T16:40:36.458Z]                          {{idx,undefined,undefined,undefined,<<\"json\">>,\r\n[2023-06-30T16:40:36.458Z]                                {[...]},\r\n[2023-06-30T16:40:36.458Z]                                undefined,...},\r\n[2023-06-30T16:40:36.458Z]                           [range1],\r\n[2023-06-30T16:40:36.458Z]                           2}]},\r\n[2023-06-30T16:40:36.458Z]               {value,[{{idx,undefined,undefined,undefined,<<\"json\">>,\r\n[2023-06-30T16:40:36.458Z]                             {[{...}]},\r\n[2023-06-30T16:40:36.458Z]                             undefined,undefined},\r\n[2023-06-30T16:40:36.458Z]                        [range1],\r\n[2023-06-30T16:40:36.458Z]                        2},\r\n[2023-06-30T16:40:36.458Z]                       {{idx,undefined,undefined,undefined,<<\"json\">>,\r\n[2023-06-30T16:40:36.458Z]                             {[...]},\r\n[2023-06-30T16:40:36.458Z]                             undefined,...},\r\n[2023-06-30T16:40:36.458Z]                        [range1,range3,range4],\r\n[2023-06-30T16:40:36.458Z]                        0},\r\n[2023-06-30T16:40:36.458Z]                       {{idx,undefined,undefined,undefined,<<\"json\">>,{...},...},\r\n[2023-06-30T16:40:36.458Z]                        [range3,range4],\r\n[2023-06-30T16:40:36.458Z]                        1}]}]}\r\n[2023-06-30T16:40:36.458Z]   output:<<\"\">>\r\n```\r\n\r\n> One of the key properties of mappings is that they do not lose elements\r\n\r\nWe were not losing elements here either, they were pre-pended to the accumulator list. The only visible difference is that we ended up with a different order of elements.\r\n\r\n>> I think we'd need to fix the tests as some assume a particular results order. We could potentially generalize those by sorted the results before comparing?\r\n\r\n> With a mapping, this is not required, I believe. It should just maintain the original ordering as it walks the list and applies the function on each element.\r\n\r\nI was trying to point out that the output order in this particular function doesn't matter as much. We always run a custom sort on the result and pick out the head only. But since that's  more about how the result is used, and not the function itself the best way is to just update all the unit tests to pass.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1615180766/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1615194313","html_url":"https://github.com/apache/couchdb/pull/4657#issuecomment-1615194313","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4657","id":1615194313,"node_id":"IC_kwDOAAMmUc5gRejJ","user":{"login":"pgj","id":277835,"node_id":"MDQ6VXNlcjI3NzgzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/277835?v=4","gravatar_id":"","url":"https://api.github.com/users/pgj","html_url":"https://github.com/pgj","followers_url":"https://api.github.com/users/pgj/followers","following_url":"https://api.github.com/users/pgj/following{/other_user}","gists_url":"https://api.github.com/users/pgj/gists{/gist_id}","starred_url":"https://api.github.com/users/pgj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgj/subscriptions","organizations_url":"https://api.github.com/users/pgj/orgs","repos_url":"https://api.github.com/users/pgj/repos","events_url":"https://api.github.com/users/pgj/events{/privacy}","received_events_url":"https://api.github.com/users/pgj/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-30T21:04:04Z","updated_at":"2023-06-30T21:04:04Z","author_association":"CONTRIBUTOR","body":"> The test is failing because the order of the elements changes. So we should at least fix that part.\r\n\r\nSorry, I was answering the part about the statement that prepending with fold left reverses the order.  You are right that the ordering does not matter in this case.   But replacing this with a `map` breaks the unit tests.  I did not notice that one, but I have pushed a fix for that since then.\r\n\r\n> We were not losing elements here either, they were pre-pended to the accumulator list. The only visible difference is that we ended up with a different order of elements.\r\n\r\nAh, my concern is not the final result but the readability mainly.  It acts like a map, why not to use the `map` function here?  This is made evident.  I believe such minor details could contribute to the overall understanding of the code.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1615194313/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1615235540","html_url":"https://github.com/apache/couchdb/pull/4657#issuecomment-1615235540","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4657","id":1615235540,"node_id":"IC_kwDOAAMmUc5gRonU","user":{"login":"pgj","id":277835,"node_id":"MDQ6VXNlcjI3NzgzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/277835?v=4","gravatar_id":"","url":"https://api.github.com/users/pgj","html_url":"https://github.com/pgj","followers_url":"https://api.github.com/users/pgj/followers","following_url":"https://api.github.com/users/pgj/following{/other_user}","gists_url":"https://api.github.com/users/pgj/gists{/gist_id}","starred_url":"https://api.github.com/users/pgj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgj/subscriptions","organizations_url":"https://api.github.com/users/pgj/orgs","repos_url":"https://api.github.com/users/pgj/repos","events_url":"https://api.github.com/users/pgj/events{/privacy}","received_events_url":"https://api.github.com/users/pgj/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-06-30T22:09:53Z","updated_at":"2023-06-30T22:09:53Z","author_association":"CONTRIBUTOR","body":"Thanks @nickva !","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1615235540/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616316141","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616316141","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616316141,"node_id":"IC_kwDOAAMmUc5gVwbt","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T02:45:20Z","updated_at":"2023-07-02T03:00:30Z","author_association":"NONE","body":"**I second this motion.** \r\n\r\nParsing HTTP Cookies is trivial. CouchDB would simply need to specify the key, or the name, of the cookie that contains the JWT.\r\n\r\n**I recommend cookie shall have a configurable key value which can be set under the `[chttpd]` section. This delivers maximum flexibility.**\r\n\r\nIt is said to be best practice to issue JWT's as HTTPOnly cookies meaning that they are not available to client/browser JavaScript. In other words, _HTTPOnly_ cookies make it impossible to build a custom header aligning with CouchDB's interface, namely `Authorization: Bearer <JWT token>`\r\n\r\nhttps://docs.couchdb.org/en/stable/api/server/authn.html#jwt-authentication\r\n\r\nRFC 6265, HTTP State Management Mechanism\r\n\r\n> [Section 4.1.2.6.  The HttpOnly Attribute](https://datatracker.ietf.org/doc/html/rfc6265#section-4.1.2.6)\r\n\r\n>    The HttpOnly attribute limits the scope of the cookie to HTTP\r\n>    requests.  In particular, the attribute instructs the user agent to\r\n>    omit the cookie when providing access to cookies via \"non-HTTP\" APIs\r\n>    (such as a web browser API that exposes cookies to scripts).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616316141/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616620226","html_url":"https://github.com/apache/couchdb/issues/4656#issuecomment-1616620226","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4656","id":1616620226,"node_id":"IC_kwDOAAMmUc5gW6rC","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T12:00:05Z","updated_at":"2023-07-02T12:00:05Z","author_association":"CONTRIBUTOR","body":"Mhhh, thats strange. Does 0.0.0.0 work?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616620226/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616628878","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616628878","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616628878,"node_id":"IC_kwDOAAMmUc5gW8yO","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T12:19:58Z","updated_at":"2023-07-02T12:19:58Z","author_association":"CONTRIBUTOR","body":"Hi,\r\n\r\nyou can use JWT tokens without requesting sessions via `_/session` API.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616628878/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616640123","html_url":"https://github.com/apache/couchdb/issues/4655#issuecomment-1616640123","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4655","id":1616640123,"node_id":"IC_kwDOAAMmUc5gW_h7","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T12:51:49Z","updated_at":"2023-07-02T16:24:01Z","author_association":"CONTRIBUTOR","body":"Hi,\r\n\r\nyou send only the value in the body as JSON string. You will need to double-escape the `\\n`.\r\n\r\nExample:\r\n```\r\ncurl -X PUT \"http://a:a@127.0.0.1:15984/_node/_local/_config/jwt_keys/rsa:testkey\" -d '\"-----BEGIN PUBLIC KEY-----\\\\nMIIBIjAN....DAQAB\\\\n-----END PUBLIC KEY-----\\\\n\"\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616640123/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":1,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616761391","html_url":"https://github.com/apache/couchdb/issues/4655#issuecomment-1616761391","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4655","id":1616761391,"node_id":"IC_kwDOAAMmUc5gXdIv","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T18:21:53Z","updated_at":"2023-07-02T18:21:53Z","author_association":"NONE","body":"> You will need to double-escape the `\\n`.\r\n\r\nI have not come across that one before. Thank you.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616761391/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616765804","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616765804","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616765804,"node_id":"IC_kwDOAAMmUc5gXeNs","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T18:28:23Z","updated_at":"2023-07-02T18:41:47Z","author_association":"NONE","body":"I need to be able to have CouchDB read cookies in order for me to not expose the JWT to client side JavaScript.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616765804/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616770080","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616770080","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616770080,"node_id":"IC_kwDOAAMmUc5gXfQg","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T18:44:30Z","updated_at":"2023-07-02T18:44:30Z","author_association":"CONTRIBUTOR","body":"What are you trying to achieve? Session cookies and JWT tokens are seperate things. A client can request a session with username/pasword or can authenticate with a JWT token.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616770080/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616772698","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616772698","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616772698,"node_id":"IC_kwDOAAMmUc5gXf5a","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T18:50:27Z","updated_at":"2023-07-02T18:50:27Z","author_association":"NONE","body":"I want to authenticate with JWT tokens. I have it working.\r\n\r\nCouch requires the JWT be passed in a specific _client request_ HTTP header, namely `Authorization: Bearer <JWT token>`. Right?\r\n\r\nHow can I set this _client request header_ on the server?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616772698/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616773782","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616773782","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616773782,"node_id":"IC_kwDOAAMmUc5gXgKW","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T18:56:04Z","updated_at":"2023-07-02T18:56:04Z","author_association":"CONTRIBUTOR","body":"> How can I set this _client request header_ on the server?\r\n\r\nWhich server do you mean, the CouchDB server?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616773782/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616774650","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616774650","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616774650,"node_id":"IC_kwDOAAMmUc5gXgX6","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T18:59:44Z","updated_at":"2023-07-02T18:59:44Z","author_association":"NONE","body":"No the web server. In my case Node.js, or PHP, any web server.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616774650/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616778006","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616778006","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616778006,"node_id":"IC_kwDOAAMmUc5gXhMW","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T19:14:18Z","updated_at":"2023-07-02T19:14:18Z","author_association":"CONTRIBUTOR","body":"To summarize this and get this correct. Your problem is to add this `Authorization: Bearer <JWT token>` header to your client request, because CouchDB expects this as a http request header to authenticate via JWT token?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616778006/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616779364","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616779364","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616779364,"node_id":"IC_kwDOAAMmUc5gXhhk","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T19:17:51Z","updated_at":"2023-07-02T19:18:46Z","author_association":"NONE","body":"Precisely. The JWT is stored in an _HHTPOnly_ cookie on the browser/client. So, how do I set the clients HTTP `Authorization` header server side?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616779364/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616785732","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616785732","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616785732,"node_id":"IC_kwDOAAMmUc5gXjFE","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T19:26:52Z","updated_at":"2023-07-02T19:27:49Z","author_association":"NONE","body":"You can't. You can, however, set client HTTP cookies server side. So, we need Couch to look for the JWT in an HTTP cookie named _`<configurable>`_.\r\n\r\nThe idea is that it is a security measure to _not_ expose the JWT to client side scripting.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616785732/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616795761","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616795761","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616795761,"node_id":"IC_kwDOAAMmUc5gXlhx","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T19:38:06Z","updated_at":"2023-07-02T19:38:06Z","author_association":"CONTRIBUTOR","body":"> Precisely. The JWT is stored in an _HHTPOnly_ cookie on the browser/client. So, how do I set the clients HTTP `Authorization` header server side?\r\n\r\nThe JWT token has nothing to do with a session or a cookie. You send it with your request to get access (if correct). How you (securly) store them on your client is a completely different question.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616795761/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616796887","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616796887","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616796887,"node_id":"IC_kwDOAAMmUc5gXlzX","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T19:41:48Z","updated_at":"2023-07-02T19:41:48Z","author_association":"NONE","body":"Add support for authentication/authorization using cookies containing JWTs is the issue.\r\n\r\nWe need Couch to look for JWT's in a cookie.\r\n\r\nHow to securely store JWT's on your client includes using HTTPOnly cookies which makes it impossible to authenticate to Couch (unless you expose the JWT to client side scripting).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616796887/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616801953","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616801953","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616801953,"node_id":"IC_kwDOAAMmUc5gXnCh","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T19:58:18Z","updated_at":"2023-07-02T20:05:48Z","author_association":"CONTRIBUTOR","body":"> We need Couch to look for JWT's in a cookie.\r\n\r\nHow should this work? The server can't send the client the credentials to obtain access. It's the same as when the server would sends the client a username/password combination. \r\nThe client needs to provide the server credentials to authenticate and not the server.\r\n\r\nIf you want a cookie (httponly - with a JWT token) from the server, how do you authenticate against it and/or with what credentials?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616801953/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616804922","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616804922","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616804922,"node_id":"IC_kwDOAAMmUc5gXnw6","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T20:10:54Z","updated_at":"2023-07-02T20:10:54Z","author_association":"NONE","body":"CouchDB does not issue JWT's. CouchDB _verifies_ JWTs (vis a vis the `[jwt-keys]` that it is configured with.\r\n\r\nCouchDB supports Authentication via JWT so long as the JWT is sent in an HTTP header titled `Authorization`.\r\n\r\nCouchDB SHOULD support authentication via JWT sent as an HTTP cookie.\r\n\r\nWhy? Bcs cookies are more secure in that they can be stored on a client as _HTTPOnly_. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616804922/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616808031","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616808031","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616808031,"node_id":"IC_kwDOAAMmUc5gXohf","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T20:23:04Z","updated_at":"2023-07-02T20:23:04Z","author_association":"CONTRIBUTOR","body":"> CouchDB does not issue JWT's. CouchDB _verifies_ JWTs (vis a vis the `[jwt-keys]` that it is configured with.\r\n> \r\n\r\nI know 😉\r\n\r\n> CouchDB supports Authentication via JWT so long as the JWT is sent in an HTTP header titled `Authorization`.\r\n> \r\n\r\nCorrect.\r\n\r\n> CouchDB SHOULD support authentication via JWT sent as an HTTP cookie.\r\n> \r\n\r\nOk, and how do you request that cookie? \r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616808031/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616809073","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616809073","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616809073,"node_id":"IC_kwDOAAMmUc5gXoxx","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T20:27:13Z","updated_at":"2023-07-02T20:27:13Z","author_association":"NONE","body":"CouchDB does request cookies. CouchDB receives cookies.\r\n\r\nAnother server issues the cookie to the client/browser. See https://developer.mozilla.org/en-US/docs/Web/HTTP/Cookies#define_where_cookies_are_sent","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616809073/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616812242","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616812242","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616812242,"node_id":"IC_kwDOAAMmUc5gXpjS","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T20:41:28Z","updated_at":"2023-07-02T20:41:28Z","author_association":"CONTRIBUTOR","body":"> CouchDB does request cookies. CouchDB receives cookies.\r\n> \r\n\r\nI know, you didn’t answer my question. How do you request your cookie?\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616812242/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616814153","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616814153","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616814153,"node_id":"IC_kwDOAAMmUc5gXqBJ","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T20:50:20Z","updated_at":"2023-07-02T20:51:39Z","author_association":"NONE","body":"Cookies are issued to browsers/clients by servers. Cookies are not requested, they are received.\r\n\r\nA server sends a browser a cookie with a JWT as the value. The browser includes that cookie (that JWT) in _every_ HTTP call to all servers on a domain or by path (configurable)\r\n\r\n<img width=\"1160\" alt=\"image\" src=\"https://github.com/apache/couchdb/assets/12751611/1b23ae80-0bda-4966-bdda-12afedd6177e\">\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616814153/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616819266","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616819266","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616819266,"node_id":"IC_kwDOAAMmUc5gXrRC","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T21:09:10Z","updated_at":"2023-07-02T21:09:10Z","author_association":"CONTRIBUTOR","body":"CouchDB sends a cookie if you request a session. To get a session, you need to provide a username/password. If you are authenticated successfully, you will get this session cookie (httponly), which can be used for further requests.\r\n\r\nIf you have an JWT token, you can send this with a header. If this token is correct, you get access to the system. You have to send this token with every request.\r\n\r\nIf you have a username/password you don’t need a JWT token for requests or vice-versa. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616819266/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616820026","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616820026","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616820026,"node_id":"IC_kwDOAAMmUc5gXrc6","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T21:12:53Z","updated_at":"2023-07-02T21:12:53Z","author_association":"NONE","body":"This issue seems elusive to you. I'll let someone else run with it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616820026/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616825174","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616825174","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616825174,"node_id":"IC_kwDOAAMmUc5gXstW","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T21:26:15Z","updated_at":"2023-07-02T21:26:15Z","author_association":"CONTRIBUTOR","body":"> This issue seems elusive to you.\r\n\r\nNo, but you don’t tell me how you want request your cookie (with your token), because you need an authorization before to get the cookie, but when you have an authorization before you don’t need a JWT token anymore, because you can already authenticate against CouchDB.\r\n\r\n> I'll let someone else run with it.\r\n🍀","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616825174/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616829422","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616829422","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616829422,"node_id":"IC_kwDOAAMmUc5gXtvu","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T21:34:32Z","updated_at":"2023-07-02T21:34:32Z","author_association":"NONE","body":"How I get my JWT is not the issue and has nothing to do with CouchDB. I think this is where you might be missing me?\r\n\r\n![image](https://github.com/apache/couchdb/assets/12751611/4990bc20-4c3e-456e-b2ee-ee1b3f41cbc2)\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616829422/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616861362","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1616861362","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1616861362,"node_id":"IC_kwDOAAMmUc5gX1iy","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-02T22:13:17Z","updated_at":"2023-07-02T22:13:17Z","author_association":"CONTRIBUTOR","body":"Maybe [proxy auth](https://docs.couchdb.org/en/stable/api/server/authn.html#proxy-authentication) is more suitable for you?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1616861362/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1617028737","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1617028737","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1617028737,"node_id":"IC_kwDOAAMmUc5gYeaB","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-03T00:20:15Z","updated_at":"2023-07-03T00:20:15Z","author_association":"NONE","body":"Proxy auth does not remedy this issue and is not related to this issue.\r\n\r\nWe don't want to expose JWT's to client/browser JavaScript. CouchDB accepting JWT via cookies is the remedy.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1617028737/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1617159413","html_url":"https://github.com/apache/couchdb/issues/4661#issuecomment-1617159413","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4661","id":1617159413,"node_id":"IC_kwDOAAMmUc5gY-T1","user":{"login":"ronnievsmith","id":12751611,"node_id":"MDQ6VXNlcjEyNzUxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/12751611?v=4","gravatar_id":"","url":"https://api.github.com/users/ronnievsmith","html_url":"https://github.com/ronnievsmith","followers_url":"https://api.github.com/users/ronnievsmith/followers","following_url":"https://api.github.com/users/ronnievsmith/following{/other_user}","gists_url":"https://api.github.com/users/ronnievsmith/gists{/gist_id}","starred_url":"https://api.github.com/users/ronnievsmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ronnievsmith/subscriptions","organizations_url":"https://api.github.com/users/ronnievsmith/orgs","repos_url":"https://api.github.com/users/ronnievsmith/repos","events_url":"https://api.github.com/users/ronnievsmith/events{/privacy}","received_events_url":"https://api.github.com/users/ronnievsmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-03T03:15:22Z","updated_at":"2023-07-03T03:15:22Z","author_association":"NONE","body":"Upon further troubleshooting it works if you add \"_admins\" to the `roles` included in the JWT payload. Closing this issue.\r\n\r\nJWT Payload Data\r\n```\r\n{\r\n  \"exp\": 1690983653708,\r\n  \"iss\": \"nodejs\",\r\n  \"roles\": [\r\n    \"member\",\r\n    \"_admin\"\r\n  ],\r\n  \"sub\": \"0428c67f-0c5d-4201-862f-71c1661f917f\"\r\n}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1617159413/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1617664814","html_url":"https://github.com/apache/couchdb/issues/2873#issuecomment-1617664814","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2873","id":1617664814,"node_id":"IC_kwDOAAMmUc5ga5su","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-03T08:56:42Z","updated_at":"2023-07-03T08:56:42Z","author_association":"MEMBER","body":"RFC 6750, § 5.3,\r\n\r\n> Don't store bearer tokens in cookies:  Implementations MUST NOT store\r\n      bearer tokens within cookies that can be sent in the clear (which\r\n      is the default transmission mode for cookies).  Implementations\r\n      that do store bearer tokens in cookies MUST take precautions\r\n      against cross-site request forgery.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1617664814/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]