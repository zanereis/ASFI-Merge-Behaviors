[{"url":"https://api.github.com/repos/apache/brpc/issues/comments/496938856","html_url":"https://github.com/apache/brpc/pull/784#issuecomment-496938856","issue_url":"https://api.github.com/repos/apache/brpc/issues/784","id":496938856,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NjkzODg1Ng==","user":{"login":"jasonszang","id":19163259,"node_id":"MDQ6VXNlcjE5MTYzMjU5","avatar_url":"https://avatars.githubusercontent.com/u/19163259?v=4","gravatar_id":"","url":"https://api.github.com/users/jasonszang","html_url":"https://github.com/jasonszang","followers_url":"https://api.github.com/users/jasonszang/followers","following_url":"https://api.github.com/users/jasonszang/following{/other_user}","gists_url":"https://api.github.com/users/jasonszang/gists{/gist_id}","starred_url":"https://api.github.com/users/jasonszang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasonszang/subscriptions","organizations_url":"https://api.github.com/users/jasonszang/orgs","repos_url":"https://api.github.com/users/jasonszang/repos","events_url":"https://api.github.com/users/jasonszang/events{/privacy}","received_events_url":"https://api.github.com/users/jasonszang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-29T13:34:20Z","updated_at":"2019-05-29T13:50:21Z","author_association":"CONTRIBUTOR","body":"Again travis doesn't look right. The error is about `run_tests.sh` not finding `[[`, which I did not touch.\r\n~~Would anyone please take a look?~~ Let me do a rebase first","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/496938856/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497036995","html_url":"https://github.com/apache/brpc/pull/784#issuecomment-497036995","issue_url":"https://api.github.com/repos/apache/brpc/issues/784","id":497036995,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzAzNjk5NQ==","user":{"login":"jasonszang","id":19163259,"node_id":"MDQ6VXNlcjE5MTYzMjU5","avatar_url":"https://avatars.githubusercontent.com/u/19163259?v=4","gravatar_id":"","url":"https://api.github.com/users/jasonszang","html_url":"https://github.com/jasonszang","followers_url":"https://api.github.com/users/jasonszang/followers","following_url":"https://api.github.com/users/jasonszang/following{/other_user}","gists_url":"https://api.github.com/users/jasonszang/gists{/gist_id}","starred_url":"https://api.github.com/users/jasonszang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasonszang/subscriptions","organizations_url":"https://api.github.com/users/jasonszang/orgs","repos_url":"https://api.github.com/users/jasonszang/repos","events_url":"https://api.github.com/users/jasonszang/events{/privacy}","received_events_url":"https://api.github.com/users/jasonszang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-29T17:39:00Z","updated_at":"2019-05-29T17:39:00Z","author_association":"CONTRIBUTOR","body":"Same error after rebasing, `./run_tests.sh: 22: ./run_tests.sh: [[: not found`\r\nTook a look around and it seems that master branch is currently failing for the same reason. @jamesge \r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497036995/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497177915","html_url":"https://github.com/apache/brpc/issues/785#issuecomment-497177915","issue_url":"https://api.github.com/repos/apache/brpc/issues/785","id":497177915,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzE3NzkxNQ==","user":{"login":"Ye-Tian-Zero","id":8231208,"node_id":"MDQ6VXNlcjgyMzEyMDg=","avatar_url":"https://avatars.githubusercontent.com/u/8231208?v=4","gravatar_id":"","url":"https://api.github.com/users/Ye-Tian-Zero","html_url":"https://github.com/Ye-Tian-Zero","followers_url":"https://api.github.com/users/Ye-Tian-Zero/followers","following_url":"https://api.github.com/users/Ye-Tian-Zero/following{/other_user}","gists_url":"https://api.github.com/users/Ye-Tian-Zero/gists{/gist_id}","starred_url":"https://api.github.com/users/Ye-Tian-Zero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ye-Tian-Zero/subscriptions","organizations_url":"https://api.github.com/users/Ye-Tian-Zero/orgs","repos_url":"https://api.github.com/users/Ye-Tian-Zero/repos","events_url":"https://api.github.com/users/Ye-Tian-Zero/events{/privacy}","received_events_url":"https://api.github.com/users/Ye-Tian-Zero/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-30T02:28:47Z","updated_at":"2019-05-30T02:28:47Z","author_association":"CONTRIBUTOR","body":"github 卡住导致重复发起的 issue","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497177915/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497187803","html_url":"https://github.com/apache/brpc/issues/786#issuecomment-497187803","issue_url":"https://api.github.com/repos/apache/brpc/issues/786","id":497187803,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzE4NzgwMw==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-30T03:24:11Z","updated_at":"2019-05-30T03:24:11Z","author_association":"CONTRIBUTOR","body":"单连接下，client连一个server只有一个连接，可能达到单个连接的极限了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497187803/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497189684","html_url":"https://github.com/apache/brpc/issues/788#issuecomment-497189684","issue_url":"https://api.github.com/repos/apache/brpc/issues/788","id":497189684,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzE4OTY4NA==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-30T03:35:21Z","updated_at":"2019-05-30T03:35:21Z","author_association":"CONTRIBUTOR","body":"这个看起来可能和你启动程序的方法有关，使得程序的权限不够","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497189684/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497190404","html_url":"https://github.com/apache/brpc/issues/788#issuecomment-497190404","issue_url":"https://api.github.com/repos/apache/brpc/issues/788","id":497190404,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzE5MDQwNA==","user":{"login":"h2oast","id":16482774,"node_id":"MDQ6VXNlcjE2NDgyNzc0","avatar_url":"https://avatars.githubusercontent.com/u/16482774?v=4","gravatar_id":"","url":"https://api.github.com/users/h2oast","html_url":"https://github.com/h2oast","followers_url":"https://api.github.com/users/h2oast/followers","following_url":"https://api.github.com/users/h2oast/following{/other_user}","gists_url":"https://api.github.com/users/h2oast/gists{/gist_id}","starred_url":"https://api.github.com/users/h2oast/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/h2oast/subscriptions","organizations_url":"https://api.github.com/users/h2oast/orgs","repos_url":"https://api.github.com/users/h2oast/repos","events_url":"https://api.github.com/users/h2oast/events{/privacy}","received_events_url":"https://api.github.com/users/h2oast/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-30T03:40:05Z","updated_at":"2019-05-30T03:40:05Z","author_association":"NONE","body":"我直接将输出警告的那一行注释掉了：）","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497190404/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497249040","html_url":"https://github.com/apache/brpc/pull/784#issuecomment-497249040","issue_url":"https://api.github.com/repos/apache/brpc/issues/784","id":497249040,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzI0OTA0MA==","user":{"login":"jasonszang","id":19163259,"node_id":"MDQ6VXNlcjE5MTYzMjU5","avatar_url":"https://avatars.githubusercontent.com/u/19163259?v=4","gravatar_id":"","url":"https://api.github.com/users/jasonszang","html_url":"https://github.com/jasonszang","followers_url":"https://api.github.com/users/jasonszang/followers","following_url":"https://api.github.com/users/jasonszang/following{/other_user}","gists_url":"https://api.github.com/users/jasonszang/gists{/gist_id}","starred_url":"https://api.github.com/users/jasonszang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jasonszang/subscriptions","organizations_url":"https://api.github.com/users/jasonszang/orgs","repos_url":"https://api.github.com/users/jasonszang/repos","events_url":"https://api.github.com/users/jasonszang/events{/privacy}","received_events_url":"https://api.github.com/users/jasonszang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-30T08:24:24Z","updated_at":"2019-05-30T08:24:24Z","author_association":"CONTRIBUTOR","body":"Looks good now","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497249040/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497304787","html_url":"https://github.com/apache/brpc/issues/790#issuecomment-497304787","issue_url":"https://api.github.com/repos/apache/brpc/issues/790","id":497304787,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzMwNDc4Nw==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-30T11:55:36Z","updated_at":"2019-05-30T11:55:36Z","author_association":"CONTRIBUTOR","body":"The deadline timer in brpc starts when the user calls Channel::CallMethod() which includes request marshaling, buffering, sending (nearly all steps of a RPC). If the packet containing the response(which may not be parsed yet) comes back before the deadline, the timer is removed. Otherwise the RPC ends with ERPCTIMEDOUT error.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497304787/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497546323","html_url":"https://github.com/apache/brpc/issues/577#issuecomment-497546323","issue_url":"https://api.github.com/repos/apache/brpc/issues/577","id":497546323,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzU0NjMyMw==","user":{"login":"fengliangwang","id":9689078,"node_id":"MDQ6VXNlcjk2ODkwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/9689078?v=4","gravatar_id":"","url":"https://api.github.com/users/fengliangwang","html_url":"https://github.com/fengliangwang","followers_url":"https://api.github.com/users/fengliangwang/followers","following_url":"https://api.github.com/users/fengliangwang/following{/other_user}","gists_url":"https://api.github.com/users/fengliangwang/gists{/gist_id}","starred_url":"https://api.github.com/users/fengliangwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fengliangwang/subscriptions","organizations_url":"https://api.github.com/users/fengliangwang/orgs","repos_url":"https://api.github.com/users/fengliangwang/repos","events_url":"https://api.github.com/users/fengliangwang/events{/privacy}","received_events_url":"https://api.github.com/users/fengliangwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-31T01:52:45Z","updated_at":"2019-05-31T01:52:45Z","author_association":"NONE","body":"> > 请问此问题是如何修复解决的？\r\n> > 不用改代码，编译时加上 --define=with_glog=true\r\n> > $ bazel build --define=with_glog=true  ...\r\n\r\n好的，看到了，谢谢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497546323/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497598426","html_url":"https://github.com/apache/brpc/issues/787#issuecomment-497598426","issue_url":"https://api.github.com/repos/apache/brpc/issues/787","id":497598426,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzU5ODQyNg==","user":{"login":"scottzzq","id":1217132,"node_id":"MDQ6VXNlcjEyMTcxMzI=","avatar_url":"https://avatars.githubusercontent.com/u/1217132?v=4","gravatar_id":"","url":"https://api.github.com/users/scottzzq","html_url":"https://github.com/scottzzq","followers_url":"https://api.github.com/users/scottzzq/followers","following_url":"https://api.github.com/users/scottzzq/following{/other_user}","gists_url":"https://api.github.com/users/scottzzq/gists{/gist_id}","starred_url":"https://api.github.com/users/scottzzq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottzzq/subscriptions","organizations_url":"https://api.github.com/users/scottzzq/orgs","repos_url":"https://api.github.com/users/scottzzq/repos","events_url":"https://api.github.com/users/scottzzq/events{/privacy}","received_events_url":"https://api.github.com/users/scottzzq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-31T06:55:56Z","updated_at":"2019-05-31T06:55:56Z","author_association":"NONE","body":"我自己实现的一种简单粗暴的屏蔽策略，测试的时候会走到：https://github.com/apache/incubator-brpc/blob/master/src/brpc/socket.cpp#L1933 我的代码大概的逻辑就是保存连续超时的次数，达到阈值直接调用SetFailed这个函数,最终走到L1933行，程序挂掉了，我取了两台机器当时socket的状态数据如下：\r\n第一个\r\n$4 = {static STREAM_FAKE_FD = 2147483647, static PROGRESS_INIT = 1, _versioned_ref = {<std::atomic<unsigned long>> = {<std::__atomic_base<unsigned long>> = {\r\n        static _S_alignment = 8, _M_i = 3}, <No data fields>}, <No data fields>}, _shared_part = {<std::atomic<brpc::Socket::SharedPart*>> = {_M_b = {\r\n        _M_p = 0x7f2e3387fd00}}, <No data fields>}, _nevent = {<std::atomic<int>> = {<std::__atomic_base<int>> = {static _S_alignment = 4, \r\n        _M_i = 0}, <No data fields>}, <No data fields>}, _keytable_pool = 0x0, _fd = {<std::atomic<int>> = {<std::__atomic_base<int>> = {static _S_alignment = 4, \r\n        _M_i = -1}, <No data fields>}, <No data fields>}, _tos = 0, _reset_fd_real_us = 1558802556182021, _remote_side = {ip = {s_addr = XXXX}, port = 8090}, \r\n  _local_side = {ip = {s_addr = 0}, port = 0}, _on_edge_triggered_events = 0x1353780 <brpc::InputMessenger::OnNewMessages(brpc::Socket*)>, _user = 0x7f314923ef90, \r\n  _conn = 0x0, _app_connect = {<std::__shared_ptr<brpc::AppConnect, (__gnu_cxx::_Lock_policy)2>> = {_M_ptr = 0x0, _M_refcount = {_M_pi = 0x0}}, <No data fields>}, \r\n  _this_id = 8601, _preferred_index = 1, _hc_count = 0, _last_msg_size = 0, _avg_msg_size = 12083, _read_buf = {<butil::IOBuf> = {static DEFAULT_BLOCK_SIZE = 8192, \r\n      static INITIAL_CAP = 32, static INVALID_AREA = 0, {_bv = {magic = 0, start = 0, refs = 0x0, nref = 0, cap_mask = 0, nbytes = 0}, _sv = {refs = {{offset = 0, \r\n              length = 0, block = 0x0}, {offset = 0, length = 0, block = 0x0}}}}}, _block = 0x0}, \r\n  _last_readtime_us = {<std::atomic<long>> = {<std::__atomic_base<long>> = {static _S_alignment = 8, _M_i = 716836113636}, <No data fields>}, <No data fields>}, \r\n  _parsing_context = {<std::atomic<brpc::Destroyable*>> = {_M_b = {_M_p = 0x0}}, <No data fields>}, _correlation_id = 0, _health_check_interval_s = 3, \r\n  _ninprocess = {<std::atomic<unsigned int>> = {<std::__atomic_base<unsigned int>> = {static _S_alignment = 4, _M_i = 1}, <No data fields>}, <No data fields>}, \r\n  _auth_flag_error = {<std::atomic<unsigned long>> = {<std::__atomic_base<unsigned long>> = {static _S_alignment = 8, _M_i = 0}, <No data fields>}, <No data fields>}, \r\n  _auth_id = {value = 35923106471208}, _auth_context = 0x0, _ssl_state = brpc::SSL_OFF, _ssl_session = 0x0, \r\n  _ssl_ctx = {<std::__shared_ptr<brpc::SocketSSLContext, (__gnu_cxx::_Lock_policy)2>> = {_M_ptr = 0x0, _M_refcount = {_M_pi = 0x0}}, <No data fields>}, \r\n  _connection_type_for_progressive_read = brpc::CONNECTION_TYPE_UNKNOWN, _controller_released_socket = {<std::atomic<bool>> = {_M_base = {static _S_alignment = 1, \r\n        _M_i = false}}, <No data fields>}, _overcrowded = false, _fail_me_at_server_stop = false, _logoff_flag = {<std::atomic<bool>> = {_M_base = {\r\n        static _S_alignment = 1, _M_i = false}}, <No data fields>}, _recycle_flag = {<std::atomic<bool>> = {_M_base = {static _S_alignment = 1, \r\n        _M_i = false}}, <No data fields>}, _error_code = 1009, _error_text = {static npos = 18446744073709551615, \r\n    _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, _M_p = 0x7f2986450ba0 \"\"}, _M_string_length = 0, {\r\n      _M_local_buf = '\\000' <repeats 15 times>, _M_allocated_capacity = 0}}, _agent_socket_id = {<std::atomic<unsigned long>> = {<std::__atomic_base<unsigned long>> = {\r\n        static _S_alignment = 8, _M_i = 18446744073709551615}, <No data fields>}, <No data fields>}, _pipeline_mutex = {_native_handle = {__data = {__lock = 0, \r\n        __count = 0, __owner = 0, __nusers = 0, __kind = 0, __spins = 0, __list = {__prev = 0x0, __next = 0x0}}, __size = '\\000' <repeats 39 times>, __align = 0}}, \r\n  _pipeline_q = 0x0, _id_wait_list_mutex = {__data = {__lock = 0, __count = 0, __owner = 0, __nusers = 0, __kind = 0, __spins = 0, __list = {__prev = 0x0, __next = 0x0}}, \r\n    __size = '\\000' <repeats 39 times>, __align = 0}, _id_wait_list = {impl = 0x0, head = 0, size = 0, conflict_head = 0, conflict_size = 0}, \r\n  _last_writetime_us = {<std::atomic<long>> = {<std::__atomic_base<long>> = {static _S_alignment = 8, _M_i = 716836113636}, <No data fields>}, <No data fields>}, \r\n  _unwritten_bytes = {<std::atomic<long>> = {<std::__atomic_base<long>> = {static _S_alignment = 8, _M_i = 0}, <No data fields>}, <No data fields>}, \r\n  _epollout_butex = 0x7f298586b780, _write_head = {<std::atomic<brpc::Socket::WriteRequest*>> = {_M_b = {_M_p = 0x0}}, <No data fields>}, _stream_mutex = {\r\n    _native_handle = {__data = {__lock = 0, __count = 0, __owner = 0, __nusers = 0, __kind = 0, __spins = 0, __list = {__prev = 0x0, __next = 0x0}}, \r\n      __size = '\\000' <repeats 39 times>, __align = 0}}, _stream_set = 0x0, _message_count = {<std::__atomic_base<long>> = {static _S_alignment = 8, \r\n      _M_i = 0}, <No data fields>}, _timeout_count = {<std::__atomic_base<long>> = {static _S_alignment = 8, _M_i = 0}, <No data fields>}, \r\n  _last_failed_timestamp = {<std::__atomic_base<long>> = {static _S_alignment = 8, _M_i = 9223372036854775807}, <No data fields>}}\r\n\r\n第二个：\r\n$5 = {static STREAM_FAKE_FD = 2147483647, static PROGRESS_INIT = 1, _versioned_ref = {<std::atomic<unsigned long>> = {<std::__atomic_base<unsigned long>> = {\r\n        static _S_alignment = 8, _M_i = 4294967299}, <No data fields>}, <No data fields>}, _shared_part = {<std::atomic<brpc::Socket::SharedPart*>> = {_M_b = {\r\n        _M_p = 0x7f6d02e89040}}, <No data fields>}, _nevent = {<std::atomic<int>> = {<std::__atomic_base<int>> = {static _S_alignment = 4, \r\n        _M_i = 0}, <No data fields>}, <No data fields>}, _keytable_pool = 0x0, _fd = {<std::atomic<int>> = {<std::__atomic_base<int>> = {static _S_alignment = 4, \r\n        _M_i = -1}, <No data fields>}, <No data fields>}, _tos = 0, _reset_fd_real_us = 1558802940407031, _remote_side = {ip = {s_addr = XXXXX}, port = 8090}, \r\n  _local_side = {ip = {s_addr = 0}, port = 0}, _on_edge_triggered_events = 0x1353780 <brpc::InputMessenger::OnNewMessages(brpc::Socket*)>, _user = 0x7f6da944b080, \r\n  _conn = 0x0, _app_connect = {<std::__shared_ptr<brpc::AppConnect, (__gnu_cxx::_Lock_policy)2>> = {_M_ptr = 0x0, _M_refcount = {_M_pi = 0x0}}, <No data fields>}, \r\n  _this_id = 1397, _preferred_index = 1, _hc_count = 0, _last_msg_size = 0, _avg_msg_size = 13654, _read_buf = {<butil::IOBuf> = {static DEFAULT_BLOCK_SIZE = 8192, \r\n      static INITIAL_CAP = 32, static INVALID_AREA = 0, {_bv = {magic = 0, start = 0, refs = 0x0, nref = 0, cap_mask = 0, nbytes = 0}, _sv = {refs = {{offset = 0, \r\n              length = 0, block = 0x0}, {offset = 0, length = 0, block = 0x0}}}}}, _block = 0x0}, \r\n  _last_readtime_us = {<std::atomic<long>> = {<std::__atomic_base<long>> = {static _S_alignment = 8, _M_i = 716566117540}, <No data fields>}, <No data fields>}, \r\n  _parsing_context = {<std::atomic<brpc::Destroyable*>> = {_M_b = {_M_p = 0x0}}, <No data fields>}, _correlation_id = 0, _health_check_interval_s = 3, \r\n  _ninprocess = {<std::atomic<unsigned int>> = {<std::__atomic_base<unsigned int>> = {static _S_alignment = 4, _M_i = 1}, <No data fields>}, <No data fields>}, \r\n  _auth_flag_error = {<std::atomic<unsigned long>> = {<std::__atomic_base<unsigned long>> = {static _S_alignment = 8, _M_i = 0}, <No data fields>}, <No data fields>}, \r\n  _auth_id = {value = 71902047506782}, _auth_context = 0x0, _ssl_state = brpc::SSL_OFF, _ssl_session = 0x0, \r\n  _ssl_ctx = {<std::__shared_ptr<brpc::SocketSSLContext, (__gnu_cxx::_Lock_policy)2>> = {_M_ptr = 0x0, _M_refcount = {_M_pi = 0x0}}, <No data fields>}, \r\n  _connection_type_for_progressive_read = brpc::CONNECTION_TYPE_UNKNOWN, _controller_released_socket = {<std::atomic<bool>> = {_M_base = {static _S_alignment = 1, \r\n        _M_i = false}}, <No data fields>}, _overcrowded = false, _fail_me_at_server_stop = false, _logoff_flag = {<std::atomic<bool>> = {_M_base = {\r\n        static _S_alignment = 1, _M_i = false}}, <No data fields>}, _recycle_flag = {<std::atomic<bool>> = {_M_base = {static _S_alignment = 1, \r\n        _M_i = true}}, <No data fields>}, _error_code = 110, _error_text = {static npos = 18446744073709551615, \r\n    _M_dataplus = {<std::allocator<char>> = {<__gnu_cxx::new_allocator<char>> = {<No data fields>}, <No data fields>}, \r\n      _M_p = 0x7f6d26c5a000 \"Fail to connect Socket{id=1397 addr=XXXXX:8090} (0x0x7f6d03367780): Connection timed out\"}, _M_string_length = 95, {\r\n      _M_local_buf = \"\\244\", '\\000' <repeats 14 times>, _M_allocated_capacity = 164}}, \r\n  _agent_socket_id = {<std::atomic<unsigned long>> = {<std::__atomic_base<unsigned long>> = {static _S_alignment = 8, \r\n        _M_i = 18446744073709551615}, <No data fields>}, <No data fields>}, _pipeline_mutex = {_native_handle = {__data = {__lock = 0, __count = 0, __owner = 0, \r\n        __nusers = 0, __kind = 0, __spins = 0, __list = {__prev = 0x0, __next = 0x0}}, __size = '\\000' <repeats 39 times>, __align = 0}}, _pipeline_q = 0x0, \r\n  _id_wait_list_mutex = {__data = {__lock = 0, __count = 0, __owner = 0, __nusers = 0, __kind = 0, __spins = 0, __list = {__prev = 0x0, __next = 0x0}}, \r\n    __size = '\\000' <repeats 39 times>, __align = 0}, _id_wait_list = {impl = 0x0, head = 0, size = 0, conflict_head = 0, conflict_size = 0}, \r\n  _last_writetime_us = {<std::atomic<long>> = {<std::__atomic_base<long>> = {static _S_alignment = 8, _M_i = 716566117540}, <No data fields>}, <No data fields>}, \r\n  _unwritten_bytes = {<std::atomic<long>> = {<std::__atomic_base<long>> = {static _S_alignment = 8, _M_i = 0}, <No data fields>}, <No data fields>}, \r\n  _epollout_butex = 0x7f6d03231f00, _write_head = {<std::atomic<brpc::Socket::WriteRequest*>> = {_M_b = {_M_p = 0x0}}, <No data fields>}, _stream_mutex = {\r\n    _native_handle = {__data = {__lock = 0, __count = 0, __owner = 0, __nusers = 0, __kind = 0, __spins = 0, __list = {__prev = 0x0, __next = 0x0}}, \r\n      __size = '\\000' <repeats 39 times>, __align = 0}}, _stream_set = 0x0, _message_count = {<std::__atomic_base<long>> = {static _S_alignment = 8, \r\n      _M_i = 0}, <No data fields>}, _timeout_count = {<std::__atomic_base<long>> = {static _S_alignment = 8, _M_i = 0}, <No data fields>}, \r\n  _last_failed_timestamp = {<std::__atomic_base<long>> = {static _S_alignment = 8, _M_i = 9223372036854775807}, <No data fields>}}\r\n  \r\n\r\n@jamesge  麻烦帮忙看下，出现这个case的原因是啥，谢谢了！","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497598426/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497613339","html_url":"https://github.com/apache/brpc/issues/787#issuecomment-497613339","issue_url":"https://api.github.com/repos/apache/brpc/issues/787","id":497613339,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzYxMzMzOQ==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-31T07:52:17Z","updated_at":"2019-05-31T07:52:17Z","author_association":"CONTRIBUTOR","body":"我并不知道你提到的”简单粗暴的屏蔽策略“是怎么写的，C++有太多理由coredump，所以还是建议你自己先review下代码，看看是否有内存相关的bug。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497613339/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497619367","html_url":"https://github.com/apache/brpc/issues/787#issuecomment-497619367","issue_url":"https://api.github.com/repos/apache/brpc/issues/787","id":497619367,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzYxOTM2Nw==","user":{"login":"scottzzq","id":1217132,"node_id":"MDQ6VXNlcjEyMTcxMzI=","avatar_url":"https://avatars.githubusercontent.com/u/1217132?v=4","gravatar_id":"","url":"https://api.github.com/users/scottzzq","html_url":"https://github.com/scottzzq","followers_url":"https://api.github.com/users/scottzzq/followers","following_url":"https://api.github.com/users/scottzzq/following{/other_user}","gists_url":"https://api.github.com/users/scottzzq/gists{/gist_id}","starred_url":"https://api.github.com/users/scottzzq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottzzq/subscriptions","organizations_url":"https://api.github.com/users/scottzzq/orgs","repos_url":"https://api.github.com/users/scottzzq/repos","events_url":"https://api.github.com/users/scottzzq/events{/privacy}","received_events_url":"https://api.github.com/users/scottzzq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-31T08:11:44Z","updated_at":"2019-05-31T08:11:44Z","author_association":"NONE","body":"coredump的原因是这个是比较明确的，就是执行到L1933,最终调用了glog打印了FATAL日志导致的，现在看起来原因就是调用了socket的SetFailed方法，之后还能收到这个socket的可读事件，但是在StartInputEvent的时候其实发现fd被设置成-1了，我仔细看过SetFailed的代码，中间其实是有个WaitAndReset的，理论上执行完这个函数之后，fd已经从EventDispatch中删除掉了，不会再触发到可读事件了，但是现在的确出现这样的问题了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497619367/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497620200","html_url":"https://github.com/apache/brpc/issues/787#issuecomment-497620200","issue_url":"https://api.github.com/repos/apache/brpc/issues/787","id":497620200,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzYyMDIwMA==","user":{"login":"scottzzq","id":1217132,"node_id":"MDQ6VXNlcjEyMTcxMzI=","avatar_url":"https://avatars.githubusercontent.com/u/1217132?v=4","gravatar_id":"","url":"https://api.github.com/users/scottzzq","html_url":"https://github.com/scottzzq","followers_url":"https://api.github.com/users/scottzzq/followers","following_url":"https://api.github.com/users/scottzzq/following{/other_user}","gists_url":"https://api.github.com/users/scottzzq/gists{/gist_id}","starred_url":"https://api.github.com/users/scottzzq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottzzq/subscriptions","organizations_url":"https://api.github.com/users/scottzzq/orgs","repos_url":"https://api.github.com/users/scottzzq/repos","events_url":"https://api.github.com/users/scottzzq/events{/privacy}","received_events_url":"https://api.github.com/users/scottzzq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-31T08:14:24Z","updated_at":"2019-05-31T08:14:24Z","author_association":"NONE","body":"我的关闭的策略和master中的熔断功能基本是一样的，都是调用SetFailed方法来做的，理论上如果启用了熔断功能也会有类似的问题的 @jamesge ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497620200/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497622466","html_url":"https://github.com/apache/brpc/issues/787#issuecomment-497622466","issue_url":"https://api.github.com/repos/apache/brpc/issues/787","id":497622466,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzYyMjQ2Ng==","user":{"login":"scottzzq","id":1217132,"node_id":"MDQ6VXNlcjEyMTcxMzI=","avatar_url":"https://avatars.githubusercontent.com/u/1217132?v=4","gravatar_id":"","url":"https://api.github.com/users/scottzzq","html_url":"https://github.com/scottzzq","followers_url":"https://api.github.com/users/scottzzq/followers","following_url":"https://api.github.com/users/scottzzq/following{/other_user}","gists_url":"https://api.github.com/users/scottzzq/gists{/gist_id}","starred_url":"https://api.github.com/users/scottzzq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottzzq/subscriptions","organizations_url":"https://api.github.com/users/scottzzq/orgs","repos_url":"https://api.github.com/users/scottzzq/repos","events_url":"https://api.github.com/users/scottzzq/events{/privacy}","received_events_url":"https://api.github.com/users/scottzzq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-31T08:22:02Z","updated_at":"2019-05-31T08:22:02Z","author_association":"NONE","body":"https://github.com/apache/incubator-brpc/blob/master/src/brpc/socket.cpp#L693 能不能把这行挪到https://github.com/apache/incubator-brpc/blob/master/src/brpc/socket.cpp#L839这一行的位置，这样可以在健康检查开始之前就把socket注册的可读事件删除掉，这样可能就能避免上面提到的问题，你看这样可行吗 @jamesge ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497622466/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497658901","html_url":"https://github.com/apache/brpc/issues/787#issuecomment-497658901","issue_url":"https://api.github.com/repos/apache/brpc/issues/787","id":497658901,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzY1ODkwMQ==","user":{"login":"scottzzq","id":1217132,"node_id":"MDQ6VXNlcjEyMTcxMzI=","avatar_url":"https://avatars.githubusercontent.com/u/1217132?v=4","gravatar_id":"","url":"https://api.github.com/users/scottzzq","html_url":"https://github.com/scottzzq","followers_url":"https://api.github.com/users/scottzzq/followers","following_url":"https://api.github.com/users/scottzzq/following{/other_user}","gists_url":"https://api.github.com/users/scottzzq/gists{/gist_id}","starred_url":"https://api.github.com/users/scottzzq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottzzq/subscriptions","organizations_url":"https://api.github.com/users/scottzzq/orgs","repos_url":"https://api.github.com/users/scottzzq/repos","events_url":"https://api.github.com/users/scottzzq/events{/privacy}","received_events_url":"https://api.github.com/users/scottzzq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-31T10:20:02Z","updated_at":"2019-05-31T10:20:02Z","author_association":"NONE","body":"通过上面我发的Socket的信息，发现_versioned_ref 分别是3、4294967299，这个数字和0xFFFFFFFFul这个做&运算，结果都是3，说明外部对Socket句柄的引用计数是3，这也就是说在WaitAndReset(2)之后，的确有其他线程对Socket做了一次新的引用。@jamesge ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497658901/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497661349","html_url":"https://github.com/apache/brpc/issues/787#issuecomment-497661349","issue_url":"https://api.github.com/repos/apache/brpc/issues/787","id":497661349,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzY2MTM0OQ==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-31T10:29:13Z","updated_at":"2019-05-31T10:29:13Z","author_association":"CONTRIBUTOR","body":"StartInputEvent里会先address一次，failed之后是address不到的，直接就退了，走不到L1933那里","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497661349/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497661685","html_url":"https://github.com/apache/brpc/issues/787#issuecomment-497661685","issue_url":"https://api.github.com/repos/apache/brpc/issues/787","id":497661685,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzY2MTY4NQ==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-31T10:30:35Z","updated_at":"2019-05-31T10:30:35Z","author_association":"CONTRIBUTOR","body":"做健康检查也会address的，所以WaitAndReset之后引用超过2也是可能的（不过得通过AddressFailedAsWell）","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497661685/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497676321","html_url":"https://github.com/apache/brpc/issues/787#issuecomment-497676321","issue_url":"https://api.github.com/repos/apache/brpc/issues/787","id":497676321,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzY3NjMyMQ==","user":{"login":"scottzzq","id":1217132,"node_id":"MDQ6VXNlcjEyMTcxMzI=","avatar_url":"https://avatars.githubusercontent.com/u/1217132?v=4","gravatar_id":"","url":"https://api.github.com/users/scottzzq","html_url":"https://github.com/scottzzq","followers_url":"https://api.github.com/users/scottzzq/followers","following_url":"https://api.github.com/users/scottzzq/following{/other_user}","gists_url":"https://api.github.com/users/scottzzq/gists{/gist_id}","starred_url":"https://api.github.com/users/scottzzq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottzzq/subscriptions","organizations_url":"https://api.github.com/users/scottzzq/orgs","repos_url":"https://api.github.com/users/scottzzq/repos","events_url":"https://api.github.com/users/scottzzq/events{/privacy}","received_events_url":"https://api.github.com/users/scottzzq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-05-31T11:29:31Z","updated_at":"2019-05-31T11:29:31Z","author_association":"NONE","body":"是的，看代码逻辑的确是这样的，我看注释WaitAndReset(2)的时候不是已经把健康检查持有的句柄算进去了吗？看_hc_count=0，从现象上来看，多出来的引用计数的确是被StartInputEvent里面的Address给占用了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497676321/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497914521","html_url":"https://github.com/apache/brpc/issues/786#issuecomment-497914521","issue_url":"https://api.github.com/repos/apache/brpc/issues/786","id":497914521,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzkxNDUyMQ==","user":{"login":"peiyuanzheng","id":4730528,"node_id":"MDQ6VXNlcjQ3MzA1Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4730528?v=4","gravatar_id":"","url":"https://api.github.com/users/peiyuanzheng","html_url":"https://github.com/peiyuanzheng","followers_url":"https://api.github.com/users/peiyuanzheng/followers","following_url":"https://api.github.com/users/peiyuanzheng/following{/other_user}","gists_url":"https://api.github.com/users/peiyuanzheng/gists{/gist_id}","starred_url":"https://api.github.com/users/peiyuanzheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peiyuanzheng/subscriptions","organizations_url":"https://api.github.com/users/peiyuanzheng/orgs","repos_url":"https://api.github.com/users/peiyuanzheng/repos","events_url":"https://api.github.com/users/peiyuanzheng/events{/privacy}","received_events_url":"https://api.github.com/users/peiyuanzheng/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-01T05:23:28Z","updated_at":"2019-06-01T05:23:28Z","author_association":"NONE","body":"我之前遇到类似的情况，后来定位的原因如下：\r\nrpc_press代码中PressClient::get_output_message() 会用到DynamicMessageFactory，而DynamicMessageFactory::GetPrototype() 有锁。测试过程观察到client的cpu sys 65%，contention截图如下：\r\n![contention](https://user-images.githubusercontent.com/4730528/58744079-de75a900-846f-11e9-9f2b-5ce4c5fafff3.png)\r\n\r\n可能的解决方案：每个client线程单独持有一个DynamicMessageFactory，避免抢锁。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497914521/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497916628","html_url":"https://github.com/apache/brpc/issues/765#issuecomment-497916628","issue_url":"https://api.github.com/repos/apache/brpc/issues/765","id":497916628,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5NzkxNjYyOA==","user":{"login":"peiyuanzheng","id":4730528,"node_id":"MDQ6VXNlcjQ3MzA1Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4730528?v=4","gravatar_id":"","url":"https://api.github.com/users/peiyuanzheng","html_url":"https://github.com/peiyuanzheng","followers_url":"https://api.github.com/users/peiyuanzheng/followers","following_url":"https://api.github.com/users/peiyuanzheng/following{/other_user}","gists_url":"https://api.github.com/users/peiyuanzheng/gists{/gist_id}","starred_url":"https://api.github.com/users/peiyuanzheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peiyuanzheng/subscriptions","organizations_url":"https://api.github.com/users/peiyuanzheng/orgs","repos_url":"https://api.github.com/users/peiyuanzheng/repos","events_url":"https://api.github.com/users/peiyuanzheng/events{/privacy}","received_events_url":"https://api.github.com/users/peiyuanzheng/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-01T06:03:16Z","updated_at":"2019-06-01T06:03:16Z","author_association":"NONE","body":"我们也遇到同样的问题，解决方法是在自己的应用代码中，把metrics name 和 label 拼接成bvar，然后提供一个给Prometheus查询的服务，解析bvar回metrics name 和label。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/497916628/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498099731","html_url":"https://github.com/apache/brpc/issues/765#issuecomment-498099731","issue_url":"https://api.github.com/repos/apache/brpc/issues/765","id":498099731,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODA5OTczMQ==","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-03T03:19:45Z","updated_at":"2019-06-03T03:19:45Z","author_association":"MEMBER","body":"目前brpc内部统计的metric用gauge和summary就足够了，所以只输出了gauge和summary。如果需要用label来输出业务的统计数据，建议用Prometheus官方提供的cpp client","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498099731/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498138358","html_url":"https://github.com/apache/brpc/issues/697#issuecomment-498138358","issue_url":"https://api.github.com/repos/apache/brpc/issues/697","id":498138358,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODEzODM1OA==","user":{"login":"cuisonghui","id":8772285,"node_id":"MDQ6VXNlcjg3NzIyODU=","avatar_url":"https://avatars.githubusercontent.com/u/8772285?v=4","gravatar_id":"","url":"https://api.github.com/users/cuisonghui","html_url":"https://github.com/cuisonghui","followers_url":"https://api.github.com/users/cuisonghui/followers","following_url":"https://api.github.com/users/cuisonghui/following{/other_user}","gists_url":"https://api.github.com/users/cuisonghui/gists{/gist_id}","starred_url":"https://api.github.com/users/cuisonghui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cuisonghui/subscriptions","organizations_url":"https://api.github.com/users/cuisonghui/orgs","repos_url":"https://api.github.com/users/cuisonghui/repos","events_url":"https://api.github.com/users/cuisonghui/events{/privacy}","received_events_url":"https://api.github.com/users/cuisonghui/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-03T07:06:41Z","updated_at":"2019-06-03T07:08:10Z","author_association":"NONE","body":"目前brpc已经成功运行在生产环境，运行稳定且符合预期，以上问题都得到解决，谢谢。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498138358/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498198585","html_url":"https://github.com/apache/brpc/issues/697#issuecomment-498198585","issue_url":"https://api.github.com/repos/apache/brpc/issues/697","id":498198585,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODE5ODU4NQ==","user":{"login":"tanzhongyi003","id":20179982,"node_id":"MDQ6VXNlcjIwMTc5OTgy","avatar_url":"https://avatars.githubusercontent.com/u/20179982?v=4","gravatar_id":"","url":"https://api.github.com/users/tanzhongyi003","html_url":"https://github.com/tanzhongyi003","followers_url":"https://api.github.com/users/tanzhongyi003/followers","following_url":"https://api.github.com/users/tanzhongyi003/following{/other_user}","gists_url":"https://api.github.com/users/tanzhongyi003/gists{/gist_id}","starred_url":"https://api.github.com/users/tanzhongyi003/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tanzhongyi003/subscriptions","organizations_url":"https://api.github.com/users/tanzhongyi003/orgs","repos_url":"https://api.github.com/users/tanzhongyi003/repos","events_url":"https://api.github.com/users/tanzhongyi003/events{/privacy}","received_events_url":"https://api.github.com/users/tanzhongyi003/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-03T10:15:31Z","updated_at":"2019-06-03T10:15:31Z","author_association":"MEMBER","body":"BTW： cuisonghui， which company are you working for？ so we know that brpc has added another users.thanks","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498198585/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498217851","html_url":"https://github.com/apache/brpc/issues/767#issuecomment-498217851","issue_url":"https://api.github.com/repos/apache/brpc/issues/767","id":498217851,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODIxNzg1MQ==","user":{"login":"account-login","id":9835862,"node_id":"MDQ6VXNlcjk4MzU4NjI=","avatar_url":"https://avatars.githubusercontent.com/u/9835862?v=4","gravatar_id":"","url":"https://api.github.com/users/account-login","html_url":"https://github.com/account-login","followers_url":"https://api.github.com/users/account-login/followers","following_url":"https://api.github.com/users/account-login/following{/other_user}","gists_url":"https://api.github.com/users/account-login/gists{/gist_id}","starred_url":"https://api.github.com/users/account-login/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/account-login/subscriptions","organizations_url":"https://api.github.com/users/account-login/orgs","repos_url":"https://api.github.com/users/account-login/repos","events_url":"https://api.github.com/users/account-login/events{/privacy}","received_events_url":"https://api.github.com/users/account-login/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-03T11:23:31Z","updated_at":"2019-06-03T11:23:31Z","author_association":"NONE","body":"200ms 可能是 tcp 重发的时间。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498217851/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498493139","html_url":"https://github.com/apache/brpc/pull/766#issuecomment-498493139","issue_url":"https://api.github.com/repos/apache/brpc/issues/766","id":498493139,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODQ5MzEzOQ==","user":{"login":"GardianT","id":38547380,"node_id":"MDQ6VXNlcjM4NTQ3Mzgw","avatar_url":"https://avatars.githubusercontent.com/u/38547380?v=4","gravatar_id":"","url":"https://api.github.com/users/GardianT","html_url":"https://github.com/GardianT","followers_url":"https://api.github.com/users/GardianT/followers","following_url":"https://api.github.com/users/GardianT/following{/other_user}","gists_url":"https://api.github.com/users/GardianT/gists{/gist_id}","starred_url":"https://api.github.com/users/GardianT/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GardianT/subscriptions","organizations_url":"https://api.github.com/users/GardianT/orgs","repos_url":"https://api.github.com/users/GardianT/repos","events_url":"https://api.github.com/users/GardianT/events{/privacy}","received_events_url":"https://api.github.com/users/GardianT/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-04T02:18:47Z","updated_at":"2019-06-04T02:18:47Z","author_association":"NONE","body":"问下这个fix是ok的么？预计什么时候会merge？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498493139/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498515674","html_url":"https://github.com/apache/brpc/issues/787#issuecomment-498515674","issue_url":"https://api.github.com/repos/apache/brpc/issues/787","id":498515674,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODUxNTY3NA==","user":{"login":"scottzzq","id":1217132,"node_id":"MDQ6VXNlcjEyMTcxMzI=","avatar_url":"https://avatars.githubusercontent.com/u/1217132?v=4","gravatar_id":"","url":"https://api.github.com/users/scottzzq","html_url":"https://github.com/scottzzq","followers_url":"https://api.github.com/users/scottzzq/followers","following_url":"https://api.github.com/users/scottzzq/following{/other_user}","gists_url":"https://api.github.com/users/scottzzq/gists{/gist_id}","starred_url":"https://api.github.com/users/scottzzq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottzzq/subscriptions","organizations_url":"https://api.github.com/users/scottzzq/orgs","repos_url":"https://api.github.com/users/scottzzq/repos","events_url":"https://api.github.com/users/scottzzq/events{/privacy}","received_events_url":"https://api.github.com/users/scottzzq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-04T04:23:05Z","updated_at":"2019-06-04T04:23:05Z","author_association":"NONE","body":"@jamesge  这几天仔细看代码，线下做了多次尝试，今天终于复现出来了。原因如下：EventDispatch线程在某一次epoll_wait返回之后得到可读fd列表，之后依次调用fd的StartInputEvent函数，在执行比较慢的情况下(cpu非常繁忙)，假设某一个Socket还没有进入到StartInputEvent函数，此时别的线程调用了这个Socket的SetFailed函数，之后启动健康检查，之后新建连接成功，健康检查结果正常，调用了Socket的Revive函数，但是还没有调用ResetFileDescriptor，这个时候通过SocketId调用Address已经可以成功了，这个时候刚好又进入Socket的StartInputEvent，此时就会遇到fd=-1","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498515674/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498545779","html_url":"https://github.com/apache/brpc/issues/787#issuecomment-498545779","issue_url":"https://api.github.com/repos/apache/brpc/issues/787","id":498545779,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODU0NTc3OQ==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-04T06:54:17Z","updated_at":"2019-06-04T06:54:17Z","author_association":"CONTRIBUTOR","body":"多谢详细的解释，看起来只要去掉EventDispatcher中的CHECK就解决问题了？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498545779/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498549057","html_url":"https://github.com/apache/brpc/issues/787#issuecomment-498549057","issue_url":"https://api.github.com/repos/apache/brpc/issues/787","id":498549057,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODU0OTA1Nw==","user":{"login":"scottzzq","id":1217132,"node_id":"MDQ6VXNlcjEyMTcxMzI=","avatar_url":"https://avatars.githubusercontent.com/u/1217132?v=4","gravatar_id":"","url":"https://api.github.com/users/scottzzq","html_url":"https://github.com/scottzzq","followers_url":"https://api.github.com/users/scottzzq/followers","following_url":"https://api.github.com/users/scottzzq/following{/other_user}","gists_url":"https://api.github.com/users/scottzzq/gists{/gist_id}","starred_url":"https://api.github.com/users/scottzzq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottzzq/subscriptions","organizations_url":"https://api.github.com/users/scottzzq/orgs","repos_url":"https://api.github.com/users/scottzzq/repos","events_url":"https://api.github.com/users/scottzzq/events{/privacy}","received_events_url":"https://api.github.com/users/scottzzq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-04T07:06:25Z","updated_at":"2019-06-04T07:06:25Z","author_association":"NONE","body":"去掉的确不会core掉了，我还在确认下有没有其他副作用，比如能预料到的一个case就是，如果EventDistapch执行有延迟，如果刚好调用了ResetFileDescriptor之后，再调用StartInputEvent，这个时候时候fd就是合法的了，但是如果此时fd上并没有可读事件，仍然会触发一次InputMessenger::OnNewMessages，只要这个函数可以兼容这种情况，应该就没啥问题了 @jamesge ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498549057/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498549708","html_url":"https://github.com/apache/brpc/issues/787#issuecomment-498549708","issue_url":"https://api.github.com/repos/apache/brpc/issues/787","id":498549708,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODU0OTcwOA==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-04T07:08:34Z","updated_at":"2019-06-04T07:08:34Z","author_association":"CONTRIBUTOR","body":"这个不要紧，消息通知出现\"假阳性\"的后果只是白读了而已。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498549708/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498642766","html_url":"https://github.com/apache/brpc/issues/793#issuecomment-498642766","issue_url":"https://api.github.com/repos/apache/brpc/issues/793","id":498642766,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODY0Mjc2Ng==","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-04T12:03:53Z","updated_at":"2019-06-04T12:03:53Z","author_association":"MEMBER","body":"There is no demand for this feature any more.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498642766/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498925372","html_url":"https://github.com/apache/brpc/issues/779#issuecomment-498925372","issue_url":"https://api.github.com/repos/apache/brpc/issues/779","id":498925372,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODkyNTM3Mg==","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-05T03:29:14Z","updated_at":"2019-06-05T03:29:14Z","author_association":"CONTRIBUTOR","body":"我理解tcp的client和server通讯，总归需要定义一种通信的协议，所以如果现有的比较通用的协议都不是你想要的，你可以实现你的私有协议。另外用protobuf定义协议很方便啊","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498925372/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498952404","html_url":"https://github.com/apache/brpc/issues/786#issuecomment-498952404","issue_url":"https://api.github.com/repos/apache/brpc/issues/786","id":498952404,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODk1MjQwNA==","user":{"login":"Ye-Tian-Zero","id":8231208,"node_id":"MDQ6VXNlcjgyMzEyMDg=","avatar_url":"https://avatars.githubusercontent.com/u/8231208?v=4","gravatar_id":"","url":"https://api.github.com/users/Ye-Tian-Zero","html_url":"https://github.com/Ye-Tian-Zero","followers_url":"https://api.github.com/users/Ye-Tian-Zero/followers","following_url":"https://api.github.com/users/Ye-Tian-Zero/following{/other_user}","gists_url":"https://api.github.com/users/Ye-Tian-Zero/gists{/gist_id}","starred_url":"https://api.github.com/users/Ye-Tian-Zero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ye-Tian-Zero/subscriptions","organizations_url":"https://api.github.com/users/Ye-Tian-Zero/orgs","repos_url":"https://api.github.com/users/Ye-Tian-Zero/repos","events_url":"https://api.github.com/users/Ye-Tian-Zero/events{/privacy}","received_events_url":"https://api.github.com/users/Ye-Tian-Zero/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-05T06:14:02Z","updated_at":"2019-06-05T06:14:02Z","author_association":"CONTRIBUTOR","body":"谢谢，后续我有空试一下这个解法，再同步","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498952404/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498952781","html_url":"https://github.com/apache/brpc/issues/796#issuecomment-498952781","issue_url":"https://api.github.com/repos/apache/brpc/issues/796","id":498952781,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODk1Mjc4MQ==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-05T06:15:53Z","updated_at":"2019-06-05T06:15:53Z","author_association":"CONTRIBUTOR","body":"上限有两种：一种是内存放不下了，这是不存在的，因为adder只会存累加后结果；另一种是overflow了，如果类型宽度太小，确实有这个可能，那就换一个更宽的类型。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498952781/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498985411","html_url":"https://github.com/apache/brpc/issues/779#issuecomment-498985411","issue_url":"https://api.github.com/repos/apache/brpc/issues/779","id":498985411,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODk4NTQxMQ==","user":{"login":"ipconfigme","id":2500750,"node_id":"MDQ6VXNlcjI1MDA3NTA=","avatar_url":"https://avatars.githubusercontent.com/u/2500750?v=4","gravatar_id":"","url":"https://api.github.com/users/ipconfigme","html_url":"https://github.com/ipconfigme","followers_url":"https://api.github.com/users/ipconfigme/followers","following_url":"https://api.github.com/users/ipconfigme/following{/other_user}","gists_url":"https://api.github.com/users/ipconfigme/gists{/gist_id}","starred_url":"https://api.github.com/users/ipconfigme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ipconfigme/subscriptions","organizations_url":"https://api.github.com/users/ipconfigme/orgs","repos_url":"https://api.github.com/users/ipconfigme/repos","events_url":"https://api.github.com/users/ipconfigme/events{/privacy}","received_events_url":"https://api.github.com/users/ipconfigme/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-05T08:17:08Z","updated_at":"2019-06-05T08:17:08Z","author_association":"CONTRIBUTOR","body":"可以尝试定制protocol，也可以考虑用bthread/unstable.h中的bthread_xxx的类socket接口","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498985411/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498986926","html_url":"https://github.com/apache/brpc/issues/712#issuecomment-498986926","issue_url":"https://api.github.com/repos/apache/brpc/issues/712","id":498986926,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5ODk4NjkyNg==","user":{"login":"ipconfigme","id":2500750,"node_id":"MDQ6VXNlcjI1MDA3NTA=","avatar_url":"https://avatars.githubusercontent.com/u/2500750?v=4","gravatar_id":"","url":"https://api.github.com/users/ipconfigme","html_url":"https://github.com/ipconfigme","followers_url":"https://api.github.com/users/ipconfigme/followers","following_url":"https://api.github.com/users/ipconfigme/following{/other_user}","gists_url":"https://api.github.com/users/ipconfigme/gists{/gist_id}","starred_url":"https://api.github.com/users/ipconfigme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ipconfigme/subscriptions","organizations_url":"https://api.github.com/users/ipconfigme/orgs","repos_url":"https://api.github.com/users/ipconfigme/repos","events_url":"https://api.github.com/users/ipconfigme/events{/privacy}","received_events_url":"https://api.github.com/users/ipconfigme/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-05T08:21:58Z","updated_at":"2019-06-05T08:27:17Z","author_association":"CONTRIBUTOR","body":"建议设置ServerOptions.idle_timeout_sec为7200，有时候连接会出现一端是ESTABLISHED，一端已经断开了，这个时候ESTABLISHED端的IOBuf就会leak","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/498986926/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/499088684","html_url":"https://github.com/apache/brpc/issues/787#issuecomment-499088684","issue_url":"https://api.github.com/repos/apache/brpc/issues/787","id":499088684,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTA4ODY4NA==","user":{"login":"scottzzq","id":1217132,"node_id":"MDQ6VXNlcjEyMTcxMzI=","avatar_url":"https://avatars.githubusercontent.com/u/1217132?v=4","gravatar_id":"","url":"https://api.github.com/users/scottzzq","html_url":"https://github.com/scottzzq","followers_url":"https://api.github.com/users/scottzzq/followers","following_url":"https://api.github.com/users/scottzzq/following{/other_user}","gists_url":"https://api.github.com/users/scottzzq/gists{/gist_id}","starred_url":"https://api.github.com/users/scottzzq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottzzq/subscriptions","organizations_url":"https://api.github.com/users/scottzzq/orgs","repos_url":"https://api.github.com/users/scottzzq/repos","events_url":"https://api.github.com/users/scottzzq/events{/privacy}","received_events_url":"https://api.github.com/users/scottzzq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-05T13:44:01Z","updated_at":"2019-06-05T13:44:52Z","author_association":"NONE","body":"@jamesge  又出现一个新问题，在遇到EFAILEDSOCKET错误的时候，brpc默认会做重试，按照时间序一次发生下列事件：\r\nIssueRPC: _current_call.nretry:0, _correlation_id:57144539873281, cid:57144539873282, _current_call.nretry:0, remote_side:A:port\r\nIssueRPC:  _current_call.nretry:1, _correlation_id:57144539873281, cid:57144539873283, _current_call.nretry:1, remote_side:B:port\r\nIssueRPC: _current_call.nretry:2, _correlation_id:57144539873281, cid:57144539873284, _current_call.nretry:2, remote_side:C:port\r\n\r\nEndRPC: error_code:0,info.id:57144539873283, current_id:57144539873284, _correlation_id:57144539873281, _current_call.nretry:2\r\n\r\n这种情况下brpc仍然会打印FATAL并且coredump，原因就是 https://github.com/apache/incubator-brpc/blob/master/src/brpc/controller.cpp#L798 这一行判断失败，问下这块能否改成  info.id <= current_id() && info.id >= _correlation_id？ 多谢了！","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/499088684/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/499323967","html_url":"https://github.com/apache/brpc/issues/796#issuecomment-499323967","issue_url":"https://api.github.com/repos/apache/brpc/issues/796","id":499323967,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTMyMzk2Nw==","user":{"login":"chyxyjh","id":15868192,"node_id":"MDQ6VXNlcjE1ODY4MTky","avatar_url":"https://avatars.githubusercontent.com/u/15868192?v=4","gravatar_id":"","url":"https://api.github.com/users/chyxyjh","html_url":"https://github.com/chyxyjh","followers_url":"https://api.github.com/users/chyxyjh/followers","following_url":"https://api.github.com/users/chyxyjh/following{/other_user}","gists_url":"https://api.github.com/users/chyxyjh/gists{/gist_id}","starred_url":"https://api.github.com/users/chyxyjh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chyxyjh/subscriptions","organizations_url":"https://api.github.com/users/chyxyjh/orgs","repos_url":"https://api.github.com/users/chyxyjh/repos","events_url":"https://api.github.com/users/chyxyjh/events{/privacy}","received_events_url":"https://api.github.com/users/chyxyjh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-06T02:25:34Z","updated_at":"2019-06-06T11:37:01Z","author_association":"NONE","body":"上限的第二种，overflow，我个人理解是，如定义了`Adder<int> request_adder`，那么其最大存储便只有2*10^9左右，随着程序的运行，`request_adder`不断累加，便可能发生overflow，请问理解是否正确？\r\n如果正确的话，overflow的结果只会导致累加结果错误是吗，比如当前`request_adder`累加到了2147483647，之后`request_adder << 1;`，`request_adder`中存储的值便因overflow被计算为-2147483648。\r\n感谢支持","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/499323967/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/499474217","html_url":"https://github.com/apache/brpc/issues/796#issuecomment-499474217","issue_url":"https://api.github.com/repos/apache/brpc/issues/796","id":499474217,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTQ3NDIxNw==","user":{"login":"chenzhangyi","id":6805583,"node_id":"MDQ6VXNlcjY4MDU1ODM=","avatar_url":"https://avatars.githubusercontent.com/u/6805583?v=4","gravatar_id":"","url":"https://api.github.com/users/chenzhangyi","html_url":"https://github.com/chenzhangyi","followers_url":"https://api.github.com/users/chenzhangyi/followers","following_url":"https://api.github.com/users/chenzhangyi/following{/other_user}","gists_url":"https://api.github.com/users/chenzhangyi/gists{/gist_id}","starred_url":"https://api.github.com/users/chenzhangyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenzhangyi/subscriptions","organizations_url":"https://api.github.com/users/chenzhangyi/orgs","repos_url":"https://api.github.com/users/chenzhangyi/repos","events_url":"https://api.github.com/users/chenzhangyi/events{/privacy}","received_events_url":"https://api.github.com/users/chenzhangyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-06T12:32:04Z","updated_at":"2019-06-06T12:32:04Z","author_association":"MEMBER","body":"会，如果没有特殊的考虑， 建议定义Adder<int64_t>, 基本上不会有overflow的问题.\r\n如果需要看一段时间的累加值，可以套上Window, 这个即使Adder本身溢出了，只要时间跨度不太夸张，结果也是准确的","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/499474217/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/499749041","html_url":"https://github.com/apache/brpc/pull/723#issuecomment-499749041","issue_url":"https://api.github.com/repos/apache/brpc/issues/723","id":499749041,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTc0OTA0MQ==","user":{"login":"wenweihu86","id":2144079,"node_id":"MDQ6VXNlcjIxNDQwNzk=","avatar_url":"https://avatars.githubusercontent.com/u/2144079?v=4","gravatar_id":"","url":"https://api.github.com/users/wenweihu86","html_url":"https://github.com/wenweihu86","followers_url":"https://api.github.com/users/wenweihu86/followers","following_url":"https://api.github.com/users/wenweihu86/following{/other_user}","gists_url":"https://api.github.com/users/wenweihu86/gists{/gist_id}","starred_url":"https://api.github.com/users/wenweihu86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wenweihu86/subscriptions","organizations_url":"https://api.github.com/users/wenweihu86/orgs","repos_url":"https://api.github.com/users/wenweihu86/repos","events_url":"https://api.github.com/users/wenweihu86/events{/privacy}","received_events_url":"https://api.github.com/users/wenweihu86/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-07T04:01:30Z","updated_at":"2019-06-07T04:01:30Z","author_association":"CONTRIBUTOR","body":"@jamesge master版本还是会找不到openssl，把搜索路径改成/usr/local后，可以解决，我更新了pull request。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/499749041/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/499930809","html_url":"https://github.com/apache/brpc/issues/735#issuecomment-499930809","issue_url":"https://api.github.com/repos/apache/brpc/issues/735","id":499930809,"node_id":"MDEyOklzc3VlQ29tbWVudDQ5OTkzMDgwOQ==","user":{"login":"wenweihu86","id":2144079,"node_id":"MDQ6VXNlcjIxNDQwNzk=","avatar_url":"https://avatars.githubusercontent.com/u/2144079?v=4","gravatar_id":"","url":"https://api.github.com/users/wenweihu86","html_url":"https://github.com/wenweihu86","followers_url":"https://api.github.com/users/wenweihu86/followers","following_url":"https://api.github.com/users/wenweihu86/following{/other_user}","gists_url":"https://api.github.com/users/wenweihu86/gists{/gist_id}","starred_url":"https://api.github.com/users/wenweihu86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wenweihu86/subscriptions","organizations_url":"https://api.github.com/users/wenweihu86/orgs","repos_url":"https://api.github.com/users/wenweihu86/repos","events_url":"https://api.github.com/users/wenweihu86/events{/privacy}","received_events_url":"https://api.github.com/users/wenweihu86/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-07T15:29:50Z","updated_at":"2019-06-07T15:29:50Z","author_association":"CONTRIBUTOR","body":"@darrenwang00 you can try brpc-java, may be useful for you. \r\nhttps://github.com/baidu/brpc-java","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/499930809/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/500281028","html_url":"https://github.com/apache/brpc/issues/798#issuecomment-500281028","issue_url":"https://api.github.com/repos/apache/brpc/issues/798","id":500281028,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDI4MTAyOA==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-10T03:35:40Z","updated_at":"2019-06-10T03:35:40Z","author_association":"CONTRIBUTOR","body":"bvar的作用就是记录当前值供监控系统搜集，不会向用户暴露历史值。\"自有的一些有历史记录和图表的var\"只是为了方面用户调试问题，且并不限定于PassiveStatus。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/500281028/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/500282556","html_url":"https://github.com/apache/brpc/issues/798#issuecomment-500282556","issue_url":"https://api.github.com/repos/apache/brpc/issues/798","id":500282556,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDI4MjU1Ng==","user":{"login":"ShinanWu","id":32710924,"node_id":"MDQ6VXNlcjMyNzEwOTI0","avatar_url":"https://avatars.githubusercontent.com/u/32710924?v=4","gravatar_id":"","url":"https://api.github.com/users/ShinanWu","html_url":"https://github.com/ShinanWu","followers_url":"https://api.github.com/users/ShinanWu/followers","following_url":"https://api.github.com/users/ShinanWu/following{/other_user}","gists_url":"https://api.github.com/users/ShinanWu/gists{/gist_id}","starred_url":"https://api.github.com/users/ShinanWu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ShinanWu/subscriptions","organizations_url":"https://api.github.com/users/ShinanWu/orgs","repos_url":"https://api.github.com/users/ShinanWu/repos","events_url":"https://api.github.com/users/ShinanWu/events{/privacy}","received_events_url":"https://api.github.com/users/ShinanWu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-10T03:46:56Z","updated_at":"2019-06-10T03:47:57Z","author_association":"NONE","body":"多谢回复~\r\n那如果希望Status也可以方便的调试问题（图表显示变化），需要怎么做呢，有参考的demo吗?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/500282556/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/500289817","html_url":"https://github.com/apache/brpc/issues/798#issuecomment-500289817","issue_url":"https://api.github.com/repos/apache/brpc/issues/798","id":500289817,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDI4OTgxNw==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-10T04:42:38Z","updated_at":"2019-06-10T04:42:38Z","author_association":"CONTRIBUTOR","body":"master head中数字型Status会出现历史曲线。不过一般来说服务中关注的都是累加值，会用其他带reduce语意的bvar，bvar::Status几乎用不到，所以这里你可能也要看下是否其他bvar能更好地满足需求。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/500289817/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/500668581","html_url":"https://github.com/apache/brpc/issues/636#issuecomment-500668581","issue_url":"https://api.github.com/repos/apache/brpc/issues/636","id":500668581,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDY2ODU4MQ==","user":{"login":"hongbshi","id":42710460,"node_id":"MDQ6VXNlcjQyNzEwNDYw","avatar_url":"https://avatars.githubusercontent.com/u/42710460?v=4","gravatar_id":"","url":"https://api.github.com/users/hongbshi","html_url":"https://github.com/hongbshi","followers_url":"https://api.github.com/users/hongbshi/followers","following_url":"https://api.github.com/users/hongbshi/following{/other_user}","gists_url":"https://api.github.com/users/hongbshi/gists{/gist_id}","starred_url":"https://api.github.com/users/hongbshi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hongbshi/subscriptions","organizations_url":"https://api.github.com/users/hongbshi/orgs","repos_url":"https://api.github.com/users/hongbshi/repos","events_url":"https://api.github.com/users/hongbshi/events{/privacy}","received_events_url":"https://api.github.com/users/hongbshi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-11T03:01:08Z","updated_at":"2019-06-11T03:01:08Z","author_association":"NONE","body":"我现在也在找brpc server端如何主动关闭连接, 想问下具体是在哪一块？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/500668581/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/500679359","html_url":"https://github.com/apache/brpc/issues/799#issuecomment-500679359","issue_url":"https://api.github.com/repos/apache/brpc/issues/799","id":500679359,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDY3OTM1OQ==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-11T04:10:44Z","updated_at":"2019-06-11T04:10:44Z","author_association":"CONTRIBUTOR","body":"这个不是bug，L596处是backup request的逻辑，对应的_current_call移入了_unfinished_call，而L617处直接结束_current_call了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/500679359/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/500688843","html_url":"https://github.com/apache/brpc/issues/799#issuecomment-500688843","issue_url":"https://api.github.com/repos/apache/brpc/issues/799","id":500688843,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMDY4ODg0Mw==","user":{"login":"scottzzq","id":1217132,"node_id":"MDQ6VXNlcjEyMTcxMzI=","avatar_url":"https://avatars.githubusercontent.com/u/1217132?v=4","gravatar_id":"","url":"https://api.github.com/users/scottzzq","html_url":"https://github.com/scottzzq","followers_url":"https://api.github.com/users/scottzzq/followers","following_url":"https://api.github.com/users/scottzzq/following{/other_user}","gists_url":"https://api.github.com/users/scottzzq/gists{/gist_id}","starred_url":"https://api.github.com/users/scottzzq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scottzzq/subscriptions","organizations_url":"https://api.github.com/users/scottzzq/orgs","repos_url":"https://api.github.com/users/scottzzq/repos","events_url":"https://api.github.com/users/scottzzq/events{/privacy}","received_events_url":"https://api.github.com/users/scottzzq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-11T05:10:26Z","updated_at":"2019-06-11T10:59:07Z","author_association":"NONE","body":"https://github.com/apache/incubator-brpc/blob/master/src/brpc/controller.cpp#L826 但是执行了这一行会挂掉，这个怎么解决呢？可以直接注释掉吗 @jamesge ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/500688843/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/501335856","html_url":"https://github.com/apache/brpc/issues/639#issuecomment-501335856","issue_url":"https://api.github.com/repos/apache/brpc/issues/639","id":501335856,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMTMzNTg1Ng==","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-12T15:50:13Z","updated_at":"2019-06-12T15:50:13Z","author_association":"CONTRIBUTOR","body":"@yjhjstz 所有的堆栈都能找着，回溯有什么办法吗，改寄存器只能attach到进程才能改，core文件好像没办法","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/501335856/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/501613664","html_url":"https://github.com/apache/brpc/issues/801#issuecomment-501613664","issue_url":"https://api.github.com/repos/apache/brpc/issues/801","id":501613664,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMTYxMzY2NA==","user":{"login":"Ye-Tian-Zero","id":8231208,"node_id":"MDQ6VXNlcjgyMzEyMDg=","avatar_url":"https://avatars.githubusercontent.com/u/8231208?v=4","gravatar_id":"","url":"https://api.github.com/users/Ye-Tian-Zero","html_url":"https://github.com/Ye-Tian-Zero","followers_url":"https://api.github.com/users/Ye-Tian-Zero/followers","following_url":"https://api.github.com/users/Ye-Tian-Zero/following{/other_user}","gists_url":"https://api.github.com/users/Ye-Tian-Zero/gists{/gist_id}","starred_url":"https://api.github.com/users/Ye-Tian-Zero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ye-Tian-Zero/subscriptions","organizations_url":"https://api.github.com/users/Ye-Tian-Zero/orgs","repos_url":"https://api.github.com/users/Ye-Tian-Zero/repos","events_url":"https://api.github.com/users/Ye-Tian-Zero/events{/privacy}","received_events_url":"https://api.github.com/users/Ye-Tian-Zero/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-13T08:55:28Z","updated_at":"2019-06-13T08:56:05Z","author_association":"CONTRIBUTOR","body":"这块儿确实有点复杂，但是一个简单的指针没法满足需求。\r\n考虑 RPC 超时的场景下，这个指针在用户回调执行后就被销毁了。\r\n所以至少得有一个 Global 的东西来记录目前已经创建的指针，来达到类似 weak_ptr 的效果。\r\n同时还要解决 ABA 的问题，请求超时->用户销毁 controller -> 用户创建新的 controller 发起新的请求\r\n这个过程中后创建的 controller 的address 很可能和已经销毁的是相同的，那么就会错误的处理已经超时的请求的 response。\r\n\r\n这么最后搞吧搞吧，搞出来跟现在估计也差不多了。\r\n\r\n个人理解，欢迎指正","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/501613664/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/501950938","html_url":"https://github.com/apache/brpc/issues/801#issuecomment-501950938","issue_url":"https://api.github.com/repos/apache/brpc/issues/801","id":501950938,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMTk1MDkzOA==","user":{"login":"zhuchong0329","id":9687347,"node_id":"MDQ6VXNlcjk2ODczNDc=","avatar_url":"https://avatars.githubusercontent.com/u/9687347?v=4","gravatar_id":"","url":"https://api.github.com/users/zhuchong0329","html_url":"https://github.com/zhuchong0329","followers_url":"https://api.github.com/users/zhuchong0329/followers","following_url":"https://api.github.com/users/zhuchong0329/following{/other_user}","gists_url":"https://api.github.com/users/zhuchong0329/gists{/gist_id}","starred_url":"https://api.github.com/users/zhuchong0329/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhuchong0329/subscriptions","organizations_url":"https://api.github.com/users/zhuchong0329/orgs","repos_url":"https://api.github.com/users/zhuchong0329/repos","events_url":"https://api.github.com/users/zhuchong0329/events{/privacy}","received_events_url":"https://api.github.com/users/zhuchong0329/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-14T03:06:17Z","updated_at":"2019-06-14T03:06:17Z","author_association":"NONE","body":"有道理，还要解决ABA的问题，感谢解答。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/501950938/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/502621999","html_url":"https://github.com/apache/brpc/issues/809#issuecomment-502621999","issue_url":"https://api.github.com/repos/apache/brpc/issues/809","id":502621999,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMjYyMTk5OQ==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-17T10:11:10Z","updated_at":"2019-06-17T10:11:10Z","author_association":"CONTRIBUTOR","body":"这个看上去是BNS SDK的问题。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/502621999/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/502633763","html_url":"https://github.com/apache/brpc/issues/809#issuecomment-502633763","issue_url":"https://api.github.com/repos/apache/brpc/issues/809","id":502633763,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMjYzMzc2Mw==","user":{"login":"Tsrign","id":10807479,"node_id":"MDQ6VXNlcjEwODA3NDc5","avatar_url":"https://avatars.githubusercontent.com/u/10807479?v=4","gravatar_id":"","url":"https://api.github.com/users/Tsrign","html_url":"https://github.com/Tsrign","followers_url":"https://api.github.com/users/Tsrign/followers","following_url":"https://api.github.com/users/Tsrign/following{/other_user}","gists_url":"https://api.github.com/users/Tsrign/gists{/gist_id}","starred_url":"https://api.github.com/users/Tsrign/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tsrign/subscriptions","organizations_url":"https://api.github.com/users/Tsrign/orgs","repos_url":"https://api.github.com/users/Tsrign/repos","events_url":"https://api.github.com/users/Tsrign/events{/privacy}","received_events_url":"https://api.github.com/users/Tsrign/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-17T10:51:25Z","updated_at":"2019-06-17T10:53:11Z","author_association":"NONE","body":"查看BNS SDK，发现其通过单例模式在.bss 段注册了一个 LruCache 实例， 想了解下， brpc当 server.stop && server.join 结束时，主线程退出，全局变量析构的过程中， NamingServiceThread是否还可能在 period run， 是否可能存在线程安全问题。\r\n\r\n我目前通过调大 Flag_ns_access_interval 可以有效降低出 core 概率。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/502633763/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/502634399","html_url":"https://github.com/apache/brpc/issues/809#issuecomment-502634399","issue_url":"https://api.github.com/repos/apache/brpc/issues/809","id":502634399,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMjYzNDM5OQ==","user":{"login":"Ye-Tian-Zero","id":8231208,"node_id":"MDQ6VXNlcjgyMzEyMDg=","avatar_url":"https://avatars.githubusercontent.com/u/8231208?v=4","gravatar_id":"","url":"https://api.github.com/users/Ye-Tian-Zero","html_url":"https://github.com/Ye-Tian-Zero","followers_url":"https://api.github.com/users/Ye-Tian-Zero/followers","following_url":"https://api.github.com/users/Ye-Tian-Zero/following{/other_user}","gists_url":"https://api.github.com/users/Ye-Tian-Zero/gists{/gist_id}","starred_url":"https://api.github.com/users/Ye-Tian-Zero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ye-Tian-Zero/subscriptions","organizations_url":"https://api.github.com/users/Ye-Tian-Zero/orgs","repos_url":"https://api.github.com/users/Ye-Tian-Zero/repos","events_url":"https://api.github.com/users/Ye-Tian-Zero/events{/privacy}","received_events_url":"https://api.github.com/users/Ye-Tian-Zero/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-17T10:53:44Z","updated_at":"2019-06-17T10:53:44Z","author_association":"CONTRIBUTOR","body":"server.join 也不会停掉主线程吧？。。。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/502634399/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/502635156","html_url":"https://github.com/apache/brpc/issues/809#issuecomment-502635156","issue_url":"https://api.github.com/repos/apache/brpc/issues/809","id":502635156,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMjYzNTE1Ng==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-17T10:56:30Z","updated_at":"2019-06-17T10:56:30Z","author_association":"CONTRIBUTOR","body":"这个大概是因为bns中使用了一些会在程序退出时析构的static变量，作为一个lib，一般来说是要能正确地处理在main函数之前或之后运行的问题的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/502635156/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/502640791","html_url":"https://github.com/apache/brpc/issues/809#issuecomment-502640791","issue_url":"https://api.github.com/repos/apache/brpc/issues/809","id":502640791,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMjY0MDc5MQ==","user":{"login":"Tsrign","id":10807479,"node_id":"MDQ6VXNlcjEwODA3NDc5","avatar_url":"https://avatars.githubusercontent.com/u/10807479?v=4","gravatar_id":"","url":"https://api.github.com/users/Tsrign","html_url":"https://github.com/Tsrign","followers_url":"https://api.github.com/users/Tsrign/followers","following_url":"https://api.github.com/users/Tsrign/following{/other_user}","gists_url":"https://api.github.com/users/Tsrign/gists{/gist_id}","starred_url":"https://api.github.com/users/Tsrign/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tsrign/subscriptions","organizations_url":"https://api.github.com/users/Tsrign/orgs","repos_url":"https://api.github.com/users/Tsrign/repos","events_url":"https://api.github.com/users/Tsrign/events{/privacy}","received_events_url":"https://api.github.com/users/Tsrign/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-17T11:16:06Z","updated_at":"2019-06-17T11:16:06Z","author_association":"NONE","body":"> server.join 也不会停掉主线程吧？。。。\r\n\r\n嗯，我的意思是问题出现在server.join返回之后，main函数便是正常return弹栈，开始析构整个进程的static和全局变量，怀疑是在这个析构过程中，子线程NamingServiceThread使用的BNS SDK仍在访问它注册的全局变量。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/502640791/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/502645634","html_url":"https://github.com/apache/brpc/pull/803#issuecomment-502645634","issue_url":"https://api.github.com/repos/apache/brpc/issues/803","id":502645634,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMjY0NTYzNA==","user":{"login":"tanzhongyi003","id":20179982,"node_id":"MDQ6VXNlcjIwMTc5OTgy","avatar_url":"https://avatars.githubusercontent.com/u/20179982?v=4","gravatar_id":"","url":"https://api.github.com/users/tanzhongyi003","html_url":"https://github.com/tanzhongyi003","followers_url":"https://api.github.com/users/tanzhongyi003/followers","following_url":"https://api.github.com/users/tanzhongyi003/following{/other_user}","gists_url":"https://api.github.com/users/tanzhongyi003/gists{/gist_id}","starred_url":"https://api.github.com/users/tanzhongyi003/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tanzhongyi003/subscriptions","organizations_url":"https://api.github.com/users/tanzhongyi003/orgs","repos_url":"https://api.github.com/users/tanzhongyi003/repos","events_url":"https://api.github.com/users/tanzhongyi003/events{/privacy}","received_events_url":"https://api.github.com/users/tanzhongyi003/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-17T11:33:00Z","updated_at":"2019-06-17T11:33:00Z","author_association":"MEMBER","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/502645634/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503046593","html_url":"https://github.com/apache/brpc/issues/810#issuecomment-503046593","issue_url":"https://api.github.com/repos/apache/brpc/issues/810","id":503046593,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzA0NjU5Mw==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-18T10:30:16Z","updated_at":"2019-06-18T10:30:16Z","author_association":"CONTRIBUTOR","body":"It's by design. NOSIGNAL bthreads should be paired with bthread_flush(), which is an advanced usage and un-recommended for regular users.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503046593/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503235147","html_url":"https://github.com/apache/brpc/issues/813#issuecomment-503235147","issue_url":"https://api.github.com/repos/apache/brpc/issues/813","id":503235147,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzIzNTE0Nw==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-18T17:32:41Z","updated_at":"2019-06-18T17:32:41Z","author_association":"CONTRIBUTOR","body":"h2:grpc能达到什么样的qps","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503235147/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503263696","html_url":"https://github.com/apache/brpc/issues/813#issuecomment-503263696","issue_url":"https://api.github.com/repos/apache/brpc/issues/813","id":503263696,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzI2MzY5Ng==","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-18T18:47:47Z","updated_at":"2019-06-18T18:50:26Z","author_association":"CONTRIBUTOR","body":"> h2:grpc能达到什么样的qps\r\n\r\n100w+ qps，用了20个核，issue表述有误，刚确认了下加client会增加server端cpu使用，但是qps不涨","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503263696/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503270260","html_url":"https://github.com/apache/brpc/issues/813#issuecomment-503270260","issue_url":"https://api.github.com/repos/apache/brpc/issues/813","id":503270260,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzI3MDI2MA==","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-18T19:06:08Z","updated_at":"2019-06-18T19:06:08Z","author_association":"CONTRIBUTOR","body":"更新了一些描述，以及压满cpu下的火焰图","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503270260/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503272324","html_url":"https://github.com/apache/brpc/issues/813#issuecomment-503272324","issue_url":"https://api.github.com/repos/apache/brpc/issues/813","id":503272324,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzI3MjMyNA==","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-18T19:12:11Z","updated_at":"2019-06-18T19:12:11Z","author_association":"CONTRIBUTOR","body":"contention的图也补了一下，有点长只截了je_tcache_bin_flush_small在的那块","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503272324/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503377388","html_url":"https://github.com/apache/brpc/issues/810#issuecomment-503377388","issue_url":"https://api.github.com/repos/apache/brpc/issues/810","id":503377388,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzM3NzM4OA==","user":{"login":"zexuan","id":6112909,"node_id":"MDQ6VXNlcjYxMTI5MDk=","avatar_url":"https://avatars.githubusercontent.com/u/6112909?v=4","gravatar_id":"","url":"https://api.github.com/users/zexuan","html_url":"https://github.com/zexuan","followers_url":"https://api.github.com/users/zexuan/followers","following_url":"https://api.github.com/users/zexuan/following{/other_user}","gists_url":"https://api.github.com/users/zexuan/gists{/gist_id}","starred_url":"https://api.github.com/users/zexuan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zexuan/subscriptions","organizations_url":"https://api.github.com/users/zexuan/orgs","repos_url":"https://api.github.com/users/zexuan/repos","events_url":"https://api.github.com/users/zexuan/events{/privacy}","received_events_url":"https://api.github.com/users/zexuan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-19T02:09:00Z","updated_at":"2019-06-19T02:09:00Z","author_association":"CONTRIBUTOR","body":"> It's by design. NOSIGNAL bthreads should be paired with bthread_flush(), which is an advanced usage and un-recommended for regular users.\r\n\r\nIt will have the same effect if some bthreads come in when all workers are busy(pthread blocked) and signals will be ignored. How can we deal with this?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503377388/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503400620","html_url":"https://github.com/apache/brpc/issues/813#issuecomment-503400620","issue_url":"https://api.github.com/repos/apache/brpc/issues/813","id":503400620,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzQwMDYyMA==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-19T04:24:36Z","updated_at":"2019-06-19T04:24:36Z","author_association":"CONTRIBUTOR","body":"1. 看一下使用h2:proto是否有区别，上图中占比较大的PercentEncode是grpc特有的\r\n2. 你上面的图是指server端的情况吧？client端是否可能成为瓶颈？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503400620/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503682037","html_url":"https://github.com/apache/brpc/issues/813#issuecomment-503682037","issue_url":"https://api.github.com/repos/apache/brpc/issues/813","id":503682037,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzY4MjAzNw==","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-19T18:43:15Z","updated_at":"2019-06-19T18:43:15Z","author_association":"CONTRIBUTOR","body":"> 1. 看一下使用h2:proto是否有区别，上图中占比较大的PercentEncode是grpc特有的\r\n> 2. 你上面的图是指server端的情况吧？client端是否可能成为瓶颈？\r\n\r\n1. 压了一下h2:proto，表现是占用23核时能达到120w qps，客户端再加压直到压满服务端CPU(64核)，最终是140w qps，比h2:grpc高了一些\r\n![image](https://user-images.githubusercontent.com/16054841/59791496-d38e9580-9304-11e9-817e-1575ee45274e.png)\r\n![image](https://user-images.githubusercontent.com/16054841/59791513-e0ab8480-9304-11e9-936b-dfc7355f4719.png)\r\n\r\n2. 是server情况，client应该不是瓶颈，server端CPU已经被打满了，h2:grpc是可以打满cpu的，但是20核就已经到100w qps了，再加客户端压满cpu(64核)，qps基本不变","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503682037/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503684024","html_url":"https://github.com/apache/brpc/issues/813#issuecomment-503684024","issue_url":"https://api.github.com/repos/apache/brpc/issues/813","id":503684024,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzY4NDAyNA==","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-19T18:49:07Z","updated_at":"2019-06-19T18:49:07Z","author_association":"CONTRIBUTOR","body":"h2:proto画了一个contention图，看着还是同样的地方\r\n![image](https://user-images.githubusercontent.com/16054841/59791929-b8705580-9305-11e9-8509-f1a81897ded0.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503684024/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503828254","html_url":"https://github.com/apache/brpc/issues/813#issuecomment-503828254","issue_url":"https://api.github.com/repos/apache/brpc/issues/813","id":503828254,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzgyODI1NA==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-20T03:35:36Z","updated_at":"2019-06-20T03:35:36Z","author_association":"CONTRIBUTOR","body":"确认一下：\"增加client\"指的是增加client进程的数量，而不是增加线程或是channel数量吧","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503828254/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503830633","html_url":"https://github.com/apache/brpc/issues/813#issuecomment-503830633","issue_url":"https://api.github.com/repos/apache/brpc/issues/813","id":503830633,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzgzMDYzMw==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-20T03:50:32Z","updated_at":"2019-06-20T03:50:32Z","author_association":"CONTRIBUTOR","body":"1. 看一下server端的bthread_worker_count和bthread_worker_usage是多少？排除线程数是瓶颈。\r\n2. contention那个框虽然大，但上面的数字0.566(秒)占profiling的总时间(默认10秒)比例也不是很高。可以看看有无其他框，以及可以贴一下文字版的。\r\n3. 一般来说，64核cpu肯定是numa架构。可以通过numactl --hardware看看有几个nodes，并尝试起对应个数的server，并把client平分加压看看差异是否较大。也许对不同协议的影响量不太一样。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503830633/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503838559","html_url":"https://github.com/apache/brpc/issues/813#issuecomment-503838559","issue_url":"https://api.github.com/repos/apache/brpc/issues/813","id":503838559,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzgzODU1OQ==","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-20T04:36:18Z","updated_at":"2019-06-20T04:36:18Z","author_association":"CONTRIBUTOR","body":"> 确认一下：\"增加client\"指的是增加client进程的数量，而不是增加线程或是channel数量吧\r\n\r\n是进程数量","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503838559/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503871642","html_url":"https://github.com/apache/brpc/issues/813#issuecomment-503871642","issue_url":"https://api.github.com/repos/apache/brpc/issues/813","id":503871642,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzg3MTY0Mg==","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-20T04:58:22Z","updated_at":"2019-06-20T04:58:22Z","author_association":"CONTRIBUTOR","body":"> 1. 看一下server端的bthread_worker_count和bthread_worker_usage是多少？排除线程数是瓶颈。\r\n> 2. contention那个框虽然大，但上面的数字0.566(秒)占profiling的总时间(默认10秒)比例也不是很高。可以看看有无其他框，以及可以贴一下文字版的。\r\n> 3. 一般来说，64核cpu肯定是numa架构。可以通过numactl --hardware看看有几个nodes，并尝试起对应个数的server，并把client平分加压看看差异是否较大。也许对不同协议的影响量不太一样。\r\n\r\n下面的数据是h2:proto下cpu使用率接近跑满的数据\r\n![image](https://user-images.githubusercontent.com/16054841/59819504-b8e70b80-935a-11e9-9470-295875945d47.png)\r\n1. bthread_worker_count是65，bthread_worker_usage大概在40\r\n![image](https://user-images.githubusercontent.com/16054841/59819337-f9925500-9359-11e9-9b3f-086c785291a2.png)\r\n2. total看只有0.187s，那可能是有符号没有打出来嘛。butil:Mutex这个是bvar的，测baidu_std协议这个占比也挺高\r\n![image](https://user-images.githubusercontent.com/16054841/59819383-2f373e00-935a-11e9-8f0b-eddc44554a72.png)\r\n![image](https://user-images.githubusercontent.com/16054841/59819452-80dfc880-935a-11e9-9b9d-71ff7a1397aa.png)\r\n3. 我测一下再给一些数据","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503871642/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503877162","html_url":"https://github.com/apache/brpc/issues/813#issuecomment-503877162","issue_url":"https://api.github.com/repos/apache/brpc/issues/813","id":503877162,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzg3NzE2Mg==","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-20T05:11:56Z","updated_at":"2019-06-20T05:11:56Z","author_association":"CONTRIBUTOR","body":"再补下process_cpu_usage的信息\r\n![image](https://user-images.githubusercontent.com/16054841/59820017-e7fe7c80-935c-11e9-83e9-b0558ad5ff91.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503877162/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503986551","html_url":"https://github.com/apache/brpc/pull/818#issuecomment-503986551","issue_url":"https://api.github.com/repos/apache/brpc/issues/818","id":503986551,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzk4NjU1MQ==","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-20T11:18:43Z","updated_at":"2019-06-20T11:19:43Z","author_association":"MEMBER","body":"Thanks for the pr and bazel seems also missing the file. Could you add the missing file into test/BUILD?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503986551/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503996410","html_url":"https://github.com/apache/brpc/pull/818#issuecomment-503996410","issue_url":"https://api.github.com/repos/apache/brpc/issues/818","id":503996410,"node_id":"MDEyOklzc3VlQ29tbWVudDUwMzk5NjQxMA==","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-20T11:54:58Z","updated_at":"2019-06-20T11:54:58Z","author_association":"CONTRIBUTOR","body":"> Thanks for the pr and bazel seems also missing the file. Could you add the missing file into test/BUILD?\r\n\r\nresolved","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/503996410/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/504431688","html_url":"https://github.com/apache/brpc/issues/820#issuecomment-504431688","issue_url":"https://api.github.com/repos/apache/brpc/issues/820","id":504431688,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDQzMTY4OA==","user":{"login":"gtarcoder","id":11898942,"node_id":"MDQ6VXNlcjExODk4OTQy","avatar_url":"https://avatars.githubusercontent.com/u/11898942?v=4","gravatar_id":"","url":"https://api.github.com/users/gtarcoder","html_url":"https://github.com/gtarcoder","followers_url":"https://api.github.com/users/gtarcoder/followers","following_url":"https://api.github.com/users/gtarcoder/following{/other_user}","gists_url":"https://api.github.com/users/gtarcoder/gists{/gist_id}","starred_url":"https://api.github.com/users/gtarcoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gtarcoder/subscriptions","organizations_url":"https://api.github.com/users/gtarcoder/orgs","repos_url":"https://api.github.com/users/gtarcoder/repos","events_url":"https://api.github.com/users/gtarcoder/events{/privacy}","received_events_url":"https://api.github.com/users/gtarcoder/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-21T13:46:39Z","updated_at":"2019-06-21T13:46:39Z","author_association":"NONE","body":"发现程序的运行路线是这样的：\r\n\r\n1. 下游服务端频繁超时\r\n2. 客户端每次RPC 后会 FeedBack ( src/brpc/policy/locality_aware_load_balancer.cpp/Feedback) 更新节点的weight\r\n3.  节点不断被降权 \r\n4. 最终节点的 _base_weight 变成了0 ，从而节点被disable\r\n5. 在 SelectServer 中，始终走到如下分支逻辑，\r\n在 AddInflight 中，会直接返回 {false, 0}. （由于节点被disable）\r\n\r\n![image](https://user-images.githubusercontent.com/11898942/59926685-68ac9e00-946d-11e9-9218-5db5ea6e2f9c.png)\r\n所以，每次都无法select 出来节点。\r\n\r\n6 . 无法select节点，就无法IssueRPC，节点的weight 就无法通过 Feedback 来进行更新, 节点就一直无法被选择，从而一直报 [E112]Fail to select server from list:// （即使下游服务已经恢复）","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/504431688/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/504434407","html_url":"https://github.com/apache/brpc/issues/820#issuecomment-504434407","issue_url":"https://api.github.com/repos/apache/brpc/issues/820","id":504434407,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDQzNDQwNw==","user":{"login":"gtarcoder","id":11898942,"node_id":"MDQ6VXNlcjExODk4OTQy","avatar_url":"https://avatars.githubusercontent.com/u/11898942?v=4","gravatar_id":"","url":"https://api.github.com/users/gtarcoder","html_url":"https://github.com/gtarcoder","followers_url":"https://api.github.com/users/gtarcoder/followers","following_url":"https://api.github.com/users/gtarcoder/following{/other_user}","gists_url":"https://api.github.com/users/gtarcoder/gists{/gist_id}","starred_url":"https://api.github.com/users/gtarcoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gtarcoder/subscriptions","organizations_url":"https://api.github.com/users/gtarcoder/orgs","repos_url":"https://api.github.com/users/gtarcoder/repos","events_url":"https://api.github.com/users/gtarcoder/events{/privacy}","received_events_url":"https://api.github.com/users/gtarcoder/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-21T13:54:31Z","updated_at":"2019-06-21T13:54:31Z","author_association":"NONE","body":"看起来如果naming service 一直不更新下游服务节点（比如测试中使用list 这种naming service方式），那么这种状态就无法跳出。 @jamesge   这种情况是因为使用不当吗？ 还是框架本身就有可能出现这种情况？ 以及，能否通过 定期check 下游节点的方式 去避免？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/504434407/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/504809852","html_url":"https://github.com/apache/brpc/issues/820#issuecomment-504809852","issue_url":"https://api.github.com/repos/apache/brpc/issues/820","id":504809852,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNDgwOTg1Mg==","user":{"login":"gtarcoder","id":11898942,"node_id":"MDQ6VXNlcjExODk4OTQy","avatar_url":"https://avatars.githubusercontent.com/u/11898942?v=4","gravatar_id":"","url":"https://api.github.com/users/gtarcoder","html_url":"https://github.com/gtarcoder","followers_url":"https://api.github.com/users/gtarcoder/followers","following_url":"https://api.github.com/users/gtarcoder/following{/other_user}","gists_url":"https://api.github.com/users/gtarcoder/gists{/gist_id}","starred_url":"https://api.github.com/users/gtarcoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gtarcoder/subscriptions","organizations_url":"https://api.github.com/users/gtarcoder/orgs","repos_url":"https://api.github.com/users/gtarcoder/repos","events_url":"https://api.github.com/users/gtarcoder/events{/privacy}","received_events_url":"https://api.github.com/users/gtarcoder/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-24T01:42:21Z","updated_at":"2019-06-24T01:42:21Z","author_association":"NONE","body":"之前我们的服务使用LALB 出现过两种现象：\r\n1. 客户端连接后端server，如果一个节点连续 timeout 之后， 日志里面后面会紧跟着 can not select server from list://xxxx 这种错误\r\n2. 连续几分钟后端服务不可用之后， brpc 就彻底不会再尝试链接后端服务了 \r\n\r\n于是，看了 LALB 的实现代码，感觉原因如下：\r\n现象1： 因为LALB 的实现中，是概率性的选择下游节点，权重越大（一般是latency越小会导致权重越大），则被选中的概率越大 （通过产生随机数实现）。 如果一个节点出问题后，这个节点可能短时间内无法被成功选中（这是符合预期的，代码里面也是这么实现的），但是随机数产生的时候，仍然会可能产生到这个节点的区间，导致不断的去尝试选这个节点，当耗尽 ntry 次数之后，选择过程结束，最终没有选中 这个坏节点之外的其他好节点。 （因为是概率选择，所以这是可能发生的，尤其是一个本来权重很高的节点，突然出问题之后，短时间内，它的选中概率仍然最大）\r\n\r\n所以，就会出现 连续的  can not select server from list 这种错误\r\n\r\n现象2： 如果LALB 后面的server 节点，都连续超时，导致他们不断被降权，最终 _base_weight = 0, 此时会被 disable 掉。 然后之后的所有 SelectServer 都不会返回节点了， 一直出现  can not select server from list:// 错误\r\n\r\n\r\n感觉LALB 的实现中， SelectServer中的 ntry 有些问题，它对于两次产生随机数去选择节点过程中，没有去除重复节点，最终直接和 总节点数n 比较。如果一个坏节点不断被选中，会浪费选择次数，最终导致没有选择出可用节点。 虽然 Selectserver 循环有 nloop最大次数 10000 的限制，如果按现在这种实现的话，那么nloop 是永远不会被触发。因为循环（统计产生随机数的次数）最多被执行n次（节点数）， ntry >= n 就会退出\r\n\r\n感觉可以有两点改进：\r\n1. 在 SelectServer 中，ntry 不单纯统计尝试的次数，而是统计 尝试的unique的节点的个数，这样避免了 can not select server from 这种错误的误发生几率 （因为后端是有可用节点的，但是没有选出来）\r\n2. 节点被disable之后，尝试一定时间间隔去重新复活一次，防止节点落入永久不可恢复状态。\r\n\r\n@jamesge  你觉得合理吗？\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/504809852/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505298226","html_url":"https://github.com/apache/brpc/pull/821#issuecomment-505298226","issue_url":"https://api.github.com/repos/apache/brpc/issues/821","id":505298226,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTI5ODIyNg==","user":{"login":"gtarcoder","id":11898942,"node_id":"MDQ6VXNlcjExODk4OTQy","avatar_url":"https://avatars.githubusercontent.com/u/11898942?v=4","gravatar_id":"","url":"https://api.github.com/users/gtarcoder","html_url":"https://github.com/gtarcoder","followers_url":"https://api.github.com/users/gtarcoder/followers","following_url":"https://api.github.com/users/gtarcoder/following{/other_user}","gists_url":"https://api.github.com/users/gtarcoder/gists{/gist_id}","starred_url":"https://api.github.com/users/gtarcoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gtarcoder/subscriptions","organizations_url":"https://api.github.com/users/gtarcoder/orgs","repos_url":"https://api.github.com/users/gtarcoder/repos","events_url":"https://api.github.com/users/gtarcoder/events{/privacy}","received_events_url":"https://api.github.com/users/gtarcoder/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-25T06:07:23Z","updated_at":"2019-06-25T06:07:23Z","author_association":"NONE","body":"@jamesge @zyearn 能帮忙看下？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505298226/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505677225","html_url":"https://github.com/apache/brpc/pull/821#issuecomment-505677225","issue_url":"https://api.github.com/repos/apache/brpc/issues/821","id":505677225,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTY3NzIyNQ==","user":{"login":"gydong","id":3294444,"node_id":"MDQ6VXNlcjMyOTQ0NDQ=","avatar_url":"https://avatars.githubusercontent.com/u/3294444?v=4","gravatar_id":"","url":"https://api.github.com/users/gydong","html_url":"https://github.com/gydong","followers_url":"https://api.github.com/users/gydong/followers","following_url":"https://api.github.com/users/gydong/following{/other_user}","gists_url":"https://api.github.com/users/gydong/gists{/gist_id}","starred_url":"https://api.github.com/users/gydong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gydong/subscriptions","organizations_url":"https://api.github.com/users/gydong/orgs","repos_url":"https://api.github.com/users/gydong/repos","events_url":"https://api.github.com/users/gydong/events{/privacy}","received_events_url":"https://api.github.com/users/gydong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-26T01:07:42Z","updated_at":"2019-06-26T01:07:42Z","author_association":"CONTRIBUTOR","body":"@gtarcoder 可以加一下修改背景或者设计方案。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505677225/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505687361","html_url":"https://github.com/apache/brpc/issues/809#issuecomment-505687361","issue_url":"https://api.github.com/repos/apache/brpc/issues/809","id":505687361,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTY4NzM2MQ==","user":{"login":"Tsrign","id":10807479,"node_id":"MDQ6VXNlcjEwODA3NDc5","avatar_url":"https://avatars.githubusercontent.com/u/10807479?v=4","gravatar_id":"","url":"https://api.github.com/users/Tsrign","html_url":"https://github.com/Tsrign","followers_url":"https://api.github.com/users/Tsrign/followers","following_url":"https://api.github.com/users/Tsrign/following{/other_user}","gists_url":"https://api.github.com/users/Tsrign/gists{/gist_id}","starred_url":"https://api.github.com/users/Tsrign/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tsrign/subscriptions","organizations_url":"https://api.github.com/users/Tsrign/orgs","repos_url":"https://api.github.com/users/Tsrign/repos","events_url":"https://api.github.com/users/Tsrign/events{/privacy}","received_events_url":"https://api.github.com/users/Tsrign/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-26T02:03:20Z","updated_at":"2019-06-26T02:03:20Z","author_association":"NONE","body":"最终的trick方案：主线程退出main函数之前无线等待，等待外部的kill信号。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505687361/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505696111","html_url":"https://github.com/apache/brpc/issues/823#issuecomment-505696111","issue_url":"https://api.github.com/repos/apache/brpc/issues/823","id":505696111,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTY5NjExMQ==","user":{"login":"chengweiv5","id":689798,"node_id":"MDQ6VXNlcjY4OTc5OA==","avatar_url":"https://avatars.githubusercontent.com/u/689798?v=4","gravatar_id":"","url":"https://api.github.com/users/chengweiv5","html_url":"https://github.com/chengweiv5","followers_url":"https://api.github.com/users/chengweiv5/followers","following_url":"https://api.github.com/users/chengweiv5/following{/other_user}","gists_url":"https://api.github.com/users/chengweiv5/gists{/gist_id}","starred_url":"https://api.github.com/users/chengweiv5/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chengweiv5/subscriptions","organizations_url":"https://api.github.com/users/chengweiv5/orgs","repos_url":"https://api.github.com/users/chengweiv5/repos","events_url":"https://api.github.com/users/chengweiv5/events{/privacy}","received_events_url":"https://api.github.com/users/chengweiv5/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-26T02:49:39Z","updated_at":"2019-06-26T02:49:39Z","author_association":"NONE","body":"例如是否可以给长连接设置一个老化时间？到时自动断开重新建立连接？不知道是否合理。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505696111/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505728750","html_url":"https://github.com/apache/brpc/issues/788#issuecomment-505728750","issue_url":"https://api.github.com/repos/apache/brpc/issues/788","id":505728750,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTcyODc1MA==","user":{"login":"verydota","id":8371779,"node_id":"MDQ6VXNlcjgzNzE3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/8371779?v=4","gravatar_id":"","url":"https://api.github.com/users/verydota","html_url":"https://github.com/verydota","followers_url":"https://api.github.com/users/verydota/followers","following_url":"https://api.github.com/users/verydota/following{/other_user}","gists_url":"https://api.github.com/users/verydota/gists{/gist_id}","starred_url":"https://api.github.com/users/verydota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/verydota/subscriptions","organizations_url":"https://api.github.com/users/verydota/orgs","repos_url":"https://api.github.com/users/verydota/repos","events_url":"https://api.github.com/users/verydota/events{/privacy}","received_events_url":"https://api.github.com/users/verydota/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-26T05:49:08Z","updated_at":"2019-06-26T05:49:08Z","author_association":"NONE","body":"我遇到了类似的问题。直接注释掉会影响监控。 \r\n\r\n问题来源是， 因为我们需要对裸盘操作， 所以给 二进制加了部分权限\r\nsetcap cap_sys_rawio,cap_sys_admin=eip  ./datanode】\r\n\r\n加权限之后， 程序运行时无法 打开   /proc/self/io 。导致缺少bvar 监控值。\r\n\r\n为二进制继续添加  cap_dac_read_search 权限后得以 可以解决权限问题。\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505728750/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505729384","html_url":"https://github.com/apache/brpc/issues/767#issuecomment-505729384","issue_url":"https://api.github.com/repos/apache/brpc/issues/767","id":505729384,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTcyOTM4NA==","user":{"login":"verydota","id":8371779,"node_id":"MDQ6VXNlcjgzNzE3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/8371779?v=4","gravatar_id":"","url":"https://api.github.com/users/verydota","html_url":"https://github.com/verydota","followers_url":"https://api.github.com/users/verydota/followers","following_url":"https://api.github.com/users/verydota/following{/other_user}","gists_url":"https://api.github.com/users/verydota/gists{/gist_id}","starred_url":"https://api.github.com/users/verydota/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/verydota/subscriptions","organizations_url":"https://api.github.com/users/verydota/orgs","repos_url":"https://api.github.com/users/verydota/repos","events_url":"https://api.github.com/users/verydota/events{/privacy}","received_events_url":"https://api.github.com/users/verydota/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-26T05:52:01Z","updated_at":"2019-06-26T05:52:01Z","author_association":"NONE","body":"看一下机器的 tcp 重传监控，是否tcp重传很高 。 200ms看起来是触发了 tcp重传 导致部分请求+200ms","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505729384/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505745074","html_url":"https://github.com/apache/brpc/issues/822#issuecomment-505745074","issue_url":"https://api.github.com/repos/apache/brpc/issues/822","id":505745074,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTc0NTA3NA==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-26T06:52:13Z","updated_at":"2019-06-26T06:52:13Z","author_association":"CONTRIBUTOR","body":"如果是同步访问，再能设置controller时rpc已经结束了，设了也没有意义。如果是异步访问，这个操作的行为是undefined，controller可能出于还没用、正在被用、重试中、已经删除等状态，各有各的情况","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505745074/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505755733","html_url":"https://github.com/apache/brpc/issues/820#issuecomment-505755733","issue_url":"https://api.github.com/repos/apache/brpc/issues/820","id":505755733,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTc1NTczMw==","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-26T07:29:36Z","updated_at":"2019-06-26T07:29:36Z","author_association":"MEMBER","body":"这个问题是在 https://github.com/apache/incubator-brpc/blob/master/src/brpc/policy/locality_aware_load_balancer.cpp#L460 这里对_base_weight赋值的时候赋成0了，导致在SelectServer时判断disable()为true就永远选不了了，最简单的解决办法是把 Disable() 和 Disabled()的实现改成 _base_weight = -1, 以及 _base_weight == -1就好了。\r\n\r\n如果一个节点出问题了，那么在feedback的时候会减小它的权重，就算在随机值落在这个server上，在发rpc之前也会把InFlight rpc的惩罚加到权重上，如果随机值不落在这个新权重里，还是会重新选一次的，这里的逻辑看起来没问题，问题节点的流量会越来越小","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505755733/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505868572","html_url":"https://github.com/apache/brpc/issues/820#issuecomment-505868572","issue_url":"https://api.github.com/repos/apache/brpc/issues/820","id":505868572,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNTg2ODU3Mg==","user":{"login":"gtarcoder","id":11898942,"node_id":"MDQ6VXNlcjExODk4OTQy","avatar_url":"https://avatars.githubusercontent.com/u/11898942?v=4","gravatar_id":"","url":"https://api.github.com/users/gtarcoder","html_url":"https://github.com/gtarcoder","followers_url":"https://api.github.com/users/gtarcoder/followers","following_url":"https://api.github.com/users/gtarcoder/following{/other_user}","gists_url":"https://api.github.com/users/gtarcoder/gists{/gist_id}","starred_url":"https://api.github.com/users/gtarcoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gtarcoder/subscriptions","organizations_url":"https://api.github.com/users/gtarcoder/orgs","repos_url":"https://api.github.com/users/gtarcoder/repos","events_url":"https://api.github.com/users/gtarcoder/events{/privacy}","received_events_url":"https://api.github.com/users/gtarcoder/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-26T13:12:35Z","updated_at":"2019-06-26T13:12:35Z","author_association":"NONE","body":"> 这个问题是在 https://github.com/apache/incubator-brpc/blob/master/src/brpc/policy/locality_aware_load_balancer.cpp#L460 这里对_base_weight赋值的时候赋成0了，导致在SelectServer时判断disable()为true就永远选不了了，最简单的解决办法是把 Disable() 和 Disabled()的实现改成 _base_weight = -1, 以及 _base_weight == -1就好了。\r\n> \r\n> 如果一个节点出问题了，那么在feedback的时候会减小它的权重，就算在随机值落在这个server上，在发rpc之前也会把InFlight rpc的惩罚加到权重上，如果随机值不落在这个新权重里，还是会重新选一次的，这里的逻辑看起来没问题，问题节点的流量会越来越小\r\n\r\n因为是随机性的选取，如果每次选择都是 一个坏节点被选中； 那么n次之后，就返回 can not select server， 而有其他节点没有被选中。 这种情况需要避免吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/505868572/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506106086","html_url":"https://github.com/apache/brpc/issues/823#issuecomment-506106086","issue_url":"https://api.github.com/repos/apache/brpc/issues/823","id":506106086,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjEwNjA4Ng==","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-27T01:48:09Z","updated_at":"2019-06-27T01:48:09Z","author_association":"CONTRIBUTOR","body":"因为rpc已经自带naming和LB功能，所以其实没必要再加一层LVS，可以直接把服务实例注册到某种naming系统（如consul/etcd）然后通过rpc访问","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506106086/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506143936","html_url":"https://github.com/apache/brpc/issues/823#issuecomment-506143936","issue_url":"https://api.github.com/repos/apache/brpc/issues/823","id":506143936,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjE0MzkzNg==","user":{"login":"chengweiv5","id":689798,"node_id":"MDQ6VXNlcjY4OTc5OA==","avatar_url":"https://avatars.githubusercontent.com/u/689798?v=4","gravatar_id":"","url":"https://api.github.com/users/chengweiv5","html_url":"https://github.com/chengweiv5","followers_url":"https://api.github.com/users/chengweiv5/followers","following_url":"https://api.github.com/users/chengweiv5/following{/other_user}","gists_url":"https://api.github.com/users/chengweiv5/gists{/gist_id}","starred_url":"https://api.github.com/users/chengweiv5/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chengweiv5/subscriptions","organizations_url":"https://api.github.com/users/chengweiv5/orgs","repos_url":"https://api.github.com/users/chengweiv5/repos","events_url":"https://api.github.com/users/chengweiv5/events{/privacy}","received_events_url":"https://api.github.com/users/chengweiv5/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-27T03:39:29Z","updated_at":"2019-06-27T03:39:29Z","author_association":"NONE","body":"好的，多谢，我们考虑下。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506143936/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506147646","html_url":"https://github.com/apache/brpc/issues/823#issuecomment-506147646","issue_url":"https://api.github.com/repos/apache/brpc/issues/823","id":506147646,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjE0NzY0Ng==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-27T04:02:56Z","updated_at":"2019-06-27T04:02:56Z","author_association":"CONTRIBUTOR","body":"四层负载均衡一般是用在直接接受用户流量的服务上，内部服务尽量别用。你说的问题(连接vip)，用pooled连接模式就行了，默认情况下一个连接只要10秒没有使用，就会关闭，由于流量总是有高有低，连接其实会持续（但不高频）地关闭和打开的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506147646/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506227762","html_url":"https://github.com/apache/brpc/issues/823#issuecomment-506227762","issue_url":"https://api.github.com/repos/apache/brpc/issues/823","id":506227762,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjIyNzc2Mg==","user":{"login":"chengweiv5","id":689798,"node_id":"MDQ6VXNlcjY4OTc5OA==","avatar_url":"https://avatars.githubusercontent.com/u/689798?v=4","gravatar_id":"","url":"https://api.github.com/users/chengweiv5","html_url":"https://github.com/chengweiv5","followers_url":"https://api.github.com/users/chengweiv5/followers","following_url":"https://api.github.com/users/chengweiv5/following{/other_user}","gists_url":"https://api.github.com/users/chengweiv5/gists{/gist_id}","starred_url":"https://api.github.com/users/chengweiv5/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chengweiv5/subscriptions","organizations_url":"https://api.github.com/users/chengweiv5/orgs","repos_url":"https://api.github.com/users/chengweiv5/repos","events_url":"https://api.github.com/users/chengweiv5/events{/privacy}","received_events_url":"https://api.github.com/users/chengweiv5/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-27T07:28:41Z","updated_at":"2019-06-27T07:28:41Z","author_association":"NONE","body":"@jamesge 好的，多谢，我们试试效果","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506227762/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506265547","html_url":"https://github.com/apache/brpc/issues/825#issuecomment-506265547","issue_url":"https://api.github.com/repos/apache/brpc/issues/825","id":506265547,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjI2NTU0Nw==","user":{"login":"kevinmgyu","id":42665912,"node_id":"MDQ6VXNlcjQyNjY1OTEy","avatar_url":"https://avatars.githubusercontent.com/u/42665912?v=4","gravatar_id":"","url":"https://api.github.com/users/kevinmgyu","html_url":"https://github.com/kevinmgyu","followers_url":"https://api.github.com/users/kevinmgyu/followers","following_url":"https://api.github.com/users/kevinmgyu/following{/other_user}","gists_url":"https://api.github.com/users/kevinmgyu/gists{/gist_id}","starred_url":"https://api.github.com/users/kevinmgyu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kevinmgyu/subscriptions","organizations_url":"https://api.github.com/users/kevinmgyu/orgs","repos_url":"https://api.github.com/users/kevinmgyu/repos","events_url":"https://api.github.com/users/kevinmgyu/events{/privacy}","received_events_url":"https://api.github.com/users/kevinmgyu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-27T09:16:57Z","updated_at":"2019-06-27T09:16:57Z","author_association":"NONE","body":"thanks","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506265547/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506273831","html_url":"https://github.com/apache/brpc/issues/826#issuecomment-506273831","issue_url":"https://api.github.com/repos/apache/brpc/issues/826","id":506273831,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjI3MzgzMQ==","user":{"login":"MR-workaholic","id":12267045,"node_id":"MDQ6VXNlcjEyMjY3MDQ1","avatar_url":"https://avatars.githubusercontent.com/u/12267045?v=4","gravatar_id":"","url":"https://api.github.com/users/MR-workaholic","html_url":"https://github.com/MR-workaholic","followers_url":"https://api.github.com/users/MR-workaholic/followers","following_url":"https://api.github.com/users/MR-workaholic/following{/other_user}","gists_url":"https://api.github.com/users/MR-workaholic/gists{/gist_id}","starred_url":"https://api.github.com/users/MR-workaholic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MR-workaholic/subscriptions","organizations_url":"https://api.github.com/users/MR-workaholic/orgs","repos_url":"https://api.github.com/users/MR-workaholic/repos","events_url":"https://api.github.com/users/MR-workaholic/events{/privacy}","received_events_url":"https://api.github.com/users/MR-workaholic/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-27T09:39:31Z","updated_at":"2019-06-27T09:39:31Z","author_association":"NONE","body":"请问这个与HTTPS有关吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506273831/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506301082","html_url":"https://github.com/apache/brpc/issues/826#issuecomment-506301082","issue_url":"https://api.github.com/repos/apache/brpc/issues/826","id":506301082,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjMwMTA4Mg==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-27T11:04:17Z","updated_at":"2019-06-27T11:04:17Z","author_association":"CONTRIBUTOR","body":"Fixed. curl --http2发的是一个带Upgrade header的http 1.1请求，brpc中的http parser在看到upgrade header时就会不解析body了，目前调整为仍会解析。之前测试中只验证了get没有留意post。\r\n不过请注意，这种情况下brpc仍然是http 1.1模式，要与brpc建立h2连接，只能走[connection preface](https://tools.ietf.org/html/rfc7540#section-3.4)","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506301082/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506301989","html_url":"https://github.com/apache/brpc/issues/825#issuecomment-506301989","issue_url":"https://api.github.com/repos/apache/brpc/issues/825","id":506301989,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjMwMTk4OQ==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-27T11:07:23Z","updated_at":"2019-06-27T11:07:47Z","author_association":"CONTRIBUTOR","body":"websocket要解决的问题一般可以通过[server push](https://github.com/apache/incubator-brpc/blob/master/docs/cn/server_push.md)、[持续下载](https://github.com/apache/incubator-brpc/blob/master/docs/cn/http_client.md#%E6%8C%81%E7%BB%AD%E4%B8%8B%E8%BD%BD)、[持续发送](https://github.com/apache/incubator-brpc/blob/master/docs/cn/http_service.md#%E6%8C%81%E7%BB%AD%E5%8F%91%E9%80%81)等实现","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506301989/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506598851","html_url":"https://github.com/apache/brpc/issues/820#issuecomment-506598851","issue_url":"https://api.github.com/repos/apache/brpc/issues/820","id":506598851,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjU5ODg1MQ==","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-28T04:48:45Z","updated_at":"2019-06-28T04:48:45Z","author_association":"MEMBER","body":"这个问题需要避免，这里的逻辑和weight round robin lb在选到Failed节点时的处理逻辑是差不多的，可以在pr里参考下那里的实现。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506598851/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506928222","html_url":"https://github.com/apache/brpc/issues/820#issuecomment-506928222","issue_url":"https://api.github.com/repos/apache/brpc/issues/820","id":506928222,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNjkyODIyMg==","user":{"login":"gtarcoder","id":11898942,"node_id":"MDQ6VXNlcjExODk4OTQy","avatar_url":"https://avatars.githubusercontent.com/u/11898942?v=4","gravatar_id":"","url":"https://api.github.com/users/gtarcoder","html_url":"https://github.com/gtarcoder","followers_url":"https://api.github.com/users/gtarcoder/followers","following_url":"https://api.github.com/users/gtarcoder/following{/other_user}","gists_url":"https://api.github.com/users/gtarcoder/gists{/gist_id}","starred_url":"https://api.github.com/users/gtarcoder/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gtarcoder/subscriptions","organizations_url":"https://api.github.com/users/gtarcoder/orgs","repos_url":"https://api.github.com/users/gtarcoder/repos","events_url":"https://api.github.com/users/gtarcoder/events{/privacy}","received_events_url":"https://api.github.com/users/gtarcoder/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-06-29T05:21:47Z","updated_at":"2019-06-29T05:21:47Z","author_association":"NONE","body":"ok 我看下","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/506928222/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/507088351","html_url":"https://github.com/apache/brpc/pull/829#issuecomment-507088351","issue_url":"https://api.github.com/repos/apache/brpc/issues/829","id":507088351,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNzA4ODM1MQ==","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-07-01T01:46:19Z","updated_at":"2019-07-01T01:46:19Z","author_association":"MEMBER","body":"Hi, Could you attach the error message here?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/507088351/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/507096449","html_url":"https://github.com/apache/brpc/pull/829#issuecomment-507096449","issue_url":"https://api.github.com/repos/apache/brpc/issues/829","id":507096449,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNzA5NjQ0OQ==","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-07-01T02:42:29Z","updated_at":"2019-07-01T02:42:29Z","author_association":"MEMBER","body":"It seems that this file is removed after 3.8. I have just test the pr with 3.8.0, 3.7.0, 3.6.0, 3.5.0, 3.0.0, 2.6.0, 2.4.1, and it is ok to remove the file. Thanks for the contribution.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/507096449/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/507983880","html_url":"https://github.com/apache/brpc/issues/697#issuecomment-507983880","issue_url":"https://api.github.com/repos/apache/brpc/issues/697","id":507983880,"node_id":"MDEyOklzc3VlQ29tbWVudDUwNzk4Mzg4MA==","user":{"login":"promoon","id":11702251,"node_id":"MDQ6VXNlcjExNzAyMjUx","avatar_url":"https://avatars.githubusercontent.com/u/11702251?v=4","gravatar_id":"","url":"https://api.github.com/users/promoon","html_url":"https://github.com/promoon","followers_url":"https://api.github.com/users/promoon/followers","following_url":"https://api.github.com/users/promoon/following{/other_user}","gists_url":"https://api.github.com/users/promoon/gists{/gist_id}","starred_url":"https://api.github.com/users/promoon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/promoon/subscriptions","organizations_url":"https://api.github.com/users/promoon/orgs","repos_url":"https://api.github.com/users/promoon/repos","events_url":"https://api.github.com/users/promoon/events{/privacy}","received_events_url":"https://api.github.com/users/promoon/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-07-03T07:56:00Z","updated_at":"2019-07-03T07:56:00Z","author_association":"NONE","body":"> 已经把bvar的线程移动到main函数之后执行，以保证fork之后才执行bvar线程．\r\n> \r\n> 目前进行业务压测，超时问题应该是bthread_worker_usage达到上限导致,跟预期服务承载能力不相符，目前还在排查．\r\n> ![1755025561](https://user-images.githubusercontent.com/8772285/55847307-5cf25080-5b7b-11e9-8b62-20c5aae2a2d8.jpg)\r\n> ![376294209](https://user-images.githubusercontent.com/8772285/55847315-61b70480-5b7b-11e9-9f03-238b22bb9d5f.jpg)\r\n> \r\n> 但是随着qps继续上涨，服务会直接卡死，访问前端页面(http://_:6104,http://_:6104/vars)也不行，压测全部报超时error\r\n> \r\n> Search request Error1: 1008: [E1008]Reached timeout=3500ms @_:6104 Query : 爱情练习题 Search request Error1: 1008: [E1008]Reached timeout=3500ms @_:6104 Query : 爱情两部曲\r\n> Search request Error1: 1008: [E1008]Reached timeout=3500ms @_:6104 Query : 爱情两好三坏 Search request Error1: 1008: [E1008]Reached timeout=3500ms @_:6104 Query : 爱情领域\r\n> \r\n> 且服务cpu占用基本为0,服务不能自己恢复正常,只能重启解决．\r\n> 但是netstat查看监听端口正常,处于LINSEN状态，并且使用telnet访问此端口也能连接上.\r\n> 最后发现是服务的线程block住，导致的问题.\r\n> ![Screenshot from 2019-04-10 14:16:22](https://user-images.githubusercontent.com/8772285/55856000-989d1280-5b9b-11e9-89d2-060053fac326.png)\r\n> \r\n> 我的理解是这样子的:由于我的服务还会使用brpc client往下游发送数据，而造成bthread资源不够,所以整体block住,不知道对不对.\r\n> \r\n> 请问这种情况如何避免?\r\n\r\n我们目前在用的bvar也遇到了同样的core dump，请问你是如何将bvar线程移到main函数之后的？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/507983880/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/508078586","html_url":"https://github.com/apache/brpc/issues/690#issuecomment-508078586","issue_url":"https://api.github.com/repos/apache/brpc/issues/690","id":508078586,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODA3ODU4Ng==","user":{"login":"tonybase","id":3871120,"node_id":"MDQ6VXNlcjM4NzExMjA=","avatar_url":"https://avatars.githubusercontent.com/u/3871120?v=4","gravatar_id":"","url":"https://api.github.com/users/tonybase","html_url":"https://github.com/tonybase","followers_url":"https://api.github.com/users/tonybase/followers","following_url":"https://api.github.com/users/tonybase/following{/other_user}","gists_url":"https://api.github.com/users/tonybase/gists{/gist_id}","starred_url":"https://api.github.com/users/tonybase/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonybase/subscriptions","organizations_url":"https://api.github.com/users/tonybase/orgs","repos_url":"https://api.github.com/users/tonybase/repos","events_url":"https://api.github.com/users/tonybase/events{/privacy}","received_events_url":"https://api.github.com/users/tonybase/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-07-03T12:48:25Z","updated_at":"2019-07-03T12:48:25Z","author_association":"NONE","body":"clone master，编译brpc和example/multi_threaded_echo_server，直接运行我也出现这个","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/508078586/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/508325541","html_url":"https://github.com/apache/brpc/issues/832#issuecomment-508325541","issue_url":"https://api.github.com/repos/apache/brpc/issues/832","id":508325541,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODMyNTU0MQ==","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-07-04T03:34:47Z","updated_at":"2019-07-04T03:34:47Z","author_association":"CONTRIBUTOR","body":"fork出来后行为是undefined，尽量不要fork","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/508325541/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/508388898","html_url":"https://github.com/apache/brpc/issues/786#issuecomment-508388898","issue_url":"https://api.github.com/repos/apache/brpc/issues/786","id":508388898,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODM4ODg5OA==","user":{"login":"Ye-Tian-Zero","id":8231208,"node_id":"MDQ6VXNlcjgyMzEyMDg=","avatar_url":"https://avatars.githubusercontent.com/u/8231208?v=4","gravatar_id":"","url":"https://api.github.com/users/Ye-Tian-Zero","html_url":"https://github.com/Ye-Tian-Zero","followers_url":"https://api.github.com/users/Ye-Tian-Zero/followers","following_url":"https://api.github.com/users/Ye-Tian-Zero/following{/other_user}","gists_url":"https://api.github.com/users/Ye-Tian-Zero/gists{/gist_id}","starred_url":"https://api.github.com/users/Ye-Tian-Zero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Ye-Tian-Zero/subscriptions","organizations_url":"https://api.github.com/users/Ye-Tian-Zero/orgs","repos_url":"https://api.github.com/users/Ye-Tian-Zero/repos","events_url":"https://api.github.com/users/Ye-Tian-Zero/events{/privacy}","received_events_url":"https://api.github.com/users/Ye-Tian-Zero/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-07-04T08:20:35Z","updated_at":"2019-07-04T08:20:35Z","author_association":"CONTRIBUTOR","body":"@peiyuanzheng \r\n我测试了下，在我的系统上，应该是达到单条 tcp 链接的极限了，我按你说的改造，甚至直接去掉了这种方式，而是使用一个静态的 proto 文件作为传输协议，在跑16字节的 echo 时，都存在了上限也就是 55w qps 左右。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/508388898/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/508432521","html_url":"https://github.com/apache/brpc/issues/786#issuecomment-508432521","issue_url":"https://api.github.com/repos/apache/brpc/issues/786","id":508432521,"node_id":"MDEyOklzc3VlQ29tbWVudDUwODQzMjUyMQ==","user":{"login":"peiyuanzheng","id":4730528,"node_id":"MDQ6VXNlcjQ3MzA1Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/4730528?v=4","gravatar_id":"","url":"https://api.github.com/users/peiyuanzheng","html_url":"https://github.com/peiyuanzheng","followers_url":"https://api.github.com/users/peiyuanzheng/followers","following_url":"https://api.github.com/users/peiyuanzheng/following{/other_user}","gists_url":"https://api.github.com/users/peiyuanzheng/gists{/gist_id}","starred_url":"https://api.github.com/users/peiyuanzheng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/peiyuanzheng/subscriptions","organizations_url":"https://api.github.com/users/peiyuanzheng/orgs","repos_url":"https://api.github.com/users/peiyuanzheng/repos","events_url":"https://api.github.com/users/peiyuanzheng/events{/privacy}","received_events_url":"https://api.github.com/users/peiyuanzheng/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-07-04T10:30:22Z","updated_at":"2019-07-04T10:30:22Z","author_association":"NONE","body":"@skilxnTL 感谢同步。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/508432521/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]