[{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1694143954","html_url":"https://github.com/apache/ratis/pull/908#issuecomment-1694143954","issue_url":"https://api.github.com/repos/apache/ratis/issues/908","id":1694143954,"node_id":"IC_kwDOBMxbGc5k-pXS","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-26T03:43:45Z","updated_at":"2023-08-26T03:43:45Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo  work on this, +1 LGTM.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1694143954/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1694402715","html_url":"https://github.com/apache/ratis/pull/909#issuecomment-1694402715","issue_url":"https://api.github.com/repos/apache/ratis/issues/909","id":1694402715,"node_id":"IC_kwDOBMxbGc5k_oib","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-26T16:25:31Z","updated_at":"2023-08-26T16:25:31Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo work on this, +1 LGTM.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1694402715/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1694705079","html_url":"https://github.com/apache/ratis/pull/907#issuecomment-1694705079","issue_url":"https://api.github.com/repos/apache/ratis/issues/907","id":1694705079,"node_id":"IC_kwDOBMxbGc5lAyW3","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-27T16:12:05Z","updated_at":"2023-08-27T16:12:05Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , thanks for reviewing and merging this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1694705079/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1694705663","html_url":"https://github.com/apache/ratis/pull/908#issuecomment-1694705663","issue_url":"https://api.github.com/repos/apache/ratis/issues/908","id":1694705663,"node_id":"IC_kwDOBMxbGc5lAyf_","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-27T16:14:54Z","updated_at":"2023-08-27T16:14:54Z","author_association":"CONTRIBUTOR","body":"@guohao-rosicky , @SzyWilliam , thanks for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1694705663/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1694711471","html_url":"https://github.com/apache/ratis/pull/909#issuecomment-1694711471","issue_url":"https://api.github.com/repos/apache/ratis/issues/909","id":1694711471,"node_id":"IC_kwDOBMxbGc5lAz6v","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-27T16:44:48Z","updated_at":"2023-08-27T16:44:48Z","author_association":"CONTRIBUTOR","body":"> ... shall we turn on the failOnViolation option in pom to force checkstyle?\r\n\r\nSure, let's try it.\r\n\r\n\r\nBTW, just found that license-maven-plugin.version was updated incorrectly.  The version 4.1 does not exist.  The latest is 2.2.0 (https://mvnrepository.com/artifact/org.codehaus.mojo/license-maven-plugin).  Will also fix it here.\r\n```\r\n-    <license-maven-plugin.version>4.1</license-maven-plugin.version>\r\n+    <license-maven-plugin.version>2.2.0</license-maven-plugin.version>\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1694711471/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1699423327","html_url":"https://github.com/apache/ratis/pull/911#issuecomment-1699423327","issue_url":"https://api.github.com/repos/apache/ratis/issues/911","id":1699423327,"node_id":"IC_kwDOBMxbGc5lSyRf","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-30T15:43:42Z","updated_at":"2023-08-30T15:43:42Z","author_association":"MEMBER","body":"Thanks @szetszwo very much for the patch! I'll use the patch to restart and see if we can fix it later on.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1699423327/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1704480264","html_url":"https://github.com/apache/ratis/pull/913#issuecomment-1704480264","issue_url":"https://api.github.com/repos/apache/ratis/issues/913","id":1704480264,"node_id":"IC_kwDOBMxbGc5lmE4I","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-04T01:26:43Z","updated_at":"2023-09-04T01:26:43Z","author_association":"MEMBER","body":"@szetszwo Thanks very much for the patch! It's good to know `CodeInjectionForTesting` can be used for blocking. I'll try using Injection to replace the sleep time in the linearizable read index tests.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1704480264/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1705576264","html_url":"https://github.com/apache/ratis/pull/911#issuecomment-1705576264","issue_url":"https://api.github.com/repos/apache/ratis/issues/911","id":1705576264,"node_id":"IC_kwDOBMxbGc5lqQdI","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-04T17:46:36Z","updated_at":"2023-09-04T17:46:36Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , as @OneSizeFitsQuorum mentioned in [RATIS-1879](https://issues.apache.org/jira/browse/RATIS-1879).  We already have WARN_AND_RETURN corruption policy.  We does not seem to need this anymore.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1705576264/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1705842282","html_url":"https://github.com/apache/ratis/pull/911#issuecomment-1705842282","issue_url":"https://api.github.com/repos/apache/ratis/issues/911","id":1705842282,"node_id":"IC_kwDOBMxbGc5lrRZq","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-05T02:00:37Z","updated_at":"2023-09-05T02:00:37Z","author_association":"MEMBER","body":"@szetszwo Thanks a lot! I was still worrying about this issue yesterday since it turned out that our user turned off the `unsafeFlush` and I made a mistake when firing a issue. The corruption problem may happen whether we enable `unsafeFlush`  or not. \r\nNow that I know `CorruptionPolicy` and it perfectly meet our needs. \r\nThanks @szetszwo @OneSizeFitsQuorum again!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1705842282/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1706042137","html_url":"https://github.com/apache/ratis/pull/911#issuecomment-1706042137","issue_url":"https://api.github.com/repos/apache/ratis/issues/911","id":1706042137,"node_id":"IC_kwDOBMxbGc5lsCMZ","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-05T06:50:58Z","updated_at":"2023-09-05T06:50:58Z","author_association":"CONTRIBUTOR","body":"@szetszwo it looks like you already addressed the issue reported by Ozone four years ago, which is really cool. Thank you for your thorough work!!!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1706042137/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1706862563","html_url":"https://github.com/apache/ratis/pull/914#issuecomment-1706862563","issue_url":"https://api.github.com/repos/apache/ratis/issues/914","id":1706862563,"node_id":"IC_kwDOBMxbGc5lvKfj","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-05T15:41:58Z","updated_at":"2023-09-05T15:41:58Z","author_association":"CONTRIBUTOR","body":"@Brokenice0415 , Indeed, `TestRaftReconfigurationWithGrpc.testBootstrapReconf()` failed and the failure can be reproduced.  Could you take a look?\r\n\r\nBTW, thanks a lot for working on this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1706862563/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1706889470","html_url":"https://github.com/apache/ratis/pull/915#issuecomment-1706889470","issue_url":"https://api.github.com/repos/apache/ratis/issues/915","id":1706889470,"node_id":"IC_kwDOBMxbGc5lvRD-","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-05T15:55:09Z","updated_at":"2023-09-05T15:55:09Z","author_association":"CONTRIBUTOR","body":"> Maybe we should recommend users to set a retry cache expiration duration longer than the client retry-waiting duration?\r\n\r\nYes, it is a must.  RetryCache is to tolerate client retries.  The cache expiration must be longer than the client retry.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1706889470/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1706950095","html_url":"https://github.com/apache/ratis/pull/914#issuecomment-1706950095","issue_url":"https://api.github.com/repos/apache/ratis/issues/914","id":1706950095,"node_id":"IC_kwDOBMxbGc5lvf3P","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-05T16:26:20Z","updated_at":"2023-09-05T16:26:20Z","author_association":"MEMBER","body":"> The follower cannot clear the existing log. Otherwise, the committed entries can be removed.\r\n\r\nTotally agree. That's the exact reason why the test fails. In `testBootstrapReconf`, we first start the new servers [here](https://github.com/apache/ratis/blob/88405b037ac9db4471603dfdd8ddc7c542f0229c/ratis-server/src/test/java/org/apache/ratis/server/impl/RaftReconfigurationBaseTest.java#L405), but then restart the same new servers again [here](https://github.com/apache/ratis/blob/88405b037ac9db4471603dfdd8ddc7c542f0229c/ratis-server/src/test/java/org/apache/ratis/server/impl/RaftReconfigurationBaseTest.java#L425). The tests will pass if we set `startNewPeer` to false.\r\n\r\nI agree that we should enforce matchIndex safety. Thought `testBootstrapReconf` was a deliberate test for robustness before.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1706950095/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1706961606","html_url":"https://github.com/apache/ratis/pull/915#issuecomment-1706961606","issue_url":"https://api.github.com/repos/apache/ratis/issues/915","id":1706961606,"node_id":"IC_kwDOBMxbGc5lvirG","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-05T16:44:23Z","updated_at":"2023-09-05T16:44:46Z","author_association":"MEMBER","body":"> Yes, it is a must. RetryCache is to tolerate client retries. The cache expiration must be longer than the client retry.\r\n\r\n@szetszwo Thanks for the review! Added reminders in docs about this restriction.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1706961606/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1706966094","html_url":"https://github.com/apache/ratis/pull/914#issuecomment-1706966094","issue_url":"https://api.github.com/repos/apache/ratis/issues/914","id":1706966094,"node_id":"IC_kwDOBMxbGc5lvjxO","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-05T16:47:40Z","updated_at":"2023-09-05T16:47:40Z","author_association":"CONTRIBUTOR","body":"> ... In testBootstrapReconf, we first start the new servers [here](https://github.com/apache/ratis/blob/88405b037ac9db4471603dfdd8ddc7c542f0229c/ratis-server/src/test/java/org/apache/ratis/server/impl/RaftReconfigurationBaseTest.java#L405), but then restart the same new servers again [here](https://github.com/apache/ratis/blob/88405b037ac9db4471603dfdd8ddc7c542f0229c/ratis-server/src/test/java/org/apache/ratis/server/impl/RaftReconfigurationBaseTest.java#L425). ...\r\n\r\nWould it work if we don't format the new peer again?  Anyway, we should fix the test then.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1706966094/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1706973176","html_url":"https://github.com/apache/ratis/pull/915#issuecomment-1706973176","issue_url":"https://api.github.com/repos/apache/ratis/issues/915","id":1706973176,"node_id":"IC_kwDOBMxbGc5lvlf4","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-05T16:52:53Z","updated_at":"2023-09-05T16:52:53Z","author_association":"MEMBER","body":"This change also happens to address another long-standing issue that had been bothering me. We occasionally encountered the 'apply twice' problem, and I had previously believed that the only solution was to add a retry cache to the state machine to definitively eliminate this possibility. However, it turns out that we can resolve the issue simply by setting a longer expiration timeout. Problem solved!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1706973176/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1707108376","html_url":"https://github.com/apache/ratis/pull/915#issuecomment-1707108376","issue_url":"https://api.github.com/repos/apache/ratis/issues/915","id":1707108376,"node_id":"IC_kwDOBMxbGc5lwGgY","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-05T18:25:19Z","updated_at":"2023-09-05T18:25:19Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , please file a new JIRA instead of reusing a previous JIRA.  It is easier to track.  :)","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1707108376/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1707520743","html_url":"https://github.com/apache/ratis/pull/915#issuecomment-1707520743","issue_url":"https://api.github.com/repos/apache/ratis/issues/915","id":1707520743,"node_id":"IC_kwDOBMxbGc5lxrLn","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-06T01:37:00Z","updated_at":"2023-09-06T01:37:00Z","author_association":"MEMBER","body":"@szetszwo Thanks for merging this and the reminding! I will use a new jira next time.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1707520743/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1707617608","html_url":"https://github.com/apache/ratis/pull/914#issuecomment-1707617608","issue_url":"https://api.github.com/repos/apache/ratis/issues/914","id":1707617608,"node_id":"IC_kwDOBMxbGc5lyC1I","user":{"login":"Brokenice0415","id":44429817,"node_id":"MDQ6VXNlcjQ0NDI5ODE3","avatar_url":"https://avatars.githubusercontent.com/u/44429817?v=4","gravatar_id":"","url":"https://api.github.com/users/Brokenice0415","html_url":"https://github.com/Brokenice0415","followers_url":"https://api.github.com/users/Brokenice0415/followers","following_url":"https://api.github.com/users/Brokenice0415/following{/other_user}","gists_url":"https://api.github.com/users/Brokenice0415/gists{/gist_id}","starred_url":"https://api.github.com/users/Brokenice0415/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Brokenice0415/subscriptions","organizations_url":"https://api.github.com/users/Brokenice0415/orgs","repos_url":"https://api.github.com/users/Brokenice0415/repos","events_url":"https://api.github.com/users/Brokenice0415/events{/privacy}","received_events_url":"https://api.github.com/users/Brokenice0415/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-06T03:56:38Z","updated_at":"2023-09-06T03:56:38Z","author_association":"CONTRIBUTOR","body":"> @Brokenice0415 , Indeed, `TestRaftReconfigurationWithGrpc.testBootstrapReconf()` failed and the failure can be reproduced. Could you take a look?\r\n> \r\n> BTW, thanks a lot for working on this!\r\n\r\nI tried to skip formatting the new peer when test `TestRaftReconfigurationWithGrpc.testBootstrapReconf()` when testing locally, and the tests will pass successfully. I think the deliberate fomat is the exact reason for the test failure.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1707617608/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1710510002","html_url":"https://github.com/apache/ratis/pull/914#issuecomment-1710510002","issue_url":"https://api.github.com/repos/apache/ratis/issues/914","id":1710510002,"node_id":"IC_kwDOBMxbGc5l9E-y","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-07T17:10:46Z","updated_at":"2023-09-07T17:10:46Z","author_association":"CONTRIBUTOR","body":"![image](https://github.com/apache/ratis/assets/907380/9b5e13ab-9d4e-4dc3-8331-5fe12faf9181)\r\nNot sure why the other commits are included in the \"File changed\".","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1710510002/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1710572043","html_url":"https://github.com/apache/ratis/pull/914#issuecomment-1710572043","issue_url":"https://api.github.com/repos/apache/ratis/issues/914","id":1710572043,"node_id":"IC_kwDOBMxbGc5l9UIL","user":{"login":"Brokenice0415","id":44429817,"node_id":"MDQ6VXNlcjQ0NDI5ODE3","avatar_url":"https://avatars.githubusercontent.com/u/44429817?v=4","gravatar_id":"","url":"https://api.github.com/users/Brokenice0415","html_url":"https://github.com/Brokenice0415","followers_url":"https://api.github.com/users/Brokenice0415/followers","following_url":"https://api.github.com/users/Brokenice0415/following{/other_user}","gists_url":"https://api.github.com/users/Brokenice0415/gists{/gist_id}","starred_url":"https://api.github.com/users/Brokenice0415/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Brokenice0415/subscriptions","organizations_url":"https://api.github.com/users/Brokenice0415/orgs","repos_url":"https://api.github.com/users/Brokenice0415/repos","events_url":"https://api.github.com/users/Brokenice0415/events{/privacy}","received_events_url":"https://api.github.com/users/Brokenice0415/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-07T18:03:31Z","updated_at":"2023-09-07T18:03:31Z","author_association":"CONTRIBUTOR","body":"> ![image](https://user-images.githubusercontent.com/907380/266391956-9b5e13ab-9d4e-4dc3-8331-5fe12faf9181.png) Not sure why the other commits are included in the \"File changed\".\r\n\r\nOpps... My mistake. I have fixed it now.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1710572043/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1712709142","html_url":"https://github.com/apache/ratis/pull/913#issuecomment-1712709142","issue_url":"https://api.github.com/repos/apache/ratis/issues/913","id":1712709142,"node_id":"IC_kwDOBMxbGc5mFd4W","user":{"login":"tisonkun","id":18818196,"node_id":"MDQ6VXNlcjE4ODE4MTk2","avatar_url":"https://avatars.githubusercontent.com/u/18818196?v=4","gravatar_id":"","url":"https://api.github.com/users/tisonkun","html_url":"https://github.com/tisonkun","followers_url":"https://api.github.com/users/tisonkun/followers","following_url":"https://api.github.com/users/tisonkun/following{/other_user}","gists_url":"https://api.github.com/users/tisonkun/gists{/gist_id}","starred_url":"https://api.github.com/users/tisonkun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tisonkun/subscriptions","organizations_url":"https://api.github.com/users/tisonkun/orgs","repos_url":"https://api.github.com/users/tisonkun/repos","events_url":"https://api.github.com/users/tisonkun/events{/privacy}","received_events_url":"https://api.github.com/users/tisonkun/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-10T04:46:27Z","updated_at":"2023-09-10T04:46:27Z","author_association":"MEMBER","body":"Cool! I'm checking this out.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1712709142/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1712709183","html_url":"https://github.com/apache/ratis/pull/913#issuecomment-1712709183","issue_url":"https://api.github.com/repos/apache/ratis/issues/913","id":1712709183,"node_id":"IC_kwDOBMxbGc5mFd4_","user":{"login":"tisonkun","id":18818196,"node_id":"MDQ6VXNlcjE4ODE4MTk2","avatar_url":"https://avatars.githubusercontent.com/u/18818196?v=4","gravatar_id":"","url":"https://api.github.com/users/tisonkun","html_url":"https://github.com/tisonkun","followers_url":"https://api.github.com/users/tisonkun/followers","following_url":"https://api.github.com/users/tisonkun/following{/other_user}","gists_url":"https://api.github.com/users/tisonkun/gists{/gist_id}","starred_url":"https://api.github.com/users/tisonkun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tisonkun/subscriptions","organizations_url":"https://api.github.com/users/tisonkun/orgs","repos_url":"https://api.github.com/users/tisonkun/repos","events_url":"https://api.github.com/users/tisonkun/events{/privacy}","received_events_url":"https://api.github.com/users/tisonkun/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-10T04:46:46Z","updated_at":"2023-09-10T04:46:46Z","author_association":"MEMBER","body":"May I ask what is the target release version of this feature?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1712709183/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1714302837","html_url":"https://github.com/apache/ratis/pull/910#issuecomment-1714302837","issue_url":"https://api.github.com/repos/apache/ratis/issues/910","id":1714302837,"node_id":"IC_kwDOBMxbGc5mLi91","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-11T17:29:29Z","updated_at":"2023-09-11T17:29:29Z","author_association":"CONTRIBUTOR","body":"@guohao-rosicky , some tests were failing.  Could you take a look?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1714302837/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1716149464","html_url":"https://github.com/apache/ratis/pull/913#issuecomment-1716149464","issue_url":"https://api.github.com/repos/apache/ratis/issues/913","id":1716149464,"node_id":"IC_kwDOBMxbGc5mSlzY","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-12T17:32:28Z","updated_at":"2023-09-12T17:32:28Z","author_association":"CONTRIBUTOR","body":"We should include this to both 3.0.0 and the next branch 2 releases.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1716149464/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1719530919","html_url":"https://github.com/apache/ratis/pull/898#issuecomment-1719530919","issue_url":"https://api.github.com/repos/apache/ratis/issues/898","id":1719530919,"node_id":"IC_kwDOBMxbGc5mffWn","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-14T14:09:47Z","updated_at":"2023-09-14T14:09:47Z","author_association":"MEMBER","body":"@szetszwo Thanks very much for the detailed review! I'll elaborate the leader changing process. (may be in next PR). ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1719530919/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1720712795","html_url":"https://github.com/apache/ratis/pull/919#issuecomment-1720712795","issue_url":"https://api.github.com/repos/apache/ratis/issues/919","id":1720712795,"node_id":"IC_kwDOBMxbGc5mj_5b","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-15T05:49:29Z","updated_at":"2023-09-15T05:49:29Z","author_association":"CONTRIBUTOR","body":"Hi @szetszwo @ChenSammi What do you think of this change?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1720712795/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1720866852","html_url":"https://github.com/apache/ratis/pull/920#issuecomment-1720866852","issue_url":"https://api.github.com/repos/apache/ratis/issues/920","id":1720866852,"node_id":"IC_kwDOBMxbGc5mklgk","user":{"login":"tisonkun","id":18818196,"node_id":"MDQ6VXNlcjE4ODE4MTk2","avatar_url":"https://avatars.githubusercontent.com/u/18818196?v=4","gravatar_id":"","url":"https://api.github.com/users/tisonkun","html_url":"https://github.com/tisonkun","followers_url":"https://api.github.com/users/tisonkun/followers","following_url":"https://api.github.com/users/tisonkun/following{/other_user}","gists_url":"https://api.github.com/users/tisonkun/gists{/gist_id}","starred_url":"https://api.github.com/users/tisonkun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tisonkun/subscriptions","organizations_url":"https://api.github.com/users/tisonkun/orgs","repos_url":"https://api.github.com/users/tisonkun/repos","events_url":"https://api.github.com/users/tisonkun/events{/privacy}","received_events_url":"https://api.github.com/users/tisonkun/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-15T08:15:31Z","updated_at":"2023-09-15T08:21:49Z","author_association":"MEMBER","body":"Tests failed on:\r\n\r\n>   TestRaftReconfigurationWithGrpc>RaftReconfigurationBaseTest.testBootstrapReconf:389->RaftReconfigurationBaseTest.lambda$testBootstrapReconf$10:389->RaftReconfigurationBaseTest.runTestBootstrapReconf:429 Â» Timeout Timed out waiting for condition.\r\n\r\nDoesn't seem related.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1720866852/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1721155193","html_url":"https://github.com/apache/ratis/pull/917#issuecomment-1721155193","issue_url":"https://api.github.com/repos/apache/ratis/issues/917","id":1721155193,"node_id":"IC_kwDOBMxbGc5mlr55","user":{"login":"chrisdutz","id":651105,"node_id":"MDQ6VXNlcjY1MTEwNQ==","avatar_url":"https://avatars.githubusercontent.com/u/651105?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisdutz","html_url":"https://github.com/chrisdutz","followers_url":"https://api.github.com/users/chrisdutz/followers","following_url":"https://api.github.com/users/chrisdutz/following{/other_user}","gists_url":"https://api.github.com/users/chrisdutz/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisdutz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisdutz/subscriptions","organizations_url":"https://api.github.com/users/chrisdutz/orgs","repos_url":"https://api.github.com/users/chrisdutz/repos","events_url":"https://api.github.com/users/chrisdutz/events{/privacy}","received_events_url":"https://api.github.com/users/chrisdutz/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-15T11:57:04Z","updated_at":"2023-09-15T11:57:04Z","author_association":"NONE","body":"Yeah ... sorry for the confusion ... will close this one.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1721155193/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1721544160","html_url":"https://github.com/apache/ratis/pull/917#issuecomment-1721544160","issue_url":"https://api.github.com/repos/apache/ratis/issues/917","id":1721544160,"node_id":"IC_kwDOBMxbGc5mnK3g","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-15T16:25:01Z","updated_at":"2023-09-15T16:25:01Z","author_association":"CONTRIBUTOR","body":"@chrisdutz , no problem.  Please let me know if `ratis-metrics-default` works for you.  If not, we could create a `ratis-metrics-dropwizard4` module.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1721544160/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1721554374","html_url":"https://github.com/apache/ratis/pull/920#issuecomment-1721554374","issue_url":"https://api.github.com/repos/apache/ratis/issues/920","id":1721554374,"node_id":"IC_kwDOBMxbGc5mnNXG","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-15T16:33:40Z","updated_at":"2023-09-15T16:33:40Z","author_association":"CONTRIBUTOR","body":"> Doesn't seem related.\r\n\r\nAgree.  Just have restarted the failed job.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1721554374/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1721573701","html_url":"https://github.com/apache/ratis/pull/917#issuecomment-1721573701","issue_url":"https://api.github.com/repos/apache/ratis/issues/917","id":1721573701,"node_id":"IC_kwDOBMxbGc5mnSFF","user":{"login":"chrisdutz","id":651105,"node_id":"MDQ6VXNlcjY1MTEwNQ==","avatar_url":"https://avatars.githubusercontent.com/u/651105?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisdutz","html_url":"https://github.com/chrisdutz","followers_url":"https://api.github.com/users/chrisdutz/followers","following_url":"https://api.github.com/users/chrisdutz/following{/other_user}","gists_url":"https://api.github.com/users/chrisdutz/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisdutz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisdutz/subscriptions","organizations_url":"https://api.github.com/users/chrisdutz/orgs","repos_url":"https://api.github.com/users/chrisdutz/repos","events_url":"https://api.github.com/users/chrisdutz/events{/privacy}","received_events_url":"https://api.github.com/users/chrisdutz/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-15T16:49:34Z","updated_at":"2023-09-15T16:49:34Z","author_association":"NONE","body":"Thing is, currently Apache IoTDB is consuming the oddly released artifacts from the snapshot2 branch ... I only came across problems as some modules were at different dropwizard versions and I needed that update in Ratis in order to streamline the versions. \r\nI would however imagine, that once 3.0.0 is released, we will pretty quickly transition to that. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1721573701/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1721599715","html_url":"https://github.com/apache/ratis/pull/917#issuecomment-1721599715","issue_url":"https://api.github.com/repos/apache/ratis/issues/917","id":1721599715,"node_id":"IC_kwDOBMxbGc5mnYbj","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-15T17:13:02Z","updated_at":"2023-09-15T17:13:02Z","author_association":"CONTRIBUTOR","body":"@chrisdutz , I see.  We probably will release Ratis 3.0.0 soon; see https://lists.apache.org/thread/wnkyy58d1btxy6h95325n0knv9fftfp8.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1721599715/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1722133370","html_url":"https://github.com/apache/ratis/pull/920#issuecomment-1722133370","issue_url":"https://api.github.com/repos/apache/ratis/issues/920","id":1722133370,"node_id":"IC_kwDOBMxbGc5mpat6","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-16T04:43:55Z","updated_at":"2023-09-16T04:43:55Z","author_association":"MEMBER","body":"@tisonkun Thanks a lot for the patch! It looks really concise.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1722133370/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1722839847","html_url":"https://github.com/apache/ratis/pull/922#issuecomment-1722839847","issue_url":"https://api.github.com/repos/apache/ratis/issues/922","id":1722839847,"node_id":"IC_kwDOBMxbGc5msHMn","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-18T06:50:10Z","updated_at":"2023-09-18T06:50:10Z","author_association":"CONTRIBUTOR","body":"@szetszwo PTAL!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1722839847/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1722893383","html_url":"https://github.com/apache/ratis/pull/921#issuecomment-1722893383","issue_url":"https://api.github.com/repos/apache/ratis/issues/921","id":1722893383,"node_id":"IC_kwDOBMxbGc5msURH","user":{"login":"ivandika3","id":36403683,"node_id":"MDQ6VXNlcjM2NDAzNjgz","avatar_url":"https://avatars.githubusercontent.com/u/36403683?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandika3","html_url":"https://github.com/ivandika3","followers_url":"https://api.github.com/users/ivandika3/followers","following_url":"https://api.github.com/users/ivandika3/following{/other_user}","gists_url":"https://api.github.com/users/ivandika3/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandika3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandika3/subscriptions","organizations_url":"https://api.github.com/users/ivandika3/orgs","repos_url":"https://api.github.com/users/ivandika3/repos","events_url":"https://api.github.com/users/ivandika3/events{/privacy}","received_events_url":"https://api.github.com/users/ivandika3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-18T07:38:51Z","updated_at":"2023-09-18T07:38:51Z","author_association":"CONTRIBUTOR","body":"@szetszwo @guohao-rosicky Could you help take a look if you have time?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1722893383/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1723361732","html_url":"https://github.com/apache/ratis/pull/921#issuecomment-1723361732","issue_url":"https://api.github.com/repos/apache/ratis/issues/921","id":1723361732,"node_id":"IC_kwDOBMxbGc5muGnE","user":{"login":"ivandika3","id":36403683,"node_id":"MDQ6VXNlcjM2NDAzNjgz","avatar_url":"https://avatars.githubusercontent.com/u/36403683?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandika3","html_url":"https://github.com/ivandika3","followers_url":"https://api.github.com/users/ivandika3/followers","following_url":"https://api.github.com/users/ivandika3/following{/other_user}","gists_url":"https://api.github.com/users/ivandika3/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandika3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandika3/subscriptions","organizations_url":"https://api.github.com/users/ivandika3/orgs","repos_url":"https://api.github.com/users/ivandika3/repos","events_url":"https://api.github.com/users/ivandika3/events{/privacy}","received_events_url":"https://api.github.com/users/ivandika3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-18T13:02:04Z","updated_at":"2023-09-18T13:02:04Z","author_association":"CONTRIBUTOR","body":"Successful CI run: https://github.com/ivandika3/ratis/actions/runs/6218919857","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1723361732/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1723419345","html_url":"https://github.com/apache/ratis/pull/922#issuecomment-1723419345","issue_url":"https://api.github.com/repos/apache/ratis/issues/922","id":1723419345,"node_id":"IC_kwDOBMxbGc5muUrR","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-18T13:33:10Z","updated_at":"2023-09-18T13:33:10Z","author_association":"MEMBER","body":"> It looks like the master branch doesn't have this issue, but we can cp this commit to a future 2.x release branch to circumvent some potential issues\r\n\r\nShall we merge the commit directly into branch2?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1723419345/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1724735264","html_url":"https://github.com/apache/ratis/pull/921#issuecomment-1724735264","issue_url":"https://api.github.com/repos/apache/ratis/issues/921","id":1724735264,"node_id":"IC_kwDOBMxbGc5mzV8g","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-19T02:22:03Z","updated_at":"2023-09-19T02:22:03Z","author_association":"CONTRIBUTOR","body":"Changes look largely good to me. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1724735264/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1724758960","html_url":"https://github.com/apache/ratis/pull/922#issuecomment-1724758960","issue_url":"https://api.github.com/repos/apache/ratis/issues/922","id":1724758960,"node_id":"IC_kwDOBMxbGc5mzbuw","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-19T02:55:51Z","updated_at":"2023-09-19T02:55:51Z","author_association":"CONTRIBUTOR","body":"> Shall we merge the commit directly into branch2?\r\n\r\nIâm ok with both solution :)","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1724758960/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725235204","html_url":"https://github.com/apache/ratis/pull/921#issuecomment-1725235204","issue_url":"https://api.github.com/repos/apache/ratis/issues/921","id":1725235204,"node_id":"IC_kwDOBMxbGc5m1QAE","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-19T10:24:51Z","updated_at":"2023-09-19T10:25:29Z","author_association":"CONTRIBUTOR","body":"LGTM~\r\n\r\nWe've noticed previously that evicting the cache during appendLog consumes a significant amount of CPU resources. We're hopeful that this PR will bring about a notable performance improvement.\r\n\r\nBTW, I'm wondering if it's necessary to check the cache log threshold exceeded limit every time we appendLog? Originally, traversing the list is a lightweight CPU operation, but due to its frequent invocation, it's incurring such a high CPU overhead, even if reduced to one traversal, it can't be ignored. If the LogSegment cache is now file-grained, could we further optimize it to only check when switching RaftLog? This might result in a slight loss of precision, but it could maximize the reduction in overhead on the critical write path.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725235204/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725239722","html_url":"https://github.com/apache/ratis/pull/921#issuecomment-1725239722","issue_url":"https://api.github.com/repos/apache/ratis/issues/921","id":1725239722,"node_id":"IC_kwDOBMxbGc5m1RGq","user":{"login":"ivandika3","id":36403683,"node_id":"MDQ6VXNlcjM2NDAzNjgz","avatar_url":"https://avatars.githubusercontent.com/u/36403683?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandika3","html_url":"https://github.com/ivandika3","followers_url":"https://api.github.com/users/ivandika3/followers","following_url":"https://api.github.com/users/ivandika3/following{/other_user}","gists_url":"https://api.github.com/users/ivandika3/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandika3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandika3/subscriptions","organizations_url":"https://api.github.com/users/ivandika3/orgs","repos_url":"https://api.github.com/users/ivandika3/repos","events_url":"https://api.github.com/users/ivandika3/events{/privacy}","received_events_url":"https://api.github.com/users/ivandika3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-19T10:28:11Z","updated_at":"2023-09-19T10:37:52Z","author_association":"CONTRIBUTOR","body":"Hi @SzyWilliam, we found some performance degradation in our Ozone cluster when we set `purge.preservation.log.num` (introduced in RATIS-1626) to a large number (30 million). The reason we set it quite high is to prevent follower to install snapshot from leader by downloading the leader's large DB. I suspect that causes a large number of close segments preserved which causes the `evictCache` to take a long time since it has to go through the closed segments twice.\r\n\r\nThe patch is https://issues.apache.org/jira/browse/HDDS-8131, if you are interested.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725239722/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725249304","html_url":"https://github.com/apache/ratis/pull/921#issuecomment-1725249304","issue_url":"https://api.github.com/repos/apache/ratis/issues/921","id":1725249304,"node_id":"IC_kwDOBMxbGc5m1TcY","user":{"login":"ivandika3","id":36403683,"node_id":"MDQ6VXNlcjM2NDAzNjgz","avatar_url":"https://avatars.githubusercontent.com/u/36403683?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandika3","html_url":"https://github.com/ivandika3","followers_url":"https://api.github.com/users/ivandika3/followers","following_url":"https://api.github.com/users/ivandika3/following{/other_user}","gists_url":"https://api.github.com/users/ivandika3/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandika3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandika3/subscriptions","organizations_url":"https://api.github.com/users/ivandika3/orgs","repos_url":"https://api.github.com/users/ivandika3/repos","events_url":"https://api.github.com/users/ivandika3/events{/privacy}","received_events_url":"https://api.github.com/users/ivandika3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-19T10:35:14Z","updated_at":"2023-09-19T10:36:31Z","author_association":"CONTRIBUTOR","body":"@OneSizeFitsQuorum I think the previous contributors noted the possibility of using a separate daemon thread to `checkAndEvictCache` so that it's not in the write path. Maybe worthwhile issue to tackle.\r\n\r\n```java\r\n//TODO(runzhiwang): If there is performance problem, start a daemon thread to checkAndEvictCache\r\n      checkAndEvictCache();\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725249304/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725705313","html_url":"https://github.com/apache/ratis/pull/921#issuecomment-1725705313","issue_url":"https://api.github.com/repos/apache/ratis/issues/921","id":1725705313,"node_id":"IC_kwDOBMxbGc5m3Cxh","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-19T14:21:06Z","updated_at":"2023-09-19T14:21:06Z","author_association":"MEMBER","body":"> I suspect that causes a large number of close segments preserved which causes the evictCache to take a long time since it has to go through the closed segments twice.\r\n\r\nIt sounds that there are slow followers.\r\n\r\n> If the LogSegment cache is now file-grained, could we further optimize it to only check when switching RaftLog?\r\n\r\n+1, we may cache the computed results and only update them incrementally, as the case in `LogSegmentList#sizeInBytes`.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725705313/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725849486","html_url":"https://github.com/apache/ratis/pull/898#issuecomment-1725849486","issue_url":"https://api.github.com/repos/apache/ratis/issues/898","id":1725849486,"node_id":"IC_kwDOBMxbGc5m3l-O","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-19T15:11:40Z","updated_at":"2023-09-19T15:11:40Z","author_association":"MEMBER","body":"Made changes on code. @szetszwo @OneSizeFitsQuorum PTAL, thanks!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725849486/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725907283","html_url":"https://github.com/apache/ratis/pull/921#issuecomment-1725907283","issue_url":"https://api.github.com/repos/apache/ratis/issues/921","id":1725907283,"node_id":"IC_kwDOBMxbGc5m30FT","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-19T15:36:41Z","updated_at":"2023-09-19T15:36:41Z","author_association":"CONTRIBUTOR","body":"> If not, shall we consider making this eviction operation less frequent?\r\n\r\nWe do eviction only if there is a violation.\r\n\r\nhttps://github.com/apache/ratis/blob/05f39221102abc00b2934e279da872d06f6a1811/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLogCache.java#L418-L420\r\n\r\nI suspect the current `CacheInvalidationPolicyDefault` is inefficient -- the code looks complicated.  We may make the operation async.  Then, it won't affect the append operation.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725907283/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725910235","html_url":"https://github.com/apache/ratis/pull/921#issuecomment-1725910235","issue_url":"https://api.github.com/repos/apache/ratis/issues/921","id":1725910235,"node_id":"IC_kwDOBMxbGc5m30zb","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-19T15:38:10Z","updated_at":"2023-09-19T15:38:10Z","author_association":"CONTRIBUTOR","body":"> ... . If the LogSegment cache is now file-grained, could we further optimize it to only check when switching RaftLog?  ...\r\n\r\nThis is a good idea.  Let me think about it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725910235/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725912397","html_url":"https://github.com/apache/ratis/pull/921#issuecomment-1725912397","issue_url":"https://api.github.com/repos/apache/ratis/issues/921","id":1725912397,"node_id":"IC_kwDOBMxbGc5m31VN","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-19T15:39:26Z","updated_at":"2023-09-19T15:39:26Z","author_association":"CONTRIBUTOR","body":"> ... the possibility of using a separate daemon thread to checkAndEvictCache so that it's not in the write path. Maybe worthwhile issue to tackle.\r\n\r\nAgree.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1725912397/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1726641574","html_url":"https://github.com/apache/ratis/pull/921#issuecomment-1726641574","issue_url":"https://api.github.com/repos/apache/ratis/issues/921","id":1726641574,"node_id":"IC_kwDOBMxbGc5m6nWm","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-19T22:50:46Z","updated_at":"2023-09-19T22:50:46Z","author_association":"CONTRIBUTOR","body":"```java\r\n//TODO(runzhiwang): If there is performance problem, start a daemon thread to checkAndEvictCache\r\n      checkAndEvictCache();\r\n```\r\n\r\nFiled RATIS-1893.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1726641574/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1726736119","html_url":"https://github.com/apache/ratis/pull/921#issuecomment-1726736119","issue_url":"https://api.github.com/repos/apache/ratis/issues/921","id":1726736119,"node_id":"IC_kwDOBMxbGc5m6-b3","user":{"login":"ivandika3","id":36403683,"node_id":"MDQ6VXNlcjM2NDAzNjgz","avatar_url":"https://avatars.githubusercontent.com/u/36403683?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandika3","html_url":"https://github.com/ivandika3","followers_url":"https://api.github.com/users/ivandika3/followers","following_url":"https://api.github.com/users/ivandika3/following{/other_user}","gists_url":"https://api.github.com/users/ivandika3/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandika3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandika3/subscriptions","organizations_url":"https://api.github.com/users/ivandika3/orgs","repos_url":"https://api.github.com/users/ivandika3/repos","events_url":"https://api.github.com/users/ivandika3/events{/privacy}","received_events_url":"https://api.github.com/users/ivandika3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-20T01:06:49Z","updated_at":"2023-09-20T01:06:49Z","author_association":"CONTRIBUTOR","body":"Thank you @szetszwo @guohao-rosicky @SzyWilliam @OneSizeFitsQuorum for the reviews.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1726736119/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1728106815","html_url":"https://github.com/apache/ratis/pull/924#issuecomment-1728106815","issue_url":"https://api.github.com/repos/apache/ratis/issues/924","id":1728106815,"node_id":"IC_kwDOBMxbGc5nANE_","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-20T16:50:42Z","updated_at":"2023-09-20T16:50:42Z","author_association":"CONTRIBUTOR","body":"> I'm wondering if an asynchronous thread would be a more elegant design. It looks like it would require a big change in cache concurrency control.\r\n\r\nThe `daemon` in `AwaitToRun` is an asynchronous thread.\r\n\r\n> If my subsequent review holds true, perhaps we could contemplate managing it within the primary appendLog flow but trigger it less frequently, maybe when transitioning the raftlog. This could potentially reduce implementation complexity.\r\n>\r\n> What's your opinion?\r\n\r\nIn `appendEntryImpl`, how about we evict cache only after `rollOpenSegment`?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1728106815/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1730682864","html_url":"https://github.com/apache/ratis/pull/898#issuecomment-1730682864","issue_url":"https://api.github.com/repos/apache/ratis/issues/898","id":1730682864,"node_id":"IC_kwDOBMxbGc5nKB_w","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-22T01:55:29Z","updated_at":"2023-09-22T01:55:29Z","author_association":"MEMBER","body":"@szetszwo @OneSizeFitsQuorum Thanks a lot for your careful and thorough reviews!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1730682864/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1732248848","html_url":"https://github.com/apache/ratis/pull/918#issuecomment-1732248848","issue_url":"https://api.github.com/repos/apache/ratis/issues/918","id":1732248848,"node_id":"IC_kwDOBMxbGc5nQAUQ","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-23T08:06:04Z","updated_at":"2023-09-23T08:06:04Z","author_association":"MEMBER","body":"+1 the changes looks good. Thanks very much for the patch, @chrisdutz !","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1732248848/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1732375570","html_url":"https://github.com/apache/ratis/pull/924#issuecomment-1732375570","issue_url":"https://api.github.com/repos/apache/ratis/issues/924","id":1732375570,"node_id":"IC_kwDOBMxbGc5nQfQS","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-23T17:53:10Z","updated_at":"2023-09-23T17:53:10Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , thanks  a lot for reviewing this!\r\n\r\n> ..., shall we also evict the cache here?\r\n\r\nGood catch!  We should signal cacheEviction there.  Just have updated the change.  Please take a look.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1732375570/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1732839592","html_url":"https://github.com/apache/ratis/pull/926#issuecomment-1732839592","issue_url":"https://api.github.com/repos/apache/ratis/issues/926","id":1732839592,"node_id":"IC_kwDOBMxbGc5nSQio","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-25T03:15:06Z","updated_at":"2023-09-25T03:37:40Z","author_association":"CONTRIBUTOR","body":"I'm pondering why we should update `nextIndex` when we receive a successful response. At this point, the GrpcLogAppender thread's streaming send may have already sent it to a larger index. If we reduce `nextIndex` in response to a smaller `matchIndex + 1`, even we fix this exception in this pr, it would still lead to the retransmission of many logs that have already been sent, which may affect write performance seriously when pipeline is full.\r\n\r\nI checked the example in the [issue](https://issues.apache.org/jira/browse/RATIS-1883) that introduced this problem, and I feel that the 7th step in the middle might be a typo; it should probably indicate that it was log [5]. \r\n<img width=\"1382\" alt=\"image\" src=\"https://github.com/apache/ratis/assets/32640567/b1d9ccbb-6052-42e9-95aa-ca7ff0657dcc\">\r\n\r\nAs far as I recall, gRPC's streaming interface can guarantee sequential semantics, so there shouldn't be a situation where responses sent later arrive earlier. Therefore, could it be that the example in that issue doesn't exist actually?\r\n\r\nIf the above statement is correct, maybe we can still lower nextIndex as before, only when the snapshot is transferred or some inconsistency is found, and we can leave nextIndex unchanged when we receive a correct response.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1732839592/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1733022581","html_url":"https://github.com/apache/ratis/pull/918#issuecomment-1733022581","issue_url":"https://api.github.com/repos/apache/ratis/issues/918","id":1733022581,"node_id":"IC_kwDOBMxbGc5nS9N1","user":{"login":"chrisdutz","id":651105,"node_id":"MDQ6VXNlcjY1MTEwNQ==","avatar_url":"https://avatars.githubusercontent.com/u/651105?v=4","gravatar_id":"","url":"https://api.github.com/users/chrisdutz","html_url":"https://github.com/chrisdutz","followers_url":"https://api.github.com/users/chrisdutz/followers","following_url":"https://api.github.com/users/chrisdutz/following{/other_user}","gists_url":"https://api.github.com/users/chrisdutz/gists{/gist_id}","starred_url":"https://api.github.com/users/chrisdutz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chrisdutz/subscriptions","organizations_url":"https://api.github.com/users/chrisdutz/orgs","repos_url":"https://api.github.com/users/chrisdutz/repos","events_url":"https://api.github.com/users/chrisdutz/events{/privacy}","received_events_url":"https://api.github.com/users/chrisdutz/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-25T06:48:35Z","updated_at":"2023-09-25T06:48:35Z","author_association":"NONE","body":"Have the artifacts been deployed to repository.apache.org? A quick look showed me they haven't ...\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1733022581/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1733113212","html_url":"https://github.com/apache/ratis/pull/926#issuecomment-1733113212","issue_url":"https://api.github.com/repos/apache/ratis/issues/926","id":1733113212,"node_id":"IC_kwDOBMxbGc5nTTV8","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-25T07:54:34Z","updated_at":"2023-09-25T07:54:34Z","author_association":"MEMBER","body":"@OneSizeFitsQuorum thanks a lot for the reviews!\r\n> I checked the example in the [issue](https://issues.apache.org/jira/browse/RATIS-1883) that introduced this problem, and I feel that the 7th step in the middle might be a typo; it should probably indicate that it was log [5].\r\n\r\nIt's a bit tricky. The log[4] follower received in 7th step is sent by step 3, not by step 6.\r\n\r\n> If we reduce nextIndex in response to a smaller matchIndex + 1, even we fix this exception in this pr, it would still lead to the retransmission of many logs that have already been sent, which may affect write performance seriously when pipeline is full.\r\n\r\nI agree that we should not reduce nextIndex, and that's why original pr uses `increaseNextIndex`. `updateNextIndex` also will not reduce nextIndex. However, the difference between `increaseNextIndex` and `updateNextIndex` is that,\r\n* `increaseNextIndex` requires caller to make sure the updated value is larger, or an `IllegalStateException` will be thrown.\r\n* `updateNextIndex` will only update when the provided value is larger than original one.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1733113212/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1734733689","html_url":"https://github.com/apache/ratis/pull/926#issuecomment-1734733689","issue_url":"https://api.github.com/repos/apache/ratis/issues/926","id":1734733689,"node_id":"IC_kwDOBMxbGc5nZe95","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-26T02:31:04Z","updated_at":"2023-09-26T02:31:51Z","author_association":"CONTRIBUTOR","body":"> The log[4] follower received in 7th step is sent by step 3, not by step 6.\r\n\r\n@SzyWilliam Thanks a lot for the detailed explanation! Now I understand the process completely. LGTM~\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1734733689/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1734914623","html_url":"https://github.com/apache/ratis/pull/925#issuecomment-1734914623","issue_url":"https://api.github.com/repos/apache/ratis/issues/925","id":1734914623,"node_id":"IC_kwDOBMxbGc5naLI_","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-26T06:36:04Z","updated_at":"2023-09-26T06:36:04Z","author_association":"MEMBER","body":"> Is there a good reason to use LINEARIZABLE not LEASE?\r\n\r\nI believe we have.\r\n\r\nLINEARIZABLE should meet most requirements in typical scenarios. It allows followers to handle read requests while maintaining strict linearizability. This will be the default and recommended option to use in IoTDB.\r\n\r\nLEASE is designed for situations where low latency is crucial, even at the potential cost of linearizability violations. The use of LEASE is mandated by Alluxio @codings-dan. His experiments have demonstrated that in a 3-node cluster, using LINEARIZABLE alone results in only a 160% improvement in throughput due to latency, whereas theoretically, it could achieve a 300% improvement.\r\n\r\nNevertheless, IoTDB may consider employing this option if the potential benefits outweigh the drawbacks.\r\n\r\nAlso, I added revoke mechanisms during leader-transfer / stepDown. PTAL, thanks!\r\n@szetszwo @OneSizeFitsQuorum \r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1734914623/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1740304678","html_url":"https://github.com/apache/ratis/pull/929#issuecomment-1740304678","issue_url":"https://api.github.com/repos/apache/ratis/issues/929","id":1740304678,"node_id":"IC_kwDOBMxbGc5nuvEm","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-09-29T04:36:27Z","updated_at":"2023-09-29T04:37:04Z","author_association":"CONTRIBUTOR","body":"Found an unrelated NPE in the previous build: https://github.com/apache/ratis/actions/runs/6345236213/job/17236854118?pr=929#step:5:988\r\n```java\r\nCaused by: java.lang.NullPointerException: leaderState == null\r\n\tat org.apache.ratis.server.impl.RoleInfo.shutdownLeaderState(RoleInfo.java:89)\r\n\tat org.apache.ratis.server.impl.RaftServerImpl.changeToFollower(RaftServerImpl.java:584)\r\n\tat org.apache.ratis.server.impl.RaftServerImpl.changeToFollowerAndPersistMetadata(RaftServerImpl.java:601)\r\n\tat org.apache.ratis.server.impl.LeaderStateImpl.stepDown(LeaderStateImpl.java:676)\r\n\tat org.apache.ratis.server.impl.LeaderStateImpl.checkLeadership(LeaderStateImpl.java:1080)\r\n\tat org.apache.ratis.server.impl.LeaderStateImpl$EventProcessor.run(LeaderStateImpl.java:738)\r\n```\r\nWill fix here since it is just a one line fix.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1740304678/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1741914724","html_url":"https://github.com/apache/ratis/pull/928#issuecomment-1741914724","issue_url":"https://api.github.com/repos/apache/ratis/issues/928","id":1741914724,"node_id":"IC_kwDOBMxbGc5n04Jk","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-01T01:23:25Z","updated_at":"2023-10-01T01:23:25Z","author_association":"MEMBER","body":"@codings-dan Thanks a lot for the reviews and the tests! I'm merging this PR now.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1741914724/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1745296442","html_url":"https://github.com/apache/ratis/pull/929#issuecomment-1745296442","issue_url":"https://api.github.com/repos/apache/ratis/issues/929","id":1745296442,"node_id":"IC_kwDOBMxbGc5oBxw6","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-03T16:10:14Z","updated_at":"2023-10-03T16:10:14Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , Thanks a lot for reviewing this!\r\n\r\nOops, I did not change the default to 1ms.  Could you take a look again?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1745296442/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1746537021","html_url":"https://github.com/apache/ratis/pull/931#issuecomment-1746537021","issue_url":"https://api.github.com/repos/apache/ratis/issues/931","id":1746537021,"node_id":"IC_kwDOBMxbGc5oGgo9","user":{"login":"ivandika3","id":36403683,"node_id":"MDQ6VXNlcjM2NDAzNjgz","avatar_url":"https://avatars.githubusercontent.com/u/36403683?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandika3","html_url":"https://github.com/ivandika3","followers_url":"https://api.github.com/users/ivandika3/followers","following_url":"https://api.github.com/users/ivandika3/following{/other_user}","gists_url":"https://api.github.com/users/ivandika3/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandika3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandika3/subscriptions","organizations_url":"https://api.github.com/users/ivandika3/orgs","repos_url":"https://api.github.com/users/ivandika3/repos","events_url":"https://api.github.com/users/ivandika3/events{/privacy}","received_events_url":"https://api.github.com/users/ivandika3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-04T09:56:47Z","updated_at":"2023-10-04T10:02:42Z","author_association":"CONTRIBUTOR","body":"@szetszwo @guohao-rosicky Could you help take a look if you have time?\r\n\r\n@guohao-rosicky It seems that the epoll configuration is introduced on RATIS-1521. Do you use it in your cluster, and if so, are there any performance benefits compared to using the `NioEventLoopGroup`? Also in the `NettyClientStreamRpc` it seems that epoll is never used (in RATIS-1549), do you know why is this so?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1746537021/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1747135771","html_url":"https://github.com/apache/ratis/pull/929#issuecomment-1747135771","issue_url":"https://api.github.com/repos/apache/ratis/issues/929","id":1747135771,"node_id":"IC_kwDOBMxbGc5oIy0b","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-04T15:32:28Z","updated_at":"2023-10-04T15:32:28Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , @codings-dan , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1747135771/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1747860049","html_url":"https://github.com/apache/ratis/pull/931#issuecomment-1747860049","issue_url":"https://api.github.com/repos/apache/ratis/issues/931","id":1747860049,"node_id":"IC_kwDOBMxbGc5oLjpR","user":{"login":"ivandika3","id":36403683,"node_id":"MDQ6VXNlcjM2NDAzNjgz","avatar_url":"https://avatars.githubusercontent.com/u/36403683?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandika3","html_url":"https://github.com/ivandika3","followers_url":"https://api.github.com/users/ivandika3/followers","following_url":"https://api.github.com/users/ivandika3/following{/other_user}","gists_url":"https://api.github.com/users/ivandika3/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandika3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandika3/subscriptions","organizations_url":"https://api.github.com/users/ivandika3/orgs","repos_url":"https://api.github.com/users/ivandika3/repos","events_url":"https://api.github.com/users/ivandika3/events{/privacy}","received_events_url":"https://api.github.com/users/ivandika3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-05T00:46:15Z","updated_at":"2023-10-05T00:46:15Z","author_association":"CONTRIBUTOR","body":"Thank you for the review @szetszwo.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1747860049/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1750324631","html_url":"https://github.com/apache/ratis/pull/932#issuecomment-1750324631","issue_url":"https://api.github.com/repos/apache/ratis/issues/932","id":1750324631,"node_id":"IC_kwDOBMxbGc5oU9WX","user":{"login":"ivandika3","id":36403683,"node_id":"MDQ6VXNlcjM2NDAzNjgz","avatar_url":"https://avatars.githubusercontent.com/u/36403683?v=4","gravatar_id":"","url":"https://api.github.com/users/ivandika3","html_url":"https://github.com/ivandika3","followers_url":"https://api.github.com/users/ivandika3/followers","following_url":"https://api.github.com/users/ivandika3/following{/other_user}","gists_url":"https://api.github.com/users/ivandika3/gists{/gist_id}","starred_url":"https://api.github.com/users/ivandika3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivandika3/subscriptions","organizations_url":"https://api.github.com/users/ivandika3/orgs","repos_url":"https://api.github.com/users/ivandika3/repos","events_url":"https://api.github.com/users/ivandika3/events{/privacy}","received_events_url":"https://api.github.com/users/ivandika3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-06T10:00:45Z","updated_at":"2023-10-06T10:00:45Z","author_association":"CONTRIBUTOR","body":"Hi @szetszwo , I left out Netty proxies in RATIS-1898, I have added in this patch. Could you help take a look?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1750324631/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1752000968","html_url":"https://github.com/apache/ratis/pull/910#issuecomment-1752000968","issue_url":"https://api.github.com/repos/apache/ratis/issues/910","id":1752000968,"node_id":"IC_kwDOBMxbGc5obWnI","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-08T11:14:09Z","updated_at":"2023-10-08T12:12:59Z","author_association":"CONTRIBUTOR","body":"> @guohao-rosicky , some tests were failing. Could you take a look?\r\n\r\nThanks @szetszwo for the review. Ci passed, see: https://github.com/guohao-rosicky/ratis/actions/runs/6447289333\r\n\r\nBy the way: I don't have the ByteToMessageDecoder related set to shared, as far as I know it doesn't support sharing.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1752000968/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1753314088","html_url":"https://github.com/apache/ratis/pull/910#issuecomment-1753314088","issue_url":"https://api.github.com/repos/apache/ratis/issues/910","id":1753314088,"node_id":"IC_kwDOBMxbGc5ogXMo","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-09T16:24:49Z","updated_at":"2023-10-10T15:35:41Z","author_association":"CONTRIBUTOR","body":"@guohao-rosicky , thanks for working on this!\r\n\r\nBTW, could you send an email to me?  I would like to send you something.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1753314088/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1754309216","html_url":"https://github.com/apache/ratis/pull/910#issuecomment-1754309216","issue_url":"https://api.github.com/repos/apache/ratis/issues/910","id":1754309216,"node_id":"IC_kwDOBMxbGc5okKJg","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-10T03:47:59Z","updated_at":"2023-10-10T15:36:34Z","author_association":"CONTRIBUTOR","body":"> BTW, could you send an email to me? I would like to send you something.\r\n\r\nHi, @szetszwo, Email has been sent to you, my email is (...), we can communicate by email!\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1754309216/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1754780767","html_url":"https://github.com/apache/ratis/pull/930#issuecomment-1754780767","issue_url":"https://api.github.com/repos/apache/ratis/issues/930","id":1754780767,"node_id":"IC_kwDOBMxbGc5ol9Rf","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-10T09:10:44Z","updated_at":"2023-10-10T09:10:44Z","author_association":"MEMBER","body":"`testTransactionContextIsPassedBack` failed constantly. In my local env,\r\n```java\r\njava.lang.AssertionError\r\norg.apache.ratis.statemachine.TestStateMachine$SMTransactionContext.applyTransaction(TestStateMachine.java:94)\r\n\tat org.apache.ratis.server.impl.RaftServerImpl.applyLogToStateMachine(RaftServerImpl.java:1842)\r\n\tat org.apache.ratis.server.impl.StateMachineUpdater.applyLog(StateMachineUpdater.java:244)\r\n\tat org.apache.ratis.server.impl.StateMachineUpdater.run(StateMachineUpdater.java:186)\r\n\tat java.lang.Thread.run(Thread.java:750)\r\n```\r\nGuess it's related to `getTransactionContext`. The leader somehow cannot obtain the client request from transaction context.\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1754780767/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1755706878","html_url":"https://github.com/apache/ratis/pull/910#issuecomment-1755706878","issue_url":"https://api.github.com/repos/apache/ratis/issues/910","id":1755706878,"node_id":"IC_kwDOBMxbGc5opfX-","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-10T15:36:47Z","updated_at":"2023-10-10T15:36:47Z","author_association":"CONTRIBUTOR","body":"@guohao-rosicky , thanks.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1755706878/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1755956582","html_url":"https://github.com/apache/ratis/pull/930#issuecomment-1755956582","issue_url":"https://api.github.com/repos/apache/ratis/issues/930","id":1755956582,"node_id":"IC_kwDOBMxbGc5oqcVm","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-10T17:59:10Z","updated_at":"2023-10-10T17:59:10Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , you are right that there is a bug in `getTransactionContext`.  It should also check leader when `createNew == true`.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1755956582/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1756118522","html_url":"https://github.com/apache/ratis/pull/927#issuecomment-1756118522","issue_url":"https://api.github.com/repos/apache/ratis/issues/927","id":1756118522,"node_id":"IC_kwDOBMxbGc5orD36","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-10T19:46:32Z","updated_at":"2023-10-10T19:46:32Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1756118522/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1756191739","html_url":"https://github.com/apache/ratis/pull/930#issuecomment-1756191739","issue_url":"https://api.github.com/repos/apache/ratis/issues/930","id":1756191739,"node_id":"IC_kwDOBMxbGc5orVv7","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-10T20:35:41Z","updated_at":"2023-10-10T20:35:41Z","author_association":"CONTRIBUTOR","body":"Forced push for resolving a conflict.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1756191739/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1760306751","html_url":"https://github.com/apache/ratis/pull/930#issuecomment-1760306751","issue_url":"https://api.github.com/repos/apache/ratis/issues/930","id":1760306751,"node_id":"IC_kwDOBMxbGc5o7CY_","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-12T20:15:16Z","updated_at":"2023-10-12T20:15:16Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , thanks a lot for carefully reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1760306751/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1760665410","html_url":"https://github.com/apache/ratis/pull/933#issuecomment-1760665410","issue_url":"https://api.github.com/repos/apache/ratis/issues/933","id":1760665410,"node_id":"IC_kwDOBMxbGc5o8Z9C","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-13T02:19:47Z","updated_at":"2023-10-13T02:19:47Z","author_association":"CONTRIBUTOR","body":"> ... Is it for the compatibility concern choosing not to reply INVALID_LOG_INDEX?\r\n\r\nThe old code could handle follower replying INVALID_LOG_INDEX.  The code just set the replied index as the `followerSnapshotIndex`.\r\n\r\nThanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1760665410/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1760677642","html_url":"https://github.com/apache/ratis/pull/933#issuecomment-1760677642","issue_url":"https://api.github.com/repos/apache/ratis/issues/933","id":1760677642,"node_id":"IC_kwDOBMxbGc5o8c8K","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-13T02:40:30Z","updated_at":"2023-10-13T02:40:30Z","author_association":"MEMBER","body":"> The old code could handle follower replying INVALID_LOG_INDEX. The code just set the replied index as the followerSnapshotIndex.\r\n\r\nGot it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1760677642/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1763057500","html_url":"https://github.com/apache/ratis/pull/934#issuecomment-1763057500","issue_url":"https://api.github.com/repos/apache/ratis/issues/934","id":1763057500,"node_id":"IC_kwDOBMxbGc5pFh9c","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-14T17:25:11Z","updated_at":"2023-10-14T17:25:11Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1763057500/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1763272758","html_url":"https://github.com/apache/ratis/pull/937#issuecomment-1763272758","issue_url":"https://api.github.com/repos/apache/ratis/issues/937","id":1763272758,"node_id":"IC_kwDOBMxbGc5pGWg2","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-15T05:01:27Z","updated_at":"2023-10-15T05:01:27Z","author_association":"MEMBER","body":"Thanks @adoroszlai for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1763272758/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1765911894","html_url":"https://github.com/apache/ratis/pull/936#issuecomment-1765911894","issue_url":"https://api.github.com/repos/apache/ratis/issues/936","id":1765911894,"node_id":"IC_kwDOBMxbGc5pQa1W","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-17T08:21:21Z","updated_at":"2023-10-17T08:21:21Z","author_association":"MEMBER","body":"@OneSizeFitsQuorum Thanks for reviewing this!\r\n\r\n> BTW, ratis also have some bug-level code smells from sonar, maybe we can fix them first!\r\n\r\nThat's right. Would you like to work on fixing them? ;)","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1765911894/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1766293849","html_url":"https://github.com/apache/ratis/pull/936#issuecomment-1766293849","issue_url":"https://api.github.com/repos/apache/ratis/issues/936","id":1766293849,"node_id":"IC_kwDOBMxbGc5pR4FZ","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-17T12:13:37Z","updated_at":"2023-10-17T12:13:37Z","author_association":"CONTRIBUTOR","body":"> That's right. Would you like to work on fixing them? ;)\r\n\r\nYes, I'd love to try and fix those bug-level code smells, and it's also an opportunity for me to learn more about ratis code :)\r\nHowever, to avoid duplication, I will continue to fix it after this PR is merged.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1766293849/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1767581651","html_url":"https://github.com/apache/ratis/pull/939#issuecomment-1767581651","issue_url":"https://api.github.com/repos/apache/ratis/issues/939","id":1767581651,"node_id":"IC_kwDOBMxbGc5pWyfT","user":{"login":"Brokenice0415","id":44429817,"node_id":"MDQ6VXNlcjQ0NDI5ODE3","avatar_url":"https://avatars.githubusercontent.com/u/44429817?v=4","gravatar_id":"","url":"https://api.github.com/users/Brokenice0415","html_url":"https://github.com/Brokenice0415","followers_url":"https://api.github.com/users/Brokenice0415/followers","following_url":"https://api.github.com/users/Brokenice0415/following{/other_user}","gists_url":"https://api.github.com/users/Brokenice0415/gists{/gist_id}","starred_url":"https://api.github.com/users/Brokenice0415/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Brokenice0415/subscriptions","organizations_url":"https://api.github.com/users/Brokenice0415/orgs","repos_url":"https://api.github.com/users/Brokenice0415/repos","events_url":"https://api.github.com/users/Brokenice0415/events{/privacy}","received_events_url":"https://api.github.com/users/Brokenice0415/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-18T03:45:45Z","updated_at":"2023-10-18T03:51:25Z","author_association":"CONTRIBUTOR","body":"@szetszwo, thanks for the review. That's a nice change:) I have updated it according to the suggested patch diff.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1767581651/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1768971122","html_url":"https://github.com/apache/ratis/pull/940#issuecomment-1768971122","issue_url":"https://api.github.com/repos/apache/ratis/issues/940","id":1768971122,"node_id":"IC_kwDOBMxbGc5pcFty","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-18T17:00:05Z","updated_at":"2023-10-18T17:00:05Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1768971122/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1770363034","html_url":"https://github.com/apache/ratis/pull/943#issuecomment-1770363034","issue_url":"https://api.github.com/repos/apache/ratis/issues/943","id":1770363034,"node_id":"IC_kwDOBMxbGc5phZia","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-19T08:55:42Z","updated_at":"2023-10-19T08:55:42Z","author_association":"MEMBER","body":"Thanks @wojiaodoubao for this detailed example! This case indeed may lead to indefinite unavailability. It seems like a nightmare to me :(\r\n\r\nMaybe we can allow a whitelist for request vote, as proposed in previous thread https://lists.apache.org/thread/tt1j3jkogh71k2hvq5gtltwmphxfy736. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1770363034/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1771456668","html_url":"https://github.com/apache/ratis/pull/942#issuecomment-1771456668","issue_url":"https://api.github.com/repos/apache/ratis/issues/942","id":1771456668,"node_id":"IC_kwDOBMxbGc5plkic","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-19T17:53:17Z","updated_at":"2023-10-19T17:53:17Z","author_association":"CONTRIBUTOR","body":"The test failure is related: https://github.com/apache/ratis/actions/runs/6566630497/job/17837715966?pr=942#step:5:811\r\n\r\nSince the calls are submitted asynchronously, we cannot assume the callIds are in order.  Will remove the callId set from the server side and let the client send multiple replied callIds.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1771456668/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1771719929","html_url":"https://github.com/apache/ratis/pull/943#issuecomment-1771719929","issue_url":"https://api.github.com/repos/apache/ratis/issues/943","id":1771719929,"node_id":"IC_kwDOBMxbGc5pmkz5","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-19T21:18:23Z","updated_at":"2023-10-19T21:18:23Z","author_association":"CONTRIBUTOR","body":"@wojiaodoubao , thanks for testing Ratis!\r\n\r\n> ...  Supposing we want to replace 2 peers from a 3 peers cluster. ...\r\n\r\nWe probably should not allow changing a major of peers at the same time.  It should replace the node one by one.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1771719929/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1772002266","html_url":"https://github.com/apache/ratis/pull/943#issuecomment-1772002266","issue_url":"https://api.github.com/repos/apache/ratis/issues/943","id":1772002266,"node_id":"IC_kwDOBMxbGc5pnpva","user":{"login":"wojiaodoubao","id":16864967,"node_id":"MDQ6VXNlcjE2ODY0OTY3","avatar_url":"https://avatars.githubusercontent.com/u/16864967?v=4","gravatar_id":"","url":"https://api.github.com/users/wojiaodoubao","html_url":"https://github.com/wojiaodoubao","followers_url":"https://api.github.com/users/wojiaodoubao/followers","following_url":"https://api.github.com/users/wojiaodoubao/following{/other_user}","gists_url":"https://api.github.com/users/wojiaodoubao/gists{/gist_id}","starred_url":"https://api.github.com/users/wojiaodoubao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wojiaodoubao/subscriptions","organizations_url":"https://api.github.com/users/wojiaodoubao/orgs","repos_url":"https://api.github.com/users/wojiaodoubao/repos","events_url":"https://api.github.com/users/wojiaodoubao/events{/privacy}","received_events_url":"https://api.github.com/users/wojiaodoubao/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-20T03:01:45Z","updated_at":"2023-10-20T03:01:45Z","author_association":"CONTRIBUTOR","body":"Thanks @SzyWilliam @szetszwo for your great reply! IMHO, the root cause is 'We can't find any majority without new peers in C_new'. \r\nBad cases example:\r\n1. Change from {n0} to {n0, ***n1***}.\r\n2. Change from {n0, n1, n2} to {n0, n1, n2, ***n3, n4, n5***}.\r\n3. Change from {n0, n1, n2} to {n0, ***n3, n4***}.\r\n4. Change from {n0, n1, n2} to {n0, n1, ***n3, n4***}.\r\n\r\nReplace/add/remove one by one can fit most cases. But fails in case 1, change from {n0} to {n0, n1}. \r\n\r\nThe solution might be:\r\n1. RaftServerImpl#setConfiguration checks the C_new. Throwing exception If it can't find any majority without new peers in C_new. This might be the easiest way to fix the problem. And the shortcoming is not allowing any conf conversion as described in raft paper.\r\n2. Configure vote whitelist for new peers. This is a little tricky, because we must remove the whitelist as soon as the new peers' conf is updated to old_and_new/transitional. Otherwise it may vote for the removed peer.\r\n3. Start each new peer with {C_old, peer_itself}. And when a server not in conf is asking for vote, don't let it crash.  Preventing nodes from crashing may cause very dangerous problems, which is probably why we let them crash. I haven't investigated it. Please help if you know the crash reason.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1772002266/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1772244681","html_url":"https://github.com/apache/ratis/pull/943#issuecomment-1772244681","issue_url":"https://api.github.com/repos/apache/ratis/issues/943","id":1772244681,"node_id":"IC_kwDOBMxbGc5pok7J","user":{"login":"Brokenice0415","id":44429817,"node_id":"MDQ6VXNlcjQ0NDI5ODE3","avatar_url":"https://avatars.githubusercontent.com/u/44429817?v=4","gravatar_id":"","url":"https://api.github.com/users/Brokenice0415","html_url":"https://github.com/Brokenice0415","followers_url":"https://api.github.com/users/Brokenice0415/followers","following_url":"https://api.github.com/users/Brokenice0415/following{/other_user}","gists_url":"https://api.github.com/users/Brokenice0415/gists{/gist_id}","starred_url":"https://api.github.com/users/Brokenice0415/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Brokenice0415/subscriptions","organizations_url":"https://api.github.com/users/Brokenice0415/orgs","repos_url":"https://api.github.com/users/Brokenice0415/repos","events_url":"https://api.github.com/users/Brokenice0415/events{/privacy}","received_events_url":"https://api.github.com/users/Brokenice0415/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-20T07:44:17Z","updated_at":"2023-10-20T07:49:53Z","author_association":"CONTRIBUTOR","body":"The solution 3 seems nice.\r\n\r\nThe reason of shutdown when NOT_IN_CONF is according to this #560 -- It may cause the failure of shutdowning a NOT_IN_CONF peer who still requests vote after the remove.\r\n\r\nAccording to the annotation below, we only shutdown candidate whose id is not included in conf **when the conf is stable**.\r\n\r\nhttps://github.com/apache/ratis/blob/639f1bf0bc1d4b8c72e22cfcd50f3f1d2b7df641/ratis-server/src/main/java/org/apache/ratis/server/impl/RaftServerImpl.java#L1333-L1341\r\n\r\nSo maybe we should change the NOT_IN_CONF handler of request vote reply regardless of whether to use solution 3 or not.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1772244681/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1772328833","html_url":"https://github.com/apache/ratis/pull/938#issuecomment-1772328833","issue_url":"https://api.github.com/repos/apache/ratis/issues/938","id":1772328833,"node_id":"IC_kwDOBMxbGc5po5eB","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-20T08:45:01Z","updated_at":"2023-10-20T08:45:01Z","author_association":"MEMBER","body":"@szetszwo, thanks for the reviews! Made changes on code, PTAL.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1772328833/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1772384079","html_url":"https://github.com/apache/ratis/pull/943#issuecomment-1772384079","issue_url":"https://api.github.com/repos/apache/ratis/issues/943","id":1772384079,"node_id":"IC_kwDOBMxbGc5ppG9P","user":{"login":"Brokenice0415","id":44429817,"node_id":"MDQ6VXNlcjQ0NDI5ODE3","avatar_url":"https://avatars.githubusercontent.com/u/44429817?v=4","gravatar_id":"","url":"https://api.github.com/users/Brokenice0415","html_url":"https://github.com/Brokenice0415","followers_url":"https://api.github.com/users/Brokenice0415/followers","following_url":"https://api.github.com/users/Brokenice0415/following{/other_user}","gists_url":"https://api.github.com/users/Brokenice0415/gists{/gist_id}","starred_url":"https://api.github.com/users/Brokenice0415/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Brokenice0415/subscriptions","organizations_url":"https://api.github.com/users/Brokenice0415/orgs","repos_url":"https://api.github.com/users/Brokenice0415/repos","events_url":"https://api.github.com/users/Brokenice0415/events{/privacy}","received_events_url":"https://api.github.com/users/Brokenice0415/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-20T09:22:54Z","updated_at":"2023-10-20T09:22:54Z","author_association":"CONTRIBUTOR","body":"I find out that the NOT_IN_CONF is only generated when the candidate finds itself is not in conf when requesting vote, which is not related to what we discussed.\r\n\r\nPeer who receives vote request replies shutdown when `shouldSendShutdown` returning true, which demands C_old is null. So I wonder if the crash in solution 3 really happens.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1772384079/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1772539227","html_url":"https://github.com/apache/ratis/pull/943#issuecomment-1772539227","issue_url":"https://api.github.com/repos/apache/ratis/issues/943","id":1772539227,"node_id":"IC_kwDOBMxbGc5pps1b","user":{"login":"wojiaodoubao","id":16864967,"node_id":"MDQ6VXNlcjE2ODY0OTY3","avatar_url":"https://avatars.githubusercontent.com/u/16864967?v=4","gravatar_id":"","url":"https://api.github.com/users/wojiaodoubao","html_url":"https://github.com/wojiaodoubao","followers_url":"https://api.github.com/users/wojiaodoubao/followers","following_url":"https://api.github.com/users/wojiaodoubao/following{/other_user}","gists_url":"https://api.github.com/users/wojiaodoubao/gists{/gist_id}","starred_url":"https://api.github.com/users/wojiaodoubao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wojiaodoubao/subscriptions","organizations_url":"https://api.github.com/users/wojiaodoubao/orgs","repos_url":"https://api.github.com/users/wojiaodoubao/repos","events_url":"https://api.github.com/users/wojiaodoubao/events{/privacy}","received_events_url":"https://api.github.com/users/wojiaodoubao/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-20T11:06:23Z","updated_at":"2023-10-20T11:06:23Z","author_association":"CONTRIBUTOR","body":"Hi @Brokenice0415 , thanks your nice advice and explanation!\r\n\r\n> Peer who receives vote request replies shutdown when shouldSendShutdown returning true, which demands C_old is null. So I wonder if the crash in solution 3 really happens.\r\n\r\nI made a test to simulate this case. The new peer did shutdown. Please have a look at TestMembership#testShutdown.\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1772539227/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1773083549","html_url":"https://github.com/apache/ratis/pull/944#issuecomment-1773083549","issue_url":"https://api.github.com/repos/apache/ratis/issues/944","id":1773083549,"node_id":"IC_kwDOBMxbGc5prxud","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-20T16:58:52Z","updated_at":"2023-10-20T16:58:52Z","author_association":"CONTRIBUTOR","body":"@jojochuang , @SzyWilliam , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1773083549/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1773088695","html_url":"https://github.com/apache/ratis/pull/943#issuecomment-1773088695","issue_url":"https://api.github.com/repos/apache/ratis/issues/943","id":1773088695,"node_id":"IC_kwDOBMxbGc5pry-3","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-20T17:02:44Z","updated_at":"2023-10-20T17:02:44Z","author_association":"CONTRIBUTOR","body":"> 1. Change from {n0} to {n0, n1}.\r\n\r\n@wojiaodoubao , This case should work well.  How could it be bad?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1773088695/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1773133347","html_url":"https://github.com/apache/ratis/pull/943#issuecomment-1773133347","issue_url":"https://api.github.com/repos/apache/ratis/issues/943","id":1773133347,"node_id":"IC_kwDOBMxbGc5pr94j","user":{"login":"Brokenice0415","id":44429817,"node_id":"MDQ6VXNlcjQ0NDI5ODE3","avatar_url":"https://avatars.githubusercontent.com/u/44429817?v=4","gravatar_id":"","url":"https://api.github.com/users/Brokenice0415","html_url":"https://github.com/Brokenice0415","followers_url":"https://api.github.com/users/Brokenice0415/followers","following_url":"https://api.github.com/users/Brokenice0415/following{/other_user}","gists_url":"https://api.github.com/users/Brokenice0415/gists{/gist_id}","starred_url":"https://api.github.com/users/Brokenice0415/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Brokenice0415/subscriptions","organizations_url":"https://api.github.com/users/Brokenice0415/orgs","repos_url":"https://api.github.com/users/Brokenice0415/repos","events_url":"https://api.github.com/users/Brokenice0415/events{/privacy}","received_events_url":"https://api.github.com/users/Brokenice0415/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-20T17:34:26Z","updated_at":"2023-10-20T17:34:26Z","author_association":"CONTRIBUTOR","body":"@wojiaodoubao, thanks for your case explanation!\r\n\r\nHowever, it seems that the new peer 3 is not added to the new configuration by client, meaning the test case only shows a new peer which is not in C_old will shutdown after asking old peers for vote.\r\n\r\nI tried to add `client.admin().setConfiguration(Arrays.copyOfRange(peers, 0, 4))` before peer 3 starts, and peer 3 does not crash any more. So is after, unless a long sleep, i.e. 1s, before the call of `setConfiguration`.\r\n\r\nSo maybe the shutdown is reasonable. If a new peer starts for a long time but the cluster does not receive the request to change conf, it should shutdown. And in solution 3, the crash may not happen if client sets up a new conf in time.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1773133347/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1773910962","html_url":"https://github.com/apache/ratis/pull/946#issuecomment-1773910962","issue_url":"https://api.github.com/repos/apache/ratis/issues/946","id":1773910962,"node_id":"IC_kwDOBMxbGc5pu7uy","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-21T20:07:51Z","updated_at":"2023-10-21T20:07:51Z","author_association":"CONTRIBUTOR","body":"@adoroszlai , thanks for reviewing this!  Updated `SegmentedRaftLogReader` and also added `bannedImports`.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1773910962/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1774154248","html_url":"https://github.com/apache/ratis/pull/946#issuecomment-1774154248","issue_url":"https://api.github.com/repos/apache/ratis/issues/946","id":1774154248,"node_id":"IC_kwDOBMxbGc5pv3II","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-22T17:39:10Z","updated_at":"2023-10-22T17:39:10Z","author_association":"CONTRIBUTOR","body":"@adoroszlai , I agree that this is not a simple change.  Let me separate this to two, three JIRAs.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1774154248/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1774281969","html_url":"https://github.com/apache/ratis/pull/943#issuecomment-1774281969","issue_url":"https://api.github.com/repos/apache/ratis/issues/943","id":1774281969,"node_id":"IC_kwDOBMxbGc5pwWTx","user":{"login":"wojiaodoubao","id":16864967,"node_id":"MDQ6VXNlcjE2ODY0OTY3","avatar_url":"https://avatars.githubusercontent.com/u/16864967?v=4","gravatar_id":"","url":"https://api.github.com/users/wojiaodoubao","html_url":"https://github.com/wojiaodoubao","followers_url":"https://api.github.com/users/wojiaodoubao/followers","following_url":"https://api.github.com/users/wojiaodoubao/following{/other_user}","gists_url":"https://api.github.com/users/wojiaodoubao/gists{/gist_id}","starred_url":"https://api.github.com/users/wojiaodoubao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wojiaodoubao/subscriptions","organizations_url":"https://api.github.com/users/wojiaodoubao/orgs","repos_url":"https://api.github.com/users/wojiaodoubao/repos","events_url":"https://api.github.com/users/wojiaodoubao/events{/privacy}","received_events_url":"https://api.github.com/users/wojiaodoubao/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-23T01:24:04Z","updated_at":"2023-10-23T01:54:24Z","author_association":"CONTRIBUTOR","body":"> Change from {n0} to {n0, n1}.\r\n> This case should work well. How could it be bad?\r\n\r\nHi @szetszwo , sorry for my late response. I made a test to simulate this case. Please have a look at TestMembership#testAddOneToOne. The procedure is as below.\r\n1. Originally we have a cluster with 1 node n0.\r\n2. Start n1 with empty conf.\r\n3. Call setConfiguration to n0. After n1 catches up, n0 changes conf to C_old_and_C_new.\r\n4. A network partition happens. n1 doesn't get conf C_old_and_C_new.\r\n5. n0 finds no majority because n1 doesn't answer. n0 quits and restarts election.\r\n6. Network partition recovers.\r\n7. n1 never votes to n0, so we won't have leader anymore.\r\n\r\nI think the reason is: All new peers' conf are empty while the peers in C_old has became transitional conf(C_old_and_C_new). Peer with transitional conf needs votes from both C_old majority and C_new majority. But 'We can't find any majority without new peers in C_new'. That's why we won' get new leader.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1774281969/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1774307566","html_url":"https://github.com/apache/ratis/pull/943#issuecomment-1774307566","issue_url":"https://api.github.com/repos/apache/ratis/issues/943","id":1774307566,"node_id":"IC_kwDOBMxbGc5pwcju","user":{"login":"wojiaodoubao","id":16864967,"node_id":"MDQ6VXNlcjE2ODY0OTY3","avatar_url":"https://avatars.githubusercontent.com/u/16864967?v=4","gravatar_id":"","url":"https://api.github.com/users/wojiaodoubao","html_url":"https://github.com/wojiaodoubao","followers_url":"https://api.github.com/users/wojiaodoubao/followers","following_url":"https://api.github.com/users/wojiaodoubao/following{/other_user}","gists_url":"https://api.github.com/users/wojiaodoubao/gists{/gist_id}","starred_url":"https://api.github.com/users/wojiaodoubao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wojiaodoubao/subscriptions","organizations_url":"https://api.github.com/users/wojiaodoubao/orgs","repos_url":"https://api.github.com/users/wojiaodoubao/repos","events_url":"https://api.github.com/users/wojiaodoubao/events{/privacy}","received_events_url":"https://api.github.com/users/wojiaodoubao/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-23T01:48:36Z","updated_at":"2023-10-23T01:51:35Z","author_association":"CONTRIBUTOR","body":"Hi @Brokenice0415, thanks your detailed explanation! If I understand correctly, 'setConfiguration before staring new peers' is right for most cases. There might be a small corner case as I'll descried below. Please help review whether it exists, thanks. I'll try to simulate it later.\r\n\r\nFirstly, we know 3 RaftServer behaviors:\r\n1. If a peer not in C_old is asking for votes from leader, leader will crash the peer. \r\n2. After we call 'setConfiguration', leader will start a new LogAppender thread, keep calling appendEntries to the new peer.\r\n3. If the new peer gets appendEntries, it will accept the leader as its leader.\r\n\r\n\r\nThe corner case is below. There is a race condition between 'leader appendEntries to peer 3' and 'peer 3 asks for vote from leader'.\r\n1. Originally we have a cluster with peer 0, 1, 2. Peer 0 is leader.\r\n4. SetConfiguration to peer 0, update conf from {0, 1, 2} to  {0, 1, 2, 3}.\r\n5. Peer 0 starts a new LogAppender thread responsible for peer 3.\r\n6. A network partition happens.\r\n7. Start peer 3.\r\n8. Network partition recovers.\r\n9. A race condition between 'leader appendEntries to peer 3' and 'peer 3 asks for vote from leader' happens. If 'asks for vote' gets first, peer 3 will shutdown.\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1774307566/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1774813634","html_url":"https://github.com/apache/ratis/pull/943#issuecomment-1774813634","issue_url":"https://api.github.com/repos/apache/ratis/issues/943","id":1774813634,"node_id":"IC_kwDOBMxbGc5pyYHC","user":{"login":"Brokenice0415","id":44429817,"node_id":"MDQ6VXNlcjQ0NDI5ODE3","avatar_url":"https://avatars.githubusercontent.com/u/44429817?v=4","gravatar_id":"","url":"https://api.github.com/users/Brokenice0415","html_url":"https://github.com/Brokenice0415","followers_url":"https://api.github.com/users/Brokenice0415/followers","following_url":"https://api.github.com/users/Brokenice0415/following{/other_user}","gists_url":"https://api.github.com/users/Brokenice0415/gists{/gist_id}","starred_url":"https://api.github.com/users/Brokenice0415/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Brokenice0415/subscriptions","organizations_url":"https://api.github.com/users/Brokenice0415/orgs","repos_url":"https://api.github.com/users/Brokenice0415/repos","events_url":"https://api.github.com/users/Brokenice0415/events{/privacy}","received_events_url":"https://api.github.com/users/Brokenice0415/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-23T09:44:08Z","updated_at":"2023-10-23T09:45:20Z","author_association":"CONTRIBUTOR","body":"Hi @wojiaodoubao , I think that race may happen.\r\n\r\nI think it's difficult to distinguish the new peer from the removed old one when receiving vote request from a peer not in conf.\r\n\r\nHow about just restarting the crashed new peer, since the network partition has recovered and there is little likelihood of the partition happening again in such a short period of time? If the partition does happen again and the restarted new peer crashes again, maybe we should give up to add this unstable peer to the new conf?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1774813634/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1775473201","html_url":"https://github.com/apache/ratis/pull/943#issuecomment-1775473201","issue_url":"https://api.github.com/repos/apache/ratis/issues/943","id":1775473201,"node_id":"IC_kwDOBMxbGc5p05Ix","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-10-23T15:34:07Z","updated_at":"2023-10-23T15:34:07Z","author_association":"CONTRIBUTOR","body":"@wojiaodoubao , When there is [NO PROGRESS](https://github.com/apache/ratis/blob/eab143a577210e051c5c284969243fa88f1fef93/ratis-server/src/main/java/org/apache/ratis/server/impl/LeaderStateImpl.java#L104), setConf will fail.  However, if there is no leader, they may not be able to elect one.  Good catch on the bug!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1775473201/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]