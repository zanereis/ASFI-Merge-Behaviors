[{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1171888466","html_url":"https://github.com/apache/brpc/pull/1818#issuecomment-1171888466","issue_url":"https://api.github.com/repos/apache/brpc/issues/1818","id":1171888466,"node_id":"IC_kwDOBhmkcs5F2ZlS","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-01T03:21:55Z","updated_at":"2022-07-01T03:21:55Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1171888466/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1172661920","html_url":"https://github.com/apache/brpc/pull/1814#issuecomment-1172661920","issue_url":"https://api.github.com/repos/apache/brpc/issues/1814","id":1172661920,"node_id":"IC_kwDOBhmkcs5F5Wag","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-01T19:39:22Z","updated_at":"2022-07-01T19:39:22Z","author_association":"MEMBER","body":"能不能把堆栈发一下？是不是core在了https://github.com/apache/incubator-brpc/blob/master/src/brpc/socket.cpp?#L1692？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1172661920/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1172666822","html_url":"https://github.com/apache/brpc/issues/1823#issuecomment-1172666822","issue_url":"https://api.github.com/repos/apache/brpc/issues/1823","id":1172666822,"node_id":"IC_kwDOBhmkcs5F5XnG","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-01T19:48:26Z","updated_at":"2022-07-01T19:48:26Z","author_association":"MEMBER","body":"试试baidu_std","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1172666822/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1172669906","html_url":"https://github.com/apache/brpc/issues/1346#issuecomment-1172669906","issue_url":"https://api.github.com/repos/apache/brpc/issues/1346","id":1172669906,"node_id":"IC_kwDOBhmkcs5F5YXS","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-01T19:54:26Z","updated_at":"2022-07-01T19:56:45Z","author_association":"MEMBER","body":"@Vitusyc  对性能不会有影响。这几个Flags可以命令行直接改","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1172669906/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1172820954","html_url":"https://github.com/apache/brpc/issues/944#issuecomment-1172820954","issue_url":"https://api.github.com/repos/apache/brpc/issues/944","id":1172820954,"node_id":"IC_kwDOBhmkcs5F59Pa","user":{"login":"BeautyCJ","id":11649149,"node_id":"MDQ6VXNlcjExNjQ5MTQ5","avatar_url":"https://avatars.githubusercontent.com/u/11649149?v=4","gravatar_id":"","url":"https://api.github.com/users/BeautyCJ","html_url":"https://github.com/BeautyCJ","followers_url":"https://api.github.com/users/BeautyCJ/followers","following_url":"https://api.github.com/users/BeautyCJ/following{/other_user}","gists_url":"https://api.github.com/users/BeautyCJ/gists{/gist_id}","starred_url":"https://api.github.com/users/BeautyCJ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BeautyCJ/subscriptions","organizations_url":"https://api.github.com/users/BeautyCJ/orgs","repos_url":"https://api.github.com/users/BeautyCJ/repos","events_url":"https://api.github.com/users/BeautyCJ/events{/privacy}","received_events_url":"https://api.github.com/users/BeautyCJ/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-02T02:58:28Z","updated_at":"2022-07-02T02:58:28Z","author_association":"NONE","body":"请问，是否已经解决了这个问题？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1172820954/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1173040653","html_url":"https://github.com/apache/brpc/pull/1826#issuecomment-1173040653","issue_url":"https://api.github.com/repos/apache/brpc/issues/1826","id":1173040653,"node_id":"IC_kwDOBhmkcs5F6y4N","user":{"login":"jenrryyou","id":4698734,"node_id":"MDQ6VXNlcjQ2OTg3MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/4698734?v=4","gravatar_id":"","url":"https://api.github.com/users/jenrryyou","html_url":"https://github.com/jenrryyou","followers_url":"https://api.github.com/users/jenrryyou/followers","following_url":"https://api.github.com/users/jenrryyou/following{/other_user}","gists_url":"https://api.github.com/users/jenrryyou/gists{/gist_id}","starred_url":"https://api.github.com/users/jenrryyou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jenrryyou/subscriptions","organizations_url":"https://api.github.com/users/jenrryyou/orgs","repos_url":"https://api.github.com/users/jenrryyou/repos","events_url":"https://api.github.com/users/jenrryyou/events{/privacy}","received_events_url":"https://api.github.com/users/jenrryyou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-03T08:52:28Z","updated_at":"2022-07-03T08:52:28Z","author_association":"CONTRIBUTOR","body":"@chenzhangyi 辛苦review下~","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1173040653/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1173054662","html_url":"https://github.com/apache/brpc/issues/1816#issuecomment-1173054662","issue_url":"https://api.github.com/repos/apache/brpc/issues/1816","id":1173054662,"node_id":"IC_kwDOBhmkcs5F62TG","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-03T10:26:18Z","updated_at":"2022-07-03T10:26:18Z","author_association":"MEMBER","body":"This is duplicate to #1693, cmake fail to find pthread as the simple compile test failed, which is caused by the nil defined `__const__`.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1173054662/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1173245772","html_url":"https://github.com/apache/brpc/pull/1774#issuecomment-1173245772","issue_url":"https://api.github.com/repos/apache/brpc/issues/1774","id":1173245772,"node_id":"IC_kwDOBhmkcs5F7k9M","user":{"login":"zhaodongzhi","id":6293650,"node_id":"MDQ6VXNlcjYyOTM2NTA=","avatar_url":"https://avatars.githubusercontent.com/u/6293650?v=4","gravatar_id":"","url":"https://api.github.com/users/zhaodongzhi","html_url":"https://github.com/zhaodongzhi","followers_url":"https://api.github.com/users/zhaodongzhi/followers","following_url":"https://api.github.com/users/zhaodongzhi/following{/other_user}","gists_url":"https://api.github.com/users/zhaodongzhi/gists{/gist_id}","starred_url":"https://api.github.com/users/zhaodongzhi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhaodongzhi/subscriptions","organizations_url":"https://api.github.com/users/zhaodongzhi/orgs","repos_url":"https://api.github.com/users/zhaodongzhi/repos","events_url":"https://api.github.com/users/zhaodongzhi/events{/privacy}","received_events_url":"https://api.github.com/users/zhaodongzhi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-04T01:39:49Z","updated_at":"2022-07-04T01:39:49Z","author_association":"NONE","body":"您好，请问这里是还有其他需要修改的地方吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1173245772/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1173262061","html_url":"https://github.com/apache/brpc/pull/1826#issuecomment-1173262061","issue_url":"https://api.github.com/repos/apache/brpc/issues/1826","id":1173262061,"node_id":"IC_kwDOBhmkcs5F7o7t","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-04T02:11:15Z","updated_at":"2022-07-04T02:11:15Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1173262061/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":2,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1173273088","html_url":"https://github.com/apache/brpc/pull/1814#issuecomment-1173273088","issue_url":"https://api.github.com/repos/apache/brpc/issues/1814","id":1173273088,"node_id":"IC_kwDOBhmkcs5F7roA","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-04T02:30:56Z","updated_at":"2022-07-04T02:30:56Z","author_association":"CONTRIBUTOR","body":"@zyearn 和 https://github.com/apache/incubator-brpc/issues/658 一样。因为ssl为NULL，所以core在[cut_multiple_into_SSL_channel](https://github.com/apache/incubator-brpc/blob/master/src/brpc/socket.cpp?#L1698)函数里。\r\n<img width=\"1300\" alt=\"企业微信截图_16551888723200\" src=\"https://user-images.githubusercontent.com/12249635/177070890-209e1f00-da5b-48cb-b681-e1f2ac1536d5.png\">\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1173273088/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1173404817","html_url":"https://github.com/apache/brpc/issues/1827#issuecomment-1173404817","issue_url":"https://api.github.com/repos/apache/brpc/issues/1827","id":1173404817,"node_id":"IC_kwDOBhmkcs5F8LyR","user":{"login":"cdjingit","id":31362185,"node_id":"MDQ6VXNlcjMxMzYyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/31362185?v=4","gravatar_id":"","url":"https://api.github.com/users/cdjingit","html_url":"https://github.com/cdjingit","followers_url":"https://api.github.com/users/cdjingit/followers","following_url":"https://api.github.com/users/cdjingit/following{/other_user}","gists_url":"https://api.github.com/users/cdjingit/gists{/gist_id}","starred_url":"https://api.github.com/users/cdjingit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdjingit/subscriptions","organizations_url":"https://api.github.com/users/cdjingit/orgs","repos_url":"https://api.github.com/users/cdjingit/repos","events_url":"https://api.github.com/users/cdjingit/events{/privacy}","received_events_url":"https://api.github.com/users/cdjingit/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-04T06:29:06Z","updated_at":"2022-07-04T06:29:06Z","author_association":"CONTRIBUTOR","body":"用的什么ns呢？是由于某个阶段的某个节点的权重比较大导致的吧","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1173404817/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174002198","html_url":"https://github.com/apache/brpc/pull/1768#issuecomment-1174002198","issue_url":"https://api.github.com/repos/apache/brpc/issues/1768","id":1174002198,"node_id":"IC_kwDOBhmkcs5F-doW","user":{"login":"zwkno1","id":6861609,"node_id":"MDQ6VXNlcjY4NjE2MDk=","avatar_url":"https://avatars.githubusercontent.com/u/6861609?v=4","gravatar_id":"","url":"https://api.github.com/users/zwkno1","html_url":"https://github.com/zwkno1","followers_url":"https://api.github.com/users/zwkno1/followers","following_url":"https://api.github.com/users/zwkno1/following{/other_user}","gists_url":"https://api.github.com/users/zwkno1/gists{/gist_id}","starred_url":"https://api.github.com/users/zwkno1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zwkno1/subscriptions","organizations_url":"https://api.github.com/users/zwkno1/orgs","repos_url":"https://api.github.com/users/zwkno1/repos","events_url":"https://api.github.com/users/zwkno1/events{/privacy}","received_events_url":"https://api.github.com/users/zwkno1/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-04T16:51:08Z","updated_at":"2022-07-04T16:51:08Z","author_association":"CONTRIBUTOR","body":"大哥，这玩意还能不能合了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174002198/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174382656","html_url":"https://github.com/apache/brpc/pull/1814#issuecomment-1174382656","issue_url":"https://api.github.com/repos/apache/brpc/issues/1814","id":1174382656,"node_id":"IC_kwDOBhmkcs5F_6hA","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-04T21:17:39Z","updated_at":"2022-07-04T21:18:06Z","author_association":"MEMBER","body":"@chenBright 这个问题能不能通过在判断ssl_state和_ssl_session基础上解决呢？比如在DoWrite里\r\n```\r\ncurrent_ssl_session = _ssl_session\r\nif (current_ssl_session == NULL) {\r\n   // necessary comment\r\n   return -1;\r\n}\r\n...\r\nbutil::IOBuf::cut_multiple_into_SSL_channel(current_ssl_session, ...)\r\n```\r\n\r\n这样保证current_ssl_session不是NULL，不出core，然后写fd的时候发现对端已经关了连接就走正常错误处理的代码了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174382656/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174525425","html_url":"https://github.com/apache/brpc/pull/1768#issuecomment-1174525425","issue_url":"https://api.github.com/repos/apache/brpc/issues/1768","id":1174525425,"node_id":"IC_kwDOBhmkcs5GAdXx","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-05T02:11:26Z","updated_at":"2022-07-05T02:12:05Z","author_association":"CONTRIBUTOR","body":"LGTM\r\n@lorinlee 有空也看看","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174525425/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174529575","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1174529575","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1174529575,"node_id":"IC_kwDOBhmkcs5GAeYn","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-05T02:18:54Z","updated_at":"2022-07-05T02:18:54Z","author_association":"CONTRIBUTOR","body":"这个是客户端的延迟数据对吧，服务端延迟怎么样呢？先排除是服务端的问题哈。\r\n另外客户端网络情况如何，客户端机器的网卡有被打满吗？如果同时启动 26个下游 和 1个下游 的两个进程，1个下游的进程还能保持低延迟吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174529575/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174536777","html_url":"https://github.com/apache/brpc/pull/1814#issuecomment-1174536777","issue_url":"https://api.github.com/repos/apache/brpc/issues/1814","id":1174536777,"node_id":"IC_kwDOBhmkcs5GAgJJ","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-05T02:33:04Z","updated_at":"2022-07-05T02:34:33Z","author_association":"CONTRIBUTOR","body":"> @chenBright 这个问题能不能通过在判断ssl_state和_ssl_session基础上解决呢？比如在DoWrite里\r\n> \r\n> ```\r\n> current_ssl_session = _ssl_session\r\n> if (current_ssl_session == NULL) {\r\n>    // necessary comment\r\n>    return -1;\r\n> }\r\n> ...\r\n> butil::IOBuf::cut_multiple_into_SSL_channel(current_ssl_session, ...)\r\n> ```\r\n> \r\n> 这样保证current_ssl_session不是NULL，不出core，然后写fd的时候发现对端已经关了连接就走正常错误处理的代码了。\r\n\r\n@zyearn 这样可以保证不会coredump，这也是正常的边界处理逻辑。当时有考虑通过判断_ssl_session或者fd来解决，但是觉得并没有实际解决问题。现在是HealthCheckTask里的引用不符合预期，导致了Socket内部的状态错误的问题，这样处理的话，会不会不太合适呢？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174536777/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174659914","html_url":"https://github.com/apache/brpc/pull/1814#issuecomment-1174659914","issue_url":"https://api.github.com/repos/apache/brpc/issues/1814","id":1174659914,"node_id":"IC_kwDOBhmkcs5GA-NK","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-05T06:17:08Z","updated_at":"2022-07-05T06:17:08Z","author_association":"CONTRIBUTOR","body":"> @chenBright 这个问题能不能通过在判断ssl_state和_ssl_session基础上解决呢？比如在DoWrite里\r\n> \r\n> ```\r\n> current_ssl_session = _ssl_session\r\n> if (current_ssl_session == NULL) {\r\n>    // necessary comment\r\n>    return -1;\r\n> }\r\n> ...\r\n> butil::IOBuf::cut_multiple_into_SSL_channel(current_ssl_session, ...)\r\n> ```\r\n> \r\n> 这样保证current_ssl_session不是NULL，不出core，然后写fd的时候发现对端已经关了连接就走正常错误处理的代码了。\r\n\r\n还有一个问题：https://github.com/apache/incubator-brpc/issues/658 这个case中，当HealthCheckTask等到引用计数为2后，Connect之前，另一处rpc DoWrite失败，rpc结束，引用计数减一。此时，该下游节点恢复了，HealthCheckTask成功Connect，并将Socket Revive。此时Socket是正常的，但是没有地方持有对应的SocketId，那么这个Socket是“泄漏”了吧？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174659914/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174663366","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1174663366","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1174663366,"node_id":"IC_kwDOBhmkcs5GA_DG","user":{"login":"Missmiaom","id":10678668,"node_id":"MDQ6VXNlcjEwNjc4NjY4","avatar_url":"https://avatars.githubusercontent.com/u/10678668?v=4","gravatar_id":"","url":"https://api.github.com/users/Missmiaom","html_url":"https://github.com/Missmiaom","followers_url":"https://api.github.com/users/Missmiaom/followers","following_url":"https://api.github.com/users/Missmiaom/following{/other_user}","gists_url":"https://api.github.com/users/Missmiaom/gists{/gist_id}","starred_url":"https://api.github.com/users/Missmiaom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Missmiaom/subscriptions","organizations_url":"https://api.github.com/users/Missmiaom/orgs","repos_url":"https://api.github.com/users/Missmiaom/repos","events_url":"https://api.github.com/users/Missmiaom/events{/privacy}","received_events_url":"https://api.github.com/users/Missmiaom/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-05T06:22:11Z","updated_at":"2022-07-05T06:22:11Z","author_association":"NONE","body":"@lorinlee 是客户端延迟数据，服务端延迟基本都在1ms左右，服务端都是万兆网卡，请求基本在200B以内，没有打满。\r\n\r\n另外同时启动两个测试，一个连26个下游，一个只连一个下游，还是一样的结果。一个下游的测试耗时比较低，多个下游的测试耗时明显高出很多。\r\n\r\n请问可能还有哪些原因呢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174663366/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174823172","html_url":"https://github.com/apache/brpc/issues/1827#issuecomment-1174823172","issue_url":"https://api.github.com/repos/apache/brpc/issues/1827","id":1174823172,"node_id":"IC_kwDOBhmkcs5GBmEE","user":{"login":"ZhihaoPan","id":28187784,"node_id":"MDQ6VXNlcjI4MTg3Nzg0","avatar_url":"https://avatars.githubusercontent.com/u/28187784?v=4","gravatar_id":"","url":"https://api.github.com/users/ZhihaoPan","html_url":"https://github.com/ZhihaoPan","followers_url":"https://api.github.com/users/ZhihaoPan/followers","following_url":"https://api.github.com/users/ZhihaoPan/following{/other_user}","gists_url":"https://api.github.com/users/ZhihaoPan/gists{/gist_id}","starred_url":"https://api.github.com/users/ZhihaoPan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZhihaoPan/subscriptions","organizations_url":"https://api.github.com/users/ZhihaoPan/orgs","repos_url":"https://api.github.com/users/ZhihaoPan/repos","events_url":"https://api.github.com/users/ZhihaoPan/events{/privacy}","received_events_url":"https://api.github.com/users/ZhihaoPan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-05T09:16:47Z","updated_at":"2022-07-05T09:16:47Z","author_association":"NONE","body":"> \r\n\r\n感觉和ns关系不大，我看每次如果有remain_server.id != server_list[pos].id 就会把remain_server.weight置0，那这时候就相当于从某个position的0位置开始按stride走，这时候的概率就不是权重的概率了吧。\r\n\r\n我们服务权重变更很频繁，下游假设只有3个节点 权重为(110, 93, 87) stride为107，某一时刻权重微调，server_list顺序变了，那么按照现在逻辑remain_server.weight置0，都从pos的起始点走，那走到110上的概率接近2/3了吧。 我们上游节点有一百个，这种抖动现象就很明显","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174823172/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174838341","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1174838341","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1174838341,"node_id":"IC_kwDOBhmkcs5GBpxF","user":{"login":"cdjingit","id":31362185,"node_id":"MDQ6VXNlcjMxMzYyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/31362185?v=4","gravatar_id":"","url":"https://api.github.com/users/cdjingit","html_url":"https://github.com/cdjingit","followers_url":"https://api.github.com/users/cdjingit/followers","following_url":"https://api.github.com/users/cdjingit/following{/other_user}","gists_url":"https://api.github.com/users/cdjingit/gists{/gist_id}","starred_url":"https://api.github.com/users/cdjingit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdjingit/subscriptions","organizations_url":"https://api.github.com/users/cdjingit/orgs","repos_url":"https://api.github.com/users/cdjingit/repos","events_url":"https://api.github.com/users/cdjingit/events{/privacy}","received_events_url":"https://api.github.com/users/cdjingit/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-05T09:30:21Z","updated_at":"2022-07-05T09:30:21Z","author_association":"CONTRIBUTOR","body":"> @lorinlee 是客户端延迟数据，服务端延迟基本都在1ms左右，服务端都是万兆网卡，请求基本在200B以内，没有打满。\r\n> \r\n> 另外同时启动两个测试，一个连26个下游，一个只连一个下游，还是一样的结果。一个下游的测试耗时比较低，多个下游的测试耗时明显高出很多。\r\n> \r\n> 请问可能还有哪些原因呢\r\n\r\n用的是什么连接方式？qps大约多少？网络的rtt大约多少？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174838341/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174845423","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1174845423","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1174845423,"node_id":"IC_kwDOBhmkcs5GBrfv","user":{"login":"Missmiaom","id":10678668,"node_id":"MDQ6VXNlcjEwNjc4NjY4","avatar_url":"https://avatars.githubusercontent.com/u/10678668?v=4","gravatar_id":"","url":"https://api.github.com/users/Missmiaom","html_url":"https://github.com/Missmiaom","followers_url":"https://api.github.com/users/Missmiaom/followers","following_url":"https://api.github.com/users/Missmiaom/following{/other_user}","gists_url":"https://api.github.com/users/Missmiaom/gists{/gist_id}","starred_url":"https://api.github.com/users/Missmiaom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Missmiaom/subscriptions","organizations_url":"https://api.github.com/users/Missmiaom/orgs","repos_url":"https://api.github.com/users/Missmiaom/repos","events_url":"https://api.github.com/users/Missmiaom/events{/privacy}","received_events_url":"https://api.github.com/users/Missmiaom/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-05T09:36:34Z","updated_at":"2022-07-05T09:36:34Z","author_association":"NONE","body":"@cdjingit 使用的是单连接模式，qps 保持在3000，测试程序和下游节点都在同一机房，网络的rtt在0.05ms左右","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174845423/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174946875","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1174946875","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1174946875,"node_id":"IC_kwDOBhmkcs5GCEQ7","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-05T11:23:21Z","updated_at":"2022-07-05T11:23:21Z","author_association":"CONTRIBUTOR","body":"@Missmiaom 有试过使用其他的lb策略吗，延迟是否有变化呢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1174946875/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1175734765","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1175734765","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1175734765,"node_id":"IC_kwDOBhmkcs5GFEnt","user":{"login":"Missmiaom","id":10678668,"node_id":"MDQ6VXNlcjEwNjc4NjY4","avatar_url":"https://avatars.githubusercontent.com/u/10678668?v=4","gravatar_id":"","url":"https://api.github.com/users/Missmiaom","html_url":"https://github.com/Missmiaom","followers_url":"https://api.github.com/users/Missmiaom/followers","following_url":"https://api.github.com/users/Missmiaom/following{/other_user}","gists_url":"https://api.github.com/users/Missmiaom/gists{/gist_id}","starred_url":"https://api.github.com/users/Missmiaom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Missmiaom/subscriptions","organizations_url":"https://api.github.com/users/Missmiaom/orgs","repos_url":"https://api.github.com/users/Missmiaom/repos","events_url":"https://api.github.com/users/Missmiaom/events{/privacy}","received_events_url":"https://api.github.com/users/Missmiaom/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-06T03:21:32Z","updated_at":"2022-07-06T03:22:12Z","author_association":"NONE","body":"@lorinlee  试过la模式，耗时情况好很多。\r\n\r\n但是，在 la 模式下把发给下游的ip和请求数量列出来了\r\n\r\n发现每次测试刚开始的时候，请求分布比较均匀，测试到后面（约1分钟后），请求都大量集中在一个节点上，并且每次测试请求集中的节点都不是同一个下游节点，看起来像随机的，请求集中的节点能收到几万个请求，而其他节点只能收到几十个请求\r\n\r\n在 rr 模式下，测试请求均匀分布在下游所有节点上","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1175734765/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1175826310","html_url":"https://github.com/apache/brpc/issues/1825#issuecomment-1175826310","issue_url":"https://api.github.com/repos/apache/brpc/issues/1825","id":1175826310,"node_id":"IC_kwDOBhmkcs5GFa-G","user":{"login":"xiaolin310","id":6479416,"node_id":"MDQ6VXNlcjY0Nzk0MTY=","avatar_url":"https://avatars.githubusercontent.com/u/6479416?v=4","gravatar_id":"","url":"https://api.github.com/users/xiaolin310","html_url":"https://github.com/xiaolin310","followers_url":"https://api.github.com/users/xiaolin310/followers","following_url":"https://api.github.com/users/xiaolin310/following{/other_user}","gists_url":"https://api.github.com/users/xiaolin310/gists{/gist_id}","starred_url":"https://api.github.com/users/xiaolin310/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiaolin310/subscriptions","organizations_url":"https://api.github.com/users/xiaolin310/orgs","repos_url":"https://api.github.com/users/xiaolin310/repos","events_url":"https://api.github.com/users/xiaolin310/events{/privacy}","received_events_url":"https://api.github.com/users/xiaolin310/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-06T06:20:19Z","updated_at":"2022-07-06T06:20:19Z","author_association":"NONE","body":"Replace to use `GNU readline` and it works !","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1175826310/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1175967268","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1175967268","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1175967268,"node_id":"IC_kwDOBhmkcs5GF9Yk","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-06T08:59:04Z","updated_at":"2022-07-06T08:59:04Z","author_association":"CONTRIBUTOR","body":"@Missmiaom 有试过random吗，方便试下看延迟情况如何呢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1175967268/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176003127","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1176003127","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1176003127,"node_id":"IC_kwDOBhmkcs5GGGI3","user":{"login":"Missmiaom","id":10678668,"node_id":"MDQ6VXNlcjEwNjc4NjY4","avatar_url":"https://avatars.githubusercontent.com/u/10678668?v=4","gravatar_id":"","url":"https://api.github.com/users/Missmiaom","html_url":"https://github.com/Missmiaom","followers_url":"https://api.github.com/users/Missmiaom/followers","following_url":"https://api.github.com/users/Missmiaom/following{/other_user}","gists_url":"https://api.github.com/users/Missmiaom/gists{/gist_id}","starred_url":"https://api.github.com/users/Missmiaom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Missmiaom/subscriptions","organizations_url":"https://api.github.com/users/Missmiaom/orgs","repos_url":"https://api.github.com/users/Missmiaom/repos","events_url":"https://api.github.com/users/Missmiaom/events{/privacy}","received_events_url":"https://api.github.com/users/Missmiaom/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-06T09:33:23Z","updated_at":"2022-07-06T09:33:23Z","author_association":"NONE","body":"@lorinlee  这里是下游多节点，random模型的测试情况：\r\n\r\n[Latency]\r\n  avg           4754 us\r\n  50%            403 us\r\n  70%           3763 us\r\n  90%          15567 us\r\n  95%          24327 us\r\n  97%          32290 us\r\n  99%          39459 us\r\n  99.9%        40148 us\r\n  99.99%       40715 us\r\n  max          41832 us\r\n\r\n也是耗时比较高，下游请求均匀分布。T.T\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176003127/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176020715","html_url":"https://github.com/apache/brpc/pull/1608#issuecomment-1176020715","issue_url":"https://api.github.com/repos/apache/brpc/issues/1608","id":1176020715,"node_id":"IC_kwDOBhmkcs5GGKbr","user":{"login":"tcp9","id":38188494,"node_id":"MDQ6VXNlcjM4MTg4NDk0","avatar_url":"https://avatars.githubusercontent.com/u/38188494?v=4","gravatar_id":"","url":"https://api.github.com/users/tcp9","html_url":"https://github.com/tcp9","followers_url":"https://api.github.com/users/tcp9/followers","following_url":"https://api.github.com/users/tcp9/following{/other_user}","gists_url":"https://api.github.com/users/tcp9/gists{/gist_id}","starred_url":"https://api.github.com/users/tcp9/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tcp9/subscriptions","organizations_url":"https://api.github.com/users/tcp9/orgs","repos_url":"https://api.github.com/users/tcp9/repos","events_url":"https://api.github.com/users/tcp9/events{/privacy}","received_events_url":"https://api.github.com/users/tcp9/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-06T09:50:50Z","updated_at":"2022-07-06T09:50:50Z","author_association":"NONE","body":"> > 这个mr 大概什么时候可以提交？\r\n> \r\n> 你现在使用这个功能了吗？\r\n\r\n想问下 为啥不在brpc_metrics导出呢？ ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176020715/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176334486","html_url":"https://github.com/apache/brpc/pull/1608#issuecomment-1176334486","issue_url":"https://api.github.com/repos/apache/brpc/issues/1608","id":1176334486,"node_id":"IC_kwDOBhmkcs5GHXCW","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-06T15:03:24Z","updated_at":"2022-07-06T15:03:24Z","author_association":"CONTRIBUTOR","body":"> > > 这个mr 大概什么时候可以提交？\r\n> > \r\n> > \r\n> > 你现在使用这个功能了吗？\r\n> \r\n> 想问下 为啥不在brpc_metrics导出呢？\r\n\r\n有可能metrics和维度非常多，目前还没有通过brpc_metrics导出，不过这个实现起来应该不复杂","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176334486/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176958011","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1176958011","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1176958011,"node_id":"IC_kwDOBhmkcs5GJvQ7","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-07T02:02:52Z","updated_at":"2022-07-07T02:02:52Z","author_association":"CONTRIBUTOR","body":"保持下游的qps一致试试，比如一个下游的时候3000qps，26个下游的时候3000*26 qps试试。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176958011/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176972827","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1176972827","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1176972827,"node_id":"IC_kwDOBhmkcs5GJy4b","user":{"login":"Missmiaom","id":10678668,"node_id":"MDQ6VXNlcjEwNjc4NjY4","avatar_url":"https://avatars.githubusercontent.com/u/10678668?v=4","gravatar_id":"","url":"https://api.github.com/users/Missmiaom","html_url":"https://github.com/Missmiaom","followers_url":"https://api.github.com/users/Missmiaom/followers","following_url":"https://api.github.com/users/Missmiaom/following{/other_user}","gists_url":"https://api.github.com/users/Missmiaom/gists{/gist_id}","starred_url":"https://api.github.com/users/Missmiaom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Missmiaom/subscriptions","organizations_url":"https://api.github.com/users/Missmiaom/orgs","repos_url":"https://api.github.com/users/Missmiaom/repos","events_url":"https://api.github.com/users/Missmiaom/events{/privacy}","received_events_url":"https://api.github.com/users/Missmiaom/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-07T02:27:41Z","updated_at":"2022-07-07T02:27:41Z","author_association":"NONE","body":"@wwbmmm  现在测试了26个节点 3000*26 qps的情况，rr模式，耗时情况确实好很多！！！ 很接近单节点 3000 qps的情况。\r\n\r\n另外还测试了 单节点 100 qps，耗时情况也非常好，响应基本都在1ms左右。\r\n\r\n这个可能是什么原因呢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176972827/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176976284","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1176976284","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1176976284,"node_id":"IC_kwDOBhmkcs5GJzuc","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-07T02:34:04Z","updated_at":"2022-07-07T02:34:04Z","author_association":"CONTRIBUTOR","body":"下游26个节点，是在同一台机器上的吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176976284/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176977235","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1176977235","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1176977235,"node_id":"IC_kwDOBhmkcs5GJz9T","user":{"login":"Missmiaom","id":10678668,"node_id":"MDQ6VXNlcjEwNjc4NjY4","avatar_url":"https://avatars.githubusercontent.com/u/10678668?v=4","gravatar_id":"","url":"https://api.github.com/users/Missmiaom","html_url":"https://github.com/Missmiaom","followers_url":"https://api.github.com/users/Missmiaom/followers","following_url":"https://api.github.com/users/Missmiaom/following{/other_user}","gists_url":"https://api.github.com/users/Missmiaom/gists{/gist_id}","starred_url":"https://api.github.com/users/Missmiaom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Missmiaom/subscriptions","organizations_url":"https://api.github.com/users/Missmiaom/orgs","repos_url":"https://api.github.com/users/Missmiaom/repos","events_url":"https://api.github.com/users/Missmiaom/events{/privacy}","received_events_url":"https://api.github.com/users/Missmiaom/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-07T02:35:57Z","updated_at":"2022-07-07T02:35:57Z","author_association":"NONE","body":"@wwbmmm 不是噢，4个节点一个物理机","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176977235/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176980594","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1176980594","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1176980594,"node_id":"IC_kwDOBhmkcs5GJ0xy","user":{"login":"Missmiaom","id":10678668,"node_id":"MDQ6VXNlcjEwNjc4NjY4","avatar_url":"https://avatars.githubusercontent.com/u/10678668?v=4","gravatar_id":"","url":"https://api.github.com/users/Missmiaom","html_url":"https://github.com/Missmiaom","followers_url":"https://api.github.com/users/Missmiaom/followers","following_url":"https://api.github.com/users/Missmiaom/following{/other_user}","gists_url":"https://api.github.com/users/Missmiaom/gists{/gist_id}","starred_url":"https://api.github.com/users/Missmiaom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Missmiaom/subscriptions","organizations_url":"https://api.github.com/users/Missmiaom/orgs","repos_url":"https://api.github.com/users/Missmiaom/repos","events_url":"https://api.github.com/users/Missmiaom/events{/privacy}","received_events_url":"https://api.github.com/users/Missmiaom/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-07T02:41:54Z","updated_at":"2022-07-07T02:46:56Z","author_association":"NONE","body":"@wwbmmm  下游qps越高，耗时情况越好，并且 rpc_press 工具的 thread_num 参数越小，耗时情况也越好。\r\n\r\n\r\n下面针对线程数的一个测试，下游26个节点，rr模式：\r\n\r\nqps=78000 thread_num=1，一个线程最多64000qps，这个耗时情况比较好\r\n\r\n==================================================\r\n2022/07/07-10:36:03     sent:64592     success:64594     error:0     total_error:0         total_sent:18674682  \r\n[Latency]\r\n  avg            491 us\r\n  50%            500 us\r\n  70%            506 us\r\n  90%            519 us\r\n  95%            528 us\r\n  97%            533 us\r\n  99%            542 us\r\n  99.9%          762 us\r\n  99.99%        3710 us\r\n  max          11915 us\r\n\r\n\r\nqps=78000 thread_num=0 rpc_press决定线程数，可以达到78000qps，这个耗时情况不是很理想，但是也比 26个节点总共3000 qps 好非常多了\r\n\r\n==================================================\r\n2022/07/07-10:38:52     sent:78015     success:78362     error:0     total_error:0         total_sent:3900746   \r\n[Latency]\r\n  avg           1015 us\r\n  50%            744 us\r\n  70%           1027 us\r\n  90%           1558 us\r\n  95%           1869 us\r\n  97%           2198 us\r\n  99%           4045 us\r\n  99.9%        24466 us\r\n  99.99%       26290 us\r\n  max          27601 us\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176980594/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176995770","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1176995770","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1176995770,"node_id":"IC_kwDOBhmkcs5GJ4e6","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-07T03:02:30Z","updated_at":"2022-07-07T03:02:30Z","author_association":"CONTRIBUTOR","body":"rpc_press是最新版吗？如果不是，建议更新到包含这个PR的版本试试：https://github.com/apache/incubator-brpc/pull/1763","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1176995770/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1177201319","html_url":"https://github.com/apache/brpc/pull/1608#issuecomment-1177201319","issue_url":"https://api.github.com/repos/apache/brpc/issues/1608","id":1177201319,"node_id":"IC_kwDOBhmkcs5GKqqn","user":{"login":"tcp9","id":38188494,"node_id":"MDQ6VXNlcjM4MTg4NDk0","avatar_url":"https://avatars.githubusercontent.com/u/38188494?v=4","gravatar_id":"","url":"https://api.github.com/users/tcp9","html_url":"https://github.com/tcp9","followers_url":"https://api.github.com/users/tcp9/followers","following_url":"https://api.github.com/users/tcp9/following{/other_user}","gists_url":"https://api.github.com/users/tcp9/gists{/gist_id}","starred_url":"https://api.github.com/users/tcp9/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tcp9/subscriptions","organizations_url":"https://api.github.com/users/tcp9/orgs","repos_url":"https://api.github.com/users/tcp9/repos","events_url":"https://api.github.com/users/tcp9/events{/privacy}","received_events_url":"https://api.github.com/users/tcp9/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-07T07:38:47Z","updated_at":"2022-07-07T07:38:47Z","author_association":"NONE","body":"> > 想问下 为啥不在brpc_metrics导出呢？\r\n\r\n谢谢@serverglen；是的，我目前基于这个PR已经导出来了，改动比较小，就是metrics维度多的话容易影响/brpc_metrics 性能；","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1177201319/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1177514453","html_url":"https://github.com/apache/brpc/pull/1832#issuecomment-1177514453","issue_url":"https://api.github.com/repos/apache/brpc/issues/1832","id":1177514453,"node_id":"IC_kwDOBhmkcs5GL3HV","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-07T12:14:37Z","updated_at":"2022-07-07T12:14:37Z","author_association":"CONTRIBUTOR","body":"感觉这个功能好像是对brpc现有功能的一个封装？是不是可以作为一个独立的库存在，不用提到brpc的代码库里","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1177514453/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1177540304","html_url":"https://github.com/apache/brpc/pull/1832#issuecomment-1177540304","issue_url":"https://api.github.com/repos/apache/brpc/issues/1832","id":1177540304,"node_id":"IC_kwDOBhmkcs5GL9bQ","user":{"login":"zengkui","id":1586033,"node_id":"MDQ6VXNlcjE1ODYwMzM=","avatar_url":"https://avatars.githubusercontent.com/u/1586033?v=4","gravatar_id":"","url":"https://api.github.com/users/zengkui","html_url":"https://github.com/zengkui","followers_url":"https://api.github.com/users/zengkui/followers","following_url":"https://api.github.com/users/zengkui/following{/other_user}","gists_url":"https://api.github.com/users/zengkui/gists{/gist_id}","starred_url":"https://api.github.com/users/zengkui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zengkui/subscriptions","organizations_url":"https://api.github.com/users/zengkui/orgs","repos_url":"https://api.github.com/users/zengkui/repos","events_url":"https://api.github.com/users/zengkui/events{/privacy}","received_events_url":"https://api.github.com/users/zengkui/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-07T12:34:25Z","updated_at":"2022-07-07T12:34:25Z","author_association":"NONE","body":"> 感觉这个功能好像是对brpc现有功能的一个封装？是不是可以作为一个独立的库存在，不用提到brpc的代码库里\r\n\r\n嗯，最开始我也认为可能不太合适。 提这个request 主要是 jamesge 有这个想法 参见[issue1775](https://github.com/apache/incubator-brpc/issues/1775)，我觉的可以讨论下。 如果合适可以继续merge，不合适的话就放我自己的仓库里了。 ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1177540304/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1177801305","html_url":"https://github.com/apache/brpc/pull/1608#issuecomment-1177801305","issue_url":"https://api.github.com/repos/apache/brpc/issues/1608","id":1177801305,"node_id":"IC_kwDOBhmkcs5GM9JZ","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-07T15:32:53Z","updated_at":"2022-07-07T15:32:53Z","author_association":"CONTRIBUTOR","body":"> > > 想问下 为啥不在brpc_metrics导出呢？\r\n> \r\n> 谢谢@serverglen；是的，我目前基于这个PR已经导出来了，改动比较小，就是metrics维度多的话容易影响/brpc_metrics 性能；\r\n\r\n可以支持按照条件过滤，这样导出的数据应该比较小。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1177801305/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1178491895","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1178491895","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1178491895,"node_id":"IC_kwDOBhmkcs5GPlv3","user":{"login":"Missmiaom","id":10678668,"node_id":"MDQ6VXNlcjEwNjc4NjY4","avatar_url":"https://avatars.githubusercontent.com/u/10678668?v=4","gravatar_id":"","url":"https://api.github.com/users/Missmiaom","html_url":"https://github.com/Missmiaom","followers_url":"https://api.github.com/users/Missmiaom/followers","following_url":"https://api.github.com/users/Missmiaom/following{/other_user}","gists_url":"https://api.github.com/users/Missmiaom/gists{/gist_id}","starred_url":"https://api.github.com/users/Missmiaom/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Missmiaom/subscriptions","organizations_url":"https://api.github.com/users/Missmiaom/orgs","repos_url":"https://api.github.com/users/Missmiaom/repos","events_url":"https://api.github.com/users/Missmiaom/events{/privacy}","received_events_url":"https://api.github.com/users/Missmiaom/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-08T03:08:52Z","updated_at":"2022-07-08T03:10:18Z","author_association":"NONE","body":"@wwbmmm   我们之前用的代码是 0.9.7 版本。我们使用了最新的 master 分支代码，并把我们实现的协议 patch 上去后，再测试发现：\r\n\r\n- 使用新版本，thread_num 设置 1， 3000qps 26个下游节点，耗时很低，和 3000 qps 一个节点情况相当比旧版本测试结果好很多。\r\n- 使用旧版本，thread_num 设置 1，如果设置 qps=0，相当于同步发送，3000qps 26个下游节点，速度可到3000qps，95线时耗小于1ms。\r\n- 使用新旧版本，thread_num 设置 2 或者 3，3000qps 26个下游节点，耗时情况不理想，50线和99线有明显升高。\r\n- bthread_usage 监控值并不高，离 bthread_count 还有空余。\r\n\r\n\r\n这个问题我们在线上服务中遇到了，然后使用了 rpc_press 发现和线上情况类似。但是看 #1763 如果理解没错的话应该是优化 rpc_press 发送时间间隔，以稳定发送 qps，请问为什么还会让耗时情况变好呢？\r\n\r\n另外，我们线上服务是使用异步请求，多线程发送，bthread_usage 也并不高，有空闲\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1178491895/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1178534900","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1178534900","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1178534900,"node_id":"IC_kwDOBhmkcs5GPwP0","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-08T04:26:45Z","updated_at":"2022-07-08T04:26:45Z","author_association":"CONTRIBUTOR","body":"旧版rpc_press的问题是发送qps不稳定，有时瞬间发送大量请求，然后又空闲一段时间没有请求。\r\n我猜测你们线上服务可能也是这种情况。\r\n再加上请求被分散给了26个下游结点，那每个下游可能空闲时间更长，空闲期间线程可能被操作系统挂起，或者内存等资源被换出，再次收到请求时就得重新唤醒，导致长尾耗时变多。\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1178534900/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1178851935","html_url":"https://github.com/apache/brpc/issues/1828#issuecomment-1178851935","issue_url":"https://api.github.com/repos/apache/brpc/issues/1828","id":1178851935,"node_id":"IC_kwDOBhmkcs5GQ9pf","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-08T10:58:25Z","updated_at":"2022-07-08T10:58:25Z","author_association":"CONTRIBUTOR","body":"还有可能是tcp_autocorking导致的，\r\n把/proc/sys/net/ipv4/tcp_autocorking的值改成0试试","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1178851935/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1179465898","html_url":"https://github.com/apache/brpc/issues/1827#issuecomment-1179465898","issue_url":"https://api.github.com/repos/apache/brpc/issues/1827","id":1179465898,"node_id":"IC_kwDOBhmkcs5GTTiq","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-09T02:52:48Z","updated_at":"2022-07-09T02:52:48Z","author_association":"CONTRIBUTOR","body":"@ZhihaoPan weight如果频繁变的话，这块使用WeightedRandomizedLoadBalancer符合业务场景需要吗","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1179465898/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1180018920","html_url":"https://github.com/apache/brpc/issues/1827#issuecomment-1180018920","issue_url":"https://api.github.com/repos/apache/brpc/issues/1827","id":1180018920,"node_id":"IC_kwDOBhmkcs5GVajo","user":{"login":"ZhihaoPan","id":28187784,"node_id":"MDQ6VXNlcjI4MTg3Nzg0","avatar_url":"https://avatars.githubusercontent.com/u/28187784?v=4","gravatar_id":"","url":"https://api.github.com/users/ZhihaoPan","html_url":"https://github.com/ZhihaoPan","followers_url":"https://api.github.com/users/ZhihaoPan/followers","following_url":"https://api.github.com/users/ZhihaoPan/following{/other_user}","gists_url":"https://api.github.com/users/ZhihaoPan/gists{/gist_id}","starred_url":"https://api.github.com/users/ZhihaoPan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZhihaoPan/subscriptions","organizations_url":"https://api.github.com/users/ZhihaoPan/orgs","repos_url":"https://api.github.com/users/ZhihaoPan/repos","events_url":"https://api.github.com/users/ZhihaoPan/events{/privacy}","received_events_url":"https://api.github.com/users/ZhihaoPan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-11T06:32:21Z","updated_at":"2022-07-11T06:35:06Z","author_association":"NONE","body":"> \r\n\r\n@lorinlee 因为机型不同会经常有节点迁移到不同机型上，而且会收到其他部署在该节点上的服务影响，所以我们会动态调整权重。一般10-20s微调一次","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1180018920/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1180172755","html_url":"https://github.com/apache/brpc/issues/1827#issuecomment-1180172755","issue_url":"https://api.github.com/repos/apache/brpc/issues/1827","id":1180172755,"node_id":"IC_kwDOBhmkcs5GWAHT","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-11T09:30:42Z","updated_at":"2022-07-11T09:30:42Z","author_association":"CONTRIBUTOR","body":"@ZhihaoPan 所以可以使用WeightedRandomizedLoadBalancer吗","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1180172755/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181652869","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1181652869","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1181652869,"node_id":"IC_kwDOBhmkcs5GbpeF","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-12T11:38:42Z","updated_at":"2022-07-12T11:38:42Z","author_association":"CONTRIBUTOR","body":"编译gflags的时候也加上-D_GLIBCXX_USE_CXX11_ABI=0了吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181652869/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181682252","html_url":"https://github.com/apache/brpc/pull/1478#issuecomment-1181682252","issue_url":"https://api.github.com/repos/apache/brpc/issues/1478","id":1181682252,"node_id":"IC_kwDOBhmkcs5GbwpM","user":{"login":"TousakaRin","id":8801314,"node_id":"MDQ6VXNlcjg4MDEzMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8801314?v=4","gravatar_id":"","url":"https://api.github.com/users/TousakaRin","html_url":"https://github.com/TousakaRin","followers_url":"https://api.github.com/users/TousakaRin/followers","following_url":"https://api.github.com/users/TousakaRin/following{/other_user}","gists_url":"https://api.github.com/users/TousakaRin/gists{/gist_id}","starred_url":"https://api.github.com/users/TousakaRin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TousakaRin/subscriptions","organizations_url":"https://api.github.com/users/TousakaRin/orgs","repos_url":"https://api.github.com/users/TousakaRin/repos","events_url":"https://api.github.com/users/TousakaRin/events{/privacy}","received_events_url":"https://api.github.com/users/TousakaRin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-12T12:10:31Z","updated_at":"2022-07-12T12:10:31Z","author_association":"CONTRIBUTOR","body":"同步master代码的时候用rebase，不要用merge","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181682252/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181692606","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1181692606","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1181692606,"node_id":"IC_kwDOBhmkcs5GbzK-","user":{"login":"willamhou","id":8574759,"node_id":"MDQ6VXNlcjg1NzQ3NTk=","avatar_url":"https://avatars.githubusercontent.com/u/8574759?v=4","gravatar_id":"","url":"https://api.github.com/users/willamhou","html_url":"https://github.com/willamhou","followers_url":"https://api.github.com/users/willamhou/followers","following_url":"https://api.github.com/users/willamhou/following{/other_user}","gists_url":"https://api.github.com/users/willamhou/gists{/gist_id}","starred_url":"https://api.github.com/users/willamhou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willamhou/subscriptions","organizations_url":"https://api.github.com/users/willamhou/orgs","repos_url":"https://api.github.com/users/willamhou/repos","events_url":"https://api.github.com/users/willamhou/events{/privacy}","received_events_url":"https://api.github.com/users/willamhou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-12T12:20:51Z","updated_at":"2022-07-12T12:53:09Z","author_association":"NONE","body":"> 编译gflags的时候也加上-D_GLIBCXX_USE_CXX11_ABI=0了吗？\r\n刚刚不记得加没加了。重新加了一下，又编译了下brpc。报错和前面一样。\r\n![image](https://user-images.githubusercontent.com/8574759/178494435-d29381ba-1969-4417-8a1a-757234589a4f.png)\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181692606/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181710051","html_url":"https://github.com/apache/brpc/issues/1732#issuecomment-1181710051","issue_url":"https://api.github.com/repos/apache/brpc/issues/1732","id":1181710051,"node_id":"IC_kwDOBhmkcs5Gb3bj","user":{"login":"willamhou","id":8574759,"node_id":"MDQ6VXNlcjg1NzQ3NTk=","avatar_url":"https://avatars.githubusercontent.com/u/8574759?v=4","gravatar_id":"","url":"https://api.github.com/users/willamhou","html_url":"https://github.com/willamhou","followers_url":"https://api.github.com/users/willamhou/followers","following_url":"https://api.github.com/users/willamhou/following{/other_user}","gists_url":"https://api.github.com/users/willamhou/gists{/gist_id}","starred_url":"https://api.github.com/users/willamhou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willamhou/subscriptions","organizations_url":"https://api.github.com/users/willamhou/orgs","repos_url":"https://api.github.com/users/willamhou/repos","events_url":"https://api.github.com/users/willamhou/events{/privacy}","received_events_url":"https://api.github.com/users/willamhou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-12T12:39:04Z","updated_at":"2022-07-12T12:39:04Z","author_association":"NONE","body":"> ABI问题 已经fix。\r\n\r\n怎么解决的？我也遇到了。 ABI的设置都设置成零了，还是报错\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181710051/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181759367","html_url":"https://github.com/apache/brpc/issues/1732#issuecomment-1181759367","issue_url":"https://api.github.com/repos/apache/brpc/issues/1732","id":1181759367,"node_id":"IC_kwDOBhmkcs5GcDeH","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-12T13:26:33Z","updated_at":"2022-07-12T13:26:33Z","author_association":"MEMBER","body":"是否设置为 0 取决于是否所有依赖的模块是否也都设置为 0 了，关键在于统一，都设置为 1 或 0 都是可以正常编译链接的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181759367/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181765130","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1181765130","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1181765130,"node_id":"IC_kwDOBhmkcs5GcE4K","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-12T13:31:49Z","updated_at":"2022-07-12T13:31:49Z","author_association":"MEMBER","body":"gflags 编译完有没有安装？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181765130/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181767064","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1181767064","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1181767064,"node_id":"IC_kwDOBhmkcs5GcFWY","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-12T13:33:39Z","updated_at":"2022-07-12T13:33:39Z","author_association":"MEMBER","body":"印象中 ubuntu 18.04 中 7.5 编译器，系统安装的库都禁用了c++11abi，但编译器默认编译选项是打开的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181767064/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181771318","html_url":"https://github.com/apache/brpc/pull/1478#issuecomment-1181771318","issue_url":"https://api.github.com/repos/apache/brpc/issues/1478","id":1181771318,"node_id":"IC_kwDOBhmkcs5GcGY2","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-12T13:37:14Z","updated_at":"2022-07-12T13:37:14Z","author_association":"MEMBER","body":"> 同步master代码的时候用rebase，不要用merge\r\n\r\n合并的时候涉及单一功能的可以给他 Squash 为一个提交，看起来历史也是线性的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181771318/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181775453","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1181775453","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1181775453,"node_id":"IC_kwDOBhmkcs5GcHZd","user":{"login":"willamhou","id":8574759,"node_id":"MDQ6VXNlcjg1NzQ3NTk=","avatar_url":"https://avatars.githubusercontent.com/u/8574759?v=4","gravatar_id":"","url":"https://api.github.com/users/willamhou","html_url":"https://github.com/willamhou","followers_url":"https://api.github.com/users/willamhou/followers","following_url":"https://api.github.com/users/willamhou/following{/other_user}","gists_url":"https://api.github.com/users/willamhou/gists{/gist_id}","starred_url":"https://api.github.com/users/willamhou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willamhou/subscriptions","organizations_url":"https://api.github.com/users/willamhou/orgs","repos_url":"https://api.github.com/users/willamhou/repos","events_url":"https://api.github.com/users/willamhou/events{/privacy}","received_events_url":"https://api.github.com/users/willamhou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-12T13:41:11Z","updated_at":"2022-07-12T13:41:45Z","author_association":"NONE","body":"> gflags 编译完有没有安装？\r\n都是make install得，日志是显示装上了。现在报protobuf得问题了。\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181775453/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181776888","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1181776888","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1181776888,"node_id":"IC_kwDOBhmkcs5GcHv4","user":{"login":"willamhou","id":8574759,"node_id":"MDQ6VXNlcjg1NzQ3NTk=","avatar_url":"https://avatars.githubusercontent.com/u/8574759?v=4","gravatar_id":"","url":"https://api.github.com/users/willamhou","html_url":"https://github.com/willamhou","followers_url":"https://api.github.com/users/willamhou/followers","following_url":"https://api.github.com/users/willamhou/following{/other_user}","gists_url":"https://api.github.com/users/willamhou/gists{/gist_id}","starred_url":"https://api.github.com/users/willamhou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willamhou/subscriptions","organizations_url":"https://api.github.com/users/willamhou/orgs","repos_url":"https://api.github.com/users/willamhou/repos","events_url":"https://api.github.com/users/willamhou/events{/privacy}","received_events_url":"https://api.github.com/users/willamhou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-12T13:42:26Z","updated_at":"2022-07-12T13:42:26Z","author_association":"NONE","body":"> 印象中 ubuntu 18.04 中 7.5 编译器，系统安装的库都禁用了c++11abi，但编译器默认编译选项是打开的。\r\n\r\n我看了现在得，\r\n\r\n> 印象中 ubuntu 18.04 中 7.5 编译器，系统安装的库都禁用了c++11abi，但编译器默认编译选项是打开的。\r\n\r\n没有默认打开，现在正在编译protobuf，手动打开的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181776888/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181777699","html_url":"https://github.com/apache/brpc/issues/1732#issuecomment-1181777699","issue_url":"https://api.github.com/repos/apache/brpc/issues/1732","id":1181777699,"node_id":"IC_kwDOBhmkcs5GcH8j","user":{"login":"willamhou","id":8574759,"node_id":"MDQ6VXNlcjg1NzQ3NTk=","avatar_url":"https://avatars.githubusercontent.com/u/8574759?v=4","gravatar_id":"","url":"https://api.github.com/users/willamhou","html_url":"https://github.com/willamhou","followers_url":"https://api.github.com/users/willamhou/followers","following_url":"https://api.github.com/users/willamhou/following{/other_user}","gists_url":"https://api.github.com/users/willamhou/gists{/gist_id}","starred_url":"https://api.github.com/users/willamhou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willamhou/subscriptions","organizations_url":"https://api.github.com/users/willamhou/orgs","repos_url":"https://api.github.com/users/willamhou/repos","events_url":"https://api.github.com/users/willamhou/events{/privacy}","received_events_url":"https://api.github.com/users/willamhou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-12T13:43:08Z","updated_at":"2022-07-12T13:43:08Z","author_association":"NONE","body":"> nm -AC ./src/.libs/libprotobuf.a |grep \"GetString\"\r\n\r\n正在统一的ABI处理方式\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1181777699/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1182687401","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1182687401","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1182687401,"node_id":"IC_kwDOBhmkcs5GfmCp","user":{"login":"willamhou","id":8574759,"node_id":"MDQ6VXNlcjg1NzQ3NTk=","avatar_url":"https://avatars.githubusercontent.com/u/8574759?v=4","gravatar_id":"","url":"https://api.github.com/users/willamhou","html_url":"https://github.com/willamhou","followers_url":"https://api.github.com/users/willamhou/followers","following_url":"https://api.github.com/users/willamhou/following{/other_user}","gists_url":"https://api.github.com/users/willamhou/gists{/gist_id}","starred_url":"https://api.github.com/users/willamhou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willamhou/subscriptions","organizations_url":"https://api.github.com/users/willamhou/orgs","repos_url":"https://api.github.com/users/willamhou/repos","events_url":"https://api.github.com/users/willamhou/events{/privacy}","received_events_url":"https://api.github.com/users/willamhou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-13T02:13:21Z","updated_at":"2022-07-13T02:14:44Z","author_association":"NONE","body":"gflags \r\n![image](https://user-images.githubusercontent.com/8574759/178636017-65198b52-b3da-4e40-b84e-fba870717aff.png)\r\n\r\nprotobuf\r\n![image](https://user-images.githubusercontent.com/8574759/178636387-baff26fe-2cac-43bc-9c63-a4ff6ceddcfa.png)\r\nprotobuf 装完然后ldconfig\r\n![image](https://user-images.githubusercontent.com/8574759/178636387-baff26fe-2cac-43bc-9c63-a4ff6ceddcfa.png)\r\n\r\n但是重新编译还是会报上面的错，同时makefile增加了-D_GLIBCXX_USE_CXX11_ABI=0","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1182687401/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1182702601","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1182702601","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1182702601,"node_id":"IC_kwDOBhmkcs5GfpwJ","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-13T02:45:22Z","updated_at":"2022-07-13T02:45:43Z","author_association":"MEMBER","body":"`protoc-gen-mcpack` master 上最近刚改了一个 Makefile 中编译参数未生效的问题，release-1.1 应该没这个修正，可以换 master 试试。\r\n\r\n#1824 ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1182702601/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1182733472","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1182733472","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1182733472,"node_id":"IC_kwDOBhmkcs5GfxSg","user":{"login":"willamhou","id":8574759,"node_id":"MDQ6VXNlcjg1NzQ3NTk=","avatar_url":"https://avatars.githubusercontent.com/u/8574759?v=4","gravatar_id":"","url":"https://api.github.com/users/willamhou","html_url":"https://github.com/willamhou","followers_url":"https://api.github.com/users/willamhou/followers","following_url":"https://api.github.com/users/willamhou/following{/other_user}","gists_url":"https://api.github.com/users/willamhou/gists{/gist_id}","starred_url":"https://api.github.com/users/willamhou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willamhou/subscriptions","organizations_url":"https://api.github.com/users/willamhou/orgs","repos_url":"https://api.github.com/users/willamhou/repos","events_url":"https://api.github.com/users/willamhou/events{/privacy}","received_events_url":"https://api.github.com/users/willamhou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-13T03:48:31Z","updated_at":"2022-07-13T03:48:31Z","author_association":"NONE","body":"> `protoc-gen-mcpack` master 上最近刚改了一个 Makefile 中编译参数未生效的问题，release-1.1 应该没这个修正，可以换 master 试试。\r\n> \r\n> #1824\r\n\r\n我试一下。BTW 我找了大概是3年的版本编译了下，重新编译了下leveldb, 整个就正常compile 了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1182733472/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1182736585","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1182736585","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1182736585,"node_id":"IC_kwDOBhmkcs5GfyDJ","user":{"login":"willamhou","id":8574759,"node_id":"MDQ6VXNlcjg1NzQ3NTk=","avatar_url":"https://avatars.githubusercontent.com/u/8574759?v=4","gravatar_id":"","url":"https://api.github.com/users/willamhou","html_url":"https://github.com/willamhou","followers_url":"https://api.github.com/users/willamhou/followers","following_url":"https://api.github.com/users/willamhou/following{/other_user}","gists_url":"https://api.github.com/users/willamhou/gists{/gist_id}","starred_url":"https://api.github.com/users/willamhou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willamhou/subscriptions","organizations_url":"https://api.github.com/users/willamhou/orgs","repos_url":"https://api.github.com/users/willamhou/repos","events_url":"https://api.github.com/users/willamhou/events{/privacy}","received_events_url":"https://api.github.com/users/willamhou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-13T03:55:51Z","updated_at":"2022-07-13T03:55:51Z","author_association":"NONE","body":"> `protoc-gen-mcpack` master 上最近刚改了一个 Makefile 中编译参数未生效的问题，release-1.1 应该没这个修正，可以换 master 试试。\r\n> \r\n> #1824\r\nmaster，从日志里看是带上-D_GLIBCXX_USE_CXX11_ABI=0.  结果仍旧是报错的\r\n![image](https://user-images.githubusercontent.com/8574759/178647154-2fbb9771-d9b5-4d38-af83-aa108c48078d.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1182736585/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1182806020","html_url":"https://github.com/apache/brpc/issues/1835#issuecomment-1182806020","issue_url":"https://api.github.com/repos/apache/brpc/issues/1835","id":1182806020,"node_id":"IC_kwDOBhmkcs5GgDAE","user":{"login":"Lao-Bee","id":18545974,"node_id":"MDQ6VXNlcjE4NTQ1OTc0","avatar_url":"https://avatars.githubusercontent.com/u/18545974?v=4","gravatar_id":"","url":"https://api.github.com/users/Lao-Bee","html_url":"https://github.com/Lao-Bee","followers_url":"https://api.github.com/users/Lao-Bee/followers","following_url":"https://api.github.com/users/Lao-Bee/following{/other_user}","gists_url":"https://api.github.com/users/Lao-Bee/gists{/gist_id}","starred_url":"https://api.github.com/users/Lao-Bee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lao-Bee/subscriptions","organizations_url":"https://api.github.com/users/Lao-Bee/orgs","repos_url":"https://api.github.com/users/Lao-Bee/repos","events_url":"https://api.github.com/users/Lao-Bee/events{/privacy}","received_events_url":"https://api.github.com/users/Lao-Bee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-13T06:10:22Z","updated_at":"2022-07-13T06:10:22Z","author_association":"NONE","body":"问题的复现方式：\r\n\r\n在一个线程中先构造一个 `http client` ，调用 `CallMethod(nullptr, &_cntl, req, resp, nullptr);`\r\n执行完成之后，又构造一个 `http client`, 调用 `CallMethod(nullptr, &_cntl, req, resp, done);`，此时 done 不为空。\r\n\r\n当我把第二次构造的 `http client` 的 `done` 也传入空时，异常就没再出现。\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1182806020/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183002117","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1183002117","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1183002117,"node_id":"IC_kwDOBhmkcs5Ggy4F","user":{"login":"willamhou","id":8574759,"node_id":"MDQ6VXNlcjg1NzQ3NTk=","avatar_url":"https://avatars.githubusercontent.com/u/8574759?v=4","gravatar_id":"","url":"https://api.github.com/users/willamhou","html_url":"https://github.com/willamhou","followers_url":"https://api.github.com/users/willamhou/followers","following_url":"https://api.github.com/users/willamhou/following{/other_user}","gists_url":"https://api.github.com/users/willamhou/gists{/gist_id}","starred_url":"https://api.github.com/users/willamhou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willamhou/subscriptions","organizations_url":"https://api.github.com/users/willamhou/orgs","repos_url":"https://api.github.com/users/willamhou/repos","events_url":"https://api.github.com/users/willamhou/events{/privacy}","received_events_url":"https://api.github.com/users/willamhou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-13T09:40:51Z","updated_at":"2022-07-13T09:54:55Z","author_association":"NONE","body":"更新，将版本回退到 e93e0c2afef5350a05e18cebf1a9677d345af5ec 这个提交后。\r\n执行mkdir bld && cd bld && cmake .. && make，在bld目录下的lib中可以正常编译出libbrcp.a 和 libbrpc.so.\r\n\r\n![image](https://user-images.githubusercontent.com/8574759/178706023-52c89d3c-f4e6-4d7b-bac4-b519feba0609.png)\r\n\r\n但是同样的环境，利用config_brpc.sh 编译会报原来的错误.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183002117/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183030081","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1183030081","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1183030081,"node_id":"IC_kwDOBhmkcs5Gg5tB","user":{"login":"willamhou","id":8574759,"node_id":"MDQ6VXNlcjg1NzQ3NTk=","avatar_url":"https://avatars.githubusercontent.com/u/8574759?v=4","gravatar_id":"","url":"https://api.github.com/users/willamhou","html_url":"https://github.com/willamhou","followers_url":"https://api.github.com/users/willamhou/followers","following_url":"https://api.github.com/users/willamhou/following{/other_user}","gists_url":"https://api.github.com/users/willamhou/gists{/gist_id}","starred_url":"https://api.github.com/users/willamhou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willamhou/subscriptions","organizations_url":"https://api.github.com/users/willamhou/orgs","repos_url":"https://api.github.com/users/willamhou/repos","events_url":"https://api.github.com/users/willamhou/events{/privacy}","received_events_url":"https://api.github.com/users/willamhou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-13T10:08:44Z","updated_at":"2022-07-13T10:08:44Z","author_association":"NONE","body":"发现了新问题\r\n1. master分支下，直接执行cmake -B build && cmake --build build -j6，会报错。\r\n![image](https://user-images.githubusercontent.com/8574759/178706772-0efb4b5f-d836-463a-9b5b-f0d702815bb2.png)\r\n\r\n2. 当新建build目录，并将CMakeList.txt及config.h.in拷贝进build目录下，会报GFLAGS_NAMESPACE错.\r\n![image](https://user-images.githubusercontent.com/8574759/178707102-d5ab7045-0153-4b56-873c-660084fd6db3.png)\r\n\r\n3. 不使用\"cmake -B build && cmake --build build -j6\", 使用mkdir bld && cd bld && cmake .. && make是可以编译的\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183030081/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183154984","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1183154984","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1183154984,"node_id":"IC_kwDOBhmkcs5GhYMo","user":{"login":"willamhou","id":8574759,"node_id":"MDQ6VXNlcjg1NzQ3NTk=","avatar_url":"https://avatars.githubusercontent.com/u/8574759?v=4","gravatar_id":"","url":"https://api.github.com/users/willamhou","html_url":"https://github.com/willamhou","followers_url":"https://api.github.com/users/willamhou/followers","following_url":"https://api.github.com/users/willamhou/following{/other_user}","gists_url":"https://api.github.com/users/willamhou/gists{/gist_id}","starred_url":"https://api.github.com/users/willamhou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willamhou/subscriptions","organizations_url":"https://api.github.com/users/willamhou/orgs","repos_url":"https://api.github.com/users/willamhou/repos","events_url":"https://api.github.com/users/willamhou/events{/privacy}","received_events_url":"https://api.github.com/users/willamhou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-13T12:22:35Z","updated_at":"2022-07-13T12:23:39Z","author_association":"NONE","body":"update  \r\n1. config_brpc.sh的方式可以正常编译了. \r\n2. cmake的报刚刚的错误\r\nhttps://user-images.githubusercontent.com/8574759/178707102-d5ab7045-0153-4b56-873c-660084fd6db3.png","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183154984/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183171323","html_url":"https://github.com/apache/brpc/issues/1835#issuecomment-1183171323","issue_url":"https://api.github.com/repos/apache/brpc/issues/1835","id":1183171323,"node_id":"IC_kwDOBhmkcs5GhcL7","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-13T12:38:27Z","updated_at":"2022-07-13T12:38:27Z","author_association":"CONTRIBUTOR","body":"> 问题的复现方式：\r\n> \r\n> 在一个线程中先构造一个 `http client` ，调用 `CallMethod(nullptr, &_cntl, req, resp, nullptr);` 执行完成之后，又构造一个 `http client`, 调用 `CallMethod(nullptr, &_cntl, req, resp, done);`，此时 done 不为空。\r\n> \r\n> 当我把第二次构造的 `http client` 的 `done` 也传入空时，异常就没再出现。\r\n\r\n异步调用的话，检查下是否在done中使用了controller，有可能这个controller在返回response后提前被析构了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183171323/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183204863","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1183204863","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1183204863,"node_id":"IC_kwDOBhmkcs5GhkX_","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-13T13:10:28Z","updated_at":"2022-07-13T13:12:35Z","author_association":"MEMBER","body":"> 发现了新问题\r\n> \r\n> 1. master分支下，直接执行cmake -B build && cmake --build build -j6，会报错。\r\n> 2. 当新建build目录，并将CMakeList.txt及config.h.in拷贝进build目录下，会报GFLAGS_NAMESPACE错.\r\n\r\ncmake 就不是这么用的，没必要拿一个错误的尝试说有问题...\r\n\r\n稍后更新 cmake 相关编译文档。\r\n\r\n> 3. 不使用\"cmake -B build && cmake --build build -j6\", 使用mkdir bld && cd bld && cmake .. && make是可以编译的\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183204863/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183207548","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1183207548","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1183207548,"node_id":"IC_kwDOBhmkcs5GhlB8","user":{"login":"willamhou","id":8574759,"node_id":"MDQ6VXNlcjg1NzQ3NTk=","avatar_url":"https://avatars.githubusercontent.com/u/8574759?v=4","gravatar_id":"","url":"https://api.github.com/users/willamhou","html_url":"https://github.com/willamhou","followers_url":"https://api.github.com/users/willamhou/followers","following_url":"https://api.github.com/users/willamhou/following{/other_user}","gists_url":"https://api.github.com/users/willamhou/gists{/gist_id}","starred_url":"https://api.github.com/users/willamhou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willamhou/subscriptions","organizations_url":"https://api.github.com/users/willamhou/orgs","repos_url":"https://api.github.com/users/willamhou/repos","events_url":"https://api.github.com/users/willamhou/events{/privacy}","received_events_url":"https://api.github.com/users/willamhou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-13T13:12:54Z","updated_at":"2022-07-13T13:12:54Z","author_association":"NONE","body":"> > 发现了新问题\r\n> > \r\n> > 1. master分支下，直接执行cmake -B build && cmake --build build -j6，会报错。\r\n> > 2. 当新建build目录，并将CMakeList.txt及config.h.in拷贝进build目录下，会报GFLAGS_NAMESPACE错.\r\n> \r\n> cmake 就不是这么用的，没必要拿一个错误的尝试说有问题...\r\n> \r\n> > 3. 不使用\"cmake -B build && cmake --build build -j6\", 使用mkdir bld && cd bld && cmake .. && make是可以编译的\r\n文档上是这么写的。\r\n![image](https://user-images.githubusercontent.com/8574759/178741733-bdf530b7-5a2e-4c1a-a6e0-fd756c5b33a5.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183207548/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183208630","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1183208630","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1183208630,"node_id":"IC_kwDOBhmkcs5GhlS2","user":{"login":"willamhou","id":8574759,"node_id":"MDQ6VXNlcjg1NzQ3NTk=","avatar_url":"https://avatars.githubusercontent.com/u/8574759?v=4","gravatar_id":"","url":"https://api.github.com/users/willamhou","html_url":"https://github.com/willamhou","followers_url":"https://api.github.com/users/willamhou/followers","following_url":"https://api.github.com/users/willamhou/following{/other_user}","gists_url":"https://api.github.com/users/willamhou/gists{/gist_id}","starred_url":"https://api.github.com/users/willamhou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willamhou/subscriptions","organizations_url":"https://api.github.com/users/willamhou/orgs","repos_url":"https://api.github.com/users/willamhou/repos","events_url":"https://api.github.com/users/willamhou/events{/privacy}","received_events_url":"https://api.github.com/users/willamhou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-13T13:13:50Z","updated_at":"2022-07-13T13:13:50Z","author_association":"NONE","body":"> > 发现了新问题\r\n> > \r\n> > 1. master分支下，直接执行cmake -B build && cmake --build build -j6，会报错。\r\n> > 2. 当新建build目录，并将CMakeList.txt及config.h.in拷贝进build目录下，会报GFLAGS_NAMESPACE错.\r\n> \r\n> cmake 就不是这么用的，没必要拿一个错误的尝试说有问题...\r\n> \r\n> 稍后更新 cmake 相关编译文档。\r\n> \r\n> > 3. 不使用\"cmake -B build && cmake --build build -j6\", 使用mkdir bld && cd bld && cmake .. && make是可以编译的\r\n\r\n我可以正确的使用cmake来编译。只不过顺手尝试文档的方式发现他是不work的\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183208630/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183230650","html_url":"https://github.com/apache/brpc/issues/1827#issuecomment-1183230650","issue_url":"https://api.github.com/repos/apache/brpc/issues/1827","id":1183230650,"node_id":"IC_kwDOBhmkcs5Ghqq6","user":{"login":"ZhihaoPan","id":28187784,"node_id":"MDQ6VXNlcjI4MTg3Nzg0","avatar_url":"https://avatars.githubusercontent.com/u/28187784?v=4","gravatar_id":"","url":"https://api.github.com/users/ZhihaoPan","html_url":"https://github.com/ZhihaoPan","followers_url":"https://api.github.com/users/ZhihaoPan/followers","following_url":"https://api.github.com/users/ZhihaoPan/following{/other_user}","gists_url":"https://api.github.com/users/ZhihaoPan/gists{/gist_id}","starred_url":"https://api.github.com/users/ZhihaoPan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ZhihaoPan/subscriptions","organizations_url":"https://api.github.com/users/ZhihaoPan/orgs","repos_url":"https://api.github.com/users/ZhihaoPan/repos","events_url":"https://api.github.com/users/ZhihaoPan/events{/privacy}","received_events_url":"https://api.github.com/users/ZhihaoPan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-13T13:33:18Z","updated_at":"2022-07-13T13:33:18Z","author_association":"NONE","body":"@lorinlee 看了下代码应该是可以满足要求的，只是random的担心某些qps小的下游会不稳定 问题应该不大。 只是为啥不在wrr里面也保证下第一次的概率呢。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183230650/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183321057","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1183321057","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1183321057,"node_id":"IC_kwDOBhmkcs5GiAvh","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-13T14:48:39Z","updated_at":"2022-07-13T14:48:39Z","author_association":"MEMBER","body":"`-B` 选项是在 3.13+ 的版本引入的, Ubuntu 18.04 中还是 3.10, 不支持该选项, 文档已更新.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183321057/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183834890","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1183834890","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1183834890,"node_id":"IC_kwDOBhmkcs5Gj-MK","user":{"login":"willamhou","id":8574759,"node_id":"MDQ6VXNlcjg1NzQ3NTk=","avatar_url":"https://avatars.githubusercontent.com/u/8574759?v=4","gravatar_id":"","url":"https://api.github.com/users/willamhou","html_url":"https://github.com/willamhou","followers_url":"https://api.github.com/users/willamhou/followers","following_url":"https://api.github.com/users/willamhou/following{/other_user}","gists_url":"https://api.github.com/users/willamhou/gists{/gist_id}","starred_url":"https://api.github.com/users/willamhou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willamhou/subscriptions","organizations_url":"https://api.github.com/users/willamhou/orgs","repos_url":"https://api.github.com/users/willamhou/repos","events_url":"https://api.github.com/users/willamhou/events{/privacy}","received_events_url":"https://api.github.com/users/willamhou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-14T01:01:27Z","updated_at":"2022-07-14T01:01:27Z","author_association":"NONE","body":"> `-B` 选项是在 3.13+ 的版本引入的, Ubuntu 18.04 中还是 3.10, 不支持该选项, 文档已更新.\r\n\r\nGet. Thx, 感谢解答。另外是否需要一个官方编译镜像？我可以提供centos 和 ubuntu的","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183834890/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183840091","html_url":"https://github.com/apache/brpc/issues/1833#issuecomment-1183840091","issue_url":"https://api.github.com/repos/apache/brpc/issues/1833","id":1183840091,"node_id":"IC_kwDOBhmkcs5Gj_db","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-14T01:11:34Z","updated_at":"2022-07-14T01:11:34Z","author_association":"MEMBER","body":"使用的场景通常应该不是标准化的场景，如果和运行环境不符的话，编译镜像适用性就没那么大了，毕竟是要集成在用户应用中编译的。只是测试用的话也可以考虑提供几个常用发行版的安装包，开发用还是建议自己编一遍，即便趟一遍坑我觉得也是有益的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183840091/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183854668","html_url":"https://github.com/apache/brpc/issues/1835#issuecomment-1183854668","issue_url":"https://api.github.com/repos/apache/brpc/issues/1835","id":1183854668,"node_id":"IC_kwDOBhmkcs5GkDBM","user":{"login":"Lao-Bee","id":18545974,"node_id":"MDQ6VXNlcjE4NTQ1OTc0","avatar_url":"https://avatars.githubusercontent.com/u/18545974?v=4","gravatar_id":"","url":"https://api.github.com/users/Lao-Bee","html_url":"https://github.com/Lao-Bee","followers_url":"https://api.github.com/users/Lao-Bee/followers","following_url":"https://api.github.com/users/Lao-Bee/following{/other_user}","gists_url":"https://api.github.com/users/Lao-Bee/gists{/gist_id}","starred_url":"https://api.github.com/users/Lao-Bee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lao-Bee/subscriptions","organizations_url":"https://api.github.com/users/Lao-Bee/orgs","repos_url":"https://api.github.com/users/Lao-Bee/repos","events_url":"https://api.github.com/users/Lao-Bee/events{/privacy}","received_events_url":"https://api.github.com/users/Lao-Bee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-14T01:27:25Z","updated_at":"2022-07-14T01:27:25Z","author_association":"NONE","body":"> > 问题的复现方式：\r\n> > 在一个线程中先构造一个 `http client` ，调用 `CallMethod(nullptr, &_cntl, req, resp, nullptr);` 执行完成之后，又构造一个 `http client`, 调用 `CallMethod(nullptr, &_cntl, req, resp, done);`，此时 done 不为空。\r\n> > 当我把第二次构造的 `http client` 的 `done` 也传入空时，异常就没再出现。\r\n> \r\n> 异步调用的话，检查下是否在done中使用了controller，有可能这个controller在返回response后提前被析构了。\r\n\r\n`done` 继承 `google::protobuf::Closure` ， 里边没有使用到 `controller`。`new` 了一个 `done`, 在它的 `run()` 最后 执行了 `delete this` 对它进行了释放。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183854668/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183913048","html_url":"https://github.com/apache/brpc/issues/1835#issuecomment-1183913048","issue_url":"https://api.github.com/repos/apache/brpc/issues/1835","id":1183913048,"node_id":"IC_kwDOBhmkcs5GkRRY","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-14T02:27:13Z","updated_at":"2022-07-14T02:27:13Z","author_association":"CONTRIBUTOR","body":"@liu-meng-06 请问brpc是用了哪个版本，linux发行版是哪个，以及用了什么版本的编译器。如果不是最新版本的brpc，建议先升级到最新尝试一下\r\n\r\n另外如果用http client的example是可复现的，辛苦提供一个完整的最小可复现代码片段吧","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183913048/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183930605","html_url":"https://github.com/apache/brpc/issues/502#issuecomment-1183930605","issue_url":"https://api.github.com/repos/apache/brpc/issues/502","id":1183930605,"node_id":"IC_kwDOBhmkcs5GkVjt","user":{"login":"eyun221","id":9376835,"node_id":"MDQ6VXNlcjkzNzY4MzU=","avatar_url":"https://avatars.githubusercontent.com/u/9376835?v=4","gravatar_id":"","url":"https://api.github.com/users/eyun221","html_url":"https://github.com/eyun221","followers_url":"https://api.github.com/users/eyun221/followers","following_url":"https://api.github.com/users/eyun221/following{/other_user}","gists_url":"https://api.github.com/users/eyun221/gists{/gist_id}","starred_url":"https://api.github.com/users/eyun221/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eyun221/subscriptions","organizations_url":"https://api.github.com/users/eyun221/orgs","repos_url":"https://api.github.com/users/eyun221/repos","events_url":"https://api.github.com/users/eyun221/events{/privacy}","received_events_url":"https://api.github.com/users/eyun221/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-14T03:03:32Z","updated_at":"2022-07-14T03:08:40Z","author_association":"NONE","body":"@wanglun @wuw92 大佬，问下这个fix有在生产环境使用吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183930605/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183933351","html_url":"https://github.com/apache/brpc/issues/502#issuecomment-1183933351","issue_url":"https://api.github.com/repos/apache/brpc/issues/502","id":1183933351,"node_id":"IC_kwDOBhmkcs5GkWOn","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-14T03:08:58Z","updated_at":"2022-07-14T03:08:58Z","author_association":"CONTRIBUTOR","body":"> @wanglun @wuw92 大佬，问下这个fix有在生产环境使用吗？\r\n\r\n有的，百度内部一直在用","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183933351/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183943860","html_url":"https://github.com/apache/brpc/issues/502#issuecomment-1183943860","issue_url":"https://api.github.com/repos/apache/brpc/issues/502","id":1183943860,"node_id":"IC_kwDOBhmkcs5GkYy0","user":{"login":"eyun221","id":9376835,"node_id":"MDQ6VXNlcjkzNzY4MzU=","avatar_url":"https://avatars.githubusercontent.com/u/9376835?v=4","gravatar_id":"","url":"https://api.github.com/users/eyun221","html_url":"https://github.com/eyun221","followers_url":"https://api.github.com/users/eyun221/followers","following_url":"https://api.github.com/users/eyun221/following{/other_user}","gists_url":"https://api.github.com/users/eyun221/gists{/gist_id}","starred_url":"https://api.github.com/users/eyun221/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eyun221/subscriptions","organizations_url":"https://api.github.com/users/eyun221/orgs","repos_url":"https://api.github.com/users/eyun221/repos","events_url":"https://api.github.com/users/eyun221/events{/privacy}","received_events_url":"https://api.github.com/users/eyun221/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-14T03:30:51Z","updated_at":"2022-07-14T03:30:51Z","author_association":"NONE","body":"> \r\n\r\n好的，感谢大佬，这个fix为啥不合并到master呢？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183943860/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183953991","html_url":"https://github.com/apache/brpc/issues/502#issuecomment-1183953991","issue_url":"https://api.github.com/repos/apache/brpc/issues/502","id":1183953991,"node_id":"IC_kwDOBhmkcs5GkbRH","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-14T03:50:03Z","updated_at":"2022-07-14T03:50:03Z","author_association":"CONTRIBUTOR","body":"> > \r\n> \r\n> 好的，感谢大佬，这个fix为啥不合并到master呢？\r\n\r\n之前漏了，近期合入一下\r\n@KaneVV1 ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1183953991/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1184088881","html_url":"https://github.com/apache/brpc/pull/1838#issuecomment-1184088881","issue_url":"https://api.github.com/repos/apache/brpc/issues/1838","id":1184088881,"node_id":"IC_kwDOBhmkcs5Gk8Mx","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-14T07:21:46Z","updated_at":"2022-07-14T07:21:46Z","author_association":"CONTRIBUTOR","body":"Fix #502 ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1184088881/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1184205155","html_url":"https://github.com/apache/brpc/pull/1838#issuecomment-1184205155","issue_url":"https://api.github.com/repos/apache/brpc/issues/1838","id":1184205155,"node_id":"IC_kwDOBhmkcs5GlYlj","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-14T09:18:53Z","updated_at":"2022-07-14T09:18:53Z","author_association":"CONTRIBUTOR","body":"[  FAILED  ] LoadBalancerTest.doubly_buffered_data\r\n单测挂了，应该得改一下单测","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1184205155/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1185126862","html_url":"https://github.com/apache/brpc/pull/1814#issuecomment-1185126862","issue_url":"https://api.github.com/repos/apache/brpc/issues/1814","id":1185126862,"node_id":"IC_kwDOBhmkcs5Go5nO","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-15T03:08:27Z","updated_at":"2022-07-15T03:08:27Z","author_association":"CONTRIBUTOR","body":"@zyearn 请问一下，还有什么其他解决方案或者建议吗？最近一个月内有几个服务因为这个问题导致coredump了，麻烦有空推进一下呢。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1185126862/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1185534843","html_url":"https://github.com/apache/brpc/issues/1835#issuecomment-1185534843","issue_url":"https://api.github.com/repos/apache/brpc/issues/1835","id":1185534843,"node_id":"IC_kwDOBhmkcs5GqdN7","user":{"login":"Lao-Bee","id":18545974,"node_id":"MDQ6VXNlcjE4NTQ1OTc0","avatar_url":"https://avatars.githubusercontent.com/u/18545974?v=4","gravatar_id":"","url":"https://api.github.com/users/Lao-Bee","html_url":"https://github.com/Lao-Bee","followers_url":"https://api.github.com/users/Lao-Bee/followers","following_url":"https://api.github.com/users/Lao-Bee/following{/other_user}","gists_url":"https://api.github.com/users/Lao-Bee/gists{/gist_id}","starred_url":"https://api.github.com/users/Lao-Bee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Lao-Bee/subscriptions","organizations_url":"https://api.github.com/users/Lao-Bee/orgs","repos_url":"https://api.github.com/users/Lao-Bee/repos","events_url":"https://api.github.com/users/Lao-Bee/events{/privacy}","received_events_url":"https://api.github.com/users/Lao-Bee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-15T13:15:10Z","updated_at":"2022-07-15T13:15:47Z","author_association":"NONE","body":"> @liu-meng-06 请问brpc是用了哪个版本，linux发行版是哪个，以及用了什么版本的编译器。如果不是最新版本的brpc，建议先升级到最新尝试一下\r\n> \r\n> 另外如果用http client的example是可复现的，辛苦提供一个完整的最小可复现代码片段吧\r\n\r\n> \r\n\r\n- 代码\r\n\r\n``` c++\r\n#include \"test.pb.h\"\r\n#include <brpc/channel.h>\r\n#include <butil/logging.h>\r\n#include <memory>\r\n#include <boost/asio/thread_pool.hpp>\r\n#include <boost/asio/post.hpp>\r\n\r\n#define HOST \"127.0.0.1\"\r\n#define PORT (8009)\r\n\r\nclass Done : public google::protobuf::Closure {\r\npublic:\r\n    explicit Done(int idx)\r\n        : _idx(idx) {}\r\n    ~Done() override = default;\r\n\r\n    void Run() override {\r\n        LOG(DEBUG) << \"done, idx = \" << _idx;\r\n        delete this;\r\n    }\r\n\r\nprivate:\r\n    int _idx;\r\n};\r\n\r\n\r\nstatic int send(\r\n    const std::string &urlPath, const google::protobuf::Message *req,\r\n    google::protobuf::Message *resp, google::protobuf::Closure *done) {\r\n    brpc::Controller cntl;\r\n    brpc::Channel channel;\r\n    cntl.http_request().uri() = urlPath;\r\n    cntl.http_request().set_method(brpc::HTTP_METHOD_POST);\r\n    brpc::ChannelOptions channel_options;\r\n    channel_options.protocol = brpc::PROTOCOL_HTTP;\r\n    channel_options.timeout_ms = 10000;\r\n\r\n    try {\r\n        if (channel.Init(HOST, PORT, &channel_options) != 0) {\r\n            LOG(ERROR) << \"Fail to init channel \";\r\n            return -1;\r\n        }\r\n\r\n        channel.CallMethod(nullptr, &cntl, req, resp, done);\r\n        if (!cntl.Failed()) {\r\n            return -1;\r\n        }\r\n        LOG(WARNING) << \"call \" << cntl.http_request().uri()\r\n                     << \" failed : \" << cntl.ErrorText();\r\n    } catch (...) {\r\n        LOG(DEBUG) << \"channel init failed, address = \";\r\n        return -1;\r\n    }\r\n    return 0;\r\n}\r\n\r\nint main() {\r\n\r\n    boost::asio::thread_pool pool(5);\r\n\r\n    for (int i = 0; i< 20; ++i) {\r\n        boost::asio::post(pool, [=]() {\r\n            // 如果不添加到 thread 中，运行没有问题\r\n            // 或者添加到线程池，请求 ”/foo2“ 时，done = nullptr 运行也没有问题\r\n            LOG(DEBUG) << \"i = \" << i;\r\n            test::foo::FooRequest1 request1;\r\n            test::foo::FooResponse1 response1;\r\n            request1.set_id(\"foo2\");\r\n            request1.set_name(\"张三\");\r\n            request1.set_age(20);\r\n            send(\"/foo1\", &response1, &response1, nullptr);\r\n\r\n            test::foo::FooRequest2 request2;\r\n            test::foo::FooResponse2 response2;\r\n            request2.set_id(\"foo2\");\r\n            request2.set_state(1);\r\n            auto *done = new Done(i);\r\n            send(\"/foo2\", &response2, &response2, done);\r\n\r\n        });\r\n        usleep(100000);\r\n    }\r\n\r\n    pool.join();\r\n\r\n    return 0;\r\n}\r\n\r\n```\r\n\r\n- proto\r\n\r\n``` proto\r\nsyntax = \"proto2\";\r\n\r\npackage test.foo;\r\n\r\noption  cc_enable_arenas = true;\r\n\r\nmessage FooRequest1 {\r\n  optional string id = 1;\r\n  optional string name = 2;\r\n  optional int32 age = 3;\r\n}\r\n\r\nmessage FooResponse1 {}\r\n\r\nmessage FooRequest2 {\r\n  optional string id = 1;\r\n  optional int32 state = 2;\r\n}\r\n\r\nmessage FooResponse2 {}\r\n\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1185534843/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186094968","html_url":"https://github.com/apache/brpc/pull/1812#issuecomment-1186094968","issue_url":"https://api.github.com/repos/apache/brpc/issues/1812","id":1186094968,"node_id":"IC_kwDOBhmkcs5Gsl94","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-16T05:39:12Z","updated_at":"2022-07-16T05:39:12Z","author_association":"CONTRIBUTOR","body":"@renzhong could you please fix this ci issue? thanks!","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186094968/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186099973","html_url":"https://github.com/apache/brpc/issues/1839#issuecomment-1186099973","issue_url":"https://api.github.com/repos/apache/brpc/issues/1839","id":1186099973,"node_id":"IC_kwDOBhmkcs5GsnMF","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-16T06:23:16Z","updated_at":"2022-07-16T06:23:16Z","author_association":"MEMBER","body":"Skywalking 只检查了授权部分，还需要支持类似自动下载发布包，校验 sha512，验证签名以及必要的其他文件内容的检查。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186099973/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186224878","html_url":"https://github.com/apache/brpc/issues/1835#issuecomment-1186224878","issue_url":"https://api.github.com/repos/apache/brpc/issues/1835","id":1186224878,"node_id":"IC_kwDOBhmkcs5GtFru","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-16T15:54:16Z","updated_at":"2022-07-16T15:54:16Z","author_association":"MEMBER","body":"`done` 不为空情况下是异步调用, 在这个例子中, `CallMethod` 直接就返回了, 导致 `cntl` 释放, 回复时非法访问 `cntl` 导致各种异常.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186224878/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186401815","html_url":"https://github.com/apache/brpc/issues/1835#issuecomment-1186401815","issue_url":"https://api.github.com/repos/apache/brpc/issues/1835","id":1186401815,"node_id":"IC_kwDOBhmkcs5Gtw4X","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-17T05:07:42Z","updated_at":"2022-07-17T05:07:42Z","author_association":"CONTRIBUTOR","body":"@liu-meng-06 可以参考下Client文档的异步访问章节哈，有提到异步调用需要注意response/controller的生命周期。https://github.com/apache/incubator-brpc/blob/master/docs/cn/client.md#%E5%BC%82%E6%AD%A5%E8%AE%BF%E9%97%AE","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186401815/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186601701","html_url":"https://github.com/apache/brpc/pull/1814#issuecomment-1186601701","issue_url":"https://api.github.com/repos/apache/brpc/issues/1814","id":1186601701,"node_id":"IC_kwDOBhmkcs5Guhrl","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-17T20:25:37Z","updated_at":"2022-07-17T20:25:37Z","author_association":"MEMBER","body":"> > @chenBright 这个问题能不能通过在判断ssl_state和_ssl_session基础上解决呢？比如在DoWrite里\r\n> > ```\r\n> > current_ssl_session = _ssl_session\r\n> > if (current_ssl_session == NULL) {\r\n> >    // necessary comment\r\n> >    return -1;\r\n> > }\r\n> > ...\r\n> > butil::IOBuf::cut_multiple_into_SSL_channel(current_ssl_session, ...)\r\n> > ```\r\n> > \r\n> > \r\n> >     \r\n> >       \r\n> >     \r\n> > \r\n> >       \r\n> >     \r\n> > \r\n> >     \r\n> >   \r\n> > 这样保证current_ssl_session不是NULL，不出core，然后写fd的时候发现对端已经关了连接就走正常错误处理的代码了。\r\n> \r\n> @zyearn 这样可以保证不会coredump，这也是正常的边界处理逻辑。当时有考虑通过判断_ssl_session或者fd来解决，但是觉得并没有实际解决问题。现在是HealthCheckTask里的引用不符合预期，导致了Socket内部的状态错误的问题，这样处理的话，会不会不太合适呢？\r\n\r\nSorry看到晚了，加了一条comment，麻烦看下。总体我觉得没有什么问题，在增加代码的地方加点注释解释为什么这么做就好了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186601701/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186602084","html_url":"https://github.com/apache/brpc/pull/1814#issuecomment-1186602084","issue_url":"https://api.github.com/repos/apache/brpc/issues/1814","id":1186602084,"node_id":"IC_kwDOBhmkcs5Guhxk","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-17T20:28:20Z","updated_at":"2022-07-17T20:29:01Z","author_association":"MEMBER","body":"\r\n\r\n\r\n\r\n> > @chenBright 这个问题能不能通过在判断ssl_state和_ssl_session基础上解决呢？比如在DoWrite里\r\n> > ```\r\n> > current_ssl_session = _ssl_session\r\n> > if (current_ssl_session == NULL) {\r\n> >    // necessary comment\r\n> >    return -1;\r\n> > }\r\n> > ...\r\n> > butil::IOBuf::cut_multiple_into_SSL_channel(current_ssl_session, ...)\r\n> > ```\r\n> > \r\n> > \r\n> >     \r\n> >       \r\n> >     \r\n> > \r\n> >       \r\n> >     \r\n> > \r\n> >     \r\n> >   \r\n> > 这样保证current_ssl_session不是NULL，不出core，然后写fd的时候发现对端已经关了连接就走正常错误处理的代码了。\r\n> \r\n> 还有一个问题：#658 这个case中，当HealthCheckTask等到引用计数为2后，Connect之前，另一处rpc DoWrite失败，rpc结束，引用计数减一。此时，该下游节点恢复了，HealthCheckTask成功Connect，并将Socket Revive。此时Socket是正常的，但是没有地方持有对应的SocketId，那么这个Socket是“泄漏”了吧？\r\n\r\n不会，HealthCheckTask持有一个引用，因为只有2个引用，rpc结束减1，HealthCheckTask结束减1，这时候socket就被回收了\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186602084/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186693302","html_url":"https://github.com/apache/brpc/issues/502#issuecomment-1186693302","issue_url":"https://api.github.com/repos/apache/brpc/issues/502","id":1186693302,"node_id":"IC_kwDOBhmkcs5Gu4C2","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-18T02:14:14Z","updated_at":"2022-07-18T02:14:14Z","author_association":"CONTRIBUTOR","body":"> > \r\n> \r\n> 好的，感谢大佬，这个fix为啥不合并到master呢？\r\n\r\n已合入master，可以试试","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186693302/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186693620","html_url":"https://github.com/apache/brpc/issues/708#issuecomment-1186693620","issue_url":"https://api.github.com/repos/apache/brpc/issues/708","id":1186693620,"node_id":"IC_kwDOBhmkcs5Gu4H0","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-18T02:14:56Z","updated_at":"2022-07-18T02:14:56Z","author_association":"CONTRIBUTOR","body":"最新master已修复","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186693620/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186746706","html_url":"https://github.com/apache/brpc/pull/1814#issuecomment-1186746706","issue_url":"https://api.github.com/repos/apache/brpc/issues/1814","id":1186746706,"node_id":"IC_kwDOBhmkcs5GvFFS","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-18T04:17:10Z","updated_at":"2022-07-18T04:17:10Z","author_association":"CONTRIBUTOR","body":"> > > @chenBright 这个问题能不能通过在判断ssl_state和_ssl_session基础上解决呢？比如在DoWrite里\r\n> > > ```\r\n> > > current_ssl_session = _ssl_session\r\n> > > if (current_ssl_session == NULL) {\r\n> > >    // necessary comment\r\n> > >    return -1;\r\n> > > }\r\n> > > ...\r\n> > > butil::IOBuf::cut_multiple_into_SSL_channel(current_ssl_session, ...)\r\n> > > ```\r\n> > > \r\n> > > \r\n> > >     \r\n> > >       \r\n> > >     \r\n> > > \r\n> > >       \r\n> > >     \r\n> > > \r\n> > >     \r\n> > >   \r\n> > > 这样保证current_ssl_session不是NULL，不出core，然后写fd的时候发现对端已经关了连接就走正常错误处理的代码了。\r\n> > \r\n> > \r\n> > @zyearn 这样可以保证不会coredump，这也是正常的边界处理逻辑。当时有考虑通过判断_ssl_session或者fd来解决，但是觉得并没有实际解决问题。现在是HealthCheckTask里的引用不符合预期，导致了Socket内部的状态错误的问题，这样处理的话，会不会不太合适呢？\r\n> \r\n> Sorry看到晚了，加了一条comment，麻烦看下。总体我觉得没有什么问题，在增加代码的地方加点注释解释为什么这么做就好了。\r\n\r\n已修改","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186746706/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186748873","html_url":"https://github.com/apache/brpc/pull/1817#issuecomment-1186748873","issue_url":"https://api.github.com/repos/apache/brpc/issues/1817","id":1186748873,"node_id":"IC_kwDOBhmkcs5GvFnJ","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-18T04:19:50Z","updated_at":"2022-07-18T04:19:59Z","author_association":"CONTRIBUTOR","body":"@zyearn 麻烦看看这个pr。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186748873/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186981651","html_url":"https://github.com/apache/brpc/issues/502#issuecomment-1186981651","issue_url":"https://api.github.com/repos/apache/brpc/issues/502","id":1186981651,"node_id":"IC_kwDOBhmkcs5Gv-cT","user":{"login":"eyun221","id":9376835,"node_id":"MDQ6VXNlcjkzNzY4MzU=","avatar_url":"https://avatars.githubusercontent.com/u/9376835?v=4","gravatar_id":"","url":"https://api.github.com/users/eyun221","html_url":"https://github.com/eyun221","followers_url":"https://api.github.com/users/eyun221/followers","following_url":"https://api.github.com/users/eyun221/following{/other_user}","gists_url":"https://api.github.com/users/eyun221/gists{/gist_id}","starred_url":"https://api.github.com/users/eyun221/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eyun221/subscriptions","organizations_url":"https://api.github.com/users/eyun221/orgs","repos_url":"https://api.github.com/users/eyun221/repos","events_url":"https://api.github.com/users/eyun221/events{/privacy}","received_events_url":"https://api.github.com/users/eyun221/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-18T09:36:40Z","updated_at":"2022-07-18T09:36:40Z","author_association":"NONE","body":"> \r\n\r\n好的，感谢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1186981651/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1187036192","html_url":"https://github.com/apache/brpc/issues/1844#issuecomment-1187036192","issue_url":"https://api.github.com/repos/apache/brpc/issues/1844","id":1187036192,"node_id":"IC_kwDOBhmkcs5GwLwg","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-18T10:35:26Z","updated_at":"2022-07-18T10:35:26Z","author_association":"CONTRIBUTOR","body":"现在就是支持proto3的，你具体遇到什么不兼容问题，可以详细描述下","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1187036192/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1187190694","html_url":"https://github.com/apache/brpc/issues/1816#issuecomment-1187190694","issue_url":"https://api.github.com/repos/apache/brpc/issues/1816","id":1187190694,"node_id":"IC_kwDOBhmkcs5Gwxem","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-18T11:49:35Z","updated_at":"2022-07-18T11:49:35Z","author_association":"MEMBER","body":"Fixed in master.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1187190694/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1188786098","html_url":"https://github.com/apache/brpc/issues/1845#issuecomment-1188786098","issue_url":"https://api.github.com/repos/apache/brpc/issues/1845","id":1188786098,"node_id":"IC_kwDOBhmkcs5G22-y","user":{"login":"cool1456","id":82799271,"node_id":"MDQ6VXNlcjgyNzk5Mjcx","avatar_url":"https://avatars.githubusercontent.com/u/82799271?v=4","gravatar_id":"","url":"https://api.github.com/users/cool1456","html_url":"https://github.com/cool1456","followers_url":"https://api.github.com/users/cool1456/followers","following_url":"https://api.github.com/users/cool1456/following{/other_user}","gists_url":"https://api.github.com/users/cool1456/gists{/gist_id}","starred_url":"https://api.github.com/users/cool1456/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cool1456/subscriptions","organizations_url":"https://api.github.com/users/cool1456/orgs","repos_url":"https://api.github.com/users/cool1456/repos","events_url":"https://api.github.com/users/cool1456/events{/privacy}","received_events_url":"https://api.github.com/users/cool1456/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-19T08:57:07Z","updated_at":"2022-07-19T08:57:07Z","author_association":"NONE","body":"![image](https://user-images.githubusercontent.com/82799271/179710523-f3c3e195-3402-4c4a-8531-11393e9ccdd6.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1188786098/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1188787673","html_url":"https://github.com/apache/brpc/issues/1845#issuecomment-1188787673","issue_url":"https://api.github.com/repos/apache/brpc/issues/1845","id":1188787673,"node_id":"IC_kwDOBhmkcs5G23XZ","user":{"login":"cool1456","id":82799271,"node_id":"MDQ6VXNlcjgyNzk5Mjcx","avatar_url":"https://avatars.githubusercontent.com/u/82799271?v=4","gravatar_id":"","url":"https://api.github.com/users/cool1456","html_url":"https://github.com/cool1456","followers_url":"https://api.github.com/users/cool1456/followers","following_url":"https://api.github.com/users/cool1456/following{/other_user}","gists_url":"https://api.github.com/users/cool1456/gists{/gist_id}","starred_url":"https://api.github.com/users/cool1456/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cool1456/subscriptions","organizations_url":"https://api.github.com/users/cool1456/orgs","repos_url":"https://api.github.com/users/cool1456/repos","events_url":"https://api.github.com/users/cool1456/events{/privacy}","received_events_url":"https://api.github.com/users/cool1456/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-19T08:58:36Z","updated_at":"2022-07-20T07:11:11Z","author_association":"NONE","body":"传输了一个120MB的文件，下载完后就一直占用这部分内存了\r\n![image](https://user-images.githubusercontent.com/82799271/179710738-f94fa734-6daa-404f-84bd-b82dc5df31ed.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1188787673/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1189559676","html_url":"https://github.com/apache/brpc/pull/1814#issuecomment-1189559676","issue_url":"https://api.github.com/repos/apache/brpc/issues/1814","id":1189559676,"node_id":"IC_kwDOBhmkcs5G5z18","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-19T21:17:21Z","updated_at":"2022-07-19T21:17:21Z","author_association":"MEMBER","body":"有一个问题：这个PR为什么会修改selective_channel？在socket_map.cpp中增删前设置in_socket_map是不是就足够了？\r\n\r\nselective_channel里sub_channel中的Naming service会在对端离开的时候通过SocketMapRemove将对端删除，从而间接影响selective_channel了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1189559676/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1189567033","html_url":"https://github.com/apache/brpc/pull/1817#issuecomment-1189567033","issue_url":"https://api.github.com/repos/apache/brpc/issues/1817","id":1189567033,"node_id":"IC_kwDOBhmkcs5G51o5","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-19T21:26:11Z","updated_at":"2022-07-19T21:26:11Z","author_association":"MEMBER","body":"@chenBright 我这两天看一下。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1189567033/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1189573818","html_url":"https://github.com/apache/brpc/pull/1657#issuecomment-1189573818","issue_url":"https://api.github.com/repos/apache/brpc/issues/1657","id":1189573818,"node_id":"IC_kwDOBhmkcs5G53S6","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-19T21:35:15Z","updated_at":"2022-07-19T21:35:15Z","author_association":"MEMBER","body":"@hcoona Hi, Could you upload the newest version if anything has changed since last time?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1189573818/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1189778264","html_url":"https://github.com/apache/brpc/pull/1814#issuecomment-1189778264","issue_url":"https://api.github.com/repos/apache/brpc/issues/1814","id":1189778264,"node_id":"IC_kwDOBhmkcs5G6pNY","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-07-20T03:33:01Z","updated_at":"2022-07-20T04:11:05Z","author_association":"CONTRIBUTOR","body":"> 有一个问题：这个PR为什么会修改selective_channel？在socket_map.cpp中增删前设置in_socket_map是不是就足够了？\r\n> \r\n> selective_channel里sub_channel中的Naming service会在对端离开的时候通过SocketMapRemove将对端删除，从而间接影响selective_channel了。\r\n\r\nSocketMapRemove 删除的是sub_channel中的Naming service的socket吧，而这里的socket是selective_channel里为每个sub_channel创建对应的fake socket，用于lb选路。ChannelBalancer::AddChannel中创建fake socket的时候设置了health_check_interval_s，预期是fake socket被SetFailed了，启动健康检查机制，对fake socket的SocketUser（[在selective_channel中设置为sub_channel](https://github.com/apache/incubator-brpc/blob/master/src/brpc/selective_channel.cpp#L190)）进行[健康检查](https://github.com/apache/incubator-brpc/blob/master/src/brpc/details/health_check.cpp#L202)。\r\n\r\n如果不修改selective_channel，fake socket的_is_in_socket_map为false，那么fake socket的健康检查机制实际上不会执行了。虽然目前只看到ChannelBalancer::AddChannel中AddServer失败的时候才会将该socket SetFailed，随后该socket就会被回收了，健康检查执行与否都没影响，但是还是影响了现有的逻辑，感觉不合理，需要修改。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1189778264/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]