[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180006188","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2180006188","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2180006188,"node_id":"IC_kwDOAAMmUc6B8EEs","user":{"login":"zhangjingcat","id":17232084,"node_id":"MDQ6VXNlcjE3MjMyMDg0","avatar_url":"https://avatars.githubusercontent.com/u/17232084?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangjingcat","html_url":"https://github.com/zhangjingcat","followers_url":"https://api.github.com/users/zhangjingcat/followers","following_url":"https://api.github.com/users/zhangjingcat/following{/other_user}","gists_url":"https://api.github.com/users/zhangjingcat/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangjingcat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangjingcat/subscriptions","organizations_url":"https://api.github.com/users/zhangjingcat/orgs","repos_url":"https://api.github.com/users/zhangjingcat/repos","events_url":"https://api.github.com/users/zhangjingcat/events{/privacy}","received_events_url":"https://api.github.com/users/zhangjingcat/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-20T07:30:24Z","updated_at":"2024-06-20T08:21:53Z","author_association":"NONE","body":"Hi @rnewson ,thanks for your suggestions. Actually we created the DNS pointing to the ip address in a separate place on cloud configuration panel. I tried use the ApacheBench to see the results ,here attached the response(70007). Actually for other database the replication were quite fast and not sure if the setup .ini params affects the efficiency.\r\n\r\nI used local way to set replication job but also failed.\r\n\r\n```\r\nRequest:\r\n\r\n{\r\n\"source\": \"sw360changelogs\",\r\n\"target\": \"penny\",\r\n\"create_target\" : true\r\n}\r\n\r\nResponse:\r\n{\r\n\t\"error\": \"changes_req_failed\",\r\n\t\"reason\": \"{error,req_timedout}\"\r\n}\r\n```\r\n\r\nFor sw360changelogs Test Results\r\n```\r\n(base) i545542@C02FD05EMD6T ~ % ab -n 5000 -A user:pass https://FQDN/sw360changelogs/_changes\r\nThis is ApacheBench, Version 2.3 <$Revision: 1903618 $>\r\nCopyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/\r\nLicensed to The Apache Software Foundation, http://www.apache.org/\r\n\r\nBenchmarking FQDN (be patient)\r\napr_pollset_poll: The timeout specified has expired (70007)\r\n```\r\n\r\nAnd I know the replication might be difficult for big databases and could we declare a small limit under [replicator] label and make it faster for us to get each partition for the whole changes, is it supported by setting this in  [replicator]  for .ini files now? Thank you very much!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180006188/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180270271","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2180270271","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2180270271,"node_id":"IC_kwDOAAMmUc6B9Ei_","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-20T09:48:59Z","updated_at":"2024-06-20T09:48:59Z","author_association":"MEMBER","body":"This does not sound like a replicator problem. Your couchdb is not contactable at all, focus on testing connectivity with curl and apachebench, figure out why that is not working first, and then the replication problem will also be solved.\r\n\r\nThere is no \"local way\" for replication, internally the `\"target\":\"penny\"` is converted to a url anyway, all replication is over http/https, so you should specify source and target as url's yourself for clarity.\r\n\r\ntry `curl https://FQDN/sw360changelogs/_changes` and tell me if that works. try it ten times and tell me if any fail.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180270271/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180603334","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2180603334","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2180603334,"node_id":"IC_kwDOAAMmUc6B-V3G","user":{"login":"zhangjingcat","id":17232084,"node_id":"MDQ6VXNlcjE3MjMyMDg0","avatar_url":"https://avatars.githubusercontent.com/u/17232084?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangjingcat","html_url":"https://github.com/zhangjingcat","followers_url":"https://api.github.com/users/zhangjingcat/followers","following_url":"https://api.github.com/users/zhangjingcat/following{/other_user}","gists_url":"https://api.github.com/users/zhangjingcat/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangjingcat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangjingcat/subscriptions","organizations_url":"https://api.github.com/users/zhangjingcat/orgs","repos_url":"https://api.github.com/users/zhangjingcat/repos","events_url":"https://api.github.com/users/zhangjingcat/events{/privacy}","received_events_url":"https://api.github.com/users/zhangjingcat/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-20T12:55:30Z","updated_at":"2024-06-20T12:56:15Z","author_association":"NONE","body":"Hi @rnewson ,thanks a lot for the hints!\r\nNow I tried the \"curl https://FQDN/sw360changelogs/_changes\" several times and it took about 4minutes to respond as our sw360changelogs database is too huge and have 1818337 docs inside. We may try to increase the connect time out for replicator label in .ini first. It confused me is that when we reduce case to use very simple .ini file like below we do not face the replicator issue for sw360changelogs, but if we change back to use the complex .ini file for db setup then the timeout issue would appear.\r\n\r\n<img width=\"814\" alt=\"Screenshot 2024-06-20 at 20 41 18\" src=\"https://github.com/apache/couchdb/assets/17232084/90163964-46e4-4116-b933-7c0e763e3b2c\">\r\n\r\n<img width=\"1647\" alt=\"Screenshot 2024-06-20 at 20 55 43\" src=\"https://github.com/apache/couchdb/assets/17232084/fd9d350c-a8a0-479f-b103-92e34b3bc612\">\r\n\r\n\r\nThe simple .ini file that works.\r\n\r\n```\r\n[admins]\r\nxxx = xxx\r\n\r\n[couchdb]\r\nuuid = 9cfc779d1c23054f8e515f92042695c0\r\nmax_document_size = 4294967296 ; bytes\r\ndatabase_dir = ./data\r\nview_index_dir = ./data\r\nfile_compression = snappy\r\nos_process_timeout = 7000 ; 7 seconds. for view servers.\r\nmax_dbs_open = 500\r\nattachment_stream_buffer_size = 8192\r\n\r\n[couch_httpd_auth]\r\nsecret = fdccaf1f00c36ea9550a84b423b2e755\r\n\r\n[chttpd]\r\nbind_address = 0.0.0.0\r\nport = 5984\r\nmax_http_request_size = 4294967296 ; 4 GB\r\n\r\n[httpd]\r\nmax_http_request_size = 4294967296 ; 4 GB\r\nserver_options = [{backlog, 1024}, {acceptor_pool_size, 16}, {max, 8192}]\r\n\r\n[cluster]\r\nn = 1\r\n\r\n[replicator]\r\nmax_jobs = 500\r\ninterval = 60000\r\nmax_churn = 20\r\nmax_history = 20\r\nworker_batch_size = 500\r\nworker_processes = 8\r\nhttp_connections = 20\r\nretries_per_request = 5\r\nconnection_timeout = 30000\r\nsocket_options = [{keepalive, true}, {nodelay, false}]\r\ncheckpoint_interval = 5000\r\nuse_checkpoints = true\r\nuse_bulk_get = true\r\nvalid_socket_options = buffer,keepalive,nodelay,priority,recbuf,sndbuf\r\n\r\n[prometheus]\r\nadditional_port = true\r\nbind_address = 0.0.0.0\r\nport = 9985\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180603334/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180637367","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2180637367","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2180637367,"node_id":"IC_kwDOAAMmUc6B-eK3","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-20T13:06:36Z","updated_at":"2024-06-20T13:06:36Z","author_association":"MEMBER","body":"you say 4 minutes to _respond_, is that accurate? I would expect retrieving the entire changes response body will take time, but that is not a problem (the replicator processes it as a stream, no matter how long it is). \r\n\r\nthe req timedout error is about whether the response even starts, not finishes.\r\n\r\nTry curl again and add `?limit=1`, tell me if that is quick and reliable.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180637367/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180846079","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2180846079","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2180846079,"node_id":"IC_kwDOAAMmUc6B_RH_","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-20T14:24:52Z","updated_at":"2024-06-20T14:24:52Z","author_association":"CONTRIBUTOR","body":"I wonder if it's the `buffer_response = true` setting, noticed the simpler ini file didn't have that?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180846079/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180854704","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2180854704","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2180854704,"node_id":"IC_kwDOAAMmUc6B_TOw","user":{"login":"zhangjingcat","id":17232084,"node_id":"MDQ6VXNlcjE3MjMyMDg0","avatar_url":"https://avatars.githubusercontent.com/u/17232084?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangjingcat","html_url":"https://github.com/zhangjingcat","followers_url":"https://api.github.com/users/zhangjingcat/followers","following_url":"https://api.github.com/users/zhangjingcat/following{/other_user}","gists_url":"https://api.github.com/users/zhangjingcat/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangjingcat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangjingcat/subscriptions","organizations_url":"https://api.github.com/users/zhangjingcat/orgs","repos_url":"https://api.github.com/users/zhangjingcat/repos","events_url":"https://api.github.com/users/zhangjingcat/events{/privacy}","received_events_url":"https://api.github.com/users/zhangjingcat/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-20T14:28:56Z","updated_at":"2024-06-20T14:32:20Z","author_association":"NONE","body":"> you say 4 minutes to _respond_, is that accurate? I would expect retrieving the entire changes response body will take time, but that is not a problem (the replicator processes it as a stream, no matter how long it is).\r\n> \r\n> the req timedout error is about whether the response even starts, not finishes.\r\n> \r\n> Try curl again and add `?limit=1`, tell me if that is quick and reliable.\r\n\r\nYes with limit=1 it responds quick. Not sure whether the data length matters.\r\n\r\n<img width=\"968\" alt=\"Screenshot 2024-06-20 at 22 31 21\" src=\"https://github.com/apache/couchdb/assets/17232084/a3a5016c-0e4c-42c1-af89-a9e3e59e4f46\">\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180854704/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180859476","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2180859476","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2180859476,"node_id":"IC_kwDOAAMmUc6B_UZU","user":{"login":"zhangjingcat","id":17232084,"node_id":"MDQ6VXNlcjE3MjMyMDg0","avatar_url":"https://avatars.githubusercontent.com/u/17232084?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangjingcat","html_url":"https://github.com/zhangjingcat","followers_url":"https://api.github.com/users/zhangjingcat/followers","following_url":"https://api.github.com/users/zhangjingcat/following{/other_user}","gists_url":"https://api.github.com/users/zhangjingcat/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangjingcat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangjingcat/subscriptions","organizations_url":"https://api.github.com/users/zhangjingcat/orgs","repos_url":"https://api.github.com/users/zhangjingcat/repos","events_url":"https://api.github.com/users/zhangjingcat/events{/privacy}","received_events_url":"https://api.github.com/users/zhangjingcat/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-20T14:31:04Z","updated_at":"2024-06-20T14:31:04Z","author_association":"NONE","body":"> I wonder if it's the `buffer_response = true` setting, noticed the simpler ini file didn't have that?\r\n\r\nThanks for pointing that, I'll do some compare tests then.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180859476/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180860033","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2180860033","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2180860033,"node_id":"IC_kwDOAAMmUc6B_UiB","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-20T14:31:17Z","updated_at":"2024-06-20T14:31:17Z","author_association":"MEMBER","body":"hm ok, one tip, you really should remove `buffer_response = true` setting. that is not the default and it causes couchdb to attempt to build the entire response in memory before starting the response.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180860033/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180861127","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2180861127","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2180861127,"node_id":"IC_kwDOAAMmUc6B_UzH","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-20T14:31:47Z","updated_at":"2024-06-20T14:31:47Z","author_association":"MEMBER","body":"sidebar: we should exclude _changes response from that setting, or perhaps remove it entirely.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180861127/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180866671","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2180866671","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2180866671,"node_id":"IC_kwDOAAMmUc6B_WJv","user":{"login":"zhangjingcat","id":17232084,"node_id":"MDQ6VXNlcjE3MjMyMDg0","avatar_url":"https://avatars.githubusercontent.com/u/17232084?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangjingcat","html_url":"https://github.com/zhangjingcat","followers_url":"https://api.github.com/users/zhangjingcat/followers","following_url":"https://api.github.com/users/zhangjingcat/following{/other_user}","gists_url":"https://api.github.com/users/zhangjingcat/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangjingcat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangjingcat/subscriptions","organizations_url":"https://api.github.com/users/zhangjingcat/orgs","repos_url":"https://api.github.com/users/zhangjingcat/repos","events_url":"https://api.github.com/users/zhangjingcat/events{/privacy}","received_events_url":"https://api.github.com/users/zhangjingcat/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-20T14:34:20Z","updated_at":"2024-06-20T14:34:20Z","author_association":"NONE","body":"> hm ok, one tip, you really should remove `buffer_response = true` setting. that is not the default and it causes couchdb to attempt to build the entire response in memory before starting the response.\r\n\r\nOk thanks a lot! Let me try the re-setup without the param.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180866671/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180867815","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2180867815","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2180867815,"node_id":"IC_kwDOAAMmUc6B_Wbn","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-20T14:34:52Z","updated_at":"2024-06-20T14:34:52Z","author_association":"MEMBER","body":"sorry I didn't notice it sooner, but thanks to @nickva for spotting it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2180867815/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2181680397","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2181680397","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2181680397,"node_id":"IC_kwDOAAMmUc6CCc0N","user":{"login":"zhangjingcat","id":17232084,"node_id":"MDQ6VXNlcjE3MjMyMDg0","avatar_url":"https://avatars.githubusercontent.com/u/17232084?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangjingcat","html_url":"https://github.com/zhangjingcat","followers_url":"https://api.github.com/users/zhangjingcat/followers","following_url":"https://api.github.com/users/zhangjingcat/following{/other_user}","gists_url":"https://api.github.com/users/zhangjingcat/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangjingcat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangjingcat/subscriptions","organizations_url":"https://api.github.com/users/zhangjingcat/orgs","repos_url":"https://api.github.com/users/zhangjingcat/repos","events_url":"https://api.github.com/users/zhangjingcat/events{/privacy}","received_events_url":"https://api.github.com/users/zhangjingcat/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-20T22:58:35Z","updated_at":"2024-06-20T22:58:35Z","author_association":"NONE","body":"Hi @rnewson and @nickva , yes I commented out the buffer_response=true in .ini and I'm able to sync the huge database now, thank you a lot for your help!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2181680397/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182011111","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2182011111","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2182011111,"node_id":"IC_kwDOAAMmUc6CDtjn","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-21T05:09:45Z","updated_at":"2024-06-21T05:09:45Z","author_association":"CONTRIBUTOR","body":"np at all @zhangjingcat! thanks for stopping by","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182011111/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182145835","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2182145835","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2182145835,"node_id":"IC_kwDOAAMmUc6CEOcr","user":{"login":"pennyZhang2024","id":173421404,"node_id":"U_kgDOClYzXA","avatar_url":"https://avatars.githubusercontent.com/u/173421404?v=4","gravatar_id":"","url":"https://api.github.com/users/pennyZhang2024","html_url":"https://github.com/pennyZhang2024","followers_url":"https://api.github.com/users/pennyZhang2024/followers","following_url":"https://api.github.com/users/pennyZhang2024/following{/other_user}","gists_url":"https://api.github.com/users/pennyZhang2024/gists{/gist_id}","starred_url":"https://api.github.com/users/pennyZhang2024/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pennyZhang2024/subscriptions","organizations_url":"https://api.github.com/users/pennyZhang2024/orgs","repos_url":"https://api.github.com/users/pennyZhang2024/repos","events_url":"https://api.github.com/users/pennyZhang2024/events{/privacy}","received_events_url":"https://api.github.com/users/pennyZhang2024/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-21T07:11:44Z","updated_at":"2024-06-21T10:03:34Z","author_association":"NONE","body":"Hi @rnewson and @nickva,\r\n\r\nWe may have another discovery on the replication. What is the difference for Replicator and _replicate?\r\n\r\nActually we found the \"_replicate\" works very quickly for our dev couchdb while the \"_replicator\" does not seems to start.\r\n\r\nWhat might cause this? Thank you very much!\r\n\r\nAttached the .ini files from one of the 3 nodes:\r\n\r\n```\r\n\r\n[couchdb]\r\nuuid = a709547499a14e1c9f7ac7b98512b334\r\nfile_compression = snappy\r\nos_process_timeout = 7000 ; 7 seconds. for view servers.\r\nmax_dbs_open = 500\r\n\r\n[purge]\r\nmax_document_id_number = 1000  ;by default 100\r\nmax_revisions_number = 1000    ;by default 1000\r\nindex_lag_warn_seconds = 86400 ;by default 86400\r\n\r\n[cluster]\r\nq=8\r\nn=3\r\nseedlist = couchdb@sw360-couchdb01-dev.xxx.xxx.xxx,couchdb@sw360-couchdb02-dev.xxx.xxx.xxx,couchdb@sw360-couchdb03-xxx.xxx.xxx.xxx\r\n\r\n[ioq]\r\nconcurrency = 12\r\nratio = 0.01  ; by default 0.01\r\n\r\n; [ioq.bypass]\r\n; os_process = true\r\n; read = true\r\n; write = true\r\n; view_update = true\r\n\r\n[replicator]\r\nmax_jobs = 500\r\ninterval = 60000\r\nmax_churn = 20\r\nmax_history = 20\r\nworker_batch_size = 500\r\nworker_processes = 8\r\nhttp_connections = 20\r\nretries_per_request = 5\r\nconnection_timeout = 30000\r\nsocket_options = [{keepalive, true}, {nodelay, false}]\r\ncheckpoint_interval = 5000\r\nuse_checkpoints = true\r\nuse_bulk_get = true\r\nvalid_socket_options = buffer,keepalive,nodelay,priority,recbuf,sndbuf\r\n\r\n[chttpd]\r\nbind_address = 0.0.0.0\r\n; buffer_response = false  ; root cause, cannot replica data\r\nmax_http_request_size = 4294967296 ; 4 GB\r\n\r\n[httpd]\r\nserver_options = [{backlog, 1024}, {acceptor_pool_size, 16}, {max, 8192}]\r\n\r\n[chttpd_auth]\r\nsecret = c0bc8fb2\r\ntimeout = 600\r\n\r\n[rexi]\r\nbuffer_count = 2000\r\nserver_per_node = true\r\nuse_kill_all = true\r\nstream_limit = 8 ;refer to: https://docs.couchdb.org/en/stable/config/cluster.html#rexi/stream_limit\r\n\r\n; [prometheus]\r\n; additional_port = true\r\n; bind_address = 0.0.0.0\r\n; port = 9985\r\n\r\n[admins]\r\nxxx = xxx\r\n\r\n```\r\n\r\nThis replication works with \"_replicate\",it does not show the time\r\n\r\n<img width=\"1707\" alt=\"Screenshot 2024-06-21 at 15 09 47\" src=\"https://github.com/apache/couchdb/assets/173421404/2033ba42-8769-425d-a7e0-5fc56c4ba886\">\r\n\r\nThis replication fails with \"replicator\":\r\n<img width=\"1625\" alt=\"Screenshot 2024-06-21 at 15 00 51\" src=\"https://github.com/apache/couchdb/assets/173421404/b84d7331-8690-4f92-a1f8-8ae744307588\">\r\n\r\nThank you very much!\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182145835/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182252392","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2182252392","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2182252392,"node_id":"IC_kwDOAAMmUc6CEodo","user":{"login":"pennyZhang2024","id":173421404,"node_id":"U_kgDOClYzXA","avatar_url":"https://avatars.githubusercontent.com/u/173421404?v=4","gravatar_id":"","url":"https://api.github.com/users/pennyZhang2024","html_url":"https://github.com/pennyZhang2024","followers_url":"https://api.github.com/users/pennyZhang2024/followers","following_url":"https://api.github.com/users/pennyZhang2024/following{/other_user}","gists_url":"https://api.github.com/users/pennyZhang2024/gists{/gist_id}","starred_url":"https://api.github.com/users/pennyZhang2024/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pennyZhang2024/subscriptions","organizations_url":"https://api.github.com/users/pennyZhang2024/orgs","repos_url":"https://api.github.com/users/pennyZhang2024/repos","events_url":"https://api.github.com/users/pennyZhang2024/events{/privacy}","received_events_url":"https://api.github.com/users/pennyZhang2024/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-21T08:20:39Z","updated_at":"2024-06-21T08:59:29Z","author_association":"NONE","body":"And when I tried with the  APIs,\r\n\r\ncurl --request PUT \\\r\n  --url https://xxx:xxx@FQDN/_replicator \\\r\n  --header 'Content-Type: application/json' \r\n  --data '\r\n{\r\n\"_id\":\"penny_test_001\",\r\n\"source\": \"https://xxx:xxx@FQDN/sw360changelogs\",\r\n\"target\": \"https://xxx:xxx@FQDN/tomato\"\r\n}'\r\n\r\nIt seems the response is weird.\r\n\r\n{\r\n\t\"error\": \"file_exists\",\r\n\t\"reason\": \"The database could not be created, the file already exists.\"\r\n}\r\n\r\nWe do not have the tomato database as I never created the tomato database. The _replicator database is empty with no docs in now and should not have dirty data. I didn't delete it for now and not sure whether I can delete it to see if I could re-creaate another empty _replicator database.\r\n\r\n<img width=\"1626\" alt=\"Screenshot 2024-06-21 at 16 19 12\" src=\"https://github.com/apache/couchdb/assets/173421404/51e907fc-d612-4768-b94f-732c919b41a1\">\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182252392/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182498497","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2182498497","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2182498497,"node_id":"IC_kwDOAAMmUc6CFkjB","user":{"login":"pennyZhang2024","id":173421404,"node_id":"U_kgDOClYzXA","avatar_url":"https://avatars.githubusercontent.com/u/173421404?v=4","gravatar_id":"","url":"https://api.github.com/users/pennyZhang2024","html_url":"https://github.com/pennyZhang2024","followers_url":"https://api.github.com/users/pennyZhang2024/followers","following_url":"https://api.github.com/users/pennyZhang2024/following{/other_user}","gists_url":"https://api.github.com/users/pennyZhang2024/gists{/gist_id}","starred_url":"https://api.github.com/users/pennyZhang2024/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pennyZhang2024/subscriptions","organizations_url":"https://api.github.com/users/pennyZhang2024/orgs","repos_url":"https://api.github.com/users/pennyZhang2024/repos","events_url":"https://api.github.com/users/pennyZhang2024/events{/privacy}","received_events_url":"https://api.github.com/users/pennyZhang2024/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-21T10:41:05Z","updated_at":"2024-06-21T10:41:05Z","author_association":"NONE","body":"And it does not only failed on syncing local database to another local database, but also failed for configuring remote replicators, so the issue might be replicators are broken I guess.\r\n\r\nThis also failed.\r\n\r\n<img width=\"1758\" alt=\"Screenshot 2024-06-21 at 18 39 53\" src=\"https://github.com/apache/couchdb/assets/173421404/eaa7a280-47e7-41d4-b79f-e6bb80abe0b6\">\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182498497/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182563732","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2182563732","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2182563732,"node_id":"IC_kwDOAAMmUc6CF0eU","user":{"login":"pennyZhang2024","id":173421404,"node_id":"U_kgDOClYzXA","avatar_url":"https://avatars.githubusercontent.com/u/173421404?v=4","gravatar_id":"","url":"https://api.github.com/users/pennyZhang2024","html_url":"https://github.com/pennyZhang2024","followers_url":"https://api.github.com/users/pennyZhang2024/followers","following_url":"https://api.github.com/users/pennyZhang2024/following{/other_user}","gists_url":"https://api.github.com/users/pennyZhang2024/gists{/gist_id}","starred_url":"https://api.github.com/users/pennyZhang2024/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pennyZhang2024/subscriptions","organizations_url":"https://api.github.com/users/pennyZhang2024/orgs","repos_url":"https://api.github.com/users/pennyZhang2024/repos","events_url":"https://api.github.com/users/pennyZhang2024/events{/privacy}","received_events_url":"https://api.github.com/users/pennyZhang2024/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-21T11:24:41Z","updated_at":"2024-06-21T11:24:41Z","author_association":"NONE","body":"Emmm due to some reason one node from the cluster might be rebooting again and again.\r\n\r\nAnd the membership can see the nodes goes in and out each second.\r\n\r\nThe response changes frequently between the two.\r\n{\r\n\t\"all_nodes\": [\r\n\t\t\"couchdb@sw360-couchdb02-dev.gtlc.only.sap\",\r\n\t\t\"couchdb@sw360-couchdb03-dev.gtlc.only.sap\"\r\n\t],\r\n\t\"cluster_nodes\": [\r\n\t\t\"couchdb@sw360-couchdb01-dev.gtlc.only.sap\",\r\n\t\t\"couchdb@sw360-couchdb02-dev.gtlc.only.sap\",\r\n\t\t\"couchdb@sw360-couchdb03-dev.gtlc.only.sap\"\r\n\t]\r\n}\r\n\r\n{\r\n\t\"all_nodes\": [\r\n\t\t\"couchdb@sw360-couchdb01-dev.gtlc.only.sap\",\r\n\t\t\"couchdb@sw360-couchdb02-dev.gtlc.only.sap\",\r\n\t\t\"couchdb@sw360-couchdb03-dev.gtlc.only.sap\"\r\n\t],\r\n\t\"cluster_nodes\": [\r\n\t\t\"couchdb@sw360-couchdb01-dev.gtlc.only.sap\",\r\n\t\t\"couchdb@sw360-couchdb02-dev.gtlc.only.sap\",\r\n\t\t\"couchdb@sw360-couchdb03-dev.gtlc.only.sap\"\r\n\t]\r\n}\r\n\r\nSomething might be wrong with the node itself now.\r\n\r\nerror logs found:\r\n\r\n```\r\n[error] 2024-06-17T07:29:51.795109Z couchdb@sw360-couchdb01-dev.gtlc.only.sap <0.23400.24> -------- CRASH REPORT Process  (<0.23400.24>) with 0 neighbors exited with reason: killed at gen_server:decode_msg/9(line:481) <= proc_lib:init_p_do_apply/3(line:226); initial_call: {couch_index_updater,init,['Argument__1']}, ancestors: [<0.23385.24>,<0.23384.24>], message_queue_len: 0, links: [], dictionary: [], trap_exit: true, status: running, heap_size: 2586, stack_size: 29, reductions: 2786440\r\n[error] 2024-06-17T07:29:51.795167Z couchdb@sw360-couchdb01-dev.gtlc.only.sap <0.23400.24> -------- CRASH REPORT Process  (<0.23400.24>) with 0 neighbors exited with reason: killed at gen_server:decode_msg/9(line:481) <= proc_lib:init_p_do_apply/3(line:226); initial_call: {couch_index_updater,init,['Argument__1']}, ancestors: [<0.23385.24>,<0.23384.24>], message_queue_len: 0, links: [], dictionary: [], trap_exit: true, status: running, heap_size: 2586, stack_size: 29, reductions: 2786440\r\n[error] 2024-06-17T07:29:51.795200Z couchdb@sw360-couchdb01-dev.gtlc.only.sap <0.23401.24> -------- gen_server <0.23401.24> terminated with reason: killed\r\n  last msg: redacted\r\n     state: {st,<0.23385.24>,couch_mrview_index,undefined}\r\n    extra: []\r\n[error] 2024-06-17T07:29:51.795219Z couchdb@sw360-couchdb01-dev.gtlc.only.sap <0.23401.24> -------- gen_server <0.23401.24> terminated with reason: killed\r\n  last msg: redacted\r\n     state: {st,<0.23385.24>,couch_mrview_index,undefined}\r\n    extra: []\r\n[error] 2024-06-17T07:29:51.795270Z couchdb@sw360-couchdb01-dev.gtlc.only.sap <0.23401.24> -------- CRASH REPORT Process  (<0.23401.24>) with 0 neighbors exited with reason: killed at gen_server:decode_msg/9(line:481) <= proc_lib:init_p_do_apply/3(line:226); initial_call: {couch_index_compactor,init,['Argument__1']}, ancestors: [<0.23385.24>,<0.23384.24>], message_queue_len: 0, links: [], dictionary: [], trap_exit: true, status: running, heap_size: 1598, stack_size: 29, reductions: 48074\r\n[error] 2024-06-17T07:29:51.795312Z couchdb@sw360-couchdb01-dev.gtlc.only.sap <0.23401.24> -------- CRASH REPORT Process  (<0.23401.24>) with 0 neighbors exited with reason: killed at gen_server:decode_msg/9(line:481) <= proc_lib:init_p_do_apply/3(line:226); initial_call: {couch_index_compactor,init,['Argument__1']}, ancestors: [<0.23385.24>,<0.23384.24>], message_queue_len: 0, links: [], dictionary: [], trap_exit: true, status: running, heap_size: 1598, stack_size: 29, reductions: 48074\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182563732/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182601721","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2182601721","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2182601721,"node_id":"IC_kwDOAAMmUc6CF9v5","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-21T11:49:36Z","updated_at":"2024-06-21T11:49:36Z","author_association":"MEMBER","body":"_replicate starts a non-persistent replication process, if it crashes (or completes) then it is over.\r\n\r\ndocuments created inside the _replicator database also create replication processes but (with continuous: true) these jobs are restarted on a crash (or node reboot).\r\n\r\nhttps://docs.couchdb.org/en/stable/replication/intro.html#transient-and-persistent-replication","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182601721/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182602381","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2182602381","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2182602381,"node_id":"IC_kwDOAAMmUc6CF96N","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-21T11:50:04Z","updated_at":"2024-06-21T11:50:04Z","author_association":"MEMBER","body":"As the original issue is resolved I am closing this ticket. If you want a more general chat I suggest joining our Slack instance or the user mailing list.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182602381/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182607329","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2182607329","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2182607329,"node_id":"IC_kwDOAAMmUc6CF_Hh","user":{"login":"pennyZhang2024","id":173421404,"node_id":"U_kgDOClYzXA","avatar_url":"https://avatars.githubusercontent.com/u/173421404?v=4","gravatar_id":"","url":"https://api.github.com/users/pennyZhang2024","html_url":"https://github.com/pennyZhang2024","followers_url":"https://api.github.com/users/pennyZhang2024/followers","following_url":"https://api.github.com/users/pennyZhang2024/following{/other_user}","gists_url":"https://api.github.com/users/pennyZhang2024/gists{/gist_id}","starred_url":"https://api.github.com/users/pennyZhang2024/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pennyZhang2024/subscriptions","organizations_url":"https://api.github.com/users/pennyZhang2024/orgs","repos_url":"https://api.github.com/users/pennyZhang2024/repos","events_url":"https://api.github.com/users/pennyZhang2024/events{/privacy}","received_events_url":"https://api.github.com/users/pennyZhang2024/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-21T11:53:47Z","updated_at":"2024-06-21T11:53:47Z","author_association":"NONE","body":"> _replicate starts a non-persistent replication process, if it crashes (or completes) then it is over.\r\n> \r\n> documents created inside the _replicator database also create replication processes but (with continuous: true) these jobs are restarted on a crash (or node reboot).\r\n> \r\n> https://docs.couchdb.org/en/stable/replication/intro.html#transient-and-persistent-replication\r\n\r\nThanks a lot! If possible could you put me in your user mailing list as currently I'm not able to use Slack now. Thanks.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182607329/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182689712","html_url":"https://github.com/apache/couchdb/issues/5094#issuecomment-2182689712","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5094","id":2182689712,"node_id":"IC_kwDOAAMmUc6CGTOw","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-21T12:47:19Z","updated_at":"2024-06-21T12:47:19Z","author_association":"MEMBER","body":"Hi, the steps to subscribe to our mailing list are on https://couchdb.apache.org","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2182689712/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2183408451","html_url":"https://github.com/apache/couchdb/issues/4916#issuecomment-2183408451","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4916","id":2183408451,"node_id":"IC_kwDOAAMmUc6CJCtD","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-21T20:26:06Z","updated_at":"2024-06-21T20:26:06Z","author_association":"CONTRIBUTOR","body":"I believe it works now, we have the ARM64 FreeBSD worker back in full CI rotation.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2183408451/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2183955712","html_url":"https://github.com/apache/couchdb/issues/4859#issuecomment-2183955712","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4859","id":2183955712,"node_id":"IC_kwDOAAMmUc6CLIUA","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-22T09:13:08Z","updated_at":"2024-06-22T09:13:08Z","author_association":"MEMBER","body":"> is a JRE available for running nouveau? Maybe which env-Vars?\r\n\r\nI would say this must be user-supplied and we shouldn’t worry about it, just document that you need a JRE installed.\r\n\r\n> Include some service start / stop scripts to start it and stop Nouveau.\r\n\r\nFor the first iteration of the macOS binaries, I’m going with: I ship all the bits, if folks add a JRE, I’ll document how to start nouveau manually in a terminal. Once Nouveau is no longer experimental, I’ll hook up a nice service.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2183955712/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2186950721","html_url":"https://github.com/apache/couchdb/pull/5101#issuecomment-2186950721","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5101","id":2186950721,"node_id":"IC_kwDOAAMmUc6CWjhB","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-24T16:20:07Z","updated_at":"2024-06-24T16:20:07Z","author_association":"CONTRIBUTOR","body":"An example of this occurring:\r\n\r\n```\r\ngen_server couch_replicator_scheduler terminated with reason: \r\n  {{shutdown,{error,{http_request_failed,\"GET...,\r\n    {error,{error,{conn_failed,{error,econnrefused}}}}}}},\r\n    {sys,terminate,[<0.749.0>,shutdown,infinity]}}\r\n at \r\n  proc_lib:stop/3(line:1097) <= \r\n  couch_replicator_scheduler_job:stop/1(line:109) <= \r\n  couch_replicator_scheduler:stop_job_int/2(line:655) <= \r\n  couch_replicator_scheduler:maybe_remove_job_int/2(line:612) <=\r\n  couch_replicator_scheduler:handle_call/3(line:258) <=\r\n  gen_server:try_handle_call/4(line:1149) <= \r\n  ...\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2186950721/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2188028262","html_url":"https://github.com/apache/couchdb/issues/5089#issuecomment-2188028262","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5089","id":2188028262,"node_id":"IC_kwDOAAMmUc6Caqlm","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-25T05:46:25Z","updated_at":"2024-06-25T05:46:25Z","author_association":"CONTRIBUTOR","body":"A PR to fix it: https://github.com/apache/couchdb/pull/5103","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2188028262/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2188415435","html_url":"https://github.com/apache/couchdb/pull/5103#issuecomment-2188415435","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5103","id":2188415435,"node_id":"IC_kwDOAAMmUc6CcJHL","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-25T09:26:06Z","updated_at":"2024-06-25T09:26:06Z","author_association":"MEMBER","body":"```\r\ncurl http://foo:bar@localhost:15984/_scheduler/docs/rep2 -i\r\nHTTP/1.1 400 Bad Request\r\nCache-Control: must-revalidate\r\nContent-Length: 36\r\nContent-Type: application/json\r\nDate: Tue, 25 Jun 2024 09:25:15 GMT\r\nServer: CouchDB/3.3.3-03c4a6a (Erlang OTP/25)\r\nX-Couch-Request-ID: 18b134a7b5\r\nX-CouchDB-Body-Time: 0\r\n\r\n{\"error\":\"bad_request\",\"reason\":\"\"}\r\n```\r\n\r\nThis is definitely an improvement over\r\n```\r\n{\"error\":\"unknown_error\",\"reason\":\"function_clause\",\"ref\":1083485994}\r\n```\r\n\r\nbut I think we should fill in a reason. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2188415435/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2189148894","html_url":"https://github.com/apache/couchdb/pull/5103#issuecomment-2189148894","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5103","id":2189148894,"node_id":"IC_kwDOAAMmUc6Ce8Le","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-25T14:40:16Z","updated_at":"2024-06-25T14:40:16Z","author_association":"CONTRIBUTOR","body":"Good point, I'll add a reason to the bad_request.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2189148894/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2189162332","html_url":"https://github.com/apache/couchdb/pull/5103#issuecomment-2189162332","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5103","id":2189162332,"node_id":"IC_kwDOAAMmUc6Ce_dc","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-25T14:45:54Z","updated_at":"2024-06-25T14:45:54Z","author_association":"CONTRIBUTOR","body":"```\r\n% http $DB/_scheduler/docs/w/x/_replicator/y/z\r\nHTTP/1.1 400 Bad Request\r\n\r\n{\r\n    \"error\": \"bad_request\",\r\n    \"reason\": \"Invalid path\"\r\n}\r\n\r\n% http $DB/_scheduler/docs/foo\r\nHTTP/1.1 400 Bad Request\r\n\r\n{\r\n    \"error\": \"bad_request\",\r\n    \"reason\": \"Invalid path\"\r\n}\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2189162332/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2197238117","html_url":"https://github.com/apache/couchdb/pull/5105#issuecomment-2197238117","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5105","id":2197238117,"node_id":"IC_kwDOAAMmUc6C9zFl","user":{"login":"pgj","id":277835,"node_id":"MDQ6VXNlcjI3NzgzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/277835?v=4","gravatar_id":"","url":"https://api.github.com/users/pgj","html_url":"https://github.com/pgj","followers_url":"https://api.github.com/users/pgj/followers","following_url":"https://api.github.com/users/pgj/following{/other_user}","gists_url":"https://api.github.com/users/pgj/gists{/gist_id}","starred_url":"https://api.github.com/users/pgj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgj/subscriptions","organizations_url":"https://api.github.com/users/pgj/orgs","repos_url":"https://api.github.com/users/pgj/repos","events_url":"https://api.github.com/users/pgj/events{/privacy}","received_events_url":"https://api.github.com/users/pgj/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-28T16:04:28Z","updated_at":"2024-06-28T16:04:28Z","author_association":"CONTRIBUTOR","body":"Please consider the following other occurrences as well:\r\n\r\n```console\r\n% fgrep -r \"enable-clouseau\"\r\n./README-DEV.rst:    ./configure --enable-clouseau\r\n./build-aux/Jenkinsfile.full:    result += \" --enable-clouseau\"\r\n./build-aux/Jenkinsfile.pr:./configure --enable-nouveau --enable-clouseau --js-engine=${JS_ENGINE}\r\n./build-aux/Jenkinsfile.pr:          ./configure --spidermonkey-version 78 --enable-nouveau --enable-clouseau\r\n./.devcontainer/devcontainer.json:    \"postCreateCommand\": \"./configure --enable-nouveau --enable-clouseau && make\",\r\n./dev/run:        else \"./configure --enable-clouseau\"\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2197238117/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2197399447","html_url":"https://github.com/apache/couchdb/pull/5105#issuecomment-2197399447","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5105","id":2197399447,"node_id":"IC_kwDOAAMmUc6C-aeX","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-28T17:55:21Z","updated_at":"2024-06-28T17:55:21Z","author_association":"CONTRIBUTOR","body":"@pgj oh good find, maybe the same fgrep command should be run for `—enable-nouveau`?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2197399447/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2197430743","html_url":"https://github.com/apache/couchdb/pull/5105#issuecomment-2197430743","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5105","id":2197430743,"node_id":"IC_kwDOAAMmUc6C-iHX","user":{"login":"pgj","id":277835,"node_id":"MDQ6VXNlcjI3NzgzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/277835?v=4","gravatar_id":"","url":"https://api.github.com/users/pgj","html_url":"https://github.com/pgj","followers_url":"https://api.github.com/users/pgj/followers","following_url":"https://api.github.com/users/pgj/following{/other_user}","gists_url":"https://api.github.com/users/pgj/gists{/gist_id}","starred_url":"https://api.github.com/users/pgj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgj/subscriptions","organizations_url":"https://api.github.com/users/pgj/orgs","repos_url":"https://api.github.com/users/pgj/repos","events_url":"https://api.github.com/users/pgj/events{/privacy}","received_events_url":"https://api.github.com/users/pgj/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-28T18:25:12Z","updated_at":"2024-06-28T18:25:12Z","author_association":"CONTRIBUTOR","body":"> @pgj oh good find, maybe the same fgrep command should be run for `—enable-nouveau`?\r\n\r\nYep, that is a good idea.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2197430743/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2198030967","html_url":"https://github.com/apache/couchdb/pull/5107#issuecomment-2198030967","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5107","id":2198030967,"node_id":"IC_kwDOAAMmUc6DA0p3","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-29T07:44:39Z","updated_at":"2024-06-29T07:44:39Z","author_association":"CONTRIBUTOR","body":"@alxndrsn Thanks for the update. The latest supported version of Spidermonkey is v91.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2198030967/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2198031628","html_url":"https://github.com/apache/couchdb/pull/5107#issuecomment-2198031628","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5107","id":2198031628,"node_id":"IC_kwDOAAMmUc6DA00M","user":{"login":"alxndrsn","id":191496,"node_id":"MDQ6VXNlcjE5MTQ5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/191496?v=4","gravatar_id":"","url":"https://api.github.com/users/alxndrsn","html_url":"https://github.com/alxndrsn","followers_url":"https://api.github.com/users/alxndrsn/followers","following_url":"https://api.github.com/users/alxndrsn/following{/other_user}","gists_url":"https://api.github.com/users/alxndrsn/gists{/gist_id}","starred_url":"https://api.github.com/users/alxndrsn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alxndrsn/subscriptions","organizations_url":"https://api.github.com/users/alxndrsn/orgs","repos_url":"https://api.github.com/users/alxndrsn/repos","events_url":"https://api.github.com/users/alxndrsn/events{/privacy}","received_events_url":"https://api.github.com/users/alxndrsn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-06-29T07:47:39Z","updated_at":"2024-06-29T07:47:52Z","author_association":"CONTRIBUTOR","body":"> @alxndrsn Thanks for the update. The latest supported version of Spidermonkey is v91.\r\n\r\nWould a better change therefore be:\r\n\r\n```\r\nYour distribution may have `libmozjs-68-dev` or `libmozjs-91-dev` instead of 60. All are supported.\r\n```\r\n\r\n?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2198031628/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2200533405","html_url":"https://github.com/apache/couchdb/pull/5108#issuecomment-2200533405","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5108","id":2200533405,"node_id":"IC_kwDOAAMmUc6DKXmd","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-01T16:01:22Z","updated_at":"2024-07-01T16:01:22Z","author_association":"CONTRIBUTOR","body":"Thank you for your contribution, @alxndrsn!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2200533405/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2200691737","html_url":"https://github.com/apache/couchdb/pull/5105#issuecomment-2200691737","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5105","id":2200691737,"node_id":"IC_kwDOAAMmUc6DK-QZ","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-01T17:37:39Z","updated_at":"2024-07-01T17:37:39Z","author_association":"MEMBER","body":"updated, and a `jenkins-with-nouveau` branch pushed as suggested.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2200691737/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2210333086","html_url":"https://github.com/apache/couchdb/issues/5117#issuecomment-2210333086","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5117","id":2210333086,"node_id":"IC_kwDOAAMmUc6DvwGe","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-05T07:18:35Z","updated_at":"2024-07-05T07:18:35Z","author_association":"CONTRIBUTOR","body":"Hey,\r\n\r\nwhat do you mean by „with illegal IDs“ and „ID validity check”? Can you give a concrete example what’s going wrong?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2210333086/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2210358570","html_url":"https://github.com/apache/couchdb/issues/5117#issuecomment-2210358570","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5117","id":2210358570,"node_id":"IC_kwDOAAMmUc6Dv2Uq","user":{"login":"alxndrsn","id":191496,"node_id":"MDQ6VXNlcjE5MTQ5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/191496?v=4","gravatar_id":"","url":"https://api.github.com/users/alxndrsn","html_url":"https://github.com/alxndrsn","followers_url":"https://api.github.com/users/alxndrsn/followers","following_url":"https://api.github.com/users/alxndrsn/following{/other_user}","gists_url":"https://api.github.com/users/alxndrsn/gists{/gist_id}","starred_url":"https://api.github.com/users/alxndrsn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alxndrsn/subscriptions","organizations_url":"https://api.github.com/users/alxndrsn/orgs","repos_url":"https://api.github.com/users/alxndrsn/repos","events_url":"https://api.github.com/users/alxndrsn/events{/privacy}","received_events_url":"https://api.github.com/users/alxndrsn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-05T07:37:26Z","updated_at":"2024-07-05T07:39:13Z","author_association":"CONTRIBUTOR","body":"> Can you give a concrete example what’s going wrong?\r\n\r\n### Setup\r\n\r\n```sh\r\ndocker run --detach --network host --rm -e COUCHDB_USER=admin -e COUCHDB_PASSWORD=password -it --name my-couchdb-$RANDOM apache/couchdb &&\r\nsleep 5 &&\r\ncurl http://admin:password@localhost:5984/main -X PUT && curl http://admin:password@localhost:5984/_users -X PUT\r\n```\r\n\r\n### Create legal doc (PUT)\r\n\r\n```sh\r\n$ curl http://admin:password@localhost:5984/main/some-valid-doc-id -X PUT -H 'content-type: application/json' --data '{\"hi\":true}'\r\n{\"ok\":true,\"id\":\"some-valid-doc-id\",\"rev\":\"1-e7e9148335bb3e3d0f04263e57edef01\"}\r\n```\r\n\r\n### Try to create illegal doc (PUT)\r\n\r\n```sh\r\n$ curl http://admin:password@localhost:5984/main/_bad_path -X PUT -H 'content-type: application/json' --data '{\"hi\":true}'\r\n{\"error\":\"illegal_docid\",\"reason\":\"Only reserved document ids may start with underscore.\"}\r\n```\r\n\r\n### Create illegal doc (COPY)\r\n\r\n```sh\r\n$ curl http://admin:password@localhost:5984/main/some-valid-doc-id -X COPY -H 'Destination: _bad_path'\r\n{\"ok\":true,\"id\":\"_bad_path\",\"rev\":\"1-e7e9148335bb3e3d0f04263e57edef01\"}\r\n```\r\n\r\n### Retrieve illegal doc (GET)\r\n\r\n```\r\n$ curl http://admin:password@localhost:5984/main/_bad_path\r\n{\"_id\":\"_bad_path\",\"_rev\":\"1-e7e9148335bb3e3d0f04263e57edef01\",\"hi\":true}\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2210358570/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2210360423","html_url":"https://github.com/apache/couchdb/issues/5117#issuecomment-2210360423","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5117","id":2210360423,"node_id":"IC_kwDOAAMmUc6Dv2xn","user":{"login":"alxndrsn","id":191496,"node_id":"MDQ6VXNlcjE5MTQ5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/191496?v=4","gravatar_id":"","url":"https://api.github.com/users/alxndrsn","html_url":"https://github.com/alxndrsn","followers_url":"https://api.github.com/users/alxndrsn/followers","following_url":"https://api.github.com/users/alxndrsn/following{/other_user}","gists_url":"https://api.github.com/users/alxndrsn/gists{/gist_id}","starred_url":"https://api.github.com/users/alxndrsn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alxndrsn/subscriptions","organizations_url":"https://api.github.com/users/alxndrsn/orgs","repos_url":"https://api.github.com/users/alxndrsn/repos","events_url":"https://api.github.com/users/alxndrsn/events{/privacy}","received_events_url":"https://api.github.com/users/alxndrsn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-05T07:38:41Z","updated_at":"2024-07-05T07:38:41Z","author_association":"CONTRIBUTOR","body":"This creates some weird situations, e.g.\r\n\r\n```sh\r\n$ curl http://admin:password@localhost:5984/main/some-valid-doc-id -X COPY -H 'Destination: _all_docs'\r\n{\"ok\":true,\"id\":\"_all_docs\",\"rev\":\"1-e7e9148335bb3e3d0f04263e57edef01\"}\r\n```\r\n\r\n```sh\r\n$ curl http://admin:password@localhost:5984/main/_all_docs\r\n{\"total_rows\":3,\"offset\":0,\"rows\":[\r\n{\"id\":\"_all_docs\",\"key\":\"_all_docs\",\"value\":{\"rev\":\"1-e7e9148335bb3e3d0f04263e57edef01\"}},\r\n{\"id\":\"_bad_path\",\"key\":\"_bad_path\",\"value\":{\"rev\":\"1-e7e9148335bb3e3d0f04263e57edef01\"}},\r\n{\"id\":\"some-valid-doc-id\",\"key\":\"some-valid-doc-id\",\"value\":{\"rev\":\"1-e7e9148335bb3e3d0f04263e57edef01\"}}\r\n]}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2210360423/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2210380157","html_url":"https://github.com/apache/couchdb/issues/5117#issuecomment-2210380157","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5117","id":2210380157,"node_id":"IC_kwDOAAMmUc6Dv7l9","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-05T07:52:34Z","updated_at":"2024-07-05T07:52:34Z","author_association":"CONTRIBUTOR","body":"Thx 🙏 for giving an example and that doesn’t look good…","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2210380157/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2211969276","html_url":"https://github.com/apache/couchdb/issues/5077#issuecomment-2211969276","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5077","id":2211969276,"node_id":"IC_kwDOAAMmUc6D1_j8","user":{"login":"goobemaster","id":4701066,"node_id":"MDQ6VXNlcjQ3MDEwNjY=","avatar_url":"https://avatars.githubusercontent.com/u/4701066?v=4","gravatar_id":"","url":"https://api.github.com/users/goobemaster","html_url":"https://github.com/goobemaster","followers_url":"https://api.github.com/users/goobemaster/followers","following_url":"https://api.github.com/users/goobemaster/following{/other_user}","gists_url":"https://api.github.com/users/goobemaster/gists{/gist_id}","starred_url":"https://api.github.com/users/goobemaster/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/goobemaster/subscriptions","organizations_url":"https://api.github.com/users/goobemaster/orgs","repos_url":"https://api.github.com/users/goobemaster/repos","events_url":"https://api.github.com/users/goobemaster/events{/privacy}","received_events_url":"https://api.github.com/users/goobemaster/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-06T21:10:37Z","updated_at":"2024-07-06T21:16:35Z","author_association":"NONE","body":"@aklehm Docs does not explicitly explain that you have to either set this env variable or replace ${VERSION_CODENAME} to a OS version code name, in my case it was \"bookworm\" for Debian.\r\n\r\nTry running \"lsb_release -cs\". If you get a correct code name you could do:\r\n\r\n```shell\r\necho \"deb [signed-by=/usr/share/keyrings/couchdb-archive-keyring.gpg] https://apache.jfrog.io/artifactory/couchdb-deb/ ${lsb_release -cs} main\" | sudo tee /etc/apt/sources.list.d/couchdb.list >/dev/null\r\n``` \r\n\r\nBut if you've run the command already fix the issue by manually editing /etc/apt/sources.list.d/couchdb.list\r\n\r\nHmm. Official page does not list the code name for Ubuntu 24.04 🤷\r\nhttps://wiki.ubuntu.com/DevelopmentCodeNames\r\n\r\nSo, while this is not a bug, the docs could be improved imho.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2211969276/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2212343222","html_url":"https://github.com/apache/couchdb/pull/5106#issuecomment-2212343222","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5106","id":2212343222,"node_id":"IC_kwDOAAMmUc6D3a22","user":{"login":"alxndrsn","id":191496,"node_id":"MDQ6VXNlcjE5MTQ5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/191496?v=4","gravatar_id":"","url":"https://api.github.com/users/alxndrsn","html_url":"https://github.com/alxndrsn","followers_url":"https://api.github.com/users/alxndrsn/followers","following_url":"https://api.github.com/users/alxndrsn/following{/other_user}","gists_url":"https://api.github.com/users/alxndrsn/gists{/gist_id}","starred_url":"https://api.github.com/users/alxndrsn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alxndrsn/subscriptions","organizations_url":"https://api.github.com/users/alxndrsn/orgs","repos_url":"https://api.github.com/users/alxndrsn/repos","events_url":"https://api.github.com/users/alxndrsn/events{/privacy}","received_events_url":"https://api.github.com/users/alxndrsn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-07T06:41:52Z","updated_at":"2024-07-07T06:41:52Z","author_association":"CONTRIBUTOR","body":"I've updated to output a relative path instead of absolute.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2212343222/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2212386965","html_url":"https://github.com/apache/couchdb/pull/5106#issuecomment-2212386965","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5106","id":2212386965,"node_id":"IC_kwDOAAMmUc6D3liV","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-07T09:34:29Z","updated_at":"2024-07-07T09:34:29Z","author_association":"MEMBER","body":"I think it's a useful thing to print, but I don't like adding yet another construction of \"devdir\" + \"logs\". I suggest we tidy this up first, and have a function that calculates the log dir from `ctx`, use that everywhere, and then ensure it is logged somewhere (once).\r\n\r\nSomething like https://github.com/apache/couchdb/compare/run-logs-dir-2?expand=1 for example. \r\n\r\nI quite like the absolute path but relative is also fine, just as long as it works on all platforms (i.e, `./` as in the PR currently is not going to fly on Windows).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2212386965/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2220426780","html_url":"https://github.com/apache/couchdb/issues/5125#issuecomment-2220426780","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5125","id":2220426780,"node_id":"IC_kwDOAAMmUc6EWQYc","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-10T12:47:51Z","updated_at":"2024-07-10T12:47:51Z","author_association":"MEMBER","body":"You can get your desired behaviour by putting each view in a separate design document, the optimisations from putting multiple views in the same design document come at this (considerable) cost, but you don't have to do that.\r\n\r\nWe'll look at adding a warning in the dashboard.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2220426780/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2221771999","html_url":"https://github.com/apache/couchdb/pull/5126#issuecomment-2221771999","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5126","id":2221771999,"node_id":"IC_kwDOAAMmUc6EbYzf","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-11T00:38:03Z","updated_at":"2024-07-11T00:38:03Z","author_association":"CONTRIBUTOR","body":"To test:\r\n\r\n```\r\nmake eunit apps=couch suites=couch_hyper\r\n\r\n======================== EUnit ========================\r\nmodule 'couch_hyper'\r\n  couch_hyper: basics_test...[0.006 s] ok\r\n  couch_hyper: valid_precisions_test...[0.009 s] ok\r\n  couch_hyper: on_disk_format_test...[0.001 s] ok\r\n  couch_hyper: large_cardinaty_test...[0.178 s] ok\r\n  couch_hyper: same_value_repeated_update_optimization_buffer_test...ok\r\n  couch_hyper: buffered_under_threshold_union_test...[0.001 s] ok\r\n  couch_hyper: buffered_over_threshold_union_test...[0.001 s] ok\r\n  couch_hyper: buffered_over_threshold_with_duplicates_union_test...[0.001 s] ok\r\n  couch_hyper: mixed_under_threshold_union_test...[0.001 s] ok\r\n  couch_hyper: mixed_over_the_threshold_union_test...[0.002 s] ok\r\n  couch_hyper: dense_under_threshold_union_test...[0.002 s] ok\r\n  couch_hyper: dense_over_threshold_union_test...[0.003 s] ok\r\n  couch_hyper: merge_test...ok\r\n  couch_hyper: max_registers_test...ok\r\n  couch_hyper: run_of_zeroes_test...ok\r\n  couch_hyper: dense_index_test...ok\r\n  [done in 0.253 s]\r\n=======================================================\r\n  All 16 tests passed.\r\n\r\nCode Coverage:\r\ncouch_hyper : 100%\r\n\r\nTotal       : 100%\r\n```\r\n\r\nIntegration tests are covering the built-in reducers in:\r\n\r\n```\r\nmake elixir tests=test/elixir/test/reduce_builtin_test.exs\r\n\r\nReduceBuiltinTest [test/elixir/test/reduce_builtin_test.exs]\r\n  * test Builtin reduce functions with trailings (1502.3ms) [L#126]\r\n  * test Builtin count and sum reduce for key as array (498.6ms) [L#178]\r\n  * test Builtin reduce functions (123.9ms) [L#39]\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2221771999/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2222092522","html_url":"https://github.com/apache/couchdb/pull/5128#issuecomment-2222092522","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5128","id":2222092522,"node_id":"IC_kwDOAAMmUc6EcnDq","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-11T05:54:37Z","updated_at":"2024-07-11T05:54:37Z","author_association":"CONTRIBUTOR","body":"I see some credo issues:\r\n\r\n```\r\n2024-07-11T05:52:27.908Z] \r\n\r\n[2024-07-11T05:52:27.908Z] ** (CaseClauseError) no case clause matching: {:ok, 210, 1, [], [{:eol, {207, 26, 1}}, {:\")\", {207, 25, nil}}, {:\")\", {207, 24, nil}}, {:\"(\", {207, 23, nil}}, {:paren_identifier, {207, 19, ~c\"argv\"}, :argv}, {:., {207, 18, nil}}, {:alias, {207, 12, ~c\"System\"}, :System}, {:\"(\", {207, 11, nil}}, {:paren_identifier, {207, 7, ~c\"main\"}, :main}, {:., {207, 6, nil}}, {:alias, {207, 1, ~c\"Certs\"}, :Certs}, {:eol, {205, 4, 2}}, {:end, {205, 1, nil}}, {:eol, {204, 6, 1}}, {:end, {204, 3, nil}}, {:eol, {203, 6, 1}}, {:\")\", {203, 5, 1}}, {:eol, {202, 8, 1}}, {:\"]\", {202, 7, 1}}, {:eol, {201, 10, 1}}, {:\"]\", {201, 9, 1}}, {:eol, {200, 12, 1}}, {:\"]\", {200, 11, 1}}, {:eol, {199, 14, 1}}, {:\"]\", {199, 13, 1}}, {:eol, {198, 30, 1}}, {:atom, {198, 23, ~c\"string\"}, :string}, {:kw_identifier, {198, 15, ~c\"parser\"}, :parser}, {:\",\", {197, 29, 1}}, {true, {197, 25, nil}}, {:kw_identifier, {197, 15, ~c\"required\"}, :required}, {:\",\", {196, 37, 1}}, {:bin_string, {196, 27, nil}, [\"TEMPLATE\"]}, {:kw_identifier, {196, 15, ~c\"value_name\"}, :value_name}, {:\",\", {195, 33, 1}}, {:bin_string, {195, 21, nil}, [\"--template\"]}, {:kw_identifier, {195, 15, ~c\"long\"}, :long}, {:eol, {194, 24, 1}}, {:\"[\", {194, 23, nil}}, {:kw_identifier, {194, 13, ~c\"template\"}, :template}, {:\",\", {193, 14, ...}}, {:\"]\", {193, ...}}, {:eol, {...}}, {:atom, ...}, {...}, ...], []}\r\n\r\n[2024-07-11T05:52:27.908Z]     (credo 1.6.7) lib/credo/code.ex:132: Credo.Code.to_tokens/2\r\n\r\n[2024-07-11T05:52:27.908Z]     (credo 1.6.7) lib/credo/code/interpolation_helper.ex:68: Credo.Code.InterpolationHelper.interpolation_positions/2\r\n\r\n[2024-07-11T05:52:27.908Z]     (credo 1.6.7) lib/credo/code/interpolation_helper.ex:9: Credo.Code.InterpolationHelper.replace_interpolations/3\r\n\r\n[2024-07-11T05:52:27.908Z]     (credo 1.6.7) lib/credo/code/sigils.ex:80: Credo.Code.Sigils.replace_with_spaces/4\r\n\r\n[2024-07-11T05:52:27.908Z]     (credo 1.6.7) lib/credo/code.ex:170: Credo.Code.clean_charlists_strings_and_sigils/1\r\n\r\n[2024-07-11T05:52:27.908Z]     (credo 1.6.7) lib/credo/check/config_comment_finder.ex:36: Credo.Check.ConfigCommentFinder.find_config_comments/1\r\n\r\n[2024-07-11T05:52:27.908Z]     (credo 1.6.7) lib/credo/check/config_comment_finder.ex:22: Credo.Check.ConfigCommentFinder.find_and_set_in_source_file/1\r\n\r\n[2024-07-11T05:52:27.908Z]     (elixir 1.17.2) lib/enum.ex:1703: Enum.\"-map/2-lists^map/1-1-\"/2\r\n\r\n[2024-07-11T05:52:27.908Z] make: *** [Makefile:291: elixir-source-checks] Error 1\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2222092522/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2222154123","html_url":"https://github.com/apache/couchdb/pull/5128#issuecomment-2222154123","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5128","id":2222154123,"node_id":"IC_kwDOAAMmUc6Ec2GL","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-11T06:43:15Z","updated_at":"2024-07-11T06:43:15Z","author_association":"CONTRIBUTOR","body":"Fixed credo by updating it. Next hit a crypto issue in rebar:\r\n\r\n```\r\n[2024-07-11T06:32:56.777Z] =ERROR REPORT==== 11-Jul-2024::06:32:56.530392 ===\r\n[2024-07-11T06:32:56.777Z] Unable to load crypto library. Failed with error:\r\n[2024-07-11T06:32:56.777Z] \"load, Library load-call unsuccessful (227).\"\r\n[2024-07-11T06:32:56.777Z] \r\n[2024-07-11T06:32:56.777Z] Uncaught error in rebar_core: {'EXIT',\r\n[2024-07-11T06:32:56.777Z]                                {undef,\r\n[2024-07-11T06:32:56.777Z]                                 [{crypto,start,[],[]},\r\n[2024-07-11T06:32:56.777Z]                                  {rebar,run_aux,2,\r\n[2024-07-11T06:32:56.777Z]                                   [{file,\"src/rebar.erl\"},{line,209}]},\r\n[2024-07-11T06:32:56.777Z]                                  {rebar,main,1,\r\n[2024-07-11T06:32:56.777Z]                                   [{file,\"src/rebar.erl\"},{line,58}]},\r\n[2024-07-11T06:32:56.777Z]                                  {escript,run,2,\r\n[2024-07-11T06:32:56.777Z]                                   [{file,\"escript.erl\"},{line,750}]},\r\n[2024-07-11T06:32:56.777Z]                                  {escript,start,1,\r\n[2024-07-11T06:32:56.777Z]                                   [{file,\"escript.erl\"},{line,277}]},\r\n[2024-07-11T06:32:56.777Z]                                  {init,start_em,1,[]},\r\n[2024-07-11T06:32:56.777Z]                                  {init,do_boot,3,[]}]}}\r\n[2024-07-11T06:32:56.777Z] make: *** [Makefile:124: couch] Error 1\r\n[2024-07-11T06:32:56.777Z] + make build-report\r\n[2024-07-11T06:32:56.777Z] build-aux/show-test-results.py --suites=10 --tests=10 > test-results.log || true\r\n[2024-07-11T06:32:56.777Z] cat ./dev/logs/node1.log || true\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2222154123/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2222183233","html_url":"https://github.com/apache/couchdb/pull/5128#issuecomment-2222183233","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5128","id":2222183233,"node_id":"IC_kwDOAAMmUc6Ec9NB","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-11T07:00:37Z","updated_at":"2024-07-11T07:00:37Z","author_association":"CONTRIBUTOR","body":"Let's see if this fixes it: https://github.com/apache/couchdb-rebar/pull/11","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2222183233/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2223200882","html_url":"https://github.com/apache/couchdb/issues/5129#issuecomment-2223200882","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5129","id":2223200882,"node_id":"IC_kwDOAAMmUc6Eg1py","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-11T15:12:00Z","updated_at":"2024-07-11T15:12:00Z","author_association":"MEMBER","body":"hi, this looks like data corruption to me. The binary in question is a `kp_node` but it is somehow truncated or otherwise invalid.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2223200882/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2223632634","html_url":"https://github.com/apache/couchdb/pull/5128#issuecomment-2223632634","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5128","id":2223632634,"node_id":"IC_kwDOAAMmUc6EifD6","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-11T18:33:38Z","updated_at":"2024-07-11T18:33:38Z","author_association":"CONTRIBUTOR","body":"Oof. It looks like bookworm with the 3.0 openssl + erlang 26 is broken.\r\n\r\n```\r\n[2024-07-11T17:15:19.073Z]     b64url_tests: encode_iolist_test...*failed*\r\n[2024-07-11T17:15:19.073Z] in function crypto:strong_rand_bytes/1\r\n[2024-07-11T17:15:19.073Z]   called as strong_rand_bytes(4177)\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2223632634/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2223996205","html_url":"https://github.com/apache/couchdb/issues/5129#issuecomment-2223996205","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5129","id":2223996205,"node_id":"IC_kwDOAAMmUc6Ej30t","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-11T21:46:05Z","updated_at":"2024-07-11T21:46:05Z","author_association":"CONTRIBUTOR","body":"Agree with @rnewson. \r\n\r\n```\r\n<<131,0,104,2,100,0,7,107,112,95...\r\n```\r\n\r\nThe first byte `131` looked like a proper initial marker of an uncompressed term.\r\n\r\nIt's not followed by 80, so it's not compressed https://github.com/apache/couchdb/blob/c93940a66e85d5d9600d17cb38e44f62fd91585b/src/couch/src/couch_compress.erl#L22-L26\r\n\r\n`0` following `131` seems odd on first look at https://www.erlang.org/doc/apps/erts/erl_ext_dist.html#introduction. The next `104,2` looks like a proper small tuple \r\n\r\n<img width=\"675\" alt=\"Screenshot 2024-07-11 at 5 42 53 PM\" src=\"https://github.com/user-attachments/assets/4a1f3f45-31d3-4834-90e4-e35eab5809c5\">\r\n\r\nWhich is probably what we might expect in a kp node.\r\n\r\nBut turning a tuple into a binary doesn't show a 0 after 131\r\n\r\n```\r\n> erlang:term_to_binary({a, b}).\r\n<<131,104,2,100,0,1,97,100,0,1,98>>\r\n```\r\n\r\n@job-isabai \r\n\r\nWhat version of CouchDB, Erlang, OS, architecture you're running? Wonder if you backed up, or restored the data at any point. Of if there is any way to reproduce the issue?\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2223996205/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2224911605","html_url":"https://github.com/apache/couchdb/issues/5129#issuecomment-2224911605","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5129","id":2224911605,"node_id":"IC_kwDOAAMmUc6EnXT1","user":{"login":"job-isabai","id":100341653,"node_id":"U_kgDOBfsXlQ","avatar_url":"https://avatars.githubusercontent.com/u/100341653?v=4","gravatar_id":"","url":"https://api.github.com/users/job-isabai","html_url":"https://github.com/job-isabai","followers_url":"https://api.github.com/users/job-isabai/followers","following_url":"https://api.github.com/users/job-isabai/following{/other_user}","gists_url":"https://api.github.com/users/job-isabai/gists{/gist_id}","starred_url":"https://api.github.com/users/job-isabai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/job-isabai/subscriptions","organizations_url":"https://api.github.com/users/job-isabai/orgs","repos_url":"https://api.github.com/users/job-isabai/repos","events_url":"https://api.github.com/users/job-isabai/events{/privacy}","received_events_url":"https://api.github.com/users/job-isabai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-12T06:40:42Z","updated_at":"2024-07-12T06:40:42Z","author_association":"NONE","body":"Hello,\r\nThanks for the feedback.\r\nI am using CouchDB via [Community Health Toolkit (CHT)](https://docs.communityhealthtoolkit.org/core/overview/architecture/).\r\nDocker image can be found here: https://staging.dev.medicmobile.org/_couch/builds_4/medic:medic:4.5.0/docker-compose/cht-couchdb.yml but I can't tell the version. \r\nThis error emerged from a system upgrade which required all views to be indexed before migration to the new version. This takes place automatically in the backend but there was crash a couple of times during migration that resulted me to revert to a backed up version (Whole Image & Files of the VM). \r\nAfterwards, the upgrade was successful, all views were indexed and the system started running on a new version. After a couple of hours this error started popping up, which resulted to CouchDB container restarting unexpectedly. My database size is more than 2GB and growing. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2224911605/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2224999752","html_url":"https://github.com/apache/couchdb/issues/5129#issuecomment-2224999752","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5129","id":2224999752,"node_id":"IC_kwDOAAMmUc6Ens1I","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-12T07:34:18Z","updated_at":"2024-07-12T07:34:18Z","author_association":"MEMBER","body":"That image contains CouchDB 3.3.2.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2224999752/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2225011749","html_url":"https://github.com/apache/couchdb/issues/5129#issuecomment-2225011749","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5129","id":2225011749,"node_id":"IC_kwDOAAMmUc6Envwl","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-12T07:42:34Z","updated_at":"2024-07-12T07:42:34Z","author_association":"MEMBER","body":"so I think this is data corruption somehow, you'll need to try earlier backups until something works but we're very curious as to how this might have happened. If you have the details of the storage subsystem (filesystem, disks, any virtualisation between couchdb and the storage device, and any relevant settings on reordering or fsyncing) we'd love to hear them.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2225011749/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2225019422","html_url":"https://github.com/apache/couchdb/issues/5129#issuecomment-2225019422","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5129","id":2225019422,"node_id":"IC_kwDOAAMmUc6Enxoe","user":{"login":"job-isabai","id":100341653,"node_id":"U_kgDOBfsXlQ","avatar_url":"https://avatars.githubusercontent.com/u/100341653?v=4","gravatar_id":"","url":"https://api.github.com/users/job-isabai","html_url":"https://github.com/job-isabai","followers_url":"https://api.github.com/users/job-isabai/followers","following_url":"https://api.github.com/users/job-isabai/following{/other_user}","gists_url":"https://api.github.com/users/job-isabai/gists{/gist_id}","starred_url":"https://api.github.com/users/job-isabai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/job-isabai/subscriptions","organizations_url":"https://api.github.com/users/job-isabai/orgs","repos_url":"https://api.github.com/users/job-isabai/repos","events_url":"https://api.github.com/users/job-isabai/events{/privacy}","received_events_url":"https://api.github.com/users/job-isabai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-12T07:47:46Z","updated_at":"2024-07-12T07:47:46Z","author_association":"NONE","body":"Actually reverting back to earlier backups might not be an option for me since it has been a month and I might loose the current state of the database. Is there a means of repairing the corrupted data? Can I adjust the configuration to make CouchDB container error tolerant to prevent failure/restart?\r\nRunning on Ubuntu VM, docker system where everything is stored on the local disk.  ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2225019422/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2225186959","html_url":"https://github.com/apache/couchdb/issues/5129#issuecomment-2225186959","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5129","id":2225186959,"node_id":"IC_kwDOAAMmUc6EoaiP","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-12T09:28:41Z","updated_at":"2024-07-12T09:28:41Z","author_association":"MEMBER","body":"CouchDB is built as a \"crash only\" system, meaning that the couchdb process is always ready to be killed, there's no shutdown code, no need to call `sync` manually, etc. When a document is written, and the 200 OK returned, CouchDB has already done everything it can to persist the data to disk (including `fsync()` calls). At startup CouchDB will read from the end of each file looking for the latest valid header.\r\n\r\nWithout knowing how the files were corrupted it is hard to know what to recommend and, unfortunately, there are no tools we publish to repair a corrupted `.couch` file. At best we might be able to build an erlang script that would attempt to extract the document bodies inside the .couch files, though that would be shorn of a number of details (the doc id being the most significant as it is stored in a different location to the body, the corrupted btree index would be able to find it).\r\n\r\nHave you perhaps replicated this database elsewhere recently? that could be another source of backup.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2225186959/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2227149165","html_url":"https://github.com/apache/couchdb/issues/5130#issuecomment-2227149165","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5130","id":2227149165,"node_id":"IC_kwDOAAMmUc6Ev5lt","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-14T00:28:50Z","updated_at":"2024-07-14T21:09:44Z","author_association":"CONTRIBUTOR","body":"There are actually two issues here:\r\n   * We end up with `nonode@nohost`, `node()` response when we have a `-name ...` argument. The assumption in our code base is that can't happen.\r\n   * We recorded an epoch that re-wound the update sequence backward  18423167 to 830216 . That is what triggered the error in the logs. We detect this condition when we read the sequence.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2227149165/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2228607397","html_url":"https://github.com/apache/couchdb/issues/5130#issuecomment-2228607397","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5130","id":2228607397,"node_id":"IC_kwDOAAMmUc6E1dml","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-15T14:13:27Z","updated_at":"2024-07-15T14:13:27Z","author_association":"MEMBER","body":"```Returns the name of the local node. If the node is not alive, nonode@nohost is returned instead.```\r\n\r\nWe can ping the folks over there for details but the docs for `node()` don't inspire confidence.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2228607397/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2230120345","html_url":"https://github.com/apache/couchdb/pull/5132#issuecomment-2230120345","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5132","id":2230120345,"node_id":"IC_kwDOAAMmUc6E7O-Z","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-16T06:28:29Z","updated_at":"2024-07-16T06:28:29Z","author_association":"CONTRIBUTOR","body":"I made companion PR that implements a `node_name()` function based on a persistent term: https://github.com/apache/couchdb/pull/5133. \r\n\r\nThe improvement I was going for is to avoid altogether parsing and interpreting the -name/-sname args (and sidestep issues like sname host lookups, etc), and instead using the value of `node()` after the system is started and validated. The other improvement is to avoiding init becoming a potential bottleneck.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2230120345/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231346379","html_url":"https://github.com/apache/couchdb/pull/5106#issuecomment-2231346379","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5106","id":2231346379,"node_id":"IC_kwDOAAMmUc6E_6TL","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-16T16:24:59Z","updated_at":"2024-07-16T16:24:59Z","author_association":"CONTRIBUTOR","body":"Short summary:\r\n\r\nHow do we want to bring these two solutions together?\r\n\r\n1. This PR: \r\nPrint relative directory and manual joining of the path parts.\r\n\r\n2. Bob's idea: \r\nGeneric function for getting the log dir and print it as absolute path.\r\n\r\nI tried Bob's idea on Windows an macOS:\r\n```\r\nWindows:\r\n[ * ] Setup log dir: C:\\Users\\couchdb\\Documents\\couchdb-otp25\\dev\\logs ... ok\r\n[ * ] Ensure CouchDB is built ... ok\r\n[ * ] Ensure Erlang boot script exists ... ok\r\n\r\nmacOS:\r\n[ * ] Setup log dir: /Users/big-r/Documents/Developer/CouchDB/couchdb/dev/logs ... ok\r\n[ * ] Ensure CouchDB is built ... ok\r\n[ * ] Ensure Erlang boot script exists ... ok\r\n```\r\n\r\nAfter a few days have passed, I like Bob's (@rnewson) generic dev dir function a little bit more. It's cleaner, but with abs paths. What do you think Nick (@nickva)?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231346379/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231355206","html_url":"https://github.com/apache/couchdb/pull/5106#issuecomment-2231355206","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5106","id":2231355206,"node_id":"IC_kwDOAAMmUc6E_8dG","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-16T16:30:05Z","updated_at":"2024-07-16T16:30:05Z","author_association":"CONTRIBUTOR","body":"@big-r81 Let's go with Bob's idea then, the preference for relative paths was a minor preference.  Can always redact it away when pasting anywhere public.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231355206/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231381605","html_url":"https://github.com/apache/couchdb/pull/5106#issuecomment-2231381605","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5106","id":2231381605,"node_id":"IC_kwDOAAMmUc6FAC5l","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-16T16:45:31Z","updated_at":"2024-07-16T16:45:31Z","author_association":"MEMBER","body":"https://github.com/apache/couchdb/pull/5136 then?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231381605/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231472387","html_url":"https://github.com/apache/couchdb/issues/5127#issuecomment-2231472387","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5127","id":2231472387,"node_id":"IC_kwDOAAMmUc6FAZED","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-16T17:41:11Z","updated_at":"2024-07-16T17:41:11Z","author_association":"CONTRIBUTOR","body":"Looks like `dreyfus_rpc` does the right thing and cleanup the `Workers` in the outer after clause https://github.com/apache/couchdb/blob/main/src/dreyfus/src/dreyfus_fabric_search.erl#L147 and it looks like that's the full list of workers too, not just the winning shard range workers. I suggest, at a minimum, we follow the same pattern from `dreyfus_rpc` and do cleanup on the full set of workers in the after clause.\r\n\r\nI say \"at a minimum\" because I think we should consider moving the cleanup to the dedicated `rexi_mon` process such that if the coordinator process dies it'll still have the workers cleaned up. This is definitely a secondary concern compared to the main source of stranded workers in this ticket, but still worth considering.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231472387/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231526777","html_url":"https://github.com/apache/couchdb/pull/5106#issuecomment-2231526777","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5106","id":2231526777,"node_id":"IC_kwDOAAMmUc6FAmV5","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-16T18:16:01Z","updated_at":"2024-07-16T18:16:01Z","author_association":"CONTRIBUTOR","body":"> #5136 then?\r\n\r\nYes 👍.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231526777/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231528829","html_url":"https://github.com/apache/couchdb/pull/5136#issuecomment-2231528829","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5136","id":2231528829,"node_id":"IC_kwDOAAMmUc6FAm19","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-16T18:17:17Z","updated_at":"2024-07-16T18:17:17Z","author_association":"CONTRIBUTOR","body":"Needs an additional `python-black-update`…","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231528829/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231720591","html_url":"https://github.com/apache/couchdb/issues/5127#issuecomment-2231720591","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5127","id":2231720591,"node_id":"IC_kwDOAAMmUc6FBVqP","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-16T19:54:01Z","updated_at":"2024-07-16T21:18:49Z","author_association":"CONTRIBUTOR","body":"Good finds @chewbranca! Clearly there is something broken here and we should fix it. Thanks for the detailed analysis!\r\n\r\n> we should consider moving the cleanup to the dedicated rexi_mon process\r\n\r\nFor streams we already have a cleanup process spawned for every streaming request https://github.com/apache/couchdb/blob/main/src/fabric/src/fabric_streams.erl#L47. We should see why that doesn't clean up the workers and lets them timeout instead.\r\n\r\nPerhaps it's too cautious to avoid sending unnecessary kill messages? It tries to use the `rexi_STREAM_CANCEL` which makes the worker exit `normal`, instead of killing it to avoid generating sasl generate sasl logs. But perhaps that won't happen as those workers are not gen_servers?\r\n\r\nRecently we also added a kill_all command to aggregate kill commands per node, so instead of sending one per shard, it's one per node with a list of refs, maybe that's enough to keep the overhead of the extra kills fairly low.\r\n\r\nAnother thing to keep it mind is that we don't always want to kill the workers, at least in the update docs path we specifically allow them to finish updating to reduce the pressure on the internal replicator.\r\n\r\n> Looks like dreyfus_rpc does the right thing and cleanup the Workers in the outer after clause\r\n\r\nDreyfus doesn't use the streams facility, so likely has a slightly different way to doing cleanup. There is also the complication of replacements if they are spawned, those have to be cleaned up as well. However if we do a blanket `kill_all` for all the workers then it should take care of that, too. But, it would nice to see what corner cases we're missing currently. Which errors are generated and if it's triggered by some error or just a race condition...\r\n\r\nDo you have a easily reproducible scenario to test it out? Start a 3 node cluster and issue a bunch of _all_docs calls?\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231720591/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231921645","html_url":"https://github.com/apache/couchdb/pull/5106#issuecomment-2231921645","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5106","id":2231921645,"node_id":"IC_kwDOAAMmUc6FCGvt","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-16T22:25:06Z","updated_at":"2024-07-16T22:25:06Z","author_association":"CONTRIBUTOR","body":"@alxndrsn \r\nThanks for your initial idea and contribution to make CouchDB better. 🙏\r\n\r\nI’m closing this in favor of #5136.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231921645/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231929391","html_url":"https://github.com/apache/couchdb/pull/5133#issuecomment-2231929391","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5133","id":2231929391,"node_id":"IC_kwDOAAMmUc6FCIov","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-16T22:33:23Z","updated_at":"2024-07-16T22:33:23Z","author_association":"CONTRIBUTOR","body":"This was folded into https://github.com/apache/couchdb/pull/5132, closing","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231929391/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231958086","html_url":"https://github.com/apache/couchdb/pull/5132#issuecomment-2231958086","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5132","id":2231958086,"node_id":"IC_kwDOAAMmUc6FCPpG","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-16T23:04:32Z","updated_at":"2024-07-16T23:04:32Z","author_association":"CONTRIBUTOR","body":"Based on discussion in the couchdb dev slack, agree that the shard map creation should probably also use the persistent node name.\r\n\r\nI tried to gather a bunch more instances. Not all are persistent, some are for active connection so can probably be ignored. The replicator job ownership ones are in between? Some are related to API responses \"which node this replication job is running on\". Probably not the end of the world if they return `nonode@nohost`.\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3.erl#L134\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3.erl#L147\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3.erl#L366\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3.erl#L369\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/rexi/src/rexi_utils.erl#L28\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3_sync.erl#L79\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3_sync.erl#L271-L275\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3_sync.erl#L305-L309\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/couch_log/src/couch_log_writer_stderr.erl#L42\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/couch_log/src/couch_log_writer_journald.erl#L40\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/dreyfus/src/dreyfus_rpc.erl#L130\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3_reshard_dbdoc.erl#L110-L112\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3_nodes.erl#L103\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3_distribution.erl#L85\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3_rpc.erl#L58\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3_rpc.erl#L119\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3_rep.erl#L64\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3_rep.erl#L222\r\n\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3_shards.erl#L164\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/mem3/src/mem3_shards.erl#L406\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/nouveau/src/nouveau_util.erl#L41\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/chttpd/src/chttpd_node.erl#L39-L41\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/chttpd/src/chttpd_misc.erl#L289\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/dreyfus/src/dreyfus_index.erl#L85\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/couch_replicator/src/couch_replicator_utils.erl#L51\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/couch_replicator/src/couch_replicator_scheduler_job.erl#L89\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/fabric/src/fabric_util.erl#L123\r\n\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/couch_replicator/src/couch_replicator_doc_processor.erl#L127\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/couch_replicator/src/couch_replicator_doc_processor.erl#L144\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/couch_replicator/src/couch_replicator_doc_processor.erl#L596\r\n\r\nhttps://github.com/apache/couchdb/blob/f6698ecc68420d7d8307128742b7c637d3ab32ac/src/couch_replicator/src/couch_replicator_doc_processor.erl#L619\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2231958086/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2236750934","html_url":"https://github.com/apache/couchdb/issues/5140#issuecomment-2236750934","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5140","id":2236750934,"node_id":"IC_kwDOAAMmUc6FUhxW","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-18T14:39:16Z","updated_at":"2024-07-18T18:36:30Z","author_association":"CONTRIBUTOR","body":"Just a first guess, can you try with fips mode disabled in vm.args?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2236750934/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2236785028","html_url":"https://github.com/apache/couchdb/issues/5139#issuecomment-2236785028","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5139","id":2236785028,"node_id":"IC_kwDOAAMmUc6FUqGE","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-18T14:53:57Z","updated_at":"2024-07-18T16:07:20Z","author_association":"CONTRIBUTOR","body":"The query server is protocol is pretty stable. The most recent additions to it over the years are the `index_doc` for clouseau search integration and `nouveau_index_doc` (on main only). If you only plan on using a subset of functionality, could try implementing just some of the commands.\r\n\r\nSome years ago I had actually used the Python query server from https://github.com/djc/couchdb-python/blob/master/couchdb/view.py in production. It worked decently well with CouchDB 1.x series. Some docs about it: https://couchdb-python.readthedocs.io/en/latest/views.html. The project unfortunately is no longer maintained. But that could provide a starting point, perhaps.\r\n\r\nTo get an idea of how the query server gets called search for `proc_prompt` in the source code: https://github.com/search?q=repo%3Aapache%2Fcouchdb%20proc_prompt&type=code","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2236785028/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237029781","html_url":"https://github.com/apache/couchdb/issues/5130#issuecomment-2237029781","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5130","id":2237029781,"node_id":"IC_kwDOAAMmUc6FVl2V","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-18T16:26:58Z","updated_at":"2024-07-18T16:26:58Z","author_association":"CONTRIBUTOR","body":"We were able to model the `nonode@nohost` result from `nodes()` state by noticing that it happen when the `net_kernel` dist controller process is killed.  The VM will exit, but in the process of shutting down for a period of time `node()` returns `nonode@nohost`. The sequence rewind still remains a mystery, though.\r\n\r\nSo far we've put in couple of fixes related to this:\r\n  * https://github.com/apache/couchdb/pull/5132 introduces a permanent node name that saves the initial `node()` in a persistent term and does value validations right after in `config`, then asserts during epoch updates that the sequence rewinds.\r\n  * https://github.com/apache/couchdb/pull/5138 uses the persistent node name in a few more cases when there is a likelihood of the `nonode@nohost` affecting persistent data (checkpoints, shard maps, logs)\r\n  \r\nClosing the issue for now. We'll monitor to see if we notice any assertion triggers on sequence rewinds and re-open it then to continue working on it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237029781/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237036693","html_url":"https://github.com/apache/couchdb/issues/5140#issuecomment-2237036693","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5140","id":2237036693,"node_id":"IC_kwDOAAMmUc6FVniV","user":{"login":"IBMRob","id":2182970,"node_id":"MDQ6VXNlcjIxODI5NzA=","avatar_url":"https://avatars.githubusercontent.com/u/2182970?v=4","gravatar_id":"","url":"https://api.github.com/users/IBMRob","html_url":"https://github.com/IBMRob","followers_url":"https://api.github.com/users/IBMRob/followers","following_url":"https://api.github.com/users/IBMRob/following{/other_user}","gists_url":"https://api.github.com/users/IBMRob/gists{/gist_id}","starred_url":"https://api.github.com/users/IBMRob/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IBMRob/subscriptions","organizations_url":"https://api.github.com/users/IBMRob/orgs","repos_url":"https://api.github.com/users/IBMRob/repos","events_url":"https://api.github.com/users/IBMRob/events{/privacy}","received_events_url":"https://api.github.com/users/IBMRob/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-18T16:31:01Z","updated_at":"2024-07-18T16:31:01Z","author_association":"NONE","body":"Looks like if fips is disabled then it does start up so the problem is associated with fips being enabled ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237036693/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237210831","html_url":"https://github.com/apache/couchdb/issues/5140#issuecomment-2237210831","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5140","id":2237210831,"node_id":"IC_kwDOAAMmUc6FWSDP","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-18T18:18:59Z","updated_at":"2024-07-18T18:18:59Z","author_association":"CONTRIBUTOR","body":"I think it would be good to report this directly to the [Erlang/OTP Team](https://github.com/erlang/otp) to debug this further regarding fips mode.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237210831/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237233130","html_url":"https://github.com/apache/couchdb/issues/5140#issuecomment-2237233130","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5140","id":2237233130,"node_id":"IC_kwDOAAMmUc6FWXfq","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-18T18:26:37Z","updated_at":"2024-07-18T18:26:37Z","author_association":"CONTRIBUTOR","body":"There may be a related issue in OTP https://github.com/erlang/otp/issues/8562","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237233130/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237240656","html_url":"https://github.com/apache/couchdb/issues/5140#issuecomment-2237240656","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5140","id":2237240656,"node_id":"IC_kwDOAAMmUc6FWZVQ","user":{"login":"IBMRob","id":2182970,"node_id":"MDQ6VXNlcjIxODI5NzA=","avatar_url":"https://avatars.githubusercontent.com/u/2182970?v=4","gravatar_id":"","url":"https://api.github.com/users/IBMRob","html_url":"https://github.com/IBMRob","followers_url":"https://api.github.com/users/IBMRob/followers","following_url":"https://api.github.com/users/IBMRob/following{/other_user}","gists_url":"https://api.github.com/users/IBMRob/gists{/gist_id}","starred_url":"https://api.github.com/users/IBMRob/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/IBMRob/subscriptions","organizations_url":"https://api.github.com/users/IBMRob/orgs","repos_url":"https://api.github.com/users/IBMRob/repos","events_url":"https://api.github.com/users/IBMRob/events{/privacy}","received_events_url":"https://api.github.com/users/IBMRob/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-18T18:31:25Z","updated_at":"2024-07-18T18:31:25Z","author_association":"NONE","body":"> There may be a related issue in OTP [erlang/otp#8562](https://github.com/erlang/otp/issues/8562)\r\n\r\nThat does look very similar","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237240656/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237674646","html_url":"https://github.com/apache/couchdb/pull/5143#issuecomment-2237674646","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5143","id":2237674646,"node_id":"IC_kwDOAAMmUc6FYDSW","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-18T21:44:33Z","updated_at":"2024-07-18T22:13:08Z","author_association":"CONTRIBUTOR","body":"This cleanup was prompted by investigating https://github.com/apache/couchdb/issues/5122 were we noticed that we have whole functions in rexi which are not used. When diving to debug an issue having dead code adds significant overhead needing to weed through and understand logic which is never actually run.\r\n\r\nTo automate the lookups and get an initial report used the excellent [xref](https://www.erlang.org/doc/apps/tools/xref_chapter.html) that comes with Erlang/OTP with this script https://gist.github.com/nickva/0de5c227249b66650a90a24d0a422273","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237674646/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237707140","html_url":"https://github.com/apache/couchdb/pull/5143#issuecomment-2237707140","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5143","id":2237707140,"node_id":"IC_kwDOAAMmUc6FYLOE","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-18T22:08:10Z","updated_at":"2024-07-18T22:08:10Z","author_association":"CONTRIBUTOR","body":"Could we have an automated check for unused vars/functions on every CI run?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237707140/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237711023","html_url":"https://github.com/apache/couchdb/pull/5143#issuecomment-2237711023","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5143","id":2237711023,"node_id":"IC_kwDOAAMmUc6FYMKv","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-18T22:11:48Z","updated_at":"2024-07-18T22:17:52Z","author_association":"CONTRIBUTOR","body":"@big-r81 unlike missing functions, unused external are bit more complicated. Some modules have external functions that are useful for debugging (by hand, via remsh), some are used in tests, some modules don't set up their behavior declarations properly (or xref doesn't handle behaviors well) so it there is a longer list to go through. I just went manually through the report and searched for usage by hand.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2237711023/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2243374721","html_url":"https://github.com/apache/couchdb/issues/5122#issuecomment-2243374721","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5122","id":2243374721,"node_id":"IC_kwDOAAMmUc6Fty6B","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-22T16:36:09Z","updated_at":"2024-07-22T16:36:09Z","author_association":"CONTRIBUTOR","body":"This should be fixed with https://github.com/apache/couchdb/pull/5143","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2243374721/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2243544959","html_url":"https://github.com/apache/couchdb/issues/5140#issuecomment-2243544959","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5140","id":2243544959,"node_id":"IC_kwDOAAMmUc6Fucd_","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-22T18:16:14Z","updated_at":"2024-07-22T18:16:14Z","author_association":"CONTRIBUTOR","body":"Closing this for now, it seems it's an Erlang/OTP error.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2243544959/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2243671036","html_url":"https://github.com/apache/couchdb/pull/5146#issuecomment-2243671036","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5146","id":2243671036,"node_id":"IC_kwDOAAMmUc6Fu7P8","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-22T19:31:57Z","updated_at":"2024-07-22T19:31:57Z","author_association":"CONTRIBUTOR","body":"Fixing the compilation errors and now getting the following error when running `http://127.0.0.1:15984/_utils/#/verifyinstall`:\r\n\r\n```\r\n[error] 2024-07-22T19:27:50.849320Z node1@127.0.0.1 <0.897.0> -------- OS Process Error <0.906.0> :: {<<\"TypeError\">>,{[]}}\r\n```\r\n\r\nSo almost the same as for sm 102.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2243671036/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2243978639","html_url":"https://github.com/apache/couchdb/pull/5147#issuecomment-2243978639","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5147","id":2243978639,"node_id":"IC_kwDOAAMmUc6FwGWP","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-22T23:28:56Z","updated_at":"2024-07-22T23:28:56Z","author_association":"CONTRIBUTOR","body":"Ran a full CI test run since it has a search elixir suite running with clouseau:\r\n\r\n<img width=\"802\" alt=\"Screenshot 2024-07-22 at 7 28 23 PM\" src=\"https://github.com/user-attachments/assets/6f15b328-e676-4dd9-be07-8a2ced29a516\">\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2243978639/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2245194053","html_url":"https://github.com/apache/couchdb/issues/4926#issuecomment-2245194053","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4926","id":2245194053,"node_id":"IC_kwDOAAMmUc6F0vFF","user":{"login":"Linzdigr","id":8930392,"node_id":"MDQ6VXNlcjg5MzAzOTI=","avatar_url":"https://avatars.githubusercontent.com/u/8930392?v=4","gravatar_id":"","url":"https://api.github.com/users/Linzdigr","html_url":"https://github.com/Linzdigr","followers_url":"https://api.github.com/users/Linzdigr/followers","following_url":"https://api.github.com/users/Linzdigr/following{/other_user}","gists_url":"https://api.github.com/users/Linzdigr/gists{/gist_id}","starred_url":"https://api.github.com/users/Linzdigr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Linzdigr/subscriptions","organizations_url":"https://api.github.com/users/Linzdigr/orgs","repos_url":"https://api.github.com/users/Linzdigr/repos","events_url":"https://api.github.com/users/Linzdigr/events{/privacy}","received_events_url":"https://api.github.com/users/Linzdigr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-23T13:04:23Z","updated_at":"2024-07-24T06:05:12Z","author_association":"NONE","body":"Hello there, exact same issue on\r\n- Rocky Linux 9\r\n- Docker Engine Client 27.0.3\r\n- Docker Engine Server 27.0.3\r\n- Couchdb Docker image `couchdb:3.3.2`\r\n\r\nThe container is given around 1.5GiB of memory which is way more than deploying in the same condition on Ubuntu 24.04LTS (same Docker / docker-compose version) - around 95MiB.\r\n\r\nOnly this service is affected by this behavior.\r\n\r\nAny idea where I should look at as it seems kinda system dependent ?\r\n\r\nEDIT: Rocky Linux 8 don't have this issue..","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2245194053/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2253261222","html_url":"https://github.com/apache/couchdb/issues/5127#issuecomment-2253261222","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5127","id":2253261222,"node_id":"IC_kwDOAAMmUc6GTgmm","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-26T18:23:23Z","updated_at":"2024-07-26T18:23:23Z","author_association":"CONTRIBUTOR","body":"Having failed to reproduce this locally so moved on to investigate on a cluster where this error happens regularly.\r\n\r\nFound a cluster where `exit:timeout` stream init timeout errors happen up to 4000 times per minute. Noticed most of them are not generated by an error in the coordinator or the workers. The processes will generate those are calls to `fabric:design_docs/1` from the ddoc cache recover logic. The calls seem to not generate any failures except the left-over workers in the stream_init state, waiting or stream start/cancel messages, which was rather baffling at first.\r\n\r\nHowever after a more thorough investigation, the reason for that is that design docs are updated often enough that the ddoc cache is quickly firing up and immediately kill the `fabric:design_docs/1` process. There is nothing to log an error and since these are not gen_servers registered with SASL they don't emit any error logs, as expected.\r\n\r\nIn general, we already have a fabric_streams mechanism to handle the coordinator being killed unexpectedly. However tracing the lifetime of the `fabric:design_docs/1` processes, the coordinator is often killed before it gets a chance to even start the auxiliary cleanup process. The current pattern is something like this:\r\n\r\nWe submit the jobs:\r\n\r\nhttps://github.com/apache/couchdb/blob/d0cf54e1ef5c7e67fe08c29c5e80a1b77ca614e7/src/fabric/src/fabric_view_all_docs.erl#L28-L30\r\n\r\nThen we spawn the cleanup process:\r\n\r\nhttps://github.com/apache/couchdb/blob/d0cf54e1ef5c7e67fe08c29c5e80a1b77ca614e7/src/fabric/src/fabric_streams.erl#L49-L51\r\n\r\nThose may seem like they would happen almost immediately, however tracing the `init_p` call on the workers side, and trying to log the process info of the caller (coordinator), by the time the `init_p` function is called, the coordinator is already dead. Since we never spawned the cleaner process yet, there is nothing to clean up these workers.\r\n\r\nOn the positive side, these workers don't actually do any work, they just wait in a receive clause, albeit with an open handle Db handle which is not too great.\r\n\r\nTo fix this particular case we have to ensure the cleaner process starts even earlier. By the time the coordinator submits the jobs the cleanup process should be up and waiting with the node-ref tuples ready to clean them up.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2253261222/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2253518775","html_url":"https://github.com/apache/couchdb/pull/5151#issuecomment-2253518775","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5151","id":2253518775,"node_id":"IC_kwDOAAMmUc6GUfe3","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-26T21:16:38Z","updated_at":"2024-07-26T21:16:38Z","author_association":"CONTRIBUTOR","body":"> bonus points if we also fix the typo in \"js_enigine\"\r\n\r\nAh, good catch. Updated.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2253518775/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2254333040","html_url":"https://github.com/apache/couchdb/pull/5152#issuecomment-2254333040","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5152","id":2254333040,"node_id":"IC_kwDOAAMmUc6GXmRw","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-28T03:55:55Z","updated_at":"2024-07-28T03:55:55Z","author_association":"CONTRIBUTOR","body":"> Just a nit, but I thought a couple sentences in the PR description might have contained typos, specifically:\r\n> \r\n> > This is what allows us to start the cleanup process before the _even_ get submitted. Older calls can just _be easily call_ into the cast_ref versions with their own created references.\r\n\r\nThank you. Yeah that is confusing. I reworded it as:\r\n\r\n> This is what allows us to start the cleanup process before the jobs are even submitted. Older calls can just  be transformed to call into the `cast_ref` versions with their own created  references.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2254333040/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2255319888","html_url":"https://github.com/apache/couchdb/issues/5153#issuecomment-2255319888","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5153","id":2255319888,"node_id":"IC_kwDOAAMmUc6GbXNQ","user":{"login":"pgj","id":277835,"node_id":"MDQ6VXNlcjI3NzgzNQ==","avatar_url":"https://avatars.githubusercontent.com/u/277835?v=4","gravatar_id":"","url":"https://api.github.com/users/pgj","html_url":"https://github.com/pgj","followers_url":"https://api.github.com/users/pgj/followers","following_url":"https://api.github.com/users/pgj/following{/other_user}","gists_url":"https://api.github.com/users/pgj/gists{/gist_id}","starred_url":"https://api.github.com/users/pgj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pgj/subscriptions","organizations_url":"https://api.github.com/users/pgj/orgs","repos_url":"https://api.github.com/users/pgj/repos","events_url":"https://api.github.com/users/pgj/events{/privacy}","received_events_url":"https://api.github.com/users/pgj/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-29T08:28:59Z","updated_at":"2024-07-29T08:28:59Z","author_association":"CONTRIBUTOR","body":"This has been addressed in `recon` upstream: https://github.com/ferd/recon/commit/c7c07ad8193ec6470c775c213e15e0f3447114b7","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2255319888/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2256044471","html_url":"https://github.com/apache/couchdb/issues/5155#issuecomment-2256044471","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5155","id":2256044471,"node_id":"IC_kwDOAAMmUc6GeIG3","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-29T14:06:59Z","updated_at":"2024-07-29T14:06:59Z","author_association":"MEMBER","body":"Perhaps a different existing authentication handler would suit you better? (https://docs.couchdb.org/en/stable/api/server/authn.html) the Proxy and JWT handlers in particular would let you externalise authentication in a way that might better integration with your secrets management solution.\r\n\r\nAm I inferring correctly that `sops-nix` would arrange for those files to contain the appropriate passwords? If so, is it not capable of writing them in INI format?\r\n\r\nYou've mentioned 'cleartext' a few times, so I must add that couchdb will always hash any cleartext credentials it finds in the `.ini` files and write the hash back down to disk, to protect the secret value. You should always write a hashed value instead (ideally with PBKDF2 and a high iteration count).\r\n\r\nThe enhancement in question is probably not too difficult to do but there are caching concerns. For performance reasons we would need to cache the contents of those files in memory, and it would be unprecedented to monitor those files for  changes (we don't do that for our `.ini` files).\r\n\r\nMy take, so far, is that we would not want the additional complexity and failure modes that this would bring, without bringing a feature that would benefit many users. \r\n\r\nI think there is likely to be a much better way to achieve your goal than the proposal submitted, but please add any further details or comments and we can continue the discussion.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2256044471/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2256250073","html_url":"https://github.com/apache/couchdb/issues/5155#issuecomment-2256250073","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5155","id":2256250073,"node_id":"IC_kwDOAAMmUc6Ge6TZ","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-29T15:31:45Z","updated_at":"2024-07-29T16:24:37Z","author_association":"CONTRIBUTOR","body":"I think @rnewson indicated a good solution: using an `.ini` file which sops-nix seems to [support](https://github.com/Mic92/sops-nix/blob/eb34eb588132d653e4c4925d862f1e5a227cc2ab/README.md?plain=1#L580).\r\n\r\nCouchDB config system, besides `default.ini` and `local.ini`, will also look in the directories `default.d` and `local.d`, which can contain any number of `*.ini` files. So, wonder if deploying something like `.../couchdb/etc/local.d/50-sopx-admins.ini` would work, with contents looking like:\r\n\r\n```\r\n[admins]\r\nadm = pass\r\n```\r\n\r\nOr better if it's pre-hashed already:\r\n\r\n```\r\n[admins]\r\nadm = -pbkdf2:sha256-ae88e5f190f4...,50000\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2256250073/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2256255626","html_url":"https://github.com/apache/couchdb/issues/5155#issuecomment-2256255626","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5155","id":2256255626,"node_id":"IC_kwDOAAMmUc6Ge7qK","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-29T15:34:27Z","updated_at":"2024-07-29T15:34:27Z","author_association":"MEMBER","body":"right, just manage a `.ini` file of your own (one per cred, or all in one) and call config reload whenever it updates.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2256255626/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2256459007","html_url":"https://github.com/apache/couchdb/issues/5155#issuecomment-2256459007","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5155","id":2256459007,"node_id":"IC_kwDOAAMmUc6GftT_","user":{"login":"nerodono","id":125392321,"node_id":"U_kgDOB3lVwQ","avatar_url":"https://avatars.githubusercontent.com/u/125392321?v=4","gravatar_id":"","url":"https://api.github.com/users/nerodono","html_url":"https://github.com/nerodono","followers_url":"https://api.github.com/users/nerodono/followers","following_url":"https://api.github.com/users/nerodono/following{/other_user}","gists_url":"https://api.github.com/users/nerodono/gists{/gist_id}","starred_url":"https://api.github.com/users/nerodono/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nerodono/subscriptions","organizations_url":"https://api.github.com/users/nerodono/orgs","repos_url":"https://api.github.com/users/nerodono/repos","events_url":"https://api.github.com/users/nerodono/events{/privacy}","received_events_url":"https://api.github.com/users/nerodono/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-29T17:05:47Z","updated_at":"2024-07-29T17:05:47Z","author_association":"NONE","body":"Sure, it is a solution to add entire `.ini` config as a secret. (A little off-topic) `sops-nix` works a bit different, here's yml configuration of sops, as an example:\r\n```yaml\r\nusers:\r\n  user:\r\n    password: qwerty\r\n```\r\nIt will create file `/run/secrets/users/user/password` and place `qwerty` as contents. It's a bit too __secret__ to store entire config in the secrets. JWT authentication works for that purpose though.\r\n\r\n@nickva proposed good solution, thanks! This will definitely work for me.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2256459007/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2256460399","html_url":"https://github.com/apache/couchdb/issues/5153#issuecomment-2256460399","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5153","id":2256460399,"node_id":"IC_kwDOAAMmUc6Gftpv","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-29T17:06:35Z","updated_at":"2024-07-29T17:06:35Z","author_association":"CONTRIBUTOR","body":"> This has been addressed in `recon` upstream: [ferd/recon@c7c07ad](https://github.com/ferd/recon/commit/c7c07ad8193ec6470c775c213e15e0f3447114b7)\r\n\r\nThx for the hint Gábor. 🙏 ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2256460399/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2257625355","html_url":"https://github.com/apache/couchdb/issues/5044#issuecomment-2257625355","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5044","id":2257625355,"node_id":"IC_kwDOAAMmUc6GkKEL","user":{"login":"tiju86","id":55751429,"node_id":"MDQ6VXNlcjU1NzUxNDI5","avatar_url":"https://avatars.githubusercontent.com/u/55751429?v=4","gravatar_id":"","url":"https://api.github.com/users/tiju86","html_url":"https://github.com/tiju86","followers_url":"https://api.github.com/users/tiju86/followers","following_url":"https://api.github.com/users/tiju86/following{/other_user}","gists_url":"https://api.github.com/users/tiju86/gists{/gist_id}","starred_url":"https://api.github.com/users/tiju86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tiju86/subscriptions","organizations_url":"https://api.github.com/users/tiju86/orgs","repos_url":"https://api.github.com/users/tiju86/repos","events_url":"https://api.github.com/users/tiju86/events{/privacy}","received_events_url":"https://api.github.com/users/tiju86/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-30T07:06:04Z","updated_at":"2024-07-30T07:06:04Z","author_association":"NONE","body":"hello @luca-simonetti ,\r\nhave you been able to make progress on this problem? we have exactly the same thing on a couchDB 3.3.3.\r\nno particular load on the server, only restarting the couchDB service solves the problem.\r\n\r\nthanks","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2257625355/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2257633197","html_url":"https://github.com/apache/couchdb/issues/5044#issuecomment-2257633197","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5044","id":2257633197,"node_id":"IC_kwDOAAMmUc6GkL-t","user":{"login":"luca-simonetti","id":44196863,"node_id":"MDQ6VXNlcjQ0MTk2ODYz","avatar_url":"https://avatars.githubusercontent.com/u/44196863?v=4","gravatar_id":"","url":"https://api.github.com/users/luca-simonetti","html_url":"https://github.com/luca-simonetti","followers_url":"https://api.github.com/users/luca-simonetti/followers","following_url":"https://api.github.com/users/luca-simonetti/following{/other_user}","gists_url":"https://api.github.com/users/luca-simonetti/gists{/gist_id}","starred_url":"https://api.github.com/users/luca-simonetti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/luca-simonetti/subscriptions","organizations_url":"https://api.github.com/users/luca-simonetti/orgs","repos_url":"https://api.github.com/users/luca-simonetti/repos","events_url":"https://api.github.com/users/luca-simonetti/events{/privacy}","received_events_url":"https://api.github.com/users/luca-simonetti/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-30T07:10:52Z","updated_at":"2024-07-30T07:10:52Z","author_association":"NONE","body":"no we changed which API from couchdb we call. Instead of calling each single attachment, we call the doc with include_attachmets=true and that does the trick.\r\nOne possible issue is that the http client is not using the right configuration (see above). Our problem is that we're using hyperledger which cannot be changed for now (we need to stick to a specific version) and as such we won't investigate further. But I guess it's important to continue on this issue anyways. Glad to help if I can manage","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2257633197/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2257633515","html_url":"https://github.com/apache/couchdb/issues/5044#issuecomment-2257633515","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5044","id":2257633515,"node_id":"IC_kwDOAAMmUc6GkMDr","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-30T07:11:04Z","updated_at":"2024-07-30T07:11:04Z","author_association":"MEMBER","body":"one note about an earlier comment, \"What I see though is a memory cache increasing. After restart that very same cache decreases a lot and starts growing back again.\", this is referring to the kernels disk page cache and it is a good thing (critical for performance), and definitely not the sign of a problem. that it goes away when you restart makes sense, as this invalidates the cache.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2257633515/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2257642192","html_url":"https://github.com/apache/couchdb/issues/5044#issuecomment-2257642192","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5044","id":2257642192,"node_id":"IC_kwDOAAMmUc6GkOLQ","user":{"login":"luca-simonetti","id":44196863,"node_id":"MDQ6VXNlcjQ0MTk2ODYz","avatar_url":"https://avatars.githubusercontent.com/u/44196863?v=4","gravatar_id":"","url":"https://api.github.com/users/luca-simonetti","html_url":"https://github.com/luca-simonetti","followers_url":"https://api.github.com/users/luca-simonetti/followers","following_url":"https://api.github.com/users/luca-simonetti/following{/other_user}","gists_url":"https://api.github.com/users/luca-simonetti/gists{/gist_id}","starred_url":"https://api.github.com/users/luca-simonetti/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/luca-simonetti/subscriptions","organizations_url":"https://api.github.com/users/luca-simonetti/orgs","repos_url":"https://api.github.com/users/luca-simonetti/repos","events_url":"https://api.github.com/users/luca-simonetti/events{/privacy}","received_events_url":"https://api.github.com/users/luca-simonetti/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-30T07:16:24Z","updated_at":"2024-07-30T07:16:24Z","author_association":"NONE","body":"> one note about an earlier comment, \"What I see though is a memory cache increasing. After restart that very same cache decreases a lot and starts growing back again.\", this is referring to the kernels disk page cache and it is a good thing (critical for performance), and definitely not the sign of a problem. that it goes away when you restart makes sense, as this invalidates the cache.\r\n\r\nthe thing is that when we restart the couch service the performance goes back to normal. In this case the first thing that comes to my mind is some cache somewhere. Not necessarily as part of couch itself but also as part of the underlying OS or something else. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2257642192/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2257657808","html_url":"https://github.com/apache/couchdb/issues/5044#issuecomment-2257657808","issue_url":"https://api.github.com/repos/apache/couchdb/issues/5044","id":2257657808,"node_id":"IC_kwDOAAMmUc6GkR_Q","user":{"login":"tiju86","id":55751429,"node_id":"MDQ6VXNlcjU1NzUxNDI5","avatar_url":"https://avatars.githubusercontent.com/u/55751429?v=4","gravatar_id":"","url":"https://api.github.com/users/tiju86","html_url":"https://github.com/tiju86","followers_url":"https://api.github.com/users/tiju86/followers","following_url":"https://api.github.com/users/tiju86/following{/other_user}","gists_url":"https://api.github.com/users/tiju86/gists{/gist_id}","starred_url":"https://api.github.com/users/tiju86/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tiju86/subscriptions","organizations_url":"https://api.github.com/users/tiju86/orgs","repos_url":"https://api.github.com/users/tiju86/repos","events_url":"https://api.github.com/users/tiju86/events{/privacy}","received_events_url":"https://api.github.com/users/tiju86/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-30T07:25:55Z","updated_at":"2024-07-30T07:25:55Z","author_association":"NONE","body":"> no we changed which API from couchdb we call. Instead of calling each single attachment, we call the doc with include_attachmets=true and that does the trick. One possible issue is that the http client is not using the right configuration (see above). Our problem is that we're using hyperledger which cannot be changed for now (we need to stick to a specific version) and as such we won't investigate further. But I guess it's important to continue on this issue anyways. Glad to help if I can manage\r\n\r\nthanks for your answer\r\ni will study this new idea because we also use attachments, there may be a problem there\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2257657808/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2259902139","html_url":"https://github.com/apache/couchdb/issues/4819#issuecomment-2259902139","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4819","id":2259902139,"node_id":"IC_kwDOAAMmUc6Gs167","user":{"login":"jbgtmartin","id":11752758,"node_id":"MDQ6VXNlcjExNzUyNzU4","avatar_url":"https://avatars.githubusercontent.com/u/11752758?v=4","gravatar_id":"","url":"https://api.github.com/users/jbgtmartin","html_url":"https://github.com/jbgtmartin","followers_url":"https://api.github.com/users/jbgtmartin/followers","following_url":"https://api.github.com/users/jbgtmartin/following{/other_user}","gists_url":"https://api.github.com/users/jbgtmartin/gists{/gist_id}","starred_url":"https://api.github.com/users/jbgtmartin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jbgtmartin/subscriptions","organizations_url":"https://api.github.com/users/jbgtmartin/orgs","repos_url":"https://api.github.com/users/jbgtmartin/repos","events_url":"https://api.github.com/users/jbgtmartin/events{/privacy}","received_events_url":"https://api.github.com/users/jbgtmartin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-31T07:58:33Z","updated_at":"2024-07-31T07:58:33Z","author_association":"NONE","body":"Hi, I don't know if it helps, I often get the same error. In the Couch logs, there are some more details, but I have no experience with CouchDB's internals so I don't really know what it means...\r\n\r\nI get the error sometimes when querying a view, but it seems to happen randomly.\r\n\r\nI'm using CouchDB 3.3.3.\r\n\r\n```\r\n[error] 2024-07-30T23:05:50.771520Z nonode@nohost <0.22093.1547> ae18ff8e35 rexi_server: from: nonode@nohost(<0.20507.1545>) mfa: fabric_rpc:map_view/5 exit:{normal,{gen_server,call,[<0.22945.1550>,{pread_iolist,5871},infinity]}} [{gen_server,call,3,[{file,\"gen_server.erl\"},{line,247}]},{couch_file,pread_iolist,2,[{file,\"src/couch_file.erl\"},{line,170}]},{couch_file,pread_binary,2,[{file,\"src/couch_file.erl\"},{line,166}]},{couch_file,pread_term,2,[{file,\"src/couch_file.erl\"},{line,155}]},{couch_btree,get_node,2,[{file,\"src/couch_btree.erl\"},{line,474}]},{couch_btree,stream_node,8,[{file,\"src/couch_btree.erl\"},{line,1069}]},{couch_btree,fold,4,[{file,\"src/couch_btree.erl\"},{line,242}]},{couch_mrview_util,fold,4,[{file,\"src/couch_mrview_util.erl\"},{line,444}]}]\r\n[error] 2024-07-30T23:05:50.773284Z nonode@nohost <0.20507.1545> ae18ff8e35 req_err(1976876363) normal : {gen_server,call,[<0.22945.1550>,{pread_iolist,5871},infinity]}\r\n    [<<\"gen_server:call/3 L247\">>,<<\"couch_file:pread_iolist/2 L170\">>,<<\"couch_file:pread_binary/2 L166\">>,<<\"couch_file:pread_term/2 L155\">>,<<\"couch_btree:get_node/2 L474\">>,<<\"couch_btree:stream_node/8 L1069\">>,<<\"couch_btree:fold/4 L242\">>,<<\"couch_mrview_util:fold/4 L444\">>]\r\n[notice] 2024-07-30T23:05:50.785391Z nonode@nohost <0.20507.1545> ae18ff8e35 couchdb:5985 192.168.241.1 admin GET /sl-users/_design/profile/_view/entityIdAndWordPressUserId?startkey=%5B%22fr75013_hop22_002%22%2Cnull%2C0%5D&endkey=%5B%22fr75013_hop22_002%22%2Cnull%2C%22%EF%BF%B0%22%5D&limit=1&include_docs=true 500 ok 20\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2259902139/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2260137918","html_url":"https://github.com/apache/couchdb/issues/4994#issuecomment-2260137918","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4994","id":2260137918,"node_id":"IC_kwDOAAMmUc6Gtve-","user":{"login":"sergey-safarov","id":2562241,"node_id":"MDQ6VXNlcjI1NjIyNDE=","avatar_url":"https://avatars.githubusercontent.com/u/2562241?v=4","gravatar_id":"","url":"https://api.github.com/users/sergey-safarov","html_url":"https://github.com/sergey-safarov","followers_url":"https://api.github.com/users/sergey-safarov/followers","following_url":"https://api.github.com/users/sergey-safarov/following{/other_user}","gists_url":"https://api.github.com/users/sergey-safarov/gists{/gist_id}","starred_url":"https://api.github.com/users/sergey-safarov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sergey-safarov/subscriptions","organizations_url":"https://api.github.com/users/sergey-safarov/orgs","repos_url":"https://api.github.com/users/sergey-safarov/repos","events_url":"https://api.github.com/users/sergey-safarov/events{/privacy}","received_events_url":"https://api.github.com/users/sergey-safarov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-31T10:01:08Z","updated_at":"2024-07-31T10:01:08Z","author_association":"NONE","body":"It just reproduced the issue.\r\nThe issue happened during the CouchDB upgrade from 2.3.1 to 3.3.1.\r\nI have started daemon. Daemon failed because the user permission for the data folder was wrong. While updating the the CouchDB daemon was stopped on the old server, detached volume from the old server, attached to the new server, and started CouchDB on the new server. On user changed `uid` for `couchdb` user and daemons failed because does not have permission to `data` folder content.\r\nI was making `chown` for the `data` folder content and then `couchdb` service started properly and the issue reproduced.\r\nNow I can see in the logs\r\n```\r\ncouchdb@db-0.example.com <0.3795.3> -------- ./data/.shards/e0000000-ffffffff/account/44/3c/44a301b106b24f0fc1fd061d3e26.1668526196_design/mrview/462e71ffa4b5d3b38b811d08ad72396c.view has the wrong signature: expected: <<70,46,113,255,164,181,211,179,139,129,29,8,173,114,57,108>> but got <<2,65,77,140,1,52,42,68,196,86,58,98,97,23,145,106>>\r\ncouchdb@db-0.example.com <0.3922.3> -------- ./data/.shards/e0000000-ffffffff/account/44/3c/44a301b106b24f0fc1fd061d3e26.1668526196_design/mrview/dd51edd8663a1cc90af2f8215cd797be.view has the wrong signature: expected: <<221,81,237,216,102,58,28,201,10,242,248,33,92,215,151,190>> but got <<174,153,108,105,115,213,43,72,131,221,10,174,163,141,228,115>>\r\ncouchdb@db-0.example.com <0.3934.3> -------- ./data/.shards/e0000000-ffffffff/account/44/3c/44a301b106b24f0fc1fd061d3e26.1668526196_design/mrview/27fcce55829ac4f09ab0f195d43ad529.view has the wrong signature: expected: <<39,252,206,85,130,154,196,240,154,176,241,149,212,58,213,41>> but got <<241,187,13,21,148,238,32,71,82,114,244,157,164,178,210,214>>\r\ncouchdb@db-0.example.com <0.4095.3> -------- ./data/.shards/e0000000-ffffffff/account/44/3c/44a301b106b24f0fc1fd061d3e26.1668526196_design/mrview/b9a49bb8b24a083e07c436f17397fb54.view has the wrong signature: expected: <<185,164,155,184,178,74,8,62,7,196,54,241,115,151,251,84>> but got <<255,60,196,213,171,156,94,131,41,80,206,111,60,138,78,212>>\r\ncouchdb@db-0.example.com <0.2473.4> -------- ./data/.shards/c0000000-dfffffff/port_requests.1595155200_design/mrview/d2d3acac282c8c10e0edc3102682ae07.view has the wrong signature: expected: <<210,211,172,172,40,44,140,16,224,237,195,16,38,130,174,7>> but got <<91,44,84,255,172,124,87,248,145,234,222,14,180,50,2,102>>\r\ncouchdb@db-0.example.com <0.5771.4> -------- ./data/.shards/00000000-1fffffff/port_requests.1595155200_design/mrview/d2d3acac282c8c10e0edc3102682ae07.view has the wrong signature: expected: <<210,211,172,172,40,44,140,16,224,237,195,16,38,130,174,7>> but got <<91,44,84,255,172,124,87,248,145,234,222,14,180,50,2,102>>\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2260137918/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2260369446","html_url":"https://github.com/apache/couchdb/issues/4994#issuecomment-2260369446","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4994","id":2260369446,"node_id":"IC_kwDOAAMmUc6GuoAm","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-07-31T12:08:11Z","updated_at":"2024-07-31T12:08:37Z","author_association":"MEMBER","body":"jan's theory makes sense to me. the 2.x -> 3.x upgrade code is flawed, it only tries the 2.0 sig if the file was found in the old location, and assumes we'll write a new header for all views on upgrade (any couchdb crash or restart before that would cause things to go wrong subsequently)\r\n\r\nsuggest a different approach at https://github.com/apache/couchdb/blob/3.3.3/src/couch_mrview/src/couch_mrview_index.erl#L121 or so, we can try to match the v2 sig if the v3 sig fails. that is, decouple the moving of the file from old to new location from whether the file itself is v2 vs v3.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/2260369446/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]