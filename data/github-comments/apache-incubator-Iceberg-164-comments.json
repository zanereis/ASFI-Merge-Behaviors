[{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106560823","html_url":"https://github.com/apache/iceberg/pull/4611#issuecomment-1106560823","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4611","id":1106560823,"node_id":"IC_kwDOCW7NX85B9Mc3","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-22T14:15:31Z","updated_at":"2022-04-22T14:15:31Z","author_association":"MEMBER","body":"Uh looks like we already had some :) \r\n```\r\nError: eckstyle] [ERROR] /home/runner/work/iceberg/iceberg/nessie/src/main/java/org/apache/iceberg/nessie/UpdateableReference.java:53: Use Preconditions.checkNotNull(Object, String). [RegexpSinglelineJava]\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106560823/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106562919","html_url":"https://github.com/apache/iceberg/pull/4611#issuecomment-1106562919","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4611","id":1106562919,"node_id":"IC_kwDOCW7NX85B9M9n","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-22T14:17:39Z","updated_at":"2022-04-22T14:17:39Z","author_association":"MEMBER","body":"https://github.com/apache/iceberg/issues/4613","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106562919/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106590232","html_url":"https://github.com/apache/iceberg/pull/4611#issuecomment-1106590232","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4611","id":1106590232,"node_id":"IC_kwDOCW7NX85B9ToY","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-22T14:47:50Z","updated_at":"2022-04-22T14:47:50Z","author_association":"MEMBER","body":"Just waiting on tests here","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106590232/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106649862","html_url":"https://github.com/apache/iceberg/pull/4555#issuecomment-1106649862","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4555","id":1106649862,"node_id":"IC_kwDOCW7NX85B9iMG","user":{"login":"SinghAsDev","id":4915557,"node_id":"MDQ6VXNlcjQ5MTU1NTc=","avatar_url":"https://avatars.githubusercontent.com/u/4915557?v=4","gravatar_id":"","url":"https://api.github.com/users/SinghAsDev","html_url":"https://github.com/SinghAsDev","followers_url":"https://api.github.com/users/SinghAsDev/followers","following_url":"https://api.github.com/users/SinghAsDev/following{/other_user}","gists_url":"https://api.github.com/users/SinghAsDev/gists{/gist_id}","starred_url":"https://api.github.com/users/SinghAsDev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SinghAsDev/subscriptions","organizations_url":"https://api.github.com/users/SinghAsDev/orgs","repos_url":"https://api.github.com/users/SinghAsDev/repos","events_url":"https://api.github.com/users/SinghAsDev/events{/privacy}","received_events_url":"https://api.github.com/users/SinghAsDev/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-22T15:57:19Z","updated_at":"2022-04-22T15:57:19Z","author_association":"CONTRIBUTOR","body":"Hi @rdblue @kbendick thanks for taking a look. This change works for both 2-level and 3-level lists. As part of adding support for 2-level lists, we added quite a few tests which work fine with this change. We have been running some workloads with this change at Pinterest as well. I will add an end-to-end test specifically for this edge case.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106649862/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106714989","html_url":"https://github.com/apache/iceberg/pull/4466#issuecomment-1106714989","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4466","id":1106714989,"node_id":"IC_kwDOCW7NX85B9yFt","user":{"login":"CircArgs","id":35903677,"node_id":"MDQ6VXNlcjM1OTAzNjc3","avatar_url":"https://avatars.githubusercontent.com/u/35903677?v=4","gravatar_id":"","url":"https://api.github.com/users/CircArgs","html_url":"https://github.com/CircArgs","followers_url":"https://api.github.com/users/CircArgs/followers","following_url":"https://api.github.com/users/CircArgs/following{/other_user}","gists_url":"https://api.github.com/users/CircArgs/gists{/gist_id}","starred_url":"https://api.github.com/users/CircArgs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CircArgs/subscriptions","organizations_url":"https://api.github.com/users/CircArgs/orgs","repos_url":"https://api.github.com/users/CircArgs/repos","events_url":"https://api.github.com/users/CircArgs/events{/privacy}","received_events_url":"https://api.github.com/users/CircArgs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-22T17:24:19Z","updated_at":"2022-04-22T17:24:35Z","author_association":"CONTRIBUTOR","body":"Hey @rdblue I wanted to circle back on the original without raising the error. I threw it in without considering the implications based on your suggestion, but I feel as though we still don't need such a thing. When one creates an `And` for example, it will call `__new__` and run through the logic on whether we are dealing with a tautology or a contradiction and yield `AlwaysTrue` or `AlwaysFalse` respectively. This logic, in conjunction with taking in `*rest` and reducing to binary `And`s makes us have to return and that's why I'm using `__new__`. Take this example:\r\n\r\n```python\r\nclass A:\r\n    def __new__(cls):\r\n        return B()\r\n    def __init__(self):\r\n        print('A init')\r\n        \r\nclass B:\r\n    def __init__(self):\r\n        print('B init')\r\n\r\nA()\r\n>>> \"B init\"\r\n\r\n\r\n```\r\n\r\nSo A's `__new__` was called but the resulting object was a B so its `__init__` was called. I'm just showing how `__new__` has full control here and that `And`'s `__init__` will only ever see what `__new__` wants it to see. As for what happens via possible calls to `super` from child classes, do we have to worry about that? I believed these classes would not be inherited from and if they were it is the user's responsibility to understand the implications especially when dealing with dunder methods.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106714989/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106756188","html_url":"https://github.com/apache/iceberg/pull/4307#issuecomment-1106756188","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4307","id":1106756188,"node_id":"IC_kwDOCW7NX85B98Jc","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-22T18:23:34Z","updated_at":"2022-04-22T18:24:57Z","author_association":"CONTRIBUTOR","body":"Oh I see. The checkstyle is failing. If you click on ther failing check, `Java CI / build-checks`, you can see this error.\r\n\r\n```\r\nError: eckstyle] [ERROR] /home/runner/work/iceberg/iceberg/spark/v3.2/spark/src/main/java/org/apache/iceberg/spark/actions/BaseDeleteOrphanFilesSparkAction.java:276: Line is longer than 120 characters (found 121). [LineLength]\r\n```\r\n\r\nIf you run `./gradlew -DflinkVersions=1.13,1.14 -DsparkVersions=2.4,3.0,3.1,3.2 -DhiveVersions=2,3 build -x test -x javadoc -x integrationTest` locally and continue to fix the errors, then everything will be good to go 😄 ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106756188/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106767615","html_url":"https://github.com/apache/iceberg/pull/4609#issuecomment-1106767615","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4609","id":1106767615,"node_id":"IC_kwDOCW7NX85B9-7_","user":{"login":"dramaticlly","id":5961173,"node_id":"MDQ6VXNlcjU5NjExNzM=","avatar_url":"https://avatars.githubusercontent.com/u/5961173?v=4","gravatar_id":"","url":"https://api.github.com/users/dramaticlly","html_url":"https://github.com/dramaticlly","followers_url":"https://api.github.com/users/dramaticlly/followers","following_url":"https://api.github.com/users/dramaticlly/following{/other_user}","gists_url":"https://api.github.com/users/dramaticlly/gists{/gist_id}","starred_url":"https://api.github.com/users/dramaticlly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dramaticlly/subscriptions","organizations_url":"https://api.github.com/users/dramaticlly/orgs","repos_url":"https://api.github.com/users/dramaticlly/repos","events_url":"https://api.github.com/users/dramaticlly/events{/privacy}","received_events_url":"https://api.github.com/users/dramaticlly/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-22T18:41:57Z","updated_at":"2022-04-22T18:41:57Z","author_association":"CONTRIBUTOR","body":"Accessor as a class looks like a really cool way to access the index based element in a struct like container\r\n\r\nBut i am curious if we can share some more concrete example to understand how it can/shall be used in iceberg domain? \r\n\r\nGuessing from module.class structure, looks like `StructProtocol` is sitting in `files.py` and accessor is probably mostly used in expressions?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106767615/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106789619","html_url":"https://github.com/apache/iceberg/pull/4609#issuecomment-1106789619","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4609","id":1106789619,"node_id":"IC_kwDOCW7NX85B-ETz","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-22T19:15:51Z","updated_at":"2022-04-22T19:15:51Z","author_association":"CONTRIBUTOR","body":"@dramaticlly, accessors are created by a schema visitor and then used when binding an expression to a schema. The bound term (variable of a predicate) basically wraps an accessor to get the data value for evaluation. Then the predicate gets the value of the term (via accessor) and compares it to the value of the literal.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106789619/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106883935","html_url":"https://github.com/apache/iceberg/issues/4613#issuecomment-1106883935","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4613","id":1106883935,"node_id":"IC_kwDOCW7NX85B-bVf","user":{"login":"tal66","id":77445020,"node_id":"MDQ6VXNlcjc3NDQ1MDIw","avatar_url":"https://avatars.githubusercontent.com/u/77445020?v=4","gravatar_id":"","url":"https://api.github.com/users/tal66","html_url":"https://github.com/tal66","followers_url":"https://api.github.com/users/tal66/followers","following_url":"https://api.github.com/users/tal66/following{/other_user}","gists_url":"https://api.github.com/users/tal66/gists{/gist_id}","starred_url":"https://api.github.com/users/tal66/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tal66/subscriptions","organizations_url":"https://api.github.com/users/tal66/orgs","repos_url":"https://api.github.com/users/tal66/repos","events_url":"https://api.github.com/users/tal66/events{/privacy}","received_events_url":"https://api.github.com/users/tal66/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-22T21:30:05Z","updated_at":"2022-04-22T21:30:05Z","author_association":"CONTRIBUTOR","body":"is this what you mean?:\r\n```\r\n<module name=\"RegexpSinglelineJava\">\r\n        <property name=\"format\" value=\"Objects\\.requireNonNull.*\\(.*\\)\"/>\r\n        <property name=\"message\" value=\"Prefer using Preconditions.checkNotNull(Object, String).\"/>\r\n</module>\r\n```\r\nthis includes: Objects.requireNonNull() + .requireNonNullElse();\r\n\r\nsecond option: \r\n`value=\"Objects\\.(require|)[Nn]onNull.*\\(.*\\)\"` - the above + Objects.nonNull().\r\n\r\ncould add it in line 340. \r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106883935/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106885245","html_url":"https://github.com/apache/iceberg/issues/4613#issuecomment-1106885245","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4613","id":1106885245,"node_id":"IC_kwDOCW7NX85B-bp9","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-22T21:31:38Z","updated_at":"2022-04-22T21:31:38Z","author_association":"MEMBER","body":"Yep exactly something like although I haven't checked the regexes you put in there :) ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106885245/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106885845","html_url":"https://github.com/apache/iceberg/issues/4613#issuecomment-1106885845","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4613","id":1106885845,"node_id":"IC_kwDOCW7NX85B-bzV","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-22T21:32:22Z","updated_at":"2022-04-22T21:32:22Z","author_association":"MEMBER","body":"If you do submit a PR please add a few console logs of the rule in action and failing a build","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106885845/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106981195","html_url":"https://github.com/apache/iceberg/pull/4466#issuecomment-1106981195","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4466","id":1106981195,"node_id":"IC_kwDOCW7NX85B-zFL","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-22T23:01:50Z","updated_at":"2022-04-22T23:01:50Z","author_association":"CONTRIBUTOR","body":"@CircArgs, the method can still be called with bad arguments. Since we cannot hide it entirely, I think throwing an exception is a reasonable step to ensure it isn't misused.\r\n\r\nIt's also interesting that we're actually hitting the `ValueError` in tests:\r\n\r\n```\r\n  ==================================== ERRORS ====================================\r\n  _________ ERROR collecting tests/expressions/test_expressions_base.py __________\r\n  tests/expressions/test_expressions_base.py:159: in <module>\r\n      base.And(TestExpressionA(), TestExpressionB(), TestExpressionA()),\r\n  src/iceberg/expressions/base.py:162: in __init__\r\n      raise ValueError(\"Expected only left and right operands\")\r\n  E   ValueError: Expected only left and right operands\r\n  _________ ERROR collecting tests/expressions/test_expressions_base.py __________\r\n  tests/expressions/test_expressions_base.py:159: in <module>\r\n      base.And(TestExpressionA(), TestExpressionB(), TestExpressionA()),\r\n  src/iceberg/expressions/base.py:162: in __init__\r\n      raise ValueError(\"Expected only left and right operands\")\r\n  E   ValueError: Expected only left and right operands\r\n```\r\n\r\nWhy is that case getting hit? I thought that we were controlling the inputs to `__init__`?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106981195/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106986734","html_url":"https://github.com/apache/iceberg/pull/4558#issuecomment-1106986734","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4558","id":1106986734,"node_id":"IC_kwDOCW7NX85B-0bu","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-22T23:02:56Z","updated_at":"2022-04-22T23:02:56Z","author_association":"COLLABORATOR","body":"Hi guys, I filed #4618 to make checkstyle rule for this , if someone wants to pick it up.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1106986734/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107157069","html_url":"https://github.com/apache/iceberg/pull/4466#issuecomment-1107157069","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4466","id":1107157069,"node_id":"IC_kwDOCW7NX85B_eBN","user":{"login":"samredai","id":43911210,"node_id":"MDQ6VXNlcjQzOTExMjEw","avatar_url":"https://avatars.githubusercontent.com/u/43911210?v=4","gravatar_id":"","url":"https://api.github.com/users/samredai","html_url":"https://github.com/samredai","followers_url":"https://api.github.com/users/samredai/followers","following_url":"https://api.github.com/users/samredai/following{/other_user}","gists_url":"https://api.github.com/users/samredai/gists{/gist_id}","starred_url":"https://api.github.com/users/samredai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samredai/subscriptions","organizations_url":"https://api.github.com/users/samredai/orgs","repos_url":"https://api.github.com/users/samredai/repos","events_url":"https://api.github.com/users/samredai/events{/privacy}","received_events_url":"https://api.github.com/users/samredai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-23T01:35:48Z","updated_at":"2022-04-23T01:37:28Z","author_association":"CONTRIBUTOR","body":"The ValueError getting raised comes from the fact that `__init__` is always called after `__new__` when you call the standard class constructor. The first argument to `__init__` (meaning `self`) is the value returned from `__new__`.\r\n\r\nHowever for the `if rest` case that's in `__new__` here, a fully constructed instance is returned by `return reduce(And, (left, right, *rest))` and so `__init__` doesn't need to do anything, which is why it was only doing something `if not rest`. So whether or not `rest` is provided is being used as a sort of signal to `__init__` on whether or not the class has already been fully initialized in `__new__`. Adding the `ValueError` disrupts the \"already initialized path\" by causing `__init__` to panic.\r\n\r\nTwo other alternatives I can think of is:\r\n1. Move the initialization entirely into `__new__` and get rid of `__init__` completely:\r\n```py\r\nclass And(BooleanExpression):\r\n    \"\"\"AND operation expression - logical conjunction\"\"\"\r\n\r\n    def __new__(cls, left: BooleanExpression, right: BooleanExpression, *rest: BooleanExpression):\r\n        if rest:\r\n            return reduce(And, (left, right, *rest))\r\n        if left is AlwaysFalse() or right is AlwaysFalse():\r\n            return AlwaysFalse()\r\n        elif left is AlwaysTrue():\r\n            return right\r\n        elif right is AlwaysTrue():\r\n            return left\r\n        _instance = super().__new__(cls)\r\n        _instance.args = (left, right)\r\n        vars(_instance)[\"left\"] = left\r\n        vars(_instance)[\"right\"] = right\r\n        return _instance\r\n```\r\n2. Move the reduction logic out into a standalone function and simplify the `And` class to only accept a `left` and `right` arg:\r\n```py\r\ndef and_expression(left: BooleanExpression, right: BooleanExpression, *rest: BooleanExpression) -> Union[And, AlwaysTrue, AlwaysFalse]:\r\n    if rest:\r\n        return reduce(And, (left, right, *rest))\r\n    if left is AlwaysFalse() or right is AlwaysFalse():\r\n        return AlwaysFalse()\r\n    elif left is AlwaysTrue():\r\n        return right\r\n    elif right is AlwaysTrue():\r\n        return left\r\n    return And(left, right)\r\n```\r\nA note on option 1, someone can still override `__new__` in a subclass as @rdblue pointed out but I think the expectation holds that they should call `super().__new__(cls, *args, **kwargs)`, just as it's expected to call `super().__init__(*args, **kwargs)` if you override `__init__` in a subclass.\r\n\r\nA note about option 2 is that it may make checking if something is an instance of `And` less intuitive, in other words:\r\n```py\r\nfrom iceberg.expressions.base import and_expression, And\r\n\r\nexpr = and_expression(left, right, rest)\r\nisinstance(expr, And)\r\n```\r\nas opposed to:\r\n```py\r\nfrom iceberg.expressions.base import And\r\n\r\nexpr = And(left, right, rest)\r\nisinstance(expr, And)\r\n```\r\n\r\n(sorry for the super long comment...)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107157069/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107336380","html_url":"https://github.com/apache/iceberg/pull/4619#issuecomment-1107336380","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4619","id":1107336380,"node_id":"IC_kwDOCW7NX85CAJy8","user":{"login":"samredai","id":43911210,"node_id":"MDQ6VXNlcjQzOTExMjEw","avatar_url":"https://avatars.githubusercontent.com/u/43911210?v=4","gravatar_id":"","url":"https://api.github.com/users/samredai","html_url":"https://github.com/samredai","followers_url":"https://api.github.com/users/samredai/followers","following_url":"https://api.github.com/users/samredai/following{/other_user}","gists_url":"https://api.github.com/users/samredai/gists{/gist_id}","starred_url":"https://api.github.com/users/samredai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samredai/subscriptions","organizations_url":"https://api.github.com/users/samredai/orgs","repos_url":"https://api.github.com/users/samredai/repos","events_url":"https://api.github.com/users/samredai/events{/privacy}","received_events_url":"https://api.github.com/users/samredai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-23T02:59:07Z","updated_at":"2022-04-23T02:59:07Z","author_association":"CONTRIBUTOR","body":"cc: @dramaticlly @CircArgs @jun-he @dhruv-pratap","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107336380/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107367670","html_url":"https://github.com/apache/iceberg/issues/3968#issuecomment-1107367670","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3968","id":1107367670,"node_id":"IC_kwDOCW7NX85CARb2","user":{"login":"caesar168","id":4076070,"node_id":"MDQ6VXNlcjQwNzYwNzA=","avatar_url":"https://avatars.githubusercontent.com/u/4076070?v=4","gravatar_id":"","url":"https://api.github.com/users/caesar168","html_url":"https://github.com/caesar168","followers_url":"https://api.github.com/users/caesar168/followers","following_url":"https://api.github.com/users/caesar168/following{/other_user}","gists_url":"https://api.github.com/users/caesar168/gists{/gist_id}","starred_url":"https://api.github.com/users/caesar168/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/caesar168/subscriptions","organizations_url":"https://api.github.com/users/caesar168/orgs","repos_url":"https://api.github.com/users/caesar168/repos","events_url":"https://api.github.com/users/caesar168/events{/privacy}","received_events_url":"https://api.github.com/users/caesar168/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-23T05:26:17Z","updated_at":"2022-04-23T05:26:17Z","author_association":"NONE","body":"I This demand is still quite a lot. We also need such a complete example.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107367670/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107373788","html_url":"https://github.com/apache/iceberg/pull/4546#issuecomment-1107373788","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4546","id":1107373788,"node_id":"IC_kwDOCW7NX85CAS7c","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-23T05:47:55Z","updated_at":"2022-04-23T05:47:55Z","author_association":"COLLABORATOR","body":"FYI @singhpk234 if you want to take another look ?  ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107373788/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107393061","html_url":"https://github.com/apache/iceberg/issues/4618#issuecomment-1107393061","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4618","id":1107393061,"node_id":"IC_kwDOCW7NX85CAXol","user":{"login":"selectbook","id":8454350,"node_id":"MDQ6VXNlcjg0NTQzNTA=","avatar_url":"https://avatars.githubusercontent.com/u/8454350?v=4","gravatar_id":"","url":"https://api.github.com/users/selectbook","html_url":"https://github.com/selectbook","followers_url":"https://api.github.com/users/selectbook/followers","following_url":"https://api.github.com/users/selectbook/following{/other_user}","gists_url":"https://api.github.com/users/selectbook/gists{/gist_id}","starred_url":"https://api.github.com/users/selectbook/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/selectbook/subscriptions","organizations_url":"https://api.github.com/users/selectbook/orgs","repos_url":"https://api.github.com/users/selectbook/repos","events_url":"https://api.github.com/users/selectbook/events{/privacy}","received_events_url":"https://api.github.com/users/selectbook/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-23T06:28:39Z","updated_at":"2022-04-23T06:28:39Z","author_association":"NONE","body":"@szehon-ho Hello, I would like to contribute in this issue, Can you assign it to me? thank you","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107393061/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107513112","html_url":"https://github.com/apache/iceberg/pull/4620#issuecomment-1107513112","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4620","id":1107513112,"node_id":"IC_kwDOCW7NX85CA08Y","user":{"login":"felixYyu","id":3785228,"node_id":"MDQ6VXNlcjM3ODUyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3785228?v=4","gravatar_id":"","url":"https://api.github.com/users/felixYyu","html_url":"https://github.com/felixYyu","followers_url":"https://api.github.com/users/felixYyu/followers","following_url":"https://api.github.com/users/felixYyu/following{/other_user}","gists_url":"https://api.github.com/users/felixYyu/gists{/gist_id}","starred_url":"https://api.github.com/users/felixYyu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixYyu/subscriptions","organizations_url":"https://api.github.com/users/felixYyu/orgs","repos_url":"https://api.github.com/users/felixYyu/repos","events_url":"https://api.github.com/users/felixYyu/events{/privacy}","received_events_url":"https://api.github.com/users/felixYyu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-23T14:34:54Z","updated_at":"2022-04-23T14:34:54Z","author_association":"CONTRIBUTOR","body":"cc: @RussellSpitzer Can you take a look if you have time?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107513112/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107514410","html_url":"https://github.com/apache/iceberg/pull/4438#issuecomment-1107514410","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4438","id":1107514410,"node_id":"IC_kwDOCW7NX85CA1Qq","user":{"login":"felixYyu","id":3785228,"node_id":"MDQ6VXNlcjM3ODUyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3785228?v=4","gravatar_id":"","url":"https://api.github.com/users/felixYyu","html_url":"https://github.com/felixYyu","followers_url":"https://api.github.com/users/felixYyu/followers","following_url":"https://api.github.com/users/felixYyu/following{/other_user}","gists_url":"https://api.github.com/users/felixYyu/gists{/gist_id}","starred_url":"https://api.github.com/users/felixYyu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixYyu/subscriptions","organizations_url":"https://api.github.com/users/felixYyu/orgs","repos_url":"https://api.github.com/users/felixYyu/repos","events_url":"https://api.github.com/users/felixYyu/events{/privacy}","received_events_url":"https://api.github.com/users/felixYyu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-23T14:43:49Z","updated_at":"2022-04-23T14:43:49Z","author_association":"CONTRIBUTOR","body":"Can you take a look if have time? @rdblue ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107514410/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107518546","html_url":"https://github.com/apache/iceberg/issues/4618#issuecomment-1107518546","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4618","id":1107518546,"node_id":"IC_kwDOCW7NX85CA2RS","user":{"login":"felixYyu","id":3785228,"node_id":"MDQ6VXNlcjM3ODUyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3785228?v=4","gravatar_id":"","url":"https://api.github.com/users/felixYyu","html_url":"https://github.com/felixYyu","followers_url":"https://api.github.com/users/felixYyu/followers","following_url":"https://api.github.com/users/felixYyu/following{/other_user}","gists_url":"https://api.github.com/users/felixYyu/gists{/gist_id}","starred_url":"https://api.github.com/users/felixYyu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixYyu/subscriptions","organizations_url":"https://api.github.com/users/felixYyu/orgs","repos_url":"https://api.github.com/users/felixYyu/repos","events_url":"https://api.github.com/users/felixYyu/events{/privacy}","received_events_url":"https://api.github.com/users/felixYyu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-23T15:11:22Z","updated_at":"2022-04-23T15:11:22Z","author_association":"CONTRIBUTOR","body":"If you want just do it. @selectbook ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107518546/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107677506","html_url":"https://github.com/apache/iceberg/issues/4615#issuecomment-1107677506","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4615","id":1107677506,"node_id":"IC_kwDOCW7NX85CBdFC","user":{"login":"felixYyu","id":3785228,"node_id":"MDQ6VXNlcjM3ODUyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3785228?v=4","gravatar_id":"","url":"https://api.github.com/users/felixYyu","html_url":"https://github.com/felixYyu","followers_url":"https://api.github.com/users/felixYyu/followers","following_url":"https://api.github.com/users/felixYyu/following{/other_user}","gists_url":"https://api.github.com/users/felixYyu/gists{/gist_id}","starred_url":"https://api.github.com/users/felixYyu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixYyu/subscriptions","organizations_url":"https://api.github.com/users/felixYyu/orgs","repos_url":"https://api.github.com/users/felixYyu/repos","events_url":"https://api.github.com/users/felixYyu/events{/privacy}","received_events_url":"https://api.github.com/users/felixYyu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T01:06:23Z","updated_at":"2022-04-24T03:02:55Z","author_association":"CONTRIBUTOR","body":"you can use the Syntax: `COMMENT ON TABLE my_table IS 'This is my table';`\r\n\r\nother details look here，If there is no problem, please close this issue.\r\nhttps://docs.databricks.com/sql/language-manual/sql-ref-syntax-ddl-comment.html","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107677506/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107688576","html_url":"https://github.com/apache/iceberg/pull/4553#issuecomment-1107688576","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4553","id":1107688576,"node_id":"IC_kwDOCW7NX85CBfyA","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T02:24:05Z","updated_at":"2022-04-24T02:24:05Z","author_association":"MEMBER","body":"There is a broken unit test here:\r\n\r\n```\r\norg.apache.iceberg.flink.TestFlinkTableSource > testFilterPushDownBetween FAILED\r\n    java.lang.AssertionError: Should produce the expected record expected:<[+I[1, iceberg, 10.0], +I[2, b, 20.0]]> but was:<[+I[2, b, 20.0], +I[1, iceberg, 10.0]]>\r\n        at org.junit.Assert.fail(Assert.java:89)\r\n        at org.junit.Assert.failNotEquals(Assert.java:835)\r\n        at org.junit.Assert.assertEquals(Assert.java:120)\r\n        at org.apache.iceberg.flink.TestFlinkTableSource.testFilterPushDownBetween(TestFlinkTableSource.java:496)\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107688576/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107689351","html_url":"https://github.com/apache/iceberg/pull/4553#issuecomment-1107689351","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4553","id":1107689351,"node_id":"IC_kwDOCW7NX85CBf-H","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T02:29:59Z","updated_at":"2022-04-24T02:29:59Z","author_association":"MEMBER","body":"```patch\r\n+    compileOnly \"org.apache.flink:flink-connector-base:${flinkVersion}\"\r\n+    compileOnly \"org.apache.flink:flink-connector-files:${flinkVersion}\"\r\n+    // This should be connectors-base, plus some other things that are needed\r\n+    // compileOnly \"org.apache.flink:flink-connectors:${flinkVersion}\"\r\n```\r\n\r\nAs we've already added the specific children artifactId, so I think the `org.apache.flink:flink-connectors` is not required now.  we can just remove the comments.\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107689351/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107689942","html_url":"https://github.com/apache/iceberg/pull/4553#issuecomment-1107689942","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4553","id":1107689942,"node_id":"IC_kwDOCW7NX85CBgHW","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T02:35:00Z","updated_at":"2022-04-24T02:35:00Z","author_association":"MEMBER","body":"```patch\r\n   @Override\r\n   public ScanRuntimeProvider getScanRuntimeProvider(ScanContext runtimeProviderContext) {\r\n     return new DataStreamScanProvider() {\r\n+\r\n+      // UPDATED - Needs to be added as support for other signature is entirely removed.\r\n+      // TODO -    This should probably be ported to 1.14 as well to make future changes\r\n+      //           easier to backport.\r\n       @Override\r\n-      public DataStream<RowData> produceDataStream(StreamExecutionEnvironment execEnv) {\r\n+      public DataStream<RowData> produceDataStream(\r\n+          ProviderContext providerContext, StreamExecutionEnvironment execEnv) {\r\n         return createDataStream(execEnv);\r\n       }\r\n```\r\n\r\nLet's just open a separate github issue to track this thing,  seems it does not make sense to add backport TODO for flink 1.14 in the flink 1.15 source code.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107689942/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107691611","html_url":"https://github.com/apache/iceberg/pull/4553#issuecomment-1107691611","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4553","id":1107691611,"node_id":"IC_kwDOCW7NX85CBghb","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T02:48:06Z","updated_at":"2022-04-24T02:48:06Z","author_association":"MEMBER","body":"```patch\r\n+    // https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/config/#table-exec-sink-upsert-materialize\r\n+    // UPDATED - Needed to make testChangeLogOnDataKey work.\r\n+    // TODO - Add tests with all configuraiton values as follow up - and possibly remove our own injected shuffle\r\n+    //        as Flink can now do it.\r\n+    getTableEnv().getConfig().set(\"table.exec.sink.upsert-materialize\", \"NONE\");\r\n```\r\n\r\nThis is interesting.  Let's just replace those comments by the following ? \r\n\r\n```\r\n+  // Set the table.exec.sink.upsert-materialize=NONE, so that downstream operators will receive the records with the same orders as the source operator.\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107691611/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107691959","html_url":"https://github.com/apache/iceberg/pull/4553#issuecomment-1107691959","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4553","id":1107691959,"node_id":"IC_kwDOCW7NX85CBgm3","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T02:51:08Z","updated_at":"2022-04-24T02:51:08Z","author_association":"MEMBER","body":"```patch\r\n+      // UPDATED\r\n       AssertHelpers.assertThrows(\"Table should already exists\",\r\n-          ValidationException.class,\r\n+          org.apache.flink.table.api.TableException.class,\r\n           \"Could not execute CreateTable in path\",\r\n           () -> sql(\"CREATE TABLE `default_catalog`.`%s`.`%s`\", databaseName(), TABLE_NAME));\r\n```\r\n\r\nThe `UPDATED` comments seems can be removed now.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107691959/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107692125","html_url":"https://github.com/apache/iceberg/pull/4553#issuecomment-1107692125","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4553","id":1107692125,"node_id":"IC_kwDOCW7NX85CBgpd","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T02:52:45Z","updated_at":"2022-04-24T02:52:45Z","author_association":"MEMBER","body":"```patch\r\ndiff --git a/v1.14/flink/src/test/java/org/apache/iceberg/flink/source/BoundedTableFactory.java b/v1.15/flink/src/test/java/org/apache/iceberg/flink/source/BoundedTableFactory.java\r\nindex b0041c3bc..d73363395 100644\r\n--- a/v1.14/flink/src/test/java/org/apache/iceberg/flink/source/BoundedTableFactory.java\r\n+++ b/v1.15/flink/src/test/java/org/apache/iceberg/flink/source/BoundedTableFactory.java\r\n@@ -34,6 +34,7 @@ import org.apache.flink.streaming.api.environment.StreamExecutionEnvironment;\r\n import org.apache.flink.streaming.api.functions.source.SourceFunction;\r\n import org.apache.flink.table.api.TableSchema;\r\n import org.apache.flink.table.connector.ChangelogMode;\r\n+import org.apache.flink.table.connector.ProviderContext;\r\n import org.apache.flink.table.connector.source.DataStreamScanProvider;\r\n import org.apache.flink.table.connector.source.DynamicTableSource;\r\n import org.apache.flink.table.connector.source.ScanTableSource;\r\n@@ -133,8 +134,10 @@ public class BoundedTableFactory implements DynamicTableSourceFactory {\r\n     @Override\r\n     public ScanRuntimeProvider getScanRuntimeProvider(ScanContext runtimeProviderContext) {\r\n       return new DataStreamScanProvider() {\r\n+        // UPDATED\r\n         @Override\r\n-        public DataStream<RowData> produceDataStream(StreamExecutionEnvironment env) {\r\n+        public DataStream<RowData> produceDataStream(\r\n+            ProviderContext providerContext, StreamExecutionEnvironment env) {\r\n           boolean checkpointEnabled = env.getCheckpointConfig().isCheckpointingEnabled();\r\n           SourceFunction<Row> source = new BoundedTestSource<>(elementsPerCheckpoint, checkpointEnabled);\r\n```\r\n\r\nDitto.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107692125/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107693321","html_url":"https://github.com/apache/iceberg/pull/4553#issuecomment-1107693321","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4553","id":1107693321,"node_id":"IC_kwDOCW7NX85CBg8J","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T03:00:10Z","updated_at":"2022-04-24T03:00:10Z","author_association":"MEMBER","body":"The PR looks good to me overall except the above comments, thanks @kbendick for the nice work !","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107693321/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107710089","html_url":"https://github.com/apache/iceberg/issues/4621#issuecomment-1107710089","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4621","id":1107710089,"node_id":"IC_kwDOCW7NX85CBlCJ","user":{"login":"Reo-LEI","id":17312872,"node_id":"MDQ6VXNlcjE3MzEyODcy","avatar_url":"https://avatars.githubusercontent.com/u/17312872?v=4","gravatar_id":"","url":"https://api.github.com/users/Reo-LEI","html_url":"https://github.com/Reo-LEI","followers_url":"https://api.github.com/users/Reo-LEI/followers","following_url":"https://api.github.com/users/Reo-LEI/following{/other_user}","gists_url":"https://api.github.com/users/Reo-LEI/gists{/gist_id}","starred_url":"https://api.github.com/users/Reo-LEI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Reo-LEI/subscriptions","organizations_url":"https://api.github.com/users/Reo-LEI/orgs","repos_url":"https://api.github.com/users/Reo-LEI/repos","events_url":"https://api.github.com/users/Reo-LEI/events{/privacy}","received_events_url":"https://api.github.com/users/Reo-LEI/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T04:58:25Z","updated_at":"2022-04-24T04:58:25Z","author_association":"CONTRIBUTOR","body":"I worked with Hang(@hangc0276 ) before to help Pulsar store cold data using Iceberg. As Hang mentioned above, Pulsar needs to read the data which are stored in Iceberg in the order of writting.\r\n\r\nBut because the Iceberg writer will split the data file according to the number of records and file size, and Iceberg reads the data concurrently according to the file granularity. This results in that even if the upstream distributes the records with the same key to the same writer and writes them in the order of events, the data cannot be guaranteed to be read in the order of writing when reading (for example, in a snapshot, writer-1 write the data to dataFile-1 and dataFile-2 in the order of events, and the events in dataFile-2 all occur later than those in dataFile-1. However, due to concurrent reading of records, the records in dataFile-2 may be read first than the records in dataFile-1).\r\n\r\nNot only in this case of Pulsar, but also in Flink to implement stream reading of complete changlog(+I/-U/+U/-D), records need to be read in the order of writing. So I think it is necessary for Iceberg to support the ability to read records in the order they were written.\r\n\r\n@rdblue @aokolnychyi @RussellSpitzer @kbendick @flyrain @jackye1995 @stevenzwu @openinx ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107710089/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107750395","html_url":"https://github.com/apache/iceberg/issues/4621#issuecomment-1107750395","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4621","id":1107750395,"node_id":"IC_kwDOCW7NX85CBu37","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T06:29:13Z","updated_at":"2022-04-24T06:29:13Z","author_association":"MEMBER","body":"> However, we found current Iceberg Java reader implementation doesn't support read records by order or doesn't support order by operation on reading.\r\n\r\nIt sounds like the pulsar reader hope the apache iceberg reader guarantee the record-level writing order semantic.  As far as I know,  the table format based on DFS files is hard to maintain the record-level  order semantic. Currently, the iceberg table format was optimized for batch analysis readers,  not for a message queue consumer.\r\n\r\nI think @rdblue and @RussellSpitzer had discussed the approach about dual writing the iceberg table format and message queue, for downstream reader to consume the records with the writing order,  but I don't see a public discussion or design document to describe the details. Maybe they can provide more input about this issue.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107750395/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107756484","html_url":"https://github.com/apache/iceberg/issues/4621#issuecomment-1107756484","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4621","id":1107756484,"node_id":"IC_kwDOCW7NX85CBwXE","user":{"login":"hangc0276","id":5436568,"node_id":"MDQ6VXNlcjU0MzY1Njg=","avatar_url":"https://avatars.githubusercontent.com/u/5436568?v=4","gravatar_id":"","url":"https://api.github.com/users/hangc0276","html_url":"https://github.com/hangc0276","followers_url":"https://api.github.com/users/hangc0276/followers","following_url":"https://api.github.com/users/hangc0276/following{/other_user}","gists_url":"https://api.github.com/users/hangc0276/gists{/gist_id}","starred_url":"https://api.github.com/users/hangc0276/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hangc0276/subscriptions","organizations_url":"https://api.github.com/users/hangc0276/orgs","repos_url":"https://api.github.com/users/hangc0276/repos","events_url":"https://api.github.com/users/hangc0276/events{/privacy}","received_events_url":"https://api.github.com/users/hangc0276/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T06:37:41Z","updated_at":"2022-04-24T06:37:41Z","author_association":"CONTRIBUTOR","body":"> > However, we found current Iceberg Java reader implementation doesn't support read records by order or doesn't support order by operation on reading.\r\n> \r\n> It sounds like the pulsar reader hope the apache iceberg reader guarantee the record-level writing order semantic. As far as I know, the table format based on DFS files is hard to maintain the record-level order semantic. Currently, the iceberg table format was optimized for batch analysis readers, not for a message queue consumer.\r\n> \r\n> I think @rdblue and @RussellSpitzer had discussed the approach about dual writing the iceberg table format and message queue, for downstream reader to consume the records with the writing order, but I don't see a public discussion or design document to describe the details. Maybe they can provide more input about this issue.\r\n\r\n@openinx  Thanks for your quick reply. Looking forward Iceberg community to discuss and support this feature.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107756484/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107777980","html_url":"https://github.com/apache/iceberg/pull/4537#issuecomment-1107777980","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4537","id":1107777980,"node_id":"IC_kwDOCW7NX85CB1m8","user":{"login":"ggershinsky","id":12033212,"node_id":"MDQ6VXNlcjEyMDMzMjEy","avatar_url":"https://avatars.githubusercontent.com/u/12033212?v=4","gravatar_id":"","url":"https://api.github.com/users/ggershinsky","html_url":"https://github.com/ggershinsky","followers_url":"https://api.github.com/users/ggershinsky/followers","following_url":"https://api.github.com/users/ggershinsky/following{/other_user}","gists_url":"https://api.github.com/users/ggershinsky/gists{/gist_id}","starred_url":"https://api.github.com/users/ggershinsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ggershinsky/subscriptions","organizations_url":"https://api.github.com/users/ggershinsky/orgs","repos_url":"https://api.github.com/users/ggershinsky/repos","events_url":"https://api.github.com/users/ggershinsky/events{/privacy}","received_events_url":"https://api.github.com/users/ggershinsky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T07:18:03Z","updated_at":"2022-04-24T07:18:03Z","author_association":"CONTRIBUTOR","body":"> CC: @ggershinsky Could you take a look at this as well I'm not sure how we fit this into our current encryption plans since we are compressing blob blocks within this file seperately we would end up with issues if we encrypted the entire file. Is there an easy way we can compress/encrypt the blobs inside the index files?\r\n\r\nCertainly, will do","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107777980/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107805532","html_url":"https://github.com/apache/iceberg/pull/3975#issuecomment-1107805532","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3975","id":1107805532,"node_id":"IC_kwDOCW7NX85CB8Vc","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T09:50:43Z","updated_at":"2022-04-24T09:50:43Z","author_association":"MEMBER","body":"Okay, let me take a look.  Thanks for pinging me ! ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107805532/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107872171","html_url":"https://github.com/apache/iceberg/pull/4466#issuecomment-1107872171","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4466","id":1107872171,"node_id":"IC_kwDOCW7NX85CCMmr","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T16:16:47Z","updated_at":"2022-04-24T16:16:47Z","author_association":"CONTRIBUTOR","body":"Thanks for finding the problem, @samredai. I think the solution to remove `__init__` makes sense. Thanks for implementing that change, @CircArgs!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107872171/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107887040","html_url":"https://github.com/apache/iceberg/pull/4518#issuecomment-1107887040","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4518","id":1107887040,"node_id":"IC_kwDOCW7NX85CCQPA","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T17:48:37Z","updated_at":"2022-04-24T17:48:37Z","author_association":"CONTRIBUTOR","body":"@rizaon, there are a couple of PRs that should help you with this. #4608 adds `IOUtil.readFully` and `IOUtil.readRemaining` that you can use to fill buffers from an input stream. I've also opened #4623 to add the `ByteBufferInputStream` classes I was talking about. Those should allow you to easily split the data across several small allocations and wrap them in an `InputStream` implementation.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107887040/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107888126","html_url":"https://github.com/apache/iceberg/pull/4466#issuecomment-1107888126","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4466","id":1107888126,"node_id":"IC_kwDOCW7NX85CCQf-","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T17:55:58Z","updated_at":"2022-04-24T17:55:58Z","author_association":"CONTRIBUTOR","body":"Thanks, @CircArgs!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107888126/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107889476","html_url":"https://github.com/apache/iceberg/pull/4619#issuecomment-1107889476","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4619","id":1107889476,"node_id":"IC_kwDOCW7NX85CCQ1E","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T18:03:46Z","updated_at":"2022-04-24T18:03:46Z","author_association":"CONTRIBUTOR","body":"Can you rebase this? Looks like there are conflicts.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107889476/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107896918","html_url":"https://github.com/apache/iceberg/pull/4308#issuecomment-1107896918","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4308","id":1107896918,"node_id":"IC_kwDOCW7NX85CCSpW","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T18:51:34Z","updated_at":"2022-04-24T18:52:14Z","author_association":"CONTRIBUTOR","body":"I've not been able to comment on the doc since it isn't opened up for discussion. I'll add a few of the comments here instead.\r\n\r\nMy main concern about the proposed JSON format is that it is needlessly verbose and relies heavily on the JVM classes rather than representing the expressions more directly. For example, it is scoped to only unbound expressions, but still uses \"unbound-predicate\" and \"named-reference\". It also uses \"left-operand\" and \"right-operand\". I think it would be better to use fewer words and make better use of \"type\".\r\n\r\nEach node in the expression tree should be represented as a JSON object. Those are distinguished by the `type` field: that can have the following values: `and`, `or`, `not`, `eq`, `not-eq`, `in`, `not-in`, `lt`, `lt-eq`, `gt`, `gt-eq`, `starts-with`, `not-starts-with`, `is-null`, `not-null`, `is-nan`, `not-nan`, `reference`, `transform`, and `literal`.\r\n\r\nThen there is some specialization by `type`:\r\n\r\n* `and` and `or` must have child expressions named  `left` and `right`\r\n* `not` must have a child expression named `child`\r\n* All predicates must have a `term` expression that is either a `transform` or a `reference`\r\n* `transform` must have a `term` expression that is either a `transform` or a `reference` and a `transform` field that is a transform string (\"identity\", \"bucket[16]\", etc.)\r\n* Set predicates (`in` and `not-in`) must have a JSON array called `values` of literals\r\n* Comparison predicates (`eq`, etc.) must have a `value` that is a literal\r\n* `reference` must have a `name` that is a JSON string\r\n* `literal` must have a `value` field\r\n* Literal values must use the JSON value serialization defined in #4301 (structs, lists, and maps are not allowed)\r\n\r\nI would also allow the reference to be replaced with a string field name, and a literal to be replaced with the value when nested.\r\n\r\nI think this format is more direct:\r\n\r\n```json\r\n# example 1: event_ts = 2022-04-24T11:42:12.578391 OR bucket(16, id) IN (0, 1)\r\n{\r\n  \"type\": \"or\",\r\n  \"left\": {\r\n    \"type\": \"eq\",\r\n    \"term\": \"event_ts\", # equivalent to { \"type\": \"reference\", \"name\": \"event_ts\" }\r\n    \"value\": \"2022-04-24T11:42:12.578391\" # equivalent to { \"type\": \"literal\", \"value\": \"2022-04-24T11:42:12.578391\" }\r\n  }\r\n  \"right\": {\r\n    \"type\": \"in\"\r\n    \"term\": {\r\n      \"type\": \"transform\",\r\n      \"transform\": \"bucket[16]\",\r\n      \"term\": \"id\"\r\n    },\r\n    \"values\": [\r\n      { \"type\": \"literal\", \"value\": 0 },\r\n      1\r\n    ]\r\n  }\r\n}\r\n```\r\n```json\r\n# example 2: true\r\n{ \"type\": \"literal\", \"value\": true }\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107896918/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107911967","html_url":"https://github.com/apache/iceberg/pull/4301#issuecomment-1107911967","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4301","id":1107911967,"node_id":"IC_kwDOCW7NX85CCWUf","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T20:23:02Z","updated_at":"2022-04-24T20:23:02Z","author_association":"CONTRIBUTOR","body":"@rzhang10, @wmoustafa, @RussellSpitzer: I've updated this and I think it's about ready to commit. Can you take a quick look to make sure it looks alright?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107911967/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107912221","html_url":"https://github.com/apache/iceberg/pull/4301#issuecomment-1107912221","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4301","id":1107912221,"node_id":"IC_kwDOCW7NX85CCWYd","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T20:24:58Z","updated_at":"2022-04-24T20:24:58Z","author_association":"CONTRIBUTOR","body":"@sgcowell, version 2 is released and adopted, so these changes must go in v3. We will support these with a compatibility flag until then so you can opt into using them in v2 with known risks. I've documented the incompatibilities Appendix E that describes version changes.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107912221/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107915355","html_url":"https://github.com/apache/iceberg/issues/4356#issuecomment-1107915355","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4356","id":1107915355,"node_id":"IC_kwDOCW7NX85CCXJb","user":{"login":"Andre9580","id":34575854,"node_id":"MDQ6VXNlcjM0NTc1ODU0","avatar_url":"https://avatars.githubusercontent.com/u/34575854?v=4","gravatar_id":"","url":"https://api.github.com/users/Andre9580","html_url":"https://github.com/Andre9580","followers_url":"https://api.github.com/users/Andre9580/followers","following_url":"https://api.github.com/users/Andre9580/following{/other_user}","gists_url":"https://api.github.com/users/Andre9580/gists{/gist_id}","starred_url":"https://api.github.com/users/Andre9580/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Andre9580/subscriptions","organizations_url":"https://api.github.com/users/Andre9580/orgs","repos_url":"https://api.github.com/users/Andre9580/repos","events_url":"https://api.github.com/users/Andre9580/events{/privacy}","received_events_url":"https://api.github.com/users/Andre9580/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T20:46:03Z","updated_at":"2022-04-24T20:46:03Z","author_association":"CONTRIBUTOR","body":"Hi @szehon-ho, are you suggesting to update the code this way?\r\n\r\n```\r\n@Override\r\n  public void deleteWhere(Filter[] filters) {\r\n    Expression deleteExpr = SparkFilters.convert(filters);\r\n\r\n    if (deleteExpr == Expressions.alwaysFalse()) {\r\n      LOG.info(\"Skipping the delete operation as the condition is always false\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      icebergTable.newDelete()\r\n          .set(\"spark.app.id\", sparkSession().sparkContext().applicationId())\r\n          .deleteFromRowFilter(deleteExpr)\r\n          .commit();\r\n    } catch (ValidationException e) {\r\n      throw new ValidationException(e, \"Failed to cleanly delete data files matching: %s\", deleteExpr);\r\n    }\r\n  }\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107915355/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107915904","html_url":"https://github.com/apache/iceberg/pull/4503#issuecomment-1107915904","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4503","id":1107915904,"node_id":"IC_kwDOCW7NX85CCXSA","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T20:49:44Z","updated_at":"2022-04-24T20:49:44Z","author_association":"CONTRIBUTOR","body":"This looks great. Thanks for adding this, @bijanhoule!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107915904/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107926596","html_url":"https://github.com/apache/iceberg/pull/4617#issuecomment-1107926596","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4617","id":1107926596,"node_id":"IC_kwDOCW7NX85CCZ5E","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T22:03:28Z","updated_at":"2022-04-24T22:03:28Z","author_association":"CONTRIBUTOR","body":"Thanks, @tal66!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107926596/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107927098","html_url":"https://github.com/apache/iceberg/pull/4619#issuecomment-1107927098","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4619","id":1107927098,"node_id":"IC_kwDOCW7NX85CCaA6","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T22:07:18Z","updated_at":"2022-04-24T22:07:18Z","author_association":"CONTRIBUTOR","body":"Thanks, @samredai!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107927098/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107928115","html_url":"https://github.com/apache/iceberg/pull/4599#issuecomment-1107928115","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4599","id":1107928115,"node_id":"IC_kwDOCW7NX85CCaQz","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T22:13:49Z","updated_at":"2022-04-24T22:13:49Z","author_association":"CONTRIBUTOR","body":"@shardulm94 can you take a look at this?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107928115/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107928452","html_url":"https://github.com/apache/iceberg/pull/4602#issuecomment-1107928452","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4602","id":1107928452,"node_id":"IC_kwDOCW7NX85CCaWE","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T22:15:31Z","updated_at":"2022-04-24T22:15:31Z","author_association":"CONTRIBUTOR","body":"@felixYyu, I was asking for you to describe the problem and the proposed solution that you've implemented here. I don't see much information about the solution you propose. Could you include that please?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107928452/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107929025","html_url":"https://github.com/apache/iceberg/pull/4596#issuecomment-1107929025","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4596","id":1107929025,"node_id":"IC_kwDOCW7NX85CCafB","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T22:19:03Z","updated_at":"2022-04-24T22:19:03Z","author_association":"CONTRIBUTOR","body":"@uncleGen, what is the average file size in the table, the average number of files per manifest, and how many files is your scan producing? Is there anything consuming from the concurrent queue? This seems odd to me since the parallel iterator is self-limiting. When nothing is consuming from the queue, new tasks won't be submitted.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107929025/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107934502","html_url":"https://github.com/apache/iceberg/pull/4590#issuecomment-1107934502","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4590","id":1107934502,"node_id":"IC_kwDOCW7NX85CCb0m","user":{"login":"dramaticlly","id":5961173,"node_id":"MDQ6VXNlcjU5NjExNzM=","avatar_url":"https://avatars.githubusercontent.com/u/5961173?v=4","gravatar_id":"","url":"https://api.github.com/users/dramaticlly","html_url":"https://github.com/dramaticlly","followers_url":"https://api.github.com/users/dramaticlly/followers","following_url":"https://api.github.com/users/dramaticlly/following{/other_user}","gists_url":"https://api.github.com/users/dramaticlly/gists{/gist_id}","starred_url":"https://api.github.com/users/dramaticlly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dramaticlly/subscriptions","organizations_url":"https://api.github.com/users/dramaticlly/orgs","repos_url":"https://api.github.com/users/dramaticlly/repos","events_url":"https://api.github.com/users/dramaticlly/events{/privacy}","received_events_url":"https://api.github.com/users/dramaticlly/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-24T22:58:08Z","updated_at":"2022-04-24T22:58:08Z","author_association":"CONTRIBUTOR","body":"@rdblue  and @samredai updated to address review feedback, appreciate another look :)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107934502/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107980643","html_url":"https://github.com/apache/iceberg/pull/4546#issuecomment-1107980643","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4546","id":1107980643,"node_id":"IC_kwDOCW7NX85CCnFj","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T01:50:51Z","updated_at":"2022-04-25T01:50:51Z","author_association":"CONTRIBUTOR","body":"> Optional: Maybe we can add a test, about schema being too big to serialize, like snapshotSummary test\r\n\r\nMade the change","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1107980643/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108043370","html_url":"https://github.com/apache/iceberg/pull/4606#issuecomment-1108043370","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4606","id":1108043370,"node_id":"IC_kwDOCW7NX85CC2Zq","user":{"login":"kyle-cx91","id":10529123,"node_id":"MDQ6VXNlcjEwNTI5MTIz","avatar_url":"https://avatars.githubusercontent.com/u/10529123?v=4","gravatar_id":"","url":"https://api.github.com/users/kyle-cx91","html_url":"https://github.com/kyle-cx91","followers_url":"https://api.github.com/users/kyle-cx91/followers","following_url":"https://api.github.com/users/kyle-cx91/following{/other_user}","gists_url":"https://api.github.com/users/kyle-cx91/gists{/gist_id}","starred_url":"https://api.github.com/users/kyle-cx91/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kyle-cx91/subscriptions","organizations_url":"https://api.github.com/users/kyle-cx91/orgs","repos_url":"https://api.github.com/users/kyle-cx91/repos","events_url":"https://api.github.com/users/kyle-cx91/events{/privacy}","received_events_url":"https://api.github.com/users/kyle-cx91/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T03:44:35Z","updated_at":"2022-04-25T03:44:35Z","author_association":"CONTRIBUTOR","body":"@rdblue thx for the guide, and here is what it looks like now\r\n\r\n<img width=\"912\" alt=\"image\" src=\"https://user-images.githubusercontent.com/10529123/165017240-90e6b8ac-b687-46a1-adb9-afaf68401b88.png\">\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108043370/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108044334","html_url":"https://github.com/apache/iceberg/pull/4602#issuecomment-1108044334","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4602","id":1108044334,"node_id":"IC_kwDOCW7NX85CC2ou","user":{"login":"felixYyu","id":3785228,"node_id":"MDQ6VXNlcjM3ODUyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3785228?v=4","gravatar_id":"","url":"https://api.github.com/users/felixYyu","html_url":"https://github.com/felixYyu","followers_url":"https://api.github.com/users/felixYyu/followers","following_url":"https://api.github.com/users/felixYyu/following{/other_user}","gists_url":"https://api.github.com/users/felixYyu/gists{/gist_id}","starred_url":"https://api.github.com/users/felixYyu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixYyu/subscriptions","organizations_url":"https://api.github.com/users/felixYyu/orgs","repos_url":"https://api.github.com/users/felixYyu/repos","events_url":"https://api.github.com/users/felixYyu/events{/privacy}","received_events_url":"https://api.github.com/users/felixYyu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T03:46:48Z","updated_at":"2022-04-25T03:46:48Z","author_association":"CONTRIBUTOR","body":"@rdblue The description of the solution has been updated, Could you review that again please?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108044334/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108045445","html_url":"https://github.com/apache/iceberg/pull/4625#issuecomment-1108045445","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4625","id":1108045445,"node_id":"IC_kwDOCW7NX85CC26F","user":{"login":"wuwenchi","id":19755729,"node_id":"MDQ6VXNlcjE5NzU1NzI5","avatar_url":"https://avatars.githubusercontent.com/u/19755729?v=4","gravatar_id":"","url":"https://api.github.com/users/wuwenchi","html_url":"https://github.com/wuwenchi","followers_url":"https://api.github.com/users/wuwenchi/followers","following_url":"https://api.github.com/users/wuwenchi/following{/other_user}","gists_url":"https://api.github.com/users/wuwenchi/gists{/gist_id}","starred_url":"https://api.github.com/users/wuwenchi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuwenchi/subscriptions","organizations_url":"https://api.github.com/users/wuwenchi/orgs","repos_url":"https://api.github.com/users/wuwenchi/repos","events_url":"https://api.github.com/users/wuwenchi/events{/privacy}","received_events_url":"https://api.github.com/users/wuwenchi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T03:49:49Z","updated_at":"2022-05-02T03:50:46Z","author_association":"CONTRIBUTOR","body":"relevant pr: #2265, #3681 \r\nCould you help review it? Thanks!   @openinx  @rdblue  @hameizi   @zhangjun0x01  @stevenzwu  ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108045445/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108124296","html_url":"https://github.com/apache/iceberg/pull/4596#issuecomment-1108124296","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4596","id":1108124296,"node_id":"IC_kwDOCW7NX85CDKKI","user":{"login":"uncleGen","id":7402327,"node_id":"MDQ6VXNlcjc0MDIzMjc=","avatar_url":"https://avatars.githubusercontent.com/u/7402327?v=4","gravatar_id":"","url":"https://api.github.com/users/uncleGen","html_url":"https://github.com/uncleGen","followers_url":"https://api.github.com/users/uncleGen/followers","following_url":"https://api.github.com/users/uncleGen/following{/other_user}","gists_url":"https://api.github.com/users/uncleGen/gists{/gist_id}","starred_url":"https://api.github.com/users/uncleGen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/uncleGen/subscriptions","organizations_url":"https://api.github.com/users/uncleGen/orgs","repos_url":"https://api.github.com/users/uncleGen/repos","events_url":"https://api.github.com/users/uncleGen/events{/privacy}","received_events_url":"https://api.github.com/users/uncleGen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T06:22:19Z","updated_at":"2022-04-25T06:22:44Z","author_association":"CONTRIBUTOR","body":"@rdblue `ParallelIterator ` use `ConcurrentLinkedQueue`, and it is an un-bouned queue. Sorry, could you please make me clear why the parallel iterator is self-limiting? FYI, the average file size in the table is ~ 1MB, and there are hundreds of thousands of datafiles in my scan. Following is a JVM heap snapshot:\r\n\r\n<img width=\"819\" alt=\"image\" src=\"https://user-images.githubusercontent.com/7402327/165031548-de9fc13f-764b-449d-af1c-585a8b4e296d.png\">\r\n<img width=\"731\" alt=\"image\" src=\"https://user-images.githubusercontent.com/7402327/165031565-978ab449-8904-451e-b7cf-1c472a35dc18.png\">\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108124296/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108186314","html_url":"https://github.com/apache/iceberg/issues/4621#issuecomment-1108186314","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4621","id":1108186314,"node_id":"IC_kwDOCW7NX85CDZTK","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T07:35:18Z","updated_at":"2022-04-25T07:35:18Z","author_association":"CONTRIBUTOR","body":"In terms of order granularity, here are 3 of them\r\n1. snapshot level, it is there already.\r\n2. file level, not in the current table spec. I assume it is what you want for this feature request, please confirm.\r\n3. row level, not in the current table spec, I'm not even sure it is something worth to pursue.\r\n\r\nWe can discuss it in the community sync. Feel free to add it to the agenda. I’d suggest a proposal for this before that. It may present a rough idea, or multiple ideas. It may address some concerns like how it work with the current data file compaction. A data file compaction may break the order between multiple data files.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108186314/reactions","total_count":3,"+1":1,"-1":0,"laugh":0,"hooray":2,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108384805","html_url":"https://github.com/apache/iceberg/pull/3432#issuecomment-1108384805","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3432","id":1108384805,"node_id":"IC_kwDOCW7NX85CEJwl","user":{"login":"ajantha-bhat","id":5889404,"node_id":"MDQ6VXNlcjU4ODk0MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/5889404?v=4","gravatar_id":"","url":"https://api.github.com/users/ajantha-bhat","html_url":"https://github.com/ajantha-bhat","followers_url":"https://api.github.com/users/ajantha-bhat/followers","following_url":"https://api.github.com/users/ajantha-bhat/following{/other_user}","gists_url":"https://api.github.com/users/ajantha-bhat/gists{/gist_id}","starred_url":"https://api.github.com/users/ajantha-bhat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajantha-bhat/subscriptions","organizations_url":"https://api.github.com/users/ajantha-bhat/orgs","repos_url":"https://api.github.com/users/ajantha-bhat/repos","events_url":"https://api.github.com/users/ajantha-bhat/events{/privacy}","received_events_url":"https://api.github.com/users/ajantha-bhat/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T10:26:11Z","updated_at":"2022-04-25T10:26:11Z","author_association":"MEMBER","body":"@jackye1995 : I think this PR is very useful in clearing FAQ about copy-on-write vs merge-on-read.\r\nI would very much like this to get it merged.\r\n\r\nDo you have bandwidth to work on this? If not, I can take it forward and keep you as a co-author. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108384805/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108572780","html_url":"https://github.com/apache/iceberg/issues/3044#issuecomment-1108572780","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3044","id":1108572780,"node_id":"IC_kwDOCW7NX85CE3ps","user":{"login":"n00j","id":105021,"node_id":"MDQ6VXNlcjEwNTAyMQ==","avatar_url":"https://avatars.githubusercontent.com/u/105021?v=4","gravatar_id":"","url":"https://api.github.com/users/n00j","html_url":"https://github.com/n00j","followers_url":"https://api.github.com/users/n00j/followers","following_url":"https://api.github.com/users/n00j/following{/other_user}","gists_url":"https://api.github.com/users/n00j/gists{/gist_id}","starred_url":"https://api.github.com/users/n00j/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/n00j/subscriptions","organizations_url":"https://api.github.com/users/n00j/orgs","repos_url":"https://api.github.com/users/n00j/repos","events_url":"https://api.github.com/users/n00j/events{/privacy}","received_events_url":"https://api.github.com/users/n00j/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T13:27:22Z","updated_at":"2022-04-25T13:28:18Z","author_association":"NONE","body":"Having this same issue while trying to use an iceberg table in flink along with jdbccatalog implementation and s3fileio. Is there a working workaround that we can config in code? ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108572780/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108679988","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1108679988","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1108679988,"node_id":"IC_kwDOCW7NX85CFR00","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T14:52:50Z","updated_at":"2022-04-25T14:52:50Z","author_association":"MEMBER","body":"You should only be including the Spark-Runtime jar and in particular this version icberg-spark-runtime-3.1\r\n\r\nhttps://mvnrepository.com/artifact/org.apache.iceberg/iceberg-spark-runtime-3.1_2.12/0.13.1\r\n\r\nThen if you are launching your application via Spark-Submit or something like that you must include this jar as a runtime dependency either with --packages or by bundling it into your application code.\r\n\r\nhttps://iceberg.apache.org/docs/latest/getting-started/#using-iceberg-in-spark-3\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108679988/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108698816","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1108698816","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1108698816,"node_id":"IC_kwDOCW7NX85CFWbA","user":{"login":"scaladevspark","id":101802776,"node_id":"U_kgDOBhFjGA","avatar_url":"https://avatars.githubusercontent.com/u/101802776?v=4","gravatar_id":"","url":"https://api.github.com/users/scaladevspark","html_url":"https://github.com/scaladevspark","followers_url":"https://api.github.com/users/scaladevspark/followers","following_url":"https://api.github.com/users/scaladevspark/following{/other_user}","gists_url":"https://api.github.com/users/scaladevspark/gists{/gist_id}","starred_url":"https://api.github.com/users/scaladevspark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scaladevspark/subscriptions","organizations_url":"https://api.github.com/users/scaladevspark/orgs","repos_url":"https://api.github.com/users/scaladevspark/repos","events_url":"https://api.github.com/users/scaladevspark/events{/privacy}","received_events_url":"https://api.github.com/users/scaladevspark/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T15:07:47Z","updated_at":"2022-04-25T15:07:47Z","author_association":"NONE","body":"@RussellSpitzer thanks, used only   , \"org.apache.iceberg\" % \"iceberg-spark-runtime-3.1_2.12\" % \"0.13.1\", but getting another error bellow - are there any other jars required?\r\n\r\njava.lang.ClassNotFoundException: Failed to find data source: iceberg. Please find packages at http://spark.apache.org/third-party-projects.html\r\n\tat org.apache.spark.sql.execution.datasources.DataSource$.lookupDataSource(DataSource.scala:689)\r\n\tat org.apache.spark.sql.execution.datasources.DataSource$.lookupDataSourceV2(DataSource.scala:743)\r\n\tat org.apache.spark.sql.DataFrameWriter.lookupV2Provider(DataFrameWriter.scala:993)\r\n\tat org.apache.spark.sql.DataFrameWriter.saveAsTable(DataFrameWriter.scala:615)\r\n\tat pipelines.EbmL1ToL2$.processAndOutputSessionInfo$1(EbmL1ToL2.scala:148)\r\n\tat pipelines.EbmL1ToL2$.$anonfun$apply$1(EbmL1ToL2.scala:89)\r\n\tat pipelines.EbmL1ToL2$.$anonfun$apply$1$adapted(EbmL1ToL2.scala:89)\r\n\tat org.apache.spark.sql.execution.streaming.sources.ForeachBatchSink.addBatch(ForeachBatchSink.scala:35)\r\n\tat org.apache.spark.sql.execution.streaming.MicroBatchExecution.$anonfun$runBatch$16(MicroBatchExecution.scala:586)\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108698816/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108706179","html_url":"https://github.com/apache/iceberg/issues/4621#issuecomment-1108706179","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4621","id":1108706179,"node_id":"IC_kwDOCW7NX85CFYOD","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T15:13:40Z","updated_at":"2022-04-25T15:13:40Z","author_association":"MEMBER","body":"As @openinx says, Iceberg doesn't inherently have an ordering in its generic readers since these are not meant to be a full featured reader. In general, most engines like Spark or Trino are implementing that sort of sorting and ordering because in a generic case such ordering requires a full shuffling of the records as written. While you could write a table with a column that specified the insert ordering, reading with that ordering would be the responsibility of the reading implementation. \r\n\r\nFor a specific table only written and read by pulsar you could probably guarantee a certain ordering for all reading but this wouldn't be possible for a generic table. A generic Iceberg table only sees ordering at a snapshot level as @flyrain stated and within that snapshot all rows are considered to have come into existence at the same point in time.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108706179/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108707523","html_url":"https://github.com/apache/iceberg/pull/4590#issuecomment-1108707523","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4590","id":1108707523,"node_id":"IC_kwDOCW7NX85CFYjD","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T15:14:44Z","updated_at":"2022-04-25T15:14:44Z","author_association":"CONTRIBUTOR","body":"Looks great. Thanks, @dramaticlly!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108707523/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108707728","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1108707728","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1108707728,"node_id":"IC_kwDOCW7NX85CFYmQ","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T15:14:53Z","updated_at":"2022-04-25T15:14:53Z","author_association":"MEMBER","body":"Did you include --packages at runtime? Or include the jar in a your application with a FatJar pluigin?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108707728/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108709363","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1108709363","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1108709363,"node_id":"IC_kwDOCW7NX85CFY_z","user":{"login":"scaladevspark","id":101802776,"node_id":"U_kgDOBhFjGA","avatar_url":"https://avatars.githubusercontent.com/u/101802776?v=4","gravatar_id":"","url":"https://api.github.com/users/scaladevspark","html_url":"https://github.com/scaladevspark","followers_url":"https://api.github.com/users/scaladevspark/followers","following_url":"https://api.github.com/users/scaladevspark/following{/other_user}","gists_url":"https://api.github.com/users/scaladevspark/gists{/gist_id}","starred_url":"https://api.github.com/users/scaladevspark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scaladevspark/subscriptions","organizations_url":"https://api.github.com/users/scaladevspark/orgs","repos_url":"https://api.github.com/users/scaladevspark/repos","events_url":"https://api.github.com/users/scaladevspark/events{/privacy}","received_events_url":"https://api.github.com/users/scaladevspark/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T15:16:17Z","updated_at":"2022-04-25T15:16:17Z","author_association":"NONE","body":"yeah, it is a fatjar via sbt assembly.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108709363/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108713385","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1108713385","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1108713385,"node_id":"IC_kwDOCW7NX85CFZ-p","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T15:19:27Z","updated_at":"2022-04-25T15:19:27Z","author_association":"MEMBER","body":"If you are running scala, try printing this out\r\n```scala\r\nprintln(classOf[org.apache.iceberg.spark.source.IcebergSource])\r\n```\r\nIt that throws an error your jar is not shaded correctly","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108713385/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108728049","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1108728049","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1108728049,"node_id":"IC_kwDOCW7NX85CFdjx","user":{"login":"scaladevspark","id":101802776,"node_id":"U_kgDOBhFjGA","avatar_url":"https://avatars.githubusercontent.com/u/101802776?v=4","gravatar_id":"","url":"https://api.github.com/users/scaladevspark","html_url":"https://github.com/scaladevspark","followers_url":"https://api.github.com/users/scaladevspark/followers","following_url":"https://api.github.com/users/scaladevspark/following{/other_user}","gists_url":"https://api.github.com/users/scaladevspark/gists{/gist_id}","starred_url":"https://api.github.com/users/scaladevspark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scaladevspark/subscriptions","organizations_url":"https://api.github.com/users/scaladevspark/orgs","repos_url":"https://api.github.com/users/scaladevspark/repos","events_url":"https://api.github.com/users/scaladevspark/events{/privacy}","received_events_url":"https://api.github.com/users/scaladevspark/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T15:32:19Z","updated_at":"2022-04-25T15:32:19Z","author_association":"NONE","body":"Well the class seems to be there, as printed below(from the spark submitted jar) and I can also import it in the IDE as well\r\n\r\ntest:\r\nclass org.apache.iceberg.spark.source.IcebergSource\r\n22/04/25 15:28:27 INFO SharedState: Setting hive.metastore.warehouse.dir ('null') to the value of spark.sql.warehouse.dir ('s3a://spark/warehouse/').\r\n22/04/25 15:28:27 INFO SharedState: Warehouse path is 's3a://spark/warehouse/'.\r\n\r\n\r\nbut still\r\n22/04/25 15:28:39 ERROR MicroBatchExecution: Query [id = da35d26a-76f7-4ca5-887d-673582563438, runId = ca08b056-d104-44ac-98d3-5004ba94914c] terminated with error\r\njava.lang.ClassNotFoundException: Failed to find data source: iceberg. Please find packages at http://spark.apache.org/third-party-projects.html\r\n\r\n\r\nany chance I can provide the class directly to the .format instead of the \"iceberg\"string?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108728049/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108729152","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1108729152","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1108729152,"node_id":"IC_kwDOCW7NX85CFd1A","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T15:33:19Z","updated_at":"2022-04-25T15:33:19Z","author_association":"MEMBER","body":"What exactly are you trying to run?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108729152/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108732391","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1108732391","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1108732391,"node_id":"IC_kwDOCW7NX85CFenn","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T15:36:02Z","updated_at":"2022-04-25T15:38:28Z","author_association":"MEMBER","body":"In general you should be using the DSV2 Catalog api which wouldn't use \"format\" at all, but the class I asked you to print out has the DataSourceRegister which when loaded onto the classpath registers [\"iceberg\" as a format.](https://github.com/apache/iceberg/blob/4718fd316e4343fd82491060a925d91c38a48283/spark/v3.2/spark/src/main/java/org/apache/iceberg/spark/source/IcebergSource.java#L65) Now whether that supports structured streaming is a different question. I know we only have limited support for that in the [Table api itself](https://github.com/apache/iceberg/blob/9ccdb37d862c2471f6335d3841f028384af65641/spark/v3.2/spark/src/main/java/org/apache/iceberg/spark/source/SparkTable.java#L90-L91) and i'm not sure it was added to the IcebergSource","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108732391/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108735552","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1108735552","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1108735552,"node_id":"IC_kwDOCW7NX85CFfZA","user":{"login":"scaladevspark","id":101802776,"node_id":"U_kgDOBhFjGA","avatar_url":"https://avatars.githubusercontent.com/u/101802776?v=4","gravatar_id":"","url":"https://api.github.com/users/scaladevspark","html_url":"https://github.com/scaladevspark","followers_url":"https://api.github.com/users/scaladevspark/followers","following_url":"https://api.github.com/users/scaladevspark/following{/other_user}","gists_url":"https://api.github.com/users/scaladevspark/gists{/gist_id}","starred_url":"https://api.github.com/users/scaladevspark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scaladevspark/subscriptions","organizations_url":"https://api.github.com/users/scaladevspark/orgs","repos_url":"https://api.github.com/users/scaladevspark/repos","events_url":"https://api.github.com/users/scaladevspark/events{/privacy}","received_events_url":"https://api.github.com/users/scaladevspark/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T15:39:00Z","updated_at":"2022-04-25T15:39:00Z","author_association":"NONE","body":"fails on this:\r\n      df\r\n        .orderBy(TIME_KEY_COL)\r\n        .coalesce(1)\r\n        .write\r\n        .mode(SaveMode.Append)\r\n        .format(writeFormat)\r\n        .partitionBy(TIME_KEY_COL)\r\n        .option(\"path\", path)\r\n        .saveAsTable(s\"$db.$table\")\r\n\r\nwhich is called in readDf.writeStream\r\n      .trigger(ProcessingTime(time))\r\n      .option(\"checkpointLocation\", loc)\r\n      .foreachBatch {}\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108735552/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108736685","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1108736685","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1108736685,"node_id":"IC_kwDOCW7NX85CFfqt","user":{"login":"scaladevspark","id":101802776,"node_id":"U_kgDOBhFjGA","avatar_url":"https://avatars.githubusercontent.com/u/101802776?v=4","gravatar_id":"","url":"https://api.github.com/users/scaladevspark","html_url":"https://github.com/scaladevspark","followers_url":"https://api.github.com/users/scaladevspark/followers","following_url":"https://api.github.com/users/scaladevspark/following{/other_user}","gists_url":"https://api.github.com/users/scaladevspark/gists{/gist_id}","starred_url":"https://api.github.com/users/scaladevspark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scaladevspark/subscriptions","organizations_url":"https://api.github.com/users/scaladevspark/orgs","repos_url":"https://api.github.com/users/scaladevspark/repos","events_url":"https://api.github.com/users/scaladevspark/events{/privacy}","received_events_url":"https://api.github.com/users/scaladevspark/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T15:40:08Z","updated_at":"2022-04-25T15:40:08Z","author_association":"NONE","body":"this page seems to be using it with Structured Streaming https://iceberg.apache.org/docs/latest/spark-structured-streaming/\r\n\r\nbtw thanks a lot for your help and the time you are taking w me.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108736685/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108738297","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1108738297","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1108738297,"node_id":"IC_kwDOCW7NX85CFgD5","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T15:41:36Z","updated_at":"2022-04-25T15:42:37Z","author_association":"MEMBER","body":"Yes I know we have the support there, i'm just not sure if the Source flow was compatible, but you aren't using it in an actual streaming context. That code above should trigger the standard write pathway. You can pass in the full classpath for the `IcebergSource` there, although if that works it means something has gone pretty wrong in the classloader :/\r\n\r\nI would recommend getting your catalog set up and just using .writeTo(\"catalog.namespace.table\").append() (or create table or whatever it is you want it to do on each batch)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108738297/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108743804","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1108743804","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1108743804,"node_id":"IC_kwDOCW7NX85CFhZ8","user":{"login":"scaladevspark","id":101802776,"node_id":"U_kgDOBhFjGA","avatar_url":"https://avatars.githubusercontent.com/u/101802776?v=4","gravatar_id":"","url":"https://api.github.com/users/scaladevspark","html_url":"https://github.com/scaladevspark","followers_url":"https://api.github.com/users/scaladevspark/followers","following_url":"https://api.github.com/users/scaladevspark/following{/other_user}","gists_url":"https://api.github.com/users/scaladevspark/gists{/gist_id}","starred_url":"https://api.github.com/users/scaladevspark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scaladevspark/subscriptions","organizations_url":"https://api.github.com/users/scaladevspark/orgs","repos_url":"https://api.github.com/users/scaladevspark/repos","events_url":"https://api.github.com/users/scaladevspark/events{/privacy}","received_events_url":"https://api.github.com/users/scaladevspark/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T15:46:28Z","updated_at":"2022-04-25T15:46:28Z","author_association":"NONE","body":"could the catalog settings be an issue then? Have this currently:\r\n\"spark.sql.catalogImplementation\": \"hive\"\r\n    \"spark.sql.catalog.iceberg_catalog.type\": \"hive\"\r\n    \"spark.sql.catalog.iceberg_catalog.uri\": \"thrift://hms-service.default.svc.cluster.local:9083\"\r\n    \"spark.sql.catalog.iceberg_catalog\": \"org.apache.iceberg.spark.SparkCatalog\"\r\n    \"spark.sql.catalog.iceberg_catalog.warehouse\": \"s3a://spark/warehouse/\"\r\n    \"spark.sql.extensions\": \"org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions\"\r\n    \"spark.hadoop.hive.metastore.uris\": \"thrift://hms-service.default.svc.cluster.local:9083\"","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108743804/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108763936","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1108763936","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1108763936,"node_id":"IC_kwDOCW7NX85CFmUg","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T16:05:32Z","updated_at":"2022-04-25T16:05:32Z","author_association":"MEMBER","body":"That would be fine, but you aren't specifying your catalog in your write, should probably be\r\n\r\n```scala\r\ndf\r\n.orderBy(TIME_KEY_COL)\r\n.coalesce(1)\r\n.writeTo(s\"iceberg_catalog.$db.$table\")\r\n.append()\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108763936/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108778429","html_url":"https://github.com/apache/iceberg/pull/4395#issuecomment-1108778429","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4395","id":1108778429,"node_id":"IC_kwDOCW7NX85CFp29","user":{"login":"wypoon","id":3925490,"node_id":"MDQ6VXNlcjM5MjU0OTA=","avatar_url":"https://avatars.githubusercontent.com/u/3925490?v=4","gravatar_id":"","url":"https://api.github.com/users/wypoon","html_url":"https://github.com/wypoon","followers_url":"https://api.github.com/users/wypoon/followers","following_url":"https://api.github.com/users/wypoon/following{/other_user}","gists_url":"https://api.github.com/users/wypoon/gists{/gist_id}","starred_url":"https://api.github.com/users/wypoon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wypoon/subscriptions","organizations_url":"https://api.github.com/users/wypoon/orgs","repos_url":"https://api.github.com/users/wypoon/repos","events_url":"https://api.github.com/users/wypoon/events{/privacy}","received_events_url":"https://api.github.com/users/wypoon/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T16:17:55Z","updated_at":"2022-04-25T16:17:55Z","author_association":"CONTRIBUTOR","body":"@RussellSpitzer I have addressed your feedback. I think this one should be ready.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108778429/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108780017","html_url":"https://github.com/apache/iceberg/pull/4588#issuecomment-1108780017","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4588","id":1108780017,"node_id":"IC_kwDOCW7NX85CFqPx","user":{"login":"wypoon","id":3925490,"node_id":"MDQ6VXNlcjM5MjU0OTA=","avatar_url":"https://avatars.githubusercontent.com/u/3925490?v=4","gravatar_id":"","url":"https://api.github.com/users/wypoon","html_url":"https://github.com/wypoon","followers_url":"https://api.github.com/users/wypoon/followers","following_url":"https://api.github.com/users/wypoon/following{/other_user}","gists_url":"https://api.github.com/users/wypoon/gists{/gist_id}","starred_url":"https://api.github.com/users/wypoon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wypoon/subscriptions","organizations_url":"https://api.github.com/users/wypoon/orgs","repos_url":"https://api.github.com/users/wypoon/repos","events_url":"https://api.github.com/users/wypoon/events{/privacy}","received_events_url":"https://api.github.com/users/wypoon/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T16:19:30Z","updated_at":"2022-04-25T16:19:30Z","author_association":"CONTRIBUTOR","body":"@RussellSpitzer I have cleaned up the logging, and reworked the unit tests, on top of the updates to #4395.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108780017/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108782055","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1108782055","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1108782055,"node_id":"IC_kwDOCW7NX85CFqvn","user":{"login":"scaladevspark","id":101802776,"node_id":"U_kgDOBhFjGA","avatar_url":"https://avatars.githubusercontent.com/u/101802776?v=4","gravatar_id":"","url":"https://api.github.com/users/scaladevspark","html_url":"https://github.com/scaladevspark","followers_url":"https://api.github.com/users/scaladevspark/followers","following_url":"https://api.github.com/users/scaladevspark/following{/other_user}","gists_url":"https://api.github.com/users/scaladevspark/gists{/gist_id}","starred_url":"https://api.github.com/users/scaladevspark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scaladevspark/subscriptions","organizations_url":"https://api.github.com/users/scaladevspark/orgs","repos_url":"https://api.github.com/users/scaladevspark/repos","events_url":"https://api.github.com/users/scaladevspark/events{/privacy}","received_events_url":"https://api.github.com/users/scaladevspark/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T16:21:33Z","updated_at":"2022-04-25T16:21:55Z","author_association":"NONE","body":"ok, switching to writeTo helped, this now runs:\r\n      dfToWrite\r\n        .orderBy(TIME_KEY_COL)\r\n        .coalesce(1)\r\n        .writeTo(s\"iceberg_catalog.$db.$table\")\r\n        .partitionedBy(col(TIME_KEY_COL))\r\n        .createOrReplace()\r\n\r\nHowever, the api changed a lot. It does not seem possible anymore to directly write to a partitioned table with an external location and create it if not exists. So basically:\r\ndf\r\n.write\r\n.mode(SaveMode.Append)\r\n.format(writeFormat)\r\n.partitionBy(TIME_KEY_COL)\r\n.option(\"path\", path)\r\n.saveAsTable(s\"$db.$table\")\r\n\r\nis not possible with the new API anymore, as you need to create the table first and then write to it? Or is there a way?\r\n\r\nThanks a lot again for all your help.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108782055/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108790296","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1108790296","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1108790296,"node_id":"IC_kwDOCW7NX85CFswY","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T16:30:11Z","updated_at":"2022-04-25T16:30:11Z","author_association":"MEMBER","body":"You could use the format version as well but you need to add the catalog to `.saveAsTable(s\"iceberg_catalog.$db.$table\")`\r\n\r\nIn the new api I believe you would need to be explicit if you want to create IF not exists\r\n\r\n```scala\r\n val df = dfToWrite\r\n    .orderBy(TIME_KEY_COL)\r\n    .coalesce(1)\r\n     .writeTo(s\"iceberg_catalog.$db.$table\")\r\n    .partitionedBy(col(TIME_KEY_COL))\r\n    .tableProperty(\"location\", \"somewhere\")\r\ntry {\r\n  df.create()\r\n} catchTableExists {\r\n  df.append()\r\n}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108790296/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108814359","html_url":"https://github.com/apache/iceberg/pull/4608#issuecomment-1108814359","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4608","id":1108814359,"node_id":"IC_kwDOCW7NX85CFyoX","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T16:55:58Z","updated_at":"2022-04-25T16:55:58Z","author_association":"CONTRIBUTOR","body":"Thanks, @danielcweeks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108814359/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108840545","html_url":"https://github.com/apache/iceberg/issues/4356#issuecomment-1108840545","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4356","id":1108840545,"node_id":"IC_kwDOCW7NX85CF5Bh","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T17:21:01Z","updated_at":"2022-04-25T17:21:01Z","author_association":"COLLABORATOR","body":"Hi @Andre9580 yea , even more simply, I think we can even entirely removing the try/catch block","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108840545/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108879409","html_url":"https://github.com/apache/iceberg/pull/4537#issuecomment-1108879409","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4537","id":1108879409,"node_id":"IC_kwDOCW7NX85CGCgx","user":{"login":"findepi","id":144328,"node_id":"MDQ6VXNlcjE0NDMyOA==","avatar_url":"https://avatars.githubusercontent.com/u/144328?v=4","gravatar_id":"","url":"https://api.github.com/users/findepi","html_url":"https://github.com/findepi","followers_url":"https://api.github.com/users/findepi/followers","following_url":"https://api.github.com/users/findepi/following{/other_user}","gists_url":"https://api.github.com/users/findepi/gists{/gist_id}","starred_url":"https://api.github.com/users/findepi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/findepi/subscriptions","organizations_url":"https://api.github.com/users/findepi/orgs","repos_url":"https://api.github.com/users/findepi/repos","events_url":"https://api.github.com/users/findepi/events{/privacy}","received_events_url":"https://api.github.com/users/findepi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T18:05:51Z","updated_at":"2022-04-25T18:05:51Z","author_association":"MEMBER","body":"AC","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108879409/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108895547","html_url":"https://github.com/apache/iceberg/pull/4535#issuecomment-1108895547","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4535","id":1108895547,"node_id":"IC_kwDOCW7NX85CGGc7","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T18:22:22Z","updated_at":"2022-04-25T18:22:22Z","author_association":"COLLABORATOR","body":"Merged, thanks @zhongyujiang ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1108895547/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109074425","html_url":"https://github.com/apache/iceberg/pull/4560#issuecomment-1109074425","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4560","id":1109074425,"node_id":"IC_kwDOCW7NX85CGyH5","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T21:48:32Z","updated_at":"2022-04-25T21:48:32Z","author_association":"COLLABORATOR","body":"No problem, thanks for all the suggestions !","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109074425/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109106657","html_url":"https://github.com/apache/iceberg/issues/4356#issuecomment-1109106657","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4356","id":1109106657,"node_id":"IC_kwDOCW7NX85CG5_h","user":{"login":"Andre9580","id":34575854,"node_id":"MDQ6VXNlcjM0NTc1ODU0","avatar_url":"https://avatars.githubusercontent.com/u/34575854?v=4","gravatar_id":"","url":"https://api.github.com/users/Andre9580","html_url":"https://github.com/Andre9580","followers_url":"https://api.github.com/users/Andre9580/followers","following_url":"https://api.github.com/users/Andre9580/following{/other_user}","gists_url":"https://api.github.com/users/Andre9580/gists{/gist_id}","starred_url":"https://api.github.com/users/Andre9580/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Andre9580/subscriptions","organizations_url":"https://api.github.com/users/Andre9580/orgs","repos_url":"https://api.github.com/users/Andre9580/repos","events_url":"https://api.github.com/users/Andre9580/events{/privacy}","received_events_url":"https://api.github.com/users/Andre9580/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T22:33:27Z","updated_at":"2022-04-25T22:33:27Z","author_association":"CONTRIBUTOR","body":"Hi @[szehon-ho](https://github.com/szehon-ho), created a pull request ([#4630](https://github.com/apache/iceberg/pull/4630)) please feel free to review it.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109106657/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109107691","html_url":"https://github.com/apache/iceberg/issues/4631#issuecomment-1109107691","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4631","id":1109107691,"node_id":"IC_kwDOCW7NX85CG6Pr","user":{"login":"dramaticlly","id":5961173,"node_id":"MDQ6VXNlcjU5NjExNzM=","avatar_url":"https://avatars.githubusercontent.com/u/5961173?v=4","gravatar_id":"","url":"https://api.github.com/users/dramaticlly","html_url":"https://github.com/dramaticlly","followers_url":"https://api.github.com/users/dramaticlly/followers","following_url":"https://api.github.com/users/dramaticlly/following{/other_user}","gists_url":"https://api.github.com/users/dramaticlly/gists{/gist_id}","starred_url":"https://api.github.com/users/dramaticlly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dramaticlly/subscriptions","organizations_url":"https://api.github.com/users/dramaticlly/orgs","repos_url":"https://api.github.com/users/dramaticlly/repos","events_url":"https://api.github.com/users/dramaticlly/events{/privacy}","received_events_url":"https://api.github.com/users/dramaticlly/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T22:35:25Z","updated_at":"2022-04-25T22:35:25Z","author_association":"CONTRIBUTOR","body":"Since there's some sporadic discussion in both PR and slack (which I cannot see it history unfortunately), so I want to collect the opinion of yours to see if above list of validations above are enough to construct the PartitionSpec in python without the `builder`\r\n\r\nCC @rdblue  @samredai  @jun-he ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109107691/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109145010","html_url":"https://github.com/apache/iceberg/pull/4629#issuecomment-1109145010","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4629","id":1109145010,"node_id":"IC_kwDOCW7NX85CHDWy","user":{"login":"dramaticlly","id":5961173,"node_id":"MDQ6VXNlcjU5NjExNzM=","avatar_url":"https://avatars.githubusercontent.com/u/5961173?v=4","gravatar_id":"","url":"https://api.github.com/users/dramaticlly","html_url":"https://github.com/dramaticlly","followers_url":"https://api.github.com/users/dramaticlly/followers","following_url":"https://api.github.com/users/dramaticlly/following{/other_user}","gists_url":"https://api.github.com/users/dramaticlly/gists{/gist_id}","starred_url":"https://api.github.com/users/dramaticlly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dramaticlly/subscriptions","organizations_url":"https://api.github.com/users/dramaticlly/orgs","repos_url":"https://api.github.com/users/dramaticlly/repos","events_url":"https://api.github.com/users/dramaticlly/events{/privacy}","received_events_url":"https://api.github.com/users/dramaticlly/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T23:43:29Z","updated_at":"2022-04-25T23:46:51Z","author_association":"CONTRIBUTOR","body":"from what I can tell, all Spark share the similar interface `BaseExpireSnapshotsActionResult`, so looks like Spark3.2 is updated with new results but [Spark 2.4](https://github.com/apache/iceberg/blob/master/spark/v2.4/spark/src/main/java/org/apache/iceberg/spark/actions/BaseExpireSnapshotsSparkAction.java#L274) is still unhappy per CI failure \r\n\r\n```\r\n/home/runner/work/iceberg/iceberg/spark/v2.4/spark/src/main/java/org/apache/iceberg/spark/actions/BaseExpireSnapshotsSparkAction.java:274: error: constructor BaseExpireSnapshotsActionResult in class org.apache.iceberg.actions.BaseExpireSnapshotsActionResult cannot be applied to given types;\r\n\r\n    return new BaseExpireSnapshotsActionResult(dataFileCount.get(), manifestCount.get(), manifestListCount.get());\r\n           ^\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109145010/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109201599","html_url":"https://github.com/apache/iceberg/pull/4535#issuecomment-1109201599","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4535","id":1109201599,"node_id":"IC_kwDOCW7NX85CHRK_","user":{"login":"zhongyujiang","id":42907416,"node_id":"MDQ6VXNlcjQyOTA3NDE2","avatar_url":"https://avatars.githubusercontent.com/u/42907416?v=4","gravatar_id":"","url":"https://api.github.com/users/zhongyujiang","html_url":"https://github.com/zhongyujiang","followers_url":"https://api.github.com/users/zhongyujiang/followers","following_url":"https://api.github.com/users/zhongyujiang/following{/other_user}","gists_url":"https://api.github.com/users/zhongyujiang/gists{/gist_id}","starred_url":"https://api.github.com/users/zhongyujiang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhongyujiang/subscriptions","organizations_url":"https://api.github.com/users/zhongyujiang/orgs","repos_url":"https://api.github.com/users/zhongyujiang/repos","events_url":"https://api.github.com/users/zhongyujiang/events{/privacy}","received_events_url":"https://api.github.com/users/zhongyujiang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T01:27:38Z","updated_at":"2022-04-26T01:27:38Z","author_association":"CONTRIBUTOR","body":"Thanks for your review!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109201599/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109315236","html_url":"https://github.com/apache/iceberg/pull/4518#issuecomment-1109315236","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4518","id":1109315236,"node_id":"IC_kwDOCW7NX85CHs6k","user":{"login":"rizaon","id":6033430,"node_id":"MDQ6VXNlcjYwMzM0MzA=","avatar_url":"https://avatars.githubusercontent.com/u/6033430?v=4","gravatar_id":"","url":"https://api.github.com/users/rizaon","html_url":"https://github.com/rizaon","followers_url":"https://api.github.com/users/rizaon/followers","following_url":"https://api.github.com/users/rizaon/following{/other_user}","gists_url":"https://api.github.com/users/rizaon/gists{/gist_id}","starred_url":"https://api.github.com/users/rizaon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rizaon/subscriptions","organizations_url":"https://api.github.com/users/rizaon/orgs","repos_url":"https://api.github.com/users/rizaon/repos","events_url":"https://api.github.com/users/rizaon/events{/privacy}","received_events_url":"https://api.github.com/users/rizaon/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T04:24:08Z","updated_at":"2022-04-26T04:24:08Z","author_association":"CONTRIBUTOR","body":"Got it, thank you. Will rebase and update this PR once they are merged.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109315236/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109344248","html_url":"https://github.com/apache/iceberg/issues/4607#issuecomment-1109344248","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4607","id":1109344248,"node_id":"IC_kwDOCW7NX85CHz_4","user":{"login":"kyle-cx91","id":10529123,"node_id":"MDQ6VXNlcjEwNTI5MTIz","avatar_url":"https://avatars.githubusercontent.com/u/10529123?v=4","gravatar_id":"","url":"https://api.github.com/users/kyle-cx91","html_url":"https://github.com/kyle-cx91","followers_url":"https://api.github.com/users/kyle-cx91/followers","following_url":"https://api.github.com/users/kyle-cx91/following{/other_user}","gists_url":"https://api.github.com/users/kyle-cx91/gists{/gist_id}","starred_url":"https://api.github.com/users/kyle-cx91/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kyle-cx91/subscriptions","organizations_url":"https://api.github.com/users/kyle-cx91/orgs","repos_url":"https://api.github.com/users/kyle-cx91/repos","events_url":"https://api.github.com/users/kyle-cx91/events{/privacy}","received_events_url":"https://api.github.com/users/kyle-cx91/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T04:57:32Z","updated_at":"2022-04-26T04:57:32Z","author_association":"CONTRIBUTOR","body":"hi @samredai, need any volunteer? \r\nWill you create an issue for each item? Or do it directly under the current issue?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109344248/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109394145","html_url":"https://github.com/apache/iceberg/pull/4632#issuecomment-1109394145","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4632","id":1109394145,"node_id":"IC_kwDOCW7NX85CIALh","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T06:23:32Z","updated_at":"2022-04-26T19:13:48Z","author_association":"CONTRIBUTOR","body":"I left `AddPartitionSpec` unimplemented because of concerns about processing incoming JSON that does not have field-id set when parsed, which would be assigned default field ids (starting at 1000). Want to double check any potential consequences or realities of that happening.\r\n\r\n I'm not even sure that could happen / needs to be accounted for, but after having that thought I figured it would be better to open the `AddPartitionSpec` SerDe in a separate PR given that smaller PRs are generally better anyway. I'll open that one shortly.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109394145/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109399253","html_url":"https://github.com/apache/iceberg/pull/4632#issuecomment-1109399253","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4632","id":1109399253,"node_id":"IC_kwDOCW7NX85CIBbV","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T06:29:41Z","updated_at":"2022-04-26T06:29:41Z","author_association":"CONTRIBUTOR","body":"cc @rdblue","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109399253/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109430948","html_url":"https://github.com/apache/iceberg/pull/4625#issuecomment-1109430948","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4625","id":1109430948,"node_id":"IC_kwDOCW7NX85CIJKk","user":{"login":"wuwenchi","id":19755729,"node_id":"MDQ6VXNlcjE5NzU1NzI5","avatar_url":"https://avatars.githubusercontent.com/u/19755729?v=4","gravatar_id":"","url":"https://api.github.com/users/wuwenchi","html_url":"https://github.com/wuwenchi","followers_url":"https://api.github.com/users/wuwenchi/followers","following_url":"https://api.github.com/users/wuwenchi/following{/other_user}","gists_url":"https://api.github.com/users/wuwenchi/gists{/gist_id}","starred_url":"https://api.github.com/users/wuwenchi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wuwenchi/subscriptions","organizations_url":"https://api.github.com/users/wuwenchi/orgs","repos_url":"https://api.github.com/users/wuwenchi/repos","events_url":"https://api.github.com/users/wuwenchi/events{/privacy}","received_events_url":"https://api.github.com/users/wuwenchi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T07:12:14Z","updated_at":"2022-04-26T11:22:11Z","author_association":"CONTRIBUTOR","body":"@kbendick   Thanks for your reply!\r\n\r\n> I believe Flink 1.15 was released, so I am going to rebase my Flink 1.15 support PR to the release branch and we should have 1.15 support in the next few days.\r\n\r\nIs this feature already supported on the flink 1.15 branch you are working on now? Or should we wait until flink1.15 is branched out and then support this function through this PR?\r\n\r\n> Have you given any thought to possibly trying to support tables with hidden partitioning (that use partition transforms other than identity transform) via generated columns? Likely out of scope, but that’s one way I’ve been considering to add support.\r\n\r\nYes, this feature is very useful to me, and the next plan is to support this feature. If you don't mind, can I join this feature?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109430948/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109515565","html_url":"https://github.com/apache/iceberg/pull/4463#issuecomment-1109515565","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4463","id":1109515565,"node_id":"IC_kwDOCW7NX85CId0t","user":{"login":"polaris6","id":29967142,"node_id":"MDQ6VXNlcjI5OTY3MTQy","avatar_url":"https://avatars.githubusercontent.com/u/29967142?v=4","gravatar_id":"","url":"https://api.github.com/users/polaris6","html_url":"https://github.com/polaris6","followers_url":"https://api.github.com/users/polaris6/followers","following_url":"https://api.github.com/users/polaris6/following{/other_user}","gists_url":"https://api.github.com/users/polaris6/gists{/gist_id}","starred_url":"https://api.github.com/users/polaris6/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/polaris6/subscriptions","organizations_url":"https://api.github.com/users/polaris6/orgs","repos_url":"https://api.github.com/users/polaris6/repos","events_url":"https://api.github.com/users/polaris6/events{/privacy}","received_events_url":"https://api.github.com/users/polaris6/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T08:37:59Z","updated_at":"2022-04-26T08:37:59Z","author_association":"CONTRIBUTOR","body":"hi @RussellSpitzer, could you please help me to merge this PR? Thank you very much!\r\nWe can add a separate doc in another PR to explain the Distribution/Ordering and global sort/local sort, l am glad to do this if no one else does it, but I need to take the time to research it first.\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109515565/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109773271","html_url":"https://github.com/apache/iceberg/issues/4628#issuecomment-1109773271","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4628","id":1109773271,"node_id":"IC_kwDOCW7NX85CJcvX","user":{"login":"scaladevspark","id":101802776,"node_id":"U_kgDOBhFjGA","avatar_url":"https://avatars.githubusercontent.com/u/101802776?v=4","gravatar_id":"","url":"https://api.github.com/users/scaladevspark","html_url":"https://github.com/scaladevspark","followers_url":"https://api.github.com/users/scaladevspark/followers","following_url":"https://api.github.com/users/scaladevspark/following{/other_user}","gists_url":"https://api.github.com/users/scaladevspark/gists{/gist_id}","starred_url":"https://api.github.com/users/scaladevspark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/scaladevspark/subscriptions","organizations_url":"https://api.github.com/users/scaladevspark/orgs","repos_url":"https://api.github.com/users/scaladevspark/repos","events_url":"https://api.github.com/users/scaladevspark/events{/privacy}","received_events_url":"https://api.github.com/users/scaladevspark/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T13:05:39Z","updated_at":"2022-04-26T13:06:11Z","author_association":"NONE","body":"thanks, this approach works, you just have to move the partitionedBy to the create part, otherwise you cannot continue with append. So this works:\r\n\r\nval df = dfToWrite\r\n    .orderBy(TIME_KEY_COL)\r\n    .coalesce(1)\r\n     .writeTo(s\"iceberg_catalog.$db.$table\")\r\ntry {\r\n  df\r\n    .partitionedBy(col(TIME_KEY_COL))\r\n    .tableProperty(\"location\", \"somewhere\")\r\n    .create()\r\n} catchTableExists {\r\n  df.append()\r\n}\r\n\r\nthanks again for helping me.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109773271/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109809403","html_url":"https://github.com/apache/iceberg/issues/4607#issuecomment-1109809403","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4607","id":1109809403,"node_id":"IC_kwDOCW7NX85CJlj7","user":{"login":"samredai","id":43911210,"node_id":"MDQ6VXNlcjQzOTExMjEw","avatar_url":"https://avatars.githubusercontent.com/u/43911210?v=4","gravatar_id":"","url":"https://api.github.com/users/samredai","html_url":"https://github.com/samredai","followers_url":"https://api.github.com/users/samredai/followers","following_url":"https://api.github.com/users/samredai/following{/other_user}","gists_url":"https://api.github.com/users/samredai/gists{/gist_id}","starred_url":"https://api.github.com/users/samredai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samredai/subscriptions","organizations_url":"https://api.github.com/users/samredai/orgs","repos_url":"https://api.github.com/users/samredai/repos","events_url":"https://api.github.com/users/samredai/events{/privacy}","received_events_url":"https://api.github.com/users/samredai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T13:37:48Z","updated_at":"2022-04-26T13:37:48Z","author_association":"CONTRIBUTOR","body":"@kyle-cx that would be awesome! I think we can just work on it directly under this issue. Do you want to tackle the \"single configuration page\"?\r\n\r\nSome context around that requirement is that many people found it inefficient to have to search all over the site to find the one configuration table they need. So this item is to take the config tables out of separate sections, like [table](https://iceberg.apache.org/docs/latest/configuration/#table-properties) configs, [spark catalog](https://iceberg.apache.org/docs/latest/spark-configuration/#catalog-configuration) configs and [spark runtime](https://iceberg.apache.org/docs/latest/spark-configuration/#runtime-configuration) configs, and put them in a single `configuration.md` page that's purely a list of tables (perfect for a CMD/Ctrl+F).","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109809403/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109978162","html_url":"https://github.com/apache/iceberg/pull/4586#issuecomment-1109978162","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4586","id":1109978162,"node_id":"IC_kwDOCW7NX85CKOwy","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T16:04:19Z","updated_at":"2022-04-26T16:04:19Z","author_association":"CONTRIBUTOR","body":"+1 for what Amogh suggested, I would vote for directly going with Spark SQL extension if possible. Just from user standpoint, SQL is considered an easier user experience compared to procedure calls, although I understand technically there is not much difference for us developers. I would also hope the current procedures such as `rewrite_data_files`, `migrate` and `expire_snapshots` to map to `OPTIMIZE`, `IMPORT` and `VACUUM` SQL extensions in the future.\r\n\r\n@amogh-jahagirdar I remember you have a doc about the possible syntaxes, could you share with the audience here? Once the syntax is determined, the implementation is pretty straightforward.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1109978162/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1110006116","html_url":"https://github.com/apache/iceberg/pull/4466#issuecomment-1110006116","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4466","id":1110006116,"node_id":"IC_kwDOCW7NX85CKVlk","user":{"login":"CircArgs","id":35903677,"node_id":"MDQ6VXNlcjM1OTAzNjc3","avatar_url":"https://avatars.githubusercontent.com/u/35903677?v=4","gravatar_id":"","url":"https://api.github.com/users/CircArgs","html_url":"https://github.com/CircArgs","followers_url":"https://api.github.com/users/CircArgs/followers","following_url":"https://api.github.com/users/CircArgs/following{/other_user}","gists_url":"https://api.github.com/users/CircArgs/gists{/gist_id}","starred_url":"https://api.github.com/users/CircArgs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CircArgs/subscriptions","organizations_url":"https://api.github.com/users/CircArgs/orgs","repos_url":"https://api.github.com/users/CircArgs/repos","events_url":"https://api.github.com/users/CircArgs/events{/privacy}","received_events_url":"https://api.github.com/users/CircArgs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T16:31:26Z","updated_at":"2022-04-26T16:31:26Z","author_association":"CONTRIBUTOR","body":"> Thanks, @CircArgs!\n\nThank you for all the helpful commentary","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1110006116/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1110105909","html_url":"https://github.com/apache/iceberg/pull/4553#issuecomment-1110105909","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4553","id":1110105909,"node_id":"IC_kwDOCW7NX85CKt81","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T18:13:55Z","updated_at":"2022-04-26T18:13:55Z","author_association":"CONTRIBUTOR","body":"> ```diff\r\n>    @Override\r\n>    public ScanRuntimeProvider getScanRuntimeProvider(ScanContext runtimeProviderContext) {\r\n>      return new DataStreamScanProvider() {\r\n> +\r\n> +      // UPDATED - Needs to be added as support for other signature is entirely removed.\r\n> +      // TODO -    This should probably be ported to 1.14 as well to make future changes\r\n> +      //           easier to backport.\r\n>        @Override\r\n> -      public DataStream<RowData> produceDataStream(StreamExecutionEnvironment execEnv) {\r\n> +      public DataStream<RowData> produceDataStream(\r\n> +          ProviderContext providerContext, StreamExecutionEnvironment execEnv) {\r\n>          return createDataStream(execEnv);\r\n>        }\r\n> ```\r\n> \r\n> Let's just open a separate github issue to track this thing, seems it does not make sense to add backport TODO for flink 1.14 in the flink 1.15 source code.\r\n\r\nI opened a new issue for this: https://github.com/apache/iceberg/issues/4634","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1110105909/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1110109959","html_url":"https://github.com/apache/iceberg/pull/4553#issuecomment-1110109959","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4553","id":1110109959,"node_id":"IC_kwDOCW7NX85CKu8H","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T18:17:59Z","updated_at":"2022-04-26T18:17:59Z","author_association":"CONTRIBUTOR","body":"> ```diff\r\n> +    // https://nightlies.apache.org/flink/flink-docs-master/docs/dev/table/config/#table-exec-sink-upsert-materialize\r\n> +    // UPDATED - Needed to make testChangeLogOnDataKey work.\r\n> +    // TODO - Add tests with all configuraiton values as follow up - and possibly remove our own injected shuffle\r\n> +    //        as Flink can now do it.\r\n> +    getTableEnv().getConfig().set(\"table.exec.sink.upsert-materialize\", \"NONE\");\r\n> ```\r\n> \r\n> This is interesting. Let's just replace those comments by the following ?\r\n> \r\n> ```\r\n> +  // Set the table.exec.sink.upsert-materialize=NONE, so that downstream operators will receive the records with the same orders as the source operator.\r\n> ```\r\n\r\nI updated it (and added a note about bypassing Flink's shuffle). We should open an issue to consider allowing for Flink to handle the shuffling where necessary. Or set the necessary configuration by default for users - though I'm generally not in favor of changing the defaults and would prefer to let Flink handle the shuffle if at all possible.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1110109959/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1110113105","html_url":"https://github.com/apache/iceberg/pull/4553#issuecomment-1110113105","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4553","id":1110113105,"node_id":"IC_kwDOCW7NX85CKvtR","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T18:21:34Z","updated_at":"2022-04-26T18:21:34Z","author_association":"CONTRIBUTOR","body":"> There is a broken unit test here:\r\n> \r\n> ```\r\n> org.apache.iceberg.flink.TestFlinkTableSource > testFilterPushDownBetween FAILED\r\n>     java.lang.AssertionError: Should produce the expected record expected:<[+I[1, iceberg, 10.0], +I[2, b, 20.0]]> but was:<[+I[2, b, 20.0], +I[1, iceberg, 10.0]]>\r\n>         at org.junit.Assert.fail(Assert.java:89)\r\n>         at org.junit.Assert.failNotEquals(Assert.java:835)\r\n>         at org.junit.Assert.assertEquals(Assert.java:120)\r\n>         at org.apache.iceberg.flink.TestFlinkTableSource.testFilterPushDownBetween(TestFlinkTableSource.java:496)\r\n> ```\r\n\r\nHmmm this seems to be a newer breaking unit test. At least with The RC-2 there were not any breaking tests.\r\n\r\nNow that i've made the updates suggested here, let me diff the two again, catch 1.15 up to date with 1.14, and then we can go from there.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1110113105/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1110115771","html_url":"https://github.com/apache/iceberg/pull/4553#issuecomment-1110115771","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4553","id":1110115771,"node_id":"IC_kwDOCW7NX85CKwW7","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T18:24:35Z","updated_at":"2022-04-26T18:29:00Z","author_association":"CONTRIBUTOR","body":"I rebased off of master and made the suggested changes. Here's the file diff:\r\n\r\n```bash\r\n$ diff -qr flink/v1.14/ flink/v1.15/\r\nFiles flink/v1.14/build.gradle and flink/v1.15/build.gradle differ\r\nFiles flink/v1.14/flink/src/main/java/org/apache/iceberg/flink/IcebergTableSink.java and flink/v1.15/flink/src/main/java/org/apache/iceberg/flink/IcebergTableSink.java differ\r\nFiles flink/v1.14/flink/src/main/java/org/apache/iceberg/flink/IcebergTableSource.java and flink/v1.15/flink/src/main/java/org/apache/iceberg/flink/IcebergTableSource.java differ\r\nFiles flink/v1.14/flink/src/test/java/org/apache/iceberg/flink/TestChangeLogTable.java and flink/v1.15/flink/src/test/java/org/apache/iceberg/flink/TestChangeLogTable.java differ\r\nFiles flink/v1.14/flink/src/test/java/org/apache/iceberg/flink/TestIcebergConnector.java and flink/v1.15/flink/src/test/java/org/apache/iceberg/flink/TestIcebergConnector.java differ\r\nFiles flink/v1.14/flink/src/test/java/org/apache/iceberg/flink/source/BoundedTableFactory.java and flink/v1.15/flink/src/test/java/org/apache/iceberg/flink/source/BoundedTableFactory.java differ\r\n```\r\n\r\nI've uploaded a gist with the new diff here:\r\n\r\nhttps://gist.github.com/kbendick/8265987b7386dc2738b09d7977abe41b\r\n\r\nThe above diff was generated using `git diff --no-index ./flink/v1.14 ./flink/v1.15 >> flink_115_diff_20220426.txt`","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1110115771/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1110148921","html_url":"https://github.com/apache/iceberg/pull/4553#issuecomment-1110148921","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4553","id":1110148921,"node_id":"IC_kwDOCW7NX85CK4c5","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T19:04:15Z","updated_at":"2022-04-26T19:04:15Z","author_association":"CONTRIBUTOR","body":"For the test that is failing, I took a look into it and it seems that the test is relying on the order of records returned from the query, which is flakey in general.\r\n\r\nGiven that we're not testing the order of records, just the actual records, I've opened a PR to update Flink 1.14's tests to use `Set` semantics for comparison (adding size tests where needed) and will port that to 1.15 once it's merged: https://github.com/apache/iceberg/pull/4635","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1110148921/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]