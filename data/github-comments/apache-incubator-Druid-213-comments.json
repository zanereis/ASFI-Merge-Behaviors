[{"url":"https://api.github.com/repos/apache/druid/issues/comments/449756125","html_url":"https://github.com/apache/druid/pull/6702#issuecomment-449756125","issue_url":"https://api.github.com/repos/apache/druid/issues/6702","id":449756125,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0OTc1NjEyNQ==","user":{"login":"kaijianding","id":8663725,"node_id":"MDQ6VXNlcjg2NjM3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/8663725?v=4","gravatar_id":"","url":"https://api.github.com/users/kaijianding","html_url":"https://github.com/kaijianding","followers_url":"https://api.github.com/users/kaijianding/followers","following_url":"https://api.github.com/users/kaijianding/following{/other_user}","gists_url":"https://api.github.com/users/kaijianding/gists{/gist_id}","starred_url":"https://api.github.com/users/kaijianding/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaijianding/subscriptions","organizations_url":"https://api.github.com/users/kaijianding/orgs","repos_url":"https://api.github.com/users/kaijianding/repos","events_url":"https://api.github.com/users/kaijianding/events{/privacy}","received_events_url":"https://api.github.com/users/kaijianding/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-24T17:11:58Z","updated_at":"2018-12-24T17:11:58Z","author_association":"CONTRIBUTOR","body":"@leventov even for broker, this PR still add too many watches: the number of brokers * the number all of nodes. Still think should do some modification base on #6683 . Sorry for doesn't finish #6683 yet, I will finish it ASAP.\r\n`\r\nIs it better to add similar listener mechanism when DruidNodeAnnouncer.announce(DiscoveryDruidNode) is called?`\r\n\r\nI mean like current ServerView callback mechanism, when NodeAnnouncer done register, an initial-done callback should be called.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/449756125/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/449928871","html_url":"https://github.com/apache/druid/issues/6779#issuecomment-449928871","issue_url":"https://api.github.com/repos/apache/druid/issues/6779","id":449928871,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0OTkyODg3MQ==","user":{"login":"gaodayue","id":1198446,"node_id":"MDQ6VXNlcjExOTg0NDY=","avatar_url":"https://avatars.githubusercontent.com/u/1198446?v=4","gravatar_id":"","url":"https://api.github.com/users/gaodayue","html_url":"https://github.com/gaodayue","followers_url":"https://api.github.com/users/gaodayue/followers","following_url":"https://api.github.com/users/gaodayue/following{/other_user}","gists_url":"https://api.github.com/users/gaodayue/gists{/gist_id}","starred_url":"https://api.github.com/users/gaodayue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gaodayue/subscriptions","organizations_url":"https://api.github.com/users/gaodayue/orgs","repos_url":"https://api.github.com/users/gaodayue/repos","events_url":"https://api.github.com/users/gaodayue/events{/privacy}","received_events_url":"https://api.github.com/users/gaodayue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-26T08:29:29Z","updated_at":"2018-12-26T08:29:29Z","author_association":"CONTRIBUTOR","body":"Already fixed by #5905","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/449928871/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450009730","html_url":"https://github.com/apache/druid/issues/5543#issuecomment-450009730","issue_url":"https://api.github.com/repos/apache/druid/issues/5543","id":450009730,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDAwOTczMA==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-26T19:01:41Z","updated_at":"2018-12-26T19:01:41Z","author_association":"CONTRIBUTOR","body":"Hi @csimplestring, yes it should work.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450009730/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450173947","html_url":"https://github.com/apache/druid/issues/6781#issuecomment-450173947","issue_url":"https://api.github.com/repos/apache/druid/issues/6781","id":450173947,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDE3Mzk0Nw==","user":{"login":"dangerousfeng","id":16306831,"node_id":"MDQ6VXNlcjE2MzA2ODMx","avatar_url":"https://avatars.githubusercontent.com/u/16306831?v=4","gravatar_id":"","url":"https://api.github.com/users/dangerousfeng","html_url":"https://github.com/dangerousfeng","followers_url":"https://api.github.com/users/dangerousfeng/followers","following_url":"https://api.github.com/users/dangerousfeng/following{/other_user}","gists_url":"https://api.github.com/users/dangerousfeng/gists{/gist_id}","starred_url":"https://api.github.com/users/dangerousfeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dangerousfeng/subscriptions","organizations_url":"https://api.github.com/users/dangerousfeng/orgs","repos_url":"https://api.github.com/users/dangerousfeng/repos","events_url":"https://api.github.com/users/dangerousfeng/events{/privacy}","received_events_url":"https://api.github.com/users/dangerousfeng/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-27T15:37:27Z","updated_at":"2018-12-27T15:37:27Z","author_association":"NONE","body":"I have solved it.  mysql. Utf8 instead of utf8mb4.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450173947/reactions","total_count":7,"+1":6,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450200661","html_url":"https://github.com/apache/druid/pull/6778#issuecomment-450200661","issue_url":"https://api.github.com/repos/apache/druid/issues/6778","id":450200661,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDIwMDY2MQ==","user":{"login":"drcrallen","id":8213081,"node_id":"MDQ6VXNlcjgyMTMwODE=","avatar_url":"https://avatars.githubusercontent.com/u/8213081?v=4","gravatar_id":"","url":"https://api.github.com/users/drcrallen","html_url":"https://github.com/drcrallen","followers_url":"https://api.github.com/users/drcrallen/followers","following_url":"https://api.github.com/users/drcrallen/following{/other_user}","gists_url":"https://api.github.com/users/drcrallen/gists{/gist_id}","starred_url":"https://api.github.com/users/drcrallen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drcrallen/subscriptions","organizations_url":"https://api.github.com/users/drcrallen/orgs","repos_url":"https://api.github.com/users/drcrallen/repos","events_url":"https://api.github.com/users/drcrallen/events{/privacy}","received_events_url":"https://api.github.com/users/drcrallen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-27T17:56:14Z","updated_at":"2018-12-27T17:56:14Z","author_association":"CONTRIBUTOR","body":"Can you add more information on why this needs to be in the default and not just overridden in installation configs?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450200661/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450205116","html_url":"https://github.com/apache/druid/pull/6767#issuecomment-450205116","issue_url":"https://api.github.com/repos/apache/druid/issues/6767","id":450205116,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDIwNTExNg==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-27T18:25:17Z","updated_at":"2018-12-27T18:25:17Z","author_association":"CONTRIBUTOR","body":"@asdf2014 thank you for the review! I've addressed your comments.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450205116/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450249175","html_url":"https://github.com/apache/druid/issues/5582#issuecomment-450249175","issue_url":"https://api.github.com/repos/apache/druid/issues/5582","id":450249175,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDI0OTE3NQ==","user":{"login":"rahulsingh303","id":11955402,"node_id":"MDQ6VXNlcjExOTU1NDAy","avatar_url":"https://avatars.githubusercontent.com/u/11955402?v=4","gravatar_id":"","url":"https://api.github.com/users/rahulsingh303","html_url":"https://github.com/rahulsingh303","followers_url":"https://api.github.com/users/rahulsingh303/followers","following_url":"https://api.github.com/users/rahulsingh303/following{/other_user}","gists_url":"https://api.github.com/users/rahulsingh303/gists{/gist_id}","starred_url":"https://api.github.com/users/rahulsingh303/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rahulsingh303/subscriptions","organizations_url":"https://api.github.com/users/rahulsingh303/orgs","repos_url":"https://api.github.com/users/rahulsingh303/repos","events_url":"https://api.github.com/users/rahulsingh303/events{/privacy}","received_events_url":"https://api.github.com/users/rahulsingh303/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-27T23:08:39Z","updated_at":"2018-12-27T23:08:39Z","author_association":"NONE","body":"Checkout this one https://github.com/rahulsingh303/druid-helm . It works for me , tested on both minikube and kubernetes cluster.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450249175/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450419504","html_url":"https://github.com/apache/druid/pull/6016#issuecomment-450419504","issue_url":"https://api.github.com/repos/apache/druid/issues/6016","id":450419504,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDQxOTUwNA==","user":{"login":"clintropolis","id":1577461,"node_id":"MDQ6VXNlcjE1Nzc0NjE=","avatar_url":"https://avatars.githubusercontent.com/u/1577461?v=4","gravatar_id":"","url":"https://api.github.com/users/clintropolis","html_url":"https://github.com/clintropolis","followers_url":"https://api.github.com/users/clintropolis/followers","following_url":"https://api.github.com/users/clintropolis/following{/other_user}","gists_url":"https://api.github.com/users/clintropolis/gists{/gist_id}","starred_url":"https://api.github.com/users/clintropolis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintropolis/subscriptions","organizations_url":"https://api.github.com/users/clintropolis/orgs","repos_url":"https://api.github.com/users/clintropolis/repos","events_url":"https://api.github.com/users/clintropolis/events{/privacy}","received_events_url":"https://api.github.com/users/clintropolis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-28T20:07:36Z","updated_at":"2018-12-28T20:07:36Z","author_association":"MEMBER","body":"This branch was pretty far behind, for my sanity getting it on latest I've rebased and squashed history after I think addressing all but 1 comment [(centralized \"unsafe\")](https://github.com/apache/incubator-druid/pull/6016#discussion_r208354711). The commit history is [available here](https://github.com/clintropolis/druid/tree/shapeshift-history). I still need to resolve the FastPFOR situation as mentioned in my last comment, I'm looking into that next.\r\n\r\nI've re-ran 1 set of benchmarks, and this approach is still on top even after the lz4 performance improvements from #6478 \r\n![current](https://user-images.githubusercontent.com/1577461/50526745-0152fa00-0a99-11e9-9a8e-4243bd5ac00e.gif)\r\n","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450419504/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450481113","html_url":"https://github.com/apache/druid/issues/6788#issuecomment-450481113","issue_url":"https://api.github.com/repos/apache/druid/issues/6788","id":450481113,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDQ4MTExMw==","user":{"login":"licl2014","id":6941514,"node_id":"MDQ6VXNlcjY5NDE1MTQ=","avatar_url":"https://avatars.githubusercontent.com/u/6941514?v=4","gravatar_id":"","url":"https://api.github.com/users/licl2014","html_url":"https://github.com/licl2014","followers_url":"https://api.github.com/users/licl2014/followers","following_url":"https://api.github.com/users/licl2014/following{/other_user}","gists_url":"https://api.github.com/users/licl2014/gists{/gist_id}","starred_url":"https://api.github.com/users/licl2014/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/licl2014/subscriptions","organizations_url":"https://api.github.com/users/licl2014/orgs","repos_url":"https://api.github.com/users/licl2014/repos","events_url":"https://api.github.com/users/licl2014/events{/privacy}","received_events_url":"https://api.github.com/users/licl2014/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-29T10:02:32Z","updated_at":"2018-12-29T10:02:32Z","author_association":"CONTRIBUTOR","body":"it shoud be\r\n`public ConcurrentTimeCounter getFailedSendingTimeCounter()\r\n  {\r\n    return emittingThread.failedSendingTimeCounter;\r\n  }`","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450481113/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450481771","html_url":"https://github.com/apache/druid/pull/6778#issuecomment-450481771","issue_url":"https://api.github.com/repos/apache/druid/issues/6778","id":450481771,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDQ4MTc3MQ==","user":{"login":"JasonChoi27","id":25651737,"node_id":"MDQ6VXNlcjI1NjUxNzM3","avatar_url":"https://avatars.githubusercontent.com/u/25651737?v=4","gravatar_id":"","url":"https://api.github.com/users/JasonChoi27","html_url":"https://github.com/JasonChoi27","followers_url":"https://api.github.com/users/JasonChoi27/followers","following_url":"https://api.github.com/users/JasonChoi27/following{/other_user}","gists_url":"https://api.github.com/users/JasonChoi27/gists{/gist_id}","starred_url":"https://api.github.com/users/JasonChoi27/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JasonChoi27/subscriptions","organizations_url":"https://api.github.com/users/JasonChoi27/orgs","repos_url":"https://api.github.com/users/JasonChoi27/repos","events_url":"https://api.github.com/users/JasonChoi27/events{/privacy}","received_events_url":"https://api.github.com/users/JasonChoi27/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-29T10:13:16Z","updated_at":"2018-12-29T10:13:16Z","author_association":"NONE","body":"Actually, it has no need to set `AppenderRef` to `RollingFile` in default, so I change it to `Console`.\r\nBeyond that, in order to not effect the log appender of `Peon` process, I add a new parameter `druid.indexer.fork.property.log.appender.ref=Console` in the `middleManager/runtime.properties`. \r\n@drcrallen ","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450481771/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450483397","html_url":"https://github.com/apache/druid/issues/6789#issuecomment-450483397","issue_url":"https://api.github.com/repos/apache/druid/issues/6789","id":450483397,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDQ4MzM5Nw==","user":{"login":"pphust","id":17570553,"node_id":"MDQ6VXNlcjE3NTcwNTUz","avatar_url":"https://avatars.githubusercontent.com/u/17570553?v=4","gravatar_id":"","url":"https://api.github.com/users/pphust","html_url":"https://github.com/pphust","followers_url":"https://api.github.com/users/pphust/followers","following_url":"https://api.github.com/users/pphust/following{/other_user}","gists_url":"https://api.github.com/users/pphust/gists{/gist_id}","starred_url":"https://api.github.com/users/pphust/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pphust/subscriptions","organizations_url":"https://api.github.com/users/pphust/orgs","repos_url":"https://api.github.com/users/pphust/repos","events_url":"https://api.github.com/users/pphust/events{/privacy}","received_events_url":"https://api.github.com/users/pphust/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-29T10:39:06Z","updated_at":"2018-12-29T10:39:06Z","author_association":"CONTRIBUTOR","body":"I guess it should use one io.druid.storage.hdfs.HdfsDataSegmentPusher here","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450483397/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450575795","html_url":"https://github.com/apache/druid/pull/6336#issuecomment-450575795","issue_url":"https://api.github.com/repos/apache/druid/issues/6336","id":450575795,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDU3NTc5NQ==","user":{"login":"QiuMM","id":15156517,"node_id":"MDQ6VXNlcjE1MTU2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/15156517?v=4","gravatar_id":"","url":"https://api.github.com/users/QiuMM","html_url":"https://github.com/QiuMM","followers_url":"https://api.github.com/users/QiuMM/followers","following_url":"https://api.github.com/users/QiuMM/following{/other_user}","gists_url":"https://api.github.com/users/QiuMM/gists{/gist_id}","starred_url":"https://api.github.com/users/QiuMM/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/QiuMM/subscriptions","organizations_url":"https://api.github.com/users/QiuMM/orgs","repos_url":"https://api.github.com/users/QiuMM/repos","events_url":"https://api.github.com/users/QiuMM/events{/privacy}","received_events_url":"https://api.github.com/users/QiuMM/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-30T17:41:56Z","updated_at":"2018-12-30T17:49:05Z","author_association":"MEMBER","body":"@jihoonson @FaxianZhao I think I know why the overlord console loading slow after merged this PR, the reason is every index task request overlord to perform a segment allocate action and all tasks occupied a http handle thread which blocked at `TaskLockbox#doInCriticalSection`, so there are no idle threads or resources to response other requests.  The larger the cluster, the slower it will be. I tried to increase the value of `druid.server.http.numThreads` and allocate more cores for the overlord, but it's not helpful. In my view, this PR let we lose more than what we gained.  Taking minutes to open  the overlord console makes me feeling badly!","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450575795/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450603775","html_url":"https://github.com/apache/druid/pull/6336#issuecomment-450603775","issue_url":"https://api.github.com/repos/apache/druid/issues/6336","id":450603775,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDYwMzc3NQ==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-31T03:05:50Z","updated_at":"2018-12-31T03:05:50Z","author_association":"CONTRIBUTOR","body":"@QiuMM thank you for reporting! I think `TaskLockbox` potentially has this problem for all methods because they are coordinated by a single `giant` lock. I guess this becomes significant in large clusters when `allocatePendingSegment` is executed inside of `doInCriticalSection` because it's a heavy method.\r\n\r\nI think this PR is still useful because we can avoid the slow pending segment allocation problem caused by the race in `allocatePendingSegment`, but the solution may need to be improved. How about improving the lock granularity for taskLockbox? There's no need to use a single lock, but it can use more granular lock per dataSource per interval.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450603775/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450604466","html_url":"https://github.com/apache/druid/pull/6336#issuecomment-450604466","issue_url":"https://api.github.com/repos/apache/druid/issues/6336","id":450604466,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDYwNDQ2Ng==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-31T03:23:20Z","updated_at":"2018-12-31T03:23:20Z","author_association":"CONTRIBUTOR","body":"BTW, I guess your `pendingSegments` table might be very large if `allocatePendingSegment` takes too long. Does cleaning up old entries in `pendingSegments` table help?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450604466/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450610474","html_url":"https://github.com/apache/druid/pull/6336#issuecomment-450610474","issue_url":"https://api.github.com/repos/apache/druid/issues/6336","id":450610474,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDYxMDQ3NA==","user":{"login":"QiuMM","id":15156517,"node_id":"MDQ6VXNlcjE1MTU2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/15156517?v=4","gravatar_id":"","url":"https://api.github.com/users/QiuMM","html_url":"https://github.com/QiuMM","followers_url":"https://api.github.com/users/QiuMM/followers","following_url":"https://api.github.com/users/QiuMM/following{/other_user}","gists_url":"https://api.github.com/users/QiuMM/gists{/gist_id}","starred_url":"https://api.github.com/users/QiuMM/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/QiuMM/subscriptions","organizations_url":"https://api.github.com/users/QiuMM/orgs","repos_url":"https://api.github.com/users/QiuMM/repos","events_url":"https://api.github.com/users/QiuMM/events{/privacy}","received_events_url":"https://api.github.com/users/QiuMM/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-31T05:44:02Z","updated_at":"2018-12-31T17:52:35Z","author_association":"MEMBER","body":"> How about improving the lock granularity for taskLockbox? There's no need to use a single lock, but it can use more granular lock per dataSource per interval.\r\n\r\n@jihoonson I have tried like below:\r\n```java\r\n/**\r\n   * Perform the given action with a guarantee that we synchronize actions on the same (Datasource, Interval) pair.\r\n   * This method just checks that the pair of (Datasource, Interval) is valid, does not care about locks for the given\r\n   * task and interval, so you should care about the locks by yourself.\r\n   *\r\n   * @param task     task performing a {@link SyncDataSourceAndIntervalAction}\r\n   * @param interval interval\r\n   * @param action   action to be performed\r\n   */\r\n  public <T> T doInSyncDataSourceAndInterval(\r\n      Task task,\r\n      Interval interval,\r\n      SyncDataSourceAndIntervalAction<T> action\r\n  ) throws Exception\r\n  {\r\n    Pair<String, Interval> pair = dataSourceIntervals.getOrDefault(task.getDataSource(), new HashMap<>()).get(interval);\r\n    if (pair != null) {\r\n      synchronized (pair) {\r\n        return action.perform();\r\n      }\r\n    } else {\r\n      log.warn(\"Invalid dataSource and interval pair: (%s, %s), can not sync on it!\", task.getDataSource(), interval);\r\n      return null;\r\n    }\r\n  }\r\n```\r\nHowever, the overlord console still loading very slowly after I restart the overlord since all newly created tasks post a segment allocate action. But about one hours later, I didn't see any delay when open the console except the moment that all tasks start to allocate new segments. I think it's still terrible because every time I restart the overlord I would like to open the console to see the status of the overlord, It's hard to bear if it loading slow. Maybe we should not restart all tasks at the same moment, how about add some delay? \r\n\r\nBesides, after I use such granular lock, some errors occured:\r\n```\r\n2018-12-29 18:19:10,252 ERROR [qtp685428529-136] com.sun.jersey.spi.container.ContainerResponse - The RuntimeException could not be mapped to a response, re-throwing to the HTTP container\r\nio.druid.java.util.common.ISE: Segments not covered by locks for task: index_kafka_huoshan_all_map_3c8768ae0f0f563_ihpmdnek\r\n        at io.druid.indexing.common.actions.TaskActionPreconditions.checkLockCoversSegments(TaskActionPreconditions.java:45) ~[druid-indexing-service-0.12.2.jar:0.12.2]\r\n        at io.druid.indexing.common.actions.SegmentTransactionalInsertAction.perform(SegmentTransactionalInsertAction.java:107) ~[druid-indexing-service-0.12.2.jar:0.12.2]\r\n        at io.druid.indexing.common.actions.SegmentTransactionalInsertAction.perform(SegmentTransactionalInsertAction.java:47) ~[druid-indexing-service-0.12.2.jar:0.12.2]\r\n        at io.druid.indexing.common.actions.LocalTaskActionClient.submit(LocalTaskActionClient.java:64) ~[druid-indexing-service-0.12.2.jar:0.12.2]\r\n        at io.druid.indexing.overlord.http.OverlordResource$3.apply(OverlordResource.java:368) ~[druid-indexing-service-0.12.2.jar:0.12.2]\r\n        at io.druid.indexing.overlord.http.OverlordResource$3.apply(OverlordResource.java:357) ~[druid-indexing-service-0.12.2.jar:0.12.2]\r\n        at io.druid.indexing.overlord.http.OverlordResource.asLeaderWith(OverlordResource.java:683) ~[druid-indexing-service-0.12.2.jar:0.12.2]\r\n        at io.druid.indexing.overlord.http.OverlordResource.doAction(OverlordResource.java:354) ~[druid-indexing-service-0.12.2.jar:0.12.2]\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:1.8.0_131]\r\n        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:1.8.0_131]\r\n        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:1.8.0_131]\r\n        at java.lang.reflect.Method.invoke(Method.java:498) ~[?:1.8.0_131]\r\n```\r\nSuch error occurs after I restart the overlord and all newly created tasks would pending for some minutes which is weird and make me confused (I have never modified `SegmentTransactionalInsertAction`). But after all tasks are running normally, I never see any errors again.\r\n\r\n> BTW, I guess your pendingSegments table might be very large if allocatePendingSegment takes too long. Does cleaning up old entries in pendingSegments table help?\r\n\r\nI have already set `druid.coordinator.kill.pendingSegments.on` to true, so old entries would be cleaned up.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450610474/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450679442","html_url":"https://github.com/apache/druid/pull/6336#issuecomment-450679442","issue_url":"https://api.github.com/repos/apache/druid/issues/6336","id":450679442,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDY3OTQ0Mg==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-31T18:47:07Z","updated_at":"2018-12-31T18:47:07Z","author_association":"CONTRIBUTOR","body":"@QiuMM thank you for trying it out! I understand what you feel when the UI is very slow. We need to fix this.\r\n\r\nIt sounds like the too many concurrent segmentAllocateActions is causing this problem, but, I don't understand why it's still slow with the granular locking. The `segmentAllocateAction` calls 2 methods of `taskLockbox`. \r\n\r\n1) It calls `tryLock` to get a taskLock. This method is coordinated by a single `giant` lock.\r\n2) Once it gets a taskLock, it calls `allocatePendingSegmentAction` in `doInCriticalSection` or (`doInSyncDataSourceAndInterval`).\r\n\r\nBefore this PR, `2.` was executed outside of `doInCriticalSection`, so there was no coordination. And now with `doInSyncDataSourceAndInterval`, there should be no lock contention between tasks unless they are replica tasks. Then, I think this should work as it was before this PR (or work with a little lock contention between replicas). Do you know what method is the bottleneck exactly? Probably checking overlord's stack trace would be helpful.\r\n\r\nRegarding the exception of `io.druid.java.util.common.ISE: Segments not covered by locks for task`, this happens when a task tries to publish new segments and update the metadata store without a valid taskLock. Since the taskLock must be acquired before calling `allocatePendingSegmentAction` in `doInSyncDataSourceAndInterval`, I don't think this exception is related to the granular locking. Is it possible that some tasks revoked other task locks by any chance?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450679442/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450683860","html_url":"https://github.com/apache/druid/pull/6336#issuecomment-450683860","issue_url":"https://api.github.com/repos/apache/druid/issues/6336","id":450683860,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDY4Mzg2MA==","user":{"login":"QiuMM","id":15156517,"node_id":"MDQ6VXNlcjE1MTU2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/15156517?v=4","gravatar_id":"","url":"https://api.github.com/users/QiuMM","html_url":"https://github.com/QiuMM","followers_url":"https://api.github.com/users/QiuMM/followers","following_url":"https://api.github.com/users/QiuMM/following{/other_user}","gists_url":"https://api.github.com/users/QiuMM/gists{/gist_id}","starred_url":"https://api.github.com/users/QiuMM/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/QiuMM/subscriptions","organizations_url":"https://api.github.com/users/QiuMM/orgs","repos_url":"https://api.github.com/users/QiuMM/repos","events_url":"https://api.github.com/users/QiuMM/events{/privacy}","received_events_url":"https://api.github.com/users/QiuMM/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-31T19:38:21Z","updated_at":"2018-12-31T19:47:31Z","author_association":"MEMBER","body":">  there should be no lock contention between tasks unless they are replica tasks\r\n\r\n@jihoonson not only replica tasks, all tasks create by a supervisor would share same `TaskLock#groupId`, and in my scenario there are at most 600 tasks for a datasource.  So still many tasks share the same lock.\r\n\r\n> Since the taskLock must be acquired before calling allocatePendingSegmentAction in doInSyncDataSourceAndInterval, I don't think this exception is related to the granular locking.\r\n\r\nI'm not very sure about this, but I have also observed such exception even if I didn't use `doInSyncDataSourceAndInterval`.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450683860/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450685702","html_url":"https://github.com/apache/druid/pull/6791#issuecomment-450685702","issue_url":"https://api.github.com/repos/apache/druid/issues/6791","id":450685702,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDY4NTcwMg==","user":{"login":"glasser","id":16724,"node_id":"MDQ6VXNlcjE2NzI0","avatar_url":"https://avatars.githubusercontent.com/u/16724?v=4","gravatar_id":"","url":"https://api.github.com/users/glasser","html_url":"https://github.com/glasser","followers_url":"https://api.github.com/users/glasser/followers","following_url":"https://api.github.com/users/glasser/following{/other_user}","gists_url":"https://api.github.com/users/glasser/gists{/gist_id}","starred_url":"https://api.github.com/users/glasser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glasser/subscriptions","organizations_url":"https://api.github.com/users/glasser/orgs","repos_url":"https://api.github.com/users/glasser/repos","events_url":"https://api.github.com/users/glasser/events{/privacy}","received_events_url":"https://api.github.com/users/glasser/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-31T20:01:04Z","updated_at":"2018-12-31T20:01:04Z","author_association":"CONTRIBUTOR","body":"I realize I didn't add a test for this feature. The other tests in StatsDEmitterTest mock out the StatsDClient, and this change is primarily a change to the construction of that object.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450685702/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450693437","html_url":"https://github.com/apache/druid/pull/6336#issuecomment-450693437","issue_url":"https://api.github.com/repos/apache/druid/issues/6336","id":450693437,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDY5MzQzNw==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-31T21:52:52Z","updated_at":"2018-12-31T21:52:52Z","author_association":"CONTRIBUTOR","body":"I see. Since the lock contention can happen between tasks if they're writing into the interval of the same dataSource, 600 running tasks at the same time can cause this issue. If this is the case, before this PR, I think such many tasks could cause frequent pending segment allocation failures due to the allowed race in `allocatePendingSegments`. Those failed actions will be retried, but make segment allocation slow. Were you able to see this kind of problem before upgrade?\r\n\r\nMaybe we need to use separate http thread pools for API and UI. Also, maybe https://github.com/apache/incubator-druid/pull/6348 and https://github.com/apache/incubator-druid/pull/6356 would help though you said your pendingSegment table is small.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450693437/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450740873","html_url":"https://github.com/apache/druid/pull/6336#issuecomment-450740873","issue_url":"https://api.github.com/repos/apache/druid/issues/6336","id":450740873,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDc0MDg3Mw==","user":{"login":"QiuMM","id":15156517,"node_id":"MDQ6VXNlcjE1MTU2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/15156517?v=4","gravatar_id":"","url":"https://api.github.com/users/QiuMM","html_url":"https://github.com/QiuMM","followers_url":"https://api.github.com/users/QiuMM/followers","following_url":"https://api.github.com/users/QiuMM/following{/other_user}","gists_url":"https://api.github.com/users/QiuMM/gists{/gist_id}","starred_url":"https://api.github.com/users/QiuMM/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/QiuMM/subscriptions","organizations_url":"https://api.github.com/users/QiuMM/orgs","repos_url":"https://api.github.com/users/QiuMM/repos","events_url":"https://api.github.com/users/QiuMM/events{/privacy}","received_events_url":"https://api.github.com/users/QiuMM/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-01T16:19:36Z","updated_at":"2019-01-01T16:19:36Z","author_association":"MEMBER","body":"> Those failed actions will be retried, but make segment allocation slow. Were you able to see this kind of problem before upgrade?\r\n\r\nYeah, I'm going to see this problem. I'll let you know if I found something. And I think I know why the exception of `io.druid.java.util.common.ISE: Segments not covered by locks for task` occurred, the reason is I used `HeapMemoryTaskStorage`, so when I restarted the overlord all locks information lost.\r\nFor the table indexes, I had merged the PR before.\r\n\r\n> Maybe we need to use separate http thread pools for API and UI.\r\n\r\nThis is a good solution, but it seems not easy to do for Jetty Server.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450740873/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450765911","html_url":"https://github.com/apache/druid/pull/6336#issuecomment-450765911","issue_url":"https://api.github.com/repos/apache/druid/issues/6336","id":450765911,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDc2NTkxMQ==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-01T23:43:32Z","updated_at":"2019-01-01T23:43:32Z","author_association":"CONTRIBUTOR","body":"Thanks. I've checked some Jetty configurations and it looks that Jetty's QoS filter (https://www.eclipse.org/jetty/documentation/9.4.x/qos-filter.html) might help. We're already using this filter for task's chat handler and the lookup. I think we can use it for the overlord too. The max number of requests for internal API calls is limited by some new configurations like `maxRequests`, so that some HTTP threads are available for UI requests. What do you think?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450765911/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450767087","html_url":"https://github.com/apache/druid/pull/6791#issuecomment-450767087","issue_url":"https://api.github.com/repos/apache/druid/issues/6791","id":450767087,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDc2NzA4Nw==","user":{"login":"glasser","id":16724,"node_id":"MDQ6VXNlcjE2NzI0","avatar_url":"https://avatars.githubusercontent.com/u/16724?v=4","gravatar_id":"","url":"https://api.github.com/users/glasser","html_url":"https://github.com/glasser","followers_url":"https://api.github.com/users/glasser/followers","following_url":"https://api.github.com/users/glasser/following{/other_user}","gists_url":"https://api.github.com/users/glasser/gists{/gist_id}","starred_url":"https://api.github.com/users/glasser/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glasser/subscriptions","organizations_url":"https://api.github.com/users/glasser/orgs","repos_url":"https://api.github.com/users/glasser/repos","events_url":"https://api.github.com/users/glasser/events{/privacy}","received_events_url":"https://api.github.com/users/glasser/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T00:05:34Z","updated_at":"2019-01-02T00:05:34Z","author_association":"CONTRIBUTOR","body":"Thanks, addressed both comments.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450767087/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450778828","html_url":"https://github.com/apache/druid/pull/6336#issuecomment-450778828","issue_url":"https://api.github.com/repos/apache/druid/issues/6336","id":450778828,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDc3ODgyOA==","user":{"login":"QiuMM","id":15156517,"node_id":"MDQ6VXNlcjE1MTU2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/15156517?v=4","gravatar_id":"","url":"https://api.github.com/users/QiuMM","html_url":"https://github.com/QiuMM","followers_url":"https://api.github.com/users/QiuMM/followers","following_url":"https://api.github.com/users/QiuMM/following{/other_user}","gists_url":"https://api.github.com/users/QiuMM/gists{/gist_id}","starred_url":"https://api.github.com/users/QiuMM/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/QiuMM/subscriptions","organizations_url":"https://api.github.com/users/QiuMM/orgs","repos_url":"https://api.github.com/users/QiuMM/repos","events_url":"https://api.github.com/users/QiuMM/events{/privacy}","received_events_url":"https://api.github.com/users/QiuMM/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T02:47:08Z","updated_at":"2019-01-02T02:47:08Z","author_association":"MEMBER","body":"Sounds good, I'll have a try.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450778828/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450780812","html_url":"https://github.com/apache/druid/issues/6788#issuecomment-450780812","issue_url":"https://api.github.com/repos/apache/druid/issues/6788","id":450780812,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDc4MDgxMg==","user":{"login":"asdf2014","id":8108788,"node_id":"MDQ6VXNlcjgxMDg3ODg=","avatar_url":"https://avatars.githubusercontent.com/u/8108788?v=4","gravatar_id":"","url":"https://api.github.com/users/asdf2014","html_url":"https://github.com/asdf2014","followers_url":"https://api.github.com/users/asdf2014/followers","following_url":"https://api.github.com/users/asdf2014/following{/other_user}","gists_url":"https://api.github.com/users/asdf2014/gists{/gist_id}","starred_url":"https://api.github.com/users/asdf2014/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/asdf2014/subscriptions","organizations_url":"https://api.github.com/users/asdf2014/orgs","repos_url":"https://api.github.com/users/asdf2014/repos","events_url":"https://api.github.com/users/asdf2014/events{/privacy}","received_events_url":"https://api.github.com/users/asdf2014/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T03:15:40Z","updated_at":"2019-01-02T03:15:40Z","author_association":"MEMBER","body":"Thanks for reporting this, which has been fixed in #6793.\r\n","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450780812/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450806938","html_url":"https://github.com/apache/druid/pull/6764#issuecomment-450806938","issue_url":"https://api.github.com/repos/apache/druid/issues/6764","id":450806938,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDgwNjkzOA==","user":{"login":"richardstartin","id":16439049,"node_id":"MDQ6VXNlcjE2NDM5MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/16439049?v=4","gravatar_id":"","url":"https://api.github.com/users/richardstartin","html_url":"https://github.com/richardstartin","followers_url":"https://api.github.com/users/richardstartin/followers","following_url":"https://api.github.com/users/richardstartin/following{/other_user}","gists_url":"https://api.github.com/users/richardstartin/gists{/gist_id}","starred_url":"https://api.github.com/users/richardstartin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richardstartin/subscriptions","organizations_url":"https://api.github.com/users/richardstartin/orgs","repos_url":"https://api.github.com/users/richardstartin/repos","events_url":"https://api.github.com/users/richardstartin/events{/privacy}","received_events_url":"https://api.github.com/users/richardstartin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T08:22:55Z","updated_at":"2019-01-02T08:22:55Z","author_association":"MEMBER","body":"@clintropolis the change optimises *ordered* insertion, because it avoids binary search on the high 16 bits of the bitmap. The change is useless for unordered insertions.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450806938/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450807677","html_url":"https://github.com/apache/druid/pull/6764#issuecomment-450807677","issue_url":"https://api.github.com/repos/apache/druid/issues/6764","id":450807677,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDgwNzY3Nw==","user":{"login":"clintropolis","id":1577461,"node_id":"MDQ6VXNlcjE1Nzc0NjE=","avatar_url":"https://avatars.githubusercontent.com/u/1577461?v=4","gravatar_id":"","url":"https://api.github.com/users/clintropolis","html_url":"https://github.com/clintropolis","followers_url":"https://api.github.com/users/clintropolis/followers","following_url":"https://api.github.com/users/clintropolis/following{/other_user}","gists_url":"https://api.github.com/users/clintropolis/gists{/gist_id}","starred_url":"https://api.github.com/users/clintropolis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/clintropolis/subscriptions","organizations_url":"https://api.github.com/users/clintropolis/orgs","repos_url":"https://api.github.com/users/clintropolis/repos","events_url":"https://api.github.com/users/clintropolis/events{/privacy}","received_events_url":"https://api.github.com/users/clintropolis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T08:28:15Z","updated_at":"2019-01-02T08:28:15Z","author_association":"MEMBER","body":"Ah, I misread the PR description, :+1:","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450807677/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450810372","html_url":"https://github.com/apache/druid/pull/6793#issuecomment-450810372","issue_url":"https://api.github.com/repos/apache/druid/issues/6793","id":450810372,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDgxMDM3Mg==","user":{"login":"asdf2014","id":8108788,"node_id":"MDQ6VXNlcjgxMDg3ODg=","avatar_url":"https://avatars.githubusercontent.com/u/8108788?v=4","gravatar_id":"","url":"https://api.github.com/users/asdf2014","html_url":"https://github.com/asdf2014","followers_url":"https://api.github.com/users/asdf2014/followers","following_url":"https://api.github.com/users/asdf2014/following{/other_user}","gists_url":"https://api.github.com/users/asdf2014/gists{/gist_id}","starred_url":"https://api.github.com/users/asdf2014/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/asdf2014/subscriptions","organizations_url":"https://api.github.com/users/asdf2014/orgs","repos_url":"https://api.github.com/users/asdf2014/repos","events_url":"https://api.github.com/users/asdf2014/events{/privacy}","received_events_url":"https://api.github.com/users/asdf2014/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T08:45:42Z","updated_at":"2019-01-02T08:45:42Z","author_association":"MEMBER","body":"Hi, @nishantmonu51 . Thanks for your comments. It's done. PTAL.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450810372/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450812124","html_url":"https://github.com/apache/druid/pull/6793#issuecomment-450812124","issue_url":"https://api.github.com/repos/apache/druid/issues/6793","id":450812124,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDgxMjEyNA==","user":{"login":"nishantmonu51","id":5023786,"node_id":"MDQ6VXNlcjUwMjM3ODY=","avatar_url":"https://avatars.githubusercontent.com/u/5023786?v=4","gravatar_id":"","url":"https://api.github.com/users/nishantmonu51","html_url":"https://github.com/nishantmonu51","followers_url":"https://api.github.com/users/nishantmonu51/followers","following_url":"https://api.github.com/users/nishantmonu51/following{/other_user}","gists_url":"https://api.github.com/users/nishantmonu51/gists{/gist_id}","starred_url":"https://api.github.com/users/nishantmonu51/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nishantmonu51/subscriptions","organizations_url":"https://api.github.com/users/nishantmonu51/orgs","repos_url":"https://api.github.com/users/nishantmonu51/repos","events_url":"https://api.github.com/users/nishantmonu51/events{/privacy}","received_events_url":"https://api.github.com/users/nishantmonu51/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T08:56:49Z","updated_at":"2019-01-02T08:56:49Z","author_association":"MEMBER","body":"Thanks @asdf2014 ","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450812124/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450846465","html_url":"https://github.com/apache/druid/pull/6764#issuecomment-450846465","issue_url":"https://api.github.com/repos/apache/druid/issues/6764","id":450846465,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDg0NjQ2NQ==","user":{"login":"richardstartin","id":16439049,"node_id":"MDQ6VXNlcjE2NDM5MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/16439049?v=4","gravatar_id":"","url":"https://api.github.com/users/richardstartin","html_url":"https://github.com/richardstartin","followers_url":"https://api.github.com/users/richardstartin/followers","following_url":"https://api.github.com/users/richardstartin/following{/other_user}","gists_url":"https://api.github.com/users/richardstartin/gists{/gist_id}","starred_url":"https://api.github.com/users/richardstartin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richardstartin/subscriptions","organizations_url":"https://api.github.com/users/richardstartin/orgs","repos_url":"https://api.github.com/users/richardstartin/repos","events_url":"https://api.github.com/users/richardstartin/events{/privacy}","received_events_url":"https://api.github.com/users/richardstartin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T11:57:52Z","updated_at":"2019-01-02T11:59:51Z","author_association":"MEMBER","body":"@clintropolis You were right about where most of the performance came from. I cleaned up the commits a bit and ran against master.\r\n\r\nHere's the benchmark at `114a9fc38feda5f85799d24889007bc572d04dea` at 0.7.30\r\n\r\n```\r\nBenchmark                                  (bitmapAlgo)  (prob)   (size)  Mode  Cnt         Score         Error  Units\r\nBitmapIterationBenchmark.constructAndIter       roaring     0.0  1000000  avgt    5       130.624 ±       2.645  ns/op\r\nBitmapIterationBenchmark.constructAndIter       roaring   0.001  1000000  avgt    5     17553.925 ±    1177.041  ns/op\r\nBitmapIterationBenchmark.constructAndIter       roaring     0.1  1000000  avgt    5   1704213.394 ±   51487.534  ns/op\r\nBitmapIterationBenchmark.constructAndIter       roaring     0.5  1000000  avgt    5   6831889.531 ±  146377.716  ns/op\r\nBitmapIterationBenchmark.constructAndIter       roaring    0.99  1000000  avgt    5  13106844.584 ±  661339.555  ns/op\r\nBitmapIterationBenchmark.constructAndIter       roaring     1.0  1000000  avgt    5  15204652.686 ± 1441562.179  ns/op\r\n```\r\n\r\nHere's a slight improvement on this branch at `1afb602de27d31367440b1cccc86ec799c59dc4c` owing to reduced construction times.\r\n\r\n```\r\nBenchmark                                  (bitmapAlgo)  (prob)   (size)  Mode  Cnt         Score        Error  Units\r\nBitmapIterationBenchmark.constructAndIter       roaring     0.0  1000000  avgt    5       189.940 ±      3.313  ns/op\r\nBitmapIterationBenchmark.constructAndIter       roaring   0.001  1000000  avgt    5     13719.152 ±     42.376  ns/op\r\nBitmapIterationBenchmark.constructAndIter       roaring     0.1  1000000  avgt    5   1268587.758 ±  42864.087  ns/op\r\nBitmapIterationBenchmark.constructAndIter       roaring     0.5  1000000  avgt    5   4658899.187 ± 163463.751  ns/op\r\nBitmapIterationBenchmark.constructAndIter       roaring    0.99  1000000  avgt    5  10556288.928 ± 212975.696  ns/op\r\nBitmapIterationBenchmark.constructAndIter       roaring     1.0  1000000  avgt    5  11036729.972 ± 346125.258  ns/op\r\n```\r\n\r\nPS this has been squashed and force pushed so take another look.\r\n","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450846465/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450848581","html_url":"https://github.com/apache/druid/pull/6764#issuecomment-450848581","issue_url":"https://api.github.com/repos/apache/druid/issues/6764","id":450848581,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDg0ODU4MQ==","user":{"login":"richardstartin","id":16439049,"node_id":"MDQ6VXNlcjE2NDM5MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/16439049?v=4","gravatar_id":"","url":"https://api.github.com/users/richardstartin","html_url":"https://github.com/richardstartin","followers_url":"https://api.github.com/users/richardstartin/followers","following_url":"https://api.github.com/users/richardstartin/following{/other_user}","gists_url":"https://api.github.com/users/richardstartin/gists{/gist_id}","starred_url":"https://api.github.com/users/richardstartin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/richardstartin/subscriptions","organizations_url":"https://api.github.com/users/richardstartin/orgs","repos_url":"https://api.github.com/users/richardstartin/repos","events_url":"https://api.github.com/users/richardstartin/events{/privacy}","received_events_url":"https://api.github.com/users/richardstartin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T12:09:54Z","updated_at":"2019-01-02T12:09:54Z","author_association":"MEMBER","body":"In fact, here's a benchmark to isolate the construction time from the iteration time:\r\n\r\n```java\r\n  @Benchmark\r\n  public Object construct(ConstructAndIterState state)\r\n  {\r\n    int dataSize = state.dataSize;\r\n    int[] data = state.data;\r\n    MutableBitmap mutableBitmap = factory.makeEmptyMutableBitmap();\r\n    for (int i = 0; i < dataSize; i++) {\r\n      mutableBitmap.add(data[i]);\r\n    }\r\n    return factory.makeImmutableBitmap(mutableBitmap);\r\n  }\r\n```\r\n\r\nand at `114a9fc38feda5f85799d24889007bc572d04dea` (master) I get\r\n\r\n```\r\nBenchmark                           (bitmapAlgo)  (prob)   (size)  Mode  Cnt         Score        Error  Units\r\nBitmapIterationBenchmark.construct       roaring     0.0  1000000  avgt    5       124.236 ±      6.597  ns/op\r\nBitmapIterationBenchmark.construct       roaring   0.001  1000000  avgt    5     14045.045 ±   1026.400  ns/op\r\nBitmapIterationBenchmark.construct       roaring     0.1  1000000  avgt    5   1317274.340 ± 153275.511  ns/op\r\nBitmapIterationBenchmark.construct       roaring     0.5  1000000  avgt    5   7415001.388 ± 377532.457  ns/op\r\nBitmapIterationBenchmark.construct       roaring    0.99  1000000  avgt    5  10687372.213 ± 860813.095  ns/op\r\nBitmapIterationBenchmark.construct       roaring     1.0  1000000  avgt    5  10790794.579 ± 961663.105  ns/op\r\n```\r\n\r\nAnd at `1afb602de27d31367440b1cccc86ec799c59dc4c` (this PR) I get:\r\n\r\n```\r\nBenchmark                           (bitmapAlgo)  (prob)   (size)  Mode  Cnt        Score        Error  Units\r\nBitmapIterationBenchmark.construct       roaring     0.0  1000000  avgt    5      187.924 ±     12.126  ns/op\r\nBitmapIterationBenchmark.construct       roaring   0.001  1000000  avgt    5    12674.625 ±    267.506  ns/op\r\nBitmapIterationBenchmark.construct       roaring     0.1  1000000  avgt    5   868981.551 ±  21139.938  ns/op\r\nBitmapIterationBenchmark.construct       roaring     0.5  1000000  avgt    5  3391372.332 ±  86345.168  ns/op\r\nBitmapIterationBenchmark.construct       roaring    0.99  1000000  avgt    5  7314761.225 ± 335907.952  ns/op\r\nBitmapIterationBenchmark.construct       roaring     1.0  1000000  avgt    5  7147180.460 ± 107730.956  ns/op\r\n\r\n```\r\n\r\nSo there's a good boost to be had from avoiding the binary searches, and it sounds like druid does write its bitmaps in an ordered fashion.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450848581/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450907420","html_url":"https://github.com/apache/druid/issues/5855#issuecomment-450907420","issue_url":"https://api.github.com/repos/apache/druid/issues/5855","id":450907420,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDkwNzQyMA==","user":{"login":"abhijain1351","id":20940689,"node_id":"MDQ6VXNlcjIwOTQwNjg5","avatar_url":"https://avatars.githubusercontent.com/u/20940689?v=4","gravatar_id":"","url":"https://api.github.com/users/abhijain1351","html_url":"https://github.com/abhijain1351","followers_url":"https://api.github.com/users/abhijain1351/followers","following_url":"https://api.github.com/users/abhijain1351/following{/other_user}","gists_url":"https://api.github.com/users/abhijain1351/gists{/gist_id}","starred_url":"https://api.github.com/users/abhijain1351/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abhijain1351/subscriptions","organizations_url":"https://api.github.com/users/abhijain1351/orgs","repos_url":"https://api.github.com/users/abhijain1351/repos","events_url":"https://api.github.com/users/abhijain1351/events{/privacy}","received_events_url":"https://api.github.com/users/abhijain1351/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T16:17:07Z","updated_at":"2019-01-02T16:17:07Z","author_association":"NONE","body":"For which service is this happening?\r\nCoordinator or historical?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450907420/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450940038","html_url":"https://github.com/apache/druid/pull/6794#issuecomment-450940038","issue_url":"https://api.github.com/repos/apache/druid/issues/6794","id":450940038,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDk0MDAzOA==","user":{"login":"drcrallen","id":8213081,"node_id":"MDQ6VXNlcjgyMTMwODE=","avatar_url":"https://avatars.githubusercontent.com/u/8213081?v=4","gravatar_id":"","url":"https://api.github.com/users/drcrallen","html_url":"https://github.com/drcrallen","followers_url":"https://api.github.com/users/drcrallen/followers","following_url":"https://api.github.com/users/drcrallen/following{/other_user}","gists_url":"https://api.github.com/users/drcrallen/gists{/gist_id}","starred_url":"https://api.github.com/users/drcrallen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drcrallen/subscriptions","organizations_url":"https://api.github.com/users/drcrallen/orgs","repos_url":"https://api.github.com/users/drcrallen/repos","events_url":"https://api.github.com/users/drcrallen/events{/privacy}","received_events_url":"https://api.github.com/users/drcrallen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T18:16:56Z","updated_at":"2019-01-02T18:16:56Z","author_association":"CONTRIBUTOR","body":"Very cool, I think both @xvrl and @nishantmonu51 may have taken a hack at this previously as well. There is even https://github.com/metamx/druid/tree/gpudruid if anyone wants to peek at super old code. Looking forward to see how this patch performs","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450940038/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450946134","html_url":"https://github.com/apache/druid/pull/6794#issuecomment-450946134","issue_url":"https://api.github.com/repos/apache/druid/issues/6794","id":450946134,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDk0NjEzNA==","user":{"login":"gianm","id":1214075,"node_id":"MDQ6VXNlcjEyMTQwNzU=","avatar_url":"https://avatars.githubusercontent.com/u/1214075?v=4","gravatar_id":"","url":"https://api.github.com/users/gianm","html_url":"https://github.com/gianm","followers_url":"https://api.github.com/users/gianm/followers","following_url":"https://api.github.com/users/gianm/following{/other_user}","gists_url":"https://api.github.com/users/gianm/gists{/gist_id}","starred_url":"https://api.github.com/users/gianm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gianm/subscriptions","organizations_url":"https://api.github.com/users/gianm/orgs","repos_url":"https://api.github.com/users/gianm/repos","events_url":"https://api.github.com/users/gianm/events{/privacy}","received_events_url":"https://api.github.com/users/gianm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T18:39:12Z","updated_at":"2019-01-02T18:39:12Z","author_association":"CONTRIBUTOR","body":"There's some benchmarks in the description (https://static.imply.io/gianm/vb.html) & I have also run some queries on a real cluster and seen similar speedups. Although notably, topN isn't vectorized in this patch, and contributions are welcome on that one 😄. I would expect speedup ratios there similar to groupBy, maybe a bit less since topN already has some optimizations targeted at reducing method call overhead (the monomorphic specialization system).\r\n\r\nThere's some TeamCity inspections going bump because of unused stuff. Most of it is there for a reason so I'll add some comments that hopefully make the inspections happy.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450946134/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450946224","html_url":"https://github.com/apache/druid/pull/6778#issuecomment-450946224","issue_url":"https://api.github.com/repos/apache/druid/issues/6778","id":450946224,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDk0NjIyNA==","user":{"login":"drcrallen","id":8213081,"node_id":"MDQ6VXNlcjgyMTMwODE=","avatar_url":"https://avatars.githubusercontent.com/u/8213081?v=4","gravatar_id":"","url":"https://api.github.com/users/drcrallen","html_url":"https://github.com/drcrallen","followers_url":"https://api.github.com/users/drcrallen/followers","following_url":"https://api.github.com/users/drcrallen/following{/other_user}","gists_url":"https://api.github.com/users/drcrallen/gists{/gist_id}","starred_url":"https://api.github.com/users/drcrallen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drcrallen/subscriptions","organizations_url":"https://api.github.com/users/drcrallen/orgs","repos_url":"https://api.github.com/users/drcrallen/repos","events_url":"https://api.github.com/users/drcrallen/events{/privacy}","received_events_url":"https://api.github.com/users/drcrallen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T18:39:33Z","updated_at":"2019-01-02T18:39:33Z","author_association":"CONTRIBUTOR","body":"What I mean is, all of these changes can be made by an administrator locally. Any production deployment really should be managing their own log4j2.xml. Changing the default (and intentionally simple) config can change behavior in unexpected ways.\r\n\r\nWithout strong evidence why simply changing it in a local deployment is insufficient (see https://logging.apache.org/log4j/2.x/manual/configuration.html for many configuration options) I am 👎 ","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450946224/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450958932","html_url":"https://github.com/apache/druid/pull/6629#issuecomment-450958932","issue_url":"https://api.github.com/repos/apache/druid/issues/6629","id":450958932,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDk1ODkzMg==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T19:25:24Z","updated_at":"2019-01-02T19:25:24Z","author_association":"CONTRIBUTOR","body":"@drcrallen thanks for the review, but I'll change my implementation based on the discussion with @leventov. (See https://github.com/apache/incubator-druid/pull/6629#discussion_r242156826.) Probably I'll close this and raise another PR.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450958932/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450962842","html_url":"https://github.com/apache/druid/pull/6581#issuecomment-450962842","issue_url":"https://api.github.com/repos/apache/druid/issues/6581","id":450962842,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDk2Mjg0Mg==","user":{"login":"jon-wei","id":8729063,"node_id":"MDQ6VXNlcjg3MjkwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8729063?v=4","gravatar_id":"","url":"https://api.github.com/users/jon-wei","html_url":"https://github.com/jon-wei","followers_url":"https://api.github.com/users/jon-wei/followers","following_url":"https://api.github.com/users/jon-wei/following{/other_user}","gists_url":"https://api.github.com/users/jon-wei/gists{/gist_id}","starred_url":"https://api.github.com/users/jon-wei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jon-wei/subscriptions","organizations_url":"https://api.github.com/users/jon-wei/orgs","repos_url":"https://api.github.com/users/jon-wei/repos","events_url":"https://api.github.com/users/jon-wei/events{/privacy}","received_events_url":"https://api.github.com/users/jon-wei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T19:39:23Z","updated_at":"2019-01-02T19:39:23Z","author_association":"CONTRIBUTOR","body":"@edgan8 Is this ready for review again?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450962842/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450967839","html_url":"https://github.com/apache/druid/pull/6794#issuecomment-450967839","issue_url":"https://api.github.com/repos/apache/druid/issues/6794","id":450967839,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDk2NzgzOQ==","user":{"login":"gianm","id":1214075,"node_id":"MDQ6VXNlcjEyMTQwNzU=","avatar_url":"https://avatars.githubusercontent.com/u/1214075?v=4","gravatar_id":"","url":"https://api.github.com/users/gianm","html_url":"https://github.com/gianm","followers_url":"https://api.github.com/users/gianm/followers","following_url":"https://api.github.com/users/gianm/following{/other_user}","gists_url":"https://api.github.com/users/gianm/gists{/gist_id}","starred_url":"https://api.github.com/users/gianm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gianm/subscriptions","organizations_url":"https://api.github.com/users/gianm/orgs","repos_url":"https://api.github.com/users/gianm/repos","events_url":"https://api.github.com/users/gianm/events{/privacy}","received_events_url":"https://api.github.com/users/gianm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T19:57:35Z","updated_at":"2019-01-02T19:57:35Z","author_association":"CONTRIBUTOR","body":"Updated the top comment to be more proposal-y following discussion on the dev list.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450967839/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450972331","html_url":"https://github.com/apache/druid/pull/6794#issuecomment-450972331","issue_url":"https://api.github.com/repos/apache/druid/issues/6794","id":450972331,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDk3MjMzMQ==","user":{"login":"b-slim","id":7376396,"node_id":"MDQ6VXNlcjczNzYzOTY=","avatar_url":"https://avatars.githubusercontent.com/u/7376396?v=4","gravatar_id":"","url":"https://api.github.com/users/b-slim","html_url":"https://github.com/b-slim","followers_url":"https://api.github.com/users/b-slim/followers","following_url":"https://api.github.com/users/b-slim/following{/other_user}","gists_url":"https://api.github.com/users/b-slim/gists{/gist_id}","starred_url":"https://api.github.com/users/b-slim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/b-slim/subscriptions","organizations_url":"https://api.github.com/users/b-slim/orgs","repos_url":"https://api.github.com/users/b-slim/repos","events_url":"https://api.github.com/users/b-slim/events{/privacy}","received_events_url":"https://api.github.com/users/b-slim/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T20:15:38Z","updated_at":"2019-01-02T20:15:38Z","author_association":"CONTRIBUTOR","body":"> Updated the top comment to be more proposal-y following discussion on the dev list.\r\n\r\nI do not think this is going to work, because the updates to the description is something that only authors are doing and there is no tracking for history.\r\nAlso take the example of Rejected approach, not sure whom had rejected that ? and whom thought does reflects.\r\nIn fact, i might not agree that Apache Arrow is not a good candidate, in fact am looking to see if we can use it to stream bulk data from Druid and expose it a standard interface to export data to another execution engine...\r\n","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450972331/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450977406","html_url":"https://github.com/apache/druid/pull/6794#issuecomment-450977406","issue_url":"https://api.github.com/repos/apache/druid/issues/6794","id":450977406,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDk3NzQwNg==","user":{"login":"gianm","id":1214075,"node_id":"MDQ6VXNlcjEyMTQwNzU=","avatar_url":"https://avatars.githubusercontent.com/u/1214075?v=4","gravatar_id":"","url":"https://api.github.com/users/gianm","html_url":"https://github.com/gianm","followers_url":"https://api.github.com/users/gianm/followers","following_url":"https://api.github.com/users/gianm/following{/other_user}","gists_url":"https://api.github.com/users/gianm/gists{/gist_id}","starred_url":"https://api.github.com/users/gianm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gianm/subscriptions","organizations_url":"https://api.github.com/users/gianm/orgs","repos_url":"https://api.github.com/users/gianm/repos","events_url":"https://api.github.com/users/gianm/events{/privacy}","received_events_url":"https://api.github.com/users/gianm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T20:35:32Z","updated_at":"2019-01-02T20:35:32Z","author_association":"CONTRIBUTOR","body":"> I do not think this is going to work, because the updates to the description is something that only authors are doing and there is no tracking for history.\r\n\r\nThere is history (click \"edited\" in the top bar of the comment). I don't think there's anything wrong with edits coming from the author of the proposal, so long as they reflect community discussion.\r\n\r\n> Also take the example of Rejected approach, not sure whom had rejected that ? and whom thought does reflects.\r\n\r\nI used the Kafka template from https://cwiki.apache.org/confluence/display/KAFKA/Kafka+Improvement+Proposals. As I understand it, this section means \"rejected by the author of the proposal\", and is meant to help reflect the author's thinking in the course of developing the proposal. In the current version it reflects my thinking alone. I would update it to reflect community discussion.\r\n\r\n> In fact, i might not agree that Apache Arrow is not a good candidate, in fact am looking to see if we can use it to stream bulk data from Druid and expose it a standard interface to export data to another execution engine...\r\n\r\nThat sounds like a good discussion point!! Would love to hear any more thoughts you have on this topic. As I see it- supporting Arrow as an export interface and using it internally are two different things and could happen independently of each other. There is also a potential case to be made around using Arrow for the later stages of query execution, after per-segment processing, even if it's not used for per-segment processing. Druid doesn't currently always use optimized data structures for this phase (there's a lot of in-heap Java objects involved, and some glaring inefficiencies like representing rows using LinkedHashMaps).\r\n\r\nFwiw, the KIP process suggests the following for discussion,\r\n\r\n> Start a [DISCUSS] thread on the Apache mailing list. Please ensure that the subject of the thread is of the format [DISCUSS] KIP-{your KIP number} {your KIP heading} The discussion should happen on the mailing list not on the wiki since the wiki comment system doesn't work well for larger discussions. In the process of the discussion you may update the proposal. You should let people know the changes you are making.\r\n\r\nIf we want to try something similar -- we can do that in comments for this PR.\r\n\r\nDo you think that will work?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450977406/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450982419","html_url":"https://github.com/apache/druid/pull/6794#issuecomment-450982419","issue_url":"https://api.github.com/repos/apache/druid/issues/6794","id":450982419,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDk4MjQxOQ==","user":{"login":"gianm","id":1214075,"node_id":"MDQ6VXNlcjEyMTQwNzU=","avatar_url":"https://avatars.githubusercontent.com/u/1214075?v=4","gravatar_id":"","url":"https://api.github.com/users/gianm","html_url":"https://github.com/gianm","followers_url":"https://api.github.com/users/gianm/followers","following_url":"https://api.github.com/users/gianm/following{/other_user}","gists_url":"https://api.github.com/users/gianm/gists{/gist_id}","starred_url":"https://api.github.com/users/gianm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gianm/subscriptions","organizations_url":"https://api.github.com/users/gianm/orgs","repos_url":"https://api.github.com/users/gianm/repos","events_url":"https://api.github.com/users/gianm/events{/privacy}","received_events_url":"https://api.github.com/users/gianm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T20:56:04Z","updated_at":"2019-01-02T20:56:46Z","author_association":"CONTRIBUTOR","body":"Some previous discussion on Arrow as an export format in particular: https://github.com/apache/incubator-druid/issues/3891 (should be largely unrelated to this proposal, which is concerned with internal processing, not export).","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450982419/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450982648","html_url":"https://github.com/apache/druid/pull/6629#issuecomment-450982648","issue_url":"https://api.github.com/repos/apache/druid/issues/6629","id":450982648,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDk4MjY0OA==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T20:57:06Z","updated_at":"2019-01-02T20:57:06Z","author_association":"CONTRIBUTOR","body":"I'm closing this PR. Will raise a new one later.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450982648/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450985151","html_url":"https://github.com/apache/druid/pull/6794#issuecomment-450985151","issue_url":"https://api.github.com/repos/apache/druid/issues/6794","id":450985151,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDk4NTE1MQ==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T21:07:11Z","updated_at":"2019-01-02T21:07:11Z","author_association":"CONTRIBUTOR","body":"> There is history (click \"edited\" in the top bar of the comment). I don't think there's anything wrong with edits coming from the author of the proposal, so long as they reflect community discussion.\r\n\r\nThis is true, but I would like to suggest to use a better tool for easy discussion. I think the proposal will be usually large, which means it's not easy to point some particular parts of the proposal. Probably we can use Github PR for the proposals as well, so that people can easily leave comments.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450985151/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450986975","html_url":"https://github.com/apache/druid/pull/6782#issuecomment-450986975","issue_url":"https://api.github.com/repos/apache/druid/issues/6782","id":450986975,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDk4Njk3NQ==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T21:14:06Z","updated_at":"2019-01-02T21:14:06Z","author_association":"CONTRIBUTOR","body":"@nishantmonu51 thanks for the review. I've addressed your comments.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450986975/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/450996611","html_url":"https://github.com/apache/druid/pull/6794#issuecomment-450996611","issue_url":"https://api.github.com/repos/apache/druid/issues/6794","id":450996611,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MDk5NjYxMQ==","user":{"login":"b-slim","id":7376396,"node_id":"MDQ6VXNlcjczNzYzOTY=","avatar_url":"https://avatars.githubusercontent.com/u/7376396?v=4","gravatar_id":"","url":"https://api.github.com/users/b-slim","html_url":"https://github.com/b-slim","followers_url":"https://api.github.com/users/b-slim/followers","following_url":"https://api.github.com/users/b-slim/following{/other_user}","gists_url":"https://api.github.com/users/b-slim/gists{/gist_id}","starred_url":"https://api.github.com/users/b-slim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/b-slim/subscriptions","organizations_url":"https://api.github.com/users/b-slim/orgs","repos_url":"https://api.github.com/users/b-slim/repos","events_url":"https://api.github.com/users/b-slim/events{/privacy}","received_events_url":"https://api.github.com/users/b-slim/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T21:52:21Z","updated_at":"2019-01-02T21:52:21Z","author_association":"CONTRIBUTOR","body":"> If we want to try something similar -- we can do that in comments for this PR.\r\n\r\nAs i said i am not targeting per-say  this PR. Ideally would love to see a formal agreement about the process on the dev mailing list and then maybe start implementing it on this PR if possible.\r\n\r\n> There is history (click \"edited\" in the top bar of the comment). I don't think there's anything wrong with edits coming from the author of the proposal, so long as they reflect community discussion.\r\n\r\nThanks i guess i learned new thing today.\r\n\r\nFYI as a side note I honestly  prefer a separation between Code reviewing and Proposal reviewing discussion , for the simple reason that when the code review starts it will introduce a lot of noise about the implementation details and therefore all the discussion about design will be lost or not possible to sort out, In fact Github pages becomes unloadable once we get bunch of comments.  \r\n","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/450996611/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451004778","html_url":"https://github.com/apache/druid/pull/6758#issuecomment-451004778","issue_url":"https://api.github.com/repos/apache/druid/issues/6758","id":451004778,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTAwNDc3OA==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T22:26:55Z","updated_at":"2019-01-02T22:26:55Z","author_association":"CONTRIBUTOR","body":"@jon-wei thanks for the review. I updated the docs. Besides, I changed the behavior of the keepSegmentGranularity and segmentGranularity to remove keepSegmentGranularity easily in the future. The changed behavior is:\r\n\r\nSegmentGranularity | keepSegmentGranularity | Used SegmentGranularity \r\n---------------------|--------------------------|---------------------------\r\nNon-null | True | Error\r\nNon-null | False | Given segmentGranularity\r\nNon-null | Null | Given segmentGranularity\r\nNull | True | Original segmentGranularity\r\nNull | False | ALL segmentGranularity\r\nNull | Null | Original segmentGranularity","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451004778/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451009824","html_url":"https://github.com/apache/druid/pull/6683#issuecomment-451009824","issue_url":"https://api.github.com/repos/apache/druid/issues/6683","id":451009824,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTAwOTgyNA==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-02T22:49:42Z","updated_at":"2019-01-02T22:54:12Z","author_association":"CONTRIBUTOR","body":"Hi @kaijianding, I still don't understand why you have such many watchers. In Druid, only master nodes (brokers, coordinator, overlord if you use zk-based remoteTaskRunner) watch such announcements. For example, `AbstractCuratorServerInventoryView` watches `/some/zk/path/announcements` which is used only in brokers and the coordinator. Similarly, `/some/zk/path/listeners/lookups/` is watched only by the coordinator (`LookupCoordinatorManager`). Are you seeing that other modules like tasks are also watching those zk paths?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451009824/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451025041","html_url":"https://github.com/apache/druid/pull/6797#issuecomment-451025041","issue_url":"https://api.github.com/repos/apache/druid/issues/6797","id":451025041,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTAyNTA0MQ==","user":{"login":"fjy","id":428325,"node_id":"MDQ6VXNlcjQyODMyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/428325?v=4","gravatar_id":"","url":"https://api.github.com/users/fjy","html_url":"https://github.com/fjy","followers_url":"https://api.github.com/users/fjy/followers","following_url":"https://api.github.com/users/fjy/following{/other_user}","gists_url":"https://api.github.com/users/fjy/gists{/gist_id}","starred_url":"https://api.github.com/users/fjy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fjy/subscriptions","organizations_url":"https://api.github.com/users/fjy/orgs","repos_url":"https://api.github.com/users/fjy/repos","events_url":"https://api.github.com/users/fjy/events{/privacy}","received_events_url":"https://api.github.com/users/fjy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T00:14:58Z","updated_at":"2019-01-03T00:14:58Z","author_association":"CONTRIBUTOR","body":"@shivtools @amalakar was this supposed to be pushed to an internal branch?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451025041/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451025191","html_url":"https://github.com/apache/druid/pull/6797#issuecomment-451025191","issue_url":"https://api.github.com/repos/apache/druid/issues/6797","id":451025191,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTAyNTE5MQ==","user":{"login":"shivtools","id":12538052,"node_id":"MDQ6VXNlcjEyNTM4MDUy","avatar_url":"https://avatars.githubusercontent.com/u/12538052?v=4","gravatar_id":"","url":"https://api.github.com/users/shivtools","html_url":"https://github.com/shivtools","followers_url":"https://api.github.com/users/shivtools/followers","following_url":"https://api.github.com/users/shivtools/following{/other_user}","gists_url":"https://api.github.com/users/shivtools/gists{/gist_id}","starred_url":"https://api.github.com/users/shivtools/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shivtools/subscriptions","organizations_url":"https://api.github.com/users/shivtools/orgs","repos_url":"https://api.github.com/users/shivtools/repos","events_url":"https://api.github.com/users/shivtools/events{/privacy}","received_events_url":"https://api.github.com/users/shivtools/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T00:15:57Z","updated_at":"2019-01-03T00:15:57Z","author_association":"CONTRIBUTOR","body":"@fjy yes, my apologies for the mistake. ","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451025191/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451040262","html_url":"https://github.com/apache/druid/pull/6581#issuecomment-451040262","issue_url":"https://api.github.com/repos/apache/druid/issues/6581","id":451040262,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTA0MDI2Mg==","user":{"login":"edgan8","id":2577963,"node_id":"MDQ6VXNlcjI1Nzc5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/2577963?v=4","gravatar_id":"","url":"https://api.github.com/users/edgan8","html_url":"https://github.com/edgan8","followers_url":"https://api.github.com/users/edgan8/followers","following_url":"https://api.github.com/users/edgan8/following{/other_user}","gists_url":"https://api.github.com/users/edgan8/gists{/gist_id}","starred_url":"https://api.github.com/users/edgan8/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edgan8/subscriptions","organizations_url":"https://api.github.com/users/edgan8/orgs","repos_url":"https://api.github.com/users/edgan8/repos","events_url":"https://api.github.com/users/edgan8/events{/privacy}","received_events_url":"https://api.github.com/users/edgan8/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T02:08:32Z","updated_at":"2019-01-03T02:08:32Z","author_association":"CONTRIBUTOR","body":"@jon-wei not yet, I need to write the documentation and fix some more issues. Will ping this thread in the next day or two!","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451040262/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451040874","html_url":"https://github.com/apache/druid/pull/6794#issuecomment-451040874","issue_url":"https://api.github.com/repos/apache/druid/issues/6794","id":451040874,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTA0MDg3NA==","user":{"login":"gianm","id":1214075,"node_id":"MDQ6VXNlcjEyMTQwNzU=","avatar_url":"https://avatars.githubusercontent.com/u/1214075?v=4","gravatar_id":"","url":"https://api.github.com/users/gianm","html_url":"https://github.com/gianm","followers_url":"https://api.github.com/users/gianm/followers","following_url":"https://api.github.com/users/gianm/following{/other_user}","gists_url":"https://api.github.com/users/gianm/gists{/gist_id}","starred_url":"https://api.github.com/users/gianm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gianm/subscriptions","organizations_url":"https://api.github.com/users/gianm/orgs","repos_url":"https://api.github.com/users/gianm/repos","events_url":"https://api.github.com/users/gianm/events{/privacy}","received_events_url":"https://api.github.com/users/gianm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T02:14:05Z","updated_at":"2019-01-03T02:14:55Z","author_association":"CONTRIBUTOR","body":"Sounds good, let's take that part of the discussion to the mailing list. Still very open to comments on this particular change though.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451040874/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451041341","html_url":"https://github.com/apache/druid/pull/6798#issuecomment-451041341","issue_url":"https://api.github.com/repos/apache/druid/issues/6798","id":451041341,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTA0MTM0MQ==","user":{"login":"drcrallen","id":8213081,"node_id":"MDQ6VXNlcjgyMTMwODE=","avatar_url":"https://avatars.githubusercontent.com/u/8213081?v=4","gravatar_id":"","url":"https://api.github.com/users/drcrallen","html_url":"https://github.com/drcrallen","followers_url":"https://api.github.com/users/drcrallen/followers","following_url":"https://api.github.com/users/drcrallen/following{/other_user}","gists_url":"https://api.github.com/users/drcrallen/gists{/gist_id}","starred_url":"https://api.github.com/users/drcrallen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drcrallen/subscriptions","organizations_url":"https://api.github.com/users/drcrallen/orgs","repos_url":"https://api.github.com/users/drcrallen/repos","events_url":"https://api.github.com/users/drcrallen/events{/privacy}","received_events_url":"https://api.github.com/users/drcrallen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T02:17:58Z","updated_at":"2019-01-03T02:17:58Z","author_association":"CONTRIBUTOR","body":"For RAT I'm getting\r\n\r\n```\r\nFiles with unapproved licenses:\r\n\r\n  /Users/charles.allen/src/druid/extensions-core/grpc/target/rat.txt\r\n  /Users/charles.allen/src/druid/extensions-core/grpc/target/imports.xml\r\n  /Users/charles.allen/src/druid/extensions-core/grpc/target/checkstyle-cachefile\r\n  /Users/charles.allen/src/druid/extensions-core/grpc/target/checkstyle-result.xml\r\n  /Users/charles.allen/src/druid/extensions-core/grpc/target/pmd.xml\r\n  /Users/charles.allen/src/druid/extensions-core/grpc/target/maven-status/maven-compiler-plugin/testCompile/default-testCompile/inputFiles.lst\r\n  /Users/charles.allen/src/druid/extensions-core/grpc/target/maven-status/maven-compiler-plugin/testCompile/default-testCompile/createdFiles.lst\r\n  /Users/charles.allen/src/druid/extensions-core/grpc/target/maven-status/maven-compiler-plugin/compile/default-compile/inputFiles.lst\r\n  /Users/charles.allen/src/druid/extensions-core/grpc/target/maven-status/maven-compiler-plugin/compile/default-compile/createdFiles.lst\r\n  /Users/charles.allen/src/druid/extensions-core/grpc/target/maven-archiver/pom.properties\r\n  /Users/charles.allen/src/druid/extensions-core/grpc/target/dependency-reduced-pom.xml\r\n  /Users/charles.allen/src/druid/extensions-core/grpc/target/git.version\r\n  /Users/charles.allen/src/druid/extensions-core/grpc/target/.plxarc\r\n```\r\n\r\nwhen I do it locally. But it *thinks* it is excluding `target`","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451041341/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451042731","html_url":"https://github.com/apache/druid/pull/6798#issuecomment-451042731","issue_url":"https://api.github.com/repos/apache/druid/issues/6798","id":451042731,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTA0MjczMQ==","user":{"login":"drcrallen","id":8213081,"node_id":"MDQ6VXNlcjgyMTMwODE=","avatar_url":"https://avatars.githubusercontent.com/u/8213081?v=4","gravatar_id":"","url":"https://api.github.com/users/drcrallen","html_url":"https://github.com/drcrallen","followers_url":"https://api.github.com/users/drcrallen/followers","following_url":"https://api.github.com/users/drcrallen/following{/other_user}","gists_url":"https://api.github.com/users/drcrallen/gists{/gist_id}","starred_url":"https://api.github.com/users/drcrallen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drcrallen/subscriptions","organizations_url":"https://api.github.com/users/drcrallen/orgs","repos_url":"https://api.github.com/users/drcrallen/repos","events_url":"https://api.github.com/users/drcrallen/events{/privacy}","received_events_url":"https://api.github.com/users/drcrallen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T02:31:45Z","updated_at":"2019-01-03T02:31:45Z","author_association":"CONTRIBUTOR","body":"`useDefaultExcludes` for the rat properties should be excluding the target directory but it is not for some reason.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451042731/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451042824","html_url":"https://github.com/apache/druid/pull/6775#issuecomment-451042824","issue_url":"https://api.github.com/repos/apache/druid/issues/6775","id":451042824,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTA0MjgyNA==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T02:32:33Z","updated_at":"2019-01-03T02:32:33Z","author_association":"CONTRIBUTOR","body":"@QiuMM would you elaborate more on how this change helps to speed up the segment assignment?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451042824/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451047151","html_url":"https://github.com/apache/druid/pull/6800#issuecomment-451047151","issue_url":"https://api.github.com/repos/apache/druid/issues/6800","id":451047151,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTA0NzE1MQ==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T03:16:12Z","updated_at":"2019-01-03T03:16:12Z","author_association":"CONTRIBUTOR","body":"I additionally fixed a wrong commit tag for guava in NOTICE file.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451047151/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451048805","html_url":"https://github.com/apache/druid/issues/6457#issuecomment-451048805","issue_url":"https://api.github.com/repos/apache/druid/issues/6457","id":451048805,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTA0ODgwNQ==","user":{"login":"weijietong","id":728692,"node_id":"MDQ6VXNlcjcyODY5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/728692?v=4","gravatar_id":"","url":"https://api.github.com/users/weijietong","html_url":"https://github.com/weijietong","followers_url":"https://api.github.com/users/weijietong/followers","following_url":"https://api.github.com/users/weijietong/following{/other_user}","gists_url":"https://api.github.com/users/weijietong/gists{/gist_id}","starred_url":"https://api.github.com/users/weijietong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weijietong/subscriptions","organizations_url":"https://api.github.com/users/weijietong/orgs","repos_url":"https://api.github.com/users/weijietong/repos","events_url":"https://api.github.com/users/weijietong/events{/privacy}","received_events_url":"https://api.github.com/users/weijietong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T03:33:05Z","updated_at":"2019-01-03T03:33:05Z","author_association":"NONE","body":"Sorry, I will leave the Druid community, so abort this work.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451048805/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451080207","html_url":"https://github.com/apache/druid/pull/6775#issuecomment-451080207","issue_url":"https://api.github.com/repos/apache/druid/issues/6775","id":451080207,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTA4MDIwNw==","user":{"login":"QiuMM","id":15156517,"node_id":"MDQ6VXNlcjE1MTU2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/15156517?v=4","gravatar_id":"","url":"https://api.github.com/users/QiuMM","html_url":"https://github.com/QiuMM","followers_url":"https://api.github.com/users/QiuMM/followers","following_url":"https://api.github.com/users/QiuMM/following{/other_user}","gists_url":"https://api.github.com/users/QiuMM/gists{/gist_id}","starred_url":"https://api.github.com/users/QiuMM/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/QiuMM/subscriptions","organizations_url":"https://api.github.com/users/QiuMM/orgs","repos_url":"https://api.github.com/users/QiuMM/repos","events_url":"https://api.github.com/users/QiuMM/events{/privacy}","received_events_url":"https://api.github.com/users/QiuMM/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T08:30:14Z","updated_at":"2019-01-03T13:35:05Z","author_association":"MEMBER","body":"Well, currently all `loadqueuepeon`s share the same `processingExecutor` which contains only one thread so that these `loadqueuepeon`s have to process one by one.  Giving the ability to set the thread pool size for the `loadqueuepeon`s can let `loadqueuepeon`s run in parallel.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451080207/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451080731","html_url":"https://github.com/apache/druid/issues/6043#issuecomment-451080731","issue_url":"https://api.github.com/repos/apache/druid/issues/6043","id":451080731,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTA4MDczMQ==","user":{"login":"huanzhang","id":3303276,"node_id":"MDQ6VXNlcjMzMDMyNzY=","avatar_url":"https://avatars.githubusercontent.com/u/3303276?v=4","gravatar_id":"","url":"https://api.github.com/users/huanzhang","html_url":"https://github.com/huanzhang","followers_url":"https://api.github.com/users/huanzhang/followers","following_url":"https://api.github.com/users/huanzhang/following{/other_user}","gists_url":"https://api.github.com/users/huanzhang/gists{/gist_id}","starred_url":"https://api.github.com/users/huanzhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/huanzhang/subscriptions","organizations_url":"https://api.github.com/users/huanzhang/orgs","repos_url":"https://api.github.com/users/huanzhang/repos","events_url":"https://api.github.com/users/huanzhang/events{/privacy}","received_events_url":"https://api.github.com/users/huanzhang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T08:33:32Z","updated_at":"2019-01-03T08:33:32Z","author_association":"NONE","body":"I also got this when I ran sql from hive.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451080731/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451213685","html_url":"https://github.com/apache/druid/pull/6775#issuecomment-451213685","issue_url":"https://api.github.com/repos/apache/druid/issues/6775","id":451213685,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTIxMzY4NQ==","user":{"login":"drcrallen","id":8213081,"node_id":"MDQ6VXNlcjgyMTMwODE=","avatar_url":"https://avatars.githubusercontent.com/u/8213081?v=4","gravatar_id":"","url":"https://api.github.com/users/drcrallen","html_url":"https://github.com/drcrallen","followers_url":"https://api.github.com/users/drcrallen/followers","following_url":"https://api.github.com/users/drcrallen/following{/other_user}","gists_url":"https://api.github.com/users/drcrallen/gists{/gist_id}","starred_url":"https://api.github.com/users/drcrallen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drcrallen/subscriptions","organizations_url":"https://api.github.com/users/drcrallen/orgs","repos_url":"https://api.github.com/users/drcrallen/repos","events_url":"https://api.github.com/users/drcrallen/events{/privacy}","received_events_url":"https://api.github.com/users/drcrallen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T17:21:04Z","updated_at":"2019-01-03T17:21:04Z","author_association":"CONTRIBUTOR","body":"Is the behavior during leadership changes affected by this patch?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451213685/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451235601","html_url":"https://github.com/apache/druid/pull/6769#issuecomment-451235601","issue_url":"https://api.github.com/repos/apache/druid/issues/6769","id":451235601,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTIzNTYwMQ==","user":{"login":"gianm","id":1214075,"node_id":"MDQ6VXNlcjEyMTQwNzU=","avatar_url":"https://avatars.githubusercontent.com/u/1214075?v=4","gravatar_id":"","url":"https://api.github.com/users/gianm","html_url":"https://github.com/gianm","followers_url":"https://api.github.com/users/gianm/followers","following_url":"https://api.github.com/users/gianm/following{/other_user}","gists_url":"https://api.github.com/users/gianm/gists{/gist_id}","starred_url":"https://api.github.com/users/gianm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gianm/subscriptions","organizations_url":"https://api.github.com/users/gianm/orgs","repos_url":"https://api.github.com/users/gianm/repos","events_url":"https://api.github.com/users/gianm/events{/privacy}","received_events_url":"https://api.github.com/users/gianm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T18:35:39Z","updated_at":"2019-01-03T18:35:39Z","author_association":"CONTRIBUTOR","body":"@jihoonson what kind of sanity checks do you have in mind?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451235601/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451235804","html_url":"https://github.com/apache/druid/pull/6769#issuecomment-451235804","issue_url":"https://api.github.com/repos/apache/druid/issues/6769","id":451235804,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTIzNTgwNA==","user":{"login":"gianm","id":1214075,"node_id":"MDQ6VXNlcjEyMTQwNzU=","avatar_url":"https://avatars.githubusercontent.com/u/1214075?v=4","gravatar_id":"","url":"https://api.github.com/users/gianm","html_url":"https://github.com/gianm","followers_url":"https://api.github.com/users/gianm/followers","following_url":"https://api.github.com/users/gianm/following{/other_user}","gists_url":"https://api.github.com/users/gianm/gists{/gist_id}","starred_url":"https://api.github.com/users/gianm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gianm/subscriptions","organizations_url":"https://api.github.com/users/gianm/orgs","repos_url":"https://api.github.com/users/gianm/repos","events_url":"https://api.github.com/users/gianm/events{/privacy}","received_events_url":"https://api.github.com/users/gianm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T18:36:21Z","updated_at":"2019-01-03T18:36:21Z","author_association":"CONTRIBUTOR","body":"I'll merge this, but please still mention what you're thinking of, if it would make a good improvement.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451235804/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451246932","html_url":"https://github.com/apache/druid/pull/6794#issuecomment-451246932","issue_url":"https://api.github.com/repos/apache/druid/issues/6794","id":451246932,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTI0NjkzMg==","user":{"login":"gianm","id":1214075,"node_id":"MDQ6VXNlcjEyMTQwNzU=","avatar_url":"https://avatars.githubusercontent.com/u/1214075?v=4","gravatar_id":"","url":"https://api.github.com/users/gianm","html_url":"https://github.com/gianm","followers_url":"https://api.github.com/users/gianm/followers","following_url":"https://api.github.com/users/gianm/following{/other_user}","gists_url":"https://api.github.com/users/gianm/gists{/gist_id}","starred_url":"https://api.github.com/users/gianm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gianm/subscriptions","organizations_url":"https://api.github.com/users/gianm/orgs","repos_url":"https://api.github.com/users/gianm/repos","events_url":"https://api.github.com/users/gianm/events{/privacy}","received_events_url":"https://api.github.com/users/gianm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T19:14:57Z","updated_at":"2019-01-03T19:14:57Z","author_association":"CONTRIBUTOR","body":"I added a \"Future work\" section that illustrates what would be left to be done before the feature is 'complete'. I don't necessarily think it makes sense to do any of it in the first PR, since the first PR would just be to lay a foundation that allows the other work to happen.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451246932/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451250348","html_url":"https://github.com/apache/druid/pull/6769#issuecomment-451250348","issue_url":"https://api.github.com/repos/apache/druid/issues/6769","id":451250348,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTI1MDM0OA==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T19:26:55Z","updated_at":"2019-01-03T19:26:55Z","author_association":"CONTRIBUTOR","body":"I'm thinking like verifying the iteration order while checking the query has some clauses. For example, `getSortProject` is called before `getSort`, the sanity check may throw an exception.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451250348/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451252327","html_url":"https://github.com/apache/druid/pull/6769#issuecomment-451252327","issue_url":"https://api.github.com/repos/apache/druid/issues/6769","id":451252327,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTI1MjMyNw==","user":{"login":"gianm","id":1214075,"node_id":"MDQ6VXNlcjEyMTQwNzU=","avatar_url":"https://avatars.githubusercontent.com/u/1214075?v=4","gravatar_id":"","url":"https://api.github.com/users/gianm","html_url":"https://github.com/gianm","followers_url":"https://api.github.com/users/gianm/followers","following_url":"https://api.github.com/users/gianm/following{/other_user}","gists_url":"https://api.github.com/users/gianm/gists{/gist_id}","starred_url":"https://api.github.com/users/gianm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gianm/subscriptions","organizations_url":"https://api.github.com/users/gianm/orgs","repos_url":"https://api.github.com/users/gianm/repos","events_url":"https://api.github.com/users/gianm/events{/privacy}","received_events_url":"https://api.github.com/users/gianm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T19:33:56Z","updated_at":"2019-01-03T19:33:56Z","author_association":"CONTRIBUTOR","body":"Ah. But, what if a caller doesn't need the `sort` and just needs the `sortProject`? It seems strange to force it to call `getSort` anyway.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451252327/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451252646","html_url":"https://github.com/apache/druid/pull/6769#issuecomment-451252646","issue_url":"https://api.github.com/repos/apache/druid/issues/6769","id":451252646,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTI1MjY0Ng==","user":{"login":"gianm","id":1214075,"node_id":"MDQ6VXNlcjEyMTQwNzU=","avatar_url":"https://avatars.githubusercontent.com/u/1214075?v=4","gravatar_id":"","url":"https://api.github.com/users/gianm","html_url":"https://github.com/gianm","followers_url":"https://api.github.com/users/gianm/followers","following_url":"https://api.github.com/users/gianm/following{/other_user}","gists_url":"https://api.github.com/users/gianm/gists{/gist_id}","starred_url":"https://api.github.com/users/gianm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gianm/subscriptions","organizations_url":"https://api.github.com/users/gianm/orgs","repos_url":"https://api.github.com/users/gianm/repos","events_url":"https://api.github.com/users/gianm/events{/privacy}","received_events_url":"https://api.github.com/users/gianm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T19:35:02Z","updated_at":"2019-01-03T19:35:02Z","author_association":"CONTRIBUTOR","body":"There is a sanity check on _write_, btw, and that is what got triggered here. The \"Cannot move from stage[AGGREGATE] to stage[SORT_PROJECT]\" message is from PartialDruidQuery's withSortProject method.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451252646/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451254639","html_url":"https://github.com/apache/druid/issues/6743#issuecomment-451254639","issue_url":"https://api.github.com/repos/apache/druid/issues/6743","id":451254639,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTI1NDYzOQ==","user":{"login":"gianm","id":1214075,"node_id":"MDQ6VXNlcjEyMTQwNzU=","avatar_url":"https://avatars.githubusercontent.com/u/1214075?v=4","gravatar_id":"","url":"https://api.github.com/users/gianm","html_url":"https://github.com/gianm","followers_url":"https://api.github.com/users/gianm/followers","following_url":"https://api.github.com/users/gianm/following{/other_user}","gists_url":"https://api.github.com/users/gianm/gists{/gist_id}","starred_url":"https://api.github.com/users/gianm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gianm/subscriptions","organizations_url":"https://api.github.com/users/gianm/orgs","repos_url":"https://api.github.com/users/gianm/repos","events_url":"https://api.github.com/users/gianm/events{/privacy}","received_events_url":"https://api.github.com/users/gianm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T19:42:00Z","updated_at":"2019-01-03T19:42:00Z","author_association":"CONTRIBUTOR","body":"> I think you are referring to the HyperLogLog (HLL) sketch implementation that was developed for Druid some years ago. There are several things you need to understand about that implementation.\r\n\r\n@leerho, yep, you are right, I am talking about that one. I am aware of the things you mentioned and appreciate the work you've done in the characterization studies (I was not aware of the problems with our core HLL implementation until that work was published). I only mentioned it by way of explaining why we never worried about growability in the past, back when that was the only sketch we supported.\r\n\r\nIt's a separate issue from this one, but, I'd like to take you up on working out a way to migrate users to the new sketch. It is somewhat delicate since the new one is in an extension and the old one is in core. And also because they don't have the same on-disk format, so we'd need to support both forever (we don't want to drop compatibility with on-disk data). We need to get the migration right to avoid user confusion.\r\n\r\n> I'm not sure I follow your proposal and may be missing something.\r\n\r\nWhat part is unclear? I can tell from your other comments that you are following at least the main idea of it: that each aggregation operator would get a chunk of memory and be responsible for using it to store sketch data for all the tuples being aggregated for a given segment.\r\n\r\n> Nonetheless, one of the challenges of just carving out a chunk of the processing buffer to be managed by by the individual BufferAggregators is that in order truly gain back the \"unused memory\" would require memory management sophistication similar to the design of a malloc(), free() and a garbage collector, which is non-trivial. Imagine each sketch with an internal hash-table. As individual sketches grow they need to obtain a larger chunk of memory for a bigger hash-table, move their data into the larger chunk and free the previous chunk. If those freed chunks don't get reused, then we will not achieve the optimum memory savings. Allowing the sketches to allocate and free memory directly from the operating system allows us to leverage the already existing and very sophisticated malloc() and free() of the underlying C-libraries and the OS itself.\r\n\r\nOn the flip side, the challenge of _not_ using a chunk of the processing buffer is that we need two things to make that work:\r\n\r\n1. A way for users to configure the maximum amount of 'extra' memory used per query, or some mechanism to set that limit automatically. (We can't allow unlimited allocation, since we'll risk running out of memory.)\r\n2. A way to track the amount of memory being used per query, and if it exceeds the limit, trigger the out-of-memory code that would get triggered if the processing buffer filled up. Depending on where we are in the query pipeline and what engine is being used, that might trigger a spill to disk, a second pass through the data, an emitting of partially data to a later stage of the pipeline, or an error.\r\n\r\nThey are probably solvable, but I just wanted to call them out.\r\n\r\n> BTW, there is already a mechanism in the JVM to track usage of off-heap memory used by DirectByteBuffers. We use this same mechanism to track allocations we make against off-heap memory even though we don't use DirectByteBuffers. So the JVM knows and tracks this usage already. Druid could also monitor these same JVM counters if it wanted or needed to.\r\n\r\nDo you know if there's a way to use this functionality to track per-query memory usage? That would be ideal, since we don't want excessive memory use by one query to affect another unrelated query.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451254639/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451255141","html_url":"https://github.com/apache/druid/issues/6457#issuecomment-451255141","issue_url":"https://api.github.com/repos/apache/druid/issues/6457","id":451255141,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTI1NTE0MQ==","user":{"login":"gianm","id":1214075,"node_id":"MDQ6VXNlcjEyMTQwNzU=","avatar_url":"https://avatars.githubusercontent.com/u/1214075?v=4","gravatar_id":"","url":"https://api.github.com/users/gianm","html_url":"https://github.com/gianm","followers_url":"https://api.github.com/users/gianm/followers","following_url":"https://api.github.com/users/gianm/following{/other_user}","gists_url":"https://api.github.com/users/gianm/gists{/gist_id}","starred_url":"https://api.github.com/users/gianm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gianm/subscriptions","organizations_url":"https://api.github.com/users/gianm/orgs","repos_url":"https://api.github.com/users/gianm/repos","events_url":"https://api.github.com/users/gianm/events{/privacy}","received_events_url":"https://api.github.com/users/gianm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T19:43:56Z","updated_at":"2019-01-03T19:43:56Z","author_association":"CONTRIBUTOR","body":"Sorry to hear that @weijietong.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451255141/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451256186","html_url":"https://github.com/apache/druid/issues/6795#issuecomment-451256186","issue_url":"https://api.github.com/repos/apache/druid/issues/6795","id":451256186,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTI1NjE4Ng==","user":{"login":"gianm","id":1214075,"node_id":"MDQ6VXNlcjEyMTQwNzU=","avatar_url":"https://avatars.githubusercontent.com/u/1214075?v=4","gravatar_id":"","url":"https://api.github.com/users/gianm","html_url":"https://github.com/gianm","followers_url":"https://api.github.com/users/gianm/followers","following_url":"https://api.github.com/users/gianm/following{/other_user}","gists_url":"https://api.github.com/users/gianm/gists{/gist_id}","starred_url":"https://api.github.com/users/gianm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gianm/subscriptions","organizations_url":"https://api.github.com/users/gianm/orgs","repos_url":"https://api.github.com/users/gianm/repos","events_url":"https://api.github.com/users/gianm/events{/privacy}","received_events_url":"https://api.github.com/users/gianm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T19:47:53Z","updated_at":"2019-01-03T19:47:53Z","author_association":"CONTRIBUTOR","body":"Hi @csimplestring,\r\n\r\nThis is possibly related to #6743 and may come from the same underlying problem: the theta sketch has a relatively large maximum size, even though it's not typically going to use it all. This causes IncrementalIndex to overestimate its size and it also causes groupBy to reserve a lot more space for it than truly necessary. In turn- this can cause inefficiency and potentially slow down the query.\r\n\r\nCould you try running the query with `\"groupByStrategy\": \"v1\"`? That one uses on-heap aggregators and so it doesn't suffer from the same problem. If it's faster, it probably means my guess above is correct about wha's happening.\r\n\r\nThis is one of the only situations where groupBy v1 is better than v2 (when using an aggregation type that has a large maximum size but a small typical size). Possibly the only situation at all.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451256186/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451258341","html_url":"https://github.com/apache/druid/issues/6743#issuecomment-451258341","issue_url":"https://api.github.com/repos/apache/druid/issues/6743","id":451258341,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTI1ODM0MQ==","user":{"login":"gianm","id":1214075,"node_id":"MDQ6VXNlcjEyMTQwNzU=","avatar_url":"https://avatars.githubusercontent.com/u/1214075?v=4","gravatar_id":"","url":"https://api.github.com/users/gianm","html_url":"https://github.com/gianm","followers_url":"https://api.github.com/users/gianm/followers","following_url":"https://api.github.com/users/gianm/following{/other_user}","gists_url":"https://api.github.com/users/gianm/gists{/gist_id}","starred_url":"https://api.github.com/users/gianm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gianm/subscriptions","organizations_url":"https://api.github.com/users/gianm/orgs","repos_url":"https://api.github.com/users/gianm/repos","events_url":"https://api.github.com/users/gianm/events{/privacy}","received_events_url":"https://api.github.com/users/gianm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T19:55:31Z","updated_at":"2019-01-03T19:55:31Z","author_association":"CONTRIBUTOR","body":"> Do you know if there's a way to use this functionality to track per-query memory usage? That would be ideal, since we don't want excessive memory use by one query to affect another unrelated query.\r\n\r\nI suppose we could ask each aggregation operator to track its own 'extra' memory usage and report it to the query engine when asked. That sounds pretty easy. Which would just leave how we configure the maximum. I guess it'd be a new config, possibly defaulting to some percentage of the processing buffer size?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451258341/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451265619","html_url":"https://github.com/apache/druid/issues/6795#issuecomment-451265619","issue_url":"https://api.github.com/repos/apache/druid/issues/6795","id":451265619,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTI2NTYxOQ==","user":{"login":"csimplestring","id":5042273,"node_id":"MDQ6VXNlcjUwNDIyNzM=","avatar_url":"https://avatars.githubusercontent.com/u/5042273?v=4","gravatar_id":"","url":"https://api.github.com/users/csimplestring","html_url":"https://github.com/csimplestring","followers_url":"https://api.github.com/users/csimplestring/followers","following_url":"https://api.github.com/users/csimplestring/following{/other_user}","gists_url":"https://api.github.com/users/csimplestring/gists{/gist_id}","starred_url":"https://api.github.com/users/csimplestring/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/csimplestring/subscriptions","organizations_url":"https://api.github.com/users/csimplestring/orgs","repos_url":"https://api.github.com/users/csimplestring/repos","events_url":"https://api.github.com/users/csimplestring/events{/privacy}","received_events_url":"https://api.github.com/users/csimplestring/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T20:22:23Z","updated_at":"2019-01-03T20:22:23Z","author_association":"NONE","body":"Hi, @gianm,\r\n\r\nI tried the 'v1' and 'v2' groupbyStrategy respectively, there is NO significant difference at all. I plan to switch to HyperUnique aggregator later in order to achieve faster speed.\r\n\r\nAs mentioned in #6743, the Druid HLL implementation is some years ago and might be deprecated, using the theta sketch library is the preferred option. But the performance is still a small hurdle to me.\r\n\r\nBut thanks for your help.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451265619/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451267133","html_url":"https://github.com/apache/druid/issues/6795#issuecomment-451267133","issue_url":"https://api.github.com/repos/apache/druid/issues/6795","id":451267133,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTI2NzEzMw==","user":{"login":"gianm","id":1214075,"node_id":"MDQ6VXNlcjEyMTQwNzU=","avatar_url":"https://avatars.githubusercontent.com/u/1214075?v=4","gravatar_id":"","url":"https://api.github.com/users/gianm","html_url":"https://github.com/gianm","followers_url":"https://api.github.com/users/gianm/followers","following_url":"https://api.github.com/users/gianm/following{/other_user}","gists_url":"https://api.github.com/users/gianm/gists{/gist_id}","starred_url":"https://api.github.com/users/gianm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gianm/subscriptions","organizations_url":"https://api.github.com/users/gianm/orgs","repos_url":"https://api.github.com/users/gianm/repos","events_url":"https://api.github.com/users/gianm/events{/privacy}","received_events_url":"https://api.github.com/users/gianm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T20:28:08Z","updated_at":"2019-01-03T20:28:08Z","author_association":"CONTRIBUTOR","body":"Some profiling might be interesting, to identify where the bottleneck is. It could help us improve groupBy, or theta sketches, or both.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451267133/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451284576","html_url":"https://github.com/apache/druid/pull/6724#issuecomment-451284576","issue_url":"https://api.github.com/repos/apache/druid/issues/6724","id":451284576,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTI4NDU3Ng==","user":{"login":"jon-wei","id":8729063,"node_id":"MDQ6VXNlcjg3MjkwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8729063?v=4","gravatar_id":"","url":"https://api.github.com/users/jon-wei","html_url":"https://github.com/jon-wei","followers_url":"https://api.github.com/users/jon-wei/followers","following_url":"https://api.github.com/users/jon-wei/following{/other_user}","gists_url":"https://api.github.com/users/jon-wei/gists{/gist_id}","starred_url":"https://api.github.com/users/jon-wei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jon-wei/subscriptions","organizations_url":"https://api.github.com/users/jon-wei/orgs","repos_url":"https://api.github.com/users/jon-wei/repos","events_url":"https://api.github.com/users/jon-wei/events{/privacy}","received_events_url":"https://api.github.com/users/jon-wei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T21:34:04Z","updated_at":"2019-01-03T21:34:04Z","author_association":"CONTRIBUTOR","body":"@QiuMM there are some real CI failures","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451284576/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451303101","html_url":"https://github.com/apache/druid/pull/6769#issuecomment-451303101","issue_url":"https://api.github.com/repos/apache/druid/issues/6769","id":451303101,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTMwMzEwMQ==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T22:50:46Z","updated_at":"2019-01-03T22:50:46Z","author_association":"CONTRIBUTOR","body":"Ah cool. It sounds fine then. Thanks.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451303101/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451312047","html_url":"https://github.com/apache/druid/issues/6803#issuecomment-451312047","issue_url":"https://api.github.com/repos/apache/druid/issues/6803","id":451312047,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTMxMjA0Nw==","user":{"login":"jon-wei","id":8729063,"node_id":"MDQ6VXNlcjg3MjkwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8729063?v=4","gravatar_id":"","url":"https://api.github.com/users/jon-wei","html_url":"https://github.com/jon-wei","followers_url":"https://api.github.com/users/jon-wei/followers","following_url":"https://api.github.com/users/jon-wei/following{/other_user}","gists_url":"https://api.github.com/users/jon-wei/gists{/gist_id}","starred_url":"https://api.github.com/users/jon-wei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jon-wei/subscriptions","organizations_url":"https://api.github.com/users/jon-wei/orgs","repos_url":"https://api.github.com/users/jon-wei/repos","events_url":"https://api.github.com/users/jon-wei/events{/privacy}","received_events_url":"https://api.github.com/users/jon-wei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-03T23:33:36Z","updated_at":"2019-01-03T23:33:36Z","author_association":"CONTRIBUTOR","body":"Phase I sounds pretty useful, what entity would issue the yarn kill command? Do you have more details on the interfaces/code areas you plan to change for that?\r\n\r\nFor Phase II, can you describe the use case in more detail? When would a task resume occur? What happens if the input to the ingestion task changes between retries (e.g. the task is reading from some s3 bucket which gets some new files)?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451312047/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451321623","html_url":"https://github.com/apache/druid/issues/6803#issuecomment-451321623","issue_url":"https://api.github.com/repos/apache/druid/issues/6803","id":451321623,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTMyMTYyMw==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T00:29:07Z","updated_at":"2019-01-04T00:29:07Z","author_association":"CONTRIBUTOR","body":"Thanks @ankit0811. Sounds useful!\r\n\r\nFor phase 1, I think we need a unified way to support various platforms like Hadoop, Spark, and so on. So, I would suggest to change the way killing Druid tasks. Currently, the overlord sends a kill request to a middleManager where the task is running. Then, the middleManager just destroys the task process. As a result, the task can't have a chance to prepare stopping like cleaning up its resources or killing Hadoop jobs. Instead, I think the task can clean up resources before stop by changing how the middleManager kills the task. This way makes more sense to me because the Hadoop job is started and killed in the same place (Druid Hadoop task).\r\n\r\nFortunately, we have some logics already implemented. First, there's `stopGracefully` in `Task`. \r\n\r\n```java\r\n  /**\r\n   * Asks a task to arrange for its \"run\" method to exit promptly. This method will only be called if\r\n   * {@link #canRestore()} returns true. Tasks that take too long to stop gracefully will be terminated with\r\n   * extreme prejudice.\r\n   */\r\n  void stopGracefully();\r\n```\r\n\r\nThis is currently only for restorable tasks, so you may want to make the hadoop task restorable (maybe related to phase 2?). `stopGracefully` method is currently called in `SingleTaskBackgroundRunner.stop()` which in turn is called when the output stream of the task process is closed (see `ForkingTaskRunner.stop()` and `ExecutorLifecycle.start()`). So, it would work if you make hadoop task restorable and change the way to kill to closing the output stream of the task process instead of destroying the task process directly. What do you think?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451321623/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451322966","html_url":"https://github.com/apache/druid/issues/6795#issuecomment-451322966","issue_url":"https://api.github.com/repos/apache/druid/issues/6795","id":451322966,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTMyMjk2Ng==","user":{"login":"leerho","id":12941506,"node_id":"MDQ6VXNlcjEyOTQxNTA2","avatar_url":"https://avatars.githubusercontent.com/u/12941506?v=4","gravatar_id":"","url":"https://api.github.com/users/leerho","html_url":"https://github.com/leerho","followers_url":"https://api.github.com/users/leerho/followers","following_url":"https://api.github.com/users/leerho/following{/other_user}","gists_url":"https://api.github.com/users/leerho/gists{/gist_id}","starred_url":"https://api.github.com/users/leerho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leerho/subscriptions","organizations_url":"https://api.github.com/users/leerho/orgs","repos_url":"https://api.github.com/users/leerho/repos","events_url":"https://api.github.com/users/leerho/events{/privacy}","received_events_url":"https://api.github.com/users/leerho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T00:37:38Z","updated_at":"2019-01-04T00:51:03Z","author_association":"CONTRIBUTOR","body":"@csimplestring \r\n\r\n> But the performance is still a small hurdle to me.\r\n\r\nI'd be curious if you tried the HLL sketch in the DataSketches library if you have the same problem. \r\nThis would just be a test.  The DS HLL sketch (like the Druid HLL sketch) is not suitable for intersections or set differences :)\r\n","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451322966/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451328299","html_url":"https://github.com/apache/druid/issues/6743#issuecomment-451328299","issue_url":"https://api.github.com/repos/apache/druid/issues/6743","id":451328299,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTMyODI5OQ==","user":{"login":"leerho","id":12941506,"node_id":"MDQ6VXNlcjEyOTQxNTA2","avatar_url":"https://avatars.githubusercontent.com/u/12941506?v=4","gravatar_id":"","url":"https://api.github.com/users/leerho","html_url":"https://github.com/leerho","followers_url":"https://api.github.com/users/leerho/followers","following_url":"https://api.github.com/users/leerho/following{/other_user}","gists_url":"https://api.github.com/users/leerho/gists{/gist_id}","starred_url":"https://api.github.com/users/leerho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leerho/subscriptions","organizations_url":"https://api.github.com/users/leerho/orgs","repos_url":"https://api.github.com/users/leerho/repos","events_url":"https://api.github.com/users/leerho/events{/privacy}","received_events_url":"https://api.github.com/users/leerho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T01:10:20Z","updated_at":"2019-01-04T01:10:20Z","author_association":"CONTRIBUTOR","body":"@gianm \r\n\r\n> I'd like to take you up on working out a way to migrate users to the new sketch. It is somewhat delicate since the new one is in an extension and the old one is in core. And also because they don't have the same on-disk format, so we'd need to support both forever (we don't want to drop compatibility with on-disk data). We need to get the migration right to avoid user confusion.\r\n\r\nUnderstood and I agree that you will have to keep it around, but once we have an easy way for users to substitute in the DS HLL sketch, we should deprecate the old one with documentation on how to use the DS HLL sketch instead. The docs will have to include the warning that since the two sketches use different hash functions, using the DS-HLL sketch is starting from scratch.  If the user is relying oh historically stored sketch images, they are stuck with the old sketch, and its error problems.\r\n\r\nJust wondering, is there a way we could move the DS library to core?\r\n\r\nI am still on vacation this week, but will start looking at this next week :)\r\n ","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451328299/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451365328","html_url":"https://github.com/apache/druid/pull/6798#issuecomment-451365328","issue_url":"https://api.github.com/repos/apache/druid/issues/6798","id":451365328,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTM2NTMyOA==","user":{"login":"ndolgov","id":63305,"node_id":"MDQ6VXNlcjYzMzA1","avatar_url":"https://avatars.githubusercontent.com/u/63305?v=4","gravatar_id":"","url":"https://api.github.com/users/ndolgov","html_url":"https://github.com/ndolgov","followers_url":"https://api.github.com/users/ndolgov/followers","following_url":"https://api.github.com/users/ndolgov/following{/other_user}","gists_url":"https://api.github.com/users/ndolgov/gists{/gist_id}","starred_url":"https://api.github.com/users/ndolgov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ndolgov/subscriptions","organizations_url":"https://api.github.com/users/ndolgov/orgs","repos_url":"https://api.github.com/users/ndolgov/repos","events_url":"https://api.github.com/users/ndolgov/events{/privacy}","received_events_url":"https://api.github.com/users/ndolgov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T06:50:08Z","updated_at":"2019-01-04T06:50:57Z","author_association":"NONE","body":"@drcrallen For a moment I was scared my little PoC (https://github.com/ndolgov/gruid) was unnecessary.  But then I noticed that your extension is not only of production quality but also goes in a different direction. I have borrowed your Guava workaround though. I am really grateful for your hints.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451365328/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451377031","html_url":"https://github.com/apache/druid/pull/6805#issuecomment-451377031","issue_url":"https://api.github.com/repos/apache/druid/issues/6805","id":451377031,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTM3NzAzMQ==","user":{"login":"dyf6372","id":1322134,"node_id":"MDQ6VXNlcjEzMjIxMzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1322134?v=4","gravatar_id":"","url":"https://api.github.com/users/dyf6372","html_url":"https://github.com/dyf6372","followers_url":"https://api.github.com/users/dyf6372/followers","following_url":"https://api.github.com/users/dyf6372/following{/other_user}","gists_url":"https://api.github.com/users/dyf6372/gists{/gist_id}","starred_url":"https://api.github.com/users/dyf6372/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dyf6372/subscriptions","organizations_url":"https://api.github.com/users/dyf6372/orgs","repos_url":"https://api.github.com/users/dyf6372/repos","events_url":"https://api.github.com/users/dyf6372/events{/privacy}","received_events_url":"https://api.github.com/users/dyf6372/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T08:00:54Z","updated_at":"2019-01-04T08:00:54Z","author_association":"CONTRIBUTOR","body":"After CI, I think it's not a good idea to change the logic in auto format since a lot of tests depend on it. Maybe it will be better to create a new format.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451377031/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451384184","html_url":"https://github.com/apache/druid/issues/6806#issuecomment-451384184","issue_url":"https://api.github.com/repos/apache/druid/issues/6806","id":451384184,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTM4NDE4NA==","user":{"login":"licl2014","id":6941514,"node_id":"MDQ6VXNlcjY5NDE1MTQ=","avatar_url":"https://avatars.githubusercontent.com/u/6941514?v=4","gravatar_id":"","url":"https://api.github.com/users/licl2014","html_url":"https://github.com/licl2014","followers_url":"https://api.github.com/users/licl2014/followers","following_url":"https://api.github.com/users/licl2014/following{/other_user}","gists_url":"https://api.github.com/users/licl2014/gists{/gist_id}","starred_url":"https://api.github.com/users/licl2014/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/licl2014/subscriptions","organizations_url":"https://api.github.com/users/licl2014/orgs","repos_url":"https://api.github.com/users/licl2014/repos","events_url":"https://api.github.com/users/licl2014/events{/privacy}","received_events_url":"https://api.github.com/users/licl2014/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T08:37:08Z","updated_at":"2019-01-04T08:37:08Z","author_association":"CONTRIBUTOR","body":"if this kafka index task has segment meta data in mysql or has segment data in HDFS?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451384184/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451384879","html_url":"https://github.com/apache/druid/pull/6775#issuecomment-451384879","issue_url":"https://api.github.com/repos/apache/druid/issues/6775","id":451384879,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTM4NDg3OQ==","user":{"login":"QiuMM","id":15156517,"node_id":"MDQ6VXNlcjE1MTU2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/15156517?v=4","gravatar_id":"","url":"https://api.github.com/users/QiuMM","html_url":"https://github.com/QiuMM","followers_url":"https://api.github.com/users/QiuMM/followers","following_url":"https://api.github.com/users/QiuMM/following{/other_user}","gists_url":"https://api.github.com/users/QiuMM/gists{/gist_id}","starred_url":"https://api.github.com/users/QiuMM/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/QiuMM/subscriptions","organizations_url":"https://api.github.com/users/QiuMM/orgs","repos_url":"https://api.github.com/users/QiuMM/repos","events_url":"https://api.github.com/users/QiuMM/events{/privacy}","received_events_url":"https://api.github.com/users/QiuMM/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T08:41:14Z","updated_at":"2019-01-04T08:41:14Z","author_association":"MEMBER","body":"@drcrallen no. This patch just make the thread pool size(default size is one) can be configured, didn't change anything related to leadership.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451384879/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451385877","html_url":"https://github.com/apache/druid/issues/6806#issuecomment-451385877","issue_url":"https://api.github.com/repos/apache/druid/issues/6806","id":451385877,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTM4NTg3Nw==","user":{"login":"helianthuslulu","id":4606832,"node_id":"MDQ6VXNlcjQ2MDY4MzI=","avatar_url":"https://avatars.githubusercontent.com/u/4606832?v=4","gravatar_id":"","url":"https://api.github.com/users/helianthuslulu","html_url":"https://github.com/helianthuslulu","followers_url":"https://api.github.com/users/helianthuslulu/followers","following_url":"https://api.github.com/users/helianthuslulu/following{/other_user}","gists_url":"https://api.github.com/users/helianthuslulu/gists{/gist_id}","starred_url":"https://api.github.com/users/helianthuslulu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/helianthuslulu/subscriptions","organizations_url":"https://api.github.com/users/helianthuslulu/orgs","repos_url":"https://api.github.com/users/helianthuslulu/repos","events_url":"https://api.github.com/users/helianthuslulu/events{/privacy}","received_events_url":"https://api.github.com/users/helianthuslulu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T08:47:08Z","updated_at":"2019-01-04T08:47:08Z","author_association":"NONE","body":"There is no metadata information, and no sink in hdfs.\r\n","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451385877/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451386882","html_url":"https://github.com/apache/druid/issues/6806#issuecomment-451386882","issue_url":"https://api.github.com/repos/apache/druid/issues/6806","id":451386882,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTM4Njg4Mg==","user":{"login":"helianthuslulu","id":4606832,"node_id":"MDQ6VXNlcjQ2MDY4MzI=","avatar_url":"https://avatars.githubusercontent.com/u/4606832?v=4","gravatar_id":"","url":"https://api.github.com/users/helianthuslulu","html_url":"https://github.com/helianthuslulu","followers_url":"https://api.github.com/users/helianthuslulu/followers","following_url":"https://api.github.com/users/helianthuslulu/following{/other_user}","gists_url":"https://api.github.com/users/helianthuslulu/gists{/gist_id}","starred_url":"https://api.github.com/users/helianthuslulu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/helianthuslulu/subscriptions","organizations_url":"https://api.github.com/users/helianthuslulu/orgs","repos_url":"https://api.github.com/users/helianthuslulu/repos","events_url":"https://api.github.com/users/helianthuslulu/events{/privacy}","received_events_url":"https://api.github.com/users/helianthuslulu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T08:52:47Z","updated_at":"2019-01-04T08:53:09Z","author_association":"NONE","body":"in $DRUID_HOME/conf/druid/_common/common.runtime.properties, segment dir config:\r\n**druid.storage.storageDirectory=/druid/segments**\r\nbut there is no segment about this datasource \"metrics-kafka\" in /druid/segments","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451386882/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451388783","html_url":"https://github.com/apache/druid/issues/6806#issuecomment-451388783","issue_url":"https://api.github.com/repos/apache/druid/issues/6806","id":451388783,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTM4ODc4Mw==","user":{"login":"helianthuslulu","id":4606832,"node_id":"MDQ6VXNlcjQ2MDY4MzI=","avatar_url":"https://avatars.githubusercontent.com/u/4606832?v=4","gravatar_id":"","url":"https://api.github.com/users/helianthuslulu","html_url":"https://github.com/helianthuslulu","followers_url":"https://api.github.com/users/helianthuslulu/followers","following_url":"https://api.github.com/users/helianthuslulu/following{/other_user}","gists_url":"https://api.github.com/users/helianthuslulu/gists{/gist_id}","starred_url":"https://api.github.com/users/helianthuslulu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/helianthuslulu/subscriptions","organizations_url":"https://api.github.com/users/helianthuslulu/orgs","repos_url":"https://api.github.com/users/helianthuslulu/repos","events_url":"https://api.github.com/users/helianthuslulu/events{/privacy}","received_events_url":"https://api.github.com/users/helianthuslulu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T09:01:24Z","updated_at":"2019-01-04T09:04:07Z","author_association":"NONE","body":"my env:\r\n\r\n> druid-0.12.3 release\r\n> openjdk-8\r\n> hadoop-2.7.1\r\n> kafka_2.11-0.10.2.2\r\n\r\n> IP | hostname | roles\r\n> xxx.x.xxx.20 | druid01 | coordinator  overlord kafka zookeeper\r\n> xxx.x.xxx.21 | druid02 | historical  middleManager\r\n> xxx.x.xxx.22 | druid03 | historical  middleManager\r\n> xxx.x.xxx.23 | druid04 | broker","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451388783/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451390061","html_url":"https://github.com/apache/druid/issues/6795#issuecomment-451390061","issue_url":"https://api.github.com/repos/apache/druid/issues/6795","id":451390061,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTM5MDA2MQ==","user":{"login":"csimplestring","id":5042273,"node_id":"MDQ6VXNlcjUwNDIyNzM=","avatar_url":"https://avatars.githubusercontent.com/u/5042273?v=4","gravatar_id":"","url":"https://api.github.com/users/csimplestring","html_url":"https://github.com/csimplestring","followers_url":"https://api.github.com/users/csimplestring/followers","following_url":"https://api.github.com/users/csimplestring/following{/other_user}","gists_url":"https://api.github.com/users/csimplestring/gists{/gist_id}","starred_url":"https://api.github.com/users/csimplestring/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/csimplestring/subscriptions","organizations_url":"https://api.github.com/users/csimplestring/orgs","repos_url":"https://api.github.com/users/csimplestring/repos","events_url":"https://api.github.com/users/csimplestring/events{/privacy}","received_events_url":"https://api.github.com/users/csimplestring/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T09:07:53Z","updated_at":"2019-01-04T09:07:53Z","author_association":"NONE","body":"Hi, @leerho ，\r\n\r\nThanks! I'll try that as well soon. \r\n\r\nRight now in Druid, there are 3 sketch options to get the approximate distinct count:\r\n- the old Druid built-in HLL, aka, HyperUnique\r\n- the DataSketch's ThetaSketch aggregator\r\n- the DataSketch's HLL Sketch aggregator\r\n\r\nI'll test them and hopefully give you a small summary.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451390061/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451402510","html_url":"https://github.com/apache/druid/issues/6806#issuecomment-451402510","issue_url":"https://api.github.com/repos/apache/druid/issues/6806","id":451402510,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTQwMjUxMA==","user":{"login":"helianthuslulu","id":4606832,"node_id":"MDQ6VXNlcjQ2MDY4MzI=","avatar_url":"https://avatars.githubusercontent.com/u/4606832?v=4","gravatar_id":"","url":"https://api.github.com/users/helianthuslulu","html_url":"https://github.com/helianthuslulu","followers_url":"https://api.github.com/users/helianthuslulu/followers","following_url":"https://api.github.com/users/helianthuslulu/following{/other_user}","gists_url":"https://api.github.com/users/helianthuslulu/gists{/gist_id}","starred_url":"https://api.github.com/users/helianthuslulu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/helianthuslulu/subscriptions","organizations_url":"https://api.github.com/users/helianthuslulu/orgs","repos_url":"https://api.github.com/users/helianthuslulu/repos","events_url":"https://api.github.com/users/helianthuslulu/events{/privacy}","received_events_url":"https://api.github.com/users/helianthuslulu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T10:04:38Z","updated_at":"2019-01-04T10:04:38Z","author_association":"NONE","body":"data is manually send by kafka-console-producer.sh：\r\n**{\"time\": \"2019-01-04T06:47:17Z\", \"url\": \"/ftp/druid\", \"user\": \"alice\"}**\r\ndata should be correct.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451402510/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451426031","html_url":"https://github.com/apache/druid/pull/6683#issuecomment-451426031","issue_url":"https://api.github.com/repos/apache/druid/issues/6683","id":451426031,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTQyNjAzMQ==","user":{"login":"kaijianding","id":8663725,"node_id":"MDQ6VXNlcjg2NjM3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/8663725?v=4","gravatar_id":"","url":"https://api.github.com/users/kaijianding","html_url":"https://github.com/kaijianding","followers_url":"https://api.github.com/users/kaijianding/followers","following_url":"https://api.github.com/users/kaijianding/following{/other_user}","gists_url":"https://api.github.com/users/kaijianding/gists{/gist_id}","starred_url":"https://api.github.com/users/kaijianding/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaijianding/subscriptions","organizations_url":"https://api.github.com/users/kaijianding/orgs","repos_url":"https://api.github.com/users/kaijianding/repos","events_url":"https://api.github.com/users/kaijianding/events{/privacy}","received_events_url":"https://api.github.com/users/kaijianding/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T12:01:36Z","updated_at":"2019-01-04T12:01:36Z","author_association":"CONTRIBUTOR","body":"@jihoonson Announcer.java is also used in realtime node to re-announce itself when temporary disconnecting to zk, Then a realtime node also watches `/some/zk/path/announcements` ","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451426031/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451434343","html_url":"https://github.com/apache/druid/pull/6724#issuecomment-451434343","issue_url":"https://api.github.com/repos/apache/druid/issues/6724","id":451434343,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTQzNDM0Mw==","user":{"login":"QiuMM","id":15156517,"node_id":"MDQ6VXNlcjE1MTU2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/15156517?v=4","gravatar_id":"","url":"https://api.github.com/users/QiuMM","html_url":"https://github.com/QiuMM","followers_url":"https://api.github.com/users/QiuMM/followers","following_url":"https://api.github.com/users/QiuMM/following{/other_user}","gists_url":"https://api.github.com/users/QiuMM/gists{/gist_id}","starred_url":"https://api.github.com/users/QiuMM/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/QiuMM/subscriptions","organizations_url":"https://api.github.com/users/QiuMM/orgs","repos_url":"https://api.github.com/users/QiuMM/repos","events_url":"https://api.github.com/users/QiuMM/events{/privacy}","received_events_url":"https://api.github.com/users/QiuMM/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T12:44:35Z","updated_at":"2019-01-04T12:44:35Z","author_association":"MEMBER","body":"@jon-wei I revert the last commit since it would change the expected behavior and cause the CI failures. \r\n> Using the iterator would avoid the ISE, but I think it's still possible to persist a Sink that was already abandoned (i.e., abandonSegment could remove a Sink after that Sink is returned by iterator.next() in persistAll)).\r\n\r\nI think there is no need to concern this. `abandonSegment` is called in `clear` , `close` and `drop` : \r\n1. In `clear`, here is the code, it will await the dropping.\r\n\r\n```java\r\n        // Drop everything.\r\n        final List<ListenableFuture<?>> futures = Lists.newArrayList();\r\n        for (Map.Entry<SegmentIdentifier, Sink> entry : sinks.entrySet()) {\r\n          futures.add(abandonSegment(entry.getKey(), entry.getValue(), true));\r\n        }\r\n\r\n        // Await dropping.\r\n        Futures.allAsList(futures).get();\r\n```\r\n  2. In `close`, it will also await the dropping and shutdown the `persistExecutor`.\r\n  3. In `drop`, it means the handoff operation have been finished, which means the the `hydrant`s \r\n   have been already swapped and will be ignored to persist.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451434343/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451453010","html_url":"https://github.com/apache/druid/issues/3362#issuecomment-451453010","issue_url":"https://api.github.com/repos/apache/druid/issues/3362","id":451453010,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTQ1MzAxMA==","user":{"login":"agahemre","id":6897511,"node_id":"MDQ6VXNlcjY4OTc1MTE=","avatar_url":"https://avatars.githubusercontent.com/u/6897511?v=4","gravatar_id":"","url":"https://api.github.com/users/agahemre","html_url":"https://github.com/agahemre","followers_url":"https://api.github.com/users/agahemre/followers","following_url":"https://api.github.com/users/agahemre/following{/other_user}","gists_url":"https://api.github.com/users/agahemre/gists{/gist_id}","starred_url":"https://api.github.com/users/agahemre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/agahemre/subscriptions","organizations_url":"https://api.github.com/users/agahemre/orgs","repos_url":"https://api.github.com/users/agahemre/repos","events_url":"https://api.github.com/users/agahemre/events{/privacy}","received_events_url":"https://api.github.com/users/agahemre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T14:08:40Z","updated_at":"2019-01-04T15:18:21Z","author_association":"NONE","body":"I am getting the same error message. This message is related with the same data source segment which is no longer available. Are there any guess what root cause can be ?  ","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451453010/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451539134","html_url":"https://github.com/apache/druid/issues/6803#issuecomment-451539134","issue_url":"https://api.github.com/repos/apache/druid/issues/6803","id":451539134,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTUzOTEzNA==","user":{"login":"ankit0811","id":12939079,"node_id":"MDQ6VXNlcjEyOTM5MDc5","avatar_url":"https://avatars.githubusercontent.com/u/12939079?v=4","gravatar_id":"","url":"https://api.github.com/users/ankit0811","html_url":"https://github.com/ankit0811","followers_url":"https://api.github.com/users/ankit0811/followers","following_url":"https://api.github.com/users/ankit0811/following{/other_user}","gists_url":"https://api.github.com/users/ankit0811/gists{/gist_id}","starred_url":"https://api.github.com/users/ankit0811/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ankit0811/subscriptions","organizations_url":"https://api.github.com/users/ankit0811/orgs","repos_url":"https://api.github.com/users/ankit0811/repos","events_url":"https://api.github.com/users/ankit0811/events{/privacy}","received_events_url":"https://api.github.com/users/ankit0811/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T19:11:28Z","updated_at":"2019-01-04T19:26:15Z","author_association":"CONTRIBUTOR","body":"@jon-wei `HadoopIndexTask` will issue the kill command using the `ToolRunner` util class\r\nWe do have a working implementation ready for 0.12.2 and have been testing it for quite some time now. The classes/interface affected will be `JobHelper`, `IndexGeneratorJob`, `HadoopDruidIndexGeneratorJob`, `HadoopDruidIndexerConfig`, `HadoopDruidDetermineConfigurationJob`, `DetermineHashedPartitionsJob`, `Jobby`, `Task`, `ForkingTaskRunner`\r\n\r\nfor phase II will share a detailed use case soon\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451539134/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451546740","html_url":"https://github.com/apache/druid/issues/6803#issuecomment-451546740","issue_url":"https://api.github.com/repos/apache/druid/issues/6803","id":451546740,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTU0Njc0MA==","user":{"login":"ankit0811","id":12939079,"node_id":"MDQ6VXNlcjEyOTM5MDc5","avatar_url":"https://avatars.githubusercontent.com/u/12939079?v=4","gravatar_id":"","url":"https://api.github.com/users/ankit0811","html_url":"https://github.com/ankit0811","followers_url":"https://api.github.com/users/ankit0811/followers","following_url":"https://api.github.com/users/ankit0811/following{/other_user}","gists_url":"https://api.github.com/users/ankit0811/gists{/gist_id}","starred_url":"https://api.github.com/users/ankit0811/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ankit0811/subscriptions","organizations_url":"https://api.github.com/users/ankit0811/orgs","repos_url":"https://api.github.com/users/ankit0811/repos","events_url":"https://api.github.com/users/ankit0811/events{/privacy}","received_events_url":"https://api.github.com/users/ankit0811/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T19:38:53Z","updated_at":"2019-01-04T19:38:53Z","author_association":"CONTRIBUTOR","body":"@jihoonson so you are suggesting to go for phaseII first and then make a unified kill task support?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451546740/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451550892","html_url":"https://github.com/apache/druid/issues/6803#issuecomment-451550892","issue_url":"https://api.github.com/repos/apache/druid/issues/6803","id":451550892,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTU1MDg5Mg==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T19:54:00Z","updated_at":"2019-01-04T19:54:00Z","author_association":"CONTRIBUTOR","body":"@ankit0811 I'm also not sure what restoring means for Hadoop indexTask and how it's useful. I just mean, you may need to make Hadoop indexTask restorable no matter what it does on `restore()`. Or, maybe it's better to extend `stopGracefully()` to be called for non-restorable tasks as well.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451550892/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451578866","html_url":"https://github.com/apache/druid/pull/6780#issuecomment-451578866","issue_url":"https://api.github.com/repos/apache/druid/issues/6780","id":451578866,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTU3ODg2Ng==","user":{"login":"jihoonson","id":2322288,"node_id":"MDQ6VXNlcjIzMjIyODg=","avatar_url":"https://avatars.githubusercontent.com/u/2322288?v=4","gravatar_id":"","url":"https://api.github.com/users/jihoonson","html_url":"https://github.com/jihoonson","followers_url":"https://api.github.com/users/jihoonson/followers","following_url":"https://api.github.com/users/jihoonson/following{/other_user}","gists_url":"https://api.github.com/users/jihoonson/gists{/gist_id}","starred_url":"https://api.github.com/users/jihoonson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jihoonson/subscriptions","organizations_url":"https://api.github.com/users/jihoonson/orgs","repos_url":"https://api.github.com/users/jihoonson/repos","events_url":"https://api.github.com/users/jihoonson/events{/privacy}","received_events_url":"https://api.github.com/users/jihoonson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T21:50:38Z","updated_at":"2019-01-04T21:50:38Z","author_association":"CONTRIBUTOR","body":"@nishantmonu51 do you have more comments?","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451578866/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451592432","html_url":"https://github.com/apache/druid/pull/6792#issuecomment-451592432","issue_url":"https://api.github.com/repos/apache/druid/issues/6792","id":451592432,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTU5MjQzMg==","user":{"login":"surekhasaharan","id":13008746,"node_id":"MDQ6VXNlcjEzMDA4NzQ2","avatar_url":"https://avatars.githubusercontent.com/u/13008746?v=4","gravatar_id":"","url":"https://api.github.com/users/surekhasaharan","html_url":"https://github.com/surekhasaharan","followers_url":"https://api.github.com/users/surekhasaharan/followers","following_url":"https://api.github.com/users/surekhasaharan/following{/other_user}","gists_url":"https://api.github.com/users/surekhasaharan/gists{/gist_id}","starred_url":"https://api.github.com/users/surekhasaharan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surekhasaharan/subscriptions","organizations_url":"https://api.github.com/users/surekhasaharan/orgs","repos_url":"https://api.github.com/users/surekhasaharan/repos","events_url":"https://api.github.com/users/surekhasaharan/events{/privacy}","received_events_url":"https://api.github.com/users/surekhasaharan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-04T22:51:00Z","updated_at":"2019-01-04T22:52:04Z","author_association":"NONE","body":"> It looks that many codes are duplicated in TestQueryHelper and SqlResourceTestClient. Could you export them as a common abstract class or a util class?\r\n\r\n@jihoonson You probably meant QueryResourceTestClient and SqlResourceTestClient, I added an abstract class for those.","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451592432/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451613706","html_url":"https://github.com/apache/druid/pull/6724#issuecomment-451613706","issue_url":"https://api.github.com/repos/apache/druid/issues/6724","id":451613706,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTYxMzcwNg==","user":{"login":"jon-wei","id":8729063,"node_id":"MDQ6VXNlcjg3MjkwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8729063?v=4","gravatar_id":"","url":"https://api.github.com/users/jon-wei","html_url":"https://github.com/jon-wei","followers_url":"https://api.github.com/users/jon-wei/followers","following_url":"https://api.github.com/users/jon-wei/following{/other_user}","gists_url":"https://api.github.com/users/jon-wei/gists{/gist_id}","starred_url":"https://api.github.com/users/jon-wei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jon-wei/subscriptions","organizations_url":"https://api.github.com/users/jon-wei/orgs","repos_url":"https://api.github.com/users/jon-wei/repos","events_url":"https://api.github.com/users/jon-wei/events{/privacy}","received_events_url":"https://api.github.com/users/jon-wei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-05T01:08:59Z","updated_at":"2019-01-05T01:08:59Z","author_association":"CONTRIBUTOR","body":"@QiuMM Cool, thanks for looking into this","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451613706/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451615533","html_url":"https://github.com/apache/druid/pull/6798#issuecomment-451615533","issue_url":"https://api.github.com/repos/apache/druid/issues/6798","id":451615533,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTYxNTUzMw==","user":{"login":"drcrallen","id":8213081,"node_id":"MDQ6VXNlcjgyMTMwODE=","avatar_url":"https://avatars.githubusercontent.com/u/8213081?v=4","gravatar_id":"","url":"https://api.github.com/users/drcrallen","html_url":"https://github.com/drcrallen","followers_url":"https://api.github.com/users/drcrallen/followers","following_url":"https://api.github.com/users/drcrallen/following{/other_user}","gists_url":"https://api.github.com/users/drcrallen/gists{/gist_id}","starred_url":"https://api.github.com/users/drcrallen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drcrallen/subscriptions","organizations_url":"https://api.github.com/users/drcrallen/orgs","repos_url":"https://api.github.com/users/drcrallen/repos","events_url":"https://api.github.com/users/drcrallen/events{/privacy}","received_events_url":"https://api.github.com/users/drcrallen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-05T01:26:41Z","updated_at":"2019-01-05T01:26:41Z","author_association":"CONTRIBUTOR","body":"Cool, glad it helps!\r\n\r\nJust think, alllllll of the rest of the druid code base is there to make sure this little snippet of code does what its supposed to:\r\n\r\nhttps://github.com/ndolgov/gruid/blob/5afd56d7910515aab8c3856846c4ce2234e2c91f/druid-grpc/src/main/java/org/apache/druid/server/grpc/DruidGrpcQueryExecutor.java#L71-L90","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451615533/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451616919","html_url":"https://github.com/apache/druid/pull/5413#issuecomment-451616919","issue_url":"https://api.github.com/repos/apache/druid/issues/5413","id":451616919,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTYxNjkxOQ==","user":{"login":"drcrallen","id":8213081,"node_id":"MDQ6VXNlcjgyMTMwODE=","avatar_url":"https://avatars.githubusercontent.com/u/8213081?v=4","gravatar_id":"","url":"https://api.github.com/users/drcrallen","html_url":"https://github.com/drcrallen","followers_url":"https://api.github.com/users/drcrallen/followers","following_url":"https://api.github.com/users/drcrallen/following{/other_user}","gists_url":"https://api.github.com/users/drcrallen/gists{/gist_id}","starred_url":"https://api.github.com/users/drcrallen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/drcrallen/subscriptions","organizations_url":"https://api.github.com/users/drcrallen/orgs","repos_url":"https://api.github.com/users/drcrallen/repos","events_url":"https://api.github.com/users/drcrallen/events{/privacy}","received_events_url":"https://api.github.com/users/drcrallen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-05T01:41:47Z","updated_at":"2019-01-05T01:41:47Z","author_association":"CONTRIBUTOR","body":"This is too old at this point. closing","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451616919/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451626648","html_url":"https://github.com/apache/druid/issues/6795#issuecomment-451626648","issue_url":"https://api.github.com/repos/apache/druid/issues/6795","id":451626648,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTYyNjY0OA==","user":{"login":"leerho","id":12941506,"node_id":"MDQ6VXNlcjEyOTQxNTA2","avatar_url":"https://avatars.githubusercontent.com/u/12941506?v=4","gravatar_id":"","url":"https://api.github.com/users/leerho","html_url":"https://github.com/leerho","followers_url":"https://api.github.com/users/leerho/followers","following_url":"https://api.github.com/users/leerho/following{/other_user}","gists_url":"https://api.github.com/users/leerho/gists{/gist_id}","starred_url":"https://api.github.com/users/leerho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leerho/subscriptions","organizations_url":"https://api.github.com/users/leerho/orgs","repos_url":"https://api.github.com/users/leerho/repos","events_url":"https://api.github.com/users/leerho/events{/privacy}","received_events_url":"https://api.github.com/users/leerho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-05T04:25:19Z","updated_at":"2019-01-05T04:25:19Z","author_association":"CONTRIBUTOR","body":"That would be fabulous!","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451626648/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451640364","html_url":"https://github.com/apache/druid/issues/6809#issuecomment-451640364","issue_url":"https://api.github.com/repos/apache/druid/issues/6809","id":451640364,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTY0MDM2NA==","user":{"login":"helianthuslulu","id":4606832,"node_id":"MDQ6VXNlcjQ2MDY4MzI=","avatar_url":"https://avatars.githubusercontent.com/u/4606832?v=4","gravatar_id":"","url":"https://api.github.com/users/helianthuslulu","html_url":"https://github.com/helianthuslulu","followers_url":"https://api.github.com/users/helianthuslulu/followers","following_url":"https://api.github.com/users/helianthuslulu/following{/other_user}","gists_url":"https://api.github.com/users/helianthuslulu/gists{/gist_id}","starred_url":"https://api.github.com/users/helianthuslulu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/helianthuslulu/subscriptions","organizations_url":"https://api.github.com/users/helianthuslulu/orgs","repos_url":"https://api.github.com/users/helianthuslulu/repos","events_url":"https://api.github.com/users/helianthuslulu/events{/privacy}","received_events_url":"https://api.github.com/users/helianthuslulu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-05T09:17:34Z","updated_at":"2019-01-05T09:17:34Z","author_association":"NONE","body":"Does someone had the same problem？ ","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451640364/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451648149","html_url":"https://github.com/apache/druid/issues/6809#issuecomment-451648149","issue_url":"https://api.github.com/repos/apache/druid/issues/6809","id":451648149,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTY0ODE0OQ==","user":{"login":"nishantmonu51","id":5023786,"node_id":"MDQ6VXNlcjUwMjM3ODY=","avatar_url":"https://avatars.githubusercontent.com/u/5023786?v=4","gravatar_id":"","url":"https://api.github.com/users/nishantmonu51","html_url":"https://github.com/nishantmonu51","followers_url":"https://api.github.com/users/nishantmonu51/followers","following_url":"https://api.github.com/users/nishantmonu51/following{/other_user}","gists_url":"https://api.github.com/users/nishantmonu51/gists{/gist_id}","starred_url":"https://api.github.com/users/nishantmonu51/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nishantmonu51/subscriptions","organizations_url":"https://api.github.com/users/nishantmonu51/orgs","repos_url":"https://api.github.com/users/nishantmonu51/repos","events_url":"https://api.github.com/users/nishantmonu51/events{/privacy}","received_events_url":"https://api.github.com/users/nishantmonu51/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-05T11:38:23Z","updated_at":"2019-01-05T11:38:23Z","author_association":"MEMBER","body":"either there is no events to be ingested in the topic or all the events are unparseable. ","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451648149/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/druid/issues/comments/451667289","html_url":"https://github.com/apache/druid/issues/6651#issuecomment-451667289","issue_url":"https://api.github.com/repos/apache/druid/issues/6651","id":451667289,"node_id":"MDEyOklzc3VlQ29tbWVudDQ1MTY2NzI4OQ==","user":{"login":"zhaojiandong","id":5977839,"node_id":"MDQ6VXNlcjU5Nzc4Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/5977839?v=4","gravatar_id":"","url":"https://api.github.com/users/zhaojiandong","html_url":"https://github.com/zhaojiandong","followers_url":"https://api.github.com/users/zhaojiandong/followers","following_url":"https://api.github.com/users/zhaojiandong/following{/other_user}","gists_url":"https://api.github.com/users/zhaojiandong/gists{/gist_id}","starred_url":"https://api.github.com/users/zhaojiandong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhaojiandong/subscriptions","organizations_url":"https://api.github.com/users/zhaojiandong/orgs","repos_url":"https://api.github.com/users/zhaojiandong/repos","events_url":"https://api.github.com/users/zhaojiandong/events{/privacy}","received_events_url":"https://api.github.com/users/zhaojiandong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-01-05T16:03:29Z","updated_at":"2019-01-05T16:03:29Z","author_association":"CONTRIBUTOR","body":"> Hi @zhaojiandong,\r\n> \r\n> I tried a similar query on master and got a correct result. It is possible something has been fixed here since the version you're using. Could you tell if this query works in master (or even in the latest 0.13.0 RC, available at https://dist.apache.org/repos/dist/dev/incubator/druid/0.13.0-incubating-rc3/)?\r\n> \r\n> If you still find issues in master, could you please write a unit test that shows the problem, in CalciteQueryTest?\r\n> \r\n> Thanks!\r\n\r\nThanks Gianm\r\nIt works in 0.13.0, we use 0.12.0","reactions":{"url":"https://api.github.com/repos/apache/druid/issues/comments/451667289/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]