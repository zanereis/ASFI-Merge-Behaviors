[{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1910518213","html_url":"https://github.com/apache/ratis/pull/1029#issuecomment-1910518213","issue_url":"https://api.github.com/repos/apache/ratis/issues/1029","id":1910518213,"node_id":"IC_kwDOBMxbGc5x4DHF","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-25T16:07:36Z","updated_at":"2024-01-25T16:07:36Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1910518213/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1912902685","html_url":"https://github.com/apache/ratis/pull/1023#issuecomment-1912902685","issue_url":"https://api.github.com/repos/apache/ratis/issues/1023","id":1912902685,"node_id":"IC_kwDOBMxbGc5yBJQd","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-27T01:35:31Z","updated_at":"2024-01-27T01:35:31Z","author_association":"CONTRIBUTOR","body":"I had to pause working on this issue to fix new leaks found: @szetszwo \r\n- https://issues.apache.org/jira/browse/RATIS-2017: race condition from checkAndEvictCache.\r\n- Reopened RATIS-2007 for multiple other leaks. \r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1912902685/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1912922808","html_url":"https://github.com/apache/ratis/pull/1030#issuecomment-1912922808","issue_url":"https://api.github.com/repos/apache/ratis/issues/1030","id":1912922808,"node_id":"IC_kwDOBMxbGc5yBOK4","user":{"login":"symious","id":14933944,"node_id":"MDQ6VXNlcjE0OTMzOTQ0","avatar_url":"https://avatars.githubusercontent.com/u/14933944?v=4","gravatar_id":"","url":"https://api.github.com/users/symious","html_url":"https://github.com/symious","followers_url":"https://api.github.com/users/symious/followers","following_url":"https://api.github.com/users/symious/following{/other_user}","gists_url":"https://api.github.com/users/symious/gists{/gist_id}","starred_url":"https://api.github.com/users/symious/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/symious/subscriptions","organizations_url":"https://api.github.com/users/symious/orgs","repos_url":"https://api.github.com/users/symious/repos","events_url":"https://api.github.com/users/symious/events{/privacy}","received_events_url":"https://api.github.com/users/symious/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-27T02:35:49Z","updated_at":"2024-01-27T02:35:49Z","author_association":"CONTRIBUTOR","body":"@szetszwo Updated, PTAL.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1912922808/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1913269325","html_url":"https://github.com/apache/ratis/pull/1030#issuecomment-1913269325","issue_url":"https://api.github.com/repos/apache/ratis/issues/1030","id":1913269325,"node_id":"IC_kwDOBMxbGc5yCixN","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-27T17:32:37Z","updated_at":"2024-01-27T17:32:37Z","author_association":"CONTRIBUTOR","body":"@symious , why having 54cd580b17bc9741cc2cd71c0ab8fd66553eacc3 ?  The check seems correct.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1913269325/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1913631586","html_url":"https://github.com/apache/ratis/pull/1030#issuecomment-1913631586","issue_url":"https://api.github.com/repos/apache/ratis/issues/1030","id":1913631586,"node_id":"IC_kwDOBMxbGc5yD7Ni","user":{"login":"symious","id":14933944,"node_id":"MDQ6VXNlcjE0OTMzOTQ0","avatar_url":"https://avatars.githubusercontent.com/u/14933944?v=4","gravatar_id":"","url":"https://api.github.com/users/symious","html_url":"https://github.com/symious","followers_url":"https://api.github.com/users/symious/followers","following_url":"https://api.github.com/users/symious/following{/other_user}","gists_url":"https://api.github.com/users/symious/gists{/gist_id}","starred_url":"https://api.github.com/users/symious/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/symious/subscriptions","organizations_url":"https://api.github.com/users/symious/orgs","repos_url":"https://api.github.com/users/symious/repos","events_url":"https://api.github.com/users/symious/events{/privacy}","received_events_url":"https://api.github.com/users/symious/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-28T15:20:46Z","updated_at":"2024-01-28T15:20:46Z","author_association":"CONTRIBUTOR","body":"> why having https://github.com/apache/ratis/commit/54cd580b17bc9741cc2cd71c0ab8fd66553eacc3 ? The check seems correct.\r\n\r\n@szetszwo The leader can send multiple requests before receiving the reply, so when received the first request with index 0, the queue will not be empty.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1913631586/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1913645552","html_url":"https://github.com/apache/ratis/pull/1030#issuecomment-1913645552","issue_url":"https://api.github.com/repos/apache/ratis/issues/1030","id":1913645552,"node_id":"IC_kwDOBMxbGc5yD-nw","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-28T16:06:28Z","updated_at":"2024-01-28T16:06:28Z","author_association":"CONTRIBUTOR","body":"@symious , you are right.  It is a queue but not a stack!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1913645552/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1913732287","html_url":"https://github.com/apache/ratis/pull/1032#issuecomment-1913732287","issue_url":"https://api.github.com/repos/apache/ratis/issues/1032","id":1913732287,"node_id":"IC_kwDOBMxbGc5yETy_","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-28T21:48:01Z","updated_at":"2024-01-28T21:48:01Z","author_association":"CONTRIBUTOR","body":"@szetszwo ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1913732287/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1913864817","html_url":"https://github.com/apache/ratis/pull/1030#issuecomment-1913864817","issue_url":"https://api.github.com/repos/apache/ratis/issues/1030","id":1913864817,"node_id":"IC_kwDOBMxbGc5yE0Jx","user":{"login":"symious","id":14933944,"node_id":"MDQ6VXNlcjE0OTMzOTQ0","avatar_url":"https://avatars.githubusercontent.com/u/14933944?v=4","gravatar_id":"","url":"https://api.github.com/users/symious","html_url":"https://github.com/symious","followers_url":"https://api.github.com/users/symious/followers","following_url":"https://api.github.com/users/symious/following{/other_user}","gists_url":"https://api.github.com/users/symious/gists{/gist_id}","starred_url":"https://api.github.com/users/symious/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/symious/subscriptions","organizations_url":"https://api.github.com/users/symious/orgs","repos_url":"https://api.github.com/users/symious/repos","events_url":"https://api.github.com/users/symious/events{/privacy}","received_events_url":"https://api.github.com/users/symious/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-29T02:40:24Z","updated_at":"2024-01-29T02:40:24Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thank your for the review and merge.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1913864817/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1913917283","html_url":"https://github.com/apache/ratis/pull/1033#issuecomment-1913917283","issue_url":"https://api.github.com/repos/apache/ratis/issues/1033","id":1913917283,"node_id":"IC_kwDOBMxbGc5yFA9j","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-29T03:54:35Z","updated_at":"2024-01-29T03:54:35Z","author_association":"CONTRIBUTOR","body":"@szetszwo PTAL!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1913917283/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1914109749","html_url":"https://github.com/apache/ratis/pull/1023#issuecomment-1914109749","issue_url":"https://api.github.com/repos/apache/ratis/issues/1023","id":1914109749,"node_id":"IC_kwDOBMxbGc5yFv81","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-29T07:28:34Z","updated_at":"2024-01-29T07:28:34Z","author_association":"CONTRIBUTOR","body":"This still depends on #1032 to fix all the leak buffers.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1914109749/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1915435501","html_url":"https://github.com/apache/ratis/pull/1032#issuecomment-1915435501","issue_url":"https://api.github.com/repos/apache/ratis/issues/1032","id":1915435501,"node_id":"IC_kwDOBMxbGc5yKznt","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-29T19:43:00Z","updated_at":"2024-01-29T19:43:00Z","author_association":"CONTRIBUTOR","body":"https://github.com/apache/ratis/blob/66d7d3956b0f24efa7628740dd063d5cb15185a9/ratis-grpc/src/main/java/org/apache/ratis/grpc/server/GrpcServerProtocolService.java#L175\r\n\r\nOne more comments:  The line above should not use request since it may be released.  We should pass `callId` and `isHeartbeat`; see https://issues.apache.org/jira/secure/attachment/13066333/1032_review.patch","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1915435501/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1915781073","html_url":"https://github.com/apache/ratis/pull/1032#issuecomment-1915781073","issue_url":"https://api.github.com/repos/apache/ratis/issues/1032","id":1915781073,"node_id":"IC_kwDOBMxbGc5yMH_R","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-29T23:52:16Z","updated_at":"2024-01-29T23:52:16Z","author_association":"CONTRIBUTOR","body":"Thanks for the detailed review, @szetszwo. We should completely avoid using requests in the asynchronous contexts (reply, error handler) as you suggest.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1915781073/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1915989734","html_url":"https://github.com/apache/ratis/pull/1023#issuecomment-1915989734","issue_url":"https://api.github.com/repos/apache/ratis/issues/1023","id":1915989734,"node_id":"IC_kwDOBMxbGc5yM67m","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-30T03:02:55Z","updated_at":"2024-01-30T03:02:55Z","author_association":"CONTRIBUTOR","body":"#1032 is merged to master. Rebased this PR. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1915989734/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1921818429","html_url":"https://github.com/apache/ratis/pull/1038#issuecomment-1921818429","issue_url":"https://api.github.com/repos/apache/ratis/issues/1038","id":1921818429,"node_id":"IC_kwDOBMxbGc5yjJ89","user":{"login":"nandakumar131","id":8871229,"node_id":"MDQ6VXNlcjg4NzEyMjk=","avatar_url":"https://avatars.githubusercontent.com/u/8871229?v=4","gravatar_id":"","url":"https://api.github.com/users/nandakumar131","html_url":"https://github.com/nandakumar131","followers_url":"https://api.github.com/users/nandakumar131/followers","following_url":"https://api.github.com/users/nandakumar131/following{/other_user}","gists_url":"https://api.github.com/users/nandakumar131/gists{/gist_id}","starred_url":"https://api.github.com/users/nandakumar131/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nandakumar131/subscriptions","organizations_url":"https://api.github.com/users/nandakumar131/orgs","repos_url":"https://api.github.com/users/nandakumar131/repos","events_url":"https://api.github.com/users/nandakumar131/events{/privacy}","received_events_url":"https://api.github.com/users/nandakumar131/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-01T17:13:52Z","updated_at":"2024-02-01T17:13:52Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo  for the review and merge!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1921818429/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1921818971","html_url":"https://github.com/apache/ratis/pull/1037#issuecomment-1921818971","issue_url":"https://api.github.com/repos/apache/ratis/issues/1037","id":1921818971,"node_id":"IC_kwDOBMxbGc5yjKFb","user":{"login":"nandakumar131","id":8871229,"node_id":"MDQ6VXNlcjg4NzEyMjk=","avatar_url":"https://avatars.githubusercontent.com/u/8871229?v=4","gravatar_id":"","url":"https://api.github.com/users/nandakumar131","html_url":"https://github.com/nandakumar131","followers_url":"https://api.github.com/users/nandakumar131/followers","following_url":"https://api.github.com/users/nandakumar131/following{/other_user}","gists_url":"https://api.github.com/users/nandakumar131/gists{/gist_id}","starred_url":"https://api.github.com/users/nandakumar131/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nandakumar131/subscriptions","organizations_url":"https://api.github.com/users/nandakumar131/orgs","repos_url":"https://api.github.com/users/nandakumar131/repos","events_url":"https://api.github.com/users/nandakumar131/events{/privacy}","received_events_url":"https://api.github.com/users/nandakumar131/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-01T17:14:10Z","updated_at":"2024-02-01T17:14:10Z","author_association":"CONTRIBUTOR","body":"Thanks @adoroszlai for the review and merge!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1921818971/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1921929393","html_url":"https://github.com/apache/ratis/pull/1039#issuecomment-1921929393","issue_url":"https://api.github.com/repos/apache/ratis/issues/1039","id":1921929393,"node_id":"IC_kwDOBMxbGc5yjlCx","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-01T18:12:01Z","updated_at":"2024-02-01T18:12:01Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for reviewing and merging this.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1921929393/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1930225344","html_url":"https://github.com/apache/ratis/pull/1040#issuecomment-1930225344","issue_url":"https://api.github.com/repos/apache/ratis/issues/1040","id":1930225344,"node_id":"IC_kwDOBMxbGc5zDObA","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-06T16:23:02Z","updated_at":"2024-02-06T16:23:02Z","author_association":"CONTRIBUTOR","body":"@adoroszlai , thanks for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1930225344/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1932524321","html_url":"https://github.com/apache/ratis/pull/1041#issuecomment-1932524321","issue_url":"https://api.github.com/repos/apache/ratis/issues/1041","id":1932524321,"node_id":"IC_kwDOBMxbGc5zL_sh","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-07T17:20:24Z","updated_at":"2024-02-07T17:20:24Z","author_association":"CONTRIBUTOR","body":"@adoroszlai , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1932524321/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1933240304","html_url":"https://github.com/apache/ratis/pull/1042#issuecomment-1933240304","issue_url":"https://api.github.com/repos/apache/ratis/issues/1042","id":1933240304,"node_id":"IC_kwDOBMxbGc5zOufw","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-08T01:50:04Z","updated_at":"2024-02-08T01:50:04Z","author_association":"CONTRIBUTOR","body":"@szetszwo ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1933240304/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1936375703","html_url":"https://github.com/apache/ratis/pull/1042#issuecomment-1936375703","issue_url":"https://api.github.com/repos/apache/ratis/issues/1042","id":1936375703,"node_id":"IC_kwDOBMxbGc5zar-X","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-09T18:03:03Z","updated_at":"2024-02-09T18:03:03Z","author_association":"CONTRIBUTOR","body":"> @duongkame , thanks a lot for working on this! Since this change is quite large and involves multiple public API classes. Let's refactor only `TransactionContext` and the work on the `RaftLog` and `StateMachine` in a separated JIRA?\r\n> \r\n> See the comments inlined and also https://issues.apache.org/jira/secure/attachment/13066614/1042_review.patch\r\n\r\nThanks for the detailed review as always, @szetszwo . \r\nThe chance in `RaftLog` is quite minimal and a direct dependency of `TransactionContext` context API changes. `StateMachine` changes are straightforward and a consequence of `TransactionContext` changes as well. Removing them would not reduce the complexity of the PR much imho. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1936375703/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1945476818","html_url":"https://github.com/apache/ratis/pull/1042#issuecomment-1945476818","issue_url":"https://api.github.com/repos/apache/ratis/issues/1042","id":1945476818,"node_id":"IC_kwDOBMxbGc5z9Z7S","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-15T07:04:00Z","updated_at":"2024-02-15T07:04:00Z","author_association":"CONTRIBUTOR","body":"> > The chance in RaftLog is quite minimal and a direct dependency of TransactionContext context API changes. StateMachine changes are straightforward and a consequence of TransactionContext changes as well. ...\r\n> \r\n> I don't understand the dependency -- the `TransactionContext` change is for `StateMachine` implementations. It does not seem to relate to RaftLog.\r\n> \r\n> Also, the changes are quite separate, even the changed files are different. I just have tried moving out the `TransactionContext` change by reverting the other changed files; see https://issues.apache.org/jira/secure/attachment/13066642/1042_review2.patch\r\n> \r\n> > ... Removing them would not reduce the complexity of the PR much imho.\r\n> \r\n> It is also about future maintenance. This is not a simple code change and involve public API changes. If there are bugs/incompatibility problems later on, it will be easier to fix it or revert the change. It is also easier to backport.\r\n\r\nSure. I've moved the RaftLog changes out, to RATIS-2028. Thanks for the suggestion. \r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1945476818/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1951591873","html_url":"https://github.com/apache/ratis/pull/1044#issuecomment-1951591873","issue_url":"https://api.github.com/repos/apache/ratis/issues/1044","id":1951591873,"node_id":"IC_kwDOBMxbGc50Uu3B","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-19T02:33:23Z","updated_at":"2024-02-19T02:33:23Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo work on this. Let me see.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1951591873/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1953460156","html_url":"https://github.com/apache/ratis/pull/1043#issuecomment-1953460156","issue_url":"https://api.github.com/repos/apache/ratis/issues/1043","id":1953460156,"node_id":"IC_kwDOBMxbGc50b2-8","user":{"login":"nandakumar131","id":8871229,"node_id":"MDQ6VXNlcjg4NzEyMjk=","avatar_url":"https://avatars.githubusercontent.com/u/8871229?v=4","gravatar_id":"","url":"https://api.github.com/users/nandakumar131","html_url":"https://github.com/nandakumar131","followers_url":"https://api.github.com/users/nandakumar131/followers","following_url":"https://api.github.com/users/nandakumar131/following{/other_user}","gists_url":"https://api.github.com/users/nandakumar131/gists{/gist_id}","starred_url":"https://api.github.com/users/nandakumar131/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nandakumar131/subscriptions","organizations_url":"https://api.github.com/users/nandakumar131/orgs","repos_url":"https://api.github.com/users/nandakumar131/repos","events_url":"https://api.github.com/users/nandakumar131/events{/privacy}","received_events_url":"https://api.github.com/users/nandakumar131/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-20T04:13:17Z","updated_at":"2024-02-20T04:13:17Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for the review. Fixed the unit test failure and updated the PR.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1953460156/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1955353236","html_url":"https://github.com/apache/ratis/pull/1042#issuecomment-1955353236","issue_url":"https://api.github.com/repos/apache/ratis/issues/1042","id":1955353236,"node_id":"IC_kwDOBMxbGc50jFKU","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-20T23:34:44Z","updated_at":"2024-02-20T23:34:44Z","author_association":"CONTRIBUTOR","body":"@szetszwo RaftLog changes are all dropped. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1955353236/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1956453907","html_url":"https://github.com/apache/ratis/pull/1044#issuecomment-1956453907","issue_url":"https://api.github.com/repos/apache/ratis/issues/1044","id":1956453907,"node_id":"IC_kwDOBMxbGc50nR4T","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-21T11:31:55Z","updated_at":"2024-02-21T11:31:55Z","author_association":"CONTRIBUTOR","body":"LGTM. Thanks @szetszwo .","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1956453907/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1957281192","html_url":"https://github.com/apache/ratis/pull/1044#issuecomment-1957281192","issue_url":"https://api.github.com/repos/apache/ratis/issues/1044","id":1957281192,"node_id":"IC_kwDOBMxbGc50qb2o","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-21T16:51:46Z","updated_at":"2024-02-21T16:51:46Z","author_association":"CONTRIBUTOR","body":"@guohao-rosicky , thanks a lot for reviewing and merging this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1957281192/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1973747496","html_url":"https://github.com/apache/ratis/pull/1048#issuecomment-1973747496","issue_url":"https://api.github.com/repos/apache/ratis/issues/1048","id":1973747496,"node_id":"IC_kwDOBMxbGc51pP8o","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-01T18:52:30Z","updated_at":"2024-03-01T18:52:30Z","author_association":"CONTRIBUTOR","body":"@adoroszlai , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1973747496/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1973996458","html_url":"https://github.com/apache/ratis/pull/1047#issuecomment-1973996458","issue_url":"https://api.github.com/repos/apache/ratis/issues/1047","id":1973996458,"node_id":"IC_kwDOBMxbGc51qMuq","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-01T22:09:54Z","updated_at":"2024-03-01T22:09:54Z","author_association":"CONTRIBUTOR","body":"@DaveTeng0 , Let's add the peer info (i.e. applyIndex etc.) to `GroupInfoReply`.  Then, we won't need two different info methods.\r\n\r\nSorry that I said `GroupInfoRequest` was sent to the leader.  Indeed, it was sent to a particular server specified in the parameter in getGroupManagementApi https://github.com/apache/ratis/blob/1bd451046b2d33fe063712d7e811262bef580a4e/ratis-client/src/main/java/org/apache/ratis/client/RaftClient.java#L63 .)","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1973996458/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1974007113","html_url":"https://github.com/apache/ratis/pull/1047#issuecomment-1974007113","issue_url":"https://api.github.com/repos/apache/ratis/issues/1047","id":1974007113,"node_id":"IC_kwDOBMxbGc51qPVJ","user":{"login":"DaveTeng0","id":109315747,"node_id":"U_kgDOBoQGow","avatar_url":"https://avatars.githubusercontent.com/u/109315747?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveTeng0","html_url":"https://github.com/DaveTeng0","followers_url":"https://api.github.com/users/DaveTeng0/followers","following_url":"https://api.github.com/users/DaveTeng0/following{/other_user}","gists_url":"https://api.github.com/users/DaveTeng0/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveTeng0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveTeng0/subscriptions","organizations_url":"https://api.github.com/users/DaveTeng0/orgs","repos_url":"https://api.github.com/users/DaveTeng0/repos","events_url":"https://api.github.com/users/DaveTeng0/events{/privacy}","received_events_url":"https://api.github.com/users/DaveTeng0/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-01T22:15:22Z","updated_at":"2024-03-01T22:15:22Z","author_association":"CONTRIBUTOR","body":"> @DaveTeng0 , Let's add the peer info (i.e. applyIndex etc.) to `GroupInfoReply`. Then, we won't need two different info methods.\r\n> \r\n> Sorry that I said `GroupInfoRequest` was sent to the leader. Indeed, it was sent to a particular server specified in the parameter in getGroupManagementApi\r\n> \r\n> https://github.com/apache/ratis/blob/1bd451046b2d33fe063712d7e811262bef580a4e/ratis-client/src/main/java/org/apache/ratis/client/RaftClient.java#L63\r\n> \r\n> .)\r\n\r\noh sure! yeah I definitely could move those into GroupInfoReply!  Thanks Nicholas for the suggestion!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1974007113/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1974011616","html_url":"https://github.com/apache/ratis/pull/1047#issuecomment-1974011616","issue_url":"https://api.github.com/repos/apache/ratis/issues/1047","id":1974011616,"node_id":"IC_kwDOBMxbGc51qQbg","user":{"login":"DaveTeng0","id":109315747,"node_id":"U_kgDOBoQGow","avatar_url":"https://avatars.githubusercontent.com/u/109315747?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveTeng0","html_url":"https://github.com/DaveTeng0","followers_url":"https://api.github.com/users/DaveTeng0/followers","following_url":"https://api.github.com/users/DaveTeng0/following{/other_user}","gists_url":"https://api.github.com/users/DaveTeng0/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveTeng0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveTeng0/subscriptions","organizations_url":"https://api.github.com/users/DaveTeng0/orgs","repos_url":"https://api.github.com/users/DaveTeng0/repos","events_url":"https://api.github.com/users/DaveTeng0/events{/privacy}","received_events_url":"https://api.github.com/users/DaveTeng0/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-01T22:19:08Z","updated_at":"2024-03-01T22:19:08Z","author_association":"CONTRIBUTOR","body":"> aNod ca be involed with many projec\r\n\r\noh yeah works on Datanodes too, since user needs to add 'groupId' in this command (https://github.com/apache/ratis/pull/1047/files#diff-b69a99093904ce19e8e368cbf0f92252b53a53a39e1fbcfa38fcbc636b99db4dR73) whenever a ratis server belongs to multiple groups, otherwise the command would just fail.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1974011616/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1977263322","html_url":"https://github.com/apache/ratis/pull/1045#issuecomment-1977263322","issue_url":"https://api.github.com/repos/apache/ratis/issues/1045","id":1977263322,"node_id":"IC_kwDOBMxbGc512qTa","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-04T19:02:26Z","updated_at":"2024-03-04T19:02:26Z","author_association":"CONTRIBUTOR","body":"cc. @szetszwo ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1977263322/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1979653550","html_url":"https://github.com/apache/ratis/pull/1047#issuecomment-1979653550","issue_url":"https://api.github.com/repos/apache/ratis/issues/1047","id":1979653550,"node_id":"IC_kwDOBMxbGc51_x2u","user":{"login":"DaveTeng0","id":109315747,"node_id":"U_kgDOBoQGow","avatar_url":"https://avatars.githubusercontent.com/u/109315747?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveTeng0","html_url":"https://github.com/DaveTeng0","followers_url":"https://api.github.com/users/DaveTeng0/followers","following_url":"https://api.github.com/users/DaveTeng0/following{/other_user}","gists_url":"https://api.github.com/users/DaveTeng0/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveTeng0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveTeng0/subscriptions","organizations_url":"https://api.github.com/users/DaveTeng0/orgs","repos_url":"https://api.github.com/users/DaveTeng0/repos","events_url":"https://api.github.com/users/DaveTeng0/events{/privacy}","received_events_url":"https://api.github.com/users/DaveTeng0/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-05T21:19:46Z","updated_at":"2024-03-05T21:27:31Z","author_association":"CONTRIBUTOR","body":"> @DaveTeng0 , Let's add the peer info (i.e. applyIndex etc.) to `GroupInfoReply`. Then, we won't need two different info methods.\r\n> \r\n> Sorry that I said `GroupInfoRequest` was sent to the leader. Indeed, it was sent to a particular server specified in the parameter in getGroupManagementApi\r\n> \r\n> https://github.com/apache/ratis/blob/1bd451046b2d33fe063712d7e811262bef580a4e/ratis-client/src/main/java/org/apache/ratis/client/RaftClient.java#L63\r\n> \r\n> .)\r\n\r\nHey @szetszwo I merged the peer information (applied index, snapshot index, current term, etc.) into response of GroupInfoCommand. Please help to take another look, and feel free to let me know if there is any question, thanks!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1979653550/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1981500582","html_url":"https://github.com/apache/ratis/pull/1047#issuecomment-1981500582","issue_url":"https://api.github.com/repos/apache/ratis/issues/1047","id":1981500582,"node_id":"IC_kwDOBMxbGc52G0ym","user":{"login":"DaveTeng0","id":109315747,"node_id":"U_kgDOBoQGow","avatar_url":"https://avatars.githubusercontent.com/u/109315747?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveTeng0","html_url":"https://github.com/DaveTeng0","followers_url":"https://api.github.com/users/DaveTeng0/followers","following_url":"https://api.github.com/users/DaveTeng0/following{/other_user}","gists_url":"https://api.github.com/users/DaveTeng0/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveTeng0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveTeng0/subscriptions","organizations_url":"https://api.github.com/users/DaveTeng0/orgs","repos_url":"https://api.github.com/users/DaveTeng0/repos","events_url":"https://api.github.com/users/DaveTeng0/events{/privacy}","received_events_url":"https://api.github.com/users/DaveTeng0/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-06T18:09:09Z","updated_at":"2024-03-06T18:09:09Z","author_association":"CONTRIBUTOR","body":"> @DaveTeng0 , thanks for the update!\r\n> \r\n> We should change `GroupInfoReply`. The other protos and appendEntries/CommitInfo code should not be changed.\r\n\r\nHey @szetszwo updated accordingly, I move the logInfo related into GroupInfoReply! Please help to take another look when you have time, thanks!\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1981500582/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1982036377","html_url":"https://github.com/apache/ratis/pull/1045#issuecomment-1982036377","issue_url":"https://api.github.com/repos/apache/ratis/issues/1045","id":1982036377,"node_id":"IC_kwDOBMxbGc52I3mZ","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-06T23:34:16Z","updated_at":"2024-03-06T23:35:12Z","author_association":"CONTRIBUTOR","body":"> @duongkame , thanks for working not this! We should talk about the contract of the new `RaftLog.getWithRef`. Are `retain()`/`release()` required? If not, when is safe to use it?\r\n> \r\n> Currently, `SegmentedRaftLog` may release the returned `ref` and causing an exception as below:\r\n> \r\n> 1. SegmentedRaftLog loads an entry, creates `ref` and calls `retain()` in order to save it to cache.\r\n> 2. SegmentedRaftLog.getWithRef(..) returns `ref` to a caller.\r\n> 3. SegmentedRaftLog cache evicts the entry, the reference count becomes 0 and `ref` is completely released.\r\n> 4. The caller use `ref` by calling `get()` or `retain()`.  Then, it will get an exception.\r\n\r\nYeah, that's a good point. I had same question but wasn't sure if the log entry can be evicted shortly after being called with `get` from SegmentedRaftLog.  If theoretically eviction can happen immediately, calling `retain()` after `getWithRef()` can help either as there's no coordination between the SegmentedRaftLog internal state and the `ReferenceCountedObject` after it is returned.\r\n\r\nTo properly prevent this error, the `retain()` needs to be called in the readLock before `getWithRef` returns to prevent it from being cleaned up. It means a new API that looks like\r\n\r\n```\r\n# SegmentedRaftLog API\r\nvoid readLogEntry(long index, Consumer<LogEntryProto> consumer) {\r\n   try (AutoCloseableLock readLock = readLock()) {\r\n     segment = cache.getSegment(index);\r\n     record = segment.getLogRecord(index);\r\n     final ReferenceCountedObject<LogEntryProto> entry = segment.getEntryFromCache(record.getTermIndex());\r\n     LogEntryProto log = entry.retain();\r\n     try {\r\n       consumer.consume(log);\r\n     } finally {\r\n       entry.release();\r\n     }\r\n   }\r\n}\r\n\r\n\r\n```\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1982036377/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1982553699","html_url":"https://github.com/apache/ratis/pull/1046#issuecomment-1982553699","issue_url":"https://api.github.com/repos/apache/ratis/issues/1046","id":1982553699,"node_id":"IC_kwDOBMxbGc52K15j","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-07T06:30:01Z","updated_at":"2024-03-07T06:30:01Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for the patch, @OneSizeFitsQuorum for the review.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1982553699/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1982613140","html_url":"https://github.com/apache/ratis/pull/712#issuecomment-1982613140","issue_url":"https://api.github.com/repos/apache/ratis/issues/712","id":1982613140,"node_id":"IC_kwDOBMxbGc52LEaU","user":{"login":"symious","id":14933944,"node_id":"MDQ6VXNlcjE0OTMzOTQ0","avatar_url":"https://avatars.githubusercontent.com/u/14933944?v=4","gravatar_id":"","url":"https://api.github.com/users/symious","html_url":"https://github.com/symious","followers_url":"https://api.github.com/users/symious/followers","following_url":"https://api.github.com/users/symious/following{/other_user}","gists_url":"https://api.github.com/users/symious/gists{/gist_id}","starred_url":"https://api.github.com/users/symious/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/symious/subscriptions","organizations_url":"https://api.github.com/users/symious/orgs","repos_url":"https://api.github.com/users/symious/repos","events_url":"https://api.github.com/users/symious/events{/privacy}","received_events_url":"https://api.github.com/users/symious/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-07T06:53:12Z","updated_at":"2024-03-07T06:53:12Z","author_association":"CONTRIBUTOR","body":"Title and description should be changed to \"trigger heartbeat\" instead of \"trigger snapshot\".","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1982613140/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1983931815","html_url":"https://github.com/apache/ratis/pull/1046#issuecomment-1983931815","issue_url":"https://api.github.com/repos/apache/ratis/issues/1046","id":1983931815,"node_id":"IC_kwDOBMxbGc52QGWn","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-07T16:29:20Z","updated_at":"2024-03-07T16:29:20Z","author_association":"CONTRIBUTOR","body":"@adoroszlai , thanks a lot for reviewing and merging this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1983931815/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1983962784","html_url":"https://github.com/apache/ratis/pull/1045#issuecomment-1983962784","issue_url":"https://api.github.com/repos/apache/ratis/issues/1045","id":1983962784,"node_id":"IC_kwDOBMxbGc52QN6g","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-07T16:38:29Z","updated_at":"2024-03-07T16:38:29Z","author_association":"CONTRIBUTOR","body":"Could we retain it before returns and ask the caller to release it?\r\n```java\r\n//RaftLog\r\n   /**\r\n-   * @return a ReferenceCountedObject to the  log entry corresponding to the given log index if it exists.\r\n-   * otherwise, null.\r\n+   * @return a retained {@link ReferenceCountedObject} to the log entry corresponding to the given index\r\n+   *         if it exists; otherwise, return null.\r\n+   *         Since the returned reference is retained,\r\n+   *         the caller must call {@link ReferenceCountedObject#release()}} after use.\r\n    */\r\n-  default ReferenceCountedObject<LogEntryProto> getWithRef(long index) throws RaftLogIOException {\r\n+  default ReferenceCountedObject<LogEntryProto> retainEntry(long index) throws RaftLogIOException {\r\n     return ReferenceCountedObject.wrap(get(index));\r\n   }\r\n```\r\n\r\n```java\r\n@@ -287,6 +287,7 @@ public final class SegmentedRaftLog extends RaftLogBase {\r\n       }\r\n       final ReferenceCountedObject<LogEntryProto> entry = segment.getEntryFromCache(record.getTermIndex());\r\n       if (entry != null) {\r\n+        entry.retain();\r\n         getRaftLogMetrics().onRaftLogCacheHit();\r\n         return entry;\r\n       }\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1983962784/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1984209515","html_url":"https://github.com/apache/ratis/pull/1046#issuecomment-1984209515","issue_url":"https://api.github.com/repos/apache/ratis/issues/1046","id":1984209515,"node_id":"IC_kwDOBMxbGc52RKJr","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-07T18:49:09Z","updated_at":"2024-03-07T18:49:09Z","author_association":"CONTRIBUTOR","body":"@OneSizeFitsQuorum , thank you also for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1984209515/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1984277311","html_url":"https://github.com/apache/ratis/pull/712#issuecomment-1984277311","issue_url":"https://api.github.com/repos/apache/ratis/issues/712","id":1984277311,"node_id":"IC_kwDOBMxbGc52Ras_","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-07T19:31:36Z","updated_at":"2024-03-07T19:31:36Z","author_association":"CONTRIBUTOR","body":"@symious Updated.  Thanks for catching it!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1984277311/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1986080840","html_url":"https://github.com/apache/ratis/pull/1045#issuecomment-1986080840","issue_url":"https://api.github.com/repos/apache/ratis/issues/1045","id":1986080840,"node_id":"IC_kwDOBMxbGc52YTBI","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-08T17:07:31Z","updated_at":"2024-03-08T17:07:31Z","author_association":"CONTRIBUTOR","body":"> Could we retain it before returns and ask the caller to release it?\r\n> \r\n\r\nSounds good. We can call `retain` in the readLock.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1986080840/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1995408429","html_url":"https://github.com/apache/ratis/pull/1049#issuecomment-1995408429","issue_url":"https://api.github.com/repos/apache/ratis/issues/1049","id":1995408429,"node_id":"IC_kwDOBMxbGc5274Qt","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-13T19:01:17Z","updated_at":"2024-03-13T19:01:17Z","author_association":"CONTRIBUTOR","body":"cc. @szetszwo \r\nI have a question. Is there any reason why `newAppendEntriesRequest` is declared as an API under `LogAppender`. It seems to be more appropriate as an internal utility inside LogAppender implementations. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1995408429/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1995569141","html_url":"https://github.com/apache/ratis/pull/1049#issuecomment-1995569141","issue_url":"https://api.github.com/repos/apache/ratis/issues/1049","id":1995569141,"node_id":"IC_kwDOBMxbGc528ff1","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-13T19:51:27Z","updated_at":"2024-03-13T19:51:27Z","author_association":"CONTRIBUTOR","body":"> ...  Is there any reason why newAppendEntriesRequest is declared as an API under LogAppender. It seems to be more appropriate as an internal utility inside LogAppender implementations.\r\n\r\nYou are right that the `newAppendEntriesRequest` and the `newInstallSnapshot[Notification]Requests` methods are better removed from the `LogAppender` interface.  Let's deprecate them and remove later?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1995569141/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1996165782","html_url":"https://github.com/apache/ratis/pull/1049#issuecomment-1996165782","issue_url":"https://api.github.com/repos/apache/ratis/issues/1049","id":1996165782,"node_id":"IC_kwDOBMxbGc52-xKW","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-14T00:10:21Z","updated_at":"2024-03-15T23:49:35Z","author_association":"CONTRIBUTOR","body":"> You are right that the `newAppendEntriesRequest` and the `newInstallSnapshot[Notification]Requests` methods are better removed from the `LogAppender` interface. Let's deprecate them and remove later?\r\n\r\nThanks, makes sense. Please have a look whenever you have time. @szetszwo \r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1996165782/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1997986077","html_url":"https://github.com/apache/ratis/pull/1050#issuecomment-1997986077","issue_url":"https://api.github.com/repos/apache/ratis/issues/1050","id":1997986077,"node_id":"IC_kwDOBMxbGc53Ftkd","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-14T17:33:52Z","updated_at":"2024-03-14T17:33:52Z","author_association":"CONTRIBUTOR","body":"@symious , thanks for working on this!  It actually should store the `peerId` but not `peer`.  Then, the code can be simplified as below:\r\n```java\r\n+++ b/ratis-server/src/main/java/org/apache/ratis/server/impl/FollowerInfoImpl.java\r\n@@ -32,7 +32,7 @@ import java.util.function.LongUnaryOperator;\r\n class FollowerInfoImpl implements FollowerInfo {\r\n   private final String name;\r\n \r\n-  private final AtomicReference<RaftPeer> peer;\r\n+  private final RaftPeerId peerId;\r\n   private final Function<RaftPeerId, RaftPeer> getPeer;\r\n   private final AtomicReference<Timestamp> lastRpcResponseTime;\r\n   private final AtomicReference<Timestamp> lastRpcSendTime;\r\n@@ -47,9 +47,8 @@ class FollowerInfoImpl implements FollowerInfo {\r\n \r\n   FollowerInfoImpl(RaftGroupMemberId id, RaftPeer peer, Function<RaftPeerId, RaftPeer> getPeer,\r\n       Timestamp lastRpcTime, long nextIndex, boolean caughtUp) {\r\n-    this.name = id + \"->\" + peer.getId();\r\n-\r\n-    this.peer = new AtomicReference<>(peer);\r\n+    this.peerId = peer.getId();\r\n+    this.name = id + \"->\" + peerId;\r\n     this.getPeer = getPeer;\r\n     this.lastRpcResponseTime = new AtomicReference<>(lastRpcTime);\r\n     this.lastRpcSendTime = new AtomicReference<>(lastRpcTime);\r\n@@ -183,18 +182,12 @@ class FollowerInfoImpl implements FollowerInfo {\r\n \r\n   @Override\r\n   public RaftPeerId getId() {\r\n-    return peer.get().getId();\r\n+    return peerId;\r\n   }\r\n \r\n   @Override\r\n   public RaftPeer getPeer() {\r\n-    final RaftPeer newPeer = getPeer.apply(getId());\r\n-    if (newPeer != null) {\r\n-      peer.set(newPeer);\r\n-      return newPeer;\r\n-    } else {\r\n-      return peer.get();\r\n-    }\r\n+    return getPeer.apply(getId());\r\n   }\r\n \r\n   @Override\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1997986077/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1998704857","html_url":"https://github.com/apache/ratis/pull/1050#issuecomment-1998704857","issue_url":"https://api.github.com/repos/apache/ratis/issues/1050","id":1998704857,"node_id":"IC_kwDOBMxbGc53IdDZ","user":{"login":"symious","id":14933944,"node_id":"MDQ6VXNlcjE0OTMzOTQ0","avatar_url":"https://avatars.githubusercontent.com/u/14933944?v=4","gravatar_id":"","url":"https://api.github.com/users/symious","html_url":"https://github.com/symious","followers_url":"https://api.github.com/users/symious/followers","following_url":"https://api.github.com/users/symious/following{/other_user}","gists_url":"https://api.github.com/users/symious/gists{/gist_id}","starred_url":"https://api.github.com/users/symious/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/symious/subscriptions","organizations_url":"https://api.github.com/users/symious/orgs","repos_url":"https://api.github.com/users/symious/repos","events_url":"https://api.github.com/users/symious/events{/privacy}","received_events_url":"https://api.github.com/users/symious/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-15T00:46:08Z","updated_at":"2024-03-15T00:46:08Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks for the suggestion, updated the PR, PTAL.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1998704857/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1998729939","html_url":"https://github.com/apache/ratis/pull/1050#issuecomment-1998729939","issue_url":"https://api.github.com/repos/apache/ratis/issues/1050","id":1998729939,"node_id":"IC_kwDOBMxbGc53IjLT","user":{"login":"symious","id":14933944,"node_id":"MDQ6VXNlcjE0OTMzOTQ0","avatar_url":"https://avatars.githubusercontent.com/u/14933944?v=4","gravatar_id":"","url":"https://api.github.com/users/symious","html_url":"https://github.com/symious","followers_url":"https://api.github.com/users/symious/followers","following_url":"https://api.github.com/users/symious/following{/other_user}","gists_url":"https://api.github.com/users/symious/gists{/gist_id}","starred_url":"https://api.github.com/users/symious/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/symious/subscriptions","organizations_url":"https://api.github.com/users/symious/orgs","repos_url":"https://api.github.com/users/symious/repos","events_url":"https://api.github.com/users/symious/events{/privacy}","received_events_url":"https://api.github.com/users/symious/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-15T01:19:37Z","updated_at":"2024-03-15T01:19:37Z","author_association":"CONTRIBUTOR","body":"The failed test is related, I'll fix it first.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1998729939/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1998739708","html_url":"https://github.com/apache/ratis/pull/1050#issuecomment-1998739708","issue_url":"https://api.github.com/repos/apache/ratis/issues/1050","id":1998739708,"node_id":"IC_kwDOBMxbGc53Ilj8","user":{"login":"symious","id":14933944,"node_id":"MDQ6VXNlcjE0OTMzOTQ0","avatar_url":"https://avatars.githubusercontent.com/u/14933944?v=4","gravatar_id":"","url":"https://api.github.com/users/symious","html_url":"https://github.com/symious","followers_url":"https://api.github.com/users/symious/followers","following_url":"https://api.github.com/users/symious/following{/other_user}","gists_url":"https://api.github.com/users/symious/gists{/gist_id}","starred_url":"https://api.github.com/users/symious/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/symious/subscriptions","organizations_url":"https://api.github.com/users/symious/orgs","repos_url":"https://api.github.com/users/symious/repos","events_url":"https://api.github.com/users/symious/events{/privacy}","received_events_url":"https://api.github.com/users/symious/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-15T01:31:56Z","updated_at":"2024-03-15T01:31:56Z","author_association":"CONTRIBUTOR","body":"@szetszwo The test failed because it's using `server.getRaftConf()` to get RaftPeer, but for a new peer, the raftConf doesn't  have information of the new RaftPeer.\r\n\r\nSo `server.getRaftConf().getPeer(id, RaftPeerRole.FOLLOWER, RaftPeerRole.LISTENER);` is returnning null here. I think we still need to store RaftPeer instead of RaftPeerId in `FollowerInfoImpl`?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1998739708/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1998750590","html_url":"https://github.com/apache/ratis/pull/1050#issuecomment-1998750590","issue_url":"https://api.github.com/repos/apache/ratis/issues/1050","id":1998750590,"node_id":"IC_kwDOBMxbGc53IoN-","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-15T01:40:19Z","updated_at":"2024-03-15T01:40:19Z","author_association":"CONTRIBUTOR","body":"> ... for a new peer, the raftConf doesn't have information of the new RaftPeer. ...\r\n\r\nYou are right.  I recall now why we have `AtomicReference<RaftPeer>`.\r\n\r\nThen, let's don't change it since the `AtomicReference.set` method is more efficient than the `RaftPeer.isSame` method. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1998750590/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1998801864","html_url":"https://github.com/apache/ratis/pull/1050#issuecomment-1998801864","issue_url":"https://api.github.com/repos/apache/ratis/issues/1050","id":1998801864,"node_id":"IC_kwDOBMxbGc53I0vI","user":{"login":"symious","id":14933944,"node_id":"MDQ6VXNlcjE0OTMzOTQ0","avatar_url":"https://avatars.githubusercontent.com/u/14933944?v=4","gravatar_id":"","url":"https://api.github.com/users/symious","html_url":"https://github.com/symious","followers_url":"https://api.github.com/users/symious/followers","following_url":"https://api.github.com/users/symious/following{/other_user}","gists_url":"https://api.github.com/users/symious/gists{/gist_id}","starred_url":"https://api.github.com/users/symious/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/symious/subscriptions","organizations_url":"https://api.github.com/users/symious/orgs","repos_url":"https://api.github.com/users/symious/repos","events_url":"https://api.github.com/users/symious/events{/privacy}","received_events_url":"https://api.github.com/users/symious/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-15T02:00:04Z","updated_at":"2024-03-15T02:00:04Z","author_association":"CONTRIBUTOR","body":"Ok, I'll close the ticket then. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1998801864/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2002727204","html_url":"https://github.com/apache/ratis/pull/1052#issuecomment-2002727204","issue_url":"https://api.github.com/repos/apache/ratis/issues/1052","id":2002727204,"node_id":"IC_kwDOBMxbGc53XzEk","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-18T01:39:16Z","updated_at":"2024-03-18T01:39:16Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , Since the methods in `AppendEntriesListeners` are `synchronized`, let check it there?\r\n```java\r\ndiff --git a/ratis-server/src/main/java/org/apache/ratis/server/impl/ReadIndexHeartbeats.java b/ratis-server/src/main/java/org/apache/ratis/server/impl/ReadIndexHeartbeats.java\r\nindex d08a1ea406..4ff1460d7d 100644\r\n--- a/ratis-server/src/main/java/org/apache/ratis/server/impl/ReadIndexHeartbeats.java\r\n+++ b/ratis-server/src/main/java/org/apache/ratis/server/impl/ReadIndexHeartbeats.java\r\n@@ -23,6 +23,7 @@ import org.apache.ratis.server.leader.LogAppender;\r\n import org.apache.ratis.server.raftlog.RaftLog;\r\n import org.apache.ratis.server.raftlog.RaftLogIndex;\r\n import org.apache.ratis.util.JavaUtils;\r\n+import org.apache.ratis.util.Preconditions;\r\n import org.slf4j.Logger;\r\n import org.slf4j.LoggerFactory;\r\n \r\n@@ -123,8 +124,15 @@ class ReadIndexHeartbeats {\r\n \r\n   class AppendEntriesListeners {\r\n     private final NavigableMap<Long, AppendEntriesListener> sorted = new TreeMap<>();\r\n+    private Exception exception = null;\r\n \r\n     synchronized AppendEntriesListener add(long commitIndex, Function<Long, AppendEntriesListener> constructor) {\r\n+      if (exception != null) {\r\n+        Preconditions.assertTrue(sorted.isEmpty());\r\n+        final AppendEntriesListener listener = constructor.apply(commitIndex);\r\n+        listener.getFuture().completeExceptionally(exception);\r\n+        return listener;\r\n+      }\r\n       return sorted.computeIfAbsent(commitIndex, constructor);\r\n     }\r\n \r\n@@ -152,6 +160,10 @@ class ReadIndexHeartbeats {\r\n     }\r\n \r\n     synchronized void failAll(Exception e) {\r\n+      if (exception != null) {\r\n+        return;\r\n+      }\r\n+      exception = e;\r\n       sorted.forEach((index, listener) -> listener.getFuture().completeExceptionally(e));\r\n       sorted.clear();\r\n     }\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2002727204/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2004050347","html_url":"https://github.com/apache/ratis/pull/1052#issuecomment-2004050347","issue_url":"https://api.github.com/repos/apache/ratis/issues/1052","id":2004050347,"node_id":"IC_kwDOBMxbGc53c2Gr","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-18T14:20:41Z","updated_at":"2024-03-18T14:20:41Z","author_association":"MEMBER","body":"@szetszwo Thanks for your time! Your are right we should check it in `AppendEntriesListeners`. The original patch have memory leak problems. Let me apply the suggested changes.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2004050347/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2008303219","html_url":"https://github.com/apache/ratis/pull/1053#issuecomment-2008303219","issue_url":"https://api.github.com/repos/apache/ratis/issues/1053","id":2008303219,"node_id":"IC_kwDOBMxbGc53tEZz","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-19T22:58:18Z","updated_at":"2024-03-19T22:58:18Z","author_association":"CONTRIBUTOR","body":"@duongkame , there are some test failures related to `IllegalState allLeaks.size = 2`; see https://github.com/apache/ratis/actions/runs/8350541481/job/22857177939?pr=1053#step:6:1096","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2008303219/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2008472746","html_url":"https://github.com/apache/ratis/pull/1053#issuecomment-2008472746","issue_url":"https://api.github.com/repos/apache/ratis/issues/1053","id":2008472746,"node_id":"IC_kwDOBMxbGc53ttyq","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-20T00:53:45Z","updated_at":"2024-03-20T00:53:45Z","author_association":"CONTRIBUTOR","body":"> @duongkame , there are some test failures related to `IllegalState allLeaks.size = 2`; see https://github.com/apache/ratis/actions/runs/8350541481/job/22857177939?pr=1053#step:6:1096\r\n\r\nI created a custom build with advance detection here: https://github.com/duongkame/ratis/actions/runs/8351812136\r\n\r\nLooks like this is because the [retained log entries](https://github.com/apache/ratis/blob/master/ratis-server/src/test/java/org/apache/ratis/statemachine/impl/SimpleStateMachine4Testing.java#L203-L203) in SimpleStateMachine4Testing cache are not released. Probably because the state machine is not closed. Filed RATIS-2046.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2008472746/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2013372374","html_url":"https://github.com/apache/ratis/pull/1049#issuecomment-2013372374","issue_url":"https://api.github.com/repos/apache/ratis/issues/1049","id":2013372374,"node_id":"IC_kwDOBMxbGc54AZ_W","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-21T19:08:15Z","updated_at":"2024-03-21T19:08:15Z","author_association":"CONTRIBUTOR","body":"> Without updates, the existing client code won't call getEntryRef either, but getEntry which copies the returned LogEntryProto?\r\n\r\nClient code will call `RaftLog.getEntryWithData(..)`.  In the new code and the change below, it will retain but not release the ref.\r\n```java\r\n//SegmentedRaftLog\r\n  public EntryWithData getEntryWithData(long index) throws RaftLogIOException {\r\n    final ReferenceCountedObject<LogEntryProto> entryRef = retainLog(index);\r\n```\r\nthis change\r\n```java\r\n@@ -323,17 +323,9 @@ public final class SegmentedRaftLog extends RaftLogBase {\r\n     if (entryRef == null) {\r\n       throw new RaftLogIOException(\"Log entry not found: index = \" + index);\r\n     }\r\n-    try {\r\n-      // TODO. The reference counted object should be passed to LogAppender RATIS-2026.\r\n-      return getEntryWithData(entryRef.get());\r\n-    } finally {\r\n-      entryRef.release();\r\n-    }\r\n-  }\r\n-\r\n-  private EntryWithData getEntryWithData(LogEntryProto entry) throws RaftLogIOException {\r\n+    LogEntryProto entry = entryRef.get();\r\n     if (!LogProtoUtils.isStateMachineDataEmpty(entry)) {\r\n-      return newEntryWithData(entry, null);\r\n+      return newEntryWithData(entryRef, null);\r\n     }\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2013372374/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2015359644","html_url":"https://github.com/apache/ratis/pull/1056#issuecomment-2015359644","issue_url":"https://api.github.com/repos/apache/ratis/issues/1056","id":2015359644,"node_id":"IC_kwDOBMxbGc54H_Kc","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-22T15:36:28Z","updated_at":"2024-03-22T15:36:28Z","author_association":"CONTRIBUTOR","body":"@szetszwo PTAL","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2015359644/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2015359861","html_url":"https://github.com/apache/ratis/pull/1055#issuecomment-2015359861","issue_url":"https://api.github.com/repos/apache/ratis/issues/1055","id":2015359861,"node_id":"IC_kwDOBMxbGc54H_N1","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-22T15:36:36Z","updated_at":"2024-03-22T15:36:36Z","author_association":"CONTRIBUTOR","body":"@szetszwo PTAL","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2015359861/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2015360241","html_url":"https://github.com/apache/ratis/pull/1054#issuecomment-2015360241","issue_url":"https://api.github.com/repos/apache/ratis/issues/1054","id":2015360241,"node_id":"IC_kwDOBMxbGc54H_Tx","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-22T15:36:49Z","updated_at":"2024-03-22T15:36:49Z","author_association":"CONTRIBUTOR","body":"@szetszwo PTAL","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2015360241/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2015429777","html_url":"https://github.com/apache/ratis/pull/1057#issuecomment-2015429777","issue_url":"https://api.github.com/repos/apache/ratis/issues/1057","id":2015429777,"node_id":"IC_kwDOBMxbGc54IQSR","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-22T16:11:48Z","updated_at":"2024-03-22T16:11:48Z","author_association":"CONTRIBUTOR","body":"@szetszwo PTAL","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2015429777/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2017176771","html_url":"https://github.com/apache/ratis/pull/1058#issuecomment-2017176771","issue_url":"https://api.github.com/repos/apache/ratis/issues/1058","id":2017176771,"node_id":"IC_kwDOBMxbGc54O6zD","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-25T04:12:10Z","updated_at":"2024-03-25T04:12:10Z","author_association":"CONTRIBUTOR","body":"How about just using a force bool flag rather than a createGap parameter?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2017176771/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2017190277","html_url":"https://github.com/apache/ratis/pull/1058#issuecomment-2017190277","issue_url":"https://api.github.com/repos/apache/ratis/issues/1058","id":2017190277,"node_id":"IC_kwDOBMxbGc54O-GF","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-25T04:31:13Z","updated_at":"2024-03-25T04:31:13Z","author_association":"MEMBER","body":"> How about just using a force bool flag rather than a createGap parameter?\r\n\r\n@OneSizeFitsQuorum You are right, force bool flag is more user friendly. How about add a new interface `create(force, timeout)` in `SnapshotManagementApi`?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2017190277/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2019436773","html_url":"https://github.com/apache/ratis/pull/1058#issuecomment-2019436773","issue_url":"https://api.github.com/repos/apache/ratis/issues/1058","id":2019436773,"node_id":"IC_kwDOBMxbGc54Xijl","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-26T05:42:07Z","updated_at":"2024-03-26T05:42:07Z","author_association":"MEMBER","body":"@szetszwo Thanks a lot for the reviews! Made changes on javadoc and code, PTAL.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2019436773/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2021697412","html_url":"https://github.com/apache/ratis/pull/1049#issuecomment-2021697412","issue_url":"https://api.github.com/repos/apache/ratis/issues/1049","id":2021697412,"node_id":"IC_kwDOBMxbGc54gKeE","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-27T00:18:29Z","updated_at":"2024-03-27T00:18:29Z","author_association":"CONTRIBUTOR","body":"> https://issues.apache.org/jira/browse/RATIS-2026\r\n\r\nSure, I was just worried about how to proceed to the next step RATIS-1979 in which the data read from StateMachine (`StateMachine.read`) is reference counted too. Currently I'm making it happen inside the EntryWithDataImpl. https://github.com/duongkame/ratis/blob/RATIS-1979/ratis-server/src/main/java/org/apache/ratis/server/raftlog/RaftLogBase.java#L447-L487\r\n\r\nBut I believe we'll find the right implementation. Updated this PR as suggestion. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2021697412/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2021771837","html_url":"https://github.com/apache/ratis/pull/1058#issuecomment-2021771837","issue_url":"https://api.github.com/repos/apache/ratis/issues/1058","id":2021771837,"node_id":"IC_kwDOBMxbGc54gco9","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-27T01:45:56Z","updated_at":"2024-03-27T01:45:56Z","author_association":"MEMBER","body":"@szetszwo Thanks for reviewing and merging this patch!\r\n@OneSizeFitsQuorum Thanks for the reviews!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2021771837/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2022141860","html_url":"https://github.com/apache/ratis/pull/1059#issuecomment-2022141860","issue_url":"https://api.github.com/repos/apache/ratis/issues/1059","id":2022141860,"node_id":"IC_kwDOBMxbGc54h2-k","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-27T07:47:46Z","updated_at":"2024-03-27T07:47:46Z","author_association":"CONTRIBUTOR","body":"@szetszwo PTAL","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2022141860/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2024114889","html_url":"https://github.com/apache/ratis/pull/1060#issuecomment-2024114889","issue_url":"https://api.github.com/repos/apache/ratis/issues/1060","id":2024114889,"node_id":"IC_kwDOBMxbGc54pYrJ","user":{"login":"DaveTeng0","id":109315747,"node_id":"U_kgDOBoQGow","avatar_url":"https://avatars.githubusercontent.com/u/109315747?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveTeng0","html_url":"https://github.com/DaveTeng0","followers_url":"https://api.github.com/users/DaveTeng0/followers","following_url":"https://api.github.com/users/DaveTeng0/following{/other_user}","gists_url":"https://api.github.com/users/DaveTeng0/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveTeng0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveTeng0/subscriptions","organizations_url":"https://api.github.com/users/DaveTeng0/orgs","repos_url":"https://api.github.com/users/DaveTeng0/repos","events_url":"https://api.github.com/users/DaveTeng0/events{/privacy}","received_events_url":"https://api.github.com/users/DaveTeng0/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-27T22:51:08Z","updated_at":"2024-03-27T22:51:08Z","author_association":"CONTRIBUTOR","body":"hey @szetszwo please feel free to take a look, thanks!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2024114889/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2024546400","html_url":"https://github.com/apache/ratis/pull/1061#issuecomment-2024546400","issue_url":"https://api.github.com/repos/apache/ratis/issues/1061","id":2024546400,"node_id":"IC_kwDOBMxbGc54rCBg","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-28T07:08:44Z","updated_at":"2024-03-28T07:08:44Z","author_association":"CONTRIBUTOR","body":"@szetszwo PTAL","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2024546400/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2026254926","html_url":"https://github.com/apache/ratis/pull/1062#issuecomment-2026254926","issue_url":"https://api.github.com/repos/apache/ratis/issues/1062","id":2026254926,"node_id":"IC_kwDOBMxbGc54xjJO","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-28T22:40:18Z","updated_at":"2024-03-28T22:40:18Z","author_association":"CONTRIBUTOR","body":"@szetszwo can you please have a look?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2026254926/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2026450400","html_url":"https://github.com/apache/ratis/pull/1061#issuecomment-2026450400","issue_url":"https://api.github.com/repos/apache/ratis/issues/1061","id":2026450400,"node_id":"IC_kwDOBMxbGc54yS3g","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-29T01:39:31Z","updated_at":"2024-03-29T01:39:38Z","author_association":"CONTRIBUTOR","body":"> @OneSizeFitsQuorum , could you file a new JIRA? Let's have a JIRA per commit. It is easier to track.\r\n\r\nThanks for reminding! Done!\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2026450400/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2027895276","html_url":"https://github.com/apache/ratis/pull/1061#issuecomment-2027895276","issue_url":"https://api.github.com/repos/apache/ratis/issues/1061","id":2027895276,"node_id":"IC_kwDOBMxbGc543zns","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-03-30T03:24:16Z","updated_at":"2024-03-30T03:24:16Z","author_association":"CONTRIBUTOR","body":"> +1\r\n> \r\n> @OneSizeFitsQuorum , thanks for filing the JIRA. BTW, you may simply use [RATIS-2052](https://issues.apache.org/jira/browse/RATIS-2052), instead of [JIRA](https://issues.apache.org/jira/browse/RATIS-2052). We have setup that [RATIS-XXXX](https://issues.apache.org/jira/browse/RATIS-XXXX) will be automatically converted to a link.\r\n\r\nSorry I made a mistake, I will pay attention to it later ~","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2027895276/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2043385126","html_url":"https://github.com/apache/ratis/pull/596#issuecomment-2043385126","issue_url":"https://api.github.com/repos/apache/ratis/issues/596","id":2043385126,"node_id":"IC_kwDOBMxbGc55y5Um","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-08T18:11:53Z","updated_at":"2024-04-08T18:11:53Z","author_association":"CONTRIBUTOR","body":"@guohao-rosicky , thanks for working not this!  On top of the bug fix, the change from `RaftServer` to `Division` is great!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2043385126/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2048441945","html_url":"https://github.com/apache/ratis/pull/621#issuecomment-2048441945","issue_url":"https://api.github.com/repos/apache/ratis/issues/621","id":2048441945,"node_id":"IC_kwDOBMxbGc56GL5Z","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-10T21:10:46Z","updated_at":"2024-04-10T21:10:46Z","author_association":"CONTRIBUTOR","body":"After RATIS-1550, this is no longer a problem.  Closing this.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2048441945/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2048743682","html_url":"https://github.com/apache/ratis/pull/1063#issuecomment-2048743682","issue_url":"https://api.github.com/repos/apache/ratis/issues/1063","id":2048743682,"node_id":"IC_kwDOBMxbGc56HVkC","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-11T01:18:33Z","updated_at":"2024-04-11T01:18:33Z","author_association":"MEMBER","body":"@szetszwo Thanks for reviewing this! I found that RaftServer would update TermIndex when applying non-statemachine logs here https://github.com/apache/ratis/blob/8638a2ffa802de576aae546c22160da3d9339a8f/ratis-server/src/main/java/org/apache/ratis/server/impl/RaftServerImpl.java#L1809. \r\nSo this patch is duplicate. Let me close this PR.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2048743682/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2050208782","html_url":"https://github.com/apache/ratis/pull/1060#issuecomment-2050208782","issue_url":"https://api.github.com/repos/apache/ratis/issues/1060","id":2050208782,"node_id":"IC_kwDOBMxbGc56M7QO","user":{"login":"DaveTeng0","id":109315747,"node_id":"U_kgDOBoQGow","avatar_url":"https://avatars.githubusercontent.com/u/109315747?v=4","gravatar_id":"","url":"https://api.github.com/users/DaveTeng0","html_url":"https://github.com/DaveTeng0","followers_url":"https://api.github.com/users/DaveTeng0/followers","following_url":"https://api.github.com/users/DaveTeng0/following{/other_user}","gists_url":"https://api.github.com/users/DaveTeng0/gists{/gist_id}","starred_url":"https://api.github.com/users/DaveTeng0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DaveTeng0/subscriptions","organizations_url":"https://api.github.com/users/DaveTeng0/orgs","repos_url":"https://api.github.com/users/DaveTeng0/repos","events_url":"https://api.github.com/users/DaveTeng0/events{/privacy}","received_events_url":"https://api.github.com/users/DaveTeng0/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-11T17:53:08Z","updated_at":"2024-04-11T17:53:08Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo !","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2050208782/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2051221344","html_url":"https://github.com/apache/ratis/pull/1064#issuecomment-2051221344","issue_url":"https://api.github.com/repos/apache/ratis/issues/1064","id":2051221344,"node_id":"IC_kwDOBMxbGc56Qydg","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-12T07:57:49Z","updated_at":"2024-04-12T07:57:49Z","author_association":"CONTRIBUTOR","body":"+1 LGTM.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2051221344/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2051978116","html_url":"https://github.com/apache/ratis/pull/1064#issuecomment-2051978116","issue_url":"https://api.github.com/repos/apache/ratis/issues/1064","id":2051978116,"node_id":"IC_kwDOBMxbGc56TrOE","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-12T15:26:17Z","updated_at":"2024-04-12T15:26:17Z","author_association":"CONTRIBUTOR","body":"@guohao-rosicky , thanks a lot for reviewing and merging this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2051978116/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2054025131","html_url":"https://github.com/apache/ratis/pull/1065#issuecomment-2054025131","issue_url":"https://api.github.com/repos/apache/ratis/issues/1065","id":2054025131,"node_id":"IC_kwDOBMxbGc56be-r","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-14T12:00:14Z","updated_at":"2024-04-14T12:00:14Z","author_association":"MEMBER","body":"@szetszwo Thanks for reviewing and merging this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2054025131/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2058072943","html_url":"https://github.com/apache/ratis/pull/1066#issuecomment-2058072943","issue_url":"https://api.github.com/repos/apache/ratis/issues/1066","id":2058072943,"node_id":"IC_kwDOBMxbGc56q7Nv","user":{"login":"symious","id":14933944,"node_id":"MDQ6VXNlcjE0OTMzOTQ0","avatar_url":"https://avatars.githubusercontent.com/u/14933944?v=4","gravatar_id":"","url":"https://api.github.com/users/symious","html_url":"https://github.com/symious","followers_url":"https://api.github.com/users/symious/followers","following_url":"https://api.github.com/users/symious/following{/other_user}","gists_url":"https://api.github.com/users/symious/gists{/gist_id}","starred_url":"https://api.github.com/users/symious/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/symious/subscriptions","organizations_url":"https://api.github.com/users/symious/orgs","repos_url":"https://api.github.com/users/symious/repos","events_url":"https://api.github.com/users/symious/events{/privacy}","received_events_url":"https://api.github.com/users/symious/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-16T01:27:05Z","updated_at":"2024-04-16T01:27:05Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thank you for the update.\r\n\r\nI saw the comments in \"https://issues.apache.org/jira/browse/RATIS-2058\" that says \"Other classes (e.g. JavaUtils, JvmPauseMonitor, DataQueue) may not necessarily be.\", does that mean applications should not use \"JavaUtils\" in the future since it's not in \"ratis-common-api\"?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2058072943/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2058324921","html_url":"https://github.com/apache/ratis/pull/1066#issuecomment-2058324921","issue_url":"https://api.github.com/repos/apache/ratis/issues/1066","id":2058324921,"node_id":"IC_kwDOBMxbGc56r4u5","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-16T06:28:22Z","updated_at":"2024-04-16T06:28:22Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for the patch.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2058324921/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2059628550","html_url":"https://github.com/apache/ratis/pull/1066#issuecomment-2059628550","issue_url":"https://api.github.com/repos/apache/ratis/issues/1066","id":2059628550,"node_id":"IC_kwDOBMxbGc56w3AG","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-16T17:42:57Z","updated_at":"2024-04-16T17:42:57Z","author_association":"CONTRIBUTOR","body":"> ... does that mean applications should not use \"JavaUtils\" in the future  ... ?\r\n\r\nThat's is a good question!  For now, we may consider the APIs in classes like `JavaUtils` are `experimental` (similar to [Java 9 jfr](https://docs.oracle.com/javase%2F9%2Fdocs%2Fapi%2F%2F/jdk/jfr/Experimental.html) or [grpc](https://grpc.github.io/grpc-java/javadoc/io/grpc/ExperimentalApi.html)).   We will make the APIs more stable when we establish the public ratis -common-api.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2059628550/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2059631717","html_url":"https://github.com/apache/ratis/pull/1066#issuecomment-2059631717","issue_url":"https://api.github.com/repos/apache/ratis/issues/1066","id":2059631717,"node_id":"IC_kwDOBMxbGc56w3xl","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-16T17:44:47Z","updated_at":"2024-04-16T17:44:47Z","author_association":"CONTRIBUTOR","body":"@adoroszlai , thanks a lot for reviewing and merging this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2059631717/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2060169137","html_url":"https://github.com/apache/ratis/pull/1066#issuecomment-2060169137","issue_url":"https://api.github.com/repos/apache/ratis/issues/1066","id":2060169137,"node_id":"IC_kwDOBMxbGc56y6-x","user":{"login":"symious","id":14933944,"node_id":"MDQ6VXNlcjE0OTMzOTQ0","avatar_url":"https://avatars.githubusercontent.com/u/14933944?v=4","gravatar_id":"","url":"https://api.github.com/users/symious","html_url":"https://github.com/symious","followers_url":"https://api.github.com/users/symious/followers","following_url":"https://api.github.com/users/symious/following{/other_user}","gists_url":"https://api.github.com/users/symious/gists{/gist_id}","starred_url":"https://api.github.com/users/symious/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/symious/subscriptions","organizations_url":"https://api.github.com/users/symious/orgs","repos_url":"https://api.github.com/users/symious/repos","events_url":"https://api.github.com/users/symious/events{/privacy}","received_events_url":"https://api.github.com/users/symious/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-17T01:21:35Z","updated_at":"2024-04-17T01:21:35Z","author_association":"CONTRIBUTOR","body":"> For now, we may consider the APIs in classes like JavaUtils are experimental (similar to [Java 9 jfr](https://docs.oracle.com/javase%2F9%2Fdocs%2Fapi%2F%2F/jdk/jfr/Experimental.html) or [grpc](https://grpc.github.io/grpc-java/javadoc/io/grpc/ExperimentalApi.html)). We will make the APIs more stable when we establish the public ratis -common-api.\r\n\r\n@szetszwo Thank you for the explaination. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2060169137/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2061740059","html_url":"https://github.com/apache/ratis/pull/1067#issuecomment-2061740059","issue_url":"https://api.github.com/repos/apache/ratis/issues/1067","id":2061740059,"node_id":"IC_kwDOBMxbGc5646gb","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-17T16:43:58Z","updated_at":"2024-04-17T16:43:58Z","author_association":"CONTRIBUTOR","body":"cc. @szetszwo can you look at this?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2061740059/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2062889186","html_url":"https://github.com/apache/ratis/pull/1068#issuecomment-2062889186","issue_url":"https://api.github.com/repos/apache/ratis/issues/1068","id":2062889186,"node_id":"IC_kwDOBMxbGc569TDi","user":{"login":"symious","id":14933944,"node_id":"MDQ6VXNlcjE0OTMzOTQ0","avatar_url":"https://avatars.githubusercontent.com/u/14933944?v=4","gravatar_id":"","url":"https://api.github.com/users/symious","html_url":"https://github.com/symious","followers_url":"https://api.github.com/users/symious/followers","following_url":"https://api.github.com/users/symious/following{/other_user}","gists_url":"https://api.github.com/users/symious/gists{/gist_id}","starred_url":"https://api.github.com/users/symious/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/symious/subscriptions","organizations_url":"https://api.github.com/users/symious/orgs","repos_url":"https://api.github.com/users/symious/repos","events_url":"https://api.github.com/users/symious/events{/privacy}","received_events_url":"https://api.github.com/users/symious/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-18T02:38:06Z","updated_at":"2024-04-18T02:38:06Z","author_association":"CONTRIBUTOR","body":"@szetszwo @duongkame Raised the PR based on the PR in ticket. \r\n\r\nPTAL.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2062889186/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2063668492","html_url":"https://github.com/apache/ratis/pull/956#issuecomment-2063668492","issue_url":"https://api.github.com/repos/apache/ratis/issues/956","id":2063668492,"node_id":"IC_kwDOBMxbGc57ARUM","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-18T11:43:36Z","updated_at":"2024-04-18T11:58:44Z","author_association":"CONTRIBUTOR","body":"Hi @szetszwo .\r\n\r\nI used this patch on my Ozone production environment.\r\nObserved that s3 gateway and datanode would have an excessive number of open files.\r\nIt's caused by too many connections on port 9855, and I suspect that this patch causes the inability to close handles.\r\n\r\n```\r\n# lsof -p 407922 (datanode)\r\n[root@ozone01 tmp]# grep 9855 407922-datanode.lsof | wc -l\r\n152375\r\n[root@ozone01 tmp]# wc -l 407922-datanode.lsof \r\n156215 407922-datanode.lsof\r\n\r\n# lsof -p 265960 (s3 gateway)\r\n[root@ozone01 tmp]# grep 9855 265960-s3gateway.lsof | wc -l\r\n159474\r\n[root@ozone01 tmp]# wc -l 265960-s3gateway.lsof\r\n164088 265960-s3gateway.lsof\r\n```\r\n\r\nThe number of files opened without this patch is in the normal range.\r\n\r\n![image](https://github.com/apache/ratis/assets/5122636/3f85b201-223a-4777-8760-b5feef0575d8)\r\n\r\n\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2063668492/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2064302013","html_url":"https://github.com/apache/ratis/pull/956#issuecomment-2064302013","issue_url":"https://api.github.com/repos/apache/ratis/issues/956","id":2064302013,"node_id":"IC_kwDOBMxbGc57Cr-9","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-18T15:44:52Z","updated_at":"2024-04-18T15:44:52Z","author_association":"CONTRIBUTOR","body":"@guohao-rosicky , thanks for testing this!  Do you have RATIS-1948?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2064302013/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2071809515","html_url":"https://github.com/apache/ratis/pull/956#issuecomment-2071809515","issue_url":"https://api.github.com/repos/apache/ratis/issues/956","id":2071809515,"node_id":"IC_kwDOBMxbGc57fU3r","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-23T09:13:08Z","updated_at":"2024-04-23T09:13:08Z","author_association":"CONTRIBUTOR","body":"Didn't include [RATIS-1948](https://issues.apache.org/jira/browse/RATIS-1948), I'll add it and try it, thanks @szetszwo  for the help.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2071809515/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2073941018","html_url":"https://github.com/apache/ratis/pull/1069#issuecomment-2073941018","issue_url":"https://api.github.com/repos/apache/ratis/issues/1069","id":2073941018,"node_id":"IC_kwDOBMxbGc57ndQa","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-24T03:23:44Z","updated_at":"2024-04-24T03:23:44Z","author_association":"CONTRIBUTOR","body":"@szetszwo PTAL","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2073941018/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2078582219","html_url":"https://github.com/apache/ratis/pull/1070#issuecomment-2078582219","issue_url":"https://api.github.com/repos/apache/ratis/issues/1070","id":2078582219,"node_id":"IC_kwDOBMxbGc575KXL","user":{"login":"whbing","id":18388154,"node_id":"MDQ6VXNlcjE4Mzg4MTU0","avatar_url":"https://avatars.githubusercontent.com/u/18388154?v=4","gravatar_id":"","url":"https://api.github.com/users/whbing","html_url":"https://github.com/whbing","followers_url":"https://api.github.com/users/whbing/followers","following_url":"https://api.github.com/users/whbing/following{/other_user}","gists_url":"https://api.github.com/users/whbing/gists{/gist_id}","starred_url":"https://api.github.com/users/whbing/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/whbing/subscriptions","organizations_url":"https://api.github.com/users/whbing/orgs","repos_url":"https://api.github.com/users/whbing/repos","events_url":"https://api.github.com/users/whbing/events{/privacy}","received_events_url":"https://api.github.com/users/whbing/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-26T03:50:17Z","updated_at":"2024-04-26T03:50:17Z","author_association":"CONTRIBUTOR","body":"Updated. @szetszwo Thanks for review !","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2078582219/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2082374138","html_url":"https://github.com/apache/ratis/pull/1071#issuecomment-2082374138","issue_url":"https://api.github.com/repos/apache/ratis/issues/1071","id":2082374138,"node_id":"IC_kwDOBMxbGc58HoH6","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-29T10:27:35Z","updated_at":"2024-04-29T10:27:35Z","author_association":"CONTRIBUTOR","body":"@szetszwo PTAL!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2082374138/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2083232590","html_url":"https://github.com/apache/ratis/pull/1071#issuecomment-2083232590","issue_url":"https://api.github.com/repos/apache/ratis/issues/1071","id":2083232590,"node_id":"IC_kwDOBMxbGc58K5tO","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-29T17:04:28Z","updated_at":"2024-04-29T17:04:28Z","author_association":"CONTRIBUTOR","body":"@duongkame , This looks like the same as RATIS-2063.  Could you test it?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2083232590/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2084672771","html_url":"https://github.com/apache/ratis/pull/1073#issuecomment-2084672771","issue_url":"https://api.github.com/repos/apache/ratis/issues/1073","id":2084672771,"node_id":"IC_kwDOBMxbGc58QZUD","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-30T08:14:03Z","updated_at":"2024-04-30T08:14:03Z","author_association":"CONTRIBUTOR","body":"@szetszwo PTAL","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2084672771/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2085840525","html_url":"https://github.com/apache/ratis/pull/1072#issuecomment-2085840525","issue_url":"https://api.github.com/repos/apache/ratis/issues/1072","id":2085840525,"node_id":"IC_kwDOBMxbGc58U2aN","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-30T16:17:33Z","updated_at":"2024-04-30T16:17:33Z","author_association":"CONTRIBUTOR","body":"@ChenSammi  , thanks for working on this!  \r\n\r\nWe already have a `notifyServerShutdown`.  It will notify the `StateMachine` when its division (i.e. `RaftServerImpl`, not `RaftServerProxy`) is closed.  Is it good enough?\r\nhttps://github.com/apache/ratis/blob/1fe59e07dff9b02e46d150de8b46ed2d4fc3abce/ratis-server-api/src/main/java/org/apache/ratis/statemachine/StateMachine.java#L268\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2085840525/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2093098293","html_url":"https://github.com/apache/ratis/pull/1072#issuecomment-2093098293","issue_url":"https://api.github.com/repos/apache/ratis/issues/1072","id":2093098293,"node_id":"IC_kwDOBMxbGc58wiU1","user":{"login":"ChenSammi","id":19790142,"node_id":"MDQ6VXNlcjE5NzkwMTQy","avatar_url":"https://avatars.githubusercontent.com/u/19790142?v=4","gravatar_id":"","url":"https://api.github.com/users/ChenSammi","html_url":"https://github.com/ChenSammi","followers_url":"https://api.github.com/users/ChenSammi/followers","following_url":"https://api.github.com/users/ChenSammi/following{/other_user}","gists_url":"https://api.github.com/users/ChenSammi/gists{/gist_id}","starred_url":"https://api.github.com/users/ChenSammi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ChenSammi/subscriptions","organizations_url":"https://api.github.com/users/ChenSammi/orgs","repos_url":"https://api.github.com/users/ChenSammi/repos","events_url":"https://api.github.com/users/ChenSammi/events{/privacy}","received_events_url":"https://api.github.com/users/ChenSammi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-03T14:08:22Z","updated_at":"2024-05-03T14:08:22Z","author_association":"CONTRIBUTOR","body":"@szetszwo , notifyServerShutdown is not enough for this DN case. For DN, there is always new pipeline created and old pipeline destroyed.  I guess this notifyServerShutdown will be called when an old pipeline is closed.  This specific DN case, is when there is long GC, longer than configured threshold, RaftServerProxy will close itself. When this happens, we need to close DN as well. To achieve this, one solution is provide an close callback as this JIRA do, another solution is we start a new thread in DN to closely monitor the RaftServerProxy state, whether it's running or closed.  After some thoughts, I prefer the first solution since it will save a thread resource. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2093098293/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2093308221","html_url":"https://github.com/apache/ratis/pull/1072#issuecomment-2093308221","issue_url":"https://api.github.com/repos/apache/ratis/issues/1072","id":2093308221,"node_id":"IC_kwDOBMxbGc58xVk9","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-03T16:06:23Z","updated_at":"2024-05-03T16:06:23Z","author_association":"CONTRIBUTOR","body":"@ChenSammi , we may add a boolean parameter as below.  Anyway, we should use the same mechanism to notify the `StateMachine`.\r\n```java\r\n    /**\r\n     * Notify the {@link StateMachine} that a raft server has step down.\r\n     */\r\n    default void notifyServerShutdown(RoleInfoProto roleInfo) {\r\n      notifyServerShutdown(roleInfo, false);\r\n    }\r\n\r\n    default void notifyServerShutdown(RoleInfoProto roleInfo, boolean allServers) {}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2093308221/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2093369071","html_url":"https://github.com/apache/ratis/pull/1074#issuecomment-2093369071","issue_url":"https://api.github.com/repos/apache/ratis/issues/1074","id":2093369071,"node_id":"IC_kwDOBMxbGc58xkbv","user":{"login":"duongkame","id":17348547,"node_id":"MDQ6VXNlcjE3MzQ4NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/17348547?v=4","gravatar_id":"","url":"https://api.github.com/users/duongkame","html_url":"https://github.com/duongkame","followers_url":"https://api.github.com/users/duongkame/followers","following_url":"https://api.github.com/users/duongkame/following{/other_user}","gists_url":"https://api.github.com/users/duongkame/gists{/gist_id}","starred_url":"https://api.github.com/users/duongkame/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duongkame/subscriptions","organizations_url":"https://api.github.com/users/duongkame/orgs","repos_url":"https://api.github.com/users/duongkame/repos","events_url":"https://api.github.com/users/duongkame/events{/privacy}","received_events_url":"https://api.github.com/users/duongkame/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-03T16:36:39Z","updated_at":"2024-05-03T16:36:39Z","author_association":"CONTRIBUTOR","body":"> @duongkame , thanks a lot for fixing this! Please see the comments inlined and also https://issues.apache.org/jira/secure/attachment/13068605/1074_review.patch\r\n\r\nThanks for the quick review @szetszwo . Updated the PR.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2093369071/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2094645708","html_url":"https://github.com/apache/ratis/pull/1077#issuecomment-2094645708","issue_url":"https://api.github.com/repos/apache/ratis/issues/1077","id":2094645708,"node_id":"IC_kwDOBMxbGc582cHM","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-05T06:04:20Z","updated_at":"2024-05-05T06:04:20Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for the review.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2094645708/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2095142790","html_url":"https://github.com/apache/ratis/pull/1072#issuecomment-2095142790","issue_url":"https://api.github.com/repos/apache/ratis/issues/1072","id":2095142790,"node_id":"IC_kwDOBMxbGc584VeG","user":{"login":"ChenSammi","id":19790142,"node_id":"MDQ6VXNlcjE5NzkwMTQy","avatar_url":"https://avatars.githubusercontent.com/u/19790142?v=4","gravatar_id":"","url":"https://api.github.com/users/ChenSammi","html_url":"https://github.com/ChenSammi","followers_url":"https://api.github.com/users/ChenSammi/followers","following_url":"https://api.github.com/users/ChenSammi/following{/other_user}","gists_url":"https://api.github.com/users/ChenSammi/gists{/gist_id}","starred_url":"https://api.github.com/users/ChenSammi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ChenSammi/subscriptions","organizations_url":"https://api.github.com/users/ChenSammi/orgs","repos_url":"https://api.github.com/users/ChenSammi/repos","events_url":"https://api.github.com/users/ChenSammi/events{/privacy}","received_events_url":"https://api.github.com/users/ChenSammi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-06T03:42:40Z","updated_at":"2024-05-06T04:08:42Z","author_association":"CONTRIBUTOR","body":"@szetszwo , notifyServerShutdown is called currently when a peer's in vote phase, and is found not in the raft group by leader, so it turns down itself.  \r\n\r\nThe case we met in Ozone datanode,  the call trace is,\r\n  RaftServerProxy#pauseMonitor#handleJvmPause -> RaftServerProxy#close -> ImplMap for each Impl, RaftServerImpl#close\r\nNone of StateMachine#EventApi is called along this trace.\r\n  \r\nWe have seem same long GC in OM and SCM.  The trace is the same. But OM and SCM is single raft, we implemented the JVM termination of OM and SCM in its state machine close call.\r\n \r\nBut for Datanode, it's multi raft. First, we cannot terminate DN in container state machine close call, since it could be a normal pipeline close action, currently we don't have a way to tell the exact close reason.  Even we know the reason, terminating the DN in one statemachine close call, or any other call, is not appropriate, for there are multiple rafts there, it's better to let all multi rafts close its state machine, persist any state to disk, release any resources before JVM is terminated. That's why this solution is proposed. \r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2095142790/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2096290715","html_url":"https://github.com/apache/ratis/pull/1072#issuecomment-2096290715","issue_url":"https://api.github.com/repos/apache/ratis/issues/1072","id":2096290715,"node_id":"IC_kwDOBMxbGc588tub","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-06T15:22:16Z","updated_at":"2024-05-06T15:22:16Z","author_association":"CONTRIBUTOR","body":"@ChenSammi , this JIRA is suggesting to add a callback.   Instead of adding a new callback, why not changing the `notifyServerShutdown` API and then call it in `ImplMap.close(groupId, future)` as below?\r\n```java\r\n+++ b/ratis-server/src/main/java/org/apache/ratis/server/impl/RaftServerProxy.java\r\n@@ -138,6 +138,8 @@ class RaftServerProxy implements RaftServer {\r\n       } catch (Throwable t) {\r\n         LOG.warn(\"{}: Failed to close the division for {}\", getId(), groupId, t);\r\n       }\r\n+\r\n+      impl.getStateMachine().event().notifyServerShutdown(impl.getRoleInfoProto(), true);\r\n     }\r\n \r\n     synchronized List<RaftGroupId> getGroupIds() {\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2096290715/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2096346148","html_url":"https://github.com/apache/ratis/pull/1078#issuecomment-2096346148","issue_url":"https://api.github.com/repos/apache/ratis/issues/1078","id":2096346148,"node_id":"IC_kwDOBMxbGc5887Qk","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-06T15:44:39Z","updated_at":"2024-05-06T15:44:39Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for the review.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/2096346148/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]