[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472107280","html_url":"https://github.com/apache/couchdb/issues/1923#issuecomment-472107280","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1923","id":472107280,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjEwNzI4MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-12T17:42:33Z","updated_at":"2019-03-12T17:42:33Z","author_association":"MEMBER","body":"Are you trying to use client certificates? If so, you need to include the signing CA public certificate in the file you're using. CouchDB (and Erlang) requires this \"chained CA cert\" file format.\r\n\r\nTry this: https://cwiki.apache.org/confluence/pages/viewpage.action?pageId=48203146","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472107280/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472107895","html_url":"https://github.com/apache/couchdb/issues/1876#issuecomment-472107895","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1876","id":472107895,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjEwNzg5NQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-12T17:44:03Z","updated_at":"2019-03-12T17:44:03Z","author_association":"MEMBER","body":"No, the _bulk_docs endpoint is the only bulk endpoint useful for this in CouchDB of which I know.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472107895/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472108146","html_url":"https://github.com/apache/couchdb/issues/1876#issuecomment-472108146","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1876","id":472108146,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjEwODE0Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-12T17:44:42Z","updated_at":"2019-03-12T17:44:42Z","author_association":"MEMBER","body":"See  https://github.com/apache/couchdb-documentation/issues/390 .","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472108146/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472111408","html_url":"https://github.com/apache/couchdb/issues/1943#issuecomment-472111408","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1943","id":472111408,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjExMTQwOA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-12T17:52:31Z","updated_at":"2019-03-12T17:52:31Z","author_association":"MEMBER","body":"Confirmed on `master` (post 2.3.1) with the same command using `dev/run -n 1`. logfile shows:\r\n\r\n```\r\n[notice] 2019-03-12T17:51:03.030365Z node1@127.0.0.1 <0.909.0> 05a227bfb0 localhost:15984\r\n127.0.0.1 undefined PUT /foo 202 ok 287\r\n[error] 2019-03-12T17:51:37.839482Z node1@127.0.0.1 <0.1405.0> 16aaab9392 req_err(86628135\r\n3) badmatch : ok\r\n    [<<\"chttpd_db:db_doc_req/3 L1029\">>,<<\"chttpd:handle_req_after_auth/2 L322\">>,<<\"chttp\r\nd:process_request/1 L305\">>,<<\"chttpd:handle_request_int/1 L243\">>,<<\"mochiweb_http:header\r\ns/6 L128\">>,<<\"proc_lib:init_p_do_apply/3 L247\">>]\r\n[notice] 2019-03-12T17:51:37.840019Z node1@127.0.0.1 <0.1405.0> 16aaab9392 localhost:15984\r\n 127.0.0.1 undefined PUT /foo/oink 500 ok 13094\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472111408/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472112523","html_url":"https://github.com/apache/couchdb/issues/1943#issuecomment-472112523","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1943","id":472112523,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjExMjUyMw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-12T17:55:01Z","updated_at":"2019-03-12T17:55:31Z","author_association":"MEMBER","body":"@flimzy actually I'm not sure this is a valid test case. See:\r\n\r\nhttps://curl.haxx.se/mail/archive-2004-12/0104.html\r\n\r\nIf you let curl do the chunking for you, does it do the right thing?\r\n\r\nYour chunking process isn't including the length of the chunks which I think is invalid HTTP 1.1. See https://en.wikipedia.org/wiki/Chunked_transfer_encoding","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472112523/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472129785","html_url":"https://github.com/apache/couchdb/issues/1943#issuecomment-472129785","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1943","id":472129785,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjEyOTc4NQ==","user":{"login":"flimzy","id":8555063,"node_id":"MDQ6VXNlcjg1NTUwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8555063?v=4","gravatar_id":"","url":"https://api.github.com/users/flimzy","html_url":"https://github.com/flimzy","followers_url":"https://api.github.com/users/flimzy/followers","following_url":"https://api.github.com/users/flimzy/following{/other_user}","gists_url":"https://api.github.com/users/flimzy/gists{/gist_id}","starred_url":"https://api.github.com/users/flimzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flimzy/subscriptions","organizations_url":"https://api.github.com/users/flimzy/orgs","repos_url":"https://api.github.com/users/flimzy/repos","events_url":"https://api.github.com/users/flimzy/events{/privacy}","received_events_url":"https://api.github.com/users/flimzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-12T18:37:40Z","updated_at":"2019-03-12T18:37:40Z","author_association":"MEMBER","body":"I think I am letting curl do the chunking for me. Or am I misunderstanding your question?  If I omit the `Transfer-Encoding: chunked` header from the curl command, curl calculates the size of the upload, and includes the appropriate `Content-Length` header, which Couch accepts with no problem.\r\n\r\nThe curl commands are just to demonstrate a problem I discovered when working on my Go client, where wireshark confirmed that the length of chunks were most definitely being included.  I can re-produce that, and attach a packet capture if that's useful","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472129785/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472246617","html_url":"https://github.com/apache/couchdb/issues/1923#issuecomment-472246617","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1923","id":472246617,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjI0NjYxNw==","user":{"login":"greg2git","id":24355032,"node_id":"MDQ6VXNlcjI0MzU1MDMy","avatar_url":"https://avatars.githubusercontent.com/u/24355032?v=4","gravatar_id":"","url":"https://api.github.com/users/greg2git","html_url":"https://github.com/greg2git","followers_url":"https://api.github.com/users/greg2git/followers","following_url":"https://api.github.com/users/greg2git/following{/other_user}","gists_url":"https://api.github.com/users/greg2git/gists{/gist_id}","starred_url":"https://api.github.com/users/greg2git/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/greg2git/subscriptions","organizations_url":"https://api.github.com/users/greg2git/orgs","repos_url":"https://api.github.com/users/greg2git/repos","events_url":"https://api.github.com/users/greg2git/events{/privacy}","received_events_url":"https://api.github.com/users/greg2git/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-13T01:43:31Z","updated_at":"2019-03-13T01:43:31Z","author_association":"NONE","body":"k, let me try to play with the cert chains a little bit more. i don't see certbot in the page you have provided. is CouchDB compatible with ACME CA as explained in https://certbot.eff.org/lets-encrypt/ubuntubionic-apache?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472246617/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472258139","html_url":"https://github.com/apache/couchdb/issues/1923#issuecomment-472258139","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1923","id":472258139,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjI1ODEzOQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-13T02:46:49Z","updated_at":"2019-03-13T02:46:49Z","author_association":"MEMBER","body":"If you include the signing CA public cert from LetsEncrypt, it should be fine. You have to include the full chain of certs all the way back to (and including) the CA.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472258139/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472493404","html_url":"https://github.com/apache/couchdb/issues/1976#issuecomment-472493404","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1976","id":472493404,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MjQ5MzQwNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-13T16:14:52Z","updated_at":"2019-03-13T16:14:52Z","author_association":"MEMBER","body":"@sbcsuman \r\n\r\nHi there,\r\n\r\nThis is not a CouchDB bug. GitHub is for actual CouchDB bugs only.\r\n\r\nIf you are looking for general support with using CouchDB, please try one of these other options:\r\n\r\n* The user mailing list. Signup instructions are [here](http://couchdb.apache.org/#mailing-lists)\r\n* The Slack/IRC chat room. Joining instructions are [here](http://couchdb.apache.org/#chat)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472493404/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472890990","html_url":"https://github.com/apache/couchdb/issues/1524#issuecomment-472890990","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1524","id":472890990,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Mjg5MDk5MA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-14T14:38:25Z","updated_at":"2019-03-14T14:38:25Z","author_association":"MEMBER","body":"latest updates on dev@ https://lists.apache.org/thread.html/1aae26aa329817d8c54bab615a0df1c3a7b0fd34f17a2321ecf047f3@%3Cdev.couchdb.apache.org%3E","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/472890990/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473481938","html_url":"https://github.com/apache/couchdb/issues/1979#issuecomment-473481938","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1979","id":473481938,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MzQ4MTkzOA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-16T00:42:42Z","updated_at":"2019-03-16T00:42:42Z","author_association":"MEMBER","body":"This is a duplicate of #1810.\r\n\r\nYou need to upgrade to CouchDB 2.3.1.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473481938/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473482439","html_url":"https://github.com/apache/couchdb/issues/1980#issuecomment-473482439","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1980","id":473482439,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MzQ4MjQzOQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-16T00:47:21Z","updated_at":"2019-03-16T00:47:21Z","author_association":"MEMBER","body":"https://stackoverflow.com/questions/13021002/my-deb-file-removes-opt\r\n\r\nTake it up with upstream Debian.\r\n\r\nIf your `/opt` contains files other than CouchDB, `apt purge couchdb` will not remove `/opt`.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473482439/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473686687","html_url":"https://github.com/apache/couchdb/issues/1428#issuecomment-473686687","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1428","id":473686687,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MzY4NjY4Nw==","user":{"login":"tsloughter","id":36227,"node_id":"MDQ6VXNlcjM2MjI3","avatar_url":"https://avatars.githubusercontent.com/u/36227?v=4","gravatar_id":"","url":"https://api.github.com/users/tsloughter","html_url":"https://github.com/tsloughter","followers_url":"https://api.github.com/users/tsloughter/followers","following_url":"https://api.github.com/users/tsloughter/following{/other_user}","gists_url":"https://api.github.com/users/tsloughter/gists{/gist_id}","starred_url":"https://api.github.com/users/tsloughter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsloughter/subscriptions","organizations_url":"https://api.github.com/users/tsloughter/orgs","repos_url":"https://api.github.com/users/tsloughter/repos","events_url":"https://api.github.com/users/tsloughter/events{/privacy}","received_events_url":"https://api.github.com/users/tsloughter/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-17T17:25:30Z","updated_at":"2019-03-17T17:25:30Z","author_association":"NONE","body":"You might find it easier to use https://github.com/blt/port_compiler/ instead of having to call out to the external `enc` escript just to build NIFs.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473686687/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473873820","html_url":"https://github.com/apache/couchdb/pull/1907#issuecomment-473873820","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1907","id":473873820,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Mzg3MzgyMA==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-18T11:32:34Z","updated_at":"2019-03-18T11:32:34Z","author_association":"MEMBER","body":"We can close this since the elixir tests are merged in","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473873820/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473937254","html_url":"https://github.com/apache/couchdb/issues/1982#issuecomment-473937254","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1982","id":473937254,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3MzkzNzI1NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-18T14:38:54Z","updated_at":"2019-03-18T14:38:54Z","author_association":"MEMBER","body":"@danielszot Can you look in your couch logfile and grep for the number `2393520390`? There should be a traceback around there that we can go on.\r\n\r\nThis could be a misconfiguration, or it could be a bug, we need the log entries to know more.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473937254/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473955464","html_url":"https://github.com/apache/couchdb/issues/1982#issuecomment-473955464","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1982","id":473955464,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Mzk1NTQ2NA==","user":{"login":"danielszot","id":10668623,"node_id":"MDQ6VXNlcjEwNjY4NjIz","avatar_url":"https://avatars.githubusercontent.com/u/10668623?v=4","gravatar_id":"","url":"https://api.github.com/users/danielszot","html_url":"https://github.com/danielszot","followers_url":"https://api.github.com/users/danielszot/followers","following_url":"https://api.github.com/users/danielszot/following{/other_user}","gists_url":"https://api.github.com/users/danielszot/gists{/gist_id}","starred_url":"https://api.github.com/users/danielszot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielszot/subscriptions","organizations_url":"https://api.github.com/users/danielszot/orgs","repos_url":"https://api.github.com/users/danielszot/repos","events_url":"https://api.github.com/users/danielszot/events{/privacy}","received_events_url":"https://api.github.com/users/danielszot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-18T15:19:58Z","updated_at":"2019-03-18T15:19:58Z","author_association":"NONE","body":"@wohali I hope and assume this is misconfiguration, sorry for assigning bug label. Should be \"help needed\" rather.\r\n\r\nI changed log level by adding:\r\n```ini\r\n[log]\r\nlevel = debug\r\n```\r\nto configuration.\r\n\r\nI can see messages with `[debug]` prefix in the logs. Nevertheless, after grep through log messages this is the only messages I get:\r\n\r\n```bash\r\nkubectl logs dms-v1-prod-couchdb-0 --container couchdb | grep -A 1 2393520390\r\n```\r\n```\r\n[error] 2019-03-18T15:05:17.625875Z couchdb@dms-v1-prod-couchdb-0.dms-v1-prod-couchdb.default.svc.cluster.local <0.2949.0> 99d6944193 req_err(2393520390) case_clause : False\r\n    [<<\"chttpd_auth:party_mode_handler/1 L55\">>,<<\"chttpd:authenticate_request/2 L531\">>,<<\"chttpd:process_request/1 L301\">>,<<\"chttpd:handle_request_int/1 L243\">>,<<\"mochiweb_http:headers/6 L128\">>,<<\"proc_lib:init_p_do_apply/3 L247\">>]\r\n--\r\n[error] 2019-03-18T15:05:33.438952Z couchdb@dms-v1-prod-couchdb-0.dms-v1-prod-couchdb.default.svc.cluster.local <0.2949.0> dcb4734e1d req_err(2393520390) case_clause : False\r\n    [<<\"chttpd_auth:party_mode_handler/1 L55\">>,<<\"chttpd:authenticate_request/2 L531\">>,<<\"chttpd:process_request/1 L301\">>,<<\"chttpd:handle_request_int/1 L243\">>,<<\"mochiweb_http:headers/6 L128\">>,<<\"proc_lib:init_p_do_apply/3 L247\">>]\r\n--\r\n[error] 2019-03-18T15:05:37.033135Z couchdb@dms-v1-prod-couchdb-0.dms-v1-prod-couchdb.default.svc.cluster.local <0.2949.0> 134c36c418 req_err(2393520390) case_clause : False\r\n    [<<\"chttpd_auth:party_mode_handler/1 L55\">>,<<\"chttpd:authenticate_request/2 L531\">>,<<\"chttpd:process_request/1 L301\">>,<<\"chttpd:handle_request_int/1 L243\">>,<<\"mochiweb_http:headers/6 L128\">>,<<\"proc_lib:init_p_do_apply/3 L247\">>]\r\n--\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473955464/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473976074","html_url":"https://github.com/apache/couchdb/issues/1428#issuecomment-473976074","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1428","id":473976074,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Mzk3NjA3NA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-18T16:00:31Z","updated_at":"2019-03-18T16:00:31Z","author_association":"MEMBER","body":"The issues I had trying to use port_compiler is precisely what motivated me to write enc in the first place. I haven't paid any attention at all to changes to port_compiler in the meantime but that's precisely because I've not had any issues reported with enc in the nearly two years since I last touched it.\r\n\r\nI'm not against changing back to port_compiler if someone wants to take a stab at it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473976074/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473989531","html_url":"https://github.com/apache/couchdb/issues/1428#issuecomment-473989531","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1428","id":473989531,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Mzk4OTUzMQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-18T16:25:58Z","updated_at":"2019-03-18T16:25:58Z","author_association":"CONTRIBUTOR","body":"I started on this a while back: \r\n\r\nhttps://github.com/cloudant/couchdb/commit/b0f3feefa8c1725b178641c024a06cf7b1defb2a\r\n\r\nBesides the port compiler issue the other one was using raw dependencies (Fauxton and docs). `rebar3` doesn't do those by default (or didn't do when I checked): https://github.com/erlang/rebar3/issues/110 There might be a plugin to handle those. The other option could be to make a \"fake\" Erlang OTP directory structure in those dependencies.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473989531/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473990373","html_url":"https://github.com/apache/couchdb/issues/1428#issuecomment-473990373","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1428","id":473990373,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Mzk5MDM3Mw==","user":{"login":"tsloughter","id":36227,"node_id":"MDQ6VXNlcjM2MjI3","avatar_url":"https://avatars.githubusercontent.com/u/36227?v=4","gravatar_id":"","url":"https://api.github.com/users/tsloughter","html_url":"https://github.com/tsloughter","followers_url":"https://api.github.com/users/tsloughter/followers","following_url":"https://api.github.com/users/tsloughter/following{/other_user}","gists_url":"https://api.github.com/users/tsloughter/gists{/gist_id}","starred_url":"https://api.github.com/users/tsloughter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsloughter/subscriptions","organizations_url":"https://api.github.com/users/tsloughter/orgs","repos_url":"https://api.github.com/users/tsloughter/repos","events_url":"https://api.github.com/users/tsloughter/events{/privacy}","received_events_url":"https://api.github.com/users/tsloughter/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-18T16:27:36Z","updated_at":"2019-03-18T16:27:36Z","author_association":"NONE","body":"Yea, there is a raw resource plugin that can be used.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473990373/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473994198","html_url":"https://github.com/apache/couchdb/pull/1983#issuecomment-473994198","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1983","id":473994198,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Mzk5NDE5OA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-18T16:34:46Z","updated_at":"2019-03-18T16:34:46Z","author_association":"MEMBER","body":"@davisp Can you take a look please?\r\n\r\nI don't understand why it is necessary to recalculate doc's external size during compaction, given we are interested in uncompressed value, not changing doc's body and already have this info on `#leaf`, so I'm afraid I might be missing something subtle here.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473994198/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473996306","html_url":"https://github.com/apache/couchdb/issues/1982#issuecomment-473996306","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1982","id":473996306,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Mzk5NjMwNg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-18T16:38:43Z","updated_at":"2019-03-18T16:38:43Z","author_association":"MEMBER","body":"The [line that's being reported as an error here](https://github.com/apache/couchdb/blob/master/src/chttpd/src/chttpd_auth.erl#L55) is the line that fetches your\r\n\r\n```\r\n[chttpd]\r\nrequire_valid_user = false\r\n```\r\n\r\nfrom the config file. You have a capital `False` in there. Make that `false` and the problem will go away.\r\n\r\nFor better or worse, Couch has made a project decision not to relax handling input on these types of things, so I'll close this as resolved. Hope it solves your problem!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/473996306/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474007244","html_url":"https://github.com/apache/couchdb/issues/1428#issuecomment-474007244","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1428","id":474007244,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDAwNzI0NA==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-18T16:59:40Z","updated_at":"2019-03-18T16:59:40Z","author_association":"CONTRIBUTOR","body":"I think we should consider trying out `mix` (Elixir build tool) instead of `rebar3`. Although we would have same compatibility issues as with rebar3 (NIFs and raw deps). Nevertheless I find mix implementation faster and easier to hack on. I am  happy to go with any direction the community would decide to pursue. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474007244/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474011731","html_url":"https://github.com/apache/couchdb/issues/1428#issuecomment-474011731","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1428","id":474011731,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDAxMTczMQ==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-18T17:09:07Z","updated_at":"2019-03-18T17:09:07Z","author_association":"MEMBER","body":"+1 to using mix\n\n\n________________________________\nFrom: iilyak <notifications@github.com>\nSent: Monday, March 18, 2019 7:01 PM\nTo: apache/couchdb\nCc: Subscribed\nSubject: Re: [apache/couchdb] Migrate to rebar3 (#1428)\n\n\nI think we should consider trying out mix (Elixir build tool) instead of rebar3. Although we would have same compatibility issues as with rebar3 (NIFs and raw deps). Nevertheless I find mix implementation faster and easier to hack on. I am happy to go with any direction the community would decide to pursue.\n\n—\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub<https://github.com/apache/couchdb/issues/1428#issuecomment-474007244>, or mute the thread<https://github.com/notifications/unsubscribe-auth/AAK9AteE0ppVBV9_9dRYjSHLwZ8qOzyEks5vX8ZcgaJpZM4VH-DS>.\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474011731/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474022062","html_url":"https://github.com/apache/couchdb/issues/1428#issuecomment-474022062","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1428","id":474022062,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDAyMjA2Mg==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-18T17:32:39Z","updated_at":"2019-03-18T17:32:39Z","author_association":"MEMBER","body":"I'd +1 for trying `mix` too. I don't have an opinion on it itself, but I personally don't find `rebar3` a significant improvement over \"classical\" rebar. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474022062/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474023094","html_url":"https://github.com/apache/couchdb/issues/1982#issuecomment-474023094","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1982","id":474023094,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDAyMzA5NA==","user":{"login":"danielszot","id":10668623,"node_id":"MDQ6VXNlcjEwNjY4NjIz","avatar_url":"https://avatars.githubusercontent.com/u/10668623?v=4","gravatar_id":"","url":"https://api.github.com/users/danielszot","html_url":"https://github.com/danielszot","followers_url":"https://api.github.com/users/danielszot/followers","following_url":"https://api.github.com/users/danielszot/following{/other_user}","gists_url":"https://api.github.com/users/danielszot/gists{/gist_id}","starred_url":"https://api.github.com/users/danielszot/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielszot/subscriptions","organizations_url":"https://api.github.com/users/danielszot/orgs","repos_url":"https://api.github.com/users/danielszot/repos","events_url":"https://api.github.com/users/danielszot/events{/privacy}","received_events_url":"https://api.github.com/users/danielszot/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-18T17:35:10Z","updated_at":"2019-03-18T17:35:10Z","author_association":"NONE","body":"Thank you, it helped, now everything works correctly. \r\n\r\nThis was just because I use Ansible to generate that config file based on variables and template file and by default boolean values starts from capital letter in Ansible.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474023094/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474027962","html_url":"https://github.com/apache/couchdb/issues/1428#issuecomment-474027962","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1428","id":474027962,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDAyNzk2Mg==","user":{"login":"tsloughter","id":36227,"node_id":"MDQ6VXNlcjM2MjI3","avatar_url":"https://avatars.githubusercontent.com/u/36227?v=4","gravatar_id":"","url":"https://api.github.com/users/tsloughter","html_url":"https://github.com/tsloughter","followers_url":"https://api.github.com/users/tsloughter/followers","following_url":"https://api.github.com/users/tsloughter/following{/other_user}","gists_url":"https://api.github.com/users/tsloughter/gists{/gist_id}","starred_url":"https://api.github.com/users/tsloughter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tsloughter/subscriptions","organizations_url":"https://api.github.com/users/tsloughter/orgs","repos_url":"https://api.github.com/users/tsloughter/repos","events_url":"https://api.github.com/users/tsloughter/events{/privacy}","received_events_url":"https://api.github.com/users/tsloughter/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-18T17:46:38Z","updated_at":"2019-03-18T17:46:38Z","author_association":"NONE","body":":( \r\n\r\nI don't work on couchdb so my opinion doesn't matter here, but I am always interested in ways to improve rebar3, so please pass along (probably not on this issue unless it somehow directly relates to the question of couchdb migration) any suggestions or complaints (particularly how it doesn't do better than rebar2 which was one of the main goals and why it was essentially a rewrite). \r\n\r\nrebar3 is fairly different from mix, so personal preference for one or the other over particular decisions we made differently is an understandable separation that can't necessarily be bridged, but always interested in hearing about them.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474027962/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474041838","html_url":"https://github.com/apache/couchdb/issues/1920#issuecomment-474041838","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1920","id":474041838,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDA0MTgzOA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-18T18:21:02Z","updated_at":"2019-03-18T18:21:02Z","author_association":"CONTRIBUTOR","body":"The PR was moved to: https://github.com/apache/couchdb/pull/1972\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474041838/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474064163","html_url":"https://github.com/apache/couchdb/issues/1428#issuecomment-474064163","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1428","id":474064163,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDA2NDE2Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-18T19:21:41Z","updated_at":"2019-03-18T19:21:41Z","author_association":"MEMBER","body":"@tsloughter Thanks so much for stopping by!\r\n\r\nThe big issues for us when rebar3 dropped were  problems with NIFs (why @davisp had to build [enc](https://github.com/davisp/erlang-native-compiler).), coupled with the problems Nick mentioned on raw dependencies, and some Windows compile issue (probably NIF related) I ran into that I can't remember. Because that was early and we were waiting, you have probably fixed some or all of these by now, but this hasn't been a high priority ticket. It's becoming more important as we look at architectural changes to CouchDB and newer versions of Erlang.\r\n\r\nWhile mix is interesting, it matters more in my opinion if we're going to start accepting Elixir as a core language, not just for our test suite. Either way, I don't have the cycles to drive the work on either, so I hope someone picks up either and runs with it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474064163/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474311302","html_url":"https://github.com/apache/couchdb/issues/1418#issuecomment-474311302","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1418","id":474311302,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDMxMTMwMg==","user":{"login":"adrienverge","id":5244945,"node_id":"MDQ6VXNlcjUyNDQ5NDU=","avatar_url":"https://avatars.githubusercontent.com/u/5244945?v=4","gravatar_id":"","url":"https://api.github.com/users/adrienverge","html_url":"https://github.com/adrienverge","followers_url":"https://api.github.com/users/adrienverge/followers","following_url":"https://api.github.com/users/adrienverge/following{/other_user}","gists_url":"https://api.github.com/users/adrienverge/gists{/gist_id}","starred_url":"https://api.github.com/users/adrienverge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrienverge/subscriptions","organizations_url":"https://api.github.com/users/adrienverge/orgs","repos_url":"https://api.github.com/users/adrienverge/repos","events_url":"https://api.github.com/users/adrienverge/events{/privacy}","received_events_url":"https://api.github.com/users/adrienverge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-19T11:09:11Z","updated_at":"2019-03-19T11:09:11Z","author_association":"CONTRIBUTOR","body":"This is an interesting edge case indeed!\r\n\r\nI also experience the bug on CouchDB 2. My understanding is that it happens in this particular case:\r\n\r\n- **step A:** document is non-deleted, and correctly replicated :heavy_check_mark:\r\n  ```\r\n               first rev       latest rev on source\r\n                  ↘           ↙\r\n  SOURCE SERVER    o----o----o\r\n  TARGET SERVER    o----o----o\r\n                              ↖\r\n                               latest rev on target\r\n  ```\r\n- **step B:** document is deleted, and correctly replicated :heavy_check_mark:\r\n  ```\r\n               first rev            tombstone rev (latest rev on source)\r\n                  ↘                ↙\r\n  SOURCE SERVER    o----o----o----x\r\n  TARGET SERVER    o----o----o----x\r\n                                   ↖\r\n                                    tombstone rev (latest rev on target)\r\n  ```\r\n- **step C:** document is re-created on source, but **not replicated** :warning:\r\n  ```\r\n                              tombstone rev\r\n               first rev     (last common ancestor)     latest rev on source\r\n                  ↘               ↓                    ↙\r\n  SOURCE SERVER    o----o----o----x----o----o----o----o\r\n  TARGET SERVER    o----o----o----x\r\n                                   ↖\r\n                                    tombstone rev (latest rev on target)\r\n  ```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474311302/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474449340","html_url":"https://github.com/apache/couchdb/issues/1984#issuecomment-474449340","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1984","id":474449340,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDQ0OTM0MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-19T16:11:48Z","updated_at":"2019-03-19T16:15:25Z","author_association":"MEMBER","body":"Hi there @Austint30 ,\r\n\r\nI can promise you that CouchDB works fine with >120k documents frequently. It sounds like your hardware is underpowered and you need more CPU or need to bump the timeout, but that error you're seeing on your index is that Mango does not yet support reduces. Remove the `reduce` key.\r\n\r\nYou should also upgrade as soon as possible because of known security holes in both 2.1.1 and 2.2.0 as documented [here](http://docs.couchdb.org/en/stable/cve/index.html).\r\n\r\nUnfortunately, This is not a CouchDB bug. GitHub is for actual CouchDB bugs only.\r\n\r\nIf you are looking for general support with using CouchDB, please try one of these other options:\r\n\r\n* The user mailing list. Signup instructions are [here](http://couchdb.apache.org/#mailing-lists)\r\n* The Slack/IRC chat room. Joining instructions are [here](http://couchdb.apache.org/#chat)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474449340/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474455369","html_url":"https://github.com/apache/couchdb/issues/1920#issuecomment-474455369","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1920","id":474455369,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDQ1NTM2OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-19T16:24:36Z","updated_at":"2019-03-19T16:24:36Z","author_association":"MEMBER","body":"@nickva don't forget to commit the RFC to the docs repo in the `rfcs/ `directory.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474455369/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474459576","html_url":"https://github.com/apache/couchdb/issues/1984#issuecomment-474459576","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1984","id":474459576,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDQ1OTU3Ng==","user":{"login":"Austint30","id":16272815,"node_id":"MDQ6VXNlcjE2MjcyODE1","avatar_url":"https://avatars.githubusercontent.com/u/16272815?v=4","gravatar_id":"","url":"https://api.github.com/users/Austint30","html_url":"https://github.com/Austint30","followers_url":"https://api.github.com/users/Austint30/followers","following_url":"https://api.github.com/users/Austint30/following{/other_user}","gists_url":"https://api.github.com/users/Austint30/gists{/gist_id}","starred_url":"https://api.github.com/users/Austint30/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Austint30/subscriptions","organizations_url":"https://api.github.com/users/Austint30/orgs","repos_url":"https://api.github.com/users/Austint30/repos","events_url":"https://api.github.com/users/Austint30/events{/privacy}","received_events_url":"https://api.github.com/users/Austint30/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-19T16:34:55Z","updated_at":"2019-03-19T16:34:55Z","author_association":"NONE","body":"Hi @wohali \r\nThe reduce key was added automatically when creating indexes using db/_index (or in the Fauxton interface under Mango Query).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474459576/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474463601","html_url":"https://github.com/apache/couchdb/issues/1984#issuecomment-474463601","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1984","id":474463601,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDQ2MzYwMQ==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-19T16:44:40Z","updated_at":"2019-03-19T16:44:40Z","author_association":"MEMBER","body":"Which version of Fauxton are you using?\n\n\n________________________________\nFrom: Austint30 <notifications@github.com>\nSent: Tuesday, March 19, 2019 6:34 PM\nTo: apache/couchdb\nCc: Subscribed\nSubject: Re: [apache/couchdb] CouchDB Indexes Failing (Invalid Index Def ... Error: error, Reason: {badmatch,undefined}) (#1984)\n\n\nHi @wohali<https://github.com/wohali>\nThe reduce key was added automatically when creating indexes using db/_index (or in the Fauxton interface under Mango Query).\n\n—\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub<https://github.com/apache/couchdb/issues/1984#issuecomment-474459576>, or mute the thread<https://github.com/notifications/unsubscribe-auth/AAK9AtzkUKJc6CX6trcsq7qBsGLH88OGks5vYRGwgaJpZM4b8UpM>.\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474463601/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474468182","html_url":"https://github.com/apache/couchdb/issues/1984#issuecomment-474468182","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1984","id":474468182,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDQ2ODE4Mg==","user":{"login":"Austint30","id":16272815,"node_id":"MDQ6VXNlcjE2MjcyODE1","avatar_url":"https://avatars.githubusercontent.com/u/16272815?v=4","gravatar_id":"","url":"https://api.github.com/users/Austint30","html_url":"https://github.com/Austint30","followers_url":"https://api.github.com/users/Austint30/followers","following_url":"https://api.github.com/users/Austint30/following{/other_user}","gists_url":"https://api.github.com/users/Austint30/gists{/gist_id}","starred_url":"https://api.github.com/users/Austint30/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Austint30/subscriptions","organizations_url":"https://api.github.com/users/Austint30/orgs","repos_url":"https://api.github.com/users/Austint30/repos","events_url":"https://api.github.com/users/Austint30/events{/privacy}","received_events_url":"https://api.github.com/users/Austint30/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-19T16:55:29Z","updated_at":"2019-03-19T16:55:29Z","author_association":"NONE","body":"I am using the version of Fauxton that came with CouchDB 2.1.1.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474468182/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474497030","html_url":"https://github.com/apache/couchdb/issues/1920#issuecomment-474497030","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1920","id":474497030,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDQ5NzAzMA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-19T17:55:35Z","updated_at":"2019-03-19T17:55:35Z","author_association":"CONTRIBUTOR","body":"@wohali moved to the RFC dir in docs: https://github.com/apache/couchdb-documentation/pull/400\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474497030/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474799709","html_url":"https://github.com/apache/couchdb/issues/747#issuecomment-474799709","issue_url":"https://api.github.com/repos/apache/couchdb/issues/747","id":474799709,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDc5OTcwOQ==","user":{"login":"col-panic","id":1679857,"node_id":"MDQ6VXNlcjE2Nzk4NTc=","avatar_url":"https://avatars.githubusercontent.com/u/1679857?v=4","gravatar_id":"","url":"https://api.github.com/users/col-panic","html_url":"https://github.com/col-panic","followers_url":"https://api.github.com/users/col-panic/followers","following_url":"https://api.github.com/users/col-panic/following{/other_user}","gists_url":"https://api.github.com/users/col-panic/gists{/gist_id}","starred_url":"https://api.github.com/users/col-panic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/col-panic/subscriptions","organizations_url":"https://api.github.com/users/col-panic/orgs","repos_url":"https://api.github.com/users/col-panic/repos","events_url":"https://api.github.com/users/col-panic/events{/privacy}","received_events_url":"https://api.github.com/users/col-panic/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-20T11:59:50Z","updated_at":"2019-03-20T12:00:10Z","author_association":"NONE","body":"I came here via the current docker official couchdb installation (2.3.1) - still in its default configuration, couchdb has\r\n\r\n```\r\n[httpd]\r\nauthentication_handlers = {couch_httpd_auth, cookie_authentication_handler}, {couch_httpd_auth, default_authentication_handler}\r\n```\r\n\r\nand if I delete this entry in favour of the [chttpd] one - couchdb instantly terminates","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474799709/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474913561","html_url":"https://github.com/apache/couchdb/issues/1985#issuecomment-474913561","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1985","id":474913561,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDkxMzU2MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-20T16:25:48Z","updated_at":"2019-03-20T16:28:33Z","author_association":"MEMBER","body":"@col-panic Will take a look soon but wanted to make it clear: do *NOT* use port 5986 for anything other than what the documentation states you should do. That means - do not point your database clients at port 5986, ever.\r\n\r\nI have recently made proxy authentication work with 2.3.1 for a client, so I know it's possible, but need to retrace my steps. I'll be in touch later this week.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474913561/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474926259","html_url":"https://github.com/apache/couchdb/issues/747#issuecomment-474926259","issue_url":"https://api.github.com/repos/apache/couchdb/issues/747","id":474926259,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDkyNjI1OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-20T16:49:51Z","updated_at":"2019-03-20T16:49:51Z","author_association":"MEMBER","body":"https://docs.couchdb.org/en/stable/api/server/authn.html#proxy-authentication has the correct information, note the configuration is slightly different than what you tried.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474926259/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474926664","html_url":"https://github.com/apache/couchdb/issues/1985#issuecomment-474926664","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1985","id":474926664,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NDkyNjY2NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-20T16:50:42Z","updated_at":"2019-03-20T16:50:42Z","author_association":"MEMBER","body":"@col-panic See: https://docs.couchdb.org/en/stable/api/server/authn.html#proxy-authentication\r\n\r\nThe correct configuration is:\r\n\r\n```\r\n[chttpd]\r\nauthentication_handlers = {chttpd_auth, cookie_authentication_handler}, {chttpd_auth, proxy_authentication_handler}, {chttpd_auth, default_authentication_handler}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/474926664/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475127245","html_url":"https://github.com/apache/couchdb/issues/1985#issuecomment-475127245","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1985","id":475127245,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NTEyNzI0NQ==","user":{"login":"col-panic","id":1679857,"node_id":"MDQ6VXNlcjE2Nzk4NTc=","avatar_url":"https://avatars.githubusercontent.com/u/1679857?v=4","gravatar_id":"","url":"https://api.github.com/users/col-panic","html_url":"https://github.com/col-panic","followers_url":"https://api.github.com/users/col-panic/followers","following_url":"https://api.github.com/users/col-panic/following{/other_user}","gists_url":"https://api.github.com/users/col-panic/gists{/gist_id}","starred_url":"https://api.github.com/users/col-panic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/col-panic/subscriptions","organizations_url":"https://api.github.com/users/col-panic/orgs","repos_url":"https://api.github.com/users/col-panic/repos","events_url":"https://api.github.com/users/col-panic/events{/privacy}","received_events_url":"https://api.github.com/users/col-panic/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-21T06:46:54Z","updated_at":"2019-03-21T06:46:54Z","author_association":"NONE","body":"I can confirm, that after restarting couchdb it does work now!? This seems to have been the problem with the docker instance too! Thanks a lot!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475127245/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475128316","html_url":"https://github.com/apache/couchdb/issues/1985#issuecomment-475128316","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1985","id":475128316,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NTEyODMxNg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-21T06:54:28Z","updated_at":"2019-03-21T06:54:28Z","author_association":"MEMBER","body":"Glad I was able to help. Yes, you need to restart CouchDB for that setting to take effect.\r\n\r\nA quick word - your comments from before you made the above comment made it to our mailing list for posterity. Don't be so hasty to tell someone who maintains the software and has worked with it for more than 10 years that she doesn't know what she's doing.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475128316/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475133137","html_url":"https://github.com/apache/couchdb/issues/1985#issuecomment-475133137","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1985","id":475133137,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NTEzMzEzNw==","user":{"login":"col-panic","id":1679857,"node_id":"MDQ6VXNlcjE2Nzk4NTc=","avatar_url":"https://avatars.githubusercontent.com/u/1679857?v=4","gravatar_id":"","url":"https://api.github.com/users/col-panic","html_url":"https://github.com/col-panic","followers_url":"https://api.github.com/users/col-panic/followers","following_url":"https://api.github.com/users/col-panic/following{/other_user}","gists_url":"https://api.github.com/users/col-panic/gists{/gist_id}","starred_url":"https://api.github.com/users/col-panic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/col-panic/subscriptions","organizations_url":"https://api.github.com/users/col-panic/orgs","repos_url":"https://api.github.com/users/col-panic/repos","events_url":"https://api.github.com/users/col-panic/events{/privacy}","received_events_url":"https://api.github.com/users/col-panic/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-21T07:25:16Z","updated_at":"2019-03-21T07:25:16Z","author_association":"NONE","body":"@wohali thank you and yes - I apologize for that! \r\n\r\nI tried all different settings for some hours yesterday, and it is not obvious, that for this one setting, a restart of couchdb seems necessary, where for all others this isn't the case! ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475133137/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475177957","html_url":"https://github.com/apache/couchdb/issues/1269#issuecomment-475177957","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1269","id":475177957,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NTE3Nzk1Nw==","user":{"login":"homerjam","id":1055769,"node_id":"MDQ6VXNlcjEwNTU3Njk=","avatar_url":"https://avatars.githubusercontent.com/u/1055769?v=4","gravatar_id":"","url":"https://api.github.com/users/homerjam","html_url":"https://github.com/homerjam","followers_url":"https://api.github.com/users/homerjam/followers","following_url":"https://api.github.com/users/homerjam/following{/other_user}","gists_url":"https://api.github.com/users/homerjam/gists{/gist_id}","starred_url":"https://api.github.com/users/homerjam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/homerjam/subscriptions","organizations_url":"https://api.github.com/users/homerjam/orgs","repos_url":"https://api.github.com/users/homerjam/repos","events_url":"https://api.github.com/users/homerjam/events{/privacy}","received_events_url":"https://api.github.com/users/homerjam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-21T10:27:36Z","updated_at":"2019-03-21T10:27:36Z","author_association":"NONE","body":"Any more updates on this? It would be so wonderful not to be reliant on IBM! They can't even seem to handle billing 🤦🏻‍♂️","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475177957/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475294678","html_url":"https://github.com/apache/couchdb/issues/1986#issuecomment-475294678","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1986","id":475294678,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NTI5NDY3OA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-21T16:07:35Z","updated_at":"2019-03-21T16:07:35Z","author_association":"MEMBER","body":"The `_replicator` DB is special - you shouldn't see this behaviour on other DBs.\r\n\r\n@nickva can respond to this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475294678/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475318353","html_url":"https://github.com/apache/couchdb/issues/1269#issuecomment-475318353","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1269","id":475318353,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NTMxODM1Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-21T17:05:08Z","updated_at":"2019-03-21T17:05:08Z","author_association":"MEMBER","body":"If there's progress, you'll see it linked here. As there is no update, there has been no progress.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475318353/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475491037","html_url":"https://github.com/apache/couchdb/issues/1986#issuecomment-475491037","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1986","id":475491037,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NTQ5MTAzNw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-22T04:34:43Z","updated_at":"2019-03-22T07:34:36Z","author_association":"CONTRIBUTOR","body":"@magnadoodle, @wohali is right, `_replicator` is special. \r\n\r\nThe idea was that `_replicator` in CouchDB 1.x could only be a single database per server. So in the case with multiple users, one of them could list the replicator doc for all the other users and view their credentials.\r\n\r\nHowever there is another feature in 2.x that lets you bypass this in a way. It turns out, in CouchDB 2.x you can have multiple replicator dbs! Basically any database that ends with the `/_replicator` will be a `_replicator`. For example `other/_replicator` or `my/_replicator`, etc. And it turns out those additional replicator dbs don't have this restriction that only server admin can perform `_all_docs`!\r\n\r\nLet's try it out:\r\n\r\n```\r\n$ curl -XPUT http://adm:pass@localhost:15984/other%2f_replicator\r\n{\"ok\":true}\r\n```\r\n[!] Notice: I urlencoded `/` as `%2f` so it is not interpreted as db=`other` and doc=`_replicator`\r\n\r\nThen I followed the same steps as you to add the test user. And then add the new user to `_replicator` and `other/_replicator` as admins.\r\n\r\n```\r\n$ curl http://adm:pass@localhost:15984/_replicator/_security\r\n{\"admins\":{\"names\":[\"testuser\"],\"roles\":[]},\"members\":{\"names\":[],\"roles\":[]}}\r\n\r\n$ curl http://adm:pass@localhost:15984/other%2f_replicator/_security\r\n{\"admins\":{\"names\":[\"testuser\"],\"roles\":[]},\"members\":{\"names\":[],\"roles\":[]}}\r\n```\r\n\r\nNow notice that I can't query `_all_docs` on `_replicator` but can on `other/_replicator`.\r\n\r\n```\r\n$ curl http://testuser:test1234@localhost:15984/_replicator/_all_docs\r\n{\"error\":\"unauthorized\",\"reason\":\"You are not a server admin.\"}\r\n\r\n\r\n$ curl http://testuser:test1234@localhost:15984/other%2f_replicator/_all_docs\r\n{\"total_rows\":1,\"offset\":0,\"rows\":[\r\n{\"id\":\"_design/_replicator\",\"key\":\"_design/_replicator\",\"value\":{\"rev\":\"1-85a961d0d9b235b7b4f07baed1a38fda\"}}\r\n]}\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475491037/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475991130","html_url":"https://github.com/apache/couchdb/issues/1989#issuecomment-475991130","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1989","id":475991130,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NTk5MTEzMA==","user":{"login":"popojargo","id":9197078,"node_id":"MDQ6VXNlcjkxOTcwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/9197078?v=4","gravatar_id":"","url":"https://api.github.com/users/popojargo","html_url":"https://github.com/popojargo","followers_url":"https://api.github.com/users/popojargo/followers","following_url":"https://api.github.com/users/popojargo/following{/other_user}","gists_url":"https://api.github.com/users/popojargo/gists{/gist_id}","starred_url":"https://api.github.com/users/popojargo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/popojargo/subscriptions","organizations_url":"https://api.github.com/users/popojargo/orgs","repos_url":"https://api.github.com/users/popojargo/repos","events_url":"https://api.github.com/users/popojargo/events{/privacy}","received_events_url":"https://api.github.com/users/popojargo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-24T19:25:04Z","updated_at":"2019-03-24T19:25:51Z","author_association":"MEMBER","body":"~~I'll move that over `apache/couchdb-glazier` since it's related to Windows build only.~~\r\n\r\nNVM, there's no issue page for this repo.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475991130/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475992183","html_url":"https://github.com/apache/couchdb/issues/1989#issuecomment-475992183","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1989","id":475992183,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NTk5MjE4Mw==","user":{"login":"popojargo","id":9197078,"node_id":"MDQ6VXNlcjkxOTcwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/9197078?v=4","gravatar_id":"","url":"https://api.github.com/users/popojargo","html_url":"https://github.com/popojargo","followers_url":"https://api.github.com/users/popojargo/followers","following_url":"https://api.github.com/users/popojargo/following{/other_user}","gists_url":"https://api.github.com/users/popojargo/gists{/gist_id}","starred_url":"https://api.github.com/users/popojargo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/popojargo/subscriptions","organizations_url":"https://api.github.com/users/popojargo/orgs","repos_url":"https://api.github.com/users/popojargo/repos","events_url":"https://api.github.com/users/popojargo/events{/privacy}","received_events_url":"https://api.github.com/users/popojargo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-24T19:36:59Z","updated_at":"2019-03-24T19:36:59Z","author_association":"MEMBER","body":"I know that with WIX, we can easily configure some files so that they remains when uninstalling.\r\n\r\nSee this S/O response for example: https://stackoverflow.com/a/2631261/5236185\r\n\r\nI can submit a pull request for that but I would like to know what are the files to keep? \r\n\r\nThe only one that I'm sure so far is: `/etc/local.ini`\r\n\r\nIs there any other files?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/475992183/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476096534","html_url":"https://github.com/apache/couchdb/issues/1986#issuecomment-476096534","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1986","id":476096534,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjA5NjUzNA==","user":{"login":"magnadoodle","id":29652981,"node_id":"MDQ6VXNlcjI5NjUyOTgx","avatar_url":"https://avatars.githubusercontent.com/u/29652981?v=4","gravatar_id":"","url":"https://api.github.com/users/magnadoodle","html_url":"https://github.com/magnadoodle","followers_url":"https://api.github.com/users/magnadoodle/followers","following_url":"https://api.github.com/users/magnadoodle/following{/other_user}","gists_url":"https://api.github.com/users/magnadoodle/gists{/gist_id}","starred_url":"https://api.github.com/users/magnadoodle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/magnadoodle/subscriptions","organizations_url":"https://api.github.com/users/magnadoodle/orgs","repos_url":"https://api.github.com/users/magnadoodle/repos","events_url":"https://api.github.com/users/magnadoodle/events{/privacy}","received_events_url":"https://api.github.com/users/magnadoodle/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-25T08:21:06Z","updated_at":"2019-03-25T08:21:31Z","author_association":"NONE","body":"@whoali @nickva Thanks for the detailed answer. I understand these design considerations. But this makes it really hard to monitor CouchDB 2 in a secure way. I will try if @nickva's approach to use another Database as _replicator DB is viable for me.\r\n\r\nWhat do you think about API Endpoints to expose information about running Replications (without DB credentials) and DB Stats, which are also only accessible to DB Admins since Version 2 to read-only users? If you like the idea I will file a feature request. \r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476096534/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476191522","html_url":"https://github.com/apache/couchdb/issues/887#issuecomment-476191522","issue_url":"https://api.github.com/repos/apache/couchdb/issues/887","id":476191522,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjE5MTUyMg==","user":{"login":"vincnetas","id":472357,"node_id":"MDQ6VXNlcjQ3MjM1Nw==","avatar_url":"https://avatars.githubusercontent.com/u/472357?v=4","gravatar_id":"","url":"https://api.github.com/users/vincnetas","html_url":"https://github.com/vincnetas","followers_url":"https://api.github.com/users/vincnetas/followers","following_url":"https://api.github.com/users/vincnetas/following{/other_user}","gists_url":"https://api.github.com/users/vincnetas/gists{/gist_id}","starred_url":"https://api.github.com/users/vincnetas/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vincnetas/subscriptions","organizations_url":"https://api.github.com/users/vincnetas/orgs","repos_url":"https://api.github.com/users/vincnetas/repos","events_url":"https://api.github.com/users/vincnetas/events{/privacy}","received_events_url":"https://api.github.com/users/vincnetas/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-25T13:16:43Z","updated_at":"2019-03-25T13:16:43Z","author_association":"NONE","body":"I think this parameter was left undocumented. Could update  documentation but not sure what was added and what's the syntax. Can't read erlang :( \r\n\r\nIs it root level property :\r\n\r\n```\r\n{\r\n  \"create_target\": true,\r\n  \"create_target_params\": {\"q\": \"1\", ...}\r\n}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476191522/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476192442","html_url":"https://github.com/apache/couchdb/issues/1989#issuecomment-476192442","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1989","id":476192442,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjE5MjQ0Mg==","user":{"login":"popojargo","id":9197078,"node_id":"MDQ6VXNlcjkxOTcwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/9197078?v=4","gravatar_id":"","url":"https://api.github.com/users/popojargo","html_url":"https://github.com/popojargo","followers_url":"https://api.github.com/users/popojargo/followers","following_url":"https://api.github.com/users/popojargo/following{/other_user}","gists_url":"https://api.github.com/users/popojargo/gists{/gist_id}","starred_url":"https://api.github.com/users/popojargo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/popojargo/subscriptions","organizations_url":"https://api.github.com/users/popojargo/orgs","repos_url":"https://api.github.com/users/popojargo/repos","events_url":"https://api.github.com/users/popojargo/events{/privacy}","received_events_url":"https://api.github.com/users/popojargo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-25T13:19:01Z","updated_at":"2019-03-25T13:19:01Z","author_association":"MEMBER","body":"Updates from @wohali : etc/local.ini and the entire etc/local.d directory","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476192442/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476219737","html_url":"https://github.com/apache/couchdb/issues/1986#issuecomment-476219737","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1986","id":476219737,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjIxOTczNw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-25T14:25:15Z","updated_at":"2019-03-25T14:25:15Z","author_association":"CONTRIBUTOR","body":"@magnadoodle _active_tasks, _scheduler/jobs and _scheduler/docs should probably be used to monitor replications. If you specifically look at document states, then _scheduler/docs is probably the first to try\r\n\r\nhttps://docs.couchdb.org/en/stable/api/server/common.html#get--_scheduler-docs-replicator_db","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476219737/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476370317","html_url":"https://github.com/apache/couchdb/pull/1972#issuecomment-476370317","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1972","id":476370317,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjM3MDMxNw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-25T20:46:04Z","updated_at":"2019-03-25T20:46:04Z","author_association":"CONTRIBUTOR","body":"@jaydoane Thanks for taking a look and for the detailed review. I think I have fixed / responded to most of the comments. I couldn't reproduce the. I couldn't reproduce the PartitionAllDocsTest failure locally as discussed online.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476370317/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476398318","html_url":"https://github.com/apache/couchdb/issues/1990#issuecomment-476398318","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1990","id":476398318,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjM5ODMxOA==","user":{"login":"wintercounter","id":963776,"node_id":"MDQ6VXNlcjk2Mzc3Ng==","avatar_url":"https://avatars.githubusercontent.com/u/963776?v=4","gravatar_id":"","url":"https://api.github.com/users/wintercounter","html_url":"https://github.com/wintercounter","followers_url":"https://api.github.com/users/wintercounter/followers","following_url":"https://api.github.com/users/wintercounter/following{/other_user}","gists_url":"https://api.github.com/users/wintercounter/gists{/gist_id}","starred_url":"https://api.github.com/users/wintercounter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wintercounter/subscriptions","organizations_url":"https://api.github.com/users/wintercounter/orgs","repos_url":"https://api.github.com/users/wintercounter/repos","events_url":"https://api.github.com/users/wintercounter/events{/privacy}","received_events_url":"https://api.github.com/users/wintercounter/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-25T22:15:06Z","updated_at":"2019-03-25T22:15:06Z","author_association":"NONE","body":"Found it, sorry.\r\n\r\nhttps://github.com/apache/couchdb-pkg/blob/master/debian/README.Debian","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476398318/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476519118","html_url":"https://github.com/apache/couchdb/issues/1986#issuecomment-476519118","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1986","id":476519118,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjUxOTExOA==","user":{"login":"magnadoodle","id":29652981,"node_id":"MDQ6VXNlcjI5NjUyOTgx","avatar_url":"https://avatars.githubusercontent.com/u/29652981?v=4","gravatar_id":"","url":"https://api.github.com/users/magnadoodle","html_url":"https://github.com/magnadoodle","followers_url":"https://api.github.com/users/magnadoodle/followers","following_url":"https://api.github.com/users/magnadoodle/following{/other_user}","gists_url":"https://api.github.com/users/magnadoodle/gists{/gist_id}","starred_url":"https://api.github.com/users/magnadoodle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/magnadoodle/subscriptions","organizations_url":"https://api.github.com/users/magnadoodle/orgs","repos_url":"https://api.github.com/users/magnadoodle/repos","events_url":"https://api.github.com/users/magnadoodle/events{/privacy}","received_events_url":"https://api.github.com/users/magnadoodle/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-26T08:18:09Z","updated_at":"2019-03-26T08:18:09Z","author_association":"NONE","body":"@nickva thanks I will take a look at that! So I will close this one. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476519118/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476707751","html_url":"https://github.com/apache/couchdb/pull/1734#issuecomment-476707751","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1734","id":476707751,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NjcwNzc1MQ==","user":{"login":"brianewilkins","id":11932760,"node_id":"MDQ6VXNlcjExOTMyNzYw","avatar_url":"https://avatars.githubusercontent.com/u/11932760?v=4","gravatar_id":"","url":"https://api.github.com/users/brianewilkins","html_url":"https://github.com/brianewilkins","followers_url":"https://api.github.com/users/brianewilkins/followers","following_url":"https://api.github.com/users/brianewilkins/following{/other_user}","gists_url":"https://api.github.com/users/brianewilkins/gists{/gist_id}","starred_url":"https://api.github.com/users/brianewilkins/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brianewilkins/subscriptions","organizations_url":"https://api.github.com/users/brianewilkins/orgs","repos_url":"https://api.github.com/users/brianewilkins/repos","events_url":"https://api.github.com/users/brianewilkins/events{/privacy}","received_events_url":"https://api.github.com/users/brianewilkins/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-26T15:37:35Z","updated_at":"2019-12-19T16:35:34Z","author_association":"NONE","body":"The replication of a document silently fails if the sum of the sizes of its attachments is high enough. There is no indication of which documents failed to replicate or why.\r\n\r\nBelow is a sequence of commands to reproduce the problem using Cloudant.\r\nWhen you run this sequence of commands the variables ACCOUNTNAME and PASSWORD must have been set to appropriate values.\r\n```\r\nSOURCE_DB=https://$ACCOUNTNAME:$PASSWORD@$ACCOUNTNAME.cloudant.com/fb110773_source\r\nTARGET_DB=https://$ACCOUNTNAME:$PASSWORD@$ACCOUNTNAME.cloudant.com/fb110773_target\r\nREPLICATOR_DB=https://$ACCOUNTNAME:$PASSWORD@$ACCOUNTNAME.cloudant.com/_replicator\r\n\r\nATTACHMENT_FILE=attachment_file\r\nATTACHMENT_MIME_TYPE=application/octet-stream\r\n\r\ncurl -X DELETE $SOURCE_DB\r\ncurl -X DELETE $TARGET_DB\r\n\r\ncurl -X PUT $SOURCE_DB\r\ncurl -X PUT $TARGET_DB\r\n\r\ndd if=<(yes | tr -d \"\\n\") of=$ATTACHMENT_FILE bs=1024 count=10240 # create a 10 MB file\r\n\r\nREV=`curl -X PUT $SOURCE_DB/doc1 -H \"Content-Type: application/json\" -d {} | jq .rev | tr -d '\"'`\r\nREV=`curl -X PUT $SOURCE_DB/doc1/attachment1?rev=$REV -H \"Content-Type: $ATTACHMENT_MIME_TYPE\" -d @$ATTACHMENT_FILE | jq .rev | tr -d '\"'`\r\nREV=`curl -X PUT $SOURCE_DB/doc1/attachment2?rev=$REV -H \"Content-Type: $ATTACHMENT_MIME_TYPE\" -d @$ATTACHMENT_FILE | jq .rev | tr -d '\"'`\r\nREV=`curl -X PUT $SOURCE_DB/doc1/attachment3?rev=$REV -H \"Content-Type: $ATTACHMENT_MIME_TYPE\" -d @$ATTACHMENT_FILE | jq .rev | tr -d '\"'`\r\nREV=`curl -X PUT $SOURCE_DB/doc1/attachment4?rev=$REV -H \"Content-Type: $ATTACHMENT_MIME_TYPE\" -d @$ATTACHMENT_FILE | jq .rev | tr -d '\"'`\r\nREV=`curl -X PUT $SOURCE_DB/doc1/attachment5?rev=$REV -H \"Content-Type: $ATTACHMENT_MIME_TYPE\" -d @$ATTACHMENT_FILE | jq .rev | tr -d '\"'`\r\nREV=`curl -X PUT $SOURCE_DB/doc1/attachment6?rev=$REV -H \"Content-Type: $ATTACHMENT_MIME_TYPE\" -d @$ATTACHMENT_FILE | jq .rev | tr -d '\"'`\r\nREV=`curl -X PUT $SOURCE_DB/doc1/attachment7?rev=$REV -H \"Content-Type: $ATTACHMENT_MIME_TYPE\" -d @$ATTACHMENT_FILE | jq .rev | tr -d '\"'`\r\n\r\nREV=`curl -X PUT $SOURCE_DB/doc2 -H \"Content-Type: application/json\" -d {} | jq .rev | tr -d '\"'`\r\nREV=`curl -X PUT $SOURCE_DB/doc2/attachment1?rev=$REV -H \"Content-Type: $ATTACHMENT_MIME_TYPE\" -d @$ATTACHMENT_FILE | jq .rev | tr -d '\"'`\r\n\r\ncurl -X PUT $REPLICATOR_DB\r\nREPLICATOR_DOCID=fb110773_`date +%Y%m%d_%H%M%S`\r\ncurl -X PUT $REPLICATOR_DB/$REPLICATOR_DOCID -H \"Content-Type: application/json\" -d \"\r\n{\r\n  \\\"source\\\": \\\"$SOURCE_DB\\\",\r\n  \\\"target\\\": \\\"$TARGET_DB\\\"\r\n}\"\r\n\r\nsleep 30\r\n\r\ncurl -s $TARGET_DB/_all_docs\r\ncurl -s $REPLICATOR_DB/$REPLICATOR_DOCID?include_docs=true | jq .\r\n```\r\n\r\nWhen you run that sequence of commands the document doc2, whose attachment size is no more than 10 MB, is replicated to the target database. But the document doc1 is not replicated to the target database, and that must be because the sum of the size of its attachments exceeds the effective value of httpd/max_http_request_size. \r\nWhat is problematic is that it fails silently to replicate:\r\n1) The \"_replication_state\" of the _replicator document is not an error state.\r\n2) There is no indication of which documents failed to replicate or why.\r\n\r\nHere is what the _replicator document eventually became (except that I have replaced my Cloudant account name with <account_redacted> and replaced my password with <password_redacted>):\r\n```\r\n$ curl -s $REPLICATOR_DB/$REPLICATOR_DOCID?include_docs=true | jq .\r\n{\r\n  \"_id\": \"fb110773_20190326_162606\",\r\n  \"_rev\": \"3-ddc5d2e3602ee8f001c4c4fd578ef8dc\",\r\n  \"source\": \"https://<account_redacted>:<password_redacted>d@<account_redacted>.cloudant.com/fb110773_source\",\r\n  \"target\": \"https://<account_redacted>:<password_redacted>d@<account_redacted>.cloudant.com/fb110773_target\",\r\n  \"owner\": \"<account_redacted>\",\r\n  \"_replication_state\": \"completed\",\r\n  \"_replication_state_time\": \"2019-03-26T16:26:10Z\",\r\n  \"_replication_id\": \"5c41510d28d26e691e1466c6e2eb0708\",\r\n  \"_replication_stats\": {\r\n    \"revisions_checked\": 2,\r\n    \"missing_revisions_found\": 2,\r\n    \"docs_read\": 2,\r\n    \"docs_written\": 1,\r\n    \"changes_pending\": null,\r\n    \"doc_write_failures\": 1,\r\n    \"checkpointed_source_seq\": \"10-g1AAAAGBeJyNj88OgjAMhxsgUR_E48jGnygneZV2nUEyRkLgrG-mb4ZjnuQClzZN-vu-1gJA0sQMZybdD6ZmUnlKndBaMFohs1TbfmJ0Y-rMaP16hEC3eZ5bhP9gpjaCVPtKzyXbxBh1fjpQWSjCfC9ndeplw-gSX-Hlm5e-FysEa6VLQypjOE2Ozf3hDK_IxS7y50cO_xwDWecor7Lay2q__UZ2kQ\",\r\n    \"start_time\": \"2019-03-26T16:26:06Z\"\r\n  }\r\n}\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476707751/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476740442","html_url":"https://github.com/apache/couchdb/pull/1718#issuecomment-476740442","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1718","id":476740442,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Njc0MDQ0Mg==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-26T16:46:14Z","updated_at":"2019-03-26T16:46:14Z","author_association":"CONTRIBUTOR","body":"+1 again","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/476740442/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477257398","html_url":"https://github.com/apache/couchdb/issues/1989#issuecomment-477257398","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1989","id":477257398,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NzI1NzM5OA==","user":{"login":"popojargo","id":9197078,"node_id":"MDQ6VXNlcjkxOTcwNzg=","avatar_url":"https://avatars.githubusercontent.com/u/9197078?v=4","gravatar_id":"","url":"https://api.github.com/users/popojargo","html_url":"https://github.com/popojargo","followers_url":"https://api.github.com/users/popojargo/followers","following_url":"https://api.github.com/users/popojargo/following{/other_user}","gists_url":"https://api.github.com/users/popojargo/gists{/gist_id}","starred_url":"https://api.github.com/users/popojargo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/popojargo/subscriptions","organizations_url":"https://api.github.com/users/popojargo/orgs","repos_url":"https://api.github.com/users/popojargo/repos","events_url":"https://api.github.com/users/popojargo/events{/privacy}","received_events_url":"https://api.github.com/users/popojargo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-27T17:05:28Z","updated_at":"2019-03-27T17:05:39Z","author_association":"MEMBER","body":"I've figured out how to keep the files after uninstalling but I don't know how to apply it to the current setup. We generate the files components using Heat. So each file has  GUID and I can't find how to modify them using Wix files without using XML transformations when generating files.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477257398/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477558449","html_url":"https://github.com/apache/couchdb/pull/1983#issuecomment-477558449","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1983","id":477558449,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NzU1ODQ0OQ==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-28T11:35:02Z","updated_at":"2019-03-28T11:35:02Z","author_association":"MEMBER","body":"@davisp I've made the requested change, sorry it took so long, travis hung on the update for some reason.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477558449/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477743692","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-477743692","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":477743692,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Nzc0MzY5Mg==","user":{"login":"tabeth","id":5572859,"node_id":"MDQ6VXNlcjU1NzI4NTk=","avatar_url":"https://avatars.githubusercontent.com/u/5572859?v=4","gravatar_id":"","url":"https://api.github.com/users/tabeth","html_url":"https://github.com/tabeth","followers_url":"https://api.github.com/users/tabeth/followers","following_url":"https://api.github.com/users/tabeth/following{/other_user}","gists_url":"https://api.github.com/users/tabeth/gists{/gist_id}","starred_url":"https://api.github.com/users/tabeth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tabeth/subscriptions","organizations_url":"https://api.github.com/users/tabeth/orgs","repos_url":"https://api.github.com/users/tabeth/repos","events_url":"https://api.github.com/users/tabeth/events{/privacy}","received_events_url":"https://api.github.com/users/tabeth/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-28T19:43:53Z","updated_at":"2019-03-28T19:52:08Z","author_association":"NONE","body":"Great discussion above, but I'd like to add one thing.\r\n\r\nIt isn't possible to manually revoke a stateless token, but it may be desirable to maintain a bit of state in an internal CouchDB document that will allow for @realulim 's request to be possible. \r\n\r\nImagine a `_BLACKLIST` document, which would be initially empty. Deleting a a `_session` would add the associated token in `_BLACKLIST`. With this, a request that requires authentication would simply check `_BLACKLIST` before proceeding (and of course return a 401 with a message to re-authenticate if blacklisted). What I'm proposing isn't really new and is effectively re-creating a session token, but in the context of CouchDB, this may be acceptable since CouchDB itself is stateful, and so adding a bit more state may be permissible. \r\n\r\nSince CouchDB already maintains jobs for replication, a similar set of jobs could be maintained to delete expired tokens from the `_BLACKLIST`. \r\n\r\nSo all that would need to be done on the CouchDB side is just to look at this `_BLACKLIST` document before assuming a user is authenticated. This functionality could be turned off by default to preserve backwards compatibility. \r\n\r\nI'd love to hear your thoughts @wohali @janl .\r\n\r\nTLDR: A backwards compatible approach could be to add an internal document that's referenced when authenticated requests are received, before a response is sent. The nonexistence of a database (for older versions) would result in the same behavior as today. Deleting a session would simply add document to this database. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477743692/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477811388","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-477811388","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":477811388,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NzgxMTM4OA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-28T23:45:41Z","updated_at":"2019-03-28T23:45:41Z","author_association":"MEMBER","body":"The simplest way to implement a /_logout_all_sessions endpoint is as follows;\r\n\r\n1) require the username and password in the request body (the request must prove knowledge of these values to proceed)\r\n2) if user:pass is correct, generate a new random salt value and save updated password_sha, salt (or derived_key, salt if using pbkdf2)\r\n\r\nAll already issued session cookies are invalid, as the user salt is incorporated into them all. This is done so that a password change invalidates all session cookies, but it would be simple to reuse this mechanism for a forced logout feature.\r\n\r\n@wohali @janl ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477811388/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477811492","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-477811492","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":477811492,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NzgxMTQ5Mg==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-28T23:46:14Z","updated_at":"2019-03-28T23:46:14Z","author_association":"MEMBER","body":"(we need user password in the request body in order to generate the new password_sha or derived_key, in case that wasn't obvious).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477811492/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477825276","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-477825276","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":477825276,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NzgyNTI3Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T01:00:33Z","updated_at":"2019-03-29T01:00:33Z","author_association":"MEMBER","body":"@rnewson that's a more intelligent way of doing it, yes. And it doesn't require adding new server-side storage to achieve it.\r\n\r\nPR welcome :heart: ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477825276/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477826916","html_url":"https://github.com/apache/couchdb/pull/1734#issuecomment-477826916","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1734","id":477826916,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NzgyNjkxNg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T01:09:43Z","updated_at":"2019-03-29T01:09:43Z","author_association":"MEMBER","body":"@brianewilkins please do not hijack this PR with a bug report unless you are specifically reporting a problem **with this PR**.\r\n\r\nNew bug reports can be filed at https://github.com/apache/couchdb/issues if desired, however this appears to be a Cloudant bug - have you reported it to IBM Support instead?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477826916/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477832461","html_url":"https://github.com/apache/couchdb/issues/1992#issuecomment-477832461","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1992","id":477832461,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NzgzMjQ2MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T01:39:36Z","updated_at":"2019-03-29T01:39:36Z","author_association":"MEMBER","body":"We need more logfiles from CouchDB to know what happened here. It's entirely possible that you overloaded what your container is capable of providing.\r\n\r\nHave you considered reading from the interface fast, then doing a bulk doc operation regularly instead? https://docs.couchdb.org/en/stable/api/database/bulk-api.html#db-bulk-docs","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477832461/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477841750","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-477841750","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":477841750,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Nzg0MTc1MA==","user":{"login":"tabeth","id":5572859,"node_id":"MDQ6VXNlcjU1NzI4NTk=","avatar_url":"https://avatars.githubusercontent.com/u/5572859?v=4","gravatar_id":"","url":"https://api.github.com/users/tabeth","html_url":"https://github.com/tabeth","followers_url":"https://api.github.com/users/tabeth/followers","following_url":"https://api.github.com/users/tabeth/following{/other_user}","gists_url":"https://api.github.com/users/tabeth/gists{/gist_id}","starred_url":"https://api.github.com/users/tabeth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tabeth/subscriptions","organizations_url":"https://api.github.com/users/tabeth/orgs","repos_url":"https://api.github.com/users/tabeth/repos","events_url":"https://api.github.com/users/tabeth/events{/privacy}","received_events_url":"https://api.github.com/users/tabeth/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T02:27:44Z","updated_at":"2019-03-29T02:35:15Z","author_association":"NONE","body":"@rnewson \r\n@wohali \r\n\r\nI think the issue with that approach is that wouldn't be useful for the main use-case when there's been a breach, e.g. a stolen cookie. The administrator, you, potentially wouldn't know (or shouldn't know) the user's password so you would have no way of invalidating a user's token on behalf of the user. \r\n\r\nAfter looking at `couch_httpd_auth.erl` I do see that the approach I suggested earlier would be quite a refactor, since you'd basically need to add that check I referred to earlier everywhere a session token could be input for authentication. \r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477841750/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477900897","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-477900897","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":477900897,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3NzkwMDg5Nw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T07:43:42Z","updated_at":"2019-03-29T07:43:42Z","author_association":"MEMBER","body":"In the event of a breach the remedy is to change the password, which also invalidates all previous session cookies. An administrator can change a password without knowing its current value, using their own credentials.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477900897/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477968770","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-477968770","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":477968770,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Nzk2ODc3MA==","user":{"login":"tabeth","id":5572859,"node_id":"MDQ6VXNlcjU1NzI4NTk=","avatar_url":"https://avatars.githubusercontent.com/u/5572859?v=4","gravatar_id":"","url":"https://api.github.com/users/tabeth","html_url":"https://github.com/tabeth","followers_url":"https://api.github.com/users/tabeth/followers","following_url":"https://api.github.com/users/tabeth/following{/other_user}","gists_url":"https://api.github.com/users/tabeth/gists{/gist_id}","starred_url":"https://api.github.com/users/tabeth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tabeth/subscriptions","organizations_url":"https://api.github.com/users/tabeth/orgs","repos_url":"https://api.github.com/users/tabeth/repos","events_url":"https://api.github.com/users/tabeth/events{/privacy}","received_events_url":"https://api.github.com/users/tabeth/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T11:44:18Z","updated_at":"2019-03-29T11:50:16Z","author_association":"NONE","body":"That would work if you happened to know the user associated with the leaked token(s). My understanding of the HMAC used is that it can't be decrypted. @wohali , is it possible to derive the user from their session token and the `couch_httpd_auth` secret? \r\n\r\nIf that's the case then I think your solution (@rnewson) would be the easiest to implement. I'd also be willing to attempt adding said endpoint (I've been lurking for a while, meaning to contribute more).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477968770/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477976782","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-477976782","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":477976782,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Nzk3Njc4Mg==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T12:15:44Z","updated_at":"2019-03-29T12:15:44Z","author_association":"MEMBER","body":"the username and timestamp are in plaintext (base64 encoded) in the session cookie (as couchdb needs to retrieve both items), the HMAC is irreversible but you don't need to. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477976782/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477977590","html_url":"https://github.com/apache/couchdb/issues/1994#issuecomment-477977590","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1994","id":477977590,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Nzk3NzU5MA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T12:18:47Z","updated_at":"2019-03-29T12:18:47Z","author_association":"MEMBER","body":"Reducing revs_limit causes replication issues, yes. If a common ancestor of an update cannot be found then a new branch is created (this is another way of saying a conflict is created), so we don't recommend changing revs limit at all.\n\nYou didn't mention how frequently you are compacting the databases and the views. compaction is the only operation that recovers disk space.\n\n-- \n Robert Samuel Newson\n rnewson@apache.org\n\n\nOn Fri, 29 Mar 2019, at 09:27, Dilushan wrote:\n\n> We have a project that involved with a database sync with pouchdb in mobile devices. We have faced issue when updating multiple documents (8400 docs per minute), internal storage increasing (around 20MB per minute) frequency.\n>  We figured one main reason for that couchdb revisions. So we decided to decrease database rev_limit to around 5. But we heard it may impact replication process between couchdb and pouchdb. My first question is\n>  how this decrease of revision limit impact to the replication process?.\n>  And figured out views taking more space than normal document storage. My second question, is there any way to reduce couchdb view size?\n\n> —\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub <https://github.com/apache/couchdb/issues/1994>, or mute the thread <https://github.com/notifications/unsubscribe-auth/AAC4dyin1UrU32OXKPT4CauAns4QO1iiks5vbdx0gaJpZM4cR-ZC>.\n\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477977590/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477984914","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-477984914","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":477984914,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Nzk4NDkxNA==","user":{"login":"tabeth","id":5572859,"node_id":"MDQ6VXNlcjU1NzI4NTk=","avatar_url":"https://avatars.githubusercontent.com/u/5572859?v=4","gravatar_id":"","url":"https://api.github.com/users/tabeth","html_url":"https://github.com/tabeth","followers_url":"https://api.github.com/users/tabeth/followers","following_url":"https://api.github.com/users/tabeth/following{/other_user}","gists_url":"https://api.github.com/users/tabeth/gists{/gist_id}","starred_url":"https://api.github.com/users/tabeth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tabeth/subscriptions","organizations_url":"https://api.github.com/users/tabeth/orgs","repos_url":"https://api.github.com/users/tabeth/repos","events_url":"https://api.github.com/users/tabeth/events{/privacy}","received_events_url":"https://api.github.com/users/tabeth/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T12:46:23Z","updated_at":"2019-03-29T12:46:23Z","author_association":"NONE","body":"OK, just to put everything together @rnewson \r\n\r\nYou're saying:\r\n\r\nIf we `POST` for a new session token:\r\n```\r\nPOST /_session HTTP/1.1\r\nAccept: application/json\r\nContent-Length: 24\r\nContent-Type: application/x-www-form-urlencoded\r\nHost: localhost:5984\r\n\r\nname=root&password=relax\r\n```\r\n\r\nWe'll get a response, containing the session token:\r\n```\r\nHTTP/1.1 200 OK\r\nCache-Control: must-revalidate\r\nContent-Length: 43\r\nContent-Type: application/json\r\nDate: Mon, 03 Dec 2012 01:23:14 GMT\r\nServer: CouchDB (Erlang/OTP)\r\nSet-Cookie: AuthSession=cm9vdDo1MEJCRkYwMjq0LO0ylOIwShrgt8y-UkhI-c6BGw; Version=1; Path=/; HttpOnly\r\n\r\n{\"ok\":true,\"name\":\"root\",\"roles\":[\"_admin\"]}\r\n```\r\n\r\nAnd so, if this AuthSession token, `cm9vdDo1MEJCRkYwMjq0LO0ylOIwShrgt8y-UkhI-c6BGw`, were to ever be compromised (let's just say it's accidentally sent in an email). Your solution would be to reset the user's password manually. \r\n\r\nWe don't know who the user is, but you've stated that we can get the username from the `AuthSession` token by base64 decoding it. When we do this, we decode the previous `AuthSession` token to:\r\n\r\n```\r\nroot:520550C1:柪귒ㄥ^B【茗#\r\n```\r\n\r\nAnd there it is, `root`  is colon separated from some random gibberish, likely related to the secret. Now that we know who the user is, we then would look-up their user in `_users` and reset their password using the method you described above. \r\n\r\nIs that right?\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477984914/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477989456","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-477989456","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":477989456,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3Nzk4OTQ1Ng==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T13:02:32Z","updated_at":"2019-03-29T13:02:32Z","author_association":"MEMBER","body":"that's right. Note also that the cookie will expire if not used, so compromise via email is not super plausible. You don't need to decode the cookie to figure this out, do a GET /_session with the cookie and couchdb will tell you the username (and roles) if the cookie is still valid.\r\n\r\nOther things to consider;\r\n\r\n1. include the client ip in the hmac (but not in the cookie). When verifying, we know the client ip of that request and can include it in the hmac (much like we don't expose the salt value in the cookie).\r\n2. revisit the auto-extension of session cookies. This is a very old decision and there's concern about what might break, but I think it's worth considering. It doesn't feel right for a session cookie to extend indefinitely, even if that is convenient. Cloudant has recently integrated with a different auth system and those tokens do not auto-extend (and they last only one hour). \r\n\r\n* the cookie is base64(username:timestamp:hmac) ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/477989456/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478015230","html_url":"https://github.com/apache/couchdb/issues/1996#issuecomment-478015230","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1996","id":478015230,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODAxNTIzMA==","user":{"login":"irishmark","id":419812,"node_id":"MDQ6VXNlcjQxOTgxMg==","avatar_url":"https://avatars.githubusercontent.com/u/419812?v=4","gravatar_id":"","url":"https://api.github.com/users/irishmark","html_url":"https://github.com/irishmark","followers_url":"https://api.github.com/users/irishmark/followers","following_url":"https://api.github.com/users/irishmark/following{/other_user}","gists_url":"https://api.github.com/users/irishmark/gists{/gist_id}","starred_url":"https://api.github.com/users/irishmark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/irishmark/subscriptions","organizations_url":"https://api.github.com/users/irishmark/orgs","repos_url":"https://api.github.com/users/irishmark/repos","events_url":"https://api.github.com/users/irishmark/events{/privacy}","received_events_url":"https://api.github.com/users/irishmark/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T14:21:20Z","updated_at":"2019-03-29T14:21:20Z","author_association":"NONE","body":"Closing this cos it turned out that some of the docs do exist and are editable, I just had a load of missing ones in my DB","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478015230/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478040489","html_url":"https://github.com/apache/couchdb/issues/1987#issuecomment-478040489","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1987","id":478040489,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODA0MDQ4OQ==","user":{"login":"irishmark","id":419812,"node_id":"MDQ6VXNlcjQxOTgxMg==","avatar_url":"https://avatars.githubusercontent.com/u/419812?v=4","gravatar_id":"","url":"https://api.github.com/users/irishmark","html_url":"https://github.com/irishmark","followers_url":"https://api.github.com/users/irishmark/followers","following_url":"https://api.github.com/users/irishmark/following{/other_user}","gists_url":"https://api.github.com/users/irishmark/gists{/gist_id}","starred_url":"https://api.github.com/users/irishmark/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/irishmark/subscriptions","organizations_url":"https://api.github.com/users/irishmark/orgs","repos_url":"https://api.github.com/users/irishmark/repos","events_url":"https://api.github.com/users/irishmark/events{/privacy}","received_events_url":"https://api.github.com/users/irishmark/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T15:28:18Z","updated_at":"2019-03-29T15:28:18Z","author_association":"NONE","body":"It looks like the answer to this might be to perform a search and replace on the _local shard-sync documents on all the nodes when starting a new cluster on new hostnames. Setting the server UUID on the servers didn't seem to help much as far as I could see","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478040489/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478075057","html_url":"https://github.com/apache/couchdb/issues/1994#issuecomment-478075057","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1994","id":478075057,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODA3NTA1Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T17:03:27Z","updated_at":"2019-03-29T17:03:27Z","author_association":"MEMBER","body":"@dilushan\r\n\r\nThis is not a CouchDB bug. GitHub is for actual CouchDB bugs only.\r\n\r\nIf you are looking for general support with using CouchDB, please try one of these other options:\r\n\r\n* The user mailing list. Signup instructions are [here](http://couchdb.apache.org/#mailing-lists)\r\n* The Slack/IRC chat room. Joining instructions are [here](http://couchdb.apache.org/#chat)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478075057/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478075620","html_url":"https://github.com/apache/couchdb/issues/1995#issuecomment-478075620","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1995","id":478075620,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODA3NTYyMA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T17:05:08Z","updated_at":"2019-03-29T17:05:08Z","author_association":"MEMBER","body":"@tudordumitriu The easiest is to change the password in the `_users` database. This will lock that user out until the password is changed again.\r\n\r\nIf that is unacceptable, a disabled flag is an enhancement request.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478075620/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478076285","html_url":"https://github.com/apache/couchdb/pull/1972#issuecomment-478076285","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1972","id":478076285,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODA3NjI4NQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T17:07:05Z","updated_at":"2019-03-29T17:07:05Z","author_association":"MEMBER","body":"@nickva have you seen #1987 and #1996 ?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478076285/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478079089","html_url":"https://github.com/apache/couchdb/issues/1996#issuecomment-478079089","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1996","id":478079089,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODA3OTA4OQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T17:15:21Z","updated_at":"2019-03-29T17:15:21Z","author_association":"CONTRIBUTOR","body":"shard-sync documents are used by the internal replicator to sync shard content between shard copies they are not written at the cluster level so don't follow the cluster document hashing rules where the document id is hashed and sent to a particular shard range based on that. That explains why when you make request you might see different subsets of them depending on which shard copies respond to your requests.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478079089/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478082541","html_url":"https://github.com/apache/couchdb/issues/1996#issuecomment-478082541","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1996","id":478082541,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODA4MjU0MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T17:25:40Z","updated_at":"2019-03-29T17:25:40Z","author_association":"MEMBER","body":"@nickva the trick is that I think if someone re-names or replaces a node during a shard split/sync, there needs to at least be some sort of doc that explains how to clean-up after the fact.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478082541/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478104630","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-478104630","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":478104630,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODEwNDYzMA==","user":{"login":"tabeth","id":5572859,"node_id":"MDQ6VXNlcjU1NzI4NTk=","avatar_url":"https://avatars.githubusercontent.com/u/5572859?v=4","gravatar_id":"","url":"https://api.github.com/users/tabeth","html_url":"https://github.com/tabeth","followers_url":"https://api.github.com/users/tabeth/followers","following_url":"https://api.github.com/users/tabeth/following{/other_user}","gists_url":"https://api.github.com/users/tabeth/gists{/gist_id}","starred_url":"https://api.github.com/users/tabeth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tabeth/subscriptions","organizations_url":"https://api.github.com/users/tabeth/orgs","repos_url":"https://api.github.com/users/tabeth/repos","events_url":"https://api.github.com/users/tabeth/events{/privacy}","received_events_url":"https://api.github.com/users/tabeth/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T18:32:38Z","updated_at":"2019-03-29T19:22:24Z","author_association":"NONE","body":"@rnewson A few things on this, after doing some experimentation:\r\n\r\n- Regarding recalculating the `salt` and expiring all previous sessions, the way to currently do this without having to modify any code would be to call `_users` and modify the password. By modifying the password, including modifying it with the same password, `salt` will be recalculated and therefore all previous sessions will become invalid. This has been tested using CouchDB 2.3 \r\n\r\nThis obviously leads to a bigger question of how a logout would be realistically implemented. Based on what was just stated, you would `logout` by having the user confirm their password. This could be done by making a GET request `_session` and making sure you get `{\"ok\": true}` (to prevent users from logging out without the correct password). \r\n\r\nThe only question that remains is whether we'd want to support a logout scheme without the user putting in their password. I'm not a fan of this solution, but we could support logout by looking for a `log_out: true` key value pair in the `user` document, which could then be picked up in `couch_users_db.erl` to re-calculate the `salt`, and `derived` key. \r\n\r\n\r\n```erlang\r\nsave_doc(#doc{body={Body}} = Doc) ->\r\n    %% Support both schemes to smooth migration from legacy scheme\r\n    Scheme = config:get(\"couch_httpd_auth\", \"password_scheme\", \"pbkdf2\"),\r\n    case {couch_util:get_value(?PASSWORD, Body), Scheme} of\r\n    {null, _} -> % server admins don't have a user-db password entry\r\n        Doc;\r\n    {undefined, _} ->\r\n        case {couch_util:get_value(?LOGOUT, Body)} of\r\n          {true} -> % Logout\r\n              Iterations = list_to_integer(config:get(\"couch_httpd_auth\", \"iterations\", \"1000\")),\r\n              Salt = couch_uuids:random()\r\n              DerivedKey = couch_passwords:pbkdf2(\"\", Salt, Iterations),\r\n              Body0 = ?replace(Body, ?SALT, Salt),\r\n              Body1 = ?replace(Body, ?DERIVED_KEY, DerivedKey)\r\n              Doc#doc{body={Body1}};\r\n         {_} ->\r\n             Doc;\r\n         end.\r\n```\r\n---\r\n\r\n\r\nThanks for the tip on the cookie format! I think revisiting the auto-extension of cookies is good, but would be a pretty major change, no? I imagine it would involve effectively saying that a valid `AuthSession` and a `username` and `password` pair are no longer equivalent like they are now. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478104630/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478105351","html_url":"https://github.com/apache/couchdb/pull/1972#issuecomment-478105351","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1972","id":478105351,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODEwNTM1MQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T18:34:43Z","updated_at":"2019-03-29T18:34:43Z","author_association":"CONTRIBUTOR","body":"@wohali I think you referenced the bit where we copy and modify _local checkpoint docs to make replications not rewind. We have that functionality in the PR and could probably surface it somehow at the API level. But would need a separate PR or RFC for it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478105351/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478143414","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-478143414","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":478143414,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODE0MzQxNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T20:43:35Z","updated_at":"2019-03-29T20:43:35Z","author_association":"MEMBER","body":"We'd still need the old password to logout, and we don't store that plaintext, so I don't see how a logout scheme without the user entering it can work.\r\n\r\nYes, we can't easily revisit how the cookie problem will be improved without making backward-incompatible changes. There was some traffic about this on the dev@couchdb.apache.org mailing list and it was decided not to make any changes until at least 3.0, if not later.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478143414/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478144025","html_url":"https://github.com/apache/couchdb/pull/1972#issuecomment-478144025","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1972","id":478144025,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODE0NDAyNQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T20:45:29Z","updated_at":"2019-03-29T20:45:29Z","author_association":"MEMBER","body":"@nickva Well, yes, and the problem of shard syncing or resharding getting confused when nodes hosting shards change (along with the _dbs document). What happens then? If we've changed the starting conditions, how does the scheduling service react? Sorry to stick this here but I only just thought of it.\r\n\r\nSeparate PR is fine without an RFC I think for an enhancement like this since we're talking about, really, essential functionality.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478144025/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478171585","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-478171585","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":478171585,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODE3MTU4NQ==","user":{"login":"tabeth","id":5572859,"node_id":"MDQ6VXNlcjU1NzI4NTk=","avatar_url":"https://avatars.githubusercontent.com/u/5572859?v=4","gravatar_id":"","url":"https://api.github.com/users/tabeth","html_url":"https://github.com/tabeth","followers_url":"https://api.github.com/users/tabeth/followers","following_url":"https://api.github.com/users/tabeth/following{/other_user}","gists_url":"https://api.github.com/users/tabeth/gists{/gist_id}","starred_url":"https://api.github.com/users/tabeth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tabeth/subscriptions","organizations_url":"https://api.github.com/users/tabeth/orgs","repos_url":"https://api.github.com/users/tabeth/repos","events_url":"https://api.github.com/users/tabeth/events{/privacy}","received_events_url":"https://api.github.com/users/tabeth/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-29T22:46:08Z","updated_at":"2019-03-29T22:48:21Z","author_association":"NONE","body":"@wohali\r\n\r\nYeah, right now you would need a password to logout. However if something similar to what I showed earlier were implemented a user with a valid session cookie would be able to modify their own user document with a logout or equivalent flag which could then change the derived key and salt, invalidating all sessions.\r\n\r\nThen, upon logging in via _session they would receive a new, valid session token. I've tried the first part in Futon, but I'll need to make sure both that and the latter part I'm describing here works via just the API.\r\n\r\nDepending on how far 3.0 is in terms of time line, it could be worth incorporating in the interim. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478171585/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478267862","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-478267862","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":478267862,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODI2Nzg2Mg==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-30T17:23:59Z","updated_at":"2019-03-30T17:23:59Z","author_association":"MEMBER","body":"@tabeth Wohali has already explained that we cannot change the derived key without the password, and we don't store the password, so the user would have to supply it to log out. Your scheme above will not work.\r\n\r\nWe document this at https://docs.couchdb.org/en/2.2.0/intro/security.html but I'd like to describe it here for clarity.\r\n\r\nIt's essential that this point is understood by everyone in the thread as it defines what can and cannot be done as a solution.\r\n\r\nWhen a user is created;\r\n\r\n1. the plaintext password is sent to couchdb.\r\n2. couchdb generates a large random value which we call salt.\r\n3. we calculate sha1(password + salt) or pbkdf2(password, salt, iterations)\r\n4. this value is stored to the users doc, the plaintext password value is discarded.\r\n\r\nGiven the same inputs (password + salt) we can calculate the same output as step 3 and then compare it against what is stored. We cannot feasibly retrieve the password from what we store in the users doc.\r\n\r\nYou could, in an emergency, change the salt value of the _users doc to some new random value. This will invalidate all previous session cookies but obviously the user could then not acquire a new one as they wouldn't know the new password (and that value could not feasibly be calculated).\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478267862/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478268636","html_url":"https://github.com/apache/couchdb/issues/1987#issuecomment-478268636","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1987","id":478268636,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODI2ODYzNg==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-30T17:30:06Z","updated_at":"2019-03-30T17:30:06Z","author_association":"MEMBER","body":"All nodes in the blue cluster should have the same UUID, All nodes in the green cluster should have the same UUID, but the blue UUID should not be the same as the green UUID.\n\nThe ordering of documents in each cluster will not be the same, so you absolutely cannot make the same 'seq' value mean the same thing for both clusters.\n\nSo, yes, you are doing something crazy. \n\n-- \n Robert Samuel Newson\n rnewson@apache.org\n\n\nOn Fri, 29 Mar 2019, at 15:39, irishmark wrote:\n> It looks like the answer to this might be to perform a search and replace on the _local shard-sync documents on all the nodes when starting a new cluster on new hostnames. Setting the server UUID on the servers didn't seem to help much as far as I could see\n\n> —\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub <https://github.com/apache/couchdb/issues/1987#issuecomment-478040489>, or mute the thread <https://github.com/notifications/unsubscribe-auth/AAC4d8u6-1NCvBmfc50FZwkgkSS84v7Aks5vbjESgaJpZM4cDn90>.\n\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478268636/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478287126","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-478287126","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":478287126,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODI4NzEyNg==","user":{"login":"realulim","id":17084846,"node_id":"MDQ6VXNlcjE3MDg0ODQ2","avatar_url":"https://avatars.githubusercontent.com/u/17084846?v=4","gravatar_id":"","url":"https://api.github.com/users/realulim","html_url":"https://github.com/realulim","followers_url":"https://api.github.com/users/realulim/followers","following_url":"https://api.github.com/users/realulim/following{/other_user}","gists_url":"https://api.github.com/users/realulim/gists{/gist_id}","starred_url":"https://api.github.com/users/realulim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/realulim/subscriptions","organizations_url":"https://api.github.com/users/realulim/orgs","repos_url":"https://api.github.com/users/realulim/repos","events_url":"https://api.github.com/users/realulim/events{/privacy}","received_events_url":"https://api.github.com/users/realulim/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-30T20:32:59Z","updated_at":"2019-03-30T20:32:59Z","author_association":"NONE","body":"I've detailed a possible approach in my posting on October 10th, 2017. There may be holes in my scheme, so I'd welcome any comments. My idea involves keeping state on the server, but only per user, not per session. Also, eventual consistency suffices, so I see no issues with scalability and distribution and no changes to existing APIs are needed. Also I believe that the \"invalidate\" request does not need the user's password for authentication, it would be enough to use a valid stateless token. Sure, a hacker could \"invalidate\" with a stolen token, but he would actually be doing the user a favor, because he locks himself out that way.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478287126/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478294927","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-478294927","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":478294927,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODI5NDkyNw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-30T22:31:16Z","updated_at":"2019-03-30T22:31:16Z","author_association":"MEMBER","body":"Ah, thank you, I was referring to more recent messages in this thread. The scheme near the top could work though I don't think we want to use wall clock time. Instead, we could store an epoch value in the _users doc, initialised to 0. When the logout endpoint is called, we'd increment that epoch. The epoch value would be included in the session cookie value (and covered by the HMAC). CouchDB would check that the epoch value in the cookie matches the current value in the _users doc.\r\n\r\nEven more succinctly, we would separate the dual functionality of the 'salt' value into two distinct fields. We'd include the epoch _instead_ of the salt value, and a password change would also increment the epoch value.\r\n\r\nIt doesn't have to be an incrementing integer, it could be a random string, it would depend on whether we wanted to record 'current epoch' and 'last logged out epoch' as you suggest earlier, and allow all cookies with an epoch greater than 'last logged out epoch' to work. I don't immediately see a reason to allow that.\r\n\r\nOne thing to note is that is still a per-user log out, and not a per-session log out. But the change I describe in this ticket is equivalent to the current semantics.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478294927/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478295024","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-478295024","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":478295024,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODI5NTAyNA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-30T22:32:39Z","updated_at":"2019-03-30T22:32:39Z","author_association":"MEMBER","body":"by \" is still a per-user log out, and not a per-session log out\" I mean that we could not bump the epoch for a call to DELETE /_session as this would invalidate _other_ sessions. We'd need a new endpoint that made the scope of the action clear, /_end_all_sessions or some such.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478295024/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478295722","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-478295722","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":478295722,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODI5NTcyMg==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-30T22:41:19Z","updated_at":"2019-03-30T22:41:19Z","author_association":"MEMBER","body":"thinking again, we wouldn't need to include the epoch in the cookie value, just in the HMAC, as long as we only cared for it not matching the stored epoch value in the _users doc. If we want to do the range thing (again, not sure we do), we'd need it in the cookie.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478295722/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478295894","html_url":"https://github.com/apache/couchdb/issues/1995#issuecomment-478295894","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1995","id":478295894,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODI5NTg5NA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-30T22:44:19Z","updated_at":"2019-03-30T22:44:19Z","author_association":"MEMBER","body":"Maybe a similar trick to how unix/linux accounts are disabled? Add a character to the front of password_sha (or derived_key) that cannot appear in any possible output of the hashing process. I think we convert to hex, so there are plenty of options, but `!` would do it. Re-enable by removing it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478295894/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478299043","html_url":"https://github.com/apache/couchdb/pull/1972#issuecomment-478299043","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1972","id":478299043,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODI5OTA0Mw==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-30T23:46:00Z","updated_at":"2019-03-30T23:46:00Z","author_association":"MEMBER","body":"@wohali Definitely a good idea to add some tests around missing hosts and so on. We'd obviously want those to fail properly and not cause issues. However the actual work is all local to a node so we don't have any doomsday situations where we're writing bytes that disappear into the ether if a node has been renamed. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478299043/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478301195","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-478301195","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":478301195,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODMwMTE5NQ==","user":{"login":"realulim","id":17084846,"node_id":"MDQ6VXNlcjE3MDg0ODQ2","avatar_url":"https://avatars.githubusercontent.com/u/17084846?v=4","gravatar_id":"","url":"https://api.github.com/users/realulim","html_url":"https://github.com/realulim","followers_url":"https://api.github.com/users/realulim/followers","following_url":"https://api.github.com/users/realulim/following{/other_user}","gists_url":"https://api.github.com/users/realulim/gists{/gist_id}","starred_url":"https://api.github.com/users/realulim/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/realulim/subscriptions","organizations_url":"https://api.github.com/users/realulim/orgs","repos_url":"https://api.github.com/users/realulim/repos","events_url":"https://api.github.com/users/realulim/events{/privacy}","received_events_url":"https://api.github.com/users/realulim/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-31T00:32:50Z","updated_at":"2019-03-31T00:32:50Z","author_association":"NONE","body":"I was assuming that the epoch value (what I called a timestamp) would be updated every time the stateless token was refreshed. That could lead to a situation where newer tokens were already given out, but one of the nodes in the distributed system would still have the old epoch value stored for the user. But you would want requests against that node to succeed with a newer stateless token.\r\n\r\nThat way the per-user epoch value could be eventually consistent in order to not affect scalability.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478301195/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478306994","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-478306994","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":478306994,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODMwNjk5NA==","user":{"login":"tabeth","id":5572859,"node_id":"MDQ6VXNlcjU1NzI4NTk=","avatar_url":"https://avatars.githubusercontent.com/u/5572859?v=4","gravatar_id":"","url":"https://api.github.com/users/tabeth","html_url":"https://github.com/tabeth","followers_url":"https://api.github.com/users/tabeth/followers","following_url":"https://api.github.com/users/tabeth/following{/other_user}","gists_url":"https://api.github.com/users/tabeth/gists{/gist_id}","starred_url":"https://api.github.com/users/tabeth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tabeth/subscriptions","organizations_url":"https://api.github.com/users/tabeth/orgs","repos_url":"https://api.github.com/users/tabeth/repos","events_url":"https://api.github.com/users/tabeth/events{/privacy}","received_events_url":"https://api.github.com/users/tabeth/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-31T02:48:42Z","updated_at":"2019-03-31T03:50:43Z","author_association":"NONE","body":"@rnewson \r\n\r\n> Wohali has already explained that we cannot change the derived key without the password\r\n\r\nReally? A couple days ago I experimented with this by creating a session and was able to modify a user's `derived_key`, or anything in their document really, with just the session token (assuming they had access, of course).\r\n\r\n> Given the same inputs (password + salt) we can calculate the same output as step 3 and then compare it against what is stored. We cannot feasibly retrieve the password from what we store in the users doc.\r\n\r\n> You could, in an emergency, change the salt value of the _users doc to some new random value. This will invalidate all previous session cookies but obviously the user could then not acquire a new one as they wouldn't know the new password (and that value could not feasibly be calculated).\r\n\r\nYeah this meshes pretty much with what I discovered. I'd have to amend my earlier idea -- that would be more like a \"deactivate and logout\" function than simply \"logout\". A user could, today, \"logout\" and invalidate all of their sessions by attaining a valid session token and just modifying their `salt` and/or `derived_key`. This would also have the effect of preventing them from logging in again, which would make it more suitable for being a sort of \"deactivate\" function. \r\n\r\n---\r\n\r\nAs far as the conversation above goes, why not do it on a per session basis? Isn't it pretty unusual in general for a client to be logged out on all clients when they log out on one? How would one implement a \"remember me\" or equivalent? \r\n\r\nSo to kind of summarize, right now we can:\r\n\r\n1. Log out of all sessions (a user can re-save their password by entering it, invalidating all sessions)\r\n2. \"Deactivate\" their account (a user can modify their salt and/or derived key, invalidating all sessions and preventing them from creating new ones)\r\n\r\nWe're still missing:\r\n1. Log out of current session (e.g. invalidate specific sessions).\r\n2. Log out of all sessions w/o password (AFAIK there's no way to do this without some changes).\r\n\r\nAt the moment I can't think of a way to do a per-session invalidation per the original scope of this issue without ultimately doing something that amounts to a blacklist.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478306994/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478308325","html_url":"https://github.com/apache/couchdb/pull/1972#issuecomment-478308325","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1972","id":478308325,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODMwODMyNQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-31T03:19:41Z","updated_at":"2019-03-31T03:19:41Z","author_association":"CONTRIBUTOR","body":"We do have a few places which react to changes in the shard map. If db is deleted we clean up the splitting job. When the shard is updated we error out if the shard we are replacing is missing https://github.com/apache/couchdb/pull/1972/files#diff-bec6521346a40b9585a85ff559b82b50R110 , if expected source shard node is not there we bail out https://github.com/apache/couchdb/pull/1972/files#diff-bec6521346a40b9585a85ff559b82b50R200 and there are others.\r\n\r\nFor cases where they are manual shard moves or other manual operations we added the API to stop resharding via the `_reshard/state` endpoint.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478308325/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478313160","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-478313160","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":478313160,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODMxMzE2MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-31T05:22:29Z","updated_at":"2019-03-31T05:22:29Z","author_association":"MEMBER","body":"Sure, you can modify the derived key, but without knowing the original (plaintext) password, you can't modify it to have the same password with a different salt. That's the point of password hash functions, they're one way :)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478313160/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478333429","html_url":"https://github.com/apache/couchdb/issues/1959#issuecomment-478333429","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1959","id":478333429,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODMzMzQyOQ==","user":{"login":"jacorall","id":10423755,"node_id":"MDQ6VXNlcjEwNDIzNzU1","avatar_url":"https://avatars.githubusercontent.com/u/10423755?v=4","gravatar_id":"","url":"https://api.github.com/users/jacorall","html_url":"https://github.com/jacorall","followers_url":"https://api.github.com/users/jacorall/followers","following_url":"https://api.github.com/users/jacorall/following{/other_user}","gists_url":"https://api.github.com/users/jacorall/gists{/gist_id}","starred_url":"https://api.github.com/users/jacorall/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jacorall/subscriptions","organizations_url":"https://api.github.com/users/jacorall/orgs","repos_url":"https://api.github.com/users/jacorall/repos","events_url":"https://api.github.com/users/jacorall/events{/privacy}","received_events_url":"https://api.github.com/users/jacorall/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-31T11:30:40Z","updated_at":"2019-03-31T11:30:40Z","author_association":"NONE","body":"I'm experiencing the same issue.  I made sure the I've set-up a strong/long admin password. \r\nThe server I've installed is just for development purposes at the moment.\r\nI've installed the CouchDB server on a blank Ubuntu server, and user the firewall to expose only port 22(SSH) and 5984 to the internet.\r\nThe user keeps showing up in the _users database.\r\nI noticed this, because I'm developimg template/boilerplate system running only CouchDB in the back-end and JavaScript in the front-end.  The only communication with the server, from my side is via the Fauxton utlility and the Javascript fetch-API.\r\nI thoucht it was a hacker, but then I decided to re-install a blank server, and the rootbakseven user appeared again.\r\nI use Ubuntu 18.10 and CouchDB 2.3.1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478333429/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478333493","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-478333493","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":478333493,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODMzMzQ5Mw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-31T11:31:40Z","updated_at":"2019-03-31T11:31:40Z","author_association":"MEMBER","body":"Agree that 'log out all sessions' is unusual, Wohali and I are simply conveying the consequences of changing the salt value in the users doc.\r\n\r\nThe only way to invalidate individual sessions would be store some state on the server for each session, which is a big change and probably unwelcome to many (though it could be optional). It raises questions for clustering and we'd obviously need something to clean up expired session state completely (so it can't be a regular document unless we're going to use _purge for something this routine). Whether we record all sessions or just the ones that have been invalidated specifically doesn't alter the scope of the change much.\r\n\r\nPerhaps a better path forward is to remove the auto-extension of session cookies. Given that session cookies already expire, through lack of use (or a password change), this is expected behaviour and is handled by the UI (by making you log in again) and the replicator (which can acquire a new cookie).\r\n\r\nTo compare, IBM Cloudant (disclaimer: I work for IBM), uses an alternate auth system that issues fixed-duration tokens that last one hour, so there's already a precedent.\r\n\r\nIt would also be important to return a 401 error when couchdb is passed an expired token rather than treating the request as one past without authentication, as anonymous writes might be allowed on the target (albeit perhaps restricted by a VDU) and this would lead to surprising behaviour for users and the replicator. That said, it would be a big improvement for the auth workflow, a 401 would ensure all tools re-acquire a cookie (by re-presenting credentials) exactly when needed.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478333493/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478341471","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-478341471","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":478341471,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODM0MTQ3MQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-31T13:22:35Z","updated_at":"2019-03-31T13:22:35Z","author_association":"MEMBER","body":"and, just to be clear, the 'log out all sessions' is scoped to the user, in case you thought I literally meant all sessions.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478341471/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478341551","html_url":"https://github.com/apache/couchdb/issues/844#issuecomment-478341551","issue_url":"https://api.github.com/repos/apache/couchdb/issues/844","id":478341551,"node_id":"MDEyOklzc3VlQ29tbWVudDQ3ODM0MTU1MQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2019-03-31T13:23:44Z","updated_at":"2019-03-31T13:23:44Z","author_association":"MEMBER","body":"I wrote some of these ideas up as code a while back so I might as well link to them here: https://github.com/apache/couchdb/compare/enhance-session-cookies?expand=1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/478341551/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]