[{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/647763685","html_url":"https://github.com/apache/iceberg/issues/519#issuecomment-647763685","issue_url":"https://api.github.com/repos/apache/iceberg/issues/519","id":647763685,"node_id":"MDEyOklzc3VlQ29tbWVudDY0Nzc2MzY4NQ==","user":{"login":"samarthjain","id":1642180,"node_id":"MDQ6VXNlcjE2NDIxODA=","avatar_url":"https://avatars.githubusercontent.com/u/1642180?v=4","gravatar_id":"","url":"https://api.github.com/users/samarthjain","html_url":"https://github.com/samarthjain","followers_url":"https://api.github.com/users/samarthjain/followers","following_url":"https://api.github.com/users/samarthjain/following{/other_user}","gists_url":"https://api.github.com/users/samarthjain/gists{/gist_id}","starred_url":"https://api.github.com/users/samarthjain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samarthjain/subscriptions","organizations_url":"https://api.github.com/users/samarthjain/orgs","repos_url":"https://api.github.com/users/samarthjain/repos","events_url":"https://api.github.com/users/samarthjain/events{/privacy}","received_events_url":"https://api.github.com/users/samarthjain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-22T20:52:32Z","updated_at":"2020-06-22T20:52:32Z","author_association":"COLLABORATOR","body":"For non dictionary encoded Strings, Iceberg vectorized reads are still slower:\r\n```\r\nVectorizedReadStringsBenchmark.readIcebergVectorized5k                 1.482\r\nVectorizedReadStringsBenchmark.readSparkVectorized5k                   1.286\r\nVectorizedReadStringsBenchmark.readSparkNonVectorized                  2.553\r\n```\r\n\r\nFor dictionary encoded Strings, Iceberg vectorized reads are faster:\r\n```\r\nVectorizedReadDictionaryStringsBenchmark.readIcebergVectorized5k       0.881 \r\nVectorizedReadStringsBenchmark.readSparkVectorized5k                   1.142\r\nVectorizedReadStringsBenchmark.readSparkNonVectorized                  2.324\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/647763685/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/647764759","html_url":"https://github.com/apache/iceberg/issues/519#issuecomment-647764759","issue_url":"https://api.github.com/repos/apache/iceberg/issues/519","id":647764759,"node_id":"MDEyOklzc3VlQ29tbWVudDY0Nzc2NDc1OQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-22T20:55:12Z","updated_at":"2020-06-22T20:55:12Z","author_association":"CONTRIBUTOR","body":"Okay, so we should leave this open for non-dictionary strings. Thanks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/647764759/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/647810858","html_url":"https://github.com/apache/iceberg/pull/1132#issuecomment-647810858","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1132","id":647810858,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NzgxMDg1OA==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-22T23:01:22Z","updated_at":"2020-06-22T23:01:22Z","author_association":"CONTRIBUTOR","body":"I think that fields with non-null defaults should have the default removed.\r\n\r\nIn Iceberg, the default value for an optional column is _always_ null. Non-null defaults are not allowed. That's why null is always the first type in the option union.\r\n\r\nAn Iceberg table schema does not have default values for columns, so it will never actually use Avro to fill in a default value. The read schemas that Iceberg passes to Avro are based on the write schema and the current table schema (for renames). The default value only comes from the write schema, so it will never be applied because the writer knew about the column and wrote values into the file. Avro defaults are only used when projecting a column that isn't in the file.\r\n\r\nBecause the default value here only comes from the write schema and will never actually be used, I think the right thing is to simply remove any default values when building the Avro projection schema.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/647810858/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/647835798","html_url":"https://github.com/apache/iceberg/pull/1126#issuecomment-647835798","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1126","id":647835798,"node_id":"MDEyOklzc3VlQ29tbWVudDY0NzgzNTc5OA==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-23T00:28:00Z","updated_at":"2020-06-23T00:28:00Z","author_association":"CONTRIBUTOR","body":"I guess the explicit resolution for jackson is still needed as iceberg-core and Spark depend on different lib versions. While we relocate it in iceberg-spark-runtime, the resolution may be needed for tests.\r\n\r\nOne point that is not clear to me is why we declare 2.10.0 in `versions.props` but force 2.10.2.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/647835798/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/647841319","html_url":"https://github.com/apache/iceberg/pull/1125#issuecomment-647841319","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1125","id":647841319,"node_id":"MDEyOklzc3VlQ29tbWVudDY0Nzg0MTMxOQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-23T00:48:56Z","updated_at":"2020-06-23T00:48:56Z","author_association":"CONTRIBUTOR","body":"Thanks! I'll give this a thorough review tomorrow.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/647841319/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/647850642","html_url":"https://github.com/apache/iceberg/pull/1127#issuecomment-647850642","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1127","id":647850642,"node_id":"MDEyOklzc3VlQ29tbWVudDY0Nzg1MDY0Mg==","user":{"login":"edgarRd","id":266670,"node_id":"MDQ6VXNlcjI2NjY3MA==","avatar_url":"https://avatars.githubusercontent.com/u/266670?v=4","gravatar_id":"","url":"https://api.github.com/users/edgarRd","html_url":"https://github.com/edgarRd","followers_url":"https://api.github.com/users/edgarRd/followers","following_url":"https://api.github.com/users/edgarRd/following{/other_user}","gists_url":"https://api.github.com/users/edgarRd/gists{/gist_id}","starred_url":"https://api.github.com/users/edgarRd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edgarRd/subscriptions","organizations_url":"https://api.github.com/users/edgarRd/orgs","repos_url":"https://api.github.com/users/edgarRd/repos","events_url":"https://api.github.com/users/edgarRd/events{/privacy}","received_events_url":"https://api.github.com/users/edgarRd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-23T01:22:19Z","updated_at":"2020-06-23T01:22:19Z","author_association":"CONTRIBUTOR","body":"@rdblue I've simplified this PR and avoided disabling date column filter pushdown as that's not really the problem.\r\n\r\nThere're actually 2 problems, which are related:\r\n1. Getting the min/max stats for Date types in [ORC are returned with milliseconds adjusted to the local timezone](https://github.com/apache/hive/blob/204d8525bf48bf85d15feb427e6f5a31ec192bac/storage-api/src/java/org/apache/hadoop/hive/serde2/io/DateWritable.java#L145). This means that timezones ahead of epoch would have less milliseconds to the date, therefore when converting to days from epoch they would be 1 day less if `EPOCH.plus` is used for the conversion as this one is UTC based.\r\n2. In ORC the timezone used for adjusting the min/max metrics milliseconds seems to be stored at the [Thread level](https://github.com/apache/hive/blob/204d8525bf48bf85d15feb427e6f5a31ec192bac/storage-api/src/java/org/apache/hadoop/hive/serde2/io/DateWritable.java#L48) and looks like  it's not reset, hence [tests switching multiple timezones fail](https://github.com/apache/iceberg/commit/e61cc6187c6a13b7913f66f548f4be9d05d2a717) since it appears that the TZ is not updated in ORC - https://github.com/apache/iceberg/issues/1116#issuecomment-645643279. \r\n\r\nThis PR is solving:\r\nhttps://github.com/apache/iceberg/pull/1127/commits/a6fc6885f4ee7f0b00b224510191e4f5a7c3a547 Problem 1 - By using the returned `Date` object from ORC and calling `toLocalDate` which performs normalization to the local timezone.\r\n\r\nI've added a comment to mention problem 2 in https://github.com/apache/iceberg/pull/1127/commits/b1fa8e6b3a636d434a46da360556fca100219ba0 and fixed some tests that changed the default TZ and did not reset it to the current default one https://github.com/apache/iceberg/pull/1127/commits/82d46d3c733914627ef89ae921788a60f2655f0a. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/647850642/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/647951691","html_url":"https://github.com/apache/iceberg/pull/1132#issuecomment-647951691","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1132","id":647951691,"node_id":"MDEyOklzc3VlQ29tbWVudDY0Nzk1MTY5MQ==","user":{"login":"shardulm94","id":6961317,"node_id":"MDQ6VXNlcjY5NjEzMTc=","avatar_url":"https://avatars.githubusercontent.com/u/6961317?v=4","gravatar_id":"","url":"https://api.github.com/users/shardulm94","html_url":"https://github.com/shardulm94","followers_url":"https://api.github.com/users/shardulm94/followers","following_url":"https://api.github.com/users/shardulm94/following{/other_user}","gists_url":"https://api.github.com/users/shardulm94/gists{/gist_id}","starred_url":"https://api.github.com/users/shardulm94/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shardulm94/subscriptions","organizations_url":"https://api.github.com/users/shardulm94/orgs","repos_url":"https://api.github.com/users/shardulm94/repos","events_url":"https://api.github.com/users/shardulm94/events{/privacy}","received_events_url":"https://api.github.com/users/shardulm94/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-23T07:04:11Z","updated_at":"2020-06-23T07:04:11Z","author_association":"CONTRIBUTOR","body":"@rdblue That makes sense! Thanks for pointing that out. I understand the reasoning behind your suggestion and have tried to incorporate it in the latest commit. However, I am not sure if the implementation is the best way to go about it. Let me know if you a better idea.  ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/647951691/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648277168","html_url":"https://github.com/apache/iceberg/pull/1128#issuecomment-648277168","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1128","id":648277168,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODI3NzE2OA==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-23T16:34:52Z","updated_at":"2020-06-23T16:34:52Z","author_association":"CONTRIBUTOR","body":"Thanks, @chenjunjiedada!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648277168/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648302532","html_url":"https://github.com/apache/iceberg/pull/1132#issuecomment-648302532","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1132","id":648302532,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODMwMjUzMg==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-23T17:22:43Z","updated_at":"2020-06-23T17:22:43Z","author_association":"CONTRIBUTOR","body":"@shardulm94, this looks really close to me. I think we just need to update the default value logic a little, as I noted above.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648302532/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648306081","html_url":"https://github.com/apache/iceberg/pull/1129#issuecomment-648306081","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1129","id":648306081,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODMwNjA4MQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-23T17:29:20Z","updated_at":"2020-06-23T17:29:20Z","author_association":"CONTRIBUTOR","body":"@chenjunjiedada, I think this is good to commit. It would be nice to update the tests, but not really necessary to test what this is doing. Thanks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648306081/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648459182","html_url":"https://github.com/apache/iceberg/pull/1129#issuecomment-648459182","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1129","id":648459182,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODQ1OTE4Mg==","user":{"login":"chenjunjiedada","id":3960228,"node_id":"MDQ6VXNlcjM5NjAyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3960228?v=4","gravatar_id":"","url":"https://api.github.com/users/chenjunjiedada","html_url":"https://github.com/chenjunjiedada","followers_url":"https://api.github.com/users/chenjunjiedada/followers","following_url":"https://api.github.com/users/chenjunjiedada/following{/other_user}","gists_url":"https://api.github.com/users/chenjunjiedada/gists{/gist_id}","starred_url":"https://api.github.com/users/chenjunjiedada/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenjunjiedada/subscriptions","organizations_url":"https://api.github.com/users/chenjunjiedada/orgs","repos_url":"https://api.github.com/users/chenjunjiedada/repos","events_url":"https://api.github.com/users/chenjunjiedada/events{/privacy}","received_events_url":"https://api.github.com/users/chenjunjiedada/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-23T22:22:08Z","updated_at":"2020-06-23T22:22:08Z","author_association":"COLLABORATOR","body":"@rdblue, Thanks for merging, will think more about the requirement next time.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648459182/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648470996","html_url":"https://github.com/apache/iceberg/pull/1129#issuecomment-648470996","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1129","id":648470996,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODQ3MDk5Ng==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-23T22:59:44Z","updated_at":"2020-06-23T22:59:44Z","author_association":"CONTRIBUTOR","body":"@chenjunjiedada, the problem was that the ID column was required. It should be optional if it is missing in a file. Could you submit a PR with the test updated?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648470996/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648479555","html_url":"https://github.com/apache/iceberg/pull/1132#issuecomment-648479555","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1132","id":648479555,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODQ3OTU1NQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-23T23:27:11Z","updated_at":"2020-06-23T23:27:11Z","author_association":"CONTRIBUTOR","body":"Looks great, thanks @shardulm94!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648479555/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648481889","html_url":"https://github.com/apache/iceberg/pull/1129#issuecomment-648481889","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1129","id":648481889,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODQ4MTg4OQ==","user":{"login":"chenjunjiedada","id":3960228,"node_id":"MDQ6VXNlcjM5NjAyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3960228?v=4","gravatar_id":"","url":"https://api.github.com/users/chenjunjiedada","html_url":"https://github.com/chenjunjiedada","followers_url":"https://api.github.com/users/chenjunjiedada/followers","following_url":"https://api.github.com/users/chenjunjiedada/following{/other_user}","gists_url":"https://api.github.com/users/chenjunjiedada/gists{/gist_id}","starred_url":"https://api.github.com/users/chenjunjiedada/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenjunjiedada/subscriptions","organizations_url":"https://api.github.com/users/chenjunjiedada/orgs","repos_url":"https://api.github.com/users/chenjunjiedada/repos","events_url":"https://api.github.com/users/chenjunjiedada/events{/privacy}","received_events_url":"https://api.github.com/users/chenjunjiedada/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-23T23:35:27Z","updated_at":"2020-06-23T23:35:27Z","author_association":"COLLABORATOR","body":"@rdblue, Just created https://github.com/apache/iceberg/pull/1135.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648481889/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648509997","html_url":"https://github.com/apache/iceberg/pull/1125#issuecomment-648509997","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1125","id":648509997,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODUwOTk5Nw==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-24T00:30:31Z","updated_at":"2020-06-24T00:30:31Z","author_association":"CONTRIBUTOR","body":"Thanks @openinx! Overall this looks pretty close to ready to go in. I like that we can reuse so much between Flink and Iceberg generics.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648509997/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648984181","html_url":"https://github.com/apache/iceberg/pull/1126#issuecomment-648984181","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1126","id":648984181,"node_id":"MDEyOklzc3VlQ29tbWVudDY0ODk4NDE4MQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-24T18:15:49Z","updated_at":"2020-06-24T18:15:49Z","author_association":"CONTRIBUTOR","body":"Looks like the only blocker is the `build.gradle` issue. It would be nice to fix some of the style, but overall this looks good.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/648984181/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/649142889","html_url":"https://github.com/apache/iceberg/pull/1100#issuecomment-649142889","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1100","id":649142889,"node_id":"MDEyOklzc3VlQ29tbWVudDY0OTE0Mjg4OQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-25T00:24:55Z","updated_at":"2020-06-25T00:24:55Z","author_association":"CONTRIBUTOR","body":"> Should we use Hive Table or Hadoop Table in the docker demo?\r\n\r\nYes, otherwise we don't need docker for a demo. Hadoop tables can be used with a local file system after starting Spark with the instructions on the [quick start page](https://iceberg.apache.org/getting-started/#using-iceberg-in-spark). The difficult thing is seeing it work with a metastore because it is difficult to get Hive running.\r\n\r\n> How often do we need to update the docker?\r\n\r\nI'd say it should be updated after each release. It would also be nice to test releases by running through it. I wouldn't add it to CI because I don't think Docker adds much value there over what we already have.\r\n\r\n> Features included in the docker demo\r\n\r\nSchema evolution is a good one to demonstrate. Metadata tables are really useful, and time travel queries are good to know about.\r\n\r\n> Will the docker demo demonstrated on the website?\r\n\r\nYes, I think it would be worth adding to the site once it's done.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/649142889/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/649145345","html_url":"https://github.com/apache/iceberg/pull/1100#issuecomment-649145345","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1100","id":649145345,"node_id":"MDEyOklzc3VlQ29tbWVudDY0OTE0NTM0NQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-25T00:34:38Z","updated_at":"2020-06-25T00:34:38Z","author_association":"CONTRIBUTOR","body":"Thanks for working on this, @Jiayi-Liao! It looks interesting, but I think that we would want to have a container running a Hive Metastore that Spark connects to.\r\n\r\nAlso, we're currently adding Spark 3.0 support in preparation for the 0.9.0 release, which will include SQL. So we will probably want to keep that in mind as well.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/649145345/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/649155637","html_url":"https://github.com/apache/iceberg/pull/796#issuecomment-649155637","issue_url":"https://api.github.com/repos/apache/iceberg/issues/796","id":649155637,"node_id":"MDEyOklzc3VlQ29tbWVudDY0OTE1NTYzNw==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-25T01:13:49Z","updated_at":"2020-06-25T01:13:49Z","author_association":"CONTRIBUTOR","body":"@jerryshao, I didn't have much time to look at this today, so I'll continue looking at it tomorrow. Sorry for the delay getting comments to you!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/649155637/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/649851442","html_url":"https://github.com/apache/iceberg/issues/1138#issuecomment-649851442","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1138","id":649851442,"node_id":"MDEyOklzc3VlQ29tbWVudDY0OTg1MTQ0Mg==","user":{"login":"gustavoatt","id":1475634,"node_id":"MDQ6VXNlcjE0NzU2MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1475634?v=4","gravatar_id":"","url":"https://api.github.com/users/gustavoatt","html_url":"https://github.com/gustavoatt","followers_url":"https://api.github.com/users/gustavoatt/followers","following_url":"https://api.github.com/users/gustavoatt/following{/other_user}","gists_url":"https://api.github.com/users/gustavoatt/gists{/gist_id}","starred_url":"https://api.github.com/users/gustavoatt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gustavoatt/subscriptions","organizations_url":"https://api.github.com/users/gustavoatt/orgs","repos_url":"https://api.github.com/users/gustavoatt/repos","events_url":"https://api.github.com/users/gustavoatt/events{/privacy}","received_events_url":"https://api.github.com/users/gustavoatt/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-25T22:34:49Z","updated_at":"2020-06-25T22:34:49Z","author_association":"CONTRIBUTOR","body":"It seems like the [current spec](https://iceberg.apache.org/spec/#parquet) does require timestamps to be stored as epoch microseconds in an `int64`.\r\n\r\nHowever I do think that supporting `int96` timestamps on the read path would be really handy when migrating tables to iceberg to avoid having to rewrite data.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/649851442/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650149685","html_url":"https://github.com/apache/iceberg/issues/1113#issuecomment-650149685","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1113","id":650149685,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDE0OTY4NQ==","user":{"login":"massdosage","id":29457,"node_id":"MDQ6VXNlcjI5NDU3","avatar_url":"https://avatars.githubusercontent.com/u/29457?v=4","gravatar_id":"","url":"https://api.github.com/users/massdosage","html_url":"https://github.com/massdosage","followers_url":"https://api.github.com/users/massdosage/followers","following_url":"https://api.github.com/users/massdosage/following{/other_user}","gists_url":"https://api.github.com/users/massdosage/gists{/gist_id}","starred_url":"https://api.github.com/users/massdosage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/massdosage/subscriptions","organizations_url":"https://api.github.com/users/massdosage/orgs","repos_url":"https://api.github.com/users/massdosage/repos","events_url":"https://api.github.com/users/massdosage/events{/privacy}","received_events_url":"https://api.github.com/users/massdosage/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-26T12:20:51Z","updated_at":"2020-06-26T12:20:51Z","author_association":"CONTRIBUTOR","body":"This is still failing on master:\r\n\r\nTestLocalScan. testFilterWithDateAndTimestamp[1] \r\n```\r\n\r\njava.lang.AssertionError\r\n\tat org.junit.Assert.fail(Assert.java:86)\r\n\tat org.junit.Assert.assertTrue(Assert.java:41)\r\n\tat org.junit.Assert.assertTrue(Assert.java:52)\r\n\tat org.apache.iceberg.data.TestLocalScan.testFilterWithDateAndTimestamp(TestLocalScan.java:486)\r\n```\r\n\r\nAnd now an additional test is failing:\r\n\r\nTestMetricsRowGroupFilterTypes. testEq[20] \r\n\r\n```\r\njava.lang.AssertionError: Should read: value is in the row group: 2018-06-29\r\n\tat org.junit.Assert.fail(Assert.java:88)\r\n\tat org.junit.Assert.assertTrue(Assert.java:41)\r\n\tat org.apache.iceberg.data.TestMetricsRowGroupFilterTypes.testEq(TestMetricsRowGroupFilterTypes.java:284)\r\n\tat sun.reflect.GeneratedMethodAccessor9.invoke(Unknown Source)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650149685/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650172547","html_url":"https://github.com/apache/iceberg/pull/1103#issuecomment-650172547","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1103","id":650172547,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDE3MjU0Nw==","user":{"login":"massdosage","id":29457,"node_id":"MDQ6VXNlcjI5NDU3","avatar_url":"https://avatars.githubusercontent.com/u/29457?v=4","gravatar_id":"","url":"https://api.github.com/users/massdosage","html_url":"https://github.com/massdosage","followers_url":"https://api.github.com/users/massdosage/followers","following_url":"https://api.github.com/users/massdosage/following{/other_user}","gists_url":"https://api.github.com/users/massdosage/gists{/gist_id}","starred_url":"https://api.github.com/users/massdosage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/massdosage/subscriptions","organizations_url":"https://api.github.com/users/massdosage/orgs","repos_url":"https://api.github.com/users/massdosage/repos","events_url":"https://api.github.com/users/massdosage/events{/privacy}","received_events_url":"https://api.github.com/users/massdosage/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-26T13:14:45Z","updated_at":"2020-06-26T13:14:45Z","author_association":"CONTRIBUTOR","body":"All the outstanding comments on this PR have now been resolved. Could we please get another round of reviews to see if this can be merged now? @rdblue @rdsr \r\n\r\nThanks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650172547/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650208769","html_url":"https://github.com/apache/iceberg/pull/1126#issuecomment-650208769","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1126","id":650208769,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDIwODc2OQ==","user":{"login":"raptond","id":30231978,"node_id":"MDQ6VXNlcjMwMjMxOTc4","avatar_url":"https://avatars.githubusercontent.com/u/30231978?v=4","gravatar_id":"","url":"https://api.github.com/users/raptond","html_url":"https://github.com/raptond","followers_url":"https://api.github.com/users/raptond/followers","following_url":"https://api.github.com/users/raptond/following{/other_user}","gists_url":"https://api.github.com/users/raptond/gists{/gist_id}","starred_url":"https://api.github.com/users/raptond/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raptond/subscriptions","organizations_url":"https://api.github.com/users/raptond/orgs","repos_url":"https://api.github.com/users/raptond/repos","events_url":"https://api.github.com/users/raptond/events{/privacy}","received_events_url":"https://api.github.com/users/raptond/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-26T14:28:09Z","updated_at":"2020-06-26T14:28:09Z","author_association":"CONTRIBUTOR","body":"@rdblue - [`build.gradle`](https://github.com/apache/iceberg/pull/1126#discussion_r445078278) issue is fixed and so were all the style comments. I have ensured the style fixes are taken care throughout the code. \r\n\r\nThere is one comment I would like to have your feedback. Could you please take a look at this?    https://github.com/apache/iceberg/pull/1126#discussion_r446213012. \r\n\r\nThanks for the review. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650208769/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650295324","html_url":"https://github.com/apache/iceberg/pull/1125#issuecomment-650295324","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1125","id":650295324,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDI5NTMyNA==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-26T17:14:36Z","updated_at":"2020-06-26T17:14:36Z","author_association":"CONTRIBUTOR","body":"@openinx, I think this is ready to commit other than the public interfaces and methods to pass struct factories. I'd like to make those protected or go with the inheritance approach. Personally, I think the inheritance approach is cleaner and I don't mind the method you pointed out, but either way I think can work.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650295324/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650302395","html_url":"https://github.com/apache/iceberg/pull/1127#issuecomment-650302395","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1127","id":650302395,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDMwMjM5NQ==","user":{"login":"edgarRd","id":266670,"node_id":"MDQ6VXNlcjI2NjY3MA==","avatar_url":"https://avatars.githubusercontent.com/u/266670?v=4","gravatar_id":"","url":"https://api.github.com/users/edgarRd","html_url":"https://github.com/edgarRd","followers_url":"https://api.github.com/users/edgarRd/followers","following_url":"https://api.github.com/users/edgarRd/following{/other_user}","gists_url":"https://api.github.com/users/edgarRd/gists{/gist_id}","starred_url":"https://api.github.com/users/edgarRd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edgarRd/subscriptions","organizations_url":"https://api.github.com/users/edgarRd/orgs","repos_url":"https://api.github.com/users/edgarRd/repos","events_url":"https://api.github.com/users/edgarRd/events{/privacy}","received_events_url":"https://api.github.com/users/edgarRd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-26T17:27:53Z","updated_at":"2020-06-26T17:27:53Z","author_association":"CONTRIBUTOR","body":"@rdblue @shardulm94 PTAL whenever you have a chance.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650302395/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650416548","html_url":"https://github.com/apache/iceberg/pull/1127#issuecomment-650416548","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1127","id":650416548,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDQxNjU0OA==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-26T21:43:07Z","updated_at":"2020-06-26T21:43:07Z","author_association":"CONTRIBUTOR","body":"Thanks for the summary, @edgarRd. I find this behavior concerning. I think it will help to cover some background, just to cover the context for specific comments.\r\n\r\nAs a storage layer, Iceberg should always read and return the exact data value that was written. For example, with floating point values, there is no \"close enough\" and Iceberg should read the same bits that were written. That's why we use `assertEquals` instead of assertions that a value is within some floating point error.\r\n\r\nFor date/time types, Iceberg should never modify a value. Concerns like translating from some time zone into the UTC value to store for `timestamptz` must be handled by processing engines, which handle calendars time zone offsets, and other concerns. Iceberg stores the UTC value without modification, and the data type tells the engine how to produce a value to write and consume a value that's read. This is why the internal representation is microseconds from the Unix epoch in UTC. That's unambiguous.\r\n\r\nIt looks like ORC uses representations that are timezone-dependent in some cases, like returning, and possibly calculating, stats. I think that it is good that we don't use these in the Iceberg readers or writers, and my first approach to fixing this would be to avoid having data passed using those objects.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650416548/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650456019","html_url":"https://github.com/apache/iceberg/pull/1127#issuecomment-650456019","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1127","id":650456019,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDQ1NjAxOQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-26T23:58:31Z","updated_at":"2020-06-26T23:58:31Z","author_association":"CONTRIBUTOR","body":"I just had a chat with @omalley about this issue and he's going to add a getter for the underlying values, `getMinimumDays` and `getMaximumDays`. That way, we won't need to go through a type with behavior dependent on the time zone and we will avoid the adjustment problems.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650456019/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650462092","html_url":"https://github.com/apache/iceberg/pull/1127#issuecomment-650462092","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1127","id":650462092,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDQ2MjA5Mg==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-27T00:27:24Z","updated_at":"2020-06-27T00:27:24Z","author_association":"CONTRIBUTOR","body":"@edgarRd, I created https://github.com/edgarRd/iceberg/pull/1 against your branch with the reflection fix. It passes all of the tests in this PR and the stats tests.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650462092/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650466406","html_url":"https://github.com/apache/iceberg/issues/1131#issuecomment-650466406","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1131","id":650466406,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDQ2NjQwNg==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-27T00:59:04Z","updated_at":"2020-06-27T00:59:04Z","author_association":"CONTRIBUTOR","body":"That's right, concurrent writes are supported through the Hive catalog implementation. You can customize this as @edgarRd pointed out.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650466406/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650467924","html_url":"https://github.com/apache/iceberg/pull/1127#issuecomment-650467924","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1127","id":650467924,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDQ2NzkyNA==","user":{"login":"edgarRd","id":266670,"node_id":"MDQ6VXNlcjI2NjY3MA==","avatar_url":"https://avatars.githubusercontent.com/u/266670?v=4","gravatar_id":"","url":"https://api.github.com/users/edgarRd","html_url":"https://github.com/edgarRd","followers_url":"https://api.github.com/users/edgarRd/followers","following_url":"https://api.github.com/users/edgarRd/following{/other_user}","gists_url":"https://api.github.com/users/edgarRd/gists{/gist_id}","starred_url":"https://api.github.com/users/edgarRd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edgarRd/subscriptions","organizations_url":"https://api.github.com/users/edgarRd/orgs","repos_url":"https://api.github.com/users/edgarRd/repos","events_url":"https://api.github.com/users/edgarRd/events{/privacy}","received_events_url":"https://api.github.com/users/edgarRd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-27T01:11:03Z","updated_at":"2020-06-27T05:04:58Z","author_association":"CONTRIBUTOR","body":"@rdblue great! I've merged the change. Thanks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650467924/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650467967","html_url":"https://github.com/apache/iceberg/issues/1138#issuecomment-650467967","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1138","id":650467967,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDQ2Nzk2Nw==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-27T01:11:24Z","updated_at":"2020-06-27T01:11:24Z","author_association":"CONTRIBUTOR","body":"To be clear, when you use Iceberg with Spark, Iceberg's timestamp type works just fine. So this is only necessary when working with other systems. And I believe Spark can already write the INT64 timestamps that Iceberg uses.\r\n\r\nIceberg is strict about the files that it writes and uses the timestamps specified in Parquet. The INT96 timestamps have a ton of problems, so it's really unlikely that it would ever make sense for Iceberg to write them.\r\n\r\nIceberg could _read_ data files with those timestamps, but they would have to be existing data files imported by converting a Parquet/Hive table over to Iceberg. I guess if someone needed to implement that, we'd review it.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650467967/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650468182","html_url":"https://github.com/apache/iceberg/issues/1117#issuecomment-650468182","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1117","id":650468182,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDQ2ODE4Mg==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-27T01:13:20Z","updated_at":"2020-06-27T01:13:20Z","author_association":"CONTRIBUTOR","body":"Do you have a test case that reproduces the problem?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650468182/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650468284","html_url":"https://github.com/apache/iceberg/issues/1114#issuecomment-650468284","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1114","id":650468284,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDQ2ODI4NA==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-27T01:14:04Z","updated_at":"2020-06-27T01:14:04Z","author_association":"CONTRIBUTOR","body":"This support is coming with the 0.9.0 release for Spark 3.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650468284/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650468402","html_url":"https://github.com/apache/iceberg/issues/1093#issuecomment-650468402","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1093","id":650468402,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDQ2ODQwMg==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-27T01:15:11Z","updated_at":"2020-06-27T01:15:11Z","author_association":"CONTRIBUTOR","body":"This was added in #1095. I'll close the issue.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650468402/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650470573","html_url":"https://github.com/apache/iceberg/issues/360#issuecomment-650470573","issue_url":"https://api.github.com/repos/apache/iceberg/issues/360","id":650470573,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDQ3MDU3Mw==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-27T01:34:32Z","updated_at":"2020-06-27T01:34:52Z","author_association":"CONTRIBUTOR","body":"@openinx, sorry I haven't had a chance to reply before now. We missed you at the last sync up, where we talked about this. I added this to the notes, but I wanted to follow up here as well.\r\n\r\nSounds like there are 2 main reasons to use a dynamic schema. The first is that you might want to delete with different filters, like dropping a user by first/last name, or dropping by user id. I think it's reasonable to say there may be more than one way to delete data, but I don't think that there is much value to encoding those deletes in the same file. There is going to be a small number of column sets used to identify and delete records, and I think it's worth just using a different delete for each set of columns. Then we wouldn't need the complexity of encoding a map with various value types, and can take advantage of columnar formats.\r\n\r\nThe second argument for a dynamic schema -- the CDC case with rapid upserts for the same row -- is interesting, and something I've been thinking about how to solve as well. Let me present the approach I've been thinking about.\r\n\r\nContinuing with your example, I would actually encode the delete using a positional delete rather than an equality delete. That removes the concern about deleting row with ID 1 twice because the delete would be for `(file=data_file.avro, pos=0)`. The second record would not be deleted by accident.\r\n\r\nThe position-based approach has a few benefits as well:\r\n1. Position delete files are more efficient to apply because we're using information that we already know -- exactly where the row is\r\n2. Although we would need to keep a mapping from ID to position for every row in the data file, this would still require less memory than the approach where we encode a delete with an equality predicate with all columns of the original row. Keeping all columns of the original row is more expensive than the identity columns and an int or long position.\r\n3. Encoding a delete using all of the columns from the previous copy of the row may delete all copies of a row. Consider the following sequence:\r\n\r\n```\r\nt0, UPSERT(1, 2)\r\nt1, UPSERT(1, 3)\r\nt2, UPSERT(1, 4)\r\nt3, UPSERT(1, 3)\r\n```\r\n\r\nThe second upsert would be encoded as `id=1 and data=3`, which would actually delete the _last_ row because the data was reset. This situation could also happen if an upsert is replayed because a stream has at-least-once semantics (which should be fine, since upsert is idempotent).\r\n\r\nI think that using a positional delete is a good solution to this problem. That would also mean that we won't need to apply equality deletes to any data files with the same sequence number, which is a small win. Only positional delete files would need to be applied to data files with the same sequence number.\r\n\r\nWhat do you think?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650470573/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650623060","html_url":"https://github.com/apache/iceberg/pull/1127#issuecomment-650623060","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1127","id":650623060,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDYyMzA2MA==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-27T20:42:24Z","updated_at":"2020-06-27T20:42:24Z","author_association":"CONTRIBUTOR","body":"Merged to master. Thanks @edgarRd!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650623060/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650653084","html_url":"https://github.com/apache/iceberg/pull/1125#issuecomment-650653084","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1125","id":650653084,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDY1MzA4NA==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-28T00:12:35Z","updated_at":"2020-06-28T00:12:35Z","author_association":"MEMBER","body":"Ping @rdblue , Mind to take another look ?  I think it's prepared to be merged now, will pull request the next patch about flink sink operator as we described in https://github.com/apache/iceberg/pull/1096","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650653084/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650694300","html_url":"https://github.com/apache/iceberg/issues/360#issuecomment-650694300","issue_url":"https://api.github.com/repos/apache/iceberg/issues/360","id":650694300,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDY5NDMwMA==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-28T04:39:02Z","updated_at":"2020-06-28T04:39:02Z","author_association":"MEMBER","body":"Well, seems  I thought differently with yours. \r\n\r\nFor my understanding, your solution will divide the deletes into two parts:  1. equality-deletion ; 2. positional-deletion.   The equality-deletion will only be applied to data files with sequence_number < current delete file, the positional-deletion will only be applied to data files with the same sequence number. \r\n\r\nThere're several problems in my thought: \r\n1.  As you said, keeping the index from ID to position is expensive, especially when the data couldn't fit in the limited memory. In that case, we may need to spill into disk. That could produce many random seeks if searching the position for a given ID when generating the positional delete files.\r\n2.  The equality-deletion and positional-deletion seems make the JOIN algorithm complex,  both the read & replay implementation need to consider both of them.  I'd prefer to use one kind of deletion if possible. \r\n3.   If the equality-deletions only keep the primary key columns in delta files, then it will be a problem when replaying to the downstream iceberg table.  For example, we have a table with two columns (a,b), a is primary key and b is partition key.  the operation `DELETE(a=1)` will need to be applied to all partitions in downstream iceberg table,  while the `DELETE(a=1, b=2)` will only need to be applied to `partition=2`.  Keeping all columns for equality-deletions is good for replaying. \r\n\r\nI'm writing the some document for the `equality-deletes`,  will post to the mail list in next days. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650694300/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650737185","html_url":"https://github.com/apache/iceberg/issues/1114#issuecomment-650737185","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1114","id":650737185,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDczNzE4NQ==","user":{"login":"yiguolei","id":9208457,"node_id":"MDQ6VXNlcjkyMDg0NTc=","avatar_url":"https://avatars.githubusercontent.com/u/9208457?v=4","gravatar_id":"","url":"https://api.github.com/users/yiguolei","html_url":"https://github.com/yiguolei","followers_url":"https://api.github.com/users/yiguolei/followers","following_url":"https://api.github.com/users/yiguolei/following{/other_user}","gists_url":"https://api.github.com/users/yiguolei/gists{/gist_id}","starred_url":"https://api.github.com/users/yiguolei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yiguolei/subscriptions","organizations_url":"https://api.github.com/users/yiguolei/orgs","repos_url":"https://api.github.com/users/yiguolei/repos","events_url":"https://api.github.com/users/yiguolei/events{/privacy}","received_events_url":"https://api.github.com/users/yiguolei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-28T11:23:36Z","updated_at":"2020-06-28T11:23:36Z","author_association":"NONE","body":"@rdblue when will 0.9.0 be released?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650737185/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650829640","html_url":"https://github.com/apache/iceberg/pull/922#issuecomment-650829640","issue_url":"https://api.github.com/repos/apache/iceberg/issues/922","id":650829640,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDgyOTY0MA==","user":{"login":"jun-he","id":12246263,"node_id":"MDQ6VXNlcjEyMjQ2MjYz","avatar_url":"https://avatars.githubusercontent.com/u/12246263?v=4","gravatar_id":"","url":"https://api.github.com/users/jun-he","html_url":"https://github.com/jun-he","followers_url":"https://api.github.com/users/jun-he/followers","following_url":"https://api.github.com/users/jun-he/following{/other_user}","gists_url":"https://api.github.com/users/jun-he/gists{/gist_id}","starred_url":"https://api.github.com/users/jun-he/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jun-he/subscriptions","organizations_url":"https://api.github.com/users/jun-he/orgs","repos_url":"https://api.github.com/users/jun-he/repos","events_url":"https://api.github.com/users/jun-he/events{/privacy}","received_events_url":"https://api.github.com/users/jun-he/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-28T22:18:31Z","updated_at":"2020-06-29T01:59:05Z","author_association":"COLLABORATOR","body":"@rdblue  thanks for the comment. I address the comments and update the PR accordingly.\r\nIn this change, `UpdatePartitionSpec` now ignores all soft-deleted fields in `V1` and then applies all changes to create a `V2` partition spec. After that, it then fill each of partition filed id gaps with a `VoidTransform` field.\r\n\r\nIn this way, we can also support partition spec evolution, e.g.\r\n- reuse a field id previously removed in V1\r\n- keep spec concise without useless trailing void fields if needed\r\n\r\nAdditionally, it does not need to consider `V1` case before committing and make the code cleaner and easier to read. \r\n\r\nCan you please take another look and let me know your comments? Thanks!\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650829640/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650896338","html_url":"https://github.com/apache/iceberg/pull/1139#issuecomment-650896338","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1139","id":650896338,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MDg5NjMzOA==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-29T04:20:54Z","updated_at":"2020-06-29T04:20:54Z","author_association":"CONTRIBUTOR","body":"@rdblue, did you guys tested this already in your env?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/650896338/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651268262","html_url":"https://github.com/apache/iceberg/issues/360#issuecomment-651268262","issue_url":"https://api.github.com/repos/apache/iceberg/issues/360","id":651268262,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTI2ODI2Mg==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-29T17:49:49Z","updated_at":"2020-06-29T17:50:29Z","author_association":"CONTRIBUTOR","body":"Sounds like there is a slight difference in how we are framing the problem. I have been thinking of an upsert case, where we get an entire replacement row but not the previous row values. From your comments, it sounds like you are thinking of a case where we have both the previous row and the replacement row (possibly as separate delete and insert events). It's good to think through that case because it does change what we might do here.\r\n\r\nWithout the previous row, I think you would have to keep track of previously written values, so the position deletes are attractive because you have to keep less information -- a position and the id columns, rather than all columns. But _with_ the previous row, you wouldn't need to keep any state. I agree that this makes it a good alternative if you have that information in your CDC stream.\r\n\r\nThere's still a major problem with using equality deletes that I pointed out: deleting with row values would potentially delete future rows when two copies of a row have the same values. Using a unique ID for each CDC event could mitigate the problem, but duplicate events from at-least-once processing would still incorrectly delete data rows. How would you avoid this problem?\r\n\r\nTo your point about replaying events, I think I agree that it would be a good to keep track of the previous column values if they are present in a CDC delete event, but I'm not sure it would enable a source to replay exactly the events that were received -- after all, we're still separating inserts and deletes into separate files so we can't easily reconstruct an upsert event.\r\n\r\nAssuming that it is likely valuable to track the deleted data values, I don't think that it makes a case for dynamic columns:\r\n1. It would be good to track deleted data whether the delete is encoding using position or equality. We can add additional columns for deleted values to both formats, so this doesn't strictly require equality deletes.\r\n2. If we introduce additional columns for deleted row values, then why wouldn't we add columns more to the equality delete file? They could be normal data files that contain deleted rows and are used differently. Then we get columnar encoding. Making the column list dynamic doesn't help, unless for some reason the CDC event is missing some columns. And in that case, it's not too much overhead to have a delete file for each combination of columns the CDC event emitter produces.\r\n\r\n### Clarifications\r\n\r\n> the positional-deletion will only be applied to data files with the same sequence number.\r\n\r\nPosition deletes would apply to data files with a sequence number `<=` to the delete file's sequence number. They would still be used for other delete cases, which require `<`.\r\n\r\nIf we want to use equality delete files for this, then we would similarly apply an equality delete file when a data file's sequence number is `<=` the equality delete's sequence number.\r\n\r\nThe optimization I was suggesting is if we don't use equality deletes to encode deletes within the same commit, we can use `<` instead of `<=`.\r\n\r\n> keeping the index from ID to position is expensive, especially when the data couldn't fit in the limited memory\r\n\r\nYou could avoid spilling to disk by closing the data file when this is getting too expensive, instead of spilling to disk. If we assume that the ID column is a UUID and the position is a long, then each (id, pos) pair takes about 24 bytes. If we double that for JVM overhead, then we can track about 2.8 million rows in 128 MB of memory. While that's significant, it isn't unreasonable to cut off data files well before 2.8 million rows. Even if the checkpoint interval is as long as 5 minutes, then then the rate of rows to the file would need to be 9,300 rows per second to exceed that limit.\r\n\r\n> The equality-deletion and positional-deletion seems make the JOIN algorithm complex\r\n\r\nThis would happen anyway because data files will need to merge multiple delete files. Position deletes are more efficient because they are more targeted, so deployments will very likely have regular compaction from equality deletes to position deletes. That means at any given time, a file may have both delete formats to merge in. This is not that much complexity as long as we can filter the results of another filter.\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651268262/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651272569","html_url":"https://github.com/apache/iceberg/pull/1125#issuecomment-651272569","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1125","id":651272569,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTI3MjU2OQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-29T17:58:51Z","updated_at":"2020-06-29T17:58:51Z","author_association":"CONTRIBUTOR","body":"Thanks, @openinx!\r\n\r\nI appreciate you going with the inheritance approach for now. I'll prototype the alternative I [suggested above](https://github.com/apache/iceberg/pull/1125#discussion_r446304286), since I think that addresses your duplication concern while not making the factory interface public. I'm merging this so that it unblocks you and we can find a good solution to that problem in parallel.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651272569/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651276091","html_url":"https://github.com/apache/iceberg/pull/1139#issuecomment-651276091","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1139","id":651276091,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTI3NjA5MQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-29T18:06:27Z","updated_at":"2020-06-29T18:06:27Z","author_association":"CONTRIBUTOR","body":"I think @jun-he makes a good point that we should consider, but we can do that in a follow-up. In the mean time, I'll merge this to fix the memory leak in master.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651276091/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651276357","html_url":"https://github.com/apache/iceberg/pull/1139#issuecomment-651276357","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1139","id":651276357,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTI3NjM1Nw==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-29T18:07:06Z","updated_at":"2020-06-29T18:07:06Z","author_association":"CONTRIBUTOR","body":"@aokolnychyi, yes. We've been running with this in prod for about a week now.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651276357/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651286889","html_url":"https://github.com/apache/iceberg/issues/1114#issuecomment-651286889","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1114","id":651286889,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTI4Njg4OQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-29T18:29:45Z","updated_at":"2020-06-29T18:29:45Z","author_association":"CONTRIBUTOR","body":"I'm aiming to get it out in the next few weeks, now that Spark 3 has been released.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651286889/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651396772","html_url":"https://github.com/apache/iceberg/issues/1138#issuecomment-651396772","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1138","id":651396772,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTM5Njc3Mg==","user":{"login":"gustavoatt","id":1475634,"node_id":"MDQ6VXNlcjE0NzU2MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1475634?v=4","gravatar_id":"","url":"https://api.github.com/users/gustavoatt","html_url":"https://github.com/gustavoatt","followers_url":"https://api.github.com/users/gustavoatt/followers","following_url":"https://api.github.com/users/gustavoatt/following{/other_user}","gists_url":"https://api.github.com/users/gustavoatt/gists{/gist_id}","starred_url":"https://api.github.com/users/gustavoatt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gustavoatt/subscriptions","organizations_url":"https://api.github.com/users/gustavoatt/orgs","repos_url":"https://api.github.com/users/gustavoatt/repos","events_url":"https://api.github.com/users/gustavoatt/events{/privacy}","received_events_url":"https://api.github.com/users/gustavoatt/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-29T22:12:05Z","updated_at":"2020-06-29T22:12:05Z","author_association":"CONTRIBUTOR","body":"Thanks @rdblue! We would most likely need this to migrate some of our biggest tables to Iceberg since we were writing timestamps using `int96`.\r\n\r\nI can take this on as only read-support, do you have any pointers where the change would need to be made? I'm looking at `/parquet/ColumnIterator` and `/parquet/PageIterator` since that is where we have parquet read support.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651396772/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651412676","html_url":"https://github.com/apache/iceberg/issues/1138#issuecomment-651412676","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1138","id":651412676,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTQxMjY3Ng==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-29T23:01:11Z","updated_at":"2020-06-29T23:08:04Z","author_association":"CONTRIBUTOR","body":"Is the INT96 timestamp representation in query engines like Hive, Impala, Spark identical? In other words, will we have to understand which system wrote that INT96 timestamp in order to read it in Iceberg? I remember different query engines did different workarounds.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651412676/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651424201","html_url":"https://github.com/apache/iceberg/issues/1138#issuecomment-651424201","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1138","id":651424201,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTQyNDIwMQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-29T23:39:12Z","updated_at":"2020-06-29T23:39:12Z","author_association":"CONTRIBUTOR","body":"Off the top of my head, we'd need to support:\r\n\r\n1. A value reader for INT96 that converts values to micros\r\n2. Type conversion from Parquet schemas to Iceberg (timestamp or timestamptz?)\r\n\r\nWe would not need to modify any of the Parquet filter classes because INT96 timestamps have broken min/max stats. We would probably want to ignore them entirely in the Parquet metrics code as well.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651424201/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651476463","html_url":"https://github.com/apache/iceberg/pull/1103#issuecomment-651476463","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1103","id":651476463,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTQ3NjQ2Mw==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-30T02:10:47Z","updated_at":"2020-06-30T02:10:47Z","author_association":"CONTRIBUTOR","body":"I had a few questions, but overall this looks good. The only blocker is how `ByteBuffer` is handled.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651476463/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651476786","html_url":"https://github.com/apache/iceberg/pull/1136#issuecomment-651476786","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1136","id":651476786,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTQ3Njc4Ng==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-30T02:11:45Z","updated_at":"2020-06-30T02:11:45Z","author_association":"CONTRIBUTOR","body":"#1124 was merged with the tests, so this is no longer needed.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651476786/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651477301","html_url":"https://github.com/apache/iceberg/pull/1051#issuecomment-651477301","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1051","id":651477301,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTQ3NzMwMQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-30T02:13:17Z","updated_at":"2020-06-30T02:13:17Z","author_association":"CONTRIBUTOR","body":"@pranaydharmale, #828 is in if you'd like to pick this up again. Thanks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651477301/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651479109","html_url":"https://github.com/apache/iceberg/pull/1051#issuecomment-651479109","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1051","id":651479109,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTQ3OTEwOQ==","user":{"login":"pranaydharmale","id":495744,"node_id":"MDQ6VXNlcjQ5NTc0NA==","avatar_url":"https://avatars.githubusercontent.com/u/495744?v=4","gravatar_id":"","url":"https://api.github.com/users/pranaydharmale","html_url":"https://github.com/pranaydharmale","followers_url":"https://api.github.com/users/pranaydharmale/followers","following_url":"https://api.github.com/users/pranaydharmale/following{/other_user}","gists_url":"https://api.github.com/users/pranaydharmale/gists{/gist_id}","starred_url":"https://api.github.com/users/pranaydharmale/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pranaydharmale/subscriptions","organizations_url":"https://api.github.com/users/pranaydharmale/orgs","repos_url":"https://api.github.com/users/pranaydharmale/repos","events_url":"https://api.github.com/users/pranaydharmale/events{/privacy}","received_events_url":"https://api.github.com/users/pranaydharmale/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-30T02:17:54Z","updated_at":"2020-06-30T02:17:54Z","author_association":"CONTRIBUTOR","body":"@rdblue I'll pick it back up. Thank you. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651479109/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651504974","html_url":"https://github.com/apache/iceberg/issues/1117#issuecomment-651504974","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1117","id":651504974,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTUwNDk3NA==","user":{"login":"hzfanxinxin","id":11593166,"node_id":"MDQ6VXNlcjExNTkzMTY2","avatar_url":"https://avatars.githubusercontent.com/u/11593166?v=4","gravatar_id":"","url":"https://api.github.com/users/hzfanxinxin","html_url":"https://github.com/hzfanxinxin","followers_url":"https://api.github.com/users/hzfanxinxin/followers","following_url":"https://api.github.com/users/hzfanxinxin/following{/other_user}","gists_url":"https://api.github.com/users/hzfanxinxin/gists{/gist_id}","starred_url":"https://api.github.com/users/hzfanxinxin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hzfanxinxin/subscriptions","organizations_url":"https://api.github.com/users/hzfanxinxin/orgs","repos_url":"https://api.github.com/users/hzfanxinxin/repos","events_url":"https://api.github.com/users/hzfanxinxin/events{/privacy}","received_events_url":"https://api.github.com/users/hzfanxinxin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-30T03:27:18Z","updated_at":"2020-06-30T03:27:18Z","author_association":"CONTRIBUTOR","body":"> Do you have a test case that reproduces the problem?\r\n\r\nOK, let me commit a PR to add a test case. Thanks. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651504974/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651521784","html_url":"https://github.com/apache/iceberg/pull/1143#issuecomment-651521784","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1143","id":651521784,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTUyMTc4NA==","user":{"login":"hzfanxinxin","id":11593166,"node_id":"MDQ6VXNlcjExNTkzMTY2","avatar_url":"https://avatars.githubusercontent.com/u/11593166?v=4","gravatar_id":"","url":"https://api.github.com/users/hzfanxinxin","html_url":"https://github.com/hzfanxinxin","followers_url":"https://api.github.com/users/hzfanxinxin/followers","following_url":"https://api.github.com/users/hzfanxinxin/following{/other_user}","gists_url":"https://api.github.com/users/hzfanxinxin/gists{/gist_id}","starred_url":"https://api.github.com/users/hzfanxinxin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hzfanxinxin/subscriptions","organizations_url":"https://api.github.com/users/hzfanxinxin/orgs","repos_url":"https://api.github.com/users/hzfanxinxin/repos","events_url":"https://api.github.com/users/hzfanxinxin/events{/privacy}","received_events_url":"https://api.github.com/users/hzfanxinxin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-30T04:18:31Z","updated_at":"2020-06-30T04:23:37Z","author_association":"CONTRIBUTOR","body":"1. Run the tests\r\n`./gradlew :iceberg-data:clean :iceberg-data:test --tests org.apache.iceberg.data.parquet.TestGenericReadProjection`\r\n\r\n2. This fails with output like so:\r\n```> Task :iceberg-data:test\r\norg.apache.iceberg.data.parquet.TestGenericReadProjection > testBasicProjection FAILED\r\n    java.lang.NullPointerException\r\n        at org.apache.iceberg.data.parquet.GenericParquetReaders$ReadBuilder.primitive(GenericParquetReaders.java:234)\r\n        at org.apache.iceberg.data.parquet.GenericParquetReaders$ReadBuilder.primitive(GenericParquetReaders.java:118)\r\n        at org.apache.iceberg.parquet.TypeWithSchemaVisitor.visit(TypeWithSchemaVisitor.java:52)\r\n        at org.apache.iceberg.parquet.TypeWithSchemaVisitor.visitField(TypeWithSchemaVisitor.java:155)\r\n        at org.apache.iceberg.parquet.TypeWithSchemaVisitor.visitFields(TypeWithSchemaVisitor.java:169)\r\n        at org.apache.iceberg.parquet.TypeWithSchemaVisitor.visit(TypeWithSchemaVisitor.java:47)\r\n        at org.apache.iceberg.data.parquet.GenericParquetReaders.buildReader(GenericParquetReaders.java:78)\r\n        at org.apache.iceberg.data.parquet.GenericParquetReaders.buildReader(GenericParquetReaders.java:70)\r\n        at org.apache.iceberg.data.parquet.TestGenericReadProjection.lambda$writeAndRead$0(TestGenericReadProjection.java:48)\r\n        at org.apache.iceberg.parquet.ReadConf.<init>(ReadConf.java:109)\r\n        at org.apache.iceberg.parquet.ParquetReader.init(ParquetReader.java:66)\r\n        at org.apache.iceberg.parquet.ParquetReader.iterator(ParquetReader.java:77)\r\n        at org.apache.iceberg.parquet.ParquetReader.iterator(ParquetReader.java:38)\r\n        at org.apache.iceberg.relocated.com.google.common.collect.Iterables.getOnlyElement(Iterables.java:254)\r\n        at org.apache.iceberg.data.parquet.TestGenericReadProjection.writeAndRead(TestGenericReadProjection.java:51)\r\n14 tests completed, 1 failed```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651521784/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651531457","html_url":"https://github.com/apache/iceberg/issues/360#issuecomment-651531457","issue_url":"https://api.github.com/repos/apache/iceberg/issues/360","id":651531457,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTUzMTQ1Nw==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-30T04:47:22Z","updated_at":"2020-06-30T04:47:22Z","author_association":"MEMBER","body":"> I have been thinking of an upsert case, where we get an entire replacement row but not the previous row values. \r\n\r\nThe `upsert` without the previous row values depends on the primary key specification, otherwise an `UPSERT(1,2)` don't know which row should it change. The primary key will also introduce other questions: \r\n1.   whether the primary key columns should include the partition column and bucket column ? if not, then a table with (a,b) columns, a is the primary key and b is the partition key. for an `UPSERT(1,2)` its old row could be in any partitions of the iceberg table, we will need broadcast to all partition ? That seems resource wasting.  If sure, then it will limit the usage, for example we may adjust the bucket policy based on the fields to be JOIN between two table to avoid the massive data shuffle. So when adjust the bucket policy we will also need to adjust the primary key to include the new bucket columns ? \r\n2.  How to ensure the uniqueness in iceberg table ?  Within a given bucket,  two different version of the same row may appear  in two different data files, then will we need the costly  `JOIN` between data files (Previously, we only need to JOIN between data files and delete files);  Within a given iceberg table,  if primary key don't include the partition column, then two rows with the same primary key may appear in two different partition, the pk deduplication is a problem too.\r\n\r\nIn my opinion,  CDC events from RDBMS should always provide both old values and new values (such as `row-level` binlog).  It will be good to handle this case correctly first. About the other CDC events, such as `UPSERT` with only primary key, it seems need more consideration.\r\n\r\n> Using a unique ID for each CDC event could mitigate the problem, but duplicate events from at-least-once processing would still incorrectly delete data rows. How would you avoid this problem?\r\n\r\nFor spark streaming, it only guarantee the `at-least-once` semantics. Seems hard to maintain the consistent data in sink table unless we provide a identified global timestamp to indicate the before-after order. Let me think more about this.  For flink, it provide the `exactly-once` semantics, so it seems easier.\r\n\r\n> but I'm not sure it would enable a source to replay exactly the events that were received -- after all, we're still separating inserts and deletes into separate files so we can't easily reconstruct an upsert event.\r\n\r\nI think the mixed equality-deletion/positional-deletion you described seems hard to reconstruct the correct event order.  The pure positional-deletion described in this [document](https://docs.google.com/document/d/1bBKDD4l-pQFXaMb4nOyVK-Sl3N2NTTG37uOCQx8rKVc/edit#heading=h.ljqc7bxmc6ej)  could restore the original order.  \r\n\r\n>  I don't think that it makes a case for dynamic columns.\r\n\r\nYes, I agree that we don't need to care about the dynamic columns now.  In the real CDC events, it always provide all column values for a row.  Please ignore the propose about the dynamic columns encoding.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651531457/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651918493","html_url":"https://github.com/apache/iceberg/issues/1138#issuecomment-651918493","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1138","id":651918493,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTkxODQ5Mw==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-30T16:53:59Z","updated_at":"2020-06-30T16:53:59Z","author_association":"CONTRIBUTOR","body":"Also, we should find out more about differences between engines so we can document how our implementation works. I think there were some bugs there. Thanks for pointing it out, @aokolnychyi.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651918493/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651924427","html_url":"https://github.com/apache/iceberg/pull/1143#issuecomment-651924427","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1143","id":651924427,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTkyNDQyNw==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-30T17:05:08Z","updated_at":"2020-06-30T17:05:08Z","author_association":"CONTRIBUTOR","body":"Thanks for posting the test case that reproduces the error, @hzfanxinxin! I'll take a look and work on fixing it.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651924427/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651925401","html_url":"https://github.com/apache/iceberg/pull/922#issuecomment-651925401","issue_url":"https://api.github.com/repos/apache/iceberg/issues/922","id":651925401,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTkyNTQwMQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-30T17:07:02Z","updated_at":"2020-06-30T17:07:02Z","author_association":"CONTRIBUTOR","body":"Thanks for the update, @jun-he! I'll take a look.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651925401/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651958929","html_url":"https://github.com/apache/iceberg/issues/1138#issuecomment-651958929","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1138","id":651958929,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MTk1ODkyOQ==","user":{"login":"gustavoatt","id":1475634,"node_id":"MDQ6VXNlcjE0NzU2MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/1475634?v=4","gravatar_id":"","url":"https://api.github.com/users/gustavoatt","html_url":"https://github.com/gustavoatt","followers_url":"https://api.github.com/users/gustavoatt/followers","following_url":"https://api.github.com/users/gustavoatt/following{/other_user}","gists_url":"https://api.github.com/users/gustavoatt/gists{/gist_id}","starred_url":"https://api.github.com/users/gustavoatt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gustavoatt/subscriptions","organizations_url":"https://api.github.com/users/gustavoatt/orgs","repos_url":"https://api.github.com/users/gustavoatt/repos","events_url":"https://api.github.com/users/gustavoatt/events{/privacy}","received_events_url":"https://api.github.com/users/gustavoatt/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-06-30T18:13:21Z","updated_at":"2020-06-30T18:13:21Z","author_association":"CONTRIBUTOR","body":"Here is the [spark code](https://github.com/apache/spark/blob/d66a4e82eceb89a274edeb22c2fb4384bed5078b/sql/core/src/main/scala/org/apache/spark/sql/execution/datasources/parquet/ParquetWriteSupport.scala#L171-L178) that writes int96 timestamps.\r\n\r\nThere is some discussion on [SPARK-12297](https://issues.apache.org/jira/browse/SPARK-12297) about having Spark int96 timestamps to work correctly with Hive & Impala.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/651958929/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652117056","html_url":"https://github.com/apache/iceberg/pull/1137#issuecomment-652117056","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1137","id":652117056,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjExNzA1Ng==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-01T00:28:43Z","updated_at":"2020-07-01T00:28:43Z","author_association":"CONTRIBUTOR","body":"I'm closing this because most of the changes are in #1147. Remaining changes will be split out into separate PRs to add tests and catalog namespace support.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652117056/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652161470","html_url":"https://github.com/apache/iceberg/issues/1148#issuecomment-652161470","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1148","id":652161470,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjE2MTQ3MA==","user":{"login":"stevenzwu","id":1545663,"node_id":"MDQ6VXNlcjE1NDU2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1545663?v=4","gravatar_id":"","url":"https://api.github.com/users/stevenzwu","html_url":"https://github.com/stevenzwu","followers_url":"https://api.github.com/users/stevenzwu/followers","following_url":"https://api.github.com/users/stevenzwu/following{/other_user}","gists_url":"https://api.github.com/users/stevenzwu/gists{/gist_id}","starred_url":"https://api.github.com/users/stevenzwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevenzwu/subscriptions","organizations_url":"https://api.github.com/users/stevenzwu/orgs","repos_url":"https://api.github.com/users/stevenzwu/repos","events_url":"https://api.github.com/users/stevenzwu/events{/privacy}","received_events_url":"https://api.github.com/users/stevenzwu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-01T03:11:42Z","updated_at":"2020-07-01T03:11:42Z","author_association":"CONTRIBUTOR","body":"this is obsoleted by https://github.com/apache/iceberg/pull/840/files","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652161470/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652224477","html_url":"https://github.com/apache/iceberg/issues/1150#issuecomment-652224477","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1150","id":652224477,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjIyNDQ3Nw==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-01T06:41:23Z","updated_at":"2020-07-01T06:41:23Z","author_association":"MEMBER","body":"Well, seems we only have `hive catalog` examples. Sure, I think it will be helpful for users if we provide the hadoop catalogs example. \r\nIf you'd like to prepare a pull request, then please go ahead. \r\nThanks.\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652224477/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652252505","html_url":"https://github.com/apache/iceberg/issues/1150#issuecomment-652252505","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1150","id":652252505,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjI1MjUwNQ==","user":{"login":"zhangdove","id":25578853,"node_id":"MDQ6VXNlcjI1NTc4ODUz","avatar_url":"https://avatars.githubusercontent.com/u/25578853?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangdove","html_url":"https://github.com/zhangdove","followers_url":"https://api.github.com/users/zhangdove/followers","following_url":"https://api.github.com/users/zhangdove/following{/other_user}","gists_url":"https://api.github.com/users/zhangdove/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangdove/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangdove/subscriptions","organizations_url":"https://api.github.com/users/zhangdove/orgs","repos_url":"https://api.github.com/users/zhangdove/repos","events_url":"https://api.github.com/users/zhangdove/events{/privacy}","received_events_url":"https://api.github.com/users/zhangdove/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-01T07:45:25Z","updated_at":"2020-07-01T07:45:25Z","author_association":"CONTRIBUTOR","body":"Thanks for quick response. I have add a PR [1151](https://github.com/apache/iceberg/pull/1151).","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652252505/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652416692","html_url":"https://github.com/apache/iceberg/pull/1103#issuecomment-652416692","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1103","id":652416692,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjQxNjY5Mg==","user":{"login":"massdosage","id":29457,"node_id":"MDQ6VXNlcjI5NDU3","avatar_url":"https://avatars.githubusercontent.com/u/29457?v=4","gravatar_id":"","url":"https://api.github.com/users/massdosage","html_url":"https://github.com/massdosage","followers_url":"https://api.github.com/users/massdosage/followers","following_url":"https://api.github.com/users/massdosage/following{/other_user}","gists_url":"https://api.github.com/users/massdosage/gists{/gist_id}","starred_url":"https://api.github.com/users/massdosage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/massdosage/subscriptions","organizations_url":"https://api.github.com/users/massdosage/orgs","repos_url":"https://api.github.com/users/massdosage/repos","events_url":"https://api.github.com/users/massdosage/events{/privacy}","received_events_url":"https://api.github.com/users/massdosage/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-01T13:25:12Z","updated_at":"2020-07-01T13:25:12Z","author_association":"CONTRIBUTOR","body":"@rdblue thanks for the comments in the review, we've implemented or replied to all of them. Could you please take another look?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652416692/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652519017","html_url":"https://github.com/apache/iceberg/pull/1103#issuecomment-652519017","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1103","id":652519017,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjUxOTAxNw==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-01T16:24:05Z","updated_at":"2020-07-01T16:24:05Z","author_association":"CONTRIBUTOR","body":"I had a couple of minor comments, but we can fix those later. I'm going to merge this to unblock the next steps. Thanks @cmathiesen, @massdosage, @guilload, and everyone that reviewed!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652519017/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652598657","html_url":"https://github.com/apache/iceberg/issues/1155#issuecomment-652598657","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1155","id":652598657,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjU5ODY1Nw==","user":{"login":"guilload","id":3011588,"node_id":"MDQ6VXNlcjMwMTE1ODg=","avatar_url":"https://avatars.githubusercontent.com/u/3011588?v=4","gravatar_id":"","url":"https://api.github.com/users/guilload","html_url":"https://github.com/guilload","followers_url":"https://api.github.com/users/guilload/followers","following_url":"https://api.github.com/users/guilload/following{/other_user}","gists_url":"https://api.github.com/users/guilload/gists{/gist_id}","starred_url":"https://api.github.com/users/guilload/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guilload/subscriptions","organizations_url":"https://api.github.com/users/guilload/orgs","repos_url":"https://api.github.com/users/guilload/repos","events_url":"https://api.github.com/users/guilload/events{/privacy}","received_events_url":"https://api.github.com/users/guilload/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-01T19:13:50Z","updated_at":"2020-07-01T19:14:44Z","author_association":"CONTRIBUTOR","body":"I have some thoughts regarding this. Now that the SerDe has been merged, there are two pieces of code that do essentially the same thing:\r\n- [IcebergInputFormat.findTable(...)](https://github.com/apache/iceberg/blob/master/mr/src/main/java/org/apache/iceberg/mr/mapreduce/IcebergInputFormat.java#L357)\r\n- [TableResolver.resolveTableFromConfiguration(...)](https://github.com/apache/iceberg/blob/master/mr/src/main/java/org/apache/iceberg/mr/mapred/TableResolver.java#L45)\r\n\r\n1. Those two classes should probably be consolidated into one.\r\n2. The ability to define a custom catalog loader is neat. We actually use our own catalog at Airbnb and that feature comes in handy.\r\n3. At the same time, most users are going to use either the default Hadoop or Hive catalogs, so let's make it easy for them.\r\n4. I'm personally not a fan of using  a \"table path\" configuration property to pass either a file path or a table identifier and have to look for the `/` character  to know which use is intended.\r\n\r\nRoughly, I have something like that in mind:\r\n\r\n```python\r\ndef find_table(conf)\r\n  assert conf.get('table.identifier') is None or conf.get('table.path') is None\r\n  assert conf.get('catalog') is None or conf.get('catalog.loader.class') is None\r\n\r\n  if conf.get('table.path'):\r\n    return HadoopTables.load(conf.get('table.path'))\r\n\r\n  if conf.get('catalog.loader.class'):\r\n    loader = load_class(conf.get('catalog.loader.class'))\r\n    return loader.load(conf)\r\n\r\n  identifier = conf.get('table.identifier')\r\n\r\n  if (conf.get('catalog') == 'hadoop'):\r\n    return HadoopCatalog.load(identifier)\r\n  elif (conf.get('catalog') == 'hive'):\r\n    return HiveCatalog.load(identifier)\r\n  else:\r\n    raise ...\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652598657/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652601748","html_url":"https://github.com/apache/iceberg/issues/1155#issuecomment-652601748","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1155","id":652601748,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjYwMTc0OA==","user":{"login":"rdsr","id":129474,"node_id":"MDQ6VXNlcjEyOTQ3NA==","avatar_url":"https://avatars.githubusercontent.com/u/129474?v=4","gravatar_id":"","url":"https://api.github.com/users/rdsr","html_url":"https://github.com/rdsr","followers_url":"https://api.github.com/users/rdsr/followers","following_url":"https://api.github.com/users/rdsr/following{/other_user}","gists_url":"https://api.github.com/users/rdsr/gists{/gist_id}","starred_url":"https://api.github.com/users/rdsr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdsr/subscriptions","organizations_url":"https://api.github.com/users/rdsr/orgs","repos_url":"https://api.github.com/users/rdsr/repos","events_url":"https://api.github.com/users/rdsr/events{/privacy}","received_events_url":"https://api.github.com/users/rdsr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-01T19:21:16Z","updated_at":"2020-07-01T19:21:16Z","author_association":"CONTRIBUTOR","body":"I had something similar in mind.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652601748/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652636874","html_url":"https://github.com/apache/iceberg/pull/577#issuecomment-652636874","issue_url":"https://api.github.com/repos/apache/iceberg/issues/577","id":652636874,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjYzNjg3NA==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-01T20:43:30Z","updated_at":"2020-07-01T20:43:30Z","author_association":"CONTRIBUTOR","body":"I think this is finally unblocked. We now have Spark 2 and Spark 3 modules in master, so we could add tests with Java 11 that disable the Spark 2 modules.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652636874/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652665366","html_url":"https://github.com/apache/iceberg/pull/1147#issuecomment-652665366","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1147","id":652665366,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjY2NTM2Ng==","user":{"login":"danielcweeks","id":4925077,"node_id":"MDQ6VXNlcjQ5MjUwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4925077?v=4","gravatar_id":"","url":"https://api.github.com/users/danielcweeks","html_url":"https://github.com/danielcweeks","followers_url":"https://api.github.com/users/danielcweeks/followers","following_url":"https://api.github.com/users/danielcweeks/following{/other_user}","gists_url":"https://api.github.com/users/danielcweeks/gists{/gist_id}","starred_url":"https://api.github.com/users/danielcweeks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielcweeks/subscriptions","organizations_url":"https://api.github.com/users/danielcweeks/orgs","repos_url":"https://api.github.com/users/danielcweeks/repos","events_url":"https://api.github.com/users/danielcweeks/events{/privacy}","received_events_url":"https://api.github.com/users/danielcweeks/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-01T21:54:19Z","updated_at":"2020-07-01T21:54:19Z","author_association":"CONTRIBUTOR","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652665366/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652677542","html_url":"https://github.com/apache/iceberg/pull/1149#issuecomment-652677542","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1149","id":652677542,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjY3NzU0Mg==","user":{"login":"danielcweeks","id":4925077,"node_id":"MDQ6VXNlcjQ5MjUwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4925077?v=4","gravatar_id":"","url":"https://api.github.com/users/danielcweeks","html_url":"https://github.com/danielcweeks","followers_url":"https://api.github.com/users/danielcweeks/followers","following_url":"https://api.github.com/users/danielcweeks/following{/other_user}","gists_url":"https://api.github.com/users/danielcweeks/gists{/gist_id}","starred_url":"https://api.github.com/users/danielcweeks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielcweeks/subscriptions","organizations_url":"https://api.github.com/users/danielcweeks/orgs","repos_url":"https://api.github.com/users/danielcweeks/repos","events_url":"https://api.github.com/users/danielcweeks/events{/privacy}","received_events_url":"https://api.github.com/users/danielcweeks/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-01T22:29:40Z","updated_at":"2020-07-01T22:29:40Z","author_association":"CONTRIBUTOR","body":"LGTM, but some checkstyle failures in CI?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652677542/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652684932","html_url":"https://github.com/apache/iceberg/pull/1149#issuecomment-652684932","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1149","id":652684932,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjY4NDkzMg==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-01T22:55:06Z","updated_at":"2020-07-01T22:55:06Z","author_association":"CONTRIBUTOR","body":"Thanks for pointing that out. I've pushed a fix for checkstyle.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652684932/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652697389","html_url":"https://github.com/apache/iceberg/pull/1149#issuecomment-652697389","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1149","id":652697389,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjY5NzM4OQ==","user":{"login":"danielcweeks","id":4925077,"node_id":"MDQ6VXNlcjQ5MjUwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4925077?v=4","gravatar_id":"","url":"https://api.github.com/users/danielcweeks","html_url":"https://github.com/danielcweeks","followers_url":"https://api.github.com/users/danielcweeks/followers","following_url":"https://api.github.com/users/danielcweeks/following{/other_user}","gists_url":"https://api.github.com/users/danielcweeks/gists{/gist_id}","starred_url":"https://api.github.com/users/danielcweeks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielcweeks/subscriptions","organizations_url":"https://api.github.com/users/danielcweeks/orgs","repos_url":"https://api.github.com/users/danielcweeks/repos","events_url":"https://api.github.com/users/danielcweeks/events{/privacy}","received_events_url":"https://api.github.com/users/danielcweeks/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-01T23:40:14Z","updated_at":"2020-07-01T23:40:14Z","author_association":"CONTRIBUTOR","body":"+1 (pending checks)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652697389/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652698487","html_url":"https://github.com/apache/iceberg/pull/1149#issuecomment-652698487","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1149","id":652698487,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjY5ODQ4Nw==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-01T23:44:27Z","updated_at":"2020-07-01T23:44:27Z","author_association":"CONTRIBUTOR","body":"I ran the checks locally since our Travis queue seems backed up today. Thanks for the review, @danielcweeks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652698487/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652714999","html_url":"https://github.com/apache/iceberg/pull/1140#issuecomment-652714999","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1140","id":652714999,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjcxNDk5OQ==","user":{"login":"edgarRd","id":266670,"node_id":"MDQ6VXNlcjI2NjY3MA==","avatar_url":"https://avatars.githubusercontent.com/u/266670?v=4","gravatar_id":"","url":"https://api.github.com/users/edgarRd","html_url":"https://github.com/edgarRd","followers_url":"https://api.github.com/users/edgarRd/followers","following_url":"https://api.github.com/users/edgarRd/following{/other_user}","gists_url":"https://api.github.com/users/edgarRd/gists{/gist_id}","starred_url":"https://api.github.com/users/edgarRd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edgarRd/subscriptions","organizations_url":"https://api.github.com/users/edgarRd/orgs","repos_url":"https://api.github.com/users/edgarRd/repos","events_url":"https://api.github.com/users/edgarRd/events{/privacy}","received_events_url":"https://api.github.com/users/edgarRd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T00:44:32Z","updated_at":"2020-07-02T00:44:32Z","author_association":"CONTRIBUTOR","body":"@rdblue @rdsr I've made the changes in the comments, PTAL when you have a chance.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652714999/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652720632","html_url":"https://github.com/apache/iceberg/pull/1140#issuecomment-652720632","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1140","id":652720632,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjcyMDYzMg==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T01:07:16Z","updated_at":"2020-07-02T01:07:16Z","author_association":"CONTRIBUTOR","body":"@edgarRd, this looks good to me. The only problem is with the tests, which assert sizes instead of schema structure. I think it's probably best to be more specific about _which_ fields are converted.\r\n\r\nYou may also consider moving the conversion visitor out of the util class and into its own file.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652720632/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652771218","html_url":"https://github.com/apache/iceberg/pull/1125#issuecomment-652771218","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1125","id":652771218,"node_id":"MDEyOklzc3VlQ29tbWVudDY1Mjc3MTIxOA==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T04:14:36Z","updated_at":"2020-07-02T04:14:36Z","author_association":"MEMBER","body":"@rdblue , Seems it's more clearer to abstract the generic logics in a separate `BaseParquetReader<T>` and make the `RecordParquetReader` to extend it.  I implemented this in https://github.com/apache/iceberg/pull/1158, you may want to take a look. Thanks. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652771218/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652816714","html_url":"https://github.com/apache/iceberg/issues/1113#issuecomment-652816714","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1113","id":652816714,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjgxNjcxNA==","user":{"login":"edgarRd","id":266670,"node_id":"MDQ6VXNlcjI2NjY3MA==","avatar_url":"https://avatars.githubusercontent.com/u/266670?v=4","gravatar_id":"","url":"https://api.github.com/users/edgarRd","html_url":"https://github.com/edgarRd","followers_url":"https://api.github.com/users/edgarRd/followers","following_url":"https://api.github.com/users/edgarRd/following{/other_user}","gists_url":"https://api.github.com/users/edgarRd/gists{/gist_id}","starred_url":"https://api.github.com/users/edgarRd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edgarRd/subscriptions","organizations_url":"https://api.github.com/users/edgarRd/orgs","repos_url":"https://api.github.com/users/edgarRd/repos","events_url":"https://api.github.com/users/edgarRd/events{/privacy}","received_events_url":"https://api.github.com/users/edgarRd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T06:44:40Z","updated_at":"2020-07-02T06:44:40Z","author_association":"CONTRIBUTOR","body":"Can we close this issue if fixed?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652816714/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652817094","html_url":"https://github.com/apache/iceberg/issues/1116#issuecomment-652817094","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1116","id":652817094,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjgxNzA5NA==","user":{"login":"edgarRd","id":266670,"node_id":"MDQ6VXNlcjI2NjY3MA==","avatar_url":"https://avatars.githubusercontent.com/u/266670?v=4","gravatar_id":"","url":"https://api.github.com/users/edgarRd","html_url":"https://github.com/edgarRd","followers_url":"https://api.github.com/users/edgarRd/followers","following_url":"https://api.github.com/users/edgarRd/following{/other_user}","gists_url":"https://api.github.com/users/edgarRd/gists{/gist_id}","starred_url":"https://api.github.com/users/edgarRd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edgarRd/subscriptions","organizations_url":"https://api.github.com/users/edgarRd/orgs","repos_url":"https://api.github.com/users/edgarRd/repos","events_url":"https://api.github.com/users/edgarRd/events{/privacy}","received_events_url":"https://api.github.com/users/edgarRd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T06:45:41Z","updated_at":"2020-07-02T06:45:41Z","author_association":"CONTRIBUTOR","body":"Can we close this issue? Fix has been merged. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652817094/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652831735","html_url":"https://github.com/apache/iceberg/issues/1113#issuecomment-652831735","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1113","id":652831735,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjgzMTczNQ==","user":{"login":"massdosage","id":29457,"node_id":"MDQ6VXNlcjI5NDU3","avatar_url":"https://avatars.githubusercontent.com/u/29457?v=4","gravatar_id":"","url":"https://api.github.com/users/massdosage","html_url":"https://github.com/massdosage","followers_url":"https://api.github.com/users/massdosage/followers","following_url":"https://api.github.com/users/massdosage/following{/other_user}","gists_url":"https://api.github.com/users/massdosage/gists{/gist_id}","starred_url":"https://api.github.com/users/massdosage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/massdosage/subscriptions","organizations_url":"https://api.github.com/users/massdosage/orgs","repos_url":"https://api.github.com/users/massdosage/repos","events_url":"https://api.github.com/users/massdosage/events{/privacy}","received_events_url":"https://api.github.com/users/massdosage/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T07:19:51Z","updated_at":"2020-07-02T07:19:51Z","author_association":"CONTRIBUTOR","body":"Yes, I merged master into the forks/branches where we saw these issues and the tests now pass.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652831735/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652844652","html_url":"https://github.com/apache/iceberg/issues/1155#issuecomment-652844652","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1155","id":652844652,"node_id":"MDEyOklzc3VlQ29tbWVudDY1Mjg0NDY1Mg==","user":{"login":"massdosage","id":29457,"node_id":"MDQ6VXNlcjI5NDU3","avatar_url":"https://avatars.githubusercontent.com/u/29457?v=4","gravatar_id":"","url":"https://api.github.com/users/massdosage","html_url":"https://github.com/massdosage","followers_url":"https://api.github.com/users/massdosage/followers","following_url":"https://api.github.com/users/massdosage/following{/other_user}","gists_url":"https://api.github.com/users/massdosage/gists{/gist_id}","starred_url":"https://api.github.com/users/massdosage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/massdosage/subscriptions","organizations_url":"https://api.github.com/users/massdosage/orgs","repos_url":"https://api.github.com/users/massdosage/repos","events_url":"https://api.github.com/users/massdosage/events{/privacy}","received_events_url":"https://api.github.com/users/massdosage/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T07:46:07Z","updated_at":"2020-07-02T07:46:07Z","author_association":"CONTRIBUTOR","body":"This is on our TODO list but we were only going to start looking at it properly after the `mapred` InputFormat is merged. The above suggestion to merge the code and the logic outlined above looks good. If someone else wants to start working on this now that's fine by me.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652844652/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652859150","html_url":"https://github.com/apache/iceberg/issues/1160#issuecomment-652859150","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1160","id":652859150,"node_id":"MDEyOklzc3VlQ29tbWVudDY1Mjg1OTE1MA==","user":{"login":"zhangdove","id":25578853,"node_id":"MDQ6VXNlcjI1NTc4ODUz","avatar_url":"https://avatars.githubusercontent.com/u/25578853?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangdove","html_url":"https://github.com/zhangdove","followers_url":"https://api.github.com/users/zhangdove/followers","following_url":"https://api.github.com/users/zhangdove/following{/other_user}","gists_url":"https://api.github.com/users/zhangdove/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangdove/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangdove/subscriptions","organizations_url":"https://api.github.com/users/zhangdove/orgs","repos_url":"https://api.github.com/users/zhangdove/repos","events_url":"https://api.github.com/users/zhangdove/events{/privacy}","received_events_url":"https://api.github.com/users/zhangdove/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T08:14:51Z","updated_at":"2020-07-02T08:14:51Z","author_association":"CONTRIBUTOR","body":"I have add a PR [1161](https://github.com/apache/iceberg/pull/1161).\r\nWho can review the issue at a convenient time?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652859150/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652914516","html_url":"https://github.com/apache/iceberg/pull/1161#issuecomment-652914516","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1161","id":652914516,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MjkxNDUxNg==","user":{"login":"zhangdove","id":25578853,"node_id":"MDQ6VXNlcjI1NTc4ODUz","avatar_url":"https://avatars.githubusercontent.com/u/25578853?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangdove","html_url":"https://github.com/zhangdove","followers_url":"https://api.github.com/users/zhangdove/followers","following_url":"https://api.github.com/users/zhangdove/following{/other_user}","gists_url":"https://api.github.com/users/zhangdove/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangdove/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangdove/subscriptions","organizations_url":"https://api.github.com/users/zhangdove/orgs","repos_url":"https://api.github.com/users/zhangdove/repos","events_url":"https://api.github.com/users/zhangdove/events{/privacy}","received_events_url":"https://api.github.com/users/zhangdove/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T10:04:13Z","updated_at":"2020-07-02T10:04:13Z","author_association":"CONTRIBUTOR","body":"I added some unit test. Could you review it at your convenience? @openinx ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652914516/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652947677","html_url":"https://github.com/apache/iceberg/pull/1154#issuecomment-652947677","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1154","id":652947677,"node_id":"MDEyOklzc3VlQ29tbWVudDY1Mjk0NzY3Nw==","user":{"login":"massdosage","id":29457,"node_id":"MDQ6VXNlcjI5NDU3","avatar_url":"https://avatars.githubusercontent.com/u/29457?v=4","gravatar_id":"","url":"https://api.github.com/users/massdosage","html_url":"https://github.com/massdosage","followers_url":"https://api.github.com/users/massdosage/followers","following_url":"https://api.github.com/users/massdosage/following{/other_user}","gists_url":"https://api.github.com/users/massdosage/gists{/gist_id}","starred_url":"https://api.github.com/users/massdosage/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/massdosage/subscriptions","organizations_url":"https://api.github.com/users/massdosage/orgs","repos_url":"https://api.github.com/users/massdosage/repos","events_url":"https://api.github.com/users/massdosage/events{/privacy}","received_events_url":"https://api.github.com/users/massdosage/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T11:21:01Z","updated_at":"2020-07-02T11:21:01Z","author_association":"CONTRIBUTOR","body":"What do you think of marking `RuntimeIOException` as \"deprecated\" to encourage the usage of `UncheckedIOException` instead? Let me know, otherwise I can remove that too and just leave the `extends` part in.\r\n\r\nI've reverted everything in `api` to use `RuntimeIOException` but if you think its usages in other subprojects could also cause issues I can revert it everywhere (other than possibly a few tests which seemed to be using it but really don't need to).","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652947677/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652965209","html_url":"https://github.com/apache/iceberg/pull/796#issuecomment-652965209","issue_url":"https://api.github.com/repos/apache/iceberg/issues/796","id":652965209,"node_id":"MDEyOklzc3VlQ29tbWVudDY1Mjk2NTIwOQ==","user":{"login":"jerryshao","id":850797,"node_id":"MDQ6VXNlcjg1MDc5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/850797?v=4","gravatar_id":"","url":"https://api.github.com/users/jerryshao","html_url":"https://github.com/jerryshao","followers_url":"https://api.github.com/users/jerryshao/followers","following_url":"https://api.github.com/users/jerryshao/following{/other_user}","gists_url":"https://api.github.com/users/jerryshao/gists{/gist_id}","starred_url":"https://api.github.com/users/jerryshao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jerryshao/subscriptions","organizations_url":"https://api.github.com/users/jerryshao/orgs","repos_url":"https://api.github.com/users/jerryshao/repos","events_url":"https://api.github.com/users/jerryshao/events{/privacy}","received_events_url":"https://api.github.com/users/jerryshao/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T12:03:31Z","updated_at":"2020-07-02T12:03:31Z","author_association":"CONTRIBUTOR","body":"Thanks a lot @rdblue for the comments, I will address your comments in these days.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/652965209/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653117418","html_url":"https://github.com/apache/iceberg/pull/1157#issuecomment-653117418","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1157","id":653117418,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzExNzQxOA==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T16:52:17Z","updated_at":"2020-07-02T16:52:17Z","author_association":"CONTRIBUTOR","body":"Thanks for fixing this, @guilload!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653117418/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653117727","html_url":"https://github.com/apache/iceberg/pull/1145#issuecomment-653117727","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1145","id":653117727,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzExNzcyNw==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T16:53:00Z","updated_at":"2020-07-02T16:53:00Z","author_association":"CONTRIBUTOR","body":"I should have time to review this today or tomorrow. Thanks for getting this ready, @openinx!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653117727/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653138389","html_url":"https://github.com/apache/iceberg/pull/1140#issuecomment-653138389","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1140","id":653138389,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzEzODM4OQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T17:40:05Z","updated_at":"2020-07-02T17:40:05Z","author_association":"CONTRIBUTOR","body":"+1\r\n\r\nI'll merge this when tests pass. Thanks @edgarRd!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653138389/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653141238","html_url":"https://github.com/apache/iceberg/pull/1154#issuecomment-653141238","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1154","id":653141238,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzE0MTIzOA==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T17:46:51Z","updated_at":"2020-07-02T17:46:51Z","author_association":"CONTRIBUTOR","body":"+1 to marking `RuntimeIOException` as deprecated and nudging the user to catch `UncheckedIOException`.\r\n\r\nI think we need to revert all of the conversions, not just the ones in API. Because we're using unchecked exceptions, many of the other places this is thrown will bubble up through the API.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653141238/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653142201","html_url":"https://github.com/apache/iceberg/pull/1140#issuecomment-653142201","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1140","id":653142201,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzE0MjIwMQ==","user":{"login":"edgarRd","id":266670,"node_id":"MDQ6VXNlcjI2NjY3MA==","avatar_url":"https://avatars.githubusercontent.com/u/266670?v=4","gravatar_id":"","url":"https://api.github.com/users/edgarRd","html_url":"https://github.com/edgarRd","followers_url":"https://api.github.com/users/edgarRd/followers","following_url":"https://api.github.com/users/edgarRd/following{/other_user}","gists_url":"https://api.github.com/users/edgarRd/gists{/gist_id}","starred_url":"https://api.github.com/users/edgarRd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edgarRd/subscriptions","organizations_url":"https://api.github.com/users/edgarRd/orgs","repos_url":"https://api.github.com/users/edgarRd/repos","events_url":"https://api.github.com/users/edgarRd/events{/privacy}","received_events_url":"https://api.github.com/users/edgarRd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T17:49:08Z","updated_at":"2020-07-02T17:49:08Z","author_association":"CONTRIBUTOR","body":"Thanks for the reviews @rdblue and @rdsr!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653142201/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653182358","html_url":"https://github.com/apache/iceberg/issues/1055#issuecomment-653182358","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1055","id":653182358,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzE4MjM1OA==","user":{"login":"edgarRd","id":266670,"node_id":"MDQ6VXNlcjI2NjY3MA==","avatar_url":"https://avatars.githubusercontent.com/u/266670?v=4","gravatar_id":"","url":"https://api.github.com/users/edgarRd","html_url":"https://github.com/edgarRd","followers_url":"https://api.github.com/users/edgarRd/followers","following_url":"https://api.github.com/users/edgarRd/following{/other_user}","gists_url":"https://api.github.com/users/edgarRd/gists{/gist_id}","starred_url":"https://api.github.com/users/edgarRd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edgarRd/subscriptions","organizations_url":"https://api.github.com/users/edgarRd/orgs","repos_url":"https://api.github.com/users/edgarRd/repos","events_url":"https://api.github.com/users/edgarRd/events{/privacy}","received_events_url":"https://api.github.com/users/edgarRd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T19:24:58Z","updated_at":"2020-07-02T19:24:58Z","author_association":"CONTRIBUTOR","body":"I think we can close this issue. Thanks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653182358/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653185375","html_url":"https://github.com/apache/iceberg/issues/1152#issuecomment-653185375","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1152","id":653185375,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzE4NTM3NQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T19:32:57Z","updated_at":"2020-07-02T19:37:35Z","author_association":"CONTRIBUTOR","body":"Readers and writers are specific to an in-memory representation, which I'll inter-changeably refer to as an object model. The Avro readers and writers you're using here are for different object models: Iceberg generics and Avro.\r\n\r\nThe `data.avro.DataReader` and `data.avro.DataWriter` classes were written for the Iceberg generics data model. That uses Iceberg's generic record class, Java 8 date/time types, BigDecimal, ByteBuffer, and byte[]. This representation is intended for application authors working directly with Iceberg API. That's why it uses standard Java representations for most types.\r\n\r\nThe `avro.GenericAvroReader` and `avro.GenericAvroWriter` classes are for working with Avro's generic or specific records. That's why this produces `GenericData.Record` or instances of specific classes that all implement Avro's `IndexedRecord`. This is intended for internal use -- internal implementations of `DataFile` and `ManifestFile` use `IndexedRecord` -- so it produces the internal representations, like `BigDecimal`, long microseconds from epoch, or int days from epoch.\r\n\r\nUnfortunately, early on we left the generic Avro reader/writer implementation public in core and have some downstream uses, like the original Netflix Flink sink. I think we should eventually remove Avro from the public API. I would also like to remove it and make `DataFile` and `ManifestFile` implement our own `Record` API, but we would need to have a reader that produces the internal value representations.\r\n\r\nFor Flink, we should build reader/writer classes that produce and consume its in-memory representation. That's what we do for Spark and Pig. Based on the Parquet support in #1125, I thought that Flink uses Java 8 date/time classes, BigDecimal, and ByteBuffer, so it would make sense to base the readers on Iceberg generics. In that case, basing your implementation on `data.avro.DataReader` and `data.avro.DataWriter` should work fine.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653185375/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653186558","html_url":"https://github.com/apache/iceberg/issues/1055#issuecomment-653186558","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1055","id":653186558,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzE4NjU1OA==","user":{"login":"rdsr","id":129474,"node_id":"MDQ6VXNlcjEyOTQ3NA==","avatar_url":"https://avatars.githubusercontent.com/u/129474?v=4","gravatar_id":"","url":"https://api.github.com/users/rdsr","html_url":"https://github.com/rdsr","followers_url":"https://api.github.com/users/rdsr/followers","following_url":"https://api.github.com/users/rdsr/following{/other_user}","gists_url":"https://api.github.com/users/rdsr/gists{/gist_id}","starred_url":"https://api.github.com/users/rdsr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdsr/subscriptions","organizations_url":"https://api.github.com/users/rdsr/orgs","repos_url":"https://api.github.com/users/rdsr/repos","events_url":"https://api.github.com/users/rdsr/events{/privacy}","received_events_url":"https://api.github.com/users/rdsr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T19:35:51Z","updated_at":"2020-07-02T19:35:51Z","author_association":"CONTRIBUTOR","body":"Thanks @edgarRd !","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653186558/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653189327","html_url":"https://github.com/apache/iceberg/pull/1162#issuecomment-653189327","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1162","id":653189327,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzE4OTMyNw==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T19:42:41Z","updated_at":"2020-07-02T19:42:41Z","author_association":"CONTRIBUTOR","body":"Looks good to me. Thanks for the refactor, @openinx!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653189327/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653194140","html_url":"https://github.com/apache/iceberg/pull/1153#issuecomment-653194140","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1153","id":653194140,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzE5NDE0MA==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-02T19:55:02Z","updated_at":"2020-07-02T19:55:02Z","author_association":"CONTRIBUTOR","body":"Looks good overall. Mainly, I think we should have this run through the projection test to ensure we don't have future regressions.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653194140/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653281824","html_url":"https://github.com/apache/iceberg/issues/360#issuecomment-653281824","issue_url":"https://api.github.com/repos/apache/iceberg/issues/360","id":653281824,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzI4MTgyNA==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-03T01:18:50Z","updated_at":"2020-07-03T01:19:17Z","author_association":"CONTRIBUTOR","body":"I think we're in agreement on a few points for moving forward:\r\n\r\n* We will use a static schema for equality deletes\r\n* We need to be able to reconstruct an equivalent stream of changes for streaming CDC pipelines\r\n* We should add a way to encode all of the columns for an equality delete and identify the subset used for deletion (for efficiency)\r\n* We may need to add a way to encode all columns into position delete files (if used for CDC)\r\n* For the CDC case, we'll first assume that we have the entire deleted row in delete events\r\n* We should handle a stream of upserts as a separate use case\r\n\r\nThe doc describes ways to use both equality and position deletes for CDC streams. Sounds like equality would be ideal if (1) events have a unique ID, and (2) the execution has exactly-once semantics. Otherwise, I think it is possible to use position deletes. Which do you plan to target?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653281824/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653313170","html_url":"https://github.com/apache/iceberg/issues/1152#issuecomment-653313170","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1152","id":653313170,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzMxMzE3MA==","user":{"login":"chenjunjiedada","id":3960228,"node_id":"MDQ6VXNlcjM5NjAyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3960228?v=4","gravatar_id":"","url":"https://api.github.com/users/chenjunjiedada","html_url":"https://github.com/chenjunjiedada","followers_url":"https://api.github.com/users/chenjunjiedada/followers","following_url":"https://api.github.com/users/chenjunjiedada/following{/other_user}","gists_url":"https://api.github.com/users/chenjunjiedada/gists{/gist_id}","starred_url":"https://api.github.com/users/chenjunjiedada/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenjunjiedada/subscriptions","organizations_url":"https://api.github.com/users/chenjunjiedada/orgs","repos_url":"https://api.github.com/users/chenjunjiedada/repos","events_url":"https://api.github.com/users/chenjunjiedada/events{/privacy}","received_events_url":"https://api.github.com/users/chenjunjiedada/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-03T03:03:40Z","updated_at":"2020-07-03T03:03:40Z","author_association":"COLLABORATOR","body":"Thanks @openinx to bring this out. I will try to work on this.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653313170/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653449112","html_url":"https://github.com/apache/iceberg/pull/1145#issuecomment-653449112","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1145","id":653449112,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzQ0OTExMg==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-03T09:27:16Z","updated_at":"2020-07-03T09:27:16Z","author_association":"MEMBER","body":"Thanks  for your reviewing, @JingsongLi   let me take a look. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653449112/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653501110","html_url":"https://github.com/apache/iceberg/issues/360#issuecomment-653501110","issue_url":"https://api.github.com/repos/apache/iceberg/issues/360","id":653501110,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzUwMTExMA==","user":{"login":"JingsongLi","id":9601882,"node_id":"MDQ6VXNlcjk2MDE4ODI=","avatar_url":"https://avatars.githubusercontent.com/u/9601882?v=4","gravatar_id":"","url":"https://api.github.com/users/JingsongLi","html_url":"https://github.com/JingsongLi","followers_url":"https://api.github.com/users/JingsongLi/followers","following_url":"https://api.github.com/users/JingsongLi/following{/other_user}","gists_url":"https://api.github.com/users/JingsongLi/gists{/gist_id}","starred_url":"https://api.github.com/users/JingsongLi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JingsongLi/subscriptions","organizations_url":"https://api.github.com/users/JingsongLi/orgs","repos_url":"https://api.github.com/users/JingsongLi/repos","events_url":"https://api.github.com/users/JingsongLi/events{/privacy}","received_events_url":"https://api.github.com/users/JingsongLi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-03T11:28:10Z","updated_at":"2020-07-03T11:40:45Z","author_association":"CONTRIBUTOR","body":"Thanks for your discussion and summary. Sorry for joining this discussion lately. Here is my thinking, correct me if I am wrong:\r\nIIUC, there can be two user oriented modes for equality delete: \r\n\r\n## Mode1\r\nIceberg as a database: Users can using SQLs to query this iceberg table: \"insert into\", \"update ... where x=a”, \"delete from where x=a“. For equality delete, with high performance, iceberg should just writes number of physical records at constant level for these SQLs.\r\n\r\nWhat is the solution for mode1?\r\n- For an iceberg transaction, just writing logs, including inserts and deletes, but merging efficiency looks not good.\r\n- For an iceberg transaction, just writing inserts file and equality deletes file: Looks not work, consider insert(1, 2), delete(1, 2),   insert(1, 2). If there just be inserts file and deletes file, it is hard to know we need emit an insert(1, 2) after merging. In other words, we can't distinguish the order between inserts and deletes.\r\n- For an iceberg transaction, writing inserts file and equality deletes file and position deletes file. For a delete(1, 2), we may should write this record to both equality deletes file and position deletes file, because a delete should delete records from old files, and also delete records in this transaction in ordered. When merging, old transactions can just join equality deletes file is OK.\r\nThe equality deletes file could just have the key fields. The position deletes file should just have file_id and position.\r\n\r\n## Mode2\r\nIceberg as a CDC receiver: Theoretically, every records from CDC stream should just affect single record to Database.\r\n- CDC with primary key(unique ID), iceberg can let it affect all records to Database too. The semantics are the same.\r\n- CDC without primary key(unique ID), it is hard to implement for this too, store all fields in memory looks expensive, and maybe need some special merging algorithm, I think it maybe too demanding.\r\nShould support both batch reading and streaming reading for CDC input stream, and also producing CDC stream for streaming reading too.\r\n\r\nWhat is the solution for mode2?\r\n- For batch reading: The solution can be similar to mode1. As above said, with primary key(unique ID), CDC records can affect all records to Database too, so,  it can be treated as a mode1 stream.\r\n- For streaming reading: If we want to output CDC stream, a CDC stream should include delete records with all columns, so in equality deletes files, should have all the columns.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653501110/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653532308","html_url":"https://github.com/apache/iceberg/issues/360#issuecomment-653532308","issue_url":"https://api.github.com/repos/apache/iceberg/issues/360","id":653532308,"node_id":"MDEyOklzc3VlQ29tbWVudDY1MzUzMjMwOA==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-07-03T12:48:19Z","updated_at":"2020-07-03T12:48:19Z","author_association":"MEMBER","body":"@rdblue, our team also had another discussion about the user cases and solutions. For the user cases, we have three cases: \r\n\r\n* Case.1: the table has a primary key(the unique ID as you said), and all CDC events are INSERT/UPDATE/DELETE operations(the UPDATE event has both old values and new values). Such as the classic MySQL binlog events (assuming that t have (id, data) columns and id is the primary key): \r\n\r\n```sql\r\nINERT INTO t SET @1=1 @2='apple';\r\nDELETE FROM t WHERE @1=1 @2='apple';\r\nUPDATE t WHERE @1=1 @2='apple' SET @1=1 @2='pear';\r\n```\r\n\r\n* Case.2: the table has a primary key, and all CDC events are UPSERT/DELETE, the UPSERT don't have to provide old values. such as: \r\n\r\n```sql\r\nUPSERT(1, 'apple')\r\nDELETE(1, 'apple')\r\nDELETE(1) // DELETE don't have to provide all the column values, the primary key is enough.\r\n```\r\n\r\n* Case.3: the table don't have a primary key, all CDC events are INSERT/UPDATE/DELETE(UPDATE should provide both old values and new values). Supporting UPSERT without old values is impossible.\r\n\r\nThe three cases should match the CDC requirements from users, and we have the three goals to meet the requirements: 1) Fast ingestion; 2) Acceptable Batch Read performance; 3) an equivalent stream so that we could keep the eventual consistency between source table and sink table. \r\n\r\nNow, we have three solutions: \r\n\r\n1. The mixed equality-deletes and pos-deletes solution as you proposed. \r\n2. The pure postional-deletes I described in the document.\r\n3. The incremental log files solution. \r\n\r\nIn summary, the solution#2 and solution#3 resovled the before-after order for downstream, but they both have few issues about batch read performance. The solution #2 will need to check whether there exist a delete row whose `<file_id, offset>` isn't less than the candinate row's in INSERT data files, it will use a data structure like `HashMap<primaryKey, TreeSet<T>>`(maintain those delete marker) to implement the `JOIN` algorithm. It don't need any `map<primary_key, pos>` when writing but solution#1 need, while the solution#1 is more simple when considering merge read.\r\n\r\nThe solution#3 will need to do `JOIN` between the newly written INSERT while the solution#1 will only `JOIN` between INSERT and DELETE. \r\n\r\nFor solution#1, the problem is: how to reconstruct the stream events which could replay to downstream corrently ?  We could take an example, the CDC events: \r\n\r\n```\r\nt0, INSERT(1,2)\r\nt1, DELETE(2,2)\r\nt2, UPSERT(1,3)\r\n(The first field is primary key)\r\n```\r\n\r\nIt will generate three files: \r\n\r\n* the INSERT file will have: \r\n\r\n```\r\nINSERT(1,2)\r\nINSERT(1,3)\r\n```\r\n\r\n* the equality-delete file will have: \r\n\r\n```\r\nDELETE(2,2)\r\n```\r\n\r\n* the postional-delete file will have: \r\n\r\n```\r\n<data-file=insert-file-id, position=0, primary_key_column=1>\r\n```\r\n\r\nNOTICE: here we add the `primary_key_column=1` in positional-delete file because if it's `UPSERT` then the DELETE(1,2) should also mask the data files who have a smaller sequence number. Keeping the primary key value here could avoid to searching the original insert data file for comparing primary key when doing `JOIN` between data file and delete file.\r\n\r\nNow let's consider the replay issue again, we could regard the equality-delete file are deleting existed rows before this transaction, so it should be replayed firstly. Then we could restore the correct event order by JOIN INSERT file and positional-delete file. In theory, we could maintain the eventual consistency between source table and sink table because we gurantee: \r\n\r\n1. Events of the same row will be consumed exactly as the order they are written in the source table.\r\n2. We don’t guarantee the consumption order of different rows.\r\n3. If an UPDATE event updates from one row to another row, then we don’t guarantee the before-after order between two rows. \r\n\r\nSo seems the solution#1 could be a candidate solution for the primary key case#1 and case#2.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/653532308/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]