[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305745344","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-305745344","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":305745344,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc0NTM0NA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T10:03:13Z","updated_at":"2017-06-02T10:03:13Z","author_association":"MEMBER","body":"Let’s see if https://github.com/apache/couchdb/pull/562 fixes this.\r\n\r\n@wohali IIRC this has to be merged to master before we see it in Jenkins, right?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305745344/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305747398","html_url":"https://github.com/apache/couchdb/issues/559#issuecomment-305747398","issue_url":"https://api.github.com/repos/apache/couchdb/issues/559","id":305747398,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc0NzM5OA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T10:13:13Z","updated_at":"2017-06-02T10:13:13Z","author_association":"MEMBER","body":"I’m generally weary of disabling tests, but I think it is warranted in this case.\r\n\r\n1. This looks like a change that should have been marked as a BC break coming from 1.x to 2.x and I’d suggest we’d retroactively mark it as such. It would have been great to have found it earlier, but we made a conscious decision to keep some tests disabled i favour of getting 2.0 out the door. I’d make that trade-off again, but it is time to clean up now.\r\n\r\n2. Disabling the cache for the test doesn't help anyone using this in production. This is adding and edge-case to the server to make tests pass, while the server default will be different. I don’t see how this is useful, when most people then would get the “broken” behaviour in practice. (That said, I’m +1ing [the proposed change to ddoc_cache](https://github.com/apache/couchdb/pull/561) so it *can* be disabled. This will be useful for debugging at least).\r\n\r\n3. I can’t comment on ddoc_cache, but I could see that making that sync will cause all sorts of issues. It might even be impossible to do because of the CAP-nature of CouchDB, e.g. I think we would have to make ddoc_cache sync across all nodes in a cluster, and that’s not something we have the underlying mechanics for (nor do we want them, mostly).\r\n\r\n4. This is a *very* niche feature that I don’t think many people depend upon. I believe we put this behaviour in when we were trying to advocate building web apps directly against CouchDB which we’ve largely moved away from.\r\n\r\nAs such, I’d suggest we:\r\n\r\n1. delete the test in question from 2.x.\r\n2. document this as a BC break for 1.x to 2.x (that we only discovered past 2.0).\r\n3. get over our institutional aversion against the JS test suite, which time and time again finds real issues in CouchDB 2.x, and focus on getting all currently disabled JS tests enabled to flush out these issues.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305747398/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305748499","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-305748499","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":305748499,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc0ODQ5OQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T10:18:52Z","updated_at":"2017-06-02T10:18:52Z","author_association":"MEMBER","body":"Hah, ok, looking closer now, this can’t work.\r\n\r\n@davisp line 54 relies on `State` which is only bound in line 50.\r\n\r\nI’m not too deep in the code, is what you meant adding the `erlang:monitor` on the `Pid` that’s returned by `get_index_pid()`?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305748499/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305749100","html_url":"https://github.com/apache/couchdb/pull/562#issuecomment-305749100","issue_url":"https://api.github.com/repos/apache/couchdb/issues/562","id":305749100,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc0OTEwMA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T10:22:02Z","updated_at":"2017-06-02T10:22:02Z","author_association":"MEMBER","body":"First iteration didn’t work, now switching to monitoring the doc index `Pid`, instead of the `^EState`’s `fd`, as that is only available after getting the state.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305749100/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305751373","html_url":"https://github.com/apache/couchdb/pull/556#issuecomment-305751373","issue_url":"https://api.github.com/repos/apache/couchdb/issues/556","id":305751373,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc1MTM3Mw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T10:34:15Z","updated_at":"2017-06-02T10:34:15Z","author_association":"MEMBER","body":"I might be missing something, but I can’t see any call to `/_restart` any more, or any other way of actually issuing a restart command.\r\n\r\nOn top of that, I think 2.0 dropped the `_restart` API. I can’t find it in `chttpd` and I believe we’ve disabled all tests that rely on it.\r\n\r\nFor tests we want (re-)enable, we need to port them to not rely on restart any more.\r\n\r\nFor the stats tests, the call to `/_restart` just not working, could be the cause for the off-by-one/a-few errors we are seeing.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305751373/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305757770","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-305757770","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":305757770,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc1Nzc3MA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T11:09:06Z","updated_at":"2017-06-02T11:09:06Z","author_association":"MEMBER","body":"Oh derp. Yeah, thats not right. This is a race condition when deleting the database out from under the view. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305757770/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305759318","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-305759318","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":305759318,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc1OTMxOA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T11:18:13Z","updated_at":"2017-06-02T11:18:13Z","author_association":"MEMBER","body":"Random idea. I wonder if curl is using keep-alive on the connection and we're getting a mesage back from an old rpc worker which looks like an error and closes the connection. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305759318/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305759652","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-305759652","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":305759652,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc1OTY1Mg==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T11:20:15Z","updated_at":"2017-06-02T11:20:15Z","author_association":"MEMBER","body":"Maybe try adding connection: close hereish?\r\n\r\nhttps://github.com/apache/couchdb/blob/master/test/javascript/couch.js#L438","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305759652/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305768383","html_url":"https://github.com/apache/couchdb/pull/562#issuecomment-305768383","issue_url":"https://api.github.com/repos/apache/couchdb/issues/562","id":305768383,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc2ODM4Mw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T12:08:47Z","updated_at":"2017-06-02T12:08:47Z","author_association":"MEMBER","body":"Second iteration didn’t fail, but [@davisp said](https://github.com/apache/couchdb/issues/548#issuecomment-305759652) isn’t helping.\r\n\r\nTrying latest suggestion now.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305768383/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305768423","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-305768423","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":305768423,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc2ODQyMw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T12:09:00Z","updated_at":"2017-06-02T12:09:00Z","author_association":"MEMBER","body":"testing: https://github.com/apache/couchdb/pull/562\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305768423/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305770651","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-305770651","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":305770651,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc3MDY1MQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T12:21:09Z","updated_at":"2017-06-02T12:21:09Z","author_association":"MEMBER","body":"@davisp running this locally in a while loop `make javascript suites=builtin_reduce.js` still gives me occasional errors like:\r\n\r\n```\r\n    Error: {gen_server,call,[<0.5915.0>,{get_state,19},infinity]}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305770651/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305772247","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-305772247","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":305772247,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc3MjI0Nw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T12:29:37Z","updated_at":"2017-06-02T12:29:37Z","author_association":"MEMBER","body":"Point of note: This happens more if my test machine is idle otherwise. If there is other CPU load, this tends not to happen.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305772247/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305782137","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-305782137","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":305782137,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc4MjEzNw==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T13:07:33Z","updated_at":"2017-06-02T13:07:33Z","author_association":"MEMBER","body":"Yeah, I htink this is not right. I'd abandon this approach and try the Connection: close I wrote down somewhere else while staring at my phone with one eye after I woke up.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305782137/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305791858","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-305791858","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":305791858,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTc5MTg1OA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T13:46:49Z","updated_at":"2017-06-02T13:46:49Z","author_association":"MEMBER","body":"@davisp sorry for the confusion, this is with the initial suggestion reverted and now using `Connection: close`. Still fails occasionally\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305791858/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305804783","html_url":"https://github.com/apache/couchdb/pull/539#issuecomment-305804783","issue_url":"https://api.github.com/repos/apache/couchdb/issues/539","id":305804783,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTgwNDc4Mw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T14:29:21Z","updated_at":"2017-06-02T14:29:21Z","author_association":"CONTRIBUTOR","body":"Made a few updates. Should be ready for another look.\r\n\r\nAlso checked that in an idle cluster _nodes and _dbs don't become idle. It's probably because there are change feeds listening to them.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305804783/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305876702","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-305876702","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":305876702,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTg3NjcwMg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T18:39:44Z","updated_at":"2017-06-02T18:39:44Z","author_association":"MEMBER","body":"@janl Correct, Jenkins only runs on the master, 2.1.x and jenkins-pipeline (for debugging) branches at present. Running the test in a loop is the easiest way to repro these test cases.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305876702/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305879544","html_url":"https://github.com/apache/couchdb/issues/559#issuecomment-305879544","issue_url":"https://api.github.com/repos/apache/couchdb/issues/559","id":305879544,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTg3OTU0NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T18:51:30Z","updated_at":"2017-06-02T18:51:30Z","author_association":"MEMBER","body":"In view queries other than `_show`s. a simple GET-PUT-GET cycle on a view could return the same result as this test case on a cluster, even without the ddoc_cache, though the exact same scenario as here could also recur. So I understand what you're saying here.\r\n\r\nI will delete this test case and update the documentation to somehow reflect this change in behaviour. Thanks for the advice.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305879544/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305884205","html_url":"https://github.com/apache/couchdb/issues/559#issuecomment-305884205","issue_url":"https://api.github.com/repos/apache/couchdb/issues/559","id":305884205,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTg4NDIwNQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T19:10:57Z","updated_at":"2017-06-02T19:10:57Z","author_association":"MEMBER","body":"A fix for this test case without deleting it would be to add a synchronous eviction during the request to modify a design doc (on the client side so we're not blocking couch_db_updater). This way the one client that requested the modification should not see the pre-modified ddoc in the cache if they make another request.\r\n\r\nBasically that'd be just a matter of making a ddoc_cache:evict_docs_sync or similar that uses gen_server:call/2 which would internally just use the same handle_cast code and reply with something arbitrary. And then we'd just add a couple lines in the clause at [1] that would look for any ddoc ids and do the eviction if they exist.\r\n\r\n[1] https://github.com/apache/couchdb/blob/master/src/couch/src/couch_db.erl#L1078\r\n\r\nAlso someone should remove this extra eviction code that's still hanging around because its a duplication of the code around line 315.\r\n\r\nhttps://github.com/apache/couchdb/blob/master/src/couch/src/couch_db_updater.erl#L902-L903","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305884205/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305898161","html_url":"https://github.com/apache/couchdb/issues/559#issuecomment-305898161","issue_url":"https://api.github.com/repos/apache/couchdb/issues/559","id":305898161,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTg5ODE2MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T20:15:09Z","updated_at":"2017-06-02T20:15:09Z","author_association":"MEMBER","body":"@davisp said on IRC:\r\n\r\n```irc\r\n15:55 <+davisp> Yeah, you're right. I was only thinking single node. The sync\r\n                thing would still be async for other nodes so you're right that\r\n                with the load balancer it'd break\r\n15:55 <+davisp> Which makes this a tweak for tests which I agree isn't super\r\n                awesome\r\n15:55 <+davisp> So delete it!\r\n```\r\n\r\nWhich is what I'm about to do, with an implicit +1 (so I will merge it straight away to master.)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305898161/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305898910","html_url":"https://github.com/apache/couchdb/issues/559#issuecomment-305898910","issue_url":"https://api.github.com/repos/apache/couchdb/issues/559","id":305898910,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTg5ODkxMA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T20:18:25Z","updated_at":"2017-06-02T20:18:25Z","author_association":"MEMBER","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305898910/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305899008","html_url":"https://github.com/apache/couchdb/pull/562#issuecomment-305899008","issue_url":"https://api.github.com/repos/apache/couchdb/issues/562","id":305899008,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTg5OTAwOA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T20:18:50Z","updated_at":"2017-06-02T20:18:50Z","author_association":"MEMBER","body":"@eiri is working a proper patch for this, closing.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305899008/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305900102","html_url":"https://github.com/apache/couchdb/issues/554#issuecomment-305900102","issue_url":"https://api.github.com/repos/apache/couchdb/issues/554","id":305900102,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTkwMDEwMg==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T20:23:53Z","updated_at":"2017-06-02T20:23:53Z","author_association":"MEMBER","body":"`stats.js` relies heavily on `restartServer` which [I believe](https://github.com/apache/couchdb/pull/556#issuecomment-305751373) we nixed for 2.0 {","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305900102/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305900596","html_url":"https://github.com/apache/couchdb/pull/556#issuecomment-305900596","issue_url":"https://api.github.com/repos/apache/couchdb/issues/556","id":305900596,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTkwMDU5Ng==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T20:26:00Z","updated_at":"2017-06-02T20:26:00Z","author_association":"MEMBER","body":"I stand corrected:\r\n\r\n```\r\n[22:20:29]  <+Wohali>\tso restart isn't done that way anymore\r\n[22:21:33]  <+Wohali>\tthis took me a bit to figure out\r\n[22:21:35]  <+Wohali>\thttps://github.com/apache/couchdb/blob/master/dev/run#L531-L540\r\n[22:21:49]  <+Wohali>\tso the javascript test suite is invoked as the run_command argument to dev/run\r\n[22:22:07]  <+Wohali>\tanything the test suite prints out to stdout is parsed by L538\r\n[22:23:02]  <+Wohali>\tso that's how this works: https://github.com/apache/couchdb/pull/556/files#diff-10d21021a1d1424fbe10267262a4d4a7L75\r\n[22:23:19]  <+Wohali>\tJS's restartServer() prints restart, which is eval()'d by dev/run and restarts the nodes\r\n[22:23:48]  <+Wohali>\tthat's why I completely removed the old /_restart endpoint call - not only was it eclipsed by the version in test_setup.js, it simply doesn't work with 2.0\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305900596/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305900649","html_url":"https://github.com/apache/couchdb/pull/556#issuecomment-305900649","issue_url":"https://api.github.com/repos/apache/couchdb/issues/556","id":305900649,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTkwMDY0OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T20:26:16Z","updated_at":"2017-06-02T20:26:16Z","author_association":"MEMBER","body":"So restart isn't done that way anymore. This took me a bit to figure out...\r\n\r\nhttps://github.com/apache/couchdb/blob/master/dev/run#L531-L540\r\n\r\nSo the javascript test suite is invoked as the `run_command` argument to `dev/run`. Anything the test suite prints out to stdout is parsed by L538. \r\n\r\nSo that's how this works:\r\nhttps://github.com/apache/couchdb/pull/556/files#diff-10d21021a1d1424fbe10267262a4d4a7L75\r\n\r\nJS's `restartServer()` prints `restart`, which is `eval()`'d by `dev/run` and restarts the nodes\r\n\r\nThat's why I completely removed the old `/_restart` endpoint call - not only was it eclipsed by the version in `test_setup.js`, it simply doesn't work with 2.0!\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305900649/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305900683","html_url":"https://github.com/apache/couchdb/issues/554#issuecomment-305900683","issue_url":"https://api.github.com/repos/apache/couchdb/issues/554","id":305900683,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTkwMDY4Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T20:26:24Z","updated_at":"2017-06-02T20:26:24Z","author_association":"MEMBER","body":"restartServer() works with 2.0 via a call out to `dev/run`, see my comments here: https://github.com/apache/couchdb/pull/556#issuecomment-305900649","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305900683/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305900792","html_url":"https://github.com/apache/couchdb/issues/554#issuecomment-305900792","issue_url":"https://api.github.com/repos/apache/couchdb/issues/554","id":305900792,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTkwMDc5Mg==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T20:26:56Z","updated_at":"2017-06-02T20:26:56Z","author_association":"MEMBER","body":"yup, sorry,*retract retract*\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305900792/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305901753","html_url":"https://github.com/apache/couchdb/pull/561#issuecomment-305901753","issue_url":"https://api.github.com/repos/apache/couchdb/issues/561","id":305901753,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTkwMTc1Mw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T20:31:26Z","updated_at":"2017-06-02T20:31:26Z","author_association":"MEMBER","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305901753/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305909995","html_url":"https://github.com/apache/couchdb/issues/552#issuecomment-305909995","issue_url":"https://api.github.com/repos/apache/couchdb/issues/552","id":305909995,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTkwOTk5NQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T21:10:09Z","updated_at":"2017-06-02T21:10:09Z","author_association":"MEMBER","body":"If @eiri's patch for #548 doesn't fix this then I think the answer is to insert a wait for the index pid to exit due to its database being kicked out of the LRU. I'd monitor the db and index pids, wait for db exit, wait for index exit, then proceed.\r\n\r\nI'd acquire monitors here:\r\n\r\nhttps://github.com/apache/couchdb/blob/master/src/couch/test/couchdb_views_tests.erl#L345\r\n\r\nAnd then wait for the 'DOWN' signal here:\r\n\r\nhttps://github.com/apache/couchdb/blob/master/src/couch/test/couchdb_views_tests.erl#L352","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305909995/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305912057","html_url":"https://github.com/apache/couchdb/pull/563#issuecomment-305912057","issue_url":"https://api.github.com/repos/apache/couchdb/issues/563","id":305912057,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTkxMjA1Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T21:20:49Z","updated_at":"2017-06-02T21:20:49Z","author_association":"MEMBER","body":"Pre-approved by @janl and @davisp in #559. Rebasing and merging now.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305912057/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305915424","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-305915424","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":305915424,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTkxNTQyNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T21:38:17Z","updated_at":"2017-06-02T21:38:17Z","author_association":"MEMBER","body":"We have more instances of this today: \r\n\r\nhttps://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/master/8/pipeline/48 (Ubuntu 16.04, Erlang 18.3)\r\nhttps://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/master/8/pipeline/47 (Ubuntu 16.04, default Erlang)\r\nhttps://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/master/9/pipeline/47 (Ubuntu 16.04, default Erlang)\r\nhttps://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/master/10/pipeline/41 (CentOS 6, Erlang 18.3)\r\nhttps://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/master/10/pipeline/43 (CentOS 7, Erlang 18.3)\r\nhttps://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/master/10/pipeline/48 (Ubuntu 16.04, Erlang 18.3)\r\nhttps://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/master/10/pipeline/47 (Ubuntu 16.04, default Erlang)\r\n\r\nThis is now by far our most common failure scenario in Jenkins.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305915424/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305917246","html_url":"https://github.com/apache/couchdb/pull/496#issuecomment-305917246","issue_url":"https://api.github.com/repos/apache/couchdb/issues/496","id":305917246,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTkxNzI0Ng==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-02T21:48:37Z","updated_at":"2017-06-02T21:48:37Z","author_association":"CONTRIBUTOR","body":"Tested mixed cluster upgrade. Started a cluster from `COUCHDB-3288-mixed-cluster-upgrade` with dev/run. Killed node3 and then started it with PSE code.\r\n\r\nNoticed that internal replication pushing documents with attachments from node1 to node3 was failing with a function_clause in `couch_att:flush_data`.\r\n\r\n```\r\nrpc couch_db:update_docs/4 function_clause [{couch_att,flush_data, [{db,1,<<\"shards/...\r\n```\r\n\r\nThe reason is that flush_data was called with `Db, {Fd, StreamPointer}, Att` arguments instead of the new format of `Db, {stream, StreamEngine}, Att`\r\n\r\nProbably need to add a clause to upgrade old stream to new couch_bt_engine's stream format and vice versa.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305917246/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305937285","html_url":"https://github.com/apache/couchdb/pull/477#issuecomment-305937285","issue_url":"https://api.github.com/repos/apache/couchdb/issues/477","id":305937285,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTkzNzI4NQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T00:29:43Z","updated_at":"2017-06-03T00:29:43Z","author_association":"CONTRIBUTOR","body":"> @davisp\r\n I keep thinking there must be something a bit cleaner here with exposing a new API function to ask the module if its index is idle.\r\n\r\nIdeally we would want to minimize the interaction with couch_index_server since it is a bottlneck. \r\nIf we can ensure that it is impossible to have at any given time multiple index processes for the same index we could move locking out of couch_index_server. In such case the maybe_close_index function would be simpler (maybe).\r\n\r\nI also experimented with some other possibilities a little bit to make it more generic.  The goal was to make couch_server and couch_index_server similar. Most likely it is overkill. I tend to over engineer at times.\r\n  \r\ncouch_lock.erl\r\n---------------\r\n```\r\nnew(Table, Key, Pos) ->\r\n    {Table, Key, Pos}.\r\nwith_lock({Table, Key, Pos}, Default, Fun) ->\r\n    case ets:update_element(Table, Key, {Pos, true}) of\r\n         true ->\r\n              try \r\n                   [Entry] = ets:lookup(Table, Key),\r\n                  Fun(Entry)\r\n              after\r\n                  ets:update_element(Table, Key, Pos, false)\r\n              end;\r\n         false ->\r\n             Default\r\n   end.\r\n```\r\n\r\ncouch_index.erl\r\n----------------\r\n```\r\ntxn({DbName, DDocId, Sig}, Default, Fun) ->\r\n    Lock = couch_lock:lock(?BY_SIG, {DbName, Sig}, #entry.locked),\r\n    couch_lock:with_lock(Lock, Default, Fun). %% we don't have it yet\r\n\r\nis_idle(Pid) ->\r\n         gen_server:call(Pid, is_idle).\r\n\r\nset_committing(Pid, Value) ->\r\n         gen_server:call(Pid, {set_committing, Value}).\r\n\r\nset_compacting(Pid, Value) ->\r\n         gen_server:call(Pid, {set_compacting, Value}).\r\n```\r\n\r\ncouch_index_server.erl\r\n-----------------------\r\n```\r\nmaybe_close_index({DbName, DDocId, Sig} = Idx) ->\r\n   couch_index:txn(Idx, {false, true}, fun(#entry{pid =Pid}) ->\r\n        case couch_index:is_idle(Pid) of\r\n            true -> \r\n                 rem_from_ets(DbName, Sig, DDocId, Pid),\r\n                 couch_index:stop(Pid),\r\n                 {true, true};\r\n            false ->\r\n                couch_stats:increment_counter([couchdb, couch_index_server, lru_skip]),\r\n                {false, false}\r\n        end\r\n   end).\r\n```\r\n\r\ncouch_server.erl\r\n----------------\r\n```\r\ntxn(DbName, Default, Fun) ->\r\n    Lock = couch_lock:lock(couch_dbs, DbName, #db.fd_monitor),\r\n    couch_lock:with_lock(Lock, Default, Fun). %% we don't have it yet\r\n\r\nmaybe_close_db(DbName) ->\r\n   couch_server:txn(Idx, {false, true}, fun(#db{main_pid =Pid} = Db) ->\r\n        case couch_db:is_idle(Db) of\r\n            true -> \r\n                true = ets:delete(couch_dbs, DbName),\r\n                true = ets:delete(couch_dbs_pid_to_name, Pid),\r\n                exit(Pid, kill),\r\n                {true, true};\r\n            false ->\r\n                couch_stats:increment_counter([couchdb, couch_server, lru_skip]),\r\n                {false, false}\r\n        end\r\n   end).\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305937285/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305956201","html_url":"https://github.com/apache/couchdb/issues/559#issuecomment-305956201","issue_url":"https://api.github.com/repos/apache/couchdb/issues/559","id":305956201,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk1NjIwMQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T06:45:47Z","updated_at":"2017-06-03T06:45:47Z","author_association":"MEMBER","body":"Documented in https://github.com/apache/couchdb-documentation/commit/e274cea923a8e090c488970a931ae4852d0fc491","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305956201/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305963713","html_url":"https://github.com/apache/couchdb/pull/541#issuecomment-305963713","issue_url":"https://api.github.com/repos/apache/couchdb/issues/541","id":305963713,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk2MzcxMw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T09:28:49Z","updated_at":"2017-06-03T09:28:49Z","author_association":"MEMBER","body":"Solid PR!\r\n\r\nThe only question i have is why there is a threshold for the optimised path? The way I understand this there are two code paths, one is faster, but can’t deal with a large number of doc ids, the other is slower, but can deal with an unbounded number of doc ids. The question then is: when does the fast path turn into the slow path (or even-slower-than-the-slow-path) and why is the limit 100 now? What trade-off is being made?\r\n\r\nI’d like to understand this if only to make sure that we add a comment in the .ini file that explains, hypothetically: “you can set that to whatever, but for every 1k doc ids allowed, you’re using an extra 2Mb of memory per concurrent doc_id `_changes` request”, or whatever it ends up being, so people understand the trade-offs.\r\n\r\n`git blame` tells me this code is originally @davisp’s, so ping :)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305963713/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305965763","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-305965763","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":305965763,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk2NTc2Mw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T10:12:31Z","updated_at":"2017-06-03T10:12:31Z","author_association":"MEMBER","body":"And another one on Travis:\r\n\r\n```\r\ntest/javascript/tests/view_collation.js                        \r\n    Error: {gen_server,call,[<0.7764.0>,{get_state,8},infinity]}\r\nTrace back (most recent call first):\r\n    \r\n 548: test/javascript/couch.js\r\n      CouchError([object Object])\r\n 511: test/javascript/couch.js\r\n      ([object CouchHTTP])\r\n 177: test/javascript/couch.js\r\n      (\"(function (doc) {emit(doc.foo, null);})\",null,[object Object])\r\n  85: test/javascript/tests/view_collation.js\r\n      ()\r\n  37: test/javascript/cli_runner.js\r\n      runTest()\r\n  48: test/javascript/cli_runner.js\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305965763/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305967951","html_url":"https://github.com/apache/couchdb/issues/552#issuecomment-305967951","issue_url":"https://api.github.com/repos/apache/couchdb/issues/552","id":305967951,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk2Nzk1MQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T11:01:44Z","updated_at":"2017-06-03T11:01:44Z","author_association":"MEMBER","body":"@davisp good call, since the compaction test below uses the same pattern.\r\n\r\nI’ve given this a shot here: https://github.com/apache/couchdb/pull/568","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305967951/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305968701","html_url":"https://github.com/apache/couchdb/pull/567#issuecomment-305968701","issue_url":"https://api.github.com/repos/apache/couchdb/issues/567","id":305968701,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk2ODcwMQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T11:18:49Z","updated_at":"2017-06-03T11:18:49Z","author_association":"MEMBER","body":"not sure why GitHub complains here, the branch merges cleanly locally.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305968701/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305968713","html_url":"https://github.com/apache/couchdb/pull/567#issuecomment-305968713","issue_url":"https://api.github.com/repos/apache/couchdb/issues/567","id":305968713,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk2ODcxMw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T11:19:08Z","updated_at":"2017-06-03T11:19:08Z","author_association":"MEMBER","body":"cc @davisp review plz <3","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305968713/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305968746","html_url":"https://github.com/apache/couchdb/pull/568#issuecomment-305968746","issue_url":"https://api.github.com/repos/apache/couchdb/issues/568","id":305968746,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk2ODc0Ng==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T11:20:12Z","updated_at":"2017-06-03T11:20:12Z","author_association":"MEMBER","body":"@wohali would be great to give this a spin on Jenkins, but we can equally merge to master and see what happens :)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305968746/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305976414","html_url":"https://github.com/apache/couchdb/pull/570#issuecomment-305976414","issue_url":"https://api.github.com/repos/apache/couchdb/issues/570","id":305976414,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk3NjQxNA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T13:52:02Z","updated_at":"2017-06-03T13:52:02Z","author_association":"MEMBER","body":"cc @guillett ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305976414/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305986518","html_url":"https://github.com/apache/couchdb/pull/568#issuecomment-305986518","issue_url":"https://api.github.com/repos/apache/couchdb/issues/568","id":305986518,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk4NjUxOA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T16:41:42Z","updated_at":"2017-06-03T16:41:42Z","author_association":"MEMBER","body":"I'd rather not mess with the Jenkins config to build more than just the release branches. Best to just run this specific test in a loop for a few hundred times and see if the error goes away.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305986518/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305986546","html_url":"https://github.com/apache/couchdb/pull/569#issuecomment-305986546","issue_url":"https://api.github.com/repos/apache/couchdb/issues/569","id":305986546,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk4NjU0Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T16:42:17Z","updated_at":"2017-06-03T16:42:17Z","author_association":"MEMBER","body":"+1. If we start getting emfile errors then we'll need to revisit - but I've never seen emfile errors when running `make javascript`.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305986546/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305986605","html_url":"https://github.com/apache/couchdb/pull/569#issuecomment-305986605","issue_url":"https://api.github.com/repos/apache/couchdb/issues/569","id":305986605,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk4NjYwNQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T16:43:17Z","updated_at":"2017-06-03T16:43:17Z","author_association":"MEMBER","body":"Yeah, that was from before we deleted the databases we created in each test.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305986605/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305986672","html_url":"https://github.com/apache/couchdb/pull/568#issuecomment-305986672","issue_url":"https://api.github.com/repos/apache/couchdb/issues/568","id":305986672,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk4NjY3Mg==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T16:44:26Z","updated_at":"2017-06-03T16:44:26Z","author_association":"MEMBER","body":"I’ve done a bit, but will set up the loop again and go for dinner, will report back.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305986672/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305987518","html_url":"https://github.com/apache/couchdb/issues/571#issuecomment-305987518","issue_url":"https://api.github.com/repos/apache/couchdb/issues/571","id":305987518,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk4NzUxOA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T16:57:05Z","updated_at":"2017-06-03T16:57:05Z","author_association":"MEMBER","body":"+1 for increasing the timeout it is 1s only","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305987518/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305987634","html_url":"https://github.com/apache/couchdb/issues/571#issuecomment-305987634","issue_url":"https://api.github.com/repos/apache/couchdb/issues/571","id":305987634,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk4NzYzNA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T16:58:50Z","updated_at":"2017-06-03T16:58:58Z","author_association":"MEMBER","body":"https://github.com/apache/couchdb/pull/572","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305987634/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305989428","html_url":"https://github.com/apache/couchdb/pull/568#issuecomment-305989428","issue_url":"https://api.github.com/repos/apache/couchdb/issues/568","id":305989428,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk4OTQyOA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T17:27:47Z","updated_at":"2017-06-03T17:27:47Z","author_association":"MEMBER","body":"no fail since, +1ing myself :)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305989428/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305991705","html_url":"https://github.com/apache/couchdb/pull/573#issuecomment-305991705","issue_url":"https://api.github.com/repos/apache/couchdb/issues/573","id":305991705,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk5MTcwNQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T18:06:35Z","updated_at":"2017-06-03T18:06:35Z","author_association":"MEMBER","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305991705/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305991937","html_url":"https://github.com/apache/couchdb/pull/572#issuecomment-305991937","issue_url":"https://api.github.com/repos/apache/couchdb/issues/572","id":305991937,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk5MTkzNw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T18:10:33Z","updated_at":"2017-06-03T18:10:33Z","author_association":"CONTRIBUTOR","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305991937/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305992604","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-305992604","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":305992604,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNTk5MjYwNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-03T18:21:46Z","updated_at":"2017-06-03T18:21:46Z","author_association":"MEMBER","body":"Another 6 or so occurrences for this in Jenkins. I'm not going to keep updating this ticket with the links, we have enough evidence to go on at this point.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/305992604/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306132727","html_url":"https://github.com/apache/couchdb/pull/570#issuecomment-306132727","issue_url":"https://api.github.com/repos/apache/couchdb/issues/570","id":306132727,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjEzMjcyNw==","user":{"login":"jamescorbett","id":1403475,"node_id":"MDQ6VXNlcjE0MDM0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/1403475?v=4","gravatar_id":"","url":"https://api.github.com/users/jamescorbett","html_url":"https://github.com/jamescorbett","followers_url":"https://api.github.com/users/jamescorbett/followers","following_url":"https://api.github.com/users/jamescorbett/following{/other_user}","gists_url":"https://api.github.com/users/jamescorbett/gists{/gist_id}","starred_url":"https://api.github.com/users/jamescorbett/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamescorbett/subscriptions","organizations_url":"https://api.github.com/users/jamescorbett/orgs","repos_url":"https://api.github.com/users/jamescorbett/repos","events_url":"https://api.github.com/users/jamescorbett/events{/privacy}","received_events_url":"https://api.github.com/users/jamescorbett/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T08:29:32Z","updated_at":"2017-06-05T08:29:32Z","author_association":"NONE","body":"Just tried this, worked great first time. On restart I'm getting a crash.\r\n```[info] 2017-06-05T08:24:17.964899Z nonode@nohost <0.198.0> -------- Starting couch_sup\r\n[error] 2017-06-05T08:24:18.100303Z nonode@nohost <0.234.0> -------- CRASH REPORT Process  (<0.234.0>) with 0 neighbors exited with reason: bad argument in call to ets:member(mem3_openers, <<\"_users\">>) at mem3_shards:maybe_spawn_shard_writer/3(line:486) <= mem3_shards:load_shards_from_db/2(line:389) <= mem3_shards:load_shards_from_disk/1(line:378) <= mem3_shards:for_db/2(line:59) <= mem3_shards:local/1(line:156) <= couch_peruser:init/0(line:58) <= couch_peruser:init/1(line:187); initial_call: {couch_peruser,init,['Argument__1']}, ancestors: [couch_secondary_services,couch_sup,<0.197.0>], messages: [], links: [<0.206.0>,<0.83.0>], dictionary: [], trap_exit: false, status: running, heap_size: 4185, stack_size: 27, reductions: 3938\r\n[error] 2017-06-05T08:24:18.100543Z nonode@nohost <0.206.0> -------- Supervisor couch_secondary_services had child couch_peruser started with couch_peruser:start_link() at undefined exit with reason bad argument in call to ets:member(mem3_openers, <<\"_users\">>) at mem3_shards:maybe_spawn_shard_writer/3(line:486) <= mem3_shards:load_shards_from_db/2(line:389) <= mem3_shards:load_shards_from_disk/1(line:378) <= mem3_shards:for_db/2(line:59) <= mem3_shards:local/1(line:156) <= couch_peruser:init/0(line:58) <= couch_peruser:init/1(line:187) in context start_error\r\n[error] 2017-06-05T08:24:18.101403Z nonode@nohost <0.198.0> -------- Supervisor couch_sup had child couch_secondary_services started with couch_secondary_sup:start_link() at undefined exit with reason {shutdown,{failed_to_start_child,couch_peruser,{badarg,[{ets,member,[mem3_openers,<<\"_users\">>],[]},{mem3_shards,maybe_spawn_shard_writer,3,[{file,\"src/mem3_shards.erl\"},{line,486}]},{mem3_shards,load_shards_from_db,2,[{file,\"src/mem3_shards.erl\"},{line,389}]},{mem3_shards,load_shards_from_disk,1,[{file,\"src/mem3_shards.erl\"},{line,378}]},{mem3_shards,for_db,2,[{file,\"src/mem3_shards.erl\"},{line,59}]},{mem3_shards,local,1,[{file,\"src/mem3_shards.erl\"},{line,156}]},{couch_peruser,init,0,[{file,...},...]},...]}}} in context start_error\r\n[error] 2017-06-05T08:24:18.101486Z nonode@nohost <0.197.0> -------- Error starting Apache CouchDB:\r\n\r\n    {error,{shutdown,{failed_to_start_child,couch_secondary_services,{shutdown,{failed_to_start_child,couch_peruser,{badarg,[{ets,member,[mem3_openers,<<\"_users\">>],[]},{mem3_shards,maybe_spawn_shard_writer,3,[{file,\"src/mem3_shards.erl\"},{line,486}]},{mem3_shards,load_shards_from_db,2,[{file,\"src/mem3_shards.erl\"},{line,389}]},{mem3_shards,load_shards_from_disk,1,[{file,\"src/mem3_shards.erl\"},{line,378}]},{mem3_shards,for_db,2,[{file,\"src/mem3_shards.erl\"},{line,59}]},{mem3_shards,local,1,[{file,\"src/mem3_shards.erl\"},{line,156}]},{couch_peruser,init,0,[{file,\"src/couch_peruser.erl\"},{line,58}]},{couch_peruser,init,1,[{file,\"src/couch_peruser.erl\"},{line,187}]}]}}}}}}\r\n\r\n\r\n[error] 2017-06-05T08:24:18.101983Z nonode@nohost <0.196.0> -------- CRASH REPORT Process  (<0.196.0>) with 0 neighbors exited with reason: {{shutdown,{failed_to_start_child,couch_secondary_services,{shutdown,{failed_to_start_child,couch_peruser,{badarg,[{ets,member,[mem3_openers,<<\"_users\">>],[]},{mem3_shards,maybe_spawn_shard_writer,3,[{file,\"src/mem3_shards.erl\"},{line,486}]},{mem3_shards,load_shards_from_db,2,[{file,\"src/mem3_shards.erl\"},{line,389}]},{mem3_shards,load_shards_from_disk,1,[{file,\"src/mem3_shards.erl\"},{line,378}]},{mem3_shards,for_db,2,[{file,\"src/mem3_shards.erl\"},{line,59}]},{mem3_shards,local,1,[{file,\"s...\"},...]},...]}}}}},...} at application_master:init/4(line:133) <= proc_lib:init_p_do_apply/3(line:237); initial_call: {application_master,init,['Argument__1','Argument__2',...]}, ancestors: [<0.195.0>], messages: [{'EXIT',<0.197.0>,normal}], links: [<0.195.0>,<0.7.0>], dictionary: [], trap_exit: true, status: running, heap_size: 987, stack_size: 27, reductions: 158\r\n[info] 2017-06-05T08:24:18.102835Z nonode@nohost <0.7.0> -------- Application couch exited with reason: {{shutdown,{failed_to_start_child,couch_secondary_services,{shutdown,{failed_to_start_child,couch_peruser,{badarg,[{ets,member,[mem3_openers,<<\"_users\">>],[]},{mem3_shards,maybe_spawn_shard_writer,3,[{file,\"src/mem3_shards.erl\"},{line,486}]},{mem3_shards,load_shards_from_db,2,[{file,\"src/mem3_shards.erl\"},{line,389}]},{mem3_shards,load_shards_from_disk,1,[{file,\"src/mem3_shards.erl\"},{line,378}]},{mem3_shards,for_db,2,[{file,\"src/mem3_shards.erl\"},{line,59}]},{mem3_shards,local,1,[{file,\"s...\"},...]},...]}}}}},...}\r\n[os_mon] memory supervisor port (memsup): Erlang has closed\r\n[os_mon] cpu supervisor port (cpu_sup): Erlang has closed\r\n{\"Kernel pid terminated\",application_controller,\"{application_start_failure,couch,{{shutdown,{failed_to_start_child,couch_secondary_services,{shutdown,{failed_to_start_child,couch_peruser,{badarg,[{ets,member,[mem3_openers,<<\\\"_users\\\">>],[]},{mem3_shards,maybe_spawn_shard_writer,3,[{file,\\\"src/mem3_shards.erl\\\"},{line,486}]},{mem3_shards,load_shards_from_db,2,[{file,\\\"src/mem3_shards.erl\\\"},{line,389}]},{mem3_shards,load_shards_from_disk,1,[{file,\\\"src/mem3_shards.erl\\\"},{line,378}]},{mem3_shards,for_db,2,[{file,\\\"src/mem3_shards.erl\\\"},{line,59}]},{mem3_shards,local,1,[{file,\\\"src/mem3_shards.erl\\\"},{line,156}]},{couch_peruser,init,0,[{file,\\\"src/couch_peruser.erl\\\"},{line,58}]},{couch_peruser,init,1,[{file,\\\"src/couch_peruser.erl\\\"},{line,187}]}]}}}}},{couch_app,start,[normal,[]]}}}\"}\r\n\r\nCrash dump was written to: erl_crash.dump\r\nKernel pid terminated (application_controller) ({application_start_failure,couch,{{shutdown,{failed_to_start_child,couch_secondary_services,{shutdown,{failed_to_start_child,couch_peruser,{badarg,[{e```\r\n\r\nBuild was based on: https://github.com/klaemo/docker-couchdb/blob/master/2.0.0/Dockerfile with this git branch instead of the tar from apache","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306132727/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306140464","html_url":"https://github.com/apache/couchdb/pull/560#issuecomment-306140464","issue_url":"https://api.github.com/repos/apache/couchdb/issues/560","id":306140464,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjE0MDQ2NA==","user":{"login":"jiangphcn","id":18000622,"node_id":"MDQ6VXNlcjE4MDAwNjIy","avatar_url":"https://avatars.githubusercontent.com/u/18000622?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangphcn","html_url":"https://github.com/jiangphcn","followers_url":"https://api.github.com/users/jiangphcn/followers","following_url":"https://api.github.com/users/jiangphcn/following{/other_user}","gists_url":"https://api.github.com/users/jiangphcn/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangphcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangphcn/subscriptions","organizations_url":"https://api.github.com/users/jiangphcn/orgs","repos_url":"https://api.github.com/users/jiangphcn/repos","events_url":"https://api.github.com/users/jiangphcn/events{/privacy}","received_events_url":"https://api.github.com/users/jiangphcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T09:08:35Z","updated_at":"2017-06-05T09:08:35Z","author_association":"CONTRIBUTOR","body":"Hi @eiri Thanks so much for reviewing codes and providing suggestion. I almost addressed your comments. However, regarding whether to set StartSeq with or without plus 1 for query only with `since`, we still need some discussion/test. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306140464/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306226410","html_url":"https://github.com/apache/couchdb/pull/575#issuecomment-306226410","issue_url":"https://api.github.com/repos/apache/couchdb/issues/575","id":306226410,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjIyNjQxMA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T15:56:49Z","updated_at":"2017-06-05T15:56:49Z","author_association":"MEMBER","body":"+1, Thanks for the tests.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306226410/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306242076","html_url":"https://github.com/apache/couchdb/pull/570#issuecomment-306242076","issue_url":"https://api.github.com/repos/apache/couchdb/issues/570","id":306242076,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjI0MjA3Ng==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T16:55:15Z","updated_at":"2017-06-05T16:55:15Z","author_association":"MEMBER","body":"@jamescorbett can you paste the full log? I can’t seem to be able to reproduce this in the source tree\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306242076/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306299309","html_url":"https://github.com/apache/couchdb/pull/541#issuecomment-306299309","issue_url":"https://api.github.com/repos/apache/couchdb/issues/541","id":306299309,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjI5OTMwOQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T20:42:17Z","updated_at":"2017-06-05T20:42:17Z","author_association":"CONTRIBUTOR","body":"Yeah, that should work!\r\n\r\nLet's clean it up a bit by making lines less than 80 columns. Then squash the commits.\r\n\r\nAlso unit tests are failing. You can click on the red 'X' to see the logs. I'll take a look there to help out as the EUnit test suite is not the easiest to work with.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306299309/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306313292","html_url":"https://github.com/apache/couchdb/pull/541#issuecomment-306313292","issue_url":"https://api.github.com/repos/apache/couchdb/issues/541","id":306313292,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjMxMzI5Mg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T21:19:10Z","updated_at":"2017-06-05T21:19:10Z","author_association":"CONTRIBUTOR","body":"@alxndrsn \r\n\r\nTests are failing because get_integer expects the default value to be an integer. So switch \"100\" to 100 in `config:get_integer/3` function call.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306313292/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306322613","html_url":"https://github.com/apache/couchdb/pull/577#issuecomment-306322613","issue_url":"https://api.github.com/repos/apache/couchdb/issues/577","id":306322613,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjMyMjYxMw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T21:59:10Z","updated_at":"2017-06-05T21:59:10Z","author_association":"MEMBER","body":"You fixed it! +1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306322613/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306326994","html_url":"https://github.com/apache/couchdb/pull/579#issuecomment-306326994","issue_url":"https://api.github.com/repos/apache/couchdb/issues/579","id":306326994,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjMyNjk5NA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-05T22:20:46Z","updated_at":"2017-06-05T22:20:46Z","author_association":"CONTRIBUTOR","body":"Related to https://github.com/apache/couchdb/pull/578","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306326994/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306432789","html_url":"https://github.com/apache/couchdb/pull/541#issuecomment-306432789","issue_url":"https://api.github.com/repos/apache/couchdb/issues/541","id":306432789,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjQzMjc4OQ==","user":{"login":"alxndrsn","id":191496,"node_id":"MDQ6VXNlcjE5MTQ5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/191496?v=4","gravatar_id":"","url":"https://api.github.com/users/alxndrsn","html_url":"https://github.com/alxndrsn","followers_url":"https://api.github.com/users/alxndrsn/followers","following_url":"https://api.github.com/users/alxndrsn/following{/other_user}","gists_url":"https://api.github.com/users/alxndrsn/gists{/gist_id}","starred_url":"https://api.github.com/users/alxndrsn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alxndrsn/subscriptions","organizations_url":"https://api.github.com/users/alxndrsn/orgs","repos_url":"https://api.github.com/users/alxndrsn/repos","events_url":"https://api.github.com/users/alxndrsn/events{/privacy}","received_events_url":"https://api.github.com/users/alxndrsn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-06T09:31:46Z","updated_at":"2017-06-06T09:31:46Z","author_association":"CONTRIBUTOR","body":"@nickva thanks for all the help!\r\n\r\nOne query, reference wrapping lines to 80 columns: where would you wrap the following, and how would you indent the split line?\r\n\r\n         MaxDocIds = config:get_integer(\"couchdb\", \"changes_doc_ids_optimization_threshold\", 100), \r\n\r\nI guess the following would work:\r\n\r\n         MaxDocIds = config:get_integer(\"couchdb\",\r\n                 \"changes_doc_ids_optimization_threshold\", 100),\r\n\r\nBut there are no other similar lines wrapped in that file, and lots of lines which spill over above 80 columns.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306432789/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306498518","html_url":"https://github.com/apache/couchdb/pull/541#issuecomment-306498518","issue_url":"https://api.github.com/repos/apache/couchdb/issues/541","id":306498518,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjQ5ODUxOA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-06T14:11:56Z","updated_at":"2017-06-06T14:11:56Z","author_association":"CONTRIBUTOR","body":"@alxndrsn \r\n\r\n```\r\nMaxDocIds = config:get_integer(\"couchdb\",\r\n    \"changes_doc_ids_optimization_threshold\", 100),\r\n```\r\nThat ^ should do it.  The indent of the second line would be 4 spaces.  \r\n\r\nYeah some files are a mess, sorry about that. We are trying to at least apply the formatting rules for the new PRs.\r\n\r\nAnd thanks again for the PR.\r\n\r\n+1 after the formatting change.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306498518/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306507787","html_url":"https://github.com/apache/couchdb/pull/580#issuecomment-306507787","issue_url":"https://api.github.com/repos/apache/couchdb/issues/580","id":306507787,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjUwNzc4Nw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-06T14:41:53Z","updated_at":"2017-06-06T14:41:53Z","author_association":"MEMBER","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306507787/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306530137","html_url":"https://github.com/apache/couchdb/pull/541#issuecomment-306530137","issue_url":"https://api.github.com/repos/apache/couchdb/issues/541","id":306530137,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjUzMDEzNw==","user":{"login":"alxndrsn","id":191496,"node_id":"MDQ6VXNlcjE5MTQ5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/191496?v=4","gravatar_id":"","url":"https://api.github.com/users/alxndrsn","html_url":"https://github.com/alxndrsn","followers_url":"https://api.github.com/users/alxndrsn/followers","following_url":"https://api.github.com/users/alxndrsn/following{/other_user}","gists_url":"https://api.github.com/users/alxndrsn/gists{/gist_id}","starred_url":"https://api.github.com/users/alxndrsn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alxndrsn/subscriptions","organizations_url":"https://api.github.com/users/alxndrsn/orgs","repos_url":"https://api.github.com/users/alxndrsn/repos","events_url":"https://api.github.com/users/alxndrsn/events{/privacy}","received_events_url":"https://api.github.com/users/alxndrsn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-06T15:50:09Z","updated_at":"2017-06-06T15:50:09Z","author_association":"CONTRIBUTOR","body":"@nickva fixed","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306530137/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306538580","html_url":"https://github.com/apache/couchdb/pull/541#issuecomment-306538580","issue_url":"https://api.github.com/repos/apache/couchdb/issues/541","id":306538580,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjUzODU4MA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-06T16:17:48Z","updated_at":"2017-06-06T16:17:48Z","author_association":"CONTRIBUTOR","body":"@alxndrsn \r\n\r\nExcellent work! Thank you for your contribution. I'll merge it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306538580/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306730924","html_url":"https://github.com/apache/couchdb/issues/583#issuecomment-306730924","issue_url":"https://api.github.com/repos/apache/couchdb/issues/583","id":306730924,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjczMDkyNA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-07T08:45:29Z","updated_at":"2017-06-07T08:45:29Z","author_association":"MEMBER","body":"Could `{failed_to_start_child,os_daemons,{already_started,<0.3640.1>}}} ` “already started” be a smoking gun?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306730924/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306821177","html_url":"https://github.com/apache/couchdb/issues/583#issuecomment-306821177","issue_url":"https://api.github.com/repos/apache/couchdb/issues/583","id":306821177,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjgyMTE3Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-07T14:57:13Z","updated_at":"2017-06-07T14:57:13Z","author_association":"MEMBER","body":"That's coming from the subsequent tests, after it failed to stop it. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306821177/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306821465","html_url":"https://github.com/apache/couchdb/issues/585#issuecomment-306821465","issue_url":"https://api.github.com/repos/apache/couchdb/issues/585","id":306821465,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjgyMTQ2NQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-07T14:58:08Z","updated_at":"2017-06-07T14:58:08Z","author_association":"MEMBER","body":"I'm afraid that Futon is no longer supported. You will want to upgrade to CouchDB 2.0 and the new UI in that, Fauxton.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306821465/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306874059","html_url":"https://github.com/apache/couchdb/pull/586#issuecomment-306874059","issue_url":"https://api.github.com/repos/apache/couchdb/issues/586","id":306874059,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjg3NDA1OQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-07T17:54:00Z","updated_at":"2017-06-07T17:54:00Z","author_association":"CONTRIBUTOR","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306874059/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306883357","html_url":"https://github.com/apache/couchdb/pull/496#issuecomment-306883357","issue_url":"https://api.github.com/repos/apache/couchdb/issues/496","id":306883357,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjg4MzM1Nw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-07T18:26:09Z","updated_at":"2017-06-07T18:26:09Z","author_association":"CONTRIBUTOR","body":"+1\r\n\r\nVery nice work. This is a significant step forward. It opens a lot of possibilities for CouchDB.\r\n\r\nThings I tested:\r\n \r\n * Read the source. Had some API comments. Those were addressed\r\n * Ran extended replication tests which test a good amount of APIs: crud operations, change feeds, bulk docs, attachments, filters\r\n  * Tested crud operations by hand. Building & querying views.\r\n  * Tested mixed cluster scenarios. Started a dev cluster in with the `COUCHDB-3288-mixed-cluster-upgrade branch` then stopped one node and started with the PSE branch. Then watched logs. Performed more tests. Noticed a few issues there and submitted PRs\r\n\r\nDidn't test:\r\n * Switching engines. Using a non-default engine. Saw other reviewers focused on that so skipped that.\r\n\r\nGreat job. Looking forward to seeing this merged.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306883357/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306907200","html_url":"https://github.com/apache/couchdb/pull/539#issuecomment-306907200","issue_url":"https://api.github.com/repos/apache/couchdb/issues/539","id":306907200,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjkwNzIwMA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-07T19:57:05Z","updated_at":"2017-06-07T19:57:05Z","author_association":"CONTRIBUTOR","body":"This is running a crud benchmark while having 30k _users (system dbs) loaded.\r\n\r\n![6194_vs_6200](https://user-images.githubusercontent.com/211822/26898433-e7378268-4b99-11e7-8245-7202b4f43918.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306907200/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306907813","html_url":"https://github.com/apache/couchdb/pull/539#issuecomment-306907813","issue_url":"https://api.github.com/repos/apache/couchdb/issues/539","id":306907813,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjkwNzgxMw==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-07T19:59:39Z","updated_at":"2017-06-07T19:59:39Z","author_association":"MEMBER","body":"Probably a better idea to use hashes to identify runs rather than Jenkins build numbers.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306907813/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306908903","html_url":"https://github.com/apache/couchdb/pull/539#issuecomment-306908903","issue_url":"https://api.github.com/repos/apache/couchdb/issues/539","id":306908903,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjkwODkwMw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-07T20:04:02Z","updated_at":"2017-06-07T20:04:02Z","author_association":"CONTRIBUTOR","body":"@davisp ah good point. 6194 is the build for master and 6200 is the close-idle-pr build","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306908903/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306912689","html_url":"https://github.com/apache/couchdb/pull/539#issuecomment-306912689","issue_url":"https://api.github.com/repos/apache/couchdb/issues/539","id":306912689,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjkxMjY4OQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-07T20:19:30Z","updated_at":"2017-06-07T20:19:30Z","author_association":"MEMBER","body":"Just realized I didn't explicitly +1 this... so:\r\n\r\n+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306912689/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306916161","html_url":"https://github.com/apache/couchdb/issues/571#issuecomment-306916161","issue_url":"https://api.github.com/repos/apache/couchdb/issues/571","id":306916161,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjkxNjE2MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-07T20:33:01Z","updated_at":"2017-06-07T20:33:01Z","author_association":"MEMBER","body":"The patch here didn't work - see #583. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306916161/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306916297","html_url":"https://github.com/apache/couchdb/issues/583#issuecomment-306916297","issue_url":"https://api.github.com/repos/apache/couchdb/issues/583","id":306916297,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjkxNjI5Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-07T20:33:32Z","updated_at":"2017-06-07T20:33:32Z","author_association":"MEMBER","body":"Closing as a duplicate of #571.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306916297/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306934907","html_url":"https://github.com/apache/couchdb/issues/551#issuecomment-306934907","issue_url":"https://api.github.com/repos/apache/couchdb/issues/551","id":306934907,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNjkzNDkwNw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-07T21:47:05Z","updated_at":"2017-06-08T04:36:26Z","author_association":"MEMBER","body":"Based on @nickva 's suppositions, I attempted a low-memory, low-stack-size invocation of couch and couchjs respectively. For reference:\r\n\r\n```sh\r\n$ docker run -it -m 256M --memory-swap 0 --memory-reservation 256M couchdbdev/centos-7-erlang-18.3 /bin/bash\r\n```\r\n\r\nThen, after pulling & building couch master inside the VM, editing `dev/run` to add `-S 65535` or `-S 16384` to the `javascript =` line (L268)\r\n\r\nFinally, running the test in a loop:\r\n\r\n```sh\r\n$ for i in `seq 1 500`; do make suites=reduce.js javascript; done\r\n```\r\n\r\nNo failures after 500 executions. It didn't help reproduce the problem. :(\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/306934907/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307010881","html_url":"https://github.com/apache/couchdb/issues/571#issuecomment-307010881","issue_url":"https://api.github.com/repos/apache/couchdb/issues/571","id":307010881,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzAxMDg4MQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-08T06:26:14Z","updated_at":"2017-06-08T06:26:14Z","author_association":"CONTRIBUTOR","body":"\r\nTook a look at this. Part of shutdown code is in `terminate` callback in `couch_os_daemons` module. In `terminate` each port is sequentially stopped. When stopping, it spawns an os process to run \"kill -9 <pid>\" then port is also closed with \"port_close\". Forking another process and the sequential part could take a while I suppose. In this particular case we can probably wrap the test teardown code iin a try/except and then if cleanup fails issue an `exit(OsDPid, kill)` signal.\r\n\r\nHowever speaking of timing, ran this on my laptop (5 year old Thinkpad, 1.9Ghz, Ubuntu 17.04) and the `should_spawn_multiple_daemons.` test finishes in `[0.006 s]` seconds. From the log above I see it finished in `[0.607 s]` on our test runner. That's over a 100x slowdown. It's not scientific, of course, but even so seems like a significant difference. Wonder if there is any way to guarantee a minimum performance profile in the test runners, or least abandon a test run if we see it's running at the speed of a pocket calculator.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307010881/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307014381","html_url":"https://github.com/apache/couchdb/issues/571#issuecomment-307014381","issue_url":"https://api.github.com/repos/apache/couchdb/issues/571","id":307014381,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzAxNDM4MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-08T06:46:22Z","updated_at":"2017-06-08T06:46:22Z","author_association":"MEMBER","body":"Look at the rest of the test run logfile - most of the tests complete pretty speedily, certainly not 100x slower. We just have occasional slowdowns, I guess, possibly related to process execution. The environment is largely out of our control, unless Cloudant is prepared to donate hosts for full control by the ASF on which we can run our Dockerized tests.\r\n\r\nIf the entire test run takes > 45 minutes, we abort the test run. Our tests should complete in 20 minutes. I think that's enough safeguarding.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307014381/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307021062","html_url":"https://github.com/apache/couchdb/pull/560#issuecomment-307021062","issue_url":"https://api.github.com/repos/apache/couchdb/issues/560","id":307021062,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzAyMTA2Mg==","user":{"login":"jiangphcn","id":18000622,"node_id":"MDQ6VXNlcjE4MDAwNjIy","avatar_url":"https://avatars.githubusercontent.com/u/18000622?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangphcn","html_url":"https://github.com/jiangphcn","followers_url":"https://api.github.com/users/jiangphcn/followers","following_url":"https://api.github.com/users/jiangphcn/following{/other_user}","gists_url":"https://api.github.com/users/jiangphcn/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangphcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangphcn/subscriptions","organizations_url":"https://api.github.com/users/jiangphcn/orgs","repos_url":"https://api.github.com/users/jiangphcn/repos","events_url":"https://api.github.com/users/jiangphcn/events{/privacy}","received_events_url":"https://api.github.com/users/jiangphcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-08T07:20:38Z","updated_at":"2017-06-08T07:20:38Z","author_association":"CONTRIBUTOR","body":"Thanks so much @eiri for your review and suggestions. I have addressed all of your current comments. You also mentioned that we want to have another PR to introduce \"customer less\". So don't change in this PR. \r\n\r\nI run test suites below and they can pass. Finally, thanks again! \r\n\r\nmake eunit apps=couch_mrview suites=couch_mrview_changes_since_tests\r\n```\r\n======================== EUnit ========================\r\nmodule 'couch_mrview_changes_since_tests'\r\n  changes_since tests\r\n    couch_mrview_changes_since_tests:109: test_basic...ok\r\n    couch_mrview_changes_since_tests:132: test_basic_since...ok\r\n    couch_mrview_changes_since_tests:145: test_basic_count...ok\r\n    couch_mrview_changes_since_tests:154: test_basic_count_since...ok\r\n    couch_mrview_changes_since_tests:164: test_compact...ok\r\n    couch_mrview_changes_since_tests:164: test_compact...ok\r\n[os_mon] cpu supervisor port (cpu_sup): Erlang has closed\r\n    [done in 0.666 s]\r\n  changes_since_range tests\r\n    couch_mrview_changes_since_tests:120: test_range...ok\r\n    couch_mrview_changes_since_tests:141: test_range_since...ok\r\n[os_mon] cpu supervisor port (cpu_sup): Erlang has closed\r\n    [done in 0.236 s]\r\n  changes_since_range_count tests\r\n    couch_mrview_changes_since_tests:150: test_range_count...ok\r\n    couch_mrview_changes_since_tests:159: test_range_count_since...ok\r\n    couch_mrview_changes_since_tests:196: test_remove_key...ok\r\n    couch_mrview_changes_since_tests:197: test_remove_key...ok\r\n    couch_mrview_changes_since_tests:198: test_remove_key...ok\r\n    couch_mrview_changes_since_tests:199: test_remove_key...ok\r\n[os_mon] cpu supervisor port (cpu_sup): Erlang has closed\r\n    [done in 0.423 s]\r\n  [done in 3.173 s]\r\n=======================================================\r\n  All 14 tests passed.\r\n==> rel (eunit)\r\n```\r\nmake eunit apps=couch_mrview\r\n```\r\n    [done in 0.589 s]\r\n  [done in 0.734 s]\r\n=======================================================\r\n  All 129 tests passed.\r\n==> rel (eunit)\r\n==> couchdb (eunit)\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307021062/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307148429","html_url":"https://github.com/apache/couchdb/issues/571#issuecomment-307148429","issue_url":"https://api.github.com/repos/apache/couchdb/issues/571","id":307148429,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzE0ODQyOQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-08T16:00:22Z","updated_at":"2017-06-08T16:00:22Z","author_association":"CONTRIBUTOR","body":"Yap, obviously it's not a sustained 100x slowdown but there are either random spikes or like you said related to specific operations (forking, reading from disk, socket stuff maybe...).\r\n\r\nBesides getting dedicated hosts with predictable performance profile wonder if Travis has anything to mitigate this. Say if test fails retry one more time. Or take the best of 5 runs.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307148429/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307192137","html_url":"https://github.com/apache/couchdb/issues/588#issuecomment-307192137","issue_url":"https://api.github.com/repos/apache/couchdb/issues/588","id":307192137,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzE5MjEzNw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-08T18:43:11Z","updated_at":"2017-06-08T18:43:11Z","author_association":"MEMBER","body":"This is a duplicate of https://github.com/apache/couchdb/issues/508 . We hope to fix this problem with the CouchDB 2.1 release.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307192137/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307192614","html_url":"https://github.com/apache/couchdb/issues/571#issuecomment-307192614","issue_url":"https://api.github.com/repos/apache/couchdb/issues/571","id":307192614,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzE5MjYxNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-08T18:45:01Z","updated_at":"2017-06-08T18:45:01Z","author_association":"MEMBER","body":"Travis doesn't do \"best of 5\" unless you explicitly enable it. And to my mind that's just sweeping the problem under the rug.....","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307192614/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307250710","html_url":"https://github.com/apache/couchdb/issues/581#issuecomment-307250710","issue_url":"https://api.github.com/repos/apache/couchdb/issues/581","id":307250710,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzI1MDcxMA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-08T23:03:23Z","updated_at":"2017-06-08T23:03:23Z","author_association":"MEMBER","body":"Just a note: it turned out there could be two causes for this failure 1) we are indeed checking event manager before it had chance to remove old handler 2) `couch_log_sup` is super fast and spawns and register new handler before we are pulling `which_handlers/1`, so we are getting _new_ handler. Just `sleep` would help in half of the cases, so I ended with something a bit more verbose. Hope it'll work more reliably. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307250710/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307254016","html_url":"https://github.com/apache/couchdb/pull/590#issuecomment-307254016","issue_url":"https://api.github.com/repos/apache/couchdb/issues/590","id":307254016,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzI1NDAxNg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-08T23:24:02Z","updated_at":"2017-06-08T23:24:02Z","author_association":"MEMBER","body":"Ironically your test for this build failed on the couch_log_config_listener_test:\r\n\r\nhttps://travis-ci.org/apache/couchdb/jobs/240997782","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307254016/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307259486","html_url":"https://github.com/apache/couchdb/pull/590#issuecomment-307259486","issue_url":"https://api.github.com/repos/apache/couchdb/issues/590","id":307259486,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzI1OTQ4Ng==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-09T00:01:32Z","updated_at":"2017-06-09T00:01:32Z","author_association":"MEMBER","body":"Ironically indeed :/\r\n\r\nSince it's guaranteed that the old handler was gone, it sent `'DOWN'` after all, that means this is a new registered handler already spawned by sup. I'll have to bash my head now to figure out what can be done about this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307259486/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307277217","html_url":"https://github.com/apache/couchdb/pull/560#issuecomment-307277217","issue_url":"https://api.github.com/repos/apache/couchdb/issues/560","id":307277217,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzI3NzIxNw==","user":{"login":"jiangphcn","id":18000622,"node_id":"MDQ6VXNlcjE4MDAwNjIy","avatar_url":"https://avatars.githubusercontent.com/u/18000622?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangphcn","html_url":"https://github.com/jiangphcn","followers_url":"https://api.github.com/users/jiangphcn/followers","following_url":"https://api.github.com/users/jiangphcn/following{/other_user}","gists_url":"https://api.github.com/users/jiangphcn/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangphcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangphcn/subscriptions","organizations_url":"https://api.github.com/users/jiangphcn/orgs","repos_url":"https://api.github.com/users/jiangphcn/repos","events_url":"https://api.github.com/users/jiangphcn/events{/privacy}","received_events_url":"https://api.github.com/users/jiangphcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-09T02:19:22Z","updated_at":"2017-06-09T02:19:22Z","author_association":"CONTRIBUTOR","body":"@eiri thanks again for review and approval. Because I didn't have write access to  `https://github.com/apache/couchdb`, so currently I am working on `https://github.com/cloudant/couchdb`. I rebased from `https://github.com/cloudant/couchdb` and  squash commits. Right now, I can see `All Checks have passed`. Would you please help check and merge to  `https://github.com/apache/couchdb` if applicable? Thanks.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307277217/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307406084","html_url":"https://github.com/apache/couchdb/pull/591#issuecomment-307406084","issue_url":"https://api.github.com/repos/apache/couchdb/issues/591","id":307406084,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzQwNjA4NA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-09T14:36:01Z","updated_at":"2017-06-09T14:36:01Z","author_association":"CONTRIBUTOR","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307406084/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307457715","html_url":"https://github.com/apache/couchdb/issues/565#issuecomment-307457715","issue_url":"https://api.github.com/repos/apache/couchdb/issues/565","id":307457715,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzQ1NzcxNQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-09T17:58:05Z","updated_at":"2017-06-09T17:58:05Z","author_association":"CONTRIBUTOR","body":"Have we seen these after this commit https://github.com/apache/couchdb/commit/05d2e1e6a7db3e2526530cdbb446034557b94e57 ?\r\n\r\nWondering if that fixed this as well","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307457715/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307457776","html_url":"https://github.com/apache/couchdb/issues/589#issuecomment-307457776","issue_url":"https://api.github.com/repos/apache/couchdb/issues/589","id":307457776,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzQ1Nzc3Ng==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-09T17:58:22Z","updated_at":"2017-06-09T17:58:22Z","author_association":"CONTRIBUTOR","body":"Have we seen more of these after this commit: https://github.com/apache/couchdb/commit/05d2e1e6a7db3e2526530cdbb446034557b94e57 ?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307457776/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307475987","html_url":"https://github.com/apache/couchdb/issues/589#issuecomment-307475987","issue_url":"https://api.github.com/repos/apache/couchdb/issues/589","id":307475987,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzQ3NTk4Nw==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-09T19:14:34Z","updated_at":"2017-06-09T19:14:34Z","author_association":"MEMBER","body":"@nickva this issue opened 23 hours ago, the commit done 4 days ago, so I guess the answer is yes :)\r\n\r\nOn a different topic - @wohali this issue seems to be duplicate of apache/couchdb#565, should we close one of them?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307475987/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307521943","html_url":"https://github.com/apache/couchdb/issues/589#issuecomment-307521943","issue_url":"https://api.github.com/repos/apache/couchdb/issues/589","id":307521943,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzUyMTk0Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-09T23:12:46Z","updated_at":"2017-06-09T23:12:46Z","author_association":"MEMBER","body":"Sorry, my mistake. This is a duplicate of #565 so I'll close this one.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307521943/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307589029","html_url":"https://github.com/apache/couchdb/issues/508#issuecomment-307589029","issue_url":"https://api.github.com/repos/apache/couchdb/issues/508","id":307589029,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzU4OTAyOQ==","user":{"login":"nueko","id":2134953,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIxMzQ5NTM=","avatar_url":"https://avatars.githubusercontent.com/u/2134953?v=4","gravatar_id":"","url":"https://api.github.com/users/nueko","html_url":"https://github.com/nueko","followers_url":"https://api.github.com/users/nueko/followers","following_url":"https://api.github.com/users/nueko/following{/other_user}","gists_url":"https://api.github.com/users/nueko/gists{/gist_id}","starred_url":"https://api.github.com/users/nueko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nueko/subscriptions","organizations_url":"https://api.github.com/users/nueko/orgs","repos_url":"https://api.github.com/users/nueko/repos","events_url":"https://api.github.com/users/nueko/events{/privacy}","received_events_url":"https://api.github.com/users/nueko/received_events","type":"Organization","user_view_type":"public","site_admin":false},"created_at":"2017-06-10T20:41:13Z","updated_at":"2017-06-10T20:43:13Z","author_association":"NONE","body":"it is NSSM related issue, see [here](https://nssm.cc/download)\r\n> Windows 10 Creators Update\r\n\r\n>2017-04-26: Users of Windows 10 Creators Update should use prelease build 2.2.4-101 to avoid an issue with services failing to start. If for some reason you cannot use that build you can also set AppNoConsole=1 in the registry, noting that applications which expect a console window may behave unexpectedly.\r\n\r\n>Thanks to Sebasian Krause for the initial diagnosis.\r\n\r\nMy temporary solution is run it manually \r\n```powershell\r\nStart-Process -WorkingDirectory \"D:\\\\Applications\\\\CouchDB\" -FilePath \"bin\\\\couchdb.cmd\" -WindowStyle Hidden\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307589029/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307593069","html_url":"https://github.com/apache/couchdb/issues/508#issuecomment-307593069","issue_url":"https://api.github.com/repos/apache/couchdb/issues/508","id":307593069,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzU5MzA2OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-10T22:09:20Z","updated_at":"2017-06-10T22:09:20Z","author_association":"MEMBER","body":"Thanks for the diagnosis @nueko ! We'll update the version of `nssm.exe` we use in the next build.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307593069/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307593496","html_url":"https://github.com/apache/couchdb/issues/593#issuecomment-307593496","issue_url":"https://api.github.com/repos/apache/couchdb/issues/593","id":307593496,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzU5MzQ5Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-10T22:19:35Z","updated_at":"2017-06-10T22:19:35Z","author_association":"MEMBER","body":"If possible I'd like to patch this pre-2.1 if we can. The work is pretty straightforward, but we'll want to write tests for it ideally.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307593496/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307593643","html_url":"https://github.com/apache/couchdb/issues/508#issuecomment-307593643","issue_url":"https://api.github.com/repos/apache/couchdb/issues/508","id":307593643,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzU5MzY0Mw==","user":{"login":"nueko","id":2134953,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIxMzQ5NTM=","avatar_url":"https://avatars.githubusercontent.com/u/2134953?v=4","gravatar_id":"","url":"https://api.github.com/users/nueko","html_url":"https://github.com/nueko","followers_url":"https://api.github.com/users/nueko/followers","following_url":"https://api.github.com/users/nueko/following{/other_user}","gists_url":"https://api.github.com/users/nueko/gists{/gist_id}","starred_url":"https://api.github.com/users/nueko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nueko/subscriptions","organizations_url":"https://api.github.com/users/nueko/orgs","repos_url":"https://api.github.com/users/nueko/repos","events_url":"https://api.github.com/users/nueko/events{/privacy}","received_events_url":"https://api.github.com/users/nueko/received_events","type":"Organization","user_view_type":"public","site_admin":false},"created_at":"2017-06-10T22:22:56Z","updated_at":"2017-06-10T22:23:56Z","author_association":"NONE","body":"also by copying `nssm.exe` from the pre-release version does work here.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307593643/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307643197","html_url":"https://github.com/apache/couchdb/issues/594#issuecomment-307643197","issue_url":"https://api.github.com/repos/apache/couchdb/issues/594","id":307643197,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzY0MzE5Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-11T17:17:33Z","updated_at":"2017-06-11T17:17:33Z","author_association":"MEMBER","body":"You can do this right now very easily with two queries. Each query would use `startkey` and `endkey` to access the entire range of keys just before and just after the key you are wanting to exclude.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307643197/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307954410","html_url":"https://github.com/apache/couchdb/issues/551#issuecomment-307954410","issue_url":"https://api.github.com/repos/apache/couchdb/issues/551","id":307954410,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzk1NDQxMA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-12T22:42:45Z","updated_at":"2017-06-12T22:42:45Z","author_association":"CONTRIBUTOR","body":"I looked at this a bit today. Compiled couchjs from mozjs 1.8.5 source on a CentOS 7 VM. \r\n\r\nThe created a patch to run log all couchjs inputs to file. Then fed that input to that couchjs process in a loop. So far no crashes.\r\n\r\nThe ran valgrind against couchjs with a few lines of input. It found a whole bunch of uninitialized variable uses but apparently those are ok according to upstream and to reduce the noise have to set `./configure --enable-valgrind` that made it better and only showed two leaks:\r\n\r\n```\r\n==2212==\r\n==2212== HEAP SUMMARY:\r\n==2212==     in use at exit: 608 bytes in 2 blocks\r\n==2212==   total heap usage: 1,157,666 allocs, 1,157,664 frees, 470,097,237 bytes allocated\r\n==2212==\r\n==2212== 40 bytes in 1 blocks are definitely lost in loss record 1 of 2\r\n==2212==    at 0x4C27BE3: malloc (vg_replace_malloc.c:299)\r\n==2212==    by 0x4056EF: couch_parse_args (util.c:75)\r\n==2212==    by 0x4048E2: main (main.c:388)\r\n==2212==\r\n==2212== 568 bytes in 1 blocks are still reachable in loss record 2 of 2\r\n==2212==    at 0x4C27BE3: malloc (vg_replace_malloc.c:299)\r\n==2212==    by 0x596654C: __fopen_internal (iofopen.c:73)\r\n==2212==    by 0x405529: slurp_file (util.c:36)\r\n==2212==    by 0x405CDA: couch_readfile (util.c:203)\r\n==2212==    by 0x404B53: main (main.c:449)\r\n==2212==\r\n==2212== LEAK SUMMARY:\r\n==2212==    definitely lost: 40 bytes in 1 blocks\r\n==2212==    indirectly lost: 0 bytes in 0 blocks\r\n==2212==      possibly lost: 0 bytes in 0 blocks\r\n==2212==    still reachable: 568 bytes in 1 blocks\r\n==2212==         suppressed: 0 bytes in 0 blocks\r\n==2212==\r\n==2212== For counts of detected and suppressed errors, rerun with: -v\r\n==2212== ERROR SUMMARY: 1 errors from 1 contexts (suppressed: 0 from 0)\r\n```\r\n\r\nThose are ok. It would be good to clean them up but the process exits at that point it doesn't seem like the culprit.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307954410/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307992413","html_url":"https://github.com/apache/couchdb/issues/551#issuecomment-307992413","issue_url":"https://api.github.com/repos/apache/couchdb/issues/551","id":307992413,"node_id":"MDEyOklzc3VlQ29tbWVudDMwNzk5MjQxMw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-13T02:57:44Z","updated_at":"2017-06-13T02:57:44Z","author_association":"MEMBER","body":"So to me this suggests it's not a strict memory leak that's failing. Your idea from IRC about capturing all the stdio for the couchjs process and using that to playback against the process to find the source of the problem is intriguing.\r\n\r\nI'd also appreciate a review of the compile-time settings for our js libs across platforms, compilers used, and whether anything there might be at fault.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/307992413/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/308220014","html_url":"https://github.com/apache/couchdb/pull/595#issuecomment-308220014","issue_url":"https://api.github.com/repos/apache/couchdb/issues/595","id":308220014,"node_id":"MDEyOklzc3VlQ29tbWVudDMwODIyMDAxNA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-13T19:17:38Z","updated_at":"2017-06-13T19:17:38Z","author_association":"MEMBER","body":"The tests are fine locally and `404` is better than `500`, so the change itself looks good to me.\r\n\r\nThe only thing is that I'm not 100% sure that we should return `404` and not `409` here. I understand we are crashing with `not_found`, but update of attachment is doc's update and we are throwing 409 on attempt to update doc with non-existing revision. So from consistency perspective we might want to do this here as well.\r\n\r\nI'm tentatively +1, but get a second opinion before merging, please.\r\n\r\n\r\nLocal tests:\r\n\r\n```bash\r\nmake eunit apps=chttpd\r\n...\r\n=======================================================\r\n  All 150 tests passed.\r\n```\r\n\r\n```bash\r\nmake javascript\r\n...\r\n=======================================================\r\nJavaScript tests complete.\r\n  Failed: 0.  Skipped or passed: 86.\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/308220014/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/308248643","html_url":"https://github.com/apache/couchdb/pull/596#issuecomment-308248643","issue_url":"https://api.github.com/repos/apache/couchdb/issues/596","id":308248643,"node_id":"MDEyOklzc3VlQ29tbWVudDMwODI0ODY0Mw==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-13T21:06:28Z","updated_at":"2017-06-13T21:06:28Z","author_association":"MEMBER","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/308248643/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/308259436","html_url":"https://github.com/apache/couchdb/pull/595#issuecomment-308259436","issue_url":"https://api.github.com/repos/apache/couchdb/issues/595","id":308259436,"node_id":"MDEyOklzc3VlQ29tbWVudDMwODI1OTQzNg==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-06-13T21:51:22Z","updated_at":"2017-06-13T21:51:22Z","author_association":"CONTRIBUTOR","body":"@eiri thanks for the review. I chose 404 since it seemed like that was consistent with other \"not_found\" errors, but I understand your concern. I agree we should have at least a second opinion.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/308259436/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]