[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590323","html_url":"https://github.com/apache/couchdb/issues/4227#issuecomment-1280590323","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4227","id":1280590323,"node_id":"MDEyOklzc3VlQ29tbWVudDEyODA1OTAzMjM=","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-19T22:50:14Z","updated_at":"2020-12-19T22:51:14Z","author_association":"MEMBER","body":"I read the links a bit more carefully, so I want to ask: are you sure this is a problem for btrfs? Have you seen a significant CouchDB performance change when altering the file setting? Alternatively, what does `filefrag` say on those files on a system that has been in production for a while?\r\n\r\nUnlike traditional SQL databases, CouchDB doesn't do random writes to its database files. It only ever appends to a file. (It is, in fact, a copy-on-write B-tree database itself, just like btrfs.) The link you gave suggests that this is only an issue for files that have lots of random writes. That never happens with CouchDB: it will only ever write to a disk block once.\r\n\r\nAlso, compaction will rewrite the database and all of its views/indexes to new files when necessary. CouchDB 3.x has a fairly aggressive compaction setting, meaning databases will get compacted if they see a lot of writes anyway. In this scenario, given the entire database & index files are rewritten as part of compaction, I wonder how bad the situation really is.\r\n\r\nIf this is really an issue (and I'm not saying it's not, I'd just like to be sure that it is), it is a pretty specific, narrow use case. In general, we don't detect or address this sort of thing automatically at installation or setup time. Given how long CouchDB's been around, and this is the first we're hearing of this, I'm guessing there's either not a problem (see above) or CouchDB+btrfs use in production is limited. (Most deployments I know of use ext4, xfs, or zfs.)\r\n\r\n-----\r\n\r\nI would add this as a callout [at this line](https://github.com/apache/couchdb-documentation/blame/main/src/install/unix.rst#L161), just before the \"Installation from source\" section. You can use a warning box, [like this one](https://github.com/apache/couchdb-documentation/blame/main/src/install/windows.rst#L26).\r\n\r\nI would not include the entire script, especially not with all of the moves/etc. We like to treat our users as capable system administrators, it should be enough to provide the basics. So I would say something like:\r\n\r\n```\r\n*Note*: On btrfs, performance is improved by disabling copy-on-write for the ``data/`` directory. This is done by moving the old directory aside, creating a new one, then setting `chattr +C` on it. You may want to copy your databases and indexes back over, if you have any data to keep.\r\n```\r\n\r\nThat's only suggested text, please rewrite however you see fit.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590323/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590330","html_url":"https://github.com/apache/couchdb/issues/4227#issuecomment-1280590330","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4227","id":1280590330,"node_id":"MDEyOklzc3VlQ29tbWVudDEyODA1OTAzMzA=","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-19T22:51:00Z","updated_at":"2020-12-19T22:51:00Z","author_association":"MEMBER","body":"And - thank you so much for helping us build and maintain CouchDB! 🥰👨‍🚀🏋️‍♀️","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590330/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590334","html_url":"https://github.com/apache/couchdb/issues/4227#issuecomment-1280590334","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4227","id":1280590334,"node_id":"MDEyOklzc3VlQ29tbWVudDEyODA1OTAzMzQ=","user":{"login":"ceremcem","id":6639874,"node_id":"MDQ6VXNlcjY2Mzk4NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/6639874?v=4","gravatar_id":"","url":"https://api.github.com/users/ceremcem","html_url":"https://github.com/ceremcem","followers_url":"https://api.github.com/users/ceremcem/followers","following_url":"https://api.github.com/users/ceremcem/following{/other_user}","gists_url":"https://api.github.com/users/ceremcem/gists{/gist_id}","starred_url":"https://api.github.com/users/ceremcem/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ceremcem/subscriptions","organizations_url":"https://api.github.com/users/ceremcem/orgs","repos_url":"https://api.github.com/users/ceremcem/repos","events_url":"https://api.github.com/users/ceremcem/events{/privacy}","received_events_url":"https://api.github.com/users/ceremcem/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-19T23:31:22Z","updated_at":"2020-12-19T23:50:19Z","author_association":"CONTRIBUTOR","body":"> Have you seen a significant CouchDB performance change when altering the file setting? Alternatively, what does filefrag say on those files on a system that has been in production for a while?\r\n\r\nThis needs to be measured. Luckily I have a production setup on BTRFS where I forgot to change that CoW flag, so system was running without CoW flag disabled for a year. I was experiencing lots of interesting issues with database microservice, but that might not be related directly with this topic. Let's see. \r\n\r\nCouchDB 3.x on my Laptop in LXC container (Debian Buster, freshly installed), with ~20K documents synced *after* `chattr +C /var/lib/couchdb`  with the `production server` :\r\n```commands\r\nroot@couchdb-erik:/var/lib# find couchdb -type f -exec filefrag {} \\; \r\ncouchdb/couchdb/_dbs.couch: 1 extent found\r\ncouchdb/couchdb/_nodes.couch: 1 extent found\r\ncouchdb/couchdb/shards/80000000-ffffffff/_users.1608348635.couch: 1 extent found\r\ncouchdb/couchdb/shards/80000000-ffffffff/_replicator.1608348637.couch: 1 extent found\r\ncouchdb/couchdb/shards/80000000-ffffffff/test.1608349285.couch: 1 extent found\r\ncouchdb/couchdb/shards/00000000-7fffffff/_users.1608348635.couch: 1 extent found\r\ncouchdb/couchdb/shards/00000000-7fffffff/_replicator.1608348637.couch: 1 extent found\r\ncouchdb/couchdb/shards/00000000-7fffffff/test.1608349285.couch: 1 extent found\r\ncouchdb/_dbs.couch: 5 extents found\r\ncouchdb/_nodes.couch: 1 extent found\r\ncouchdb/shards/80000000-ffffffff/_users.1608348635.couch: 1 extent found\r\ncouchdb/shards/80000000-ffffffff/_replicator.1608348637.couch: 3 extents found\r\ncouchdb/shards/80000000-ffffffff/test.1608349285.couch: 1 extent found\r\ncouchdb/shards/80000000-ffffffff/foo2.1608351797.couch: 2 extents found\r\ncouchdb/shards/80000000-ffffffff/foo2.1608353430.couch.compact.meta: 2 extents found\r\ncouchdb/shards/80000000-ffffffff/foo2.1608353430.couch: 31 extents found\r\ncouchdb/shards/00000000-7fffffff/_users.1608348635.couch: 1 extent found\r\ncouchdb/shards/00000000-7fffffff/_replicator.1608348637.couch: 18 extents found\r\ncouchdb/shards/00000000-7fffffff/test.1608349285.couch: 1 extent found\r\ncouchdb/shards/00000000-7fffffff/foo2.1608351797.couch: 2 extents found\r\ncouchdb/shards/00000000-7fffffff/foo2.1608353430.couch.compact.meta: 2 extents found\r\ncouchdb/shards/00000000-7fffffff/foo2.1608353430.couch: 20 extents found\r\n```\r\n\r\nCouchDB 3.x on my server in LXC container (Debian Buster, freshly installed), with ~20K documents synced *after* `chattr +C /var/lib/couchdb`  with the `production server` :\r\n\r\n```\r\nroot@aktos-couch4:/var/lib# find couchdb -type f -exec filefrag {} \\;\r\ncouchdb/_dbs.couch: 2 extents found\r\ncouchdb/_nodes.couch: 1 extent found\r\ncouchdb/shards/80000000-ffffffff/_users.1608390062.couch: 1 extent found\r\ncouchdb/shards/80000000-ffffffff/_replicator.1608390062.couch: 3 extents found\r\ncouchdb/shards/80000000-ffffffff/foo2.1608390979.couch.compact.meta: 3 extents found\r\ncouchdb/shards/80000000-ffffffff/foo2.1608390979.couch: 922 extents found\r\ncouchdb/shards/00000000-7fffffff/_users.1608390062.couch: 1 extent found\r\ncouchdb/shards/00000000-7fffffff/_replicator.1608390062.couch: 1 extent found\r\ncouchdb/shards/00000000-7fffffff/foo2.1608390979.couch.compact.meta: 6 extents found\r\ncouchdb/shards/00000000-7fffffff/foo2.1608390979.couch: 290 extents found\r\n```\r\n\r\nCouchDB 2.x on my server in LXC container (Debian Stretch), with ~20K documents. This is my production server (where CoW is not disabled):\r\n\r\n```\r\nroot@aktos-couch3:/var/lib# find couchdb -type f -exec filefrag {} \\; | sort -t\":\" -k 2 -n -r\r\ncouchdb/shards/c0000000-dfffffff/foo2.1576202327.couch: 8882 extents found\r\ncouchdb/shards/40000000-5fffffff/foo2.1576202327.couch: 8707 extents found\r\ncouchdb/shards/80000000-9fffffff/foo2.1576202327.couch: 3514 extents found\r\ncouchdb/shards/60000000-7fffffff/foo2.1576202327.couch: 2336 extents found\r\ncouchdb/shards/a0000000-bfffffff/foo2.1576202327.couch: 2320 extents found\r\ncouchdb/shards/00000000-1fffffff/foo2.1576202327.couch: 2210 extents found\r\ncouchdb/shards/e0000000-ffffffff/foo2.1576202327.couch: 2186 extents found\r\ncouchdb/shards/20000000-3fffffff/foo2.1576202327.couch: 2041 extents found\r\ncouchdb/.shards/60000000-7fffffff/foo2.1576202327_design/mrview/ff377ba3dcf6801401e64c4b47ee91f0.view: 825 extents found\r\ncouchdb/.shards/60000000-7fffffff/foo2.1576202327_design/mrview/60c0365cb541a047d8841256fb5104af.view: 824 extents found\r\ncouchdb/.shards/60000000-7fffffff/foo2.1576202327_design/mrview/54f171fe1f24ac4eb52ac24c85f9d8fc.view: 824 extents found\r\ncouchdb/.shards/a0000000-bfffffff/foo2.1576202327_design/mrview/54f171fe1f24ac4eb52ac24c85f9d8fc.view: 814 extents found\r\ncouchdb/.shards/a0000000-bfffffff/foo2.1576202327_design/mrview/ff377ba3dcf6801401e64c4b47ee91f0.view: 811 extents found\r\ncouchdb/.shards/a0000000-bfffffff/foo2.1576202327_design/mrview/60c0365cb541a047d8841256fb5104af.view: 810 extents found\r\ncouchdb/.shards/40000000-5fffffff/foo2.1576202327_design/mrview/ff377ba3dcf6801401e64c4b47ee91f0.view: 806 extents found\r\ncouchdb/.shards/40000000-5fffffff/foo2.1576202327_design/mrview/60c0365cb541a047d8841256fb5104af.view: 805 extents found\r\ncouchdb/.shards/00000000-1fffffff/foo2.1576202327_design/mrview/ff377ba3dcf6801401e64c4b47ee91f0.view: 788 extents found\r\ncouchdb/.shards/00000000-1fffffff/foo2.1576202327_design/mrview/60c0365cb541a047d8841256fb5104af.view: 788 extents found\r\ncouchdb/.shards/00000000-1fffffff/foo2.1576202327_design/mrview/54f171fe1f24ac4eb52ac24c85f9d8fc.view: 788 extents found\r\ncouchdb/.shards/20000000-3fffffff/foo2.1576202327_design/mrview/ff377ba3dcf6801401e64c4b47ee91f0.view: 782 extents found\r\ncouchdb/.shards/20000000-3fffffff/foo2.1576202327_design/mrview/54f171fe1f24ac4eb52ac24c85f9d8fc.view: 780 extents found\r\ncouchdb/.shards/20000000-3fffffff/foo2.1576202327_design/mrview/60c0365cb541a047d8841256fb5104af.view: 779 extents found\r\ncouchdb/.shards/c0000000-dfffffff/foo2.1576202327_design/mrview/60c0365cb541a047d8841256fb5104af.view: 759 extents found\r\ncouchdb/.shards/c0000000-dfffffff/foo2.1576202327_design/mrview/ff377ba3dcf6801401e64c4b47ee91f0.view: 758 extents found\r\ncouchdb/.shards/e0000000-ffffffff/foo2.1576202327_design/mrview/ff377ba3dcf6801401e64c4b47ee91f0.view: 737 extents found\r\ncouchdb/.shards/e0000000-ffffffff/foo2.1576202327_design/mrview/60c0365cb541a047d8841256fb5104af.view: 737 extents found\r\ncouchdb/.shards/e0000000-ffffffff/foo2.1576202327_design/mrview/54f171fe1f24ac4eb52ac24c85f9d8fc.view: 737 extents found\r\ncouchdb/.shards/80000000-9fffffff/foo2.1576202327_design/mrview/60c0365cb541a047d8841256fb5104af.view: 705 extents found\r\ncouchdb/.shards/80000000-9fffffff/foo2.1576202327_design/mrview/ff377ba3dcf6801401e64c4b47ee91f0.view: 704 extents found\r\ncouchdb/.shards/80000000-9fffffff/foo2.1576202327_design/mrview/54f171fe1f24ac4eb52ac24c85f9d8fc.view: 703 extents found\r\ncouchdb/.shards/20000000-3fffffff/foo2.1576202327_design/mrview/efaeb757cdb9120e0d2d312a237f955c.view: 41 extents found\r\ncouchdb/.shards/e0000000-ffffffff/foo2.1576202327_design/mrview/903132c98329dd5618a69593f92f1088.view: 34 extents found\r\ncouchdb/.shards/60000000-7fffffff/foo2.1576202327_design/mrview/efaeb757cdb9120e0d2d312a237f955c.view: 33 extents found\r\ncouchdb/shards/e0000000-ffffffff/demo.1576774963.couch: 32 extents found\r\ncouchdb/.shards/c0000000-dfffffff/foo2.1576202327_design/mrview/efaeb757cdb9120e0d2d312a237f955c.view: 32 extents found\r\ncouchdb/shards/c0000000-dfffffff/demo.1576774963.couch: 32 extents found\r\ncouchdb/shards/80000000-9fffffff/demo.1576774963.couch: 32 extents found\r\ncouchdb/shards/40000000-5fffffff/demo.1576774963.couch: 32 extents found\r\ncouchdb/shards/20000000-3fffffff/demo.1576774963.couch: 32 extents found\r\ncouchdb/shards/a0000000-bfffffff/demo.1576774963.couch: 31 extents found\r\ncouchdb/shards/60000000-7fffffff/demo.1576774963.couch: 31 extents found\r\ncouchdb/shards/00000000-1fffffff/demo.1576774963.couch: 31 extents found\r\ncouchdb/.shards/60000000-7fffffff/foo2.1576202327_design/mrview/77698c399d7c398c3fa2221d547b559a.view: 29 extents found\r\ncouchdb/.shards/e0000000-ffffffff/foo2.1576202327_design/mrview/77698c399d7c398c3fa2221d547b559a.view: 28 extents found\r\ncouchdb/shards/c0000000-dfffffff/_global_changes.1576197947.couch: 26 extents found\r\ncouchdb/.shards/00000000-1fffffff/foo2.1576202327_design/mrview/efaeb757cdb9120e0d2d312a237f955c.view: 26 extents found\r\ncouchdb/.shards/20000000-3fffffff/foo2.1576202327_design/mrview/903132c98329dd5618a69593f92f1088.view: 25 extents found\r\ncouchdb/.shards/80000000-9fffffff/foo2.1576202327_design/mrview/9e6552c45632f3e05a6ae72915e96b9b.view: 24 extents found\r\ncouchdb/.shards/c0000000-dfffffff/foo2.1576202327_design/mrview/54f171fe1f24ac4eb52ac24c85f9d8fc.view: 23 extents found\r\ncouchdb/.shards/a0000000-bfffffff/foo2.1576202327_design/mrview/1f3dc3019c5156f2aa66ab47248add61.view: 22 extents found\r\ncouchdb/.shards/80000000-9fffffff/foo2.1576202327_design/mrview/efaeb757cdb9120e0d2d312a237f955c.view: 21 extents found\r\ncouchdb/.shards/80000000-9fffffff/foo2.1576202327_design/mrview/1f3dc3019c5156f2aa66ab47248add61.view: 21 extents found\r\ncouchdb/.shards/00000000-1fffffff/foo2.1576202327_design/mrview/1f3dc3019c5156f2aa66ab47248add61.view: 21 extents found\r\ncouchdb/.shards/e0000000-ffffffff/foo2.1576202327_design/mrview/efaeb757cdb9120e0d2d312a237f955c.view: 19 extents found\r\ncouchdb/.shards/e0000000-ffffffff/foo2.1576202327_design/mrview/1f3dc3019c5156f2aa66ab47248add61.view: 19 extents found\r\ncouchdb/.shards/a0000000-bfffffff/foo2.1576202327_design/mrview/903132c98329dd5618a69593f92f1088.view: 19 extents found\r\ncouchdb/.shards/40000000-5fffffff/foo2.1576202327_design/mrview/9e6552c45632f3e05a6ae72915e96b9b.view: 19 extents found\r\ncouchdb/.shards/40000000-5fffffff/foo2.1576202327_design/mrview/37b94f6b5836a143c9db7b8a9caf45b9.view: 19 extents found\r\ncouchdb/.shards/80000000-9fffffff/foo2.1576202327_design/mrview/37b94f6b5836a143c9db7b8a9caf45b9.view: 18 extents found\r\ncouchdb/.shards/e0000000-ffffffff/foo2.1576202327_design/mrview/9e6552c45632f3e05a6ae72915e96b9b.view: 15 extents found\r\ncouchdb/.shards/a0000000-bfffffff/foo2.1576202327_design/mrview/37b94f6b5836a143c9db7b8a9caf45b9.view: 15 extents found\r\ncouchdb/.shards/40000000-5fffffff/foo2.1576202327_design/mrview/77698c399d7c398c3fa2221d547b559a.view: 15 extents found\r\ncouchdb/.shards/60000000-7fffffff/foo2.1576202327_design/mrview/9e6552c45632f3e05a6ae72915e96b9b.view: 14 extents found\r\ncouchdb/.shards/20000000-3fffffff/foo2.1576202327_design/mrview/37b94f6b5836a143c9db7b8a9caf45b9.view: 13 extents found\r\ncouchdb/.shards/c0000000-dfffffff/foo2.1576202327_design/mrview/1f3dc3019c5156f2aa66ab47248add61.view: 12 extents found\r\ncouchdb/.shards/60000000-7fffffff/foo2.1576202327_design/mrview/37b94f6b5836a143c9db7b8a9caf45b9.view: 12 extents found\r\ncouchdb/.shards/a0000000-bfffffff/foo2.1576202327_design/mrview/efaeb757cdb9120e0d2d312a237f955c.view: 9 extents found\r\ncouchdb/.shards/80000000-9fffffff/foo2.1576202327_design/mrview/77698c399d7c398c3fa2221d547b559a.view: 9 extents found\r\ncouchdb/.shards/e0000000-ffffffff/foo2.1576202327_design/mrview/37b94f6b5836a143c9db7b8a9caf45b9.view: 8 extents found\r\ncouchdb/.shards/80000000-9fffffff/foo2.1576202327_design/mrview/903132c98329dd5618a69593f92f1088.view: 8 extents found\r\ncouchdb/.shards/60000000-7fffffff/foo2.1576202327_design/mrview/1f3dc3019c5156f2aa66ab47248add61.view: 8 extents found\r\ncouchdb/.shards/20000000-3fffffff/foo2.1576202327_design/mrview/77698c399d7c398c3fa2221d547b559a.view: 8 extents found\r\ncouchdb/.shards/00000000-1fffffff/foo2.1576202327_design/mrview/903132c98329dd5618a69593f92f1088.view: 8 extents found\r\ncouchdb/.shards/40000000-5fffffff/foo2.1576202327_design/mrview/54f171fe1f24ac4eb52ac24c85f9d8fc.view: 7 extents found\r\ncouchdb/.shards/40000000-5fffffff/foo2.1576202327_design/mrview/903132c98329dd5618a69593f92f1088.view: 6 extents found\r\ncouchdb/.shards/00000000-1fffffff/foo2.1576202327_design/mrview/9e6552c45632f3e05a6ae72915e96b9b.view: 6 extents found\r\ncouchdb/shards/e0000000-ffffffff/_global_changes.1576197947.couch: 5 extents found\r\ncouchdb/.shards/a0000000-bfffffff/foo2.1576202327_design/mrview/9e6552c45632f3e05a6ae72915e96b9b.view: 5 extents found\r\ncouchdb/.shards/c0000000-dfffffff/foo2.1576202327_design/mrview/9e6552c45632f3e05a6ae72915e96b9b.view: 4 extents found\r\ncouchdb/.shards/c0000000-dfffffff/foo2.1576202327_design/mrview/37b94f6b5836a143c9db7b8a9caf45b9.view: 4 extents found\r\ncouchdb/.shards/60000000-7fffffff/foo2.1576202327_design/mrview/903132c98329dd5618a69593f92f1088.view: 4 extents found\r\ncouchdb/.shards/40000000-5fffffff/foo2.1576202327_design/mrview/efaeb757cdb9120e0d2d312a237f955c.view: 4 extents found\r\ncouchdb/.shards/40000000-5fffffff/foo2.1576202327_design/mrview/1f3dc3019c5156f2aa66ab47248add61.view: 4 extents found\r\ncouchdb/.shards/20000000-3fffffff/foo2.1576202327_design/mrview/9e6552c45632f3e05a6ae72915e96b9b.view: 4 extents found\r\ncouchdb/.shards/20000000-3fffffff/foo2.1576202327_design/mrview/1f3dc3019c5156f2aa66ab47248add61.view: 4 extents found\r\ncouchdb/shards/60000000-7fffffff/_global_changes.1576197947.couch: 3 extents found\r\ncouchdb/.shards/00000000-1fffffff/foo2.1576202327_design/mrview/77698c399d7c398c3fa2221d547b559a.view: 3 extents found\r\ncouchdb/_dbs.couch: 3 extents found\r\ncouchdb/.shards/c0000000-dfffffff/foo2.1576202327_design/mrview/77698c399d7c398c3fa2221d547b559a.view: 2 extents found\r\ncouchdb/.shards/a0000000-bfffffff/foo2.1576202327_design/mrview/77698c399d7c398c3fa2221d547b559a.view: 2 extents found\r\ncouchdb/shards/80000000-9fffffff/_global_changes.1576197947.couch: 2 extents found\r\ncouchdb/shards/20000000-3fffffff/_global_changes.1576197947.couch: 2 extents found\r\ncouchdb/shards/00000000-1fffffff/_users.1576197947.couch: 2 extents found\r\ncouchdb/.shards/00000000-1fffffff/foo2.1576202327_design/mrview/37b94f6b5836a143c9db7b8a9caf45b9.view: 2 extents found\r\ncouchdb/._users_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/_users.couch: 1 extent found\r\ncouchdb/.shards/e0000000-ffffffff/_users.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/shards/e0000000-ffffffff/_users.1576197947.couch: 1 extent found\r\ncouchdb/.shards/e0000000-ffffffff/_replicator.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/shards/e0000000-ffffffff/_replicator.1576197947.couch: 1 extent found\r\ncouchdb/.shards/e0000000-ffffffff/demo.1576774963_design/mrview/c12a4679354f40965b2fac59260bad86.view: 1 extent found\r\ncouchdb/.shards/c0000000-dfffffff/_users.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/shards/c0000000-dfffffff/_users.1576197947.couch: 1 extent found\r\ncouchdb/.shards/c0000000-dfffffff/foo2.1576202327_design/mrview/903132c98329dd5618a69593f92f1088.view: 1 extent found\r\ncouchdb/.shards/c0000000-dfffffff/_replicator.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/shards/c0000000-dfffffff/_replicator.1576197947.couch: 1 extent found\r\ncouchdb/.shards/c0000000-dfffffff/demo.1576774963_design/mrview/c12a4679354f40965b2fac59260bad86.view: 1 extent found\r\ncouchdb/.shards/a0000000-bfffffff/_users.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/shards/a0000000-bfffffff/_users.1576197947.couch: 1 extent found\r\ncouchdb/.shards/a0000000-bfffffff/_replicator.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/shards/a0000000-bfffffff/_replicator.1576197947.couch: 1 extent found\r\ncouchdb/shards/a0000000-bfffffff/_global_changes.1576197947.couch: 1 extent found\r\ncouchdb/.shards/a0000000-bfffffff/demo.1576774963_design/mrview/c12a4679354f40965b2fac59260bad86.view: 1 extent found\r\ncouchdb/.shards/80000000-9fffffff/_users.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/shards/80000000-9fffffff/_users.1576197947.couch: 1 extent found\r\ncouchdb/.shards/80000000-9fffffff/_replicator.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/shards/80000000-9fffffff/_replicator.1576197947.couch: 1 extent found\r\ncouchdb/.shards/80000000-9fffffff/demo.1576774963_design/mrview/c12a4679354f40965b2fac59260bad86.view: 1 extent found\r\ncouchdb/.shards/60000000-7fffffff/_users.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/shards/60000000-7fffffff/_users.1576197947.couch: 1 extent found\r\ncouchdb/.shards/60000000-7fffffff/_replicator.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/shards/60000000-7fffffff/_replicator.1576197947.couch: 1 extent found\r\ncouchdb/.shards/60000000-7fffffff/demo.1576774963_design/mrview/c12a4679354f40965b2fac59260bad86.view: 1 extent found\r\ncouchdb/.shards/40000000-5fffffff/_users.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/shards/40000000-5fffffff/_users.1576197947.couch: 1 extent found\r\ncouchdb/.shards/40000000-5fffffff/_replicator.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/shards/40000000-5fffffff/_replicator.1576197947.couch: 1 extent found\r\ncouchdb/shards/40000000-5fffffff/_global_changes.1576197947.couch: 1 extent found\r\ncouchdb/.shards/40000000-5fffffff/demo.1576774963_design/mrview/c12a4679354f40965b2fac59260bad86.view: 1 extent found\r\ncouchdb/.shards/20000000-3fffffff/_users.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/shards/20000000-3fffffff/_users.1576197947.couch: 1 extent found\r\ncouchdb/.shards/20000000-3fffffff/_replicator.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/shards/20000000-3fffffff/_replicator.1576197947.couch: 1 extent found\r\ncouchdb/.shards/20000000-3fffffff/demo.1576774963_design/mrview/c12a4679354f40965b2fac59260bad86.view: 1 extent found\r\ncouchdb/.shards/00000000-1fffffff/_users.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/.shards/00000000-1fffffff/_replicator.1576197947_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/shards/00000000-1fffffff/_replicator.1576197947.couch: 1 extent found\r\ncouchdb/shards/00000000-1fffffff/_global_changes.1576197947.couch: 1 extent found\r\ncouchdb/.shards/00000000-1fffffff/demo.1576774963_design/mrview/c12a4679354f40965b2fac59260bad86.view: 1 extent found\r\ncouchdb/._replicator_design/mrview/3e823c2a4383ac0c18d4e574135a5b08.view: 1 extent found\r\ncouchdb/_replicator.couch: 1 extent found\r\ncouchdb/_nodes.couch: 1 extent found\r\n\r\n```\r\n\r\nHow should we interpret those results? \r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590334/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/748660621","html_url":"https://github.com/apache/couchdb/pull/3303#issuecomment-748660621","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3303","id":748660621,"node_id":"MDEyOklzc3VlQ29tbWVudDc0ODY2MDYyMQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-20T19:57:54Z","updated_at":"2020-12-20T19:57:54Z","author_association":"MEMBER","body":"Would love to see this on 3.x @rnewson ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/748660621/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/748671791","html_url":"https://github.com/apache/couchdb/pull/3189#issuecomment-748671791","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3189","id":748671791,"node_id":"MDEyOklzc3VlQ29tbWVudDc0ODY3MTc5MQ==","user":{"login":"dottorblaster","id":20770,"node_id":"MDQ6VXNlcjIwNzcw","avatar_url":"https://avatars.githubusercontent.com/u/20770?v=4","gravatar_id":"","url":"https://api.github.com/users/dottorblaster","html_url":"https://github.com/dottorblaster","followers_url":"https://api.github.com/users/dottorblaster/followers","following_url":"https://api.github.com/users/dottorblaster/following{/other_user}","gists_url":"https://api.github.com/users/dottorblaster/gists{/gist_id}","starred_url":"https://api.github.com/users/dottorblaster/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dottorblaster/subscriptions","organizations_url":"https://api.github.com/users/dottorblaster/orgs","repos_url":"https://api.github.com/users/dottorblaster/repos","events_url":"https://api.github.com/users/dottorblaster/events{/privacy}","received_events_url":"https://api.github.com/users/dottorblaster/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-20T21:14:49Z","updated_at":"2020-12-20T21:16:15Z","author_association":"MEMBER","body":"Hm. I'll think about that, honestly I was struggling with this because the `--only` flag has some quirks, I'll analyze this again and report.\r\n\r\n> Ideally the ability to skip tests via blacklist should be supported by testing framework\r\n\r\nMix is not the right place for this discussion to happen, maybe you'll want to speak to the folks maintaining ExUnit :-D nonetheless I think they are pretty much the same team, you're right.\r\n\r\nAnyway your fix makes CouchDB have a much wider coverage because you include test modules in a very specific way, while `--only` as far as I can remember cannot be combined with exclusions or something like that. To be honest that was the reason I dropped things on this PR, I plan to take on this again as your work was very inspiring for a new solution. Still, I don't think we will be allowed to leverage ExUnit mechanics to do this. I have to dig into it.\r\n\r\nAlso I don't know about that, but merry XMas! :D\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/748671791/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/749650492","html_url":"https://github.com/apache/couchdb/issues/3309#issuecomment-749650492","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3309","id":749650492,"node_id":"MDEyOklzc3VlQ29tbWVudDc0OTY1MDQ5Mg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-22T16:47:42Z","updated_at":"2020-12-22T16:47:42Z","author_association":"MEMBER","body":"HI there,\r\n\r\nhttps://github.com/apache/couchdb/pull/2710 was merged into 3.x a while ago. It should place `%COUCHDB_BIN_DIR%` ahead of `%SystemRoot%\\system32` in the path.\r\n\r\nCan you confirm that your `couchdb.cmd` file has this change in place?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/749650492/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/751035163","html_url":"https://github.com/apache/couchdb/issues/2554#issuecomment-751035163","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2554","id":751035163,"node_id":"MDEyOklzc3VlQ29tbWVudDc1MTAzNTE2Mw==","user":{"login":"Sid-Turner-Ellis","id":61651211,"node_id":"MDQ6VXNlcjYxNjUxMjEx","avatar_url":"https://avatars.githubusercontent.com/u/61651211?v=4","gravatar_id":"","url":"https://api.github.com/users/Sid-Turner-Ellis","html_url":"https://github.com/Sid-Turner-Ellis","followers_url":"https://api.github.com/users/Sid-Turner-Ellis/followers","following_url":"https://api.github.com/users/Sid-Turner-Ellis/following{/other_user}","gists_url":"https://api.github.com/users/Sid-Turner-Ellis/gists{/gist_id}","starred_url":"https://api.github.com/users/Sid-Turner-Ellis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sid-Turner-Ellis/subscriptions","organizations_url":"https://api.github.com/users/Sid-Turner-Ellis/orgs","repos_url":"https://api.github.com/users/Sid-Turner-Ellis/repos","events_url":"https://api.github.com/users/Sid-Turner-Ellis/events{/privacy}","received_events_url":"https://api.github.com/users/Sid-Turner-Ellis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-24T21:03:31Z","updated_at":"2020-12-24T21:03:31Z","author_association":"NONE","body":"I am also getting this error, It will not allow me to install and tells me the setup wizard ended prematurely. Was there any solution to this?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/751035163/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/751156011","html_url":"https://github.com/apache/couchdb/issues/2554#issuecomment-751156011","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2554","id":751156011,"node_id":"MDEyOklzc3VlQ29tbWVudDc1MTE1NjAxMQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-25T03:01:07Z","updated_at":"2020-12-25T03:01:07Z","author_association":"MEMBER","body":"@Sid-Turner-Ellis Install the .NET Framework 3.5 first. Does that work?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/751156011/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/751241337","html_url":"https://github.com/apache/couchdb/issues/2554#issuecomment-751241337","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2554","id":751241337,"node_id":"MDEyOklzc3VlQ29tbWVudDc1MTI0MTMzNw==","user":{"login":"Sid-Turner-Ellis","id":61651211,"node_id":"MDQ6VXNlcjYxNjUxMjEx","avatar_url":"https://avatars.githubusercontent.com/u/61651211?v=4","gravatar_id":"","url":"https://api.github.com/users/Sid-Turner-Ellis","html_url":"https://github.com/Sid-Turner-Ellis","followers_url":"https://api.github.com/users/Sid-Turner-Ellis/followers","following_url":"https://api.github.com/users/Sid-Turner-Ellis/following{/other_user}","gists_url":"https://api.github.com/users/Sid-Turner-Ellis/gists{/gist_id}","starred_url":"https://api.github.com/users/Sid-Turner-Ellis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sid-Turner-Ellis/subscriptions","organizations_url":"https://api.github.com/users/Sid-Turner-Ellis/orgs","repos_url":"https://api.github.com/users/Sid-Turner-Ellis/repos","events_url":"https://api.github.com/users/Sid-Turner-Ellis/events{/privacy}","received_events_url":"https://api.github.com/users/Sid-Turner-Ellis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-25T12:15:54Z","updated_at":"2020-12-25T12:15:54Z","author_association":"NONE","body":"@wohali Which should i download? There is 3.1 and 5.0 and then run times vs the sdk","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/751241337/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/751243989","html_url":"https://github.com/apache/couchdb/issues/2554#issuecomment-751243989","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2554","id":751243989,"node_id":"MDEyOklzc3VlQ29tbWVudDc1MTI0Mzk4OQ==","user":{"login":"Sid-Turner-Ellis","id":61651211,"node_id":"MDQ6VXNlcjYxNjUxMjEx","avatar_url":"https://avatars.githubusercontent.com/u/61651211?v=4","gravatar_id":"","url":"https://api.github.com/users/Sid-Turner-Ellis","html_url":"https://github.com/Sid-Turner-Ellis","followers_url":"https://api.github.com/users/Sid-Turner-Ellis/followers","following_url":"https://api.github.com/users/Sid-Turner-Ellis/following{/other_user}","gists_url":"https://api.github.com/users/Sid-Turner-Ellis/gists{/gist_id}","starred_url":"https://api.github.com/users/Sid-Turner-Ellis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sid-Turner-Ellis/subscriptions","organizations_url":"https://api.github.com/users/Sid-Turner-Ellis/orgs","repos_url":"https://api.github.com/users/Sid-Turner-Ellis/repos","events_url":"https://api.github.com/users/Sid-Turner-Ellis/events{/privacy}","received_events_url":"https://api.github.com/users/Sid-Turner-Ellis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-25T12:40:21Z","updated_at":"2020-12-25T12:40:21Z","author_association":"NONE","body":"@wohali That worked a treat. Thanks a lot ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/751243989/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590336","html_url":"https://github.com/apache/couchdb/issues/4227#issuecomment-1280590336","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4227","id":1280590336,"node_id":"MDEyOklzc3VlQ29tbWVudDEyODA1OTAzMzY=","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-26T13:10:09Z","updated_at":"2020-12-26T13:10:09Z","author_association":"MEMBER","body":"Hm, that's more extents, but it doesn't look terrible. And 3.x will be doing more aggressive compaction than 2.x, so we're also seeing version vs. version bias here (and 2.x is end-of-life).\r\n\r\nI'm reading that just [adding `-o autodefrag` to the data mount](https://askubuntu.com/questions/84213/btrfs-defragmentation-of-files-folders) may be a better choice here. \"`autodefrag` does help, performance impact is minor at best on everyday systems.\" But this data is also 7 years old, so I don't know how things have progressed since then. A recent [reddit post agrees](https://old.reddit.com/r/btrfs/comments/fch1v0/is_fragmentation_on_ssd_an_issue/).\r\n\r\nOr it might be acceptable to simply run [`btrfs filesystem defragment ...`](https://btrfs.wiki.kernel.org/index.php/Manpage/btrfs-filesystem) \r\n\r\nThis is definitely a finer point of tuning, and while I can see that this would be useful info for CouchDB users, it's not something I'd call out as critical in the installation section. Maybe this would be better to put in the [best practices](https://github.com/apache/couchdb-documentation/tree/main/src/best-practices) under the \"if it ain't broke, don't fix it\" approach? I'll definitely merge a PR if it shows up, I'm just not sure we have enough data here to define this as a best practice.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590336/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590342","html_url":"https://github.com/apache/couchdb/issues/4227#issuecomment-1280590342","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4227","id":1280590342,"node_id":"MDEyOklzc3VlQ29tbWVudDEyODA1OTAzNDI=","user":{"login":"ceremcem","id":6639874,"node_id":"MDQ6VXNlcjY2Mzk4NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/6639874?v=4","gravatar_id":"","url":"https://api.github.com/users/ceremcem","html_url":"https://github.com/ceremcem","followers_url":"https://api.github.com/users/ceremcem/followers","following_url":"https://api.github.com/users/ceremcem/following{/other_user}","gists_url":"https://api.github.com/users/ceremcem/gists{/gist_id}","starred_url":"https://api.github.com/users/ceremcem/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ceremcem/subscriptions","organizations_url":"https://api.github.com/users/ceremcem/orgs","repos_url":"https://api.github.com/users/ceremcem/repos","events_url":"https://api.github.com/users/ceremcem/events{/privacy}","received_events_url":"https://api.github.com/users/ceremcem/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-26T18:20:15Z","updated_at":"2020-12-26T18:21:24Z","author_association":"CONTRIBUTOR","body":"I'm having an interesting trouble here, as the script I provided in my first post worked just well on my laptop (CouchDB-3.x on Debian-Buster on LXC on my-laptop which uses BTRFS), however, CouchDB-2.x refuses to build views on my production server when I applied those changes. I'm on it and I'll provide the tested directions ASAP. \r\n\r\n`btrfs fs defrag` has a disadvantage of causing data bloat, so I avoid using it. See [this](https://unix.stackexchange.com/a/402339/65781). \r\n\r\n> it's not something I'd call out as critical in the installation section. \r\n\r\nWell, it's hard for me to clearly state anything, but I've a feeling that this is a critical matter. I experienced a disk failure where my server got unresponsive (naturally). When I tried to recover any data I could, I realized that the corrupted files were especially belonged to CouchDB (this might be a coincidence, I'm aware). See [this](https://unix.stackexchange.com/q/557213/65781) and [this](https://lore.kernel.org/linux-btrfs/CAN4oSBeUY=dVq5MAZ6bdDs1d5p3BVacEdffzsvCS+80O1iO7jg@mail.gmail.com/): \r\n\r\n> I was wondering\r\n> if insisting CouchDB on BTRFS would eventually cause a failure or not,\r\n> so this corrupted files list might help shedding the light on the\r\n> cause: https://gist.github.com/ceremcem/b507be2669682857f37039eb9655d7ad\r\n\r\nI'll be get in touch as soon as I solve the puzzle. \r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590342/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590347","html_url":"https://github.com/apache/couchdb/issues/4227#issuecomment-1280590347","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4227","id":1280590347,"node_id":"MDEyOklzc3VlQ29tbWVudDEyODA1OTAzNDc=","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-27T07:42:20Z","updated_at":"2020-12-27T07:42:20Z","author_association":"MEMBER","body":"Looking forward to it, let us know. I'm going to be away for a few days, so I can get back to this in January.\r\n\r\nYour post on linux-btrfs and your gist suggest your root cause is disk failure to me. CouchDB insists on fsync() after every write (unconditionally in 3.x, and in 2.x by default unless you disable a poorly documented setting).\r\n\r\nHappy Holidays!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590347/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/753567562","html_url":"https://github.com/apache/couchdb/issues/3319#issuecomment-753567562","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3319","id":753567562,"node_id":"MDEyOklzc3VlQ29tbWVudDc1MzU2NzU2Mg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-03T04:49:04Z","updated_at":"2021-01-03T04:49:04Z","author_association":"MEMBER","body":"This is related to https://github.com/apache/couchdb/issues/2188 - both of them have issues with equals signs in keys or values in  the ini file. Fix one and you should fix the other.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/753567562/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/753604178","html_url":"https://github.com/apache/couchdb/pull/3301#issuecomment-753604178","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3301","id":753604178,"node_id":"MDEyOklzc3VlQ29tbWVudDc1MzYwNDE3OA==","user":{"login":"dottorblaster","id":20770,"node_id":"MDQ6VXNlcjIwNzcw","avatar_url":"https://avatars.githubusercontent.com/u/20770?v=4","gravatar_id":"","url":"https://api.github.com/users/dottorblaster","html_url":"https://github.com/dottorblaster","followers_url":"https://api.github.com/users/dottorblaster/followers","following_url":"https://api.github.com/users/dottorblaster/following{/other_user}","gists_url":"https://api.github.com/users/dottorblaster/gists{/gist_id}","starred_url":"https://api.github.com/users/dottorblaster/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dottorblaster/subscriptions","organizations_url":"https://api.github.com/users/dottorblaster/orgs","repos_url":"https://api.github.com/users/dottorblaster/repos","events_url":"https://api.github.com/users/dottorblaster/events{/privacy}","received_events_url":"https://api.github.com/users/dottorblaster/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-03T11:39:33Z","updated_at":"2021-01-03T11:39:33Z","author_association":"MEMBER","body":"@jjrodrig absolutely, I upgraded to the latest version available. Once the tests are green I'll merge and cherry-pick this to `3.x`. Thanks a lot!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/753604178/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/754224498","html_url":"https://github.com/apache/couchdb/issues/2203#issuecomment-754224498","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2203","id":754224498,"node_id":"MDEyOklzc3VlQ29tbWVudDc1NDIyNDQ5OA==","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-04T21:17:34Z","updated_at":"2021-01-04T21:17:34Z","author_association":"MEMBER","body":"@flimzy I happened upon the CBOR spec for an entirely different reason last week and sat down to read it through. I think there's a lot to like. It handles everything I could think of from my experience working with CouchDB. I like that the authors paid special attention to round-tripping through JSON, and while it's a larger topic I particularly like the approach to extensibility that allows CBOR to handle things like timestamps and arbitrary-precision decimals. I could see a future where CouchDB allowed any JSON, but also supported a particular spec based on CBOR that would enable us to introduce a richer set of datatypes in the database.\r\n\r\n@fangq as it turns out, when @rkalla was first working on UBJSON he had several discussions with @davisp and @kxepal from the CouchDB community and floated the idea of having CouchDB adopt UBJSON, first as an encoding on the wire but possibly also as an on-disk representation if the wire format took off. That was almost ten years ago, but I can imagine that a UBJSON encoding would be achievable given that history.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/754224498/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/754409811","html_url":"https://github.com/apache/couchdb/pull/1950#issuecomment-754409811","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1950","id":754409811,"node_id":"MDEyOklzc3VlQ29tbWVudDc1NDQwOTgxMQ==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-05T05:39:16Z","updated_at":"2021-01-05T05:39:16Z","author_association":"CONTRIBUTOR","body":"I took another look at this, but noticed [this commit](https://github.com/apache/couchdb/commit/8a062686fac0a29af2d6f3c7da81ff3ff1e484fb) from Jan already addressed the issue of stack traces in the logs, and the repeating error does actually seem like a good -- albeit somewhat spammy -- feature. So I think we should just close this in favor of his more elegant fix.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/754409811/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/754988080","html_url":"https://github.com/apache/couchdb/issues/3308#issuecomment-754988080","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3308","id":754988080,"node_id":"MDEyOklzc3VlQ29tbWVudDc1NDk4ODA4MA==","user":{"login":"anuragvohraec","id":53807480,"node_id":"MDQ6VXNlcjUzODA3NDgw","avatar_url":"https://avatars.githubusercontent.com/u/53807480?v=4","gravatar_id":"","url":"https://api.github.com/users/anuragvohraec","html_url":"https://github.com/anuragvohraec","followers_url":"https://api.github.com/users/anuragvohraec/followers","following_url":"https://api.github.com/users/anuragvohraec/following{/other_user}","gists_url":"https://api.github.com/users/anuragvohraec/gists{/gist_id}","starred_url":"https://api.github.com/users/anuragvohraec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anuragvohraec/subscriptions","organizations_url":"https://api.github.com/users/anuragvohraec/orgs","repos_url":"https://api.github.com/users/anuragvohraec/repos","events_url":"https://api.github.com/users/anuragvohraec/events{/privacy}","received_events_url":"https://api.github.com/users/anuragvohraec/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-06T00:33:22Z","updated_at":"2021-01-06T00:35:50Z","author_association":"NONE","body":"If this is implemented, I will suggest `dbseq=true` to be a query param instead of request header, as its used as a query in here.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/754988080/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/755382755","html_url":"https://github.com/apache/couchdb/issues/2225#issuecomment-755382755","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2225","id":755382755,"node_id":"MDEyOklzc3VlQ29tbWVudDc1NTM4Mjc1NQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-06T15:54:20Z","updated_at":"2021-01-06T15:54:20Z","author_association":"MEMBER","body":"https://github.com/apache/couchdb/pull/3243 should cover this?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/755382755/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/755423622","html_url":"https://github.com/apache/couchdb/issues/2225#issuecomment-755423622","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2225","id":755423622,"node_id":"MDEyOklzc3VlQ29tbWVudDc1NTQyMzYyMg==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-06T16:53:47Z","updated_at":"2021-01-06T16:54:24Z","author_association":"MEMBER","body":"Confirmed that the `cache_grv` work achieves this. I print the GRV within the fold_docs transaction and the get_body_wait transactions and they are all the same.\r\n\r\n```diff\r\ndiff --git a/src/fabric/src/fabric2_db.erl b/src/fabric/src/fabric2_db.erl\r\nindex a310470ea..352b30946 100644\r\n--- a/src/fabric/src/fabric2_db.erl\r\n+++ b/src/fabric/src/fabric2_db.erl\r\n@@ -946,9 +946,12 @@ fold_docs(Db, UserFun, UserAcc0, Options) ->\r\n     fabric2_fdb:transactional(Db, fun(TxDb) ->\r\n         try\r\n             #{\r\n+              tx := Tx,\r\n                 db_prefix := DbPrefix\r\n             } = TxDb,\r\n\r\n+            couch_log:error(\"fold_docs ~p\", [erlfdb:wait(erlfdb:get_read_version(Tx))]),\r\n\r\n             Prefix = erlfdb_tuple:pack({?DB_ALL_DOCS}, DbPrefix),\r\n             Meta = get_all_docs_meta(TxDb, Options),\r\n\r\ndiff --git a/src/fabric/src/fabric2_fdb.erl b/src/fabric/src/fabric2_fdb.erl\r\nindex 5394f27bb..8b2a19535 100644\r\n--- a/src/fabric/src/fabric2_fdb.erl\r\n+++ b/src/fabric/src/fabric2_fdb.erl\r\n@@ -772,7 +772,7 @@ get_doc_body_wait(#{} = Db0, DocId, RevInfo, Future) ->\r\n     #{\r\n         tx := Tx\r\n     } = Db = ensure_current(Db0),\r\n\r\n+    couch_log:error(\"get_doc_body ~p\", [erlfdb:wait(erlfdb:get_read_version(Tx))]),\r\n     #{\r\n         rev_id := {RevPos, Rev},\r\n         rev_path := RevPath\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/755423622/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/755426460","html_url":"https://github.com/apache/couchdb/issues/2225#issuecomment-755426460","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2225","id":755426460,"node_id":"MDEyOklzc3VlQ29tbWVudDc1NTQyNjQ2MA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-06T16:58:21Z","updated_at":"2021-01-06T16:58:21Z","author_association":"CONTRIBUTOR","body":"#3243 would cover it, but I thought we already fixed this for most general cases like _all_docs variants and view rows emits. I see for _all_docs, _design_docs and _local_docs we use `TxDb` https://github.com/apache/couchdb/blob/main/src/fabric/src/fabric2_db.erl#L971, and for views https://github.com/apache/couchdb/blob/main/src/couch_views/src/couch_views_reader.erl#L199\r\n\r\nThe code in chttpd might still catch some edge cases though from other requests which use the `view_cb` callback","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/755426460/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/756213553","html_url":"https://github.com/apache/couchdb/pull/3243#issuecomment-756213553","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3243","id":756213553,"node_id":"MDEyOklzc3VlQ29tbWVudDc1NjIxMzU1Mw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-07T16:11:27Z","updated_at":"2021-01-07T16:11:27Z","author_association":"CONTRIBUTOR","body":"Was trying to think what would happen if a read-only transaction re-uses the GRV then throws a `transaction_too_old` error and is retried.  On retry it will fail again with the same error, but then, when it retries again it will grab a new GRV and succeed (because we run `apply_then_clear_grv_cache/0`). That's probably fine, even though it's a bit subtle.  The other alternative here would be to catch the error and clear GRV on any error, then to re-raise, stacktrace and all, but that's more code and maybe not worth it.\r\n\r\nWe should add some fabric tests since we modify the transactional semantics and fabric tests is where we test that mostly. We have chttpd and elixir test which would exercise this code path, but none of those tests would explicitly check transactional semantics (unless we can see some tests which do that well and we can add a few extra lines checking the GRV re-use).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/756213553/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/756217911","html_url":"https://github.com/apache/couchdb/pull/3243#issuecomment-756217911","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3243","id":756217911,"node_id":"MDEyOklzc3VlQ29tbWVudDc1NjIxNzkxMQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-07T16:18:24Z","updated_at":"2021-01-07T16:18:24Z","author_association":"MEMBER","body":"@nickva under what circumstances do we retry? This is important in the context of the open vote on dev@ mailing list about couchdb 4.0's transactional semantics. As long as a retry means the response, assuming the retry succeeds, is calculated over a single snapshot (albeit not the first snapshot taken) that's fine, but if the response could contain data retrieved from the first txn and the txn of the retry, that's something we need to prevent (assuming the vote passes ofc)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/756217911/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/756231890","html_url":"https://github.com/apache/couchdb/pull/3243#issuecomment-756231890","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3243","id":756231890,"node_id":"MDEyOklzc3VlQ29tbWVudDc1NjIzMTg5MA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-07T16:41:48Z","updated_at":"2021-01-07T16:41:48Z","author_association":"CONTRIBUTOR","body":"> @nickva under what circumstances do we retry? \r\n\r\nFor transaction_too_old as by default it's a retry-able error. The typical reason it could be thrown is that the transaction took too long to run, but that's not the only reason. Sometimes the backend processes will fast-forward time during recovery (it's virtual time so to speak) but the effect is that transaction_too_old is thrown with the expectation that the client will retry.\r\n\r\nSee https://github.com/apple/foundationdb/blob/8d9e7adac7b8b46919e5c75e4d8b17457b8c41f6/documentation/sphinx/source/architecture.rst#transaction-system-recovery\r\n\r\nAnd that's just `transaction_too_old` there are other retry-able errors in the list https://apple.github.io/foundationdb/api-error-codes.html that I am not sure if they will handle the same GRV being set and still make progress. Maybe 1009 is like that but not 100% sure on that one.\r\n\r\n>  if the response could contain data retrieved from the first txn and the txn of the retry, that's something we need to prevent (assuming the vote passes ofc)\r\n\r\nThat would be depend if we started streaming the data or not yet, but I think that's a concern a higher level up in the stack\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/756231890/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/757687768","html_url":"https://github.com/apache/couchdb/issues/3309#issuecomment-757687768","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3309","id":757687768,"node_id":"MDEyOklzc3VlQ29tbWVudDc1NzY4Nzc2OA==","user":{"login":"magel20","id":69040597,"node_id":"MDQ6VXNlcjY5MDQwNTk3","avatar_url":"https://avatars.githubusercontent.com/u/69040597?v=4","gravatar_id":"","url":"https://api.github.com/users/magel20","html_url":"https://github.com/magel20","followers_url":"https://api.github.com/users/magel20/followers","following_url":"https://api.github.com/users/magel20/following{/other_user}","gists_url":"https://api.github.com/users/magel20/gists{/gist_id}","starred_url":"https://api.github.com/users/magel20/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/magel20/subscriptions","organizations_url":"https://api.github.com/users/magel20/orgs","repos_url":"https://api.github.com/users/magel20/repos","events_url":"https://api.github.com/users/magel20/events{/privacy}","received_events_url":"https://api.github.com/users/magel20/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-11T08:02:24Z","updated_at":"2021-01-11T08:02:24Z","author_association":"NONE","body":"Hey,\r\n\r\nyes I can confirm that the 'couchdb.cmd' has the changes from https://github.com/apache/couchdb/pull/2710\r\n\r\nI also tried it with CouchDB 3.1.1 as well but the problem still occurs.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/757687768/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/758095090","html_url":"https://github.com/apache/couchdb/issues/3309#issuecomment-758095090","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3309","id":758095090,"node_id":"MDEyOklzc3VlQ29tbWVudDc1ODA5NTA5MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-11T17:13:21Z","updated_at":"2021-01-11T17:13:21Z","author_association":"MEMBER","body":"@magel20 Unfortunately, I can't confirm this in our development environment.\r\n\r\nThat `PATH` environment variable change explicitly puts the CouchDB binary directory ahead of the `C:\\Windows\\System32` directory. The Windows dynamic linker searches PATH in order to find the necessary DLLs it needs. It can't run with only `%COUCHDB_BIN_DIR%, it needs the system's DLLs as well to run.\r\n\r\nWhat happens if you open an Administrator Command Prompt and run the `couchdb.cmd` rather than using the automatic Windows Service? Does the problem still occur?\r\n\r\nDo you know which program placed those DLLs in your `%SYSTEMROOT%` directory? Arguably, *that's* the bug here, because with those DLLs in there, if the `%PATH%` tweak doesn't prevent those from being accessed, there's little we can do here to fix it. Can you move those DLLs to the directory of the program that actually needs them?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/758095090/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/758817361","html_url":"https://github.com/apache/couchdb/pull/3322#issuecomment-758817361","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3322","id":758817361,"node_id":"MDEyOklzc3VlQ29tbWVudDc1ODgxNzM2MQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-12T17:30:10Z","updated_at":"2021-01-12T17:30:10Z","author_association":"MEMBER","body":"Thank you for the review, @rnewson ! Can you please merge this for me? I'll open a PR to port this to `main` next.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/758817361/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/758841603","html_url":"https://github.com/apache/couchdb/pull/3323#issuecomment-758841603","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3323","id":758841603,"node_id":"MDEyOklzc3VlQ29tbWVudDc1ODg0MTYwMw==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-12T18:11:12Z","updated_at":"2021-01-12T18:11:12Z","author_association":"MEMBER","body":"Thank you for the review, @rnewson ! Can you please merge this also for me?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/758841603/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/758918213","html_url":"https://github.com/apache/couchdb/pull/3243#issuecomment-758918213","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3243","id":758918213,"node_id":"MDEyOklzc3VlQ29tbWVudDc1ODkxODIxMw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-12T20:20:49Z","updated_at":"2021-01-12T20:20:49Z","author_association":"CONTRIBUTOR","body":"I could reproduce the failing tests on this branch but not on main. On main I ran with commit \r\n bc9773a2f6199cc095aae8ae977eb8df75204dab\r\n\r\n```\r\nmake eunit apps=chttpd suites=chttpd_view_test\r\n```\r\n\r\nWhile on `cache_grv` branch (commit 5b2c353b7be7cccabd27f5558924555a77536a43) it fails with \r\n\r\n```\r\nin function chttpd_view_test:'-should_succeed_on_view_with_queries_keys/1-fun-2-'/1 (test/eunit/chttpd_view_test.erl, line 81)\r\n**error:{badmatch,\r\n    {error,\r\n        {'EXIT',\r\n            {{function_clause,\r\n                 [{ibrowse_http_client,to_ascii,\"K\",\r\n                      [{file,\"src/ibrowse_http_client.erl\"},{line,1834}]},\r\n                  {ibrowse_http_client,hexlist_to_integer,3,\r\n                      [{file,\"src/ibrowse_http_client.erl\"},{line,1830}]},\r\n                  {ibrowse_http_client,parse_11_response,2,\r\n                      [{file,[...]},{line,...}]},\r\n                  {ibrowse_http_client,handle_sock_data,2,[{file,...},{...}]},\r\n                  {gen_server,try_dispatch,4,[{...}|...]},\r\n                  {gen_server,handle_msg,6,[...]},\r\n                  {proc_lib,init_p_do_apply,3,...}]},\r\n             {gen_server,call,\r\n                 [<0.776.0>,\r\n                  {send_req,\r\n                      {{url,\r\n                           \"http://127.0.0.1:57467/eunit-test-db-7b060bf5620fc5144cdc763537ff0b54/_design/bar/_view/baz/queries/\",\r\n                           [...],...},\r\n                       [{[...],...},{...}],\r\n                       post,<<...>>,...}},\r\n                  30000]}}}}}\r\n  output:<<\"\">>\r\n```\r\n\r\nThose are performing multiple queries with keys per request, perhaps it interacts with the transaction re-use somehow...","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/758918213/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/759951440","html_url":"https://github.com/apache/couchdb/pull/3312#issuecomment-759951440","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3312","id":759951440,"node_id":"MDEyOklzc3VlQ29tbWVudDc1OTk1MTQ0MA==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-14T06:14:20Z","updated_at":"2021-01-14T06:14:20Z","author_association":"CONTRIBUTOR","body":"For a [first pass at documentation](https://github.com/apache/couchdb-documentation/pull/615), I ported the README.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/759951440/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/760085194","html_url":"https://github.com/apache/couchdb/issues/3309#issuecomment-760085194","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3309","id":760085194,"node_id":"MDEyOklzc3VlQ29tbWVudDc2MDA4NTE5NA==","user":{"login":"magel20","id":69040597,"node_id":"MDQ6VXNlcjY5MDQwNTk3","avatar_url":"https://avatars.githubusercontent.com/u/69040597?v=4","gravatar_id":"","url":"https://api.github.com/users/magel20","html_url":"https://github.com/magel20","followers_url":"https://api.github.com/users/magel20/followers","following_url":"https://api.github.com/users/magel20/following{/other_user}","gists_url":"https://api.github.com/users/magel20/gists{/gist_id}","starred_url":"https://api.github.com/users/magel20/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/magel20/subscriptions","organizations_url":"https://api.github.com/users/magel20/orgs","repos_url":"https://api.github.com/users/magel20/repos","events_url":"https://api.github.com/users/magel20/events{/privacy}","received_events_url":"https://api.github.com/users/magel20/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-14T09:50:46Z","updated_at":"2021-01-14T09:50:46Z","author_association":"NONE","body":"I tried the `couchdb.cmd` in an Administrator Command Prompt as well as the Windows Service. Problem occurred both times.\r\n\r\nSo the `set PATH=...` command inside the `couchdb.cmd` sets  the CouchDB binary directory ahead of the others. Should I be able to see that change in the `Environment Variables` UI in Windows 10? Because there I do not see the `%COUCHDB_BIN_DIR%` in the PATH at all or is this set done by the script only temporary?\r\n\r\nIf I understand it correctly the problem I encounter should not occur because the `couchdb.cmd` first looks inside the CouchDB binary directory finds the DLLs and should then not care about the DLLs in the `%SYSTEMROOT%` directory? Might there be a possibility that the set command is not working? Or is it more likely that the `%PATH%` tweak does not prevent the DLLs from being accessed if they are placed in the `%SYSTEMROOT%` ?\r\n\r\nUnfortunately I have not found out which program placed the DLLs there. Removing them from `%SYSTEMROOT%` made the CouchDB work and so far no other program I use on a daily basis has complained about it. But if I got you correct it should not be the case that a program places its DLLs in the `%SYSTEMROOT%` directory and that is the actual bug?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/760085194/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/760526610","html_url":"https://github.com/apache/couchdb/issues/2962#issuecomment-760526610","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2962","id":760526610,"node_id":"MDEyOklzc3VlQ29tbWVudDc2MDUyNjYxMA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-14T22:50:53Z","updated_at":"2021-01-14T22:53:59Z","author_association":"CONTRIBUTOR","body":"I was able to reproduce this issue artificially by raising an error the list_cb (list processing callback, called for each row from the view). The the couch_js process stuck in the `getRow` was returned to the process pool.  That would be enough to trigger this bug.\r\n\r\nThe fix is rather simple and it's to only return the process to the pool there were no errors thrown here: \r\nhttps://github.com/apache/couchdb/blob/main/src/couch/src/couch_query_servers.erl#L532-L534\r\n\r\nThanks for @davisp who helped debug the issue and suggested a fix\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/760526610/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/760898800","html_url":"https://github.com/apache/couchdb/pull/3322#issuecomment-760898800","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3322","id":760898800,"node_id":"MDEyOklzc3VlQ29tbWVudDc2MDg5ODgwMA==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-15T11:54:23Z","updated_at":"2021-01-15T11:54:23Z","author_association":"MEMBER","body":"Actually, I'll try merging this myself.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/760898800/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/761111871","html_url":"https://github.com/apache/couchdb/issues/3328#issuecomment-761111871","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3328","id":761111871,"node_id":"MDEyOklzc3VlQ29tbWVudDc2MTExMTg3MQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-15T18:34:55Z","updated_at":"2021-01-15T18:34:55Z","author_association":"CONTRIBUTOR","body":"That looks like a bug. Thank you for your report @nicolas-albert ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/761111871/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/762269089","html_url":"https://github.com/apache/couchdb/pull/3334#issuecomment-762269089","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3334","id":762269089,"node_id":"MDEyOklzc3VlQ29tbWVudDc2MjI2OTA4OQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-18T14:01:05Z","updated_at":"2021-01-18T14:01:05Z","author_association":"MEMBER","body":"That PR is not quite right :)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/762269089/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/762272139","html_url":"https://github.com/apache/couchdb/pull/3334#issuecomment-762272139","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3334","id":762272139,"node_id":"MDEyOklzc3VlQ29tbWVudDc2MjI3MjEzOQ==","user":{"login":"sklassen","id":6997477,"node_id":"MDQ6VXNlcjY5OTc0Nzc=","avatar_url":"https://avatars.githubusercontent.com/u/6997477?v=4","gravatar_id":"","url":"https://api.github.com/users/sklassen","html_url":"https://github.com/sklassen","followers_url":"https://api.github.com/users/sklassen/followers","following_url":"https://api.github.com/users/sklassen/following{/other_user}","gists_url":"https://api.github.com/users/sklassen/gists{/gist_id}","starred_url":"https://api.github.com/users/sklassen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sklassen/subscriptions","organizations_url":"https://api.github.com/users/sklassen/orgs","repos_url":"https://api.github.com/users/sklassen/repos","events_url":"https://api.github.com/users/sklassen/events{/privacy}","received_events_url":"https://api.github.com/users/sklassen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-18T14:06:18Z","updated_at":"2021-01-18T14:06:18Z","author_association":"CONTRIBUTOR","body":"> That PR is not quite right :)\r\n\r\nLet me try again. I thought I had sync'd with 3.x branch.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/762272139/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/764744445","html_url":"https://github.com/apache/couchdb/pull/3337#issuecomment-764744445","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3337","id":764744445,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NDc0NDQ0NQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-21T15:58:41Z","updated_at":"2021-01-21T15:58:41Z","author_association":"MEMBER","body":"It looks like this is the diff that black (the python formatter/linter) is suggesting:\r\n\r\n```diff\r\ndiff --git a/dev/run b/dev/run\r\nindex 476ec3682..7af718afa 100755\r\n--- a/dev/run\r\n+++ b/dev/run\r\n@@ -190,7 +190,7 @@ def get_args_parser():\r\n         \"--erlang-config\",\r\n         dest=\"erlang_config\",\r\n         default=\"rel/files/sys.config\",\r\n-        help=\"Specify an alternative Erlang application configuration\"\r\n+        help=\"Specify an alternative Erlang application configuration\",\r\n     )\r\n     parser.add_option(\r\n         \"--degrade-cluster\",\r\n@@ -275,6 +275,7 @@ def check_beams(ctx):\r\n     for fname in glob.glob(os.path.join(ctx[\"devdir\"], \"*.erl\")):\r\n         sp.check_call([\"erlc\", \"-o\", ctx[\"devdir\"] + os.sep, fname])\r\n \r\n+\r\n @log(\"Ensure Erlang boot script exists\")\r\n def check_boot_script(ctx):\r\n     if not os.path.exists(os.path.join(ctx[\"devdir\"], \"devnode.boot\")):\r\n@@ -282,6 +283,7 @@ def check_boot_script(ctx):\r\n         env[\"ERL_LIBS\"] = os.path.join(ctx[\"rootdir\"], \"src\")\r\n         sp.check_call([\"escript\", \"make_boot_script\"], env=env, cwd=ctx[\"devdir\"])\r\n \r\n+\r\n @log(\"Prepare configuration files\")\r\n def setup_configs(ctx):\r\n     for idx, node in enumerate(ctx[\"nodes\"]):\r\n@@ -631,7 +633,7 @@ def boot_node(ctx, node):\r\n         os.path.join(ctx[\"devdir\"], \"devnode\"),\r\n         \"-pa\",\r\n         ctx[\"devdir\"],\r\n-        \"-s monitor_parent\"\r\n+        \"-s monitor_parent\",\r\n     ]\r\n     if ctx[\"reset_logs\"]:\r\n         mode = \"wb\"\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/764744445/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/764744735","html_url":"https://github.com/apache/couchdb/pull/3337#issuecomment-764744735","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3337","id":764744735,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NDc0NDczNQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-21T15:59:06Z","updated_at":"2021-01-21T15:59:06Z","author_association":"MEMBER","body":"I can push that commit if you like.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/764744735/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/764748069","html_url":"https://github.com/apache/couchdb/pull/3337#issuecomment-764748069","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3337","id":764748069,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NDc0ODA2OQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-21T16:04:04Z","updated_at":"2021-01-21T16:04:04Z","author_association":"MEMBER","body":"@davisp go ahead.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/764748069/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/764767483","html_url":"https://github.com/apache/couchdb/pull/3337#issuecomment-764767483","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3337","id":764767483,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NDc2NzQ4Mw==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-21T16:25:50Z","updated_at":"2021-01-21T16:25:50Z","author_association":"MEMBER","body":"Also done for main as well.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/764767483/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/764791865","html_url":"https://github.com/apache/couchdb/pull/3337#issuecomment-764791865","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3337","id":764791865,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NDc5MTg2NQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-21T16:58:17Z","updated_at":"2021-01-21T16:58:17Z","author_association":"MEMBER","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/764791865/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/765125247","html_url":"https://github.com/apache/couchdb/issues/3339#issuecomment-765125247","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3339","id":765125247,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NTEyNTI0Nw==","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-22T05:01:04Z","updated_at":"2021-01-22T05:01:04Z","author_association":"MEMBER","body":"Enh, I can't repro this on a fully clean checkout. Ignore.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/765125247/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/765581690","html_url":"https://github.com/apache/couchdb/issues/3319#issuecomment-765581690","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3319","id":765581690,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NTU4MTY5MA==","user":{"login":"mtenrero","id":6759022,"node_id":"MDQ6VXNlcjY3NTkwMjI=","avatar_url":"https://avatars.githubusercontent.com/u/6759022?v=4","gravatar_id":"","url":"https://api.github.com/users/mtenrero","html_url":"https://github.com/mtenrero","followers_url":"https://api.github.com/users/mtenrero/followers","following_url":"https://api.github.com/users/mtenrero/following{/other_user}","gists_url":"https://api.github.com/users/mtenrero/gists{/gist_id}","starred_url":"https://api.github.com/users/mtenrero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtenrero/subscriptions","organizations_url":"https://api.github.com/users/mtenrero/orgs","repos_url":"https://api.github.com/users/mtenrero/repos","events_url":"https://api.github.com/users/mtenrero/events{/privacy}","received_events_url":"https://api.github.com/users/mtenrero/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-22T17:49:31Z","updated_at":"2021-01-22T17:49:31Z","author_association":"NONE","body":"I'm not sure if you realized this issue is already fixed in this PR: [https://github.com/apache/couchdb-config/pull/32](https://github.com/apache/couchdb-config/pull/32 )","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/765581690/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/766730707","html_url":"https://github.com/apache/couchdb/pull/3344#issuecomment-766730707","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3344","id":766730707,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NjczMDcwNw==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-25T10:53:15Z","updated_at":"2021-01-25T10:53:15Z","author_association":"CONTRIBUTOR","body":"Thanks! LGTM","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/766730707/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/766771602","html_url":"https://github.com/apache/couchdb/pull/3243#issuecomment-766771602","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3243","id":766771602,"node_id":"MDEyOklzc3VlQ29tbWVudDc2Njc3MTYwMg==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-25T12:07:51Z","updated_at":"2021-01-25T12:07:51Z","author_association":"MEMBER","body":"Agreed with davisp that this approach is untidy. deferring for now.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/766771602/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/767024137","html_url":"https://github.com/apache/couchdb/pull/3346#issuecomment-767024137","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3346","id":767024137,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzAyNDEzNw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-25T18:33:44Z","updated_at":"2021-01-25T18:33:44Z","author_association":"CONTRIBUTOR","body":"Thank you for the contribution, @big-r81\r\n\r\nI'll merge the PR","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/767024137/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/767574082","html_url":"https://github.com/apache/couchdb/pull/3347#issuecomment-767574082","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3347","id":767574082,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzU3NDA4Mg==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T14:23:29Z","updated_at":"2021-01-26T14:23:29Z","author_association":"CONTRIBUTOR","body":"This PR might require a vote on ML.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/767574082/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/767603240","html_url":"https://github.com/apache/couchdb/pull/3347#issuecomment-767603240","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3347","id":767603240,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzYwMzI0MA==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T15:03:05Z","updated_at":"2021-01-26T15:03:05Z","author_association":"MEMBER","body":"Thank you for the review, @iilyak . I've just noticed that this PR is not passing some tests. I'll push a commit soon to fix that.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/767603240/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/768331343","html_url":"https://github.com/apache/couchdb/pull/3332#issuecomment-768331343","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3332","id":768331343,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODMzMTM0Mw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-27T14:41:39Z","updated_at":"2021-01-27T14:41:39Z","author_association":"MEMBER","body":"@garrensmith the 408 status code is for when the client takes too long to send the request body, that doesn't appear to be the reason we get a 1031 from fdb?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/768331343/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/768816084","html_url":"https://github.com/apache/couchdb/pull/3347#issuecomment-768816084","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3347","id":768816084,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODgxNjA4NA==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-28T05:48:06Z","updated_at":"2021-01-28T05:48:06Z","author_association":"MEMBER","body":"Thank you for the review, @iilyak !\r\nI've just opened vote thread: https://lists.apache.org/thread.html/r815b25fe34996ab3c54e2fb9759de2026ddccffc8bb59966b1168063%40%3Cdev.couchdb.apache.org%3E","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/768816084/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/768958531","html_url":"https://github.com/apache/couchdb/issues/3349#issuecomment-768958531","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3349","id":768958531,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODk1ODUzMQ==","user":{"login":"personalnadir","id":559503,"node_id":"MDQ6VXNlcjU1OTUwMw==","avatar_url":"https://avatars.githubusercontent.com/u/559503?v=4","gravatar_id":"","url":"https://api.github.com/users/personalnadir","html_url":"https://github.com/personalnadir","followers_url":"https://api.github.com/users/personalnadir/followers","following_url":"https://api.github.com/users/personalnadir/following{/other_user}","gists_url":"https://api.github.com/users/personalnadir/gists{/gist_id}","starred_url":"https://api.github.com/users/personalnadir/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/personalnadir/subscriptions","organizations_url":"https://api.github.com/users/personalnadir/orgs","repos_url":"https://api.github.com/users/personalnadir/repos","events_url":"https://api.github.com/users/personalnadir/events{/privacy}","received_events_url":"https://api.github.com/users/personalnadir/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-28T10:32:59Z","updated_at":"2021-01-28T10:32:59Z","author_association":"NONE","body":"The pop up box for setting the password also does not submit when pressing return, instead it adds a newline to the password, making the cursor drop out of view. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/768958531/reactions","total_count":2,"+1":1,"-1":0,"laugh":1,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/769837903","html_url":"https://github.com/apache/couchdb/pull/3355#issuecomment-769837903","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3355","id":769837903,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTgzNzkwMw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T14:29:32Z","updated_at":"2021-01-29T14:29:32Z","author_association":"MEMBER","body":"There's an open question on whether we should expose these internal error states at all and I'm undecided myself. My current view is I would rather have this PR in place so that we have \"nice\" error responses but do work elsewhere to eliminate the chance that we actually return one. I'm also completely open to the idea of sending a generic error in the response but recording the FDB details (the output of fdb_error_name/1, say) to couch_log.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/769837903/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/769902427","html_url":"https://github.com/apache/couchdb/issues/3354#issuecomment-769902427","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3354","id":769902427,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTkwMjQyNw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T16:19:04Z","updated_at":"2021-01-29T16:19:04Z","author_association":"CONTRIBUTOR","body":"+1 to have a ceiling to max_document_size\r\n\r\nAnd then I believe if we see a 2103 it should be a bug and we shouldn't see the error if we do the chunking properly.\r\n\r\nFor chunking we may need a ceiling to the `binary_chunk_size` parameter which would depend on the encryption overhead. With the current default (100KB), any encryption overhead per-row is guaranteed to generate 2103 errors and it's kind of subtle to figure out why.\r\n\r\nIs 57 bytes per-row overhead you mentioned fixed for all encryption types, or it depends on the plugin which does the actual encryption? If it depends on the plugin, maybe we should have a new aegis plugin API which exposes the per-row-encryption-overhead. Or even better, switch to encrypting, then chunking. Would that be possible? That would eliminate the involvement of chunking parameter from the discussion altogether.\r\n\r\n>  If I attempt a _bulk_docs with two documents, one of which would cause a 2103 error on the txn and one that doesn't, what should happen? \r\n\r\nWhere was the 2103 error raised for bulk_docs, would you have a stack trace? With _bulk_docs I can see getting a 2101 (transaction size exceeded) easily. There is a heuristic there how we split the request into smaller transactions currently and it probably needs adjustment. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/769902427/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/769907814","html_url":"https://github.com/apache/couchdb/issues/3354#issuecomment-769907814","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3354","id":769907814,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTkwNzgxNA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T16:28:23Z","updated_at":"2021-01-29T16:28:23Z","author_association":"MEMBER","body":"the 57 bytes is from aegis core code, the only pluggable aspect is the key manager (i.e, how the 256 bits of key material are retrieved). it's 1 byte as a marker, 40 bytes for the wrapped row key and 16 bytes for the gcm integrity check. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/769907814/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/769909508","html_url":"https://github.com/apache/couchdb/issues/3354#issuecomment-769909508","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3354","id":769909508,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTkwOTUwOA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T16:31:21Z","updated_at":"2021-01-29T16:31:21Z","author_association":"MEMBER","body":"[{erlfdb_nif,erlfdb_future_get,[#Ref<0.1405062055.739115012.214974>],[]},{erlfdb,do_transaction,2,[{file,\"src/erlfdb.erl\"},{line,686}]},{fabric2_fdb,do_transaction,2,[{file,\"src/fabric2_fdb.erl\"},{line,171}]},{fabric2_fdb,transactional,2,[{file,\"src/fabric2_fdb.erl\"},{line,142}]},{fabric2_db,batch_update_docs,1,[{file,\"src/fabric2_db.erl\"},{line,1707}]},{fabric2_db,batch_update_docs,3,[{file,\"src/fabric2_db.erl\"},{line,1693}]},{fabric2_db,update_docs,3,[{file,\"src/fabric2_db.erl\"},{line,888}]},{chttpd_db,db_req,2,[{file,\"src/chttpd_db.erl\"},{line,520}]}]","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/769909508/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/769911384","html_url":"https://github.com/apache/couchdb/issues/3354#issuecomment-769911384","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3354","id":769911384,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTkxMTM4NA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T16:34:36Z","updated_at":"2021-01-29T16:34:36Z","author_association":"MEMBER","body":"encrypting before chunking is a good thought but it'll be tricky. aegis encrypts at the fdb key/value level. the key is included in the gcm integrity check, as a protection against programming error and tampering.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/769911384/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/769986131","html_url":"https://github.com/apache/couchdb/issues/3354#issuecomment-769986131","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3354","id":769986131,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTk4NjEzMQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T18:55:29Z","updated_at":"2021-01-29T18:55:29Z","author_association":"CONTRIBUTOR","body":"Makes sense about the 57 byte aegis overhead and about encrypting per row. It might be possible to account for the overhead probably when chunking and just reduce chunk size read from the config - 57 bytes.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/769986131/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/769988768","html_url":"https://github.com/apache/couchdb/issues/3354#issuecomment-769988768","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3354","id":769988768,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTk4ODc2OA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T19:00:43Z","updated_at":"2021-01-29T19:00:43Z","author_association":"MEMBER","body":"or we could move the chunking into aegis. Pass it the entire binary and it returns 1 or more rows each below the chunk limit.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/769988768/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/770001685","html_url":"https://github.com/apache/couchdb/issues/3354#issuecomment-770001685","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3354","id":770001685,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDAwMTY4NQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T19:25:57Z","updated_at":"2021-01-31T18:11:35Z","author_association":"CONTRIBUTOR","body":"Letting aegis do the chunking would make make sense, yeah.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/770001685/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/770016374","html_url":"https://github.com/apache/couchdb/issues/3354#issuecomment-770016374","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3354","id":770016374,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDAxNjM3NA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T19:55:48Z","updated_at":"2021-01-29T19:55:48Z","author_association":"CONTRIBUTOR","body":"Thanks for the _bulk_docs stacktrace. I tried to reproduce the 2103 error but had no luck so far. I used this script to insert docs of various sizes and batches https://gist.github.com/nickva/e7c7aa2a3d1fec3586fc4fee2f3a4cf8\r\n\r\nAt first I set `max_document_size` to 300000 be large enough to ensure each document would be chunked. To make sure we hit that code I added a few logs to see how many chunks are generated and if _bulk_docs is split across multiple transactions: [patch_diff.txt](https://github.com/apache/couchdb/files/5895910/patch_diff.txt)\r\n\r\nThen in the test script if I set `DOC_SIZE = 310000` I get 201s with all the docs inserted. If increase `DOC_SIZE = 320000` they fail with 413 as expected (well as we do in 3.x, which is a bit strange as you noted but at least consistent).\r\n\r\n```\r\n$ ./create_docs.py\r\nNUM_DOCS = 60 BATCH_SIZE = 30 DOC_SIZE = 310000\r\n_bulk_docs code 201\r\n_bulk_docs code 201\r\n```\r\n\r\n```\r\n$ ./create_docs.py\r\nNUM_DOCS = 60 BATCH_SIZE = 30 DOC_SIZE = 320000\r\n_bulk_docs code 413\r\n {'error': 'document_too_large', 'reason': ''}\r\n_bulk_docs code 413\r\n {'error': 'document_too_large', 'reason': ''}\r\n```\r\n\r\nWith the default 8MB doc size same thing:\r\n\r\n```\r\n$. /create_docs.py\r\nNUM_DOCS = 4 BATCH_SIZE = 2 DOC_SIZE = 8300000\r\n_bulk_docs code 201\r\n_bulk_docs code 201\r\n```\r\n```\r\n$ ./create_docs.py\r\nNUM_DOCS = 4 BATCH_SIZE = 2 DOC_SIZE = 8400000\r\n_bulk_docs code 413\r\n {'error': 'document_too_large', 'reason': ''}\r\n_bulk_docs code 413\r\n {'error': 'document_too_large', 'reason': ''}\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/770016374/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/770018414","html_url":"https://github.com/apache/couchdb/issues/3354#issuecomment-770018414","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3354","id":770018414,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDAxODQxNA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T19:59:33Z","updated_at":"2021-01-29T19:59:33Z","author_association":"MEMBER","body":"try\r\n\r\n```python\r\n#!/usr/bin/env python\r\n\r\nimport requests, json, random, string, os\r\n\r\ndocs = []\r\ndocs.append({\"foo\": \"\".join(random.choice(string.ascii_lowercase) for x in range(1000000))})\r\n\r\nr = requests.post(\r\n    'http://localhost:15984/db1/_bulk_docs',\r\n    json={\"docs\":docs}, auth=('foo', 'bar')\r\n)\r\n\r\nprint (r.status_code, r.text)\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/770018414/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/770028636","html_url":"https://github.com/apache/couchdb/issues/3354#issuecomment-770028636","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3354","id":770028636,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDAyODYzNg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T20:20:11Z","updated_at":"2021-01-29T21:26:44Z","author_association":"CONTRIBUTOR","body":"Thanks, with max_doc_size = 1000000 it returns a 413:\r\n\r\n```\r\n./create_one_large_bulk_docs.py\r\n413 {\"error\":\"document_too_large\",\"reason\":\"\"}\r\n```\r\n\r\nIt does that up until 1000009 after 1000010 it returns a 201\r\n\r\n```\r\n$ ./create_one_large_bulk_docs.py\r\n201 [{\"ok\":true,\"id\":\"58a1e10f6da663f79dfdb75a21001d8e\",\"rev\":\"1-824f43dd9cd68fb9af68ed05c293fb00\"}]\r\n\r\n$ http $DB/_node/_local/_config/couchdb/max_document_size\r\n\"1000010\"\r\n```\r\n\r\n```\r\n$ ./create_one_large_bulk_docs.py\r\n413 {\"error\":\"document_too_large\",\"reason\":\"\"}\r\n\r\n$ http $DB/_node/_local/_config/couchdb/max_document_size\r\n\"1000009\"\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/770028636/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/770846819","html_url":"https://github.com/apache/couchdb/issues/2858#issuecomment-770846819","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2858","id":770846819,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDg0NjgxOQ==","user":{"login":"gitsnaf","id":5305272,"node_id":"MDQ6VXNlcjUzMDUyNzI=","avatar_url":"https://avatars.githubusercontent.com/u/5305272?v=4","gravatar_id":"","url":"https://api.github.com/users/gitsnaf","html_url":"https://github.com/gitsnaf","followers_url":"https://api.github.com/users/gitsnaf/followers","following_url":"https://api.github.com/users/gitsnaf/following{/other_user}","gists_url":"https://api.github.com/users/gitsnaf/gists{/gist_id}","starred_url":"https://api.github.com/users/gitsnaf/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gitsnaf/subscriptions","organizations_url":"https://api.github.com/users/gitsnaf/orgs","repos_url":"https://api.github.com/users/gitsnaf/repos","events_url":"https://api.github.com/users/gitsnaf/events{/privacy}","received_events_url":"https://api.github.com/users/gitsnaf/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T13:12:16Z","updated_at":"2021-02-01T13:12:16Z","author_association":"NONE","body":"I still have exactly the same problem with CouchDB 3.1.1.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/770846819/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/770983459","html_url":"https://github.com/apache/couchdb/issues/2858#issuecomment-770983459","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2858","id":770983459,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDk4MzQ1OQ==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T16:30:18Z","updated_at":"2021-02-01T16:30:18Z","author_association":"CONTRIBUTOR","body":"Thanks @gitsnaf \r\n3.1.1 does not include the fix. It seems that this change has not been backported to 3.x yet","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/770983459/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771006460","html_url":"https://github.com/apache/couchdb/pull/3340#issuecomment-771006460","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3340","id":771006460,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTAwNjQ2MA==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T17:03:58Z","updated_at":"2021-02-01T17:03:58Z","author_association":"MEMBER","body":"Thank you for the review, @nickva ! I'm about to merge this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771006460/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771007715","html_url":"https://github.com/apache/couchdb/pull/3340#issuecomment-771007715","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3340","id":771007715,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTAwNzcxNQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T17:05:51Z","updated_at":"2021-02-01T17:06:44Z","author_association":"CONTRIBUTOR","body":"Don't forget to squash and rebase :-)\r\n\r\nAn perhaps we'd want to issue the PR for main as well","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771007715/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771014163","html_url":"https://github.com/apache/couchdb/pull/3340#issuecomment-771014163","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3340","id":771014163,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTAxNDE2Mw==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T17:15:11Z","updated_at":"2021-02-01T17:15:11Z","author_association":"MEMBER","body":"> An perhaps we'd want to issue the PR for main as well\r\n\r\nI thought `main` doesn't do attachments. Has that changed?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771014163/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771079214","html_url":"https://github.com/apache/couchdb/pull/3340#issuecomment-771079214","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3340","id":771079214,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTA3OTIxNA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T18:55:19Z","updated_at":"2021-02-01T18:59:05Z","author_association":"CONTRIBUTOR","body":"> I thought main doesn't do attachments. Has that changed?\r\n\r\nAttachments can be added, retrieved and replicated still. Pretty sure we have tests for that too. Their size would be limited by the maximum transaction size and that may not be exposed properly as a 413 and would just emit a 500 response but smaller sizes < 10Mb should work.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771079214/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771087608","html_url":"https://github.com/apache/couchdb/pull/3347#issuecomment-771087608","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3347","id":771087608,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTA4NzYwOA==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T19:08:34Z","updated_at":"2021-02-01T19:08:34Z","author_association":"MEMBER","body":"Thank you for the review, @iilyak and @rnewson !\r\nI'm about to merge this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771087608/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771089338","html_url":"https://github.com/apache/couchdb/pull/3340#issuecomment-771089338","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3340","id":771089338,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTA4OTMzOA==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T19:11:13Z","updated_at":"2021-02-01T19:11:13Z","author_association":"MEMBER","body":"> Attachments can be added, retrieved and replicated still. Pretty sure we have tests for that too. Their size would be limited by the maximum transaction size and that may not be exposed properly as a 413 and would just emit a 500 response but smaller sizes < 10Mb should work.\r\n\r\nGotcha. I'll open a PR to backport this to `main` after merge.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771089338/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771784569","html_url":"https://github.com/apache/couchdb/issues/1943#issuecomment-771784569","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1943","id":771784569,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTc4NDU2OQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-02T16:54:18Z","updated_at":"2021-02-02T16:54:18Z","author_association":"MEMBER","body":"Why didn't merging https://github.com/apache/couchdb/pull/3340 close this ticket?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771784569/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771979349","html_url":"https://github.com/apache/couchdb/issues/1943#issuecomment-771979349","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1943","id":771979349,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTk3OTM0OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-02T20:56:34Z","updated_at":"2021-02-02T20:56:34Z","author_association":"MEMBER","body":"Not sure...maybe cause it didn't land on `main`.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771979349/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771990389","html_url":"https://github.com/apache/couchdb/pull/3340#issuecomment-771990389","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3340","id":771990389,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTk5MDM4OQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-02T21:11:51Z","updated_at":"2021-02-02T21:11:51Z","author_association":"MEMBER","body":"Forgot to link: [backport PR](https://github.com/apache/couchdb/pull/3360)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771990389/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771990958","html_url":"https://github.com/apache/couchdb/pull/3360#issuecomment-771990958","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3360","id":771990958,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTk5MDk1OA==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-02T21:12:39Z","updated_at":"2021-02-02T21:12:39Z","author_association":"MEMBER","body":"Thank you for the review, @nickva ! I'm about to merge this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/771990958/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/772508539","html_url":"https://github.com/apache/couchdb/issues/1853#issuecomment-772508539","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1853","id":772508539,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MjUwODUzOQ==","user":{"login":"risabhsharma71","id":40636743,"node_id":"MDQ6VXNlcjQwNjM2NzQz","avatar_url":"https://avatars.githubusercontent.com/u/40636743?v=4","gravatar_id":"","url":"https://api.github.com/users/risabhsharma71","html_url":"https://github.com/risabhsharma71","followers_url":"https://api.github.com/users/risabhsharma71/followers","following_url":"https://api.github.com/users/risabhsharma71/following{/other_user}","gists_url":"https://api.github.com/users/risabhsharma71/gists{/gist_id}","starred_url":"https://api.github.com/users/risabhsharma71/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/risabhsharma71/subscriptions","organizations_url":"https://api.github.com/users/risabhsharma71/orgs","repos_url":"https://api.github.com/users/risabhsharma71/repos","events_url":"https://api.github.com/users/risabhsharma71/events{/privacy}","received_events_url":"https://api.github.com/users/risabhsharma71/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T13:32:38Z","updated_at":"2021-02-03T13:35:17Z","author_association":"NONE","body":"@garrensmith\r\n**$in** queries are really slow,my data set is of a million records.It takes around  2 mins to execute.\r\nfor me **$eq** is fast.even after running the $in query multiple times it slow.\r\n ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/772508539/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/773420018","html_url":"https://github.com/apache/couchdb/pull/3359#issuecomment-773420018","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3359","id":773420018,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MzQyMDAxOA==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-04T16:06:01Z","updated_at":"2021-02-04T16:06:01Z","author_association":"CONTRIBUTOR","body":"Thanks @nickva ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/773420018/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/774058385","html_url":"https://github.com/apache/couchdb/pull/3361#issuecomment-774058385","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3361","id":774058385,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NDA1ODM4NQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-05T14:15:57Z","updated_at":"2021-02-05T14:15:57Z","author_association":"MEMBER","body":"works nicely for suspended processes but other processes report as \"waiting\" mostly and that might confuse folks. Suspect \"running\" state is quite fleeting","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/774058385/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/774658236","html_url":"https://github.com/apache/couchdb/issues/3356#issuecomment-774658236","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3356","id":774658236,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NDY1ODIzNg==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-07T11:29:56Z","updated_at":"2021-02-07T11:29:56Z","author_association":"MEMBER","body":"The _security object is stored on each copy of each shard range so there is some potential for inconsistency and delay even on a single node server. It also largely not relevant that the requests were initiated by the same coordinator node.\r\n\r\nmultiple seconds is a little odd though. One thing to note is that the change to the security object will enter the same queue as reads and writes to the relevant files, and those are processed in order of receipt.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/774658236/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/775005078","html_url":"https://github.com/apache/couchdb/issues/3356#issuecomment-775005078","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3356","id":775005078,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NTAwNTA3OA==","user":{"login":"adrienverge","id":5244945,"node_id":"MDQ6VXNlcjUyNDQ5NDU=","avatar_url":"https://avatars.githubusercontent.com/u/5244945?v=4","gravatar_id":"","url":"https://api.github.com/users/adrienverge","html_url":"https://github.com/adrienverge","followers_url":"https://api.github.com/users/adrienverge/followers","following_url":"https://api.github.com/users/adrienverge/following{/other_user}","gists_url":"https://api.github.com/users/adrienverge/gists{/gist_id}","starred_url":"https://api.github.com/users/adrienverge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrienverge/subscriptions","organizations_url":"https://api.github.com/users/adrienverge/orgs","repos_url":"https://api.github.com/users/adrienverge/repos","events_url":"https://api.github.com/users/adrienverge/events{/privacy}","received_events_url":"https://api.github.com/users/adrienverge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-08T09:29:20Z","updated_at":"2021-02-08T09:29:20Z","author_association":"CONTRIBUTOR","body":"Hello @rnewson, thanks for your answer.\r\n\r\n> It also largely not relevant that the requests were initiated by the same coordinator node.\r\n\r\nInteresting and good to know! That's not an intuitive result. But that's indeed what I measured when testing reproduction scenarii.\r\n\r\n> One thing to note is that the change to the security object will enter the same queue as reads and writes to the relevant files, and those are processed in order of receipt.\r\n\r\nInteresting too! Is there a way to use this fact in order to garantee that a future call to `GET /base` (as user) will succeed (no random HTTP 403)? Without making the code \"sleep\" for an arbitrary amount of time?\r\n\r\nAlso, is it a *bug* to get inconsistent results just after changing a base `_security` object?\r\n- If yes, is there something I can do? I could open a pull request to update the docs about this limitation?\r\n- If no, is there a \"correct\" way to get consistent results when querying a base after changing its `_security`? Because \"waiting 1 second\" doesn't sound satisfafying (performance loss after each database creation, in our case) nor reliable (in case of server load, delays are increased).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/775005078/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/776124292","html_url":"https://github.com/apache/couchdb/pull/3363#issuecomment-776124292","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3363","id":776124292,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NjEyNDI5Mg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-09T17:55:19Z","updated_at":"2021-02-10T02:17:49Z","author_association":"CONTRIBUTOR","body":"@janosgyerman\r\n\r\nVery nice. It's good to have friendly error message and send stack traces to the logs. \r\n\r\nI wonder if on `main` the specific `EXIT` clause error won't even apply. We'd have to call a `gen_server` from the request process and then the callback inside would throw an `error` and I couldn't remember if there are any calls to gen_servers made from the request process.\r\n\r\nAlso, what do the logs show with and without your fix on 3.x, would you mind sharing those? And then perhaps move the PR to the 3.x branch.\r\n\r\nOn main we'd have to see if these types of stacktraces can be generated at all. Maybe we'd need to add other clauses here not just an 'EXIT' one.  As a fun experiment to help generate errors you could insert various `error(some_message)` or `exit(exit_message)` expressions in lower level functions which read or write to FDB (something in fabric2_db, fabric2_fdb, erlfdb, maybe). To make it fancy you could make them a bit random and say something like:  `case random:uniform() < 0.1 of true -> exit(boom); false -> ok end.` so only 10% of the time you'd get the error.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/776124292/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/776920435","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-776920435","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":776920435,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NjkyMDQzNQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-10T18:32:11Z","updated_at":"2021-02-10T18:32:11Z","author_association":"MEMBER","body":"Huh. Can you explain the failure mode in more detail, @rnewson ?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/776920435/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/776921180","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-776921180","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":776921180,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NjkyMTE4MA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-10T18:33:30Z","updated_at":"2021-02-10T18:33:30Z","author_association":"MEMBER","body":"couch_server as a single gen_server has a finite throughput that, in busy clusters, is easily breached, causing a sizeable backlog in the message queue, ultimately leading to failure and errors.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/776921180/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/776921761","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-776921761","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":776921761,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NjkyMTc2MQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-10T18:34:29Z","updated_at":"2021-02-10T18:34:29Z","author_association":"MEMBER","body":"timeouts, memory blow ups, cats and dogs living together. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/776921761/reactions","total_count":1,"+1":0,"-1":0,"laugh":1,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/777080949","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-777080949","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":777080949,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NzA4MDk0OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-10T22:34:19Z","updated_at":"2021-02-10T22:34:37Z","author_association":"MEMBER","body":"How will this affect the output of the `message_queues` key in `_system` stats?\r\n\r\n[This line](https://github.com/apache/couchdb/blob/main/src/chttpd/src/chttpd_node.erl#L215) calls `registered()` and I don't know how that works for multiple `gen_servers` that all appear to have the same name.\r\n\r\nI suspect it'd be useful to be able to generate a (new?) stat that showed message queues by `couch_server` shard, identifying by db/shard serviced by that `gen_server`. But I might be assuming something here that isn't real... :upside_down_face: ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/777080949/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/777104434","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-777104434","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":777104434,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NzEwNDQzNA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-10T23:25:29Z","updated_at":"2021-02-10T23:25:54Z","author_association":"MEMBER","body":"tests pass locally. getting random 1 or 2 failures each time on our CI chain. I would like to disable them if they aren't going to run reliably.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/777104434/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/777138822","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-777138822","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":777138822,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NzEzODgyMg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-11T00:46:44Z","updated_at":"2021-02-11T00:46:44Z","author_association":"MEMBER","body":"> tests pass locally. getting random 1 or 2 failures each time on our CI chain. I would like to disable them if they aren't going to run reliably.\r\n\r\nIf the development team is unable to put in the time to maintain test suites properly, then you have my vote.\r\n\r\nI'd bring this up on dev@, but I have, many times over many years, and nothing ever changes.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/777138822/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/777225292","html_url":"https://github.com/apache/couchdb/pull/3312#issuecomment-777225292","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3312","id":777225292,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NzIyNTI5Mg==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-11T06:14:13Z","updated_at":"2021-02-11T06:14:13Z","author_association":"CONTRIBUTOR","body":"@wohali is there anything else needed here?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/777225292/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/777737131","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-777737131","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":777737131,"node_id":"MDEyOklzc3VlQ29tbWVudDc3NzczNzEzMQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-11T19:33:16Z","updated_at":"2021-02-12T16:14:25Z","author_association":"CONTRIBUTOR","body":"I noticed one of the failed tests in `\r\ncontinuous-integration/jenkins/pr-merge` a `couch_server` failure in it. I ran the test suite locally and it passed so could be just a flaky test and the new code just highlights the flakiness, but since couch_server showed up it was a bit suspicious so thought I'd mention it here:\r\n\r\n\r\n```\r\n[2021-02-11T18:42:04.494Z]     Multiple database create/delete tests\r\n\r\n[2021-02-11T18:42:04.853Z]       couch_db_tests:111: should_create_multiple_dbs...[0.090 s] ok\r\n\r\n[2021-02-11T18:42:04.853Z]       couch_db_tests:122: should_delete_multiple_dbs...*failed*\r\n\r\n[2021-02-11T18:42:04.853Z] in function gen_server:call/3 (gen_server.erl, line 223)\r\n\r\n[2021-02-11T18:42:04.853Z] in call from couch_server:create_int/2 (src/couch_server.erl, line 143)\r\n\r\n[2021-02-11T18:42:04.853Z] in call from couch_server:create/2 (src/couch_server.erl, line 135)\r\n\r\n[2021-02-11T18:42:04.853Z] in call from couch_db_tests:create_db/2 (test/eunit/couch_db_tests.erl, line 193)\r\n\r\n[2021-02-11T18:42:04.853Z] in call from couch_db_tests:'-should_delete_multiple_dbs/1-fun-1-'/1 (test/eunit/couch_db_tests.erl, line 123)\r\n\r\n[2021-02-11T18:42:04.853Z] in call from couch_db_tests:'-should_delete_multiple_dbs/1-lc$^0/1-0-'/1 (test/eunit/couch_db_tests.erl, line 123)\r\n\r\n[2021-02-11T18:42:04.853Z] in call from couch_db_tests:'-should_delete_multiple_dbs/1-fun-8-'/1 (test/eunit/couch_db_tests.erl, line 123)\r\n\r\n[2021-02-11T18:42:04.853Z] in call from eunit_test:run_testfun/1 (eunit_test.erl, line 71)\r\n\r\n[2021-02-11T18:42:04.853Z] **exit:{{badarg,[{ets,update_element,\r\n\r\n[2021-02-11T18:42:04.853Z]                [couch_server_4,\r\n\r\n[2021-02-11T18:42:04.853Z]                 <<\"eunit-test-db-cd448fbae5748e8885319d3a0d\"...>>,\r\n\r\n[2021-02-11T18:42:04.853Z]                 {5,locked}],\r\n\r\n[2021-02-11T18:42:04.853Z]                []},\r\n\r\n[2021-02-11T18:42:04.853Z]           {couch_lru,close_int,2,[{file,\"src/couch_lru.erl\"},{line,49}]},\r\n\r\n[2021-02-11T18:42:04.853Z]           {couch_server,maybe_close_lru_db,1,\r\n\r\n[2021-02-11T18:42:04.853Z]                         [{file,\"src/couch_server.erl\"},{line,405}]},\r\n\r\n[2021-02-11T18:42:04.853Z]           {couch_server,handle_call,3,\r\n\r\n[2021-02-11T18:42:04.853Z]                         [{file,\"src/couch_server.erl\"},{line,575}]},\r\n\r\n[2021-02-11T18:42:04.853Z]           {gen_server,try_handle_call,4,[{file,\"gen_server.erl\"},{line,661}]},\r\n\r\n[2021-02-11T18:42:04.853Z]           {gen_server,handle_msg,6,[{file,\"gen_server.erl\"},{line,690}]},\r\n\r\n[2021-02-11T18:42:04.853Z]           {proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,249}]}]},\r\n\r\n[2021-02-11T18:42:04.853Z]  {gen_server,call,\r\n\r\n[2021-02-11T18:42:04.853Z]              [couch_server_4,\r\n\r\n[2021-02-11T18:42:04.853Z]               {create,<<\"eunit-test-db-9849e822ba346e3d33d5f388c3\"...>>,[]},\r\n\r\n[2021-02-11T18:42:04.853Z]               infinity]}}\r\n\r\n[2021-02-11T18:42:04.853Z]   output:<<\"\">>\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/777737131/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778189676","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-778189676","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":778189676,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODE4OTY3Ng==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-12T13:17:19Z","updated_at":"2021-02-12T13:17:19Z","author_association":"MEMBER","body":"took me way to long to see my mistake. I called couch_server:couch_server(DbName) in couch_lru.erl instead of couch_server:couch_dbs(DbName). So the _new_ mystery is why these tests pass locally...\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778189676/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778207412","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-778207412","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":778207412,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODIwNzQxMg==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-12T13:51:20Z","updated_at":"2021-02-12T13:51:20Z","author_association":"MEMBER","body":"@wohali the processes (and ets tables) have different names. I checked _system output and its as expected\r\n\r\n```\r\n   \"mem3_reshard_sup\": 0,\r\n    \"mem3_reshard_job_sup\": 0,\r\n    \"erl_prim_loader\": 0,\r\n    \"couch_server_16\": 0,\r\n    \"mem3_reshard_dbdoc\": 0,\r\n    \"couch_server_15\": 0,\r\n    \"couch_epi_sup\": 0,\r\n    \"couch_server_14\": 0,\r\n    \"mem3_reshard\": 0,\r\n    \"couch_server_13\": 0,\r\n    \"init\": 0,\r\n    \"couch_server_12\": 0,\r\n    \"couch_server_11\": 0,\r\n    \"mem3_nodes\": 0,\r\n    \"couch_server_10\": 0,\r\n    \"couch_server_9\": 0,\r\n    \"couch_server_8\": 0,\r\n    \"couch_server_7\": 0,\r\n    \"couch_server_6\": 0,\r\n    \"code_server\": 0,\r\n    \"couch_server_5\": 0,\r\n    \"couch_server_4\": 0,\r\n    \"application_controller\": 0,\r\n    \"httpc_sup\": 0,\r\n...\r\n```\r\n\r\nConsumers of this will need to adjust expectations for sure, though the _stats endpoint is fine, each couch_server_X process increments the same named stats as before.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778207412/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778207976","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-778207976","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":778207976,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODIwNzk3Ng==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-12T13:52:27Z","updated_at":"2021-02-12T13:52:27Z","author_association":"MEMBER","body":"The only remaining question before merging is whether we redefine what `max_dbs_open` to be per scheduler, or whether I should reduce `max_dbs_open` by the num_servers() factor internal to each couch_server. My preference is for the latter but it's an important point to get opinions on.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778207976/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778222394","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-778222394","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":778222394,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODIyMjM5NA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-12T14:18:22Z","updated_at":"2021-02-12T14:18:22Z","author_association":"MEMBER","body":"I've added the division at https://github.com/apache/couchdb/pull/3366/files#diff-2a7cfe9afa75338cd45f2ab010896e7cf24ea59b4355404f5412000cd9c7d934R296.\r\n\r\nThe idea is that instead of 1 gen_server/ets tables handling all $max_dbs_open items, we have N gen_server/ets tables handling $max_dbs_open/N items.\r\n\r\nThis is the least surprising behaviour. The alternative would be a silent multiplying of max_dbs_open by the number of schedulers, a number that is usually not consciously chosen and varies by host.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778222394/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778236937","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-778236937","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":778236937,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODIzNjkzNw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-12T14:44:32Z","updated_at":"2021-02-12T15:13:46Z","author_association":"MEMBER","body":"> If the development team is unable to put in the time to maintain test suites properly, then you have my vote.\r\n\r\nturns out they were real bugs in this PR :)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778236937/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778305951","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-778305951","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":778305951,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODMwNTk1MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-12T16:43:31Z","updated_at":"2021-02-12T16:43:31Z","author_association":"MEMBER","body":"@rnewson so no way to determine which couch_server is which without a remsh? Boo. How would I go about that anyway?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778305951/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778355795","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-778355795","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":778355795,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODM1NTc5NQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-12T18:11:29Z","updated_at":"2021-02-12T18:11:29Z","author_association":"MEMBER","body":"@wohali What do you mean which is which? Those message queues are the registered names. Thus, `couch_server_1` literally translates to a process registered under that name that can be inspected via `process_info/1` and friends.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778355795/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778454576","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-778454576","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":778454576,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODQ1NDU3Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-12T21:05:24Z","updated_at":"2021-02-12T21:05:24Z","author_association":"MEMBER","body":"@davisp which shard is `couch_server_14` serving out?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778454576/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778460208","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-778460208","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":778460208,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODQ2MDIwOA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-12T21:17:51Z","updated_at":"2021-02-12T21:17:51Z","author_association":"MEMBER","body":"You can call `couch_server:couch_server(DbName)` from a remsh if you need to know which couch_server_X process a specific database is handled by. I'm not sure how useful that is. Typically at Cloudant we'd kill `couch_server` if it gained such a large message queue that it wasn't going to heal on its own, but I don't recall needing to look inside its state. What's your use case?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778460208/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778468715","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-778468715","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":778468715,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODQ2ODcxNQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-12T21:37:30Z","updated_at":"2021-02-12T21:37:30Z","author_association":"MEMBER","body":"@rnewson Talking people through problem solving remotely, people who are not generally facile with (or are frightened by) remsh.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778468715/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778474473","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-778474473","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":778474473,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODQ3NDQ3Mw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-12T21:51:20Z","updated_at":"2021-02-12T21:51:20Z","author_association":"MEMBER","body":"Hm, ok, I'm still lost. A problem that requires looking into the state of couch_server is going to need remsh access anyway. Can you give me an example?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778474473/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778532407","html_url":"https://github.com/apache/couchdb/pull/3366#issuecomment-778532407","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3366","id":778532407,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODUzMjQwNw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-13T00:50:37Z","updated_at":"2021-02-13T00:50:37Z","author_association":"MEMBER","body":"Never mind. Thanks for the good work on this PR.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778532407/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]