[{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1235041484","html_url":"https://github.com/apache/ratis/pull/718#issuecomment-1235041484","issue_url":"https://api.github.com/repos/apache/ratis/issues/718","id":1235041484,"node_id":"IC_kwDOBMxbGc5JnTzM","user":{"login":"captainzmc","id":13825159,"node_id":"MDQ6VXNlcjEzODI1MTU5","avatar_url":"https://avatars.githubusercontent.com/u/13825159?v=4","gravatar_id":"","url":"https://api.github.com/users/captainzmc","html_url":"https://github.com/captainzmc","followers_url":"https://api.github.com/users/captainzmc/followers","following_url":"https://api.github.com/users/captainzmc/following{/other_user}","gists_url":"https://api.github.com/users/captainzmc/gists{/gist_id}","starred_url":"https://api.github.com/users/captainzmc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/captainzmc/subscriptions","organizations_url":"https://api.github.com/users/captainzmc/orgs","repos_url":"https://api.github.com/users/captainzmc/repos","events_url":"https://api.github.com/users/captainzmc/events{/privacy}","received_events_url":"https://api.github.com/users/captainzmc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-02T03:58:57Z","updated_at":"2022-09-02T03:58:57Z","author_association":"MEMBER","body":"@szetszwo Sure, let me verify that.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1235041484/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1235136179","html_url":"https://github.com/apache/ratis/pull/729#issuecomment-1235136179","issue_url":"https://api.github.com/repos/apache/ratis/issues/729","id":1235136179,"node_id":"IC_kwDOBMxbGc5Jnq6z","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-02T06:52:20Z","updated_at":"2022-09-02T06:52:20Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for reviewing and committing it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1235136179/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236104782","html_url":"https://github.com/apache/ratis/pull/732#issuecomment-1236104782","issue_url":"https://api.github.com/repos/apache/ratis/issues/732","id":1236104782,"node_id":"IC_kwDOBMxbGc5JrXZO","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-03T11:54:46Z","updated_at":"2022-09-03T11:54:46Z","author_association":"CONTRIBUTOR","body":"@codings-dan , thanks a lot for merging this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236104782/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236105683","html_url":"https://github.com/apache/ratis/pull/733#issuecomment-1236105683","issue_url":"https://api.github.com/repos/apache/ratis/issues/733","id":1236105683,"node_id":"IC_kwDOBMxbGc5JrXnT","user":{"login":"jiacheliu3","id":14806853,"node_id":"MDQ6VXNlcjE0ODA2ODUz","avatar_url":"https://avatars.githubusercontent.com/u/14806853?v=4","gravatar_id":"","url":"https://api.github.com/users/jiacheliu3","html_url":"https://github.com/jiacheliu3","followers_url":"https://api.github.com/users/jiacheliu3/followers","following_url":"https://api.github.com/users/jiacheliu3/following{/other_user}","gists_url":"https://api.github.com/users/jiacheliu3/gists{/gist_id}","starred_url":"https://api.github.com/users/jiacheliu3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiacheliu3/subscriptions","organizations_url":"https://api.github.com/users/jiacheliu3/orgs","repos_url":"https://api.github.com/users/jiacheliu3/repos","events_url":"https://api.github.com/users/jiacheliu3/events{/privacy}","received_events_url":"https://api.github.com/users/jiacheliu3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-03T12:01:10Z","updated_at":"2022-09-03T12:01:10Z","author_association":"CONTRIBUTOR","body":"@codings-dan PTAL if the design meets expectation and pls feel free to add any reviewers to the discussion. If you are all okay with the idea and design, I will move on to add unit tests.\r\n\r\nOn unit tests, I'm honestly not sure what you would expect me to add. I mean, this PR adds UnexpectedExceptionHandlers then I guess I should add tests to trigger unhandled exceptions to each Daemon thread? Or just having one test on the Daemon thread class itself would be acceptable? I'm new to Ratis repo so I'd like to conform to how you normally test. Any advice is appreciated!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236105683/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236118887","html_url":"https://github.com/apache/ratis/pull/735#issuecomment-1236118887","issue_url":"https://api.github.com/repos/apache/ratis/issues/735","id":1236118887,"node_id":"IC_kwDOBMxbGc5Jra1n","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-03T13:16:55Z","updated_at":"2022-09-03T13:16:55Z","author_association":"MEMBER","body":"@szetszwo Hi, last time we have discussions on moving `ReadRequests` to `LeaderStateImpl`. It is inconvenient since we cannot initialize the `appliedIndexConsumer` in `StateMachineUpdater` constructor. Thus, I am thinking about separating `ReadIndexQueue` from `ReadRequests`, since\r\n1. `ReadIndexQueue` should be accessed by both leader and follower peer after we implement **follower linearizable read**.\r\n2. After separating, we can avoid the above inconveniences, placing the `ReadRequests` in `LeaderStateImpl` and `ReadIndexQueue` in `ServerState`.\r\nWhat do you think?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236118887/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236318483","html_url":"https://github.com/apache/ratis/pull/733#issuecomment-1236318483","issue_url":"https://api.github.com/repos/apache/ratis/issues/733","id":1236318483,"node_id":"IC_kwDOBMxbGc5JsLkT","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-04T11:39:55Z","updated_at":"2022-09-04T11:39:55Z","author_association":"CONTRIBUTOR","body":"@jiacheliu3 Thanks for working on this, I will review the change recently @szetszwo Could you help take a look at this pull request?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236318483/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236459783","html_url":"https://github.com/apache/ratis/pull/733#issuecomment-1236459783","issue_url":"https://api.github.com/repos/apache/ratis/issues/733","id":1236459783,"node_id":"IC_kwDOBMxbGc5JsuEH","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-05T01:17:58Z","updated_at":"2022-09-05T01:17:58Z","author_association":"CONTRIBUTOR","body":"@codings-dan , sure, will review this.\r\n\r\n@jiacheliu3 , thanks a lot for working this!  There were some failures in https://github.com/apache/ratis/actions/runs/2984287869 .  Could you take a look?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236459783/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236661549","html_url":"https://github.com/apache/ratis/pull/718#issuecomment-1236661549","issue_url":"https://api.github.com/repos/apache/ratis/issues/718","id":1236661549,"node_id":"IC_kwDOBMxbGc5JtfUt","user":{"login":"captainzmc","id":13825159,"node_id":"MDQ6VXNlcjEzODI1MTU5","avatar_url":"https://avatars.githubusercontent.com/u/13825159?v=4","gravatar_id":"","url":"https://api.github.com/users/captainzmc","html_url":"https://github.com/captainzmc","followers_url":"https://api.github.com/users/captainzmc/followers","following_url":"https://api.github.com/users/captainzmc/following{/other_user}","gists_url":"https://api.github.com/users/captainzmc/gists{/gist_id}","starred_url":"https://api.github.com/users/captainzmc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/captainzmc/subscriptions","organizations_url":"https://api.github.com/users/captainzmc/orgs","repos_url":"https://api.github.com/users/captainzmc/repos","events_url":"https://api.github.com/users/captainzmc/events{/privacy}","received_events_url":"https://api.github.com/users/captainzmc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-05T07:55:57Z","updated_at":"2022-09-05T07:57:55Z","author_association":"MEMBER","body":"> @captainzmc , [RATIS-1694](https://issues.apache.org/jira/browse/RATIS-1694) is now merged. Could you test if it could fix the problem so that we can include RATIS-1677 in 2.4.0?\r\n\r\nHi @szetszwo, It appears that RATIS-1694 did not solve the [CI error problem.](https://github.com/captainzmc/hadoop-ozone/runs/8182883694?check_suite_focus=true#step:5:5415) \r\nHere I use the test package published by Yao Long, which is his local commit log. Thanks @codings-dan  for the help.\r\n<img width=\"653\" alt=\"企业微信截图_7532426c-c640-418a-80e8-aaf4177c5e37\" src=\"https://user-images.githubusercontent.com/13825159/188397923-cb4ef5c5-d3df-4f37-92b6-47760d3d38e2.png\">\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236661549/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236675912","html_url":"https://github.com/apache/ratis/pull/718#issuecomment-1236675912","issue_url":"https://api.github.com/repos/apache/ratis/issues/718","id":1236675912,"node_id":"IC_kwDOBMxbGc5Jti1I","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-05T08:11:22Z","updated_at":"2022-09-05T08:11:22Z","author_association":"CONTRIBUTOR","body":"@captainzmc , the number of failures was decreased dramatically.  It is expected to have test failures.  The tests depend on the auto-format behavior need to be updated.  As an example, see https://github.com/captainzmc/hadoop-ozone/runs/8182884310?check_suite_focus=true#step:6:2010 .  \r\n\r\nNote that this is a fix for a data loss case caused by the auto-format behavior.  So I suggest to include this in 2.4.0 and then update Ozone.  What do you think?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236675912/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236681385","html_url":"https://github.com/apache/ratis/pull/733#issuecomment-1236681385","issue_url":"https://api.github.com/repos/apache/ratis/issues/733","id":1236681385,"node_id":"IC_kwDOBMxbGc5JtkKp","user":{"login":"jiacheliu3","id":14806853,"node_id":"MDQ6VXNlcjE0ODA2ODUz","avatar_url":"https://avatars.githubusercontent.com/u/14806853?v=4","gravatar_id":"","url":"https://api.github.com/users/jiacheliu3","html_url":"https://github.com/jiacheliu3","followers_url":"https://api.github.com/users/jiacheliu3/followers","following_url":"https://api.github.com/users/jiacheliu3/following{/other_user}","gists_url":"https://api.github.com/users/jiacheliu3/gists{/gist_id}","starred_url":"https://api.github.com/users/jiacheliu3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiacheliu3/subscriptions","organizations_url":"https://api.github.com/users/jiacheliu3/orgs","repos_url":"https://api.github.com/users/jiacheliu3/repos","events_url":"https://api.github.com/users/jiacheliu3/events{/privacy}","received_events_url":"https://api.github.com/users/jiacheliu3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-05T08:17:02Z","updated_at":"2022-09-05T08:17:02Z","author_association":"CONTRIBUTOR","body":"Is this one flaky? This UT passes on my local build.\r\n```\r\nError:  Tests run: 16, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 42.736 s <<< FAILURE! - in org.apache.ratis.server.simulation.TestLeaderElectionWithSimulatedRpc\r\nError:  testRemoveListener(org.apache.ratis.server.simulation.TestLeaderElectionWithSimulatedRpc)  Time elapsed: 1.711 s  <<< ERROR!\r\njava.lang.IllegalStateException: Found duplicated element s0|rpc:localhost:38565|admin:localhost:42183|client:localhost:37945|dataStream:localhost:42749|priority:0|startupRole:FOLLOWER in [s0|rpc:localhost:38565|admin:localhost:42183|client:localhost:37945|dataStream:localhost:42749|priority:0|startupRole:FOLLOWER, s2|rpc:localhost:40489|admin:localhost:40079|client:localhost:44937|dataStream:localhost:40043|priority:0|startupRole:FOLLOWER, s0|rpc:localhost:38565|admin:localhost:42183|client:localhost:37945|dataStream:localhost:42749|priority:0|startupRole:FOLLOWER]\r\n\tat org.apache.ratis.util.Preconditions.assertTrue(Preconditions.java:73)\r\n\tat org.apache.ratis.util.Preconditions.assertUnique(Preconditions.java:128)\r\n\tat org.apache.ratis.util.Preconditions.assertUnique(Preconditions.java:122)\r\n\tat org.apache.ratis.protocol.SetConfigurationRequest$Arguments.<init>(SetConfigurationRequest.java:59)\r\n\tat org.apache.ratis.protocol.SetConfigurationRequest$Arguments.<init>(SetConfigurationRequest.java:36)\r\n\tat org.apache.ratis.protocol.SetConfigurationRequest$Arguments$Builder.build(SetConfigurationRequest.java:144)\r\n\tat org.apache.ratis.client.api.AdminApi.setConfiguration(AdminApi.java:55)\r\n\tat org.apache.ratis.client.api.AdminApi.setConfiguration(AdminApi.java:40)\r\n\tat org.apache.ratis.server.impl.LeaderElectionTests.testRemoveListener(LeaderElectionTests.java:353)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\r\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\r\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\r\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:299)\r\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:293)\r\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n\tat java.base/java.lang.Thread.run(Thread.java:829)\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236681385/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236693191","html_url":"https://github.com/apache/ratis/pull/733#issuecomment-1236693191","issue_url":"https://api.github.com/repos/apache/ratis/issues/733","id":1236693191,"node_id":"IC_kwDOBMxbGc5JtnDH","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-05T08:28:08Z","updated_at":"2022-09-05T08:28:08Z","author_association":"CONTRIBUTOR","body":"> Is this one flaky? This UT passes on my local build.\r\n> \r\n> ```\r\n> Error:  Tests run: 16, Failures: 0, Errors: 1, Skipped: 0, Time elapsed: 42.736 s <<< FAILURE! - in org.apache.ratis.server.simulation.TestLeaderElectionWithSimulatedRpc\r\n> Error:  testRemoveListener(org.apache.ratis.server.simulation.TestLeaderElectionWithSimulatedRpc)  Time elapsed: 1.711 s  <<< ERROR!\r\n> java.lang.IllegalStateException: Found duplicated element s0|rpc:localhost:38565|admin:localhost:42183|client:localhost:37945|dataStream:localhost:42749|priority:0|startupRole:FOLLOWER in [s0|rpc:localhost:38565|admin:localhost:42183|client:localhost:37945|dataStream:localhost:42749|priority:0|startupRole:FOLLOWER, s2|rpc:localhost:40489|admin:localhost:40079|client:localhost:44937|dataStream:localhost:40043|priority:0|startupRole:FOLLOWER, s0|rpc:localhost:38565|admin:localhost:42183|client:localhost:37945|dataStream:localhost:42749|priority:0|startupRole:FOLLOWER]\r\n> \tat org.apache.ratis.util.Preconditions.assertTrue(Preconditions.java:73)\r\n> \tat org.apache.ratis.util.Preconditions.assertUnique(Preconditions.java:128)\r\n> \tat org.apache.ratis.util.Preconditions.assertUnique(Preconditions.java:122)\r\n> \tat org.apache.ratis.protocol.SetConfigurationRequest$Arguments.<init>(SetConfigurationRequest.java:59)\r\n> \tat org.apache.ratis.protocol.SetConfigurationRequest$Arguments.<init>(SetConfigurationRequest.java:36)\r\n> \tat org.apache.ratis.protocol.SetConfigurationRequest$Arguments$Builder.build(SetConfigurationRequest.java:144)\r\n> \tat org.apache.ratis.client.api.AdminApi.setConfiguration(AdminApi.java:55)\r\n> \tat org.apache.ratis.client.api.AdminApi.setConfiguration(AdminApi.java:40)\r\n> \tat org.apache.ratis.server.impl.LeaderElectionTests.testRemoveListener(LeaderElectionTests.java:353)\r\n> \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n> \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n> \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n> \tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n> \tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\r\n> \tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n> \tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\r\n> \tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n> \tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\r\n> \tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:299)\r\n> \tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:293)\r\n> \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n> \tat java.base/java.lang.Thread.run(Thread.java:829)\r\n> ```\r\n\r\nlet me re-run the ci test","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236693191/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236807974","html_url":"https://github.com/apache/ratis/pull/733#issuecomment-1236807974","issue_url":"https://api.github.com/repos/apache/ratis/issues/733","id":1236807974,"node_id":"IC_kwDOBMxbGc5JuDEm","user":{"login":"jiacheliu3","id":14806853,"node_id":"MDQ6VXNlcjE0ODA2ODUz","avatar_url":"https://avatars.githubusercontent.com/u/14806853?v=4","gravatar_id":"","url":"https://api.github.com/users/jiacheliu3","html_url":"https://github.com/jiacheliu3","followers_url":"https://api.github.com/users/jiacheliu3/followers","following_url":"https://api.github.com/users/jiacheliu3/following{/other_user}","gists_url":"https://api.github.com/users/jiacheliu3/gists{/gist_id}","starred_url":"https://api.github.com/users/jiacheliu3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiacheliu3/subscriptions","organizations_url":"https://api.github.com/users/jiacheliu3/orgs","repos_url":"https://api.github.com/users/jiacheliu3/repos","events_url":"https://api.github.com/users/jiacheliu3/events{/privacy}","received_events_url":"https://api.github.com/users/jiacheliu3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-05T10:13:39Z","updated_at":"2022-09-05T10:13:39Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks for the comments! What do you think about exposing the exception on the `RaftServer`? I come from Alluxio and we use Ratis RaftServer to manage the file system metadata. \r\nhttps://github.com/Alluxio/alluxio/blob/aacf14507174029fac4a997b6037207fae92ea91/core/server/common/src/main/java/alluxio/master/journal/raft/RaftJournalSystem.java#L429\r\nIt'll be very helpful if the lifecycle state on the RaftServer is more up-to-date and more ideally, we can see what error caused RaftServer to fail. It is fair if you say we don't expose the exception outside RaftServer (because the external party normally can't do better recovery than the RaftServer is capable of), but it could be more extensible to future use cases if we do expose the exception out of RaftServer. WDYT?\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236807974/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236948825","html_url":"https://github.com/apache/ratis/pull/733#issuecomment-1236948825","issue_url":"https://api.github.com/repos/apache/ratis/issues/733","id":1236948825,"node_id":"IC_kwDOBMxbGc5JuldZ","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-05T12:32:29Z","updated_at":"2022-09-05T12:32:29Z","author_association":"CONTRIBUTOR","body":"@jiacheliu3 , What do you think about exposing the exception on the `RaftServer`?\r\n\r\nIt is a good idea.  We can do it by passing an `UncaughtExceptionHandler`; see https://issues.apache.org/jira/secure/attachment/13048963/733_review.patch","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1236948825/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237201243","html_url":"https://github.com/apache/ratis/pull/736#issuecomment-1237201243","issue_url":"https://api.github.com/repos/apache/ratis/issues/736","id":1237201243,"node_id":"IC_kwDOBMxbGc5JvjFb","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-05T15:22:25Z","updated_at":"2022-09-05T15:22:25Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks for working on this, there are some unit test errors related to this change, could you take a look? see https://github.com/apache/ratis/runs/8191529663?check_suite_focus=true#step:5:683","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237201243/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237264051","html_url":"https://github.com/apache/ratis/pull/735#issuecomment-1237264051","issue_url":"https://api.github.com/repos/apache/ratis/issues/735","id":1237264051,"node_id":"IC_kwDOBMxbGc5Jvyaz","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-05T16:12:27Z","updated_at":"2022-09-05T16:12:27Z","author_association":"MEMBER","body":"@szetszwo Thanks for the reviews. I've made changes on code, please take a look again~","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237264051/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237558875","html_url":"https://github.com/apache/ratis/pull/736#issuecomment-1237558875","issue_url":"https://api.github.com/repos/apache/ratis/issues/736","id":1237558875,"node_id":"IC_kwDOBMxbGc5Jw6Zb","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-06T01:08:52Z","updated_at":"2022-09-06T01:08:52Z","author_association":"CONTRIBUTOR","body":"@codings-dan , thanks for checking!  Just have updated the code for fixing the test failures.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237558875/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237719826","html_url":"https://github.com/apache/ratis/pull/718#issuecomment-1237719826","issue_url":"https://api.github.com/repos/apache/ratis/issues/718","id":1237719826,"node_id":"IC_kwDOBMxbGc5JxhsS","user":{"login":"captainzmc","id":13825159,"node_id":"MDQ6VXNlcjEzODI1MTU5","avatar_url":"https://avatars.githubusercontent.com/u/13825159?v=4","gravatar_id":"","url":"https://api.github.com/users/captainzmc","html_url":"https://github.com/captainzmc","followers_url":"https://api.github.com/users/captainzmc/followers","following_url":"https://api.github.com/users/captainzmc/following{/other_user}","gists_url":"https://api.github.com/users/captainzmc/gists{/gist_id}","starred_url":"https://api.github.com/users/captainzmc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/captainzmc/subscriptions","organizations_url":"https://api.github.com/users/captainzmc/orgs","repos_url":"https://api.github.com/users/captainzmc/repos","events_url":"https://api.github.com/users/captainzmc/events{/privacy}","received_events_url":"https://api.github.com/users/captainzmc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-06T06:39:04Z","updated_at":"2022-09-06T06:39:04Z","author_association":"MEMBER","body":"> The tests depend on the auto-format behavior need to be updated. As an example, see https://github.com/captainzmc/hadoop-ozone/runs/8182884310?check_suite_focus=true#step:6:2010 \r\n\r\nThanks @szetszwo for the tip, I locally change the behavior of the failed CI during init and startup RaftServer. Now this UT was successful.\r\n I'll check all the failed UT in Ozone, and if it turns out to be OK, we can put RATIS-1677 and RATIS-1694 in the 2.4.0 release.  Just give me some time to make sure.\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237719826/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237728421","html_url":"https://github.com/apache/ratis/pull/735#issuecomment-1237728421","issue_url":"https://api.github.com/repos/apache/ratis/issues/735","id":1237728421,"node_id":"IC_kwDOBMxbGc5Jxjyl","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-06T06:49:46Z","updated_at":"2022-09-06T06:49:46Z","author_association":"MEMBER","body":"@szetszwo Thanks for the reviews again. Since it is already a complex change, I'll separate ReadRequests and ReadIndexQueue in the next PR.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237728421/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237825195","html_url":"https://github.com/apache/ratis/pull/718#issuecomment-1237825195","issue_url":"https://api.github.com/repos/apache/ratis/issues/718","id":1237825195,"node_id":"IC_kwDOBMxbGc5Jx7ar","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-06T08:27:16Z","updated_at":"2022-09-06T08:27:16Z","author_association":"CONTRIBUTOR","body":"@captainzmc , thanks a lot for your efforts on fixing the tests!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237825195/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237831091","html_url":"https://github.com/apache/ratis/pull/627#issuecomment-1237831091","issue_url":"https://api.github.com/repos/apache/ratis/issues/627","id":1237831091,"node_id":"IC_kwDOBMxbGc5Jx82z","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-06T08:32:21Z","updated_at":"2022-09-06T08:32:21Z","author_association":"CONTRIBUTOR","body":"> * A Listener will reject requestVote. (this seems currently missing.)\r\n\r\n@szetszwo This part doesn't seem to do anything since we don't send a requestVote request to the listener, see\r\nhttps://github.com/apache/ratis/blob/117b333114daf37e3d7a31919e49f8fdc0d9e201/ratis-server/src/main/java/org/apache/ratis/server/impl/LeaderElection.java#L279\r\n\r\nThanks again for the guidance.  I add unit test related to leaderElection, see https://github.com/apache/ratis/pull/737 \r\nCombined with RATIS-1640 all unit test tasks have been completed.\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237831091/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237853789","html_url":"https://github.com/apache/ratis/pull/627#issuecomment-1237853789","issue_url":"https://api.github.com/repos/apache/ratis/issues/627","id":1237853789,"node_id":"IC_kwDOBMxbGc5JyCZd","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-06T08:51:20Z","updated_at":"2022-09-06T08:51:20Z","author_association":"CONTRIBUTOR","body":"@codings-dan , thanks a lot for working on the listener feature!\r\n\r\n> ... since we don't send a requestVote request to the listener, ...\r\n\r\nWe should not depend on that.  A patient problem is that a server may be misconfigured or do not have the up-to-date configuration.  Then, it may send a requestVote to listeners, which it thinks they are voting members.  If the listeners replied yes, the server will become a leader.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1237853789/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1240581716","html_url":"https://github.com/apache/ratis/pull/718#issuecomment-1240581716","issue_url":"https://api.github.com/repos/apache/ratis/issues/718","id":1240581716,"node_id":"IC_kwDOBMxbGc5J8cZU","user":{"login":"captainzmc","id":13825159,"node_id":"MDQ6VXNlcjEzODI1MTU5","avatar_url":"https://avatars.githubusercontent.com/u/13825159?v=4","gravatar_id":"","url":"https://api.github.com/users/captainzmc","html_url":"https://github.com/captainzmc","followers_url":"https://api.github.com/users/captainzmc/followers","following_url":"https://api.github.com/users/captainzmc/following{/other_user}","gists_url":"https://api.github.com/users/captainzmc/gists{/gist_id}","starred_url":"https://api.github.com/users/captainzmc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/captainzmc/subscriptions","organizations_url":"https://api.github.com/users/captainzmc/orgs","repos_url":"https://api.github.com/users/captainzmc/repos","events_url":"https://api.github.com/users/captainzmc/events{/privacy}","received_events_url":"https://api.github.com/users/captainzmc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-08T11:20:56Z","updated_at":"2022-09-08T11:20:56Z","author_association":"MEMBER","body":"Hi @szetszwo , recently I have been checking all failed UTs and trying to fix a few. I found that almost every UT related to OM, SCM, and Datanode restart needs to fix.  Init, startup, and restart of these components are all affected. Many of the default behaviors need to be changed.(Other project, such as Alluxio, may also face these issues)\r\n\r\nI wonder if we can avoid these effects by deciding in Ratis whether it need Format or RECOVER. For example, use RECOVER if the directory exists, and use format if the directory does not exist. Of course, this is just a simple idea, there must be some details to pay attention to. And what do you think here?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1240581716/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1240702521","html_url":"https://github.com/apache/ratis/pull/737#issuecomment-1240702521","issue_url":"https://api.github.com/repos/apache/ratis/issues/737","id":1240702521,"node_id":"IC_kwDOBMxbGc5J8545","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-08T13:14:53Z","updated_at":"2022-09-08T13:14:53Z","author_association":"CONTRIBUTOR","body":"Is the environment unstable causing these test errors, these UT passes on my local build.\r\nhttps://github.com/apache/ratis/runs/8247709789?check_suite_focus=true#step:5:631","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1240702521/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1240777453","html_url":"https://github.com/apache/ratis/pull/718#issuecomment-1240777453","issue_url":"https://api.github.com/repos/apache/ratis/issues/718","id":1240777453,"node_id":"IC_kwDOBMxbGc5J9MLt","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-08T14:14:38Z","updated_at":"2022-09-08T14:14:38Z","author_association":"CONTRIBUTOR","body":"> ... For example, use RECOVER if the directory exists, and use format if the directory does not exist. ...\r\n\r\n@captainzmc , that is a nice idea.  Unfortunately, when no directories are found, Ratis cannot decide whether a disk with an storage directory is bad or there are indeed no existing storage directories.\r\n\r\nNote that, prior this change, the RECOVER option worked exactly like that -- if a directory is found, start with it; otherwise, choose a new directory to format.  Then, we discovered the problem described in [HDDS-7103](https://issues.apache.org/jira/browse/HDDS-7103).  When I tried to fix it, my first attempt was [RATIS-1668](https://issues.apache.org/jira/browse/RATIS-1668).  But then I realized that the fixed may lead to data loss described in [the JIRA of this pull request](https://issues.apache.org/jira/browse/RATIS-1677).\r\n\r\nIn HDFS, Namenode requires FORMAT before starting up the first time.  It is the same thing.\r\n\r\nIf it is too much work for the upstream applications (e.g. Ozone, Alluxio, etc), we may exclude this in 2.4.0.\r\n\r\nBTW, since the bug does not exist when there is only one directory, a workaround is NOT to configure multiple directories in `raft.server.storage.dir`.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1240777453/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1241509832","html_url":"https://github.com/apache/ratis/pull/718#issuecomment-1241509832","issue_url":"https://api.github.com/repos/apache/ratis/issues/718","id":1241509832,"node_id":"IC_kwDOBMxbGc5J_-_I","user":{"login":"captainzmc","id":13825159,"node_id":"MDQ6VXNlcjEzODI1MTU5","avatar_url":"https://avatars.githubusercontent.com/u/13825159?v=4","gravatar_id":"","url":"https://api.github.com/users/captainzmc","html_url":"https://github.com/captainzmc","followers_url":"https://api.github.com/users/captainzmc/followers","following_url":"https://api.github.com/users/captainzmc/following{/other_user}","gists_url":"https://api.github.com/users/captainzmc/gists{/gist_id}","starred_url":"https://api.github.com/users/captainzmc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/captainzmc/subscriptions","organizations_url":"https://api.github.com/users/captainzmc/orgs","repos_url":"https://api.github.com/users/captainzmc/repos","events_url":"https://api.github.com/users/captainzmc/events{/privacy}","received_events_url":"https://api.github.com/users/captainzmc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-09T05:19:30Z","updated_at":"2022-09-09T05:19:30Z","author_association":"MEMBER","body":"Thanks @szetszwo for the explanation. Ozone will use Ratis 2.4.0 cut 1.3.0 release branch. Without sufficient testing, new problems may be introduced. I agree that exclude this commit in 2.4.0.  We can support this in Ozone's Master branch so that we will have more time for adaptation and testing. \r\n@codings-dan Any other suggestions here?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1241509832/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1241542851","html_url":"https://github.com/apache/ratis/pull/718#issuecomment-1241542851","issue_url":"https://api.github.com/repos/apache/ratis/issues/718","id":1241542851,"node_id":"IC_kwDOBMxbGc5KAHDD","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-09T06:13:40Z","updated_at":"2022-09-09T06:13:40Z","author_association":"CONTRIBUTOR","body":"Thanks @captainzmc  for helping test Ratis 2.4.0. Since introduction RATIS-1677 and RATIS-1694 will indeed make Ozone, Alluxio and other components change a lot, I also agree to introduce them in the next release. Since Alluxio really wants to introduce [RATIS-1695](https://github.com/apache/ratis/pull/733) in 2.4.0, can we start the next 2.4.0 release(2.4.0-rc2) after it's been merged? Also, do you think there is any other commit we have to introduce in 2.4.0? @szetszwo  ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1241542851/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1241544812","html_url":"https://github.com/apache/ratis/pull/739#issuecomment-1241544812","issue_url":"https://api.github.com/repos/apache/ratis/issues/739","id":1241544812,"node_id":"IC_kwDOBMxbGc5KAHhs","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-09T06:16:10Z","updated_at":"2022-09-09T06:16:10Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for helping review the pull request!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1241544812/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1241621131","html_url":"https://github.com/apache/ratis/pull/740#issuecomment-1241621131","issue_url":"https://api.github.com/repos/apache/ratis/issues/740","id":1241621131,"node_id":"IC_kwDOBMxbGc5KAaKL","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-09T07:43:22Z","updated_at":"2022-09-09T07:43:22Z","author_association":"CONTRIBUTOR","body":"This version has been running in my environment for a long time without a client Timeout exception\r\nHi, @szetszwo Can you look at this PR","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1241621131/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1241698183","html_url":"https://github.com/apache/ratis/pull/737#issuecomment-1241698183","issue_url":"https://api.github.com/repos/apache/ratis/issues/737","id":1241698183,"node_id":"IC_kwDOBMxbGc5KAs-H","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-09T08:56:31Z","updated_at":"2022-09-09T08:56:31Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for helping review the pull request!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1241698183/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1242677672","html_url":"https://github.com/apache/ratis/pull/738#issuecomment-1242677672","issue_url":"https://api.github.com/repos/apache/ratis/issues/738","id":1242677672,"node_id":"IC_kwDOBMxbGc5KEcGo","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-10T09:14:51Z","updated_at":"2022-09-10T09:14:51Z","author_association":"MEMBER","body":"@szetszwo Thanks for providing the framework! I've finished the implementation details. Also, I've added some unit tests to verify follower linearizable read. Please take a look~","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1242677672/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1242762551","html_url":"https://github.com/apache/ratis/pull/738#issuecomment-1242762551","issue_url":"https://api.github.com/repos/apache/ratis/issues/738","id":1242762551,"node_id":"IC_kwDOBMxbGc5KEw03","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-10T16:22:48Z","updated_at":"2022-09-10T16:22:48Z","author_association":"MEMBER","body":"@szetszwo Thanks for the reviews! I've made changes on code. Happy mid-autumn festival~","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1242762551/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1242905071","html_url":"https://github.com/apache/ratis/pull/738#issuecomment-1242905071","issue_url":"https://api.github.com/repos/apache/ratis/issues/738","id":1242905071,"node_id":"IC_kwDOBMxbGc5KFTnv","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-11T07:21:38Z","updated_at":"2022-09-11T07:21:38Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam  , thanks for the update.  Happy mid-Autumn festival!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1242905071/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245130049","html_url":"https://github.com/apache/ratis/pull/740#issuecomment-1245130049","issue_url":"https://api.github.com/repos/apache/ratis/issues/740","id":1245130049,"node_id":"IC_kwDOBMxbGc5KNy1B","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-13T09:17:45Z","updated_at":"2022-09-13T09:17:45Z","author_association":"CONTRIBUTOR","body":"@guohao-rosicky , is this a bug fix?  Or just a refactoring?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245130049/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245148779","html_url":"https://github.com/apache/ratis/pull/740#issuecomment-1245148779","issue_url":"https://api.github.com/repos/apache/ratis/issues/740","id":1245148779,"node_id":"IC_kwDOBMxbGc5KN3Zr","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-13T09:33:22Z","updated_at":"2022-09-13T09:33:22Z","author_association":"CONTRIBUTOR","body":"> @guohao-rosicky , is this a bug fix? Or just a refactoring?\r\n\r\nhi, @szetszwo I changed the description of this PR\r\n1. Bug fix timeout exception.\r\n2. Refactor the code to optimize the logic of replyQueueGracePeriod.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245148779/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245161113","html_url":"https://github.com/apache/ratis/pull/733#issuecomment-1245161113","issue_url":"https://api.github.com/repos/apache/ratis/issues/733","id":1245161113,"node_id":"IC_kwDOBMxbGc5KN6aZ","user":{"login":"jiacheliu3","id":14806853,"node_id":"MDQ6VXNlcjE0ODA2ODUz","avatar_url":"https://avatars.githubusercontent.com/u/14806853?v=4","gravatar_id":"","url":"https://api.github.com/users/jiacheliu3","html_url":"https://github.com/jiacheliu3","followers_url":"https://api.github.com/users/jiacheliu3/followers","following_url":"https://api.github.com/users/jiacheliu3/following{/other_user}","gists_url":"https://api.github.com/users/jiacheliu3/gists{/gist_id}","starred_url":"https://api.github.com/users/jiacheliu3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiacheliu3/subscriptions","organizations_url":"https://api.github.com/users/jiacheliu3/orgs","repos_url":"https://api.github.com/users/jiacheliu3/repos","events_url":"https://api.github.com/users/jiacheliu3/events{/privacy}","received_events_url":"https://api.github.com/users/jiacheliu3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-13T09:43:47Z","updated_at":"2022-09-13T09:43:58Z","author_association":"CONTRIBUTOR","body":"> @jiacheliu3 , thanks for the update! This change becomes big and involves many files. Could you split it into two pull requests?\r\n> \r\n> 1. Add a Daemon.Builder.\r\n> 2. Support UncaughtExceptionHandler.\r\n> \r\n> Some comments inlined but I have not checked all the changes.\r\n\r\n@szetszwo  Sure will do. My biggest concern at this moment is the backward compatibility, could you shed some light on this thread? \r\nhttps://github.com/apache/ratis/pull/733#discussion_r967057138\r\nThx!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245161113/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245218430","html_url":"https://github.com/apache/ratis/pull/740#issuecomment-1245218430","issue_url":"https://api.github.com/repos/apache/ratis/issues/740","id":1245218430,"node_id":"IC_kwDOBMxbGc5KOIZ-","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-13T10:32:41Z","updated_at":"2022-09-13T10:32:41Z","author_association":"CONTRIBUTOR","body":"> 1. Bug fix timeout exception.\r\n> 2. Refactor the code to optimize the logic of replyQueueGracePeriod.\r\n\r\nCould you separate these changes into two JIRAs?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245218430/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245222311","html_url":"https://github.com/apache/ratis/pull/733#issuecomment-1245222311","issue_url":"https://api.github.com/repos/apache/ratis/issues/733","id":1245222311,"node_id":"IC_kwDOBMxbGc5KOJWn","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-13T10:36:39Z","updated_at":"2022-09-13T10:36:39Z","author_association":"CONTRIBUTOR","body":"UncaughtExceptionHandler is optional so that it is backward compatible.  Could you give more details of your concern?  For example, what will break by this change?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245222311/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245551494","html_url":"https://github.com/apache/ratis/pull/743#issuecomment-1245551494","issue_url":"https://api.github.com/repos/apache/ratis/issues/743","id":1245551494,"node_id":"IC_kwDOBMxbGc5KPZuG","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-13T15:06:47Z","updated_at":"2022-09-13T15:06:47Z","author_association":"MEMBER","body":"@szetszwo Thanks for the reviews. I've made changes on code. I'll add a todo for client to retry on NotLeaderExceptions.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245551494/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245643695","html_url":"https://github.com/apache/ratis/pull/744#issuecomment-1245643695","issue_url":"https://api.github.com/repos/apache/ratis/issues/744","id":1245643695,"node_id":"IC_kwDOBMxbGc5KPwOv","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-13T16:17:42Z","updated_at":"2022-09-13T16:17:42Z","author_association":"CONTRIBUTOR","body":"@xichen01 , thanks a lot for reporting the bug and fixing it!  Since the lists won't change frequently, how about add `synchronized` to all the methods and use `ArrayList` instead of `CopyOnWriteArrayList`?\r\n```java\r\ndiff --git a/ratis-metrics/src/main/java/org/apache/ratis/metrics/impl/MetricRegistriesImpl.java b/ratis-metrics/src/main/java/org/apache/ratis/metrics/impl/MetricRegistriesImpl.java\r\nindex cbe8d7bf..a459509d 100644\r\n--- a/ratis-metrics/src/main/java/org/apache/ratis/metrics/impl/MetricRegistriesImpl.java\r\n+++ b/ratis-metrics/src/main/java/org/apache/ratis/metrics/impl/MetricRegistriesImpl.java\r\n@@ -17,12 +17,12 @@\r\n  */\r\n package org.apache.ratis.metrics.impl;\r\n \r\n+import java.util.ArrayList;\r\n import java.util.Collection;\r\n import java.util.Collections;\r\n import java.util.List;\r\n import java.util.Optional;\r\n import java.util.Set;\r\n-import java.util.concurrent.CopyOnWriteArrayList;\r\n import java.util.function.Consumer;\r\n \r\n import org.apache.ratis.metrics.MetricRegistries;\r\n@@ -41,10 +41,36 @@ public class MetricRegistriesImpl extends MetricRegistries {\r\n \r\n   private static final Logger LOG = LoggerFactory.getLogger(MetricRegistriesImpl.class);\r\n \r\n-  private final List<Consumer<RatisMetricRegistry>> reporterRegistrations = new CopyOnWriteArrayList<>();\r\n+  class Reporters {\r\n+    private final List<Consumer<RatisMetricRegistry>> registrations = new ArrayList<>();\r\n+    private final List<Consumer<RatisMetricRegistry>> stoppers = new ArrayList<>();\r\n \r\n-  private final List<Consumer<RatisMetricRegistry>> stopReporters = new CopyOnWriteArrayList<>();\r\n+    synchronized RatisMetricRegistry create(MetricRegistryInfo info) {\r\n+      System.out.println(\"isEmpty? \" + registrations.isEmpty());\r\n+      if (registrations.isEmpty()) {\r\n+        if (LOG.isDebugEnabled()) {\r\n+          LOG.debug(\"First MetricRegistry has been created without registering reporters. \"\r\n+              + \"Hence registering JMX reporter by default.\");\r\n+        }\r\n+        enableJmxReporter();\r\n+      }\r\n+\r\n+      final RatisMetricRegistry registry = factory.create(info);\r\n+      registrations.forEach(reg -> reg.accept(registry));\r\n+      return registry;\r\n+    }\r\n \r\n+    synchronized void add(Consumer<RatisMetricRegistry> registration, Consumer<RatisMetricRegistry> stopper) {\r\n+      registrations.add(registration);\r\n+      stoppers.add(stopper);\r\n+    }\r\n+\r\n+    synchronized void remove(RatisMetricRegistry registry) {\r\n+      stoppers.forEach(reg -> reg.accept(registry));\r\n+    }\r\n+  }\r\n+\r\n+  private final Reporters reporters = new Reporters();\r\n   private final MetricRegistryFactory factory;\r\n \r\n   private final RefCountingMap<MetricRegistryInfo, RatisMetricRegistry> registries;\r\n@@ -60,27 +86,12 @@ public class MetricRegistriesImpl extends MetricRegistries {\r\n \r\n   @Override\r\n   public RatisMetricRegistry create(MetricRegistryInfo info) {\r\n-    return registries.put(info, () -> {\r\n-      if (reporterRegistrations.isEmpty()) {\r\n-        if (LOG.isDebugEnabled()) {\r\n-          LOG.debug(\"First MetricRegistry has been created without registering reporters. \" +\r\n-              \"Hence registering JMX reporter by default.\");\r\n-        }\r\n-        enableJmxReporter();\r\n-      }\r\n-      RatisMetricRegistry registry = factory.create(info);\r\n-      reporterRegistrations.forEach(reg -> reg.accept(registry));\r\n-      return registry;\r\n-    });\r\n+    return registries.put(info, () -> reporters.create(info));\r\n   }\r\n \r\n   @Override\r\n   public boolean remove(MetricRegistryInfo key) {\r\n-    RatisMetricRegistry registry = registries.get(key);\r\n-    if (registry != null) {\r\n-      stopReporters.forEach(reg -> reg.accept(registry));\r\n-    }\r\n-\r\n+    get(key).ifPresent(reporters::remove);\r\n     return registries.remove(key) == null;\r\n   }\r\n \r\n@@ -111,12 +122,12 @@ public class MetricRegistriesImpl extends MetricRegistries {\r\n       LOG.warn(\"New reporters are added after registries were created. Some metrics will be missing from the reporter. \"\r\n           + \"Please add reporter before adding any new registry.\");\r\n     }\r\n-    this.reporterRegistrations.add(reporterRegistration);\r\n-    this.stopReporters.add(stopReporter);\r\n+    reporters.add(reporterRegistration, stopReporter);\r\n   }\r\n \r\n   @Override\r\n   public void enableJmxReporter() {\r\n+    System.out.println(\"enableJmxReporter\");\r\n     addReporterRegistration(\r\n         MetricsReporting.jmxReporter(),\r\n         MetricsReporting.stopJmxReporter());\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245643695/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245646401","html_url":"https://github.com/apache/ratis/pull/744#issuecomment-1245646401","issue_url":"https://api.github.com/repos/apache/ratis/issues/744","id":1245646401,"node_id":"IC_kwDOBMxbGc5KPw5B","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-13T16:19:59Z","updated_at":"2022-09-13T16:19:59Z","author_association":"CONTRIBUTOR","body":"BTW, it probably is another race condition in the original code that it is not synchronized when adding to the lists.\r\nhttps://github.com/apache/ratis/blob/ab9fc535dc6f48ba1d93687fc46022989beb6b0a/ratis-metrics/src/main/java/org/apache/ratis/metrics/impl/MetricRegistriesImpl.java#L114-L115","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245646401/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245654150","html_url":"https://github.com/apache/ratis/pull/741#issuecomment-1245654150","issue_url":"https://api.github.com/repos/apache/ratis/issues/741","id":1245654150,"node_id":"IC_kwDOBMxbGc5KPyyG","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-13T16:26:30Z","updated_at":"2022-09-13T16:26:30Z","author_association":"CONTRIBUTOR","body":"@codings-dan , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1245654150/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1246442293","html_url":"https://github.com/apache/ratis/pull/733#issuecomment-1246442293","issue_url":"https://api.github.com/repos/apache/ratis/issues/733","id":1246442293,"node_id":"IC_kwDOBMxbGc5KSzM1","user":{"login":"jiacheliu3","id":14806853,"node_id":"MDQ6VXNlcjE0ODA2ODUz","avatar_url":"https://avatars.githubusercontent.com/u/14806853?v=4","gravatar_id":"","url":"https://api.github.com/users/jiacheliu3","html_url":"https://github.com/jiacheliu3","followers_url":"https://api.github.com/users/jiacheliu3/followers","following_url":"https://api.github.com/users/jiacheliu3/following{/other_user}","gists_url":"https://api.github.com/users/jiacheliu3/gists{/gist_id}","starred_url":"https://api.github.com/users/jiacheliu3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiacheliu3/subscriptions","organizations_url":"https://api.github.com/users/jiacheliu3/orgs","repos_url":"https://api.github.com/users/jiacheliu3/repos","events_url":"https://api.github.com/users/jiacheliu3/events{/privacy}","received_events_url":"https://api.github.com/users/jiacheliu3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-14T08:46:09Z","updated_at":"2022-09-14T08:46:09Z","author_association":"CONTRIBUTOR","body":"> @jiacheliu3 , thanks for the update! This change becomes big and involves many files. Could you split it into two pull requests?\r\n> \r\n> 1. Add a Daemon.Builder.\r\n> 2. Support UncaughtExceptionHandler.\r\n> \r\n> Some comments inlined but I have not checked all the changes.\r\n\r\nA separate PR https://github.com/apache/ratis/pull/747 is created to segregate the `Daemon.Builder` part of changes. All relevant comments will be addressed in that PR and I'll click `Resolve comment` on this one after that. Sorry about the inconvenience in review, if any.\r\n\r\nThen this PR will be rebased on #747 and only takes care of adding the `UncaughtExceptionHandler`. I will reuse this PR so all comment history is kept intact.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1246442293/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1246443620","html_url":"https://github.com/apache/ratis/pull/747#issuecomment-1246443620","issue_url":"https://api.github.com/repos/apache/ratis/issues/747","id":1246443620,"node_id":"IC_kwDOBMxbGc5KSzhk","user":{"login":"jiacheliu3","id":14806853,"node_id":"MDQ6VXNlcjE0ODA2ODUz","avatar_url":"https://avatars.githubusercontent.com/u/14806853?v=4","gravatar_id":"","url":"https://api.github.com/users/jiacheliu3","html_url":"https://github.com/jiacheliu3","followers_url":"https://api.github.com/users/jiacheliu3/followers","following_url":"https://api.github.com/users/jiacheliu3/following{/other_user}","gists_url":"https://api.github.com/users/jiacheliu3/gists{/gist_id}","starred_url":"https://api.github.com/users/jiacheliu3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiacheliu3/subscriptions","organizations_url":"https://api.github.com/users/jiacheliu3/orgs","repos_url":"https://api.github.com/users/jiacheliu3/repos","events_url":"https://api.github.com/users/jiacheliu3/events{/privacy}","received_events_url":"https://api.github.com/users/jiacheliu3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-14T08:47:21Z","updated_at":"2022-09-14T08:47:21Z","author_association":"CONTRIBUTOR","body":"Link to https://github.com/apache/ratis/pull/733#issuecomment-1246442293\r\nGiven this is just a refactor and prerequisite for #733 , could you take a look and merge if everything looks okay? @codings-dan @szetszwo Thanks!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1246443620/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1246504528","html_url":"https://github.com/apache/ratis/pull/747#issuecomment-1246504528","issue_url":"https://api.github.com/repos/apache/ratis/issues/747","id":1246504528,"node_id":"IC_kwDOBMxbGc5KTCZQ","user":{"login":"jiacheliu3","id":14806853,"node_id":"MDQ6VXNlcjE0ODA2ODUz","avatar_url":"https://avatars.githubusercontent.com/u/14806853?v=4","gravatar_id":"","url":"https://api.github.com/users/jiacheliu3","html_url":"https://github.com/jiacheliu3","followers_url":"https://api.github.com/users/jiacheliu3/followers","following_url":"https://api.github.com/users/jiacheliu3/following{/other_user}","gists_url":"https://api.github.com/users/jiacheliu3/gists{/gist_id}","starred_url":"https://api.github.com/users/jiacheliu3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiacheliu3/subscriptions","organizations_url":"https://api.github.com/users/jiacheliu3/orgs","repos_url":"https://api.github.com/users/jiacheliu3/repos","events_url":"https://api.github.com/users/jiacheliu3/events{/privacy}","received_events_url":"https://api.github.com/users/jiacheliu3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-14T09:40:26Z","updated_at":"2022-09-14T09:40:26Z","author_association":"CONTRIBUTOR","body":"A few tests failed but I can run those successfully on my PC. I suspect they are just flaky, let's see how they run this time:\r\n```\r\nError:  After correcting the problems, you can resume the build with the command\r\nError:    mvn <args> -rf :ratis-test\r\norg.apache.ratis.grpc.TestInstallSnapshotNotificationWithGrpc\r\norg.apache.ratis.grpc.TestRaftServerWithGrpc\r\norg.apache.ratis.grpc.TestLeaderElectionWithGrpc\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1246504528/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1247545192","html_url":"https://github.com/apache/ratis/pull/743#issuecomment-1247545192","issue_url":"https://api.github.com/repos/apache/ratis/issues/743","id":1247545192,"node_id":"IC_kwDOBMxbGc5KXAdo","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-15T03:45:48Z","updated_at":"2022-09-15T03:45:48Z","author_association":"MEMBER","body":"@szetszwo What's the ideal way for read index retry?  Currently, LeaderNotReady / NotLeader / HeartbeatTimeout would cause readIndex fail, I think we should retry when LeaderNotReady & NotLeader. Should we retry indefinitely until reach ReadOnlyTimeout?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1247545192/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1247820319","html_url":"https://github.com/apache/ratis/pull/743#issuecomment-1247820319","issue_url":"https://api.github.com/repos/apache/ratis/issues/743","id":1247820319,"node_id":"IC_kwDOBMxbGc5KYDof","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-15T09:14:31Z","updated_at":"2022-09-15T09:14:31Z","author_association":"CONTRIBUTOR","body":"> ... Should we retry indefinitely until reach ReadOnlyTimeout?\r\n\r\nYes, it sounds good.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1247820319/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1248000331","html_url":"https://github.com/apache/ratis/pull/744#issuecomment-1248000331","issue_url":"https://api.github.com/repos/apache/ratis/issues/744","id":1248000331,"node_id":"IC_kwDOBMxbGc5KYvlL","user":{"login":"xichen01","id":32928346,"node_id":"MDQ6VXNlcjMyOTI4MzQ2","avatar_url":"https://avatars.githubusercontent.com/u/32928346?v=4","gravatar_id":"","url":"https://api.github.com/users/xichen01","html_url":"https://github.com/xichen01","followers_url":"https://api.github.com/users/xichen01/followers","following_url":"https://api.github.com/users/xichen01/following{/other_user}","gists_url":"https://api.github.com/users/xichen01/gists{/gist_id}","starred_url":"https://api.github.com/users/xichen01/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xichen01/subscriptions","organizations_url":"https://api.github.com/users/xichen01/orgs","repos_url":"https://api.github.com/users/xichen01/repos","events_url":"https://api.github.com/users/xichen01/events{/privacy}","received_events_url":"https://api.github.com/users/xichen01/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-15T11:53:43Z","updated_at":"2022-09-15T11:59:00Z","author_association":"CONTRIBUTOR","body":"I use this https://github.com/apache/ratis/pull/744/commits/f0a09fabf1eb488e5849a7dc105e6cc7047ca678 commit code to test Ozone S3, Tested with a multiupload of 100 threads,  GRPC message metric leaks still appear.\r\nThis is the test code\r\n```python3\r\nimport boto3\r\nfrom boto3.s3.transfer import TransferConfig\r\n\r\nMB = 1024 * 1024\r\ns3 = boto3.resource('s3')\r\n\r\nMultipartChunkSize = 5 * MB\r\nMaxConcurrency = 100\r\nAccessKeyID = \"chen\"\r\nSecretAccessKey = \"user_key\"\r\nBucketRegion = \"dummyregion\"\r\nBucketName = \"testbucket\"\r\nEndpointUrl = \"http://localhost:9878\"\r\nLocalFilePath = \"/Users/pony.chen/500M.img\"\r\nObjectKeyName = \"key_from_py1\"\r\n\r\n\r\ndef multipart_upload(client, local_file_path, bucket_name, object_key, multipart_chunksize,\r\n                     max_concurrency):\r\n    config = TransferConfig(multipart_chunksize=multipart_chunksize,\r\n                            max_concurrency=max_concurrency)\r\n    client.upload_file(local_file_path, bucket_name, object_key, Config=config)\r\n\r\n\r\nif __name__ == '__main__':\r\n    client = boto3.client('s3',\r\n                          endpoint_url=EndpointUrl,\r\n                          aws_access_key_id=AccessKeyID,\r\n                          aws_secret_access_key=SecretAccessKey)\r\n    multipart_upload(client, LocalFilePath, BucketName, ObjectKeyName, MultipartChunkSize,\r\n                         MaxConcurrency)\r\n```\r\n\r\nI found that the leaked metrics are all related `XXX_received_executed` metrics\r\nsuch as:\r\n```bash\r\n[chen@hostname /root/ratis]% curl -s http://localhost:9878/jmx | grep client_message_metrics\r\n//....\r\n    \"name\" : \"ratis:name=ratis.client_message_metrics.client-78FD5D54C056->0806d407-c2cb-4628-a986-9d9f4da7393f.client-78FD5D54C056->0806d407-c2cb-4628-a986-9d9f4da7393f_ratis.grpc.RaftClientProtocolService_ordered_OK_received_executed\",\r\n    \"name\" : \"ratis:name=ratis.client_message_metrics.client-F3678E2734CB->3be0191f-50c8-4c86-9d31-b9d5169c42db.client-F3678E2734CB->3be0191f-50c8-4c86-9d31-b9d5169c42db_ratis.grpc.RaftClientProtocolService_unordered_OK_received_executed\",\r\n    \"name\" : \"ratis:name=ratis.client_message_metrics.client-268EA6C4F3CA->0806d407-c2cb-4628-a986-9d9f4da7393f.client-268EA6C4F3CA->0806d407-c2cb-4628-a986-9d9f4da7393f_ratis.grpc.RaftClientProtocolService_ordered_OK_received_executed\",\r\n    \"name\" : \"ratis:name=ratis.client_message_metrics.client-36DFCCCF5CE1->3be0191f-50c8-4c86-9d31-b9d5169c42db.client-36DFCCCF5CE1->3be0191f-50c8-4c86-9d31-b9d5169c42db_ratis.grpc.RaftClientProtocolService_ordered_OK_received_executed\",\r\n[chen@hostname /root/ratis]% \r\n```\r\n\r\nSo I added some `synchronized` at this commit https://github.com/apache/ratis/pull/744/commits/22d646a1b7cbed94def3c901e5a4e66874ea2be1\r\n\r\nafter applying this commit https://github.com/apache/ratis/pull/744/commits/22d646a1b7cbed94def3c901e5a4e66874ea2be1, all metrics leaks are gone \r\nThere are two `synchronized` added here, in my test, if there is no one `synchronized`, the metrics leak will appear\r\n\r\nBut I don't really understand why this can fix the GRPC message metrics leak, @codings-dan @szetszwo any suggestions?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1248000331/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1248012891","html_url":"https://github.com/apache/ratis/pull/744#issuecomment-1248012891","issue_url":"https://api.github.com/repos/apache/ratis/issues/744","id":1248012891,"node_id":"IC_kwDOBMxbGc5KYypb","user":{"login":"xichen01","id":32928346,"node_id":"MDQ6VXNlcjMyOTI4MzQ2","avatar_url":"https://avatars.githubusercontent.com/u/32928346?v=4","gravatar_id":"","url":"https://api.github.com/users/xichen01","html_url":"https://github.com/xichen01","followers_url":"https://api.github.com/users/xichen01/followers","following_url":"https://api.github.com/users/xichen01/following{/other_user}","gists_url":"https://api.github.com/users/xichen01/gists{/gist_id}","starred_url":"https://api.github.com/users/xichen01/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xichen01/subscriptions","organizations_url":"https://api.github.com/users/xichen01/orgs","repos_url":"https://api.github.com/users/xichen01/repos","events_url":"https://api.github.com/users/xichen01/events{/privacy}","received_events_url":"https://api.github.com/users/xichen01/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-15T12:06:43Z","updated_at":"2022-09-15T12:06:43Z","author_association":"CONTRIBUTOR","body":"> @xichen01 , thanks a lot for reporting the bug and fixing it! Since the lists won't change frequently, how about add `synchronized` to all the methods and use `ArrayList` instead of `CopyOnWriteArrayList`?\r\n> \r\n> ```java\r\n> diff --git a/ratis-metrics/src/main/java/org/apache/ratis/metrics/impl/MetricRegistriesImpl.java b/ratis-metrics/src/main/java/org/apache/ratis/metrics/impl/MetricRegistriesImpl.java\r\n> index cbe8d7bf..a459509d 100644\r\n> --- a/ratis-metrics/src/main/java/org/apache/ratis/metrics/impl/MetricRegistriesImpl.java\r\n> +++ b/ratis-metrics/src/main/java/org/apache/ratis/metrics/impl/MetricRegistriesImpl.java\r\n> @@ -17,12 +17,12 @@\r\n>   */\r\n>  package org.apache.ratis.metrics.impl;\r\n>  \r\n> +import java.util.ArrayList;\r\n>  import java.util.Collection;\r\n>  import java.util.Collections;\r\n>  import java.util.List;\r\n>  import java.util.Optional;\r\n>  import java.util.Set;\r\n> -import java.util.concurrent.CopyOnWriteArrayList;\r\n>  import java.util.function.Consumer;\r\n>  \r\n>  import org.apache.ratis.metrics.MetricRegistries;\r\n> @@ -41,10 +41,36 @@ public class MetricRegistriesImpl extends MetricRegistries {\r\n>  \r\n>    private static final Logger LOG = LoggerFactory.getLogger(MetricRegistriesImpl.class);\r\n>  \r\n> -  private final List<Consumer<RatisMetricRegistry>> reporterRegistrations = new CopyOnWriteArrayList<>();\r\n> +  class Reporters {\r\n> +    private final List<Consumer<RatisMetricRegistry>> registrations = new ArrayList<>();\r\n> +    private final List<Consumer<RatisMetricRegistry>> stoppers = new ArrayList<>();\r\n>  \r\n> -  private final List<Consumer<RatisMetricRegistry>> stopReporters = new CopyOnWriteArrayList<>();\r\n> +    synchronized RatisMetricRegistry create(MetricRegistryInfo info) {\r\n> +      System.out.println(\"isEmpty? \" + registrations.isEmpty());\r\n> +      if (registrations.isEmpty()) {\r\n> +        if (LOG.isDebugEnabled()) {\r\n> +          LOG.debug(\"First MetricRegistry has been created without registering reporters. \"\r\n> +              + \"Hence registering JMX reporter by default.\");\r\n> +        }\r\n> +        enableJmxReporter();\r\n> +      }\r\n> +\r\n> +      final RatisMetricRegistry registry = factory.create(info);\r\n> +      registrations.forEach(reg -> reg.accept(registry));\r\n> +      return registry;\r\n> +    }\r\n>  \r\n> +    synchronized void add(Consumer<RatisMetricRegistry> registration, Consumer<RatisMetricRegistry> stopper) {\r\n> +      registrations.add(registration);\r\n> +      stoppers.add(stopper);\r\n> +    }\r\n> +\r\n> +    synchronized void remove(RatisMetricRegistry registry) {\r\n> +      stoppers.forEach(reg -> reg.accept(registry));\r\n> +    }\r\n> +  }\r\n> +\r\n> +  private final Reporters reporters = new Reporters();\r\n>    private final MetricRegistryFactory factory;\r\n>  \r\n>    private final RefCountingMap<MetricRegistryInfo, RatisMetricRegistry> registries;\r\n> @@ -60,27 +86,12 @@ public class MetricRegistriesImpl extends MetricRegistries {\r\n>  \r\n>    @Override\r\n>    public RatisMetricRegistry create(MetricRegistryInfo info) {\r\n> -    return registries.put(info, () -> {\r\n> -      if (reporterRegistrations.isEmpty()) {\r\n> -        if (LOG.isDebugEnabled()) {\r\n> -          LOG.debug(\"First MetricRegistry has been created without registering reporters. \" +\r\n> -              \"Hence registering JMX reporter by default.\");\r\n> -        }\r\n> -        enableJmxReporter();\r\n> -      }\r\n> -      RatisMetricRegistry registry = factory.create(info);\r\n> -      reporterRegistrations.forEach(reg -> reg.accept(registry));\r\n> -      return registry;\r\n> -    });\r\n> +    return registries.put(info, () -> reporters.create(info));\r\n>    }\r\n>  \r\n>    @Override\r\n>    public boolean remove(MetricRegistryInfo key) {\r\n> -    RatisMetricRegistry registry = registries.get(key);\r\n> -    if (registry != null) {\r\n> -      stopReporters.forEach(reg -> reg.accept(registry));\r\n> -    }\r\n> -\r\n> +    get(key).ifPresent(reporters::remove);\r\n>      return registries.remove(key) == null;\r\n>    }\r\n>  \r\n> @@ -111,12 +122,12 @@ public class MetricRegistriesImpl extends MetricRegistries {\r\n>        LOG.warn(\"New reporters are added after registries were created. Some metrics will be missing from the reporter. \"\r\n>            + \"Please add reporter before adding any new registry.\");\r\n>      }\r\n> -    this.reporterRegistrations.add(reporterRegistration);\r\n> -    this.stopReporters.add(stopReporter);\r\n> +    reporters.add(reporterRegistration, stopReporter);\r\n>    }\r\n>  \r\n>    @Override\r\n>    public void enableJmxReporter() {\r\n> +    System.out.println(\"enableJmxReporter\");\r\n>      addReporterRegistration(\r\n>          MetricsReporting.jmxReporter(),\r\n>          MetricsReporting.stopJmxReporter());\r\n> ```\r\n\r\n`ArrayList With synchronized` may be better maintained than `CopyOnWriteArrayList`, I well try this","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1248012891/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1248846323","html_url":"https://github.com/apache/ratis/pull/743#issuecomment-1248846323","issue_url":"https://api.github.com/repos/apache/ratis/issues/743","id":1248846323,"node_id":"IC_kwDOBMxbGc5Kb-Hz","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-16T02:37:35Z","updated_at":"2022-09-16T02:37:35Z","author_association":"MEMBER","body":"@szetszwo I've added the retry for readIndex and its corresponding unit test. Please take a look~","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1248846323/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1248970630","html_url":"https://github.com/apache/ratis/pull/733#issuecomment-1248970630","issue_url":"https://api.github.com/repos/apache/ratis/issues/733","id":1248970630,"node_id":"IC_kwDOBMxbGc5KcceG","user":{"login":"jiacheliu3","id":14806853,"node_id":"MDQ6VXNlcjE0ODA2ODUz","avatar_url":"https://avatars.githubusercontent.com/u/14806853?v=4","gravatar_id":"","url":"https://api.github.com/users/jiacheliu3","html_url":"https://github.com/jiacheliu3","followers_url":"https://api.github.com/users/jiacheliu3/followers","following_url":"https://api.github.com/users/jiacheliu3/following{/other_user}","gists_url":"https://api.github.com/users/jiacheliu3/gists{/gist_id}","starred_url":"https://api.github.com/users/jiacheliu3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiacheliu3/subscriptions","organizations_url":"https://api.github.com/users/jiacheliu3/orgs","repos_url":"https://api.github.com/users/jiacheliu3/repos","events_url":"https://api.github.com/users/jiacheliu3/events{/privacy}","received_events_url":"https://api.github.com/users/jiacheliu3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-16T06:31:34Z","updated_at":"2022-09-16T06:31:34Z","author_association":"CONTRIBUTOR","body":"> @jiacheliu3 , thanks for the update! After checked the Java API in more details, it seems better to pass a `ThreadGroup` instead a `UncaughtExceptionHandler` (sorry that it was a bad idea); see https://issues.apache.org/jira/secure/attachment/13049347/733_review.patch\r\n\r\n@szetszwo Thanks for the suggestion that makes sense to me. One subtle implication I'm not sure about is, if the `ThreadGroup` is left `null` when creating a thread, that thread uses the current thread's `ThreadGroup`: [code](https://docs.oracle.com/javase/8/docs/api/java/lang/Thread.html#Thread-java.lang.ThreadGroup-java.lang.Runnable-)\r\n\r\nI'm not 100% sure what that suggests. Specifically I'm not sure if threads from `TimeoutScheduler.newExecutor()` [code](https://github.com/apache/ratis/blob/8fbe434efad64436e5505f5a03a4ef048a425a0a/ratis-common/src/main/java/org/apache/ratis/util/TimeoutScheduler.java#L89) will implicitly also inherit this `ThreadGroup` and uncaught exceptions there will propagate to the application in the same way. **Is that true** and is that desirable? In other words I imagine there are critical threads whose uncaught exceptions should crash the `RaftServer`, whereas there are unimportant threads whose crashes should be somehow tolerated and just generate a warning at most.\r\n\r\nIn contrast if we specify an `UncaughtExceptionHandler` in the old way, it is possible to distinguish the critical threads from the others. Not saying `setUncaughtExceptionHandler()` doesn't have downsides, just saying it's easier to manually configure.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1248970630/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1250800061","html_url":"https://github.com/apache/ratis/pull/743#issuecomment-1250800061","issue_url":"https://api.github.com/repos/apache/ratis/issues/743","id":1250800061,"node_id":"IC_kwDOBMxbGc5KjbG9","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-19T09:44:57Z","updated_at":"2022-09-19T09:44:57Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , btw, the `OPTION_KEY` is missing the `PREFIX` as shown below.  Could you fix it here?\r\n```java\r\n+++ b/ratis-server-api/src/main/java/org/apache/ratis/server/RaftServerConfigKeys.java\r\n@@ -179,7 +179,7 @@ public interface RaftServerConfigKeys {\r\n       LINEARIZABLE\r\n     }\r\n \r\n-    String OPTION_KEY = \".option\";\r\n+    String OPTION_KEY = PREFIX + \".option\";\r\n     Option OPTION_DEFAULT = Option.DEFAULT;\r\n     static Option option(RaftProperties properties) {\r\n       Option option =  get(properties::getEnum, OPTION_KEY, OPTION_DEFAULT, getDefaultLog());\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1250800061/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1250831344","html_url":"https://github.com/apache/ratis/pull/716#issuecomment-1250831344","issue_url":"https://api.github.com/repos/apache/ratis/issues/716","id":1250831344,"node_id":"IC_kwDOBMxbGc5Kjivw","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-19T10:17:51Z","updated_at":"2022-09-19T10:17:51Z","author_association":"CONTRIBUTOR","body":"@swamirishi , please see https://issues.apache.org/jira/secure/attachment/13049441/716_review.patch for the suggested change.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1250831344/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1251895489","html_url":"https://github.com/apache/ratis/pull/743#issuecomment-1251895489","issue_url":"https://api.github.com/repos/apache/ratis/issues/743","id":1251895489,"node_id":"IC_kwDOBMxbGc5KnmjB","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-20T06:26:31Z","updated_at":"2022-09-20T06:26:31Z","author_association":"MEMBER","body":"@szetszwo Thanks for the reviews! I only kept the change on refactoring and option prefix. I'll fire a new issue for read index retry discussion.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1251895489/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1253082301","html_url":"https://github.com/apache/ratis/pull/733#issuecomment-1253082301","issue_url":"https://api.github.com/repos/apache/ratis/issues/733","id":1253082301,"node_id":"IC_kwDOBMxbGc5KsIS9","user":{"login":"jiacheliu3","id":14806853,"node_id":"MDQ6VXNlcjE0ODA2ODUz","avatar_url":"https://avatars.githubusercontent.com/u/14806853?v=4","gravatar_id":"","url":"https://api.github.com/users/jiacheliu3","html_url":"https://github.com/jiacheliu3","followers_url":"https://api.github.com/users/jiacheliu3/followers","following_url":"https://api.github.com/users/jiacheliu3/following{/other_user}","gists_url":"https://api.github.com/users/jiacheliu3/gists{/gist_id}","starred_url":"https://api.github.com/users/jiacheliu3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiacheliu3/subscriptions","organizations_url":"https://api.github.com/users/jiacheliu3/orgs","repos_url":"https://api.github.com/users/jiacheliu3/repos","events_url":"https://api.github.com/users/jiacheliu3/events{/privacy}","received_events_url":"https://api.github.com/users/jiacheliu3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-21T01:20:17Z","updated_at":"2022-09-21T01:20:17Z","author_association":"CONTRIBUTOR","body":"@szetszwo PTAL if the changes look good to me. I suppose the comments are mostly resolved so it'll be a quick one :) Thanks!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1253082301/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1253266201","html_url":"https://github.com/apache/ratis/pull/733#issuecomment-1253266201","issue_url":"https://api.github.com/repos/apache/ratis/issues/733","id":1253266201,"node_id":"IC_kwDOBMxbGc5Ks1MZ","user":{"login":"jiacheliu3","id":14806853,"node_id":"MDQ6VXNlcjE0ODA2ODUz","avatar_url":"https://avatars.githubusercontent.com/u/14806853?v=4","gravatar_id":"","url":"https://api.github.com/users/jiacheliu3","html_url":"https://github.com/jiacheliu3","followers_url":"https://api.github.com/users/jiacheliu3/followers","following_url":"https://api.github.com/users/jiacheliu3/following{/other_user}","gists_url":"https://api.github.com/users/jiacheliu3/gists{/gist_id}","starred_url":"https://api.github.com/users/jiacheliu3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiacheliu3/subscriptions","organizations_url":"https://api.github.com/users/jiacheliu3/orgs","repos_url":"https://api.github.com/users/jiacheliu3/repos","events_url":"https://api.github.com/users/jiacheliu3/events{/privacy}","received_events_url":"https://api.github.com/users/jiacheliu3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-21T06:33:01Z","updated_at":"2022-09-21T06:33:01Z","author_association":"CONTRIBUTOR","body":"This test passes on my local PC, I believe this one is flaky.\r\n```\r\nError:  Failures: \r\nError:    TestLeaderElectionWithSimulatedRpc>LeaderElectionTests.testEnforceLeader:284->LeaderElectionTests.enforceLeader:298 expected:<s[1]> but was:<s[3]>\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1253266201/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1253276308","html_url":"https://github.com/apache/ratis/pull/733#issuecomment-1253276308","issue_url":"https://api.github.com/repos/apache/ratis/issues/733","id":1253276308,"node_id":"IC_kwDOBMxbGc5Ks3qU","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-21T06:45:57Z","updated_at":"2022-09-21T06:45:57Z","author_association":"CONTRIBUTOR","body":"Let me re-run the failed-job.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1253276308/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1253744101","html_url":"https://github.com/apache/ratis/pull/749#issuecomment-1253744101","issue_url":"https://api.github.com/repos/apache/ratis/issues/749","id":1253744101,"node_id":"IC_kwDOBMxbGc5Kup3l","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-21T13:52:06Z","updated_at":"2022-09-21T13:52:06Z","author_association":"CONTRIBUTOR","body":"@codings-dan , thanks a lot for reviewing this!\r\n\r\n> BTW, should we just remove the ratis-metrics module directly?\r\n\r\nDo you mean we should not rename `ratis-metrics` to `ratis-metrics-api` and keep using the name `ratis-metrics`?  I thought about it -- since the API has changed, it probably will have more confusion if we keep using `ratis-metrics`.  The applications has to update the code anyway.   Using also the module name is not a big deal.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1253744101/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1254780575","html_url":"https://github.com/apache/ratis/pull/749#issuecomment-1254780575","issue_url":"https://api.github.com/repos/apache/ratis/issues/749","id":1254780575,"node_id":"IC_kwDOBMxbGc5Kym6f","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-22T09:41:19Z","updated_at":"2022-09-22T09:41:19Z","author_association":"CONTRIBUTOR","body":"> @codings-dan , thanks a lot for reviewing this!\r\n> \r\n> > BTW, should we just remove the ratis-metrics module directly?\r\n> \r\n> Do you mean we should not rename `ratis-metrics` to `ratis-metrics-api` and keep using the name `ratis-metrics`? I thought about it -- since the API has changed, it probably will have more confusion if we keep using `ratis-metrics`. The applications has to update the code anyway. Using also the module name is not a big deal.\r\n\r\nChange the name is fine. I mean, since the `ratis-metrics` module is empty now, shouldn't we just remove it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1254780575/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1254847336","html_url":"https://github.com/apache/ratis/pull/749#issuecomment-1254847336","issue_url":"https://api.github.com/repos/apache/ratis/issues/749","id":1254847336,"node_id":"IC_kwDOBMxbGc5Ky3No","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-22T10:41:57Z","updated_at":"2022-09-22T10:41:57Z","author_association":"CONTRIBUTOR","body":"> ... since the ratis-metrics module is empty now, shouldn't we just remove it.\r\n\r\nWhen a directory is empty, git will automatically remove it.  For example,   the ratis-metrics module is not in https://github.com/apache/ratis anymore.  For the local copies, we may need to remove it manually since there probably is a `target` directory or some other Ide files.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1254847336/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1255732419","html_url":"https://github.com/apache/ratis/pull/749#issuecomment-1255732419","issue_url":"https://api.github.com/repos/apache/ratis/issues/749","id":1255732419,"node_id":"IC_kwDOBMxbGc5K2PTD","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-23T02:15:41Z","updated_at":"2022-09-23T02:15:41Z","author_association":"CONTRIBUTOR","body":"> When a directory is empty, git will automatically remove it.\r\n\r\nI didn't know that git can be automatically remove empty dir,  thank you for telling me! Now `ratis-metrics` is indeed not in [ratis](https://github.com/apache/ratis)","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1255732419/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1258231915","html_url":"https://github.com/apache/ratis/pull/751#issuecomment-1258231915","issue_url":"https://api.github.com/repos/apache/ratis/issues/751","id":1258231915,"node_id":"IC_kwDOBMxbGc5K_xhr","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-26T15:38:27Z","updated_at":"2022-09-26T15:38:27Z","author_association":"CONTRIBUTOR","body":"@codings-dan , thanks a lot for reviewing this!\r\n\r\n> ... most of the code in the ratis-metrics-default and ratis-metrics-dropwizard3 modules is duplicated, is there some way we can reduce these duplication of code?\r\n\r\nThe code does look the same but the underlying classes are different (dropwizard3 vs the shaded dropwizard4).  Unfortunately, there is no easy way to share the code since we cannot make the classes in dropwizard3 and dropwizard4 implementing a common interface.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1258231915/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1258866987","html_url":"https://github.com/apache/ratis/pull/751#issuecomment-1258866987","issue_url":"https://api.github.com/repos/apache/ratis/issues/751","id":1258866987,"node_id":"IC_kwDOBMxbGc5LCMkr","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-27T02:01:20Z","updated_at":"2022-09-27T02:01:20Z","author_association":"CONTRIBUTOR","body":"\r\n> Unfortunately, there is no easy way to share the code\r\n\r\nThanks for the reply, this is acceptable as long as the function is ok.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1258866987/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1259675985","html_url":"https://github.com/apache/ratis/pull/667#issuecomment-1259675985","issue_url":"https://api.github.com/repos/apache/ratis/issues/667","id":1259675985,"node_id":"IC_kwDOBMxbGc5LFSFR","user":{"login":"captainzmc","id":13825159,"node_id":"MDQ6VXNlcjEzODI1MTU5","avatar_url":"https://avatars.githubusercontent.com/u/13825159?v=4","gravatar_id":"","url":"https://api.github.com/users/captainzmc","html_url":"https://github.com/captainzmc","followers_url":"https://api.github.com/users/captainzmc/followers","following_url":"https://api.github.com/users/captainzmc/following{/other_user}","gists_url":"https://api.github.com/users/captainzmc/gists{/gist_id}","starred_url":"https://api.github.com/users/captainzmc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/captainzmc/subscriptions","organizations_url":"https://api.github.com/users/captainzmc/orgs","repos_url":"https://api.github.com/users/captainzmc/repos","events_url":"https://api.github.com/users/captainzmc/events{/privacy}","received_events_url":"https://api.github.com/users/captainzmc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-27T15:29:14Z","updated_at":"2022-09-27T15:35:17Z","author_association":"MEMBER","body":" Hi @szetszwo, I am currently testing ratis 2.4.0 in Ozone with @codings-dan. We found a possible compatibility issue.\r\nHere we move [statemachine.Initialize()](https://github.com/apache/ratis/pull/667/files#diff-62ccf21408c07a3fcfe1c3e3f7d5cdff22a8efbcdea9eacae3fe14351c404af3L140) from the constructor to Initialize (), which is executed only in the [start()](https://github.com/apache/ratis/pull/667/files#diff-ad3a60b7e17aef8c1e813168c5ebc591dc7259b2427d8870a95a77c010e5692dR308) of RaftServerImpl. \r\nThis changes the execution logic of RaftServer. Such as Ozone testInstallCorruptedCheckpointFailure, original MiniOzoneCluster need to[ create 3 SCM](https://github.com/apache/ozone/blob/master/hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/scm/TestSCMInstallSnapshotWithHA.java#L105) and[ start the 2 of them](https://github.com/apache/ozone/blob/master/hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/scm/TestSCMInstallSnapshotWithHA.java#L106). In the logic of the original 3 SCMStateMachine is running, Now there are only the 2 active is running. This causes the third SCMStateMachine status [check to be incorrect](https://github.com/captainzmc/hadoop-ozone/actions/runs/3098099863/jobs/5015584764#step:6:3147). \r\n\r\nUnless we find a way to execute ServerState‘s [initialize(stateMachine)](https://github.com/apache/ratis/pull/667/files#diff-62ccf21408c07a3fcfe1c3e3f7d5cdff22a8efbcdea9eacae3fe14351c404af3R156) in Ozone UT.  \r\n\r\nIn addition to the SCM UT, we also found this problem in the [OM UT](https://github.com/captainzmc/hadoop-ozone/actions/runs/3098099863/jobs/5015584440#step:5:3105). Of course, this is only a problem of UT, we did not find this problem in the actual use of Ozone.\r\n\r\nAt present, I haven't thought of a good way to fix these UT. Do you have any suggestions?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1259675985/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1261067520","html_url":"https://github.com/apache/ratis/pull/667#issuecomment-1261067520","issue_url":"https://api.github.com/repos/apache/ratis/issues/667","id":1261067520,"node_id":"IC_kwDOBMxbGc5LKl0A","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-28T15:16:33Z","updated_at":"2022-09-28T15:16:33Z","author_association":"CONTRIBUTOR","body":"@captainzmc , thanks for testing ratis 2.4.0.  Let me see how to fix the test failures.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1261067520/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1262400818","html_url":"https://github.com/apache/ratis/pull/667#issuecomment-1262400818","issue_url":"https://api.github.com/repos/apache/ratis/issues/667","id":1262400818,"node_id":"IC_kwDOBMxbGc5LPrUy","user":{"login":"captainzmc","id":13825159,"node_id":"MDQ6VXNlcjEzODI1MTU5","avatar_url":"https://avatars.githubusercontent.com/u/13825159?v=4","gravatar_id":"","url":"https://api.github.com/users/captainzmc","html_url":"https://github.com/captainzmc","followers_url":"https://api.github.com/users/captainzmc/followers","following_url":"https://api.github.com/users/captainzmc/following{/other_user}","gists_url":"https://api.github.com/users/captainzmc/gists{/gist_id}","starred_url":"https://api.github.com/users/captainzmc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/captainzmc/subscriptions","organizations_url":"https://api.github.com/users/captainzmc/orgs","repos_url":"https://api.github.com/users/captainzmc/repos","events_url":"https://api.github.com/users/captainzmc/events{/privacy}","received_events_url":"https://api.github.com/users/captainzmc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-29T14:54:40Z","updated_at":"2022-09-29T14:54:40Z","author_association":"MEMBER","body":"Hi @szetszwo, I wonder if we can achieve this PR in another way. For example, we still call [statemachine.Initialize](https://github.com/apache/ratis/pull/667/files#diff-62ccf21408c07a3fcfe1c3e3f7d5cdff22a8efbcdea9eacae3fe14351c404af3L140) in the ServerState constructor. However, we can release the lock after using it in RaftStorageImpl's Initialize. At the [start](https://github.com/apache/ratis/pull/667/files#diff-ad3a60b7e17aef8c1e813168c5ebc591dc7259b2427d8870a95a77c010e5692dR304)\r\nwe can reacquire the directory lock.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1262400818/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1262462693","html_url":"https://github.com/apache/ratis/pull/667#issuecomment-1262462693","issue_url":"https://api.github.com/repos/apache/ratis/issues/667","id":1262462693,"node_id":"IC_kwDOBMxbGc5LP6bl","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-29T15:40:31Z","updated_at":"2022-09-29T15:40:31Z","author_association":"CONTRIBUTOR","body":"@captainzmc ,  for https://github.com/captainzmc/hadoop-ozone/actions/runs/3098099863/jobs/5015584764#step:6:3146 , we may check LifeCycle state as below.\r\n\r\n```java\r\n+++ b/hadoop-hdds/server-scm/src/main/java/org/apache/hadoop/hdds/scm/ha/SCMStateMachine.java\r\n@@ -353,8 +353,11 @@ public void notifyConfigurationChanged(long term, long index,\r\n \r\n   @Override\r\n   public void pause() {\r\n-    getLifeCycle().transition(LifeCycle.State.PAUSING);\r\n-    getLifeCycle().transition(LifeCycle.State.PAUSED);\r\n+    final LifeCycle lc = getLifeCycle();\r\n+    if (lc.getCurrentState() != LifeCycle.State.NEW) {\r\n+      lc.transition(LifeCycle.State.PAUSING);\r\n+      lc.transition(LifeCycle.State.PAUSED);\r\n+    }\r\n   }\r\n \r\n   @Override\r\n```\r\n\r\nBTW, could you share the Ratis code being tested with Ozone?  I tried to use Ratis branch-2 but got some different errors.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1262462693/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1262465529","html_url":"https://github.com/apache/ratis/pull/667#issuecomment-1262465529","issue_url":"https://api.github.com/repos/apache/ratis/issues/667","id":1262465529,"node_id":"IC_kwDOBMxbGc5LP7H5","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-29T15:42:35Z","updated_at":"2022-09-29T15:42:35Z","author_association":"CONTRIBUTOR","body":"> .. call [statemachine.Initialize](https://github.com/apache/ratis/pull/667/files#diff-62ccf21408c07a3fcfe1c3e3f7d5cdff22a8efbcdea9eacae3fe14351c404af3L140) in the ServerState constructor. ...\r\n\r\nSince it is only a problem in unit tests, let's try fixing the tests instead changing the main code.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1262465529/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1262472832","html_url":"https://github.com/apache/ratis/pull/667#issuecomment-1262472832","issue_url":"https://api.github.com/repos/apache/ratis/issues/667","id":1262472832,"node_id":"IC_kwDOBMxbGc5LP86A","user":{"login":"captainzmc","id":13825159,"node_id":"MDQ6VXNlcjEzODI1MTU5","avatar_url":"https://avatars.githubusercontent.com/u/13825159?v=4","gravatar_id":"","url":"https://api.github.com/users/captainzmc","html_url":"https://github.com/captainzmc","followers_url":"https://api.github.com/users/captainzmc/followers","following_url":"https://api.github.com/users/captainzmc/following{/other_user}","gists_url":"https://api.github.com/users/captainzmc/gists{/gist_id}","starred_url":"https://api.github.com/users/captainzmc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/captainzmc/subscriptions","organizations_url":"https://api.github.com/users/captainzmc/orgs","repos_url":"https://api.github.com/users/captainzmc/repos","events_url":"https://api.github.com/users/captainzmc/events{/privacy}","received_events_url":"https://api.github.com/users/captainzmc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-29T15:48:11Z","updated_at":"2022-09-29T15:48:11Z","author_association":"MEMBER","body":"`could you share the Ratis code being tested with Ozone `\r\n\r\n@szetszwo Sure, I used yaolong's private branch. https://github.com/codings-dan/incubator-ratis/commits/2.4.0-rc2-test","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1262472832/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1262523137","html_url":"https://github.com/apache/ratis/pull/667#issuecomment-1262523137","issue_url":"https://api.github.com/repos/apache/ratis/issues/667","id":1262523137,"node_id":"IC_kwDOBMxbGc5LQJMB","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-29T16:31:16Z","updated_at":"2022-09-29T16:31:16Z","author_association":"CONTRIBUTOR","body":"> ... yaolong's private branch. https://github.com/codings-dan/incubator-ratis/commits/2.4.0-rc2-test\r\n\r\n@captainzmc , Thanks.  Both TestAddRemoveOzoneManager.testBootstrapWithoutConfigUpdate() and TestSCMInstallSnapshotWithHA.testInstallCorruptedCheckpointFailure() can pass with [this fix](https://github.com/apache/ratis/pull/667#issuecomment-1262462693).","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1262523137/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1262530747","html_url":"https://github.com/apache/ratis/pull/667#issuecomment-1262530747","issue_url":"https://api.github.com/repos/apache/ratis/issues/667","id":1262530747,"node_id":"IC_kwDOBMxbGc5LQLC7","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-29T16:37:58Z","updated_at":"2022-09-29T16:38:21Z","author_association":"CONTRIBUTOR","body":"I forgot to mention that we also should update the test as below:\r\n```java\r\n+++ b/hadoop-ozone/integration-test/src/test/java/org/apache/hadoop/ozone/scm/TestSCMInstallSnapshotWithHA.java\r\n@@ -273,7 +274,9 @@ public void testInstallCorruptedCheckpointFailure() throws Exception {\r\n \r\n     Assert.assertTrue(logCapture.getOutput()\r\n         .contains(\"Failed to reload SCM state and instantiate services.\"));\r\n-    Assert.assertTrue(followerSM.getLifeCycleState().isPausingOrPaused());\r\n+    final LifeCycle.State s = followerSM.getLifeCycleState();\r\n+    Assert.assertTrue(\"Unexpected lifeCycle state: \" + s,\r\n+        s == LifeCycle.State.NEW || s.isPausingOrPaused());\r\n \r\n     // Verify correct reloading\r\n     followerSM.setInstallingDBCheckpoint(\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1262530747/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1263065959","html_url":"https://github.com/apache/ratis/pull/667#issuecomment-1263065959","issue_url":"https://api.github.com/repos/apache/ratis/issues/667","id":1263065959,"node_id":"IC_kwDOBMxbGc5LSNtn","user":{"login":"captainzmc","id":13825159,"node_id":"MDQ6VXNlcjEzODI1MTU5","avatar_url":"https://avatars.githubusercontent.com/u/13825159?v=4","gravatar_id":"","url":"https://api.github.com/users/captainzmc","html_url":"https://github.com/captainzmc","followers_url":"https://api.github.com/users/captainzmc/followers","following_url":"https://api.github.com/users/captainzmc/following{/other_user}","gists_url":"https://api.github.com/users/captainzmc/gists{/gist_id}","starred_url":"https://api.github.com/users/captainzmc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/captainzmc/subscriptions","organizations_url":"https://api.github.com/users/captainzmc/orgs","repos_url":"https://api.github.com/users/captainzmc/repos","events_url":"https://api.github.com/users/captainzmc/events{/privacy}","received_events_url":"https://api.github.com/users/captainzmc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-30T03:40:30Z","updated_at":"2022-09-30T03:40:30Z","author_association":"MEMBER","body":"Thanks @szetszwo. If we only change Ozone to solve problems, I think it is acceptable. Let me trigger CI to verify that.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1263065959/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1263228197","html_url":"https://github.com/apache/ratis/pull/667#issuecomment-1263228197","issue_url":"https://api.github.com/repos/apache/ratis/issues/667","id":1263228197,"node_id":"IC_kwDOBMxbGc5LS1Ul","user":{"login":"captainzmc","id":13825159,"node_id":"MDQ6VXNlcjEzODI1MTU5","avatar_url":"https://avatars.githubusercontent.com/u/13825159?v=4","gravatar_id":"","url":"https://api.github.com/users/captainzmc","html_url":"https://github.com/captainzmc","followers_url":"https://api.github.com/users/captainzmc/followers","following_url":"https://api.github.com/users/captainzmc/following{/other_user}","gists_url":"https://api.github.com/users/captainzmc/gists{/gist_id}","starred_url":"https://api.github.com/users/captainzmc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/captainzmc/subscriptions","organizations_url":"https://api.github.com/users/captainzmc/orgs","repos_url":"https://api.github.com/users/captainzmc/repos","events_url":"https://api.github.com/users/captainzmc/events{/privacy}","received_events_url":"https://api.github.com/users/captainzmc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-30T07:47:32Z","updated_at":"2022-09-30T07:47:55Z","author_association":"MEMBER","body":"Thanks @szetszwo. By update some Ozone UT, the CI can be executed successfully. @codings-dan, let's start voting for the release of ratis 2.4.0.\r\nhttps://github.com/captainzmc/hadoop-ozone/actions/runs/3156724171/jobs/5136739190","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1263228197/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1263279417","html_url":"https://github.com/apache/ratis/pull/667#issuecomment-1263279417","issue_url":"https://api.github.com/repos/apache/ratis/issues/667","id":1263279417,"node_id":"IC_kwDOBMxbGc5LTB05","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-30T08:35:01Z","updated_at":"2022-09-30T08:35:01Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo and @captainzmc for helping test and fix compatibility issues related to ratis 2.4.0\r\n\r\n> let's start voting for the release of ratis 2.4.0.\r\n\r\nSure, will do!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1263279417/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1263284435","html_url":"https://github.com/apache/ratis/pull/667#issuecomment-1263284435","issue_url":"https://api.github.com/repos/apache/ratis/issues/667","id":1263284435,"node_id":"IC_kwDOBMxbGc5LTDDT","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-09-30T08:39:50Z","updated_at":"2022-09-30T08:39:50Z","author_association":"CONTRIBUTOR","body":"@captainzmc , @codings-dan , That's great.   Thanks a lot!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1263284435/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1268256327","html_url":"https://github.com/apache/ratis/pull/757#issuecomment-1268256327","issue_url":"https://api.github.com/repos/apache/ratis/issues/757","id":1268256327,"node_id":"IC_kwDOBMxbGc5LmA5H","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-05T10:37:18Z","updated_at":"2022-10-05T10:37:18Z","author_association":"CONTRIBUTOR","body":"The notice is copied from https://github.com/dropwizard/metrics/blob/release/3.2.x/NOTICE","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1268256327/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1268483707","html_url":"https://github.com/apache/ratis/pull/756#issuecomment-1268483707","issue_url":"https://api.github.com/repos/apache/ratis/issues/756","id":1268483707,"node_id":"IC_kwDOBMxbGc5Lm4Z7","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-05T14:05:42Z","updated_at":"2022-10-05T14:05:42Z","author_association":"CONTRIBUTOR","body":"@codings-dan , good catch!  Just have updated it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1268483707/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1271386544","html_url":"https://github.com/apache/ratis/pull/754#issuecomment-1271386544","issue_url":"https://api.github.com/repos/apache/ratis/issues/754","id":1271386544,"node_id":"IC_kwDOBMxbGc5Lx9Gw","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-07T09:59:14Z","updated_at":"2022-10-07T09:59:14Z","author_association":"CONTRIBUTOR","body":"@lokeshj1703 , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1271386544/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1271397354","html_url":"https://github.com/apache/ratis/pull/755#issuecomment-1271397354","issue_url":"https://api.github.com/repos/apache/ratis/issues/755","id":1271397354,"node_id":"IC_kwDOBMxbGc5Lx_vq","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-07T10:09:40Z","updated_at":"2022-10-07T10:09:40Z","author_association":"CONTRIBUTOR","body":"RATIS-1715 just has been merged to the master branch.  Updated this with it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1271397354/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1272478154","html_url":"https://github.com/apache/ratis/pull/755#issuecomment-1272478154","issue_url":"https://api.github.com/repos/apache/ratis/issues/755","id":1272478154,"node_id":"IC_kwDOBMxbGc5L2HnK","user":{"login":"tisonkun","id":18818196,"node_id":"MDQ6VXNlcjE4ODE4MTk2","avatar_url":"https://avatars.githubusercontent.com/u/18818196?v=4","gravatar_id":"","url":"https://api.github.com/users/tisonkun","html_url":"https://github.com/tisonkun","followers_url":"https://api.github.com/users/tisonkun/followers","following_url":"https://api.github.com/users/tisonkun/following{/other_user}","gists_url":"https://api.github.com/users/tisonkun/gists{/gist_id}","starred_url":"https://api.github.com/users/tisonkun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tisonkun/subscriptions","organizations_url":"https://api.github.com/users/tisonkun/orgs","repos_url":"https://api.github.com/users/tisonkun/repos","events_url":"https://api.github.com/users/tisonkun/events{/privacy}","received_events_url":"https://api.github.com/users/tisonkun/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-09T07:35:30Z","updated_at":"2022-10-09T07:35:30Z","author_association":"MEMBER","body":"@szetszwo tests failed on `TestLeaderElectionWithGrpc`. Is it known flaky test?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1272478154/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1272511899","html_url":"https://github.com/apache/ratis/pull/755#issuecomment-1272511899","issue_url":"https://api.github.com/repos/apache/ratis/issues/755","id":1272511899,"node_id":"IC_kwDOBMxbGc5L2P2b","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-09T10:36:03Z","updated_at":"2022-10-09T10:36:03Z","author_association":"CONTRIBUTOR","body":"> ... tests failed on TestLeaderElectionWithGrpc. Is it known flaky test?\r\n\r\nTestLeaderElectionWithGrpc  passed on the second attempt, although there was another test failed.  It may be flaky since it may fail once a while.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1272511899/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1273603591","html_url":"https://github.com/apache/ratis/pull/758#issuecomment-1273603591","issue_url":"https://api.github.com/repos/apache/ratis/issues/758","id":1273603591,"node_id":"IC_kwDOBMxbGc5L6aYH","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-10T17:08:36Z","updated_at":"2022-10-10T17:08:36Z","author_association":"MEMBER","body":"@szetszwo Thanks for the review! Made changes on code.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1273603591/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1273664759","html_url":"https://github.com/apache/ratis/pull/704#issuecomment-1273664759","issue_url":"https://api.github.com/repos/apache/ratis/issues/704","id":1273664759,"node_id":"IC_kwDOBMxbGc5L6pT3","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-10T18:17:21Z","updated_at":"2022-10-10T18:17:21Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for the review.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1273664759/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1274428643","html_url":"https://github.com/apache/ratis/pull/761#issuecomment-1274428643","issue_url":"https://api.github.com/repos/apache/ratis/issues/761","id":1274428643,"node_id":"IC_kwDOBMxbGc5L9jzj","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-11T09:50:41Z","updated_at":"2022-10-11T09:50:41Z","author_association":"CONTRIBUTOR","body":"@myskov , thanks a lot for your contribution!  Could you comment on the JIRA so that it can be assigned to you?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1274428643/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1274455097","html_url":"https://github.com/apache/ratis/pull/761#issuecomment-1274455097","issue_url":"https://api.github.com/repos/apache/ratis/issues/761","id":1274455097,"node_id":"IC_kwDOBMxbGc5L9qQ5","user":{"login":"myskov","id":2060295,"node_id":"MDQ6VXNlcjIwNjAyOTU=","avatar_url":"https://avatars.githubusercontent.com/u/2060295?v=4","gravatar_id":"","url":"https://api.github.com/users/myskov","html_url":"https://github.com/myskov","followers_url":"https://api.github.com/users/myskov/followers","following_url":"https://api.github.com/users/myskov/following{/other_user}","gists_url":"https://api.github.com/users/myskov/gists{/gist_id}","starred_url":"https://api.github.com/users/myskov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/myskov/subscriptions","organizations_url":"https://api.github.com/users/myskov/orgs","repos_url":"https://api.github.com/users/myskov/repos","events_url":"https://api.github.com/users/myskov/events{/privacy}","received_events_url":"https://api.github.com/users/myskov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-11T10:11:39Z","updated_at":"2022-10-11T10:11:39Z","author_association":"CONTRIBUTOR","body":"@szetszwo done. thanks for merging.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1274455097/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1280419652","html_url":"https://github.com/apache/ratis/pull/764#issuecomment-1280419652","issue_url":"https://api.github.com/repos/apache/ratis/issues/764","id":1280419652,"node_id":"IC_kwDOBMxbGc5MUadE","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-17T07:36:05Z","updated_at":"2022-10-17T07:36:05Z","author_association":"CONTRIBUTOR","body":"Thanks @szetszwo for the review.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1280419652/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1280974806","html_url":"https://github.com/apache/ratis/pull/760#issuecomment-1280974806","issue_url":"https://api.github.com/repos/apache/ratis/issues/760","id":1280974806,"node_id":"IC_kwDOBMxbGc5MWh_W","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-17T14:42:05Z","updated_at":"2022-10-17T14:42:05Z","author_association":"CONTRIBUTOR","body":"@codings-dan , thanks a lot for reviewing and merging this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1280974806/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1282266731","html_url":"https://github.com/apache/ratis/pull/748#issuecomment-1282266731","issue_url":"https://api.github.com/repos/apache/ratis/issues/748","id":1282266731,"node_id":"IC_kwDOBMxbGc5MbdZr","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-18T11:55:05Z","updated_at":"2022-10-18T11:55:05Z","author_association":"CONTRIBUTOR","body":"@lokeshj1703 , thanks a lot for reviewing this!\r\n\r\n> ... would we need a time based limit for flush? For example should flush trigger 1 minute after last flush call?\r\n\r\nThis is a good idea but it may make  the code complicated.  Let's add it if we find it useful later on.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1282266731/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1283405830","html_url":"https://github.com/apache/ratis/pull/765#issuecomment-1283405830","issue_url":"https://api.github.com/repos/apache/ratis/issues/765","id":1283405830,"node_id":"IC_kwDOBMxbGc5MfzgG","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-19T04:23:42Z","updated_at":"2022-10-19T04:23:42Z","author_association":"CONTRIBUTOR","body":"> ...  Alibaba's celeborn project write its own clean up logics ...\r\n\r\nThanks for the info!  Good to know.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1283405830/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1283664556","html_url":"https://github.com/apache/ratis/pull/748#issuecomment-1283664556","issue_url":"https://api.github.com/repos/apache/ratis/issues/748","id":1283664556,"node_id":"IC_kwDOBMxbGc5Mgyqs","user":{"login":"lokeshj1703","id":9255455,"node_id":"MDQ6VXNlcjkyNTU0NTU=","avatar_url":"https://avatars.githubusercontent.com/u/9255455?v=4","gravatar_id":"","url":"https://api.github.com/users/lokeshj1703","html_url":"https://github.com/lokeshj1703","followers_url":"https://api.github.com/users/lokeshj1703/followers","following_url":"https://api.github.com/users/lokeshj1703/following{/other_user}","gists_url":"https://api.github.com/users/lokeshj1703/gists{/gist_id}","starred_url":"https://api.github.com/users/lokeshj1703/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lokeshj1703/subscriptions","organizations_url":"https://api.github.com/users/lokeshj1703/orgs","repos_url":"https://api.github.com/users/lokeshj1703/repos","events_url":"https://api.github.com/users/lokeshj1703/events{/privacy}","received_events_url":"https://api.github.com/users/lokeshj1703/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-19T08:58:17Z","updated_at":"2022-10-19T08:58:17Z","author_association":"CONTRIBUTOR","body":"Sounds good @szetszwo.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1283664556/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1283676206","html_url":"https://github.com/apache/ratis/pull/748#issuecomment-1283676206","issue_url":"https://api.github.com/repos/apache/ratis/issues/748","id":1283676206,"node_id":"IC_kwDOBMxbGc5Mg1gu","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-19T09:07:26Z","updated_at":"2022-10-19T09:07:26Z","author_association":"CONTRIBUTOR","body":"@lokeshj1703 , thanks again for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1283676206/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1288060031","html_url":"https://github.com/apache/ratis/pull/767#issuecomment-1288060031","issue_url":"https://api.github.com/repos/apache/ratis/issues/767","id":1288060031,"node_id":"IC_kwDOBMxbGc5Mxjx_","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-23T09:12:31Z","updated_at":"2022-10-23T09:12:31Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam, is there a JIRA for this?  If not, could you file one?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1288060031/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1288081415","html_url":"https://github.com/apache/ratis/pull/767#issuecomment-1288081415","issue_url":"https://api.github.com/repos/apache/ratis/issues/767","id":1288081415,"node_id":"IC_kwDOBMxbGc5MxpAH","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-23T10:31:10Z","updated_at":"2022-10-23T10:31:10Z","author_association":"MEMBER","body":"@szetszwo Just created one, see https://issues.apache.org/jira/browse/RATIS-1727. Thanks!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1288081415/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1288137455","html_url":"https://github.com/apache/ratis/pull/767#issuecomment-1288137455","issue_url":"https://api.github.com/repos/apache/ratis/issues/767","id":1288137455,"node_id":"IC_kwDOBMxbGc5Mx2rv","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-23T15:25:29Z","updated_at":"2022-10-23T15:25:29Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , thanks!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1288137455/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1289153152","html_url":"https://github.com/apache/ratis/pull/765#issuecomment-1289153152","issue_url":"https://api.github.com/repos/apache/ratis/issues/765","id":1289153152,"node_id":"IC_kwDOBMxbGc5M1uqA","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-24T14:47:18Z","updated_at":"2022-10-24T14:47:18Z","author_association":"CONTRIBUTOR","body":"@codings-dan , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1289153152/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1290229438","html_url":"https://github.com/apache/ratis/pull/710#issuecomment-1290229438","issue_url":"https://api.github.com/repos/apache/ratis/issues/710","id":1290229438,"node_id":"IC_kwDOBMxbGc5M51a-","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-25T09:06:38Z","updated_at":"2022-10-25T09:06:38Z","author_association":"CONTRIBUTOR","body":"@szetszwo Since RATIS-1677 has fixed the issue, let's close this pull request and reopen it anytime if there is an update.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1290229438/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1290236405","html_url":"https://github.com/apache/ratis/pull/710#issuecomment-1290236405","issue_url":"https://api.github.com/repos/apache/ratis/issues/710","id":1290236405,"node_id":"IC_kwDOBMxbGc5M53H1","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-25T09:11:45Z","updated_at":"2022-10-25T09:11:45Z","author_association":"CONTRIBUTOR","body":"@codings-dan , sure.  Thanks for checking this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1290236405/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1291803455","html_url":"https://github.com/apache/ratis/pull/770#issuecomment-1291803455","issue_url":"https://api.github.com/repos/apache/ratis/issues/770","id":1291803455,"node_id":"IC_kwDOBMxbGc5M_1s_","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-26T10:09:27Z","updated_at":"2022-10-26T10:09:27Z","author_association":"MEMBER","body":"@szetszwo @codings-dan Could you please help me review this reference? Please correct me if there are any misunderstandings or incorrect expressions, thanks a lot!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1291803455/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1295113872","html_url":"https://github.com/apache/ratis/pull/770#issuecomment-1295113872","issue_url":"https://api.github.com/repos/apache/ratis/issues/770","id":1295113872,"node_id":"IC_kwDOBMxbGc5NMd6Q","user":{"login":"SzyWilliam","id":48054931,"node_id":"MDQ6VXNlcjQ4MDU0OTMx","avatar_url":"https://avatars.githubusercontent.com/u/48054931?v=4","gravatar_id":"","url":"https://api.github.com/users/SzyWilliam","html_url":"https://github.com/SzyWilliam","followers_url":"https://api.github.com/users/SzyWilliam/followers","following_url":"https://api.github.com/users/SzyWilliam/following{/other_user}","gists_url":"https://api.github.com/users/SzyWilliam/gists{/gist_id}","starred_url":"https://api.github.com/users/SzyWilliam/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SzyWilliam/subscriptions","organizations_url":"https://api.github.com/users/SzyWilliam/orgs","repos_url":"https://api.github.com/users/SzyWilliam/repos","events_url":"https://api.github.com/users/SzyWilliam/events{/privacy}","received_events_url":"https://api.github.com/users/SzyWilliam/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-28T15:07:04Z","updated_at":"2022-10-28T15:07:04Z","author_association":"MEMBER","body":"@szetszwo Thanks for the review! Learned `raft.server.sleep.deviation.threshold` from your patch🌹.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1295113872/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1297262856","html_url":"https://github.com/apache/ratis/pull/771#issuecomment-1297262856","issue_url":"https://api.github.com/repos/apache/ratis/issues/771","id":1297262856,"node_id":"IC_kwDOBMxbGc5NUqkI","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-31T15:28:20Z","updated_at":"2022-10-31T15:28:20Z","author_association":"CONTRIBUTOR","body":"@SzyWilliam , TestReadOnlyRequestWithGrpc just have failed in the last build, although it is not related to this change; see https://github.com/apache/ratis/actions/runs/3346622398/jobs/5564386148#step:5:604 .  Could you take a look?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1297262856/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1297739475","html_url":"https://github.com/apache/ratis/pull/772#issuecomment-1297739475","issue_url":"https://api.github.com/repos/apache/ratis/issues/772","id":1297739475,"node_id":"IC_kwDOBMxbGc5NWe7T","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-10-31T22:01:28Z","updated_at":"2022-10-31T22:01:28Z","author_association":"CONTRIBUTOR","body":"Thanks @cnauroth for the patch, @szetszwo for the review.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1297739475/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]