[{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1439600920","html_url":"https://github.com/apache/brpc/issues/1662#issuecomment-1439600920","issue_url":"https://api.github.com/repos/apache/brpc/issues/1662","id":1439600920,"node_id":"IC_kwDOBhmkcs5VzpEY","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-22T08:18:41Z","updated_at":"2023-02-22T08:18:41Z","author_association":"CONTRIBUTOR","body":"> \r\n\r\n\r\n\r\n> > \r\n> \r\n> 哦哦是这样，现在的实现逻辑是，先停止当前connfd接受新的请求，然后处理存量回包，再进行connfd的迁移\r\n\r\n这个方案使用效果怎么样？超时出现得频繁吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1439600920/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1439803228","html_url":"https://github.com/apache/brpc/issues/1662#issuecomment-1439803228","issue_url":"https://api.github.com/repos/apache/brpc/issues/1662","id":1439803228,"node_id":"IC_kwDOBhmkcs5V0adc","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-22T10:46:32Z","updated_at":"2023-02-22T10:46:32Z","author_association":"CONTRIBUTOR","body":"> > \r\n> \r\n> > > \r\n> > \r\n> > \r\n> > 哦哦是这样，现在的实现逻辑是，先停止当前connfd接受新的请求，然后处理存量回包，再进行connfd的迁移\r\n> \r\n> 这个方案使用效果怎么样？超时出现得频繁吗？\r\n\r\n当前的内部业务都是通过守护进程的方式启动的，而在热升级的时候会和守护进程产生冲突，目前还没有业务在线上使用这种能力，所以没有什么真实数据。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1439803228/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1439883604","html_url":"https://github.com/apache/brpc/issues/2120#issuecomment-1439883604","issue_url":"https://api.github.com/repos/apache/brpc/issues/2120","id":1439883604,"node_id":"IC_kwDOBhmkcs5V0uFU","user":{"login":"WingsGo","id":22497357,"node_id":"MDQ6VXNlcjIyNDk3MzU3","avatar_url":"https://avatars.githubusercontent.com/u/22497357?v=4","gravatar_id":"","url":"https://api.github.com/users/WingsGo","html_url":"https://github.com/WingsGo","followers_url":"https://api.github.com/users/WingsGo/followers","following_url":"https://api.github.com/users/WingsGo/following{/other_user}","gists_url":"https://api.github.com/users/WingsGo/gists{/gist_id}","starred_url":"https://api.github.com/users/WingsGo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WingsGo/subscriptions","organizations_url":"https://api.github.com/users/WingsGo/orgs","repos_url":"https://api.github.com/users/WingsGo/repos","events_url":"https://api.github.com/users/WingsGo/events{/privacy}","received_events_url":"https://api.github.com/users/WingsGo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-22T11:44:50Z","updated_at":"2023-02-22T11:45:14Z","author_association":"NONE","body":"> > @chenzhangyi @wwbmmm 我理解对于baidu_rpc协议来说，meta和payload的length是在协议头就已经确定好了的，这样可以修改append_from_file_descriptor，在从socket的fd读取数据的时候，将allocate内存的方法提供给用户，然后通过append_user_data就可以在recever端减少这一次拷贝了吧？我可以提一个PR来实现一下，不知道这样的方案是否可行?\r\n> \r\n> 可以考虑给iobuf加个reserve_continuous_buffer(int size)方法，然后由协议来控制预留buffer的大小\r\n\r\n那也就是说可以这么实现？在协议层直接预先分配内存，后续从fd读取的数据可以保证不会超过这个大小，这样就能保证block的数量始终保持为1，然后在读取数据的时候通过fetch方法来避免拷贝，我理解这样的改动是最小的？\r\n\r\nelse if (source->length() < sizeof(header_buf) + body_size) {\r\n        // 预先分配size大小的内存，并作为一个block放入source中，然后将source->length()的内容拷贝进这个block里\r\n        source-> reserve_continuous_buffer(sizeof(header_buf) + body_size)\r\n        return MakeParseError(PARSE_ERROR_NOT_ENOUGH_DATA);\r\n}\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1439883604/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1440086114","html_url":"https://github.com/apache/brpc/issues/2120#issuecomment-1440086114","issue_url":"https://api.github.com/repos/apache/brpc/issues/2120","id":1440086114,"node_id":"IC_kwDOBhmkcs5V1fhi","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-22T14:14:18Z","updated_at":"2023-02-22T14:14:18Z","author_association":"CONTRIBUTOR","body":"\r\n> \r\n> 那也就是说可以这么实现？在协议层直接预先分配内存，后续从fd读取的数据可以保证不会超过这个大小，这样就能保证block的数量始终保持为1，然后在读取数据的时候通过fetch方法来避免拷贝，我理解这样的改动是最小的？\r\n> \r\n> else if (source->length() < sizeof(header_buf) + body_size) { // 预先分配size大小的内存，并作为一个block放入source中，然后将source->length()的内容拷贝进这个block里 source-> reserve_continuous_buffer(sizeof(header_buf) + body_size) return MakeParseError(PARSE_ERROR_NOT_ENOUGH_DATA); }\r\n\r\n可以这样试试","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1440086114/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1440101993","html_url":"https://github.com/apache/brpc/pull/2129#issuecomment-1440101993","issue_url":"https://api.github.com/repos/apache/brpc/issues/2129","id":1440101993,"node_id":"IC_kwDOBhmkcs5V1jZp","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-22T14:19:55Z","updated_at":"2023-02-22T14:19:55Z","author_association":"CONTRIBUTOR","body":"> > CI是不是还有问题？我本地跑是可以过的，但是CI跑了几次，都是core在这个地方。\r\n> > > [ RUN      ] NamingServiceTest.consul_with_backup_file\r\n> > > temp_file_e34bq7\r\n> > > Segmentation fault (core dumped)\r\n> > > corefile=./core.brpc_naming_ser.12853 prog=brpc_naming_service_unittest\r\n> > > ./run_tests.sh: 42: gdb: not found\r\n> \r\n> 看上去似乎和改动有关\r\n\r\n是的，现在好了。git commit不太整洁，合的时候需要square一下。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1440101993/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1442694212","html_url":"https://github.com/apache/brpc/issues/2134#issuecomment-1442694212","issue_url":"https://api.github.com/repos/apache/brpc/issues/2134","id":1442694212,"node_id":"IC_kwDOBhmkcs5V_cRE","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-24T02:07:17Z","updated_at":"2023-02-24T02:07:17Z","author_association":"CONTRIBUTOR","body":"> 提供全局的注册函数用于注册拦截器。\r\n> \r\n> ```c++\r\n> int RegisterInterceptor(Interceptor* interceptor);\r\n> ```\r\n\r\n这个是不是可以放在ServerOptions中？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1442694212/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1442750503","html_url":"https://github.com/apache/brpc/issues/2025#issuecomment-1442750503","issue_url":"https://api.github.com/repos/apache/brpc/issues/2025","id":1442750503,"node_id":"IC_kwDOBhmkcs5V_qAn","user":{"login":"SillyBoyenjoy","id":49710570,"node_id":"MDQ6VXNlcjQ5NzEwNTcw","avatar_url":"https://avatars.githubusercontent.com/u/49710570?v=4","gravatar_id":"","url":"https://api.github.com/users/SillyBoyenjoy","html_url":"https://github.com/SillyBoyenjoy","followers_url":"https://api.github.com/users/SillyBoyenjoy/followers","following_url":"https://api.github.com/users/SillyBoyenjoy/following{/other_user}","gists_url":"https://api.github.com/users/SillyBoyenjoy/gists{/gist_id}","starred_url":"https://api.github.com/users/SillyBoyenjoy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SillyBoyenjoy/subscriptions","organizations_url":"https://api.github.com/users/SillyBoyenjoy/orgs","repos_url":"https://api.github.com/users/SillyBoyenjoy/repos","events_url":"https://api.github.com/users/SillyBoyenjoy/events{/privacy}","received_events_url":"https://api.github.com/users/SillyBoyenjoy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-24T03:20:31Z","updated_at":"2023-02-24T03:20:31Z","author_association":"NONE","body":"class_name.cpp的问题修复了，后面level db的动态库加载也出现了coredump，采用静态库编译解决了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1442750503/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1442764392","html_url":"https://github.com/apache/brpc/issues/2134#issuecomment-1442764392","issue_url":"https://api.github.com/repos/apache/brpc/issues/2134","id":1442764392,"node_id":"IC_kwDOBhmkcs5V_tZo","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-24T03:40:06Z","updated_at":"2023-02-24T03:40:06Z","author_association":"CONTRIBUTOR","body":"> > 提供全局的注册函数用于注册拦截器。\r\n> > ```c++\r\n> > int RegisterInterceptor(Interceptor* interceptor);\r\n> > ```\r\n> \r\n> 这个是不是可以放在ServerOptions中？\r\n\r\nServerOptions加个std::vector<Interceptor>，是不是不太好呀？\r\n或者ServerOptions加的是Interceptor*，只允许注册一个拦截器。用户的所有策略都在这个拦截器里实现？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1442764392/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1442821129","html_url":"https://github.com/apache/brpc/issues/2134#issuecomment-1442821129","issue_url":"https://api.github.com/repos/apache/brpc/issues/2134","id":1442821129,"node_id":"IC_kwDOBhmkcs5V_7QJ","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-24T05:12:58Z","updated_at":"2023-02-24T05:12:58Z","author_association":"CONTRIBUTOR","body":"一个拦截器应该能满足需求了吧？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1442821129/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1442830669","html_url":"https://github.com/apache/brpc/issues/2134#issuecomment-1442830669","issue_url":"https://api.github.com/repos/apache/brpc/issues/2134","id":1442830669,"node_id":"IC_kwDOBhmkcs5V_9lN","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-24T05:29:46Z","updated_at":"2023-02-24T05:29:46Z","author_association":"CONTRIBUTOR","body":"> > 提供全局的注册函数用于注册拦截器。\r\n> > ```c++\r\n> > int RegisterInterceptor(Interceptor* interceptor);\r\n> > ```\r\n> \r\n> 这个是不是可以放在ServerOptions中？\r\n\r\n赞同，我也理解一个拦截器能满足需求，而且拦截器是服务维度的，不同服务可以实现不同的拦截器。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1442830669/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1442864402","html_url":"https://github.com/apache/brpc/issues/2070#issuecomment-1442864402","issue_url":"https://api.github.com/repos/apache/brpc/issues/2070","id":1442864402,"node_id":"IC_kwDOBhmkcs5WAF0S","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-24T06:25:13Z","updated_at":"2023-02-24T06:25:13Z","author_association":"MEMBER","body":"After some googling, it seems not all OS uses `/bin/bash` as the default bash location. e.g. FreeBSD use `/usr/local/bin/bash`?\r\n\r\nAnd, if I understand right, there's no standard POSIX location for `env`, either.\r\n\r\n`#!/usr/bin/env bash` may be more portable, but that doesn't mean `#!/bin/bash` is wrong.\r\n\r\n\r\nhttps://stackoverflow.com/questions/10376206/what-is-the-preferred-bash-shebang\r\nhttps://stackoverflow.com/questions/21612980/why-is-usr-bin-env-bash-superior-to-bin-bash\r\nhttps://en.wikipedia.org/w/index.php?title=Shebang_(Unix)&oldid=878552871#Portability","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1442864402/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1442932079","html_url":"https://github.com/apache/brpc/issues/2070#issuecomment-1442932079","issue_url":"https://api.github.com/repos/apache/brpc/issues/2070","id":1442932079,"node_id":"IC_kwDOBhmkcs5WAWVv","user":{"login":"yurivict","id":271906,"node_id":"MDQ6VXNlcjI3MTkwNg==","avatar_url":"https://avatars.githubusercontent.com/u/271906?v=4","gravatar_id":"","url":"https://api.github.com/users/yurivict","html_url":"https://github.com/yurivict","followers_url":"https://api.github.com/users/yurivict/followers","following_url":"https://api.github.com/users/yurivict/following{/other_user}","gists_url":"https://api.github.com/users/yurivict/gists{/gist_id}","starred_url":"https://api.github.com/users/yurivict/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yurivict/subscriptions","organizations_url":"https://api.github.com/users/yurivict/orgs","repos_url":"https://api.github.com/users/yurivict/repos","events_url":"https://api.github.com/users/yurivict/events{/privacy}","received_events_url":"https://api.github.com/users/yurivict/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-24T07:28:03Z","updated_at":"2023-02-24T07:28:03Z","author_association":"NONE","body":"```#!/usr/bin/env bash``` works on all systems.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1442932079/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1443181662","html_url":"https://github.com/apache/brpc/issues/2134#issuecomment-1443181662","issue_url":"https://api.github.com/repos/apache/brpc/issues/2134","id":1443181662,"node_id":"IC_kwDOBhmkcs5WBTRe","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-24T08:48:28Z","updated_at":"2023-02-24T08:48:28Z","author_association":"CONTRIBUTOR","body":"好的，那提供一个服务维度的拦截器。用户可以通过ServerOptions设置。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1443181662/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1444990005","html_url":"https://github.com/apache/brpc/pull/2136#issuecomment-1444990005","issue_url":"https://api.github.com/repos/apache/brpc/issues/2136","id":1444990005,"node_id":"IC_kwDOBhmkcs5WIMw1","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-25T04:39:44Z","updated_at":"2023-02-25T04:40:05Z","author_association":"CONTRIBUTOR","body":"https://github.com/apache/brpc/blob/d6df0f156ad6bd8ec6722a3c3c15691607bb62e7/src/brpc/details/usercode_backup_pool.cpp#L103-L106\r\n\r\nCan you also add name to UserCodeBackupPool?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1444990005/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1445045408","html_url":"https://github.com/apache/brpc/pull/2136#issuecomment-1445045408","issue_url":"https://api.github.com/repos/apache/brpc/issues/2136","id":1445045408,"node_id":"IC_kwDOBhmkcs5WIaSg","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-25T10:00:56Z","updated_at":"2023-02-25T10:01:33Z","author_association":"CONTRIBUTOR","body":"\r\n\r\n\r\n> https://github.com/apache/brpc/blob/d6df0f156ad6bd8ec6722a3c3c15691607bb62e7/src/brpc/details/usercode_backup_pool.cpp#L103-L106\r\n> \r\n> Can you also add name to UserCodeBackupPool?\r\n\r\ndone","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1445045408/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1445313862","html_url":"https://github.com/apache/brpc/issues/1092#issuecomment-1445313862","issue_url":"https://api.github.com/repos/apache/brpc/issues/1092","id":1445313862,"node_id":"IC_kwDOBhmkcs5WJb1G","user":{"login":"moyucd","id":45071562,"node_id":"MDQ6VXNlcjQ1MDcxNTYy","avatar_url":"https://avatars.githubusercontent.com/u/45071562?v=4","gravatar_id":"","url":"https://api.github.com/users/moyucd","html_url":"https://github.com/moyucd","followers_url":"https://api.github.com/users/moyucd/followers","following_url":"https://api.github.com/users/moyucd/following{/other_user}","gists_url":"https://api.github.com/users/moyucd/gists{/gist_id}","starred_url":"https://api.github.com/users/moyucd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/moyucd/subscriptions","organizations_url":"https://api.github.com/users/moyucd/orgs","repos_url":"https://api.github.com/users/moyucd/repos","events_url":"https://api.github.com/users/moyucd/events{/privacy}","received_events_url":"https://api.github.com/users/moyucd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-26T09:59:49Z","updated_at":"2023-02-26T09:59:49Z","author_association":"NONE","body":"有相同问题","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1445313862/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1445553234","html_url":"https://github.com/apache/brpc/pull/2136#issuecomment-1445553234","issue_url":"https://api.github.com/repos/apache/brpc/issues/2136","id":1445553234,"node_id":"IC_kwDOBhmkcs5WKWRS","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-27T01:51:21Z","updated_at":"2023-02-27T01:51:21Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1445553234/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1445833210","html_url":"https://github.com/apache/brpc/issues/1211#issuecomment-1445833210","issue_url":"https://api.github.com/repos/apache/brpc/issues/1211","id":1445833210,"node_id":"IC_kwDOBhmkcs5WLan6","user":{"login":"17336","id":74393844,"node_id":"MDQ6VXNlcjc0MzkzODQ0","avatar_url":"https://avatars.githubusercontent.com/u/74393844?v=4","gravatar_id":"","url":"https://api.github.com/users/17336","html_url":"https://github.com/17336","followers_url":"https://api.github.com/users/17336/followers","following_url":"https://api.github.com/users/17336/following{/other_user}","gists_url":"https://api.github.com/users/17336/gists{/gist_id}","starred_url":"https://api.github.com/users/17336/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/17336/subscriptions","organizations_url":"https://api.github.com/users/17336/orgs","repos_url":"https://api.github.com/users/17336/repos","events_url":"https://api.github.com/users/17336/events{/privacy}","received_events_url":"https://api.github.com/users/17336/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-27T07:26:20Z","updated_at":"2023-02-27T07:26:48Z","author_association":"NONE","body":"> 这个是因为已经链接了glibc里面的pthread_mutex_lock实现，导致brpc里面的hook没有生效\r\n\r\n我看pthread_mutex_lock是在src/bthread/mutex.cpp里实现的，是不是只要链接这个就可以了 @chenzhangyi ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1445833210/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1445892824","html_url":"https://github.com/apache/brpc/issues/2134#issuecomment-1445892824","issue_url":"https://api.github.com/repos/apache/brpc/issues/2134","id":1445892824,"node_id":"IC_kwDOBhmkcs5WLpLY","user":{"login":"guodongxiaren","id":5945107,"node_id":"MDQ6VXNlcjU5NDUxMDc=","avatar_url":"https://avatars.githubusercontent.com/u/5945107?v=4","gravatar_id":"","url":"https://api.github.com/users/guodongxiaren","html_url":"https://github.com/guodongxiaren","followers_url":"https://api.github.com/users/guodongxiaren/followers","following_url":"https://api.github.com/users/guodongxiaren/following{/other_user}","gists_url":"https://api.github.com/users/guodongxiaren/gists{/gist_id}","starred_url":"https://api.github.com/users/guodongxiaren/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guodongxiaren/subscriptions","organizations_url":"https://api.github.com/users/guodongxiaren/orgs","repos_url":"https://api.github.com/users/guodongxiaren/repos","events_url":"https://api.github.com/users/guodongxiaren/events{/privacy}","received_events_url":"https://api.github.com/users/guodongxiaren/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-27T08:18:18Z","updated_at":"2023-02-27T08:18:18Z","author_association":"MEMBER","body":"回包的时候也加个拦截器吧","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1445892824/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1446110649","html_url":"https://github.com/apache/brpc/issues/1092#issuecomment-1446110649","issue_url":"https://api.github.com/repos/apache/brpc/issues/1092","id":1446110649,"node_id":"IC_kwDOBhmkcs5WMeW5","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-27T10:56:03Z","updated_at":"2023-02-27T10:56:16Z","author_association":"CONTRIBUTOR","body":"可能 stream 的另一端已经 close 了，导致写入失败。\r\nhttps://github.com/apache/brpc/blob/d6df0f156ad6bd8ec6722a3c3c15691607bb62e7/src/brpc/stream.cpp#L295-L297","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1446110649/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1446117608","html_url":"https://github.com/apache/brpc/issues/1211#issuecomment-1446117608","issue_url":"https://api.github.com/repos/apache/brpc/issues/1211","id":1446117608,"node_id":"IC_kwDOBhmkcs5WMgDo","user":{"login":"17336","id":74393844,"node_id":"MDQ6VXNlcjc0MzkzODQ0","avatar_url":"https://avatars.githubusercontent.com/u/74393844?v=4","gravatar_id":"","url":"https://api.github.com/users/17336","html_url":"https://github.com/17336","followers_url":"https://api.github.com/users/17336/followers","following_url":"https://api.github.com/users/17336/following{/other_user}","gists_url":"https://api.github.com/users/17336/gists{/gist_id}","starred_url":"https://api.github.com/users/17336/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/17336/subscriptions","organizations_url":"https://api.github.com/users/17336/orgs","repos_url":"https://api.github.com/users/17336/repos","events_url":"https://api.github.com/users/17336/events{/privacy}","received_events_url":"https://api.github.com/users/17336/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-27T11:00:18Z","updated_at":"2023-02-27T11:00:18Z","author_association":"NONE","body":"> > 没收到呢\r\n> \r\n> [mougaidong@gmail.com](mailto:mougaidong@gmail.com) 发的这个邮箱。邮件主题是 微信号\r\n\r\n@gydong 你最后是怎么解决的啊，我遇到了和你相同的问题，heap和contention都无法使用。我是单独把brpc里内置服务的代码抽出来用的，有这个问题。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1446117608/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447440317","html_url":"https://github.com/apache/brpc/pull/2137#issuecomment-1447440317","issue_url":"https://api.github.com/repos/apache/brpc/issues/2137","id":1447440317,"node_id":"IC_kwDOBhmkcs5WRi-9","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-28T01:47:09Z","updated_at":"2023-02-28T01:47:09Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447440317/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447794047","html_url":"https://github.com/apache/brpc/issues/2134#issuecomment-1447794047","issue_url":"https://api.github.com/repos/apache/brpc/issues/2134","id":1447794047,"node_id":"IC_kwDOBhmkcs5WS5V_","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-28T08:50:42Z","updated_at":"2023-02-28T08:50:42Z","author_association":"CONTRIBUTOR","body":"> 回包的时候也加个拦截器吧\r\n\r\n@guodongxiaren #1433 这个pr是不是已经实现这个特性了？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447794047/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447806642","html_url":"https://github.com/apache/brpc/issues/2138#issuecomment-1447806642","issue_url":"https://api.github.com/repos/apache/brpc/issues/2138","id":1447806642,"node_id":"IC_kwDOBhmkcs5WS8ay","user":{"login":"17336","id":74393844,"node_id":"MDQ6VXNlcjc0MzkzODQ0","avatar_url":"https://avatars.githubusercontent.com/u/74393844?v=4","gravatar_id":"","url":"https://api.github.com/users/17336","html_url":"https://github.com/17336","followers_url":"https://api.github.com/users/17336/followers","following_url":"https://api.github.com/users/17336/following{/other_user}","gists_url":"https://api.github.com/users/17336/gists{/gist_id}","starred_url":"https://api.github.com/users/17336/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/17336/subscriptions","organizations_url":"https://api.github.com/users/17336/orgs","repos_url":"https://api.github.com/users/17336/repos","events_url":"https://api.github.com/users/17336/events{/privacy}","received_events_url":"https://api.github.com/users/17336/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-28T08:59:38Z","updated_at":"2023-02-28T08:59:38Z","author_association":"NONE","body":"我是将内置服务的代码插入到.a链接的，发现在本地跑heap和contention profiler可以正常使用，但是在服务器上跑就会出现上面的问题","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447806642/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447846575","html_url":"https://github.com/apache/brpc/issues/2000#issuecomment-1447846575","issue_url":"https://api.github.com/repos/apache/brpc/issues/2000","id":1447846575,"node_id":"IC_kwDOBhmkcs5WTGKv","user":{"login":"MrGuin","id":26199910,"node_id":"MDQ6VXNlcjI2MTk5OTEw","avatar_url":"https://avatars.githubusercontent.com/u/26199910?v=4","gravatar_id":"","url":"https://api.github.com/users/MrGuin","html_url":"https://github.com/MrGuin","followers_url":"https://api.github.com/users/MrGuin/followers","following_url":"https://api.github.com/users/MrGuin/following{/other_user}","gists_url":"https://api.github.com/users/MrGuin/gists{/gist_id}","starred_url":"https://api.github.com/users/MrGuin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MrGuin/subscriptions","organizations_url":"https://api.github.com/users/MrGuin/orgs","repos_url":"https://api.github.com/users/MrGuin/repos","events_url":"https://api.github.com/users/MrGuin/events{/privacy}","received_events_url":"https://api.github.com/users/MrGuin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-28T09:27:22Z","updated_at":"2023-02-28T09:27:22Z","author_association":"CONTRIBUTOR","body":"@wwbmmm 你好，我这里同样是 redis-benchmark 对比 brpc 与 redis 的性能，观察到 redis 的 qps 能达到 9w，brpc-redis 只能达到 6w。brpc server 不是可以利用多线程的吗，为何会比不过 redis 呢？是因为 brpc-redis server 的实现是只有一个 bthread 在做 epoll_wait 吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447846575/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447879799","html_url":"https://github.com/apache/brpc/issues/2000#issuecomment-1447879799","issue_url":"https://api.github.com/repos/apache/brpc/issues/2000","id":1447879799,"node_id":"IC_kwDOBhmkcs5WTOR3","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-28T09:51:56Z","updated_at":"2023-02-28T09:51:56Z","author_association":"CONTRIBUTOR","body":"> @wwbmmm 你好，我这里同样是 redis-benchmark 对比 brpc 与 redis 的性能，观察到 redis 的 qps 能达到 9w，brpc-redis 只能达到 6w。brpc server 不是可以利用多线程的吗，为何会比不过 redis 呢？是因为 brpc-redis server 的实现是只有一个 bthread 在做 epoll_wait 吗？\r\n\r\n你是单个连接下的benchmark吗？单个连接下按照redis协议的要求是需要串行处理的，这种情况下多线程并没有优势，你试试用多个连接并行压测看看","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447879799/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447897677","html_url":"https://github.com/apache/brpc/issues/2000#issuecomment-1447897677","issue_url":"https://api.github.com/repos/apache/brpc/issues/2000","id":1447897677,"node_id":"IC_kwDOBhmkcs5WTSpN","user":{"login":"MrGuin","id":26199910,"node_id":"MDQ6VXNlcjI2MTk5OTEw","avatar_url":"https://avatars.githubusercontent.com/u/26199910?v=4","gravatar_id":"","url":"https://api.github.com/users/MrGuin","html_url":"https://github.com/MrGuin","followers_url":"https://api.github.com/users/MrGuin/followers","following_url":"https://api.github.com/users/MrGuin/following{/other_user}","gists_url":"https://api.github.com/users/MrGuin/gists{/gist_id}","starred_url":"https://api.github.com/users/MrGuin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MrGuin/subscriptions","organizations_url":"https://api.github.com/users/MrGuin/orgs","repos_url":"https://api.github.com/users/MrGuin/repos","events_url":"https://api.github.com/users/MrGuin/events{/privacy}","received_events_url":"https://api.github.com/users/MrGuin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-28T10:04:00Z","updated_at":"2023-02-28T10:04:00Z","author_association":"CONTRIBUTOR","body":"> > @wwbmmm 你好，我这里同样是 redis-benchmark 对比 brpc 与 redis 的性能，观察到 redis 的 qps 能达到 9w，brpc-redis 只能达到 6w。brpc server 不是可以利用多线程的吗，为何会比不过 redis 呢？是因为 brpc-redis server 的实现是只有一个 bthread 在做 epoll_wait 吗？\r\n> \r\n> 你是单个连接下的benchmark吗？单个连接下按照redis协议的要求是需要串行处理的，这种情况下多线程并没有优势，你试试用多个连接并行压测看看\r\n\r\n是多个连接，ec2 上测的 qps 最高只有 6w 左右，增加连接数 qps 也上不去，只有 latency 上去了。。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447897677/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447918551","html_url":"https://github.com/apache/brpc/issues/2000#issuecomment-1447918551","issue_url":"https://api.github.com/repos/apache/brpc/issues/2000","id":1447918551,"node_id":"IC_kwDOBhmkcs5WTXvX","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-28T10:17:37Z","updated_at":"2023-02-28T10:17:37Z","author_association":"CONTRIBUTOR","body":"> \r\n> 是多个连接，ec2 上测的 qps 最高只有 6w 左右，增加连接数 qps 也上不去，只有 latency 上去了。。\r\n\r\n可以看下bvar监控，bthread_worker_usage是否已经达到上限？process_cpu_usage和bthread_worker_usage的比值是多少？\r\n另外brpc-redis server的处理逻辑是什么，是直接从内存里访问key进行响应，还是有其它逻辑？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447918551/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447929723","html_url":"https://github.com/apache/brpc/issues/2000#issuecomment-1447929723","issue_url":"https://api.github.com/repos/apache/brpc/issues/2000","id":1447929723,"node_id":"IC_kwDOBhmkcs5WTad7","user":{"login":"MrGuin","id":26199910,"node_id":"MDQ6VXNlcjI2MTk5OTEw","avatar_url":"https://avatars.githubusercontent.com/u/26199910?v=4","gravatar_id":"","url":"https://api.github.com/users/MrGuin","html_url":"https://github.com/MrGuin","followers_url":"https://api.github.com/users/MrGuin/followers","following_url":"https://api.github.com/users/MrGuin/following{/other_user}","gists_url":"https://api.github.com/users/MrGuin/gists{/gist_id}","starred_url":"https://api.github.com/users/MrGuin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MrGuin/subscriptions","organizations_url":"https://api.github.com/users/MrGuin/orgs","repos_url":"https://api.github.com/users/MrGuin/repos","events_url":"https://api.github.com/users/MrGuin/events{/privacy}","received_events_url":"https://api.github.com/users/MrGuin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-28T10:25:02Z","updated_at":"2023-02-28T10:25:02Z","author_association":"CONTRIBUTOR","body":"> > 是多个连接，ec2 上测的 qps 最高只有 6w 左右，增加连接数 qps 也上不去，只有 latency 上去了。。\r\n> \r\n> 可以看下bvar监控，bthread_worker_usage是否已经达到上限？process_cpu_usage和bthread_worker_usage的比值是多少？ 另外brpc-redis server的处理逻辑是什么，是直接从内存里访问key进行响应，还是有其它逻辑？\r\n\r\n好的我看一下。brpc redis server 里边没有任何逻辑，单纯的 no-op，使用的是 brpc 的 redis example，并且把 commandhandler 里的内存操作都注掉了，因为想测试的是 brpc 的性能上限。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447929723/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447976629","html_url":"https://github.com/apache/brpc/issues/2118#issuecomment-1447976629","issue_url":"https://api.github.com/repos/apache/brpc/issues/2118","id":1447976629,"node_id":"IC_kwDOBhmkcs5WTl61","user":{"login":"jialei-jialei","id":13553842,"node_id":"MDQ6VXNlcjEzNTUzODQy","avatar_url":"https://avatars.githubusercontent.com/u/13553842?v=4","gravatar_id":"","url":"https://api.github.com/users/jialei-jialei","html_url":"https://github.com/jialei-jialei","followers_url":"https://api.github.com/users/jialei-jialei/followers","following_url":"https://api.github.com/users/jialei-jialei/following{/other_user}","gists_url":"https://api.github.com/users/jialei-jialei/gists{/gist_id}","starred_url":"https://api.github.com/users/jialei-jialei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jialei-jialei/subscriptions","organizations_url":"https://api.github.com/users/jialei-jialei/orgs","repos_url":"https://api.github.com/users/jialei-jialei/repos","events_url":"https://api.github.com/users/jialei-jialei/events{/privacy}","received_events_url":"https://api.github.com/users/jialei-jialei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-28T10:59:33Z","updated_at":"2023-02-28T10:59:33Z","author_association":"NONE","body":"明白，多谢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1447976629/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1448483752","html_url":"https://github.com/apache/brpc/issues/2138#issuecomment-1448483752","issue_url":"https://api.github.com/repos/apache/brpc/issues/2138","id":1448483752,"node_id":"IC_kwDOBhmkcs5WVhuo","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-28T16:29:35Z","updated_at":"2023-02-28T16:29:35Z","author_association":"CONTRIBUTOR","body":"服务器上的版本是链接了tcmalloc吗","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1448483752/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1448497764","html_url":"https://github.com/apache/brpc/issues/2140#issuecomment-1448497764","issue_url":"https://api.github.com/repos/apache/brpc/issues/2140","id":1448497764,"node_id":"IC_kwDOBhmkcs5WVlJk","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-02-28T16:39:03Z","updated_at":"2023-02-28T16:39:03Z","author_association":"CONTRIBUTOR","body":"@risemeup1 这个问题已经在 #1783 修复了， 可以升级下brpc到1.3.0及之后的版本，或者打一下相应的patch","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1448497764/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449261364","html_url":"https://github.com/apache/brpc/issues/2138#issuecomment-1449261364","issue_url":"https://api.github.com/repos/apache/brpc/issues/2138","id":1449261364,"node_id":"IC_kwDOBhmkcs5WYfk0","user":{"login":"17336","id":74393844,"node_id":"MDQ6VXNlcjc0MzkzODQ0","avatar_url":"https://avatars.githubusercontent.com/u/74393844?v=4","gravatar_id":"","url":"https://api.github.com/users/17336","html_url":"https://github.com/17336","followers_url":"https://api.github.com/users/17336/followers","following_url":"https://api.github.com/users/17336/following{/other_user}","gists_url":"https://api.github.com/users/17336/gists{/gist_id}","starred_url":"https://api.github.com/users/17336/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/17336/subscriptions","organizations_url":"https://api.github.com/users/17336/orgs","repos_url":"https://api.github.com/users/17336/repos","events_url":"https://api.github.com/users/17336/events{/privacy}","received_events_url":"https://api.github.com/users/17336/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-01T03:01:58Z","updated_at":"2023-03-01T03:02:08Z","author_association":"NONE","body":"> 服务器上的版本是链接了tcmalloc吗\r\n\r\n@lorinlee 本地和服务器跑的是同一套代码，都链接了libtcmalloc_and_profiler.so.4，然后我发现还另外链接了libjemalloc.so.2这个库，是因为这个的原因吗（但是本地也链接了这个，却能看heap和contention）\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449261364/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449275726","html_url":"https://github.com/apache/brpc/issues/2138#issuecomment-1449275726","issue_url":"https://api.github.com/repos/apache/brpc/issues/2138","id":1449275726,"node_id":"IC_kwDOBhmkcs5WYjFO","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-01T03:22:38Z","updated_at":"2023-03-01T03:22:38Z","author_association":"CONTRIBUTOR","body":"@17336 可以去掉jemalloc的链接尝试下看看","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449275726/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449509178","html_url":"https://github.com/apache/brpc/issues/2138#issuecomment-1449509178","issue_url":"https://api.github.com/repos/apache/brpc/issues/2138","id":1449509178,"node_id":"IC_kwDOBhmkcs5WZcE6","user":{"login":"17336","id":74393844,"node_id":"MDQ6VXNlcjc0MzkzODQ0","avatar_url":"https://avatars.githubusercontent.com/u/74393844?v=4","gravatar_id":"","url":"https://api.github.com/users/17336","html_url":"https://github.com/17336","followers_url":"https://api.github.com/users/17336/followers","following_url":"https://api.github.com/users/17336/following{/other_user}","gists_url":"https://api.github.com/users/17336/gists{/gist_id}","starred_url":"https://api.github.com/users/17336/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/17336/subscriptions","organizations_url":"https://api.github.com/users/17336/orgs","repos_url":"https://api.github.com/users/17336/repos","events_url":"https://api.github.com/users/17336/events{/privacy}","received_events_url":"https://api.github.com/users/17336/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-01T07:56:54Z","updated_at":"2023-03-01T07:56:54Z","author_association":"NONE","body":"> @17336 可以去掉jemalloc的链接尝试下看看\r\n\r\n去掉了也还是不行","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449509178/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449512676","html_url":"https://github.com/apache/brpc/issues/2138#issuecomment-1449512676","issue_url":"https://api.github.com/repos/apache/brpc/issues/2138","id":1449512676,"node_id":"IC_kwDOBhmkcs5WZc7k","user":{"login":"17336","id":74393844,"node_id":"MDQ6VXNlcjc0MzkzODQ0","avatar_url":"https://avatars.githubusercontent.com/u/74393844?v=4","gravatar_id":"","url":"https://api.github.com/users/17336","html_url":"https://github.com/17336","followers_url":"https://api.github.com/users/17336/followers","following_url":"https://api.github.com/users/17336/following{/other_user}","gists_url":"https://api.github.com/users/17336/gists{/gist_id}","starred_url":"https://api.github.com/users/17336/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/17336/subscriptions","organizations_url":"https://api.github.com/users/17336/orgs","repos_url":"https://api.github.com/users/17336/repos","events_url":"https://api.github.com/users/17336/events{/privacy}","received_events_url":"https://api.github.com/users/17336/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-01T07:59:08Z","updated_at":"2023-03-01T07:59:08Z","author_association":"NONE","body":"> @17336 可以去掉jemalloc的链接尝试下看看\r\n\r\n可以问下出现Argument \"MSWin32\" isn't numeric这个的原因嘛，感觉出在这个地方挺奇怪的","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449512676/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449819320","html_url":"https://github.com/apache/brpc/issues/1436#issuecomment-1449819320","issue_url":"https://api.github.com/repos/apache/brpc/issues/1436","id":1449819320,"node_id":"IC_kwDOBhmkcs5Wany4","user":{"login":"17336","id":74393844,"node_id":"MDQ6VXNlcjc0MzkzODQ0","avatar_url":"https://avatars.githubusercontent.com/u/74393844?v=4","gravatar_id":"","url":"https://api.github.com/users/17336","html_url":"https://github.com/17336","followers_url":"https://api.github.com/users/17336/followers","following_url":"https://api.github.com/users/17336/following{/other_user}","gists_url":"https://api.github.com/users/17336/gists{/gist_id}","starred_url":"https://api.github.com/users/17336/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/17336/subscriptions","organizations_url":"https://api.github.com/users/17336/orgs","repos_url":"https://api.github.com/users/17336/repos","events_url":"https://api.github.com/users/17336/events{/privacy}","received_events_url":"https://api.github.com/users/17336/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-01T10:30:43Z","updated_at":"2023-03-01T10:30:43Z","author_association":"NONE","body":"> cpu profilter和tcmalloc是gperftools里的两个库，可以单独链接cpu profiler，可能要改下链接参数之类的。heap profiler是不支持jemalloc的，需要用jemalloc自带的工具\r\n\r\n想问下目前还是这样是吧","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449819320/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449824106","html_url":"https://github.com/apache/brpc/issues/1962#issuecomment-1449824106","issue_url":"https://api.github.com/repos/apache/brpc/issues/1962","id":1449824106,"node_id":"IC_kwDOBhmkcs5Wao9q","user":{"login":"17336","id":74393844,"node_id":"MDQ6VXNlcjc0MzkzODQ0","avatar_url":"https://avatars.githubusercontent.com/u/74393844?v=4","gravatar_id":"","url":"https://api.github.com/users/17336","html_url":"https://github.com/17336","followers_url":"https://api.github.com/users/17336/followers","following_url":"https://api.github.com/users/17336/following{/other_user}","gists_url":"https://api.github.com/users/17336/gists{/gist_id}","starred_url":"https://api.github.com/users/17336/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/17336/subscriptions","organizations_url":"https://api.github.com/users/17336/orgs","repos_url":"https://api.github.com/users/17336/repos","events_url":"https://api.github.com/users/17336/events{/privacy}","received_events_url":"https://api.github.com/users/17336/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-01T10:33:02Z","updated_at":"2023-03-01T10:33:02Z","author_association":"NONE","body":"@wwbmmm 请问目前还是不支持的嘛","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449824106/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449836972","html_url":"https://github.com/apache/brpc/issues/2138#issuecomment-1449836972","issue_url":"https://api.github.com/repos/apache/brpc/issues/2138","id":1449836972,"node_id":"IC_kwDOBhmkcs5WasGs","user":{"login":"17336","id":74393844,"node_id":"MDQ6VXNlcjc0MzkzODQ0","avatar_url":"https://avatars.githubusercontent.com/u/74393844?v=4","gravatar_id":"","url":"https://api.github.com/users/17336","html_url":"https://github.com/17336","followers_url":"https://api.github.com/users/17336/followers","following_url":"https://api.github.com/users/17336/following{/other_user}","gists_url":"https://api.github.com/users/17336/gists{/gist_id}","starred_url":"https://api.github.com/users/17336/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/17336/subscriptions","organizations_url":"https://api.github.com/users/17336/orgs","repos_url":"https://api.github.com/users/17336/repos","events_url":"https://api.github.com/users/17336/events{/privacy}","received_events_url":"https://api.github.com/users/17336/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-01T10:38:12Z","updated_at":"2023-03-01T10:38:12Z","author_association":"NONE","body":"> @17336 可以去掉jemalloc的链接尝试下看看\r\n\r\n@lorinlee 请问目前只有cpu profiler能用jemalloc，heap不能用对吧？因为tcmalloc有瓶颈，线上服务只考虑用jemalloc","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449836972/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449846562","html_url":"https://github.com/apache/brpc/issues/2138#issuecomment-1449846562","issue_url":"https://api.github.com/repos/apache/brpc/issues/2138","id":1449846562,"node_id":"IC_kwDOBhmkcs5Wauci","user":{"login":"17336","id":74393844,"node_id":"MDQ6VXNlcjc0MzkzODQ0","avatar_url":"https://avatars.githubusercontent.com/u/74393844?v=4","gravatar_id":"","url":"https://api.github.com/users/17336","html_url":"https://github.com/17336","followers_url":"https://api.github.com/users/17336/followers","following_url":"https://api.github.com/users/17336/following{/other_user}","gists_url":"https://api.github.com/users/17336/gists{/gist_id}","starred_url":"https://api.github.com/users/17336/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/17336/subscriptions","organizations_url":"https://api.github.com/users/17336/orgs","repos_url":"https://api.github.com/users/17336/repos","events_url":"https://api.github.com/users/17336/events{/privacy}","received_events_url":"https://api.github.com/users/17336/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-01T10:42:55Z","updated_at":"2023-03-01T10:42:55Z","author_association":"NONE","body":"heap profiler有可能支持jemalloc吗","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1449846562/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1451160372","html_url":"https://github.com/apache/brpc/pull/2141#issuecomment-1451160372","issue_url":"https://api.github.com/repos/apache/brpc/issues/2141","id":1451160372,"node_id":"IC_kwDOBhmkcs5WfvM0","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-02T02:00:37Z","updated_at":"2023-03-02T02:00:37Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1451160372/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1451162208","html_url":"https://github.com/apache/brpc/pull/2137#issuecomment-1451162208","issue_url":"https://api.github.com/repos/apache/brpc/issues/2137","id":1451162208,"node_id":"IC_kwDOBhmkcs5Wfvpg","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-02T02:02:49Z","updated_at":"2023-03-02T02:02:49Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1451162208/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1451241148","html_url":"https://github.com/apache/brpc/pull/2141#issuecomment-1451241148","issue_url":"https://api.github.com/repos/apache/brpc/issues/2141","id":1451241148,"node_id":"IC_kwDOBhmkcs5WgC68","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-02T03:24:03Z","updated_at":"2023-03-02T03:24:03Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1451241148/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1451424967","html_url":"https://github.com/apache/brpc/issues/2138#issuecomment-1451424967","issue_url":"https://api.github.com/repos/apache/brpc/issues/2138","id":1451424967,"node_id":"IC_kwDOBhmkcs5WgvzH","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-02T07:38:51Z","updated_at":"2023-03-02T07:38:51Z","author_association":"CONTRIBUTOR","body":"@17336 jemalloc可以用jemalloc自带的jeprof的","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1451424967/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452174731","html_url":"https://github.com/apache/brpc/issues/2143#issuecomment-1452174731","issue_url":"https://api.github.com/repos/apache/brpc/issues/2143","id":1452174731,"node_id":"IC_kwDOBhmkcs5Wjm2L","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-02T16:38:38Z","updated_at":"2023-03-02T16:38:38Z","author_association":"CONTRIBUTOR","body":"@jamesge 早前提了重构naming service的issue #210","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452174731/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452178926","html_url":"https://github.com/apache/brpc/issues/2143#issuecomment-1452178926","issue_url":"https://api.github.com/repos/apache/brpc/issues/2143","id":1452178926,"node_id":"IC_kwDOBhmkcs5Wjn3u","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-02T16:41:38Z","updated_at":"2023-03-02T16:41:38Z","author_association":"CONTRIBUTOR","body":"@wwbmmm 麻烦帮忙评估一下方案，或者有没有其他解决思路？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452178926/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452891808","html_url":"https://github.com/apache/brpc/issues/1543#issuecomment-1452891808","issue_url":"https://api.github.com/repos/apache/brpc/issues/1543","id":1452891808,"node_id":"IC_kwDOBhmkcs5WmV6g","user":{"login":"17336","id":74393844,"node_id":"MDQ6VXNlcjc0MzkzODQ0","avatar_url":"https://avatars.githubusercontent.com/u/74393844?v=4","gravatar_id":"","url":"https://api.github.com/users/17336","html_url":"https://github.com/17336","followers_url":"https://api.github.com/users/17336/followers","following_url":"https://api.github.com/users/17336/following{/other_user}","gists_url":"https://api.github.com/users/17336/gists{/gist_id}","starred_url":"https://api.github.com/users/17336/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/17336/subscriptions","organizations_url":"https://api.github.com/users/17336/orgs","repos_url":"https://api.github.com/users/17336/repos","events_url":"https://api.github.com/users/17336/events{/privacy}","received_events_url":"https://api.github.com/users/17336/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T03:06:52Z","updated_at":"2023-03-03T03:06:52Z","author_association":"NONE","body":"> **Describe the bug (描述bug)**![image] 以echo_c++ server为例，使用方法： tools/pprof host:ip/pprof/profile --pdf > output.pdf 获取到的pdf如图所示 [ech0.pdf](https://github.com/apache/incubator-brpc/files/7083462/ech0.pdf)\r\n> \r\n> **To Reproduce (复现方法)**\r\n> \r\n> **Expected behavior (期望行为)**\r\n> \r\n> **Versions (各种版本)** OS: debian 9.13\r\n> \r\n> Compiler: bazel 3.0.0\r\n> \r\n> brpc: 0.9.7\r\n> \r\n> protobuf: **Additional context/screenshots (更多上下文/截图)**\r\n> \r\n> ps:为了排除是依赖的libtcmalloc_and_profiler.a和libunwind.a的问题，在demo程序上直接链接这两个静态库\r\n> \r\n> 按照如下使用方法 pprof ./demo(demo的二进制文件) 127.0.0.1:ip/pprof/profile --pdf > output.pdf\r\n> \r\n> 获取到的pdf文件是正常的，如下图\r\n> \r\n> [output.pdf](https://github.com/apache/incubator-brpc/files/7083464/output.pdf)\r\n\r\n请问你这个问题解决了吗","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452891808/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452893768","html_url":"https://github.com/apache/brpc/issues/1543#issuecomment-1452893768","issue_url":"https://api.github.com/repos/apache/brpc/issues/1543","id":1452893768,"node_id":"IC_kwDOBhmkcs5WmWZI","user":{"login":"17336","id":74393844,"node_id":"MDQ6VXNlcjc0MzkzODQ0","avatar_url":"https://avatars.githubusercontent.com/u/74393844?v=4","gravatar_id":"","url":"https://api.github.com/users/17336","html_url":"https://github.com/17336","followers_url":"https://api.github.com/users/17336/followers","following_url":"https://api.github.com/users/17336/following{/other_user}","gists_url":"https://api.github.com/users/17336/gists{/gist_id}","starred_url":"https://api.github.com/users/17336/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/17336/subscriptions","organizations_url":"https://api.github.com/users/17336/orgs","repos_url":"https://api.github.com/users/17336/repos","events_url":"https://api.github.com/users/17336/events{/privacy}","received_events_url":"https://api.github.com/users/17336/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T03:09:32Z","updated_at":"2023-03-03T03:09:32Z","author_association":"NONE","body":"> 是指没有brpc框架函数的调用关系吗？确定是有流量的？另外bin里的符号都保留了吗？有没有stripped掉？\r\n\r\n@cdjingit 我也遇到了这个问题，“bin里的符号都保留了吗”是什么意思，bin运行调用的符号应该会保留吧，不保留怎么找到符号定义呢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452893768/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452900192","html_url":"https://github.com/apache/brpc/issues/2144#issuecomment-1452900192","issue_url":"https://api.github.com/repos/apache/brpc/issues/2144","id":1452900192,"node_id":"IC_kwDOBhmkcs5WmX9g","user":{"login":"17336","id":74393844,"node_id":"MDQ6VXNlcjc0MzkzODQ0","avatar_url":"https://avatars.githubusercontent.com/u/74393844?v=4","gravatar_id":"","url":"https://api.github.com/users/17336","html_url":"https://github.com/17336","followers_url":"https://api.github.com/users/17336/followers","following_url":"https://api.github.com/users/17336/following{/other_user}","gists_url":"https://api.github.com/users/17336/gists{/gist_id}","starred_url":"https://api.github.com/users/17336/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/17336/subscriptions","organizations_url":"https://api.github.com/users/17336/orgs","repos_url":"https://api.github.com/users/17336/repos","events_url":"https://api.github.com/users/17336/events{/privacy}","received_events_url":"https://api.github.com/users/17336/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T03:20:05Z","updated_at":"2023-03-03T03:23:05Z","author_association":"NONE","body":"![image](https://user-images.githubusercontent.com/74393844/222622821-9a95cad3-a23f-4e4b-aaed-dff750716e17.png)\r\n我在https://github.com/apache/brpc/issues/1211  这个问题下看到brpc hook了pthread_mutex_lock的实现，我们代码里有的地方的链接的是系统libpthread.so里的实现，有可能是这个原因吗","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452900192/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452908777","html_url":"https://github.com/apache/brpc/issues/2143#issuecomment-1452908777","issue_url":"https://api.github.com/repos/apache/brpc/issues/2143","id":1452908777,"node_id":"IC_kwDOBhmkcs5WmaDp","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T03:29:01Z","updated_at":"2023-03-03T03:29:01Z","author_association":"CONTRIBUTOR","body":"> 如下例子，当Channel和Controller是service回调函数的栈变量，且ns需要通过rpc获取节点信息时\r\n\r\n感觉这个使用场景不是很合理，如果Channel是service回调函数的栈变量，那么每处理一个请求都需要创建/销毁一次Channel，而且这个过程中还会查询ns，而ns还需要rpc来获取节点信息，这样每次请求都要查一次ns，很低效。\r\n\r\n通常来说如果每次请求动态创建Channel，一般Channel都是比较轻量的，比如SingleServer模式，或者list ns。对于比较重的ns最好还是做成全局一个Channel的这种使用方式。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452908777/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452920351","html_url":"https://github.com/apache/brpc/issues/2143#issuecomment-1452920351","issue_url":"https://api.github.com/repos/apache/brpc/issues/2143","id":1452920351,"node_id":"IC_kwDOBhmkcs5Wmc4f","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T03:48:05Z","updated_at":"2023-03-03T03:56:24Z","author_association":"CONTRIBUTOR","body":"> > 如下例子，当Channel和Controller是service回调函数的栈变量，且ns需要通过rpc获取节点信息时\r\n> \r\n> 感觉这个使用场景不是很合理，如果Channel是service回调函数的栈变量，那么每处理一个请求都需要创建/销毁一次Channel，而且这个过程中还会查询ns，而ns还需要rpc来获取节点信息，这样每次请求都要查一次ns，很低效。\r\n> \r\n> 通常来说如果每次请求动态创建Channel，一般Channel都是比较轻量的，比如SingleServer模式，或者list ns。对于比较重的ns最好还是做成全局一个Channel的这种使用方式。\r\n\r\n这个场景不是很合理，但是Channel并没有限制这种用法。像Consul ns的rpc第一次获取节点信息是很快的，但是后续就是long polling，没有变更的话，consul不会返回，ns的rpc等到超时才能结束。这时候Channel析构就是存在等的问题了。\r\n\r\n还是说，在实现ns的时候，需要考虑这个问题。实现ns的时候，不能在GetServers里发起rpc调用，而是实现一个ns client去查ns，GetServers则是去查ns client的缓存。但是这样会有一个问题，每个ns对应的协程数由1个变成了2个了。\r\n\r\n主要是想看能不能从框架层面规避这个问题，让Channel可以立即完成析构。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452920351/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452935390","html_url":"https://github.com/apache/brpc/issues/2142#issuecomment-1452935390","issue_url":"https://api.github.com/repos/apache/brpc/issues/2142","id":1452935390,"node_id":"IC_kwDOBhmkcs5Wmgje","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T04:08:25Z","updated_at":"2023-03-03T04:08:51Z","author_association":"CONTRIBUTOR","body":"> 计算节点的时候，通过请求带的 request_code 来（request_code 应该由 RedisClusterRequest 自动计算填充，通过 CRC32/16384 计算）。\r\n\r\n目前RedisRequest支持批量，但是多个批量请求的key可能hash到不同的server，而当前一次RPC过程会把请求都发到同一个server，所以可能要加个限制，一次RPC的多个批量请求的key必须相同，否则实现起来会很复杂\r\n\r\n> 增加一个 Controller 逻辑，当客户端发现 redis cluster 返回 MOVED 之后，立即触发一次 RedisClusterNamingService 同步更新。同时修改 PreHashLoadBalancer 的路由表\r\n\r\n目前Controller能拿到LB，但是拿不到NamingService对象。Controller耦合NamingService似乎不是一个好主意，可以考虑只更新LB就可以。\r\n\r\n> 增加 Controller 逻辑，当客户端发现 redis cluster 返回 ASK 之后，直接修改请求地址，并在请求之前增加一个 ASKING 指令并获得其返回值（ASKING 在每个 SLOT 变化的时候都需要重新发送至少一次），再重新 IssueRPC，做重定向。\r\n\r\n这里需要一定的抽象，可以抽象一个通用的Controller Redirect流程\r\n\r\n> 是否需要自定义 Controller 来处理和控制 Redis Cluster 请求的 MOVE 和 ASK\r\n\r\n继承Controller父类，来实现Redis Cluster请求流程，这也是一个思路，但需要考虑Controller父类需要留出哪些接口给子类实现。毕竟Controller里的逻辑很复杂，不可能让子类完全重写一遍。\r\n\r\n> 是否需要重新注册一个 Redis Cluster protocol 协议。因为从协议上来看，redis cluster protocol 和 redis 都用的 RESP2 协议。\r\n\r\n看起来好像没必要？在协议解析这方面，并没有什么区别。\r\n\r\n> 是否需要单独独立一个 RedisClusterRequest ，还是在 RedisRequest 上加个字段来区分是否使用的 cluster 模式？\r\n\r\n如果实现了自定义的RedisController，也可以放在那里做一些cluster特有逻辑，就不用在Request上做区分\r\n\r\n> 如果要计算 request_code 需要 aware 用户请求，那么需要修改 RedisRequest 的解析段。是否让用户主动传入，我们不做计算？（感觉这里如果放开了会是个暗坑）。\r\n\r\n最好不要让用户传入","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452935390/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452996612","html_url":"https://github.com/apache/brpc/issues/2143#issuecomment-1452996612","issue_url":"https://api.github.com/repos/apache/brpc/issues/2143","id":1452996612,"node_id":"IC_kwDOBhmkcs5WmvgE","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T05:28:29Z","updated_at":"2023-03-03T05:28:29Z","author_association":"CONTRIBUTOR","body":"之前想到一个改进思路是把NamingServiceThread做成全局的，不是一个url一个bthread，而是一类NS的所有url共用一个bthread，这样有些NS可以支持批量接口的，效率会更高，也不需要在Channel析构时等待NS线程退出","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1452996612/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453003277","html_url":"https://github.com/apache/brpc/issues/2133#issuecomment-1453003277","issue_url":"https://api.github.com/repos/apache/brpc/issues/2133","id":1453003277,"node_id":"IC_kwDOBhmkcs5WmxIN","user":{"login":"chenzhangyi","id":6805583,"node_id":"MDQ6VXNlcjY4MDU1ODM=","avatar_url":"https://avatars.githubusercontent.com/u/6805583?v=4","gravatar_id":"","url":"https://api.github.com/users/chenzhangyi","html_url":"https://github.com/chenzhangyi","followers_url":"https://api.github.com/users/chenzhangyi/followers","following_url":"https://api.github.com/users/chenzhangyi/following{/other_user}","gists_url":"https://api.github.com/users/chenzhangyi/gists{/gist_id}","starred_url":"https://api.github.com/users/chenzhangyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenzhangyi/subscriptions","organizations_url":"https://api.github.com/users/chenzhangyi/orgs","repos_url":"https://api.github.com/users/chenzhangyi/repos","events_url":"https://api.github.com/users/chenzhangyi/events{/privacy}","received_events_url":"https://api.github.com/users/chenzhangyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T05:38:43Z","updated_at":"2023-03-03T05:38:43Z","author_association":"MEMBER","body":"应该是不支持的，这个和符号查找顺序有关，对于pthread_mutex_lock的hook没法影响到到glibc.so内部调用。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453003277/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453009554","html_url":"https://github.com/apache/brpc/issues/845#issuecomment-1453009554","issue_url":"https://api.github.com/repos/apache/brpc/issues/845","id":1453009554,"node_id":"IC_kwDOBhmkcs5WmyqS","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T05:48:38Z","updated_at":"2023-03-03T05:49:55Z","author_association":"CONTRIBUTOR","body":"> > > master 已修复\r\n> > \r\n> > \r\n> > Hi @wwbmmm ，我看了下master的提交记录，好像是给g++添加了`-fno-gcse`的编译选项来修复这个问题，请问，如果用clang编译器编译brpc的话，得怎么处理呢？\r\n> \r\n> 目前还不太清楚clang中有没有对应选项\r\n\r\nMac M1 下确实还会遇到这个问题，目前似乎没有找到对应的选项来解决这个问题。\r\nstackoverflow 上问了下类似的情况：https://stackoverflow.com/questions/75592038/how-to-disable-clang-expression-elimination-for-thread-local-variable/75622732#75622732。\r\n\r\n建议是说给获取 tls 的变量加上 noinline 的函数防止优化，但是可能存在函数调用开销。\r\n参考 qemu 的做法：https://github.com/qemu/qemu/blob/d7e2fe4aac8b74bbfe82b2309536528b4dbe0d34/include/qemu/coroutine-tls.h#L141-L163\r\n\r\n是否可以在 clang && mac 的情况下走这个解决方法，避免错误的产生？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453009554/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453009804","html_url":"https://github.com/apache/brpc/issues/845#issuecomment-1453009804","issue_url":"https://api.github.com/repos/apache/brpc/issues/845","id":1453009804,"node_id":"IC_kwDOBhmkcs5WmyuM","user":{"login":"x-x-p","id":49055325,"node_id":"MDQ6VXNlcjQ5MDU1MzI1","avatar_url":"https://avatars.githubusercontent.com/u/49055325?v=4","gravatar_id":"","url":"https://api.github.com/users/x-x-p","html_url":"https://github.com/x-x-p","followers_url":"https://api.github.com/users/x-x-p/followers","following_url":"https://api.github.com/users/x-x-p/following{/other_user}","gists_url":"https://api.github.com/users/x-x-p/gists{/gist_id}","starred_url":"https://api.github.com/users/x-x-p/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/x-x-p/subscriptions","organizations_url":"https://api.github.com/users/x-x-p/orgs","repos_url":"https://api.github.com/users/x-x-p/repos","events_url":"https://api.github.com/users/x-x-p/events{/privacy}","received_events_url":"https://api.github.com/users/x-x-p/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T05:49:00Z","updated_at":"2023-03-03T05:49:00Z","author_association":"NONE","body":"您好，邮件已收到...","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453009804/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453061316","html_url":"https://github.com/apache/brpc/issues/2143#issuecomment-1453061316","issue_url":"https://api.github.com/repos/apache/brpc/issues/2143","id":1453061316,"node_id":"IC_kwDOBhmkcs5Wm_TE","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T06:51:20Z","updated_at":"2023-03-03T06:51:20Z","author_association":"CONTRIBUTOR","body":"要兼容现在PeriodicNamingService的用法的话，是不是有问题？目前一个url对应一个GetServers，只有一类NS一个bthread的话，那么一类NS的所有url的GetServers就变成串行了，效率会变差吧。也没法让GetServers变成一部，因为rpc调用是由用户在GetServers里实现的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453061316/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453105640","html_url":"https://github.com/apache/brpc/issues/2143#issuecomment-1453105640","issue_url":"https://api.github.com/repos/apache/brpc/issues/2143","id":1453105640,"node_id":"IC_kwDOBhmkcs5WnKHo","user":{"login":"chenzhangyi","id":6805583,"node_id":"MDQ6VXNlcjY4MDU1ODM=","avatar_url":"https://avatars.githubusercontent.com/u/6805583?v=4","gravatar_id":"","url":"https://api.github.com/users/chenzhangyi","html_url":"https://github.com/chenzhangyi","followers_url":"https://api.github.com/users/chenzhangyi/followers","following_url":"https://api.github.com/users/chenzhangyi/following{/other_user}","gists_url":"https://api.github.com/users/chenzhangyi/gists{/gist_id}","starred_url":"https://api.github.com/users/chenzhangyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenzhangyi/subscriptions","organizations_url":"https://api.github.com/users/chenzhangyi/orgs","repos_url":"https://api.github.com/users/chenzhangyi/repos","events_url":"https://api.github.com/users/chenzhangyi/events{/privacy}","received_events_url":"https://api.github.com/users/chenzhangyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T07:40:38Z","updated_at":"2023-03-03T07:40:38Z","author_association":"MEMBER","body":"@chenBright 加个Stop的接口是不是可以解决等待异步线程执行的问题？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453105640/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453116990","html_url":"https://github.com/apache/brpc/issues/2143#issuecomment-1453116990","issue_url":"https://api.github.com/repos/apache/brpc/issues/2143","id":1453116990,"node_id":"IC_kwDOBhmkcs5WnM4-","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T07:52:59Z","updated_at":"2023-03-03T07:52:59Z","author_association":"CONTRIBUTOR","body":"> @chenBright 加个Stop的接口是不是可以解决等待异步线程执行的问题？\r\n\r\n@chenzhangyi 不行。\r\n\r\n目前NamingServiceThread已经调用了bthread_stop通知ns bthread退出了，但是ns bthread不一定能及时退出，例如在需要等rpc完成才能进行Stop的判断逻辑。之前考虑过在NamingServiceThread析构的时候通过brpc::StartCancel来取消rpc，但是需要用户实现GetServers保证能正确取消rpc，这样相当于将工作转移给了用户，而且不好实现。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453116990/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453365435","html_url":"https://github.com/apache/brpc/issues/2142#issuecomment-1453365435","issue_url":"https://api.github.com/repos/apache/brpc/issues/2142","id":1453365435,"node_id":"IC_kwDOBhmkcs5WoJi7","user":{"login":"wayslog","id":8586449,"node_id":"MDQ6VXNlcjg1ODY0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8586449?v=4","gravatar_id":"","url":"https://api.github.com/users/wayslog","html_url":"https://github.com/wayslog","followers_url":"https://api.github.com/users/wayslog/followers","following_url":"https://api.github.com/users/wayslog/following{/other_user}","gists_url":"https://api.github.com/users/wayslog/gists{/gist_id}","starred_url":"https://api.github.com/users/wayslog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wayslog/subscriptions","organizations_url":"https://api.github.com/users/wayslog/orgs","repos_url":"https://api.github.com/users/wayslog/repos","events_url":"https://api.github.com/users/wayslog/events{/privacy}","received_events_url":"https://api.github.com/users/wayslog/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T11:09:12Z","updated_at":"2023-03-03T11:09:12Z","author_association":"NONE","body":"> 目前RedisRequest支持批量，但是多个批量请求的key可能hash到不同的server，而当前一次RPC过程会把请求都发到同一个server，所以可能要加个限制，一次RPC的多个批量请求的key必须相同，否则实现起来会很复杂\r\n\r\n可以不相同，只要 key hash 之后的 slot 相同就可以了。另外现在的 redis 客户端大部分其实都未做拆分，这个拆分了之后对一些特殊的命令比如 MSETNX 之类产生不可知的影响。\r\n我们这里可以先只支持同 server 的请求，把自动拆 key （涉及到的命令主要有 MGET/MSET/DEL/EXISTS... 这几个）的作为后续的支持实现。\r\n\r\n> 目前Controller能拿到LB，但是拿不到NamingService对象。Controller耦合NamingService似乎不是一个好主意，可以考虑只更新LB就可以。\r\n\r\n我也感觉耦合 NamingService 不是一个好主意。NamingService 可以通过周期性的发送命令自己更新自己。\r\n\r\n> 这里需要一定的抽象，可以抽象一个通用的Controller Redirect流程\r\n\r\nController 这里重定向逻辑作为一个插件或者策略组什么的插入 Controller 里吧，继承下来感觉不如另加逻辑。就是我得注意一下不要把 Controller 污染。\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453365435/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453698208","html_url":"https://github.com/apache/brpc/issues/1173#issuecomment-1453698208","issue_url":"https://api.github.com/repos/apache/brpc/issues/1173","id":1453698208,"node_id":"IC_kwDOBhmkcs5Wpayg","user":{"login":"feng-y","id":1547384,"node_id":"MDQ6VXNlcjE1NDczODQ=","avatar_url":"https://avatars.githubusercontent.com/u/1547384?v=4","gravatar_id":"","url":"https://api.github.com/users/feng-y","html_url":"https://github.com/feng-y","followers_url":"https://api.github.com/users/feng-y/followers","following_url":"https://api.github.com/users/feng-y/following{/other_user}","gists_url":"https://api.github.com/users/feng-y/gists{/gist_id}","starred_url":"https://api.github.com/users/feng-y/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/feng-y/subscriptions","organizations_url":"https://api.github.com/users/feng-y/orgs","repos_url":"https://api.github.com/users/feng-y/repos","events_url":"https://api.github.com/users/feng-y/events{/privacy}","received_events_url":"https://api.github.com/users/feng-y/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-03T15:26:47Z","updated_at":"2023-03-03T15:34:19Z","author_association":"NONE","body":"<img width=\"1903\" alt=\"image\" src=\"https://user-images.githubusercontent.com/1547384/222759357-2615f45f-20f3-4d8e-87fa-32719b063104.png\">\r\n\r\n<img width=\"779\" alt=\"image\" src=\"https://user-images.githubusercontent.com/1547384/222759534-6209b3a9-bbb0-4f40-92ad-94c69935c1b1.png\">\r\n\r\n重新导入gdb 报这个错误\r\n(gdb) bthread_begin\r\nPython Exception <class 'gdb.error'> There is no member named _combiner.:\r\nError occurred in Python command: There is no member named _combiner.\r\n\r\n@lorinlee  辛苦帮忙看看，怎么解","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1453698208/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1454693957","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1454693957","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1454693957,"node_id":"IC_kwDOBhmkcs5WtN5F","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-04T10:36:18Z","updated_at":"2023-03-04T10:36:18Z","author_association":"CONTRIBUTOR","body":"@netjia-cpu 可以尝试打 #1817  这个patch试下 ，或者升级brpc版本","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1454693957/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1454757245","html_url":"https://github.com/apache/brpc/pull/2147#issuecomment-1454757245","issue_url":"https://api.github.com/repos/apache/brpc/issues/2147","id":1454757245,"node_id":"IC_kwDOBhmkcs5WtdV9","user":{"login":"aMagicNeko","id":73780784,"node_id":"MDQ6VXNlcjczNzgwNzg0","avatar_url":"https://avatars.githubusercontent.com/u/73780784?v=4","gravatar_id":"","url":"https://api.github.com/users/aMagicNeko","html_url":"https://github.com/aMagicNeko","followers_url":"https://api.github.com/users/aMagicNeko/followers","following_url":"https://api.github.com/users/aMagicNeko/following{/other_user}","gists_url":"https://api.github.com/users/aMagicNeko/gists{/gist_id}","starred_url":"https://api.github.com/users/aMagicNeko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aMagicNeko/subscriptions","organizations_url":"https://api.github.com/users/aMagicNeko/orgs","repos_url":"https://api.github.com/users/aMagicNeko/repos","events_url":"https://api.github.com/users/aMagicNeko/events{/privacy}","received_events_url":"https://api.github.com/users/aMagicNeko/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-04T14:27:21Z","updated_at":"2023-03-04T14:27:21Z","author_association":"NONE","body":"不知道我做的对吗？有大佬康康吗","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1454757245/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1454790966","html_url":"https://github.com/apache/brpc/issues/2144#issuecomment-1454790966","issue_url":"https://api.github.com/repos/apache/brpc/issues/2144","id":1454790966,"node_id":"IC_kwDOBhmkcs5Wtlk2","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-04T16:16:48Z","updated_at":"2023-03-04T16:16:48Z","author_association":"CONTRIBUTOR","body":"@17336 上面的issue是contention profiler。cpu profiler 不完整可以确认下是不是栈帧回溯有问题，issue里提供的信息比较少不太好直接定位问题，可以尝试的办法比如编译加-g和-fno-omit-frame-pointer，确认编译过后没有对相关二进制/动态库做strip；brpc的cpu profiler是基于gperftools实现的，也可以参考gperftools的文档。采样次数减少一般可以看做是当前函数的开销，对应到问题里就是start_thread本身的开销。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1454790966/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1455035079","html_url":"https://github.com/apache/brpc/issues/2025#issuecomment-1455035079","issue_url":"https://api.github.com/repos/apache/brpc/issues/2025","id":1455035079,"node_id":"IC_kwDOBhmkcs5WuhLH","user":{"login":"zyong","id":2981440,"node_id":"MDQ6VXNlcjI5ODE0NDA=","avatar_url":"https://avatars.githubusercontent.com/u/2981440?v=4","gravatar_id":"","url":"https://api.github.com/users/zyong","html_url":"https://github.com/zyong","followers_url":"https://api.github.com/users/zyong/followers","following_url":"https://api.github.com/users/zyong/following{/other_user}","gists_url":"https://api.github.com/users/zyong/gists{/gist_id}","starred_url":"https://api.github.com/users/zyong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyong/subscriptions","organizations_url":"https://api.github.com/users/zyong/orgs","repos_url":"https://api.github.com/users/zyong/repos","events_url":"https://api.github.com/users/zyong/events{/privacy}","received_events_url":"https://api.github.com/users/zyong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-05T09:19:48Z","updated_at":"2023-03-05T09:20:39Z","author_association":"NONE","body":"@SillyBoyenjoy 确定问题是修复了吗，今天新clone的代码，运行cmake生成文件，执行就报错\r\nOS:macOS Ventura 13.2.1 (22D68)\r\nCompiler:Clang\r\nbrpc:1.4.0. master版本测试也不行\r\nprotobuf:3.15.8\r\ncmake version 3.20.1\r\n\r\n ~/Develop/c/brpc/example/echo_c++   origin/release-1.4  cmake -B build && cmake --build build\r\nCMake Deprecation Warning at CMakeLists.txt:18 (cmake_minimum_required):\r\n  Compatibility with CMake < 2.8.12 will be removed from a future version of\r\n  CMake.\r\n\r\n  Update the VERSION argument <min> value or use a ...<max> suffix to tell\r\n  CMake that the project does not need compatibility with older versions.\r\n\r\n\r\n-- The C compiler identification is AppleClang 12.0.5.12050022\r\n-- The CXX compiler identification is AppleClang 12.0.5.12050022\r\n-- Detecting C compiler ABI info\r\n-- Detecting C compiler ABI info - done\r\n-- Check for working C compiler: /Library/Developer/CommandLineTools/usr/bin/cc - skipped\r\n-- Detecting C compile features\r\n-- Detecting C compile features - done\r\n-- Detecting CXX compiler ABI info\r\n-- Detecting CXX compiler ABI info - done\r\n-- Check for working CXX compiler: /Library/Developer/CommandLineTools/usr/bin/c++ - skipped\r\n-- Detecting CXX compile features\r\n-- Detecting CXX compile features - done\r\n-- Looking for pthread.h\r\n-- Looking for pthread.h - found\r\n-- Performing Test CMAKE_HAVE_LIBC_PTHREAD\r\n-- Performing Test CMAKE_HAVE_LIBC_PTHREAD - Success\r\n-- Found Threads: TRUE\r\n-- Found Protobuf: /usr/local/lib/libprotobuf.dylib (found version \"3.15.8\")\r\n-- Looking for clock_gettime\r\n-- Looking for clock_gettime - found\r\n-- Found OpenSSL: /usr/local/opt/openssl/lib/libcrypto.dylib (found version \"1.1.1k\")\r\n-- Configuring done\r\n-- Generating done\r\n-- Build files have been written to: /Users/zhaoyong/Develop/c/brpc/example/echo_c++/build\r\n[ 12%] Running cpp protocol buffer compiler on echo.proto\r\n[ 25%] Building CXX object CMakeFiles/echo_server.dir/server.cpp.o\r\n[ 75%] Building CXX object CMakeFiles/echo_client.dir/echo.pb.cc.o\r\n[ 87%] Linking CXX executable echo_client\r\n[100%] Built target echo_client\r\n\r\n   ~/Develop/c/brpc/example/echo_c++   origin/release-1.4  ./build/echo_server\r\n[1]    89260 segmentation fault  ./build/echo_server\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1455035079/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1455299029","html_url":"https://github.com/apache/brpc/pull/2148#issuecomment-1455299029","issue_url":"https://api.github.com/repos/apache/brpc/issues/2148","id":1455299029,"node_id":"IC_kwDOBhmkcs5WvhnV","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-06T01:37:39Z","updated_at":"2023-03-06T01:37:39Z","author_association":"MEMBER","body":"Thanks for the contribution, could you please add a little more about this pr? e.g. why this new example?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1455299029/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1455323227","html_url":"https://github.com/apache/brpc/issues/2133#issuecomment-1455323227","issue_url":"https://api.github.com/repos/apache/brpc/issues/2133","id":1455323227,"node_id":"IC_kwDOBhmkcs5Wvnhb","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-06T02:12:33Z","updated_at":"2023-03-06T02:12:33Z","author_association":"CONTRIBUTOR","body":"hook pthread_wrlock应该就能支持了吧？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1455323227/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1455423880","html_url":"https://github.com/apache/brpc/issues/2000#issuecomment-1455423880","issue_url":"https://api.github.com/repos/apache/brpc/issues/2000","id":1455423880,"node_id":"IC_kwDOBhmkcs5WwAGI","user":{"login":"MrGuin","id":26199910,"node_id":"MDQ6VXNlcjI2MTk5OTEw","avatar_url":"https://avatars.githubusercontent.com/u/26199910?v=4","gravatar_id":"","url":"https://api.github.com/users/MrGuin","html_url":"https://github.com/MrGuin","followers_url":"https://api.github.com/users/MrGuin/followers","following_url":"https://api.github.com/users/MrGuin/following{/other_user}","gists_url":"https://api.github.com/users/MrGuin/gists{/gist_id}","starred_url":"https://api.github.com/users/MrGuin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MrGuin/subscriptions","organizations_url":"https://api.github.com/users/MrGuin/orgs","repos_url":"https://api.github.com/users/MrGuin/repos","events_url":"https://api.github.com/users/MrGuin/events{/privacy}","received_events_url":"https://api.github.com/users/MrGuin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-06T04:20:56Z","updated_at":"2023-03-06T04:20:56Z","author_association":"CONTRIBUTOR","body":"@wwbmmm 你好，更新一下我这边的新发现。\r\n\r\n首先是 redis_benchmark 是单线程的，之前的测试请求压力不够高，换成支持多线程的 memtier_benchmark 之后 brpc-redis 和 redis 的 qps 都有显著提升，brpc 的 redis example 的 qps 达到 10w 左右，而 redis 的 qps 能达到 17w。\r\n\r\n跑的时候 brpc-redis 的 cpu 明显是没满的，猜测可能是 epoll 线程瓶颈，然后我把 event_dispatcher_num 设成 2 之后 qps 有明显上升，能达到 20w，而且 cpu 利用率高了很多，几乎能跑满 bthread_concurrency 对应的核数。并发设成 4 的情况下 bthread_worker_usage 稳定在 3.74，process_cpu_usage 最终稳定在 3.68 左右。\r\n\r\n现在的问题增加并发无法带来 qps 提升，4 并发跟 9 并发的 qps 是几乎没有提升，19.9w 对比 20w，空有 cpu 消耗多了很多，9 并发下 bthread_worker_usage 稳定在 6.6，process_cpu_usage 最终稳定在 7.0 左右。请问这里不 scale 的可能原因是什么呢，因为 bthread 的调度不 scale？是否可能跟 brpc 针对 redis 协议单连接请求串行处理有关？\r\n\r\n另外就是相同机器下使用自带的 rpc_press 压测 echo example 测出来 qps 最多能稳定在 22w多接近 23w，是否可以认为这是 brpc 的极限性能？brpc-redis 的 20w qps 是否还有提升空间呢？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1455423880/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1455776609","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1455776609","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1455776609,"node_id":"IC_kwDOBhmkcs5WxWNh","user":{"login":"jialei-jialei","id":13553842,"node_id":"MDQ6VXNlcjEzNTUzODQy","avatar_url":"https://avatars.githubusercontent.com/u/13553842?v=4","gravatar_id":"","url":"https://api.github.com/users/jialei-jialei","html_url":"https://github.com/jialei-jialei","followers_url":"https://api.github.com/users/jialei-jialei/followers","following_url":"https://api.github.com/users/jialei-jialei/following{/other_user}","gists_url":"https://api.github.com/users/jialei-jialei/gists{/gist_id}","starred_url":"https://api.github.com/users/jialei-jialei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jialei-jialei/subscriptions","organizations_url":"https://api.github.com/users/jialei-jialei/orgs","repos_url":"https://api.github.com/users/jialei-jialei/repos","events_url":"https://api.github.com/users/jialei-jialei/events{/privacy}","received_events_url":"https://api.github.com/users/jialei-jialei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-06T09:25:28Z","updated_at":"2023-03-06T09:25:28Z","author_association":"NONE","body":"> @netjia-cpu 可以尝试打 #1817 这个patch试下 ，或者升级brpc版本\r\n\r\n多谢，我试一下","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1455776609/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1455818042","html_url":"https://github.com/apache/brpc/issues/2150#issuecomment-1455818042","issue_url":"https://api.github.com/repos/apache/brpc/issues/2150","id":1455818042,"node_id":"IC_kwDOBhmkcs5WxgU6","user":{"login":"jialei-jialei","id":13553842,"node_id":"MDQ6VXNlcjEzNTUzODQy","avatar_url":"https://avatars.githubusercontent.com/u/13553842?v=4","gravatar_id":"","url":"https://api.github.com/users/jialei-jialei","html_url":"https://github.com/jialei-jialei","followers_url":"https://api.github.com/users/jialei-jialei/followers","following_url":"https://api.github.com/users/jialei-jialei/following{/other_user}","gists_url":"https://api.github.com/users/jialei-jialei/gists{/gist_id}","starred_url":"https://api.github.com/users/jialei-jialei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jialei-jialei/subscriptions","organizations_url":"https://api.github.com/users/jialei-jialei/orgs","repos_url":"https://api.github.com/users/jialei-jialei/repos","events_url":"https://api.github.com/users/jialei-jialei/events{/privacy}","received_events_url":"https://api.github.com/users/jialei-jialei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-06T09:55:34Z","updated_at":"2023-03-06T09:55:34Z","author_association":"NONE","body":"echo.pb里面的request也加上id，打印出来，在故障情况下，也是乱序的","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1455818042/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1457916135","html_url":"https://github.com/apache/brpc/pull/2148#issuecomment-1457916135","issue_url":"https://api.github.com/repos/apache/brpc/issues/2148","id":1457916135,"node_id":"IC_kwDOBhmkcs5W5gjn","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-07T10:21:31Z","updated_at":"2023-03-07T10:21:31Z","author_association":"CONTRIBUTOR","body":"I don't think this example is necessary.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1457916135/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1457927220","html_url":"https://github.com/apache/brpc/issues/2000#issuecomment-1457927220","issue_url":"https://api.github.com/repos/apache/brpc/issues/2000","id":1457927220,"node_id":"IC_kwDOBhmkcs5W5jQ0","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-07T10:29:32Z","updated_at":"2023-03-07T10:29:32Z","author_association":"CONTRIBUTOR","body":"> 4 并发跟 9 并发的 qps 是几乎没有提升，19.9w 对比 20w，空有 cpu 消耗多了很多\r\n\r\n从4并发到9并发，是否有增加对应的event_dispatcher_num呢？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1457927220/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1458004589","html_url":"https://github.com/apache/brpc/issues/2150#issuecomment-1458004589","issue_url":"https://api.github.com/repos/apache/brpc/issues/2150","id":1458004589,"node_id":"IC_kwDOBhmkcs5W52Jt","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-07T11:27:52Z","updated_at":"2023-03-07T11:27:52Z","author_association":"CONTRIBUTOR","body":"这个和channel没关系，这是因为server端收到请求时，会启动新的bthread来处理请求，如果同时有多个请求，它们的处理顺序是不能保障的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1458004589/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1458035161","html_url":"https://github.com/apache/brpc/issues/2155#issuecomment-1458035161","issue_url":"https://api.github.com/repos/apache/brpc/issues/2155","id":1458035161,"node_id":"IC_kwDOBhmkcs5W59nZ","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-07T11:53:52Z","updated_at":"2023-03-07T11:53:52Z","author_association":"CONTRIBUTOR","body":"> 而brpc不能使用这一行\r\n\r\n这里是想写grpc？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1458035161/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1459219404","html_url":"https://github.com/apache/brpc/issues/2150#issuecomment-1459219404","issue_url":"https://api.github.com/repos/apache/brpc/issues/2150","id":1459219404,"node_id":"IC_kwDOBhmkcs5W-evM","user":{"login":"jialei-jialei","id":13553842,"node_id":"MDQ6VXNlcjEzNTUzODQy","avatar_url":"https://avatars.githubusercontent.com/u/13553842?v=4","gravatar_id":"","url":"https://api.github.com/users/jialei-jialei","html_url":"https://github.com/jialei-jialei","followers_url":"https://api.github.com/users/jialei-jialei/followers","following_url":"https://api.github.com/users/jialei-jialei/following{/other_user}","gists_url":"https://api.github.com/users/jialei-jialei/gists{/gist_id}","starred_url":"https://api.github.com/users/jialei-jialei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jialei-jialei/subscriptions","organizations_url":"https://api.github.com/users/jialei-jialei/orgs","repos_url":"https://api.github.com/users/jialei-jialei/repos","events_url":"https://api.github.com/users/jialei-jialei/events{/privacy}","received_events_url":"https://api.github.com/users/jialei-jialei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-08T02:48:14Z","updated_at":"2023-03-08T02:48:14Z","author_association":"NONE","body":"> 这个和channel没关系，这是因为server端收到请求时，会启动新的bthread来处理请求，如果同时有多个请求，它们的处理顺序是不能保障的。\r\n\r\n明白了，谢谢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1459219404/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1459402539","html_url":"https://github.com/apache/brpc/issues/2155#issuecomment-1459402539","issue_url":"https://api.github.com/repos/apache/brpc/issues/2155","id":1459402539,"node_id":"IC_kwDOBhmkcs5W_Lcr","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-08T04:12:28Z","updated_at":"2023-03-08T04:12:28Z","author_association":"NONE","body":"> > 而brpc不能使用这一行\r\n> \r\n> 这里是想写grpc？\r\n\r\n是我们与别人共用proto, 别人比如java用的grpc, 我们不能随便改proto","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1459402539/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1459434956","html_url":"https://github.com/apache/brpc/issues/2155#issuecomment-1459434956","issue_url":"https://api.github.com/repos/apache/brpc/issues/2155","id":1459434956,"node_id":"IC_kwDOBhmkcs5W_TXM","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-08T04:30:46Z","updated_at":"2023-03-08T04:30:46Z","author_association":"CONTRIBUTOR","body":"好像没啥好办法，可以在编译脚本里加个命令临时改一下proto文件里的option cc_generic_services","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1459434956/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1459617623","html_url":"https://github.com/apache/brpc/issues/2155#issuecomment-1459617623","issue_url":"https://api.github.com/repos/apache/brpc/issues/2155","id":1459617623,"node_id":"IC_kwDOBhmkcs5W__9X","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-08T06:37:15Z","updated_at":"2023-03-08T06:37:15Z","author_association":"NONE","body":"> 好像没啥好办法，可以在编译脚本里加个命令临时改一下proto文件里的option cc_generic_services\r\n\r\n感谢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1459617623/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1459631804","html_url":"https://github.com/apache/brpc/issues/2151#issuecomment-1459631804","issue_url":"https://api.github.com/repos/apache/brpc/issues/2151","id":1459631804,"node_id":"IC_kwDOBhmkcs5XADa8","user":{"login":"TousakaRin","id":8801314,"node_id":"MDQ6VXNlcjg4MDEzMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8801314?v=4","gravatar_id":"","url":"https://api.github.com/users/TousakaRin","html_url":"https://github.com/TousakaRin","followers_url":"https://api.github.com/users/TousakaRin/followers","following_url":"https://api.github.com/users/TousakaRin/following{/other_user}","gists_url":"https://api.github.com/users/TousakaRin/gists{/gist_id}","starred_url":"https://api.github.com/users/TousakaRin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TousakaRin/subscriptions","organizations_url":"https://api.github.com/users/TousakaRin/orgs","repos_url":"https://api.github.com/users/TousakaRin/repos","events_url":"https://api.github.com/users/TousakaRin/events{/privacy}","received_events_url":"https://api.github.com/users/TousakaRin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-08T06:56:59Z","updated_at":"2023-03-08T06:56:59Z","author_association":"CONTRIBUTOR","body":"可以参考src/brpc/cluster_recover_policy.h看看是否满足需求","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1459631804/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1461355927","html_url":"https://github.com/apache/brpc/issues/2000#issuecomment-1461355927","issue_url":"https://api.github.com/repos/apache/brpc/issues/2000","id":1461355927,"node_id":"IC_kwDOBhmkcs5XGoWX","user":{"login":"MrGuin","id":26199910,"node_id":"MDQ6VXNlcjI2MTk5OTEw","avatar_url":"https://avatars.githubusercontent.com/u/26199910?v=4","gravatar_id":"","url":"https://api.github.com/users/MrGuin","html_url":"https://github.com/MrGuin","followers_url":"https://api.github.com/users/MrGuin/followers","following_url":"https://api.github.com/users/MrGuin/following{/other_user}","gists_url":"https://api.github.com/users/MrGuin/gists{/gist_id}","starred_url":"https://api.github.com/users/MrGuin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MrGuin/subscriptions","organizations_url":"https://api.github.com/users/MrGuin/orgs","repos_url":"https://api.github.com/users/MrGuin/repos","events_url":"https://api.github.com/users/MrGuin/events{/privacy}","received_events_url":"https://api.github.com/users/MrGuin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-09T06:16:50Z","updated_at":"2023-03-09T06:17:37Z","author_association":"CONTRIBUTOR","body":"> 从4并发到9并发，是否有增加对应的event_dispatcher_num呢？\r\n\r\n增加到3也没有提升，似乎到了瓶颈，增加线程数和 event_dispatcher_num 不会带来提升。\r\n\r\n这点在另外一台64核的机器上更为明显。\r\n ec2 server 机器类型是 c7g.16xlarge，同样的压力测试 `memtier_benchmark -s 172.31.18.183 -d 256 –distinct-client-seed –expiry-range=500-500 -p 6379 -t 64 -c 30 -n 200000`。\r\n测 Dragonfly 的 qps 能达到 300w 并最终稳定在 200w 多一点，与宣称的基本一致；\r\n测 brpc-redis 默认选项（64线程，1 event_dispatcher）下只能达到 70w，而且增加 event_dispatcher 反而会降低。线程越多反而越低，最佳的 qps 在 `-bthread_concurrency=24 -event_dispatcher_num=4` 选项下能达到 260w 并且很稳定，比 Dragonfly 还要高。并发超过 24 再增加的话就 latency 上升，qps 下降明显，无论 event_dispatcher_num 如何改变。而且 cpu 似乎全部花在了绿色 100%，\r\n\r\n这是 brpc-redis 在最佳配置 `-bthread_concurrency=24 -event_dispatcher_num=4` 下的 cpu：\r\n<img width=\"1620\" alt=\"截屏2023-03-09 13 42 30\" src=\"https://user-images.githubusercontent.com/26199910/223935384-c97a67e5-bd71-49d5-b7d0-31ef118f75a2.png\">\r\n这是在配置 `-bthread_concurrency=64 -event_dispatcher_num=4` 下的 cpu：\r\n<img width=\"1616\" alt=\"截屏2023-03-09 14 11 22\" src=\"https://user-images.githubusercontent.com/26199910/223935697-085f491d-3b2a-4929-9844-b6e01af2c69c.png\">\r\n\r\ncpu 似乎全花在了调度跟空转和争抢上。\r\n\r\n总结下就是超过一定阈值后增加并发数，latency 会上升，带来 qps 下降，似乎是调度带来的开销。现在看来每次部署都要专门调试选择最佳的配置。brpc 的潜力还是很大的，请问该怎么进一步分析，以及如何能让 cpu 能够真正地发挥呢？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1461355927/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1461500981","html_url":"https://github.com/apache/brpc/issues/2157#issuecomment-1461500981","issue_url":"https://api.github.com/repos/apache/brpc/issues/2157","id":1461500981,"node_id":"IC_kwDOBhmkcs5XHLw1","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-09T07:51:02Z","updated_at":"2023-03-09T07:51:02Z","author_association":"CONTRIBUTOR","body":"src/brpc/policy/baidu_rpc_meta.proto，这个吧","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1461500981/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1461543462","html_url":"https://github.com/apache/brpc/issues/2157#issuecomment-1461543462","issue_url":"https://api.github.com/repos/apache/brpc/issues/2157","id":1461543462,"node_id":"IC_kwDOBhmkcs5XHWIm","user":{"login":"cmdmspaint","id":50624748,"node_id":"MDQ6VXNlcjUwNjI0NzQ4","avatar_url":"https://avatars.githubusercontent.com/u/50624748?v=4","gravatar_id":"","url":"https://api.github.com/users/cmdmspaint","html_url":"https://github.com/cmdmspaint","followers_url":"https://api.github.com/users/cmdmspaint/followers","following_url":"https://api.github.com/users/cmdmspaint/following{/other_user}","gists_url":"https://api.github.com/users/cmdmspaint/gists{/gist_id}","starred_url":"https://api.github.com/users/cmdmspaint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmdmspaint/subscriptions","organizations_url":"https://api.github.com/users/cmdmspaint/orgs","repos_url":"https://api.github.com/users/cmdmspaint/repos","events_url":"https://api.github.com/users/cmdmspaint/events{/privacy}","received_events_url":"https://api.github.com/users/cmdmspaint/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-09T08:21:42Z","updated_at":"2023-03-09T08:21:42Z","author_association":"NONE","body":"> src/brpc/policy/baidu_rpc_meta.proto，这个吧\r\n\r\n应该是由包头和包体组成，包体又分为metadata、data和payload\r\n包头我知道是12个字节，通过包头我解析出来是SOFA协议\r\n![image](https://user-images.githubusercontent.com/50624748/223962519-58cc5f4c-fb43-4813-89d7-9d22eb193fda.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1461543462/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1461546270","html_url":"https://github.com/apache/brpc/issues/2157#issuecomment-1461546270","issue_url":"https://api.github.com/repos/apache/brpc/issues/2157","id":1461546270,"node_id":"IC_kwDOBhmkcs5XHW0e","user":{"login":"cmdmspaint","id":50624748,"node_id":"MDQ6VXNlcjUwNjI0NzQ4","avatar_url":"https://avatars.githubusercontent.com/u/50624748?v=4","gravatar_id":"","url":"https://api.github.com/users/cmdmspaint","html_url":"https://github.com/cmdmspaint","followers_url":"https://api.github.com/users/cmdmspaint/followers","following_url":"https://api.github.com/users/cmdmspaint/following{/other_user}","gists_url":"https://api.github.com/users/cmdmspaint/gists{/gist_id}","starred_url":"https://api.github.com/users/cmdmspaint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmdmspaint/subscriptions","organizations_url":"https://api.github.com/users/cmdmspaint/orgs","repos_url":"https://api.github.com/users/cmdmspaint/repos","events_url":"https://api.github.com/users/cmdmspaint/events{/privacy}","received_events_url":"https://api.github.com/users/cmdmspaint/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-09T08:23:33Z","updated_at":"2023-03-09T08:23:33Z","author_association":"NONE","body":"> src/brpc/policy/baidu_rpc_meta.proto，这个吧\r\n\r\n目前就是不太清楚包体的格式","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1461546270/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1461629248","html_url":"https://github.com/apache/brpc/issues/2157#issuecomment-1461629248","issue_url":"https://api.github.com/repos/apache/brpc/issues/2157","id":1461629248,"node_id":"IC_kwDOBhmkcs5XHrFA","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-09T09:16:33Z","updated_at":"2023-03-09T09:16:33Z","author_association":"CONTRIBUTOR","body":"看了一下代码，SOFA协议应该是24字节吧\r\nhttps://github.com/apache/brpc/blob/2ec8f469f82a30c0abfb534f98b7fce0f0f77455/src/brpc/policy/sofa_pbrpc_protocol.cpp#L132-L138","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1461629248/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1461764585","html_url":"https://github.com/apache/brpc/issues/2157#issuecomment-1461764585","issue_url":"https://api.github.com/repos/apache/brpc/issues/2157","id":1461764585,"node_id":"IC_kwDOBhmkcs5XIMHp","user":{"login":"cmdmspaint","id":50624748,"node_id":"MDQ6VXNlcjUwNjI0NzQ4","avatar_url":"https://avatars.githubusercontent.com/u/50624748?v=4","gravatar_id":"","url":"https://api.github.com/users/cmdmspaint","html_url":"https://github.com/cmdmspaint","followers_url":"https://api.github.com/users/cmdmspaint/followers","following_url":"https://api.github.com/users/cmdmspaint/following{/other_user}","gists_url":"https://api.github.com/users/cmdmspaint/gists{/gist_id}","starred_url":"https://api.github.com/users/cmdmspaint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmdmspaint/subscriptions","organizations_url":"https://api.github.com/users/cmdmspaint/orgs","repos_url":"https://api.github.com/users/cmdmspaint/repos","events_url":"https://api.github.com/users/cmdmspaint/events{/privacy}","received_events_url":"https://api.github.com/users/cmdmspaint/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-09T10:36:09Z","updated_at":"2023-03-09T10:36:09Z","author_association":"NONE","body":"> body_size\r\n\r\nSOFA header是4(sofa_header) 4(meta_size) 8(body_size) 8(metasize+body_size) 这样的格式吗 ? 然后后面跟上sofa_pbrpc_meta.proto 怎么看起来还是不太对呢？\r\n![image](https://user-images.githubusercontent.com/50624748/223998760-dd94e768-55c7-42bc-bac3-e0af8f0fe373.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1461764585/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463116051","html_url":"https://github.com/apache/brpc/pull/2156#issuecomment-1463116051","issue_url":"https://api.github.com/repos/apache/brpc/issues/2156","id":1463116051,"node_id":"IC_kwDOBhmkcs5XNWET","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-10T02:16:13Z","updated_at":"2023-03-10T02:16:13Z","author_association":"CONTRIBUTOR","body":"> 1. 新增 `NOT_ALLOW_OPTIMIZE_THREAD_LOCAL_ACCESS` 用于控制是否允许编译器优化\r\n\r\n能否自动根据当前编译器和平台来决定是否开启这个宏？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463116051/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463138345","html_url":"https://github.com/apache/brpc/issues/2157#issuecomment-1463138345","issue_url":"https://api.github.com/repos/apache/brpc/issues/2157","id":1463138345,"node_id":"IC_kwDOBhmkcs5XNbgp","user":{"login":"cmdmspaint","id":50624748,"node_id":"MDQ6VXNlcjUwNjI0NzQ4","avatar_url":"https://avatars.githubusercontent.com/u/50624748?v=4","gravatar_id":"","url":"https://api.github.com/users/cmdmspaint","html_url":"https://github.com/cmdmspaint","followers_url":"https://api.github.com/users/cmdmspaint/followers","following_url":"https://api.github.com/users/cmdmspaint/following{/other_user}","gists_url":"https://api.github.com/users/cmdmspaint/gists{/gist_id}","starred_url":"https://api.github.com/users/cmdmspaint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmdmspaint/subscriptions","organizations_url":"https://api.github.com/users/cmdmspaint/orgs","repos_url":"https://api.github.com/users/cmdmspaint/repos","events_url":"https://api.github.com/users/cmdmspaint/events{/privacy}","received_events_url":"https://api.github.com/users/cmdmspaint/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-10T02:31:01Z","updated_at":"2023-03-10T02:31:01Z","author_association":"NONE","body":"我理解brpc包的结构是这样的，目前了解到RpcMessageHeader是24字节。\r\n![image](https://user-images.githubusercontent.com/50624748/224207552-ad2fbcf4-956b-4503-98dd-b4cb5c77db4b.png)\r\n这个是RpcMeta的结构，按照对应的字节数进行解析。为什么对不上呢？ enum类型应该是占4字节吧\r\nmessage RpcMeta {\r\n  enum Type {\r\n    REQUEST = 0;\r\n    RESPONSE = 1;\r\n  };\r\n  required Type type = 1;                 // 4bytes\r\n  required uint64 sequence_id = 2;  //8bytes\r\n  optional string method = 100;       \r\n  optional int64 server_timeout = 101;\r\n  optional bool failed = 200;\r\n  optional int32 error_code = 201;\r\n  optional string reason = 202;\r\n  optional CompressType compress_type = 300;\r\n  optional CompressType expected_response_compress_type = 301;\r\n}","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463138345/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463184856","html_url":"https://github.com/apache/brpc/issues/2157#issuecomment-1463184856","issue_url":"https://api.github.com/repos/apache/brpc/issues/2157","id":1463184856,"node_id":"IC_kwDOBhmkcs5XNm3Y","user":{"login":"cmdmspaint","id":50624748,"node_id":"MDQ6VXNlcjUwNjI0NzQ4","avatar_url":"https://avatars.githubusercontent.com/u/50624748?v=4","gravatar_id":"","url":"https://api.github.com/users/cmdmspaint","html_url":"https://github.com/cmdmspaint","followers_url":"https://api.github.com/users/cmdmspaint/followers","following_url":"https://api.github.com/users/cmdmspaint/following{/other_user}","gists_url":"https://api.github.com/users/cmdmspaint/gists{/gist_id}","starred_url":"https://api.github.com/users/cmdmspaint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmdmspaint/subscriptions","organizations_url":"https://api.github.com/users/cmdmspaint/orgs","repos_url":"https://api.github.com/users/cmdmspaint/repos","events_url":"https://api.github.com/users/cmdmspaint/events{/privacy}","received_events_url":"https://api.github.com/users/cmdmspaint/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-10T03:01:51Z","updated_at":"2023-03-10T03:01:51Z","author_association":"NONE","body":"是开了什么压缩导致的吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463184856/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463229810","html_url":"https://github.com/apache/brpc/pull/2156#issuecomment-1463229810","issue_url":"https://api.github.com/repos/apache/brpc/issues/2156","id":1463229810,"node_id":"IC_kwDOBhmkcs5XNx1y","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-10T04:15:13Z","updated_at":"2023-03-10T04:15:13Z","author_association":"CONTRIBUTOR","body":"> > 1. 新增 `NOT_ALLOW_OPTIMIZE_THREAD_LOCAL_ACCESS` 用于控制是否允许编译器优化\r\n> \r\n> 能否自动根据当前编译器和平台来决定是否开启这个宏？\r\n\r\ndone, 根据issue的反馈信息，目前仅针对 Clang/AppleClang 并且是 ARM/AArch 架构平台关闭优化。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463229810/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463350202","html_url":"https://github.com/apache/brpc/issues/2157#issuecomment-1463350202","issue_url":"https://api.github.com/repos/apache/brpc/issues/2157","id":1463350202,"node_id":"IC_kwDOBhmkcs5XOPO6","user":{"login":"cmdmspaint","id":50624748,"node_id":"MDQ6VXNlcjUwNjI0NzQ4","avatar_url":"https://avatars.githubusercontent.com/u/50624748?v=4","gravatar_id":"","url":"https://api.github.com/users/cmdmspaint","html_url":"https://github.com/cmdmspaint","followers_url":"https://api.github.com/users/cmdmspaint/followers","following_url":"https://api.github.com/users/cmdmspaint/following{/other_user}","gists_url":"https://api.github.com/users/cmdmspaint/gists{/gist_id}","starred_url":"https://api.github.com/users/cmdmspaint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmdmspaint/subscriptions","organizations_url":"https://api.github.com/users/cmdmspaint/orgs","repos_url":"https://api.github.com/users/cmdmspaint/repos","events_url":"https://api.github.com/users/cmdmspaint/events{/privacy}","received_events_url":"https://api.github.com/users/cmdmspaint/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-10T06:47:16Z","updated_at":"2023-03-10T06:47:16Z","author_association":"NONE","body":"看了一下代码 rpcmeta是通过protobuf进行了编码，应该是按照Base 128 Varints来进行压缩的。待会验证一下看看是否正确。\r\n![image](https://user-images.githubusercontent.com/50624748/224243432-0ebee61a-644f-4db4-bccd-aa272b93ef6b.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463350202/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463629527","html_url":"https://github.com/apache/brpc/issues/2159#issuecomment-1463629527","issue_url":"https://api.github.com/repos/apache/brpc/issues/2159","id":1463629527,"node_id":"IC_kwDOBhmkcs5XPTbX","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-10T10:55:48Z","updated_at":"2023-03-10T10:55:48Z","author_association":"CONTRIBUTOR","body":"这是tcp协议保证的，brpc不做crc检查","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463629527/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463638776","html_url":"https://github.com/apache/brpc/pull/2156#issuecomment-1463638776","issue_url":"https://api.github.com/repos/apache/brpc/issues/2156","id":1463638776,"node_id":"IC_kwDOBhmkcs5XPVr4","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-10T11:02:45Z","updated_at":"2023-03-10T11:02:45Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463638776/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463802874","html_url":"https://github.com/apache/brpc/issues/2157#issuecomment-1463802874","issue_url":"https://api.github.com/repos/apache/brpc/issues/2157","id":1463802874,"node_id":"IC_kwDOBhmkcs5XP9v6","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-10T13:26:42Z","updated_at":"2023-03-10T13:26:42Z","author_association":"MEMBER","body":"需要看具体解析或者序列化部分，部分协议只是内部用 protobuf 传递，而没有在网络传输时用，并不能完全按照 proto 文件解析。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1463802874/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1464715803","html_url":"https://github.com/apache/brpc/issues/2159#issuecomment-1464715803","issue_url":"https://api.github.com/repos/apache/brpc/issues/2159","id":1464715803,"node_id":"IC_kwDOBhmkcs5XTcob","user":{"login":"ravenxrz","id":44746032,"node_id":"MDQ6VXNlcjQ0NzQ2MDMy","avatar_url":"https://avatars.githubusercontent.com/u/44746032?v=4","gravatar_id":"","url":"https://api.github.com/users/ravenxrz","html_url":"https://github.com/ravenxrz","followers_url":"https://api.github.com/users/ravenxrz/followers","following_url":"https://api.github.com/users/ravenxrz/following{/other_user}","gists_url":"https://api.github.com/users/ravenxrz/gists{/gist_id}","starred_url":"https://api.github.com/users/ravenxrz/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ravenxrz/subscriptions","organizations_url":"https://api.github.com/users/ravenxrz/orgs","repos_url":"https://api.github.com/users/ravenxrz/repos","events_url":"https://api.github.com/users/ravenxrz/events{/privacy}","received_events_url":"https://api.github.com/users/ravenxrz/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-11T00:20:02Z","updated_at":"2023-03-11T00:20:02Z","author_association":"NONE","body":"好的，谢谢。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1464715803/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1465355267","html_url":"https://github.com/apache/brpc/issues/1087#issuecomment-1465355267","issue_url":"https://api.github.com/repos/apache/brpc/issues/1087","id":1465355267,"node_id":"IC_kwDOBhmkcs5XV4wD","user":{"login":"pengybhnu","id":24263233,"node_id":"MDQ6VXNlcjI0MjYzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/24263233?v=4","gravatar_id":"","url":"https://api.github.com/users/pengybhnu","html_url":"https://github.com/pengybhnu","followers_url":"https://api.github.com/users/pengybhnu/followers","following_url":"https://api.github.com/users/pengybhnu/following{/other_user}","gists_url":"https://api.github.com/users/pengybhnu/gists{/gist_id}","starred_url":"https://api.github.com/users/pengybhnu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pengybhnu/subscriptions","organizations_url":"https://api.github.com/users/pengybhnu/orgs","repos_url":"https://api.github.com/users/pengybhnu/repos","events_url":"https://api.github.com/users/pengybhnu/events{/privacy}","received_events_url":"https://api.github.com/users/pengybhnu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-13T00:58:01Z","updated_at":"2023-03-13T00:58:01Z","author_association":"NONE","body":"> c++ 或者python 用grpc 的时候也会报同样的错，但是没有window size 可以设置\r\n\r\nc++ 找到设置方法了么？参考[窗口大小](https://groups.google.com/g/grpc-io/c/3h-Q5Vjq5aUInitialWindowSize)可以通过 grpc.http2.lookahead_bytes 设置，还未找到手动设置ConnWindowSize。response过大时 grpc 客户端访问brpc 还是报FLOW_CONTROL_ERROR。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1465355267/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1465364824","html_url":"https://github.com/apache/brpc/issues/1087#issuecomment-1465364824","issue_url":"https://api.github.com/repos/apache/brpc/issues/1087","id":1465364824,"node_id":"IC_kwDOBhmkcs5XV7FY","user":{"login":"azhe198827","id":17900630,"node_id":"MDQ6VXNlcjE3OTAwNjMw","avatar_url":"https://avatars.githubusercontent.com/u/17900630?v=4","gravatar_id":"","url":"https://api.github.com/users/azhe198827","html_url":"https://github.com/azhe198827","followers_url":"https://api.github.com/users/azhe198827/followers","following_url":"https://api.github.com/users/azhe198827/following{/other_user}","gists_url":"https://api.github.com/users/azhe198827/gists{/gist_id}","starred_url":"https://api.github.com/users/azhe198827/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/azhe198827/subscriptions","organizations_url":"https://api.github.com/users/azhe198827/orgs","repos_url":"https://api.github.com/users/azhe198827/repos","events_url":"https://api.github.com/users/azhe198827/events{/privacy}","received_events_url":"https://api.github.com/users/azhe198827/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-13T01:17:19Z","updated_at":"2023-03-13T01:17:19Z","author_association":"NONE","body":"> > c++ 或者python 用grpc 的时候也会报同样的错，但是没有window size 可以设置\r\n> \r\n> c++ 找到设置方法了么？参考[窗口大小](https://groups.google.com/g/grpc-io/c/3h-Q5Vjq5aUInitialWindowSize)可以通过 grpc.http2.lookahead_bytes 设置，还未找到手动设置ConnWindowSize。response过大时 grpc 客户端访问brpc 还是报FLOW_CONTROL_ERROR。\r\n\r\n问题困扰两年多了，一直没有找到如何解决。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1465364824/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1465769275","html_url":"https://github.com/apache/brpc/issues/2145#issuecomment-1465769275","issue_url":"https://api.github.com/repos/apache/brpc/issues/2145","id":1465769275,"node_id":"IC_kwDOBhmkcs5XXd07","user":{"login":"chenzhangyi","id":6805583,"node_id":"MDQ6VXNlcjY4MDU1ODM=","avatar_url":"https://avatars.githubusercontent.com/u/6805583?v=4","gravatar_id":"","url":"https://api.github.com/users/chenzhangyi","html_url":"https://github.com/chenzhangyi","followers_url":"https://api.github.com/users/chenzhangyi/followers","following_url":"https://api.github.com/users/chenzhangyi/following{/other_user}","gists_url":"https://api.github.com/users/chenzhangyi/gists{/gist_id}","starred_url":"https://api.github.com/users/chenzhangyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenzhangyi/subscriptions","organizations_url":"https://api.github.com/users/chenzhangyi/orgs","repos_url":"https://api.github.com/users/chenzhangyi/repos","events_url":"https://api.github.com/users/chenzhangyi/events{/privacy}","received_events_url":"https://api.github.com/users/chenzhangyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-13T09:13:17Z","updated_at":"2023-03-13T09:13:17Z","author_association":"MEMBER","body":">     \t// blocked until reading is completed\r\n>    \tcntl.ReadProgressiveAttachmentBy(new MyProgressiveReader);\r\n这个只提供同步接口么？\r\n\r\n---\r\n\r\n> Enable the new server option in Server::StartInternal by\r\n\r\n这个应该是一个method级别的option。或者至少得是service级别。 不能是server级别。不然加了这个参数之后，一些service会出现undefined behavior.\r\n\r\n---\r\n为什么需要改acceptor？ 这个不应该是socket级别的东西么？ 应该只影响ProcessHttpRequest相关的吧，如果需要可以在对应的socket或者messenger里面加一些数据。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1465769275/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1467329957","html_url":"https://github.com/apache/brpc/issues/2163#issuecomment-1467329957","issue_url":"https://api.github.com/repos/apache/brpc/issues/2163","id":1467329957,"node_id":"IC_kwDOBhmkcs5Xda2l","user":{"login":"cdjingit","id":31362185,"node_id":"MDQ6VXNlcjMxMzYyMTg1","avatar_url":"https://avatars.githubusercontent.com/u/31362185?v=4","gravatar_id":"","url":"https://api.github.com/users/cdjingit","html_url":"https://github.com/cdjingit","followers_url":"https://api.github.com/users/cdjingit/followers","following_url":"https://api.github.com/users/cdjingit/following{/other_user}","gists_url":"https://api.github.com/users/cdjingit/gists{/gist_id}","starred_url":"https://api.github.com/users/cdjingit/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdjingit/subscriptions","organizations_url":"https://api.github.com/users/cdjingit/orgs","repos_url":"https://api.github.com/users/cdjingit/repos","events_url":"https://api.github.com/users/cdjingit/events{/privacy}","received_events_url":"https://api.github.com/users/cdjingit/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-14T04:13:25Z","updated_at":"2023-03-14T04:13:25Z","author_association":"CONTRIBUTOR","body":"哪个版本触发的？可能是dump线程访问了销毁的bvar导致的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1467329957/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1467645632","html_url":"https://github.com/apache/brpc/issues/2145#issuecomment-1467645632","issue_url":"https://api.github.com/repos/apache/brpc/issues/2145","id":1467645632,"node_id":"IC_kwDOBhmkcs5Xen7A","user":{"login":"TangSiyang2001","id":82279870,"node_id":"MDQ6VXNlcjgyMjc5ODcw","avatar_url":"https://avatars.githubusercontent.com/u/82279870?v=4","gravatar_id":"","url":"https://api.github.com/users/TangSiyang2001","html_url":"https://github.com/TangSiyang2001","followers_url":"https://api.github.com/users/TangSiyang2001/followers","following_url":"https://api.github.com/users/TangSiyang2001/following{/other_user}","gists_url":"https://api.github.com/users/TangSiyang2001/gists{/gist_id}","starred_url":"https://api.github.com/users/TangSiyang2001/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TangSiyang2001/subscriptions","organizations_url":"https://api.github.com/users/TangSiyang2001/orgs","repos_url":"https://api.github.com/users/TangSiyang2001/repos","events_url":"https://api.github.com/users/TangSiyang2001/events{/privacy}","received_events_url":"https://api.github.com/users/TangSiyang2001/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-14T08:40:49Z","updated_at":"2023-03-14T11:02:51Z","author_association":"CONTRIBUTOR","body":"> 这个只提供同步接口么？\r\n\r\n我们是否可以采用将`done`传入progressive reader的方式来实现异步接口，然用户在合适的时候适时调用done->Run()？如果可行那么目前的设计可以cover这种方式。\r\n***\r\n> 这个应该是一个method级别的option。或者至少得是service级别。 不能是server级别。不然加了这个参数之后，一些service会出现undefined behavior.\r\n\r\n确实如此，本计划实现method级别的option，但暂时没有想到比较理想的方式，由于调用时序的关系，只有在ProcessHttpRequest被调用后，才能确定调用的method。\r\n见ProcessHttpRequest\r\n```cpp\r\nconst Server::MethodProperty* const sp =\r\n        FindMethodPropertyByURI(path, server, &req_header._unresolved_path);\r\n// ...\r\ngoogle::protobuf::Service* svc = sp->service;\r\nconst google::protobuf::MethodDescriptor* method = sp->method;\r\n```\r\n而是否以progressive方式读取取决于socket层的设置，应在相应socket建立之前就确定下来，即需要在`Socket::Create`中调用\r\n```cpp\r\nm->read_will_be_progressive(CONNECTION_TYPE_SHORT);\r\n```\r\n该调用时机显然在ProcessHttpRequest之前，因此认为难以设计method级别的option。service级别的option原因类似。\r\n\r\n但是目前这个思路允许指定用户对于某些需要使用自定义progressive reader的method进行指定，而对于未指定的method，使用内置的builtin proxy reader，在所有数据传递完毕后一次性回调用户的method\r\n***\r\n>为什么需要改acceptor？ 这个不应该是socket级别的东西么？ 应该只影响ProcessHttpRequest相关的吧，如果需要可以在对应的socket或者messenger里面加一些数据。\r\n\r\n如果按照以上需要在`Socket::Create`中调用\r\n```cpp\r\nm->read_will_be_progressive(CONNECTION_TYPE_SHORT);\r\n```\r\n的准则，那么需要在`Acceptor::OnNewConnectionsUntilEAGAIN`调用`Socket::Create`之前传入相应的SocketOption，而按原先的设计，就需要在Acceptor中记录相应的ServerOption，以在其创建Socket时能设置正确的SocketOption\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1467645632/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1467979833","html_url":"https://github.com/apache/brpc/issues/2145#issuecomment-1467979833","issue_url":"https://api.github.com/repos/apache/brpc/issues/2145","id":1467979833,"node_id":"IC_kwDOBhmkcs5Xf5g5","user":{"login":"chenzhangyi","id":6805583,"node_id":"MDQ6VXNlcjY4MDU1ODM=","avatar_url":"https://avatars.githubusercontent.com/u/6805583?v=4","gravatar_id":"","url":"https://api.github.com/users/chenzhangyi","html_url":"https://github.com/chenzhangyi","followers_url":"https://api.github.com/users/chenzhangyi/followers","following_url":"https://api.github.com/users/chenzhangyi/following{/other_user}","gists_url":"https://api.github.com/users/chenzhangyi/gists{/gist_id}","starred_url":"https://api.github.com/users/chenzhangyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenzhangyi/subscriptions","organizations_url":"https://api.github.com/users/chenzhangyi/orgs","repos_url":"https://api.github.com/users/chenzhangyi/repos","events_url":"https://api.github.com/users/chenzhangyi/events{/privacy}","received_events_url":"https://api.github.com/users/chenzhangyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-14T12:06:37Z","updated_at":"2023-03-14T12:40:02Z","author_association":"MEMBER","body":"@TangSiyang2001 http解析消息的时候，是可以知道是不是header complete的，如果在这个之后判断，是不是能简化问题？ 因为method相关的，在header中就拿到了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1467979833/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]