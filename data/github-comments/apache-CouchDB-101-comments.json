[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/833900500","html_url":"https://github.com/apache/couchdb/issues/3472#issuecomment-833900500","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3472","id":833900500,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzkwMDUwMA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T22:03:08Z","updated_at":"2021-05-06T22:03:08Z","author_association":"MEMBER","body":"@jiahuili430 That is only during our testing; it is not supported for production use and is disabled unless special steps are taken to enable it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/833900500/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/834729928","html_url":"https://github.com/apache/couchdb/pull/3208#issuecomment-834729928","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3208","id":834729928,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNDcyOTkyOA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-07T19:46:29Z","updated_at":"2021-05-07T19:46:29Z","author_association":"CONTRIBUTOR","body":"The fix was merged upstream https://github.com/cmullaparthi/ibrowse/commit/232f83c7af03f36c52b73af2af7e9ea0de2e043c\r\n\r\nWe'll need to set that option in our replicator ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/834729928/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/834755119","html_url":"https://github.com/apache/couchdb/pull/3208#issuecomment-834755119","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3208","id":834755119,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNDc1NTExOQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-07T20:30:15Z","updated_at":"2021-05-07T20:30:15Z","author_association":"MEMBER","body":"@Closing in favour of #3551 and @nickva if possible backport to `3.x` appreciated, thank you!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/834755119/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/834818552","html_url":"https://github.com/apache/couchdb/pull/3551#issuecomment-834818552","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3551","id":834818552,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNDgxODU1Mg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-07T22:16:23Z","updated_at":"2021-05-07T22:21:59Z","author_association":"CONTRIBUTOR","body":"`ibrowse` has unit tests now, which run and pass. However, they use a deprecated `ssl:ssl_accept` function.\r\n\r\nPR https://github.com/cmullaparthi/ibrowse/pull/172 for upstream","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/834818552/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/836141949","html_url":"https://github.com/apache/couchdb/pull/3551#issuecomment-836141949","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3551","id":836141949,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNjE0MTk0OQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-10T04:09:46Z","updated_at":"2021-05-10T04:09:46Z","author_association":"CONTRIBUTOR","body":"Upstream PR was merged, I created a new ibrowse + our patches release and updated the PR. It now passes the CI.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/836141949/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/836149763","html_url":"https://github.com/apache/couchdb/pull/3551#issuecomment-836149763","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3551","id":836149763,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNjE0OTc2Mw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-10T04:23:04Z","updated_at":"2021-05-10T04:23:04Z","author_association":"CONTRIBUTOR","body":"@wohali waiting to resolve https://github.com/apache/couchdb/pull/3551#discussion_r628517446","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/836149763/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/836996618","html_url":"https://github.com/apache/couchdb/pull/3553#issuecomment-836996618","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3553","id":836996618,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNjk5NjYxOA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-10T17:19:35Z","updated_at":"2021-05-10T17:19:35Z","author_association":"CONTRIBUTOR","body":"@bessbd the error comes from trying to acquire a map context. Would this usually be considered a user error (bad javascript, values are too large, etc) or server-side error, as in we something is broken with the backend (operator misconfigured the language server backend).  If the error is from a misconfigured query language server, wonder if failing the job after 3 tries would make sense. If the backend is fixed, would the user still get a failed error, if so it might be better to perhaps keep retrying longer.\r\n\r\nHow retries happens is a bit subtle too it seems... Notice when we retry we simply abandon the job. We exit the  but still keep ownership of the job https://github.com/apache/couchdb/pull/3553/files#diff-228d2a0ae65ae417bf4b3fb19f0de9f886c2ae168ab9fbec8e5f86b93934e6f7R148. It would eventually timeout based on https://github.com/apache/couchdb/blob/c75a9b66965939e470ed5f3f2749626d3f35d311/src/couch_views/src/couch_views_jobs.erl#L33 and rely on the job activity monitor re-enqueuing the jobs. That's not the worst and it would provide a backoff of sorts but it certainly subtle.\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/836996618/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/837370769","html_url":"https://github.com/apache/couchdb/pull/3402#issuecomment-837370769","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3402","id":837370769,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNzM3MDc2OQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-10T21:25:51Z","updated_at":"2021-05-10T21:25:51Z","author_association":"CONTRIBUTOR","body":"@tonysun83 reminded me that `_up` endpoint already checks FDB connectivity:\r\n\r\nhttps://github.com/apache/couchdb/blob/main/src/chttpd/src/chttpd_misc.erl#L368\r\n\r\nHowever, we may want to add a minor improvement where we don't let the `_up` request directly go to the FDB backend as we might not want unauthenticated requests to necessarily start read transactions. We could, for example have the `fabric2_server` periodically make that `list_dbs` call (or simply just get the metadata version) and update a fabric app environment variable or put it in some ETS table then the `_up` endpoint would only read from there and return. It might also let us define exactly what the node (pods, containers?) would do when FDB becomes unavailable for a while - keep trying to maybe stop the VM.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/837370769/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/837701672","html_url":"https://github.com/apache/couchdb/pull/3402#issuecomment-837701672","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3402","id":837701672,"node_id":"MDEyOklzc3VlQ29tbWVudDgzNzcwMTY3Mg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-11T03:05:00Z","updated_at":"2021-05-11T03:05:00Z","author_association":"CONTRIBUTOR","body":"I think can close the PR. @janosgyerman if you want to resubmit or continue working on it, feel free to reopen it","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/837701672/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/840979261","html_url":"https://github.com/apache/couchdb/issues/3562#issuecomment-840979261","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3562","id":840979261,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MDk3OTI2MQ==","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-14T03:23:11Z","updated_at":"2021-05-14T03:23:11Z","author_association":"MEMBER","body":"You're correct about the current implementation of the `skip` parameter. We keep statistics at the shard level that allow for efficient skipping of rows, but there's a bit of subtlety in computing the correct number of rows to skip in each shard of a database comprised of multiple shards. I sketched a solution to the problem in JIRA several years ago:\r\n\r\nhttps://issues.apache.org/jira/browse/COUCHDB-2784\r\n\r\nQuoting here:\r\n\r\n> For a database with Q shards and a request specifying ?skip=X We know that either a) at least one of the shards will end skipping at least `X / Q` rows, or b) the entire response body will be empty. So, I propose the following:\r\n> 1. Set the per-shard skip value to `X div Q`\r\n>     - If a shard has fewer than `X div Q` rows remaining it should send its last row\r\n>     - If `X div Q` is zero we can short-circuit and just use the current algorithm.\r\n> 1. The coordinator sorts the first responses from each shard. It then sends the key of the row that sorts first (let's call it Foo) back to all the shards\r\n> 1. Each shard counts the number of rows in between the original startkey and Foo and sends that number, then starts streaming with Foo as the new startkey\r\n> 1. The coordinator deducts the computed per-shard skip values from the user-specified skip and then takes care of the remainder in the usual way we do it today (i.e. by consuming the rows as they come in).\r\n>\r\n> [T]he algorithm could be executed recursively, e.g. if after one pass we're still left trying to consume a million rows in the coordinator we can farm that out to the shards again and identify an even better start key (Foo 2.0). Lather, rinse, repeat until the number of rows that would be consumed by the coordinator is acceptably small.\r\n\r\nIt's a moderately complex patch, and won't apply to 4.0. Efficient skips might be possible in 4.0 but it depends a bit on what sorts of statistics we might maintain in any index data structures we implement over FoundationDB (FDB itself doesn't provide any).\r\n\r\nI think we have a documentation bug here; we imply that large values of `skip` are fast for any release after 1.2, when it's really only fast for 1.x where x>2. But I would not call this a bug in CouchDB itself.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/840979261/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/841297969","html_url":"https://github.com/apache/couchdb/pull/3553#issuecomment-841297969","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3553","id":841297969,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MTI5Nzk2OQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-14T15:00:02Z","updated_at":"2021-05-14T15:00:02Z","author_association":"MEMBER","body":"> Looks good. Good idea to write tests. Just a few minor formatting issue then +1\r\n\r\nThank you for the review, @nickva . I believe I've pushed commits for all the changes you've requested. Also, I ran emilio on the problematic files so they should be good now.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/841297969/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/841322154","html_url":"https://github.com/apache/couchdb/pull/3553#issuecomment-841322154","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3553","id":841322154,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MTMyMjE1NA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-14T15:40:03Z","updated_at":"2021-05-14T15:40:03Z","author_association":"CONTRIBUTOR","body":"@bessbd we did try to integrate it, there is a `make emilio` [check](https://github.com/apache/couchdb/blob/main/Makefile#L209). One tricky part is having to figure out warning for existing code vs new code. One day we could perhaps one large reformat pass and have everything compliant with emilio. There is a formatter we could use too: https://github.com/WhatsApp/erlfmt","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/841322154/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/841611406","html_url":"https://github.com/apache/couchdb/pull/3553#issuecomment-841611406","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3553","id":841611406,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MTYxMTQwNg==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-15T06:51:33Z","updated_at":"2021-05-15T06:51:33Z","author_association":"MEMBER","body":"Thank you for the approve, @nickva ! I'm about to merge this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/841611406/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/841694221","html_url":"https://github.com/apache/couchdb/pull/3564#issuecomment-841694221","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3564","id":841694221,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MTY5NDIyMQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-15T17:06:37Z","updated_at":"2021-05-15T17:06:37Z","author_association":"MEMBER","body":"Thank you for the review, @nickva ! I'm about to merge this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/841694221/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/841862668","html_url":"https://github.com/apache/couchdb/pull/3546#issuecomment-841862668","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3546","id":841862668,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MTg2MjY2OA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-16T19:08:42Z","updated_at":"2021-05-16T19:10:08Z","author_association":"CONTRIBUTOR","body":"I think there may be a few incompatibility issues here and we should fix it up a bit better.\r\n\r\nOne issue is unquoting the '+' symbol into a space ' '. Technically the '+' is a valid character in userinfo part. This means a password which had a '+' in it, like say \"a+b\" used to work just fine now will fail because we'd decode into \"a b\". This probably means we'd have to make our own unquoting logic and excluding the '+' sign from it at least.\r\n\r\nAnother issue is passwords which had '%HH` sequence where 'H' is any hex digit would also be decoded into something which will not match the original password. Not sure how serious one one would be. Maybe we document it and ask users to double-check their replications after the upgrade. Or perhaps have config option to let uses opt out of using decoding for the userinfo part like we did in previous issues too.\r\n\r\n\r\nThis was prompted by the @flimzy's findings in the related issue https://github.com/apache/couchdb/issues/3565","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/841862668/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/841866009","html_url":"https://github.com/apache/couchdb/issues/3565#issuecomment-841866009","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3565","id":841866009,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MTg2NjAwOQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-16T19:33:41Z","updated_at":"2021-05-16T19:34:53Z","author_association":"CONTRIBUTOR","body":"I think it's coming from mochiweb were it calls [unquote]( https://github.com/mochi/mochiweb/blob/070594e4d66163d662ac7e3bfb75dadcc922dd7c/src/mochiweb_request.erl#L214) on the path but it actually uses the [unquote_plus](https://github.com/mochi/mochiweb/blob/070594e4d66163d662ac7e3bfb75dadcc922dd7c/src/mochiweb_util.erl#L256-L257) decoding logic where a `+` would be turned into a space. \r\n\r\nRecently we encountered a somewhat similar issue with userinfo decoding/decoding in replicator in https://github.com/apache/couchdb/pull/3546. Where, according to the RFC, it turns out `+` is a valid userinfo character as well but we would decode it into a space now if we just the use the decode logic in mochiweb.\r\n\r\nAgree, not sure what a good way to fix this is in a backwards compatible way. Could be it's a 4.0 feature or we just document that `+` will always be decoded to a space and if you want a `+` in doc id it would have to be url encoded.\r\n\r\nFor how other libraries handle the issue I found this one pretty well done:\r\nhttps://boltons.readthedocs.io/en/latest/_modules/boltons/urlutils.html","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/841866009/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/842328429","html_url":"https://github.com/apache/couchdb/pull/957#issuecomment-842328429","issue_url":"https://api.github.com/repos/apache/couchdb/issues/957","id":842328429,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MjMyODQyOQ==","user":{"login":"Sebatyne","id":4323193,"node_id":"MDQ6VXNlcjQzMjMxOTM=","avatar_url":"https://avatars.githubusercontent.com/u/4323193?v=4","gravatar_id":"","url":"https://api.github.com/users/Sebatyne","html_url":"https://github.com/Sebatyne","followers_url":"https://api.github.com/users/Sebatyne/followers","following_url":"https://api.github.com/users/Sebatyne/following{/other_user}","gists_url":"https://api.github.com/users/Sebatyne/gists{/gist_id}","starred_url":"https://api.github.com/users/Sebatyne/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Sebatyne/subscriptions","organizations_url":"https://api.github.com/users/Sebatyne/orgs","repos_url":"https://api.github.com/users/Sebatyne/repos","events_url":"https://api.github.com/users/Sebatyne/events{/privacy}","received_events_url":"https://api.github.com/users/Sebatyne/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-17T13:33:04Z","updated_at":"2021-05-17T13:33:04Z","author_association":"NONE","body":"Hi,\r\n\r\nI read in https://github.com/apache/couchdb/issues/959 that :\r\n\r\n> The replicator now supports session.\r\n\r\nMaybe I missed some discussions, but could this Merge Request be open again ?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/842328429/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/842536065","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-842536065","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":842536065,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MjUzNjA2NQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-17T18:23:16Z","updated_at":"2021-05-17T18:23:16Z","author_association":"CONTRIBUTOR","body":"I propose to employ a unified scale so we can collect feedback on the same formatting changes.\r\nThis would allow us to make better decisions. I also expect people to complain more than praise therefore I propose a skewed scale. \r\nI propose to rate the changes based on following scale:\r\n\r\n-5 - -1 - a scale from negative 5 to negative 1 how badly I disagree with the change. Where -5 is I cannot stand it and -1 is I don't like it but can tolerate. \r\n0 - neutral - I don't really care\r\n+1 - I like the change even if I am not used to it.\r\n+2 - this is a great\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/842536065/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/842542159","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-842542159","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":842542159,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MjU0MjE1OQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-17T18:33:27Z","updated_at":"2021-05-17T18:36:11Z","author_association":"MEMBER","body":"Thank you all for the very quick feedback!\r\nAccording to https://github.com/WhatsApp/erlfmt#comparison-with-other-erlang-formatters , erlfmt is meant to be opinionated with little to no configuration available. If we believe this PR is a net-negative change, I'll close it. If we think erlfmt is not right for us, but exploring another formatter is worth it, please let me know.\r\n\r\nEdit: or do we want erlfmt with some files excluded?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/842542159/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/842569320","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-842569320","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":842569320,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MjU2OTMyMA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-17T19:17:29Z","updated_at":"2021-05-17T19:17:29Z","author_association":"CONTRIBUTOR","body":"Nice work @bessbd. \r\n\r\n * I like that it is consistent and it auto-formats the code that is a big plus and it removes a good amount of back-and-forth during reviews\r\n \r\n * Good call to check the hashes before and after, that's a neat trick!\r\n \r\n * Some erlfmt choices are odd, such as putting `->` on a line by itself. I don't like it but not a deal breaker compared to other benefits\r\n\r\n * In general I would prefer 80 columns (that is configurable `erlfmt --print-width=80`) but if most people would want to stick with the default 100 that's ok too. It seems, based on how case nesting is reformatted (always indented with 4 spaces) some places like auth handlers end up being squished to the right even with 100 columns. With 80 it would be worse so I can live with 100 columns.\r\n\r\n * I don't like the spacing between functions as much, I prefer one line between function head clauses, and two lines between functions. However, if erlfmt means having consistency I am ok sticking with erlfmt's way.\r\n\r\nBased on @iilyak's scale (-5...+2), I'd go with +1 as an average of my choices. But also think we should wait perhaps until erlfmt reaches 1.0 and maybe gather more feedback (possibly with a post on dev@couchdb?). Also wonder if there any chance convincing erlfmt authors to change their mind about a few of the most disliked features here such as `->` being on its own line.\r\n\r\nAnother issue is being able to cherry-pick commits between `3.x` and `main`. We have two recent PRs, for example, (Erlang 24 support and a pending one for moving chttpd/httpd settings around) that would apply neatly to both branches, but if we reformat one branch those won't apply as easily. Not a deal breaker, but perhaps we would run erlfmt on both main and 3.x at the same time and maybe coordinating with pending PR authors.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/842569320/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844025759","html_url":"https://github.com/apache/couchdb/issues/3565#issuecomment-844025759","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3565","id":844025759,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NDAyNTc1OQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-19T11:48:45Z","updated_at":"2021-05-19T11:48:45Z","author_association":"MEMBER","body":"I think this is a duplicate of https://github.com/apache/couchdb/issues/2235","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844025759/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844026225","html_url":"https://github.com/apache/couchdb/issues/3565#issuecomment-844026225","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3565","id":844026225,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NDAyNjIyNQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-19T11:49:40Z","updated_at":"2021-05-19T11:49:40Z","author_association":"MEMBER","body":"Maybe it's time to fix this :D ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844026225/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844039917","html_url":"https://github.com/apache/couchdb/pull/3569#issuecomment-844039917","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3569","id":844039917,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NDAzOTkxNw==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-19T12:07:28Z","updated_at":"2021-05-19T12:07:28Z","author_association":"CONTRIBUTOR","body":"This solution doesn't match the proposal in the https://github.com/apache/couchdb/issues/3560. Do we know for sure the result we return corresponds to the transaction which succeeded?\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844039917/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844039944","html_url":"https://github.com/apache/couchdb/issues/3565#issuecomment-844039944","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3565","id":844039944,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NDAzOTk0NA==","user":{"login":"flimzy","id":8555063,"node_id":"MDQ6VXNlcjg1NTUwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8555063?v=4","gravatar_id":"","url":"https://api.github.com/users/flimzy","html_url":"https://github.com/flimzy","followers_url":"https://api.github.com/users/flimzy/followers","following_url":"https://api.github.com/users/flimzy/following{/other_user}","gists_url":"https://api.github.com/users/flimzy/gists{/gist_id}","starred_url":"https://api.github.com/users/flimzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flimzy/subscriptions","organizations_url":"https://api.github.com/users/flimzy/orgs","repos_url":"https://api.github.com/users/flimzy/repos","events_url":"https://api.github.com/users/flimzy/events{/privacy}","received_events_url":"https://api.github.com/users/flimzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-19T12:07:29Z","updated_at":"2021-05-19T12:07:29Z","author_association":"MEMBER","body":"@bessbd I think you're right. On both counts :grin: ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844039944/reactions","total_count":1,"+1":0,"-1":0,"laugh":1,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844161884","html_url":"https://github.com/apache/couchdb/issues/3565#issuecomment-844161884","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3565","id":844161884,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NDE2MTg4NA==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-19T14:30:28Z","updated_at":"2021-05-19T14:30:28Z","author_association":"MEMBER","body":"Can we close this, @flimzy ?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844161884/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844234395","html_url":"https://github.com/apache/couchdb/pull/3569#issuecomment-844234395","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3569","id":844234395,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NDIzNDM5NQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-19T15:50:16Z","updated_at":"2021-05-20T05:01:43Z","author_association":"CONTRIBUTOR","body":"@iilyak Oh good question. \r\n\r\nI think it should always be the last commit unknown result because as soon as there is at least one `commit_unknown_result` in the sequence of retries, we will always try to return that result to the user, and not run the transaction closure again https://github.com/apache/couchdb/blob/e5699e5c10bd0131ab9fe3a04bcc1568c1a16186/src/fabric/src/fabric2_fdb.erl#L186\r\n\r\nBut when we try to return the last result we still have to perform a few FDB operations which would also be an area where retries would be thrown, for example here https://github.com/apache/couchdb/blob/e5699e5c10bd0131ab9fe3a04bcc1568c1a16186/src/fabric/src/fabric2_fdb.erl#L2024 and we don't want those retryable errors to reset the fact that we're still have a commit_unknown_result to handle.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844234395/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844378799","html_url":"https://github.com/apache/couchdb/issues/3560#issuecomment-844378799","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3560","id":844378799,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NDM3ODc5OQ==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-19T18:52:37Z","updated_at":"2021-05-19T18:52:37Z","author_association":"CONTRIBUTOR","body":"I got 3 clean runs from `make buggify-elixir-suite` against main commit d29999cd3f85072d40633a1befe4a29a670890fd after which I started seeing things like this in the logs, and the complete failure of couchdb to even start up before any tests could be run. @nickva have you also seen such crashes? I'm not really sure how to interpret this, although I'm seeing what looks like both a `1009` and `4100` in close succession. \r\n\r\n```\r\n[info] 2021-05-19T05:55:43.916238Z node1@127.0.0.1 <0.273.0> -------- Preflight check: Asserting Admin Account\r\n\r\n[error] 2021-05-19T05:55:43.917339Z node1@127.0.0.1 <0.274.0> -------- No Admin Account configured. Please configure an Admin Account in your local.ini file and restart CouchDB.\r\n\r\n[info] 2021-05-19T05:55:43.918794Z node1@127.0.0.1 <0.273.0> -------- Apache CouchDB 3.0.0-d29999c is starting.\r\n\r\n[info] 2021-05-19T05:55:43.918839Z node1@127.0.0.1 <0.275.0> -------- Starting couch_sup\r\n[info] 2021-05-19T05:55:43.988198Z node1@127.0.0.1 <0.273.0> -------- Apache CouchDB has started. Time to relax.\r\n\r\n[error] 2021-05-19T05:55:45.521088Z node1@127.0.0.1 <0.361.0> -------- Mango index erlfdb error Db _users Doc <<\"_design/_auth\">> 1009\r\nInternal Error @ ./flow/flow.h 456:\r\n  atos -o libfdb_c.dylib-debug -arch x86_64 -l 0x1d600000 0x1d9f8759 0x1d8921f5 0x1d85ea5b 0x1d85eb37 0x1d71ac19 0x1d84be86 0x1d84d298 0x1d84ca35 0x1d85e8a8 0x1d850cf8 0x1d84bc53 0x1d85d638 0x1d858052 0x1d85c658 0x1d85c246 0x1d85ae48 0x1d85a666 0x1d856dc8 0x1d8562df 0x1d842978 0x1d8427b6 0x1d982b99 0x1d9825a5 0x1da4b3a8 0x1da8c2f6 0x1da87b0d 0x1d74f487 0x1d91d33c 0x1d7163e4 0x1d601958 0x17f6ef1a 0x17d678fe 0x7fff708e4109 0x7fff708dfb8b\r\n[error] 2021-05-19T05:55:45.590806Z node1@127.0.0.1 <0.402.0> -------- CRASH REPORT Process  (<0.402.0>) with 0 neighbors crashed with reason: {erlfdb_error,4100} at erlfdb_nif:erlfdb_future_get/1 <= erlfdb:do_transaction/2(line:689) <= fabric2_fdb:do_transaction/3(line:175) <= fabric2_fdb:transactional/3(line:146) <= couch_jobs:set_type_timeout/2(line:323) <= couch_views_server:init/1(line:52) <= gen_server:init_it/2(line:374) <= gen_server:init_it/6(line:342); initial_call: {couch_views_server,init,['Argument__1']}, ancestors: [couch_views_sup,<0.400.0>], message_queue_len: 0, links: [<0.401.0>], dictionary: [{'$erlfdb_error',4100},{'$fabric_db_handle',{erlfdb_database,#Ref<0.2384732776.224788482.26227>}},...], trap_exit: true, status: running, heap_size: 987, stack_size: 27, reductions: 795\r\n[error] 2021-05-19T05:55:45.591027Z node1@127.0.0.1 <0.401.0> -------- Supervisor couch_views_sup had child couch_views_server started with couch_views_server:start_link() at undefined exit with reason {erlfdb_error,4100} at erlfdb_nif:erlfdb_future_get/1 <= erlfdb:do_transaction/2(line:689) <= fabric2_fdb:do_transaction/3(line:175) <= fabric2_fdb:transactional/3(line:146) <= couch_jobs:set_type_timeout/2(line:323) <= couch_views_server:init/1(line:52) <= gen_server:init_it/2(line:374) <= gen_server:init_it/6(line:342) in context start_error\r\n[error] 2021-05-19T05:55:45.591314Z node1@127.0.0.1 <0.399.0> -------- CRASH REPORT Process  (<0.399.0>) with 0 neighbors exited with reason: {{shutdown,{failed_to_start_child,couch_views_server,{{erlfdb_error,4100},[{erlfdb_nif,erlfdb_future_get,[#Ref<0.2384732776.224788482.27142>],[]},{erlfdb,do_transaction,2,[{file,\"src/erlfdb.erl\"},{line,689}]},{fabric2_fdb,do_transaction,3,[{file,\"src/fabric2_fdb.erl\"},{line,175}]},{fabric2_fdb,transactional,3,[{file,\"src/fabric2_fdb.erl\"},{line,146}]},{couch_jobs,set_type_timeout,2,[{file,\"src/couch_jobs.erl\"},{line,323}]},{couch_views_server,init,1,[{file,\"src/couch_views_server.erl\"},{line,...}]},...]}}},...} at application_master:init/4(line:138) <= proc_lib:init_p_do_apply/3(line:249); initial_call: {application_master,init,['Argument__1','Argument__2',...]}, ancestors: [<0.398.0>], message_queue_len: 1, links: [<0.398.0>,<0.44.0>], dictionary: [], trap_exit: true, status: running, heap_size: 610, stack_size: 27, reductions: 237\r\n[info] 2021-05-19T05:55:45.591672Z node1@127.0.0.1 <0.44.0> -------- Application couch_views exited with reason: {{shutdown,{failed_to_start_child,couch_views_server,{{erlfdb_error,4100},[{erlfdb_nif,erlfdb_future_get,[#Ref<0.2384732776.224788482.27142>],[]},{erlfdb,do_transaction,2,[{file,\"src/erlfdb.erl\"},{line,689}]},{fabric2_fdb,do_transaction,3,[{file,\"src/fabric2_fdb.erl\"},{line,175}]},{fabric2_fdb,transactional,3,[{file,\"src/fabric2_fdb.erl\"},{line,146}]},{couch_jobs,set_type_timeout,2,[{file,\"src/couch_jobs.erl\"},{line,323}]},{couch_views_server,init,1,[{file,\"src/couch_views_server.erl\"},{line,...}]},...]}}},...}\r\n[error] 2021-05-19T05:55:50.595237Z node1@127.0.0.1 <0.296.0> -------- Supervisor fabric2_sup had child fabric2_db_expiration started with fabric2_db_expiration:start_link() at <0.334.0> exit with reason killed in context shutdown_error\r\n{\"Kernel pid terminated\",application_controller,\"{application_start_failure,couch_views,{{shutdown,{failed_to_start_child,couch_views_server,{{erlfdb_error,4100},[{erlfdb_nif,erlfdb_future_get,[#Ref<0.2384732776.224788482.27142>],[]},{erlfdb,do_transaction,2,[{file,\\\"src/erlfdb.erl\\\"},{line,689}]},{fabric2_fdb,do_transaction,3,[{file,\\\"src/fabric2_fdb.erl\\\"},{line,175}]},{fabric2_fdb,transactional,3,[{file,\\\"src/fabric2_fdb.erl\\\"},{line,146}]},{couch_jobs,set_type_timeout,2,[{file,\\\"src/couch_jobs.erl\\\"},{line,323}]},{couch_views_server,init,1,[{file,\\\"src/couch_views_server.erl\\\"},{line,52}]},{gen_server,init_it,2,[{file,\\\"gen_server.erl\\\"},{line,374}]},{gen_server,init_it,6,[{file,\\\"gen_server.erl\\\"},{line,342}]}]}}},{couch_views_app,start,[normal,[]]}}}\"}\r\nKernel pid terminated (application_controller) ({application_start_failure,couch_views,{{shutdown,{failed_to_start_child,couch_views_server,{{erlfdb_error,4100},[{erlfdb_nif,erlfdb_future_get,[#Ref<0.\r\n\r\nCrash dump is being written to: erl_crash.dump...done\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844378799/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844410551","html_url":"https://github.com/apache/couchdb/issues/3560#issuecomment-844410551","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3560","id":844410551,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NDQxMDU1MQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-19T19:37:29Z","updated_at":"2021-05-19T19:37:29Z","author_association":"CONTRIBUTOR","body":"@jaydoane ooh a 4100 - an internal FoundationDB crash. Never seen that before!\r\n\r\nhttps://apple.github.io/foundationdb/api-error-codes.html\r\n\r\nI wonder what happened. That's not an expected result of this PR I think. Try running on master a few times perhaps you found a legitimate bug in FDB. Maybe it's an access or file limit error or somesuch.\r\n\r\nI run most of the test with a recent-ish 6.3 branch built from scratch using. Did you use a downloaded package from Apple?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844410551/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844445117","html_url":"https://github.com/apache/couchdb/issues/3560#issuecomment-844445117","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3560","id":844445117,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NDQ0NTExNw==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-19T20:24:38Z","updated_at":"2021-05-19T20:24:38Z","author_association":"CONTRIBUTOR","body":"That run above was from main, so not due to your PR. I did find this, however, which looks a lot like the same issue: https://forums.foundationdb.org/t/client-side-buggify-internal-error/1824\r\n\r\nI'm running 6.2.10 from FoundationDB-6.2.10.pkg so maybe time to upgrade. Or maybe not, since I'm hitting this issue: https://github.com/apple/foundationdb/issues/4629","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844445117/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844467186","html_url":"https://github.com/apache/couchdb/issues/3560#issuecomment-844467186","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3560","id":844467186,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NDQ2NzE4Ng==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-19T20:57:10Z","updated_at":"2021-05-19T20:57:10Z","author_association":"CONTRIBUTOR","body":"@jaydoane nice find! that does look similar.\r\n\r\nTry upgrading to 6.3. Or if you'd want to take the plunge and compile it from scratch :-) https://gist.github.com/nickva/3ccba519c2307a584dfbda07381d215a","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844467186/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844528022","html_url":"https://github.com/apache/couchdb/issues/3560#issuecomment-844528022","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3560","id":844528022,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NDUyODAyMg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-19T22:09:35Z","updated_at":"2021-05-19T22:09:35Z","author_association":"CONTRIBUTOR","body":"@jaydoane and note that it is expected for buggify-elixir-suite to fail sometimes with req_timedout and a few 500s here and there. Just keep an eye out for for the 409 conflict errors when 201s are expected. The fix should eliminate those.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844528022/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844691943","html_url":"https://github.com/apache/couchdb/pull/3572#issuecomment-844691943","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3572","id":844691943,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NDY5MTk0Mw==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-20T04:53:40Z","updated_at":"2021-05-20T04:55:43Z","author_association":"MEMBER","body":"> This test is unfortunately still failing for me and the CI:\r\n> \r\n> ```\r\n> 09:10:44  CookieAuthTest\r\n> 09:10:45    * test cookie auth\r\n>   * test cookie auth (210.5ms)\r\n> 09:10:45  \r\n> 09:10:45    1) test cookie auth (CookieAuthTest)\r\n> 09:10:45       test/elixir/test/cookie_auth_test.exs:208\r\n> 09:10:45       Expected truthy, got false\r\n> 09:10:45       code: assert Enum.member?(info[\"userCtx\"][\"roles\"], \"foo\")\r\n> 09:10:45       arguments:\r\n> 09:10:45  \r\n> 09:10:45           # 1\r\n> 09:10:45           []\r\n> 09:10:45  \r\n> 09:10:45           # 2\r\n> 09:10:45           \"foo\"\r\n> 09:10:45  \r\n> 09:10:45       stacktrace:\r\n> 09:10:45         test/elixir/test/cookie_auth_test.exs:376: (test)\r\n> 09:10:45  \r\n> ```\r\n> \r\n> On a happy note, this one passes:\r\n> \r\n> ```\r\n> CopyDocTest\r\n>   * test Copy doc tests (90.0ms)\r\n> ```\r\n\r\nYeah, I'm working on it. It was passing locally for me so now I'm trying to figure out if I'll add some polling or if I need to rewrite the test case a bit. Thank you for the review, @jaydoane !\r\n\r\nEdit: to be honest, I didn't expect a review on a PR with failed CI. You're awesome, Jay!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/844691943/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/845521871","html_url":"https://github.com/apache/couchdb/issues/3560#issuecomment-845521871","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3560","id":845521871,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NTUyMTg3MQ==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-20T22:28:46Z","updated_at":"2021-05-20T22:28:46Z","author_association":"CONTRIBUTOR","body":"Compiling FDB from source sounds like a super fun time, but it seems there will be a [patch in less than a couple weeks](https://github.com/apple/foundationdb/issues/4789#issuecomment-841854553), so I'll just wait for that.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/845521871/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/845800181","html_url":"https://github.com/apache/couchdb/issues/3571#issuecomment-845800181","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3571","id":845800181,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NTgwMDE4MQ==","user":{"login":"oldrich-svec","id":44394662,"node_id":"MDQ6VXNlcjQ0Mzk0NjYy","avatar_url":"https://avatars.githubusercontent.com/u/44394662?v=4","gravatar_id":"","url":"https://api.github.com/users/oldrich-svec","html_url":"https://github.com/oldrich-svec","followers_url":"https://api.github.com/users/oldrich-svec/followers","following_url":"https://api.github.com/users/oldrich-svec/following{/other_user}","gists_url":"https://api.github.com/users/oldrich-svec/gists{/gist_id}","starred_url":"https://api.github.com/users/oldrich-svec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oldrich-svec/subscriptions","organizations_url":"https://api.github.com/users/oldrich-svec/orgs","repos_url":"https://api.github.com/users/oldrich-svec/repos","events_url":"https://api.github.com/users/oldrich-svec/events{/privacy}","received_events_url":"https://api.github.com/users/oldrich-svec/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-21T08:59:13Z","updated_at":"2021-05-21T09:04:40Z","author_association":"NONE","body":"We have a similar issue (Ubuntu Server 20.04, Docker version of CouchDB 3.1.1).\r\n\r\nWe have a 30GB database which is being replicated from an another machine. Looking at the files I can see that the database files take someting like 100GB + another ca. 30GB for the compaction files.\r\n\r\nThe compaction starts but always dies before it finishes. So the database gets never compacted and the compaction files are hanging there forever.\r\n\r\nI would also add that the source machine (where the replication goes from) runs CouchDB 3.1.0 on Windows Server 2019 and there the compaction seems to work just fine.\r\n\r\nSome logs:\r\n\r\n```\r\ncouchdb-backup-service-01 | [info] 2021-05-21T08:27:57.466850Z nonode@nohost <0.222.0> -------- db shards/80000000-ffffffff/yoda_filesystem.1614838752 died with reason {{badarg,[{erlang,monitor,[process,{main,'clouseau@127.0.0.1'}],[]},{ioq,submit_request,2,[{file,\"src/ioq.erl\"},{line,187}]},{ioq,maybe_submit_request,1,[{file,\"src/ioq.erl\"},{line,150}]},{ioq,handle_info,2,[{file,\"src/ioq.erl\"},{line,123}]},{gen_server,try_dispatch,4,[{file,\"gen_server.erl\"},{line,616}]},{gen_server,handle_msg,6,[{file,\"gen_server.erl\"},{line,686}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,247}]}]},{gen_server,call,[ioq,{request,<0.24352.1>,{append_bin,[<<0,0,32,0>>,[<<6,66,160,149,155,150,189,119,66,50,121,52,14,190,9,143...}}\r\ncouchdb-backup-service-01 | [warning] 2021-05-21T08:27:57.467050Z nonode@nohost <0.428.0> -------- exit for compaction of [\"shards/00000000-7fffffff/yoda_filesystem.1614838752\"]: {{badarg,[{erlang,monitor,[process,{main,'clouseau@127.0.0.1'}],[]},{ioq,submit_request,2,[{file,\"src/ioq.erl\"},{line,187}]},{ioq,maybe_submit_request,1,[{file,\"src/ioq.erl\"},{line,150}]},{ioq,handle_info,2,[{file,\"src/ioq.erl\"},{line,123}]},{gen_server,try_dispatch,4,[{file,\"gen_server.erl\"},{line,616}]},{gen_server,handle_msg,6,[{file,\"gen_server.erl\"},{line,686}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,247}]}]},{gen_server,call,[ioq,{request,<0.22588.1>,{pread_iolist,40340132370},compaction,<0.22589.1>,undefined},infinity]}}\r\ncouchdb-backup-service-01 | [info] 2021-05-21T08:27:57.467190Z nonode@nohost <0.222.0> -------- db shards/00000000-7fffffff/yoda_filesystem.1614838752 died with reason {{badarg,[{erlang,monitor,[process,{main,'clouseau@127.0.0.1'}],[]},{ioq,submit_request,2,[{file,\"src/ioq.erl\"},{line,187}]},{ioq,maybe_submit_request,1,[{file,\"src/ioq.erl\"},{line,150}]},{ioq,handle_info,2,[{file,\"src/ioq.erl\"},{line,123}]},{gen_server,try_dispatch,4,[{file,\"gen_server.erl\"},{line,616}]},{gen_server,handle_msg,6,[{file,\"gen_server.erl\"},{line,686}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,247}]}]},{gen_server,call,[ioq,{request,<0.22588.1>,{pread_iolist,40340132370},compaction,<0.22589.1>,undefined},infinity]}}\r\n\r\ncouchdb-backup-service-01 | [info] 2021-05-21T08:27:57.468479Z nonode@nohost <0.28448.1> -------- Starting compaction for db \"shards/80000000-ffffffff/yoda_filesystem.1614838752\" at 125776\r\ncouchdb-backup-service-01 | [notice] 2021-05-21T08:27:57.468708Z nonode@nohost <0.428.0> -------- ratio_dbs: Started compaction for shards/80000000-ffffffff/yoda_filesystem.1614838752\r\ncouchdb-backup-service-01 | [error] 2021-05-21T08:27:57.469504Z nonode@nohost <0.22508.1> -------- gen_server ioq terminated with reason: bad argument in call to erlang:monitor(process, {main,'clouseau@127.0.0.1'}) at ioq:submit_request/2(line:187) <= ioq:maybe_submit_request/1(line:150) <= ioq:handle_info/2(line:123) <= gen_server:try_dispatch/4(line:616) <= gen_server:handle_msg/6(line:686) <= proc_lib:init_p_do_apply/3(line:247)\r\ncouchdb-backup-service-01 |   last msg: timeout\r\ncouchdb-backup-service-01 |      state: {state,10,0.01,{[{request,{main,'clouseau@127.0.0.1'},{open,<0.28430.1>,<<\"shards/80000000-ffffffff/yodadev_features.1614849634/de6fcb4cc39fbd3e0c1d621d441e9057\">>,<<\"standard\">>},other,{<0.28430.1>,#Ref<0.2791382983.2\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/845800181/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/845891957","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-845891957","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":845891957,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NTg5MTk1Nw==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-21T11:42:48Z","updated_at":"2021-05-21T11:42:48Z","author_association":"MEMBER","body":"> Also wonder if there any chance convincing erlfmt authors to change their mind about a few of the most disliked features here such as `->` being on its own line.\r\n\r\n@nickva : to avoid being blocked on an action on their side, we can just do the reformat here and re-apply the formatter once they make the changes that are beneficial to us. Wdyt?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/845891957/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/846006697","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-846006697","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":846006697,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NjAwNjY5Nw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-21T14:50:40Z","updated_at":"2021-05-21T14:50:40Z","author_association":"CONTRIBUTOR","body":"@bessbd  yeah that would work. We can always re-apply the formatting. Good point.\r\n\r\nThe last thing is perhaps to coordinate with any pending PR authors as this might make it difficult for them to rebase, specifically thinking about this one https://github.com/apache/couchdb/pull/3567 but there may be others too.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/846006697/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/846007641","html_url":"https://github.com/apache/couchdb/pull/3567#issuecomment-846007641","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3567","id":846007641,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NjAwNzY0MQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-21T14:52:02Z","updated_at":"2021-05-21T14:52:02Z","author_association":"CONTRIBUTOR","body":"@jiahuili430 In the light of almost merging the erlfmt formatting PR, I think let's not worry about line length and emilio formatting as all that will be done automatically afterwards and it makes things simpler for you.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/846007641/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/847268982","html_url":"https://github.com/apache/couchdb/pull/3574#issuecomment-847268982","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3574","id":847268982,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NzI2ODk4Mg==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-24T19:06:26Z","updated_at":"2021-05-24T19:06:39Z","author_association":"CONTRIBUTOR","body":"Based on my reading of the code, we have 3 scenarios:\r\n1) If both chttpd and httpd config values exist, chttpd takes priority.\r\n2) If chttpd does not exist, but old httpd value exists, then we use httpd value\r\n3) If neither exists, we take in the passed default.\r\n\r\nIf this is the logic then it LGTM, and +1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/847268982/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/847731081","html_url":"https://github.com/apache/couchdb/issues/3561#issuecomment-847731081","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3561","id":847731081,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NzczMTA4MQ==","user":{"login":"Michael-List","id":9529849,"node_id":"MDQ6VXNlcjk1Mjk4NDk=","avatar_url":"https://avatars.githubusercontent.com/u/9529849?v=4","gravatar_id":"","url":"https://api.github.com/users/Michael-List","html_url":"https://github.com/Michael-List","followers_url":"https://api.github.com/users/Michael-List/followers","following_url":"https://api.github.com/users/Michael-List/following{/other_user}","gists_url":"https://api.github.com/users/Michael-List/gists{/gist_id}","starred_url":"https://api.github.com/users/Michael-List/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Michael-List/subscriptions","organizations_url":"https://api.github.com/users/Michael-List/orgs","repos_url":"https://api.github.com/users/Michael-List/repos","events_url":"https://api.github.com/users/Michael-List/events{/privacy}","received_events_url":"https://api.github.com/users/Michael-List/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-25T09:58:06Z","updated_at":"2021-05-25T09:58:06Z","author_association":"NONE","body":"Hi @othmanechentouf,\r\n\r\nI think you are using the library couchdb-python (https://github.com/djc/couchdb-python) which is no longer maintained. I would suggest you use the library **cloudant**:\r\n\r\n- Repository: https://github.com/cloudant/python-cloudant\r\n- Docs: https://python-cloudant.readthedocs.io/en/stable/#","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/847731081/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/848047173","html_url":"https://github.com/apache/couchdb/issues/3581#issuecomment-848047173","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3581","id":848047173,"node_id":"MDEyOklzc3VlQ29tbWVudDg0ODA0NzE3Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-25T16:54:28Z","updated_at":"2021-05-25T16:54:28Z","author_association":"MEMBER","body":"This requires updating the version of Erlang we use in CouchDB to a newer version, as the Erlang ssl client did not gain TLS v1.3 until Erlang 22.1.\r\n\r\nThis will not happen sooner than CouchDB 3.3 or 4.0. Sorry about that.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/848047173/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/848568758","html_url":"https://github.com/apache/couchdb/issues/3581#issuecomment-848568758","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3581","id":848568758,"node_id":"MDEyOklzc3VlQ29tbWVudDg0ODU2ODc1OA==","user":{"login":"jlami","id":8522993,"node_id":"MDQ6VXNlcjg1MjI5OTM=","avatar_url":"https://avatars.githubusercontent.com/u/8522993?v=4","gravatar_id":"","url":"https://api.github.com/users/jlami","html_url":"https://github.com/jlami","followers_url":"https://api.github.com/users/jlami/followers","following_url":"https://api.github.com/users/jlami/following{/other_user}","gists_url":"https://api.github.com/users/jlami/gists{/gist_id}","starred_url":"https://api.github.com/users/jlami/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jlami/subscriptions","organizations_url":"https://api.github.com/users/jlami/orgs","repos_url":"https://api.github.com/users/jlami/repos","events_url":"https://api.github.com/users/jlami/events{/privacy}","received_events_url":"https://api.github.com/users/jlami/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-26T08:18:26Z","updated_at":"2021-05-26T08:18:26Z","author_association":"NONE","body":"That's too bad, but thanks for the feedback!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/848568758/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/848792131","html_url":"https://github.com/apache/couchdb/pull/3582#issuecomment-848792131","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3582","id":848792131,"node_id":"MDEyOklzc3VlQ29tbWVudDg0ODc5MjEzMQ==","user":{"login":"glynnbird","id":697925,"node_id":"MDQ6VXNlcjY5NzkyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/697925?v=4","gravatar_id":"","url":"https://api.github.com/users/glynnbird","html_url":"https://github.com/glynnbird","followers_url":"https://api.github.com/users/glynnbird/followers","following_url":"https://api.github.com/users/glynnbird/following{/other_user}","gists_url":"https://api.github.com/users/glynnbird/gists{/gist_id}","starred_url":"https://api.github.com/users/glynnbird/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glynnbird/subscriptions","organizations_url":"https://api.github.com/users/glynnbird/orgs","repos_url":"https://api.github.com/users/glynnbird/repos","events_url":"https://api.github.com/users/glynnbird/events{/privacy}","received_events_url":"https://api.github.com/users/glynnbird/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-26T13:57:08Z","updated_at":"2021-05-26T13:58:05Z","author_association":"CONTRIBUTOR","body":"Thanks for the contribution @hklarner. On a broader question the new operators you are creating:\r\n\r\n- `$sizeGte`\r\n- `$sizeLte`\r\n\r\nhave no precedence in MongoDB which was the original inspiration for the MongoDB language. If I'm reading the MongoDB docs right, the MongoDB way of performing this query would be to allow the following syntax:\r\n\r\n```\r\n{\r\n  \"selector\": {\r\n     \"customers\": {\r\n        \"$size:\": { \"$gte\": 20}\r\n      }\r\n   }\r\n}\r\n```\r\n\r\nThe advantage of this approach is that\r\n\r\na) we already have a `$size` operator.\r\nb) we have plenty of other comparison operators `$eq`, `$gte` etc etc\r\nc) it wouldn't be creating new operators that differ from the \"MongoDB way\"\r\n\r\nNote that currently the Mango query parser doesn't support this syntax, but I'm suggesting it could be modified to, rather than adding lots of new `$size...` operators.\r\n\r\n\r\nWhat do you thinkg @hklarner & @garrensmith?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/848792131/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/848794736","html_url":"https://github.com/apache/couchdb/pull/3582#issuecomment-848794736","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3582","id":848794736,"node_id":"MDEyOklzc3VlQ29tbWVudDg0ODc5NDczNg==","user":{"login":"hklarner","id":1685557,"node_id":"MDQ6VXNlcjE2ODU1NTc=","avatar_url":"https://avatars.githubusercontent.com/u/1685557?v=4","gravatar_id":"","url":"https://api.github.com/users/hklarner","html_url":"https://github.com/hklarner","followers_url":"https://api.github.com/users/hklarner/followers","following_url":"https://api.github.com/users/hklarner/following{/other_user}","gists_url":"https://api.github.com/users/hklarner/gists{/gist_id}","starred_url":"https://api.github.com/users/hklarner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hklarner/subscriptions","organizations_url":"https://api.github.com/users/hklarner/orgs","repos_url":"https://api.github.com/users/hklarner/repos","events_url":"https://api.github.com/users/hklarner/events{/privacy}","received_events_url":"https://api.github.com/users/hklarner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-26T14:00:35Z","updated_at":"2021-05-26T14:00:35Z","author_association":"NONE","body":"@glynnbird I see. Agreed, the MongoDB consistency is preferable. But I don't know how to implement it :sweat_smile: ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/848794736/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/848882256","html_url":"https://github.com/apache/couchdb/pull/3572#issuecomment-848882256","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3572","id":848882256,"node_id":"MDEyOklzc3VlQ29tbWVudDg0ODg4MjI1Ng==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-26T15:40:20Z","updated_at":"2021-05-26T15:40:20Z","author_association":"MEMBER","body":"@jaydoane : I've added a retry and CI seems happy now","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/848882256/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/849035468","html_url":"https://github.com/apache/couchdb/pull/3577#issuecomment-849035468","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3577","id":849035468,"node_id":"MDEyOklzc3VlQ29tbWVudDg0OTAzNTQ2OA==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-26T18:52:49Z","updated_at":"2021-05-26T18:53:09Z","author_association":"CONTRIBUTOR","body":"Looks good. \r\n\r\nI think we need to put default values back for: \r\n- \"authentication_redirect\" -  to preserve compatibility during upgrade\r\n- \"iterations\" - to maintain adequate security by default see [1]. \r\n\r\n\r\n[1] - https://nvlpubs.nist.gov/nistpubs/Legacy/SP/nistspecialpublication800-132.pdf\r\n\r\n> 5.2 The Iteration Count (C) \r\n\r\n> A  minimum  iteration  count  of  1,000  is  recommended.  For  especially  critical  keys,  or  for  very  powerful  systems  or  systems  where  user-perceived  performance  is  not  critical,  an  iteration count of 10,000,000 may be appropriate.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/849035468/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/849078205","html_url":"https://github.com/apache/couchdb/issues/3472#issuecomment-849078205","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3472","id":849078205,"node_id":"MDEyOklzc3VlQ29tbWVudDg0OTA3ODIwNQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-26T20:00:04Z","updated_at":"2021-05-26T20:00:04Z","author_association":"CONTRIBUTOR","body":"Re-opened the issue as it was closed by accident through one of the \"fixes: ...\" lines in the commits probably","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/849078205/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/849482155","html_url":"https://github.com/apache/couchdb/pull/3572#issuecomment-849482155","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3572","id":849482155,"node_id":"MDEyOklzc3VlQ29tbWVudDg0OTQ4MjE1NQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-27T09:25:04Z","updated_at":"2021-05-27T09:25:04Z","author_association":"MEMBER","body":"Thank you for the review, @jaydoane ! I'm about to merge this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/849482155/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/849551130","html_url":"https://github.com/apache/couchdb/pull/3582#issuecomment-849551130","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3582","id":849551130,"node_id":"MDEyOklzc3VlQ29tbWVudDg0OTU1MTEzMA==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-27T11:20:57Z","updated_at":"2021-05-27T11:20:57Z","author_association":"MEMBER","body":"@hklarner take a look at some of the other operators that handle nested values. Maybe $and and look at implementing something similar. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/849551130/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/849914803","html_url":"https://github.com/apache/couchdb/pull/3577#issuecomment-849914803","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3577","id":849914803,"node_id":"MDEyOklzc3VlQ29tbWVudDg0OTkxNDgwMw==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-27T20:20:23Z","updated_at":"2021-05-27T20:20:23Z","author_association":"CONTRIBUTOR","body":"Great work @jiahuili430 !!!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/849914803/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/849937015","html_url":"https://github.com/apache/couchdb/pull/3583#issuecomment-849937015","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3583","id":849937015,"node_id":"MDEyOklzc3VlQ29tbWVudDg0OTkzNzAxNQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-27T20:58:12Z","updated_at":"2021-05-27T20:58:12Z","author_association":"CONTRIBUTOR","body":"Thank you for the review @iilyak !","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/849937015/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/850374585","html_url":"https://github.com/apache/couchdb/issues/2881#issuecomment-850374585","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2881","id":850374585,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MDM3NDU4NQ==","user":{"login":"Syedpash","id":32576112,"node_id":"MDQ6VXNlcjMyNTc2MTEy","avatar_url":"https://avatars.githubusercontent.com/u/32576112?v=4","gravatar_id":"","url":"https://api.github.com/users/Syedpash","html_url":"https://github.com/Syedpash","followers_url":"https://api.github.com/users/Syedpash/followers","following_url":"https://api.github.com/users/Syedpash/following{/other_user}","gists_url":"https://api.github.com/users/Syedpash/gists{/gist_id}","starred_url":"https://api.github.com/users/Syedpash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Syedpash/subscriptions","organizations_url":"https://api.github.com/users/Syedpash/orgs","repos_url":"https://api.github.com/users/Syedpash/repos","events_url":"https://api.github.com/users/Syedpash/events{/privacy}","received_events_url":"https://api.github.com/users/Syedpash/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-28T12:12:08Z","updated_at":"2021-05-28T12:12:08Z","author_association":"NONE","body":"> So, I reinstalled Couchdb, created an Admin Account and created a user like this:\r\n> \r\n> ```\r\n> curl -X PUT http://<admin>:<admin-password>@localhost:5984/_users/org.couchdb.user:jan \\\r\n>      -d '{\"name\":\"jan\", \"roles\":[], \"type\":\"user\", \"password\":\"apple\"}'\r\n> > Succesfully creates user jan\r\n> ```\r\n> \r\n> Then I tried to get its userinformation with the admin Account and:\r\n> \r\n> ```\r\n> curl -X GET http://<admin>:<admin-password>@localhost:5984/_users/org.couchdb.user:jan\r\n> >  Succesfully  returns Userinformation of Jan\r\n> ```\r\n> \r\n> So far so good. After that I tried to get the Userinformation of my own user\r\n> \r\n> ```\r\n> curl -X GET http://jan:apple@localhost:5984/_users/org.couchdb.user:jan\r\n>  > returns: \"You are not allowed to access this db.\"\r\n> ```\r\n> \r\n> The specified username and password are correct if I intentionally type in a wrong Password i get following response:\r\n> \r\n> ```\r\n> curl -X GET http://jan:wrongPasswordTest@localhost:5984/_users/org.couchdb.user:jan\r\n> > returns: \"Name or password is incorrect.\r\n> ```\r\n\r\nNow Iam facing same problem, would you help me?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/850374585/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/850495320","html_url":"https://github.com/apache/couchdb/issues/2881#issuecomment-850495320","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2881","id":850495320,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MDQ5NTMyMA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-28T15:23:36Z","updated_at":"2021-05-28T15:23:36Z","author_association":"MEMBER","body":"@Syedpash all of the answers are in my link above, https://github.com/apache/couchdb/issues/2881#issuecomment-627431754\r\n\r\nIf you need more real-time help please seek our our Slack or IRC channels; links are on https://couchdb.apache.org/ .","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/850495320/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/850499211","html_url":"https://github.com/apache/couchdb/pull/3582#issuecomment-850499211","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3582","id":850499211,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MDQ5OTIxMQ==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-28T15:29:56Z","updated_at":"2021-05-28T15:29:56Z","author_association":"CONTRIBUTOR","body":"Hi @hklarner, \r\n\r\n I was checking this. It seems quite simple to introduce nesting the behaviour for the $size operator. I've been testing with these changes and seems to work. \r\n \r\n```diff\r\n--- a/src/mango/src/mango_selector.erl\r\n+++ b/src/mango/src/mango_selector.erl\r\n@@ -145,6 +145,8 @@ norm_ops({[{<<\"$keyMapMatch\">>, Arg}]}) ->\r\n \r\n norm_ops({[{<<\"$size\">>, Arg}]}) when is_integer(Arg), Arg >= 0 ->\r\n     {[{<<\"$size\">>, Arg}]};\r\n+norm_ops({[{<<\"$size\">>, {_}=Arg}]}) ->\r\n+    {[{<<\"$size\">>, norm_ops(Arg)}]};\r\n norm_ops({[{<<\"$size\">>, Arg}]}) ->\r\n     ?MANGO_ERROR({bad_arg, '$size', Arg});\r\n \r\n@@ -581,8 +583,10 @@ match({[{<<\"$regex\">>, Regex}]}, Value, _Cmp) when is_binary(Value) ->\r\n match({[{<<\"$regex\">>, _}]}, _Value, _Cmp) ->\r\n     false;\r\n \r\n-match({[{<<\"$size\">>, Arg}]}, Values, _Cmp) when is_list(Values) ->\r\n+match({[{<<\"$size\">>, Arg}]}, Values, _Cmp) when is_list(Values), is_integer(Arg) ->\r\n     length(Values) == Arg;\r\n+match({[{<<\"$size\">>, Arg}]}, Values, _Cmp) when is_list(Values) ->\r\n+    match(Arg, length(Values), _Cmp);\r\n match({[{<<\"$size\">>, _}]}, _Value, _Cmp) ->\r\n     false;\r\n```\r\n\r\nI hope this could help. \r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/850499211/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/850510991","html_url":"https://github.com/apache/couchdb/issues/3282#issuecomment-850510991","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3282","id":850510991,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MDUxMDk5MQ==","user":{"login":"ustun","id":94374,"node_id":"MDQ6VXNlcjk0Mzc0","avatar_url":"https://avatars.githubusercontent.com/u/94374?v=4","gravatar_id":"","url":"https://api.github.com/users/ustun","html_url":"https://github.com/ustun","followers_url":"https://api.github.com/users/ustun/followers","following_url":"https://api.github.com/users/ustun/following{/other_user}","gists_url":"https://api.github.com/users/ustun/gists{/gist_id}","starred_url":"https://api.github.com/users/ustun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ustun/subscriptions","organizations_url":"https://api.github.com/users/ustun/orgs","repos_url":"https://api.github.com/users/ustun/repos","events_url":"https://api.github.com/users/ustun/events{/privacy}","received_events_url":"https://api.github.com/users/ustun/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-28T15:48:57Z","updated_at":"2021-05-28T15:48:57Z","author_association":"NONE","body":"Was this a single node? I think couch_peruser needs all nodes to be up to operate properly, and will fail if any of the nodes are down (or are restarting). I think eventually the dbs are created though, once the cluster is stable. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/850510991/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/850523672","html_url":"https://github.com/apache/couchdb/pull/3582#issuecomment-850523672","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3582","id":850523672,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MDUyMzY3Mg==","user":{"login":"hklarner","id":1685557,"node_id":"MDQ6VXNlcjE2ODU1NTc=","avatar_url":"https://avatars.githubusercontent.com/u/1685557?v=4","gravatar_id":"","url":"https://api.github.com/users/hklarner","html_url":"https://github.com/hklarner","followers_url":"https://api.github.com/users/hklarner/followers","following_url":"https://api.github.com/users/hklarner/following{/other_user}","gists_url":"https://api.github.com/users/hklarner/gists{/gist_id}","starred_url":"https://api.github.com/users/hklarner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hklarner/subscriptions","organizations_url":"https://api.github.com/users/hklarner/orgs","repos_url":"https://api.github.com/users/hklarner/repos","events_url":"https://api.github.com/users/hklarner/events{/privacy}","received_events_url":"https://api.github.com/users/hklarner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-28T16:10:36Z","updated_at":"2021-05-28T16:34:31Z","author_association":"NONE","body":"@jjrodrig that's great! Hey, because of your answer on stackoverflow I opened this PR! Thanks for helping.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/850523672/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/850813827","html_url":"https://github.com/apache/couchdb/issues/3282#issuecomment-850813827","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3282","id":850813827,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MDgxMzgyNw==","user":{"login":"MisterPascal","id":23127510,"node_id":"MDQ6VXNlcjIzMTI3NTEw","avatar_url":"https://avatars.githubusercontent.com/u/23127510?v=4","gravatar_id":"","url":"https://api.github.com/users/MisterPascal","html_url":"https://github.com/MisterPascal","followers_url":"https://api.github.com/users/MisterPascal/followers","following_url":"https://api.github.com/users/MisterPascal/following{/other_user}","gists_url":"https://api.github.com/users/MisterPascal/gists{/gist_id}","starred_url":"https://api.github.com/users/MisterPascal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MisterPascal/subscriptions","organizations_url":"https://api.github.com/users/MisterPascal/orgs","repos_url":"https://api.github.com/users/MisterPascal/repos","events_url":"https://api.github.com/users/MisterPascal/events{/privacy}","received_events_url":"https://api.github.com/users/MisterPascal/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-29T10:57:09Z","updated_at":"2021-05-29T10:57:09Z","author_association":"NONE","body":"Yes it was a single node. No cluster.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/850813827/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852459407","html_url":"https://github.com/apache/couchdb/issues/3594#issuecomment-852459407","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3594","id":852459407,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MjQ1OTQwNw==","user":{"login":"byrneml","id":67058590,"node_id":"MDQ6VXNlcjY3MDU4NTkw","avatar_url":"https://avatars.githubusercontent.com/u/67058590?v=4","gravatar_id":"","url":"https://api.github.com/users/byrneml","html_url":"https://github.com/byrneml","followers_url":"https://api.github.com/users/byrneml/followers","following_url":"https://api.github.com/users/byrneml/following{/other_user}","gists_url":"https://api.github.com/users/byrneml/gists{/gist_id}","starred_url":"https://api.github.com/users/byrneml/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/byrneml/subscriptions","organizations_url":"https://api.github.com/users/byrneml/orgs","repos_url":"https://api.github.com/users/byrneml/repos","events_url":"https://api.github.com/users/byrneml/events{/privacy}","received_events_url":"https://api.github.com/users/byrneml/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-01T21:31:51Z","updated_at":"2021-06-01T21:31:51Z","author_association":"NONE","body":"Issue resolved when I set retries_per_request from 20 to 5","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852459407/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852482541","html_url":"https://github.com/apache/couchdb/pull/3506#issuecomment-852482541","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3506","id":852482541,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MjQ4MjU0MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-01T22:03:11Z","updated_at":"2021-06-01T22:03:11Z","author_association":"MEMBER","body":"@tonysun83 \r\n\r\n1. Is it enabled or disabled by default? Looks like enabled and bound to 127.0.0.1:17986 by default, is this accurate?\r\n2. Is this disable-able at all?\r\n3. Can you write some docs for this? I see no mention of this functionality anywhere in apache/couchdb-documentation. I can't really release this as a new exciting in feature in 3.2 without something in the docs.\r\n\r\nThanks,\r\nJoan","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852482541/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852545682","html_url":"https://github.com/apache/couchdb/issues/3232#issuecomment-852545682","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3232","id":852545682,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MjU0NTY4Mg==","user":{"login":"NBroomfield","id":12395371,"node_id":"MDQ6VXNlcjEyMzk1Mzcx","avatar_url":"https://avatars.githubusercontent.com/u/12395371?v=4","gravatar_id":"","url":"https://api.github.com/users/NBroomfield","html_url":"https://github.com/NBroomfield","followers_url":"https://api.github.com/users/NBroomfield/followers","following_url":"https://api.github.com/users/NBroomfield/following{/other_user}","gists_url":"https://api.github.com/users/NBroomfield/gists{/gist_id}","starred_url":"https://api.github.com/users/NBroomfield/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NBroomfield/subscriptions","organizations_url":"https://api.github.com/users/NBroomfield/orgs","repos_url":"https://api.github.com/users/NBroomfield/repos","events_url":"https://api.github.com/users/NBroomfield/events{/privacy}","received_events_url":"https://api.github.com/users/NBroomfield/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-01T23:07:22Z","updated_at":"2021-06-01T23:07:22Z","author_association":"NONE","body":"+1 This is causing me issue, spent ages setting it all up, auth_handlers, converting DER to PEM, setting iss claim, now this :-(\r\n\r\nAny idea when the next patch (e.g. 3.1.2) release will be?\r\n\r\nThanks\r\n\r\nNeil","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852545682/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852552554","html_url":"https://github.com/apache/couchdb/pull/3506#issuecomment-852552554","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3506","id":852552554,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MjU1MjU1NA==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-01T23:21:51Z","updated_at":"2021-06-01T23:22:04Z","author_association":"CONTRIBUTOR","body":"@wohali \r\n\r\n1 + 2 The additional port/mochiweb server is disabled by default, but the ability to return prometheus metrics via the traditional 5984 port is always on.\r\n3) Ya I can write this up tomorrow.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852552554/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852796179","html_url":"https://github.com/apache/couchdb/pull/3588#issuecomment-852796179","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3588","id":852796179,"node_id":"MDEyOklzc3VlQ29tbWVudDg1Mjc5NjE3OQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-02T07:06:38Z","updated_at":"2021-06-02T07:06:38Z","author_association":"MEMBER","body":"@jaydoane : https://github.com/apache/couchdb/pull/3568 is very close to a merge. Do you want me to hold off with it so that this can be merged before?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852796179/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852796440","html_url":"https://github.com/apache/couchdb/pull/3582#issuecomment-852796440","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3582","id":852796440,"node_id":"MDEyOklzc3VlQ29tbWVudDg1Mjc5NjQ0MA==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-02T07:07:04Z","updated_at":"2021-06-02T07:07:04Z","author_association":"MEMBER","body":"@hklarner : https://github.com/apache/couchdb/pull/3568 is very close to a merge. Do you want me to hold off with it so that this can be merged before?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852796440/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852811217","html_url":"https://github.com/apache/couchdb/pull/3582#issuecomment-852811217","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3582","id":852811217,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MjgxMTIxNw==","user":{"login":"hklarner","id":1685557,"node_id":"MDQ6VXNlcjE2ODU1NTc=","avatar_url":"https://avatars.githubusercontent.com/u/1685557?v=4","gravatar_id":"","url":"https://api.github.com/users/hklarner","html_url":"https://github.com/hklarner","followers_url":"https://api.github.com/users/hklarner/followers","following_url":"https://api.github.com/users/hklarner/following{/other_user}","gists_url":"https://api.github.com/users/hklarner/gists{/gist_id}","starred_url":"https://api.github.com/users/hklarner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hklarner/subscriptions","organizations_url":"https://api.github.com/users/hklarner/orgs","repos_url":"https://api.github.com/users/hklarner/repos","events_url":"https://api.github.com/users/hklarner/events{/privacy}","received_events_url":"https://api.github.com/users/hklarner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-02T07:32:31Z","updated_at":"2021-06-02T07:32:31Z","author_association":"NONE","body":"@bessbd no, because I won't be able to continue with this for at least another week. All I have to do to be up to date is pull before I continue, right?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852811217/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852952031","html_url":"https://github.com/apache/couchdb/issues/3571#issuecomment-852952031","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3571","id":852952031,"node_id":"MDEyOklzc3VlQ29tbWVudDg1Mjk1MjAzMQ==","user":{"login":"AdrianTute","id":47774221,"node_id":"MDQ6VXNlcjQ3Nzc0MjIx","avatar_url":"https://avatars.githubusercontent.com/u/47774221?v=4","gravatar_id":"","url":"https://api.github.com/users/AdrianTute","html_url":"https://github.com/AdrianTute","followers_url":"https://api.github.com/users/AdrianTute/followers","following_url":"https://api.github.com/users/AdrianTute/following{/other_user}","gists_url":"https://api.github.com/users/AdrianTute/gists{/gist_id}","starred_url":"https://api.github.com/users/AdrianTute/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/AdrianTute/subscriptions","organizations_url":"https://api.github.com/users/AdrianTute/orgs","repos_url":"https://api.github.com/users/AdrianTute/repos","events_url":"https://api.github.com/users/AdrianTute/events{/privacy}","received_events_url":"https://api.github.com/users/AdrianTute/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-02T11:34:22Z","updated_at":"2021-06-02T11:34:22Z","author_association":"NONE","body":"Short appendix to what @schneuwlym wrote.\r\nI was able to completely turn off auto-compaction (smoosh).\r\nAfter insertion of ~70k records, I triggered manually a compaction task.\r\nIt was crashing at the very end (Fauxton showed progress ~99%) with the above mentioned error.\r\nCPU and memory usage was decent all the time.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852952031/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852989494","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-852989494","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":852989494,"node_id":"MDEyOklzc3VlQ29tbWVudDg1Mjk4OTQ5NA==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-02T12:35:04Z","updated_at":"2021-06-02T12:35:04Z","author_association":"CONTRIBUTOR","body":"There are `erlfmt-format` (which formats all files) and `erlfmt-check`. Do we have commands to command files in specific directory or to format a specific file? Can you document them somewhere? ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/852989494/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853028320","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-853028320","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":853028320,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MzAyODMyMA==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-02T13:28:50Z","updated_at":"2021-06-02T13:29:01Z","author_association":"MEMBER","body":"> There are `erlfmt-format` (which formats all files) and `erlfmt-check`. Do we have commands to command files in specific directory or to format a specific file? Can you document them somewhere?\r\n\r\nAdded a few lines to docs in 02c48e8 .","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853028320/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853039319","html_url":"https://github.com/apache/couchdb/pull/3582#issuecomment-853039319","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3582","id":853039319,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MzAzOTMxOQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-02T13:42:56Z","updated_at":"2021-06-02T13:42:56Z","author_association":"MEMBER","body":"> @bessbd no, because I won't be able to continue with this for at least another week. All I have to do to be up to date is pull before I continue, right?\r\n\r\nThat's pretty much it. In case you are changing files that are modified by the reformat, the conflict resolution may become a little difficult, but that shouldn't be a big deal.\r\nIn case you need help with anything, please let me know.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853039319/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853141460","html_url":"https://github.com/apache/couchdb/pull/3588#issuecomment-853141460","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3588","id":853141460,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MzE0MTQ2MA==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-02T15:49:28Z","updated_at":"2021-06-02T15:49:28Z","author_association":"CONTRIBUTOR","body":"> @jaydoane : #3568 is very close to a merge. Do you want me to hold off with it so that this can be merged before?\r\n\r\nYes, please. I'll merge this today after squashing.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853141460/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853281146","html_url":"https://github.com/apache/couchdb/pull/3506#issuecomment-853281146","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3506","id":853281146,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MzI4MTE0Ng==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-02T18:25:05Z","updated_at":"2021-06-02T18:25:05Z","author_association":"CONTRIBUTOR","body":"@wohali  I've added documentation PR here: https://github.com/apache/couchdb-documentation/pull/660 I need to clean some things up as the build is failing but let me know in terms of content if I'm missing anything you'd like me to add.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853281146/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853544197","html_url":"https://github.com/apache/couchdb/issues/3598#issuecomment-853544197","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3598","id":853544197,"node_id":"MDEyOklzc3VlQ29tbWVudDg1MzU0NDE5Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-03T04:03:00Z","updated_at":"2021-06-03T04:03:00Z","author_association":"MEMBER","body":"@teafff We don't support CouchDB 2.x anymore.\r\n\r\nWe have support for the RPi 4 already - you can install the package directly from our repositories.\r\n\r\nFor older RPis, we are blocked on our build process, and aren't likely to add support any time soon. See #892 or #1428 for detail.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853544197/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853862724","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-853862724","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":853862724,"node_id":"MDEyOklzc3VlQ29tbWVudDg1Mzg2MjcyNA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-03T13:19:14Z","updated_at":"2021-06-03T13:19:14Z","author_association":"MEMBER","body":"As Paul's involuntary amanuensis he says \"go for it\" but asks if we've confirmed that the abstract syntax tree is unaffected (i.e, the changes are purely cosmetic and make no difference to the compiled artifacts).\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853862724/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853943222","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-853943222","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":853943222,"node_id":"MDEyOklzc3VlQ29tbWVudDg1Mzk0MzIyMg==","user":{"login":"awalterschulze","id":1829933,"node_id":"MDQ6VXNlcjE4Mjk5MzM=","avatar_url":"https://avatars.githubusercontent.com/u/1829933?v=4","gravatar_id":"","url":"https://api.github.com/users/awalterschulze","html_url":"https://github.com/awalterschulze","followers_url":"https://api.github.com/users/awalterschulze/followers","following_url":"https://api.github.com/users/awalterschulze/following{/other_user}","gists_url":"https://api.github.com/users/awalterschulze/gists{/gist_id}","starred_url":"https://api.github.com/users/awalterschulze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/awalterschulze/subscriptions","organizations_url":"https://api.github.com/users/awalterschulze/orgs","repos_url":"https://api.github.com/users/awalterschulze/repos","events_url":"https://api.github.com/users/awalterschulze/events{/privacy}","received_events_url":"https://api.github.com/users/awalterschulze/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-03T15:08:15Z","updated_at":"2021-06-03T15:08:15Z","author_association":"NONE","body":"> As Paul's involuntary amanuensis he says \"go for it\" but asks if we've confirmed that the abstract syntax tree is unaffected (i.e, the changes are purely cosmetic and make no difference to the compiled artifacts).\r\n\r\nerlfmt verifies internally that the AST has not been modified, except for comments and code locations.  If it is modified erlfmt would throw an error.  If you find such cases, please report an error, so we can fix it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853943222/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853947305","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-853947305","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":853947305,"node_id":"MDEyOklzc3VlQ29tbWVudDg1Mzk0NzMwNQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-03T15:13:57Z","updated_at":"2021-06-03T15:13:57Z","author_association":"MEMBER","body":"> > As Paul's involuntary amanuensis he says \"go for it\" but asks if we've confirmed that the abstract syntax tree is unaffected (i.e, the changes are purely cosmetic and make no difference to the compiled artifacts).\r\n> \r\n> erlfmt verifies internally that the AST has not been modified, except for comments and code locations. If it is modified erlfmt would throw an error. If you find such cases, please report an error, so we can fix it.\r\n\r\n@awalterschulze : does that mean the proof I do in https://github.com/apache/couchdb/pull/3568/files#diff-f2ea7984714072018b8a19daabd2dbc8df9f662af94849ffa7eb60b54bc711f0 is unnecessary and can be removed? Same thing for tests, we can run `erlfmt` on those files and they are guaranteed to be \"identical\"?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853947305/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853952214","html_url":"https://github.com/apache/couchdb/issues/3232#issuecomment-853952214","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3232","id":853952214,"node_id":"MDEyOklzc3VlQ29tbWVudDg1Mzk1MjIxNA==","user":{"login":"broomfn","id":85287841,"node_id":"MDQ6VXNlcjg1Mjg3ODQx","avatar_url":"https://avatars.githubusercontent.com/u/85287841?v=4","gravatar_id":"","url":"https://api.github.com/users/broomfn","html_url":"https://github.com/broomfn","followers_url":"https://api.github.com/users/broomfn/followers","following_url":"https://api.github.com/users/broomfn/following{/other_user}","gists_url":"https://api.github.com/users/broomfn/gists{/gist_id}","starred_url":"https://api.github.com/users/broomfn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/broomfn/subscriptions","organizations_url":"https://api.github.com/users/broomfn/orgs","repos_url":"https://api.github.com/users/broomfn/repos","events_url":"https://api.github.com/users/broomfn/events{/privacy}","received_events_url":"https://api.github.com/users/broomfn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-03T15:20:35Z","updated_at":"2021-06-03T15:20:35Z","author_association":"NONE","body":"For anyone else with this issue, if it helps I've cherry picked #3165 into 3.1.1 and created a new fork here:\r\n\r\nhttps://github.com/RGS-IT-Development/couchdb/tree/3.1.1.1\r\n\r\nI've also built a docker image here:\r\n\r\nhttps://github.com/orgs/RGS-IT-Development/packages/container/package/couchdb\r\n\r\nI can confirm this works for my environment.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853952214/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853959096","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-853959096","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":853959096,"node_id":"MDEyOklzc3VlQ29tbWVudDg1Mzk1OTA5Ng==","user":{"login":"awalterschulze","id":1829933,"node_id":"MDQ6VXNlcjE4Mjk5MzM=","avatar_url":"https://avatars.githubusercontent.com/u/1829933?v=4","gravatar_id":"","url":"https://api.github.com/users/awalterschulze","html_url":"https://github.com/awalterschulze","followers_url":"https://api.github.com/users/awalterschulze/followers","following_url":"https://api.github.com/users/awalterschulze/following{/other_user}","gists_url":"https://api.github.com/users/awalterschulze/gists{/gist_id}","starred_url":"https://api.github.com/users/awalterschulze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/awalterschulze/subscriptions","organizations_url":"https://api.github.com/users/awalterschulze/orgs","repos_url":"https://api.github.com/users/awalterschulze/repos","events_url":"https://api.github.com/users/awalterschulze/events{/privacy}","received_events_url":"https://api.github.com/users/awalterschulze/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-03T15:30:16Z","updated_at":"2021-06-03T15:30:30Z","author_association":"NONE","body":"> > > As Paul's involuntary amanuensis he says \"go for it\" but asks if we've confirmed that the abstract syntax tree is unaffected (i.e, the changes are purely cosmetic and make no difference to the compiled artifacts).\r\n> > \r\n> > \r\n> > erlfmt verifies internally that the AST has not been modified, except for comments and code locations. If it is modified erlfmt would throw an error. If you find such cases, please report an error, so we can fix it.\r\n> \r\n> @awalterschulze : does that mean the proof I do in https://github.com/apache/couchdb/pull/3568/files#diff-f2ea7984714072018b8a19daabd2dbc8df9f662af94849ffa7eb60b54bc711f0 is unnecessary and can be removed? Same thing for tests, we can run `erlfmt` on those files and they are guaranteed to be \"identical\"?\r\n\r\nerlfmt does it on the AST level, see https://github.com/WhatsApp/erlfmt/blob/master/src/erlfmt.erl#L459\r\nyou seem to be doing it on the beam level.\r\nI think both have merit, but it depends how rigorous you need to be.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853959096/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853962273","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-853962273","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":853962273,"node_id":"MDEyOklzc3VlQ29tbWVudDg1Mzk2MjI3Mw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-03T15:34:49Z","updated_at":"2021-06-03T15:34:49Z","author_association":"MEMBER","body":"@awalterschulze ah! that's excellent, thank you.\r\n\r\n@bessbd any extra checking seems unnecessary then (and would potentially give false negatives).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/853962273/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/854096423","html_url":"https://github.com/apache/couchdb/issues/3047#issuecomment-854096423","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3047","id":854096423,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NDA5NjQyMw==","user":{"login":"seigel","id":15181,"node_id":"MDQ6VXNlcjE1MTgx","avatar_url":"https://avatars.githubusercontent.com/u/15181?v=4","gravatar_id":"","url":"https://api.github.com/users/seigel","html_url":"https://github.com/seigel","followers_url":"https://api.github.com/users/seigel/followers","following_url":"https://api.github.com/users/seigel/following{/other_user}","gists_url":"https://api.github.com/users/seigel/gists{/gist_id}","starred_url":"https://api.github.com/users/seigel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/seigel/subscriptions","organizations_url":"https://api.github.com/users/seigel/orgs","repos_url":"https://api.github.com/users/seigel/repos","events_url":"https://api.github.com/users/seigel/events{/privacy}","received_events_url":"https://api.github.com/users/seigel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-03T18:46:30Z","updated_at":"2021-06-03T18:46:30Z","author_association":"NONE","body":"Any updates on this topic, just wondering if for @molecular or the author @ngspinu , if this ever resolved?\r\n\r\nThanks","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/854096423/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/854225217","html_url":"https://github.com/apache/couchdb/issues/3232#issuecomment-854225217","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3232","id":854225217,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NDIyNTIxNw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-03T22:25:07Z","updated_at":"2021-06-03T22:25:07Z","author_association":"MEMBER","body":"FYI 3.2 is being prepared right now and should release in June 2021.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/854225217/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/854230247","html_url":"https://github.com/apache/couchdb/issues/3047#issuecomment-854230247","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3047","id":854230247,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NDIzMDI0Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-03T22:36:35Z","updated_at":"2021-06-03T23:09:01Z","author_association":"MEMBER","body":"Based on info from the above, we're going to bump the `slack_dbs` and `slack_views` defaults to 512MB, but leave the ratio at 2.0. If people have evidence to suggest other appropriate defaults, let us know. \r\n\r\nRelated PRs:\r\n* https://github.com/apache/couchdb/pull/3600\r\n* https://github.com/apache/couchdb-documentation/pull/663\r\n\r\nThe problem is that any default setting here will be too aggressive for some users, and too lenient for others.\r\n\r\nA potential future smoosh 2.0 could autotune in response to remaining disk space and current foreground load. \r\n\r\nA potential future smooth 3.0 would simply calculate the future state of the universe and then change these values to avoid any bad outcomes.\r\n\r\nTowards either improvement... \"pull requests welcome.\"","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/854230247/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590324","html_url":"https://github.com/apache/couchdb/issues/4228#issuecomment-1280590324","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4228","id":1280590324,"node_id":"MDEyOklzc3VlQ29tbWVudDEyODA1OTAzMjQ=","user":{"login":"Syedpash","id":32576112,"node_id":"MDQ6VXNlcjMyNTc2MTEy","avatar_url":"https://avatars.githubusercontent.com/u/32576112?v=4","gravatar_id":"","url":"https://api.github.com/users/Syedpash","html_url":"https://github.com/Syedpash","followers_url":"https://api.github.com/users/Syedpash/followers","following_url":"https://api.github.com/users/Syedpash/following{/other_user}","gists_url":"https://api.github.com/users/Syedpash/gists{/gist_id}","starred_url":"https://api.github.com/users/Syedpash/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Syedpash/subscriptions","organizations_url":"https://api.github.com/users/Syedpash/orgs","repos_url":"https://api.github.com/users/Syedpash/repos","events_url":"https://api.github.com/users/Syedpash/events{/privacy}","received_events_url":"https://api.github.com/users/Syedpash/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-04T02:14:47Z","updated_at":"2021-06-04T02:16:56Z","author_association":"NONE","body":"Iam also want to implement jwt authentication, but there is no clear documentation for it. I want to know is there is a way to work with django with couchdb? \r\n\r\nCan we change user instance of django to couchdb users?\r\n\r\nThank you","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590324/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/854498366","html_url":"https://github.com/apache/couchdb/issues/3232#issuecomment-854498366","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3232","id":854498366,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NDQ5ODM2Ng==","user":{"login":"mtenrero","id":6759022,"node_id":"MDQ6VXNlcjY3NTkwMjI=","avatar_url":"https://avatars.githubusercontent.com/u/6759022?v=4","gravatar_id":"","url":"https://api.github.com/users/mtenrero","html_url":"https://github.com/mtenrero","followers_url":"https://api.github.com/users/mtenrero/followers","following_url":"https://api.github.com/users/mtenrero/following{/other_user}","gists_url":"https://api.github.com/users/mtenrero/gists{/gist_id}","starred_url":"https://api.github.com/users/mtenrero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mtenrero/subscriptions","organizations_url":"https://api.github.com/users/mtenrero/orgs","repos_url":"https://api.github.com/users/mtenrero/repos","events_url":"https://api.github.com/users/mtenrero/events{/privacy}","received_events_url":"https://api.github.com/users/mtenrero/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-04T08:59:02Z","updated_at":"2021-06-04T08:59:02Z","author_association":"NONE","body":"Also this PR [https://github.com/apache/couchdb-config/pull/32](https://github.com/apache/couchdb-config/pull/32) should be taken into account in order to allow kid fields with equal signs.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/854498366/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/854541660","html_url":"https://github.com/apache/couchdb/issues/3232#issuecomment-854541660","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3232","id":854541660,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NDU0MTY2MA==","user":{"login":"broomfn","id":85287841,"node_id":"MDQ6VXNlcjg1Mjg3ODQx","avatar_url":"https://avatars.githubusercontent.com/u/85287841?v=4","gravatar_id":"","url":"https://api.github.com/users/broomfn","html_url":"https://github.com/broomfn","followers_url":"https://api.github.com/users/broomfn/followers","following_url":"https://api.github.com/users/broomfn/following{/other_user}","gists_url":"https://api.github.com/users/broomfn/gists{/gist_id}","starred_url":"https://api.github.com/users/broomfn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/broomfn/subscriptions","organizations_url":"https://api.github.com/users/broomfn/orgs","repos_url":"https://api.github.com/users/broomfn/repos","events_url":"https://api.github.com/users/broomfn/events{/privacy}","received_events_url":"https://api.github.com/users/broomfn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-04T09:49:50Z","updated_at":"2021-06-04T09:52:19Z","author_association":"NONE","body":"@mtenrero good find, our JWT issuer rotates it's keys so we don't load them in the .ini file we dynamically push them to the couchdb config URL (https://docs.couchdb.org/en/latest/api/server/configuration.html), so not sure this is an issue for us?, but maybe for others, thanks!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/854541660/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/854794608","html_url":"https://github.com/apache/couchdb/pull/3506#issuecomment-854794608","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3506","id":854794608,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NDc5NDYwOA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-04T14:58:53Z","updated_at":"2021-06-04T14:58:53Z","author_association":"MEMBER","body":"@tonysun83 Thanks for the work here. Looking generally good, left my comments over there. If you can address the remaining documentation gaps this is +1.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/854794608/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/854989033","html_url":"https://github.com/apache/couchdb/issues/3571#issuecomment-854989033","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3571","id":854989033,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NDk4OTAzMw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-04T20:46:11Z","updated_at":"2021-06-04T20:46:11Z","author_association":"CONTRIBUTOR","body":"`{undef,[{math,ceil,[1.6],[]},{couch_emsort,num_merges,2,` is quite odd. I can't figure out where it is coming from\r\n\r\nI see erlang `ceil` function in https://github.com/apache/couchdb/blob/ce596c65d9d7f0bc5d9937bcaf6253b343015690/src/couch/src/couch_emsort.erl#L363-L366 is calling `erlang:ceil` in https://github.com/erlang/otp/blob/8b29b1ca870e6b31a0f3da067ebf4b1b4ceaa969/erts/preloaded/src/erlang.erl#L566-L570 which seems to call a C NIF function but not `math:ceil` which the error indicates.\r\n\r\n@schneuwlym what version of Erlang are you running? Wonder if there is something related to that. `ceil` is a fairly new function in Erlang 20+ only.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/854989033/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/855207246","html_url":"https://github.com/apache/couchdb/issues/3571#issuecomment-855207246","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3571","id":855207246,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NTIwNzI0Ng==","user":{"login":"schneuwlym","id":12935038,"node_id":"MDQ6VXNlcjEyOTM1MDM4","avatar_url":"https://avatars.githubusercontent.com/u/12935038?v=4","gravatar_id":"","url":"https://api.github.com/users/schneuwlym","html_url":"https://github.com/schneuwlym","followers_url":"https://api.github.com/users/schneuwlym/followers","following_url":"https://api.github.com/users/schneuwlym/following{/other_user}","gists_url":"https://api.github.com/users/schneuwlym/gists{/gist_id}","starred_url":"https://api.github.com/users/schneuwlym/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schneuwlym/subscriptions","organizations_url":"https://api.github.com/users/schneuwlym/orgs","repos_url":"https://api.github.com/users/schneuwlym/repos","events_url":"https://api.github.com/users/schneuwlym/events{/privacy}","received_events_url":"https://api.github.com/users/schneuwlym/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-05T08:45:02Z","updated_at":"2021-06-05T08:45:02Z","author_association":"NONE","body":"Hi nickva\r\n\r\nThanks for your reply. We are using Version 19.3.\r\n```\r\nerl -eval '{ok, Version} = file:read_file(filename:join([code:root_dir(), \"releases\", erlang:system_info(otp_release), \"OTP_VERSION\"])), io:fwrite(Version), halt().' -noshell\r\n19.3\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/855207246/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/855272434","html_url":"https://github.com/apache/couchdb/issues/3571#issuecomment-855272434","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3571","id":855272434,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NTI3MjQzNA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-05T17:43:51Z","updated_at":"2021-06-05T17:55:03Z","author_association":"CONTRIBUTOR","body":"@schneuwlym  Erlang 19 would explain why you got an `undef` error there. That `ceil/1` function is not present in Erlang 19. Unfortunately Erlang 19 is not supported any longer for CouchDB 3.x releases.\r\n\r\nFrom the error message it seems as if someone had \"patched\" the CouchDB release to compile on 19.x and replaced the undefined `ceil/1` function (which would have prevented compiling on < 20.0 releases) with `math:ceil/1`. However, `math:ceil/1` is also not defined in < 20.0 release but we'd only find out about it at runtime.\r\n\r\n```\r\n4> catch ceil(1.6).    \r\n{'EXIT',{{shell_undef,ceil,1,[]},\r\n         [{shell,shell_undef,2,[{file,\"shell.erl\"},{line,1061}]},\r\n\r\n5> catch math:ceil(1.6).\r\n{'EXIT',{undef,[{math,ceil,[1.6],[]},\r\n                {erl_eval,do_apply,6,[{file,\"erl_eval.erl\"},{line,674}]},\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/855272434/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/855716978","html_url":"https://github.com/apache/couchdb/issues/3571#issuecomment-855716978","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3571","id":855716978,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NTcxNjk3OA==","user":{"login":"schneuwlym","id":12935038,"node_id":"MDQ6VXNlcjEyOTM1MDM4","avatar_url":"https://avatars.githubusercontent.com/u/12935038?v=4","gravatar_id":"","url":"https://api.github.com/users/schneuwlym","html_url":"https://github.com/schneuwlym","followers_url":"https://api.github.com/users/schneuwlym/followers","following_url":"https://api.github.com/users/schneuwlym/following{/other_user}","gists_url":"https://api.github.com/users/schneuwlym/gists{/gist_id}","starred_url":"https://api.github.com/users/schneuwlym/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schneuwlym/subscriptions","organizations_url":"https://api.github.com/users/schneuwlym/orgs","repos_url":"https://api.github.com/users/schneuwlym/repos","events_url":"https://api.github.com/users/schneuwlym/events{/privacy}","received_events_url":"https://api.github.com/users/schneuwlym/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-07T08:24:37Z","updated_at":"2021-06-07T08:24:37Z","author_association":"NONE","body":"Hi nickva, thanks for your reply.\r\n\r\nIndeed it seems that our packager patched the source to build couchdb\r\n```\r\n--- a/src/couch/src/couch_emsort.erl.clean      2021-01-14 17:18:40.436549175 +0000\r\n+++ a/src/couch/src/couch_emsort.erl    2021-01-14 17:17:39.128103923 +0000\r\n@@ -133,6 +133,8 @@\r\n -export([add/2, merge/1, merge/2, sort/1, iter/1, next/1]).\r\n -export([num_kvs/1, num_merges/1]).\r\n\r\n+-import(math, [ceil/1]).\r\n+\r\n -record(ems, {\r\n     fd,\r\n     root,\r\n--- a/src/couch/rebar.config.script.clean       2021-01-14 17:28:34.570100193 +0000\r\n+++ b/src/couch/rebar.config.script     2021-01-14 19:06:56.523186136 +0000\r\n@@ -107,7 +107,7 @@\r\n         };\r\n     {unix, _} when SMVsn == \"1.8.5\" ->\r\n         {\r\n-            \"-DXP_UNIX -I/usr/include/js -I/usr/local/include/js\",\r\n+            \"-DXP_UNIX \" ++ os:getenv(\"JS_CFLAGS\"),\r\n             \"-L/usr/local/lib -lmozjs185 -lm\"\r\n         };\r\n     {win32, _} when SMVsn == \"60\" ->\r\n@@ -164,7 +164,7 @@\r\n CouchJSEnv = case SMVsn of\r\n     \"1.8.5\" ->\r\n         [\r\n-            {\"CFLAGS\", JS_CFLAGS ++ \" \" ++ CURL_CFLAGS},\r\n+            {\"CFLAGS\", JS_CFLAGS ++ \" \" ++ CURL_CFLAGS ++ os:getenv(\"JS_CFLAGS\")},\r\n             {\"LDFLAGS\", JS_LDFLAGS ++ \" \" ++ CURL_LDFLAGS}\r\n         ];\r\n     _ ->\r\n\r\n```\r\n\r\nBut what I don't understand is, the dependency page (https://docs.couchdb.org/en/3.1.1/install/unix.html#dependencies) mentions Erlang OTP 19.x as requirement. Do I don't understand the line \"Erlang OTP (19.x, 20.x >= 21.3.8.5, 21.x >= 21.2.3, 22.x >= 22.0.5)\" or is this information wrong? Since it is comma sparated, I assumed that 19.x is fully supported...\r\n\r\nWhat Erlang version should we try? 22 or should we already try the latest, eg 24? Since 24 is not mentioned in the list I guess we should go with 22, right?\r\n\r\nRegards\r\nMathias","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/855716978/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/856052942","html_url":"https://github.com/apache/couchdb/issues/3571#issuecomment-856052942","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3571","id":856052942,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NjA1Mjk0Mg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-07T15:46:10Z","updated_at":"2021-06-07T15:46:10Z","author_association":"CONTRIBUTOR","body":"@schneuwlym that was a mistake on our part, we have documented it as \"soft\" supported in release notes for 3.0:  https://docs.couchdb.org/en/3.1.1/whatsnew/3.0.html\r\n\r\n```\r\n19.x - soft support only. No longer tested, but should work.\r\n```\r\n\r\nBasically saying we're not going to go out of our way to break it but it may break at some point accidentally and we're not testing it. With `ceil` the idea I think was that a failed compilation error would indicate that it obviously won't build. In retrospect, we should have taken a firmer stance and explicitly indicated we are not supporting Erlang versions < 20 in documentation at that point.\r\n\r\nI already updated the rebar config file to disallow Erlang 19 and will update the dependencies list in unix.html docs file too.\r\n\r\nAs for which versions to try. The binary packages we release are shipped with the latest versions of 20. In production at Cloudant I have seen 20 run for a few years without any issues. So could pick 20.3.8.26 for example. However, the downside there is Erlang developers promise to support only the last two versions behind the current one. If that's a concern perhaps pick the latest patch version of 23 and make sure to periodically check for fixes.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/856052942/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/856153924","html_url":"https://github.com/apache/couchdb/issues/3571#issuecomment-856153924","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3571","id":856153924,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NjE1MzkyNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-07T18:13:36Z","updated_at":"2021-06-07T18:13:36Z","author_association":"MEMBER","body":"Note that 23.x and 24.x are not yet supported in CouchDB 3, unless you are building from the `3.x` branch directly. For `3.1.1` you cannot go any newer than 22.x.\r\n\r\nSee: https://docs.couchdb.org/en/3.1.1/install/unix.html#installation-from-source for the versions supported at the time `3.1.1` was released. We acknowledge 19.x was incorrectly included there, and will support 23.x and 24.x with the forthcoming 3.2 release.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/856153924/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/856164099","html_url":"https://github.com/apache/couchdb/issues/3571#issuecomment-856164099","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3571","id":856164099,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NjE2NDA5OQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-07T18:28:17Z","updated_at":"2021-06-07T18:28:17Z","author_association":"CONTRIBUTOR","body":"@wohali good point, thanks for clarifying","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/856164099/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/856227634","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-856227634","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":856227634,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NjIyNzYzNA==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-07T20:20:11Z","updated_at":"2021-06-07T20:20:11Z","author_association":"CONTRIBUTOR","body":"@awalterschulze after playing around in an editor with some erlfmt formatted CouchDB code, I find it all pretty readable, and generally an improvement, with only one real exception. CouchDB style has evolved to put a blank line between function clauses, and 2 blank lines between functions. After formatting, these get changed to no 0 and 1 respectively. I wonder if your team would consider respecting the original format for this case as well as [the others you already honor here](https://github.com/WhatsApp/erlfmt#respecting-original-format)? ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/856227634/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/856938354","html_url":"https://github.com/apache/couchdb/issues/3324#issuecomment-856938354","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3324","id":856938354,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NjkzODM1NA==","user":{"login":"petersbattaglia","id":1198341,"node_id":"MDQ6VXNlcjExOTgzNDE=","avatar_url":"https://avatars.githubusercontent.com/u/1198341?v=4","gravatar_id":"","url":"https://api.github.com/users/petersbattaglia","html_url":"https://github.com/petersbattaglia","followers_url":"https://api.github.com/users/petersbattaglia/followers","following_url":"https://api.github.com/users/petersbattaglia/following{/other_user}","gists_url":"https://api.github.com/users/petersbattaglia/gists{/gist_id}","starred_url":"https://api.github.com/users/petersbattaglia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/petersbattaglia/subscriptions","organizations_url":"https://api.github.com/users/petersbattaglia/orgs","repos_url":"https://api.github.com/users/petersbattaglia/repos","events_url":"https://api.github.com/users/petersbattaglia/events{/privacy}","received_events_url":"https://api.github.com/users/petersbattaglia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-08T17:01:06Z","updated_at":"2021-06-08T17:01:06Z","author_association":"NONE","body":"Is there a plan to fix this issue in a comping release?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/856938354/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/857495689","html_url":"https://github.com/apache/couchdb/issues/3571#issuecomment-857495689","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3571","id":857495689,"node_id":"MDEyOklzc3VlQ29tbWVudDg1NzQ5NTY4OQ==","user":{"login":"schneuwlym","id":12935038,"node_id":"MDQ6VXNlcjEyOTM1MDM4","avatar_url":"https://avatars.githubusercontent.com/u/12935038?v=4","gravatar_id":"","url":"https://api.github.com/users/schneuwlym","html_url":"https://github.com/schneuwlym","followers_url":"https://api.github.com/users/schneuwlym/followers","following_url":"https://api.github.com/users/schneuwlym/following{/other_user}","gists_url":"https://api.github.com/users/schneuwlym/gists{/gist_id}","starred_url":"https://api.github.com/users/schneuwlym/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/schneuwlym/subscriptions","organizations_url":"https://api.github.com/users/schneuwlym/orgs","repos_url":"https://api.github.com/users/schneuwlym/repos","events_url":"https://api.github.com/users/schneuwlym/events{/privacy}","received_events_url":"https://api.github.com/users/schneuwlym/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-09T08:26:11Z","updated_at":"2021-06-09T08:26:11Z","author_association":"NONE","body":"Hi\r\n\r\nUpdating the Erlang compiler to 22 definitely seems to fix our issue!\r\n\r\nThank you very much for your help!\r\n\r\nBest regards\r\nMathias","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/857495689/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/858231737","html_url":"https://github.com/apache/couchdb/issues/3308#issuecomment-858231737","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3308","id":858231737,"node_id":"MDEyOklzc3VlQ29tbWVudDg1ODIzMTczNw==","user":{"login":"anuragvohraec","id":53807480,"node_id":"MDQ6VXNlcjUzODA3NDgw","avatar_url":"https://avatars.githubusercontent.com/u/53807480?v=4","gravatar_id":"","url":"https://api.github.com/users/anuragvohraec","html_url":"https://github.com/anuragvohraec","followers_url":"https://api.github.com/users/anuragvohraec/followers","following_url":"https://api.github.com/users/anuragvohraec/following{/other_user}","gists_url":"https://api.github.com/users/anuragvohraec/gists{/gist_id}","starred_url":"https://api.github.com/users/anuragvohraec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anuragvohraec/subscriptions","organizations_url":"https://api.github.com/users/anuragvohraec/orgs","repos_url":"https://api.github.com/users/anuragvohraec/repos","events_url":"https://api.github.com/users/anuragvohraec/events{/privacy}","received_events_url":"https://api.github.com/users/anuragvohraec/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-10T02:30:12Z","updated_at":"2021-06-10T02:30:12Z","author_association":"NONE","body":"Hi team,\r\nAny comment on this ?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/858231737/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/859000949","html_url":"https://github.com/apache/couchdb/issues/3560#issuecomment-859000949","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3560","id":859000949,"node_id":"MDEyOklzc3VlQ29tbWVudDg1OTAwMDk0OQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-10T20:02:31Z","updated_at":"2021-06-10T20:02:31Z","author_association":"CONTRIBUTOR","body":"This is fixed","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/859000949/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/859479642","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-859479642","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":859479642,"node_id":"MDEyOklzc3VlQ29tbWVudDg1OTQ3OTY0Mg==","user":{"login":"awalterschulze","id":1829933,"node_id":"MDQ6VXNlcjE4Mjk5MzM=","avatar_url":"https://avatars.githubusercontent.com/u/1829933?v=4","gravatar_id":"","url":"https://api.github.com/users/awalterschulze","html_url":"https://github.com/awalterschulze","followers_url":"https://api.github.com/users/awalterschulze/followers","following_url":"https://api.github.com/users/awalterschulze/following{/other_user}","gists_url":"https://api.github.com/users/awalterschulze/gists{/gist_id}","starred_url":"https://api.github.com/users/awalterschulze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/awalterschulze/subscriptions","organizations_url":"https://api.github.com/users/awalterschulze/orgs","repos_url":"https://api.github.com/users/awalterschulze/repos","events_url":"https://api.github.com/users/awalterschulze/events{/privacy}","received_events_url":"https://api.github.com/users/awalterschulze/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-11T10:26:09Z","updated_at":"2021-06-11T10:26:21Z","author_association":"NONE","body":"> @awalterschulze after playing around in an editor with some erlfmt formatted CouchDB code, I find it all pretty readable, and generally an improvement, with only one real exception. CouchDB style has evolved to put a blank line between function clauses, and 2 blank lines between functions. After formatting, these get changed to no 0 and 1 respectively. I wonder if your team would consider respecting the original format for this case as well as [the others you already honor here](https://github.com/WhatsApp/erlfmt#respecting-original-format)?\r\n\r\nThank you @jaydoane it is really great to hear that you find erlfmt to be a general improvement.\r\n\r\nSorry for taking so long to get back to you, but we needed to give this some thought.\r\nThe problem with preserving the spacing for this case though, is it would result in a lot of inconsistency caused by users.\r\nIf anything this would need to be an enforced style, but that would need to be configured and erlfmt does not to config.\r\nWe want erlfmt to enforce an opinionated style.\r\nWe did consider this format before as the opinionated style, as we very much liked this idea from Elixir.\r\nBut we found this style is uncommon in most erlang code bases.\r\nI hope that makes sense.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/859479642/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/859705863","html_url":"https://github.com/apache/couchdb/issues/3308#issuecomment-859705863","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3308","id":859705863,"node_id":"MDEyOklzc3VlQ29tbWVudDg1OTcwNTg2Mw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-11T16:39:17Z","updated_at":"2021-06-11T16:47:55Z","author_association":"CONTRIBUTOR","body":"As far as db / doc not found, I think error reason is already provided:\r\n\r\n```\r\n % http $DB/mydb2/doc4\r\nHTTP/1.1 404 Object Not Found\r\n\r\n{\r\n    \"error\": \"not_found\",\r\n    \"reason\": \"Database does not exist.\"\r\n}\r\n```\r\n\r\n```\r\n% http $DB/mydb1/doc2\r\nHTTP/1.1 404 Object Not Found\r\n\r\n{\r\n    \"error\": \"not_found\",\r\n    \"reason\": \"missing\"\r\n}\r\n```\r\n\r\nAs for `dbseq=true` we have a similar idea already with the `local_seq=true` parameter:\r\n```\r\n% http $DB/mydb1/doc1'?local_seq=true'\r\n\r\n{\r\n    \"_id\": \"doc1\",\r\n    \"_local_seq\": \"00000008d5c93d5a00000000\",\r\n    \"_rev\": \"1-4b8a35d3f70a5962f86c6dd06ceb599c\",\r\n    \"a\": \"b\"\r\n}\r\n```\r\n\r\nWe return the doc update sequence along with a body. I wonder if we can co-opt this feature to return the current dbseq. Something like?\r\n\r\n```\r\n% http $DB/mydb1/doc1'?db_seq=true'\r\n\r\n{\r\n    \"_id\": \"doc1\",\r\n    \"_db_seq\": \"00000008d5c93d5a110000000\",\r\n    \"_rev\": \"1-4b8a35d3f70a5962f86c6dd06ceb599c\",\r\n    \"a\": \"b\"\r\n}\r\n``` \r\n\r\nThough it would be kinda hacky since it won't be document related per-se, so maybe a header is more logical there...\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/859705863/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/860169054","html_url":"https://github.com/apache/couchdb/issues/3308#issuecomment-860169054","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3308","id":860169054,"node_id":"MDEyOklzc3VlQ29tbWVudDg2MDE2OTA1NA==","user":{"login":"anuragvohraec","id":53807480,"node_id":"MDQ6VXNlcjUzODA3NDgw","avatar_url":"https://avatars.githubusercontent.com/u/53807480?v=4","gravatar_id":"","url":"https://api.github.com/users/anuragvohraec","html_url":"https://github.com/anuragvohraec","followers_url":"https://api.github.com/users/anuragvohraec/followers","following_url":"https://api.github.com/users/anuragvohraec/following{/other_user}","gists_url":"https://api.github.com/users/anuragvohraec/gists{/gist_id}","starred_url":"https://api.github.com/users/anuragvohraec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anuragvohraec/subscriptions","organizations_url":"https://api.github.com/users/anuragvohraec/orgs","repos_url":"https://api.github.com/users/anuragvohraec/repos","events_url":"https://api.github.com/users/anuragvohraec/events{/privacy}","received_events_url":"https://api.github.com/users/anuragvohraec/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-13T07:48:18Z","updated_at":"2021-06-13T07:48:18Z","author_association":"NONE","body":"> As far as db / doc not found, I think error reason is already provided:\r\n> \r\n> ```\r\n>  % http $DB/mydb2/doc4\r\n> HTTP/1.1 404 Object Not Found\r\n> \r\n> {\r\n>     \"error\": \"not_found\",\r\n>     \"reason\": \"Database does not exist.\"\r\n> }\r\n> ```\r\n\r\nYes, my mistake. I some how missed it.\r\n\r\n> As for `dbseq=true` we have a similar idea already with the `local_seq=true` parameter:\r\n\r\nWorks only for normal docs, but for local docs (replication logs) it won't return anything. Morever the _local_seq is not DB update sequence which is used to determine if replication is required or not.\r\n\r\n \r\n> We return the doc update sequence along with a body. I wonder if we can co-opt this feature to return the current dbseq. Something like?\r\n> \r\n> ```\r\n> % http $DB/mydb1/doc1'?db_seq=true'\r\n\r\nI would suggest it to be for local docs (replication logs) `$db/mydb1/_local/replogs1?db_seq=true`;","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/860169054/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/860246655","html_url":"https://github.com/apache/couchdb/issues/3308#issuecomment-860246655","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3308","id":860246655,"node_id":"MDEyOklzc3VlQ29tbWVudDg2MDI0NjY1NQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-13T17:43:02Z","updated_at":"2021-06-13T22:37:16Z","author_association":"CONTRIBUTOR","body":"> Works only for normal docs, but for local docs (replication logs) it won't return anything. \r\n\r\nRight, local seq is the update seq of the document, so it won't be usable even if it worked for local documents. But since we have an API to return a sequence in the document I wanted to see if it would make sense having  the same kind of API rather than invent something completely new, like returning data in the headers. So far I am 50/50 on the approaches...\r\n\r\nWith the `main` branch where sequences are global, it might be interesting to return both _local_seq and _db_seq so in one response we can tell when the document was updated relative to other documents, even in different databases on the same FDB cluster, and also, find out what the current db sequence is when this document was read.\r\n\r\nRegarding the replication problem, I was wondering if connections are re-used if 1 vs 2 or 3 connection would have that much of an impact. Some time is spent during the SSL negotiation when setting up a new connection, but after that if the connection stays open there may not be a huge difference between having one or a few more requests.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/860246655/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/860760397","html_url":"https://github.com/apache/couchdb/issues/3308#issuecomment-860760397","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3308","id":860760397,"node_id":"MDEyOklzc3VlQ29tbWVudDg2MDc2MDM5Nw==","user":{"login":"anuragvohraec","id":53807480,"node_id":"MDQ6VXNlcjUzODA3NDgw","avatar_url":"https://avatars.githubusercontent.com/u/53807480?v=4","gravatar_id":"","url":"https://api.github.com/users/anuragvohraec","html_url":"https://github.com/anuragvohraec","followers_url":"https://api.github.com/users/anuragvohraec/followers","following_url":"https://api.github.com/users/anuragvohraec/following{/other_user}","gists_url":"https://api.github.com/users/anuragvohraec/gists{/gist_id}","starred_url":"https://api.github.com/users/anuragvohraec/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anuragvohraec/subscriptions","organizations_url":"https://api.github.com/users/anuragvohraec/orgs","repos_url":"https://api.github.com/users/anuragvohraec/repos","events_url":"https://api.github.com/users/anuragvohraec/events{/privacy}","received_events_url":"https://api.github.com/users/anuragvohraec/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-14T15:06:55Z","updated_at":"2021-06-14T15:07:39Z","author_association":"NONE","body":">we have an API to return a sequence in the document I wanted to see if it would make sense having the same kind of API rather than invent something completely new, like returning data in the headers...\r\n\r\nYeah any approach would be ok, as long as we get the DB update seq, along with the local docs. I suggested headers/flag based solution so that none of the old client has any kind API problems, for backward compatibility in mind.\r\nSpecifically the one which has some kind of checks in place for the data they receive from couchdb.\r\n\r\n> With the `main` branch where sequences are global, it might be interesting to return both _local_seq and _db_seq so in one response we can tell when the document was updated relative to other documents, even in different databases on the same FDB cluster, and also, find out what the current db sequence is when this document was read.\r\n\r\nAbsolutely!, will have many usefull cases.\r\n\r\n> Regarding the replication problem, I was wondering if connections are re-used if 1 vs 2 or 3 connection would have that much of an impact. Some time is spent during the SSL negotiation when setting up a new connection, but after that if the connection stays open there may not be a huge difference between having one or a few more requests.\r\n\r\nI am not able to understand this, not an expert on this matter. Are you suggesting that few steps of replication can be combined onto a single connections ?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/860760397/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]