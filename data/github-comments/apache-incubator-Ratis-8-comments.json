[{"url":"https://api.github.com/repos/apache/ratis/issues/comments/727660896","html_url":"https://github.com/apache/ratis/pull/278#issuecomment-727660896","issue_url":"https://api.github.com/repos/apache/ratis/issues/278","id":727660896,"node_id":"MDEyOklzc3VlQ29tbWVudDcyNzY2MDg5Ng==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-15T23:59:25Z","updated_at":"2020-11-16T00:00:11Z","author_association":"CONTRIBUTOR","body":"@amaliujia Could you take the failed ut: `TestDataStreamWithNettyMiniRaftCluster>DataStreamTests.testStreamWrites:57->DataStreamTests.testStreamWrites:84 Â» TestTimedOut` as high priority ? It make CI hard to pass.  Thanks a lot.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/727660896/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/727690130","html_url":"https://github.com/apache/ratis/pull/279#issuecomment-727690130","issue_url":"https://api.github.com/repos/apache/ratis/issues/279","id":727690130,"node_id":"MDEyOklzc3VlQ29tbWVudDcyNzY5MDEzMA==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-16T02:05:49Z","updated_at":"2020-11-16T02:05:49Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks the patch. I have merged it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/727690130/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/727692859","html_url":"https://github.com/apache/ratis/pull/278#issuecomment-727692859","issue_url":"https://api.github.com/repos/apache/ratis/issues/278","id":727692859,"node_id":"MDEyOklzc3VlQ29tbWVudDcyNzY5Mjg1OQ==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-16T02:17:09Z","updated_at":"2020-11-16T02:17:09Z","author_association":"CONTRIBUTOR","body":"@szetszwo Seems the commit is wrong ?\r\n![image](https://user-images.githubusercontent.com/51938049/99205886-d260e100-27f4-11eb-98d2-bd1babc6fb48.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/727692859/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/727698822","html_url":"https://github.com/apache/ratis/pull/278#issuecomment-727698822","issue_url":"https://api.github.com/repos/apache/ratis/issues/278","id":727698822,"node_id":"MDEyOklzc3VlQ29tbWVudDcyNzY5ODgyMg==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-16T02:40:04Z","updated_at":"2020-11-16T02:40:04Z","author_association":"CONTRIBUTOR","body":"@amaliujia  and @runzhiwang , yes, the commit was incorrect.  Just have pushed a new one.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/727698822/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/727731399","html_url":"https://github.com/apache/ratis/pull/278#issuecomment-727731399","issue_url":"https://api.github.com/repos/apache/ratis/issues/278","id":727731399,"node_id":"MDEyOklzc3VlQ29tbWVudDcyNzczMTM5OQ==","user":{"login":"amaliujia","id":1938382,"node_id":"MDQ6VXNlcjE5MzgzODI=","avatar_url":"https://avatars.githubusercontent.com/u/1938382?v=4","gravatar_id":"","url":"https://api.github.com/users/amaliujia","html_url":"https://github.com/amaliujia","followers_url":"https://api.github.com/users/amaliujia/followers","following_url":"https://api.github.com/users/amaliujia/following{/other_user}","gists_url":"https://api.github.com/users/amaliujia/gists{/gist_id}","starred_url":"https://api.github.com/users/amaliujia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaliujia/subscriptions","organizations_url":"https://api.github.com/users/amaliujia/orgs","repos_url":"https://api.github.com/users/amaliujia/repos","events_url":"https://api.github.com/users/amaliujia/events{/privacy}","received_events_url":"https://api.github.com/users/amaliujia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-16T04:45:26Z","updated_at":"2020-11-16T04:45:26Z","author_association":"CONTRIBUTOR","body":"@runzhiwang \r\n\r\nI have filed https://issues.apache.org/jira/browse/RATIS-1159 and found 1 timeout instance from 50 runs locally. \r\n\r\nRight now I cannot tell what is obvious reason for the flakness. If you find this test becomes pretty flaky, please add a `@Ignore` to it to allow CI pass now.\r\n\r\nThe test setup looks right. This might be a real issue that happens on a cluster. I will try to figure out the root cause but not sure if I can have some news soon.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/727731399/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/727760844","html_url":"https://github.com/apache/ratis/pull/280#issuecomment-727760844","issue_url":"https://api.github.com/repos/apache/ratis/issues/280","id":727760844,"node_id":"MDEyOklzc3VlQ29tbWVudDcyNzc2MDg0NA==","user":{"login":"amaliujia","id":1938382,"node_id":"MDQ6VXNlcjE5MzgzODI=","avatar_url":"https://avatars.githubusercontent.com/u/1938382?v=4","gravatar_id":"","url":"https://api.github.com/users/amaliujia","html_url":"https://github.com/amaliujia","followers_url":"https://api.github.com/users/amaliujia/followers","following_url":"https://api.github.com/users/amaliujia/following{/other_user}","gists_url":"https://api.github.com/users/amaliujia/gists{/gist_id}","starred_url":"https://api.github.com/users/amaliujia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaliujia/subscriptions","organizations_url":"https://api.github.com/users/amaliujia/orgs","repos_url":"https://api.github.com/users/amaliujia/repos","events_url":"https://api.github.com/users/amaliujia/events{/privacy}","received_events_url":"https://api.github.com/users/amaliujia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-16T06:16:42Z","updated_at":"2020-11-16T06:16:42Z","author_association":"CONTRIBUTOR","body":"@runzhiwang  @szetszwo ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/727760844/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/728432504","html_url":"https://github.com/apache/ratis/pull/281#issuecomment-728432504","issue_url":"https://api.github.com/repos/apache/ratis/issues/281","id":728432504,"node_id":"MDEyOklzc3VlQ29tbWVudDcyODQzMjUwNA==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-16T23:47:52Z","updated_at":"2020-11-16T23:47:52Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks the patch. I have merged it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/728432504/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/728809901","html_url":"https://github.com/apache/ratis/pull/275#issuecomment-728809901","issue_url":"https://api.github.com/repos/apache/ratis/issues/275","id":728809901,"node_id":"MDEyOklzc3VlQ29tbWVudDcyODgwOTkwMQ==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-17T09:39:55Z","updated_at":"2020-11-17T09:39:55Z","author_association":"CONTRIBUTOR","body":"@bshashikant Thanks the patch. @szetszwo @amaliujia Thanks for review. I have merged it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/728809901/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/729334586","html_url":"https://github.com/apache/ratis/pull/283#issuecomment-729334586","issue_url":"https://api.github.com/repos/apache/ratis/issues/283","id":729334586,"node_id":"MDEyOklzc3VlQ29tbWVudDcyOTMzNDU4Ng==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-18T02:24:55Z","updated_at":"2020-11-18T02:26:57Z","author_association":"CONTRIBUTOR","body":"@szetszwo Seems failed ut related to this PR. Trigger CI 3 times, this ut always fail.\r\n![image](https://user-images.githubusercontent.com/51938049/99474879-5eefd880-2988-11eb-986d-df52c38b788b.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/729334586/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/729337493","html_url":"https://github.com/apache/ratis/pull/283#issuecomment-729337493","issue_url":"https://api.github.com/repos/apache/ratis/issues/283","id":729337493,"node_id":"MDEyOklzc3VlQ29tbWVudDcyOTMzNzQ5Mw==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-18T02:34:20Z","updated_at":"2020-11-18T02:34:20Z","author_association":"CONTRIBUTOR","body":"Thanks @runzhiwang .  The test failure is related -- it uses a null server id so that the new assertion failed it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/729337493/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/729442910","html_url":"https://github.com/apache/ratis/pull/284#issuecomment-729442910","issue_url":"https://api.github.com/repos/apache/ratis/issues/284","id":729442910,"node_id":"MDEyOklzc3VlQ29tbWVudDcyOTQ0MjkxMA==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-18T05:42:41Z","updated_at":"2020-11-18T05:42:41Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks for review. Because CI passed, so I merge it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/729442910/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/730153554","html_url":"https://github.com/apache/ratis/pull/288#issuecomment-730153554","issue_url":"https://api.github.com/repos/apache/ratis/issues/288","id":730153554,"node_id":"MDEyOklzc3VlQ29tbWVudDczMDE1MzU1NA==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-19T06:12:42Z","updated_at":"2020-11-19T06:12:42Z","author_association":"CONTRIBUTOR","body":"Thanks @runzhiwang for reviewing this.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/730153554/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/730725785","html_url":"https://github.com/apache/ratis/pull/291#issuecomment-730725785","issue_url":"https://api.github.com/repos/apache/ratis/issues/291","id":730725785,"node_id":"MDEyOklzc3VlQ29tbWVudDczMDcyNTc4NQ==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-20T00:38:22Z","updated_at":"2020-11-20T00:38:22Z","author_association":"CONTRIBUTOR","body":"@cxorm Thanks the patch. I have merged it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/730725785/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/730783601","html_url":"https://github.com/apache/ratis/pull/290#issuecomment-730783601","issue_url":"https://api.github.com/repos/apache/ratis/issues/290","id":730783601,"node_id":"MDEyOklzc3VlQ29tbWVudDczMDc4MzYwMQ==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-20T01:28:54Z","updated_at":"2020-11-20T01:28:54Z","author_association":"CONTRIBUTOR","body":"\r\n\r\n> Once a log entry is created for a DataStream, the server should link log entry with the DataStream so that the StateMachine must not delete the data unless the log entry is truncated.\r\n\r\n@szetszwo Hi, I have one question. link log entry with the DataStream is aim for we can delete the data when truncate the log entry ?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/730783601/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/730790452","html_url":"https://github.com/apache/ratis/pull/290#issuecomment-730790452","issue_url":"https://api.github.com/repos/apache/ratis/issues/290","id":730790452,"node_id":"MDEyOklzc3VlQ29tbWVudDczMDc5MDQ1Mg==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-20T01:38:00Z","updated_at":"2020-11-20T01:38:00Z","author_association":"CONTRIBUTOR","body":"Yes, one of the goals is to let state machine delete the data when truncating the log entry.\r\n\r\nAnother goal is to replicate the data with the log entry to other servers (not yet implemented).\r\n\r\nThe idea is similar to the state machine data stored by StateMachine.DataApi.write(..).  The state machine should manage the stream data the same way.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/730790452/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/730791756","html_url":"https://github.com/apache/ratis/pull/290#issuecomment-730791756","issue_url":"https://api.github.com/repos/apache/ratis/issues/290","id":730791756,"node_id":"MDEyOklzc3VlQ29tbWVudDczMDc5MTc1Ng==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-20T01:42:30Z","updated_at":"2020-11-20T01:42:30Z","author_association":"CONTRIBUTOR","body":"@szetszwo Got it. Thanks for explanation.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/730791756/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/730857056","html_url":"https://github.com/apache/ratis/pull/289#issuecomment-730857056","issue_url":"https://api.github.com/repos/apache/ratis/issues/289","id":730857056,"node_id":"MDEyOklzc3VlQ29tbWVudDczMDg1NzA1Ng==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-20T05:19:51Z","updated_at":"2020-11-20T05:20:09Z","author_association":"CONTRIBUTOR","body":"@szetszwo Maybe this failed ut testWithLoad related to this PR.\r\n![image](https://user-images.githubusercontent.com/51938049/99762241-0446b000-2b33-11eb-987b-930776699aa7.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/730857056/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/730898082","html_url":"https://github.com/apache/ratis/pull/289#issuecomment-730898082","issue_url":"https://api.github.com/repos/apache/ratis/issues/289","id":730898082,"node_id":"MDEyOklzc3VlQ29tbWVudDczMDg5ODA4Mg==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-20T06:36:52Z","updated_at":"2020-11-20T06:36:52Z","author_association":"CONTRIBUTOR","body":"@runzhiwang ,  thanks for checking it.  I also suspect the test failures are related to the change.  Let's hold on this and revisit the new logic.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/730898082/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/731866513","html_url":"https://github.com/apache/ratis/pull/293#issuecomment-731866513","issue_url":"https://api.github.com/repos/apache/ratis/issues/293","id":731866513,"node_id":"MDEyOklzc3VlQ29tbWVudDczMTg2NjUxMw==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-22T23:36:36Z","updated_at":"2020-11-22T23:36:36Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks the patch. I have merged it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/731866513/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732005498","html_url":"https://github.com/apache/ratis/pull/291#issuecomment-732005498","issue_url":"https://api.github.com/repos/apache/ratis/issues/291","id":732005498,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjAwNTQ5OA==","user":{"login":"cxorm","id":38711101,"node_id":"MDQ6VXNlcjM4NzExMTAx","avatar_url":"https://avatars.githubusercontent.com/u/38711101?v=4","gravatar_id":"","url":"https://api.github.com/users/cxorm","html_url":"https://github.com/cxorm","followers_url":"https://api.github.com/users/cxorm/followers","following_url":"https://api.github.com/users/cxorm/following{/other_user}","gists_url":"https://api.github.com/users/cxorm/gists{/gist_id}","starred_url":"https://api.github.com/users/cxorm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cxorm/subscriptions","organizations_url":"https://api.github.com/users/cxorm/orgs","repos_url":"https://api.github.com/users/cxorm/repos","events_url":"https://api.github.com/users/cxorm/events{/privacy}","received_events_url":"https://api.github.com/users/cxorm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-23T08:23:04Z","updated_at":"2020-11-23T08:23:04Z","author_association":"MEMBER","body":"Thank you @runzhiwang for the review and merge.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732005498/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732925118","html_url":"https://github.com/apache/ratis/pull/296#issuecomment-732925118","issue_url":"https://api.github.com/repos/apache/ratis/issues/296","id":732925118,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjkyNTExOA==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-24T12:07:09Z","updated_at":"2020-11-24T12:08:36Z","author_association":"CONTRIBUTOR","body":"@szetszwo Hi, in transferTo method there are three methods: transferToDirectly which use sendfile and is the fastest, transferToTrustedChannel which use MapByteBuffer, transferToArbitraryChannel which use HeapByteBuffer and is the slowest. Our code use the slowest transferToArbitraryChannel , which will use HeapByteBuffer as the image shows. Not sure whether can we support transferToDirectly or transferToTrustedChannel, maybe we can not use netty if we want to support transferToDirectly.\r\n\r\n![image](https://user-images.githubusercontent.com/51938049/100091291-5e2adb00-2e8f-11eb-8efb-c0940bde7357.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732925118/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732937162","html_url":"https://github.com/apache/ratis/pull/296#issuecomment-732937162","issue_url":"https://api.github.com/repos/apache/ratis/issues/296","id":732937162,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjkzNzE2Mg==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-24T12:15:04Z","updated_at":"2020-11-24T12:15:04Z","author_association":"CONTRIBUTOR","body":"@runzhiwang , good observation.   I guess it depends on the ByteBuffer type in the source.  If it is direct buffer, it will use transferToDirectly.  The test uses FileInputStream which probably is not using direct buffer.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732937162/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732944191","html_url":"https://github.com/apache/ratis/pull/296#issuecomment-732944191","issue_url":"https://api.github.com/repos/apache/ratis/issues/296","id":732944191,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjk0NDE5MQ==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-24T12:30:06Z","updated_at":"2020-11-24T12:30:06Z","author_association":"CONTRIBUTOR","body":"@runzhiwang ,  just found that our WritableByteChannel should at least extend SelectableChannel.  Then, it may be able to use transferToDirectly.  This needs some research.\r\n\r\nHow about we commit this first and continue the work in another JIRA?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732944191/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732944678","html_url":"https://github.com/apache/ratis/pull/296#issuecomment-732944678","issue_url":"https://api.github.com/repos/apache/ratis/issues/296","id":732944678,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjk0NDY3OA==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-24T12:31:08Z","updated_at":"2020-11-24T12:31:08Z","author_association":"CONTRIBUTOR","body":"@szetszwo Sure, thanks for explanation.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732944678/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732955407","html_url":"https://github.com/apache/ratis/pull/296#issuecomment-732955407","issue_url":"https://api.github.com/repos/apache/ratis/issues/296","id":732955407,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjk1NTQwNw==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-24T12:53:38Z","updated_at":"2020-11-24T12:53:38Z","author_association":"CONTRIBUTOR","body":"Another way is to provide a different API for transferring files, say\r\n```\r\n  CompletableFuture<DataStreamReply> writeAsync(RandomAccessFile);\r\n```\r\nThen, we may use Netty DefaultFileRegion for zero-copy file transfer.\r\nhttps://github.com/netty/netty/blob/4.1/example/src/main/java/io/netty/example/file/FileServerHandler.java#L53","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732955407/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732960300","html_url":"https://github.com/apache/ratis/pull/296#issuecomment-732960300","issue_url":"https://api.github.com/repos/apache/ratis/issues/296","id":732960300,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjk2MDMwMA==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-24T13:03:32Z","updated_at":"2020-11-24T13:03:32Z","author_association":"CONTRIBUTOR","body":"@szetszwo  I agree. Do you think it can be used in ozone case, maybe can be used to write file smaller than 128MB, i.e. the size of block ? For file bigger than 128MB, we must split it into multi blocks, and can not use transferTo.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732960300/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732963170","html_url":"https://github.com/apache/ratis/pull/296#issuecomment-732963170","issue_url":"https://api.github.com/repos/apache/ratis/issues/296","id":732963170,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjk2MzE3MA==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-24T13:09:20Z","updated_at":"2020-11-24T13:10:53Z","author_association":"CONTRIBUTOR","body":"Sorry my bad, transferTo support offset (i.e. the parameter position), for big file, we can also use transferTo to split it into multi blocks.\r\n\r\n```\r\npublic abstract long transferTo(long position, long count,\r\n                                    WritableByteChannel target)\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732963170/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732963946","html_url":"https://github.com/apache/ratis/pull/296#issuecomment-732963946","issue_url":"https://api.github.com/repos/apache/ratis/issues/296","id":732963946,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjk2Mzk0Ng==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-24T13:10:50Z","updated_at":"2020-11-24T13:10:50Z","author_association":"CONTRIBUTOR","body":"We still can use transferTo for file > 128MB since the API can specify position and count.\r\nhttps://netty.io/4.1/api/io/netty/channel/DefaultFileRegion.html#DefaultFileRegion-java.nio.channels.FileChannel-long-long-\r\n\r\nUser may pass a large file.  Internally, we send it by chunks.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732963946/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732968122","html_url":"https://github.com/apache/ratis/pull/296#issuecomment-732968122","issue_url":"https://api.github.com/repos/apache/ratis/issues/296","id":732968122,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjk2ODEyMg==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-24T13:18:48Z","updated_at":"2020-11-24T13:44:09Z","author_association":"CONTRIBUTOR","body":"transferTo can avoid reading data to user space, it transfer data between kernel space and socket/disk. \r\n\r\n1. But we need to calculate checksum, so client still need read data, to avoid reading data to user space, we can use MapByteBuffer.  so we need 2 times read data from disk to kernel space: transferTo and MapByteBuffer. \r\n\r\n2. Besides, if we use transferTo, client transfer data to three nodes in parallel maybe best, otherwise if we use client -> primary -> peer, primary must wait finish write 128MB block, and then transfer the whole block file to follower, it maybe slow, but if client transfer data to three nodes in parallel, \"the client has a higher network bandwidth requirement and it cannot optimise the network traffic\". \r\n\r\nSo not sure whether we can use transferTo in ozone.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732968122/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732988191","html_url":"https://github.com/apache/ratis/pull/296#issuecomment-732988191","issue_url":"https://api.github.com/repos/apache/ratis/issues/296","id":732988191,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjk4ODE5MQ==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-24T13:56:10Z","updated_at":"2020-11-24T13:56:10Z","author_association":"CONTRIBUTOR","body":"> ... , otherwise if we use client -> primary -> peer, primary must wait finish write 128MB block, and then transfer the whole block file to follower ...\r\n\r\nNo.  The transferTo method calls WritableByteChannel.write(..) multiple times.  For example, transferToArbitraryChannel(..) create a 8KB buffer and call WritableByteChannel.write(..) every 8KB.  We must send small packets in Streaming.\r\n```\r\n//sun.nio.ch.FileChannelImpl\r\n  private long transferToArbitraryChannel(long var1, int var3, WritableByteChannel var4) throws IOException {\r\n    int var5 = Math.min(var3, 8192);\r\n    ByteBuffer var6 = Util.getTemporaryDirectBuffer(var5);\r\n```\r\nvar6 above is the 8KB buffer.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732988191/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732990668","html_url":"https://github.com/apache/ratis/pull/296#issuecomment-732990668","issue_url":"https://api.github.com/repos/apache/ratis/issues/296","id":732990668,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjk5MDY2OA==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-24T13:59:56Z","updated_at":"2020-11-24T13:59:56Z","author_association":"CONTRIBUTOR","body":"> But we need to calculate checksum, so client still need read data, to avoid reading data to user space, we can use MapByteBuffer. so we need 2 times read data from disk to kernel space: transferTo and MapByteBuffer.\r\n\r\nWe may pass MapByteBuffer to our writeAsync(..) method.  We should benchmark it.  I suspect it is better than transferTo(..) since it is using transferToArbitraryChannel(..).","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732990668/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732992036","html_url":"https://github.com/apache/ratis/pull/296#issuecomment-732992036","issue_url":"https://api.github.com/repos/apache/ratis/issues/296","id":732992036,"node_id":"MDEyOklzc3VlQ29tbWVudDczMjk5MjAzNg==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-24T14:02:01Z","updated_at":"2020-11-24T14:02:01Z","author_association":"CONTRIBUTOR","body":"@runzhiwang , thanks a lot for reviewing this.  Let's continue the discussion on https://issues.apache.org/jira/browse/RATIS-1176","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/732992036/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/733293047","html_url":"https://github.com/apache/ratis/pull/298#issuecomment-733293047","issue_url":"https://api.github.com/repos/apache/ratis/issues/298","id":733293047,"node_id":"MDEyOklzc3VlQ29tbWVudDczMzI5MzA0Nw==","user":{"login":"amaliujia","id":1938382,"node_id":"MDQ6VXNlcjE5MzgzODI=","avatar_url":"https://avatars.githubusercontent.com/u/1938382?v=4","gravatar_id":"","url":"https://api.github.com/users/amaliujia","html_url":"https://github.com/amaliujia","followers_url":"https://api.github.com/users/amaliujia/followers","following_url":"https://api.github.com/users/amaliujia/following{/other_user}","gists_url":"https://api.github.com/users/amaliujia/gists{/gist_id}","starred_url":"https://api.github.com/users/amaliujia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaliujia/subscriptions","organizations_url":"https://api.github.com/users/amaliujia/orgs","repos_url":"https://api.github.com/users/amaliujia/repos","events_url":"https://api.github.com/users/amaliujia/events{/privacy}","received_events_url":"https://api.github.com/users/amaliujia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-24T23:31:52Z","updated_at":"2020-11-24T23:31:52Z","author_association":"CONTRIBUTOR","body":"cc @szetszwo @runzhiwang  please let me know if you have any early feedback.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/733293047/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/733295325","html_url":"https://github.com/apache/ratis/pull/298#issuecomment-733295325","issue_url":"https://api.github.com/repos/apache/ratis/issues/298","id":733295325,"node_id":"MDEyOklzc3VlQ29tbWVudDczMzI5NTMyNQ==","user":{"login":"amaliujia","id":1938382,"node_id":"MDQ6VXNlcjE5MzgzODI=","avatar_url":"https://avatars.githubusercontent.com/u/1938382?v=4","gravatar_id":"","url":"https://api.github.com/users/amaliujia","html_url":"https://github.com/amaliujia","followers_url":"https://api.github.com/users/amaliujia/followers","following_url":"https://api.github.com/users/amaliujia/following{/other_user}","gists_url":"https://api.github.com/users/amaliujia/gists{/gist_id}","starred_url":"https://api.github.com/users/amaliujia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaliujia/subscriptions","organizations_url":"https://api.github.com/users/amaliujia/orgs","repos_url":"https://api.github.com/users/amaliujia/repos","events_url":"https://api.github.com/users/amaliujia/events{/privacy}","received_events_url":"https://api.github.com/users/amaliujia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-24T23:38:30Z","updated_at":"2020-11-24T23:38:30Z","author_association":"CONTRIBUTOR","body":"The basic idea so far is FileStore should initialize a DataStream by a customized header request, which specifies a file path.\r\n\r\nThen on FileStateMachine side, based on that header request, it will initialize a channel based on the file path. \r\n\r\nThen stream writes go in. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/733295325/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/733402768","html_url":"https://github.com/apache/ratis/pull/298#issuecomment-733402768","issue_url":"https://api.github.com/repos/apache/ratis/issues/298","id":733402768,"node_id":"MDEyOklzc3VlQ29tbWVudDczMzQwMjc2OA==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-25T01:23:10Z","updated_at":"2020-11-25T01:27:37Z","author_association":"CONTRIBUTOR","body":"Consider the existing code for async:\r\n```\r\n//FileStoreClient\r\n  private static <OUTPUT, THROWABLE extends Throwable> OUTPUT writeImpl(\r\n      CheckedFunction<ByteString, OUTPUT, THROWABLE> sendFunction,\r\n      String path, long offset, boolean close, ByteBuffer data)\r\n      throws THROWABLE {\r\n    final WriteRequestHeaderProto.Builder header = WriteRequestHeaderProto.newBuilder()\r\n        .setPath(ProtoUtils.toByteString(path))\r\n        .setOffset(offset)\r\n        .setLength(data.position())\r\n        .setClose(close);\r\n\r\n    final WriteRequestProto.Builder write = WriteRequestProto.newBuilder()\r\n        .setHeader(header)\r\n        .setData(ByteString.copyFrom(data));\r\n\r\n    final FileStoreRequestProto request = FileStoreRequestProto.newBuilder().setWrite(write).build();\r\n    return sendFunction.apply(request.toByteString());\r\n  }\r\n```\r\nThe idea is to define the streaming message format as below:\r\n```\r\n<header-length><header><data>\r\n```\r\nThe entire message could be big, say 100MB.  We divide it in chunks, say 1MB, and send them using DataStreamOutput.writeAsync.\r\n\r\nWe send a WriteRequestHeaderProto per message in Async.  In Streaming, we only need to send a header (say StreamRequestHeaderProto) once for the entire stream since the entire stream is logically a single message.  The StreamRequestHeaderProto has path and data length.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/733402768/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/733438963","html_url":"https://github.com/apache/ratis/pull/298#issuecomment-733438963","issue_url":"https://api.github.com/repos/apache/ratis/issues/298","id":733438963,"node_id":"MDEyOklzc3VlQ29tbWVudDczMzQzODk2Mw==","user":{"login":"amaliujia","id":1938382,"node_id":"MDQ6VXNlcjE5MzgzODI=","avatar_url":"https://avatars.githubusercontent.com/u/1938382?v=4","gravatar_id":"","url":"https://api.github.com/users/amaliujia","html_url":"https://github.com/amaliujia","followers_url":"https://api.github.com/users/amaliujia/followers","following_url":"https://api.github.com/users/amaliujia/following{/other_user}","gists_url":"https://api.github.com/users/amaliujia/gists{/gist_id}","starred_url":"https://api.github.com/users/amaliujia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaliujia/subscriptions","organizations_url":"https://api.github.com/users/amaliujia/orgs","repos_url":"https://api.github.com/users/amaliujia/repos","events_url":"https://api.github.com/users/amaliujia/events{/privacy}","received_events_url":"https://api.github.com/users/amaliujia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-25T03:24:53Z","updated_at":"2020-11-25T03:24:53Z","author_association":"CONTRIBUTOR","body":"Thank you! Will update based on current comments.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/733438963/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734020368","html_url":"https://github.com/apache/ratis/pull/299#issuecomment-734020368","issue_url":"https://api.github.com/repos/apache/ratis/issues/299","id":734020368,"node_id":"MDEyOklzc3VlQ29tbWVudDczNDAyMDM2OA==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-26T01:24:46Z","updated_at":"2020-11-26T01:36:44Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks the great work, the improvement is awesome.  But now transferTo only work on client, and it did not work on primary.  \r\n\r\n1. when primary/peer receive data and store data to disk, the data flow is: socket -> kernel space -> user space (DirectByteBuffer) -> kernel space -> disk\r\n2. when primary receive data and send data to peer, the data flow is: socket -> kernel space -> user space (DirectByteBuffer same to the previous) -> kernel space -> socket.  \r\n\r\nAnd I think the ideal flow as follows, because we do not need to read the data in user space, but I'm not sure whether can we achieve it.\r\n\r\n1. when primary/peer receive data and store data to disk, the data flow is: socket -> kernel space -> disk\r\n2. when primary receive data and send data to peer, the data flow is: socket (or disk) -> kernel space -> socket\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734020368/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734032065","html_url":"https://github.com/apache/ratis/pull/299#issuecomment-734032065","issue_url":"https://api.github.com/repos/apache/ratis/issues/299","id":734032065,"node_id":"MDEyOklzc3VlQ29tbWVudDczNDAzMjA2NQ==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-26T02:11:22Z","updated_at":"2020-11-26T02:11:22Z","author_association":"CONTRIBUTOR","body":"Good points.  For servers, we should use ByteBuf.writeBytes\r\nhttps://netty.io/4.1/api/io/netty/buffer/ByteBuf.html#writeBytes-java.nio.channels.FileChannel-long-int-\r\n\r\nLet's work on it in a separate JIRA.\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734032065/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734032635","html_url":"https://github.com/apache/ratis/pull/299#issuecomment-734032635","issue_url":"https://api.github.com/repos/apache/ratis/issues/299","id":734032635,"node_id":"MDEyOklzc3VlQ29tbWVudDczNDAzMjYzNQ==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-26T02:13:30Z","updated_at":"2020-11-26T02:13:30Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks the great patch. I have merge it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734032635/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734034426","html_url":"https://github.com/apache/ratis/pull/300#issuecomment-734034426","issue_url":"https://api.github.com/repos/apache/ratis/issues/300","id":734034426,"node_id":"MDEyOklzc3VlQ29tbWVudDczNDAzNDQyNg==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-26T02:20:40Z","updated_at":"2020-11-26T02:20:40Z","author_association":"CONTRIBUTOR","body":"@bharatviswa504 , just have filed https://issues.apache.org/jira/browse/HDDS-4517 and https://issues.apache.org/jira/browse/RATIS-1181 .","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734034426/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734039981","html_url":"https://github.com/apache/ratis/pull/299#issuecomment-734039981","issue_url":"https://api.github.com/repos/apache/ratis/issues/299","id":734039981,"node_id":"MDEyOklzc3VlQ29tbWVudDczNDAzOTk4MQ==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-26T02:41:10Z","updated_at":"2020-11-26T02:41:10Z","author_association":"CONTRIBUTOR","body":"@runzhiwang ,  thanks for merging this.\r\n\r\nBtw, just have checked FileChannelImpl.write(ByteBuffer).  It will call \r\n```\r\n//FileChannelImpl.write\r\nIOUtil.write(this.fd, var1, -1L, this.nd);\r\n```\r\nand then\r\n```\r\n//IOUtil.write\r\n  static int write(FileDescriptor var0, ByteBuffer var1, long var2, NativeDispatcher var4) throws IOException {\r\n    if (var1 instanceof DirectBuffer) {\r\n      return writeFromNativeBuffer(var0, var1, var2, var4);\r\n```\r\nI suspect writeFromNativeBuffer is already zero-copy.  If it is the case, the current server implementation is working fine.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734039981/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734048255","html_url":"https://github.com/apache/ratis/pull/289#issuecomment-734048255","issue_url":"https://api.github.com/repos/apache/ratis/issues/289","id":734048255,"node_id":"MDEyOklzc3VlQ29tbWVudDczNDA0ODI1NQ==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-26T03:14:04Z","updated_at":"2020-11-26T03:14:04Z","author_association":"CONTRIBUTOR","body":"@lokeshj1703 , could you take a look the latest change?  Thanks.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734048255/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734173964","html_url":"https://github.com/apache/ratis/pull/299#issuecomment-734173964","issue_url":"https://api.github.com/repos/apache/ratis/issues/299","id":734173964,"node_id":"MDEyOklzc3VlQ29tbWVudDczNDE3Mzk2NA==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-26T09:13:08Z","updated_at":"2020-11-26T09:13:08Z","author_association":"CONTRIBUTOR","body":"@szetszwo Hi, I draw a diagram of the data flow: client -> primary -> peer, when we use transferTo. Do you have any other  suggestions about improving the flow efficiency ?\r\n![image](https://user-images.githubusercontent.com/51938049/100330847-6b200980-300a-11eb-84b3-6dbf0f82145e.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734173964/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734202335","html_url":"https://github.com/apache/ratis/pull/299#issuecomment-734202335","issue_url":"https://api.github.com/repos/apache/ratis/issues/299","id":734202335,"node_id":"MDEyOklzc3VlQ29tbWVudDczNDIwMjMzNQ==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-26T10:05:14Z","updated_at":"2020-11-26T10:05:14Z","author_association":"CONTRIBUTOR","body":"Your diagram looks very nice.  Could you post it on RATIS-1176?\r\n\r\nSuppose the state machine only writes the data to files but not reading it or computing checksums.  Netty may be able to avoid moving it to the user space.  Need to check about it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734202335/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734218474","html_url":"https://github.com/apache/ratis/pull/289#issuecomment-734218474","issue_url":"https://api.github.com/repos/apache/ratis/issues/289","id":734218474,"node_id":"MDEyOklzc3VlQ29tbWVudDczNDIxODQ3NA==","user":{"login":"lokeshj1703","id":9255455,"node_id":"MDQ6VXNlcjkyNTU0NTU=","avatar_url":"https://avatars.githubusercontent.com/u/9255455?v=4","gravatar_id":"","url":"https://api.github.com/users/lokeshj1703","html_url":"https://github.com/lokeshj1703","followers_url":"https://api.github.com/users/lokeshj1703/followers","following_url":"https://api.github.com/users/lokeshj1703/following{/other_user}","gists_url":"https://api.github.com/users/lokeshj1703/gists{/gist_id}","starred_url":"https://api.github.com/users/lokeshj1703/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lokeshj1703/subscriptions","organizations_url":"https://api.github.com/users/lokeshj1703/orgs","repos_url":"https://api.github.com/users/lokeshj1703/repos","events_url":"https://api.github.com/users/lokeshj1703/events{/privacy}","received_events_url":"https://api.github.com/users/lokeshj1703/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-26T10:36:23Z","updated_at":"2020-11-26T10:38:20Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks for the contribution! @runzhiwang @GlenGeng Thanks for the reviews! I have committed the PR to master branch.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734218474/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734224293","html_url":"https://github.com/apache/ratis/pull/299#issuecomment-734224293","issue_url":"https://api.github.com/repos/apache/ratis/issues/299","id":734224293,"node_id":"MDEyOklzc3VlQ29tbWVudDczNDIyNDI5Mw==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-26T10:47:35Z","updated_at":"2020-11-26T10:47:35Z","author_association":"CONTRIBUTOR","body":"@szetszwo Sure, let me post it on RATIS-1176","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734224293/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734431840","html_url":"https://github.com/apache/ratis/pull/300#issuecomment-734431840","issue_url":"https://api.github.com/repos/apache/ratis/issues/300","id":734431840,"node_id":"MDEyOklzc3VlQ29tbWVudDczNDQzMTg0MA==","user":{"login":"bharatviswa504","id":8586345,"node_id":"MDQ6VXNlcjg1ODYzNDU=","avatar_url":"https://avatars.githubusercontent.com/u/8586345?v=4","gravatar_id":"","url":"https://api.github.com/users/bharatviswa504","html_url":"https://github.com/bharatviswa504","followers_url":"https://api.github.com/users/bharatviswa504/followers","following_url":"https://api.github.com/users/bharatviswa504/following{/other_user}","gists_url":"https://api.github.com/users/bharatviswa504/gists{/gist_id}","starred_url":"https://api.github.com/users/bharatviswa504/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bharatviswa504/subscriptions","organizations_url":"https://api.github.com/users/bharatviswa504/orgs","repos_url":"https://api.github.com/users/bharatviswa504/repos","events_url":"https://api.github.com/users/bharatviswa504/events{/privacy}","received_events_url":"https://api.github.com/users/bharatviswa504/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-26T18:12:58Z","updated_at":"2020-11-26T18:13:39Z","author_association":"CONTRIBUTOR","body":"> @bharatviswa504 , just have filed https://issues.apache.org/jira/browse/HDDS-4517 and https://issues.apache.org/jira/browse/RATIS-1181 .\r\n\r\nThank You @szetszwo . I will try to use the new APIs which will be introduced as part of  RATIS-1181.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/734431840/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/735040004","html_url":"https://github.com/apache/ratis/pull/298#issuecomment-735040004","issue_url":"https://api.github.com/repos/apache/ratis/issues/298","id":735040004,"node_id":"MDEyOklzc3VlQ29tbWVudDczNTA0MDAwNA==","user":{"login":"amaliujia","id":1938382,"node_id":"MDQ6VXNlcjE5MzgzODI=","avatar_url":"https://avatars.githubusercontent.com/u/1938382?v=4","gravatar_id":"","url":"https://api.github.com/users/amaliujia","html_url":"https://github.com/amaliujia","followers_url":"https://api.github.com/users/amaliujia/followers","following_url":"https://api.github.com/users/amaliujia/following{/other_user}","gists_url":"https://api.github.com/users/amaliujia/gists{/gist_id}","starred_url":"https://api.github.com/users/amaliujia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaliujia/subscriptions","organizations_url":"https://api.github.com/users/amaliujia/orgs","repos_url":"https://api.github.com/users/amaliujia/repos","events_url":"https://api.github.com/users/amaliujia/events{/privacy}","received_events_url":"https://api.github.com/users/amaliujia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-28T04:55:54Z","updated_at":"2020-11-28T04:55:54Z","author_association":"CONTRIBUTOR","body":"@szetszwo sorry for a bit delay on this PR.\r\n\r\nSending a `StreamRequestHeaderProto` which includes path and data length make senses to me. This is also what I am trying to achieve in this PR.\r\n\r\nThe question so far is, how to allow user send StreamRequestHeaderProto (or any other proto) to state machine?\r\n\r\nI think there are two models:\r\n1. Add it as a part of the stream header request. This will require to update DataStreamApi to expose a method (e.g. `DataStreamOutput stream(ByteBuffer headerContent)`). In this model, the header request will include information to initialize a data stream in state machine. \r\n2. Keep stream header as what it is now, and for `StreamRequestHeaderProto`, user can use `DataStreamOutput.writeAsync` to send it (so `DataStreamOutput.writeAsync` is one of the stream DATA packet). In this case, state machine will need to understand that not all DATA is data, one could be a special proto.\r\n\r\nTo me the model 1 is easy to use. What do you think?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/735040004/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/735040605","html_url":"https://github.com/apache/ratis/pull/298#issuecomment-735040605","issue_url":"https://api.github.com/repos/apache/ratis/issues/298","id":735040605,"node_id":"MDEyOklzc3VlQ29tbWVudDczNTA0MDYwNQ==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-28T05:03:47Z","updated_at":"2020-11-28T05:04:47Z","author_association":"CONTRIBUTOR","body":" (1) sounds good.   Then, the headerContent becomes the message (currently is null) in the RaftClientRequest.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/735040605/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/735045358","html_url":"https://github.com/apache/ratis/pull/298#issuecomment-735045358","issue_url":"https://api.github.com/repos/apache/ratis/issues/298","id":735045358,"node_id":"MDEyOklzc3VlQ29tbWVudDczNTA0NTM1OA==","user":{"login":"amaliujia","id":1938382,"node_id":"MDQ6VXNlcjE5MzgzODI=","avatar_url":"https://avatars.githubusercontent.com/u/1938382?v=4","gravatar_id":"","url":"https://api.github.com/users/amaliujia","html_url":"https://github.com/amaliujia","followers_url":"https://api.github.com/users/amaliujia/followers","following_url":"https://api.github.com/users/amaliujia/following{/other_user}","gists_url":"https://api.github.com/users/amaliujia/gists{/gist_id}","starred_url":"https://api.github.com/users/amaliujia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaliujia/subscriptions","organizations_url":"https://api.github.com/users/amaliujia/orgs","repos_url":"https://api.github.com/users/amaliujia/repos","events_url":"https://api.github.com/users/amaliujia/events{/privacy}","received_events_url":"https://api.github.com/users/amaliujia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-28T06:10:50Z","updated_at":"2020-11-28T06:10:50Z","author_association":"CONTRIBUTOR","body":"@szetszwo  PR updated. Can you take a look? I am sure this PR will need more updates :)\r\n\r\nMeanwhile, I found that the unit test I added is flaky, I am still working on understanding the cause of the flakyness.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/735045358/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/735052536","html_url":"https://github.com/apache/ratis/pull/298#issuecomment-735052536","issue_url":"https://api.github.com/repos/apache/ratis/issues/298","id":735052536,"node_id":"MDEyOklzc3VlQ29tbWVudDczNTA1MjUzNg==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-28T07:50:40Z","updated_at":"2020-11-28T07:50:40Z","author_association":"CONTRIBUTOR","body":"> Meanwhile, I found that the unit test I added is flaky, I am still working on understanding the cause of the flakyness.\r\n\r\nIt need to implement DataApi.link(..).","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/735052536/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/735798814","html_url":"https://github.com/apache/ratis/pull/308#issuecomment-735798814","issue_url":"https://api.github.com/repos/apache/ratis/issues/308","id":735798814,"node_id":"MDEyOklzc3VlQ29tbWVudDczNTc5ODgxNA==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-30T13:52:45Z","updated_at":"2020-11-30T13:52:45Z","author_association":"CONTRIBUTOR","body":"@szetszwo Could you have a brief review ? If you agree with the idea, I will fix the failed ut.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/735798814/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/736082327","html_url":"https://github.com/apache/ratis/pull/298#issuecomment-736082327","issue_url":"https://api.github.com/repos/apache/ratis/issues/298","id":736082327,"node_id":"MDEyOklzc3VlQ29tbWVudDczNjA4MjMyNw==","user":{"login":"amaliujia","id":1938382,"node_id":"MDQ6VXNlcjE5MzgzODI=","avatar_url":"https://avatars.githubusercontent.com/u/1938382?v=4","gravatar_id":"","url":"https://api.github.com/users/amaliujia","html_url":"https://github.com/amaliujia","followers_url":"https://api.github.com/users/amaliujia/followers","following_url":"https://api.github.com/users/amaliujia/following{/other_user}","gists_url":"https://api.github.com/users/amaliujia/gists{/gist_id}","starred_url":"https://api.github.com/users/amaliujia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaliujia/subscriptions","organizations_url":"https://api.github.com/users/amaliujia/orgs","repos_url":"https://api.github.com/users/amaliujia/repos","events_url":"https://api.github.com/users/amaliujia/events{/privacy}","received_events_url":"https://api.github.com/users/amaliujia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-11-30T22:00:48Z","updated_at":"2020-11-30T22:03:42Z","author_association":"CONTRIBUTOR","body":"@szetszwo sorry for a bit delay on this PR.\r\n\r\n1. Until this moment I am still not sure what `DataApi.link(..)` is supposed to do for `FileStoreStateMachine`. Any hint for it? Given a DataStream and a LogEntryProto, what's the required operation to link these two objects?\r\n\r\n2. I updated the unit test and found that transaction cannot be applied successfully. The debugger did not stop at `DataApi.link(..)` so it might not because that I haven't implemented the `DataApi.link` API. I am still debugging why it cannot apply transaction successfully (async API is a bit hard to debug) and will update when I find something interesting. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/736082327/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/736130756","html_url":"https://github.com/apache/ratis/pull/298#issuecomment-736130756","issue_url":"https://api.github.com/repos/apache/ratis/issues/298","id":736130756,"node_id":"MDEyOklzc3VlQ29tbWVudDczNjEzMDc1Ng==","user":{"login":"amaliujia","id":1938382,"node_id":"MDQ6VXNlcjE5MzgzODI=","avatar_url":"https://avatars.githubusercontent.com/u/1938382?v=4","gravatar_id":"","url":"https://api.github.com/users/amaliujia","html_url":"https://github.com/amaliujia","followers_url":"https://api.github.com/users/amaliujia/followers","following_url":"https://api.github.com/users/amaliujia/following{/other_user}","gists_url":"https://api.github.com/users/amaliujia/gists{/gist_id}","starred_url":"https://api.github.com/users/amaliujia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaliujia/subscriptions","organizations_url":"https://api.github.com/users/amaliujia/orgs","repos_url":"https://api.github.com/users/amaliujia/repos","events_url":"https://api.github.com/users/amaliujia/events{/privacy}","received_events_url":"https://api.github.com/users/amaliujia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-01T00:11:06Z","updated_at":"2020-12-01T00:19:42Z","author_association":"CONTRIBUTOR","body":"I have identified the reason for failing to apply the transaction: https://github.com/apache/incubator-ratis/blob/ebabdbf570b50af0d868a5f4e5acf6fe5adc4876/ratis-examples/src/main/java/org/apache/ratis/examples/filestore/FileStoreStateMachine.java#L94\r\n\r\nThe request in STREAM header will be sent to leader, and hits this line. Because now we have allowed a customized message in that request, so need to update here as well to parse the proper proto. \r\n\r\n----------------\r\n\r\nactually no... the `StreamWriteRequestHeaderProto`  is added to the example proto so this function is supposed to be changed. \r\n\r\nI am guessing that this request is not the request in stream header but still checking. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/736130756/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/736141905","html_url":"https://github.com/apache/ratis/pull/298#issuecomment-736141905","issue_url":"https://api.github.com/repos/apache/ratis/issues/298","id":736141905,"node_id":"MDEyOklzc3VlQ29tbWVudDczNjE0MTkwNQ==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-01T00:40:17Z","updated_at":"2020-12-01T00:40:17Z","author_association":"CONTRIBUTOR","body":"> 1. Until this moment I am still not sure what DataApi.link(..) is supposed to do for FileStoreStateMachine. ...\r\n\r\nlink(..) is to tell the StateMachine that the stream data must be persisted with the log entry.   Later, we can ask the StateMachine to handle the data for log operations such as appendEntry and truncate.  Otherwise, the StateMachine won't know whether the log entry is persisted.\r\n\r\n> 2. I updated the unit test and found that transaction cannot be applied successfully. ...\r\n\r\nPlease feel free to upload the code.  I can take a look.\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/736141905/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/736153313","html_url":"https://github.com/apache/ratis/pull/298#issuecomment-736153313","issue_url":"https://api.github.com/repos/apache/ratis/issues/298","id":736153313,"node_id":"MDEyOklzc3VlQ29tbWVudDczNjE1MzMxMw==","user":{"login":"amaliujia","id":1938382,"node_id":"MDQ6VXNlcjE5MzgzODI=","avatar_url":"https://avatars.githubusercontent.com/u/1938382?v=4","gravatar_id":"","url":"https://api.github.com/users/amaliujia","html_url":"https://github.com/amaliujia","followers_url":"https://api.github.com/users/amaliujia/followers","following_url":"https://api.github.com/users/amaliujia/following{/other_user}","gists_url":"https://api.github.com/users/amaliujia/gists{/gist_id}","starred_url":"https://api.github.com/users/amaliujia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaliujia/subscriptions","organizations_url":"https://api.github.com/users/amaliujia/orgs","repos_url":"https://api.github.com/users/amaliujia/repos","events_url":"https://api.github.com/users/amaliujia/events{/privacy}","received_events_url":"https://api.github.com/users/amaliujia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-01T01:17:18Z","updated_at":"2020-12-01T01:17:18Z","author_association":"CONTRIBUTOR","body":"@szetszwo  code is updated. For the test Basically I added one more verification and then realized that transaction failed to commit: \r\n```\r\n    DataStreamReply reply = dataStreamOutput.closeAsync().join();\r\n    Assert.assertTrue(reply.isSuccess());\r\n``` ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/736153313/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/736306660","html_url":"https://github.com/apache/ratis/pull/310#issuecomment-736306660","issue_url":"https://api.github.com/repos/apache/ratis/issues/310","id":736306660,"node_id":"MDEyOklzc3VlQ29tbWVudDczNjMwNjY2MA==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-01T08:24:52Z","updated_at":"2020-12-01T08:24:52Z","author_association":"CONTRIBUTOR","body":"This pr depends on https://github.com/apache/incubator-ratis/pull/308","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/736306660/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/736587463","html_url":"https://github.com/apache/ratis/pull/308#issuecomment-736587463","issue_url":"https://api.github.com/repos/apache/ratis/issues/308","id":736587463,"node_id":"MDEyOklzc3VlQ29tbWVudDczNjU4NzQ2Mw==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-01T14:30:09Z","updated_at":"2020-12-01T14:30:09Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks for review. I have merged the patch, because CI passed.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/736587463/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737024322","html_url":"https://github.com/apache/ratis/pull/298#issuecomment-737024322","issue_url":"https://api.github.com/repos/apache/ratis/issues/298","id":737024322,"node_id":"MDEyOklzc3VlQ29tbWVudDczNzAyNDMyMg==","user":{"login":"amaliujia","id":1938382,"node_id":"MDQ6VXNlcjE5MzgzODI=","avatar_url":"https://avatars.githubusercontent.com/u/1938382?v=4","gravatar_id":"","url":"https://api.github.com/users/amaliujia","html_url":"https://github.com/amaliujia","followers_url":"https://api.github.com/users/amaliujia/followers","following_url":"https://api.github.com/users/amaliujia/following{/other_user}","gists_url":"https://api.github.com/users/amaliujia/gists{/gist_id}","starred_url":"https://api.github.com/users/amaliujia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaliujia/subscriptions","organizations_url":"https://api.github.com/users/amaliujia/orgs","repos_url":"https://api.github.com/users/amaliujia/repos","events_url":"https://api.github.com/users/amaliujia/events{/privacy}","received_events_url":"https://api.github.com/users/amaliujia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-02T06:32:43Z","updated_at":"2020-12-02T06:32:43Z","author_association":"CONTRIBUTOR","body":"@szetszwo PR updated. Can you take a look? The test is not longer flaky now.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737024322/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737060105","html_url":"https://github.com/apache/ratis/pull/312#issuecomment-737060105","issue_url":"https://api.github.com/repos/apache/ratis/issues/312","id":737060105,"node_id":"MDEyOklzc3VlQ29tbWVudDczNzA2MDEwNQ==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-02T07:56:28Z","updated_at":"2020-12-02T07:56:28Z","author_association":"CONTRIBUTOR","body":"@GlenGeng I will merge this patch once CI passed.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737060105/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737067096","html_url":"https://github.com/apache/ratis/pull/312#issuecomment-737067096","issue_url":"https://api.github.com/repos/apache/ratis/issues/312","id":737067096,"node_id":"MDEyOklzc3VlQ29tbWVudDczNzA2NzA5Ng==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-02T08:11:58Z","updated_at":"2020-12-02T08:11:58Z","author_association":"CONTRIBUTOR","body":"We are going to add a public API DivisionInfo to get server states; see https://issues.apache.org/jira/browse/RATIS-1192\r\n\r\nRaftServerImpl will be changed to package private soon.\r\n\r\nHow about we add getRoleInfoProto() to DivisionInfo?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737067096/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737071936","html_url":"https://github.com/apache/ratis/pull/312#issuecomment-737071936","issue_url":"https://api.github.com/repos/apache/ratis/issues/312","id":737071936,"node_id":"MDEyOklzc3VlQ29tbWVudDczNzA3MTkzNg==","user":{"login":"GlenGeng-awx","id":8412672,"node_id":"MDQ6VXNlcjg0MTI2NzI=","avatar_url":"https://avatars.githubusercontent.com/u/8412672?v=4","gravatar_id":"","url":"https://api.github.com/users/GlenGeng-awx","html_url":"https://github.com/GlenGeng-awx","followers_url":"https://api.github.com/users/GlenGeng-awx/followers","following_url":"https://api.github.com/users/GlenGeng-awx/following{/other_user}","gists_url":"https://api.github.com/users/GlenGeng-awx/gists{/gist_id}","starred_url":"https://api.github.com/users/GlenGeng-awx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GlenGeng-awx/subscriptions","organizations_url":"https://api.github.com/users/GlenGeng-awx/orgs","repos_url":"https://api.github.com/users/GlenGeng-awx/repos","events_url":"https://api.github.com/users/GlenGeng-awx/events{/privacy}","received_events_url":"https://api.github.com/users/GlenGeng-awx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-02T08:22:14Z","updated_at":"2020-12-02T08:22:14Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks for looking this patch! That would be great to expose getRoleInfoProto() from the new added DivisionInfo.\r\n\r\nCurrent development on HDDS-2823 (SCM HA) relies on the public getRoleInfoProto(), so that we can inject term into SCMCommand, and help DN to distinguish a stale leader SCM. After merging back master, we found that we are not able to fetch term from underlying RaftServer. \r\n\r\nHow about merging this walk around right now, and discard it in your RATIS-1192?  @runzhiwang will help us to generate a ratis snapshot so that our development of SCM HA won't be blocked.\r\n\r\nThanks!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737071936/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737076981","html_url":"https://github.com/apache/ratis/pull/312#issuecomment-737076981","issue_url":"https://api.github.com/repos/apache/ratis/issues/312","id":737076981,"node_id":"MDEyOklzc3VlQ29tbWVudDczNzA3Njk4MQ==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-02T08:32:41Z","updated_at":"2020-12-02T08:32:41Z","author_association":"CONTRIBUTOR","body":"Sure.  We can merge this as a work around.  Thanks a lot!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737076981/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737214553","html_url":"https://github.com/apache/ratis/pull/200#issuecomment-737214553","issue_url":"https://api.github.com/repos/apache/ratis/issues/200","id":737214553,"node_id":"MDEyOklzc3VlQ29tbWVudDczNzIxNDU1Mw==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-02T12:58:33Z","updated_at":"2020-12-02T12:58:33Z","author_association":"CONTRIBUTOR","body":"@coolbeevip Thanks the patch, sorry for the late merge. @amaliujia Thanks for review. I have merged the patch.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737214553/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737541360","html_url":"https://github.com/apache/ratis/pull/315#issuecomment-737541360","issue_url":"https://api.github.com/repos/apache/ratis/issues/315","id":737541360,"node_id":"MDEyOklzc3VlQ29tbWVudDczNzU0MTM2MA==","user":{"login":"avijayanhwx","id":14299376,"node_id":"MDQ6VXNlcjE0Mjk5Mzc2","avatar_url":"https://avatars.githubusercontent.com/u/14299376?v=4","gravatar_id":"","url":"https://api.github.com/users/avijayanhwx","html_url":"https://github.com/avijayanhwx","followers_url":"https://api.github.com/users/avijayanhwx/followers","following_url":"https://api.github.com/users/avijayanhwx/following{/other_user}","gists_url":"https://api.github.com/users/avijayanhwx/gists{/gist_id}","starred_url":"https://api.github.com/users/avijayanhwx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/avijayanhwx/subscriptions","organizations_url":"https://api.github.com/users/avijayanhwx/orgs","repos_url":"https://api.github.com/users/avijayanhwx/repos","events_url":"https://api.github.com/users/avijayanhwx/events{/privacy}","received_events_url":"https://api.github.com/users/avijayanhwx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-02T22:45:14Z","updated_at":"2020-12-02T22:45:14Z","author_association":"CONTRIBUTOR","body":"cc @lokeshj1703 / @hanishakoneru for review.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737541360/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737594916","html_url":"https://github.com/apache/ratis/pull/126#issuecomment-737594916","issue_url":"https://api.github.com/repos/apache/ratis/issues/126","id":737594916,"node_id":"MDEyOklzc3VlQ29tbWVudDczNzU5NDkxNg==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-03T01:15:07Z","updated_at":"2020-12-03T01:15:07Z","author_association":"CONTRIBUTOR","body":"@adoroszlai Thanks the patch. @dineshchitlangia @bshashikant Thanks for review. I have merged the patch.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737594916/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737687666","html_url":"https://github.com/apache/ratis/pull/315#issuecomment-737687666","issue_url":"https://api.github.com/repos/apache/ratis/issues/315","id":737687666,"node_id":"MDEyOklzc3VlQ29tbWVudDczNzY4NzY2Ng==","user":{"login":"lokeshj1703","id":9255455,"node_id":"MDQ6VXNlcjkyNTU0NTU=","avatar_url":"https://avatars.githubusercontent.com/u/9255455?v=4","gravatar_id":"","url":"https://api.github.com/users/lokeshj1703","html_url":"https://github.com/lokeshj1703","followers_url":"https://api.github.com/users/lokeshj1703/followers","following_url":"https://api.github.com/users/lokeshj1703/following{/other_user}","gists_url":"https://api.github.com/users/lokeshj1703/gists{/gist_id}","starred_url":"https://api.github.com/users/lokeshj1703/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lokeshj1703/subscriptions","organizations_url":"https://api.github.com/users/lokeshj1703/orgs","repos_url":"https://api.github.com/users/lokeshj1703/repos","events_url":"https://api.github.com/users/lokeshj1703/events{/privacy}","received_events_url":"https://api.github.com/users/lokeshj1703/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-03T06:05:48Z","updated_at":"2020-12-03T06:05:48Z","author_association":"CONTRIBUTOR","body":"@avijayanhwx Thanks for the contribution! I have committed the PR to master branch.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737687666/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737730103","html_url":"https://github.com/apache/ratis/pull/126#issuecomment-737730103","issue_url":"https://api.github.com/repos/apache/ratis/issues/126","id":737730103,"node_id":"MDEyOklzc3VlQ29tbWVudDczNzczMDEwMw==","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-03T07:52:06Z","updated_at":"2020-12-03T07:52:06Z","author_association":"CONTRIBUTOR","body":"Thanks @runzhiwang for triggering CI and merging it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737730103/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737735251","html_url":"https://github.com/apache/ratis/pull/317#issuecomment-737735251","issue_url":"https://api.github.com/repos/apache/ratis/issues/317","id":737735251,"node_id":"MDEyOklzc3VlQ29tbWVudDczNzczNTI1MQ==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-03T08:03:48Z","updated_at":"2020-12-03T08:03:48Z","author_association":"CONTRIBUTOR","body":"@szetszwo Could you help review this ? ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737735251/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737819776","html_url":"https://github.com/apache/ratis/pull/317#issuecomment-737819776","issue_url":"https://api.github.com/repos/apache/ratis/issues/317","id":737819776,"node_id":"MDEyOklzc3VlQ29tbWVudDczNzgxOTc3Ng==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-03T10:05:07Z","updated_at":"2020-12-03T10:05:07Z","author_association":"CONTRIBUTOR","body":"Here is more details:\r\n```\r\ndiff --git a/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/LogSegment.java b/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/LogSegment.java\r\nindex fb58a4a8..3bd3076d 100644\r\n--- a/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/LogSegment.java\r\n+++ b/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/LogSegment.java\r\n@@ -60,8 +60,25 @@ public class LogSegment implements Comparable<Long> {\r\n \r\n   static final Logger LOG = LoggerFactory.getLogger(LogSegment.class);\r\n \r\n-  static long getEntrySize(LogEntryProto entry) {\r\n-    final int serialized = ServerProtoUtils.removeStateMachineData(entry).getSerializedSize();\r\n+  enum Op {\r\n+    LOAD_SEGMENT_FILE,\r\n+    WRITE_SEGMENT_FILE,\r\n+    WRITE_CACHE_WITH_STATE_MACHINE_CACHE,\r\n+    WRITE_CACHE_WITHOUT_STATE_MACHINE_CACHE;\r\n+  }\r\n+\r\n+  static long getEntrySize(LogEntryProto entry, Op op) {\r\n+    LogEntryProto e = entry;\r\n+    if (op == Op.WRITE_SEGMENT_FILE) {\r\n+      e = ServerProtoUtils.removeStateMachineData(entry);\r\n+    } else if (op == Op.LOAD_SEGMENT_FILE || op == Op.WRITE_CACHE_WITH_STATE_MACHINE_CACHE) {\r\n+      Preconditions.assertTrue(entry == ServerProtoUtils.removeStateMachineData(entry),\r\n+          () -> \"Unexpected LogEntryProto with StateMachine data: op=\" + op + \", entry=\" + entry);\r\n+    } else {\r\n+      Preconditions.assertTrue(op == Op.WRITE_CACHE_WITHOUT_STATE_MACHINE_CACHE,\r\n+          () -> \"Unexpected op \" + op + \", entry=\" + entry);\r\n+    }\r\n+    final int serialized = e.getSerializedSize();\r\n     return serialized + CodedOutputStream.computeUInt32SizeNoTag(serialized) + 4L;\r\n   }\r\n \r\n@@ -139,7 +156,7 @@ public class LogSegment implements Comparable<Long> {\r\n \r\n     final CorruptionPolicy corruptionPolicy = CorruptionPolicy.get(storage, RaftStorage::getLogCorruptionPolicy);\r\n     final int entryCount = readSegmentFile(file, start, end, isOpen, corruptionPolicy, raftLogMetrics, entry -> {\r\n-      segment.append(keepEntryInCache || isOpen, entry);\r\n+      segment.append(keepEntryInCache || isOpen, entry, Op.LOAD_SEGMENT_FILE);\r\n       if (logConsumer != null) {\r\n         logConsumer.accept(entry);\r\n       }\r\n@@ -273,12 +290,12 @@ public class LogSegment implements Comparable<Long> {\r\n     return CorruptionPolicy.get(storage, RaftStorage::getLogCorruptionPolicy);\r\n   }\r\n \r\n-  void appendToOpenSegment(LogEntryProto entry) {\r\n+  void appendToOpenSegment(LogEntryProto entry, Op op) {\r\n     Preconditions.assertTrue(isOpen(), \"The log segment %s is not open for append\", this);\r\n-    append(true, entry);\r\n+    append(true, entry, op);\r\n   }\r\n \r\n-  private void append(boolean keepEntryInCache, LogEntryProto entry) {\r\n+  private void append(boolean keepEntryInCache, LogEntryProto entry, Op op) {\r\n     Objects.requireNonNull(entry, \"entry == null\");\r\n     if (records.isEmpty()) {\r\n       Preconditions.assertTrue(entry.getIndex() == startIndex,\r\n@@ -300,7 +317,7 @@ public class LogSegment implements Comparable<Long> {\r\n     if (entry.hasConfigurationEntry()) {\r\n       configEntries.add(record.getTermIndex());\r\n     }\r\n-    totalSize += getEntrySize(entry);\r\n+    totalSize += getEntrySize(entry, op);\r\n     endIndex = entry.getIndex();\r\n   }\r\n \r\ndiff --git a/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLog.java b/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLog.java\r\nindex dbdbced9..ebbb00fa 100644\r\n--- a/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLog.java\r\n+++ b/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLog.java\r\n@@ -414,9 +414,10 @@ public class SegmentedRaftLog extends RaftLog {\r\n           fileLogWorker.writeLogEntry(entry).getFuture();\r\n       if (stateMachineCachingEnabled) {\r\n         // The stateMachineData will be cached inside the StateMachine itself.\r\n-        cache.appendEntry(ServerProtoUtils.removeStateMachineData(entry));\r\n+        cache.appendEntry(ServerProtoUtils.removeStateMachineData(entry),\r\n+            LogSegment.Op.WRITE_CACHE_WITH_STATE_MACHINE_CACHE);\r\n       } else {\r\n-        cache.appendEntry(entry);\r\n+        cache.appendEntry(entry, LogSegment.Op.WRITE_CACHE_WITHOUT_STATE_MACHINE_CACHE);\r\n       }\r\n       return writeFuture;\r\n     } catch (Exception e) {\r\n@@ -431,7 +432,7 @@ public class SegmentedRaftLog extends RaftLog {\r\n     if (segment.getTotalSize() >= segmentMaxSize) {\r\n       return true;\r\n     } else {\r\n-      final long entrySize = LogSegment.getEntrySize(entry);\r\n+      final long entrySize = LogSegment.getEntrySize(entry, LogSegment.Op.WRITE_SEGMENT_FILE);\r\n       // if entry size is greater than the max segment size, write it directly\r\n       // into the current segment\r\n       return entrySize <= segmentMaxSize &&\r\ndiff --git a/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLogCache.java b/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLogCache.java\r\nindex 260718f9..2177f890 100644\r\n--- a/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLogCache.java\r\n+++ b/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLogCache.java\r\n@@ -521,11 +521,11 @@ public class SegmentedRaftLogCache {\r\n             closedSegments.get(closedSegments.size() - 1).getLastTermIndex());\r\n   }\r\n \r\n-  void appendEntry(LogEntryProto entry) {\r\n+  void appendEntry(LogEntryProto entry, LogSegment.Op op) {\r\n     // SegmentedRaftLog does the segment creation/rolling work. Here we just\r\n     // simply append the entry into the open segment.\r\n     Preconditions.assertTrue(openSegment != null);\r\n-    openSegment.appendToOpenSegment(entry);\r\n+    openSegment.appendToOpenSegment(entry, op);\r\n   }\r\n \r\n   /**\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/737819776/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/738547328","html_url":"https://github.com/apache/ratis/pull/320#issuecomment-738547328","issue_url":"https://api.github.com/repos/apache/ratis/issues/320","id":738547328,"node_id":"MDEyOklzc3VlQ29tbWVudDczODU0NzMyOA==","user":{"login":"amaliujia","id":1938382,"node_id":"MDQ6VXNlcjE5MzgzODI=","avatar_url":"https://avatars.githubusercontent.com/u/1938382?v=4","gravatar_id":"","url":"https://api.github.com/users/amaliujia","html_url":"https://github.com/amaliujia","followers_url":"https://api.github.com/users/amaliujia/followers","following_url":"https://api.github.com/users/amaliujia/following{/other_user}","gists_url":"https://api.github.com/users/amaliujia/gists{/gist_id}","starred_url":"https://api.github.com/users/amaliujia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaliujia/subscriptions","organizations_url":"https://api.github.com/users/amaliujia/orgs","repos_url":"https://api.github.com/users/amaliujia/repos","events_url":"https://api.github.com/users/amaliujia/events{/privacy}","received_events_url":"https://api.github.com/users/amaliujia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-04T03:46:55Z","updated_at":"2020-12-04T03:46:55Z","author_association":"CONTRIBUTOR","body":"R: @szetszwo @runzhiwang ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/738547328/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/738569783","html_url":"https://github.com/apache/ratis/pull/321#issuecomment-738569783","issue_url":"https://api.github.com/repos/apache/ratis/issues/321","id":738569783,"node_id":"MDEyOklzc3VlQ29tbWVudDczODU2OTc4Mw==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-04T05:15:03Z","updated_at":"2020-12-04T05:15:03Z","author_association":"CONTRIBUTOR","body":"@KellyShao Thanks the patch. I will merge it once CI pass.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/738569783/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/738611787","html_url":"https://github.com/apache/ratis/pull/322#issuecomment-738611787","issue_url":"https://api.github.com/repos/apache/ratis/issues/322","id":738611787,"node_id":"MDEyOklzc3VlQ29tbWVudDczODYxMTc4Nw==","user":{"login":"avijayanhwx","id":14299376,"node_id":"MDQ6VXNlcjE0Mjk5Mzc2","avatar_url":"https://avatars.githubusercontent.com/u/14299376?v=4","gravatar_id":"","url":"https://api.github.com/users/avijayanhwx","html_url":"https://github.com/avijayanhwx","followers_url":"https://api.github.com/users/avijayanhwx/followers","following_url":"https://api.github.com/users/avijayanhwx/following{/other_user}","gists_url":"https://api.github.com/users/avijayanhwx/gists{/gist_id}","starred_url":"https://api.github.com/users/avijayanhwx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/avijayanhwx/subscriptions","organizations_url":"https://api.github.com/users/avijayanhwx/orgs","repos_url":"https://api.github.com/users/avijayanhwx/repos","events_url":"https://api.github.com/users/avijayanhwx/events{/privacy}","received_events_url":"https://api.github.com/users/avijayanhwx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-04T07:12:35Z","updated_at":"2020-12-04T07:12:35Z","author_association":"CONTRIBUTOR","body":"@lokeshj1703, @hanishakoneru , @mukul1987 I have attached a preliminary patch to solve this problem. If the approach looks OK, I can polish it and add tests.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/738611787/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/738796993","html_url":"https://github.com/apache/ratis/pull/322#issuecomment-738796993","issue_url":"https://api.github.com/repos/apache/ratis/issues/322","id":738796993,"node_id":"MDEyOklzc3VlQ29tbWVudDczODc5Njk5Mw==","user":{"login":"mukul1987","id":4317412,"node_id":"MDQ6VXNlcjQzMTc0MTI=","avatar_url":"https://avatars.githubusercontent.com/u/4317412?v=4","gravatar_id":"","url":"https://api.github.com/users/mukul1987","html_url":"https://github.com/mukul1987","followers_url":"https://api.github.com/users/mukul1987/followers","following_url":"https://api.github.com/users/mukul1987/following{/other_user}","gists_url":"https://api.github.com/users/mukul1987/gists{/gist_id}","starred_url":"https://api.github.com/users/mukul1987/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mukul1987/subscriptions","organizations_url":"https://api.github.com/users/mukul1987/orgs","repos_url":"https://api.github.com/users/mukul1987/repos","events_url":"https://api.github.com/users/mukul1987/events{/privacy}","received_events_url":"https://api.github.com/users/mukul1987/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-04T13:55:28Z","updated_at":"2020-12-04T13:55:28Z","author_association":"CONTRIBUTOR","body":"The approach looks good to me. Also tagging @szetszwo here as well.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/738796993/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739460991","html_url":"https://github.com/apache/ratis/pull/325#issuecomment-739460991","issue_url":"https://api.github.com/repos/apache/ratis/issues/325","id":739460991,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTQ2MDk5MQ==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-06T06:05:25Z","updated_at":"2020-12-06T06:16:53Z","author_association":"CONTRIBUTOR","body":"@szetszwo This pr can reproduce the bug of https://issues.apache.org/jira/browse/RATIS-1207.\r\nWe just need to execute the following command two times. The first succeed, the second failed because of the duplicated stream key.\r\n`${BIN}/client.sh filestore datastream --size 100000000 --numFiles 10 --bufferSize 1000000 --type DirectByteBuffer --peers ${PEERS}`\r\n\r\nTips: we can comment the console reporter to make output clear.\r\n```\r\n  @Override\r\n  public void enableConsoleReporter(TimeDuration consoleReportRate) {\r\n\r\n  //  addReporterRegistration(\r\n   //     MetricsReporting.consoleReporter(consoleReportRate),\r\n   //     MetricsReporting.stopConsoleReporter());\r\n\r\n  }\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739460991/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739471674","html_url":"https://github.com/apache/ratis/pull/325#issuecomment-739471674","issue_url":"https://api.github.com/repos/apache/ratis/issues/325","id":739471674,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTQ3MTY3NA==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-06T08:24:22Z","updated_at":"2020-12-06T08:24:22Z","author_association":"CONTRIBUTOR","body":"@szetszwo Could you help review this ?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739471674/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739476132","html_url":"https://github.com/apache/ratis/pull/325#issuecomment-739476132","issue_url":"https://api.github.com/repos/apache/ratis/issues/325","id":739476132,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTQ3NjEzMg==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-06T09:14:48Z","updated_at":"2020-12-06T10:19:57Z","author_association":"CONTRIBUTOR","body":"@szetszwo Not sure what happened.  If 3 servers are on different machines, DataStreamApi with type DirectByteBuffer seems slower than AsyncApi.  If 3 servers are on same machine, DataStreamApi with type DirectByteBuffer is better than AsyncApi.\r\nDataStreamApi command:\r\n`${BIN}/client.sh filestore datastream --size 100000000 --numFiles 10 --bufferSize 4000000 --type DirectByteBuffer --peers ${PEERS}`\r\nAsyncApi command:\r\n`${BIN}/client.sh filestore loadgen --size 100000000 --numFiles 10 --bufferSize 4000000 --peers ${PEERS}`","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739476132/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739486881","html_url":"https://github.com/apache/ratis/pull/325#issuecomment-739486881","issue_url":"https://api.github.com/repos/apache/ratis/issues/325","id":739486881,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTQ4Njg4MQ==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-06T11:04:11Z","updated_at":"2020-12-06T11:04:11Z","author_association":"CONTRIBUTOR","body":"The problem may be because it keeps calling ByteBuffer.allocateDirect(..), which is slow and has memory leak.  We need a buffer pool.\r\n```\r\n    ByteBuffer byteBuffer = ByteBuffer.allocateDirect(bytesToRead);\r\n    long offset = 0L;\r\n\r\n    while (fileChannel.read(byteBuffer) > 0) {\r\n      ...\r\n      if (bytesToRead > 0) {\r\n        byteBuffer = ByteBuffer.allocateDirect(bytesToRead);\r\n      }\r\n    }\r\n```\r\nCould you post some benchmark results on RATIS-1176?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739486881/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739492699","html_url":"https://github.com/apache/ratis/pull/327#issuecomment-739492699","issue_url":"https://api.github.com/repos/apache/ratis/issues/327","id":739492699,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTQ5MjY5OQ==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-06T11:59:12Z","updated_at":"2020-12-06T11:59:12Z","author_association":"CONTRIBUTOR","body":"@runzhiwang , could you see if this can make DirectByteBuffer faster than async?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739492699/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739494348","html_url":"https://github.com/apache/ratis/pull/327#issuecomment-739494348","issue_url":"https://api.github.com/repos/apache/ratis/issues/327","id":739494348,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTQ5NDM0OA==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-06T12:14:27Z","updated_at":"2020-12-06T12:14:27Z","author_association":"CONTRIBUTOR","body":"@szetszwo  I test it, and throw exception.\r\n![image](https://user-images.githubusercontent.com/51938049/101279784-8f949680-37ff-11eb-83a6-2252ae91dda5.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739494348/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739498081","html_url":"https://github.com/apache/ratis/pull/327#issuecomment-739498081","issue_url":"https://api.github.com/repos/apache/ratis/issues/327","id":739498081,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTQ5ODA4MQ==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-06T12:47:31Z","updated_at":"2020-12-06T12:47:31Z","author_association":"CONTRIBUTOR","body":"Oops, I should use ByteBuf to read the file.\r\n\r\n@runzhiwang , could you try it again?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739498081/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739499040","html_url":"https://github.com/apache/ratis/pull/327#issuecomment-739499040","issue_url":"https://api.github.com/repos/apache/ratis/issues/327","id":739499040,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTQ5OTA0MA==","user":{"login":"sonarqubecloud[bot]","id":39514782,"node_id":"MDM6Qm90Mzk1MTQ3ODI=","avatar_url":"https://avatars.githubusercontent.com/in/12526?v=4","gravatar_id":"","url":"https://api.github.com/users/sonarqubecloud%5Bbot%5D","html_url":"https://github.com/apps/sonarqubecloud","followers_url":"https://api.github.com/users/sonarqubecloud%5Bbot%5D/followers","following_url":"https://api.github.com/users/sonarqubecloud%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/sonarqubecloud%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/sonarqubecloud%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sonarqubecloud%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/sonarqubecloud%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/sonarqubecloud%5Bbot%5D/repos","events_url":"https://api.github.com/users/sonarqubecloud%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/sonarqubecloud%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2020-12-06T12:56:36Z","updated_at":"2020-12-06T12:56:36Z","author_association":"NONE","body":"SonarCloud Quality Gate failed.\n\n[<img src='https://sonarsource.github.io/sonarcloud-github-static-resources/v2/common/bug.png' alt='Bug' width='16' height='16' />](https://sonarcloud.io/project/issues?id=apache_incubator-ratis&pullRequest=327&resolved=false&types=BUG) [<img src='https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/RatingBadge/A.png' alt='A' width='16' height='16' />](https://sonarcloud.io/project/issues?id=apache_incubator-ratis&pullRequest=327&resolved=false&types=BUG) [0 Bugs](https://sonarcloud.io/project/issues?id=apache_incubator-ratis&pullRequest=327&resolved=false&types=BUG)  \n[<img src='https://sonarsource.github.io/sonarcloud-github-static-resources/v2/common/vulnerability.png' alt='Vulnerability' width='16' height='16' />](https://sonarcloud.io/project/issues?id=apache_incubator-ratis&pullRequest=327&resolved=false&types=VULNERABILITY) [<img src='https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/RatingBadge/A.png' alt='A' width='16' height='16' />](https://sonarcloud.io/project/issues?id=apache_incubator-ratis&pullRequest=327&resolved=false&types=VULNERABILITY) [0 Vulnerabilities](https://sonarcloud.io/project/issues?id=apache_incubator-ratis&pullRequest=327&resolved=false&types=VULNERABILITY)  \n[<img src='https://sonarsource.github.io/sonarcloud-github-static-resources/v2/common/security_hotspot.png' alt='Security Hotspot' width='16' height='16' />](https://sonarcloud.io/project/security_hotspots?id=apache_incubator-ratis&pullRequest=327&resolved=false&types=SECURITY_HOTSPOT) [<img src='https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/RatingBadge/A.png' alt='A' width='16' height='16' />](https://sonarcloud.io/project/security_hotspots?id=apache_incubator-ratis&pullRequest=327&resolved=false&types=SECURITY_HOTSPOT) [0 Security Hotspots](https://sonarcloud.io/project/security_hotspots?id=apache_incubator-ratis&pullRequest=327&resolved=false&types=SECURITY_HOTSPOT)  \n[<img src='https://sonarsource.github.io/sonarcloud-github-static-resources/v2/common/code_smell.png' alt='Code Smell' width='16' height='16' />](https://sonarcloud.io/project/issues?id=apache_incubator-ratis&pullRequest=327&resolved=false&types=CODE_SMELL) [<img src='https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/RatingBadge/A.png' alt='A' width='16' height='16' />](https://sonarcloud.io/project/issues?id=apache_incubator-ratis&pullRequest=327&resolved=false&types=CODE_SMELL) [2 Code Smells](https://sonarcloud.io/project/issues?id=apache_incubator-ratis&pullRequest=327&resolved=false&types=CODE_SMELL)\n\n[<img src='https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/CoverageChart/0.png' alt='0.0%' width='16' height='16' />](https://sonarcloud.io/component_measures?id=apache_incubator-ratis&pullRequest=327&metric=new_coverage&view=list) [0.0% Coverage](https://sonarcloud.io/component_measures?id=apache_incubator-ratis&pullRequest=327&metric=new_coverage&view=list)  \n[<img src='https://sonarsource.github.io/sonarcloud-github-static-resources/v2/checks/Duplications/3.png' alt='0.0%' width='16' height='16' />](https://sonarcloud.io/component_measures?id=apache_incubator-ratis&pullRequest=327&metric=new_duplicated_lines_density&view=list) [0.0% Duplication](https://sonarcloud.io/component_measures?id=apache_incubator-ratis&pullRequest=327&metric=new_duplicated_lines_density&view=list)\n\n<img src='https://sonarsource.github.io/sonarcloud-github-static-resources/v2/common/message_warning.png' alt='warning' width='16' height='16' /> The version of Java (1.8.0_275) you have used to run this analysis is deprecated and we will stop accepting it soon. Please update to at least Java 11.\nRead more [here](https://sonarcloud.io/documentation/upcoming/)\n\n\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739499040/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739500885","html_url":"https://github.com/apache/ratis/pull/327#issuecomment-739500885","issue_url":"https://api.github.com/repos/apache/ratis/issues/327","id":739500885,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTUwMDg4NQ==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-06T13:13:04Z","updated_at":"2020-12-06T13:13:04Z","author_association":"CONTRIBUTOR","body":"@szetszwo Sure, will try it tomorrow, off duty now, sorry.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739500885/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739501465","html_url":"https://github.com/apache/ratis/pull/327#issuecomment-739501465","issue_url":"https://api.github.com/repos/apache/ratis/issues/327","id":739501465,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTUwMTQ2NQ==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-06T13:17:32Z","updated_at":"2020-12-06T13:17:32Z","author_association":"CONTRIBUTOR","body":"@runzhiwang , sure thanks.  Take your time.  :)","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739501465/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739601148","html_url":"https://github.com/apache/ratis/pull/327#issuecomment-739601148","issue_url":"https://api.github.com/repos/apache/ratis/issues/327","id":739601148,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTYwMTE0OA==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-07T00:47:45Z","updated_at":"2020-12-07T00:47:45Z","author_association":"CONTRIBUTOR","body":"Replacing this pull request with https://github.com/apache/incubator-ratis/pull/328 in order to fix the branch.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739601148/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739615331","html_url":"https://github.com/apache/ratis/pull/329#issuecomment-739615331","issue_url":"https://api.github.com/repos/apache/ratis/issues/329","id":739615331,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTYxNTMzMQ==","user":{"login":"amaliujia","id":1938382,"node_id":"MDQ6VXNlcjE5MzgzODI=","avatar_url":"https://avatars.githubusercontent.com/u/1938382?v=4","gravatar_id":"","url":"https://api.github.com/users/amaliujia","html_url":"https://github.com/amaliujia","followers_url":"https://api.github.com/users/amaliujia/followers","following_url":"https://api.github.com/users/amaliujia/following{/other_user}","gists_url":"https://api.github.com/users/amaliujia/gists{/gist_id}","starred_url":"https://api.github.com/users/amaliujia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaliujia/subscriptions","organizations_url":"https://api.github.com/users/amaliujia/orgs","repos_url":"https://api.github.com/users/amaliujia/repos","events_url":"https://api.github.com/users/amaliujia/events{/privacy}","received_events_url":"https://api.github.com/users/amaliujia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-07T01:47:51Z","updated_at":"2020-12-07T01:47:51Z","author_association":"CONTRIBUTOR","body":"+1 ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739615331/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739639013","html_url":"https://github.com/apache/ratis/pull/330#issuecomment-739639013","issue_url":"https://api.github.com/repos/apache/ratis/issues/330","id":739639013,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTYzOTAxMw==","user":{"login":"amaliujia","id":1938382,"node_id":"MDQ6VXNlcjE5MzgzODI=","avatar_url":"https://avatars.githubusercontent.com/u/1938382?v=4","gravatar_id":"","url":"https://api.github.com/users/amaliujia","html_url":"https://github.com/amaliujia","followers_url":"https://api.github.com/users/amaliujia/followers","following_url":"https://api.github.com/users/amaliujia/following{/other_user}","gists_url":"https://api.github.com/users/amaliujia/gists{/gist_id}","starred_url":"https://api.github.com/users/amaliujia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaliujia/subscriptions","organizations_url":"https://api.github.com/users/amaliujia/orgs","repos_url":"https://api.github.com/users/amaliujia/repos","events_url":"https://api.github.com/users/amaliujia/events{/privacy}","received_events_url":"https://api.github.com/users/amaliujia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-07T03:21:24Z","updated_at":"2020-12-07T03:21:24Z","author_association":"CONTRIBUTOR","body":"R @runzhiwang @szetszwo ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739639013/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739644321","html_url":"https://github.com/apache/ratis/pull/330#issuecomment-739644321","issue_url":"https://api.github.com/repos/apache/ratis/issues/330","id":739644321,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTY0NDMyMQ==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-07T03:41:41Z","updated_at":"2020-12-07T03:41:41Z","author_association":"CONTRIBUTOR","body":"Let's keep DataStreamApi.stream() for convenience. We may provide a default implementation and remove DataStreamClientImpl.stream() though.\r\n```\r\n+++ b/ratis-client/src/main/java/org/apache/ratis/client/api/DataStreamApi.java\r\n@@ -38,7 +38,9 @@ import java.nio.ByteBuffer;\r\n  */\r\n public interface DataStreamApi {\r\n   /** Create a stream to write data. */\r\n-  DataStreamOutput stream();\r\n+  default DataStreamOutput stream() {\r\n+    return stream(null);\r\n+  }\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739644321/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739770403","html_url":"https://github.com/apache/ratis/pull/331#issuecomment-739770403","issue_url":"https://api.github.com/repos/apache/ratis/issues/331","id":739770403,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTc3MDQwMw==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-07T08:46:57Z","updated_at":"2020-12-07T08:46:57Z","author_association":"CONTRIBUTOR","body":"The test failure is not related; see https://issues.apache.org/jira/browse/RATIS-1211","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739770403/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739862451","html_url":"https://github.com/apache/ratis/pull/333#issuecomment-739862451","issue_url":"https://api.github.com/repos/apache/ratis/issues/333","id":739862451,"node_id":"MDEyOklzc3VlQ29tbWVudDczOTg2MjQ1MQ==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-07T11:35:01Z","updated_at":"2020-12-07T11:35:01Z","author_association":"CONTRIBUTOR","body":"@szetszwo Could you help review this patch ?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/739862451/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/740412390","html_url":"https://github.com/apache/ratis/pull/335#issuecomment-740412390","issue_url":"https://api.github.com/repos/apache/ratis/issues/335","id":740412390,"node_id":"MDEyOklzc3VlQ29tbWVudDc0MDQxMjM5MA==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-08T06:35:04Z","updated_at":"2020-12-08T06:35:04Z","author_association":"CONTRIBUTOR","body":"@szetszwo Could you help review this ?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/740412390/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/740870618","html_url":"https://github.com/apache/ratis/pull/322#issuecomment-740870618","issue_url":"https://api.github.com/repos/apache/ratis/issues/322","id":740870618,"node_id":"MDEyOklzc3VlQ29tbWVudDc0MDg3MDYxOA==","user":{"login":"avijayanhwx","id":14299376,"node_id":"MDQ6VXNlcjE0Mjk5Mzc2","avatar_url":"https://avatars.githubusercontent.com/u/14299376?v=4","gravatar_id":"","url":"https://api.github.com/users/avijayanhwx","html_url":"https://github.com/avijayanhwx","followers_url":"https://api.github.com/users/avijayanhwx/followers","following_url":"https://api.github.com/users/avijayanhwx/following{/other_user}","gists_url":"https://api.github.com/users/avijayanhwx/gists{/gist_id}","starred_url":"https://api.github.com/users/avijayanhwx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/avijayanhwx/subscriptions","organizations_url":"https://api.github.com/users/avijayanhwx/orgs","repos_url":"https://api.github.com/users/avijayanhwx/repos","events_url":"https://api.github.com/users/avijayanhwx/events{/privacy}","received_events_url":"https://api.github.com/users/avijayanhwx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-08T19:08:41Z","updated_at":"2020-12-08T19:08:41Z","author_association":"CONTRIBUTOR","body":"Thank you for the reviews @szetszwo & @mukul1987.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/740870618/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/741502577","html_url":"https://github.com/apache/ratis/pull/339#issuecomment-741502577","issue_url":"https://api.github.com/repos/apache/ratis/issues/339","id":741502577,"node_id":"MDEyOklzc3VlQ29tbWVudDc0MTUwMjU3Nw==","user":{"login":"runzhiwang","id":51938049,"node_id":"MDQ6VXNlcjUxOTM4MDQ5","avatar_url":"https://avatars.githubusercontent.com/u/51938049?v=4","gravatar_id":"","url":"https://api.github.com/users/runzhiwang","html_url":"https://github.com/runzhiwang","followers_url":"https://api.github.com/users/runzhiwang/followers","following_url":"https://api.github.com/users/runzhiwang/following{/other_user}","gists_url":"https://api.github.com/users/runzhiwang/gists{/gist_id}","starred_url":"https://api.github.com/users/runzhiwang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/runzhiwang/subscriptions","organizations_url":"https://api.github.com/users/runzhiwang/orgs","repos_url":"https://api.github.com/users/runzhiwang/repos","events_url":"https://api.github.com/users/runzhiwang/events{/privacy}","received_events_url":"https://api.github.com/users/runzhiwang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-09T03:27:59Z","updated_at":"2020-12-09T03:27:59Z","author_association":"CONTRIBUTOR","body":"@szetszwo Could you have a brief review ? If you agree with the idea, I will fix the failed ut and compiled error of ut.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/741502577/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/741722734","html_url":"https://github.com/apache/ratis/pull/340#issuecomment-741722734","issue_url":"https://api.github.com/repos/apache/ratis/issues/340","id":741722734,"node_id":"MDEyOklzc3VlQ29tbWVudDc0MTcyMjczNA==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-09T11:51:38Z","updated_at":"2020-12-09T11:51:38Z","author_association":"CONTRIBUTOR","body":"+1 the change looks good.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/741722734/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/741864208","html_url":"https://github.com/apache/ratis/pull/344#issuecomment-741864208","issue_url":"https://api.github.com/repos/apache/ratis/issues/344","id":741864208,"node_id":"MDEyOklzc3VlQ29tbWVudDc0MTg2NDIwOA==","user":{"login":"errose28","id":33912936,"node_id":"MDQ6VXNlcjMzOTEyOTM2","avatar_url":"https://avatars.githubusercontent.com/u/33912936?v=4","gravatar_id":"","url":"https://api.github.com/users/errose28","html_url":"https://github.com/errose28","followers_url":"https://api.github.com/users/errose28/followers","following_url":"https://api.github.com/users/errose28/following{/other_user}","gists_url":"https://api.github.com/users/errose28/gists{/gist_id}","starred_url":"https://api.github.com/users/errose28/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/errose28/subscriptions","organizations_url":"https://api.github.com/users/errose28/orgs","repos_url":"https://api.github.com/users/errose28/repos","events_url":"https://api.github.com/users/errose28/events{/privacy}","received_events_url":"https://api.github.com/users/errose28/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-09T15:53:55Z","updated_at":"2020-12-09T15:53:55Z","author_association":"CONTRIBUTOR","body":"cc @hanishakoneru @szetszwo @lokeshj1703 Could you please help review? Thanks!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/741864208/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/741978090","html_url":"https://github.com/apache/ratis/pull/343#issuecomment-741978090","issue_url":"https://api.github.com/repos/apache/ratis/issues/343","id":741978090,"node_id":"MDEyOklzc3VlQ29tbWVudDc0MTk3ODA5MA==","user":{"login":"amaliujia","id":1938382,"node_id":"MDQ6VXNlcjE5MzgzODI=","avatar_url":"https://avatars.githubusercontent.com/u/1938382?v=4","gravatar_id":"","url":"https://api.github.com/users/amaliujia","html_url":"https://github.com/amaliujia","followers_url":"https://api.github.com/users/amaliujia/followers","following_url":"https://api.github.com/users/amaliujia/following{/other_user}","gists_url":"https://api.github.com/users/amaliujia/gists{/gist_id}","starred_url":"https://api.github.com/users/amaliujia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amaliujia/subscriptions","organizations_url":"https://api.github.com/users/amaliujia/orgs","repos_url":"https://api.github.com/users/amaliujia/repos","events_url":"https://api.github.com/users/amaliujia/events{/privacy}","received_events_url":"https://api.github.com/users/amaliujia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-09T18:54:36Z","updated_at":"2020-12-09T18:54:36Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/741978090/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/742250873","html_url":"https://github.com/apache/ratis/pull/345#issuecomment-742250873","issue_url":"https://api.github.com/repos/apache/ratis/issues/345","id":742250873,"node_id":"MDEyOklzc3VlQ29tbWVudDc0MjI1MDg3Mw==","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-10T05:31:25Z","updated_at":"2020-12-10T05:31:25Z","author_association":"CONTRIBUTOR","body":"All unit tests passed.  Only Project Assembly failed so that it was not related.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/742250873/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/742624192","html_url":"https://github.com/apache/ratis/pull/344#issuecomment-742624192","issue_url":"https://api.github.com/repos/apache/ratis/issues/344","id":742624192,"node_id":"MDEyOklzc3VlQ29tbWVudDc0MjYyNDE5Mg==","user":{"login":"errose28","id":33912936,"node_id":"MDQ6VXNlcjMzOTEyOTM2","avatar_url":"https://avatars.githubusercontent.com/u/33912936?v=4","gravatar_id":"","url":"https://api.github.com/users/errose28","html_url":"https://github.com/errose28","followers_url":"https://api.github.com/users/errose28/followers","following_url":"https://api.github.com/users/errose28/following{/other_user}","gists_url":"https://api.github.com/users/errose28/gists{/gist_id}","starred_url":"https://api.github.com/users/errose28/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/errose28/subscriptions","organizations_url":"https://api.github.com/users/errose28/orgs","repos_url":"https://api.github.com/users/errose28/repos","events_url":"https://api.github.com/users/errose28/events{/privacy}","received_events_url":"https://api.github.com/users/errose28/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-10T16:18:49Z","updated_at":"2020-12-10T16:18:49Z","author_association":"CONTRIBUTOR","body":"Thanks for the review @szetszwo, I have updated the StateMachineException to be immutable.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/742624192/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/742771551","html_url":"https://github.com/apache/ratis/pull/300#issuecomment-742771551","issue_url":"https://api.github.com/repos/apache/ratis/issues/300","id":742771551,"node_id":"MDEyOklzc3VlQ29tbWVudDc0Mjc3MTU1MQ==","user":{"login":"bharatviswa504","id":8586345,"node_id":"MDQ6VXNlcjg1ODYzNDU=","avatar_url":"https://avatars.githubusercontent.com/u/8586345?v=4","gravatar_id":"","url":"https://api.github.com/users/bharatviswa504","html_url":"https://github.com/bharatviswa504","followers_url":"https://api.github.com/users/bharatviswa504/followers","following_url":"https://api.github.com/users/bharatviswa504/following{/other_user}","gists_url":"https://api.github.com/users/bharatviswa504/gists{/gist_id}","starred_url":"https://api.github.com/users/bharatviswa504/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bharatviswa504/subscriptions","organizations_url":"https://api.github.com/users/bharatviswa504/orgs","repos_url":"https://api.github.com/users/bharatviswa504/repos","events_url":"https://api.github.com/users/bharatviswa504/events{/privacy}","received_events_url":"https://api.github.com/users/bharatviswa504/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-10T20:15:43Z","updated_at":"2020-12-10T20:15:43Z","author_association":"CONTRIBUTOR","body":"Closing this, it is taken care under subtasks of RATIS-1181.\r\nThank You @szetszwo for providing new APIs.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/742771551/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/742906965","html_url":"https://github.com/apache/ratis/pull/349#issuecomment-742906965","issue_url":"https://api.github.com/repos/apache/ratis/issues/349","id":742906965,"node_id":"MDEyOklzc3VlQ29tbWVudDc0MjkwNjk2NQ==","user":{"login":"bharatviswa504","id":8586345,"node_id":"MDQ6VXNlcjg1ODYzNDU=","avatar_url":"https://avatars.githubusercontent.com/u/8586345?v=4","gravatar_id":"","url":"https://api.github.com/users/bharatviswa504","html_url":"https://github.com/bharatviswa504","followers_url":"https://api.github.com/users/bharatviswa504/followers","following_url":"https://api.github.com/users/bharatviswa504/following{/other_user}","gists_url":"https://api.github.com/users/bharatviswa504/gists{/gist_id}","starred_url":"https://api.github.com/users/bharatviswa504/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bharatviswa504/subscriptions","organizations_url":"https://api.github.com/users/bharatviswa504/orgs","repos_url":"https://api.github.com/users/bharatviswa504/repos","events_url":"https://api.github.com/users/bharatviswa504/events{/privacy}","received_events_url":"https://api.github.com/users/bharatviswa504/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-12-11T01:32:37Z","updated_at":"2020-12-11T01:52:40Z","author_association":"CONTRIBUTOR","body":"> raft.server.storage.dir should be created for Ratis only. Applications should just create a sub directory for Ratis. It is not a good idea to use raft.server.storage.dir for other purposes. If there are random items in it, Ratis is impossible to handle them correctly.\r\n\r\nYes, OM HA has mistakenly created the om ratis snapshot directory in ratis storage directory causing this issue during OM startup with a long error message. We are planning to fix this issue in Ozone under [HDDS-3378](https://issues.apache.org/jira/browse/HDDS-3378)","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/742906965/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]