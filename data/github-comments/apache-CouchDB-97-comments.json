[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778877834","html_url":"https://github.com/apache/couchdb/issues/1305#issuecomment-778877834","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1305","id":778877834,"node_id":"MDEyOklzc3VlQ29tbWVudDc3ODg3NzgzNA==","user":{"login":"nkev","id":5410916,"node_id":"MDQ6VXNlcjU0MTA5MTY=","avatar_url":"https://avatars.githubusercontent.com/u/5410916?v=4","gravatar_id":"","url":"https://api.github.com/users/nkev","html_url":"https://github.com/nkev","followers_url":"https://api.github.com/users/nkev/followers","following_url":"https://api.github.com/users/nkev/following{/other_user}","gists_url":"https://api.github.com/users/nkev/gists{/gist_id}","starred_url":"https://api.github.com/users/nkev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nkev/subscriptions","organizations_url":"https://api.github.com/users/nkev/orgs","repos_url":"https://api.github.com/users/nkev/repos","events_url":"https://api.github.com/users/nkev/events{/privacy}","received_events_url":"https://api.github.com/users/nkev/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-15T00:58:33Z","updated_at":"2021-02-15T00:58:33Z","author_association":"NONE","body":"In case it helps someone else, in Windows 10 with CouchDB 3.1.1 I had to modify `C:\\Program Files\\Apache CouchDB\\etc\\default.ini` (not local.ini because all settings in local.ini are commented out). Also, the setting `WWW-Authenticate: \"Basic realm=\\\"administrator\\\"\"` was missing so I added it manually (see below). Then I restarted the `Apache CouchDB` Windows service which allowed me to get back in.\r\n\r\n![image](https://user-images.githubusercontent.com/5410916/107894670-6e30f300-6f84-11eb-9c3f-f3ef7bd2709a.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/778877834/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/779391955","html_url":"https://github.com/apache/couchdb/pull/3363#issuecomment-779391955","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3363","id":779391955,"node_id":"MDEyOklzc3VlQ29tbWVudDc3OTM5MTk1NQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-15T18:36:28Z","updated_at":"2021-02-15T18:36:28Z","author_association":"MEMBER","body":"Thank you for this PR, @janosgyerman !\r\nPlease mind that `main` operates with an FDB backend instead of shard files that are referred to in the PR description.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/779391955/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/780145701","html_url":"https://github.com/apache/couchdb/pull/3372#issuecomment-780145701","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3372","id":780145701,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MDE0NTcwMQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-16T22:01:42Z","updated_at":"2021-02-16T22:01:42Z","author_association":"CONTRIBUTOR","body":">  I understand the motivation but it does not apply to all users/admins of couchdb and they should be allowed to keep the current behaviour where stack traces and process states are unaltered. \r\n\r\nI also tried to remove big terms from state. Do we want it to be configurable as well?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/780145701/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/780559432","html_url":"https://github.com/apache/couchdb/pull/3372#issuecomment-780559432","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3372","id":780559432,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MDU1OTQzMg==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-17T13:34:35Z","updated_at":"2021-02-17T13:54:46Z","author_association":"CONTRIBUTOR","body":"> I'm not sure this is appropriate for couchdb. I understand the motivation but it does not apply to all users/admins of couchdb and they should be allowed to keep the current behaviour where stack traces and process states are unaltered. This should be configurable.\r\n\r\nWhat do you think about the following approach. The `format_status/2` would return a tuple `{Status :: term(), Options :: #{senstive => boolean(), records => %{name :: atom() => Fields :: list(atom())}}}`?\r\n\r\n```\r\nformat_status(_Opt, [_PDict, State]) ->\r\n    {[{data, [{\"State\", State}}]}], #{sensitive => false, records => #{\r\n        state => record_info(fields, state),\r\n        httpd => record_info(fields, httpd)\r\n    }}}.\r\n```\r\n\r\nThen in couch_log application we would call user configured sanitizer module.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/780559432/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/780565740","html_url":"https://github.com/apache/couchdb/pull/3372#issuecomment-780565740","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3372","id":780565740,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MDU2NTc0MA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-17T13:45:12Z","updated_at":"2021-02-17T13:45:12Z","author_association":"MEMBER","body":"I'd like to hear from non-IBM CouchDB committers that might have a different view on our scrubbing of stacktraces and process states and logs first. If it's generally desired then I'd agree it doesn't need to be configurable. My concern, with both my IBM hat and CouchDB hat on, is that we are degrading the quality of our diagnostics (albeit with good intention) and I think we need to proceed with a broader consensus.\r\n\r\nI don't think format_status should return an erlang term that is completely different from the state of the process, it should look the same but with some items removed or redacted.\r\n\r\nin summary, the goal is sound, we should ask if a solution is desired widely, whether it should be configurable and how closely the redacted output should match the output it replaces.\r\n\r\n@janl @wohali @dch","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/780565740/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/780923794","html_url":"https://github.com/apache/couchdb/pull/3373#issuecomment-780923794","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3373","id":780923794,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MDkyMzc5NA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-17T23:33:12Z","updated_at":"2021-02-17T23:33:12Z","author_association":"MEMBER","body":"@nickva good idea! Done in #3374 ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/780923794/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/780923877","html_url":"https://github.com/apache/couchdb/issues/3087#issuecomment-780923877","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3087","id":780923877,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MDkyMzg3Nw==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-17T23:33:27Z","updated_at":"2021-02-17T23:33:27Z","author_association":"MEMBER","body":"Fixed in https://github.com/apache/couchdb/pull/3373","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/780923877/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/782437514","html_url":"https://github.com/apache/couchdb/pull/3364#issuecomment-782437514","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3364","id":782437514,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MjQzNzUxNA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-19T23:05:33Z","updated_at":"2021-02-20T18:06:57Z","author_association":"CONTRIBUTOR","body":"To help test the PR I created a silly script which runs with a local `./dev/run -n1` cluster. It configures replication jobs and shares for three `_replicator` dbs and then continuously samples the proportion of running jobs in each db:\r\n\r\nhttps://gist.github.com/nickva/7e86b3df19537a60372217e0f68b693a\r\n\r\nSo for the default parameters it might output something like:\r\n\r\n```\r\n ** run stats num dbs: 3, total jobs: 100\r\nrdb1/_replicator 66 66%\r\nrdb2/_replicator 23 23%\r\nrdb3/_replicator 11 11%\r\n\r\n ** run stats num dbs: 3, total jobs: 100\r\nrdb1/_replicator 61 61%\r\nrdb2/_replicator 31 31%\r\nrdb3/_replicator 8 8%\r\n```\r\n\r\nWith a configuration where the shares are all even (100) but the dbs have an uneven number of jobs, after 5-10 minutes there should be a roughly even share of running jobs from each db, even though one db has 500 jobs and others have less.\r\n```python\r\nINTERVAL = 20000\r\nCONFIG = {\r\n    \"replicator\": {\r\n        \"max_jobs\": \"100\",\r\n        \"max_churn\": \"20\",\r\n        \"interval\" : str(INTERVAL),\r\n    },\r\n    \"replicator.shares\": {\r\n        RDB1 : \"100\",\r\n        RDB2 : \"100\",\r\n        RDB3 : \"100\",\r\n    }\r\n}\r\nREPS = {\r\n    RDB1 : 200,\r\n    RDB2 : 300,\r\n    RDB3 : 500,\r\n}\r\n```\r\n\r\n```\r\n ** run stats num dbs: 3, total jobs: 100\r\nrdb1/_replicator 30 30%\r\nrdb2/_replicator 34 34%\r\nrdb3/_replicator 36 36%\r\n\r\n ** run stats num dbs: 3, total jobs: 100\r\nrdb1/_replicator 29 29%\r\nrdb2/_replicator 33 33%\r\nrdb3/_replicator 38 38%\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/782437514/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/782565957","html_url":"https://github.com/apache/couchdb/pull/3372#issuecomment-782565957","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3372","id":782565957,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MjU2NTk1Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-20T05:45:43Z","updated_at":"2021-02-20T05:45:43Z","author_association":"MEMBER","body":"If this is configurable and not enabled by default, I have no objection.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/782565957/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/783250157","html_url":"https://github.com/apache/couchdb/issues/3377#issuecomment-783250157","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3377","id":783250157,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MzI1MDE1Nw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-22T09:57:20Z","updated_at":"2021-02-22T09:57:20Z","author_association":"MEMBER","body":"It seems the discussion is still open, are we to continue it here in the Issue or on the mailing list? I was about to raise several points but they've all come up in the discussion (without resolution).\r\n\r\nConsolidating my thoughts;\r\n\r\n1) We're adding support for Prometheus but also inventing a new format for it that nothing understands.\r\n2) Negotiation by content-type when Prometheus doesn't have a registered one is a mistake (The accept= query parameter idea is better).\r\n3) As not every item in active_tasks is a metric, the new endpoint is not a replacement for it, so we'll have to retain both.\r\n4) The output, in any format, remains Prometheus specific anyway (though, again, noting that tools that understand prometheus format could not consume our novel JSON format).\r\n\r\nIt's an odd proposal that appears to satisfy no particular audience, I don't feel it's appropriate to add this to CouchDB in this form.\r\n\r\nThe goal seemed clear, \"integrate with Prometheus\", and the solution is equally clear, a new endpoint (\"/_prometheus\") that emits the documented Prometheus format with the 'text/plain; version=\"0.0.4' content type. The CouchDB project can accept or reject such a thing. Should Prometheus become old hat, we can remove the endpoint, losing no other functionality.\r\n\r\nThe code to interrogate CouchDB internals and produce the Prometheus output is useful regardless and could live on as a plugin or separate library (system administrators could add in the 'couchdb-prometheus-plugin' library as part of a custom 'make release') if the project were not to accept the work. \r\n\r\nimo it is not a blocker that Prometheus does not speak JSON and that CouchDB does. This is an integration endpoint and, by definition, the two systems being integrated are not identical.\r\n\r\nI would vote to accept a clean Prometheus endpoint.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/783250157/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/783461468","html_url":"https://github.com/apache/couchdb/issues/3377#issuecomment-783461468","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3377","id":783461468,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MzQ2MTQ2OA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-22T15:36:49Z","updated_at":"2021-02-22T15:36:49Z","author_association":"MEMBER","body":"+1 to all of @rnewson’s points","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/783461468/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/783512330","html_url":"https://github.com/apache/couchdb/issues/3377#issuecomment-783512330","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3377","id":783512330,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MzUxMjMzMA==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-22T16:48:47Z","updated_at":"2021-02-22T16:48:47Z","author_association":"CONTRIBUTOR","body":"@rnewson @janl points taken. Let's continue the discussion here.\r\n\r\nFrom these comments\r\n\r\n-  We're adding support for Prometheus but also inventing a new format for it that nothing understands.\r\n- Negotiation by content-type when Prometheus doesn't have a registered one is a mistake (The accept= query parameter idea is better).\r\n- The output, in any format, remains Prometheus specific anyway (though, again, noting that tools that understand prometheus format could not consume our novel JSON format).\r\n\r\nIt seems that both of you are not a big fan of having JSON as a return type and would rather only return `'text/plain; version=\"0.0.4' content type`. Am I understanding that correctly?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/783512330/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/783534853","html_url":"https://github.com/apache/couchdb/issues/3377#issuecomment-783534853","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3377","id":783534853,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MzUzNDg1Mw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-22T17:21:32Z","updated_at":"2021-02-22T17:21:32Z","author_association":"MEMBER","body":"yes, that's right. and make the endpoint specifically about prometheus. the ad hoc attempts to make it generic aren't convincing.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/783534853/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/783612247","html_url":"https://github.com/apache/couchdb/pull/3378#issuecomment-783612247","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3378","id":783612247,"node_id":"MDEyOklzc3VlQ29tbWVudDc4MzYxMjI0Nw==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-22T19:21:26Z","updated_at":"2021-02-22T19:21:26Z","author_association":"CONTRIBUTOR","body":"The testing instructions are a bit incorrect. The reload event can be tested using the following steps:\r\n1. set an admin password: `config:set(\"admins\", \"admin1\", \"secretpassword\").`\r\n2. manually change one of the digits corresponding to hash of pass for `admin1` in `dev/lib/node1/etc/local.ini`\r\n3. `config:reload().`","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/783612247/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784332663","html_url":"https://github.com/apache/couchdb/pull/3372#issuecomment-784332663","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3372","id":784332663,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDMzMjY2Mw==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-23T16:34:21Z","updated_at":"2021-02-23T16:34:21Z","author_association":"CONTRIBUTOR","body":"Closing in favor of https://github.com/apache/couchdb/pull/3380","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784332663/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784367867","html_url":"https://github.com/apache/couchdb/pull/3380#issuecomment-784367867","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3380","id":784367867,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDM2Nzg2Nw==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-23T17:24:50Z","updated_at":"2021-02-23T17:24:50Z","author_association":"CONTRIBUTOR","body":"> I don't think redaction beyond obvious things like passwords can be the default behaviour of CouchDB. I'm less sure if there should be an option for the kind of deep \"cleanup\" here. With my couchdb support hat on, would I be happy to diagnose a problem from a CouchDB log this heavily modified?\r\n\r\nPersonally I hit the same problem over and over. I have a bug and go to check logs. The log contains huge term which we truncate and all important information about other fields of a record omitted. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784367867/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784372133","html_url":"https://github.com/apache/couchdb/pull/3380#issuecomment-784372133","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3380","id":784372133,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDM3MjEzMw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-23T17:30:59Z","updated_at":"2021-02-23T17:30:59Z","author_association":"MEMBER","body":"Ah, sure, I get that point, thank you.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784372133/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784416097","html_url":"https://github.com/apache/couchdb/pull/3380#issuecomment-784416097","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3380","id":784416097,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDQxNjA5Nw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-23T18:28:39Z","updated_at":"2021-02-23T18:28:39Z","author_association":"MEMBER","body":"Hey hey, just casually following this, but the diff is a bit complex. I think this might have a better chance if we focus on redacting sensitive data first, and tackle garbage cleanup later.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784416097/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784417076","html_url":"https://github.com/apache/couchdb/pull/3380#issuecomment-784417076","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3380","id":784417076,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDQxNzA3Ng==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-23T18:30:11Z","updated_at":"2021-02-23T18:30:11Z","author_association":"CONTRIBUTOR","body":"> I think this might have a better chance if we focus on redacting sensitive data first, and tackle garbage cleanup later.\r\n\r\nAgree. I'll update the PR to decouple garbage cleanup out of this PR.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784417076/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784418284","html_url":"https://github.com/apache/couchdb/issues/3381#issuecomment-784418284","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3381","id":784418284,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDQxODI4NA==","user":{"login":"android-programmer","id":4536790,"node_id":"MDQ6VXNlcjQ1MzY3OTA=","avatar_url":"https://avatars.githubusercontent.com/u/4536790?v=4","gravatar_id":"","url":"https://api.github.com/users/android-programmer","html_url":"https://github.com/android-programmer","followers_url":"https://api.github.com/users/android-programmer/followers","following_url":"https://api.github.com/users/android-programmer/following{/other_user}","gists_url":"https://api.github.com/users/android-programmer/gists{/gist_id}","starred_url":"https://api.github.com/users/android-programmer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/android-programmer/subscriptions","organizations_url":"https://api.github.com/users/android-programmer/orgs","repos_url":"https://api.github.com/users/android-programmer/repos","events_url":"https://api.github.com/users/android-programmer/events{/privacy}","received_events_url":"https://api.github.com/users/android-programmer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-23T18:32:07Z","updated_at":"2021-02-23T18:32:07Z","author_association":"NONE","body":"what is the environment ?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784418284/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784418407","html_url":"https://github.com/apache/couchdb/issues/3382#issuecomment-784418407","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3382","id":784418407,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDQxODQwNw==","user":{"login":"android-programmer","id":4536790,"node_id":"MDQ6VXNlcjQ1MzY3OTA=","avatar_url":"https://avatars.githubusercontent.com/u/4536790?v=4","gravatar_id":"","url":"https://api.github.com/users/android-programmer","html_url":"https://github.com/android-programmer","followers_url":"https://api.github.com/users/android-programmer/followers","following_url":"https://api.github.com/users/android-programmer/following{/other_user}","gists_url":"https://api.github.com/users/android-programmer/gists{/gist_id}","starred_url":"https://api.github.com/users/android-programmer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/android-programmer/subscriptions","organizations_url":"https://api.github.com/users/android-programmer/orgs","repos_url":"https://api.github.com/users/android-programmer/repos","events_url":"https://api.github.com/users/android-programmer/events{/privacy}","received_events_url":"https://api.github.com/users/android-programmer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-23T18:32:19Z","updated_at":"2021-02-23T18:32:19Z","author_association":"NONE","body":"what is the environment ?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784418407/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784431640","html_url":"https://github.com/apache/couchdb/issues/3381#issuecomment-784431640","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3381","id":784431640,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDQzMTY0MA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-23T18:53:57Z","updated_at":"2021-02-23T18:53:57Z","author_association":"CONTRIBUTOR","body":"The environment is a recent version of the main branch (running on FDB).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784431640/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784431994","html_url":"https://github.com/apache/couchdb/issues/3382#issuecomment-784431994","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3382","id":784431994,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDQzMTk5NA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-23T18:54:35Z","updated_at":"2021-02-23T18:54:35Z","author_association":"CONTRIBUTOR","body":"@android-programmer The environment is a recent version of the main branch (running on FDB).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784431994/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784433125","html_url":"https://github.com/apache/couchdb/issues/3379#issuecomment-784433125","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3379","id":784433125,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDQzMzEyNQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-23T18:56:26Z","updated_at":"2021-02-23T18:56:26Z","author_association":"MEMBER","body":"This isn't likely to happen, the _changes feed has nothing to do with map-reduce.\r\n\r\nAttempts to filter _changes feeds via views failed for a number of reasons, and the work was abandonned prior to 1.x.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784433125/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784575787","html_url":"https://github.com/apache/couchdb/issues/1505#issuecomment-784575787","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1505","id":784575787,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDU3NTc4Nw==","user":{"login":"bdoyle0182","id":11879547,"node_id":"MDQ6VXNlcjExODc5NTQ3","avatar_url":"https://avatars.githubusercontent.com/u/11879547?v=4","gravatar_id":"","url":"https://api.github.com/users/bdoyle0182","html_url":"https://github.com/bdoyle0182","followers_url":"https://api.github.com/users/bdoyle0182/followers","following_url":"https://api.github.com/users/bdoyle0182/following{/other_user}","gists_url":"https://api.github.com/users/bdoyle0182/gists{/gist_id}","starred_url":"https://api.github.com/users/bdoyle0182/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bdoyle0182/subscriptions","organizations_url":"https://api.github.com/users/bdoyle0182/orgs","repos_url":"https://api.github.com/users/bdoyle0182/repos","events_url":"https://api.github.com/users/bdoyle0182/events{/privacy}","received_events_url":"https://api.github.com/users/bdoyle0182/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-23T23:03:26Z","updated_at":"2021-02-23T23:03:26Z","author_association":"NONE","body":"Is this reasonable to implement in the 3.x series if clustered purge had to deal with the addressed issues?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784575787/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784934935","html_url":"https://github.com/apache/couchdb/issues/1505#issuecomment-784934935","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1505","id":784934935,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NDkzNDkzNQ==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-24T09:23:30Z","updated_at":"2021-02-24T09:23:30Z","author_association":"CONTRIBUTOR","body":"My use cases are mainly in a mobile context where mobile clients don't need the old deleted docs. Currently, we are cleaning user databases writing external logic using the clustered purge functionality. This process needs to query the database to identify the candidate doc revisions to be purged, and then purge the leaf revisions in batches which is a quite expensive process.\r\n\r\nHaving this logic defined as part of the database makes the system simpler as CouchDB can manage it without the need for extra code as part of internal maintenance processes. So, I find this a good functionality to keep in mind as part of CouchDB.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/784934935/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/785206669","html_url":"https://github.com/apache/couchdb/issues/3377#issuecomment-785206669","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3377","id":785206669,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NTIwNjY2OQ==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-24T16:38:08Z","updated_at":"2021-02-24T16:38:08Z","author_association":"CONTRIBUTOR","body":"@janl @rnewson @chewbranca updated the RFC to reflect Bob's comments","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/785206669/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/785298912","html_url":"https://github.com/apache/couchdb/issues/3115#issuecomment-785298912","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3115","id":785298912,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NTI5ODkxMg==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-24T18:55:35Z","updated_at":"2021-02-24T18:55:35Z","author_association":"CONTRIBUTOR","body":"Keep in mind that couch_log need to be updated as well to match the changes in OTP logging infrastructure. I did a test and logging of crashes from gen_server doesn't work on otp 22 and I am sure wouldn't be working on 23 without changes.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/785298912/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786028134","html_url":"https://github.com/apache/couchdb/pull/3018#issuecomment-786028134","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3018","id":786028134,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NjAyODEzNA==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-25T16:26:21Z","updated_at":"2021-02-25T16:26:21Z","author_association":"MEMBER","body":"No longer needed","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786028134/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786244193","html_url":"https://github.com/apache/couchdb/issues/3382#issuecomment-786244193","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3382","id":786244193,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NjI0NDE5Mw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-25T21:36:34Z","updated_at":"2021-02-25T21:36:34Z","author_association":"CONTRIBUTOR","body":"Debugging this a bit more:\r\n\r\nI initially suspected it maybe related to the https://github.com/apache/couchdb/commit/27e8e332cf974bff69b86a8d3c5e2f5a6de4125f commit to minimize conflicts and use snapshot reads for db seq. So I reverted that commit but was still able to reproduce the issue. I had to modify the script slightly to not delete and re-create the view as the commit fixed the view indexer constantly conflicting and never finishing.\r\n\r\nThen I noticed that `curl -s $DB/db1/_design/foo/_info` returns the latest db sequence so the view is considered \"updated\" to the latest db_seq, which rules out the view somehow not processes all of the changes feed and stopping early.\r\n\r\n```\r\n% curl $DB/db1/_design/foo/_view/bar'?include_docs=true&limit=10'\r\n{\"total_rows\":98,\"offset\":null,\"rows\":[\r\n...\r\n{\"id\":\"doc66\",\"key\":46591,\"value\":\"1-90516cb1e0f4bc21e154f63be6fddb2a\",\"doc\":null},\r\n...\r\n]}\r\n```\r\n\r\n```\r\n% curl -s $DB/db1/_design/foo/_info| jq '.view_index.update_seq'\r\n\"000000069d8cf42c00000000\"\r\n\r\n% curl -s $DB/db1 | jq .update_seq\r\n\"000000069d8cf42c00000000\"\r\n\r\n% curl -s  $DB/db1/_changes | grep doc66\r\n{\"seq\":\"000000069d7fe8be00000000\",\"id\":\"doc66\",\"changes\":[{\"rev\":\"16-1c15c73b3bbea9c5427cb8497e8c18b9\"}],\"deleted\":true},\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786244193/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786279508","html_url":"https://github.com/apache/couchdb/issues/3382#issuecomment-786279508","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3382","id":786279508,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NjI3OTUwOA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-25T22:46:29Z","updated_at":"2021-02-25T22:46:29Z","author_association":"CONTRIBUTOR","body":"A trick that might help debug the issue is to use the `local_seq` view option then emit update_sequence for each doc in the view.\r\n\r\n```python\r\n#!/usr/bin/env python\r\n\r\nimport json\r\nimport random\r\nimport requests\r\nimport threading\r\n\r\nURL = 'http://127.0.0.1:15984/db1'\r\nUSER = 'adm'\r\nPASS = 'pass'\r\n#doc.foo\r\nVIEW = {\r\n    \"views\" : {\r\n        \"bar\":{\r\n            \"map\":\"function (doc) {emit(doc._id, [doc._rev, doc._local_seq]); }\"\r\n        }\r\n    },\r\n    \"options\": {\"local_seq\": True}\r\n}\r\ndef thread_fun():\r\n    s = requests.Session()\r\n    s.auth = (USER, PASS)\r\n    while True:\r\n        doc_id = random.randrange(1, 10)\r\n        doc = {}\r\n        r = s.get('{}/doc{}'.format(URL, doc_id))\r\n        if r.status_code == 200:\r\n            doc['_rev'] = r.json()['_rev']\r\n            if random.random() > 0.5:\r\n                doc['_deleted'] = True\r\n        s.put('{}/doc{}'.format(URL, doc_id), json = doc)\r\n\r\n\r\nif __name__ == \"__main__\":\r\n    s = requests.Session()\r\n    s.auth = (USER, PASS)\r\n    s.delete(URL)\r\n    s.put(URL)\r\n    s.put('{}/_design/foo'.format(URL), data = json.dumps(VIEW))\r\n    random.seed(42)\r\n    for x in range(1):\r\n        t = threading.Thread(target=thread_fun)\r\n        t.start()\r\n```\r\n\r\n```\r\ncurl $DB/db1/_design/foo/_view/bar'?include_docs=true&limit=10'\r\n{\"total_rows\":9,\"offset\":null,\"rows\":[\r\n{\"id\":\"doc1\",\"key\":\"doc1\",\"value\":[\"239-a68671522c8878b3e142c2e0c4e0c088\",\"00000007c21912e900000000\"],\"doc\":{\"_id\":\"doc1\",\"_rev\":\"252-6d90b849a9794f0c10c118255992ea91\"}},\r\n{\"id\":\"doc2\",\"key\":\"doc2\",\"value\":[\"260-59a6c60bddf9044d90c571569cb2c5af\",\"00000007c222b81800000000\"],\"doc\":null},\r\n{\"id\":\"doc3\",\"key\":\"doc3\",\"value\":[\"259-bee2fc5c0c38d01495d883c25b20fffb\",\"00000007c20d6a3b00000000\"],\"doc\":null},\r\n{\"id\":\"doc4\",\"key\":\"doc4\",\"value\":[\"267-da90f2173898fb5a5482a9a1dc36e56e\",\"00000007c21e82cf00000000\"],\"doc\":{\"_id\":\"doc4\",\"_rev\":\"280-c55640f682430b2b497a91499bcfd675\"}},\r\n{\"id\":\"doc5\",\"key\":\"doc5\",\"value\":[\"243-69229d2e0837f8ecf47595ce8b9efddb\",\"00000007c227d2aa00000000\"],\"doc\":null},\r\n{\"id\":\"doc6\",\"key\":\"doc6\",\"value\":[\"249-a35e458fe1eacba23641d6213230576c\",\"00000007c2041e7700000000\"],\"doc\":null},\r\n{\"id\":\"doc7\",\"key\":\"doc7\",\"value\":[\"268-bbc6d12f87a0031f8d2de6edcd4fb3d7\",\"00000007c22354ca00000000\"],\"doc\":{\"_id\":\"doc7\",\"_rev\":\"275-506c6db6153a407c4eefe34fa03f69dc\"}},\r\n{\"id\":\"doc8\",\"key\":\"doc8\",\"value\":[\"281-70a9df96a142c04ea0e45fc3ceea93a6\",\"00000007c225fcb600000000\"],\"doc\":{\"_id\":\"doc8\",\"_rev\":\"290-89c40a21527dc196d31118dfbce63dbe\"}},\r\n{\"id\":\"doc9\",\"key\":\"doc9\",\"value\":[\"281-54c6e5c3e806d21fcb39f3787440e845\",\"00000007c266503b00000000\"],\"doc\":{\"_id\":\"doc9\",\"_rev\":\"281-54c6e5c3e806d21fcb39f3787440e845\"}}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786279508/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786305924","html_url":"https://github.com/apache/couchdb/issues/3382#issuecomment-786305924","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3382","id":786305924,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NjMwNTkyNA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-25T23:40:06Z","updated_at":"2021-02-25T23:40:06Z","author_association":"CONTRIBUTOR","body":"Something maybe odd with IDTree or ViewMap BTree updates. This a log of all the write_docs docs, then the IDMap and ViewMap items:\r\n\r\n```\r\n[error] 2021-02-25T23:32:24.797212Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_indexer:write_docs@442 writting doc:#{deleted => false,id => <<\"doc5\">>,sequence => <<\"00000008684c7fbb00000000\">>}\r\n[error] 2021-02-25T23:32:24.797263Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_indexer:write_docs@442 writting doc:#{deleted => true,id => <<\"doc8\">>,sequence => <<\"00000008684d588a00000000\">>}\r\n[error] 2021-02-25T23:32:24.797296Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_indexer:write_docs@442 writting doc:#{deleted => false,id => <<\"doc7\">>,sequence => <<\"00000008684e915100000000\">>}\r\n[error] 2021-02-25T23:32:24.797343Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_indexer:write_docs@442 writting doc:#{deleted => true,id => <<\"doc2\">>,sequence => <<\"000000086850064b00000000\">>}\r\n[error] 2021-02-25T23:32:24.797375Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_indexer:write_docs@442 writting doc:#{deleted => false,id => <<\"doc9\">>,sequence => <<\"00000008685131a900000000\">>}\r\n[error] 2021-02-25T23:32:24.797403Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_indexer:write_docs@442 writting doc:#{deleted => true,id => <<\"doc6\">>,sequence => <<\"000000086851c7b200000000\">>}\r\n[error] 2021-02-25T23:32:24.797433Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_indexer:write_docs@442 writting doc:#{deleted => false,id => <<\"doc3\">>,sequence => <<\"0000000868525b8b00000000\">>}\r\n[error] 2021-02-25T23:32:24.797463Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_indexer:write_docs@442 writting doc:#{deleted => true,id => <<\"doc1\">>,sequence => <<\"000000086854237300000000\">>}\r\n[error] 2021-02-25T23:32:24.797494Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_indexer:write_docs@442 writting doc:#{deleted => false,id => <<\"doc4\">>,sequence => <<\"000000086855493400000000\">>}\r\n[error] 2021-02-25T23:32:24.798140Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_trees:update_views@202 IDTree {<<\"doc1\">>,#Ref<0.2949210352.4145020935.107350>}\r\n[error] 2021-02-25T23:32:24.798187Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_trees:update_views@202 IDTree {<<\"doc2\">>,#Ref<0.2949210352.4145020935.107350>}\r\n[error] 2021-02-25T23:32:24.798214Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_trees:update_views@202 IDTree {<<\"doc3\">>,[{0,[<<\"doc3\">>]}]}\r\n[error] 2021-02-25T23:32:24.798250Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_trees:update_views@202 IDTree {<<\"doc4\">>,[{0,[<<\"doc4\">>]}]}\r\n[error] 2021-02-25T23:32:24.798274Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_trees:update_views@202 IDTree {<<\"doc5\">>,[{0,[<<\"doc5\">>]}]}\r\n[error] 2021-02-25T23:32:24.798297Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_trees:update_views@202 IDTree {<<\"doc6\">>,#Ref<0.2949210352.4145020935.107350>}\r\n[error] 2021-02-25T23:32:24.798322Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_trees:update_views@202 IDTree {<<\"doc7\">>,[{0,[<<\"doc7\">>]}]}\r\n[error] 2021-02-25T23:32:24.798352Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_trees:update_views@202 IDTree {<<\"doc8\">>,#Ref<0.2949210352.4145020935.107350>}\r\n[error] 2021-02-25T23:32:24.798382Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_trees:update_views@202 IDTree {<<\"doc9\">>,[{0,[<<\"doc9\">>]}]}\r\n[error] 2021-02-25T23:32:24.798924Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_trees:update_views@213 ViewMap {{<<\"doc3\">>,<<\"doc3\">>},[<<\"22-097e4e5fed3b10b9e00cc0ee2c35dd43\">>,<<\"0000000868525b8b00000000\">>]}\r\n[error] 2021-02-25T23:32:24.798963Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_trees:update_views@213 ViewMap {{<<\"doc4\">>,<<\"doc4\">>},[<<\"24-56e5817ad4df6a2391016f3f8fa51079\">>,<<\"000000086855493400000000\">>]}\r\n[error] 2021-02-25T23:32:24.799005Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_trees:update_views@213 ViewMap {{<<\"doc5\">>,<<\"doc5\">>},[<<\"19-a2949bfc9889ebd35035a56e6ffc4ad1\">>,<<\"00000008684c7fbb00000000\">>]}\r\n[error] 2021-02-25T23:32:24.799037Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_trees:update_views@213 ViewMap {{<<\"doc7\">>,<<\"doc7\">>},[<<\"20-2b4f169ba4d20df8bb1563819b8e6b2d\">>,<<\"00000008684e915100000000\">>]}\r\n[error] 2021-02-25T23:32:24.799073Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_trees:update_views@213 ViewMap {{<<\"doc9\">>,<<\"doc9\">>},[<<\"30-63abba104dee58f12376d0ffd340b8ec\">>,<<\"00000008685131a900000000\">>]}\r\n[error] 2021-02-25T23:32:24.799385Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_indexer:is_update_finished@273 is_update finished true AtDbSeq:true LastSeq:<<\"000000086855493400000000\">> DbSeq:<<\"000000086855493400000000\">> AtViewVs:false ViewVs:not_found\r\n```\r\n\r\n\r\nWe notice that doc6 should be deleted and is updated with a deletedRef in couch_views_tree:update_views/3, however it still shows up in the view results:\r\n\r\n```\r\n% curl $DB/db1/_design/foo/_view/bar'?include_docs=true&limit=10'\r\n{\"total_rows\":6,\"offset\":null,\"rows\":[\r\n{\"id\":\"doc3\",\"key\":\"doc3\",\"value\":[\"22-097e4e5fed3b10b9e00cc0ee2c35dd43\",\"0000000868525b8b00000000\"],\"doc\":{\"_id\":\"doc3\",\"_rev\":\"22-097e4e5fed3b10b9e00cc0ee2c35dd43\"}},\r\n{\"id\":\"doc4\",\"key\":\"doc4\",\"value\":[\"24-56e5817ad4df6a2391016f3f8fa51079\",\"000000086855493400000000\"],\"doc\":{\"_id\":\"doc4\",\"_rev\":\"24-56e5817ad4df6a2391016f3f8fa51079\"}},\r\n{\"id\":\"doc5\",\"key\":\"doc5\",\"value\":[\"19-a2949bfc9889ebd35035a56e6ffc4ad1\",\"00000008684c7fbb00000000\"],\"doc\":{\"_id\":\"doc5\",\"_rev\":\"19-a2949bfc9889ebd35035a56e6ffc4ad1\"}},\r\n{\"id\":\"doc6\",\"key\":\"doc6\",\"value\":[\"11-bb8b0b3302cad9e88443e0f6a66b8834\",\"000000086809697700000000\"],\"doc\":null},\r\n{\"id\":\"doc7\",\"key\":\"doc7\",\"value\":[\"20-2b4f169ba4d20df8bb1563819b8e6b2d\",\"00000008684e915100000000\"],\"doc\":{\"_id\":\"doc7\",\"_rev\":\"20-2b4f169ba4d20df8bb1563819b8e6b2d\"}},\r\n{\"id\":\"doc9\",\"key\":\"doc9\",\"value\":[\"30-63abba104dee58f12376d0ffd340b8ec\",\"00000008685131a900000000\"],\"doc\":{\"_id\":\"doc9\",\"_rev\":\"30-63abba104dee58f12376d0ffd340b8ec\"}}\r\n]}\r\n```\r\n\r\nAnd the view sequence is stale in the view result:\r\n\r\n```\r\n[error] 2021-02-25T23:32:24.797403Z node1@127.0.0.1 <0.513.0> --------  +++++++ couch_views_indexer:write_docs@442 writting doc:#{deleted => true,id => <<\"doc6\">>,sequence => <<\"000000086851c7b200000000\">>}\r\n``` \r\n\r\nvs \r\n\r\n```\r\n{\"id\":\"doc6\",\"key\":\"doc6\",\"value\":[\"11-bb8b0b3302cad9e88443e0f6a66b8834\",\"000000086809697700000000\"],\"doc\":null},\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786305924/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786382683","html_url":"https://github.com/apache/couchdb/issues/3382#issuecomment-786382683","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3382","id":786382683,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NjM4MjY4Mw==","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-26T03:17:11Z","updated_at":"2021-02-26T03:17:11Z","author_association":"MEMBER","body":"This workload seems to cause quite a large number of commit conflicts for the indexer. Should the indexer be executing snapshot reads for the document data so that concurrent modifications of documents don't cause the commit in the view index to abort? More a performance issue than a correctness one, but it seems to me that a fast client updating a single document in a loop, combined with a suitably complex piece of JS code in a map function, could cause the indexer to get into an endless loop. I don't think that's what we want.\r\n\r\nI wasn't able to track it down completely but I also wonder if the bug is somewhere in those restarts. I did notice situations where e.g. the indexer would be indexing a batch of 5 documents, 1 of those documents would get updated concurrently, the indexer would restart and only index the other 4 documents, and the 5th one would be the one that was messed up in the view.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786382683/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786639112","html_url":"https://github.com/apache/couchdb/issues/3382#issuecomment-786639112","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3382","id":786639112,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NjYzOTExMg==","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-26T13:11:06Z","updated_at":"2021-02-26T13:11:06Z","author_association":"MEMBER","body":"(previous comment deleted because inaccurate -- just forgot to hit save on the updated view definition and it was throwing a JS error on the indexing :))","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786639112/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786846890","html_url":"https://github.com/apache/couchdb/issues/3382#issuecomment-786846890","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3382","id":786846890,"node_id":"MDEyOklzc3VlQ29tbWVudDc4Njg0Njg5MA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-26T19:25:19Z","updated_at":"2021-02-26T19:25:19Z","author_association":"MEMBER","body":"This should be fixed by #3385.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786846890/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786851752","html_url":"https://github.com/apache/couchdb/issues/3382#issuecomment-786851752","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3382","id":786851752,"node_id":"MDEyOklzc3VlQ29tbWVudDc4Njg1MTc1Mg==","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-26T19:35:04Z","updated_at":"2021-02-26T19:35:04Z","author_association":"MEMBER","body":"Not entirely. There's still an issue that the document is loaded in a separate transaction. If the doc is deleted between the completion of the view indexing and the request to attach the doc we will still hit this issue.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786851752/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786854434","html_url":"https://github.com/apache/couchdb/issues/3382#issuecomment-786854434","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3382","id":786854434,"node_id":"MDEyOklzc3VlQ29tbWVudDc4Njg1NDQzNA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-26T19:40:34Z","updated_at":"2021-02-26T19:40:34Z","author_association":"CONTRIBUTOR","body":"@kocolosk there is a separate issue that focuses mainly on that aspect https://github.com/apache/couchdb/issues/3381\r\n\r\nAfter @davisp's fix I can't reproduce this issue if the view is allowed to \"settle\" and process all the changes up to database's last update_seq.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786854434/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786855854","html_url":"https://github.com/apache/couchdb/issues/3381#issuecomment-786855854","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3381","id":786855854,"node_id":"MDEyOklzc3VlQ29tbWVudDc4Njg1NTg1NA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-26T19:43:18Z","updated_at":"2021-02-26T19:43:18Z","author_association":"CONTRIBUTOR","body":"I updated the description to not necessarily reference include_docs=true since it doesn't depend on that","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786855854/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786913780","html_url":"https://github.com/apache/couchdb/issues/3382#issuecomment-786913780","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3382","id":786913780,"node_id":"MDEyOklzc3VlQ29tbWVudDc4NjkxMzc4MA==","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-26T21:53:31Z","updated_at":"2021-02-26T21:53:31Z","author_association":"MEMBER","body":"Agreed, if this issue is scoped to permanent inconsistencies then we are all set here.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/786913780/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/788032042","html_url":"https://github.com/apache/couchdb/issues/3387#issuecomment-788032042","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3387","id":788032042,"node_id":"MDEyOklzc3VlQ29tbWVudDc4ODAzMjA0Mg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-01T15:23:37Z","updated_at":"2021-03-01T15:23:37Z","author_association":"MEMBER","body":"You probably want the `3.x` branch, not `main`, which doesn't have the 2.x/3.x concept of shards anymore.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/788032042/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/788065847","html_url":"https://github.com/apache/couchdb/issues/3388#issuecomment-788065847","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3388","id":788065847,"node_id":"MDEyOklzc3VlQ29tbWVudDc4ODA2NTg0Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-01T16:03:51Z","updated_at":"2021-03-01T16:03:51Z","author_association":"MEMBER","body":"`couch_httpd_auth` is deprecated, everything should be in `chttpd_auth`. Does it work if you put everything inside there? If not, it's a bug. If yes, it's a documentation bug.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/788065847/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/788069557","html_url":"https://github.com/apache/couchdb/issues/3387#issuecomment-788069557","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3387","id":788069557,"node_id":"MDEyOklzc3VlQ29tbWVudDc4ODA2OTU1Nw==","user":{"login":"mojito317","id":17944122,"node_id":"MDQ6VXNlcjE3OTQ0MTIy","avatar_url":"https://avatars.githubusercontent.com/u/17944122?v=4","gravatar_id":"","url":"https://api.github.com/users/mojito317","html_url":"https://github.com/mojito317","followers_url":"https://api.github.com/users/mojito317/followers","following_url":"https://api.github.com/users/mojito317/following{/other_user}","gists_url":"https://api.github.com/users/mojito317/gists{/gist_id}","starred_url":"https://api.github.com/users/mojito317/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mojito317/subscriptions","organizations_url":"https://api.github.com/users/mojito317/orgs","repos_url":"https://api.github.com/users/mojito317/repos","events_url":"https://api.github.com/users/mojito317/events{/privacy}","received_events_url":"https://api.github.com/users/mojito317/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-01T16:08:59Z","updated_at":"2021-03-01T16:09:39Z","author_association":"NONE","body":"Thanks for the information, @wohali!\r\n\r\nIf `main` does not have the concept of shards anymore, could the response code be a `403` or a `410` then? I think the `400` error message (```Invalid `db` ```) is misleading here. \r\n\r\nIt also came to my notice that some of the GET reshard endpoints are working while I was running the `main` branch, so I would like to ask for similar response codes there if you reach the point where you turn off the `reshard` endpoints properly. Thanks in front!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/788069557/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/788087491","html_url":"https://github.com/apache/couchdb/issues/3387#issuecomment-788087491","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3387","id":788087491,"node_id":"MDEyOklzc3VlQ29tbWVudDc4ODA4NzQ5MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-01T16:32:43Z","updated_at":"2021-03-01T16:32:43Z","author_association":"MEMBER","body":"`main` is under heavy development towards `4.0` and is not feature complete, as far as I understand.\r\n\r\nI would not be using it at the moment and would stick with `3.x` for any production use.\r\n\r\nI'm sure a pass will be done to clean up the removed endpoints for 4.0.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/788087491/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/788212151","html_url":"https://github.com/apache/couchdb/pull/3389#issuecomment-788212151","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3389","id":788212151,"node_id":"MDEyOklzc3VlQ29tbWVudDc4ODIxMjE1MQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-01T19:32:54Z","updated_at":"2021-03-01T19:32:54Z","author_association":"MEMBER","body":"Thank you for the review, @rnewson ! I'm about to merge this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/788212151/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/788229495","html_url":"https://github.com/apache/couchdb/pull/3390#issuecomment-788229495","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3390","id":788229495,"node_id":"MDEyOklzc3VlQ29tbWVudDc4ODIyOTQ5NQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-01T19:59:14Z","updated_at":"2021-03-01T19:59:14Z","author_association":"MEMBER","body":"Thank you for the review, @iilyak ! I'm about to merge this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/788229495/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/788927063","html_url":"https://github.com/apache/couchdb/issues/3388#issuecomment-788927063","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3388","id":788927063,"node_id":"MDEyOklzc3VlQ29tbWVudDc4ODkyNzA2Mw==","user":{"login":"tudordumitriu","id":4671554,"node_id":"MDQ6VXNlcjQ2NzE1NTQ=","avatar_url":"https://avatars.githubusercontent.com/u/4671554?v=4","gravatar_id":"","url":"https://api.github.com/users/tudordumitriu","html_url":"https://github.com/tudordumitriu","followers_url":"https://api.github.com/users/tudordumitriu/followers","following_url":"https://api.github.com/users/tudordumitriu/following{/other_user}","gists_url":"https://api.github.com/users/tudordumitriu/gists{/gist_id}","starred_url":"https://api.github.com/users/tudordumitriu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tudordumitriu/subscriptions","organizations_url":"https://api.github.com/users/tudordumitriu/orgs","repos_url":"https://api.github.com/users/tudordumitriu/repos","events_url":"https://api.github.com/users/tudordumitriu/events{/privacy}","received_events_url":"https://api.github.com/users/tudordumitriu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T13:56:49Z","updated_at":"2021-03-02T13:56:49Z","author_association":"NONE","body":"Once I moved the settings in chttpd_auth and updated the handlers accordingly all went fine, both auth methods working side by side.\r\nThanks and indeed the docs should be updated because is very confusing because they do work separately.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/788927063/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789000421","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-789000421","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":789000421,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTAwMDQyMQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T15:40:14Z","updated_at":"2021-03-02T15:40:14Z","author_association":"MEMBER","body":"I'd be happy to open a PR for this if someone helps me figure out why it's broken.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789000421/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789059732","html_url":"https://github.com/apache/couchdb/pull/3393#issuecomment-789059732","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3393","id":789059732,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTA1OTczMg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T17:02:40Z","updated_at":"2021-03-02T17:02:40Z","author_association":"CONTRIBUTOR","body":"I think this may need the new erlfdb bump. I already created a new release so we can refer to it by tag (v1.2.5). \r\n\r\n```\r\n-{erlfdb,           \"erlfdb\",           {tag, \"v1.2.3\"}},\r\n+{erlfdb,           \"erlfdb\",           {tag, \"v1.2.5\"}},\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789059732/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789153740","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-789153740","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":789153740,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTE1Mzc0MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T19:24:33Z","updated_at":"2021-03-02T19:24:33Z","author_association":"MEMBER","body":"@bessbd I'll have a look at this later today and we can talk through together what's up.\r\n\r\nIf you try to follow the steps in https://github.com/apache/couchdb/blob/main/build-aux/Jenkinsfile.full (this is run after any merge to `main`) by hand, using the Docker images, can you reproduce it?\r\n\r\nIt may be as simple as re-building the Docker containers and re-pushing them. This is not currently done automatically.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789153740/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789201879","html_url":"https://github.com/apache/couchdb/pull/3396#issuecomment-789201879","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3396","id":789201879,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTIwMTg3OQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T20:42:21Z","updated_at":"2021-03-02T20:42:21Z","author_association":"CONTRIBUTOR","body":"`make check` passed locally, merged","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789201879/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789206650","html_url":"https://github.com/apache/couchdb/issues/3377#issuecomment-789206650","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3377","id":789206650,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTIwNjY1MA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T20:51:04Z","updated_at":"2021-03-02T20:51:04Z","author_association":"MEMBER","body":"looks good to me, direct and to the point.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789206650/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789258207","html_url":"https://github.com/apache/couchdb/pull/3393#issuecomment-789258207","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3393","id":789258207,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTI1ODIwNw==","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T22:14:07Z","updated_at":"2021-03-02T22:14:07Z","author_association":"MEMBER","body":"`make check` passed locally","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789258207/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789285779","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-789285779","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":789285779,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTI4NTc3OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-02T23:01:33Z","updated_at":"2021-03-02T23:08:11Z","author_association":"MEMBER","body":"This isn't something that can be fixed with a checkin. The **macOS** machine is failing to build: https://ci-couchdb.apache.org/blue/organizations/jenkins/jenkins-cm1%2FFullPlatformMatrix/detail/main/49/pipeline\r\n\r\n@janl We need your help to fix this.\r\n\r\nWe also have FreeBSD machines that are presently offline. There was a stoarge failure AND backup failure (due to bugs in both ZFS and Ceph!) and the machines need to be rebuilt. This is presently masked by the macOS failures. I will rebuild them this evening,\r\n\r\nWe also need to rebuild the arm worker, this is Amazon's fault, they deleted our instance _again_ - a year to the exact day it was recreated after the last time it got nuked unexpectedly. I've asked for a root cause analysis; nothing yet.\r\n\r\nFYI, PRs only build on 3x Debian x86 instances, which is why they pass. Those images have fdb in them, as you pointed out.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789285779/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789322501","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-789322501","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":789322501,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTMyMjUwMQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-03T00:24:57Z","updated_at":"2021-03-03T00:30:02Z","author_association":"MEMBER","body":"I've gotten the ARM node back online. I've relaunched the couchdb-arm-1 node on AWS. For posterity here is the configuration:\r\n\r\n![Snap 2021-03-02, 18_25_03](https://user-images.githubusercontent.com/112292/109728724-c707aa80-7b84-11eb-9c54-a9174cd2f0f6.png)\r\n\r\nWhile @davisp 's ansible setup could be used to manage this host as well, I did it by hand for expedience.\r\n\r\nI ssh'ed into the machine and ran this to get prereqs installed, to create the Jenkins user, and to install the [ASF Infra pubkey](https://github.com/apache/infrastructure-p6/blob/production/modules/nightlies/files/jenkins.pub):\r\n\r\n```bash\r\nsudo apt update\r\nsudo apt upgrade -y\r\nsudo apt install -y openjdk-11-jre\r\nsudo groupadd -g 910 jenkins\r\nsudo useradd -u 910 -g 910 -m jenkins\r\nsudo mkdir /home/jenkins/.ssh\r\necho \"<PUBKEY FROM PRIVATE REPO>\" | sudo tee /home/jenkins/.ssh/authorized_keys >/dev/null\r\nsudo chown -R jenkins:jenkins /home/jenkins/.ssh\r\nsudo chmod -R og-rwx /home/jenkins/.ssh\r\n```\r\n\r\nthen, for Docker from https://docs.docker.com/engine/install/debian/:\r\n\r\n```bash\r\nsudo apt install -y apt-transport-https ca-certificates curl gnupg\r\ncurl -fsSL https://download.docker.com/linux/debian/gpg | sudo gpg --dearmor -o /usr/share/keyrings/docker-archive-keyring.gpg\r\necho \\\r\n  \"deb [arch=arm64 signed-by=/usr/share/keyrings/docker-archive-keyring.gpg] https://download.docker.com/linux/debian \\\r\n  $(lsb_release -cs) stable\" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null\r\nsudo apt update\r\nsudo apt install -y docker-ce docker-ce-cli containerd.io\r\n# check functionality\r\nsudo docker run hello-world\r\n```\r\n\r\nI then went to [Jenkins](https://ci-couchdb.apache.org/computer/couchdb-arm-1/configure) and updated the IP address to the new elastic IP address from AWS, and updated the hostkey with the contents of the node's `/etc/ssh/ssh_host_ecdsa_key.pub` . I pressed the Save button, then the Launch Agent button. The log showed it connected, downloaded, and ran the Jenkins agent.\r\n\r\nThe node then needed the nightly cronjobs [from here](https://github.com/apache/infrastructure-p6/blob/production/modules/build_nodes/manifests/jenkins.pp#L520-L551), which I added by hand. The `kill-old-docker.sh` script is in the same repo.\r\n\r\n-----\r\n\r\nStill TODO: the FreeBSD nodes, and when Jan can get to it, the Mac node.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789322501/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789531832","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-789531832","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":789531832,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTUzMTgzMg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-03T08:23:04Z","updated_at":"2021-03-03T18:13:01Z","author_association":"MEMBER","body":"The FreeBSD nodes are now back online. As far as I can tell, `main` has never successfully built on these nodes, so there is still work to be done.\r\n\r\nSee #3399 if you'd like to help, and paging @dch .","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789531832/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789794714","html_url":"https://github.com/apache/couchdb/pull/3398#issuecomment-789794714","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3398","id":789794714,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTc5NDcxNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-03T15:23:45Z","updated_at":"2021-03-03T15:23:45Z","author_association":"MEMBER","body":"Perfect, thanks. Merge away!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789794714/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789841242","html_url":"https://github.com/apache/couchdb/pull/3395#issuecomment-789841242","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3395","id":789841242,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTg0MTI0Mg==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-03T16:24:30Z","updated_at":"2021-03-03T16:24:30Z","author_association":"MEMBER","body":"Thank you for the review, @iilyak and @nickva ! I'm about to merge this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789841242/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789846999","html_url":"https://github.com/apache/couchdb/pull/3395#issuecomment-789846999","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3395","id":789846999,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTg0Njk5OQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-03T16:28:52Z","updated_at":"2021-03-03T16:28:52Z","author_association":"CONTRIBUTOR","body":"@bessbd don't forget to squash the commits","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789846999/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789849531","html_url":"https://github.com/apache/couchdb/pull/3395#issuecomment-789849531","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3395","id":789849531,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTg0OTUzMQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-03T16:30:48Z","updated_at":"2021-03-03T16:30:48Z","author_association":"MEMBER","body":"> @bessbd don't forget to squash the commits\r\n\r\nI always squash :)\r\n\r\nBut thank you for the reminder!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789849531/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789948954","html_url":"https://github.com/apache/couchdb/issues/3399#issuecomment-789948954","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3399","id":789948954,"node_id":"MDEyOklzc3VlQ29tbWVudDc4OTk0ODk1NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-03T18:14:44Z","updated_at":"2021-03-03T18:14:44Z","author_association":"MEMBER","body":"FYI, the build environment on these machines has both `foundationdb` and `foundationdb-devel` installed from binary packages. This is because `foundationdb` doesn't include the header files needed for compiling `erlfdb`.\r\n\r\nHowever, the problem might be that while `foundationdb` is a 2.x release, `foundationdb-devel` is a 3.0.0 pre-release... need help from @dch here.\r\n\r\nAn alternative might be to install fdb completely from source until the ports tree stuff is sorted out.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/789948954/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/790130756","html_url":"https://github.com/apache/couchdb/pull/3397#issuecomment-790130756","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3397","id":790130756,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MDEzMDc1Ng==","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-03T22:54:17Z","updated_at":"2021-03-03T22:54:17Z","author_association":"MEMBER","body":"For posterity, is this the correct list of transaction options that can be configured? https://github.com/apache/couchdb-erlfdb/blob/e652c5606688c9af11023d455eea5a6c46a8a450/c_src/atom_names.h#L76-L110","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/790130756/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/790207124","html_url":"https://github.com/apache/couchdb/pull/3397#issuecomment-790207124","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3397","id":790207124,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MDIwNzEyNA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-04T01:19:27Z","updated_at":"2021-03-04T01:19:27Z","author_association":"CONTRIBUTOR","body":"This might be a better reference to look at since it has the API version checks in there as well \r\n https://github.com/apache/couchdb-erlfdb/blob/e652c5606688c9af11023d455eea5a6c46a8a450/c_src/main.c#L927-L994\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/790207124/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/790863789","html_url":"https://github.com/apache/couchdb/pull/3402#issuecomment-790863789","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3402","id":790863789,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MDg2Mzc4OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-04T19:18:14Z","updated_at":"2021-03-04T19:18:14Z","author_association":"MEMBER","body":"Why not just put this as new fields in `GET /_up`? Seems odd to have to support 2 separate liveness checks, I can't imagine many LBs wanting to do two separate checks...","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/790863789/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791011003","html_url":"https://github.com/apache/couchdb/issues/3403#issuecomment-791011003","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3403","id":791011003,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTAxMTAwMw==","user":{"login":"BAITSLabs","id":30995021,"node_id":"MDQ6VXNlcjMwOTk1MDIx","avatar_url":"https://avatars.githubusercontent.com/u/30995021?v=4","gravatar_id":"","url":"https://api.github.com/users/BAITSLabs","html_url":"https://github.com/BAITSLabs","followers_url":"https://api.github.com/users/BAITSLabs/followers","following_url":"https://api.github.com/users/BAITSLabs/following{/other_user}","gists_url":"https://api.github.com/users/BAITSLabs/gists{/gist_id}","starred_url":"https://api.github.com/users/BAITSLabs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BAITSLabs/subscriptions","organizations_url":"https://api.github.com/users/BAITSLabs/orgs","repos_url":"https://api.github.com/users/BAITSLabs/repos","events_url":"https://api.github.com/users/BAITSLabs/events{/privacy}","received_events_url":"https://api.github.com/users/BAITSLabs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-04T23:01:43Z","updated_at":"2021-03-04T23:01:43Z","author_association":"NONE","body":"I solved it by doing this: sudo snap install couchdb\r\n\r\nhere are my results on a fresh install Ubuntu 18-04 (64 bit) I read a bunch of threads and all failed \r\n\r\n$ cd ..\r\n$ sudo apt-get install couchdb\r\n[sudo] password for devicfm:\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nPackage couchdb is not available, but is referred to by another package.\r\nThis may mean that the package is missing, has been obsoleted, or\r\nis only available from another source\r\n\r\nE: Package 'couchdb' has no installation candidate\r\n$ sudo apt search couchdb\r\nSorting... Done\r\nFull Text Search... Done\r\ncouchapp/bionic 1.0.2+dfsg1-1 all\r\n  Standalone CouchDB Application Development Made Simple\r\n\r\nlibcatmandu-perl/bionic 1.0700-1 all\r\n  metadata toolkit\r\n\r\nliblightcouch-java/bionic 0.0.6-1 all\r\n  LightCouch - CouchDB Java API\r\n\r\npd-purest-json/bionic 1.4.2-3 amd64\r\n  Pd library for working with JSON data and RESTful webservices\r\n\r\npython-celery/bionic 4.1.0-2ubuntu1 all\r\n  async task/job queue based on message passing (Python2 version)\r\n\r\npython-celery-common/bionic 4.1.0-2ubuntu1 all\r\n  async task/job queue based on message passing (common files)\r\n\r\npython-celery-doc/bionic 4.1.0-2ubuntu1 all\r\n  async task/job queue based on message passing (Documentation)\r\n\r\npython-couchdb/bionic 0.10-1.1 all\r\n  library for working with Apache CouchDB\r\n\r\npython-couchdbkit/bionic 0.6.5-2 all\r\n  Trying to improve couchdb experience in Python\r\n\r\npython-paisley/bionic 0.3.1-1 all\r\n  CouchDB client written in Python to be used within a Twisted application\r\n\r\npython-restkit/bionic 4.2.2-2 all\r\n  Restkit is an HTTP resource kit for Python\r\n\r\npython3-celery/bionic 4.1.0-2ubuntu1 all\r\n  async task/job queue based on message passing (Python3 version)\r\n\r\n$ sudo apt install apt-transport-https\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nThe following package was automatically installed and is no longer required:\r\n  python3-netifaces\r\nUse 'sudo apt autoremove' to remove it.\r\nThe following NEW packages will be installed:\r\n  apt-transport-https\r\n0 upgraded, 1 newly installed, 0 to remove and 72 not upgraded.\r\nNeed to get 1,696 B of archives.\r\nAfter this operation, 153 kB of additional disk space will be used.\r\nGet:1 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 apt-transport-https all 1.6.12ubuntu0.2 [1,696 B]\r\nFetched 1,696 B in 0s (5,564 B/s)\r\nSelecting previously unselected package apt-transport-https.\r\n(Reading database ... 103449 files and directories currently installed.)\r\nPreparing to unpack .../apt-transport-https_1.6.12ubuntu0.2_all.deb ...\r\nUnpacking apt-transport-https (1.6.12ubuntu0.2) ...\r\nSetting up apt-transport-https (1.6.12ubuntu0.2) ...\r\n$ sudo apt install couchdb\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nPackage couchdb is not available, but is referred to by another package.\r\nThis may mean that the package is missing, has been obsoleted, or\r\nis only available from another source\r\n\r\nE: Package 'couchdb' has no installation candidate\r\n$ sudo apt-get install couchdb\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nPackage couchdb is not available, but is referred to by another package.\r\nThis may mean that the package is missing, has been obsoleted, or\r\nis only available from another source\r\n\r\nE: Package 'couchdb' has no installation candidate\r\n$ sudo apt policy couchdb\r\ncouchdb:\r\n  Installed: (none)\r\n  Candidate: (none)\r\n  Version table:\r\n$ curl -sSL https://couchdb.apache.org/repo/bintray-pubkey.asc | sudo apt-key add -\r\nOK\r\n$ sudo apt-get install couchdb\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nPackage couchdb is not available, but is referred to by another package.\r\nThis may mean that the package is missing, has been obsoleted, or\r\nis only available from another source\r\n\r\nE: Package 'couchdb' has no installation candidate\r\n$ sudo apt install couchdb\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nPackage couchdb is not available, but is referred to by another package.\r\nThis may mean that the package is missing, has been obsoleted, or\r\nis only available from another source\r\n\r\nE: Package 'couchdb' has no installation candidate\r\n$ sudo rm /etc/apt/sources.list\r\n$ sudo apt update\r\nIgn:1 https://apache.bintray.com/couchdb-deb bionic InRelease\r\nGet:2 https://apache.bintray.com/couchdb-deb bionic Release [1,840 B]\r\nGet:3 https://apache.bintray.com/couchdb-deb bionic Release.gpg [821 B]\r\nGet:4 https://apache.bintray.com/couchdb-deb bionic/main amd64 Packages [2,895 B]\r\nFetched 5,556 B in 1s (4,202 B/s)\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nAll packages are up to date.\r\n$ sudo apt-get install couchdb\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nSome packages could not be installed. This may mean that you have\r\nrequested an impossible situation or if you are using the unstable\r\ndistribution that some required packages have not yet been created\r\nor been moved out of Incoming.\r\nThe following information may help to resolve the situation:\r\n\r\nThe following packages have unmet dependencies:\r\n couchdb : Depends: couch-libmozjs185-1.0 but it is not going to be installed\r\nE: Unable to correct problems, you have held broken packages.\r\n$ apt list --upgradable\r\nListing... Done\r\n$ echo \"deb https://apache.bintray.com/couchdb-deb bionic main\"     | tee -a /etc/apt/sources.list.d/couchdb.list              tee: /etc/apt/sources.list.d/couchdb.list: Permission denied\r\ndeb https://apache.bintray.com/couchdb-deb bionic main\r\n$ sudo echo \"deb https://apache.bintray.com/couchdb-deb bionic main\" | tee -a /etc/apt/sources.list.d/couchdb.list\r\ntee: /etc/apt/sources.list.d/couchdb.list: Permission denied\r\ndeb https://apache.bintray.com/couchdb-deb bionic main\r\n$ sudo echo \"deb https://apache.bintray.com/couchdb-deb bionic main\" | sudo tee -a /etc/apt/sources.list.d/couchdb.list\r\ndeb https://apache.bintray.com/couchdb-deb bionic main\r\n$ sudo deb https://apache.bintray.com/couchdb-deb bionic main\r\nsudo: deb: command not found\r\n$ sudo echo \"deb https://apache.bintray.com/couchdb-deb bionic main\" | sudo tee -a /etc/apt/sources.list.d/couchdb.list deb https://apache.bintray.com/couchdb-deb bionic main\r\ntee: 'https://apache.bintray.com/couchdb-deb': No such file or directory\r\ndeb https://apache.bintray.com/couchdb-deb bionic main\r\n$ apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 8756C4F765C9AC3CB6B85D62379CE192D401AB61\r\nExecuting: /tmp/apt-key-gpghome.MNLmfoDGo6/gpg.1.sh --keyserver keyserver.ubuntu.com --recv-keys 8756C4F765C9AC3CB6B85D62379CE192D401AB61\r\ngpg: keyserver receive failed: Connection timed out\r\n$ sudo apt update\r\nIgn:1 https://apache.bintray.com/couchdb-deb bionic InRelease\r\nGet:2 https://apache.bintray.com/couchdb-deb bionic Release [1,840 B]\r\nFetched 1,840 B in 1s (2,249 B/s)\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nAll packages are up to date.\r\nW: Target Packages (main/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target Packages (main/binary-all/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target Translations (main/i18n/Translation-en_US) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target Translations (main/i18n/Translation-en) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target CNF (main/cnf/Commands-amd64) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target CNF (main/cnf/Commands-all) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target Packages (main/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target Packages (main/binary-all/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target Translations (main/i18n/Translation-en_US) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target Translations (main/i18n/Translation-en) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target CNF (main/cnf/Commands-amd64) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target CNF (main/cnf/Commands-all) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target Packages (main/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target Packages (main/binary-all/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target Translations (main/i18n/Translation-en_US) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target Translations (main/i18n/Translation-en) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target CNF (main/cnf/Commands-amd64) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target CNF (main/cnf/Commands-all) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target Packages (main/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target Packages (main/binary-all/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target Translations (main/i18n/Translation-en_US) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target Translations (main/i18n/Translation-en) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target CNF (main/cnf/Commands-amd64) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target CNF (main/cnf/Commands-all) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\n$ sudo apt install -y couchdb\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nSome packages could not be installed. This may mean that you have\r\nrequested an impossible situation or if you are using the unstable\r\ndistribution that some required packages have not yet been created\r\nor been moved out of Incoming.\r\nThe following information may help to resolve the situation:\r\n\r\nThe following packages have unmet dependencies:\r\n couchdb : Depends: couch-libmozjs185-1.0 but it is not going to be installed\r\nE: Unable to correct problems, you have held broken packages.\r\n$ sudo apt install -y couchdb couch-libmozjs185-1.0 curl krb5-locales libcurl4 libgssapi-krb5-2 libicu60 libk5crypto3 libkeyutils1 libkrb5-3 libkrb5support0\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nlibk5crypto3 is already the newest version (1.16-2ubuntu0.2).\r\nlibk5crypto3 set to manually installed.\r\nlibicu60 is already the newest version (60.2-3ubuntu3.1).\r\nlibicu60 set to manually installed.\r\ncurl is already the newest version (7.58.0-2ubuntu3.12).\r\ncurl set to manually installed.\r\nlibcurl4 is already the newest version (7.58.0-2ubuntu3.12).\r\nlibcurl4 set to manually installed.\r\nlibkrb5support0 is already the newest version (1.16-2ubuntu0.2).\r\nlibkrb5support0 set to manually installed.\r\nlibgssapi-krb5-2 is already the newest version (1.16-2ubuntu0.2).\r\nlibgssapi-krb5-2 set to manually installed.\r\nkrb5-locales is already the newest version (1.16-2ubuntu0.2).\r\nkrb5-locales set to manually installed.\r\nlibkrb5-3 is already the newest version (1.16-2ubuntu0.2).\r\nlibkrb5-3 set to manually installed.\r\nlibkeyutils1 is already the newest version (1.5.9-9.2ubuntu2).\r\nlibkeyutils1 set to manually installed.\r\nSome packages could not be installed. This may mean that you have\r\nrequested an impossible situation or if you are using the unstable\r\ndistribution that some required packages have not yet been created\r\nor been moved out of Incoming.\r\nThe following information may help to resolve the situation:\r\n\r\nThe following packages have unmet dependencies:\r\n couch-libmozjs185-1.0 : Depends: libnspr4 (>= 2:4.9-2~) but it is not installable\r\nE: Unable to correct problems, you have held broken packages.\r\n$ sudo apt install -y couchdb couch-libmozjs185-1.0 curl krb5-locales libcurl4 libgssapi-krb5-2 libicu60 libk5crypto3 libkeyutils1 libkrb5-3 libkrb5support0 libnghttp2-14 libnspr4 libpsl5 librtmp1 publicsuffix\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nPackage libnspr4 is not available, but is referred to by another package.\r\nThis may mean that the package is missing, has been obsoleted, or\r\nis only available from another source\r\n\r\nE: Package 'libnspr4' has no installation candidate\r\n$ sudo apt install -y couchdb couch-libmozjs185-1.0 curl krb5-locales libcurl4 libgssapi-krb5-2 libicu60 libk5crypto3 libkeyutils1 libkrb5-3 libkrb5support0 libnghttp2-14 libpsl5 librtmp1 publicsuffix\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nlibk5crypto3 is already the newest version (1.16-2ubuntu0.2).\r\nlibk5crypto3 set to manually installed.\r\nlibicu60 is already the newest version (60.2-3ubuntu3.1).\r\nlibicu60 set to manually installed.\r\nlibnghttp2-14 is already the newest version (1.30.0-1ubuntu1).\r\nlibnghttp2-14 set to manually installed.\r\ncurl is already the newest version (7.58.0-2ubuntu3.12).\r\ncurl set to manually installed.\r\nlibpsl5 is already the newest version (0.19.1-5build1).\r\nlibpsl5 set to manually installed.\r\nlibcurl4 is already the newest version (7.58.0-2ubuntu3.12).\r\nlibcurl4 set to manually installed.\r\nlibrtmp1 is already the newest version (2.4+20151223.gitfa8646d.1-1).\r\nlibrtmp1 set to manually installed.\r\nlibkrb5support0 is already the newest version (1.16-2ubuntu0.2).\r\nlibkrb5support0 set to manually installed.\r\nlibgssapi-krb5-2 is already the newest version (1.16-2ubuntu0.2).\r\nlibgssapi-krb5-2 set to manually installed.\r\nkrb5-locales is already the newest version (1.16-2ubuntu0.2).\r\nkrb5-locales set to manually installed.\r\npublicsuffix is already the newest version (20180223.1310-1).\r\npublicsuffix set to manually installed.\r\nlibkrb5-3 is already the newest version (1.16-2ubuntu0.2).\r\nlibkrb5-3 set to manually installed.\r\nlibkeyutils1 is already the newest version (1.5.9-9.2ubuntu2).\r\nlibkeyutils1 set to manually installed.\r\nSome packages could not be installed. This may mean that you have\r\nrequested an impossible situation or if you are using the unstable\r\ndistribution that some required packages have not yet been created\r\nor been moved out of Incoming.\r\nThe following information may help to resolve the situation:\r\n\r\nThe following packages have unmet dependencies:\r\n couch-libmozjs185-1.0 : Depends: libnspr4 (>= 2:4.9-2~) but it is not installable\r\nE: Unable to correct problems, you have held broken packages.\r\n$ sudo apt search libnspr\r\nSorting... Done\r\nFull Text Search... Done\r\n$ sudo apt list libnspr\r\nListing... Done\r\n$ sudo apt list libnspr4\r\nListing... Done\r\n$ sudo apt search libnspr4\r\nSorting... Done\r\nFull Text Search... Done\r\n$ sudo apt install -y couchdb curl krb5-locales libcurl4 libgssapi-krb5-2 libicu60 libk5crypto3 libkeyutils1 libkrb5-3\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nlibk5crypto3 is already the newest version (1.16-2ubuntu0.2).\r\nlibk5crypto3 set to manually installed.\r\nlibicu60 is already the newest version (60.2-3ubuntu3.1).\r\nlibicu60 set to manually installed.\r\ncurl is already the newest version (7.58.0-2ubuntu3.12).\r\ncurl set to manually installed.\r\nlibcurl4 is already the newest version (7.58.0-2ubuntu3.12).\r\nlibcurl4 set to manually installed.\r\nlibgssapi-krb5-2 is already the newest version (1.16-2ubuntu0.2).\r\nlibgssapi-krb5-2 set to manually installed.\r\nkrb5-locales is already the newest version (1.16-2ubuntu0.2).\r\nkrb5-locales set to manually installed.\r\nlibkrb5-3 is already the newest version (1.16-2ubuntu0.2).\r\nlibkrb5-3 set to manually installed.\r\nlibkeyutils1 is already the newest version (1.5.9-9.2ubuntu2).\r\nlibkeyutils1 set to manually installed.\r\nSome packages could not be installed. This may mean that you have\r\nrequested an impossible situation or if you are using the unstable\r\ndistribution that some required packages have not yet been created\r\nor been moved out of Incoming.\r\nThe following information may help to resolve the situation:\r\n\r\nThe following packages have unmet dependencies:\r\n couchdb : Depends: couch-libmozjs185-1.0 but it is not going to be installed\r\nE: Unable to correct problems, you have held broken packages.\r\n$ sudo apt install -y couchdb curl krb5-locales libcurl4 libgssapi-krb5-2 libicu60 libk5crypto3 libkeyutils1 libkrb5-3 libkrb5support0 libnghttp2-14 libnspr4 libpsl5 librtmp1 publicsuffix\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nPackage libnspr4 is not available, but is referred to by another package.\r\nThis may mean that the package is missing, has been obsoleted, or\r\nis only available from another source\r\n\r\nE: Package 'libnspr4' has no installation candidate\r\n$ docker pull ubuntu:18.04\r\nWARNING:root:could not open file '/etc/apt/sources.list'\r\n\r\n\r\nCommand 'docker' not found, but can be installed with:\r\n\r\nsudo snap install docker     # version 19.03.13, or\r\nsudo apt  install docker.io\r\n\r\nSee 'snap info docker' for additional versions.\r\n\r\n$ sudo snap install docker\r\ndocker 19.03.13 from Canonical✓ installed\r\n$ docker pull ubuntu:18.04\r\nGot permission denied while trying to connect to the Docker daemon socket at unix:///var/run/docker.sock: Post http://%2Fvar%2Frun%2Fdocker.sock/v1.40/images/create?fromImage=ubuntu&tag=18.04: dial unix /var/run/docker.sock: connect: permission denied\r\n$ sudo docker pull ubuntu:18.04\r\n18.04: Pulling from library/ubuntu\r\n92dc2a97ff99: Pull complete\r\nbe13a9d27eb8: Pull complete\r\nc8299583700a: Pull complete\r\nDigest: sha256:4bc3ae6596938cb0d9e5ac51a1152ec9dcac2a1c50829c74abd9c4361e321b26\r\nStatus: Downloaded newer image for ubuntu:18.04\r\ndocker.io/library/ubuntu:18.04\r\n$ sudo docker run -it ubuntu:18.04 /bin/bash\r\nroot@5d305771d975:/# sudo apt update\r\nbash: sudo: command not found\r\nroot@5d305771d975:/# upt update\r\nbash: upt: command not found\r\nroot@5d305771d975:/# apt update\r\nGet:1 http://archive.ubuntu.com/ubuntu bionic InRelease [242 kB]\r\nGet:2 http://security.ubuntu.com/ubuntu bionic-security InRelease [88.7 kB]\r\nGet:3 http://security.ubuntu.com/ubuntu bionic-security/restricted amd64 Packages [324 kB]\r\nGet:4 http://archive.ubuntu.com/ubuntu bionic-updates InRelease [88.7 kB]\r\nGet:5 http://archive.ubuntu.com/ubuntu bionic-backports InRelease [74.6 kB]\r\nGet:6 http://archive.ubuntu.com/ubuntu bionic/restricted amd64 Packages [13.5 kB]\r\nGet:7 http://archive.ubuntu.com/ubuntu bionic/multiverse amd64 Packages [186 kB]\r\nGet:8 http://archive.ubuntu.com/ubuntu bionic/universe amd64 Packages [11.3 MB]\r\nGet:9 http://security.ubuntu.com/ubuntu bionic-security/universe amd64 Packages [1396 kB]\r\nGet:10 http://security.ubuntu.com/ubuntu bionic-security/main amd64 Packages [1963 kB]\r\nGet:11 http://security.ubuntu.com/ubuntu bionic-security/multiverse amd64 Packages [24.5 kB]\r\nGet:12 http://archive.ubuntu.com/ubuntu bionic/main amd64 Packages [1344 kB]\r\nGet:13 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 Packages [2163 kB]\r\nGet:14 http://archive.ubuntu.com/ubuntu bionic-updates/multiverse amd64 Packages [31.4 kB]\r\nGet:15 http://archive.ubuntu.com/ubuntu bionic-updates/restricted amd64 Packages [353 kB]\r\nGet:16 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 Packages [2394 kB]\r\nGet:17 http://archive.ubuntu.com/ubuntu bionic-backports/main amd64 Packages [11.3 kB]\r\nGet:18 http://archive.ubuntu.com/ubuntu bionic-backports/universe amd64 Packages [11.4 kB]\r\nFetched 22.0 MB in 3s (7071 kB/s)\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nAll packages are up to date.\r\nroot@5d305771d975:/# apt-get install -y apt-transport-https gnupg ca-certificates\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nThe following additional packages will be installed:\r\n  dirmngr gnupg-l10n gnupg-utils gpg gpg-agent gpg-wks-client gpg-wks-server gpgconf gpgsm libasn1-8-heimdal libassuan0 libgssapi3-heimdal\r\n  libhcrypto4-heimdal libheimbase1-heimdal libheimntlm0-heimdal libhx509-5-heimdal libkrb5-26-heimdal libksba8 libldap-2.4-2 libldap-common libnpth0\r\n  libreadline7 libroken18-heimdal libsasl2-2 libsasl2-modules libsasl2-modules-db libsqlite3-0 libssl1.1 libwind0-heimdal openssl pinentry-curses\r\n  readline-common\r\nSuggested packages:\r\n  dbus-user-session libpam-systemd pinentry-gnome3 tor parcimonie xloadimage scdaemon libsasl2-modules-gssapi-mit | libsasl2-modules-gssapi-heimdal\r\n  libsasl2-modules-ldap libsasl2-modules-otp libsasl2-modules-sql pinentry-doc readline-doc\r\nThe following NEW packages will be installed:\r\n  apt-transport-https ca-certificates dirmngr gnupg gnupg-l10n gnupg-utils gpg gpg-agent gpg-wks-client gpg-wks-server gpgconf gpgsm\r\n  libasn1-8-heimdal libassuan0 libgssapi3-heimdal libhcrypto4-heimdal libheimbase1-heimdal libheimntlm0-heimdal libhx509-5-heimdal libkrb5-26-heimdal\r\n  libksba8 libldap-2.4-2 libldap-common libnpth0 libreadline7 libroken18-heimdal libsasl2-2 libsasl2-modules libsasl2-modules-db libsqlite3-0\r\n  libssl1.1 libwind0-heimdal openssl pinentry-curses readline-common\r\n0 upgraded, 35 newly installed, 0 to remove and 0 not upgraded.\r\nNeed to get 5948 kB of archives.\r\nAfter this operation, 17.6 MB of additional disk space will be used.\r\nGet:1 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libssl1.1 amd64 1.1.1-1ubuntu2.1~18.04.8 [1301 kB]\r\nGet:2 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 openssl amd64 1.1.1-1ubuntu2.1~18.04.8 [614 kB]\r\nGet:3 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 ca-certificates all 20210119~18.04.1 [147 kB]\r\nGet:4 http://archive.ubuntu.com/ubuntu bionic/main amd64 readline-common all 7.0-3 [52.9 kB]\r\nGet:5 http://archive.ubuntu.com/ubuntu bionic/main amd64 libreadline7 amd64 7.0-3 [124 kB]\r\nGet:6 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libsqlite3-0 amd64 3.22.0-1ubuntu0.4 [499 kB]\r\nGet:7 http://archive.ubuntu.com/ubuntu bionic-updates/universe amd64 apt-transport-https all 1.6.12ubuntu0.2 [1696 B]\r\nGet:8 http://archive.ubuntu.com/ubuntu bionic/main amd64 libassuan0 amd64 2.5.1-2 [35.0 kB]\r\nGet:9 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 gpgconf amd64 2.2.4-1ubuntu1.4 [123 kB]\r\nGet:10 http://archive.ubuntu.com/ubuntu bionic/main amd64 libksba8 amd64 1.3.5-2 [92.6 kB]\r\nGet:11 http://archive.ubuntu.com/ubuntu bionic/main amd64 libroken18-heimdal amd64 7.5.0+dfsg-1 [41.3 kB]\r\nGet:12 http://archive.ubuntu.com/ubuntu bionic/main amd64 libasn1-8-heimdal amd64 7.5.0+dfsg-1 [175 kB]\r\nGet:13 http://archive.ubuntu.com/ubuntu bionic/main amd64 libheimbase1-heimdal amd64 7.5.0+dfsg-1 [29.3 kB]\r\nGet:14 http://archive.ubuntu.com/ubuntu bionic/main amd64 libhcrypto4-heimdal amd64 7.5.0+dfsg-1 [85.9 kB]\r\nGet:15 http://archive.ubuntu.com/ubuntu bionic/main amd64 libwind0-heimdal amd64 7.5.0+dfsg-1 [47.8 kB]\r\nGet:16 http://archive.ubuntu.com/ubuntu bionic/main amd64 libhx509-5-heimdal amd64 7.5.0+dfsg-1 [107 kB]\r\nGet:17 http://archive.ubuntu.com/ubuntu bionic/main amd64 libkrb5-26-heimdal amd64 7.5.0+dfsg-1 [206 kB]\r\nGet:18 http://archive.ubuntu.com/ubuntu bionic/main amd64 libheimntlm0-heimdal amd64 7.5.0+dfsg-1 [14.8 kB]\r\nGet:19 http://archive.ubuntu.com/ubuntu bionic/main amd64 libgssapi3-heimdal amd64 7.5.0+dfsg-1 [96.5 kB]\r\nGet:20 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libsasl2-modules-db amd64 2.1.27~101-g0780600+dfsg-3ubuntu2.3 [15.0 kB]\r\nGet:21 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libsasl2-2 amd64 2.1.27~101-g0780600+dfsg-3ubuntu2.3 [49.2 kB]\r\nGet:22 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libldap-common all 2.4.45+dfsg-1ubuntu1.10 [15.8 kB]\r\nGet:23 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libldap-2.4-2 amd64 2.4.45+dfsg-1ubuntu1.10 [154 kB]\r\nGet:24 http://archive.ubuntu.com/ubuntu bionic/main amd64 libnpth0 amd64 1.5-3 [7668 B]\r\nGet:25 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 dirmngr amd64 2.2.4-1ubuntu1.4 [316 kB]\r\nGet:26 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 gnupg-l10n all 2.2.4-1ubuntu1.4 [49.8 kB]\r\nGet:27 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 gnupg-utils amd64 2.2.4-1ubuntu1.4 [128 kB]\r\nGet:28 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 gpg amd64 2.2.4-1ubuntu1.4 [467 kB]\r\nGet:29 http://archive.ubuntu.com/ubuntu bionic/main amd64 pinentry-curses amd64 1.1.0-1 [35.8 kB]\r\nGet:30 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 gpg-agent amd64 2.2.4-1ubuntu1.4 [227 kB]\r\nGet:31 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 gpg-wks-client amd64 2.2.4-1ubuntu1.4 [91.8 kB]\r\nGet:32 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 gpg-wks-server amd64 2.2.4-1ubuntu1.4 [85.0 kB]\r\nGet:33 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 gpgsm amd64 2.2.4-1ubuntu1.4 [215 kB]\r\nGet:34 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 gnupg amd64 2.2.4-1ubuntu1.4 [249 kB]\r\nGet:35 http://archive.ubuntu.com/ubuntu bionic-updates/main amd64 libsasl2-modules amd64 2.1.27~101-g0780600+dfsg-3ubuntu2.3 [48.9 kB]\r\nFetched 5948 kB in 2s (3078 kB/s)\r\ndebconf: delaying package configuration, since apt-utils is not installed\r\nSelecting previously unselected package libssl1.1:amd64.\r\n(Reading database ... 4045 files and directories currently installed.)\r\nPreparing to unpack .../00-libssl1.1_1.1.1-1ubuntu2.1~18.04.8_amd64.deb ...\r\nUnpacking libssl1.1:amd64 (1.1.1-1ubuntu2.1~18.04.8) ...\r\nSelecting previously unselected package openssl.\r\nPreparing to unpack .../01-openssl_1.1.1-1ubuntu2.1~18.04.8_amd64.deb ...\r\nUnpacking openssl (1.1.1-1ubuntu2.1~18.04.8) ...\r\nSelecting previously unselected package ca-certificates.\r\nPreparing to unpack .../02-ca-certificates_20210119~18.04.1_all.deb ...\r\nUnpacking ca-certificates (20210119~18.04.1) ...\r\nSelecting previously unselected package readline-common.\r\nPreparing to unpack .../03-readline-common_7.0-3_all.deb ...\r\nUnpacking readline-common (7.0-3) ...\r\nSelecting previously unselected package libreadline7:amd64.\r\nPreparing to unpack .../04-libreadline7_7.0-3_amd64.deb ...\r\nUnpacking libreadline7:amd64 (7.0-3) ...\r\nSelecting previously unselected package libsqlite3-0:amd64.\r\nPreparing to unpack .../05-libsqlite3-0_3.22.0-1ubuntu0.4_amd64.deb ...\r\nUnpacking libsqlite3-0:amd64 (3.22.0-1ubuntu0.4) ...\r\nSelecting previously unselected package apt-transport-https.\r\nPreparing to unpack .../06-apt-transport-https_1.6.12ubuntu0.2_all.deb ...\r\nUnpacking apt-transport-https (1.6.12ubuntu0.2) ...\r\nSelecting previously unselected package libassuan0:amd64.\r\nPreparing to unpack .../07-libassuan0_2.5.1-2_amd64.deb ...\r\nUnpacking libassuan0:amd64 (2.5.1-2) ...\r\nSelecting previously unselected package gpgconf.\r\nPreparing to unpack .../08-gpgconf_2.2.4-1ubuntu1.4_amd64.deb ...\r\nUnpacking gpgconf (2.2.4-1ubuntu1.4) ...\r\nSelecting previously unselected package libksba8:amd64.\r\nPreparing to unpack .../09-libksba8_1.3.5-2_amd64.deb ...\r\nUnpacking libksba8:amd64 (1.3.5-2) ...\r\nSelecting previously unselected package libroken18-heimdal:amd64.\r\nPreparing to unpack .../10-libroken18-heimdal_7.5.0+dfsg-1_amd64.deb ...\r\nUnpacking libroken18-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSelecting previously unselected package libasn1-8-heimdal:amd64.\r\nPreparing to unpack .../11-libasn1-8-heimdal_7.5.0+dfsg-1_amd64.deb ...\r\nUnpacking libasn1-8-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSelecting previously unselected package libheimbase1-heimdal:amd64.\r\nPreparing to unpack .../12-libheimbase1-heimdal_7.5.0+dfsg-1_amd64.deb ...\r\nUnpacking libheimbase1-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSelecting previously unselected package libhcrypto4-heimdal:amd64.\r\nPreparing to unpack .../13-libhcrypto4-heimdal_7.5.0+dfsg-1_amd64.deb ...\r\nUnpacking libhcrypto4-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSelecting previously unselected package libwind0-heimdal:amd64.\r\nPreparing to unpack .../14-libwind0-heimdal_7.5.0+dfsg-1_amd64.deb ...\r\nUnpacking libwind0-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSelecting previously unselected package libhx509-5-heimdal:amd64.\r\nPreparing to unpack .../15-libhx509-5-heimdal_7.5.0+dfsg-1_amd64.deb ...\r\nUnpacking libhx509-5-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSelecting previously unselected package libkrb5-26-heimdal:amd64.\r\nPreparing to unpack .../16-libkrb5-26-heimdal_7.5.0+dfsg-1_amd64.deb ...\r\nUnpacking libkrb5-26-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSelecting previously unselected package libheimntlm0-heimdal:amd64.\r\nPreparing to unpack .../17-libheimntlm0-heimdal_7.5.0+dfsg-1_amd64.deb ...\r\nUnpacking libheimntlm0-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSelecting previously unselected package libgssapi3-heimdal:amd64.\r\nPreparing to unpack .../18-libgssapi3-heimdal_7.5.0+dfsg-1_amd64.deb ...\r\nUnpacking libgssapi3-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSelecting previously unselected package libsasl2-modules-db:amd64.\r\nPreparing to unpack .../19-libsasl2-modules-db_2.1.27~101-g0780600+dfsg-3ubuntu2.3_amd64.deb ...\r\nUnpacking libsasl2-modules-db:amd64 (2.1.27~101-g0780600+dfsg-3ubuntu2.3) ...\r\nSelecting previously unselected package libsasl2-2:amd64.\r\nPreparing to unpack .../20-libsasl2-2_2.1.27~101-g0780600+dfsg-3ubuntu2.3_amd64.deb ...\r\nUnpacking libsasl2-2:amd64 (2.1.27~101-g0780600+dfsg-3ubuntu2.3) ...\r\nSelecting previously unselected package libldap-common.\r\nPreparing to unpack .../21-libldap-common_2.4.45+dfsg-1ubuntu1.10_all.deb ...\r\nUnpacking libldap-common (2.4.45+dfsg-1ubuntu1.10) ...\r\nSelecting previously unselected package libldap-2.4-2:amd64.\r\nPreparing to unpack .../22-libldap-2.4-2_2.4.45+dfsg-1ubuntu1.10_amd64.deb ...\r\nUnpacking libldap-2.4-2:amd64 (2.4.45+dfsg-1ubuntu1.10) ...\r\nSelecting previously unselected package libnpth0:amd64.\r\nPreparing to unpack .../23-libnpth0_1.5-3_amd64.deb ...\r\nUnpacking libnpth0:amd64 (1.5-3) ...\r\nSelecting previously unselected package dirmngr.\r\nPreparing to unpack .../24-dirmngr_2.2.4-1ubuntu1.4_amd64.deb ...\r\nUnpacking dirmngr (2.2.4-1ubuntu1.4) ...\r\nSelecting previously unselected package gnupg-l10n.\r\nPreparing to unpack .../25-gnupg-l10n_2.2.4-1ubuntu1.4_all.deb ...\r\nUnpacking gnupg-l10n (2.2.4-1ubuntu1.4) ...\r\nSelecting previously unselected package gnupg-utils.\r\nPreparing to unpack .../26-gnupg-utils_2.2.4-1ubuntu1.4_amd64.deb ...\r\nUnpacking gnupg-utils (2.2.4-1ubuntu1.4) ...\r\nSelecting previously unselected package gpg.\r\nPreparing to unpack .../27-gpg_2.2.4-1ubuntu1.4_amd64.deb ...\r\nUnpacking gpg (2.2.4-1ubuntu1.4) ...\r\nSelecting previously unselected package pinentry-curses.\r\nPreparing to unpack .../28-pinentry-curses_1.1.0-1_amd64.deb ...\r\nUnpacking pinentry-curses (1.1.0-1) ...\r\nSelecting previously unselected package gpg-agent.\r\nPreparing to unpack .../29-gpg-agent_2.2.4-1ubuntu1.4_amd64.deb ...\r\nUnpacking gpg-agent (2.2.4-1ubuntu1.4) ...\r\nSelecting previously unselected package gpg-wks-client.\r\nPreparing to unpack .../30-gpg-wks-client_2.2.4-1ubuntu1.4_amd64.deb ...\r\nUnpacking gpg-wks-client (2.2.4-1ubuntu1.4) ...\r\nSelecting previously unselected package gpg-wks-server.\r\nPreparing to unpack .../31-gpg-wks-server_2.2.4-1ubuntu1.4_amd64.deb ...\r\nUnpacking gpg-wks-server (2.2.4-1ubuntu1.4) ...\r\nSelecting previously unselected package gpgsm.\r\nPreparing to unpack .../32-gpgsm_2.2.4-1ubuntu1.4_amd64.deb ...\r\nUnpacking gpgsm (2.2.4-1ubuntu1.4) ...\r\nSelecting previously unselected package gnupg.\r\nPreparing to unpack .../33-gnupg_2.2.4-1ubuntu1.4_amd64.deb ...\r\nUnpacking gnupg (2.2.4-1ubuntu1.4) ...\r\nSelecting previously unselected package libsasl2-modules:amd64.\r\nPreparing to unpack .../34-libsasl2-modules_2.1.27~101-g0780600+dfsg-3ubuntu2.3_amd64.deb ...\r\nUnpacking libsasl2-modules:amd64 (2.1.27~101-g0780600+dfsg-3ubuntu2.3) ...\r\nSetting up libnpth0:amd64 (1.5-3) ...\r\nSetting up readline-common (7.0-3) ...\r\nSetting up apt-transport-https (1.6.12ubuntu0.2) ...\r\nSetting up libldap-common (2.4.45+dfsg-1ubuntu1.10) ...\r\nSetting up libreadline7:amd64 (7.0-3) ...\r\nSetting up libsasl2-modules-db:amd64 (2.1.27~101-g0780600+dfsg-3ubuntu2.3) ...\r\nSetting up libsasl2-2:amd64 (2.1.27~101-g0780600+dfsg-3ubuntu2.3) ...\r\nSetting up libroken18-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSetting up libksba8:amd64 (1.3.5-2) ...\r\nSetting up gnupg-l10n (2.2.4-1ubuntu1.4) ...\r\nSetting up libssl1.1:amd64 (1.1.1-1ubuntu2.1~18.04.8) ...\r\ndebconf: unable to initialize frontend: Dialog\r\ndebconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 76.)\r\ndebconf: falling back to frontend: Readline\r\ndebconf: unable to initialize frontend: Readline\r\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.26.1 /usr/local/share/perl/5.26.1 /usr/lib/x86_64-linux-gnu/perl5/5.26 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.26 /usr/share/perl/5.26 /usr/local/lib/site_perl /usr/lib/x86_64-linux-gnu/perl-base) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7.)\r\ndebconf: falling back to frontend: Teletype\r\nSetting up libheimbase1-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSetting up openssl (1.1.1-1ubuntu2.1~18.04.8) ...\r\nSetting up libsqlite3-0:amd64 (3.22.0-1ubuntu0.4) ...\r\nSetting up libsasl2-modules:amd64 (2.1.27~101-g0780600+dfsg-3ubuntu2.3) ...\r\nSetting up ca-certificates (20210119~18.04.1) ...\r\ndebconf: unable to initialize frontend: Dialog\r\ndebconf: (No usable dialog-like program is installed, so the dialog based frontend cannot be used. at /usr/share/perl5/Debconf/FrontEnd/Dialog.pm line 76.)\r\ndebconf: falling back to frontend: Readline\r\ndebconf: unable to initialize frontend: Readline\r\ndebconf: (Can't locate Term/ReadLine.pm in @INC (you may need to install the Term::ReadLine module) (@INC contains: /etc/perl /usr/local/lib/x86_64-linux-gnu/perl/5.26.1 /usr/local/share/perl/5.26.1 /usr/lib/x86_64-linux-gnu/perl5/5.26 /usr/share/perl5 /usr/lib/x86_64-linux-gnu/perl/5.26 /usr/share/perl/5.26 /usr/local/lib/site_perl /usr/lib/x86_64-linux-gnu/perl-base) at /usr/share/perl5/Debconf/FrontEnd/Readline.pm line 7.)\r\ndebconf: falling back to frontend: Teletype\r\nUpdating certificates in /etc/ssl/certs...\r\n129 added, 0 removed; done.\r\nSetting up libassuan0:amd64 (2.5.1-2) ...\r\nSetting up libwind0-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSetting up libasn1-8-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSetting up gpgconf (2.2.4-1ubuntu1.4) ...\r\nSetting up libhcrypto4-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSetting up libhx509-5-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSetting up gpgsm (2.2.4-1ubuntu1.4) ...\r\nSetting up gnupg-utils (2.2.4-1ubuntu1.4) ...\r\nSetting up pinentry-curses (1.1.0-1) ...\r\nSetting up libkrb5-26-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSetting up libheimntlm0-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSetting up gpg (2.2.4-1ubuntu1.4) ...\r\nSetting up gpg-agent (2.2.4-1ubuntu1.4) ...\r\nSetting up gpg-wks-server (2.2.4-1ubuntu1.4) ...\r\nSetting up libgssapi3-heimdal:amd64 (7.5.0+dfsg-1) ...\r\nSetting up libldap-2.4-2:amd64 (2.4.45+dfsg-1ubuntu1.10) ...\r\nSetting up dirmngr (2.2.4-1ubuntu1.4) ...\r\nSetting up gpg-wks-client (2.2.4-1ubuntu1.4) ...\r\nSetting up gnupg (2.2.4-1ubuntu1.4) ...\r\nProcessing triggers for libc-bin (2.27-3ubuntu1.4) ...\r\nProcessing triggers for ca-certificates (20210119~18.04.1) ...\r\nUpdating certificates in /etc/ssl/certs...\r\n0 added, 0 removed; done.\r\nRunning hooks in /etc/ca-certificates/update.d...\r\ndone.\r\nroot@5d305771d975:/# echo \"deb https://apache.bintray.com/couchdb-deb bionic main\" | tee -a /etc/apt/sources.list.d/couchdb.list deb https://apache.bintray.com/couchdb-deb bionic main\r\ntee: 'https://apache.bintray.com/couchdb-deb': No such file or directory\r\ndeb https://apache.bintray.com/couchdb-deb bionic main\r\nroot@5d305771d975:/# echo \"deb https://apache.bintray.com/couchdb-deb bionic main\" | tee -a /etc/apt/sources.list.d/couchdb.list\r\ndeb https://apache.bintray.com/couchdb-deb bionic main\r\nroot@5d305771d975:/# apt-key adv --keyserver keyserver.ubuntu.com --recv-keys \\\r\n> 8756C4F765C9AC3CB6B85D62379CE192D401AB61\r\nExecuting: /tmp/apt-key-gpghome.6OjHIOpp1j/gpg.1.sh --keyserver keyserver.ubuntu.com --recv-keys 8756C4F765C9AC3CB6B85D62379CE192D401AB61\r\ngpg: keyserver receive failed: Connection timed out\r\nroot@5d305771d975:/# apt update\r\nHit:1 http://security.ubuntu.com/ubuntu bionic-security InRelease\r\nHit:2 http://archive.ubuntu.com/ubuntu bionic InRelease\r\nHit:3 http://archive.ubuntu.com/ubuntu bionic-updates InRelease\r\nHit:4 http://archive.ubuntu.com/ubuntu bionic-backports InRelease\r\nIgn:5 https://apache.bintray.com/couchdb-deb bionic InRelease\r\nGet:6 https://apache.bintray.com/couchdb-deb bionic Release [1840 B]\r\nGet:7 https://apache.bintray.com/couchdb-deb bionic Release.gpg [821 B]\r\nIgn:7 https://apache.bintray.com/couchdb-deb bionic Release.gpg\r\nReading package lists... Done\r\nW: GPG error: https://apache.bintray.com/couchdb-deb bionic Release: The following signatures couldn't be verified because the public key is not available: NO_PUBKEY 379CE192D401AB61\r\nE: The repository 'https://apache.bintray.com/couchdb-deb bionic Release' is not signed.\r\nN: Updating from such a repository can't be done securely, and is therefore disabled by default.\r\nN: See apt-secure(8) manpage for repository creation and user configuration details.\r\nW: Target Packages (main/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target Packages (main/binary-all/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nroot@5d305771d975:/# apt install -y couchdb\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nPackage couchdb is not available, but is referred to by another package.\r\nThis may mean that the package is missing, has been obsoleted, or\r\nis only available from another source\r\n\r\nW: Target Packages (main/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target Packages (main/binary-all/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nE: Package 'couchdb' has no installation candidate\r\nroot@5d305771d975:/# sudo apt clean\r\nbash: sudo: command not found\r\nroot@5d305771d975:/# exit\r\nexit\r\n$ sudo apt clean\r\n[sudo] password for devicfm:\r\n$ sudo apt autoclean\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nW: Target Packages (main/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target Packages (main/binary-all/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target Translations (main/i18n/Translation-en_US) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target Translations (main/i18n/Translation-en) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target CNF (main/cnf/Commands-amd64) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target CNF (main/cnf/Commands-all) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:2\r\nW: Target Packages (main/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target Packages (main/binary-all/Packages) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target Translations (main/i18n/Translation-en_US) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target Translations (main/i18n/Translation-en) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target CNF (main/cnf/Commands-amd64) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\nW: Target CNF (main/cnf/Commands-all) is configured multiple times in /etc/apt/sources.list.d/couchdb.list:1 and /etc/apt/sources.list.d/couchdb.list:3\r\n$ sudo rm /etc/apt/sources.list.d/couchdb.*\r\n$ sudo apt update\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nAll packages are up to date.\r\n$ sudo apt autoclean\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\n$ sudo apt clean\r\n$ sudo apt autoclean\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\n$ sudo apt-get update && sudo apt-get install couchdb\r\nReading package lists... Done\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\n\r\nNo apt package \"couchdb\", but there is a snap with that name.\r\nTry \"snap install couchdb\"\r\n\r\nE: Unable to locate package couchdb\r\n$ snap install couchdb\r\nerror: access denied (try with sudo)\r\n$ sudo snap install couchdb\r\ncouchdb 2.3.1 from Apache CouchDB installed\r\n$\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791011003/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791066460","html_url":"https://github.com/apache/couchdb/issues/3403#issuecomment-791066460","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3403","id":791066460,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTA2NjQ2MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-05T01:04:14Z","updated_at":"2021-03-05T01:05:00Z","author_association":"MEMBER","body":"Not sure what your issue is. We've had CouchDB binary packages for 2.x since 2018. Download statistics indicate many hundreds of thousands of successful installs.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791066460/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791128986","html_url":"https://github.com/apache/couchdb/pull/3402#issuecomment-791128986","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3402","id":791128986,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTEyODk4Ng==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-05T03:40:33Z","updated_at":"2021-03-05T03:40:33Z","author_association":"CONTRIBUTOR","body":"Agree with @wohali. In general it seems if FDB connection  is not up, there is not much use in knowing the node / pod / container is up. Maybe there is the idea that the node would be brought up first then later configured via _config somehow? But the backend as is, won't do that it will just endlessly crash with timeouts.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791128986/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791311320","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-791311320","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":791311320,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTMxMTMyMA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-05T09:58:16Z","updated_at":"2021-03-05T09:58:16Z","author_association":"MEMBER","body":"the arm build seem to be failing again with the OP error message, so Jenkins doesn’t go all the way to the Mac build.\r\n\r\nThe fix in couchdb-erlfdb fix https://github.com/apache/couchdb-erlfdb/commit/c25d52470576fb210d5e3acc98e2cd0da33a397c#diff-427d8ddce21ccc4fae24fb547c7a82c2a793ed57208d8343e519e0aec8119ff7 should also have fixed things on Mac.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791311320/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791580265","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-791580265","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":791580265,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTU4MDI2NQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-05T17:50:26Z","updated_at":"2021-03-05T17:50:26Z","author_association":"MEMBER","body":"Thanks @janl !\r\n\r\nLooks like a minor naming mistake in `couchdb-ci/build.sh` prevented the arm and ppc images from getting pushed to docker hub correctly. I'm rebuilding the containers now, just to freshen them, pushing, and that should get us back in business.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791580265/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791627389","html_url":"https://github.com/apache/couchdb/issues/3381#issuecomment-791627389","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3381","id":791627389,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTYyNzM4OQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-05T19:19:13Z","updated_at":"2021-03-05T19:19:13Z","author_association":"CONTRIBUTOR","body":"The results of some experiments.\r\n\r\nSo playing around by saving the indexer GRV then attempting to read the view at that version we get write conflicts  in ebtree with continuous retries. The reason for that is indexer GRV does not have any of the written indexed data yet. (This is the version it read the docs and the change feed from, but it won't have any of the indexing data associated with those changes). So ebtrees are empty, and it turns out, if they are empty when we read them ebtrees end up [writing](https://github.com/apache/couchdb/blob/main/src/ebtree/src/ebtree.erl#L107-L109) (!) resulting in conflicts. Our transaction closure retries, and since it sets the same stale GRV again, it conflicts and then the cycle repeats. (Should we have a version of `ebtree:open` that is `read_only`? It might be nice to be able to assert that reading a view would only perform reads and not any unexpected writes...)\r\n\r\nAnother idea is to use the committed version of the indexer. After a transaction has committed we can retrieve the [committed version](https://apple.github.io/foundationdb/api-c.html#c.fdb_transaction_get_committed_version), then update the job progress in a separate transaction when we [finalize everything](https://github.com/apache/couchdb/blob/main/src/couch_views/src/couch_views_indexer.erl#L248). That wouldn't always work either, since a doc could have been updated while the indexing transaction was running. Since we are using snapshots to limit the number of conflicts in the indexer, do_update function will commit, but any reads of that document after the committed version might have a different doc revision.\r\n\r\nIdeally we should read the indexed data at the committed version, but the doc bodies at the indexer GRV version. It is currently not trivial to run multiple transactions from the same process since we use the pdict to keep some state. We still could spawn a separate process running at the indexer GRV just to fetch doc bodies while the view data is read at  the current GRV. That should work, I think...\r\n\r\nHowever, another issue might be that in case the indexer has batched up the indexing in more than one transaction we may not be able to the exact doc bodies from a few transactions previous to the last one. So it seems it would be at most a best effort to see updates from the last transaction which reported its progress in the couch_jobs data.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791627389/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791635970","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-791635970","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":791635970,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTYzNTk3MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-05T19:36:10Z","updated_at":"2021-03-05T19:36:10Z","author_association":"MEMBER","body":"OK, as it turns out, Apple don't provide packages for fdb on anything but x86_64 for Linux, so I had to add support for building that from scratch. That's building now (it's sloooowwwww). Once it's done I'll push a new arm64v8 container and the jobs should start passing. Note that as we don't have any ppc64le workers, I didn't bother rebuilding that image.\r\n\r\nFor those interested in how all this gubbins works, there is a job in Jenkins called \"Update Docker Containers\" that runs on all of the nodes and pulls the latest docker container every 24h. I've just updated it to also pull all the containers on arm and ppc (if workers ever come back.)  If you have to push a new container and want it working _now_, just run the job by hand.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791635970/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791640122","html_url":"https://github.com/apache/couchdb/issues/3381#issuecomment-791640122","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3381","id":791640122,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTY0MDEyMg==","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-05T19:44:40Z","updated_at":"2021-03-05T19:44:40Z","author_association":"MEMBER","body":"Reprising our Slack conversation:\r\n\r\n> Ideally we should read the indexed data at the committed version, but the doc bodies at the indexer GRV version.\r\n\r\nYes, this is exactly the right thing to do to achieve consistency between the view and the reads of the underlying DB.\r\n\r\n> However, another issue might be that in case the indexer has batched up the indexing in more than one transaction we may not be able to the exact doc bodies from a few transactions previous to the last one.\r\n\r\nThis is the big reason why it's important to advance the target `DbSeq` during each additional transactional batch of an indexing job. Advancing the sequence will ensure that once the indexer finally catches up, it will have observed all the latest versions of all documents associated with the last read version it acquired.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791640122/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791765762","html_url":"https://github.com/apache/couchdb/issues/3399#issuecomment-791765762","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3399","id":791765762,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTc2NTc2Mg==","user":{"login":"dch","id":284368,"node_id":"MDQ6VXNlcjI4NDM2OA==","avatar_url":"https://avatars.githubusercontent.com/u/284368?v=4","gravatar_id":"","url":"https://api.github.com/users/dch","html_url":"https://github.com/dch","followers_url":"https://api.github.com/users/dch/followers","following_url":"https://api.github.com/users/dch/following{/other_user}","gists_url":"https://api.github.com/users/dch/gists{/gist_id}","starred_url":"https://api.github.com/users/dch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dch/subscriptions","organizations_url":"https://api.github.com/users/dch/orgs","repos_url":"https://api.github.com/users/dch/repos","events_url":"https://api.github.com/users/dch/events{/privacy}","received_events_url":"https://api.github.com/users/dch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-05T22:39:18Z","updated_at":"2021-03-05T22:40:00Z","author_association":"CONTRIBUTOR","body":"IIRC since ~ FDB 6.3, I switched ports to use the cmake-derived build, and the headers are since fixed. It wasn't possible in the previous 6.2.x series.\r\n\r\nhttps://svnweb.freebsd.org/ports?view=revision&revision=537449 from 31 May, which is in 2020Q3\r\nat least. Is it possible the builders aren't updated?\r\n\r\nFWIW the current diff of installed files between 6.3.11 and 7.0.0-mumble-git-sha is:\r\n\r\n```diff\r\ndch@wintermute /u/p/databases> diff /tmp/fdb /tmp/devel\r\n26,29c26,28\r\n< /usr/local/lib/libthirdparty.a\r\n< /usr/local/share/licenses/foundationdb-6.3.11/APACHE20\r\n< /usr/local/share/licenses/foundationdb-6.3.11/LICENSE\r\n< /usr/local/share/licenses/foundationdb-6.3.11/catalog.mk\r\n---\r\n> /usr/local/share/licenses/foundationdb-devel-7.0.0.a.20210224/APACHE20\r\n> /usr/local/share/licenses/foundationdb-devel-7.0.0.a.20210224/LICENSE\r\n> /usr/local/share/licenses/foundationdb-devel-7.0.0.a.20210224/catalog.mk\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791765762/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791798642","html_url":"https://github.com/apache/couchdb/issues/3399#issuecomment-791798642","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3399","id":791798642,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTc5ODY0Mg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-05T23:56:11Z","updated_at":"2021-03-05T23:56:11Z","author_association":"MEMBER","body":"@dch OK, I've removed the `foundationdb-devel` package and it just has `foundationdb` now, which is currently 6.3.9.\r\n\r\nThis makes couchdb compile but it still fails on `gmake check`:\r\n\r\n```\r\ngmake[1]: Entering directory '/root/couchdb'\r\n==> chttpd (compile)\r\n==> couch_eval (compile)\r\n==> couch_replicator (compile)\r\n==> couch_views (compile)\r\n==> ctrace (compile)\r\n==> fabric (compile)\r\n==> couch_jobs (compile)\r\n==> couch_expiring_cache (compile)\r\n==> mango (compile)\r\n==> rel (compile)\r\n==> couchdb (compile)\r\n==> couchdb (setup_eunit)\r\nWriting tmp/etc/default_eunit.ini\r\nWriting tmp/etc/local_eunit.ini\r\nWriting tmp/etc/eunit.ini\r\nWriting tmp/etc/vm.args\r\n==> couch_eval (eunit)\r\nCompiled src/couch_eval.erl\r\n======================== EUnit ========================\r\nmodule 'couch_eval'\r\n  There were no tests to run.\r\nCover analysis: /root/couchdb/src/couch_eval/.eunit/index.html\r\n\r\nCode Coverage:\r\ncouch_eval :   0%\r\n\r\nTotal      : 0%\r\n==> rel (eunit)\r\n==> couchdb (eunit)\r\n==> couch_expiring_cache (eunit)\r\nCompiled src/couch_expiring_cache.erl\r\nCompiled src/couch_expiring_cache_server.erl\r\nCompiled src/couch_expiring_cache_fdb.erl\r\nCompiled test/couch_expiring_cache_tests.erl\r\n======================== EUnit ========================\r\nmodule 'couch_expiring_cache_server'\r\nmodule 'couch_expiring_cache'\r\n  module 'couch_expiring_cache_tests'\r\n    Test expiring cache basics\r\nCannot start application 'fabric', reason {{shutdown,\r\n                                            {failed_to_start_child,\r\n                                             fabric2_server,\r\n                                             {fdbserver_bin_not_found,\r\n                                              [{erlfdb_util,\r\n                                                find_fdbserver_bin,1,\r\n                                                [{file,\"src/erlfdb_util.erl\"},\r\n                                                 {line,188}]},\r\n                                               {erlfdb_util,\r\n                                                init_test_cluster_int,1,\r\n                                                [{file,\"src/erlfdb_util.erl\"},\r\n                                                 {line,115}]},\r\n                                               {erlfdb_util,get_test_db,1,\r\n                                                [{file,\"src/erlfdb_util.erl\"},\r\n                                                 {line,37}]},\r\n                                               {fabric2_server,\r\n                                                get_db_and_cluster,1,\r\n                                                [{file,\r\n                                                  \"src/fabric2_server.erl\"},\r\n                                                 {line,213}]},\r\n                                               {fabric2_server,init,1,\r\n                                                [{file,\r\n                                                  \"src/fabric2_server.erl\"},\r\n                                                 {line,133}]},\r\n                                               {gen_server,init_it,2,\r\n                                                [{file,\"gen_server.erl\"},\r\n                                                 {line,374}]},\r\n                                               {gen_server,init_it,6,\r\n                                                [{file,\"gen_server.erl\"},\r\n                                                 {line,342}]},\r\n                                               {proc_lib,init_p_do_apply,3,\r\n                                                [{file,\"proc_lib.erl\"},\r\n                                                 {line,249}]}]}}},\r\n                                           {fabric2_app,start,[normal,[]]}}\r\n      *** context setup failed ***\r\n**in function test_util:start_applications/2 (src/test_util.erl, line 109)\r\nin call from test_util:start_couch/2 (src/test_util.erl, line 79)\r\n**throw:{error,\r\n    {cannot_start,fabric,\r\n        {{shutdown,\r\n             {failed_to_start_child,fabric2_server,\r\n                 {fdbserver_bin_not_found,\r\n                     [{erlfdb_util,find_fdbserver_bin,1,[{...}|...]},\r\n                      {erlfdb_util,init_test_cluster_int,1,[...]},\r\n                      {erlfdb_util,get_test_db,1,...},\r\n                      {fabric2_server,get_db_and_cluster,...},\r\n                      {fabric2_server,...},\r\n                      {...}|...]}}},\r\n         {fabric2_app,start,[normal,[]]}}}}\r\n\r\n\r\n    [done in 3.427 s]\r\n  [done in 3.427 s]\r\nmodule 'couch_expiring_cache_fdb'\r\n=======================================================\r\n  Failed: 0.  Skipped: 0.  Passed: 0.\r\nOne or more tests were cancelled.\r\nCover analysis: /root/couchdb/src/couch_expiring_cache/.eunit/index.html\r\n\r\nCode Coverage:\r\ncouch_expiring_cache        :   0%\r\ncouch_expiring_cache_fdb    :   0%\r\ncouch_expiring_cache_server :   0%\r\n\r\nTotal                       : 0%\r\nERROR: One or more eunit tests failed.\r\nERROR: eunit failed while processing /root/couchdb/src/couch_expiring_cache: rebar_abort\r\ngmake[1]: *** [Makefile:176: eunit] Error 1\r\ngmake[1]: Leaving directory '/root/couchdb'\r\ngmake: *** [Makefile:163: check] Error 2\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791798642/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791798887","html_url":"https://github.com/apache/couchdb/issues/3381#issuecomment-791798887","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3381","id":791798887,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTc5ODg4Nw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-05T23:57:16Z","updated_at":"2021-03-05T23:57:16Z","author_association":"CONTRIBUTOR","body":"I updated the PR https://github.com/apache/couchdb/pull/3391 to:\r\n\r\n - Save both the GRV and the committed version of the indexer\r\n - When the view is emitted to make sure to set the view data to be read from the committed version\r\n - For emitting the included docs a separate process is started which will emit docs from indexer's GRV snapshot\r\n\r\nStill WIP. The thing compiles but the one commented test still times out. Also we may need to adjust the view indexer to commit more often to avoid the indexer GRV timing out (it was kept alive since the indexer had started emitted data so it could be almost expiring by the time the view reader gets to it).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791798887/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791894962","html_url":"https://github.com/apache/couchdb/issues/3381#issuecomment-791894962","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3381","id":791894962,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MTg5NDk2Mg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-06T08:23:48Z","updated_at":"2021-03-06T08:23:48Z","author_association":"CONTRIBUTOR","body":"Cleaned up https://github.com/apache/couchdb/pull/3391 a bit and it now passes all the couch_views tests, including a new test which checks that the indexer GRV and the committed version work.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/791894962/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792223422","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-792223422","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":792223422,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MjIyMzQyMg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-07T06:01:40Z","updated_at":"2021-03-07T06:01:40Z","author_association":"MEMBER","body":"Update: fdbserver/fdbcli won't run inside of a cross-arch docker container, with the same error as https://forums.foundationdb.org/t/foundationdb-does-not-run-on-windows-subsystem-for-linux-wsl/809/10 . This causes a problem on install of the program, which I'm doing after building its package. It tries to run `fdbcli` and fails.\r\n\r\nI've worked around this with a `|| true` in the build script.\r\n\r\nI tested the docker container on our `arm64v8` worker, and it works, so I'm completing the automated build overnight and will push the image in the morning. At that point, we should be building `main` on all available secondary platforms again - Linux arm64v8, macOS, FreeBSD.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792223422/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792223865","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-792223865","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":792223865,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MjIyMzg2NQ==","user":{"login":"BillStephenson","id":7811473,"node_id":"MDQ6VXNlcjc4MTE0NzM=","avatar_url":"https://avatars.githubusercontent.com/u/7811473?v=4","gravatar_id":"","url":"https://api.github.com/users/BillStephenson","html_url":"https://github.com/BillStephenson","followers_url":"https://api.github.com/users/BillStephenson/followers","following_url":"https://api.github.com/users/BillStephenson/following{/other_user}","gists_url":"https://api.github.com/users/BillStephenson/gists{/gist_id}","starred_url":"https://api.github.com/users/BillStephenson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BillStephenson/subscriptions","organizations_url":"https://api.github.com/users/BillStephenson/orgs","repos_url":"https://api.github.com/users/BillStephenson/repos","events_url":"https://api.github.com/users/BillStephenson/events{/privacy}","received_events_url":"https://api.github.com/users/BillStephenson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-07T06:06:20Z","updated_at":"2021-03-07T07:01:52Z","author_association":"NONE","body":"Does this mean it could run on a Raspberry Pi 4?\n\nCuz that would be really cool :D\n\n—\n\nBill Stephenson\n\n\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792223865/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792225099","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-792225099","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":792225099,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MjIyNTA5OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-07T06:19:46Z","updated_at":"2021-03-07T07:02:01Z","author_association":"MEMBER","body":"CouchDB 3.x already does, and packages (that run under Raspbian) have been available for at least a year now.\r\n\r\nThis is specifically talking about `main`, aka future CouchDB 4.0, which is not yet released.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792225099/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792225871","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-792225871","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":792225871,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MjIyNTg3MQ==","user":{"login":"BillStephenson","id":7811473,"node_id":"MDQ6VXNlcjc4MTE0NzM=","avatar_url":"https://avatars.githubusercontent.com/u/7811473?v=4","gravatar_id":"","url":"https://api.github.com/users/BillStephenson","html_url":"https://github.com/BillStephenson","followers_url":"https://api.github.com/users/BillStephenson/followers","following_url":"https://api.github.com/users/BillStephenson/following{/other_user}","gists_url":"https://api.github.com/users/BillStephenson/gists{/gist_id}","starred_url":"https://api.github.com/users/BillStephenson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BillStephenson/subscriptions","organizations_url":"https://api.github.com/users/BillStephenson/orgs","repos_url":"https://api.github.com/users/BillStephenson/repos","events_url":"https://api.github.com/users/BillStephenson/events{/privacy}","received_events_url":"https://api.github.com/users/BillStephenson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-07T06:26:20Z","updated_at":"2021-03-07T07:02:07Z","author_association":"NONE","body":"I was under the impression that CouchDB wouldn’t run on the new “Pi 4 8GB” because it uses an ARM chip (or something like that). \n\nIt still runs on a P3 though and they’re still selling them so that’s good.\n\n— \n\nBill\n\n> On Mar 7, 2021, at 12:19 AM, Joan Touzet <notifications@github.com> wrote:\n> \n> \n> CouchDB 3.x already does, and packages (that run under Raspbian) have been available for at least a year now.\n> \n> This is specifically talking about main, aka future CouchDB 4.0, which is not yet released.\n> \n> —\n> You are receiving this because you commented.\n> Reply to this email directly, view it on GitHub <https://github.com/apache/couchdb/issues/3394#issuecomment-792225099>, or unsubscribe <https://github.com/notifications/unsubscribe-auth/AB3TDEK6MCE22T4TIIRI5RDTCMLI3ANCNFSM4YPGWJPQ>.\n> \n\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792225871/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792228206","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-792228206","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":792228206,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MjIyODIwNg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-07T06:50:04Z","updated_at":"2021-03-07T07:02:13Z","author_association":"MEMBER","body":"This isn't the ticket for this, but the new Raspberry Pis are `arm64v8` which is directly supported by our binary packages.\r\n\r\nRaspberry Pi 1 and 2 are 32-bit `armhf`, and will run CouchDB, but not from our prebuilt packages.\r\n\r\nRaspberry Pi 3 ships as `armhf` but can be set up to run as `arm64v8,` but is unsupported. I believe our packages will run in these reconfigured machines, but it is untested.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792228206/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792228645","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-792228645","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":792228645,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MjIyODY0NQ==","user":{"login":"BillStephenson","id":7811473,"node_id":"MDQ6VXNlcjc4MTE0NzM=","avatar_url":"https://avatars.githubusercontent.com/u/7811473?v=4","gravatar_id":"","url":"https://api.github.com/users/BillStephenson","html_url":"https://github.com/BillStephenson","followers_url":"https://api.github.com/users/BillStephenson/followers","following_url":"https://api.github.com/users/BillStephenson/following{/other_user}","gists_url":"https://api.github.com/users/BillStephenson/gists{/gist_id}","starred_url":"https://api.github.com/users/BillStephenson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/BillStephenson/subscriptions","organizations_url":"https://api.github.com/users/BillStephenson/orgs","repos_url":"https://api.github.com/users/BillStephenson/repos","events_url":"https://api.github.com/users/BillStephenson/events{/privacy}","received_events_url":"https://api.github.com/users/BillStephenson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-07T06:54:24Z","updated_at":"2021-03-07T07:02:20Z","author_association":"NONE","body":"Wow… that is awesome. I’ve obviously not kept up\n\nThank You! \n\n\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792228645/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792353477","html_url":"https://github.com/apache/couchdb/pull/3404#issuecomment-792353477","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3404","id":792353477,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MjM1MzQ3Nw==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-07T21:08:23Z","updated_at":"2021-03-07T21:10:25Z","author_association":"MEMBER","body":"Thank you for the review, @jjrodrig . Great comments! Please let me know if I've missed anything.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792353477/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792356869","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-792356869","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":792356869,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MjM1Njg2OQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-07T21:31:21Z","updated_at":"2021-03-07T21:31:21Z","author_association":"MEMBER","body":"> I'm completing the automated build overnight and will push the image in the morning. At that point, we should be building `main` on all available secondary platforms again - Linux arm64v8, macOS, FreeBSD.\r\n\r\nThank you, @wohali !","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/792356869/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/793013551","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-793013551","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":793013551,"node_id":"MDEyOklzc3VlQ29tbWVudDc5MzAxMzU1MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-08T19:29:05Z","updated_at":"2021-03-08T19:29:05Z","author_association":"MEMBER","body":"@bessbd OK, so all of the _technical_ limitations to CI on `main` have been lifted. Now, we need some code fixes.\r\n\r\nWould you be willing to start here?\r\n\r\n```\r\nhttps://ci-couchdb.apache.org/blue/organizations/jenkins/jenkins-cm1%2FFullPlatformMatrix/detail/main/70/pipeline/252#step-253-log-186\r\n```\r\n\r\nI imagine there will be more. If you'd like to dig thru them yourself, I recommend following along in `Jenkinsfile.full`, pulling down each Docker container, and going through the build process, including the packaging steps. Obviously the packages are going to need updating for 4.x, but it can't hurt to get started on them now. And I sure would appreciate the help!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/793013551/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794110526","html_url":"https://github.com/apache/couchdb/issues/3410#issuecomment-794110526","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3410","id":794110526,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDExMDUyNg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T16:18:29Z","updated_at":"2021-03-09T16:18:29Z","author_association":"MEMBER","body":"Can you share, for the database you believe isn't being compacted correctly, the per-shard info? You can retrieve this with, for a given node, `GET /_node/<node-name>/_dbs` to find the shard names, then `GET /_node/<node-name>/<shard-name>`\r\n\r\nWhat we want is the sizes object: `\"sizes\":{\"file\":49361,\"external\":2379,\"active\":3796}`\r\n\r\nIt would also help to turn logging up on your CouchDB instance to at least notice level, and show the debug output from Smoosh, as [logged here](https://github.com/apache/couchdb/blob/main/src/smoosh/src/smoosh_channel.erl#L202-L207). This will tell us if smoosh is trying to compact your databases or not.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794110526/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794200227","html_url":"https://github.com/apache/couchdb/pull/3380#issuecomment-794200227","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3380","id":794200227,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDIwMDIyNw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T17:28:38Z","updated_at":"2021-03-09T17:28:38Z","author_association":"MEMBER","body":"I don't understand these;\r\n\r\n```\r\nformat_status(normal, [_PDict, State]) ->\r\n    [{data, [{\"State\", State}]}];\r\n\r\nformat_status(terminate, [PDict, State]) ->\r\n    {State, #{module => ?MODULE, dictionary => PDict}}.\r\n```\r\n\r\nWhy so many conversions to map?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794200227/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794215510","html_url":"https://github.com/apache/couchdb/pull/3380#issuecomment-794215510","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3380","id":794215510,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDIxNTUxMA==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T17:40:41Z","updated_at":"2021-03-09T17:40:41Z","author_association":"CONTRIBUTOR","body":"> I don't understand these;\r\n> \r\n> ```\r\n> format_status(normal, [_PDict, State]) ->\r\n>     [{data, [{\"State\", State}]}];\r\n> \r\n> format_status(terminate, [PDict, State]) ->\r\n>     {State, #{module => ?MODULE, dictionary => PDict}}.\r\n> ```\r\n> \r\n> Why so many conversions to map?\r\n\r\nThere is no conversion to map for the state of the `gen_server`. The state is returned as is. The only thing I do here is return additional context. I.e. return `{State, Ctx}` instead of `State`. Then the `couch_log_formatter` passes the Ctx to plug-able sanitizer module. If `sanitizer` is not specified `Ctx` is not used or logged. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794215510/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794224328","html_url":"https://github.com/apache/couchdb/pull/3380#issuecomment-794224328","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3380","id":794224328,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDIyNDMyOA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T17:47:55Z","updated_at":"2021-03-09T17:47:55Z","author_association":"MEMBER","body":"I am very uncomfortable to see that pattern cut and paste so many times, it strongly implies a bad design. I think I see how you got here though.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794224328/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794226815","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-794226815","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":794226815,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDIyNjgxNQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T17:49:58Z","updated_at":"2021-03-09T17:49:58Z","author_association":"MEMBER","body":"> @bessbd OK, so all of the _technical_ limitations to CI on `main` have been lifted. Now, we need some code fixes.\r\n> \r\n> Would you be willing to start here?\r\n> \r\n> ```\r\n> https://ci-couchdb.apache.org/blue/organizations/jenkins/jenkins-cm1%2FFullPlatformMatrix/detail/main/70/pipeline/252#step-253-log-186\r\n> ```\r\n> \r\n> I imagine there will be more. If you'd like to dig thru them yourself, I recommend following along in `Jenkinsfile.full`, pulling down each Docker container, and going through the build process, including the packaging steps. Obviously the packages are going to need updating for 4.x, but it can't hurt to get started on them now. And I sure would appreciate the help!\r\n\r\nOn it! So far I haven't been able to reproduce the issue you've mentioned. (But I was trying it native. I'll try with docker next.)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794226815/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794227209","html_url":"https://github.com/apache/couchdb/pull/3380#issuecomment-794227209","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3380","id":794227209,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDIyNzIwOQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T17:50:18Z","updated_at":"2021-03-09T17:50:18Z","author_association":"MEMBER","body":"we also can't use the ableist slur \"sanitize\" but that's a mechanical change (\"scrub\" perhaps?). will ponder if the boilerplating can be reduced/removed (my concern is not just the duplication but also the deviation from OTP and the need to remember to do this for every new gen_server).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794227209/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794229537","html_url":"https://github.com/apache/couchdb/pull/3380#issuecomment-794229537","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3380","id":794229537,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDIyOTUzNw==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T17:52:13Z","updated_at":"2021-03-09T17:52:13Z","author_association":"CONTRIBUTOR","body":"The alternative to `map()` for the `Ctx` is a KV list. However map is superior because it can be matched in the function clause. The KV list preserve the order of elements so cannot be matched against. Which simplify dispatch in couch_log_formatter and sanitizer module.\r\n\r\n```\r\nformat_status(terminate, [PDict, State]) ->\r\n    {State, #{module => ?MODULE, dictionary => PDict}}.\r\n    \r\nsanitizer:sanitize_state(State, #{module := couch_server}) ->\r\n    ....;\r\nsanitizer:sanitize_state(State, #{module := smoosh_server}) ->\r\n    ....;\r\n```\r\n\r\ncompared to\r\n```\r\nformat_status(terminate, [PDict, State]) ->\r\n    {State, [{module, ?MODULE}, {dictionary, PDict}]}.\r\n    \r\nsanitizer:sanitize_state(State, Ctx) ->\r\n    Module = case lists:keyfind(module, 1, Ctx) -> of\r\n        {module, M} -> M;\r\n        false -> undefined\r\n     end,\r\n    PDict = case lists:keyfind(dictionary, 1, Ctx) -> of\r\n        {dictionary, D} -> D;\r\n        false -> []\r\n     end,\r\n     sanitize_state(State, Module, PDict).\r\n     \r\nsanitizer:sanitize_state(State, smoosh_server, PDict) ->\r\n    ....;\r\n\r\nsanitizer:sanitize_state(State, couch_server, PDict) ->\r\n    ....;\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794229537/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794231957","html_url":"https://github.com/apache/couchdb/pull/3380#issuecomment-794231957","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3380","id":794231957,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDIzMTk1Nw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T17:54:08Z","updated_at":"2021-03-09T17:54:08Z","author_association":"MEMBER","body":"now you've explained I'm fine with the \"context\" item being a map. What's really awkward is having to alter every gen_server in an identical way in order to pass it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794231957/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794235753","html_url":"https://github.com/apache/couchdb/pull/3380#issuecomment-794235753","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3380","id":794235753,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDIzNTc1Mw==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T17:57:14Z","updated_at":"2021-03-09T17:57:14Z","author_association":"CONTRIBUTOR","body":"> I am very uncomfortable to see that pattern cut and paste so many times, it strongly implies a bad design. I think I see how you got here though.\r\n\r\nThe alternative is a common module somewhere.\r\n\r\n```\r\nformat_status(terminate, [PDict, State]) ->\r\n      Scrubed = ...\r\n      some_module:format_status(Scrubbed, PDict).\r\n```\r\n\r\nHowever the gen_servers we update are in different applications. We don't have an application which is included in all the others. I could create a new app which would hold the module. This app would be only for utility functions and couldn't depend on other apps to avoid circular dependencies.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794235753/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794236398","html_url":"https://github.com/apache/couchdb/pull/3380#issuecomment-794236398","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3380","id":794236398,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDIzNjM5OA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T17:57:47Z","updated_at":"2021-03-09T17:57:47Z","author_association":"MEMBER","body":"could this be done with a parse transform? When we used lager it added a parse transform (https://github.com/apache/couchdb-lager/blob/master/src/lager_transform.erl) which captures module name among other things.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794236398/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794238836","html_url":"https://github.com/apache/couchdb/pull/3380#issuecomment-794238836","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3380","id":794238836,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDIzODgzNg==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T17:59:49Z","updated_at":"2021-03-09T17:59:49Z","author_association":"CONTRIBUTOR","body":"In fact my first take on this problem was a parse transform. The problem with this approach is use of `rebar`. Rebar has bugs the parse transform configured in main application is not passed to included application for umbrella apps. We would have to update `rebar.config` for each app we include.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794238836/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794243457","html_url":"https://github.com/apache/couchdb/pull/3380#issuecomment-794243457","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3380","id":794243457,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDI0MzQ1Nw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T18:03:36Z","updated_at":"2021-03-09T18:03:36Z","author_association":"MEMBER","body":"changing all the rebar.configs seems ok, and would have the advantage that any new gen_servers are automatically covered. Did you show the parse_transform version? I've lost track.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794243457/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794313274","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-794313274","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":794313274,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDMxMzI3NA==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T19:01:59Z","updated_at":"2021-03-09T19:01:59Z","author_association":"MEMBER","body":"Ok, I haven't been able to reproduce this locally with docker either. Any suggestions?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794313274/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794316354","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-794316354","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":794316354,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDMxNjM1NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T19:04:04Z","updated_at":"2021-03-09T19:04:04Z","author_association":"MEMBER","body":"@bessbd Which Docker container did you use? The failure is during the *packaging build*, not the regular build/test, for Ubuntu Bionic, `couchdbdev/ubuntu-bionic-erlang-20.3.8.25-1:latest`.\r\n\r\nNote that it is just using `-Wall` so you can probably reproduce this yourself.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794316354/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794327252","html_url":"https://github.com/apache/couchdb/pull/3380#issuecomment-794327252","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3380","id":794327252,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDMyNzI1Mg==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T19:13:41Z","updated_at":"2021-03-09T19:13:41Z","author_association":"CONTRIBUTOR","body":"> Did you show the parse_transform version? I've lost track.\r\n\r\nI didn't","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794327252/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794335136","html_url":"https://github.com/apache/couchdb/issues/3394#issuecomment-794335136","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3394","id":794335136,"node_id":"MDEyOklzc3VlQ29tbWVudDc5NDMzNTEzNg==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-09T19:20:21Z","updated_at":"2021-03-09T19:26:24Z","author_association":"MEMBER","body":"I was doing a `docker run -u root -it  couchdbdev/ubuntu-bionic-erlang-20.3.8.25-1:latest  bash -c \"git clone https://github.com/apache/couchdb.git && cd couchdb && ./configure --spidermonkey-version 1.8.5 && make\"`.\r\nI assumed it's the same contents that is `make`d for packaging and for the \"regular build/test\".  And I assumed that it's the same options for `CC`. (And certainly not stricter for packaging than for regular build.)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/794335136/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]