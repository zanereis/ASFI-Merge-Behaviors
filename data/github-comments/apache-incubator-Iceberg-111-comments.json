[{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918379126","html_url":"https://github.com/apache/iceberg/pull/3097#issuecomment-918379126","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3097","id":918379126,"node_id":"IC_kwDOCW7NX842vVp2","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T16:47:05Z","updated_at":"2021-09-13T16:47:05Z","author_association":"CONTRIBUTOR","body":"@itachi-sharingan, could you add the test that Russell suggested and fix the failing CI checks? Otherwise, I think this is about ready to go.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918379126/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918380919","html_url":"https://github.com/apache/iceberg/issues/2488#issuecomment-918380919","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2488","id":918380919,"node_id":"IC_kwDOCW7NX842vWF3","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T16:49:25Z","updated_at":"2021-09-13T16:49:25Z","author_association":"MEMBER","body":"As recently discussed with @rdblue and @flyrain I think we have consensus that we don't want to allow having `hive.url` set when using the SparkSessionCatalog class since this is always incorrect. Gonna tag this with Good First Issue since it should be a relatively small task.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918380919/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918414354","html_url":"https://github.com/apache/iceberg/pull/3097#issuecomment-918414354","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3097","id":918414354,"node_id":"IC_kwDOCW7NX842veQS","user":{"login":"itachi-sharingan","id":16745229,"node_id":"MDQ6VXNlcjE2NzQ1MjI5","avatar_url":"https://avatars.githubusercontent.com/u/16745229?v=4","gravatar_id":"","url":"https://api.github.com/users/itachi-sharingan","html_url":"https://github.com/itachi-sharingan","followers_url":"https://api.github.com/users/itachi-sharingan/followers","following_url":"https://api.github.com/users/itachi-sharingan/following{/other_user}","gists_url":"https://api.github.com/users/itachi-sharingan/gists{/gist_id}","starred_url":"https://api.github.com/users/itachi-sharingan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itachi-sharingan/subscriptions","organizations_url":"https://api.github.com/users/itachi-sharingan/orgs","repos_url":"https://api.github.com/users/itachi-sharingan/repos","events_url":"https://api.github.com/users/itachi-sharingan/events{/privacy}","received_events_url":"https://api.github.com/users/itachi-sharingan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T17:30:06Z","updated_at":"2021-09-13T17:31:52Z","author_association":"CONTRIBUTOR","body":"@rdblue have fixed the failing CI.\r\n@RussellSpitzer have added the check for non existent directory drop returning false in the same test.\r\nHence, I am closing this pr.\r\nMoreover, can someone please suggest what would be a good issue to pick up next?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918414354/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918420049","html_url":"https://github.com/apache/iceberg/pull/3094#issuecomment-918420049","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3094","id":918420049,"node_id":"IC_kwDOCW7NX842vfpR","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T17:37:06Z","updated_at":"2021-09-13T17:37:06Z","author_association":"CONTRIBUTOR","body":"Hi @jun-he, do we need a similar change in python? table_properties.py contains WRITE_NEW_DATA_LOCATION and WRITE_METADATA_LOCATION as well. I'm glad to add it if the change is needed. Another option is to handle it in a follow-up PR.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918420049/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918428118","html_url":"https://github.com/apache/iceberg/pull/3097#issuecomment-918428118","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3097","id":918428118,"node_id":"IC_kwDOCW7NX842vhnW","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T17:47:09Z","updated_at":"2021-09-13T17:47:09Z","author_association":"CONTRIBUTOR","body":"Thanks, @itachi-sharingan! I reopened this so that I could merge it. There's no need to close a PR when it is finished.\r\n\r\nIf you're looking for another contribution, #2488 is a good one! Thanks for contributing!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918428118/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918448836","html_url":"https://github.com/apache/iceberg/issues/3091#issuecomment-918448836","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3091","id":918448836,"node_id":"IC_kwDOCW7NX842vmrE","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T18:11:10Z","updated_at":"2021-09-13T18:11:10Z","author_association":"CONTRIBUTOR","body":"After enabling the info level logging from gradle, a timeout was reported by @nastra for the following job:\r\n\r\nhttps://github.com/apache/iceberg/pull/3024/checks\r\n\r\nThe logs seem to be spewing the following Flink related logs repeatedly until the 6h point is reached.\r\n\r\nI am downloading these logs as well, but it seems as though this particular Flink test shuts down / enters the `FINISHED` state before it can complete an active checkpoint, and is retrying that constantly.\r\n\r\nI believe there is a configuration parameter for maximum number of allowed failed commits. I will try adding that and see if that helps.\r\n\r\n```\r\n2021-09-13T08:19:47.7896411Z > Task :iceberg-flink:test\r\n2021-09-13T08:19:47.7899950Z     [Checkpoint Timer] INFO org.apache.flink.runtime.checkpoint.CheckpointCoordinator - Checkpoint triggering task Source: rightCustomSource -> rightIcebergSink-rightIcebergSink -> rightIcebergSink-IcebergStreamWriter (1/1) of job 437e46445e777ca2231677f60f87496a is not in state RUNNING but FINISHED instead. Aborting checkpoint.\r\n2021-09-13T08:19:47.7905489Z     [Checkpoint Timer] INFO org.apache.flink.runtime.checkpoint.CheckpointCoordinator - Checkpoint triggering task Source: rightCustomSource -> rightIcebergSink-rightIcebergSink -> rightIcebergSink-IcebergStreamWriter (1/1) of job 437e46445e777ca2231677f60f87496a is not in state RUNNING but FINISHED instead. Aborting checkpoint.\r\n2021-09-13T08:19:47.7914766Z     [Checkpoint Timer] INFO org.apache.flink.runtime.checkpoint.CheckpointCoordinator - Checkpoint triggering task Source: rightCustomSource -> rightIcebergSink-rightIcebergSink -> rightIcebergSink-IcebergStreamWriter (1/1) of job 437e46445e777ca2231677f60f87496a is not in state RUNNING but FINISHED instead. Aborting checkpoint.\r\n2021-09-13T08:19:47.7920502Z     [Checkpoint Timer] INFO org.apache.flink.runtime.checkpoint.CheckpointCoordinator - Checkpoint triggering task Source: rightCustomSource -> rightIcebergSink-rightIcebergSink -> rightIcebergSink-IcebergStreamWriter (1/1) of job 437e46445e777ca2231677f60f87496a is not in state RUNNING but FINISHED instead. Aborting checkpoint.\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918448836/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918493847","html_url":"https://github.com/apache/iceberg/issues/2532#issuecomment-918493847","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2532","id":918493847,"node_id":"IC_kwDOCW7NX842vxqX","user":{"login":"yyanyy","id":71906210,"node_id":"MDQ6VXNlcjcxOTA2MjEw","avatar_url":"https://avatars.githubusercontent.com/u/71906210?v=4","gravatar_id":"","url":"https://api.github.com/users/yyanyy","html_url":"https://github.com/yyanyy","followers_url":"https://api.github.com/users/yyanyy/followers","following_url":"https://api.github.com/users/yyanyy/following{/other_user}","gists_url":"https://api.github.com/users/yyanyy/gists{/gist_id}","starred_url":"https://api.github.com/users/yyanyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yyanyy/subscriptions","organizations_url":"https://api.github.com/users/yyanyy/orgs","repos_url":"https://api.github.com/users/yyanyy/repos","events_url":"https://api.github.com/users/yyanyy/events{/privacy}","received_events_url":"https://api.github.com/users/yyanyy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T19:08:44Z","updated_at":"2021-09-13T19:08:44Z","author_association":"CONTRIBUTOR","body":"@itachi-sharingan welcome to the community! Your understanding is correct. For creating iceberg table, the manifest/data files are not needed as the input since they should be eventually linked from the table metadata file, so such relationship should be preserved from the table metadata object and the manifest files in the resources folder. \r\n\r\nFor finding the files introduced, I think https://iceberg.apache.org/spec/#version-2 this could be a good place to check what's strictly required for v1 vs. v2; you can also create a v1 table (follow code path as in https://github.com/apache/iceberg/pull/2887 to find out the setting) and use the created files as starting point. I think we can have such setup for both v1 and v2 tables, so that in future when v3 is introduced we can continue to have this safety guard. \r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918493847/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918512786","html_url":"https://github.com/apache/iceberg/pull/3107#issuecomment-918512786","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3107","id":918512786,"node_id":"IC_kwDOCW7NX842v2SS","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T19:34:48Z","updated_at":"2021-09-13T19:34:48Z","author_association":"CONTRIBUTOR","body":"@rdblue @RussellSpitzer ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918512786/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918516558","html_url":"https://github.com/apache/iceberg/issues/3091#issuecomment-918516558","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3091","id":918516558,"node_id":"IC_kwDOCW7NX842v3NO","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T19:40:22Z","updated_at":"2021-09-13T19:40:22Z","author_association":"CONTRIBUTOR","body":"This stack overflow question might be of use for debugging this issue: https://stackoverflow.com/questions/65236052/flink-checkpoint-is-getting-aborted\r\n\r\n\r\n```You can check your parallelism Settings, if your program's parallelism is greater than the source's parallelism, then some task will show completion because it doesn't have the data, and that would abort a checkpoint.```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918516558/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918520098","html_url":"https://github.com/apache/iceberg/pull/3038#issuecomment-918520098","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3038","id":918520098,"node_id":"IC_kwDOCW7NX842v4Ei","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T19:46:03Z","updated_at":"2021-09-13T19:46:03Z","author_association":"CONTRIBUTOR","body":"Sorry for the delay. I think this change makes sense too. Thanks, @wypoon!\r\n\r\nShall we update Spark 2 as well?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918520098/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918521378","html_url":"https://github.com/apache/iceberg/pull/3038#issuecomment-918521378","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3038","id":918521378,"node_id":"IC_kwDOCW7NX842v4Yi","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T19:48:02Z","updated_at":"2021-09-13T19:48:02Z","author_association":"CONTRIBUTOR","body":"I created #3108 so that we don't forget.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918521378/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918527641","html_url":"https://github.com/apache/iceberg/pull/2987#issuecomment-918527641","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2987","id":918527641,"node_id":"IC_kwDOCW7NX842v56Z","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T19:58:06Z","updated_at":"2021-09-13T19:58:06Z","author_association":"CONTRIBUTOR","body":"@openinx @JingsongLi, could you check this PR whenever you get a sec? If it makes sense, I'll rebase.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918527641/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918546556","html_url":"https://github.com/apache/iceberg/issues/3091#issuecomment-918546556","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3091","id":918546556,"node_id":"IC_kwDOCW7NX842v-h8","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T20:22:39Z","updated_at":"2021-09-13T20:22:39Z","author_association":"CONTRIBUTOR","body":"There's more discussion here: https://issues.apache.org/jira/browse/FLINK-2491\r\n\r\nIt seems as though the source finishes, so its tasks shut down, while other parts are still checkpointing, so it doesn't complete.\r\n\r\nI think we'll need to update `BoundedTestSource` and its checkpoint abort logic.\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918546556/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918547243","html_url":"https://github.com/apache/iceberg/pull/3106#issuecomment-918547243","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3106","id":918547243,"node_id":"IC_kwDOCW7NX842v-sr","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T20:23:39Z","updated_at":"2021-09-13T20:23:39Z","author_association":"CONTRIBUTOR","body":"I actually don't think this will work.\r\n\r\nThe checkpoints are being aborted, not necessarily failing.\r\n\r\nThere's more discussion here: https://issues.apache.org/jira/browse/FLINK-2491\r\n\r\nIt seems as though the source finishes, so its task(s) shut down, while other parts are still checkpointing, so the checkpoint cannot complete as all tasks need to be up and running to acknowledge a checkpoint.\r\n\r\nI think we'll need to update `BoundedTestSource` and its checkpoint abort logic.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918547243/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918565958","html_url":"https://github.com/apache/iceberg/issues/3091#issuecomment-918565958","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3091","id":918565958,"node_id":"IC_kwDOCW7NX842wDRG","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T20:51:23Z","updated_at":"2021-09-13T20:51:23Z","author_association":"CONTRIBUTOR","body":"The CountdownLatch used here to keep the source open seems to be one possible solution: https://github.com/apache/flink/blob/313e20e8e03953a5e1cec9daa467f561ccfbd599/flink-connectors/flink-connector-files/src/test/java/org/apache/flink/connector/file/sink/StreamingExecutionFileSinkITCase.java#L55-L73\r\n\r\nI notice that we have some handling for this case, so I think it's just the addition of this two separate DAGs test that is causing this problem.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918565958/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918574306","html_url":"https://github.com/apache/iceberg/pull/2855#issuecomment-918574306","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2855","id":918574306,"node_id":"IC_kwDOCW7NX842wFTi","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T21:03:55Z","updated_at":"2021-09-13T21:03:55Z","author_association":"CONTRIBUTOR","body":"My understanding is that you are trying to make the default table location a function of all the other table states, and make this function a potentially pluggable interface. \r\n\r\nThe biggest use case I see is for tables renamed to have the same name as an old table, they will still have a different path and not clobber the data if UUID is a part of the table path. Please let me know if there is any additional important use case that I missed.\r\n\r\nSo to achieve this feature, I think another way is to have a different method in parallel to table builder's `withLocation(String newLoaction)` method called `withTableRootLocationProvider(String providerImpl)` (or this can be from table properties) to supply a root location provider. This provider is basically `Function<TableMetadataBuilder, String>`, and we will fill the null location value based on location provider in the table metadata builder.\r\n\r\nIn the PR that Ryan referenced, I have changed to implement the `TableMetadataUpdateBuilder` that works specifically for the update metadata use case. Given this case, I think it now makes more sense to have a separated `TableMetadataBuilder` to create new table metadata, and we can initialize the location provider and resolve the location in the builder.\r\n\r\nTo make this backwards compatible with existing implementations, we can remove the `defaultWarehouseLocation` method, and instead provide 2 implementations of the provider, which are `HiveTableRootLocationProvider` and `HadoopTableRootLocationProvider`, that should be able to cover all the existing use cases.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918574306/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918582832","html_url":"https://github.com/apache/iceberg/pull/2921#issuecomment-918582832","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2921","id":918582832,"node_id":"IC_kwDOCW7NX842wHYw","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T21:14:55Z","updated_at":"2021-09-13T21:14:55Z","author_association":"CONTRIBUTOR","body":"I think this will be a valuable addition. We should probably fix the arg name and also add a test where this argument is set. I know it will be hard to test the number of threads used but at least we should ensure there is no exception.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918582832/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918583021","html_url":"https://github.com/apache/iceberg/pull/3094#issuecomment-918583021","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3094","id":918583021,"node_id":"IC_kwDOCW7NX842wHbt","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T21:15:11Z","updated_at":"2021-09-13T21:15:11Z","author_association":"CONTRIBUTOR","body":"> nit: we can move L161 to after L144 to avoid deleting the comments and add again here.\r\n\r\nI am trying to put these two guys together.\r\n```\r\n  // This only applies to files written after this property is set. Files previously written aren't\r\n  // relocated to reflect this parameter.\r\n  // If not set, defaults to a \"data\" folder underneath the root path of the table.\r\n  public static final String WRITE_DATA_LOCATION = \"write.data.path\";\r\n\r\n  // This only applies to files written after this property is set. Files previously written aren't\r\n  // relocated to reflect this parameter.\r\n  // If not set, defaults to a \"metadata\" folder underneath the root path of the table.\r\n  public static final String WRITE_METADATA_LOCATION = \"write.metadata.path\";\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918583021/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918589922","html_url":"https://github.com/apache/iceberg/pull/3071#issuecomment-918589922","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3071","id":918589922,"node_id":"IC_kwDOCW7NX842wJHi","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T21:24:55Z","updated_at":"2021-09-13T21:24:55Z","author_association":"CONTRIBUTOR","body":"I'll merge this one to unblock subsequent PRs. I added the missing test.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918589922/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918590711","html_url":"https://github.com/apache/iceberg/pull/3071#issuecomment-918590711","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3071","id":918590711,"node_id":"IC_kwDOCW7NX842wJT3","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T21:26:03Z","updated_at":"2021-09-13T21:26:03Z","author_association":"CONTRIBUTOR","body":"Thanks for reviewing, @RussellSpitzer @rdblue!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918590711/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918628581","html_url":"https://github.com/apache/iceberg/pull/2933#issuecomment-918628581","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2933","id":918628581,"node_id":"IC_kwDOCW7NX842wSjl","user":{"login":"mayursrivastava","id":8659624,"node_id":"MDQ6VXNlcjg2NTk2MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8659624?v=4","gravatar_id":"","url":"https://api.github.com/users/mayursrivastava","html_url":"https://github.com/mayursrivastava","followers_url":"https://api.github.com/users/mayursrivastava/followers","following_url":"https://api.github.com/users/mayursrivastava/following{/other_user}","gists_url":"https://api.github.com/users/mayursrivastava/gists{/gist_id}","starred_url":"https://api.github.com/users/mayursrivastava/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayursrivastava/subscriptions","organizations_url":"https://api.github.com/users/mayursrivastava/orgs","repos_url":"https://api.github.com/users/mayursrivastava/repos","events_url":"https://api.github.com/users/mayursrivastava/events{/privacy}","received_events_url":"https://api.github.com/users/mayursrivastava/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T22:25:26Z","updated_at":"2021-09-13T22:25:26Z","author_association":"CONTRIBUTOR","body":"@rdblue rebased","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918628581/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918628830","html_url":"https://github.com/apache/iceberg/issues/3109#issuecomment-918628830","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3109","id":918628830,"node_id":"IC_kwDOCW7NX842wSne","user":{"login":"netvl","id":280456,"node_id":"MDQ6VXNlcjI4MDQ1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/280456?v=4","gravatar_id":"","url":"https://api.github.com/users/netvl","html_url":"https://github.com/netvl","followers_url":"https://api.github.com/users/netvl/followers","following_url":"https://api.github.com/users/netvl/following{/other_user}","gists_url":"https://api.github.com/users/netvl/gists{/gist_id}","starred_url":"https://api.github.com/users/netvl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/netvl/subscriptions","organizations_url":"https://api.github.com/users/netvl/orgs","repos_url":"https://api.github.com/users/netvl/repos","events_url":"https://api.github.com/users/netvl/events{/privacy}","received_events_url":"https://api.github.com/users/netvl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T22:25:55Z","updated_at":"2021-09-13T22:25:55Z","author_association":"NONE","body":"cc @RussellSpitzer @rdblue ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918628830/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918632089","html_url":"https://github.com/apache/iceberg/pull/2829#issuecomment-918632089","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2829","id":918632089,"node_id":"IC_kwDOCW7NX842wTaZ","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T22:32:29Z","updated_at":"2021-09-13T22:32:29Z","author_association":"MEMBER","body":"@rdblue + @adamkennedy Changes applied, if you have time please take another look","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918632089/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918632602","html_url":"https://github.com/apache/iceberg/pull/2867#issuecomment-918632602","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2867","id":918632602,"node_id":"IC_kwDOCW7NX842wTia","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T22:33:31Z","updated_at":"2021-09-13T22:33:31Z","author_association":"CONTRIBUTOR","body":"I have also been following this thread although I did no make any comment. Let me add some thoughts since I see you are making some new changes.\r\n\r\nI am mostly on the same line of thought as @stevenzwu, I am a bit worried about the scalability of the current implementation, and I think the parallel commit proposal that @rdblue proposed could work, but in the end running compaction in streaming pipeline is likely unnecessary complication. \r\n\r\nSo far we have been advocating for streaming pipelines to just commit new files to storage, and use a separated process to handle compaction at the same time. Having the streaming pipeline also do compaction would mean that there might be 2 compaction processes competing with each other. This becomes especially complicated and prone to error when you have both batch jobs and streaming pipelines running at the same time (e.g. normal streaming + daily loading of corrected and late data). I understand it is likely a good optimization for simple use cases, but I would expect it to be a feature with a lot of in-depth knowledge to use safely and correctly if we open it for general usage.\r\n\r\nI wonder what is the initial drive behind this implementation. Do you just want to avoid a separated Spark cluster to run compaction in Spark? If we have Flink actions specifically for `RewriteDataFiles` and `RewriteDeleteFiles` that you can schedule on the same Flink cluster, would that solve the issue?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918632602/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918634163","html_url":"https://github.com/apache/iceberg/issues/3109#issuecomment-918634163","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3109","id":918634163,"node_id":"IC_kwDOCW7NX842wT6z","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T22:35:06Z","updated_at":"2021-09-13T22:35:06Z","author_association":"MEMBER","body":"@rdblue As far as I could tell there was no explicit reason for this behavior but I was wondering if there is some Spark Code somewhere that will be unhappy with us if we list Iceberg tables as well. If you don't know of any instances of that, i think we should complete the implementation.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918634163/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918634442","html_url":"https://github.com/apache/iceberg/issues/3109#issuecomment-918634442","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3109","id":918634442,"node_id":"IC_kwDOCW7NX842wT_K","user":{"login":"netvl","id":280456,"node_id":"MDQ6VXNlcjI4MDQ1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/280456?v=4","gravatar_id":"","url":"https://api.github.com/users/netvl","html_url":"https://github.com/netvl","followers_url":"https://api.github.com/users/netvl/followers","following_url":"https://api.github.com/users/netvl/following{/other_user}","gists_url":"https://api.github.com/users/netvl/gists{/gist_id}","starred_url":"https://api.github.com/users/netvl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/netvl/subscriptions","organizations_url":"https://api.github.com/users/netvl/orgs","repos_url":"https://api.github.com/users/netvl/repos","events_url":"https://api.github.com/users/netvl/events{/privacy}","received_events_url":"https://api.github.com/users/netvl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T22:35:46Z","updated_at":"2021-09-13T22:35:46Z","author_association":"NONE","body":"Ok, it seems that the reason why `dropNamespace` fails is not tied to the `listTables()` problem directly (because `SparkSessionCatalog` seems to delegate `dropNamespace` directly to the legacy session catalog, which should ignore any Iceberg tables), but the issue IMO is still relevant as itself.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918634442/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918655645","html_url":"https://github.com/apache/iceberg/pull/3106#issuecomment-918655645","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3106","id":918655645,"node_id":"IC_kwDOCW7NX842wZKd","user":{"login":"stevenzwu","id":1545663,"node_id":"MDQ6VXNlcjE1NDU2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1545663?v=4","gravatar_id":"","url":"https://api.github.com/users/stevenzwu","html_url":"https://github.com/stevenzwu","followers_url":"https://api.github.com/users/stevenzwu/followers","following_url":"https://api.github.com/users/stevenzwu/following{/other_user}","gists_url":"https://api.github.com/users/stevenzwu/gists{/gist_id}","starred_url":"https://api.github.com/users/stevenzwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevenzwu/subscriptions","organizations_url":"https://api.github.com/users/stevenzwu/orgs","repos_url":"https://api.github.com/users/stevenzwu/repos","events_url":"https://api.github.com/users/stevenzwu/events{/privacy}","received_events_url":"https://api.github.com/users/stevenzwu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T23:19:53Z","updated_at":"2021-09-13T23:20:58Z","author_association":"CONTRIBUTOR","body":"@kbendick thx a lot for investigating this issue. \r\n\r\nI added this test of `testTwoSinksInDisjointedDAG` probably a few weeks ago. It seems that we may have an infinite wait problem in the `BoundedTestSource` when the other part of the DAG has completed as @kbendick found out. Maybe we should ignore this test for now so that we can stop the bleeding first while investigate the right fix.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918655645/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918656206","html_url":"https://github.com/apache/iceberg/pull/3099#issuecomment-918656206","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3099","id":918656206,"node_id":"IC_kwDOCW7NX842wZTO","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T23:20:48Z","updated_at":"2021-09-14T02:53:49Z","author_association":"COLLABORATOR","body":"Retriggering, looks like past hang due to: https://github.com/apache/iceberg/pull/3110","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918656206/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918656866","html_url":"https://github.com/apache/iceberg/issues/3077#issuecomment-918656866","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3077","id":918656866,"node_id":"IC_kwDOCW7NX842wZdi","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T23:22:06Z","updated_at":"2021-09-13T23:22:06Z","author_association":"CONTRIBUTOR","body":"Not familiar with it. May @kbendick knows.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918656866/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918664589","html_url":"https://github.com/apache/iceberg/pull/3110#issuecomment-918664589","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3110","id":918664589,"node_id":"IC_kwDOCW7NX842wbWN","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T23:39:33Z","updated_at":"2021-09-13T23:39:33Z","author_association":"CONTRIBUTOR","body":"cc @stevenzwu @RussellSpitzer @rdblue @nastra since we've located the cause of the CI timeouts, we've decided to just ignore the test for now.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918664589/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918664734","html_url":"https://github.com/apache/iceberg/pull/3106#issuecomment-918664734","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3106","id":918664734,"node_id":"IC_kwDOCW7NX842wbYe","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T23:39:56Z","updated_at":"2021-09-13T23:39:56Z","author_association":"CONTRIBUTOR","body":"We've decided to just ignore this test for now, so I'm closing this PR in favor of this one instead https://github.com/apache/iceberg/pull/3110","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918664734/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918668714","html_url":"https://github.com/apache/iceberg/pull/2985#issuecomment-918668714","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2985","id":918668714,"node_id":"IC_kwDOCW7NX842wcWq","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T23:50:01Z","updated_at":"2021-09-13T23:50:01Z","author_association":"CONTRIBUTOR","body":"This one is ready for another review round.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918668714/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918693621","html_url":"https://github.com/apache/iceberg/issues/3109#issuecomment-918693621","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3109","id":918693621,"node_id":"IC_kwDOCW7NX842wib1","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T00:31:17Z","updated_at":"2021-09-14T00:31:17Z","author_association":"CONTRIBUTOR","body":"Interesting, my test works, `SparkSessionCatalog::listTables` can list both iceberg table and non-iceberg table. We need to dig deeper. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918693621/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918724405","html_url":"https://github.com/apache/iceberg/pull/2240#issuecomment-918724405","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2240","id":918724405,"node_id":"IC_kwDOCW7NX842wp81","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T01:45:04Z","updated_at":"2021-09-14T01:45:04Z","author_association":"CONTRIBUTOR","body":"Sorry, I was off last week. I'll take a look now.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918724405/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918739609","html_url":"https://github.com/apache/iceberg/pull/2867#issuecomment-918739609","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2867","id":918739609,"node_id":"IC_kwDOCW7NX842wtqZ","user":{"login":"hameizi","id":18445460,"node_id":"MDQ6VXNlcjE4NDQ1NDYw","avatar_url":"https://avatars.githubusercontent.com/u/18445460?v=4","gravatar_id":"","url":"https://api.github.com/users/hameizi","html_url":"https://github.com/hameizi","followers_url":"https://api.github.com/users/hameizi/followers","following_url":"https://api.github.com/users/hameizi/following{/other_user}","gists_url":"https://api.github.com/users/hameizi/gists{/gist_id}","starred_url":"https://api.github.com/users/hameizi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hameizi/subscriptions","organizations_url":"https://api.github.com/users/hameizi/orgs","repos_url":"https://api.github.com/users/hameizi/repos","events_url":"https://api.github.com/users/hameizi/events{/privacy}","received_events_url":"https://api.github.com/users/hameizi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T02:21:08Z","updated_at":"2021-09-14T06:20:19Z","author_association":"CONTRIBUTOR","body":"> I think the parallel commit proposal that @rdblue proposed could work\r\n\r\n@jackye1995 In this PR the rewriteAction of flink is parallel, it will not make data deal slow down. Because when the function snapshot success flink will continue deal data but not wait the result of notifyCheckpointComplete.\r\n\r\n> I wonder what is the initial drive behind this implementation.\r\n\r\nAuto compact file every checkpoint in flink will solve several question. \r\n1. It will make query iceberg table fastly every time, because in our sence we find query table slowly although we have schedule  compact file every day, but it is not enough.\r\n2. It will slove the bug of there is duplicate rows in iceberg primary table when we compact file https://github.com/apache/iceberg/issues/2308 . Because we strict commit one snashot and then compact file in order, so we will not cause there is one more snapshot is commit when we are compacting file. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918739609/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918751593","html_url":"https://github.com/apache/iceberg/pull/3099#issuecomment-918751593","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3099","id":918751593,"node_id":"IC_kwDOCW7NX842wwlp","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T02:53:20Z","updated_at":"2021-09-14T02:56:57Z","author_association":"COLLABORATOR","body":"@pvary and @rdblue  the change as we discussed, if you guys want to take a look.\r\n\r\nAfter doing some tests with it, one unexpected side effect to call out for reviewers is that due to https://issues.apache.org/jira/browse/HIVE-13014, lock() is now explicitly not allowed to retry (ref:  https://github.com/apache/hive/blob/master/standalone-metastore/metastore-common/src/main/java/org/apache/hadoop/hive/metastore/IMetaStoreClient.java#L3413).  \r\n\r\nOn the one hand, correct-ness wise it makes sense to avoid retry (its possible the server actually got the lock but does not return to the client, leaving a dangling lock).   On the other hand, it's a bit of a bummer as lock() is called quite frequently on Iceberg side on every commit and is a bit prone to random failures, ie https://issues.apache.org/jira/browse/HIVE-23052.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918751593/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918769433","html_url":"https://github.com/apache/iceberg/issues/3109#issuecomment-918769433","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3109","id":918769433,"node_id":"IC_kwDOCW7NX842w08Z","user":{"login":"netvl","id":280456,"node_id":"MDQ6VXNlcjI4MDQ1Ng==","avatar_url":"https://avatars.githubusercontent.com/u/280456?v=4","gravatar_id":"","url":"https://api.github.com/users/netvl","html_url":"https://github.com/netvl","followers_url":"https://api.github.com/users/netvl/followers","following_url":"https://api.github.com/users/netvl/following{/other_user}","gists_url":"https://api.github.com/users/netvl/gists{/gist_id}","starred_url":"https://api.github.com/users/netvl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/netvl/subscriptions","organizations_url":"https://api.github.com/users/netvl/orgs","repos_url":"https://api.github.com/users/netvl/repos","events_url":"https://api.github.com/users/netvl/events{/privacy}","received_events_url":"https://api.github.com/users/netvl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T03:34:36Z","updated_at":"2021-09-14T03:34:36Z","author_association":"NONE","body":"@flyrain most likely, that's because the session catalog is also set to source tables from Hive. If the session catalog does not point to Hive (e.g. in-memory) then there will be a discrepancy.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918769433/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918798427","html_url":"https://github.com/apache/iceberg/pull/3038#issuecomment-918798427","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3038","id":918798427,"node_id":"IC_kwDOCW7NX842w8Bb","user":{"login":"wypoon","id":3925490,"node_id":"MDQ6VXNlcjM5MjU0OTA=","avatar_url":"https://avatars.githubusercontent.com/u/3925490?v=4","gravatar_id":"","url":"https://api.github.com/users/wypoon","html_url":"https://github.com/wypoon","followers_url":"https://api.github.com/users/wypoon/followers","following_url":"https://api.github.com/users/wypoon/following{/other_user}","gists_url":"https://api.github.com/users/wypoon/gists{/gist_id}","starred_url":"https://api.github.com/users/wypoon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wypoon/subscriptions","organizations_url":"https://api.github.com/users/wypoon/orgs","repos_url":"https://api.github.com/users/wypoon/repos","events_url":"https://api.github.com/users/wypoon/events{/privacy}","received_events_url":"https://api.github.com/users/wypoon/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T04:48:27Z","updated_at":"2021-09-14T04:48:27Z","author_association":"CONTRIBUTOR","body":"@aokolnychyi thanks for seconding the change.\r\nYes, I think it makes sense to do the same for Spark 2 as well. I'll put up a PR.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918798427/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918802895","html_url":"https://github.com/apache/iceberg/pull/3110#issuecomment-918802895","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3110","id":918802895,"node_id":"IC_kwDOCW7NX842w9HP","user":{"login":"stevenzwu","id":1545663,"node_id":"MDQ6VXNlcjE1NDU2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1545663?v=4","gravatar_id":"","url":"https://api.github.com/users/stevenzwu","html_url":"https://github.com/stevenzwu","followers_url":"https://api.github.com/users/stevenzwu/followers","following_url":"https://api.github.com/users/stevenzwu/following{/other_user}","gists_url":"https://api.github.com/users/stevenzwu/gists{/gist_id}","starred_url":"https://api.github.com/users/stevenzwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevenzwu/subscriptions","organizations_url":"https://api.github.com/users/stevenzwu/orgs","repos_url":"https://api.github.com/users/stevenzwu/repos","events_url":"https://api.github.com/users/stevenzwu/events{/privacy}","received_events_url":"https://api.github.com/users/stevenzwu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T04:59:56Z","updated_at":"2021-09-14T04:59:56Z","author_association":"CONTRIBUTOR","body":"@openinx @rdblue can you help merge this PR to avoid test hanging?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918802895/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918814786","html_url":"https://github.com/apache/iceberg/pull/3038#issuecomment-918814786","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3038","id":918814786,"node_id":"IC_kwDOCW7NX842xABC","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T05:24:33Z","updated_at":"2021-09-14T05:24:33Z","author_association":"CONTRIBUTOR","body":"Much appreciated, @wypoon!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918814786/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918883387","html_url":"https://github.com/apache/iceberg/pull/2859#issuecomment-918883387","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2859","id":918883387,"node_id":"IC_kwDOCW7NX842xQw7","user":{"login":"coolderli","id":38486782,"node_id":"MDQ6VXNlcjM4NDg2Nzgy","avatar_url":"https://avatars.githubusercontent.com/u/38486782?v=4","gravatar_id":"","url":"https://api.github.com/users/coolderli","html_url":"https://github.com/coolderli","followers_url":"https://api.github.com/users/coolderli/followers","following_url":"https://api.github.com/users/coolderli/following{/other_user}","gists_url":"https://api.github.com/users/coolderli/gists{/gist_id}","starred_url":"https://api.github.com/users/coolderli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coolderli/subscriptions","organizations_url":"https://api.github.com/users/coolderli/orgs","repos_url":"https://api.github.com/users/coolderli/repos","events_url":"https://api.github.com/users/coolderli/events{/privacy}","received_events_url":"https://api.github.com/users/coolderli/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T07:24:26Z","updated_at":"2021-09-14T07:24:26Z","author_association":"CONTRIBUTOR","body":"> @coolderli, what went wrong without this?\r\n> \r\n> Also, you should definitely coordinate with @aokolnychyi on the Spark implementations. I believe that he has them fully working at this point.\r\n\r\nYes, I found @aokolnychyi has implemented new writes #2873, we can use the new writer.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918883387/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918940938","html_url":"https://github.com/apache/iceberg/pull/2890#issuecomment-918940938","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2890","id":918940938,"node_id":"IC_kwDOCW7NX842xe0K","user":{"login":"ConeyLiu","id":12733256,"node_id":"MDQ6VXNlcjEyNzMzMjU2","avatar_url":"https://avatars.githubusercontent.com/u/12733256?v=4","gravatar_id":"","url":"https://api.github.com/users/ConeyLiu","html_url":"https://github.com/ConeyLiu","followers_url":"https://api.github.com/users/ConeyLiu/followers","following_url":"https://api.github.com/users/ConeyLiu/following{/other_user}","gists_url":"https://api.github.com/users/ConeyLiu/gists{/gist_id}","starred_url":"https://api.github.com/users/ConeyLiu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ConeyLiu/subscriptions","organizations_url":"https://api.github.com/users/ConeyLiu/orgs","repos_url":"https://api.github.com/users/ConeyLiu/repos","events_url":"https://api.github.com/users/ConeyLiu/events{/privacy}","received_events_url":"https://api.github.com/users/ConeyLiu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T08:41:09Z","updated_at":"2021-09-14T08:41:09Z","author_association":"CONTRIBUTOR","body":"gentle ping @rdblue @aokolnychyi, could you help to review this? Thanks a lot.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918940938/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918942052","html_url":"https://github.com/apache/iceberg/pull/3056#issuecomment-918942052","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3056","id":918942052,"node_id":"IC_kwDOCW7NX842xfFk","user":{"login":"ConeyLiu","id":12733256,"node_id":"MDQ6VXNlcjEyNzMzMjU2","avatar_url":"https://avatars.githubusercontent.com/u/12733256?v=4","gravatar_id":"","url":"https://api.github.com/users/ConeyLiu","html_url":"https://github.com/ConeyLiu","followers_url":"https://api.github.com/users/ConeyLiu/followers","following_url":"https://api.github.com/users/ConeyLiu/following{/other_user}","gists_url":"https://api.github.com/users/ConeyLiu/gists{/gist_id}","starred_url":"https://api.github.com/users/ConeyLiu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ConeyLiu/subscriptions","organizations_url":"https://api.github.com/users/ConeyLiu/orgs","repos_url":"https://api.github.com/users/ConeyLiu/repos","events_url":"https://api.github.com/users/ConeyLiu/events{/privacy}","received_events_url":"https://api.github.com/users/ConeyLiu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T08:42:42Z","updated_at":"2021-09-14T08:42:42Z","author_association":"CONTRIBUTOR","body":"gentle ping @rdblue @aokolnychyi, could you help to review this also? Thanks a lot.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918942052/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918978509","html_url":"https://github.com/apache/iceberg/issues/3114#issuecomment-918978509","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3114","id":918978509,"node_id":"IC_kwDOCW7NX842xn_N","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T09:27:36Z","updated_at":"2021-09-14T09:27:36Z","author_association":"MEMBER","body":"Hi @mazhiyu123 ,  I think you will need to apply this PR to your own branch: https://github.com/apache/iceberg/pull/2731","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/918978509/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919006807","html_url":"https://github.com/apache/iceberg/issues/3114#issuecomment-919006807","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3114","id":919006807,"node_id":"IC_kwDOCW7NX842xu5X","user":{"login":"mazhiyu123","id":11924158,"node_id":"MDQ6VXNlcjExOTI0MTU4","avatar_url":"https://avatars.githubusercontent.com/u/11924158?v=4","gravatar_id":"","url":"https://api.github.com/users/mazhiyu123","html_url":"https://github.com/mazhiyu123","followers_url":"https://api.github.com/users/mazhiyu123/followers","following_url":"https://api.github.com/users/mazhiyu123/following{/other_user}","gists_url":"https://api.github.com/users/mazhiyu123/gists{/gist_id}","starred_url":"https://api.github.com/users/mazhiyu123/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mazhiyu123/subscriptions","organizations_url":"https://api.github.com/users/mazhiyu123/orgs","repos_url":"https://api.github.com/users/mazhiyu123/repos","events_url":"https://api.github.com/users/mazhiyu123/events{/privacy}","received_events_url":"https://api.github.com/users/mazhiyu123/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T10:05:39Z","updated_at":"2021-09-14T10:06:14Z","author_association":"NONE","body":"> Hi @mazhiyu123 , I think you will need to apply this PR to your own branch: #2731\r\n\r\nthank you for replying soon!!!\r\n\r\nI already try this [#2731](https://github.com/apache/iceberg/pull/2731) , but i will get a new situation:\r\nwhen i insert data  with same primary key on one sql, iceberg table will has duplicate data. such as:\r\n insert sql:\r\nINSERT INTO  hadoop_catalog.iceberg_db.sample_test  VALUES (14, 'test14'), (14, 'test14_update');\r\n\r\nselect sql:\r\nselect * from hadoop_catalog.iceberg_db.sample_test;\r\n\r\nexpect : \r\n                        id                      data\r\n                        14             test14_update\r\n\r\nbut it return:\r\n                        id                      data\r\n                        14             test14_update\r\n                        14                    test14\r\n ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919006807/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919064052","html_url":"https://github.com/apache/iceberg/issues/3114#issuecomment-919064052","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3114","id":919064052,"node_id":"IC_kwDOCW7NX842x830","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T11:31:15Z","updated_at":"2021-09-14T11:31:15Z","author_association":"MEMBER","body":"I think you will need to rebase to use the latest master branch and enable the `'write.upsert.enable'='true'` from this [PR](https://github.com/apache/iceberg/pull/2863), which has enabled the upsert semantics in flink iceberg integration work.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919064052/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919073751","html_url":"https://github.com/apache/iceberg/issues/3102#issuecomment-919073751","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3102","id":919073751,"node_id":"IC_kwDOCW7NX842x_PX","user":{"login":"Reo-LEI","id":17312872,"node_id":"MDQ6VXNlcjE3MzEyODcy","avatar_url":"https://avatars.githubusercontent.com/u/17312872?v=4","gravatar_id":"","url":"https://api.github.com/users/Reo-LEI","html_url":"https://github.com/Reo-LEI","followers_url":"https://api.github.com/users/Reo-LEI/followers","following_url":"https://api.github.com/users/Reo-LEI/following{/other_user}","gists_url":"https://api.github.com/users/Reo-LEI/gists{/gist_id}","starred_url":"https://api.github.com/users/Reo-LEI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Reo-LEI/subscriptions","organizations_url":"https://api.github.com/users/Reo-LEI/orgs","repos_url":"https://api.github.com/users/Reo-LEI/repos","events_url":"https://api.github.com/users/Reo-LEI/events{/privacy}","received_events_url":"https://api.github.com/users/Reo-LEI/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T11:46:54Z","updated_at":"2021-09-14T11:46:54Z","author_association":"CONTRIBUTOR","body":"> But if some of the files owned by the old snapshot are deleted by mistake.\r\n\r\n@coolderli Thanks for your attention, but I think we don't need to worry about this case, because 'IcebergFilesCommitter' only validate the data files which are referenced by the not commited pos-delete files. And pos-delete file will only referenced the same txn data file. That is mean the referenced data files will not owned by other snapshot and only will be the uncommitted data files.\r\n\r\nSo I don't think your case will happend, but we can go a step further and discuss all possible situations. We assume that the table already has a historical snapshot.\r\n\r\n**Case-1:**  flink job **first start** and **not** uncommitted data.\r\n`IcebergFilesCommitter` will do nothing and `lastCommittedSnapshotId` will be init as init value(-1).\r\n\r\n**Case-2:**  flink job **restore** from checkpoint and **not** uncommitted data.\r\n`IcebergFilesCommitter` will do nothing and `lastCommittedSnapshotId` will be init as init value(-1).\r\n\r\n**Case-3:**  flink job **restore** from checkpoint and **have** uncommitted data.\r\n`IcebergFilesCommitter` will commit all uncommitted data. First, `lastCommittedSnapshotId` will be init as init value(-1), and then committer will validate all data files which is referenced by uncommitted pos-delete files from current snapshot to `lastCommittedSnapshotId`. Because `lastCommittedSnapshotId` value is -1, so committer will travel all snapshot history to ensure data files still exist and guarantee all snapshot history are valid. After that, `lastCommittedSnapshotId` will be update to the commited snapshotId.\r\n\r\n**Case-4:**  flink job keep **running** and **not** uncommitted data.\r\n`IcebergFilesCommitter` will do nothing and `lastCommittedSnapshotId` will keep its value.\r\n\r\n**Case-5:**  flink job keep **running** and **have** uncommitted data.\r\n`IcebergFilesCommitter` will commit all uncommitted data, and validate all referenced data files from current snapshot to `lastCommittedSnapshotId`. And then update `lastCommittedSnapshotId` the commited snapshotId. That can ensure all referenced data files are exist and not be delete between to commit.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919073751/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919073754","html_url":"https://github.com/apache/iceberg/issues/3114#issuecomment-919073754","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3114","id":919073754,"node_id":"IC_kwDOCW7NX842x_Pa","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T11:46:55Z","updated_at":"2021-09-14T11:49:20Z","author_association":"MEMBER","body":"I've checked the behavior by using iceberg master branch (git commit-id: 838cc652273c1444155bec2e1d6029cfbdbf3ea3) and flink 1.12,  all work as expected: \r\n\r\n```sql\r\nCREATE TABLE iceberg_table_v2 (\r\n    id   BIGINT,\r\n    data STRING,\r\n    PRIMARY KEY (id) NOT ENFORCED\r\n) WITH (\r\n     'connector'='iceberg',\r\n     'format-version' = '2',\r\n     'catalog-name'='hadoop_prod',\r\n     'catalog-type'='hadoop',\r\n     'write.upsert.enable'='true',\r\n     'warehouse'='file:///Users/openinx/test/iceberg-warehouse'\r\n);\r\n\r\nselect * from iceberg_table_v2;\r\n+----+------+\r\n| id | data |\r\n+----+------+\r\n0 row in set\r\n\r\nINSERT INTO iceberg_table_v2 VALUES (14, 'test14'), (14, 'test14_update');\r\n[INFO] Submitting SQL update statement to the cluster...\r\n[INFO] Table update statement has been successfully submitted to the cluster:\r\nJob ID: 083d3008e12bc533aacec0c2bdae9d0a\r\n\r\nselect * from iceberg_table_v2;\r\n+----+---------------+\r\n| id |          data |\r\n+----+---------------+\r\n| 14 | test14_update |\r\n+----+---------------+\r\n1 row in set\r\n\r\nINSERT INTO iceberg_table_v2 VALUES (14, 'test14_3');\r\n[INFO] Submitting SQL update statement to the cluster...\r\n[INFO] Table update statement has been successfully submitted to the cluster:\r\nJob ID: 9528163e8d06db33c090c16d9a858b45\r\n\r\nselect * from iceberg_table_v2; \r\n+----+----------+\r\n| id |     data |\r\n+----+----------+\r\n| 14 | test14_3 |\r\n+----+----------+\r\n1 row in set\r\n\r\nINSERT INTO iceberg_table_v2 VALUES (14, 'test14_4');\r\n[INFO] Submitting SQL update statement to the cluster...\r\n[INFO] Table update statement has been successfully submitted to the cluster:\r\nJob ID: 9543c0c29bc730ece8420066119f9abf\r\n\r\nselect * from iceberg_table_v2;\r\n+----+----------+\r\n| id |     data |\r\n+----+----------+\r\n| 14 | test14_4 |\r\n+----+----------+\r\n1 row in set\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919073754/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919074210","html_url":"https://github.com/apache/iceberg/issues/3114#issuecomment-919074210","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3114","id":919074210,"node_id":"IC_kwDOCW7NX842x_Wi","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T11:47:42Z","updated_at":"2021-09-14T11:47:42Z","author_association":"MEMBER","body":"Close this issue now, feel free to reopen this if you have more questions !","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919074210/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919082630","html_url":"https://github.com/apache/iceberg/pull/3085#issuecomment-919082630","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3085","id":919082630,"node_id":"IC_kwDOCW7NX842yBaG","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T12:00:35Z","updated_at":"2021-09-14T12:00:35Z","author_association":"MEMBER","body":"@rdblue , @jackye1995 ,  would you like to have a double check ?  I think I need at least one apache iceberg committer to approve this PR before merging this, thanks.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919082630/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919085940","html_url":"https://github.com/apache/iceberg/pull/3067#issuecomment-919085940","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3067","id":919085940,"node_id":"IC_kwDOCW7NX842yCN0","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T12:05:20Z","updated_at":"2021-09-14T12:05:20Z","author_association":"MEMBER","body":"The broken unit test is : \r\n\r\n```\r\norg.apache.iceberg.types.TestReadabilityChecks > testStructWriteReordering STANDARD_ERROR\r\n    [nested.field_b is out of order, before field_a]\r\n\r\norg.apache.iceberg.io.TestCloseableGroup > suppressExceptionIfSetSuppressIsTrue STANDARD_ERROR\r\n    [Test worker] ERROR org.apache.iceberg.io.CloseableGroup - Exception suppressed when attempting to close resources\r\n    java.io.IOException: exception1\r\n    \tat org.apache.iceberg.io.CloseableGroup.close(CloseableGroup.java:80)\r\n    \tat org.apache.iceberg.io.TestCloseableGroup.suppressExceptionIfSetSuppressIsTrue(TestCloseableGroup.java:75)\r\n    \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n    \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n    \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n    \tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n    \tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\r\n    \tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n    \tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\r\n    \tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n    \tat org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)\r\n    \tat org.junit.runners.BlockJUnit4ClassRunner$1.evaluate(BlockJUnit4ClassRunner.java:100)\r\n    \tat org.junit.runners.ParentRunner.runLeaf(ParentRunner.java:366)\r\n    \tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:103)\r\n    \tat org.junit.runners.BlockJUnit4ClassRunner.runChild(BlockJUnit4ClassRunner.java:63)\r\n    \tat org.junit.runners.ParentRunner$4.run(ParentRunner.java:331)\r\n    \tat org.junit.runners.ParentRunner$1.schedule(ParentRunner.java:79)\r\n    \tat org.junit.runners.ParentRunner.runChildren(ParentRunner.java:329)\r\n    \tat org.junit.runners.ParentRunner.access$100(ParentRunner.java:66)\r\n    \tat org.junit.runners.ParentRunner$2.evaluate(ParentRunner.java:293)\r\n    \tat org.junit.runners.ParentRunner$3.evaluate(ParentRunner.java:306)\r\n    \tat org.junit.runners.ParentRunner.run(ParentRunner.java:413)\r\n    \tat org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor.runTestClass(JUnitTestClassExecutor.java:110)\r\n    \tat org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor.execute(JUnitTestClassExecutor.java:58)\r\n    \tat org.gradle.api.internal.tasks.testing.junit.JUnitTestClassExecutor.execute(JUnitTestClassExecutor.java:38)\r\n    \tat org.gradle.api.internal.tasks.testing.junit.AbstractJUnitTestClassProcessor.processTestClass(AbstractJUnitTestClassProcessor.java:62)\r\n    \tat org.gradle.api.internal.tasks.testing.SuiteTestClassProcessor.processTestClass(SuiteTestClassProcessor.java:51)\r\n    \tat jdk.internal.reflect.GeneratedMethodAccessor4.invoke(Unknown Source)\r\n    \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n    \tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n    \tat org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)\r\n    \tat org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)\r\n    \tat org.gradle.internal.dispatch.ContextClassLoaderDispatch.dispatch(ContextClassLoaderDispatch.java:32)\r\n    \tat org.gradle.internal.dispatch.ProxyDispatchAdapter$DispatchingInvocationHandler.invoke(ProxyDispatchAdapter.java:93)\r\n    \tat com.sun.proxy.$Proxy2.processTestClass(Unknown Source)\r\n    \tat org.gradle.api.internal.tasks.testing.worker.TestWorker.processTestClass(TestWorker.java:118)\r\n    \tat jdk.internal.reflect.GeneratedMethodAccessor3.invoke(Unknown Source)\r\n    \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n    \tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n    \tat org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:35)\r\n    \tat org.gradle.internal.dispatch.ReflectionDispatch.dispatch(ReflectionDispatch.java:24)\r\n    \tat org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:175)\r\n    \tat org.gradle.internal.remote.internal.hub.MessageHubBackedObjectConnection$DispatchWrapper.dispatch(MessageHubBackedObjectConnection.java:157)\r\n    \tat org.gradle.internal.remote.internal.hub.MessageHub$Handler.run(MessageHub.java:404)\r\n    \tat org.gradle.internal.concurrent.ExecutorPolicy$CatchAndRecordFailures.onExecute(ExecutorPolicy.java:63)\r\n    \tat org.gradle.internal.concurrent.ManagedExecutorImpl$1.run(ManagedExecutorImpl.java:46)\r\n    \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n    \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n    \tat org.gradle.internal.concurrent.ThreadFactoryImpl$ManagedThreadRunnable.run(ThreadFactoryImpl.java:55)\r\n    \tat java.base/java.lang.Thread.run(Thread.java:829)\r\n```\r\n\r\nLooks like it's unrelated to this PR,  let's reopen to trigger the travis CI once again.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919085940/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919108959","html_url":"https://github.com/apache/iceberg/pull/3032#issuecomment-919108959","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3032","id":919108959,"node_id":"IC_kwDOCW7NX842yH1f","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T12:37:15Z","updated_at":"2021-09-14T12:37:15Z","author_association":"MEMBER","body":"@asnowfox ,   How did you ensure that the class was loaded by other different class loader ?  Is this PR resolved your issue ?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919108959/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919115588","html_url":"https://github.com/apache/iceberg/pull/2898#issuecomment-919115588","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2898","id":919115588,"node_id":"IC_kwDOCW7NX842yJdE","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T12:46:19Z","updated_at":"2021-09-14T12:46:19Z","author_association":"MEMBER","body":"@Reo-LEI Thanks for the contribution, sounds like I'm late for the reviewing.  Would you like to resolve the conflicts , I think I will get this reviewing tomorrow, thanks.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919115588/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919120375","html_url":"https://github.com/apache/iceberg/issues/3019#issuecomment-919120375","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3019","id":919120375,"node_id":"IC_kwDOCW7NX842yKn3","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T12:52:43Z","updated_at":"2021-09-14T12:52:43Z","author_association":"MEMBER","body":"The iceberg 0.12.0 was built on top of flink 1.12.0 version, which is implementing the flink1.12's  `DynamicTableSource`.  While the `DynamicTabelSource` was not introduced in flink 1.11.3.  So if you want to use the iceberg 0.12.0 , then you'd better to upgrade your flink cluster to flink 1.12.\r\n\r\nPlan to close this issue now,  feel free to reopen this if have more question, thanks !","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919120375/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919168138","html_url":"https://github.com/apache/iceberg/pull/3110#issuecomment-919168138","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3110","id":919168138,"node_id":"IC_kwDOCW7NX842yWSK","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T13:47:35Z","updated_at":"2021-09-14T13:47:35Z","author_association":"MEMBER","body":"Merged! Thanks everyone for looking into this! Should make CI easier until we get the real fix ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919168138/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919253483","html_url":"https://github.com/apache/iceberg/pull/2911#issuecomment-919253483","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2911","id":919253483,"node_id":"IC_kwDOCW7NX842yrHr","user":{"login":"coolderli","id":38486782,"node_id":"MDQ6VXNlcjM4NDg2Nzgy","avatar_url":"https://avatars.githubusercontent.com/u/38486782?v=4","gravatar_id":"","url":"https://api.github.com/users/coolderli","html_url":"https://github.com/coolderli","followers_url":"https://api.github.com/users/coolderli/followers","following_url":"https://api.github.com/users/coolderli/following{/other_user}","gists_url":"https://api.github.com/users/coolderli/gists{/gist_id}","starred_url":"https://api.github.com/users/coolderli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coolderli/subscriptions","organizations_url":"https://api.github.com/users/coolderli/orgs","repos_url":"https://api.github.com/users/coolderli/repos","events_url":"https://api.github.com/users/coolderli/events{/privacy}","received_events_url":"https://api.github.com/users/coolderli/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T15:19:56Z","updated_at":"2021-09-14T15:19:56Z","author_association":"CONTRIBUTOR","body":"cc @RussellSpitzer  @rdblue ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919253483/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919255465","html_url":"https://github.com/apache/iceberg/pull/2897#issuecomment-919255465","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2897","id":919255465,"node_id":"IC_kwDOCW7NX842yrmp","user":{"login":"coolderli","id":38486782,"node_id":"MDQ6VXNlcjM4NDg2Nzgy","avatar_url":"https://avatars.githubusercontent.com/u/38486782?v=4","gravatar_id":"","url":"https://api.github.com/users/coolderli","html_url":"https://github.com/coolderli","followers_url":"https://api.github.com/users/coolderli/followers","following_url":"https://api.github.com/users/coolderli/following{/other_user}","gists_url":"https://api.github.com/users/coolderli/gists{/gist_id}","starred_url":"https://api.github.com/users/coolderli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coolderli/subscriptions","organizations_url":"https://api.github.com/users/coolderli/orgs","repos_url":"https://api.github.com/users/coolderli/repos","events_url":"https://api.github.com/users/coolderli/events{/privacy}","received_events_url":"https://api.github.com/users/coolderli/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T15:21:57Z","updated_at":"2021-09-14T15:21:57Z","author_association":"CONTRIBUTOR","body":"cc @rdblue ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919255465/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919272970","html_url":"https://github.com/apache/iceberg/pull/2867#issuecomment-919272970","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2867","id":919272970,"node_id":"IC_kwDOCW7NX842yv4K","user":{"login":"stevenzwu","id":1545663,"node_id":"MDQ6VXNlcjE1NDU2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1545663?v=4","gravatar_id":"","url":"https://api.github.com/users/stevenzwu","html_url":"https://github.com/stevenzwu","followers_url":"https://api.github.com/users/stevenzwu/followers","following_url":"https://api.github.com/users/stevenzwu/following{/other_user}","gists_url":"https://api.github.com/users/stevenzwu/gists{/gist_id}","starred_url":"https://api.github.com/users/stevenzwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevenzwu/subscriptions","organizations_url":"https://api.github.com/users/stevenzwu/orgs","repos_url":"https://api.github.com/users/stevenzwu/repos","events_url":"https://api.github.com/users/stevenzwu/events{/privacy}","received_events_url":"https://api.github.com/users/stevenzwu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T15:41:25Z","updated_at":"2021-09-14T15:41:25Z","author_association":"CONTRIBUTOR","body":"> In this PR the rewriteAction of flink is parallel, it will not make data deal slow down.\r\n\r\n@hameizi by parallel, we meant multiple executors/tasks executing the rewrite. Last time I checked, this PR runs the whole rewrite action in the single committer task synchronously. that is the main scalability concern we have.\r\n\r\nAlso notifyCheckpointComplete (and snapshotState) executes in the mailbox thread. if it takes a long time to finish the notifyCheckpointComplete/rewrite, it can delay the checkpoint execution.\r\n\r\nI share the same philosophy as Jack on keep the streaming ingestion simple and stable. It is critical to **reliably** ingest data into long-term data storage (like Iceberg) first, as streaming input (like Kafka) typically has short retention.\r\n\r\n> [Handle the case that RewriteFiles and RowDelta commit the transaction at the same time #2308](https://github.com/apache/iceberg/issues/2308)\r\n\r\nregarding this issue, I agree that the lock steps of commit + compaction can avoid the problem. But it is not a solution for the general problem, because other users probably have compaction jobs like Spark. There are other more sophisticated compaction/rewrite actions that probably can't be supported by single-task rewrite action at scale.\r\n\r\n ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919272970/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919277576","html_url":"https://github.com/apache/iceberg/pull/2898#issuecomment-919277576","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2898","id":919277576,"node_id":"IC_kwDOCW7NX842yxAI","user":{"login":"Reo-LEI","id":17312872,"node_id":"MDQ6VXNlcjE3MzEyODcy","avatar_url":"https://avatars.githubusercontent.com/u/17312872?v=4","gravatar_id":"","url":"https://api.github.com/users/Reo-LEI","html_url":"https://github.com/Reo-LEI","followers_url":"https://api.github.com/users/Reo-LEI/followers","following_url":"https://api.github.com/users/Reo-LEI/following{/other_user}","gists_url":"https://api.github.com/users/Reo-LEI/gists{/gist_id}","starred_url":"https://api.github.com/users/Reo-LEI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Reo-LEI/subscriptions","organizations_url":"https://api.github.com/users/Reo-LEI/orgs","repos_url":"https://api.github.com/users/Reo-LEI/repos","events_url":"https://api.github.com/users/Reo-LEI/events{/privacy}","received_events_url":"https://api.github.com/users/Reo-LEI/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T15:46:28Z","updated_at":"2021-09-14T15:49:01Z","author_association":"CONTRIBUTOR","body":"> @Reo-LEI Thanks for the contribution, sounds like I'm late for the reviewing. Would you like to resolve the conflicts , I think I will get this reviewing tomorrow, thanks.\r\n\r\n@openinx Thanks for your reply. Since I discuss this PR with @kbendick  @stevenzwu, I think the implementation of setting `Filter` opr parallelism and use `CombinedKeySelector` to key by equality key and partition key maybe not a good way to reslove this problem. I'm plan to refactor this on this weeken, and maybe you could review this PR after that. :)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919277576/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919303222","html_url":"https://github.com/apache/iceberg/issues/3109#issuecomment-919303222","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3109","id":919303222,"node_id":"IC_kwDOCW7NX842y3Q2","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T16:15:24Z","updated_at":"2021-09-14T16:27:29Z","author_association":"CONTRIBUTOR","body":"Make sense. As @RussellSpitzer and me discussed before, the Spark build-in session catalog cannot list tables from Iceberg Hadoop type catalog. We cannot only rely on the the Spark build-in session catalog in that sense. This is a confusing behavior for the SparkSessionCatalog. Let's fix it.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919303222/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919354054","html_url":"https://github.com/apache/iceberg/issues/3109#issuecomment-919354054","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3109","id":919354054,"node_id":"IC_kwDOCW7NX842zDrG","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T17:17:08Z","updated_at":"2021-09-14T17:17:08Z","author_association":"MEMBER","body":"Maybe SparkSessionCatalog should have a special list behavior when the iceberg catalog is Hadoop or we just don't support Hadoop as a catalog type for session catalog?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919354054/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919394414","html_url":"https://github.com/apache/iceberg/pull/3111#issuecomment-919394414","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3111","id":919394414,"node_id":"IC_kwDOCW7NX842zNhu","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T18:08:59Z","updated_at":"2021-09-14T18:08:59Z","author_association":"CONTRIBUTOR","body":"Closing and reopening to force CI to run again","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919394414/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919412766","html_url":"https://github.com/apache/iceberg/issues/2488#issuecomment-919412766","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2488","id":919412766,"node_id":"IC_kwDOCW7NX842zSAe","user":{"login":"itachi-sharingan","id":16745229,"node_id":"MDQ6VXNlcjE2NzQ1MjI5","avatar_url":"https://avatars.githubusercontent.com/u/16745229?v=4","gravatar_id":"","url":"https://api.github.com/users/itachi-sharingan","html_url":"https://github.com/itachi-sharingan","followers_url":"https://api.github.com/users/itachi-sharingan/followers","following_url":"https://api.github.com/users/itachi-sharingan/following{/other_user}","gists_url":"https://api.github.com/users/itachi-sharingan/gists{/gist_id}","starred_url":"https://api.github.com/users/itachi-sharingan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itachi-sharingan/subscriptions","organizations_url":"https://api.github.com/users/itachi-sharingan/orgs","repos_url":"https://api.github.com/users/itachi-sharingan/repos","events_url":"https://api.github.com/users/itachi-sharingan/events{/privacy}","received_events_url":"https://api.github.com/users/itachi-sharingan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T18:33:11Z","updated_at":"2021-09-14T18:33:11Z","author_association":"CONTRIBUTOR","body":"There is a weird situation here, I think I know where to put the check but not sure I understand the problem correctly. Please bear with me:-\r\nSolution:\r\nPut a check in SparkSessionCatalog initialize function -> if option map contains key \"type\" as hive then there should not be a \"uri\" key in option.\r\n\r\nProblem(as far as I understand):-\r\n\r\n- if we configure two different thrift servers in Hadoop conf(i.e spark.hadoop.hive.metastore.uris) and iceberg cons(i.e spark.sql.catalog.spark_catalog.uri) then when try to create database the first one gets used and if try to create table then the second one gets used.\r\n\r\nThings I think I know:-\r\n\r\n- The uri configured in iceberg config(i.e spark.sql.catalog.spark_catalog.uri) always overrides the one in hadoop config(i.e spark.hadoop.hive.metastore.uris).\r\n- spark has a default catalog which acts as backup option(delegate catalog) if a particular table or database in spark sql ddl cannot be found in any new configured catalog metastore (given we have not configured spark_catalog itself).\r\n\r\nThings I am confused about:-\r\n- by configuring this - spark.sql.catalog.spark_catalog.uri=thrift://localhost:9083 and spark.sql.catalog.spark_catalog=org.apache.iceberg.spark.SparkSessionCatalog, are we actually overriding the default catalog for spark. So now there is no backup catalog.\r\n- are the namespace functions listed in SparkSessionCatalog class for databases, I am assuming in database = namespace, is this wrong? If yes, what is the difference between the two?\r\n- why are \"create database\" and \"create table\" queries going to two different thrift servers if hadoop conf and iceberg conf are different or only spark_catalog.uri is configured?\r\n\r\n@rdblue @RussellSpitzer can you guys pls help?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919412766/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919423650","html_url":"https://github.com/apache/iceberg/pull/3116#issuecomment-919423650","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3116","id":919423650,"node_id":"IC_kwDOCW7NX842zUqi","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T18:48:13Z","updated_at":"2021-09-15T06:03:36Z","author_association":"CONTRIBUTOR","body":"> 1. The options are not checked in `FlinkCatalogFactory.createCatalog()`, this is to be compatible with the old implementation. And this way we can use customized options as before without pre-settings.\r\n\r\n+1 to this. We have a number of customized options for things like AWS s3 / IAM etc that go on catalogs and we need to be able to support them.\r\n\r\n> 2. The implementation is not compatible with Flink 1.12 because CatalogFactory interface does not extend Factory interface in 1.12.\r\n\r\nDoes this mean we're dropping support entirely for Flink 1.12 in the next release (and effectively in the master branch)? This seems potentially premature. [I thought that the Flink 1.13 interface added `Factory`, but kept the old interface `TableFactory` as well that was extended in 1.12 for backwards compatibility.](https://github.com/apache/flink/blob/f74db4b6cce9a28f484dc9d5e6470a50b15c121a/flink-table/flink-table-common/src/main/java/org/apache/flink/table/factories/CatalogFactory.java#L40)\r\n\r\nIs it possible we can do the same (continue to implement both interfaces or have two separate classes) to keep support for Flink 1.12 @Flyangz?\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919423650/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919470004","html_url":"https://github.com/apache/iceberg/issues/2488#issuecomment-919470004","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2488","id":919470004,"node_id":"IC_kwDOCW7NX842zf-0","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T19:58:42Z","updated_at":"2021-09-14T19:58:42Z","author_association":"MEMBER","body":" 1. The issue is that by configuring spark-catalog.uri=... to something different than the default session value isn't that it overrides the value. We instead end up configuring two different metastore connections. One connection to the Spark Delegate metastore and one connection to the Iceberg metastore. During our function calls we switch between these two catalogs which has a lot of unexpected behaviors. For example making a database in one catalog without making it in the other which leads to the error I explained above.\r\n\r\n 2. Namespace is equivalent to \"database\" in this context. You can think of them as synonyms.\r\n\r\n 3. Like I mentioned in one, the underlying issue is that the delegate catalog uses one metastore and the IcebergCatalog uses another. So rather than checking the same metastore for Iceberg and then non Iceberg tables, we first check one catalog for Iceberg and then check a different catalog for non-Iceberg. \r\n So if I call \"Create Database\" this gets run on the Delegate Metastore, so now the delegate metastore has a new database. Now when I try to create an Iceberg table in that database, my requests are all routed to the Iceberg metastore where the database does not exist.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919470004/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919476134","html_url":"https://github.com/apache/iceberg/pull/2859#issuecomment-919476134","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2859","id":919476134,"node_id":"IC_kwDOCW7NX842zhem","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T20:07:52Z","updated_at":"2021-09-14T20:07:52Z","author_association":"CONTRIBUTOR","body":"Would appreciate your review on the new writers, @coolderli!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919476134/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919477057","html_url":"https://github.com/apache/iceberg/pull/2859#issuecomment-919477057","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2859","id":919477057,"node_id":"IC_kwDOCW7NX842zhtB","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T20:09:22Z","updated_at":"2021-09-14T20:09:51Z","author_association":"CONTRIBUTOR","body":"I think we got this covered in the new `WriterFactory` implementations where we call `setAll`.\r\nIs that why we closed this PR, @coolderli?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919477057/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919564894","html_url":"https://github.com/apache/iceberg/pull/2897#issuecomment-919564894","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2897","id":919564894,"node_id":"IC_kwDOCW7NX842z3Je","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T22:48:13Z","updated_at":"2021-09-14T22:48:13Z","author_association":"CONTRIBUTOR","body":"Thanks for reminding me, @coolderli! I'll merge this.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919564894/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919566128","html_url":"https://github.com/apache/iceberg/pull/2911#issuecomment-919566128","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2911","id":919566128,"node_id":"IC_kwDOCW7NX842z3cw","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T22:51:17Z","updated_at":"2021-09-14T22:51:17Z","author_association":"CONTRIBUTOR","body":"Looks good to me. Thanks for adding this to tests, @coolderli!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919566128/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919591765","html_url":"https://github.com/apache/iceberg/pull/2240#issuecomment-919591765","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2240","id":919591765,"node_id":"IC_kwDOCW7NX842z9tV","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T23:57:21Z","updated_at":"2021-09-14T23:57:21Z","author_association":"CONTRIBUTOR","body":"Looks great to me. Thanks for the work, @szehon-ho! I'll merge when tests pass.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919591765/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919626384","html_url":"https://github.com/apache/iceberg/issues/3109#issuecomment-919626384","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3109","id":919626384,"node_id":"IC_kwDOCW7NX8420GKQ","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T01:29:30Z","updated_at":"2021-09-15T01:29:30Z","author_association":"CONTRIBUTOR","body":"Won't hurt anything. And we probably need the similar changes for methods `listNamespaces`, `createNamespace`, `dropNamespace` and so on. We can borrow something code from class `SparkCatalog` for that.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919626384/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919636735","html_url":"https://github.com/apache/iceberg/pull/2916#issuecomment-919636735","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2916","id":919636735,"node_id":"IC_kwDOCW7NX8420Ir_","user":{"login":"hameizi","id":18445460,"node_id":"MDQ6VXNlcjE4NDQ1NDYw","avatar_url":"https://avatars.githubusercontent.com/u/18445460?v=4","gravatar_id":"","url":"https://api.github.com/users/hameizi","html_url":"https://github.com/hameizi","followers_url":"https://api.github.com/users/hameizi/followers","following_url":"https://api.github.com/users/hameizi/following{/other_user}","gists_url":"https://api.github.com/users/hameizi/gists{/gist_id}","starred_url":"https://api.github.com/users/hameizi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hameizi/subscriptions","organizations_url":"https://api.github.com/users/hameizi/orgs","repos_url":"https://api.github.com/users/hameizi/repos","events_url":"https://api.github.com/users/hameizi/events{/privacy}","received_events_url":"https://api.github.com/users/hameizi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T02:00:07Z","updated_at":"2021-09-15T02:00:07Z","author_association":"CONTRIBUTOR","body":"@kbendick Could you help review continue?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919636735/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919642056","html_url":"https://github.com/apache/iceberg/issues/3025#issuecomment-919642056","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3025","id":919642056,"node_id":"IC_kwDOCW7NX8420J_I","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T02:12:13Z","updated_at":"2021-09-15T02:12:13Z","author_association":"MEMBER","body":"@dmgcodevil Yes, that's the correct behavior in apache iceberg table metadata,  what's the reason that you want to keep the use-defined field id in the persistent iceberg table metadata ? ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919642056/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919645696","html_url":"https://github.com/apache/iceberg/issues/3026#issuecomment-919645696","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3026","id":919645696,"node_id":"IC_kwDOCW7NX8420K4A","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T02:20:55Z","updated_at":"2021-09-15T02:20:55Z","author_association":"MEMBER","body":"Could you please give more information about how would you like to use the truncate#width to create a ranger partition ? I did not quite understand your case actually. Thanks.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919645696/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919652871","html_url":"https://github.com/apache/iceberg/issues/2558#issuecomment-919652871","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2558","id":919652871,"node_id":"IC_kwDOCW7NX8420MoH","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T02:40:49Z","updated_at":"2021-09-15T02:40:49Z","author_association":"MEMBER","body":"Thanks @kbendick for reporting the hadoop dependencies issue,  it's indeed a problem which we've also encountered in our own aliyun iceberg datalake.  So I have filed a new issue to address this: https://github.com/apache/iceberg/issues/3117","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919652871/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919661346","html_url":"https://github.com/apache/iceberg/issues/2645#issuecomment-919661346","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2645","id":919661346,"node_id":"IC_kwDOCW7NX8420Osi","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T03:05:36Z","updated_at":"2021-09-15T03:05:36Z","author_association":"MEMBER","body":"@sfiend ,  It's good to implement the LookupTableSource for flink iceberg connector, so  that we could maintain the dimension table into apache iceberg table also.   The primary key in iceberg was designed to improve the query performance and maintain the deduplicate semantics but it was not indexed,  so in theory iceberg table is still not suitable to maintain too large dimension table. But I still like to see that the iceberg connector support `LookupTableSource`.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919661346/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919662733","html_url":"https://github.com/apache/iceberg/pull/2860#issuecomment-919662733","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2860","id":919662733,"node_id":"IC_kwDOCW7NX8420PCN","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T03:09:02Z","updated_at":"2021-09-15T03:09:02Z","author_association":"MEMBER","body":"FYI @pvary ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919662733/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919666864","html_url":"https://github.com/apache/iceberg/pull/3120#issuecomment-919666864","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3120","id":919666864,"node_id":"IC_kwDOCW7NX8420QCw","user":{"login":"Reo-LEI","id":17312872,"node_id":"MDQ6VXNlcjE3MzEyODcy","avatar_url":"https://avatars.githubusercontent.com/u/17312872?v=4","gravatar_id":"","url":"https://api.github.com/users/Reo-LEI","html_url":"https://github.com/Reo-LEI","followers_url":"https://api.github.com/users/Reo-LEI/followers","following_url":"https://api.github.com/users/Reo-LEI/following{/other_user}","gists_url":"https://api.github.com/users/Reo-LEI/gists{/gist_id}","starred_url":"https://api.github.com/users/Reo-LEI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Reo-LEI/subscriptions","organizations_url":"https://api.github.com/users/Reo-LEI/orgs","repos_url":"https://api.github.com/users/Reo-LEI/repos","events_url":"https://api.github.com/users/Reo-LEI/events{/privacy}","received_events_url":"https://api.github.com/users/Reo-LEI/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T03:19:54Z","updated_at":"2021-09-15T03:19:54Z","author_association":"CONTRIBUTOR","body":"@rdblue @aokolnychyi @kbendick @openinx @stevenzwu Could you take a look of this? :)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919666864/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919723916","html_url":"https://github.com/apache/iceberg/pull/3116#issuecomment-919723916","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3116","id":919723916,"node_id":"IC_kwDOCW7NX8420d-M","user":{"login":"wg1026688210","id":14267759,"node_id":"MDQ6VXNlcjE0MjY3NzU5","avatar_url":"https://avatars.githubusercontent.com/u/14267759?v=4","gravatar_id":"","url":"https://api.github.com/users/wg1026688210","html_url":"https://github.com/wg1026688210","followers_url":"https://api.github.com/users/wg1026688210/followers","following_url":"https://api.github.com/users/wg1026688210/following{/other_user}","gists_url":"https://api.github.com/users/wg1026688210/gists{/gist_id}","starred_url":"https://api.github.com/users/wg1026688210/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wg1026688210/subscriptions","organizations_url":"https://api.github.com/users/wg1026688210/orgs","repos_url":"https://api.github.com/users/wg1026688210/repos","events_url":"https://api.github.com/users/wg1026688210/events{/privacy}","received_events_url":"https://api.github.com/users/wg1026688210/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T05:59:49Z","updated_at":"2021-09-15T05:59:49Z","author_association":"CONTRIBUTOR","body":"we do not have the plan of improving flink  to  1.13 recently, is there a way to support both 1.12 and 1.13 versions.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919723916/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919725987","html_url":"https://github.com/apache/iceberg/pull/3116#issuecomment-919725987","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3116","id":919725987,"node_id":"IC_kwDOCW7NX8420eej","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T06:04:33Z","updated_at":"2021-09-15T06:05:28Z","author_association":"CONTRIBUTOR","body":"> we do not have the plan of improving flink to 1.13 recently, is there a way to support both 1.12 and 1.13 versions.\r\n\r\nI believe that @zhangjun0x01's original PR supported both flink 1.12 and flink 1.13. Like I mentioned, if the `FlinkCatalogFactory` implements both APIs, will that not suffice to support both 1.12 and 1.13?\r\n\r\nDropping support for Flink 1.12 is a big decision in my opinion, and should be brought up on the mailing list or at the community sync-up.\r\n\r\nDoes my idea of continuing to implement `TableFactory`, in addition to adding the newer `Factory` interface functions, just like [Flink's `CatalogFactory` does itself ](https://github.com/apache/flink/blob/f74db4b6cce9a28f484dc9d5e6470a50b15c121a/flink-table/flink-table-common/src/main/java/org/apache/flink/table/factories/CatalogFactory.java#L40) not work? I thought that was why Flink's `CatalogFactory` implemented both the old interface and the new interface, to mark the old interface as deprecated but still support both versions.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919725987/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919729702","html_url":"https://github.com/apache/iceberg/issues/3112#issuecomment-919729702","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3112","id":919729702,"node_id":"IC_kwDOCW7NX8420fYm","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T06:12:06Z","updated_at":"2021-09-15T06:12:06Z","author_association":"CONTRIBUTOR","body":"I think placing the +2 is a decent idea, if that works.\r\n\r\nIf we disable the +2 from the checks, will the test then fail on situations where it was currently stuck in an infinite loop?\r\n\r\nI also noticed that there is a callback for checkpoint aborted events. Could we possibly hook into that and on failure check if the union of checkpoint events and events yet to be checkpoint is complete for only 1 of the 2 topologies? Seems really flakey, but maybe you can think of something better than I can for the checkpoint aborted exceptions.\r\n\r\nIf disabling the +2 wouldn't leave the test flakey, I 100% support that decision.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919729702/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919730456","html_url":"https://github.com/apache/iceberg/issues/3112#issuecomment-919730456","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3112","id":919730456,"node_id":"IC_kwDOCW7NX8420fkY","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T06:13:31Z","updated_at":"2021-09-15T06:13:31Z","author_association":"CONTRIBUTOR","body":"Actually\r\n\r\n**TLDR** Since FLIP-147 will remove this issue, I think adding the flag is a good idea. If it leads to flakey tests, we'll then ignore the test again. But there's not really much way to know if it will lead to a flakey test or not without running it in full CI (as I've never been able to replicate this bug outside of CI).","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919730456/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919745677","html_url":"https://github.com/apache/iceberg/issues/3122#issuecomment-919745677","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3122","id":919745677,"node_id":"IC_kwDOCW7NX8420jSN","user":{"login":"jun-he","id":12246263,"node_id":"MDQ6VXNlcjEyMjQ2MjYz","avatar_url":"https://avatars.githubusercontent.com/u/12246263?v=4","gravatar_id":"","url":"https://api.github.com/users/jun-he","html_url":"https://github.com/jun-he","followers_url":"https://api.github.com/users/jun-he/followers","following_url":"https://api.github.com/users/jun-he/following{/other_user}","gists_url":"https://api.github.com/users/jun-he/gists{/gist_id}","starred_url":"https://api.github.com/users/jun-he/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jun-he/subscriptions","organizations_url":"https://api.github.com/users/jun-he/orgs","repos_url":"https://api.github.com/users/jun-he/repos","events_url":"https://api.github.com/users/jun-he/events{/privacy}","received_events_url":"https://api.github.com/users/jun-he/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T06:45:35Z","updated_at":"2021-09-15T06:45:35Z","author_association":"COLLABORATOR","body":"related PR: https://github.com/apache/iceberg/pull/3074","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919745677/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919749284","html_url":"https://github.com/apache/iceberg/issues/3112#issuecomment-919749284","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3112","id":919749284,"node_id":"IC_kwDOCW7NX8420kKk","user":{"login":"stevenzwu","id":1545663,"node_id":"MDQ6VXNlcjE1NDU2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1545663?v=4","gravatar_id":"","url":"https://api.github.com/users/stevenzwu","html_url":"https://github.com/stevenzwu","followers_url":"https://api.github.com/users/stevenzwu/followers","following_url":"https://api.github.com/users/stevenzwu/following{/other_user}","gists_url":"https://api.github.com/users/stevenzwu/gists{/gist_id}","starred_url":"https://api.github.com/users/stevenzwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevenzwu/subscriptions","organizations_url":"https://api.github.com/users/stevenzwu/orgs","repos_url":"https://api.github.com/users/stevenzwu/repos","events_url":"https://api.github.com/users/stevenzwu/events{/privacy}","received_events_url":"https://api.github.com/users/stevenzwu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T06:52:53Z","updated_at":"2021-09-15T06:52:53Z","author_association":"CONTRIBUTOR","body":"Yeah. I tried to run the `TestFlinkIcebergSink` single test class in a loop locally and couldn't reproduce the problem. This make it difficult to have confidence to verify the fix.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919749284/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919755305","html_url":"https://github.com/apache/iceberg/issues/3121#issuecomment-919755305","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3121","id":919755305,"node_id":"IC_kwDOCW7NX8420lop","user":{"login":"flyxu1991","id":72590534,"node_id":"MDQ6VXNlcjcyNTkwNTM0","avatar_url":"https://avatars.githubusercontent.com/u/72590534?v=4","gravatar_id":"","url":"https://api.github.com/users/flyxu1991","html_url":"https://github.com/flyxu1991","followers_url":"https://api.github.com/users/flyxu1991/followers","following_url":"https://api.github.com/users/flyxu1991/following{/other_user}","gists_url":"https://api.github.com/users/flyxu1991/gists{/gist_id}","starred_url":"https://api.github.com/users/flyxu1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyxu1991/subscriptions","organizations_url":"https://api.github.com/users/flyxu1991/orgs","repos_url":"https://api.github.com/users/flyxu1991/repos","events_url":"https://api.github.com/users/flyxu1991/events{/privacy}","received_events_url":"https://api.github.com/users/flyxu1991/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T07:03:52Z","updated_at":"2021-09-15T07:03:52Z","author_association":"NONE","body":"Don't table-format v2 support streaming read?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919755305/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919756373","html_url":"https://github.com/apache/iceberg/pull/2859#issuecomment-919756373","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2859","id":919756373,"node_id":"IC_kwDOCW7NX8420l5V","user":{"login":"coolderli","id":38486782,"node_id":"MDQ6VXNlcjM4NDg2Nzgy","avatar_url":"https://avatars.githubusercontent.com/u/38486782?v=4","gravatar_id":"","url":"https://api.github.com/users/coolderli","html_url":"https://github.com/coolderli","followers_url":"https://api.github.com/users/coolderli/followers","following_url":"https://api.github.com/users/coolderli/following{/other_user}","gists_url":"https://api.github.com/users/coolderli/gists{/gist_id}","starred_url":"https://api.github.com/users/coolderli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coolderli/subscriptions","organizations_url":"https://api.github.com/users/coolderli/orgs","repos_url":"https://api.github.com/users/coolderli/repos","events_url":"https://api.github.com/users/coolderli/events{/privacy}","received_events_url":"https://api.github.com/users/coolderli/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T07:05:43Z","updated_at":"2021-09-15T07:05:43Z","author_association":"CONTRIBUTOR","body":"> I think we got this covered in the new `WriterFactory` implementations where we call `setAll`.\r\n> Is that why we closed this PR, @coolderli?\r\n\r\nYes, I think the new `WriterFactory` has covered this case.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919756373/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919770830","html_url":"https://github.com/apache/iceberg/pull/3067#issuecomment-919770830","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3067","id":919770830,"node_id":"IC_kwDOCW7NX8420pbO","user":{"login":"xingbowu","id":12458911,"node_id":"MDQ6VXNlcjEyNDU4OTEx","avatar_url":"https://avatars.githubusercontent.com/u/12458911?v=4","gravatar_id":"","url":"https://api.github.com/users/xingbowu","html_url":"https://github.com/xingbowu","followers_url":"https://api.github.com/users/xingbowu/followers","following_url":"https://api.github.com/users/xingbowu/following{/other_user}","gists_url":"https://api.github.com/users/xingbowu/gists{/gist_id}","starred_url":"https://api.github.com/users/xingbowu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xingbowu/subscriptions","organizations_url":"https://api.github.com/users/xingbowu/orgs","repos_url":"https://api.github.com/users/xingbowu/repos","events_url":"https://api.github.com/users/xingbowu/events{/privacy}","received_events_url":"https://api.github.com/users/xingbowu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T07:29:32Z","updated_at":"2021-09-15T07:29:32Z","author_association":"CONTRIBUTOR","body":"@openinx  Thanks for your effort and comments, I have reworked them with latest code, feel free to take further review","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919770830/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919874995","html_url":"https://github.com/apache/iceberg/pull/2731#issuecomment-919874995","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2731","id":919874995,"node_id":"IC_kwDOCW7NX8421C2z","user":{"login":"Reo-LEI","id":17312872,"node_id":"MDQ6VXNlcjE3MzEyODcy","avatar_url":"https://avatars.githubusercontent.com/u/17312872?v=4","gravatar_id":"","url":"https://api.github.com/users/Reo-LEI","html_url":"https://github.com/Reo-LEI","followers_url":"https://api.github.com/users/Reo-LEI/followers","following_url":"https://api.github.com/users/Reo-LEI/following{/other_user}","gists_url":"https://api.github.com/users/Reo-LEI/gists{/gist_id}","starred_url":"https://api.github.com/users/Reo-LEI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Reo-LEI/subscriptions","organizations_url":"https://api.github.com/users/Reo-LEI/orgs","repos_url":"https://api.github.com/users/Reo-LEI/repos","events_url":"https://api.github.com/users/Reo-LEI/events{/privacy}","received_events_url":"https://api.github.com/users/Reo-LEI/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T09:56:37Z","updated_at":"2021-09-15T09:58:46Z","author_association":"CONTRIBUTOR","body":"Since iceberg v2 expose by 0.12, more and more user encounter this problem. I think we should increase the priority of this RP and let it merge into master as soon as possible. \r\n\r\nIf you don't have time to deal with this PR, I think I could pick this up and keep it in progress. :) @openinx","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919874995/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919921681","html_url":"https://github.com/apache/iceberg/pull/2731#issuecomment-919921681","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2731","id":919921681,"node_id":"IC_kwDOCW7NX8421OQR","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T11:06:18Z","updated_at":"2021-09-15T11:06:18Z","author_association":"MEMBER","body":"@Reo-LEI ,  Pls go ahead.  I can be the candidate reviewer for the PR, thanks. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919921681/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919922803","html_url":"https://github.com/apache/iceberg/issues/3121#issuecomment-919922803","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3121","id":919922803,"node_id":"IC_kwDOCW7NX8421Ohz","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T11:07:54Z","updated_at":"2021-09-15T11:07:54Z","author_association":"MEMBER","body":"Yes, the current format v2 don't support streaming read now.  The stacktrace is a bug which was addressed in this PR: https://github.com/apache/iceberg/pull/2731","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/919922803/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920190869","html_url":"https://github.com/apache/iceberg/issues/3112#issuecomment-920190869","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3112","id":920190869,"node_id":"IC_kwDOCW7NX8422P-V","user":{"login":"stevenzwu","id":1545663,"node_id":"MDQ6VXNlcjE1NDU2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1545663?v=4","gravatar_id":"","url":"https://api.github.com/users/stevenzwu","html_url":"https://github.com/stevenzwu","followers_url":"https://api.github.com/users/stevenzwu/followers","following_url":"https://api.github.com/users/stevenzwu/following{/other_user}","gists_url":"https://api.github.com/users/stevenzwu/gists{/gist_id}","starred_url":"https://api.github.com/users/stevenzwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevenzwu/subscriptions","organizations_url":"https://api.github.com/users/stevenzwu/orgs","repos_url":"https://api.github.com/users/stevenzwu/repos","events_url":"https://api.github.com/users/stevenzwu/events{/privacy}","received_events_url":"https://api.github.com/users/stevenzwu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T16:49:19Z","updated_at":"2021-09-15T16:49:19Z","author_association":"CONTRIBUTOR","body":"@kbendick I thought more about your proposal of notifyCheckpointAborted. I think it might be the more reliable solution.\r\n\r\nremoving the extra checkpoint wait may still suffer the same race condition. When one source is running and emitting record, the other source may already finished.\r\n\r\n```\r\n      final int checkpointToAwait;\r\n      synchronized (ctx.getCheckpointLock()) {\r\n        checkpointToAwait = numCheckpointsComplete.get() + 1 + idleCheckpointCyclesPerStep;\r\n        for (T element : elementsPerCheckpoint.get(checkpoint)) {\r\n          ctx.collect(element);\r\n        }\r\n      }\r\n\r\n      synchronized (ctx.getCheckpointLock()) {\r\n        while (running && numCheckpointsComplete.get() < checkpointToAwait) {\r\n          ctx.getCheckpointLock().wait(1);\r\n        }\r\n      }\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920190869/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920282625","html_url":"https://github.com/apache/iceberg/pull/3126#issuecomment-920282625","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3126","id":920282625,"node_id":"IC_kwDOCW7NX8422mYB","user":{"login":"itachi-sharingan","id":16745229,"node_id":"MDQ6VXNlcjE2NzQ1MjI5","avatar_url":"https://avatars.githubusercontent.com/u/16745229?v=4","gravatar_id":"","url":"https://api.github.com/users/itachi-sharingan","html_url":"https://github.com/itachi-sharingan","followers_url":"https://api.github.com/users/itachi-sharingan/followers","following_url":"https://api.github.com/users/itachi-sharingan/following{/other_user}","gists_url":"https://api.github.com/users/itachi-sharingan/gists{/gist_id}","starred_url":"https://api.github.com/users/itachi-sharingan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itachi-sharingan/subscriptions","organizations_url":"https://api.github.com/users/itachi-sharingan/orgs","repos_url":"https://api.github.com/users/itachi-sharingan/repos","events_url":"https://api.github.com/users/itachi-sharingan/events{/privacy}","received_events_url":"https://api.github.com/users/itachi-sharingan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T18:39:49Z","updated_at":"2021-09-15T18:39:49Z","author_association":"CONTRIBUTOR","body":"closes #2488","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920282625/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920286924","html_url":"https://github.com/apache/iceberg/issues/2488#issuecomment-920286924","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2488","id":920286924,"node_id":"IC_kwDOCW7NX8422nbM","user":{"login":"itachi-sharingan","id":16745229,"node_id":"MDQ6VXNlcjE2NzQ1MjI5","avatar_url":"https://avatars.githubusercontent.com/u/16745229?v=4","gravatar_id":"","url":"https://api.github.com/users/itachi-sharingan","html_url":"https://github.com/itachi-sharingan","followers_url":"https://api.github.com/users/itachi-sharingan/followers","following_url":"https://api.github.com/users/itachi-sharingan/following{/other_user}","gists_url":"https://api.github.com/users/itachi-sharingan/gists{/gist_id}","starred_url":"https://api.github.com/users/itachi-sharingan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itachi-sharingan/subscriptions","organizations_url":"https://api.github.com/users/itachi-sharingan/orgs","repos_url":"https://api.github.com/users/itachi-sharingan/repos","events_url":"https://api.github.com/users/itachi-sharingan/events{/privacy}","received_events_url":"https://api.github.com/users/itachi-sharingan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T18:44:02Z","updated_at":"2021-09-15T18:44:02Z","author_association":"CONTRIBUTOR","body":"@RussellSpitzer thanks a lot for the clarification, can you please review the pr.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920286924/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920319891","html_url":"https://github.com/apache/iceberg/pull/3111#issuecomment-920319891","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3111","id":920319891,"node_id":"IC_kwDOCW7NX8422veT","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T19:35:31Z","updated_at":"2021-09-15T19:35:31Z","author_association":"MEMBER","body":"Thanks! Closed this out so we won't generate 100mb of logs for every run :)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920319891/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920467808","html_url":"https://github.com/apache/iceberg/issues/3118#issuecomment-920467808","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3118","id":920467808,"node_id":"IC_kwDOCW7NX8423Tlg","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T23:51:08Z","updated_at":"2021-09-15T23:51:08Z","author_association":"CONTRIBUTOR","body":"Are you sure that this is the right approach? It seems to me that if you have so many delete files that you need to read them in parallel, that you should rewrite and merge the delete files into data files. Optimizing for a large number of delete files doesn't seem like a good idea to me.\r\n\r\nI'm interested to hear what @stevenzwu, @openinx, @jackye1995, @aokolnychyi, and @RussellSpitzer think, too.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920467808/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920477110","html_url":"https://github.com/apache/iceberg/pull/2957#issuecomment-920477110","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2957","id":920477110,"node_id":"IC_kwDOCW7NX8423V22","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-16T00:13:57Z","updated_at":"2021-09-16T00:13:57Z","author_association":"CONTRIBUTOR","body":"I was imagining the builder would work a little differently. There's definitely some value in the regular builder pattern where you can mostly copy fields and just make calls to change values. But I think adding a builder could bring more value if we actually moved the implementations of the `TableMetadata` modifications into the builder. So what I was thinking was to basically move all of the methods like `replaceCurrentSnapshot` and `removeSnapshotsIf` into the builder itself.\r\n\r\nThat approach allows us to make more than one change without adding special handling for `upgradeToFormatVersion`. We could chain changes to produce a new `TableMetadata` because the methods keep track of table state.\r\n\r\nA second benefit that I'm interested in is tracking the high-level changes the led to a new `TableMetadata` object. We're building a REST-based catalog and I think this is the first step to an update that posts just what changed. For example, `replaceCurrentSnapshot` could produce a new `TableMetadata`, but also keep track of the facts that (1) a new snapshot was added and (2) the current snapshot was set to that snapshot's ID. Those granular changes make a REST protocol much more efficient.\r\n\r\nDoes that motivation make sense?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920477110/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920536151","html_url":"https://github.com/apache/iceberg/issues/3118#issuecomment-920536151","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3118","id":920536151,"node_id":"IC_kwDOCW7NX8423kRX","user":{"login":"Reo-LEI","id":17312872,"node_id":"MDQ6VXNlcjE3MzEyODcy","avatar_url":"https://avatars.githubusercontent.com/u/17312872?v=4","gravatar_id":"","url":"https://api.github.com/users/Reo-LEI","html_url":"https://github.com/Reo-LEI","followers_url":"https://api.github.com/users/Reo-LEI/followers","following_url":"https://api.github.com/users/Reo-LEI/following{/other_user}","gists_url":"https://api.github.com/users/Reo-LEI/gists{/gist_id}","starred_url":"https://api.github.com/users/Reo-LEI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Reo-LEI/subscriptions","organizations_url":"https://api.github.com/users/Reo-LEI/orgs","repos_url":"https://api.github.com/users/Reo-LEI/repos","events_url":"https://api.github.com/users/Reo-LEI/events{/privacy}","received_events_url":"https://api.github.com/users/Reo-LEI/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-16T02:57:20Z","updated_at":"2021-09-16T02:57:54Z","author_association":"CONTRIBUTOR","body":"> Are you sure that this is the right approach? It seems to me that if you have so many delete files that you need to read them in parallel, that you should rewrite and merge the delete files into data files.\r\n\r\n@rdblue I think this optimization is needed. On the one hand, user usually need to query the latest data in streaming case, And these data may not have been rewritten yet. On the other hand,  as you said, the best way is to rewrite and merge the delete files into data files, but the rewrite is depend on read. So we should optimizing the `DeleteFilter` and read delete files in parallel to speed up the read and rewrite. \r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920536151/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920547971","html_url":"https://github.com/apache/iceberg/issues/3118#issuecomment-920547971","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3118","id":920547971,"node_id":"IC_kwDOCW7NX8423nKD","user":{"login":"Reo-LEI","id":17312872,"node_id":"MDQ6VXNlcjE3MzEyODcy","avatar_url":"https://avatars.githubusercontent.com/u/17312872?v=4","gravatar_id":"","url":"https://api.github.com/users/Reo-LEI","html_url":"https://github.com/Reo-LEI","followers_url":"https://api.github.com/users/Reo-LEI/followers","following_url":"https://api.github.com/users/Reo-LEI/following{/other_user}","gists_url":"https://api.github.com/users/Reo-LEI/gists{/gist_id}","starred_url":"https://api.github.com/users/Reo-LEI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Reo-LEI/subscriptions","organizations_url":"https://api.github.com/users/Reo-LEI/orgs","repos_url":"https://api.github.com/users/Reo-LEI/repos","events_url":"https://api.github.com/users/Reo-LEI/events{/privacy}","received_events_url":"https://api.github.com/users/Reo-LEI/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-16T03:31:00Z","updated_at":"2021-09-16T03:32:06Z","author_association":"CONTRIBUTOR","body":"Actually, in our production environment, we sync our mysql data to iceberg v2 by flink. I do some test of this optimization by spark rewrite action on these v2 table. And we found this optimization is more than 2 times faster to execute than before.\r\n\r\ncaseId | dataFile number | dataFile + deleteFile number | deleteFile read parallelism | target file size | executor number | executor-core number | spark job task number | elapsed time(min) | task min elapsed time  | task median elapsed time | task max elapsed time\r\n-- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- | -- \r\n1 | 755 | 2585 | 1 | 100MB | 4 | 1 | 4 | 456 | 33s | 1.5m | 7.6h\r\n2 | 755 | 2585 | 10 | 100MB | 4 | 1 | 4 | 168 | 26s | 37s | 2.8h","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920547971/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920552114","html_url":"https://github.com/apache/iceberg/issues/3118#issuecomment-920552114","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3118","id":920552114,"node_id":"IC_kwDOCW7NX8423oKy","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-16T03:44:40Z","updated_at":"2021-09-16T03:44:40Z","author_association":"CONTRIBUTOR","body":"Just to confirm, @Reo-LEI are you mostly doing this through Flink?\r\n\r\nI am asking because I think currently we have the following dilemma: delete files are mostly generated by CDC pipelines in Flink, but rewrite functionality is not yet ready for delete files, and even if it's ready it's in Spark.\r\n\r\n#2867 is another PR that tries to tackle the same root issue in a different way.\r\n\r\nWe definitely need to speed up the delete compaction progress, making it the top of the top priority. On the other side,  I think we should start considering developing some actions in Flink to run compaction natively. Maybe the second compactor in streaming pipeline approach is not avoidable although a bit complex.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920552114/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920563513","html_url":"https://github.com/apache/iceberg/issues/3118#issuecomment-920563513","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3118","id":920563513,"node_id":"IC_kwDOCW7NX8423q85","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-16T04:20:14Z","updated_at":"2021-09-16T04:20:14Z","author_association":"CONTRIBUTOR","body":"And just curious, it looks like the code is running in the same application as #2680 , is your benchmark based on the in memory map or this rock DB backed map?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/920563513/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]