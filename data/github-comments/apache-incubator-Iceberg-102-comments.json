[{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/885897261","html_url":"https://github.com/apache/iceberg/issues/2696#issuecomment-885897261","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2696","id":885897261,"node_id":"IC_kwDOCW7NX840zbgt","user":{"login":"WesternStar","id":728451,"node_id":"MDQ6VXNlcjcyODQ1MQ==","avatar_url":"https://avatars.githubusercontent.com/u/728451?v=4","gravatar_id":"","url":"https://api.github.com/users/WesternStar","html_url":"https://github.com/WesternStar","followers_url":"https://api.github.com/users/WesternStar/followers","following_url":"https://api.github.com/users/WesternStar/following{/other_user}","gists_url":"https://api.github.com/users/WesternStar/gists{/gist_id}","starred_url":"https://api.github.com/users/WesternStar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WesternStar/subscriptions","organizations_url":"https://api.github.com/users/WesternStar/orgs","repos_url":"https://api.github.com/users/WesternStar/repos","events_url":"https://api.github.com/users/WesternStar/events{/privacy}","received_events_url":"https://api.github.com/users/WesternStar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-23T20:28:29Z","updated_at":"2021-07-23T20:28:29Z","author_association":"NONE","body":"I was compiling the iceberg binaries myself and I was using java 11 instead of 8 I think that was the issue that broke it for me.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/885897261/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/885923681","html_url":"https://github.com/apache/iceberg/pull/2851#issuecomment-885923681","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2851","id":885923681,"node_id":"IC_kwDOCW7NX840zh9h","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-23T21:29:38Z","updated_at":"2021-07-23T21:46:15Z","author_association":"CONTRIBUTOR","body":"Thanks, everyone! I merged this to unblock subsequent PRs.\r\nLet me know if I missed any points. I'll address them in a separate PR.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/885923681/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/885935538","html_url":"https://github.com/apache/iceberg/pull/2857#issuecomment-885935538","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2857","id":885935538,"node_id":"IC_kwDOCW7NX840zk2y","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-23T22:02:18Z","updated_at":"2021-07-23T22:02:31Z","author_association":"CONTRIBUTOR","body":"cc @RussellSpitzer @rdblue @openinx @yyanyy @jackye1995 ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/885935538/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/885962685","html_url":"https://github.com/apache/iceberg/pull/2857#issuecomment-885962685","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2857","id":885962685,"node_id":"IC_kwDOCW7NX840zre9","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-23T23:37:54Z","updated_at":"2021-07-23T23:44:06Z","author_association":"CONTRIBUTOR","body":"@kbendick, each introduced data writer builder exposes methods `set` and `setAll` that internally call the corresponding methods in `WriteBuilder`. So you should be able to pass any configuration just like before.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/885962685/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/885965089","html_url":"https://github.com/apache/iceberg/pull/2841#issuecomment-885965089","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2841","id":885965089,"node_id":"IC_kwDOCW7NX840zsEh","user":{"login":"chenjunjiedada","id":3960228,"node_id":"MDQ6VXNlcjM5NjAyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3960228?v=4","gravatar_id":"","url":"https://api.github.com/users/chenjunjiedada","html_url":"https://github.com/chenjunjiedada","followers_url":"https://api.github.com/users/chenjunjiedada/followers","following_url":"https://api.github.com/users/chenjunjiedada/following{/other_user}","gists_url":"https://api.github.com/users/chenjunjiedada/gists{/gist_id}","starred_url":"https://api.github.com/users/chenjunjiedada/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenjunjiedada/subscriptions","organizations_url":"https://api.github.com/users/chenjunjiedada/orgs","repos_url":"https://api.github.com/users/chenjunjiedada/repos","events_url":"https://api.github.com/users/chenjunjiedada/events{/privacy}","received_events_url":"https://api.github.com/users/chenjunjiedada/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-23T23:49:54Z","updated_at":"2021-07-23T23:49:54Z","author_association":"COLLABORATOR","body":"@rdblue @aokolnychyi @openinx You may want to take a look as well.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/885965089/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/885979238","html_url":"https://github.com/apache/iceberg/pull/2857#issuecomment-885979238","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2857","id":885979238,"node_id":"IC_kwDOCW7NX840zvhm","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-24T01:03:54Z","updated_at":"2021-07-24T01:03:54Z","author_association":"CONTRIBUTOR","body":"Thanks, folks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/885979238/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/885981616","html_url":"https://github.com/apache/iceberg/pull/2858#issuecomment-885981616","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2858","id":885981616,"node_id":"IC_kwDOCW7NX840zwGw","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-24T01:23:52Z","updated_at":"2021-07-24T01:23:52Z","author_association":"CONTRIBUTOR","body":"cc @pvary @RussellSpitzer @rdblue @openinx @jun-he @yyanyy @jackye1995 @flyrain @kbendick @karuppayya ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/885981616/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886000852","html_url":"https://github.com/apache/iceberg/pull/2858#issuecomment-886000852","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2858","id":886000852,"node_id":"IC_kwDOCW7NX840z0zU","user":{"login":"pvary","id":19705742,"node_id":"MDQ6VXNlcjE5NzA1NzQy","avatar_url":"https://avatars.githubusercontent.com/u/19705742?v=4","gravatar_id":"","url":"https://api.github.com/users/pvary","html_url":"https://github.com/pvary","followers_url":"https://api.github.com/users/pvary/followers","following_url":"https://api.github.com/users/pvary/following{/other_user}","gists_url":"https://api.github.com/users/pvary/gists{/gist_id}","starred_url":"https://api.github.com/users/pvary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvary/subscriptions","organizations_url":"https://api.github.com/users/pvary/orgs","repos_url":"https://api.github.com/users/pvary/repos","events_url":"https://api.github.com/users/pvary/events{/privacy}","received_events_url":"https://api.github.com/users/pvary/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-24T05:04:57Z","updated_at":"2021-07-24T05:04:57Z","author_association":"CONTRIBUTOR","body":"I am OK with the Hive changes.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886000852/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886186358","html_url":"https://github.com/apache/iceberg/pull/2862#issuecomment-886186358","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2862","id":886186358,"node_id":"IC_kwDOCW7NX8400iF2","user":{"login":"Reo-LEI","id":17312872,"node_id":"MDQ6VXNlcjE3MzEyODcy","avatar_url":"https://avatars.githubusercontent.com/u/17312872?v=4","gravatar_id":"","url":"https://api.github.com/users/Reo-LEI","html_url":"https://github.com/Reo-LEI","followers_url":"https://api.github.com/users/Reo-LEI/followers","following_url":"https://api.github.com/users/Reo-LEI/following{/other_user}","gists_url":"https://api.github.com/users/Reo-LEI/gists{/gist_id}","starred_url":"https://api.github.com/users/Reo-LEI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Reo-LEI/subscriptions","organizations_url":"https://api.github.com/users/Reo-LEI/orgs","repos_url":"https://api.github.com/users/Reo-LEI/repos","events_url":"https://api.github.com/users/Reo-LEI/events{/privacy}","received_events_url":"https://api.github.com/users/Reo-LEI/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-25T11:15:43Z","updated_at":"2021-07-25T11:16:30Z","author_association":"CONTRIBUTOR","body":"Now, the `expireSnapshots` coding is finish, but I'm blocking by a `Kyro Serialization Error` when I testing.\r\n\r\nKyro raise a NPE when serialize `hadoopConf` of `HadoopFileIO` when flink create `CombinedScanTask` source. the full stack as follow:\r\n```\r\nException in thread \"main\" java.lang.RuntimeException: Serializing the source elements failed: java.lang.NullPointerException\r\nSerialization trace:\r\nhadoopConf (org.apache.iceberg.hadoop.HadoopFileIO)\r\nio (org.apache.iceberg.AllManifestsTable$ManifestListReadTask)\r\ntasks (org.apache.iceberg.BaseCombinedScanTask)\r\n\tat org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.fromCollection(StreamExecutionEnvironment.java:1046)\r\n\tat org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.fromCollection(StreamExecutionEnvironment.java:1021)\r\n\tat org.apache.iceberg.flink.source.MetadataTableSource$Builder.build(MetadataTableSource.java:92)\r\n\tat org.apache.iceberg.flink.actions.BaseFlinkAction.loadMetadataTable(BaseFlinkAction.java:117)\r\n\tat org.apache.iceberg.flink.actions.BaseFlinkAction.buildValidDataFileTable(BaseFlinkAction.java:92)\r\n\tat org.apache.iceberg.flink.actions.ExpireSnapshotsAction.buildValidFileTable(ExpireSnapshotsAction.java:122)\r\n\tat org.apache.iceberg.flink.actions.ExpireSnapshotsAction.expire(ExpireSnapshotsAction.java:139)\r\n\tat org.apache.iceberg.flink.actions.ExpireSnapshotsAction.execute(ExpireSnapshotsAction.java:117)\r\n\tat org.apache.iceberg.flink.actions.ExpireSnapshotsAction.execute(ExpireSnapshotsAction.java:44)\r\n\tat cn.walden.stream.IcebergFlinkActions.main(IcebergFlinkActions.java:28)\r\nCaused by: java.io.IOException: Serializing the source elements failed: java.lang.NullPointerException\r\nSerialization trace:\r\nhadoopConf (org.apache.iceberg.hadoop.HadoopFileIO)\r\nio (org.apache.iceberg.AllManifestsTable$ManifestListReadTask)\r\ntasks (org.apache.iceberg.BaseCombinedScanTask)\r\n\tat org.apache.flink.streaming.api.functions.source.FromElementsFunction.<init>(FromElementsFunction.java:93)\r\n\tat org.apache.flink.streaming.api.environment.StreamExecutionEnvironment.fromCollection(StreamExecutionEnvironment.java:1044)\r\n\t... 9 more\r\nCaused by: com.esotericsoftware.kryo.KryoException: java.lang.NullPointerException\r\nSerialization trace:\r\nhadoopConf (org.apache.iceberg.hadoop.HadoopFileIO)\r\nio (org.apache.iceberg.AllManifestsTable$ManifestListReadTask)\r\ntasks (org.apache.iceberg.BaseCombinedScanTask)\r\n\tat com.esotericsoftware.kryo.serializers.ObjectField.write(ObjectField.java:82)\r\n\tat com.esotericsoftware.kryo.serializers.FieldSerializer.write(FieldSerializer.java:495)\r\n\tat com.esotericsoftware.kryo.Kryo.writeObject(Kryo.java:523)\r\n\tat com.esotericsoftware.kryo.serializers.ObjectField.write(ObjectField.java:61)\r\n\tat com.esotericsoftware.kryo.serializers.FieldSerializer.write(FieldSerializer.java:495)\r\n\tat com.esotericsoftware.kryo.Kryo.writeClassAndObject(Kryo.java:599)\r\n\tat com.esotericsoftware.kryo.serializers.DefaultArraySerializers$ObjectArraySerializer.write(DefaultArraySerializers.java:348)\r\n\tat com.esotericsoftware.kryo.serializers.DefaultArraySerializers$ObjectArraySerializer.write(DefaultArraySerializers.java:289)\r\n\tat com.esotericsoftware.kryo.Kryo.writeObject(Kryo.java:523)\r\n\tat com.esotericsoftware.kryo.serializers.ObjectField.write(ObjectField.java:61)\r\n\tat com.esotericsoftware.kryo.serializers.FieldSerializer.write(FieldSerializer.java:495)\r\n\tat com.esotericsoftware.kryo.Kryo.writeClassAndObject(Kryo.java:599)\r\n\tat org.apache.flink.api.java.typeutils.runtime.kryo.KryoSerializer.serialize(KryoSerializer.java:316)\r\n\tat org.apache.flink.streaming.api.functions.source.FromElementsFunction.<init>(FromElementsFunction.java:89)\r\n\t... 10 more\r\nCaused by: java.lang.NullPointerException\r\n\tat com.esotericsoftware.kryo.util.DefaultClassResolver.writeClass(DefaultClassResolver.java:80)\r\n\tat com.esotericsoftware.kryo.Kryo.writeClass(Kryo.java:488)\r\n\tat com.esotericsoftware.kryo.serializers.ObjectField.write(ObjectField.java:57)\r\n\t... 23 more\r\n```\r\n\r\nI'm trying to figure out the reason of that, but I have been blocking for this for a while and I don't have a clue. Could someone give me a little help? @rdblue @aokolnychyi @openinx ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886186358/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886222692","html_url":"https://github.com/apache/iceberg/pull/1996#issuecomment-886222692","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1996","id":886222692,"node_id":"IC_kwDOCW7NX8400q9k","user":{"login":"Reo-LEI","id":17312872,"node_id":"MDQ6VXNlcjE3MzEyODcy","avatar_url":"https://avatars.githubusercontent.com/u/17312872?v=4","gravatar_id":"","url":"https://api.github.com/users/Reo-LEI","html_url":"https://github.com/Reo-LEI","followers_url":"https://api.github.com/users/Reo-LEI/followers","following_url":"https://api.github.com/users/Reo-LEI/following{/other_user}","gists_url":"https://api.github.com/users/Reo-LEI/gists{/gist_id}","starred_url":"https://api.github.com/users/Reo-LEI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Reo-LEI/subscriptions","organizations_url":"https://api.github.com/users/Reo-LEI/orgs","repos_url":"https://api.github.com/users/Reo-LEI/repos","events_url":"https://api.github.com/users/Reo-LEI/events{/privacy}","received_events_url":"https://api.github.com/users/Reo-LEI/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-25T16:03:36Z","updated_at":"2021-07-25T16:03:36Z","author_association":"CONTRIBUTOR","body":"I'm pick this up on #2863 @rdblue \r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886222692/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886224031","html_url":"https://github.com/apache/iceberg/pull/2863#issuecomment-886224031","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2863","id":886224031,"node_id":"IC_kwDOCW7NX8400rSf","user":{"login":"Reo-LEI","id":17312872,"node_id":"MDQ6VXNlcjE3MzEyODcy","avatar_url":"https://avatars.githubusercontent.com/u/17312872?v=4","gravatar_id":"","url":"https://api.github.com/users/Reo-LEI","html_url":"https://github.com/Reo-LEI","followers_url":"https://api.github.com/users/Reo-LEI/followers","following_url":"https://api.github.com/users/Reo-LEI/following{/other_user}","gists_url":"https://api.github.com/users/Reo-LEI/gists{/gist_id}","starred_url":"https://api.github.com/users/Reo-LEI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Reo-LEI/subscriptions","organizations_url":"https://api.github.com/users/Reo-LEI/orgs","repos_url":"https://api.github.com/users/Reo-LEI/repos","events_url":"https://api.github.com/users/Reo-LEI/events{/privacy}","received_events_url":"https://api.github.com/users/Reo-LEI/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-25T16:12:01Z","updated_at":"2021-07-25T16:12:01Z","author_association":"CONTRIBUTOR","body":"I pick #1996 up on this PR, could you take a look? @rdblue @openinx ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886224031/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886242418","html_url":"https://github.com/apache/iceberg/pull/2862#issuecomment-886242418","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2862","id":886242418,"node_id":"IC_kwDOCW7NX8400vxy","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-25T18:48:36Z","updated_at":"2021-07-25T18:48:36Z","author_association":"CONTRIBUTOR","body":"Looks like the FileIO was not prepared to be serialized by wrapping its Hadoop Configuration in SerializableConfiguration.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886242418/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886264910","html_url":"https://github.com/apache/iceberg/pull/2865#issuecomment-886264910","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2865","id":886264910,"node_id":"IC_kwDOCW7NX84001RO","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-25T22:13:51Z","updated_at":"2021-07-25T22:13:51Z","author_association":"CONTRIBUTOR","body":"@cwsteinbach FYI","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886264910/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886280201","html_url":"https://github.com/apache/iceberg/pull/2862#issuecomment-886280201","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2862","id":886280201,"node_id":"IC_kwDOCW7NX84005AJ","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T00:04:20Z","updated_at":"2021-07-26T00:04:20Z","author_association":"CONTRIBUTOR","body":"I have _potentially_ come across a similar issue when using ORC-1.7.0-SNAPSHOT (which you're definitively not using here). It only _possibly_ may be related to `SerializableConfiguration`, I am still debugging.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886280201/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886305495","html_url":"https://github.com/apache/iceberg/pull/2866#issuecomment-886305495","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2866","id":886305495,"node_id":"IC_kwDOCW7NX8400_LX","user":{"login":"jun-he","id":12246263,"node_id":"MDQ6VXNlcjEyMjQ2MjYz","avatar_url":"https://avatars.githubusercontent.com/u/12246263?v=4","gravatar_id":"","url":"https://api.github.com/users/jun-he","html_url":"https://github.com/jun-he","followers_url":"https://api.github.com/users/jun-he/followers","following_url":"https://api.github.com/users/jun-he/following{/other_user}","gists_url":"https://api.github.com/users/jun-he/gists{/gist_id}","starred_url":"https://api.github.com/users/jun-he/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jun-he/subscriptions","organizations_url":"https://api.github.com/users/jun-he/orgs","repos_url":"https://api.github.com/users/jun-he/repos","events_url":"https://api.github.com/users/jun-he/events{/privacy}","received_events_url":"https://api.github.com/users/jun-he/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T01:26:38Z","updated_at":"2021-07-26T01:26:38Z","author_association":"COLLABORATOR","body":"@TGooch44 and @rymurr can you help to review it? Thanks. \r\nSeems types package miss many features and block the update of schema class. Plan to update them and then schema.\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886305495/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886324550","html_url":"https://github.com/apache/iceberg/pull/2856#issuecomment-886324550","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2856","id":886324550,"node_id":"IC_kwDOCW7NX8401D1G","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T02:26:13Z","updated_at":"2021-07-26T02:26:13Z","author_association":"MEMBER","body":"Looks pretty good to me,  thanks @dnielsen for the blog. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886324550/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886330339","html_url":"https://github.com/apache/iceberg/pull/2836#issuecomment-886330339","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2836","id":886330339,"node_id":"IC_kwDOCW7NX8401FPj","user":{"login":"jun-he","id":12246263,"node_id":"MDQ6VXNlcjEyMjQ2MjYz","avatar_url":"https://avatars.githubusercontent.com/u/12246263?v=4","gravatar_id":"","url":"https://api.github.com/users/jun-he","html_url":"https://github.com/jun-he","followers_url":"https://api.github.com/users/jun-he/followers","following_url":"https://api.github.com/users/jun-he/following{/other_user}","gists_url":"https://api.github.com/users/jun-he/gists{/gist_id}","starred_url":"https://api.github.com/users/jun-he/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jun-he/subscriptions","organizations_url":"https://api.github.com/users/jun-he/orgs","repos_url":"https://api.github.com/users/jun-he/repos","events_url":"https://api.github.com/users/jun-he/events{/privacy}","received_events_url":"https://api.github.com/users/jun-he/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T02:46:50Z","updated_at":"2021-07-26T02:46:50Z","author_association":"COLLABORATOR","body":"@findepi  I added additional tests to check the hash values.\r\nIt matched the result in [Java test](https://github.com/apache/iceberg/blob/master/api/src/test/java/org/apache/iceberg/transforms/TestBucketing.java#L64-L119)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886330339/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886463630","html_url":"https://github.com/apache/iceberg/pull/2850#issuecomment-886463630","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2850","id":886463630,"node_id":"IC_kwDOCW7NX8401lyO","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T07:51:31Z","updated_at":"2021-07-26T07:51:31Z","author_association":"CONTRIBUTOR","body":"In testing etc, I very often use a similar pattern (possibly using a timestamp as the table suffix).\r\n\r\nHowever, I'm not sure if the best place to be doing this is in the Iceberg code.\r\n\r\nWhat other tools are you using to create these tables that have UUID suffixes? Usually, when I encounter this need, I'm doing it in one of two places:\r\n(1) Directly from shell scripts or small Spark / Trino jobs when testing on S3 (and wanting to ensure a brand new table). The solution for me there is simply to either place the table name with a timestamp in the code. Here's a sample from some code I have elsewhere:\r\n```scala\r\n    val currentTime = new Date().getTime\r\n    val tableName = \"table_\" + currentTime;\r\n    spark.sql(s\"CREATE TABLE IF NOT EXISTS my_catalog.default.${tableName} (name string, age int) USING iceberg\")\r\n``` \r\n(2) From some sort of scheduling tool, such as Airflow or Azkaban. In this case, it's very easy to create a UUID when passing In the \"new table name\" to the spark job.\r\n\r\nEffectively, for me, I'm not sure if this is something that makes sense to place it in Iceberg.\r\n\r\nCan you elaborate further on why this isn't something that you can pass as an argument to your jobs etc? It feels very use case specific, with possible ways for you to deal with it using existing tools, but maybe I'm not fully understanding the scope of your problem. 🙂 ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886463630/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886464531","html_url":"https://github.com/apache/iceberg/pull/2850#issuecomment-886464531","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2850","id":886464531,"node_id":"IC_kwDOCW7NX8401mAT","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T07:53:01Z","updated_at":"2021-07-26T07:53:01Z","author_association":"CONTRIBUTOR","body":">  We also have a requirement don't drop table data and metadata when dropping table from hive metastore. It will allow us to restore any dropped table.\r\n\r\nI believe this is possible using `EXTERNAL` tables already (where the table is dropped from HMS but th data is retained). Is this not sufficient for your use case?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886464531/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886469034","html_url":"https://github.com/apache/iceberg/pull/2867#issuecomment-886469034","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2867","id":886469034,"node_id":"IC_kwDOCW7NX8401nGq","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T08:00:10Z","updated_at":"2021-07-26T08:00:10Z","author_association":"CONTRIBUTOR","body":"Hi @hameizi! Thank you for your contribution and interest in Iceberg!\r\n\r\nThis is a non-trivial functionality addition. Would it be possible for you to create a GitHub issue for us to track and discuss this? Github issues are how we normally track new work etc, and I think given that this functionality has not been discussed etc, it would benefit from going through the standard process of having an issue.\r\n\r\nBy no means do you need to close the PR, but it would help to follow the normal workflow (and also provides the benefit that people can search the issues to see the discussion). 🙂 ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886469034/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886470356","html_url":"https://github.com/apache/iceberg/pull/2867#issuecomment-886470356","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2867","id":886470356,"node_id":"IC_kwDOCW7NX8401nbU","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T08:01:55Z","updated_at":"2021-07-26T08:04:36Z","author_association":"CONTRIBUTOR","body":"> This add one feature that flink write iceberg auto compact small files.\r\n\r\nPossibly I'm missing something, but I don't see any accounting for files that might be already near, or close to the optimal size. It's late and my eyes may deceive me, but this appears to be compacting all files to be ideally the target file size bytes, regardless of their existing size etc. In some cases, the cost of opening and rewriting provides less value than leaving the data as is. Can we account for this like we do in some other places? Or am I just missing the fact that that functionality is hidden elsewhere?\r\n\r\nThis would be a good topic to consider discussing in the mentioned GitHub issue :) ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886470356/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886492617","html_url":"https://github.com/apache/iceberg/pull/2867#issuecomment-886492617","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2867","id":886492617,"node_id":"IC_kwDOCW7NX8401s3J","user":{"login":"hameizi","id":18445460,"node_id":"MDQ6VXNlcjE4NDQ1NDYw","avatar_url":"https://avatars.githubusercontent.com/u/18445460?v=4","gravatar_id":"","url":"https://api.github.com/users/hameizi","html_url":"https://github.com/hameizi","followers_url":"https://api.github.com/users/hameizi/followers","following_url":"https://api.github.com/users/hameizi/following{/other_user}","gists_url":"https://api.github.com/users/hameizi/gists{/gist_id}","starred_url":"https://api.github.com/users/hameizi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hameizi/subscriptions","organizations_url":"https://api.github.com/users/hameizi/orgs","repos_url":"https://api.github.com/users/hameizi/repos","events_url":"https://api.github.com/users/hameizi/events{/privacy}","received_events_url":"https://api.github.com/users/hameizi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T08:28:52Z","updated_at":"2021-07-26T08:28:52Z","author_association":"CONTRIBUTOR","body":"> Hi @hameizi! Thank you for your contribution and interest in Iceberg!\r\n> \r\n> This is a non-trivial functionality addition. Would it be possible for you to create a GitHub issue for us to track and discuss this? Github issues are how we normally track new work etc, and I think given that this functionality has not been discussed etc, it would benefit from going through the standard process of having an issue.\r\n> \r\n> By no means do you need to close the PR, but it would help to follow the normal workflow (and also provides the benefit that people can search the issues to see the discussion). 🙂\r\n\r\nI add one issue https://github.com/apache/iceberg/issues/2869","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886492617/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886502378","html_url":"https://github.com/apache/iceberg/pull/2867#issuecomment-886502378","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2867","id":886502378,"node_id":"IC_kwDOCW7NX8401vPq","user":{"login":"hameizi","id":18445460,"node_id":"MDQ6VXNlcjE4NDQ1NDYw","avatar_url":"https://avatars.githubusercontent.com/u/18445460?v=4","gravatar_id":"","url":"https://api.github.com/users/hameizi","html_url":"https://github.com/hameizi","followers_url":"https://api.github.com/users/hameizi/followers","following_url":"https://api.github.com/users/hameizi/following{/other_user}","gists_url":"https://api.github.com/users/hameizi/gists{/gist_id}","starred_url":"https://api.github.com/users/hameizi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hameizi/subscriptions","organizations_url":"https://api.github.com/users/hameizi/orgs","repos_url":"https://api.github.com/users/hameizi/repos","events_url":"https://api.github.com/users/hameizi/events{/privacy}","received_events_url":"https://api.github.com/users/hameizi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T08:42:29Z","updated_at":"2021-07-26T08:42:29Z","author_association":"CONTRIBUTOR","body":"> > This add one feature that flink write iceberg auto compact small files.\r\n> \r\n> Possibly I'm missing something, but I don't see any accounting for files that might be already near, or close to the optimal size. It's late and my eyes may deceive me, but this appears to be compacting all files to be ideally the target file size bytes, regardless of their existing size etc. In some cases, the cost of opening and rewriting provides less value than leaving the data as is. Can we account for this like we do in some other places? Or am I just missing the fact that that functionality is hidden elsewhere?\r\n> \r\n> This would be a good topic to consider discussing in the mentioned GitHub issue :)\r\n\r\nIt will compact files who is the result by partition filter, so it will compact all files when there  is  no partitions. But in my work sence, there is no problem because we compact every transction that will generate little files. So compact files in every transcation is quickly and small cost and the time compact files will not more than transaction time too.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886502378/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886511060","html_url":"https://github.com/apache/iceberg/issues/2868#issuecomment-886511060","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2868","id":886511060,"node_id":"IC_kwDOCW7NX8401xXU","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T08:55:20Z","updated_at":"2021-07-26T08:55:20Z","author_association":"MEMBER","body":"It's similar to this [issue](https://github.com/apache/iceberg/issues/2710) ,   you can try to use the master branch (which has included the [fix](https://github.com/apache/iceberg/pull/2454) ) to verify this again.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886511060/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886514901","html_url":"https://github.com/apache/iceberg/pull/2850#issuecomment-886514901","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2850","id":886514901,"node_id":"IC_kwDOCW7NX8401yTV","user":{"login":"sshkvar","id":3986221,"node_id":"MDQ6VXNlcjM5ODYyMjE=","avatar_url":"https://avatars.githubusercontent.com/u/3986221?v=4","gravatar_id":"","url":"https://api.github.com/users/sshkvar","html_url":"https://github.com/sshkvar","followers_url":"https://api.github.com/users/sshkvar/followers","following_url":"https://api.github.com/users/sshkvar/following{/other_user}","gists_url":"https://api.github.com/users/sshkvar/gists{/gist_id}","starred_url":"https://api.github.com/users/sshkvar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sshkvar/subscriptions","organizations_url":"https://api.github.com/users/sshkvar/orgs","repos_url":"https://api.github.com/users/sshkvar/repos","events_url":"https://api.github.com/users/sshkvar/events{/privacy}","received_events_url":"https://api.github.com/users/sshkvar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T09:00:57Z","updated_at":"2021-07-26T09:00:57Z","author_association":"CONTRIBUTOR","body":"> In testing etc, I very often use a similar pattern (possibly using a timestamp as the table suffix).\r\n> \r\n> However, I'm not sure if the best place to be doing this is in the Iceberg code.\r\n> \r\n> What other tools are you using to create these tables that have UUID suffixes? Usually, when I encounter this need, I'm doing it in one of two places:\r\n> (1) Directly from shell scripts or small Spark / Trino jobs when testing on S3 (and wanting to ensure a brand new table). The solution for me there is simply to either place the table name with a timestamp in the code. Here's a sample from some code I have elsewhere:\r\n> \r\n> ```scala\r\n>     val currentTime = new Date().getTime\r\n>     val tableName = \"table_\" + currentTime;\r\n>     spark.sql(s\"CREATE TABLE IF NOT EXISTS my_catalog.default.${tableName} (name string, age int) USING iceberg\")\r\n> ```\r\n> \r\n> (2) From some sort of scheduling tool, such as Airflow or Azkaban. In this case, it's very easy to create a UUID when passing In the \"new table name\" to the spark job.\r\n> \r\n> Effectively, for me, I'm not sure if this is something that makes sense to place it in Iceberg.\r\n> \r\n> Can you elaborate further on why this isn't something that you can pass as an argument to your jobs etc? It feels very use case specific, with possible ways for you to deal with it using existing tools, but maybe I'm not fully understanding the scope of your problem. 🙂\r\n\r\n@kbendick Thanks for the quick reply \r\nLet me provide additional details.\r\nActually we do not need to change table name (and we don't do it), in \r\n this PR just add uuid suffix to the table location.\r\nWe need this to store tables with same name in different \"folders\" on s3. \r\nOur use-case:\r\n1. We created table with name `test_table` and inserted some data to this table\r\n2. Then we dropped this table only from metastore, because we should have ability to restore this table \r\n3. Then we again created new table with same name `test_table`.\r\n4. And again dropped this table\r\nWith this PR we will be able to restore any of this tables, because data and metadata placed in different folders, we just need to restore information about table location in metastore (we can easy do it via iceberg API). \r\n\r\nAlso we have scheduled compaction and orhan files cleanup processes. If we will have data and metadata files for both tables in same folder, orhan files cleanup process will delete data and metadata for table which was deleted in step 2.\r\nBased on described above `EXTERNAL` table is not an option for us ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886514901/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886523709","html_url":"https://github.com/apache/iceberg/pull/2854#issuecomment-886523709","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2854","id":886523709,"node_id":"IC_kwDOCW7NX84010c9","user":{"login":"sshkvar","id":3986221,"node_id":"MDQ6VXNlcjM5ODYyMjE=","avatar_url":"https://avatars.githubusercontent.com/u/3986221?v=4","gravatar_id":"","url":"https://api.github.com/users/sshkvar","html_url":"https://github.com/sshkvar","followers_url":"https://api.github.com/users/sshkvar/followers","following_url":"https://api.github.com/users/sshkvar/following{/other_user}","gists_url":"https://api.github.com/users/sshkvar/gists{/gist_id}","starred_url":"https://api.github.com/users/sshkvar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sshkvar/subscriptions","organizations_url":"https://api.github.com/users/sshkvar/orgs","repos_url":"https://api.github.com/users/sshkvar/repos","events_url":"https://api.github.com/users/sshkvar/events{/privacy}","received_events_url":"https://api.github.com/users/sshkvar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T09:10:54Z","updated_at":"2021-07-26T09:10:54Z","author_association":"CONTRIBUTOR","body":"> For Spark, my understanding was that we were gong to respect the `PURGE` information coming from the SQL command. Am I fully mistaken or is this for a different issue?\r\n\r\nIn current implementation we ignoring purge information and always send `true` from [Spark Catalog](https://github.com/apache/iceberg/blob/master/spark3/src/main/java/org/apache/iceberg/spark/SparkCatalog.java#L237) to [Hive catalog](https://github.com/apache/iceberg/blob/b623b074c6242ac3b48fce8712dedd7f97e6ee5b/api/src/main/java/org/apache/iceberg/catalog/Catalog.java#L284)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886523709/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886556438","html_url":"https://github.com/apache/iceberg/pull/2850#issuecomment-886556438","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2850","id":886556438,"node_id":"IC_kwDOCW7NX84018cW","user":{"login":"pvary","id":19705742,"node_id":"MDQ6VXNlcjE5NzA1NzQy","avatar_url":"https://avatars.githubusercontent.com/u/19705742?v=4","gravatar_id":"","url":"https://api.github.com/users/pvary","html_url":"https://github.com/pvary","followers_url":"https://api.github.com/users/pvary/followers","following_url":"https://api.github.com/users/pvary/following{/other_user}","gists_url":"https://api.github.com/users/pvary/gists{/gist_id}","starred_url":"https://api.github.com/users/pvary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvary/subscriptions","organizations_url":"https://api.github.com/users/pvary/orgs","repos_url":"https://api.github.com/users/pvary/repos","events_url":"https://api.github.com/users/pvary/events{/privacy}","received_events_url":"https://api.github.com/users/pvary/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T09:59:41Z","updated_at":"2021-07-26T10:00:20Z","author_association":"CONTRIBUTOR","body":"@sshkvar: I think you could use the following Hive query to archive the desired results:\r\n```\r\nCREATE EXTERNAL TABLE customers (id INTEGER)\r\nSTORED BY 'org.apache.iceberg.mr.hive.HiveIcebergStorageHandler'\r\nLOCATION '<WAREHOUSE>/934b0724-b4da-4202-aa90-4d6e9543b8b4//default/customers';\r\n```\r\n\r\nWould this work for you?\r\nThanks,\r\nPeter","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886556438/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886564565","html_url":"https://github.com/apache/iceberg/pull/2850#issuecomment-886564565","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2850","id":886564565,"node_id":"IC_kwDOCW7NX8401-bV","user":{"login":"sshkvar","id":3986221,"node_id":"MDQ6VXNlcjM5ODYyMjE=","avatar_url":"https://avatars.githubusercontent.com/u/3986221?v=4","gravatar_id":"","url":"https://api.github.com/users/sshkvar","html_url":"https://github.com/sshkvar","followers_url":"https://api.github.com/users/sshkvar/followers","following_url":"https://api.github.com/users/sshkvar/following{/other_user}","gists_url":"https://api.github.com/users/sshkvar/gists{/gist_id}","starred_url":"https://api.github.com/users/sshkvar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sshkvar/subscriptions","organizations_url":"https://api.github.com/users/sshkvar/orgs","repos_url":"https://api.github.com/users/sshkvar/repos","events_url":"https://api.github.com/users/sshkvar/events{/privacy}","received_events_url":"https://api.github.com/users/sshkvar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T10:09:47Z","updated_at":"2021-07-26T10:09:47Z","author_association":"CONTRIBUTOR","body":"> @sshkvar: I think you could use the following Hive query to archive the desired results:\r\n> \r\n> ```\r\n> CREATE EXTERNAL TABLE customers (id INTEGER)\r\n> STORED BY 'org.apache.iceberg.mr.hive.HiveIcebergStorageHandler'\r\n> LOCATION '<WAREHOUSE>/934b0724-b4da-4202-aa90-4d6e9543b8b4//default/customers';\r\n> ```\r\n> \r\n> Would this work for you?\r\n> Thanks,\r\n> Peter\r\n\r\n@pvary yes, this solution can be used, but in this case we need to change a lot of existing ETL's and ask people to set custom location for each new table. We would like to have some general option","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886564565/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886573458","html_url":"https://github.com/apache/iceberg/pull/2850#issuecomment-886573458","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2850","id":886573458,"node_id":"IC_kwDOCW7NX8402AmS","user":{"login":"pvary","id":19705742,"node_id":"MDQ6VXNlcjE5NzA1NzQy","avatar_url":"https://avatars.githubusercontent.com/u/19705742?v=4","gravatar_id":"","url":"https://api.github.com/users/pvary","html_url":"https://github.com/pvary","followers_url":"https://api.github.com/users/pvary/followers","following_url":"https://api.github.com/users/pvary/following{/other_user}","gists_url":"https://api.github.com/users/pvary/gists{/gist_id}","starred_url":"https://api.github.com/users/pvary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvary/subscriptions","organizations_url":"https://api.github.com/users/pvary/orgs","repos_url":"https://api.github.com/users/pvary/repos","events_url":"https://api.github.com/users/pvary/events{/privacy}","received_events_url":"https://api.github.com/users/pvary/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T10:21:45Z","updated_at":"2021-07-26T10:21:45Z","author_association":"CONTRIBUTOR","body":"@sshkvar: Do you think is a general enough request to change the HiveCatalog code, or it is ok for you to create your own CustomCatalog and use it in your deployment?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886573458/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886591554","html_url":"https://github.com/apache/iceberg/pull/2850#issuecomment-886591554","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2850","id":886591554,"node_id":"IC_kwDOCW7NX8402FBC","user":{"login":"sshkvar","id":3986221,"node_id":"MDQ6VXNlcjM5ODYyMjE=","avatar_url":"https://avatars.githubusercontent.com/u/3986221?v=4","gravatar_id":"","url":"https://api.github.com/users/sshkvar","html_url":"https://github.com/sshkvar","followers_url":"https://api.github.com/users/sshkvar/followers","following_url":"https://api.github.com/users/sshkvar/following{/other_user}","gists_url":"https://api.github.com/users/sshkvar/gists{/gist_id}","starred_url":"https://api.github.com/users/sshkvar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sshkvar/subscriptions","organizations_url":"https://api.github.com/users/sshkvar/orgs","repos_url":"https://api.github.com/users/sshkvar/repos","events_url":"https://api.github.com/users/sshkvar/events{/privacy}","received_events_url":"https://api.github.com/users/sshkvar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T10:49:32Z","updated_at":"2021-07-26T10:49:32Z","author_association":"CONTRIBUTOR","body":"> @sshkvar: Do you think is a general enough request to change the HiveCatalog code, or it is ok for you to create your own CustomCatalog and use it in your deployment?\r\n\r\nAs for me it can be useful in case when we not deleting table data. \r\nBut if you would like to avoid this changes we can try to find other solutions","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886591554/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886696199","html_url":"https://github.com/apache/iceberg/pull/2850#issuecomment-886696199","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2850","id":886696199,"node_id":"IC_kwDOCW7NX8402ekH","user":{"login":"pvary","id":19705742,"node_id":"MDQ6VXNlcjE5NzA1NzQy","avatar_url":"https://avatars.githubusercontent.com/u/19705742?v=4","gravatar_id":"","url":"https://api.github.com/users/pvary","html_url":"https://github.com/pvary","followers_url":"https://api.github.com/users/pvary/followers","following_url":"https://api.github.com/users/pvary/following{/other_user}","gists_url":"https://api.github.com/users/pvary/gists{/gist_id}","starred_url":"https://api.github.com/users/pvary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvary/subscriptions","organizations_url":"https://api.github.com/users/pvary/orgs","repos_url":"https://api.github.com/users/pvary/repos","events_url":"https://api.github.com/users/pvary/events{/privacy}","received_events_url":"https://api.github.com/users/pvary/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T13:18:34Z","updated_at":"2021-07-26T13:18:34Z","author_association":"CONTRIBUTOR","body":"> But if you would like to avoid this changes we can try to find other solutions\r\n\r\n@sshkvar: I would like to hear others opinion on this too before we come to any decision.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886696199/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886779439","html_url":"https://github.com/apache/iceberg/pull/2850#issuecomment-886779439","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2850","id":886779439,"node_id":"IC_kwDOCW7NX8402y4v","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T15:00:49Z","updated_at":"2021-07-26T15:00:49Z","author_association":"MEMBER","body":"I guess i'm also a little apprehensive of adding more parameters when this could be done in user space pretty easily. But if other folks have this need more frequently I don't think it's unreasonable. There is actually a similar thing in C* which always prefixes table names with UUID's when creating their actual locations to avoid these kind of conflicts.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886779439/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886834800","html_url":"https://github.com/apache/iceberg/pull/1744#issuecomment-886834800","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1744","id":886834800,"node_id":"IC_kwDOCW7NX8403AZw","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T16:08:31Z","updated_at":"2021-07-26T16:08:31Z","author_association":"MEMBER","body":"@rdblue + @szehon-ho - @karuppayya reminded me to fix this with our hope that it would fix #2783, While I did fix this PR it doesn't seem to have fixed the other issue. That said, I at least fixed these two issues :) I would appreciate a review so we can at least fix this portion.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886834800/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886943603","html_url":"https://github.com/apache/iceberg/pull/2858#issuecomment-886943603","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2858","id":886943603,"node_id":"IC_kwDOCW7NX8403a9z","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T18:50:56Z","updated_at":"2021-07-26T18:50:56Z","author_association":"CONTRIBUTOR","body":"This PR is specific to the output file factory. We can add tests for committing multiple specs when those features are added.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886943603/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886952345","html_url":"https://github.com/apache/iceberg/issues/2783#issuecomment-886952345","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2783","id":886952345,"node_id":"IC_kwDOCW7NX8403dGZ","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T19:04:52Z","updated_at":"2021-07-26T19:06:15Z","author_association":"MEMBER","body":"So I think I tracked this down, the basic issue is that Spark 3.1 correctly prunes nested structs and Spark 3.0 does not. You may wonder, if Spark3.1 correctly prunes nested structs why is this an issue?\r\n\r\nThe issue is that we end up reading only 2 fields out of our metadata tables and correctly present them. But our create UnsafeProjection code assumes that if a nested struct is read, then all fields are read so we end up building a projection which requires all columns, rather than just the ones we have actually extracted. This means we build a broken projection.\r\n\r\n\r\n\r\nSee RowDataReader projection, which only does a top-level pruning.\r\nhttps://github.com/apache/iceberg/blob/a79de571860a290f6e96ac562d616c9c6be2071e/spark/src/main/java/org/apache/iceberg/spark/source/RowDataReader.java#L208-L211\r\n\r\nIf we never prune columns out of the struct this is fine, if we do then we have a problem.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/886952345/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887008108","html_url":"https://github.com/apache/iceberg/pull/2858#issuecomment-887008108","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2858","id":887008108,"node_id":"IC_kwDOCW7NX8403qts","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T20:34:20Z","updated_at":"2021-07-26T20:34:20Z","author_association":"CONTRIBUTOR","body":"@jun-he @flyrain, I added a test for multiple specs. More tests will be in following PRs when we start writing and committing files that belong to multiple specs.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887008108/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887054364","html_url":"https://github.com/apache/iceberg/pull/2858#issuecomment-887054364","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2858","id":887054364,"node_id":"IC_kwDOCW7NX84032Ac","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T21:57:50Z","updated_at":"2021-07-26T21:57:50Z","author_association":"CONTRIBUTOR","body":"Merged. Thanks for the reviews, everyone!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887054364/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887055541","html_url":"https://github.com/apache/iceberg/issues/2871#issuecomment-887055541","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2871","id":887055541,"node_id":"IC_kwDOCW7NX84032S1","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T22:00:36Z","updated_at":"2021-07-26T22:00:36Z","author_association":"COLLABORATOR","body":"From first glance of the error message, first() here returns null?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887055541/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887058173","html_url":"https://github.com/apache/iceberg/pull/2858#issuecomment-887058173","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2858","id":887058173,"node_id":"IC_kwDOCW7NX8403279","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T22:04:57Z","updated_at":"2021-07-26T22:04:57Z","author_association":"CONTRIBUTOR","body":"Thanks, folks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887058173/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887058647","html_url":"https://github.com/apache/iceberg/pull/2872#issuecomment-887058647","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2872","id":887058647,"node_id":"IC_kwDOCW7NX84033DX","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T22:05:42Z","updated_at":"2021-07-26T22:05:42Z","author_association":"MEMBER","body":"@rdblue - @karuppayya noticed this when we were debugging the issue for #2783 ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887058647/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887059118","html_url":"https://github.com/apache/iceberg/issues/2783#issuecomment-887059118","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2783","id":887059118,"node_id":"IC_kwDOCW7NX84033Ku","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T22:06:30Z","updated_at":"2021-07-26T22:06:30Z","author_association":"MEMBER","body":"@karuppayya Has a temporary workaround by setting\r\n```\r\n    sql(\"set spark.sql.optimizer.nestedSchemaPruning.enabled=false\");\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887059118/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887100371","html_url":"https://github.com/apache/iceberg/pull/2872#issuecomment-887100371","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2872","id":887100371,"node_id":"IC_kwDOCW7NX8404BPT","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T23:41:08Z","updated_at":"2021-07-26T23:41:08Z","author_association":"MEMBER","body":"```bash\r\n➜  iceberg-master git:(FixBuildAgainstSparkVersions) ✗ g check --dry-run | grep testSpark31\r\n:iceberg-spark3:testSpark31 SKIPPED\r\n:iceberg-spark3-extensions:testSpark31 SKIPPED\r\n```\r\n\r\n```\r\n➜  iceberg-master git:(FixBuildAgainstSparkVersions) ✗ g :iceberg-spark3:dependencies --configuration compileOnly | grep spark-hive\r\n\\--- org.apache.spark:spark-hive_2.12:3.0.3\r\n➜  iceberg-master git:(FixBuildAgainstSparkVersions) ✗ g :iceberg-spark3:dependencies --configuration testRuntimeClasspath | grep spark-hive\r\n+--- org.apache.spark:spark-hive_2.12:3.0.3\r\n\r\n\r\n// Only compiles tests\r\n➜  iceberg-master git:(FixBuildAgainstSparkVersions) ✗ g :iceberg-spark3:dependencies --configuration spark31CompileClasspath | grep spark-hive\r\n+--- org.apache.spark:spark-hive_2.12:3.0.3 -> 3.1.1\r\n+--- org.apache.spark:spark-hive_2.12:3.1.1 (*)\r\n➜  iceberg-master git:(FixBuildAgainstSparkVersions) ✗ g :iceberg-spark3:dependencies --configuration spark31RuntimeClasspath | grep spark-hive\r\n+--- org.apache.spark:spark-hive_2.12:3.0.3 -> 3.1.1\r\n+--- org.apache.spark:spark-hive_2.12:3.1.1 (*)\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887100371/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887100753","html_url":"https://github.com/apache/iceberg/pull/2872#issuecomment-887100753","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2872","id":887100753,"node_id":"IC_kwDOCW7NX8404BVR","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-26T23:42:11Z","updated_at":"2021-07-26T23:42:11Z","author_association":"MEMBER","body":"Had to make an additional change to trigger both sets of tests to run during gradle check command, rerunning suite","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887100753/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887110945","html_url":"https://github.com/apache/iceberg/pull/2873#issuecomment-887110945","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2873","id":887110945,"node_id":"IC_kwDOCW7NX8404D0h","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T00:07:56Z","updated_at":"2021-07-27T00:07:56Z","author_association":"CONTRIBUTOR","body":"cc @pvary @RussellSpitzer @rdblue @openinx @jun-he @yyanyy @jackye1995 @flyrain @kbendick @karuppayya","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887110945/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887133825","html_url":"https://github.com/apache/iceberg/issues/2871#issuecomment-887133825","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2871","id":887133825,"node_id":"IC_kwDOCW7NX8404JaB","user":{"login":"zhangpanbigData","id":87966215,"node_id":"MDQ6VXNlcjg3OTY2MjE1","avatar_url":"https://avatars.githubusercontent.com/u/87966215?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangpanbigData","html_url":"https://github.com/zhangpanbigData","followers_url":"https://api.github.com/users/zhangpanbigData/followers","following_url":"https://api.github.com/users/zhangpanbigData/following{/other_user}","gists_url":"https://api.github.com/users/zhangpanbigData/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangpanbigData/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangpanbigData/subscriptions","organizations_url":"https://api.github.com/users/zhangpanbigData/orgs","repos_url":"https://api.github.com/users/zhangpanbigData/repos","events_url":"https://api.github.com/users/zhangpanbigData/events{/privacy}","received_events_url":"https://api.github.com/users/zhangpanbigData/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T01:12:49Z","updated_at":"2021-07-27T01:12:49Z","author_association":"NONE","body":"> From first glance of the error message, first() here returns null?\r\n\r\nno，the first function works fine，below is the result：\r\nscala> spark.sql(\"select uuid,first(level),first(ts),first(message) from hive_catalog.icebergdb.logs where cast(ts as date)='2021-07-23' group by uuid\").show(false)\r\n+------------------------------------+------------+-------------------+--------------+\r\n|uuid                                |first(level)|first(ts)          |first(message)|\r\n+------------------------------------+------------+-------------------+--------------+\r\n|db6a2c2a-93a8-443c-9e41-36cb214648f4|senior      |2021-07-23 17:24:03|the third row |\r\n|e41764f7-638b-4605-9642-f2b607d77c45|middle      |2021-07-23 17:24:03|the first row |\r\n+------------------------------------+------------+-------------------+--------------+","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887133825/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887312703","html_url":"https://github.com/apache/iceberg/issues/2871#issuecomment-887312703","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2871","id":887312703,"node_id":"IC_kwDOCW7NX84041E_","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T08:20:23Z","updated_at":"2021-07-27T08:21:07Z","author_association":"COLLABORATOR","body":"I see, I think it's a Spark compatibility issue.  first() is a 'nullable' function (it may return null values), but the table column is marked non-nullable.  You can try to edit the table schema to have that column nullable.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887312703/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887356836","html_url":"https://github.com/apache/iceberg/issues/2871#issuecomment-887356836","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2871","id":887356836,"node_id":"IC_kwDOCW7NX8404_2k","user":{"login":"zhangpanbigData","id":87966215,"node_id":"MDQ6VXNlcjg3OTY2MjE1","avatar_url":"https://avatars.githubusercontent.com/u/87966215?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangpanbigData","html_url":"https://github.com/zhangpanbigData","followers_url":"https://api.github.com/users/zhangpanbigData/followers","following_url":"https://api.github.com/users/zhangpanbigData/following{/other_user}","gists_url":"https://api.github.com/users/zhangpanbigData/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangpanbigData/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangpanbigData/subscriptions","organizations_url":"https://api.github.com/users/zhangpanbigData/orgs","repos_url":"https://api.github.com/users/zhangpanbigData/repos","events_url":"https://api.github.com/users/zhangpanbigData/events{/privacy}","received_events_url":"https://api.github.com/users/zhangpanbigData/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T09:25:01Z","updated_at":"2021-07-27T09:25:01Z","author_association":"NONE","body":"> I see, I think it's a Spark compatibility issue. first() is a 'nullable' function (it may return null values), but the table column is marked non-nullable. You can try to edit the table schema to have that column nullable.\r\n\r\naccording to your suggestion，it works，but the dynamic partition function seems not affect， removes duplicate does not work，here is my operate steps：\r\nscala> spark.sql(\"create table hive_catalog.icebergdb.logs (uuid string,level string,ts timestamp,message string) using iceberg partitioned by (level,hours(ts))\").show(false)\r\n++\r\n||\r\n++\r\n++\r\n\r\n\r\nscala> spark.sql(\"desc hive_catalog.icebergdb.logs\").show(false)\r\n+--------------+---------+-------+\r\n|col_name      |data_type|comment|\r\n+--------------+---------+-------+\r\n|uuid          |string   |       |\r\n|level         |string   |       |\r\n|ts            |timestamp|       |\r\n|message       |string   |       |\r\n|              |         |       |\r\n|# Partitioning|         |       |\r\n|Part 0        |level    |       |\r\n|Part 1        |hours(ts)|       |\r\n+--------------+---------+-------+\r\n\r\nscala> spark.sql(\"insert into hive_catalog.icebergdb.logs values('e41764f7-638b-4605-9642-f2b607d77c45','middle',timestamp '2021-07-23 17:24:03','the first mess')\").show(false)\r\n++\r\n||\r\n++\r\n++\r\n\r\n\r\nscala> spark.sql(\"insert into hive_catalog.icebergdb.logs values('db6a2c2a-93a8-443c-9e41-36cb214648f4','sensor',timestamp '2021-07-23 17:24:03','the second mess')\").show(false)\r\n++                                                                              \r\n||\r\n++\r\n++\r\n\r\n\r\nscala> spark.sql(\"insert into hive_catalog.icebergdb.logs values('b742ee76-65d3-4d74-ba74-2c25d3cd4795','low',timestamp '2021-07-25 12:43:20','the third mess')\").show(false)\r\n++\r\n||\r\n++\r\n++\r\n\r\n\r\nscala> spark.sql(\"insert into hive_catalog.icebergdb.logs values('db6a2c2a-93a8-443c-9e41-36cb214648f4','high',timestamp '2021-07-23 00:23:56','the fourth mess')\").show(false)\r\n++\r\n||\r\n++\r\n++\r\n\r\nscala> spark.sql(\"select * from hive_catalog.icebergdb.logs\").show(false)\r\n+------------------------------------+------+-------------------+---------------+\r\n|uuid                                |level |ts                 |message        |\r\n+------------------------------------+------+-------------------+---------------+\r\n|b742ee76-65d3-4d74-ba74-2c25d3cd4795|low   |2021-07-25 12:43:20|the third mess |\r\n|db6a2c2a-93a8-443c-9e41-36cb214648f4|sensor|2021-07-23 17:24:03|the second mess|\r\n|db6a2c2a-93a8-443c-9e41-36cb214648f4|high  |2021-07-23 00:23:56|the fourth mess|\r\n|e41764f7-638b-4605-9642-f2b607d77c45|middle|2021-07-23 17:24:03|the first mess |\r\n+------------------------------------+------+-------------------+---------------+\r\n\r\n\r\nscala> spark.sql(\"select uuid,first(level),first(ts),first(message) from hive_catalog.icebergdb.logs where cast(ts as date)='2021-07-23' group by uuid\").show(false)\r\n+------------------------------------+------------+-------------------+---------------+\r\n|uuid                                |first(level)|first(ts)          |first(message) |\r\n+------------------------------------+------------+-------------------+---------------+\r\n|db6a2c2a-93a8-443c-9e41-36cb214648f4|sensor      |2021-07-23 17:24:03|the second mess|\r\n|e41764f7-638b-4605-9642-f2b607d77c45|middle      |2021-07-23 17:24:03|the first mess |\r\n+------------------------------------+------------+-------------------+---------------+\r\n\r\n\r\nscala> spark.sql(\"set spark.sql.sources.partitionOverwriteMode\").show(truncate=false)\r\n+----------------------------------------+-------+\r\n|key                                     |value  |\r\n+----------------------------------------+-------+\r\n|spark.sql.sources.partitionOverwriteMode|dynamic|\r\n+----------------------------------------+-------+\r\n\r\nscala> spark.sql(\"insert overwrite table hive_catalog.icebergdb.logs select uuid,first(level),first(ts),first(message) from hive_catalog.icebergdb.logs where cast(ts as date)='2021-07-23' group by uuid\")\r\nres17: org.apache.spark.sql.DataFrame = []                                      \r\n\r\nscala> spark.sql(\"select * from hive_catalog.icebergdb.logs\").show(false)\r\n+------------------------------------+------+-------------------+---------------+\r\n|uuid                                |level |ts                 |message        |\r\n+------------------------------------+------+-------------------+---------------+\r\n|b742ee76-65d3-4d74-ba74-2c25d3cd4795|low   |2021-07-25 12:43:20|the third mess |\r\n|db6a2c2a-93a8-443c-9e41-36cb214648f4|high  |2021-07-23 00:23:56|the fourth mess|\r\n|db6a2c2a-93a8-443c-9e41-36cb214648f4|sensor|2021-07-23 17:24:03|the second mess|\r\n|e41764f7-638b-4605-9642-f2b607d77c45|middle|2021-07-23 17:24:03|the first mess |\r\n+------------------------------------+------+-------------------+---------------+\r\n\r\nit seems that there is no change with the table rows，insert overwrite clause not affect？\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887356836/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887370140","html_url":"https://github.com/apache/iceberg/issues/2871#issuecomment-887370140","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2871","id":887370140,"node_id":"IC_kwDOCW7NX8405DGc","user":{"login":"zhangpanbigData","id":87966215,"node_id":"MDQ6VXNlcjg3OTY2MjE1","avatar_url":"https://avatars.githubusercontent.com/u/87966215?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangpanbigData","html_url":"https://github.com/zhangpanbigData","followers_url":"https://api.github.com/users/zhangpanbigData/followers","following_url":"https://api.github.com/users/zhangpanbigData/following{/other_user}","gists_url":"https://api.github.com/users/zhangpanbigData/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangpanbigData/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangpanbigData/subscriptions","organizations_url":"https://api.github.com/users/zhangpanbigData/orgs","repos_url":"https://api.github.com/users/zhangpanbigData/repos","events_url":"https://api.github.com/users/zhangpanbigData/events{/privacy}","received_events_url":"https://api.github.com/users/zhangpanbigData/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T09:45:05Z","updated_at":"2021-07-27T09:45:05Z","author_association":"NONE","body":"> I see, I think it's a Spark compatibility issue. first() is a 'nullable' function (it may return null values), but the table column is marked non-nullable. You can try to edit the table schema to have that column nullable.\r\n\r\nand static overwrite mode also not avaiable：\r\nscala> spark.sql(\"set spark.sql.sources.partitionOverwriteMode\").show(truncate=false)\r\n+----------------------------------------+------+\r\n|key                                     |value |\r\n+----------------------------------------+------+\r\n|spark.sql.sources.partitionOverwriteMode|STATIC|\r\n+----------------------------------------+------+\r\n\r\nscala> spark.sql(\"select * from hive_catalog.icebergdb.logs\").show(false)\r\n+------------------------------------+------+-------------------+---------------+\r\n|uuid                                |level |ts                 |message        |\r\n+------------------------------------+------+-------------------+---------------+\r\n|db6a2c2a-93a8-443c-9e41-36cb214648f4|sensor|2021-07-24 18:43:29|the fifth mess |\r\n|b742ee76-65d3-4d74-ba74-2c25d3cd4795|low   |2021-07-25 12:43:20|the third mess |\r\n|db6a2c2a-93a8-443c-9e41-36cb214648f4|high  |2021-07-23 00:23:56|the fourth mess|\r\n|db6a2c2a-93a8-443c-9e41-36cb214648f4|sensor|2021-07-23 17:24:03|the second mess|\r\n|e41764f7-638b-4605-9642-f2b607d77c45|middle|2021-07-23 17:24:03|the first mess |\r\n+------------------------------------+------+-------------------+---------------+\r\n\r\nscala> spark.sql(\"select uuid,first(level),first(ts),first(message) from hive_catalog.icebergdb.logs where level='sensor' group by uuid\").show(false)\r\n+------------------------------------+------------+-------------------+--------------+\r\n|uuid                                |first(level)|first(ts)          |first(message)|\r\n+------------------------------------+------------+-------------------+--------------+\r\n|db6a2c2a-93a8-443c-9e41-36cb214648f4|sensor      |2021-07-24 18:43:29|the fifth mess|\r\n+------------------------------------+------------+-------------------+--------------+\r\n\r\n\r\nscala> spark.sql(\"insert overwrite hive_catalog.icebergdb.logs partition (level='sensor') select uuid,first(level),first(ts),first(message) from hive_catalog.icebergdb.logs where level='sensor' group by uuid\").show(false)\r\norg.apache.spark.sql.AnalysisException: Cannot write to 'hive_catalog.icebergdb.logs', too many data columns:\r\nTable columns: 'uuid', 'level', 'ts', 'message'\r\nData columns: 'uuid', 'level', 'first(level)', 'first(ts)', 'first(message)';\r\n  at org.apache.spark.sql.catalyst.analysis.TableOutputResolver$.resolveOutputColumns(TableOutputResolver.scala:38)\r\n  at org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveOutputRelation$$anonfun$apply$30.applyOrElse(Analyzer.scala:2879)\r\n  at org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveOutputRelation$$anonfun$apply$30.applyOrElse(Analyzer.scala:2862)\r\n  at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper.$anonfun$resolveOperatorsDown$2(AnalysisHelper.scala:108)\r\n  at org.apache.spark.sql.catalyst.trees.CurrentOrigin$.withOrigin(TreeNode.scala:75)\r\n  at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper.$anonfun$resolveOperatorsDown$1(AnalysisHelper.scala:108)\r\n  at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper$.allowInvokingTransformsInAnalyzer(AnalysisHelper.scala:212)\r\n  at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper.resolveOperatorsDown(AnalysisHelper.scala:106)\r\n  at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper.resolveOperatorsDown$(AnalysisHelper.scala:104)\r\n  at org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.resolveOperatorsDown(LogicalPlan.scala:29)\r\n  at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper.resolveOperators(AnalysisHelper.scala:73)\r\n  at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper.resolveOperators$(AnalysisHelper.scala:72)\r\n  at org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.resolveOperators(LogicalPlan.scala:29)\r\n  at org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveOutputRelation$.apply(Analyzer.scala:2862)\r\n  at org.apache.spark.sql.catalyst.analysis.Analyzer$ResolveOutputRelation$.apply(Analyzer.scala:2861)\r\n  at org.apache.spark.sql.catalyst.rules.RuleExecutor.$anonfun$execute$2(RuleExecutor.scala:149)\r\n  at scala.collection.LinearSeqOptimized.foldLeft(LinearSeqOptimized.scala:126)\r\n  at scala.collection.LinearSeqOptimized.foldLeft$(LinearSeqOptimized.scala:122)\r\n  at scala.collection.immutable.List.foldLeft(List.scala:89)\r\n  at org.apache.spark.sql.catalyst.rules.RuleExecutor.$anonfun$execute$1(RuleExecutor.scala:146)\r\n  at org.apache.spark.sql.catalyst.rules.RuleExecutor.$anonfun$execute$1$adapted(RuleExecutor.scala:138)\r\n  at scala.collection.immutable.List.foreach(List.scala:392)\r\n  at org.apache.spark.sql.catalyst.rules.RuleExecutor.execute(RuleExecutor.scala:138)\r\n  at org.apache.spark.sql.catalyst.analysis.Analyzer.org$apache$spark$sql$catalyst$analysis$Analyzer$$executeSameContext(Analyzer.scala:171)\r\n  at org.apache.spark.sql.catalyst.analysis.Analyzer.execute(Analyzer.scala:165)\r\n  at org.apache.spark.sql.catalyst.analysis.Analyzer.execute(Analyzer.scala:130)\r\n  at org.apache.spark.sql.catalyst.rules.RuleExecutor.$anonfun$executeAndTrack$1(RuleExecutor.scala:116)\r\n  at org.apache.spark.sql.catalyst.QueryPlanningTracker$.withTracker(QueryPlanningTracker.scala:88)\r\n  at org.apache.spark.sql.catalyst.rules.RuleExecutor.executeAndTrack(RuleExecutor.scala:116)\r\n  at org.apache.spark.sql.catalyst.analysis.Analyzer.$anonfun$executeAndCheck$1(Analyzer.scala:149)\r\n  at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper$.markInAnalyzer(AnalysisHelper.scala:219)\r\n  at org.apache.spark.sql.catalyst.analysis.Analyzer.executeAndCheck(Analyzer.scala:148)\r\n  at org.apache.spark.sql.execution.QueryExecution.$anonfun$analyzed$1(QueryExecution.scala:68)\r\n  at org.apache.spark.sql.catalyst.QueryPlanningTracker.measurePhase(QueryPlanningTracker.scala:111)\r\n  at org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$1(QueryExecution.scala:138)\r\n  at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:767)\r\n  at org.apache.spark.sql.execution.QueryExecution.executePhase(QueryExecution.scala:138)\r\n  at org.apache.spark.sql.execution.QueryExecution.analyzed$lzycompute(QueryExecution.scala:68)\r\n  at org.apache.spark.sql.execution.QueryExecution.analyzed(QueryExecution.scala:66)\r\n  at org.apache.spark.sql.execution.QueryExecution.assertAnalyzed(QueryExecution.scala:58)\r\n  at org.apache.spark.sql.Dataset$.$anonfun$ofRows$2(Dataset.scala:99)\r\n  at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:767)\r\n  at org.apache.spark.sql.Dataset$.ofRows(Dataset.scala:97)\r\n  at org.apache.spark.sql.SparkSession.$anonfun$sql$1(SparkSession.scala:610)\r\n  at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:767)\r\n  at org.apache.spark.sql.SparkSession.sql(SparkSession.scala:605)\r\n  ... 47 elided\r\n\r\nit throw exception directly....","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887370140/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887389462","html_url":"https://github.com/apache/iceberg/issues/2853#issuecomment-887389462","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2853","id":887389462,"node_id":"IC_kwDOCW7NX8405H0W","user":{"login":"wesselr","id":25147206,"node_id":"MDQ6VXNlcjI1MTQ3MjA2","avatar_url":"https://avatars.githubusercontent.com/u/25147206?v=4","gravatar_id":"","url":"https://api.github.com/users/wesselr","html_url":"https://github.com/wesselr","followers_url":"https://api.github.com/users/wesselr/followers","following_url":"https://api.github.com/users/wesselr/following{/other_user}","gists_url":"https://api.github.com/users/wesselr/gists{/gist_id}","starred_url":"https://api.github.com/users/wesselr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wesselr/subscriptions","organizations_url":"https://api.github.com/users/wesselr/orgs","repos_url":"https://api.github.com/users/wesselr/repos","events_url":"https://api.github.com/users/wesselr/events{/privacy}","received_events_url":"https://api.github.com/users/wesselr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T10:14:20Z","updated_at":"2021-07-27T10:14:20Z","author_association":"NONE","body":"@openinx \r\n\r\nCompiled and tested, then baked into my docker images.\r\n\r\nWas able to write the partitioned and bucketed table with success. Checked counts and did some extra appends to see if dups or data was lost. Writing worked flawlessly, will continue investigating to confirm if there are issues and report back if I find any.  \r\n\r\nThanks for the patch, let me know if I can help with documentation for the `IcebergSpark` function register when they are added. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887389462/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887390581","html_url":"https://github.com/apache/iceberg/issues/2874#issuecomment-887390581","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2874","id":887390581,"node_id":"IC_kwDOCW7NX8405IF1","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T10:15:48Z","updated_at":"2021-07-27T10:15:48Z","author_association":"MEMBER","body":"@julianjsynnex , the correct way to create a spark table with sort order columns is: \r\n\r\nStep.1  start a spark-sql:\r\n\r\n```bash\r\n./bin/spark-sql --jars /Users/openinx/test/apache-iceberg-0.12.0-1.0.0/spark3-runtime/build/libs/iceberg-spark3-runtime-0.12.0-1.0.0.jar \\\r\n    --conf spark.sql.extensions=org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensions \\\r\n    --conf spark.sql.catalog.local=org.apache.iceberg.spark.SparkCatalog \\\r\n    --conf spark.sql.catalog.local.type=hadoop \\\r\n    --conf spark.sql.catalog.local.warehouse=file:///Users/openinx/test/spark-warehouse\r\n```\r\n\r\nStep.2  create table\r\n\r\n```sql\r\nCREATE TABLE local.default.sample (\r\n    id   BIGINT,\r\n    data STRING\r\n) USING iceberg ;\r\n```\r\n\r\nStep.3 Alter the table with sort-order columns: \r\n\r\n```sql\r\nALTER TABLE local.default.sample WRITE ORDERED BY (data, id);\r\n```\r\n\r\nFinally,  you can see the sort-order specification in `sample` table's metadata: \r\n\r\n```json\r\n\"default-sort-order-id\" : 1,\r\n  \"sort-orders\" : [ {\r\n    \"order-id\" : 0,\r\n    \"fields\" : [ ]\r\n  }, {\r\n    \"order-id\" : 1,\r\n    \"fields\" : [ {\r\n      \"transform\" : \"identity\",\r\n      \"source-id\" : 2,\r\n      \"direction\" : \"asc\",\r\n      \"null-order\" : \"nulls-first\"\r\n    }, {\r\n      \"transform\" : \"identity\",\r\n      \"source-id\" : 1,\r\n      \"direction\" : \"asc\",\r\n      \"null-order\" : \"nulls-first\"\r\n    } ]\r\n  } ],\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887390581/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887403512","html_url":"https://github.com/apache/iceberg/issues/2853#issuecomment-887403512","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2853","id":887403512,"node_id":"IC_kwDOCW7NX8405LP4","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T10:36:18Z","updated_at":"2021-07-27T10:36:18Z","author_association":"MEMBER","body":"@wesselr  thanks for the verification ! If you have the bandwidth, you can try to prepare the PR to add  all the build-in transforms UDF (if you want to contribute) in the `IcebergSpark` and provide a document for it.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887403512/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887413297","html_url":"https://github.com/apache/iceberg/issues/2853#issuecomment-887413297","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2853","id":887413297,"node_id":"IC_kwDOCW7NX8405Nox","user":{"login":"wesselr","id":25147206,"node_id":"MDQ6VXNlcjI1MTQ3MjA2","avatar_url":"https://avatars.githubusercontent.com/u/25147206?v=4","gravatar_id":"","url":"https://api.github.com/users/wesselr","html_url":"https://github.com/wesselr","followers_url":"https://api.github.com/users/wesselr/followers","following_url":"https://api.github.com/users/wesselr/following{/other_user}","gists_url":"https://api.github.com/users/wesselr/gists{/gist_id}","starred_url":"https://api.github.com/users/wesselr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wesselr/subscriptions","organizations_url":"https://api.github.com/users/wesselr/orgs","repos_url":"https://api.github.com/users/wesselr/repos","events_url":"https://api.github.com/users/wesselr/events{/privacy}","received_events_url":"https://api.github.com/users/wesselr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T10:53:58Z","updated_at":"2021-07-27T10:53:58Z","author_association":"NONE","body":"@openinx \r\n\r\nSure, will try and make time this week or early next week. \r\n\r\nAre there any guidelines I need to follow for PRs?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887413297/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887415747","html_url":"https://github.com/apache/iceberg/pull/2850#issuecomment-887415747","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2850","id":887415747,"node_id":"IC_kwDOCW7NX8405OPD","user":{"login":"findepi","id":144328,"node_id":"MDQ6VXNlcjE0NDMyOA==","avatar_url":"https://avatars.githubusercontent.com/u/144328?v=4","gravatar_id":"","url":"https://api.github.com/users/findepi","html_url":"https://github.com/findepi","followers_url":"https://api.github.com/users/findepi/followers","following_url":"https://api.github.com/users/findepi/following{/other_user}","gists_url":"https://api.github.com/users/findepi/gists{/gist_id}","starred_url":"https://api.github.com/users/findepi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/findepi/subscriptions","organizations_url":"https://api.github.com/users/findepi/orgs","repos_url":"https://api.github.com/users/findepi/repos","events_url":"https://api.github.com/users/findepi/events{/privacy}","received_events_url":"https://api.github.com/users/findepi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T10:58:12Z","updated_at":"2021-07-27T10:58:12Z","author_association":"MEMBER","body":"FWIW here is the related change in Trino https://github.com/trinodb/trino/pull/6063\r\nand related discussion: https://github.com/trinodb/trino/issues/5632#issuecomment-714274998","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887415747/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887440763","html_url":"https://github.com/apache/iceberg/pull/1996#issuecomment-887440763","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1996","id":887440763,"node_id":"IC_kwDOCW7NX8405UV7","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T11:40:33Z","updated_at":"2021-07-27T11:40:33Z","author_association":"MEMBER","body":"Since @Reo-LEI  picked this PR,  I will close this PR now. And let's review that PR [here](https://github.com/apache/iceberg/pull/2863).","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887440763/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887477481","html_url":"https://github.com/apache/iceberg/issues/2557#issuecomment-887477481","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2557","id":887477481,"node_id":"IC_kwDOCW7NX8405dTp","user":{"login":"snazy","id":957468,"node_id":"MDQ6VXNlcjk1NzQ2OA==","avatar_url":"https://avatars.githubusercontent.com/u/957468?v=4","gravatar_id":"","url":"https://api.github.com/users/snazy","html_url":"https://github.com/snazy","followers_url":"https://api.github.com/users/snazy/followers","following_url":"https://api.github.com/users/snazy/following{/other_user}","gists_url":"https://api.github.com/users/snazy/gists{/gist_id}","starred_url":"https://api.github.com/users/snazy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/snazy/subscriptions","organizations_url":"https://api.github.com/users/snazy/orgs","repos_url":"https://api.github.com/users/snazy/repos","events_url":"https://api.github.com/users/snazy/events{/privacy}","received_events_url":"https://api.github.com/users/snazy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T12:39:59Z","updated_at":"2021-07-27T12:39:59Z","author_association":"MEMBER","body":"Since #2834 the Nessie-tests are no longer ran via Quarkus and there's no more \"log spam\". Think, this one can be closed.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887477481/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887635306","html_url":"https://github.com/apache/iceberg/pull/2865#issuecomment-887635306","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2865","id":887635306,"node_id":"IC_kwDOCW7NX8406D1q","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T16:00:29Z","updated_at":"2021-07-27T16:00:29Z","author_association":"CONTRIBUTOR","body":"Thanks for the reviews, everyone!\r\n\r\n@openinx, I agree that we should handle the other case you pointed out. I'm going to open a new PR for that case later today.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887635306/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887662619","html_url":"https://github.com/apache/iceberg/pull/2877#issuecomment-887662619","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2877","id":887662619,"node_id":"IC_kwDOCW7NX8406Kgb","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T16:37:08Z","updated_at":"2021-07-27T16:37:08Z","author_association":"MEMBER","body":"Solves #2783 ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887662619/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887662870","html_url":"https://github.com/apache/iceberg/issues/2783#issuecomment-887662870","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2783","id":887662870,"node_id":"IC_kwDOCW7NX8406KkW","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T16:37:32Z","updated_at":"2021-07-27T16:37:32Z","author_association":"MEMBER","body":"Pr Posted ^ For those interested","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887662870/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887663556","html_url":"https://github.com/apache/iceberg/pull/2877#issuecomment-887663556","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2877","id":887663556,"node_id":"IC_kwDOCW7NX8406KvE","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T16:38:34Z","updated_at":"2021-07-27T16:38:34Z","author_association":"MEMBER","body":"@szehon-ho + @aokolnychyi + @rdblue + @cwsteinbach - If you have some time I would be grateful if you could check this out","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887663556/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887776855","html_url":"https://github.com/apache/iceberg/pull/2877#issuecomment-887776855","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2877","id":887776855,"node_id":"IC_kwDOCW7NX8406mZX","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T19:29:54Z","updated_at":"2021-07-27T19:29:54Z","author_association":"CONTRIBUTOR","body":"@RussellSpitzer, can you update the description with a high-level summary of what you're changing?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887776855/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887845285","html_url":"https://github.com/apache/iceberg/pull/2877#issuecomment-887845285","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2877","id":887845285,"node_id":"IC_kwDOCW7NX84063Gl","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T21:24:53Z","updated_at":"2021-07-27T21:24:53Z","author_association":"MEMBER","body":"> @RussellSpitzer, can you update the description with a high-level summary of what you're changing?\r\n\r\nAdded! Sorry I have been posting notes in a lot of different places. The other option for the solution is to figure out our read schema correctly the first time based on what is being pruned rather than just using the table schema but I think this is a bit simpler.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887845285/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887847557","html_url":"https://github.com/apache/iceberg/pull/2842#issuecomment-887847557","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2842","id":887847557,"node_id":"IC_kwDOCW7NX84063qF","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T21:29:13Z","updated_at":"2021-07-27T21:29:13Z","author_association":"CONTRIBUTOR","body":"@rdblue any thoughts on this?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887847557/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887882956","html_url":"https://github.com/apache/iceberg/pull/2877#issuecomment-887882956","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2877","id":887882956,"node_id":"IC_kwDOCW7NX8407ATM","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T22:46:07Z","updated_at":"2021-07-27T22:46:35Z","author_association":"MEMBER","body":"I added another test and found an issue with my fix. We create a StructInternalRow with a \"type\" and it's data \"struct\"\r\nWhen we actually prune the projected record's \"type\" does not match the struct layout, this is an issue for Map, Array, Struct types.\r\n\r\nFor example, if we make a BaseFile with a projection we end up with a mapping of ordinal to physical entry in the row, but the StructInternal row does *not* do the same mapping when looking up types. So although my fix works for all non parameterized lookups, it fails on parameterized types since the parameterized types are looked up based on the original layout and not the pruned one.\r\n\r\nIe\r\nStructInternalRow(TableLayout) stores\r\n```\r\nTypes = ( int, string, int, list)\r\ndata = ([1,2], \"hello\") with Map ( 0 -> 3, 2 -> 1)\r\n```\r\nSince the type lookup doesn't know about the projection it is incorrect ... trying to figure out a fix without breaking everything\r\n\r\nThis isn't an issue for setters or getters which know their type, since they never touch the \"Types\" struct.\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887882956/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887947654","html_url":"https://github.com/apache/iceberg/pull/2877#issuecomment-887947654","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2877","id":887947654,"node_id":"IC_kwDOCW7NX8407QGG","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T01:50:28Z","updated_at":"2021-07-28T03:44:11Z","author_association":"MEMBER","body":"Ok so trying to fix this from the Source side, the issue here for Entries table is although it reports a schema of\r\n```\r\nstatus, snapshot_id, sequence_number, data_file <Struct with 15 fields>\r\n```\r\n\r\nThe manifest reader is allowed to project within data file which means the actual GenericManifestFiles it creates have a schema of\r\n```\r\nstatus, snapshot_id, sequence_number, data_file < pruned columns>\r\n```\r\n\r\nThis means the table schema as set in the read tasks is incorrect and does not match what is actually in the read data.\r\n\r\nCreating GenericManfiestFile with projection of data file column in the reader, creating structs with pruned columns and projections\r\n\r\nhttps://github.com/apache/iceberg/blob/83ebd4ed57254822ca26ef9b7a5ea6f528da8b34/core/src/main/java/org/apache/iceberg/ManifestEntriesTable.java#L141-L142\r\n\r\nCreating Spark StructInternalRow representation using incorrect schema (full table schema not projected schema used in GenericManfiestFile) no pruned columns or projections\r\n\r\nhttps://github.com/apache/iceberg/blob/c69da8a8c1c2f99de3a1b826514775f0f07bde72/spark/src/main/java/org/apache/iceberg/spark/source/RowDataReader.java#L189","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887947654/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887973321","html_url":"https://github.com/apache/iceberg/pull/2877#issuecomment-887973321","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2877","id":887973321,"node_id":"IC_kwDOCW7NX8407WXJ","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T03:06:05Z","updated_at":"2021-07-28T03:06:05Z","author_association":"MEMBER","body":"@rdblue Attempted to fix this from the other direction, I don't like this because we have to muck about with the DataTask api. But our underlying issue is a DataTask may read an element with a struct layout different than the table it originated from based on\r\nscan time projection. In this example the entry table when scanned produces tasks with a different schema (because of datafile pruning) than it originally reports as a table itself.\r\n\r\nIf you have another approach I'm all ears, but I think we will run into this again if we want to allow other metadata tables like the\r\npure files table to prune in a similar way.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887973321/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887980139","html_url":"https://github.com/apache/iceberg/pull/2841#issuecomment-887980139","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2841","id":887980139,"node_id":"IC_kwDOCW7NX8407YBr","user":{"login":"chenjunjiedada","id":3960228,"node_id":"MDQ6VXNlcjM5NjAyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3960228?v=4","gravatar_id":"","url":"https://api.github.com/users/chenjunjiedada","html_url":"https://github.com/chenjunjiedada","followers_url":"https://api.github.com/users/chenjunjiedada/followers","following_url":"https://api.github.com/users/chenjunjiedada/following{/other_user}","gists_url":"https://api.github.com/users/chenjunjiedada/gists{/gist_id}","starred_url":"https://api.github.com/users/chenjunjiedada/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenjunjiedada/subscriptions","organizations_url":"https://api.github.com/users/chenjunjiedada/orgs","repos_url":"https://api.github.com/users/chenjunjiedada/repos","events_url":"https://api.github.com/users/chenjunjiedada/events{/privacy}","received_events_url":"https://api.github.com/users/chenjunjiedada/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T03:24:02Z","updated_at":"2021-07-28T03:24:02Z","author_association":"COLLABORATOR","body":"@openinx @jackye1995 I rebased the #2364, now you can take a quick look at how the APIs are used. \r\n\r\ncc @rdblue @aokolnychyi @RussellSpitzer @yyanyy ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887980139/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887985252","html_url":"https://github.com/apache/iceberg/pull/2867#issuecomment-887985252","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2867","id":887985252,"node_id":"IC_kwDOCW7NX8407ZRk","user":{"login":"hameizi","id":18445460,"node_id":"MDQ6VXNlcjE4NDQ1NDYw","avatar_url":"https://avatars.githubusercontent.com/u/18445460?v=4","gravatar_id":"","url":"https://api.github.com/users/hameizi","html_url":"https://github.com/hameizi","followers_url":"https://api.github.com/users/hameizi/followers","following_url":"https://api.github.com/users/hameizi/following{/other_user}","gists_url":"https://api.github.com/users/hameizi/gists{/gist_id}","starred_url":"https://api.github.com/users/hameizi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hameizi/subscriptions","organizations_url":"https://api.github.com/users/hameizi/orgs","repos_url":"https://api.github.com/users/hameizi/repos","events_url":"https://api.github.com/users/hameizi/events{/privacy}","received_events_url":"https://api.github.com/users/hameizi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T03:41:19Z","updated_at":"2021-07-28T03:41:19Z","author_association":"CONTRIBUTOR","body":"@openinx Could you help review?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887985252/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887999783","html_url":"https://github.com/apache/iceberg/pull/2841#issuecomment-887999783","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2841","id":887999783,"node_id":"IC_kwDOCW7NX8407c0n","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T04:27:20Z","updated_at":"2021-07-28T04:27:20Z","author_association":"CONTRIBUTOR","body":"Thank you! I reviewed the PR. I will paste my major comment also here:\r\n\r\nAfter reading `ConvertEqDeletesStrategy.rewriteDeletes`, I think we can make the `RewriteDeleteStrategy` interface closer to `RewriteStrategy` interface. What we have there is basically the equivalent of `planFileGroups` plus `rewriteFiles` in `RewriteStrategy`. So I would propose we have the following methods in `RewriteDeleteStrategy` to be more aligned:\r\n\r\n```\r\nIterable<DeleteFile> selectDeletesToRewrite(Iterable<FileScanTask> dataFiles);\r\n\r\nIterable<List<FileScanTask>> planDeleteGroups(Iterable<DeleteFile> deleteFiles);\r\n\r\nSet<DeleteFile> rewriteDeletes(List<DeleteFile> deleteFilesToRewrite);\r\n```\r\n\r\nAnd we can get the partition `StructLike` directly from the list of scan tasks instead of passing it through the task pair in `EqualityDeleteRewriter`. In this way, we can also enable partial progress for commits.\r\n\r\nAny thoughts?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/887999783/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888047164","html_url":"https://github.com/apache/iceberg/issues/1883#issuecomment-888047164","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1883","id":888047164,"node_id":"IC_kwDOCW7NX8407oY8","user":{"login":"wxy7","id":40302376,"node_id":"MDQ6VXNlcjQwMzAyMzc2","avatar_url":"https://avatars.githubusercontent.com/u/40302376?v=4","gravatar_id":"","url":"https://api.github.com/users/wxy7","html_url":"https://github.com/wxy7","followers_url":"https://api.github.com/users/wxy7/followers","following_url":"https://api.github.com/users/wxy7/following{/other_user}","gists_url":"https://api.github.com/users/wxy7/gists{/gist_id}","starred_url":"https://api.github.com/users/wxy7/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wxy7/subscriptions","organizations_url":"https://api.github.com/users/wxy7/orgs","repos_url":"https://api.github.com/users/wxy7/repos","events_url":"https://api.github.com/users/wxy7/events{/privacy}","received_events_url":"https://api.github.com/users/wxy7/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T06:27:08Z","updated_at":"2021-07-28T06:28:04Z","author_association":"NONE","body":"@zuoyebushiwo have you solved now ? if yes, can you tell me how to solve this?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888047164/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888069862","html_url":"https://github.com/apache/iceberg/pull/2881#issuecomment-888069862","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2881","id":888069862,"node_id":"IC_kwDOCW7NX8407t7m","user":{"login":"vvellanki","id":5296341,"node_id":"MDQ6VXNlcjUyOTYzNDE=","avatar_url":"https://avatars.githubusercontent.com/u/5296341?v=4","gravatar_id":"","url":"https://api.github.com/users/vvellanki","html_url":"https://github.com/vvellanki","followers_url":"https://api.github.com/users/vvellanki/followers","following_url":"https://api.github.com/users/vvellanki/following{/other_user}","gists_url":"https://api.github.com/users/vvellanki/gists{/gist_id}","starred_url":"https://api.github.com/users/vvellanki/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vvellanki/subscriptions","organizations_url":"https://api.github.com/users/vvellanki/orgs","repos_url":"https://api.github.com/users/vvellanki/repos","events_url":"https://api.github.com/users/vvellanki/events{/privacy}","received_events_url":"https://api.github.com/users/vvellanki/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T07:10:28Z","updated_at":"2021-07-28T07:10:28Z","author_association":"NONE","body":"@rymurr Can you review this patch?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888069862/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888306217","html_url":"https://github.com/apache/iceberg/pull/2364#issuecomment-888306217","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2364","id":888306217,"node_id":"IC_kwDOCW7NX8408nop","user":{"login":"chenjunjiedada","id":3960228,"node_id":"MDQ6VXNlcjM5NjAyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3960228?v=4","gravatar_id":"","url":"https://api.github.com/users/chenjunjiedada","html_url":"https://github.com/chenjunjiedada","followers_url":"https://api.github.com/users/chenjunjiedada/followers","following_url":"https://api.github.com/users/chenjunjiedada/following{/other_user}","gists_url":"https://api.github.com/users/chenjunjiedada/gists{/gist_id}","starred_url":"https://api.github.com/users/chenjunjiedada/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenjunjiedada/subscriptions","organizations_url":"https://api.github.com/users/chenjunjiedada/orgs","repos_url":"https://api.github.com/users/chenjunjiedada/repos","events_url":"https://api.github.com/users/chenjunjiedada/events{/privacy}","received_events_url":"https://api.github.com/users/chenjunjiedada/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T13:23:31Z","updated_at":"2021-07-28T13:23:31Z","author_association":"COLLABORATOR","body":"Thanks @openinx and @jackye1995 for the detailed reviews. Let me update related PRs and will ping you guys soon.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888306217/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888326244","html_url":"https://github.com/apache/iceberg/pull/2863#issuecomment-888326244","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2863","id":888326244,"node_id":"IC_kwDOCW7NX8408shk","user":{"login":"coolderli","id":38486782,"node_id":"MDQ6VXNlcjM4NDg2Nzgy","avatar_url":"https://avatars.githubusercontent.com/u/38486782?v=4","gravatar_id":"","url":"https://api.github.com/users/coolderli","html_url":"https://github.com/coolderli","followers_url":"https://api.github.com/users/coolderli/followers","following_url":"https://api.github.com/users/coolderli/following{/other_user}","gists_url":"https://api.github.com/users/coolderli/gists{/gist_id}","starred_url":"https://api.github.com/users/coolderli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coolderli/subscriptions","organizations_url":"https://api.github.com/users/coolderli/orgs","repos_url":"https://api.github.com/users/coolderli/repos","events_url":"https://api.github.com/users/coolderli/events{/privacy}","received_events_url":"https://api.github.com/users/coolderli/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T13:51:29Z","updated_at":"2021-07-28T13:51:29Z","author_association":"CONTRIBUTOR","body":"@Reo-LEI  any update?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888326244/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888398659","html_url":"https://github.com/apache/iceberg/pull/2882#issuecomment-888398659","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2882","id":888398659,"node_id":"IC_kwDOCW7NX8408-ND","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T15:20:48Z","updated_at":"2021-07-28T15:20:48Z","author_association":"MEMBER","body":"Thanks @nastra !","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888398659/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888446093","html_url":"https://github.com/apache/iceberg/issues/2456#issuecomment-888446093","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2456","id":888446093,"node_id":"IC_kwDOCW7NX8409JyN","user":{"login":"grantatspothero","id":43971820,"node_id":"MDQ6VXNlcjQzOTcxODIw","avatar_url":"https://avatars.githubusercontent.com/u/43971820?v=4","gravatar_id":"","url":"https://api.github.com/users/grantatspothero","html_url":"https://github.com/grantatspothero","followers_url":"https://api.github.com/users/grantatspothero/followers","following_url":"https://api.github.com/users/grantatspothero/following{/other_user}","gists_url":"https://api.github.com/users/grantatspothero/gists{/gist_id}","starred_url":"https://api.github.com/users/grantatspothero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/grantatspothero/subscriptions","organizations_url":"https://api.github.com/users/grantatspothero/orgs","repos_url":"https://api.github.com/users/grantatspothero/repos","events_url":"https://api.github.com/users/grantatspothero/events{/privacy}","received_events_url":"https://api.github.com/users/grantatspothero/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T16:24:47Z","updated_at":"2021-07-28T16:25:28Z","author_association":"CONTRIBUTOR","body":"Encountering the same problem, any concerns with using this config `spark.sql.iceberg.check-nullability` in the SQL analysis to control nullability checking @rdblue \r\n\r\nFor others with the same problem, a workaround is setting: `spark.sql.storeAssignmentPolicy` to `legacy` since the code only does the check if the policy is strict or ansi.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888446093/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888450604","html_url":"https://github.com/apache/iceberg/pull/2863#issuecomment-888450604","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2863","id":888450604,"node_id":"IC_kwDOCW7NX8409K4s","user":{"login":"Reo-LEI","id":17312872,"node_id":"MDQ6VXNlcjE3MzEyODcy","avatar_url":"https://avatars.githubusercontent.com/u/17312872?v=4","gravatar_id":"","url":"https://api.github.com/users/Reo-LEI","html_url":"https://github.com/Reo-LEI","followers_url":"https://api.github.com/users/Reo-LEI/followers","following_url":"https://api.github.com/users/Reo-LEI/following{/other_user}","gists_url":"https://api.github.com/users/Reo-LEI/gists{/gist_id}","starred_url":"https://api.github.com/users/Reo-LEI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Reo-LEI/subscriptions","organizations_url":"https://api.github.com/users/Reo-LEI/orgs","repos_url":"https://api.github.com/users/Reo-LEI/repos","events_url":"https://api.github.com/users/Reo-LEI/events{/privacy}","received_events_url":"https://api.github.com/users/Reo-LEI/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T16:31:11Z","updated_at":"2021-07-28T16:31:11Z","author_association":"CONTRIBUTOR","body":"> @Reo-LEI any update?\r\n\r\nYep, I will keep push this PR. But I only have time on night, so the progress will be slow.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888450604/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888504715","html_url":"https://github.com/apache/iceberg/issues/2768#issuecomment-888504715","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2768","id":888504715,"node_id":"IC_kwDOCW7NX8409YGL","user":{"login":"holdenk","id":59893,"node_id":"MDQ6VXNlcjU5ODkz","avatar_url":"https://avatars.githubusercontent.com/u/59893?v=4","gravatar_id":"","url":"https://api.github.com/users/holdenk","html_url":"https://github.com/holdenk","followers_url":"https://api.github.com/users/holdenk/followers","following_url":"https://api.github.com/users/holdenk/following{/other_user}","gists_url":"https://api.github.com/users/holdenk/gists{/gist_id}","starred_url":"https://api.github.com/users/holdenk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/holdenk/subscriptions","organizations_url":"https://api.github.com/users/holdenk/orgs","repos_url":"https://api.github.com/users/holdenk/repos","events_url":"https://api.github.com/users/holdenk/events{/privacy}","received_events_url":"https://api.github.com/users/holdenk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T17:53:01Z","updated_at":"2021-07-28T17:53:01Z","author_association":"CONTRIBUTOR","body":"We could do this with Spark or Dask or Ray depending on what's installed on the system.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888504715/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888543857","html_url":"https://github.com/apache/iceberg/pull/2761#issuecomment-888543857","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2761","id":888543857,"node_id":"IC_kwDOCW7NX8409hpx","user":{"login":"holdenk","id":59893,"node_id":"MDQ6VXNlcjU5ODkz","avatar_url":"https://avatars.githubusercontent.com/u/59893?v=4","gravatar_id":"","url":"https://api.github.com/users/holdenk","html_url":"https://github.com/holdenk","followers_url":"https://api.github.com/users/holdenk/followers","following_url":"https://api.github.com/users/holdenk/following{/other_user}","gists_url":"https://api.github.com/users/holdenk/gists{/gist_id}","starred_url":"https://api.github.com/users/holdenk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/holdenk/subscriptions","organizations_url":"https://api.github.com/users/holdenk/orgs","repos_url":"https://api.github.com/users/holdenk/repos","events_url":"https://api.github.com/users/holdenk/events{/privacy}","received_events_url":"https://api.github.com/users/holdenk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T18:56:27Z","updated_at":"2021-07-28T18:56:27Z","author_association":"CONTRIBUTOR","body":"cc @TGooch44  I addressed your comments if you've got some cycles to review I'd appreciate it :) No rush though :)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888543857/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888567109","html_url":"https://github.com/apache/iceberg/pull/2884#issuecomment-888567109","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2884","id":888567109,"node_id":"IC_kwDOCW7NX8409nVF","user":{"login":"TGooch44","id":1591711,"node_id":"MDQ6VXNlcjE1OTE3MTE=","avatar_url":"https://avatars.githubusercontent.com/u/1591711?v=4","gravatar_id":"","url":"https://api.github.com/users/TGooch44","html_url":"https://github.com/TGooch44","followers_url":"https://api.github.com/users/TGooch44/followers","following_url":"https://api.github.com/users/TGooch44/following{/other_user}","gists_url":"https://api.github.com/users/TGooch44/gists{/gist_id}","starred_url":"https://api.github.com/users/TGooch44/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TGooch44/subscriptions","organizations_url":"https://api.github.com/users/TGooch44/orgs","repos_url":"https://api.github.com/users/TGooch44/repos","events_url":"https://api.github.com/users/TGooch44/events{/privacy}","received_events_url":"https://api.github.com/users/TGooch44/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T19:33:50Z","updated_at":"2021-07-28T19:33:50Z","author_association":"CONTRIBUTOR","body":"cc: @jun-he ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888567109/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888583591","html_url":"https://github.com/apache/iceberg/issues/1496#issuecomment-888583591","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1496","id":888583591,"node_id":"IC_kwDOCW7NX8409rWn","user":{"login":"WilliamWhispell","id":1390230,"node_id":"MDQ6VXNlcjEzOTAyMzA=","avatar_url":"https://avatars.githubusercontent.com/u/1390230?v=4","gravatar_id":"","url":"https://api.github.com/users/WilliamWhispell","html_url":"https://github.com/WilliamWhispell","followers_url":"https://api.github.com/users/WilliamWhispell/followers","following_url":"https://api.github.com/users/WilliamWhispell/following{/other_user}","gists_url":"https://api.github.com/users/WilliamWhispell/gists{/gist_id}","starred_url":"https://api.github.com/users/WilliamWhispell/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/WilliamWhispell/subscriptions","organizations_url":"https://api.github.com/users/WilliamWhispell/orgs","repos_url":"https://api.github.com/users/WilliamWhispell/repos","events_url":"https://api.github.com/users/WilliamWhispell/events{/privacy}","received_events_url":"https://api.github.com/users/WilliamWhispell/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T20:02:00Z","updated_at":"2021-07-28T20:02:00Z","author_association":"NONE","body":"I notice that https://iceberg.apache.org/spec/ doesn't mention the version-hint.txt file. Should the spec outline when a reader/writer should use the file?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888583591/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888630004","html_url":"https://github.com/apache/iceberg/pull/2887#issuecomment-888630004","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2887","id":888630004,"node_id":"IC_kwDOCW7NX84092r0","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T21:21:38Z","updated_at":"2021-07-28T21:21:38Z","author_association":"CONTRIBUTOR","body":"Thanks for working on this, @jackye1995!\r\n\r\nI think we want this to be more general than doing it in `BaseMetastoreCatalog`. If we are going to set the table version through a reserved property, then I think we should build the reserved property into `TableMetadata` so it is consistent across all catalogs.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888630004/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888631262","html_url":"https://github.com/apache/iceberg/issues/2456#issuecomment-888631262","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2456","id":888631262,"node_id":"IC_kwDOCW7NX84092_e","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T21:23:42Z","updated_at":"2021-07-28T21:23:42Z","author_association":"CONTRIBUTOR","body":"Yes, if you're hitting this problem then you probably want to set `spark.sql.storeAssignmentPolicy` to `legacy`. That disables the checks that ensure you don't attempt to write null values to a required column.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888631262/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888633457","html_url":"https://github.com/apache/iceberg/issues/1496#issuecomment-888633457","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1496","id":888633457,"node_id":"IC_kwDOCW7NX84093hx","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T21:27:40Z","updated_at":"2021-07-28T21:27:40Z","author_association":"CONTRIBUTOR","body":"@WilliamWhispell, that file should be entirely optional, which is why it isn't in the spec. It is merely a pointer to help avoid lots of work finding the current version.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888633457/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888635463","html_url":"https://github.com/apache/iceberg/pull/2841#issuecomment-888635463","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2841","id":888635463,"node_id":"IC_kwDOCW7NX84094BH","user":{"login":"yyanyy","id":71906210,"node_id":"MDQ6VXNlcjcxOTA2MjEw","avatar_url":"https://avatars.githubusercontent.com/u/71906210?v=4","gravatar_id":"","url":"https://api.github.com/users/yyanyy","html_url":"https://github.com/yyanyy","followers_url":"https://api.github.com/users/yyanyy/followers","following_url":"https://api.github.com/users/yyanyy/following{/other_user}","gists_url":"https://api.github.com/users/yyanyy/gists{/gist_id}","starred_url":"https://api.github.com/users/yyanyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yyanyy/subscriptions","organizations_url":"https://api.github.com/users/yyanyy/orgs","repos_url":"https://api.github.com/users/yyanyy/repos","events_url":"https://api.github.com/users/yyanyy/events{/privacy}","received_events_url":"https://api.github.com/users/yyanyy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T21:31:28Z","updated_at":"2021-07-28T21:31:28Z","author_association":"CONTRIBUTOR","body":"+1 to Jack's comment on making the delete strategy API mimic the one for `RewriteStrategy` since I believe the intention there was so that the rewrites can happen in batches/people can decide if they want to rewrite a certain partition/subset of files. If we directly take no argument for select files, we are assuming users will always want to rewrite the entire table. \r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888635463/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888695305","html_url":"https://github.com/apache/iceberg/pull/549#issuecomment-888695305","issue_url":"https://api.github.com/repos/apache/iceberg/issues/549","id":888695305,"node_id":"IC_kwDOCW7NX840-GoJ","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T23:55:31Z","updated_at":"2021-07-29T00:04:50Z","author_association":"CONTRIBUTOR","body":"Are we going to replace guava maps with non-guava ones? There are bunches of place using guava's Immutable Map. For example, here are 4 guava maps in class TableMetadata. We hit this issue when we were trying to broadcast one of them.\r\n```\r\n    this.snapshotsById = indexAndValidateSnapshots(snapshots, lastSequenceNumber);\r\n    this.schemasById = indexSchemas();\r\n    this.specsById = indexSpecs(specs);\r\n    this.sortOrdersById = indexSortOrders(sortOrders);\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888695305/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888701079","html_url":"https://github.com/apache/iceberg/pull/2877#issuecomment-888701079","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2877","id":888701079,"node_id":"IC_kwDOCW7NX840-ICX","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T00:10:14Z","updated_at":"2021-07-29T00:10:14Z","author_association":"CONTRIBUTOR","body":"Thanks, I'll take a look at this as soon as I can","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888701079/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888704844","html_url":"https://github.com/apache/iceberg/pull/549#issuecomment-888704844","issue_url":"https://api.github.com/repos/apache/iceberg/issues/549","id":888704844,"node_id":"IC_kwDOCW7NX840-I9M","user":{"login":"jzhuge","id":1883812,"node_id":"MDQ6VXNlcjE4ODM4MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1883812?v=4","gravatar_id":"","url":"https://api.github.com/users/jzhuge","html_url":"https://github.com/jzhuge","followers_url":"https://api.github.com/users/jzhuge/followers","following_url":"https://api.github.com/users/jzhuge/following{/other_user}","gists_url":"https://api.github.com/users/jzhuge/gists{/gist_id}","starred_url":"https://api.github.com/users/jzhuge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jzhuge/subscriptions","organizations_url":"https://api.github.com/users/jzhuge/orgs","repos_url":"https://api.github.com/users/jzhuge/repos","events_url":"https://api.github.com/users/jzhuge/events{/privacy}","received_events_url":"https://api.github.com/users/jzhuge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T00:20:37Z","updated_at":"2021-07-29T00:20:37Z","author_association":"MEMBER","body":"What version of kyro do you use? Newer versions support ImmutableMap.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888704844/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888705113","html_url":"https://github.com/apache/iceberg/pull/549#issuecomment-888705113","issue_url":"https://api.github.com/repos/apache/iceberg/issues/549","id":888705113,"node_id":"IC_kwDOCW7NX840-JBZ","user":{"login":"jzhuge","id":1883812,"node_id":"MDQ6VXNlcjE4ODM4MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1883812?v=4","gravatar_id":"","url":"https://api.github.com/users/jzhuge","html_url":"https://github.com/jzhuge","followers_url":"https://api.github.com/users/jzhuge/followers","following_url":"https://api.github.com/users/jzhuge/following{/other_user}","gists_url":"https://api.github.com/users/jzhuge/gists{/gist_id}","starred_url":"https://api.github.com/users/jzhuge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jzhuge/subscriptions","organizations_url":"https://api.github.com/users/jzhuge/orgs","repos_url":"https://api.github.com/users/jzhuge/repos","events_url":"https://api.github.com/users/jzhuge/events{/privacy}","received_events_url":"https://api.github.com/users/jzhuge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T00:21:22Z","updated_at":"2021-07-29T00:21:22Z","author_association":"MEMBER","body":"https://github.com/magro/kryo-serializers/blob/master/src/main/java/de/javakaffee/kryoserializers/guava/ImmutableMapSerializer.java","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888705113/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888718478","html_url":"https://github.com/apache/iceberg/pull/2887#issuecomment-888718478","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2887","id":888718478,"node_id":"IC_kwDOCW7NX840-MSO","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T00:58:10Z","updated_at":"2021-07-29T00:58:10Z","author_association":"CONTRIBUTOR","body":"> If we are going to set the table version through a reserved property, then I think we should build the reserved property into TableMetadata so it is consistent across all catalogs.\r\n\r\n@rdblue thanks for the comment! I was thinking to only allow people to create table in this way and update property will not have any effect, that's why I did it in the table builder directly. But now I think about it I realize it will also be beneficial to use this syntax to migrate existing tables to v2:\r\n\r\n```sql\r\nALTER TABLE SET TBLPROPERTIES ('format-version'='2')\r\n```\r\n\r\nSo it does make sense to do it directly in `TableMetadata`. I have updated the code and also tested with Spark to verify it works, please let me know if there is any other concern.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888718478/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888777532","html_url":"https://github.com/apache/iceberg/issues/2885#issuecomment-888777532","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2885","id":888777532,"node_id":"IC_kwDOCW7NX840-as8","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T03:44:32Z","updated_at":"2021-07-29T03:44:32Z","author_association":"MEMBER","body":"You're correct, there's a PR for this before : https://github.com/apache/iceberg/pull/2852 ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888777532/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888779550","html_url":"https://github.com/apache/iceberg/pull/2886#issuecomment-888779550","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2886","id":888779550,"node_id":"IC_kwDOCW7NX840-bMe","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T03:51:48Z","updated_at":"2021-07-29T03:51:48Z","author_association":"MEMBER","body":"Thanks @stevenzwu for the PR,   Let me take a look...","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888779550/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888811705","html_url":"https://github.com/apache/iceberg/pull/549#issuecomment-888811705","issue_url":"https://api.github.com/repos/apache/iceberg/issues/549","id":888811705,"node_id":"IC_kwDOCW7NX840-jC5","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T05:20:34Z","updated_at":"2021-07-29T05:28:47Z","author_association":"CONTRIBUTOR","body":"Thanks for the information. Nice to see you here, @jzhuge. We are using kryo-shaded-4.0.2.jar in Spark. Which version has the change in https://github.com/magro/kryo-serializers/blob/master/src/main/java/de/javakaffee/kryoserializers/guava/ImmutableMapSerializer.java?\r\nAlso, Spark 3.1.2 uses kryo v4 per this doc, https://spark.apache.org/docs/latest/tuning.html#data-serialization.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888811705/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888822594","html_url":"https://github.com/apache/iceberg/pull/549#issuecomment-888822594","issue_url":"https://api.github.com/repos/apache/iceberg/issues/549","id":888822594,"node_id":"IC_kwDOCW7NX840-ltC","user":{"login":"jzhuge","id":1883812,"node_id":"MDQ6VXNlcjE4ODM4MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1883812?v=4","gravatar_id":"","url":"https://api.github.com/users/jzhuge","html_url":"https://github.com/jzhuge","followers_url":"https://api.github.com/users/jzhuge/followers","following_url":"https://api.github.com/users/jzhuge/following{/other_user}","gists_url":"https://api.github.com/users/jzhuge/gists{/gist_id}","starred_url":"https://api.github.com/users/jzhuge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jzhuge/subscriptions","organizations_url":"https://api.github.com/users/jzhuge/orgs","repos_url":"https://api.github.com/users/jzhuge/repos","events_url":"https://api.github.com/users/jzhuge/events{/privacy}","received_events_url":"https://api.github.com/users/jzhuge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T05:50:04Z","updated_at":"2021-07-29T05:50:04Z","author_association":"MEMBER","body":"Oops, I referenced the wrong repo.\r\n\r\nIf possible, you can add the following code to `KryoSerializer.newKryo()`:\r\n```\r\n    ImmutableListSerializer.registerSerializers(kryo);\r\n    ImmutableMapSerializer.registerSerializers(kryo);\r\n```\r\n\r\nBe sure to add dependency on `de.javakaffee:kryo-serializers`.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888822594/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888868193","html_url":"https://github.com/apache/iceberg/pull/2850#issuecomment-888868193","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2850","id":888868193,"node_id":"IC_kwDOCW7NX840-w1h","user":{"login":"sshkvar","id":3986221,"node_id":"MDQ6VXNlcjM5ODYyMjE=","avatar_url":"https://avatars.githubusercontent.com/u/3986221?v=4","gravatar_id":"","url":"https://api.github.com/users/sshkvar","html_url":"https://github.com/sshkvar","followers_url":"https://api.github.com/users/sshkvar/followers","following_url":"https://api.github.com/users/sshkvar/following{/other_user}","gists_url":"https://api.github.com/users/sshkvar/gists{/gist_id}","starred_url":"https://api.github.com/users/sshkvar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sshkvar/subscriptions","organizations_url":"https://api.github.com/users/sshkvar/orgs","repos_url":"https://api.github.com/users/sshkvar/repos","events_url":"https://api.github.com/users/sshkvar/events{/privacy}","received_events_url":"https://api.github.com/users/sshkvar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T07:22:57Z","updated_at":"2021-07-29T07:22:57Z","author_association":"CONTRIBUTOR","body":"Another important reason why we need unique table location is `Rename table` action.\r\nWe have a cases when users changing name of tables and then create tables with same name, like:\r\n1. User create table with name `table1`\r\n2. Then rename it to `table2`\r\n3. Create new table with name `table1`\r\n\r\nIn this case data and metadata files will be placed in same 'folder' on s3. When we will perform remove orphan files action for example for `table1` it will remove data and metadata files for `table2`","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888868193/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888870841","html_url":"https://github.com/apache/iceberg/pull/2680#issuecomment-888870841","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2680","id":888870841,"node_id":"IC_kwDOCW7NX840-xe5","user":{"login":"coolderli","id":38486782,"node_id":"MDQ6VXNlcjM4NDg2Nzgy","avatar_url":"https://avatars.githubusercontent.com/u/38486782?v=4","gravatar_id":"","url":"https://api.github.com/users/coolderli","html_url":"https://github.com/coolderli","followers_url":"https://api.github.com/users/coolderli/followers","following_url":"https://api.github.com/users/coolderli/following{/other_user}","gists_url":"https://api.github.com/users/coolderli/gists{/gist_id}","starred_url":"https://api.github.com/users/coolderli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coolderli/subscriptions","organizations_url":"https://api.github.com/users/coolderli/orgs","repos_url":"https://api.github.com/users/coolderli/repos","events_url":"https://api.github.com/users/coolderli/events{/privacy}","received_events_url":"https://api.github.com/users/coolderli/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T07:28:00Z","updated_at":"2021-07-29T07:28:00Z","author_association":"CONTRIBUTOR","body":"@openinx Has this patch been verified? Can it be used in the production environment？","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888870841/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888874859","html_url":"https://github.com/apache/iceberg/pull/2852#issuecomment-888874859","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2852","id":888874859,"node_id":"IC_kwDOCW7NX840-ydr","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T07:35:10Z","updated_at":"2021-07-29T07:35:10Z","author_association":"MEMBER","body":"Got this merged, thanks all for reviewing !","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888874859/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888875358","html_url":"https://github.com/apache/iceberg/issues/2885#issuecomment-888875358","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2885","id":888875358,"node_id":"IC_kwDOCW7NX840-yle","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T07:36:05Z","updated_at":"2021-07-29T07:36:05Z","author_association":"MEMBER","body":"Closed via https://github.com/apache/iceberg/pull/2852","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888875358/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888925149","html_url":"https://github.com/apache/iceberg/pull/2850#issuecomment-888925149","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2850","id":888925149,"node_id":"IC_kwDOCW7NX840--vd","user":{"login":"pvary","id":19705742,"node_id":"MDQ6VXNlcjE5NzA1NzQy","avatar_url":"https://avatars.githubusercontent.com/u/19705742?v=4","gravatar_id":"","url":"https://api.github.com/users/pvary","html_url":"https://github.com/pvary","followers_url":"https://api.github.com/users/pvary/followers","following_url":"https://api.github.com/users/pvary/following{/other_user}","gists_url":"https://api.github.com/users/pvary/gists{/gist_id}","starred_url":"https://api.github.com/users/pvary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvary/subscriptions","organizations_url":"https://api.github.com/users/pvary/orgs","repos_url":"https://api.github.com/users/pvary/repos","events_url":"https://api.github.com/users/pvary/events{/privacy}","received_events_url":"https://api.github.com/users/pvary/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T08:41:40Z","updated_at":"2021-07-29T08:51:34Z","author_association":"CONTRIBUTOR","body":"Finally I put together this in my head with the same issue in Hive:\r\n- https://issues.apache.org/jira/browse/HIVE-24445\r\n\r\nWouldn't this solve both the issues?\r\n\r\nCC: @deniskuzZ, @zchovan","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/888925149/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/889007987","html_url":"https://github.com/apache/iceberg/pull/2875#issuecomment-889007987","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2875","id":889007987,"node_id":"IC_kwDOCW7NX840_S9z","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T10:39:27Z","updated_at":"2021-07-29T10:39:27Z","author_association":"MEMBER","body":"LGTM,  thanks @Flyangz for contributing !","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/889007987/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/889045179","html_url":"https://github.com/apache/iceberg/pull/2761#issuecomment-889045179","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2761","id":889045179,"node_id":"IC_kwDOCW7NX840_cC7","user":{"login":"TGooch44","id":1591711,"node_id":"MDQ6VXNlcjE1OTE3MTE=","avatar_url":"https://avatars.githubusercontent.com/u/1591711?v=4","gravatar_id":"","url":"https://api.github.com/users/TGooch44","html_url":"https://github.com/TGooch44","followers_url":"https://api.github.com/users/TGooch44/followers","following_url":"https://api.github.com/users/TGooch44/following{/other_user}","gists_url":"https://api.github.com/users/TGooch44/gists{/gist_id}","starred_url":"https://api.github.com/users/TGooch44/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TGooch44/subscriptions","organizations_url":"https://api.github.com/users/TGooch44/orgs","repos_url":"https://api.github.com/users/TGooch44/repos","events_url":"https://api.github.com/users/TGooch44/events{/privacy}","received_events_url":"https://api.github.com/users/TGooch44/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T11:38:38Z","updated_at":"2021-07-29T11:38:38Z","author_association":"CONTRIBUTOR","body":"> I think there might be some arrow stuff to add, but that might be outdated. A few comments.\r\n\r\nI think i may have mistakenly mentioned the arrow_table_utils, which doesn't exist in open source, sorry for the confusion. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/889045179/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/889045828","html_url":"https://github.com/apache/iceberg/pull/2680#issuecomment-889045828","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2680","id":889045828,"node_id":"IC_kwDOCW7NX840_cNE","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T11:39:47Z","updated_at":"2021-07-29T11:39:47Z","author_association":"MEMBER","body":"@coolderli ,  I think this PR is ready for reviewing and provided fully covered unit tests,  but we still don't get this merged because I don't know whether reviewers still has concerns for it.  I think you need to have a basic test in staging env before publish it in prod env.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/889045828/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]