[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312679369","html_url":"https://github.com/apache/couchdb/pull/627#issuecomment-312679369","issue_url":"https://api.github.com/repos/apache/couchdb/issues/627","id":312679369,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjY3OTM2OQ==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-03T15:44:40Z","updated_at":"2017-07-03T15:44:40Z","author_association":"CONTRIBUTOR","body":"I think we wanted to convert the mango test framework over to eunit at some point. It's become such a clunky thing. I guess we could also convert the entire thing over to js as well. \r\n\r\n@eiri: I read the first parts of the bug report. Now I see with an index created and posted by @wohali \r\n```\r\n[error] 2017-05-22T23:22:03.877980Z node1@127.0.0.1 <0.17275.0> 81bbcf9c62 req_err(3408688270) badrecord : vacc\r\n    [<<\"fabric:query_view/6 L343\">>,<<\"mango_cursor_view:execute/3 L98\">>,<<\"mango_httpd:handle_find_req/2 L185\">>,<<\"mango_httpd:handle_req/2 L37\">>,<<\"chttpd:process_request/1 L295\">>,<<\"chttpd:handle_request_int/1 L231\">>,<<\"mochiweb_http:headers/6 L122\">>,<<\"proc_lib:init_p_do_apply/3 L237\">>]\r\n```\r\nThis is interesting because when it's users_db in query_view we're doing:\r\n\r\n```\r\ncase fabric_util:is_users_db(Db) of\r\n    true ->\r\n        Req = Acc0#vacc.req,\r\n        FakeDb = fabric_util:fake_db(Db, [{user_ctx, Req#httpd.user_ctx}]),\r\n        couch_users_db:after_doc_read(DDoc, FakeDb);\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312679369/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312680336","html_url":"https://github.com/apache/couchdb/pull/627#issuecomment-312680336","issue_url":"https://api.github.com/repos/apache/couchdb/issues/627","id":312680336,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjY4MDMzNg==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-03T15:48:46Z","updated_at":"2017-07-03T15:48:46Z","author_association":"CONTRIBUTOR","body":"Also, we would probably want to check what happens if users created a mango text index as well.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312680336/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312688535","html_url":"https://github.com/apache/couchdb/pull/627#issuecomment-312688535","issue_url":"https://api.github.com/repos/apache/couchdb/issues/627","id":312688535,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjY4ODUzNQ==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-03T16:28:31Z","updated_at":"2017-07-03T16:28:31Z","author_association":"MEMBER","body":"> I think we wanted to convert the mango test framework over to eunit at some point.\r\n\r\nConceptually they are closer to our javascript suite, but I agree, it's better to decide on a single test framework, should we stick with existing js suite or port everything to something more user-friendly and stable.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312688535/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312718415","html_url":"https://github.com/apache/couchdb/issues/584#issuecomment-312718415","issue_url":"https://api.github.com/repos/apache/couchdb/issues/584","id":312718415,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjcxODQxNQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-03T19:24:20Z","updated_at":"2017-07-03T19:24:20Z","author_association":"MEMBER","body":"Hi @ArikShifer Are you able to test this against CouchDB master at all? We're finalising the list of bugs for fixing in 2.1 and need a reproducible test case for this against master if we're to consider this a blocker.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312718415/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312722372","html_url":"https://github.com/apache/couchdb/issues/552#issuecomment-312722372","issue_url":"https://api.github.com/repos/apache/couchdb/issues/552","id":312722372,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjcyMjM3Mg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-03T19:51:15Z","updated_at":"2017-07-03T19:53:16Z","author_association":"MEMBER","body":"@janl Seeing a failure since your checkin here, in the EUnit compaction daemon test:\r\n\r\nhttps://travis-ci.org/apache/couchdb/jobs/243780116\r\n\r\n```\r\nmodule 'couchdb_compaction_daemon_tests'\r\n  Compaction daemon tests\r\n    couchdb_compaction_daemon_tests:74: should_compact_by_default_rule...*failed*\r\nin function couchdb_compaction_daemon_tests:'-should_compact_by_default_rule/1-fun-6-'/1 (test/couchdb_compaction_daemon_tests.erl, line 104)\r\nin call from couchdb_compaction_daemon_tests:'-should_compact_by_default_rule/1-fun-7-'/1 (test/couchdb_compaction_daemon_tests.erl, line 104)\r\n**error:{assertion_failed,[{module,couchdb_compaction_daemon_tests},\r\n                   {line,104},\r\n                   {expression,\"is_idle ( DbName )\"},\r\n                   {expected,true},\r\n                   {value,false}]}\r\n```\r\n\r\nAnd again in https://travis-ci.org/apache/couchdb/jobs/243544740\r\nAnd again in https://travis-ci.org/apache/couchdb/jobs/243303511","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312722372/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312724547","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-312724547","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":312724547,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjcyNDU0Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-03T20:05:07Z","updated_at":"2017-07-03T20:05:07Z","author_association":"MEMBER","body":"@kocolosk If we're going to fix test cases, we're going to have to fix quite a few of them, and it's seems it's not just JS tests that are affected. Here are additional instances of this issue in the last ~10 Travis failures on master:\r\n\r\nhttps://travis-ci.org/apache/couchdb/jobs/248891365 (view_collation.js)\r\nhttps://travis-ci.org/apache/couchdb/jobs/248840745 (**EUnit** test in couch_mrview_changes_since_tests - where we got the `{gen_server,call,[...,infinity]}` error again!)\r\nhttps://travis-ci.org/apache/couchdb/jobs/245780773 (reduce_builtin.js - but it's an `{'EXIT',noproc}` this time. different? not much useful in the couch.log...)\r\nhttps://travis-ci.org/apache/couchdb/jobs/245780769 (reduce_builtin.js)\r\nhttps://travis-ci.org/apache/couchdb/jobs/245428546 (reduce_builtin.js)\r\nhttps://travis-ci.org/apache/couchdb/jobs/243780114 (view_pagination.js)\r\n\r\nI'm marking this as a 2.1 blocker for now. If we want to split the issue up, fine, but the eunit test tells me we may still have 2 distinct failure modes. My priority is a repeatable, clean-running test suite for the 2.1 release.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312724547/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312728326","html_url":"https://github.com/apache/couchdb/issues/554#issuecomment-312728326","issue_url":"https://api.github.com/repos/apache/couchdb/issues/554","id":312728326,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjcyODMyNg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-03T20:29:43Z","updated_at":"2017-07-03T20:29:43Z","author_association":"MEMBER","body":"We're still seeing a bunch of these:\r\n\r\nhttps://travis-ci.org/apache/couchdb/jobs/243780115 - stats.js mismatch line 58\r\nhttps://travis-ci.org/apache/couchdb/jobs/243303510 - stats.js mismatch line 58\r\n\r\nI think we have a real set of bugs here, but it may be time to re-disable the entire stats.js test for now. The fact that the test run is failing is a blocker; the fact that our stats are sometimes inconsistent, to me, isn't - though it may be indicative of race conditions as of yet uncovered.\r\n\r\nThoughts?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312728326/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312730723","html_url":"https://github.com/apache/couchdb/issues/633#issuecomment-312730723","issue_url":"https://api.github.com/repos/apache/couchdb/issues/633","id":312730723,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjczMDcyMw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-03T20:46:05Z","updated_at":"2017-07-03T20:46:05Z","author_association":"MEMBER","body":"Another one possibly for @nickva ?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312730723/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312774786","html_url":"https://github.com/apache/couchdb/pull/475#issuecomment-312774786","issue_url":"https://api.github.com/repos/apache/couchdb/issues/475","id":312774786,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjc3NDc4Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T03:57:41Z","updated_at":"2017-07-04T03:57:41Z","author_association":"MEMBER","body":"Ping @nickva @eiri can one of you +1 this PR before we merge it? Thanks!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312774786/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312776293","html_url":"https://github.com/apache/couchdb/pull/624#issuecomment-312776293","issue_url":"https://api.github.com/repos/apache/couchdb/issues/624","id":312776293,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjc3NjI5Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T04:12:36Z","updated_at":"2017-07-04T04:12:36Z","author_association":"MEMBER","body":"@janl +1, do it!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312776293/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312776523","html_url":"https://github.com/apache/couchdb/pull/570#issuecomment-312776523","issue_url":"https://api.github.com/repos/apache/couchdb/issues/570","id":312776523,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjc3NjUyMw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T04:15:16Z","updated_at":"2017-07-04T04:15:16Z","author_association":"MEMBER","body":"Would love to see this in 2.1.0 as well. @jamescorbett are you able to consistently reproduce this against our master branch?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312776523/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312901826","html_url":"https://github.com/apache/couchdb/issues/620#issuecomment-312901826","issue_url":"https://api.github.com/repos/apache/couchdb/issues/620","id":312901826,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjkwMTgyNg==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T15:14:14Z","updated_at":"2017-07-04T15:14:14Z","author_association":"MEMBER","body":"I think the docs are at fault here. I don't think it's right to return an ETag header from POST /dbname as the etag is related to the /dbname/newdocid resource not the /dbname resource.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312901826/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312902472","html_url":"https://github.com/apache/couchdb/issues/620#issuecomment-312902472","issue_url":"https://api.github.com/repos/apache/couchdb/issues/620","id":312902472,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjkwMjQ3Mg==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T15:17:11Z","updated_at":"2017-07-04T15:17:11Z","author_association":"MEMBER","body":"and further noting that the point of ETag response is for caching, and ~nothing caches POST responses (and for good reason).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312902472/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312904655","html_url":"https://github.com/apache/couchdb/issues/620#issuecomment-312904655","issue_url":"https://api.github.com/repos/apache/couchdb/issues/620","id":312904655,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjkwNDY1NQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T15:28:02Z","updated_at":"2017-07-04T15:28:02Z","author_association":"MEMBER","body":"citing https://tools.ietf.org/html/rfc7231#section-7.2 as my basis for this claim.\r\n\r\n```\r\nIn a successful response to a state-changing request, validator\r\nfields describe the new representation that has replaced the prior\r\nselected representation as a result of processing the request.\r\n```\r\n\r\nclearly the thing represented by /dbname was not replaced by the request body (a document) posted to it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312904655/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312905693","html_url":"https://github.com/apache/couchdb/issues/630#issuecomment-312905693","issue_url":"https://api.github.com/repos/apache/couchdb/issues/630","id":312905693,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjkwNTY5Mw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T15:33:14Z","updated_at":"2017-07-04T15:33:19Z","author_association":"MEMBER","body":"could this be because the changes feed is no longer totally ordered?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312905693/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312908191","html_url":"https://github.com/apache/couchdb/issues/620#issuecomment-312908191","issue_url":"https://api.github.com/repos/apache/couchdb/issues/620","id":312908191,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjkwODE5MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T15:45:27Z","updated_at":"2017-07-04T15:45:27Z","author_association":"MEMBER","body":"That may be true, but we did it in 1.6:\r\n\r\n```\r\n$ curl -X PUT http://127.0.0.1:5984/foo\r\n{\"ok\":true}\r\n$ curl --verbose -X POST -H \"Content-Type: application/json\" http://127.0.0.1:5984/foo -d '{\"am\":\"joan\"}'\r\n* Hostname was NOT found in DNS cache\r\n*   Trying 127.0.0.1...\r\n* Connected to 127.0.0.1 (127.0.0.1) port 5984 (#0)\r\n> POST /foo HTTP/1.1\r\n> User-Agent: curl/7.38.0\r\n> Host: 127.0.0.1:5984\r\n> Accept: */*\r\n> Content-Type: application/json\r\n> Content-Length: 13\r\n>\r\n* upload completely sent off: 13 out of 13 bytes\r\n< HTTP/1.1 201 Created\r\n* Server CouchDB/1.6.2 (Erlang OTP/17) is not blacklisted\r\n< Server: CouchDB/1.6.2 (Erlang OTP/17)\r\n< Location: http://127.0.0.1:5984/foo/c39513ad5ec7439a9880855224000da0\r\n< ETag: \"1-08055301094689837203c2862ea2bfe2\"\r\n< Date: Tue, 04 Jul 2017 15:44:47 GMT\r\n< Content-Type: text/plain; charset=utf-8\r\n< Content-Length: 95\r\n< Cache-Control: must-revalidate\r\n<\r\n{\"ok\":true,\"id\":\"c39513ad5ec7439a9880855224000da0\",\"rev\":\"1-08055301094689837203c2862ea2bfe2\"}\r\n* Connection #0 to host 127.0.0.1 left intact\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312908191/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312908806","html_url":"https://github.com/apache/couchdb/pull/475#issuecomment-312908806","issue_url":"https://api.github.com/repos/apache/couchdb/issues/475","id":312908806,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjkwODgwNg==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T15:49:02Z","updated_at":"2017-07-04T15:49:02Z","author_association":"MEMBER","body":"This isn't quite the right approach but I really appreciate the effort and the tests. the chttpd_auth_request.erl module controls this stuff. It's my fault, I think, that I added clustered _compact without restricting it to admins. Here's how I think it should be done;\r\n\r\n```\r\ndiff --git a/src/chttpd/src/chttpd_auth_request.erl b/src/chttpd/src/chttpd_auth_request.erl\r\nindex 90176c824..ab160ee79 100644\r\n--- a/src/chttpd/src/chttpd_auth_request.erl\r\n+++ b/src/chttpd/src/chttpd_auth_request.erl\r\n@@ -61,6 +61,10 @@ authorize_request_int(#httpd{path_parts=[_DbName], method='PUT'}=Req) ->\r\n     require_admin(Req);\r\n authorize_request_int(#httpd{path_parts=[_DbName], method='DELETE'}=Req) ->\r\n     require_admin(Req);\r\n+authorize_request_int(#httpd{path_parts=[_DbName, <<\"_compact\">>]}=Req) ->\r\n+    require_admin(Req);\r\n+authorize_request_int(#httpd{path_parts=[_DbName, <<\"_view_cleanup\">>]}=Req) ->\r\n+    require_admin(Req);\r\n authorize_request_int(#httpd{path_parts=[_DbName|_]}=Req) ->\r\n     db_authorization_check(Req).\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312908806/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312909235","html_url":"https://github.com/apache/couchdb/issues/620#issuecomment-312909235","issue_url":"https://api.github.com/repos/apache/couchdb/issues/620","id":312909235,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjkwOTIzNQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T15:51:21Z","updated_at":"2017-07-04T15:51:21Z","author_association":"MEMBER","body":"I was trying to build 1.6.1 this last hour, without success, to see if this was a regression, so thanks for that.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312909235/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312909956","html_url":"https://github.com/apache/couchdb/issues/620#issuecomment-312909956","issue_url":"https://api.github.com/repos/apache/couchdb/issues/620","id":312909956,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjkwOTk1Ng==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T15:55:05Z","updated_at":"2017-07-04T15:55:05Z","author_association":"MEMBER","body":"https://github.com/apache/couchdb-documentation/pull/139","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312909956/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312910640","html_url":"https://github.com/apache/couchdb/issues/630#issuecomment-312910640","issue_url":"https://api.github.com/repos/apache/couchdb/issues/630","id":312910640,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjkxMDY0MA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T15:58:38Z","updated_at":"2017-07-04T15:58:38Z","author_association":"MEMBER","body":"nope, can't be that.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312910640/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312913799","html_url":"https://github.com/apache/couchdb/issues/630#issuecomment-312913799","issue_url":"https://api.github.com/repos/apache/couchdb/issues/630","id":312913799,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjkxMzc5OQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T16:17:52Z","updated_at":"2017-07-04T16:17:52Z","author_association":"MEMBER","body":"  couch_changes_tests:422: should_select_with_continuous...[0.313 s] ok","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312913799/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312927106","html_url":"https://github.com/apache/couchdb/pull/475#issuecomment-312927106","issue_url":"https://api.github.com/repos/apache/couchdb/issues/475","id":312927106,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjkyNzEwNg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T17:59:50Z","updated_at":"2017-07-04T17:59:50Z","author_association":"MEMBER","body":"@fkaempfer we'd really like to fix this for 2.1, which is imminent. Can you respin your changes to match what @rnewson shows above? Keep the tests as they are, they are valuable.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312927106/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312931887","html_url":"https://github.com/apache/couchdb/issues/549#issuecomment-312931887","issue_url":"https://api.github.com/repos/apache/couchdb/issues/549","id":312931887,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjkzMTg4Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T18:26:52Z","updated_at":"2017-07-04T18:39:29Z","author_association":"MEMBER","body":"I looked at this one a bit more closely. The Makefile log output is here: https://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/2.1.x/1/pipeline/49/\r\n\r\n~~That `all_dbs_active` error got me wondering: perhaps a prior test set the `max_dbs_open` value low, and didn't clear it. A few tests earlier, `couchdb_views_tests:couchdb_1283` calls:~~\r\n\r\n```erlang\r\nok = config:set(\"couchdb\", \"max_dbs_open\", \"3\", false),\r\n```\r\n\r\n~~but I never see a similar `config:set` call to restore the default. Does our test harness clean these up for us, or could the old setting be hanging around still? If the test harness doesn't clean up config settings for us, there may be a number of places in the eunit tests where this could be biting us in weird ways.~~\r\n\r\nEDIT: Thanks, @rnewson, for helping me see that the harness calls `test_util:stop_couch/0` which does a `stop_applications(?DEFAULT_APPS)` and `-define(DEFAULT_APPS, [inets, ibrowse, ssl, config, couch_epi, couch_event, couch]).` By stopping the `config` app it loses all the settings, and that final `false` in the `config:set/4` call prevents the config change from being written to the ini file. So this is not the issue at hand...yet.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312931887/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312936640","html_url":"https://github.com/apache/couchdb/pull/626#issuecomment-312936640","issue_url":"https://api.github.com/repos/apache/couchdb/issues/626","id":312936640,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjkzNjY0MA==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T19:11:55Z","updated_at":"2017-07-04T19:11:55Z","author_association":"CONTRIBUTOR","body":"Updated to use `andalso`. If acceptable, can a committer please merge as well? Thanks.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312936640/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312941204","html_url":"https://github.com/apache/couchdb/issues/549#issuecomment-312941204","issue_url":"https://api.github.com/repos/apache/couchdb/issues/549","id":312941204,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjk0MTIwNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T19:56:13Z","updated_at":"2017-07-04T19:56:13Z","author_association":"MEMBER","body":"This is a really odd failure. My guess is we've hit a race condition where an attempt to open the database is happening prior to the database having been created yet, but I'm not comfortable enough with the `couch_server` code to be sure.\r\n\r\nWe see in the couch.log file that the PUT to create the eunit test database returns with a 201, so presumably the database has been created. But just a few hundred milliseconds, later, we also see:\r\n\r\n```\r\n[error] 2017-05-29T02:02:35.181959Z nonode@nohost <0.5150.1> -------- Could not open file /tmp/tmp.c3FrN4iLsk/apache-couchdb-2.0.0-79067c9/tmp/data/shards/40000000-5fffffff/eunit-test-db-149623354967440.1496023354.couch: no such file or directory\r\n```\r\n\r\n**Question 1**: Is it normal for a PUT to get back a 201 before all the shards have been created on disk?\r\n\r\nDuring the open call, we hit `couch_server:handle_call({open...})` > `couch_server:make_room/2` > `couch_server:maybe_close_lru_db/1`, which is the only place in the code that returns `all_dbs_active`. We must be walking this code path. What's *especially* odd is that, because we get `all_dbs_active` back, we **must** be failing this guard:\r\n\r\n```erlang\r\nmaybe_close_lru_db(#server{dbs_open=NumOpen, max_dbs_open=MaxOpen}=Server)\r\n        when NumOpen < MaxOpen ->\r\n    {ok, Server};\r\n```\r\n\r\n**Question 2**: Why did we fail that guard?\r\n\r\nSo we get past the guard, head into `couch_lru:close/1` which attempts `close_int(gb_trees:next(gb_trees:iterator(Tree)), Cache)`. Inside of `close_int/2` I see:\r\n\r\n```erlang\r\nclose_int(none, _) ->\r\n    false;\r\n```\r\n\r\nIn this particular failure, we can't possibly have >100 dbs open already. I wonder if `gb_trees:iterator(Tree)` is returning an empty list, possibly because nothing is actually open yet, and this bubbles back up as a false?\r\n\r\n**Question 3**: Should we handle the special case of `couch_lru:close/1` being called on an empty LRU to not return `false`?\r\n\r\n-----\r\n\r\nAlso: I noticed\r\n\r\n```erlang\r\ncouch/src/couch_server.erl:-define(MAX_DBS_OPEN, 100).\r\n```\r\n\r\nbut `default.ini` defines `max_dbs_open = 500`. Should we bump the default in `couch_server.erl`? 500 seems like a more reasonable default to me. I'll open a new issue for this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312941204/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312947557","html_url":"https://github.com/apache/couchdb/issues/555#issuecomment-312947557","issue_url":"https://api.github.com/repos/apache/couchdb/issues/555","id":312947557,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjk0NzU1Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T20:17:57Z","updated_at":"2017-07-04T20:17:57Z","author_association":"MEMBER","body":"There's not enough to go on here, and we've only ever seen this issue once.\r\n\r\nReopen if this recurs.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312947557/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312950872","html_url":"https://github.com/apache/couchdb/pull/475#issuecomment-312950872","issue_url":"https://api.github.com/repos/apache/couchdb/issues/475","id":312950872,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjk1MDg3Mg==","user":{"login":"fkaempfer","id":2357885,"node_id":"MDQ6VXNlcjIzNTc4ODU=","avatar_url":"https://avatars.githubusercontent.com/u/2357885?v=4","gravatar_id":"","url":"https://api.github.com/users/fkaempfer","html_url":"https://github.com/fkaempfer","followers_url":"https://api.github.com/users/fkaempfer/followers","following_url":"https://api.github.com/users/fkaempfer/following{/other_user}","gists_url":"https://api.github.com/users/fkaempfer/gists{/gist_id}","starred_url":"https://api.github.com/users/fkaempfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkaempfer/subscriptions","organizations_url":"https://api.github.com/users/fkaempfer/orgs","repos_url":"https://api.github.com/users/fkaempfer/repos","events_url":"https://api.github.com/users/fkaempfer/events{/privacy}","received_events_url":"https://api.github.com/users/fkaempfer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T20:50:10Z","updated_at":"2017-07-04T20:50:10Z","author_association":"CONTRIBUTOR","body":"Thanks for the comments! I have updated the PR according to @rnewson's request.\r\n\r\nIf I understand correctly, this change now limits  _compact to server admins, and disallows it for db admins (contrary to 1.6.1, see the lengthy discussion above). To do this right, something like db_authorization_check_admin could be implemented in chttpd_auth_request.erl. But I don't know if this feature would even be useful - I certainly don't need it and I'm happy with this smaller change going into 2.1.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312950872/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312952960","html_url":"https://github.com/apache/couchdb/issues/629#issuecomment-312952960","issue_url":"https://api.github.com/repos/apache/couchdb/issues/629","id":312952960,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjk1Mjk2MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T21:05:55Z","updated_at":"2017-07-04T21:05:55Z","author_association":"MEMBER","body":"In the first logged failure above, we get an `alarm_handler: {set,{system_memory_high_watermark,[]}}` as soon as the first compaction in the test starts. We never get to compacting the view for the database; the test times out on compacting the database itself.\r\n\r\nFor example, the first db starts compaction at `16:01:39.130870Z` but by `16:01:57.292326Z` we've given up and have moved on to the next test. While we have defined our own internal TIMEOUT to wait as 30s, we're not overriding the EUnit test timeout when running our internal `compact_db` and `compact_view` functions. As proof we're seeing the EUnit `*timed out*` response rather than the raised assertion we define at L208 in `couchdb_file_compression_tests.erl`.\r\n\r\nI'll fix this in a PR.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312952960/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312955101","html_url":"https://github.com/apache/couchdb/pull/475#issuecomment-312955101","issue_url":"https://api.github.com/repos/apache/couchdb/issues/475","id":312955101,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjk1NTEwMQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T21:11:23Z","updated_at":"2017-07-04T21:11:23Z","author_association":"MEMBER","body":"Ah true enough. My change might not be sufficient but it does show you the right path/module. \n\nSent from my iPhone\n\n> On 4 Jul 2017, at 21:50, Frederick Kämpfer <notifications@github.com> wrote:\n> \n> Thanks for the comments! I have updated the PR according to @rnewson's request.\n> \n> If I understand correctly, this change now limits _compact to server admins, and disallows it for db admins (contrary to 1.6.1, see the lengthy discussion above). To do this right, something like db_authorization_check_admin could be implemented in chttpd_auth_request.erl. But I don't know if this feature would even be useful - I certainly don't need it and I'm happy with this smaller change going into 2.1.\n> \n> —\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub, or mute the thread.\n> \n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312955101/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312956441","html_url":"https://github.com/apache/couchdb/issues/549#issuecomment-312956441","issue_url":"https://api.github.com/repos/apache/couchdb/issues/549","id":312956441,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjk1NjQ0MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T21:16:53Z","updated_at":"2017-07-04T21:16:53Z","author_association":"MEMBER","body":"```irc\r\n16:50 <+rnewson> \"Is it normal for a PUT to get back a 201 before all the\r\n                 shards have been created on disk?\"\r\n16:50 <+rnewson> no, fabric_db_create waits for all shard file creation before\r\n                 responding\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312956441/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312958708","html_url":"https://github.com/apache/couchdb/issues/638#issuecomment-312958708","issue_url":"https://api.github.com/repos/apache/couchdb/issues/638","id":312958708,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjk1ODcwOA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T21:41:20Z","updated_at":"2017-07-04T21:41:20Z","author_association":"MEMBER","body":"```\r\n[warning] 2017-06-24T14:42:21.142947Z nonode@nohost <0.6005.1> -------- Compaction daemon - skipping database `eunit-test-db-1498315211680861` compaction: the estimated necessary disk space is about 107084 bytes but the currently available disk space is 0 bytes.\r\n```\r\n\r\nx100 or so. Invalid result. Closing for now. Reopen if this recurs.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312958708/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312959354","html_url":"https://github.com/apache/couchdb/issues/631#issuecomment-312959354","issue_url":"https://api.github.com/repos/apache/couchdb/issues/631","id":312959354,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjk1OTM1NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T21:48:53Z","updated_at":"2017-07-04T21:48:53Z","author_association":"MEMBER","body":"```\r\n[info] 2017-06-06T15:01:57.314634Z nonode@nohost <0.8966.0> -------- alarm_handler: {set,{system_memory_high_watermark,[]}}\r\n[info] 2017-06-06T15:01:57.348491Z nonode@nohost <0.8982.0> -------- Apache CouchDB has started. Time to relax.\r\n\r\n[info] 2017-06-06T15:01:57.348709Z nonode@nohost <0.8982.0> -------- Apache CouchDB has started on http://127.0.0.1:33103/\r\n[info] 2017-06-06T15:01:57.348886Z nonode@nohost <0.7.0> -------- Application couch started on node nonode@nohost\r\n[notice] 2017-06-06T15:01:57.349079Z nonode@nohost <0.8831.0> -------- config: [query_server_config] os_process_limit set to 3 for reason nil\r\n[notice] 2017-06-06T15:01:57.349397Z nonode@nohost <0.8831.0> -------- config: [query_server_config] os_process_soft_limit set to 2 for reason nil\r\n[notice] 2017-06-06T15:01:58.353276Z nonode@nohost <0.8831.0> -------- config: [query_server_config] os_process_limit set to 3 for reason nil\r\n[notice] 2017-06-06T15:01:58.353573Z nonode@nohost <0.8831.0> -------- config: [query_server_config] os_process_soft_limit set to 2 for reason nil\r\n[notice] 2017-06-06T15:01:59.357433Z nonode@nohost <0.8831.0> -------- config: [query_server_config] os_process_limit set to 3 for reason nil\r\n[notice] 2017-06-06T15:01:59.514736Z nonode@nohost <0.8831.0> -------- config: [query_server_config] os_process_soft_limit set to 2 for reason nil\r\n[notice] 2017-06-06T15:02:00.519414Z nonode@nohost <0.8831.0> -------- config: [query_server_config] os_process_limit set to 3 for reason nil\r\n[notice] 2017-06-06T15:02:00.519855Z nonode@nohost <0.8831.0> -------- config: [query_server_config] os_process_soft_limit set to 2 for reason nil\r\n[notice] 2017-06-06T15:02:00.520260Z nonode@nohost <0.8831.0> -------- config: [query_server_config] os_process_idle_limit set to 1 for reason nil\r\n[info] 2017-06-06T15:02:01.527024Z nonode@nohost <0.7.0> -------- Application couch exited with reason: stopped\r\n```\r\n\r\nLooks like we're possibly running out of memory in the Travis instances now, too. :(","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312959354/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312960590","html_url":"https://github.com/apache/couchdb/issues/632#issuecomment-312960590","issue_url":"https://api.github.com/repos/apache/couchdb/issues/632","id":312960590,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjk2MDU5MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-04T22:03:59Z","updated_at":"2017-07-04T22:03:59Z","author_association":"MEMBER","body":"ddoc_cache late eviction means this is a bad test case post-2.0. PR removes it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312960590/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312976750","html_url":"https://github.com/apache/couchdb/issues/631#issuecomment-312976750","issue_url":"https://api.github.com/repos/apache/couchdb/issues/631","id":312976750,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjk3Njc1MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T01:41:24Z","updated_at":"2017-07-05T01:42:23Z","author_association":"MEMBER","body":"In the build for the PR I submitted, we actually still get a failure: https://travis-ci.org/apache/couchdb/jobs/250141409\r\n\r\nThe couch.log still shows very little data, except for that worrying high memory watermark:\r\n\r\n```\r\n[info] 2017-07-04T21:58:23.790382Z nonode@nohost <0.9522.0> -------- alarm_handler: {set,{system_memory_high_watermark,[]}}\r\n[info] 2017-07-04T21:58:24.495814Z nonode@nohost <0.9537.0> -------- Apache CouchDB has started on http://127.0.0.1:39669/\r\n[info] 2017-07-04T21:58:24.496132Z nonode@nohost <0.31.0> -------- Application couch started on node nonode@nohost\r\n[notice] 2017-07-04T21:58:24.496476Z nonode@nohost <0.9385.0> -------- config: [query_server_config] os_process_limit set to 3 for reason nil\r\n[notice] 2017-07-04T21:58:24.497220Z nonode@nohost <0.9385.0> -------- config: [query_server_config] os_process_soft_limit set to 2 for reason nil\r\n[notice] 2017-07-04T21:58:27.501516Z nonode@nohost <0.9385.0> -------- config: [query_server_config] os_process_limit set to 3 for reason nil\r\n[notice] 2017-07-04T21:58:27.502859Z nonode@nohost <0.9385.0> -------- config: [query_server_config] os_process_soft_limit set to 2 for reason nil\r\n[error] 2017-07-04T21:58:29.521926Z nonode@nohost <0.9599.0> -------- OS Process Error <0.9604.0> :: {os_process_error,\"OS process timed out.\"}\r\n[info] 2017-07-04T21:58:29.522011Z nonode@nohost <0.9548.0> -------- couch_proc_manager <0.9604.0> died normal\r\n[info] 2017-07-04T21:58:29.528694Z nonode@nohost <0.9548.0> -------- couch_proc_manager <0.9603.0> died normal\r\n[error] 2017-07-04T21:58:29.528825Z nonode@nohost <0.9598.0> -------- OS Process Error <0.9603.0> :: {os_process_error,\"OS process timed out.\"}\r\n[info] 2017-07-04T21:58:29.540705Z nonode@nohost <0.9548.0> -------- couch_proc_manager <0.9605.0> died normal\r\n[error] 2017-07-04T21:58:29.540817Z nonode@nohost <0.9597.0> -------- OS Process Error <0.9605.0> :: {os_process_error,\"OS process timed out.\"}\r\n[notice] 2017-07-04T21:58:30.507581Z nonode@nohost <0.9385.0> -------- config: [query_server_config] os_process_limit set to 3 for reason nil\r\n[notice] 2017-07-04T21:58:30.508469Z nonode@nohost <0.9385.0> -------- config: [query_server_config] os_process_soft_limit set to 2 for reason nil\r\n[notice] 2017-07-04T21:58:33.512546Z nonode@nohost <0.9385.0> -------- config: [query_server_config] os_process_limit set to 3 for reason nil\r\n[notice] 2017-07-04T21:58:33.512954Z nonode@nohost <0.9385.0> -------- config: [query_server_config] os_process_soft_limit set to 2 for reason nil\r\n[notice] 2017-07-04T21:58:33.513273Z nonode@nohost <0.9385.0> -------- config: [query_server_config] os_process_idle_limit set to 1 for reason nil\r\n[info] 2017-07-04T21:58:36.520899Z nonode@nohost <0.31.0> -------- Application couch exited with reason: stopped\r\n[info] 2017-07-04T21:58:36.524966Z nonode@nohost <0.9522.0> -------- alarm_handler: {clear,system_memory_high_watermark}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312976750/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312976958","html_url":"https://github.com/apache/couchdb/pull/640#issuecomment-312976958","issue_url":"https://api.github.com/repos/apache/couchdb/issues/640","id":312976958,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjk3Njk1OA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T01:43:26Z","updated_at":"2017-07-05T01:43:26Z","author_association":"MEMBER","body":"This isn't sufficient to fix it, look at the failing Travis run. Closing for now.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312976958/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312977354","html_url":"https://github.com/apache/couchdb/pull/475#issuecomment-312977354","issue_url":"https://api.github.com/repos/apache/couchdb/issues/475","id":312977354,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjk3NzM1NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T01:47:10Z","updated_at":"2017-07-05T01:47:10Z","author_association":"MEMBER","body":"@fkaempfer If you're willing to go the extra mile I'd be happy to see the full fix land. We have a couple of weeks before 2.1 freezes anyway, so you have time.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312977354/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312978017","html_url":"https://github.com/apache/couchdb/issues/630#issuecomment-312978017","issue_url":"https://api.github.com/repos/apache/couchdb/issues/630","id":312978017,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMjk3ODAxNw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T01:53:15Z","updated_at":"2017-07-05T01:53:15Z","author_association":"MEMBER","body":"Another instance of this today on master:\r\n* https://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/master/47/pipeline/43\r\n  * https://couchdb-vm2.apache.org/ci_errorlogs/jenkins-couchdb-47-2017-07-04T19:45:06.139489/couchlog.tar.gz\r\n\r\n```\r\n        couch_changes_tests:422: should_select_with_continuous...*failed*\r\nin function couch_changes_tests:'-should_select_with_continuous/1-fun-0-'/1 (test/couch_changes_tests.erl, line 433)\r\nin call from couch_changes_tests:'-should_select_with_continuous/1-fun-3-'/2 (test/couch_changes_tests.erl, line 432)\r\n**error:{assertMatch,[{module,couch_changes_tests},\r\n              {line,433},\r\n              {expression,\"Rows\"},\r\n              {pattern,\"[ # row { seq = 10 , id = << \\\"doc8\\\" >> , deleted = false } ]\"},\r\n              {value,[]}]}\r\n  output:<<\"\">>\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/312978017/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313017161","html_url":"https://github.com/apache/couchdb/issues/593#issuecomment-313017161","issue_url":"https://api.github.com/repos/apache/couchdb/issues/593","id":313017161,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzAxNzE2MQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T06:52:07Z","updated_at":"2017-07-05T06:52:07Z","author_association":"MEMBER","body":"The way forward is definitely \r\n\r\n> Improve the /_cluster_setup endpoint to accept a new \"action\": \"enable_single_node\" that tolerates binding to 127.0.0.1. This would have to be paired with changing the validation function in Fauxton to accept that bind address when in the single node workflow.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313017161/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313017929","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-313017929","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":313017929,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzAxNzkyOQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T06:56:56Z","updated_at":"2017-07-05T06:56:56Z","author_association":"MEMBER","body":"@sebastianrothbucher do you maybe have some time to tackle the JS tests? I know you’ve done tons of this kind of work :)\r\n\r\nOne idea would be to leave the tests as-is as good as possible, and inject the random element in couch.js, but that’s probably only really doable for ad-hoc queries that  don’t reference the doc by name later. But we do have a bunch of those.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313017929/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313044585","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-313044585","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":313044585,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzA0NDU4NQ==","user":{"login":"sebastianrothbucher","id":7339874,"node_id":"MDQ6VXNlcjczMzk4NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/7339874?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianrothbucher","html_url":"https://github.com/sebastianrothbucher","followers_url":"https://api.github.com/users/sebastianrothbucher/followers","following_url":"https://api.github.com/users/sebastianrothbucher/following{/other_user}","gists_url":"https://api.github.com/users/sebastianrothbucher/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianrothbucher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianrothbucher/subscriptions","organizations_url":"https://api.github.com/users/sebastianrothbucher/orgs","repos_url":"https://api.github.com/users/sebastianrothbucher/repos","events_url":"https://api.github.com/users/sebastianrothbucher/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianrothbucher/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T08:58:49Z","updated_at":"2017-07-05T08:58:49Z","author_association":"CONTRIBUTOR","body":"Let me check if I can some time later this week. Just from the top of my head: Would inserting a nonsensical if('randomString1'=='randomString2') {/*do nothing*/} at the end of each map function (i.e. one change in couch.js) do the trick?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313044585/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313134019","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-313134019","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":313134019,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzEzNDAxOQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T15:15:39Z","updated_at":"2017-07-05T15:15:39Z","author_association":"MEMBER","body":"Even a *whitespace* change would be sufficient.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313134019/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313135385","html_url":"https://github.com/apache/couchdb/issues/630#issuecomment-313135385","issue_url":"https://api.github.com/repos/apache/couchdb/issues/630","id":313135385,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzEzNTM4NQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T15:20:06Z","updated_at":"2017-07-05T15:20:06Z","author_association":"MEMBER","body":"And again:\r\n\r\n* https://travis-ci.org/apache/couchdb/jobs/250225893","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313135385/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313144193","html_url":"https://github.com/apache/couchdb/pull/641#issuecomment-313144193","issue_url":"https://api.github.com/repos/apache/couchdb/issues/641","id":313144193,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzE0NDE5Mw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T15:48:54Z","updated_at":"2017-07-05T15:48:54Z","author_association":"CONTRIBUTOR","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313144193/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313144229","html_url":"https://github.com/apache/couchdb/pull/628#issuecomment-313144229","issue_url":"https://api.github.com/repos/apache/couchdb/issues/628","id":313144229,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzE0NDIyOQ==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T15:49:01Z","updated_at":"2017-07-05T15:49:01Z","author_association":"CONTRIBUTOR","body":"stable and update are replacing stale right? will the same options work for text indexes?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313144229/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313144646","html_url":"https://github.com/apache/couchdb/pull/639#issuecomment-313144646","issue_url":"https://api.github.com/repos/apache/couchdb/issues/639","id":313144646,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzE0NDY0Ng==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T15:50:32Z","updated_at":"2017-07-05T15:50:32Z","author_association":"CONTRIBUTOR","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313144646/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313144919","html_url":"https://github.com/apache/couchdb/pull/637#issuecomment-313144919","issue_url":"https://api.github.com/repos/apache/couchdb/issues/637","id":313144919,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzE0NDkxOQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T15:51:28Z","updated_at":"2017-07-05T15:51:28Z","author_association":"CONTRIBUTOR","body":"Very nice!\r\n\r\n+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313144919/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313159484","html_url":"https://github.com/apache/couchdb/pull/628#issuecomment-313159484","issue_url":"https://api.github.com/repos/apache/couchdb/issues/628","id":313159484,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzE1OTQ4NA==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T16:43:39Z","updated_at":"2017-07-05T16:43:39Z","author_association":"MEMBER","body":"Yes, those are replacing stale. I'm not sure about text indexes. I don't think so\n\nAll misspelling thanks to my iPhone.\n________________________________\nFrom: Tony Sun <notifications@github.com>\nSent: Wednesday, July 5, 2017 5:49:02 PM\nTo: apache/couchdb\nCc: garren smith; Author\nSubject: Re: [apache/couchdb] Add stable and update support to Mango (#628)\n\n\nstable and update are replacing stale right? will the same options work for text indexes?\n\n—\nYou are receiving this because you authored the thread.\nReply to this email directly, view it on GitHub<https://github.com/apache/couchdb/pull/628#issuecomment-313144229>, or mute the thread<https://github.com/notifications/unsubscribe-auth/AAK9AnyBpRhKKGBhdWyDXRBzDwV6mlWTks5sK7BugaJpZM4OMGtD>.\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313159484/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313163981","html_url":"https://github.com/apache/couchdb/pull/627#issuecomment-313163981","issue_url":"https://api.github.com/repos/apache/couchdb/issues/627","id":313163981,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzE2Mzk4MQ==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T17:00:03Z","updated_at":"2017-07-05T17:00:03Z","author_association":"MEMBER","body":"This turned out to be more complicated, two-fold issue:\r\n\r\n1) `fabric:query_view/6` always expects `Acc` to be `#vacc` record and we are passing `#cursor` from mango there, so when an index presented it is indeed crashing with `badrecord`. Different issue than what's fixed here.\r\n\r\n2) We don't pass user context to db from `fabric_view_map` at all, so `including_docs` not working on `_users` db even without mango, on honest views:\r\n\r\n```\r\n$ echo '{\"name\": \"demo\", \"password\": \"apple\", \"roles\": [], \"type\": \"user\"}' | http put :15984/_users/org.couchdb.user:demo\r\n{\r\n    \"id\": \"org.couchdb.user:demo\",\r\n    \"ok\": true,\r\n    \"rev\": \"1-16edca99a7b08fc65cdc963f40c9fa9d\"\r\n}\r\n\r\n\r\n$ echo '{\"views\": {\"names\": {\"map\": \"function(doc) { emit(doc.name); }\"}}}' | http put :15984/_users/_design/users \r\n{\r\n    \"id\": \"_design/users\",\r\n    \"ok\": true,\r\n    \"rev\": \"1-fb4b161306a6da60301f313cc827704c\"\r\n}\r\n\r\n$ http :15984/_users/_design/users/_view/names include_docs==true\r\n{\r\n    \"offset\": 0,\r\n    \"rows\": [\r\n        {\r\n            \"doc\": null,\r\n            \"id\": \"org.couchdb.user:demo\",\r\n            \"key\": \"demo\",\r\n            \"value\": null\r\n        }\r\n    ],\r\n    \"total_rows\": 1\r\n}\r\n```\r\n\r\nThat \"doc\" shouldn't be `null`. \r\n\r\nSo I'm going to fix that in separate PR, amend this one to work for mango indexes and make it depended on the former.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313163981/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313176291","html_url":"https://github.com/apache/couchdb/issues/643#issuecomment-313176291","issue_url":"https://api.github.com/repos/apache/couchdb/issues/643","id":313176291,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzE3NjI5MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T17:46:44Z","updated_at":"2017-07-05T17:46:44Z","author_association":"MEMBER","body":"Another instance:\r\n* https://travis-ci.org/apache/couchdb/jobs/250437020","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313176291/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313183466","html_url":"https://github.com/apache/couchdb/issues/630#issuecomment-313183466","issue_url":"https://api.github.com/repos/apache/couchdb/issues/630","id":313183466,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzE4MzQ2Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T18:14:10Z","updated_at":"2017-07-05T18:14:10Z","author_association":"MEMBER","body":"And again:\r\n* https://travis-ci.org/apache/couchdb/jobs/250437167","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313183466/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313192665","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-313192665","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":313192665,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzE5MjY2NQ==","user":{"login":"sebastianrothbucher","id":7339874,"node_id":"MDQ6VXNlcjczMzk4NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/7339874?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianrothbucher","html_url":"https://github.com/sebastianrothbucher","followers_url":"https://api.github.com/users/sebastianrothbucher/followers","following_url":"https://api.github.com/users/sebastianrothbucher/following{/other_user}","gists_url":"https://api.github.com/users/sebastianrothbucher/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianrothbucher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianrothbucher/subscriptions","organizations_url":"https://api.github.com/users/sebastianrothbucher/orgs","repos_url":"https://api.github.com/users/sebastianrothbucher/repos","events_url":"https://api.github.com/users/sebastianrothbucher/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianrothbucher/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T18:49:00Z","updated_at":"2017-07-05T18:49:00Z","author_association":"CONTRIBUTOR","body":"or append a randomized comment when uploading the map fkt","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313192665/reactions","total_count":2,"+1":1,"-1":0,"laugh":1,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313199914","html_url":"https://github.com/apache/couchdb/issues/630#issuecomment-313199914","issue_url":"https://api.github.com/repos/apache/couchdb/issues/630","id":313199914,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzE5OTkxNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T19:17:39Z","updated_at":"2017-07-05T19:24:55Z","author_association":"MEMBER","body":"@eiri spied on IRC that these failures both point to heartbeats showing up in the _changes feed, possibly unexpected ones. Good eye! \r\n\r\nTest case needing to be partially rewritten, perhaps?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313199914/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313203328","html_url":"https://github.com/apache/couchdb/pull/627#issuecomment-313203328","issue_url":"https://api.github.com/repos/apache/couchdb/issues/627","id":313203328,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzIwMzMyOA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T19:31:29Z","updated_at":"2017-07-05T19:31:29Z","author_association":"MEMBER","body":"Depends on apache/couchdb#645","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313203328/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313215096","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-313215096","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":313215096,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzIxNTA5Ng==","user":{"login":"sebastianrothbucher","id":7339874,"node_id":"MDQ6VXNlcjczMzk4NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/7339874?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianrothbucher","html_url":"https://github.com/sebastianrothbucher","followers_url":"https://api.github.com/users/sebastianrothbucher/followers","following_url":"https://api.github.com/users/sebastianrothbucher/following{/other_user}","gists_url":"https://api.github.com/users/sebastianrothbucher/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianrothbucher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianrothbucher/subscriptions","organizations_url":"https://api.github.com/users/sebastianrothbucher/orgs","repos_url":"https://api.github.com/users/sebastianrothbucher/repos","events_url":"https://api.github.com/users/sebastianrothbucher/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianrothbucher/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T20:19:14Z","updated_at":"2017-07-05T20:19:14Z","author_association":"CONTRIBUTOR","body":"I did a PR for just that. Sadly I can't reproduce (on a CentOS VM), but tests still work - maybe Travis gives us more stable test runs now","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313215096/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313215537","html_url":"https://github.com/apache/couchdb/pull/646#issuecomment-313215537","issue_url":"https://api.github.com/repos/apache/couchdb/issues/646","id":313215537,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzIxNTUzNw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T20:20:57Z","updated_at":"2017-07-05T20:20:57Z","author_association":"MEMBER","body":"Once Travis passes in about 20 minutes, a big +1. Thanks for this!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313215537/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313223339","html_url":"https://github.com/apache/couchdb/pull/646#issuecomment-313223339","issue_url":"https://api.github.com/repos/apache/couchdb/issues/646","id":313223339,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzIyMzMzOQ==","user":{"login":"sebastianrothbucher","id":7339874,"node_id":"MDQ6VXNlcjczMzk4NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/7339874?v=4","gravatar_id":"","url":"https://api.github.com/users/sebastianrothbucher","html_url":"https://github.com/sebastianrothbucher","followers_url":"https://api.github.com/users/sebastianrothbucher/followers","following_url":"https://api.github.com/users/sebastianrothbucher/following{/other_user}","gists_url":"https://api.github.com/users/sebastianrothbucher/gists{/gist_id}","starred_url":"https://api.github.com/users/sebastianrothbucher/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sebastianrothbucher/subscriptions","organizations_url":"https://api.github.com/users/sebastianrothbucher/orgs","repos_url":"https://api.github.com/users/sebastianrothbucher/repos","events_url":"https://api.github.com/users/sebastianrothbucher/events{/privacy}","received_events_url":"https://api.github.com/users/sebastianrothbucher/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T20:52:09Z","updated_at":"2017-07-05T20:52:09Z","author_association":"CONTRIBUTOR","body":"great!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313223339/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313223484","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-313223484","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":313223484,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzIyMzQ4NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T20:52:48Z","updated_at":"2017-07-05T20:52:48Z","author_association":"MEMBER","body":"@kocolosk @eiri What do you want to do about the actual race condition? Do you think the race itself should be a 2.1 release blocker?\r\n\r\nFeel free to keep this issue for it, or open a new one.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313223484/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313226682","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-313226682","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":313226682,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzIyNjY4Mg==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T21:05:08Z","updated_at":"2017-07-05T21:05:08Z","author_association":"MEMBER","body":"It's rather hard to fix it for real with a solid chance of accidentally adding deadlock or bottleneck and at the same time it is induced by usage anti-pattern, so I don't see it as a blocker.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313226682/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313228301","html_url":"https://github.com/apache/couchdb/pull/646#issuecomment-313228301","issue_url":"https://api.github.com/repos/apache/couchdb/issues/646","id":313228301,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzIyODMwMQ==","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T21:11:58Z","updated_at":"2017-07-05T21:11:58Z","author_association":"MEMBER","body":"Yes, thanks. This is exactly the sort of thing I had in mind for #548 ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313228301/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313228860","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-313228860","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":313228860,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzIyODg2MA==","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T21:14:23Z","updated_at":"2017-07-05T21:14:23Z","author_association":"MEMBER","body":"Not a blocker. We should write a solid reproducible test case for it (should be easy enough in EUnit right?) and address it, but agree it's difficult.\r\n\r\nI think it is possible to observe this bug in normal operations, especially if a user is following the best practice around ddoc upgrades. Deleting the temporary ddoc after migrating the main one could easily kill any in-progress view responses.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313228860/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313229321","html_url":"https://github.com/apache/couchdb/pull/615#issuecomment-313229321","issue_url":"https://api.github.com/repos/apache/couchdb/issues/615","id":313229321,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzIyOTMyMQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T21:16:09Z","updated_at":"2017-07-05T21:16:09Z","author_association":"CONTRIBUTOR","body":"I am glad I opened the PR for discussion prior to any significant work","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313229321/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313230957","html_url":"https://github.com/apache/couchdb/issues/548#issuecomment-313230957","issue_url":"https://api.github.com/repos/apache/couchdb/issues/548","id":313230957,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzIzMDk1Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T21:23:30Z","updated_at":"2017-07-05T21:23:30Z","author_association":"MEMBER","body":"OK, see #647 for the continuation to this bug. I am closing this one out for now, unless we see repeats of this pop up in test runs.\r\n\r\nThanks everyone! 💃 🐄 🎆 ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313230957/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313237324","html_url":"https://github.com/apache/couchdb/pull/645#issuecomment-313237324","issue_url":"https://api.github.com/repos/apache/couchdb/issues/645","id":313237324,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzIzNzMyNA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T21:52:23Z","updated_at":"2017-07-06T02:37:40Z","author_association":"MEMBER","body":"End-points `_list` and `_show` are not working on `_users` as well. `_show` because of the missing user context and `_list` because it is using not `#vacc` record as an acc for `query_view` and crashing on request. So this fix needs a bit different approach, changing PR on WIP for now.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313237324/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313237534","html_url":"https://github.com/apache/couchdb/issues/620#issuecomment-313237534","issue_url":"https://api.github.com/repos/apache/couchdb/issues/620","id":313237534,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzIzNzUzNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T21:53:24Z","updated_at":"2017-07-05T21:53:24Z","author_association":"MEMBER","body":"I'm closing this one as \"works as designed\" assuming that apache/couchdb-documentation#139 will hit in the next day or two.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313237534/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313255711","html_url":"https://github.com/apache/couchdb/pull/648#issuecomment-313255711","issue_url":"https://api.github.com/repos/apache/couchdb/issues/648","id":313255711,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzI1NTcxMQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-05T23:40:08Z","updated_at":"2017-07-05T23:40:08Z","author_association":"CONTRIBUTOR","body":"This is a fixup for https://github.com/apache/couchdb/commit/571a2fc0b7445df0f6ad4626f6172bfe6c8c9a7c","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313255711/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313266084","html_url":"https://github.com/apache/couchdb/pull/648#issuecomment-313266084","issue_url":"https://api.github.com/repos/apache/couchdb/issues/648","id":313266084,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzI2NjA4NA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-06T00:56:35Z","updated_at":"2017-07-06T00:56:35Z","author_association":"MEMBER","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313266084/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313278182","html_url":"https://github.com/apache/couchdb/issues/508#issuecomment-313278182","issue_url":"https://api.github.com/repos/apache/couchdb/issues/508","id":313278182,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzI3ODE4Mg==","user":{"login":"dracuslayer","id":28158254,"node_id":"MDQ6VXNlcjI4MTU4MjU0","avatar_url":"https://avatars.githubusercontent.com/u/28158254?v=4","gravatar_id":"","url":"https://api.github.com/users/dracuslayer","html_url":"https://github.com/dracuslayer","followers_url":"https://api.github.com/users/dracuslayer/followers","following_url":"https://api.github.com/users/dracuslayer/following{/other_user}","gists_url":"https://api.github.com/users/dracuslayer/gists{/gist_id}","starred_url":"https://api.github.com/users/dracuslayer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dracuslayer/subscriptions","organizations_url":"https://api.github.com/users/dracuslayer/orgs","repos_url":"https://api.github.com/users/dracuslayer/repos","events_url":"https://api.github.com/users/dracuslayer/events{/privacy}","received_events_url":"https://api.github.com/users/dracuslayer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-06T02:28:47Z","updated_at":"2017-07-06T02:28:47Z","author_association":"NONE","body":"for those that have windows 10 creators edition just follow this after install and couchdb will work for you https://stackoverflow.com/questions/44107334/couchdb-fails-to-start-after-applying-windows-10-creators-update","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313278182/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313316848","html_url":"https://github.com/apache/couchdb/pull/475#issuecomment-313316848","issue_url":"https://api.github.com/repos/apache/couchdb/issues/475","id":313316848,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzMxNjg0OA==","user":{"login":"fkaempfer","id":2357885,"node_id":"MDQ6VXNlcjIzNTc4ODU=","avatar_url":"https://avatars.githubusercontent.com/u/2357885?v=4","gravatar_id":"","url":"https://api.github.com/users/fkaempfer","html_url":"https://github.com/fkaempfer","followers_url":"https://api.github.com/users/fkaempfer/followers","following_url":"https://api.github.com/users/fkaempfer/following{/other_user}","gists_url":"https://api.github.com/users/fkaempfer/gists{/gist_id}","starred_url":"https://api.github.com/users/fkaempfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkaempfer/subscriptions","organizations_url":"https://api.github.com/users/fkaempfer/orgs","repos_url":"https://api.github.com/users/fkaempfer/repos","events_url":"https://api.github.com/users/fkaempfer/events{/privacy}","received_events_url":"https://api.github.com/users/fkaempfer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-06T07:20:14Z","updated_at":"2017-07-06T07:20:14Z","author_association":"CONTRIBUTOR","body":"@wohali okay I'll give it a shot in the next days.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313316848/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313344194","html_url":"https://github.com/apache/couchdb/pull/597#issuecomment-313344194","issue_url":"https://api.github.com/repos/apache/couchdb/issues/597","id":313344194,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzM0NDE5NA==","user":{"login":"jiangphcn","id":18000622,"node_id":"MDQ6VXNlcjE4MDAwNjIy","avatar_url":"https://avatars.githubusercontent.com/u/18000622?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangphcn","html_url":"https://github.com/jiangphcn","followers_url":"https://api.github.com/users/jiangphcn/followers","following_url":"https://api.github.com/users/jiangphcn/following{/other_user}","gists_url":"https://api.github.com/users/jiangphcn/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangphcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangphcn/subscriptions","organizations_url":"https://api.github.com/users/jiangphcn/orgs","repos_url":"https://api.github.com/users/jiangphcn/repos","events_url":"https://api.github.com/users/jiangphcn/events{/privacy}","received_events_url":"https://api.github.com/users/jiangphcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-06T09:23:41Z","updated_at":"2017-07-06T09:23:41Z","author_association":"CONTRIBUTOR","body":"@eiri Thanks again for your comments. I have addressed them except for item3 \"run some kind of perf test\". For item2 \"the final path for the recovery indexes\", you can see some test result below.\r\n`make check apps=couch tests=deleted_filename_test_`. Would you please take a further look?\r\n\r\n```\r\n======================== EUnit ========================\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/dbname.couch)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/.dbname_design/mrview/3133e28517e89a3e11435dd5ac4ad85a.view)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/shards/00000000-1fffffff/dbname.1458336317.couch)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/.shards/00000000-1fffffff/dbname.1458336317_design)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/.shards/00000000-1fffffff/dbname.1458336317_design/mrview/3133e28517e89a3e11435dd5ac4ad85a.view)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/.recovery/shards/00000000-1fffffff/dbname.1499329402_design)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/.recovery/shards/00000000-1fffffff/dbname.1499329402_design/mrview/8fabddcb28f501d6764afd7def3bd352.view)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/db.name.couch)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/.db.name_design/mrview/3133e28517e89a3e11435dd5ac4ad85a.view)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/shards/00000000-1fffffff/db.name.1458336317.couch)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/.shards/00000000-1fffffff/db.name.1458336317_design)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/.shards/00000000-1fffffff/db.name.1458336317_design/mrview/3133e28517e89a3e11435dd5ac4ad85a.view)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/.recovery/shards/00000000-1fffffff/db.name.1499329402_design)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/.recovery/shards/00000000-1fffffff/db.name.1499329402_design/mrview/8fabddcb28f501d6764afd7def3bd352.view)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/user/dbname.couch)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/.user/dbname_design/mrview/3133e28517e89a3e11435dd5ac4ad85a.view)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/shards/00000000-1fffffff/user/dbname.1458336317.couch)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/.shards/00000000-1fffffff/user/dbname.1458336317_design)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/.shards/00000000-1fffffff/user/dbname.1458336317_design/mrview/3133e28517e89a3e11435dd5ac4ad85a.view)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/.recovery/shards/00000000-1fffffff/user/dbname.1499329402_design)...ok\r\ncouch_file:758: should_create_proper_deleted_filename (/srv/data/.recovery/shards/00000000-1fffffff/user/dbname.1499329402_design/mrview/8fabddcb28f501d6764afd7def3bd352.view)...ok\r\n=======================================================\r\n  All 21 tests passed.\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313344194/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313376311","html_url":"https://github.com/apache/couchdb/issues/649#issuecomment-313376311","issue_url":"https://api.github.com/repos/apache/couchdb/issues/649","id":313376311,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzM3NjMxMQ==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-06T12:01:18Z","updated_at":"2017-07-06T12:01:18Z","author_association":"MEMBER","body":"No, this is different, just looks the same, because it's happening during getting view state and the cause is also race condition.\r\n\r\nIn previous case we've been crashing on old index_server exit or be gone already, so exceptions been `normal` (for exit reason) or `noproc`.\r\n\r\nHere exception is `unknown_info` and it is actually couch_index_updater server crashing (and bringing index server with it, because [this clause](https://github.com/apache/couchdb/blob/master/src/couch_index/src/couch_index_updater.erl#L92)  doesn't match. It seems that the updater spawned two updating workers due to restart on compaction, then kept pid of the second, but got [exit message](https://github.com/apache/couchdb/blob/master/src/couch_index/src/couch_index_updater.erl#L196) from the first one. This is interesting, I'd expect this swap to be sequential, so I wonder if we have a bug in [couch_util:shutdown_sync/1](https://github.com/apache/couchdb/blob/master/src/couch_index/src/couch_index_updater.erl#L77) and it is not that \"sync\".\r\n\r\nOn the other hand, why do we have a compaction happening during a test? I thought that new compaction daemon supposed to be turned off for eunits?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313376311/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313493656","html_url":"https://github.com/apache/couchdb/pull/610#issuecomment-313493656","issue_url":"https://api.github.com/repos/apache/couchdb/issues/610","id":313493656,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzQ5MzY1Ng==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-06T19:21:03Z","updated_at":"2017-07-06T19:21:03Z","author_association":"MEMBER","body":"@chewbranca I managed to figure out a decent way to avoid the unnecessary second fabric calls in the two cases you were worried about. Now the first client that opens an entry will kick off a process that will insert the corresponding cache entry if no entry existed before. I.e., if we call ddoc_cache:open(DbName, DDocId) and there's no entry for it, we'll take the result and insert it for the revid specific version as well (assuming there's not already an existing entry). And vice versa when opening a revid specific version.\r\n\r\nhttps://github.com/apache/couchdb/pull/610/commits/85b53855255be0a4166bbb14697c010ff4468d20\r\n\r\nAlso, for your comment on the revid specific entries I spent some time trying to figure out a decent way to be clever using latest=true or something but in the end I went entirely different. Now if a cache entry is not accessed within its refresh period it will voluntarily drop out of the cache. So this will apply for all entries which I think is good to help when someone wants to scan a bunch of views periodically. We'll end up dropping all of the unused entries which could help with memory pressure if someone has big design documents without much activity on more than a few.\r\n\r\nhttps://github.com/apache/couchdb/pull/610/commits/32cd254d7e7c678a10a9302e48e9c6f064701701\r\n\r\nFor the configurability, I added a refresh timeout config option and documented it in the default.ini as per usual. I also added notes for max_size as well.\r\n\r\nhttps://github.com/apache/couchdb/pull/610/commits/9151fb59a8f8553a95af23fa58ef67a76f069b80\r\n\r\nAnd thanks for the good eye on clearing the waiters list.\r\n\r\nhttps://github.com/apache/couchdb/pull/610/commits/7c376bd6efc372cd7f107989fd14e40e8ab7a7e6\r\n\r\nThe only other thing you really noted was the comment update but I think that was just due to a misunderstanding so I'm assuming you're good my comment there.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313493656/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313567680","html_url":"https://github.com/apache/couchdb/issues/508#issuecomment-313567680","issue_url":"https://api.github.com/repos/apache/couchdb/issues/508","id":313567680,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzU2NzY4MA==","user":{"login":"nueko","id":2134953,"node_id":"MDEyOk9yZ2FuaXphdGlvbjIxMzQ5NTM=","avatar_url":"https://avatars.githubusercontent.com/u/2134953?v=4","gravatar_id":"","url":"https://api.github.com/users/nueko","html_url":"https://github.com/nueko","followers_url":"https://api.github.com/users/nueko/followers","following_url":"https://api.github.com/users/nueko/following{/other_user}","gists_url":"https://api.github.com/users/nueko/gists{/gist_id}","starred_url":"https://api.github.com/users/nueko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nueko/subscriptions","organizations_url":"https://api.github.com/users/nueko/orgs","repos_url":"https://api.github.com/users/nueko/repos","events_url":"https://api.github.com/users/nueko/events{/privacy}","received_events_url":"https://api.github.com/users/nueko/received_events","type":"Organization","user_view_type":"public","site_admin":false},"created_at":"2017-07-07T02:06:02Z","updated_at":"2017-07-07T02:06:02Z","author_association":"NONE","body":"🍭 Great","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313567680/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313570554","html_url":"https://github.com/apache/couchdb/issues/508#issuecomment-313570554","issue_url":"https://api.github.com/repos/apache/couchdb/issues/508","id":313570554,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzU3MDU1NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-07T02:28:34Z","updated_at":"2017-07-07T02:28:34Z","author_association":"MEMBER","body":"This is the same fix that was stated earlier in this thread.\r\n\r\nLocking down comments on this for now. We know what the problem is. 2.1 will be released shortly with this fix included.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313570554/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313570665","html_url":"https://github.com/apache/couchdb/issues/630#issuecomment-313570665","issue_url":"https://api.github.com/repos/apache/couchdb/issues/630","id":313570665,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzU3MDY2NQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-07T02:29:28Z","updated_at":"2017-07-07T02:29:28Z","author_association":"MEMBER","body":"@nickva do you think your checkin will resolve this?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313570665/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313571440","html_url":"https://github.com/apache/couchdb/issues/630#issuecomment-313571440","issue_url":"https://api.github.com/repos/apache/couchdb/issues/630","id":313571440,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzU3MTQ0MA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-07T02:35:34Z","updated_at":"2017-07-07T02:35:34Z","author_association":"CONTRIBUTOR","body":"@wohali yeah I think it should resolve it. Let's close it and then we can re-open it if we see it up pop up again.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313571440/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313614461","html_url":"https://github.com/apache/couchdb/issues/652#issuecomment-313614461","issue_url":"https://api.github.com/repos/apache/couchdb/issues/652","id":313614461,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzYxNDQ2MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-07T07:57:53Z","updated_at":"2017-07-07T07:57:53Z","author_association":"MEMBER","body":"@janl mind taking a look at this one?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313614461/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313671108","html_url":"https://github.com/apache/couchdb/issues/652#issuecomment-313671108","issue_url":"https://api.github.com/repos/apache/couchdb/issues/652","id":313671108,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzY3MTEwOA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-07T12:44:37Z","updated_at":"2017-07-07T12:44:37Z","author_association":"MEMBER","body":"> because some eunit tests actually need the compaction daemon, and that change completely removes its definition. Grumble.\r\n\r\nWhich ones?\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313671108/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313727920","html_url":"https://github.com/apache/couchdb/issues/652#issuecomment-313727920","issue_url":"https://api.github.com/repos/apache/couchdb/issues/652","id":313727920,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzcyNzkyMA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-07T16:21:12Z","updated_at":"2017-07-07T16:21:12Z","author_association":"MEMBER","body":"`src/couch/test/couchdb_compaction_daemon_tests.erl`\r\n\r\nI guess we could have this do the config dance to re-establish the correct value for `[daemons] compaction_daemon` and do the same thing I did in `dev/run` here: https://github.com/apache/couchdb/pull/651/files#diff-d86563699bde00df2cce2613ecbed531R193","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313727920/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313752478","html_url":"https://github.com/apache/couchdb/pull/645#issuecomment-313752478","issue_url":"https://api.github.com/repos/apache/couchdb/issues/645","id":313752478,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzc1MjQ3OA==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-07T18:02:37Z","updated_at":"2017-07-07T18:02:37Z","author_association":"CONTRIBUTOR","body":"Tested _show and that lead to 500 \r\n```\r\n[error] 2017-07-07T17:59:08.236067Z node1@127.0.0.1 <0.7836.0> 354b71b309 req_err(1517023101) case_clause : {forbidden,<<\"Only administrators can view design docs in the users database.\">>}\r\n    [<<\"chttpd_show:maybe_open_doc/2 L26\">>,<<\"chttpd_show:handle_doc_show_req/3 L52\">>,<<\"chttpd:process_request/1 L295\">>,<<\"chttpd:handle_request_int/1 L231\">>,<<\"mochiweb_http:headers/6 L122\">>,<<\"proc_lib:init_p_do_apply/3 L237\">>]\r\n```\r\nThis is a different bug though.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313752478/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313752494","html_url":"https://github.com/apache/couchdb/pull/645#issuecomment-313752494","issue_url":"https://api.github.com/repos/apache/couchdb/issues/645","id":313752494,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzc1MjQ5NA==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-07T18:02:40Z","updated_at":"2017-07-07T18:02:40Z","author_association":"CONTRIBUTOR","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313752494/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313755237","html_url":"https://github.com/apache/couchdb/issues/653#issuecomment-313755237","issue_url":"https://api.github.com/repos/apache/couchdb/issues/653","id":313755237,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzc1NTIzNw==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-07T18:13:44Z","updated_at":"2017-07-07T18:13:44Z","author_association":"MEMBER","body":"Reference issue apache/couchdb#645","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313755237/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313776529","html_url":"https://github.com/apache/couchdb/issues/652#issuecomment-313776529","issue_url":"https://api.github.com/repos/apache/couchdb/issues/652","id":313776529,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzc3NjUyOQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-07T19:49:32Z","updated_at":"2017-07-07T19:49:32Z","author_association":"MEMBER","body":"I had patched that though: https://github.com/apache/couchdb/pull/624/files","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313776529/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313790860","html_url":"https://github.com/apache/couchdb/issues/652#issuecomment-313790860","issue_url":"https://api.github.com/repos/apache/couchdb/issues/652","id":313790860,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzc5MDg2MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-07T20:56:11Z","updated_at":"2017-07-07T20:56:11Z","author_association":"MEMBER","body":"That as may be, empirically I'm seeing the compaction daemon running during other eunit tests. More investigation is required.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313790860/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313802174","html_url":"https://github.com/apache/couchdb/pull/526#issuecomment-313802174","issue_url":"https://api.github.com/repos/apache/couchdb/issues/526","id":313802174,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzgwMjE3NA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-07T21:54:06Z","updated_at":"2017-07-07T21:54:06Z","author_association":"MEMBER","body":"@davisp So I went ahead, reverted the new module and modified `fabric_view_all_docs.erl` instead. Does it looks better to you?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313802174/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313814388","html_url":"https://github.com/apache/couchdb/issues/652#issuecomment-313814388","issue_url":"https://api.github.com/repos/apache/couchdb/issues/652","id":313814388,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzgxNDM4OA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-07T23:18:19Z","updated_at":"2017-07-07T23:18:19Z","author_association":"MEMBER","body":"So @janl I think your change only disables the daemon going into the compaction daemon tests. I think the daemon is still running for all the other tests.\r\n\r\nI have a change to `test_util:start_couch` that I am testing in a soak loop now. If there are no failures I'll submit a PR.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313814388/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313819812","html_url":"https://github.com/apache/couchdb/issues/649#issuecomment-313819812","issue_url":"https://api.github.com/repos/apache/couchdb/issues/649","id":313819812,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzgxOTgxMg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-08T00:09:23Z","updated_at":"2017-07-08T00:10:08Z","author_association":"MEMBER","body":"I think this is because of #652 in the eunit test - but do we want to keep this issue to track fixing the race condition? Keep in mind that once the PR is merged, we won't easily reproduce this bug anymore.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313819812/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313819946","html_url":"https://github.com/apache/couchdb/issues/652#issuecomment-313819946","issue_url":"https://api.github.com/repos/apache/couchdb/issues/652","id":313819946,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzgxOTk0Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-08T00:11:00Z","updated_at":"2017-07-08T00:11:00Z","author_association":"MEMBER","body":"Note that I could see the flipside of this ticket - that we should leave it enabled and deal with the tests that are failing instead like https://github.com/apache/couchdb/issues/649 and couchdb_views_tests:couchdb_1283. Let me know.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313819946/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313820358","html_url":"https://github.com/apache/couchdb/issues/643#issuecomment-313820358","issue_url":"https://api.github.com/repos/apache/couchdb/issues/643","id":313820358,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzgyMDM1OA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-08T00:16:18Z","updated_at":"2017-07-08T00:16:18Z","author_association":"MEMBER","body":"I believe these are being caused by #652.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313820358/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313821982","html_url":"https://github.com/apache/couchdb/issues/571#issuecomment-313821982","issue_url":"https://api.github.com/repos/apache/couchdb/issues/571","id":313821982,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzgyMTk4Mg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-08T00:36:55Z","updated_at":"2017-07-08T00:36:55Z","author_association":"MEMBER","body":"Haven't seen this again in a bit. Closing for now...","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313821982/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313824985","html_url":"https://github.com/apache/couchdb/issues/554#issuecomment-313824985","issue_url":"https://api.github.com/repos/apache/couchdb/issues/554","id":313824985,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzgyNDk4NQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-08T01:25:41Z","updated_at":"2017-07-08T01:25:41Z","author_association":"MEMBER","body":"I have fully disabled this test for now. I'm starting to think that the dynamic behaviour of the clustered setup means these stats don't make as much sense anymore -- and that the test needs a complete rework.\r\n\r\nWe can revisit after 2.1.0.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313824985/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313831089","html_url":"https://github.com/apache/couchdb/issues/655#issuecomment-313831089","issue_url":"https://api.github.com/repos/apache/couchdb/issues/655","id":313831089,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzgzMTA4OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-08T03:45:14Z","updated_at":"2017-07-08T03:45:30Z","author_association":"MEMBER","body":"FYI, a reminder that [COUCHDB-1283](https://issues.apache.org/jira/browse/COUCHDB-1283) is: \"Impossible to compact view groups when number of active databases > max_dbs_open\". Is a fix for this issue still valid for 2.0, @rnewson ?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313831089/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313837528","html_url":"https://github.com/apache/couchdb/issues/643#issuecomment-313837528","issue_url":"https://api.github.com/repos/apache/couchdb/issues/643","id":313837528,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzgzNzUyOA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-08T06:20:29Z","updated_at":"2017-07-08T06:20:29Z","author_association":"MEMBER","body":"Closing because PR#654 landed. Will reopen if it recurs.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313837528/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313837535","html_url":"https://github.com/apache/couchdb/issues/649#issuecomment-313837535","issue_url":"https://api.github.com/repos/apache/couchdb/issues/649","id":313837535,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzgzNzUzNQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-08T06:20:34Z","updated_at":"2017-07-08T06:20:34Z","author_association":"MEMBER","body":"Closing because PR#654 landed. Will reopen if it recurs.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313837535/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313837711","html_url":"https://github.com/apache/couchdb/pull/610#issuecomment-313837711","issue_url":"https://api.github.com/repos/apache/couchdb/issues/610","id":313837711,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzgzNzcxMQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-08T06:24:43Z","updated_at":"2017-07-08T06:26:32Z","author_association":"CONTRIBUTOR","body":"I ran the `ddoc_cache_speed` benchmark with the following diff:\r\n\r\n```\r\n spawn_workers(WorkerCount) ->\r\n     Self = self(),\r\n-    WorkerDb = list_to_binary(integer_to_list(WorkerCount)),\r\n-    spawn(fun() ->\r\n+    WorkerId = WorkerCount, % rem ?RANGE,\r\n+    WorkerDb = integer_to_binary(WorkerId),\r\n+    spawn_link(fun() ->\r\n         do_work(Self, WorkerDb, 0)\r\n     end),\r\n     spawn_workers(WorkerCount - 1).\r\n \r\n \r\n-do_work(Parent, WorkerDb, Count) when Count >= 25 ->\r\n+do_work(Parent, WorkerDb, Count) when Count >= 1000 ->\r\n     Parent ! {done, Count},\r\n     do_work(Parent, WorkerDb, 0);\r\n \r\n     case timer:now_diff(Now, Start) of\r\n         N when N > 1000000 ->\r\n             {_, MQL} = process_info(whereis(ddoc_cache_lru), message_queue_len),\r\n-            io:format(\"~p ~p~n\", [Count, MQL]),\r\n+            CacheSize = ets:info(ddoc_cache_lru, size),\r\n+            io:format(\"~p ~p ~p~n\", [Count, MQL, CacheSize]),\r\n             report(Now, 0);\r\n         _ ->\r\n             receive\r\n```\r\n\r\n`ddoc_cache_speed:go(2000).`\r\n\r\n```\r\n1403000 1000 997\r\n1441000 999 997\r\n1416000 1001 998\r\n1387000 1000 997\r\n1403000 1001 996\r\n1418000 1001 997\r\n```\r\nLeft it running for 30 min or so and was seeing about 1M+ opens per second. Cache max size was left as the default at 1000. VM memory and number of processes stayed stable under 100MB and 3500 respectively.\r\n\r\nCache ets size (the 3rd column) also stayed under 1000. Reducing the max_cache to 500 also reduced the table sizes accordingly:\r\n```\r\n1336000 1500 497\r\n1252000 1499 498\r\n1307000 1500 497\r\n1240000 1500 497\r\n```\r\n\r\nThe interesting observation is that the LRU message queue size is in a steady steady and is almost exactly equal to `NumberOfWorkers-MaxSize`.  `NumberOfWorkers=2000` and when `MaxSize=1000`, then message queue was 2000-1000=1000. Then when `MaxSize` was reduced to 500, queue size became 2000-500=1500.\r\n\r\nNice unit test coverage. All news tests pass:\r\n\r\n```\r\nmake eunit apps=ddoc_cache\r\n...\r\n\r\n  All 46 tests passed.\r\n```\r\n\r\n+1 (but first see a few questions about ets delete and other minor nits).\r\n\r\nVery nice work!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313837711/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313839730","html_url":"https://github.com/apache/couchdb/issues/649#issuecomment-313839730","issue_url":"https://api.github.com/repos/apache/couchdb/issues/649","id":313839730,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzgzOTczMA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-08T07:14:00Z","updated_at":"2017-07-08T07:14:00Z","author_association":"MEMBER","body":"Sadly, it recurred already.\r\n\r\nhttps://builds.apache.org/blue/organizations/jenkins/CouchDB/detail/master/64/pipeline/49/","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313839730/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313839901","html_url":"https://github.com/apache/couchdb/issues/649#issuecomment-313839901","issue_url":"https://api.github.com/repos/apache/couchdb/issues/649","id":313839901,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzgzOTkwMQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-08T07:18:09Z","updated_at":"2017-07-08T07:19:46Z","author_association":"MEMBER","body":"The Makefile shows <0.22474.1> as the pid that is being monitored:\r\n\r\n```\r\nmodule 'couch_mrview_changes_since_tests'\r\n  changes_since tests\r\n    couch_mrview_changes_since_tests:109: test_basic...ok\r\n    couch_mrview_changes_since_tests:132: test_basic_since...ok\r\n    couch_mrview_changes_since_tests:145: test_basic_count...ok\r\n    couch_mrview_changes_since_tests:154: test_basic_count_since...ok\r\n    undefined\r\n    *** instantiation of subtests failed ***\r\n**in function gen_server:call/3 (gen_server.erl, line 190)\r\nin call from couch_mrview_util:get_view_index_state/5 (src/couch_mrview_util.erl, line 83)\r\nin call from couch_mrview_util:get_view/4 (src/couch_mrview_util.erl, line 45)\r\nin call from couch_mrview:count_view_changes_since/5 (src/couch_mrview.erl, line 304)\r\nin call from couch_mrview_changes_since_tests:test_compact/1 (test/couch_mrview_changes_since_tests.erl, line 163)\r\n**exit:{unknown_info,{gen_server,call,[<0.22474.1>,{get_state,11},infinity]}}\r\n```\r\n\r\ncouch.log shows the compaction in the test, but a strange exit:\r\n\r\n```\r\n[info] 2017-07-08T06:34:17.054113Z nonode@nohost <0.7.0> -------- Application couch started on node nonode@nohost\r\n[notice] 2017-07-08T06:34:17.054117Z nonode@nohost <0.22188.1> -------- config: [compactions] _default deleted for reason nil\r\n[info] 2017-07-08T06:34:17.364621Z nonode@nohost <0.22402.1> -------- Opening index for db: eunit-test-db-149949565754465 idx: _design/bar sig: \"7d577d5ace56a11c2e7289f38c77f383\"\r\n[info] 2017-07-08T06:34:17.364889Z nonode@nohost <0.22405.1> -------- Starting index update for db: eunit-test-db-149949565754465 idx: _design/bar\r\n[info] 2017-07-08T06:34:17.370701Z nonode@nohost <0.22405.1> -------- Index update finished for db: eunit-test-db-149949565754465 idx: _design/bar\r\n[info] 2017-07-08T06:34:17.374392Z nonode@nohost <0.22402.1> -------- Index shutdown by monitor notice for db: eunit-test-db-149949565754465 idx: _design/bar\r\n[info] 2017-07-08T06:34:17.374925Z nonode@nohost <0.22402.1> -------- Closing index for db: eunit-test-db-149949565754465 idx: _design/bar sig: \"7d577d5ace56a11c2e7289f38c77f383\" because normal\r\n[info] 2017-07-08T06:34:17.388247Z nonode@nohost <0.22420.1> -------- Opening index for db: eunit-test-db-1499495657375222 idx: _design/bar sig: \"7d577d5ace56a11c2e7289f38c77f383\"\r\n[info] 2017-07-08T06:34:17.388478Z nonode@nohost <0.22423.1> -------- Starting index update for db: eunit-test-db-1499495657375222 idx: _design/bar\r\n[info] 2017-07-08T06:34:17.394489Z nonode@nohost <0.22423.1> -------- Index update finished for db: eunit-test-db-1499495657375222 idx: _design/bar\r\n[info] 2017-07-08T06:34:17.397271Z nonode@nohost <0.22420.1> -------- Index shutdown by monitor notice for db: eunit-test-db-1499495657375222 idx: _design/bar\r\n[info] 2017-07-08T06:34:17.397739Z nonode@nohost <0.22420.1> -------- Closing index for db: eunit-test-db-1499495657375222 idx: _design/bar sig: \"7d577d5ace56a11c2e7289f38c77f383\" because normal\r\n[info] 2017-07-08T06:34:17.410658Z nonode@nohost <0.22438.1> -------- Opening index for db: eunit-test-db-1499495657398013 idx: _design/bar sig: \"7d577d5ace56a11c2e7289f38c77f383\"\r\n[info] 2017-07-08T06:34:17.411090Z nonode@nohost <0.22441.1> -------- Starting index update for db: eunit-test-db-1499495657398013 idx: _design/bar\r\n[info] 2017-07-08T06:34:17.420887Z nonode@nohost <0.22441.1> -------- Index update finished for db: eunit-test-db-1499495657398013 idx: _design/bar\r\n[info] 2017-07-08T06:34:17.424261Z nonode@nohost <0.22438.1> -------- Index shutdown by monitor notice for db: eunit-test-db-1499495657398013 idx: _design/bar\r\n[info] 2017-07-08T06:34:17.424604Z nonode@nohost <0.22438.1> -------- Closing index for db: eunit-test-db-1499495657398013 idx: _design/bar sig: \"7d577d5ace56a11c2e7289f38c77f383\" because normal\r\n[info] 2017-07-08T06:34:17.437426Z nonode@nohost <0.22456.1> -------- Opening index for db: eunit-test-db-1499495657424766 idx: _design/bar sig: \"7d577d5ace56a11c2e7289f38c77f383\"\r\n[info] 2017-07-08T06:34:17.437689Z nonode@nohost <0.22459.1> -------- Starting index update for db: eunit-test-db-1499495657424766 idx: _design/bar\r\n[info] 2017-07-08T06:34:17.443562Z nonode@nohost <0.22459.1> -------- Index update finished for db: eunit-test-db-1499495657424766 idx: _design/bar\r\n[info] 2017-07-08T06:34:17.446443Z nonode@nohost <0.22456.1> -------- Index shutdown by monitor notice for db: eunit-test-db-1499495657424766 idx: _design/bar\r\n[info] 2017-07-08T06:34:17.447092Z nonode@nohost <0.22456.1> -------- Closing index for db: eunit-test-db-1499495657424766 idx: _design/bar sig: \"7d577d5ace56a11c2e7289f38c77f383\" because normal\r\n[info] 2017-07-08T06:34:17.471464Z nonode@nohost <0.22474.1> -------- Opening index for db: eunit-test-db-1499495657447342 idx: _design/bar sig: \"7d577d5ace56a11c2e7289f38c77f383\"\r\n[info] 2017-07-08T06:34:17.471735Z nonode@nohost <0.22479.1> -------- Compaction started for db: eunit-test-db-1499495657447342 idx: _design/bar\r\n[info] 2017-07-08T06:34:17.472199Z nonode@nohost <0.22477.1> -------- Starting index update for db: eunit-test-db-1499495657447342 idx: _design/bar\r\n[notice] 2017-07-08T06:34:17.478663Z nonode@nohost <0.22474.1> -------- Compaction swap for view /tmp/tmp.8hwe87r9Aw/apache-couchdb-2.1.0-da7aa54/tmp/data/.eunit-test-db-1499495657447342_design/mrview/7d577d5ace56a11c2e7289f38c77f383.view 51 4200\r\n[info] 2017-07-08T06:34:17.479292Z nonode@nohost <0.22477.1> -------- Restarting index update for db: eunit-test-db-1499495657447342 idx: _design/bar\r\n[info] 2017-07-08T06:34:17.479623Z nonode@nohost <0.22479.1> -------- Compaction finished for db: eunit-test-db-1499495657447342 idx: _design/bar\r\n[error] 2017-07-08T06:34:17.479875Z nonode@nohost <0.22477.1> -------- gen_server <0.22477.1> terminated with reason: unknown_info\r\n  last msg: {'EXIT',<0.22480.1>,{updated,<0.22480.1>,{mrst,<<125,87,125,90,206,86,161,28,46,114,137,243,140,119,243,131>>,<0.22476.1>,#Ref<0.0.6.164863>,<<\"eunit-test-db-1499495657447342\">>,<<\"_design/bar\">>,<<\"javascript\">>,[{<<\"seq_indexed\">>,true}],true,false,{[]},[{mrview,0,11,0,[<<\"baz\">>],[],<<\"function(doc) {emit(doc.val.toString(), doc.val);}\">>,{btree,<0.22476.1>,{363,{10,[]},139},undefined,undefined,#Fun<couch_ejson_compare.less_json_ids.2>,#Fun<couch_mrview_util.17.34658527>,snappy},{btree,<0.22476.1>,{502,10,376},undefined,undefined,undefined,#Fun<couch_db_updater.btree_by_seq_reduce.2>,snappy},nil,true,false,[]}],{btree,<0.22476.1>,{51,[],135},undefined,undefined,undefined,nil,snappy},{btree,<0.22476.1>,{186,[],177},undefined,undefined,undefined,nil,snappy},11,0,undefined,undefined,undefined,undefined,undefined,nil}}}\r\n     state: {st,<0.22474.1>,couch_mrview_index,<0.22488.1>}\r\n[error] 2017-07-08T06:34:17.480273Z nonode@nohost <0.22477.1> -------- CRASH REPORT Process  (<0.22477.1>) with 2 neighbors exited with reason: unknown_info at gen_server:terminate/6(line:737) <= proc_lib:init_p_do_apply/3(line:237); initial_call: {couch_index_updater,init,['Argument__1']}, ancestors: [<0.22474.1>,<0.22473.1>], messages: [], links: [<0.22474.1>], dictionary: [], trap_exit: true, status: running, heap_size: 1598, stack_size: 27, reductions: 1732\r\n[error] 2017-07-08T06:34:17.480508Z nonode@nohost <0.22478.1> -------- gen_server <0.22478.1> terminated with reason: unknown_info\r\n  last msg: {'EXIT',<0.22474.1>,unknown_info}\r\n     state: {st,<0.22474.1>,couch_mrview_index,<0.22479.1>}\r\n[error] 2017-07-08T06:34:17.480850Z nonode@nohost <0.22478.1> -------- CRASH REPORT Process  (<0.22478.1>) with 0 neighbors exited with reason: unknown_info at gen_server:terminate/6(line:737) <= proc_lib:init_p_do_apply/3(line:237); initial_call: {couch_index_compactor,init,['Argument__1']}, ancestors: [<0.22474.1>,<0.22473.1>], messages: [], links: [], dictionary: [], trap_exit: true, status: running, heap_size: 376, stack_size: 27, reductions: 145\r\n```\r\n\r\n@eiri @nickva are either of you able to help out here?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313839901/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313897087","html_url":"https://github.com/apache/couchdb/pull/654#issuecomment-313897087","issue_url":"https://api.github.com/repos/apache/couchdb/issues/654","id":313897087,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzg5NzA4Nw==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-09T04:07:55Z","updated_at":"2017-07-09T04:08:36Z","author_association":"MEMBER","body":"+1\r\n\r\nI don't think we should worry about disabling the daemon for tests. Adding randomness to the tests when we're making assertions about global state isn't gonna work so hot when we've got something doing things in the background without coordination. If we're worried about testing things with the daemon running we should just write new tests for it rather than screw with all the existing tests. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313897087/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313898756","html_url":"https://github.com/apache/couchdb/issues/631#issuecomment-313898756","issue_url":"https://api.github.com/repos/apache/couchdb/issues/631","id":313898756,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzg5ODc1Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-09T04:56:36Z","updated_at":"2017-07-09T04:56:36Z","author_association":"MEMBER","body":"Just happened again:\r\n\r\n* https://travis-ci.org/apache/couchdb/jobs/251632768","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313898756/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313902350","html_url":"https://github.com/apache/couchdb/issues/508#issuecomment-313902350","issue_url":"https://api.github.com/repos/apache/couchdb/issues/508","id":313902350,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzkwMjM1MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-09T06:37:38Z","updated_at":"2017-07-09T06:37:38Z","author_association":"MEMBER","body":"I have a newly built version of the 2.0.0 installer with the replaced NSSM, Erlang 18.3 and OpenSSL 1.0.2l. I am waiting for access to the code signing service to be restored, at which point I'll publish the installer as v2.0.0.2.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313902350/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313935007","html_url":"https://github.com/apache/couchdb/pull/657#issuecomment-313935007","issue_url":"https://api.github.com/repos/apache/couchdb/issues/657","id":313935007,"node_id":"MDEyOklzc3VlQ29tbWVudDMxMzkzNTAwNw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-07-09T17:54:34Z","updated_at":"2017-07-09T17:54:34Z","author_association":"MEMBER","body":"think there's more to do in replicator, chttpd, etc. I think it best to review as a whole set than piecemeal.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/313935007/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]