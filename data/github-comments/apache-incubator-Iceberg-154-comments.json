[{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061305835","html_url":"https://github.com/apache/iceberg/pull/4208#issuecomment-1061305835","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4208","id":1061305835,"node_id":"IC_kwDOCW7NX84_Qj3r","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T01:15:13Z","updated_at":"2022-03-08T01:15:13Z","author_association":"CONTRIBUTOR","body":"This should cover it. The `docs` folder was already present, but `open-api` and `format` were not: https://github.com/apache/iceberg/pull/4286","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061305835/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061306399","html_url":"https://github.com/apache/iceberg/pull/4286#issuecomment-1061306399","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4286","id":1061306399,"node_id":"IC_kwDOCW7NX84_QkAf","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T01:16:27Z","updated_at":"2022-03-08T01:23:03Z","author_association":"CONTRIBUTOR","body":"Note that CI ran because the workflow files were changes. A little paradoxical, but not a common enough situation imo to merit jumping through a lot of hoops to try to stop.\r\n\r\nShouldn't be the case we see CI running once PRs are submitted that are already based on the latest changes. Although PRs, once merged into master, will run until completion for all workflows (which is a good idea imo).\r\n\r\nWe can try to limit that if need be (if it starts eating into our available test runners), but I think it's best to have all commits run to completion.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061306399/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061308018","html_url":"https://github.com/apache/iceberg/pull/4286#issuecomment-1061308018","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4286","id":1061308018,"node_id":"IC_kwDOCW7NX84_QkZy","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T01:19:35Z","updated_at":"2022-03-08T01:19:35Z","author_association":"CONTRIBUTOR","body":"cc @rdblue @samredai @snazy ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061308018/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061309086","html_url":"https://github.com/apache/iceberg/pull/4286#issuecomment-1061309086","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4286","id":1061309086,"node_id":"IC_kwDOCW7NX84_Qkqe","user":{"login":"samredai","id":43911210,"node_id":"MDQ6VXNlcjQzOTExMjEw","avatar_url":"https://avatars.githubusercontent.com/u/43911210?v=4","gravatar_id":"","url":"https://api.github.com/users/samredai","html_url":"https://github.com/samredai","followers_url":"https://api.github.com/users/samredai/followers","following_url":"https://api.github.com/users/samredai/following{/other_user}","gists_url":"https://api.github.com/users/samredai/gists{/gist_id}","starred_url":"https://api.github.com/users/samredai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samredai/subscriptions","organizations_url":"https://api.github.com/users/samredai/orgs","repos_url":"https://api.github.com/users/samredai/repos","events_url":"https://api.github.com/users/samredai/events{/privacy}","received_events_url":"https://api.github.com/users/samredai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T01:21:42Z","updated_at":"2022-03-08T01:21:42Z","author_association":"CONTRIBUTOR","body":"LGTM. Thanks @kbendick!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061309086/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061310842","html_url":"https://github.com/apache/iceberg/pull/4283#issuecomment-1061310842","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4283","id":1061310842,"node_id":"IC_kwDOCW7NX84_QlF6","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T01:25:14Z","updated_at":"2022-03-08T01:25:14Z","author_association":"CONTRIBUTOR","body":"Thanks for this @tprelle. Would you mind copying over information from the issue to the PR description so that people can find it properly (e.g. if they're looking at git history in their IDE etc).\r\n\r\nAdditionally, I noticed you said the behavior of Spark was to return null if a null was encountered in this situation. I'm not a Hive user... is this the same behavior that's expected in Hive proper?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061310842/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061320792","html_url":"https://github.com/apache/iceberg/pull/4210#issuecomment-1061320792","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4210","id":1061320792,"node_id":"IC_kwDOCW7NX84_QnhY","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T01:45:15Z","updated_at":"2022-03-08T01:45:15Z","author_association":"CONTRIBUTOR","body":"> Thanks! Is it possible to pattern match on branches like this does for tags? All of the release candidates start with `apache-iceberg-*`\r\n\r\nYes it is. I can open a PR now. 👍 ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061320792/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061324052","html_url":"https://github.com/apache/iceberg/pull/3810#issuecomment-1061324052","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3810","id":1061324052,"node_id":"IC_kwDOCW7NX84_QoUU","user":{"login":"hililiwei","id":59213263,"node_id":"MDQ6VXNlcjU5MjEzMjYz","avatar_url":"https://avatars.githubusercontent.com/u/59213263?v=4","gravatar_id":"","url":"https://api.github.com/users/hililiwei","html_url":"https://github.com/hililiwei","followers_url":"https://api.github.com/users/hililiwei/followers","following_url":"https://api.github.com/users/hililiwei/following{/other_user}","gists_url":"https://api.github.com/users/hililiwei/gists{/gist_id}","starred_url":"https://api.github.com/users/hililiwei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hililiwei/subscriptions","organizations_url":"https://api.github.com/users/hililiwei/orgs","repos_url":"https://api.github.com/users/hililiwei/repos","events_url":"https://api.github.com/users/hililiwei/events{/privacy}","received_events_url":"https://api.github.com/users/hililiwei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T01:51:49Z","updated_at":"2022-03-08T01:53:43Z","author_association":"CONTRIBUTOR","body":"> @openinx, @hililiwei, I think we need to revert this. It looks like the `dataContext` and `deleteContext` methods accept Hadoop Configuration objects rather than property maps.\r\n> \r\n> Iceberg doesn't use Hadoop Configuration. We can either directly fix this to work like the Parquet contexts with another PR, or I think we should revert and open a replacement PR. What do you think is the right way forward?\r\n\r\nI understand what you mean roughly. Let me raise a separate PR, it may goes beyond the this PR content.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061324052/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061328646","html_url":"https://github.com/apache/iceberg/pull/4210#issuecomment-1061328646","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4210","id":1061328646,"node_id":"IC_kwDOCW7NX84_QpcG","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T02:00:49Z","updated_at":"2022-03-08T02:00:49Z","author_association":"CONTRIBUTOR","body":"> > Thanks! Is it possible to pattern match on branches like this does for tags? All of the release candidates start with `apache-iceberg-*`\r\n> \r\n> Yes it is. I can open a PR now. 👍\r\n\r\nOpened a PR for release branches: https://github.com/apache/iceberg/pull/4287","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061328646/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061329890","html_url":"https://github.com/apache/iceberg/pull/3810#issuecomment-1061329890","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3810","id":1061329890,"node_id":"IC_kwDOCW7NX84_Qpvi","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T02:03:06Z","updated_at":"2022-03-08T02:03:06Z","author_association":"MEMBER","body":"@rdblue  The `ORC#WriterBuilder` will copy all the key values from property map to the Hadoop configuration, please see [1] and [2]. So in my thought,  we can just use the unified hadoop configuration to get all of the configure keys.  Will this answer your concern ? \r\n\r\n[1]. https://github.com/apache/iceberg/blob/master/orc/src/main/java/org/apache/iceberg/orc/ORC.java#L122\r\n[2]. https://github.com/apache/iceberg/blob/master/orc/src/main/java/org/apache/iceberg/orc/ORC.java#L132","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061329890/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061334692","html_url":"https://github.com/apache/iceberg/pull/3810#issuecomment-1061334692","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3810","id":1061334692,"node_id":"IC_kwDOCW7NX84_Qq6k","user":{"login":"hililiwei","id":59213263,"node_id":"MDQ6VXNlcjU5MjEzMjYz","avatar_url":"https://avatars.githubusercontent.com/u/59213263?v=4","gravatar_id":"","url":"https://api.github.com/users/hililiwei","html_url":"https://github.com/hililiwei","followers_url":"https://api.github.com/users/hililiwei/followers","following_url":"https://api.github.com/users/hililiwei/following{/other_user}","gists_url":"https://api.github.com/users/hililiwei/gists{/gist_id}","starred_url":"https://api.github.com/users/hililiwei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hililiwei/subscriptions","organizations_url":"https://api.github.com/users/hililiwei/orgs","repos_url":"https://api.github.com/users/hililiwei/repos","events_url":"https://api.github.com/users/hililiwei/events{/privacy}","received_events_url":"https://api.github.com/users/hililiwei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T02:13:03Z","updated_at":"2022-03-08T02:13:03Z","author_association":"CONTRIBUTOR","body":"https://github.com/apache/iceberg/blob/c6710cd5e0f3b3cf457ebca1532e10091042474f/parquet/src/main/java/org/apache/iceberg/parquet/Parquet.java#L153-L156\r\n\r\nhttps://github.com/apache/iceberg/blob/c6710cd5e0f3b3cf457ebca1532e10091042474f/parquet/src/main/java/org/apache/iceberg/parquet/Parquet.java#L158-L161\r\n\r\nhttps://github.com/apache/iceberg/blob/c6710cd5e0f3b3cf457ebca1532e10091042474f/parquet/src/main/java/org/apache/iceberg/parquet/Parquet.java#L261-L270\r\n\r\nI mainly refer to Parquet's code above. Do you mean to use this way as well? @openinx \r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061334692/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061342640","html_url":"https://github.com/apache/iceberg/pull/3810#issuecomment-1061342640","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3810","id":1061342640,"node_id":"IC_kwDOCW7NX84_Qs2w","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T02:29:28Z","updated_at":"2022-03-08T02:29:28Z","author_association":"MEMBER","body":"Let's make this more clear: \r\n\r\nIn the ORC class, we just copied all key values from property maps to hadoop configuration. And all the following configure keys will be parsed from hadoop configuration instance. \r\n\r\nIn the current Parquet class, we will just keep all the property maps into in-memory hash map, and then the `dataContext` & `deleteContext` will parse the hash map directly.  Finally,  we will copy the key values from HashMap to hadoop configuration.\r\n\r\nIn my mind, I just don't see the difference between the two approach. Both look good to me.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061342640/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061344862","html_url":"https://github.com/apache/iceberg/pull/4280#issuecomment-1061344862","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4280","id":1061344862,"node_id":"IC_kwDOCW7NX84_QtZe","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T02:34:28Z","updated_at":"2022-03-08T02:34:28Z","author_association":"CONTRIBUTOR","body":"> Plus enforcement can't really be done client side.\r\n> I don't think this should change the Table API.\r\n\r\nYes agree, please hold on the review for some time, I am asking for an initial draft from @xiaoxuandev so we can just openly review the code changes. I think this needs a few iterations to trim down the changes. We should be able to make this feature work through just creating the correct TableOperation object using the correct credentials. I don't even think we need a `LakeFormationCatalog`, it can just be controlled through a flag.\r\n\r\n> I'm also curious about the long-term plan for access control integration because I don't think we want to put very many features in Iceberg for it.\r\n\r\nI think database and table level access control is most likely going to be all we add in Iceberg. For column-level and cell-level access control, all the AWS compute platforms are mostly already onboard with that, and there is guidelines published now for any third-party integration, it's not something that could be enforced just within the table format itself.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061344862/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061351387","html_url":"https://github.com/apache/iceberg/pull/4286#issuecomment-1061351387","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4286","id":1061351387,"node_id":"IC_kwDOCW7NX84_Qu_b","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T02:49:20Z","updated_at":"2022-03-08T02:49:20Z","author_association":"CONTRIBUTOR","body":"Thanks, @kbendick!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061351387/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061352370","html_url":"https://github.com/apache/iceberg/pull/4287#issuecomment-1061352370","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4287","id":1061352370,"node_id":"IC_kwDOCW7NX84_QvOy","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T02:51:23Z","updated_at":"2022-03-08T02:51:23Z","author_association":"CONTRIBUTOR","body":"Sorry, I think I was wrong. Branches are named after the release version, like `0.13.x`. The release tags are named `apache-iceberg-**`, but we already run on tags. So I think it should be `0.**`?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061352370/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061353601","html_url":"https://github.com/apache/iceberg/pull/4280#issuecomment-1061353601","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4280","id":1061353601,"node_id":"IC_kwDOCW7NX84_QviB","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T02:54:05Z","updated_at":"2022-03-08T02:54:05Z","author_association":"CONTRIBUTOR","body":"> Yes agree, please hold on the review for some time\r\n\r\nNo problem. I hope it wasn't a nuisance that I reviewed earlier.\r\n\r\n> I think database and table level access control is most likely going to be all we add in Iceberg\r\n\r\nWhy put this in Iceberg at all? If it can't be enforced then is it worth complication? Wouldn't this just open up the project to other ineffective integrations?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061353601/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061357724","html_url":"https://github.com/apache/iceberg/pull/4287#issuecomment-1061357724","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4287","id":1061357724,"node_id":"IC_kwDOCW7NX84_Qwic","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T03:03:25Z","updated_at":"2022-03-08T03:03:25Z","author_association":"CONTRIBUTOR","body":"> Sorry, I think I was wrong. Branches are named after the release version, like `0.13.x`. The release tags are named `apache-iceberg-**`, but we already run on tags. So I think it should be `0.**`?\r\n\r\nNo worries. I updated it to be branches of `0.**` (not sure how to require that it be `0.x.y` formatted and realistically before this we were running CI on push to any branch).\r\n\r\nI also updated the tags to be `apache-iceberg-**` since that is the format for release tags.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061357724/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061393072","html_url":"https://github.com/apache/iceberg/pull/4264#issuecomment-1061393072","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4264","id":1061393072,"node_id":"IC_kwDOCW7NX84_Q5Kw","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T04:25:46Z","updated_at":"2022-03-08T04:25:46Z","author_association":"MEMBER","body":"FYI @rdblue , @aokolnychyi , @dungdm93 .  I think this draft PR is ready to review now. Mind to take a look when you have a chance ?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061393072/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061522325","html_url":"https://github.com/apache/iceberg/pull/4158#issuecomment-1061522325","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4158","id":1061522325,"node_id":"IC_kwDOCW7NX84_RYuV","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T08:22:42Z","updated_at":"2022-03-08T08:22:42Z","author_association":"MEMBER","body":"Since we had an apache iceberg PMC (@jackye1995 ) approved this PR, I plan to get this merged now. Thanks all for reviewing.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061522325/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061572642","html_url":"https://github.com/apache/iceberg/issues/4212#issuecomment-1061572642","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4212","id":1061572642,"node_id":"IC_kwDOCW7NX84_RlAi","user":{"login":"itaise","id":64745584,"node_id":"MDQ6VXNlcjY0NzQ1NTg0","avatar_url":"https://avatars.githubusercontent.com/u/64745584?v=4","gravatar_id":"","url":"https://api.github.com/users/itaise","html_url":"https://github.com/itaise","followers_url":"https://api.github.com/users/itaise/followers","following_url":"https://api.github.com/users/itaise/following{/other_user}","gists_url":"https://api.github.com/users/itaise/gists{/gist_id}","starred_url":"https://api.github.com/users/itaise/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itaise/subscriptions","organizations_url":"https://api.github.com/users/itaise/orgs","repos_url":"https://api.github.com/users/itaise/repos","events_url":"https://api.github.com/users/itaise/events{/privacy}","received_events_url":"https://api.github.com/users/itaise/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T09:25:03Z","updated_at":"2022-03-08T09:25:03Z","author_association":"NONE","body":"@rdblue we will be very grateful to get your input on this. thank you!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061572642/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061680316","html_url":"https://github.com/apache/iceberg/pull/4277#issuecomment-1061680316","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4277","id":1061680316,"node_id":"IC_kwDOCW7NX84_R_S8","user":{"login":"ConeyLiu","id":12733256,"node_id":"MDQ6VXNlcjEyNzMzMjU2","avatar_url":"https://avatars.githubusercontent.com/u/12733256?v=4","gravatar_id":"","url":"https://api.github.com/users/ConeyLiu","html_url":"https://github.com/ConeyLiu","followers_url":"https://api.github.com/users/ConeyLiu/followers","following_url":"https://api.github.com/users/ConeyLiu/following{/other_user}","gists_url":"https://api.github.com/users/ConeyLiu/gists{/gist_id}","starred_url":"https://api.github.com/users/ConeyLiu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ConeyLiu/subscriptions","organizations_url":"https://api.github.com/users/ConeyLiu/orgs","repos_url":"https://api.github.com/users/ConeyLiu/repos","events_url":"https://api.github.com/users/ConeyLiu/events{/privacy}","received_events_url":"https://api.github.com/users/ConeyLiu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T11:28:50Z","updated_at":"2022-03-08T11:28:50Z","author_association":"CONTRIBUTOR","body":"> Just to confirm the api isn't available in Spark 3.0 correct?\r\n\r\nThat's right. It has been changed since Spark 3.1.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061680316/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061735573","html_url":"https://github.com/apache/iceberg/issues/4217#issuecomment-1061735573","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4217","id":1061735573,"node_id":"IC_kwDOCW7NX84_SMyV","user":{"login":"ConeyLiu","id":12733256,"node_id":"MDQ6VXNlcjEyNzMzMjU2","avatar_url":"https://avatars.githubusercontent.com/u/12733256?v=4","gravatar_id":"","url":"https://api.github.com/users/ConeyLiu","html_url":"https://github.com/ConeyLiu","followers_url":"https://api.github.com/users/ConeyLiu/followers","following_url":"https://api.github.com/users/ConeyLiu/following{/other_user}","gists_url":"https://api.github.com/users/ConeyLiu/gists{/gist_id}","starred_url":"https://api.github.com/users/ConeyLiu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ConeyLiu/subscriptions","organizations_url":"https://api.github.com/users/ConeyLiu/orgs","repos_url":"https://api.github.com/users/ConeyLiu/repos","events_url":"https://api.github.com/users/ConeyLiu/events{/privacy}","received_events_url":"https://api.github.com/users/ConeyLiu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T12:40:23Z","updated_at":"2022-03-09T11:04:04Z","author_association":"CONTRIBUTOR","body":"We also have benchmarked iceberg with TPCDS. And got the following finds:\r\n1. As @wypoon said, spark reading parquet and reading iceberg using different relation size estimation, which leads to the different table plan. Such as BroadcastJoin to SortMergeJoin.\r\n2. Spark reading parquet with vectorized data reading by default. However, we have just enabled it by default in iceberg recently.  You could enable it by yourself. This could improve data reading a lot. And I have a pr (https://github.com/apache/iceberg/pull/3249) for optimizing iceberg parquet decimal vectorized reading.\r\n3. Spark supports DPP for build-in datasource while it supports iceberg-like datasource since spark 3.2. This could influence the performance a lot from TPCDS side.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061735573/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061772959","html_url":"https://github.com/apache/iceberg/pull/3810#issuecomment-1061772959","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3810","id":1061772959,"node_id":"IC_kwDOCW7NX84_SV6f","user":{"login":"zhongyujiang","id":42907416,"node_id":"MDQ6VXNlcjQyOTA3NDE2","avatar_url":"https://avatars.githubusercontent.com/u/42907416?v=4","gravatar_id":"","url":"https://api.github.com/users/zhongyujiang","html_url":"https://github.com/zhongyujiang","followers_url":"https://api.github.com/users/zhongyujiang/followers","following_url":"https://api.github.com/users/zhongyujiang/following{/other_user}","gists_url":"https://api.github.com/users/zhongyujiang/gists{/gist_id}","starred_url":"https://api.github.com/users/zhongyujiang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhongyujiang/subscriptions","organizations_url":"https://api.github.com/users/zhongyujiang/orgs","repos_url":"https://api.github.com/users/zhongyujiang/repos","events_url":"https://api.github.com/users/zhongyujiang/events{/privacy}","received_events_url":"https://api.github.com/users/zhongyujiang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T13:23:58Z","updated_at":"2022-03-08T15:26:45Z","author_association":"CONTRIBUTOR","body":"@openinx, I think what @rdblue means is that  in current logic Iceberg configuration might be overridden by Hadoop configuration , for example:\r\nwhen Hadoop configuraion is configed a property \r\n\"orc.compress\" = \"snappy\"\r\nand no corresponding property has been configed in Iceberg table props, In the present context ORC will use snappy for compress as configed in Hadoop. But the correct procedure is use default codec configed in `TableProperties`.\r\n\r\nSo we need a props map to receive table props passed in, then set corresponding ORC props in Hadoop configuration after parsing, just like Parquet.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061772959/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061849558","html_url":"https://github.com/apache/iceberg/pull/3956#issuecomment-1061849558","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3956","id":1061849558,"node_id":"IC_kwDOCW7NX84_SonW","user":{"login":"nastra","id":271029,"node_id":"MDQ6VXNlcjI3MTAyOQ==","avatar_url":"https://avatars.githubusercontent.com/u/271029?v=4","gravatar_id":"","url":"https://api.github.com/users/nastra","html_url":"https://github.com/nastra","followers_url":"https://api.github.com/users/nastra/followers","following_url":"https://api.github.com/users/nastra/following{/other_user}","gists_url":"https://api.github.com/users/nastra/gists{/gist_id}","starred_url":"https://api.github.com/users/nastra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nastra/subscriptions","organizations_url":"https://api.github.com/users/nastra/orgs","repos_url":"https://api.github.com/users/nastra/repos","events_url":"https://api.github.com/users/nastra/events{/privacy}","received_events_url":"https://api.github.com/users/nastra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T14:41:41Z","updated_at":"2022-03-08T14:41:41Z","author_association":"CONTRIBUTOR","body":"@rdblue shall we merge this?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061849558/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061990622","html_url":"https://github.com/apache/iceberg/pull/3810#issuecomment-1061990622","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3810","id":1061990622,"node_id":"IC_kwDOCW7NX84_TLDe","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T16:54:08Z","updated_at":"2022-03-08T16:54:08Z","author_association":"CONTRIBUTOR","body":"For Parquet the Hadoop configuration is used to pass options into the data file. It is not used as the source of table configuration. Table configuration properties should never come from the Hadoop Configuration.\r\n\r\nThe steps should be:\r\n1. Get the Hadoop configuration, if it is present in the InputFile or OutputFile. If not, default it\r\n2. Get config from the builder and the table properties\r\n3. Set configuration from step 2 on the Hadoop config\r\n4. Create the reader or writer with the Hadoop config\r\n\r\nThe only configuration coming from the Hadoop Configuration itself is whatever was in the environment.\r\n\r\nOne possibly confusing thing is that we also set config values directly in the Hadoop configuration. That handles cases where the user wants to pass config properties that are not standardized in Iceberg. So you could use `set(\"parquet.bloom.filter.enabled#id\", \"true\")` for example. Standardized table settings should override these.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1061990622/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062008372","html_url":"https://github.com/apache/iceberg/pull/4280#issuecomment-1062008372","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4280","id":1062008372,"node_id":"IC_kwDOCW7NX84_TPY0","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T17:11:08Z","updated_at":"2022-03-08T17:11:34Z","author_association":"CONTRIBUTOR","body":"> Why put this in Iceberg at all? If it can't be enforced then is it worth complication? Wouldn't this just open up the project to other ineffective integrations?\r\n\r\nThe fact is that Glue and LakeFormation are 2 very tightly coupled products, around 70% of customers using `GlueCatalog` we interact brings up LakeFormation integration at some point of time.\r\n\r\nThe LakeFormation permission control consists of 2 parts, (1) normal AWS credential is used to check access against Glue based on IAM + LakeFormation policy, (2) LF-vended temporary credential is used to access S3. \r\n\r\nWhen a user enrolls in LakeFormation (which happens when the user visits the LakeFormation console), the Glue access control automatically changes respect LakeFormation policy because of (1). This works fine for Hive tables because data and catalog are operated separately, but for Iceberg table all of a sudden users can no longer write and commit to the table because of (2).\r\n\r\nI would say this is more like a bug of `GlueCatalog` so we have to solve within this class. We do need at least `GlueCatalog` to support (2), which means it will use a specialized AWS client factory where the S3 client uses a different LF-vended temporary credential, and the credential needs to be different for each table based on the table name.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062008372/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062018384","html_url":"https://github.com/apache/iceberg/pull/4280#issuecomment-1062018384","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4280","id":1062018384,"node_id":"IC_kwDOCW7NX84_TR1Q","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T17:22:09Z","updated_at":"2022-03-08T17:22:09Z","author_association":"CONTRIBUTOR","body":"I think adding credentials makes sense. You just mentioned table-level access control. Maybe I misinterpreted what you meant by that. I thought you meant some sort of enforcement or integration beyond user identity or credentials. I don't think it makes sense to add anything to Iceberg beyond that.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062018384/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062020131","html_url":"https://github.com/apache/iceberg/pull/4260#issuecomment-1062020131","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4260","id":1062020131,"node_id":"IC_kwDOCW7NX84_TSQj","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T17:24:04Z","updated_at":"2022-03-08T17:24:04Z","author_association":"CONTRIBUTOR","body":"Thanks for the reviews, everyone!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062020131/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062027218","html_url":"https://github.com/apache/iceberg/pull/4254#issuecomment-1062027218","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4254","id":1062027218,"node_id":"IC_kwDOCW7NX84_TT_S","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T17:32:07Z","updated_at":"2022-03-08T17:32:23Z","author_association":"CONTRIBUTOR","body":"> But the metrics reporting that this affects are being passed back to a processing engine, which is determined by the environment.\r\n\r\nYes I agree this is more related to the processing engine, rather than the catalog. The question here becomes how do we support integration to different engines without dynamically loading? We do not really have a way of configuring FileIO outside catalog.\r\n\r\nThe issue with HadoopMetricsContext is that we are going back to be tied to Hadoop. We have seen users trying to use Iceberg environments without Hadoop dependency (e.g. AWS Kinesis serverless Flink) and people don't want to load Hadoop dependencies just for getting metrics. So I think we definitely need some other implementations.\r\n\r\nOur plan with this PR is to later introduce metrics context such as `CollectdMetricsContext`, and that could be then tied to any monitoring services that typically has an agent process running to collect metrics at background. Our target is AWS CloudWatch integration, but I think most products offer similar integration pattern.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062027218/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062031477","html_url":"https://github.com/apache/iceberg/pull/4254#issuecomment-1062031477","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4254","id":1062031477,"node_id":"IC_kwDOCW7NX84_TVB1","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T17:36:54Z","updated_at":"2022-03-08T17:38:05Z","author_association":"CONTRIBUTOR","body":"What I was thinking is a mix-in interface for `FileIO` that allows the engine to set the metrics context. We could default to Hadoop since that's what happens with `HadoopFileIO` automatically, but if you want to get passed metrics directly then you can set the context:\r\n\r\n```java\r\n  FileIO io = table.io();\r\n  if (io instanceof MetricsProducer) {\r\n    ((MetricsProducer) io).setMetricsContext(engineContext);\r\n  }\r\n```\r\n\r\nWhat do you think, @jackye1995?\r\n\r\nFor reporting metrics to CloudWatch, wouldn't you integrate with the engine rather than with low-level libraries? You certainly could integrate directly if you wanted to. But I thought you'd probably want full metrics from the engine, not just what you can get from Iceberg file interaction.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062031477/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062074207","html_url":"https://github.com/apache/iceberg/pull/4254#issuecomment-1062074207","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4254","id":1062074207,"node_id":"IC_kwDOCW7NX84_Tfdf","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T18:23:35Z","updated_at":"2022-03-08T18:23:35Z","author_association":"CONTRIBUTOR","body":"> I was thinking is a mix-in interface\r\n\r\nYes that could work!\r\n\r\n> wouldn't you integrate with the engine rather than with low-level libraries\r\n\r\nCorrect, however the current `HadoopMetricsContext` seems to be doing this across all the engines, and this offers a unique benefit for `HadoopFileIO` users that they are able to see their FileIO metrics across all compute platforms aggregate through the Hadoop FileSystem interface. \r\n\r\nThere is benefit in at least providing an alternative such as `CollectdMetricsContext`, because we have been advocating `S3FileIO` to be not Hadoop dependent, and it is awkward that we now tell people we have to bring back the dependency and use Hadoop FileSystem to report metrics. This also applies to other non-Hadoop FileIOs.\r\n\r\nBecause of that, I think it still makes sense to have some sort of default behavior controlled through catalog level property, maybe in the name of `io.metrics.default.type` which is limited to a few specific types including `hadoop` and `collectd`, and `io.metrics.default.namespace` provides the namespace of the metrics.\r\n\r\n(regarding metrics namespace, it was discussed in https://github.com/apache/iceberg/pull/4254#discussion_r819178970, it seems to be the terminology that most metrics system use, let me know what you think)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062074207/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062077335","html_url":"https://github.com/apache/iceberg/pull/4280#issuecomment-1062077335","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4280","id":1062077335,"node_id":"IC_kwDOCW7NX84_TgOX","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T18:27:12Z","updated_at":"2022-03-08T18:27:29Z","author_association":"CONTRIBUTOR","body":"> I don't think it makes sense to add anything to Iceberg beyond that.\r\n\r\nYes agree, the original PR also included changes for column level security integration which I think is too much, so I am already cutting the scope. That's a primary reason I am asking for direct open source review, because I feel the internal development is diverging a bit too much and it's better if we just publish openly to discuss the right scope within Iceberg, so thanks very much for the input here!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062077335/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062146680","html_url":"https://github.com/apache/iceberg/pull/4242#issuecomment-1062146680","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4242","id":1062146680,"node_id":"IC_kwDOCW7NX84_TxJ4","user":{"login":"funcheetah","id":52840691,"node_id":"MDQ6VXNlcjUyODQwNjkx","avatar_url":"https://avatars.githubusercontent.com/u/52840691?v=4","gravatar_id":"","url":"https://api.github.com/users/funcheetah","html_url":"https://github.com/funcheetah","followers_url":"https://api.github.com/users/funcheetah/followers","following_url":"https://api.github.com/users/funcheetah/following{/other_user}","gists_url":"https://api.github.com/users/funcheetah/gists{/gist_id}","starred_url":"https://api.github.com/users/funcheetah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/funcheetah/subscriptions","organizations_url":"https://api.github.com/users/funcheetah/orgs","repos_url":"https://api.github.com/users/funcheetah/repos","events_url":"https://api.github.com/users/funcheetah/events{/privacy}","received_events_url":"https://api.github.com/users/funcheetah/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T19:54:12Z","updated_at":"2022-03-08T19:54:12Z","author_association":"NONE","body":"@wmoustafa @shardulm94 ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062146680/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062165212","html_url":"https://github.com/apache/iceberg/pull/4254#issuecomment-1062165212","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4254","id":1062165212,"node_id":"IC_kwDOCW7NX84_T1rc","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T20:10:32Z","updated_at":"2022-03-08T20:10:32Z","author_association":"CONTRIBUTOR","body":"> (regarding metrics namespace, it was discussed in https://github.com/apache/iceberg/pull/4254#discussion_r819178970, it seems to be the terminology that most metrics system use, let me know what you think)\r\n\r\nI think the problem is that we're standardizing something that doesn't need to be standard. This is specific to Hadoop metrics collection. I don't think we are ready to add a feature like prefixing metric names more generally.\r\n\r\nSince a lot of this is unknown, I would lean toward not exposing things publicly or building a lot of expectations right now.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062165212/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062169188","html_url":"https://github.com/apache/iceberg/pull/4254#issuecomment-1062169188","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4254","id":1062169188,"node_id":"IC_kwDOCW7NX84_T2pk","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T20:15:39Z","updated_at":"2022-03-08T20:15:39Z","author_association":"CONTRIBUTOR","body":"> Correct, however the current HadoopMetricsContext seems to be doing this across all the engines, and this offers a unique benefit for HadoopFileIO users that they are able to see their FileIO metrics across all compute platforms aggregate through the Hadoop FileSystem interface.\r\n\r\nThis is just a convenient way to get metrics to engines that already use Hadoop. I think we all agree that we want to be able to extend this, but it is a reasonable default for now.\r\n\r\n>  think it still makes sense to have some sort of default behavior controlled through catalog level property, maybe in the name of io.metrics.default.type which is limited to a few specific types including hadoop and collectd, and io.metrics.default.namespace provides the namespace of the metrics.\r\n\r\nI don't think we are at a point where there's a good argument for catalog-level configuration. Catalog configuration would be in conflict with what engines need and we would have to find a more complicated way to avoid this problem.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062169188/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062233014","html_url":"https://github.com/apache/iceberg/pull/3450#issuecomment-1062233014","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3450","id":1062233014,"node_id":"IC_kwDOCW7NX84_UGO2","user":{"login":"jun-he","id":12246263,"node_id":"MDQ6VXNlcjEyMjQ2MjYz","avatar_url":"https://avatars.githubusercontent.com/u/12246263?v=4","gravatar_id":"","url":"https://api.github.com/users/jun-he","html_url":"https://github.com/jun-he","followers_url":"https://api.github.com/users/jun-he/followers","following_url":"https://api.github.com/users/jun-he/following{/other_user}","gists_url":"https://api.github.com/users/jun-he/gists{/gist_id}","starred_url":"https://api.github.com/users/jun-he/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jun-he/subscriptions","organizations_url":"https://api.github.com/users/jun-he/orgs","repos_url":"https://api.github.com/users/jun-he/repos","events_url":"https://api.github.com/users/jun-he/events{/privacy}","received_events_url":"https://api.github.com/users/jun-he/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T21:32:00Z","updated_at":"2022-03-08T21:32:00Z","author_association":"COLLABORATOR","body":"@rdblue Updated the PR and can you let me know your comments? Thanks.\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062233014/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062258595","html_url":"https://github.com/apache/iceberg/pull/4254#issuecomment-1062258595","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4254","id":1062258595,"node_id":"IC_kwDOCW7NX84_UMej","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T21:59:26Z","updated_at":"2022-03-08T21:59:26Z","author_association":"CONTRIBUTOR","body":"> This is just a convenient way to get metrics to engines that already use Hadoop. I think we all agree that we want to be able to extend this, but it is a reasonable default for now.\r\n\r\nYes, in that case let's first try to add the `MetricsProducer` mixin interface. I agree the catalog-based solution is more like a workaround, let's just implement the right thing.\r\n\r\nIn this model, how would we eventually make this not just a S3FileIO specific implementation?\r\n\r\nI am thinking about something like the following in SparkCatalog\r\n\r\n```java\r\nprivate Pair<Table, Long> load(Identifier ident) {\r\n  ...\r\n  Table table;\r\n  try {\r\n    table = icebergCatalog.loadTable(namespaceAsIdent);\r\n    FileIO io = table.io();\r\n    if (io instanceof MetricsProducer) {\r\n        // Report Hadoop metrics by default, will add logic and option for SparkMetricsContext in the future when that is available\r\n        try {\r\n          DynConstructors.Ctor<MetricsContext> ctor =\r\n              DynConstructors.builder(MetricsContext.class).hiddenImpl(DEFAULT_METRICS_IMPL, String.class).buildChecked();\r\n          // how would scheme be set for ResolvingFileIO? should we take table.location() as input to constructor to derive the scheme?\r\n          MetricsContext metrics = ctor.newInstance(io.scheme());\r\n          metrics.initialize(properties);\r\n        } catch (NoSuchMethodException | ClassCastException e) {\r\n          LOG.warn(\"Unable to load metrics class: '{}', falling back to null metrics\", DEFAULT_METRICS_IMPL, e);\r\n        }\r\n      ((MetricsProducer) io).setMetricsContext(metrics);\r\n    }\r\n  } catch (Exception ignored) {\r\n    // the namespace does not identify a table, so it cannot be a table with a snapshot selector\r\n    // throw the original exception\r\n    throw e;\r\n  }\r\n  ...\r\n}\r\n```\r\n\r\nWould this make sense to you?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062258595/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062480021","html_url":"https://github.com/apache/iceberg/pull/1100#issuecomment-1062480021","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1100","id":1062480021,"node_id":"IC_kwDOCW7NX84_VCiV","user":{"login":"kelly-sm","id":59846011,"node_id":"MDQ6VXNlcjU5ODQ2MDEx","avatar_url":"https://avatars.githubusercontent.com/u/59846011?v=4","gravatar_id":"","url":"https://api.github.com/users/kelly-sm","html_url":"https://github.com/kelly-sm","followers_url":"https://api.github.com/users/kelly-sm/followers","following_url":"https://api.github.com/users/kelly-sm/following{/other_user}","gists_url":"https://api.github.com/users/kelly-sm/gists{/gist_id}","starred_url":"https://api.github.com/users/kelly-sm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kelly-sm/subscriptions","organizations_url":"https://api.github.com/users/kelly-sm/orgs","repos_url":"https://api.github.com/users/kelly-sm/repos","events_url":"https://api.github.com/users/kelly-sm/events{/privacy}","received_events_url":"https://api.github.com/users/kelly-sm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T02:05:27Z","updated_at":"2022-03-09T02:05:27Z","author_association":"NONE","body":"It would be awesome to see a Flink example here as well.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062480021/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062485900","html_url":"https://github.com/apache/iceberg/pull/3810#issuecomment-1062485900","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3810","id":1062485900,"node_id":"IC_kwDOCW7NX84_VD-M","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T02:16:40Z","updated_at":"2022-03-09T02:16:40Z","author_association":"MEMBER","body":"Okay,  I think I get the drawback about the current ORC builder ( which copied the table properties map into hadoop conf and just use the hadoop conf as the source of truth): \r\n\r\n* As @zhongyujiang said, the default value of iceberg standardized settings will be replaced by the hadoop config values.\r\n* Non-standardized iceberg settings which are added in the iceberg table properties will be affected to the underlying ORC readers & writers. \r\n* The standardized iceberg settings will be added to hadoop configuration, which may pollute the hadoop configuration.\r\n\r\nI agree to make another PR to change the ORC configs parser as the @rdblue suggested.\r\n\r\nThanks.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062485900/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062509405","html_url":"https://github.com/apache/iceberg/pull/4285#issuecomment-1062509405","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4285","id":1062509405,"node_id":"IC_kwDOCW7NX84_VJtd","user":{"login":"samredai","id":43911210,"node_id":"MDQ6VXNlcjQzOTExMjEw","avatar_url":"https://avatars.githubusercontent.com/u/43911210?v=4","gravatar_id":"","url":"https://api.github.com/users/samredai","html_url":"https://github.com/samredai","followers_url":"https://api.github.com/users/samredai/followers","following_url":"https://api.github.com/users/samredai/following{/other_user}","gists_url":"https://api.github.com/users/samredai/gists{/gist_id}","starred_url":"https://api.github.com/users/samredai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samredai/subscriptions","organizations_url":"https://api.github.com/users/samredai/orgs","repos_url":"https://api.github.com/users/samredai/repos","events_url":"https://api.github.com/users/samredai/events{/privacy}","received_events_url":"https://api.github.com/users/samredai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T03:08:00Z","updated_at":"2022-03-09T03:08:00Z","author_association":"CONTRIBUTOR","body":"We should also move the `extras_require` in `setup.py` over to `setup.cfg` so that we're not setting package info in two places. This stuff collides easily and causes confusion. We can then just have a barebones `setup.py` and have everything contained in `setup.cfg`:\r\n\r\n*setup.py*\r\n```py\r\nfrom setuptools import setup\r\n\r\nsetup()\r\n```\r\nLet me know what you think.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062509405/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062511152","html_url":"https://github.com/apache/iceberg/pull/2680#issuecomment-1062511152","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2680","id":1062511152,"node_id":"IC_kwDOCW7NX84_VKIw","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T03:11:50Z","updated_at":"2022-03-09T06:40:49Z","author_association":"MEMBER","body":"> For example, we have a TiDB table that has six hundred million records. If we use flink streaming mode, it will cost too much time\r\n\r\n@coolderli  Are you using the latest flink cdc connector and iceberg to export the stream ?  I remember the latest flink cdc connector are refactored to use the netflix [DBLog algorithm](https://netflixtechblog.com/dblog-a-generic-change-data-capture-framework-69351fb9099b) in parallel to export those existing RDBMS records in parallel. So in theory,  if we don't have any performance blocker in the flink->iceberg path.  There should not be any blocker that cost too much time.  What's your bottleneck in your CDC exporting path ?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062511152/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062574756","html_url":"https://github.com/apache/iceberg/issues/4288#issuecomment-1062574756","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4288","id":1062574756,"node_id":"IC_kwDOCW7NX84_VZqk","user":{"login":"singhpk234","id":35593236,"node_id":"MDQ6VXNlcjM1NTkzMjM2","avatar_url":"https://avatars.githubusercontent.com/u/35593236?v=4","gravatar_id":"","url":"https://api.github.com/users/singhpk234","html_url":"https://github.com/singhpk234","followers_url":"https://api.github.com/users/singhpk234/followers","following_url":"https://api.github.com/users/singhpk234/following{/other_user}","gists_url":"https://api.github.com/users/singhpk234/gists{/gist_id}","starred_url":"https://api.github.com/users/singhpk234/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/singhpk234/subscriptions","organizations_url":"https://api.github.com/users/singhpk234/orgs","repos_url":"https://api.github.com/users/singhpk234/repos","events_url":"https://api.github.com/users/singhpk234/events{/privacy}","received_events_url":"https://api.github.com/users/singhpk234/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T05:43:10Z","updated_at":"2022-03-10T13:26:27Z","author_association":"CONTRIBUTOR","body":"As per my understanding we at the time of reading the stream re-initialize the statistics \r\n\r\nhttps://github.com/apache/iceberg/blob/197325f3e31193054ecdd860ac0fbc2af4b64748/core/src/main/java/org/apache/iceberg/hadoop/HadoopMetricsContext.java#L121-L124\r\n\r\nmay be I am missing something here as well.\r\n\r\ncc @danielcweeks ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062574756/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062639550","html_url":"https://github.com/apache/iceberg/issues/2788#issuecomment-1062639550","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2788","id":1062639550,"node_id":"IC_kwDOCW7NX84_Vpe-","user":{"login":"tmnd1991","id":7031242,"node_id":"MDQ6VXNlcjcwMzEyNDI=","avatar_url":"https://avatars.githubusercontent.com/u/7031242?v=4","gravatar_id":"","url":"https://api.github.com/users/tmnd1991","html_url":"https://github.com/tmnd1991","followers_url":"https://api.github.com/users/tmnd1991/followers","following_url":"https://api.github.com/users/tmnd1991/following{/other_user}","gists_url":"https://api.github.com/users/tmnd1991/gists{/gist_id}","starred_url":"https://api.github.com/users/tmnd1991/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tmnd1991/subscriptions","organizations_url":"https://api.github.com/users/tmnd1991/orgs","repos_url":"https://api.github.com/users/tmnd1991/repos","events_url":"https://api.github.com/users/tmnd1991/events{/privacy}","received_events_url":"https://api.github.com/users/tmnd1991/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T07:46:04Z","updated_at":"2022-03-09T07:46:04Z","author_association":"NONE","body":"Hi all, I would love to contribute on this, may I propose a PR only for v2 tables and then we can think about how to go for v1?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062639550/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062707574","html_url":"https://github.com/apache/iceberg/pull/4259#issuecomment-1062707574","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4259","id":1062707574,"node_id":"IC_kwDOCW7NX84_V6F2","user":{"login":"rajarshisarkar","id":4561678,"node_id":"MDQ6VXNlcjQ1NjE2Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/4561678?v=4","gravatar_id":"","url":"https://api.github.com/users/rajarshisarkar","html_url":"https://github.com/rajarshisarkar","followers_url":"https://api.github.com/users/rajarshisarkar/followers","following_url":"https://api.github.com/users/rajarshisarkar/following{/other_user}","gists_url":"https://api.github.com/users/rajarshisarkar/gists{/gist_id}","starred_url":"https://api.github.com/users/rajarshisarkar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rajarshisarkar/subscriptions","organizations_url":"https://api.github.com/users/rajarshisarkar/orgs","repos_url":"https://api.github.com/users/rajarshisarkar/repos","events_url":"https://api.github.com/users/rajarshisarkar/events{/privacy}","received_events_url":"https://api.github.com/users/rajarshisarkar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T09:11:42Z","updated_at":"2022-03-09T12:14:36Z","author_association":"CONTRIBUTOR","body":"I took the idea of parsing the properties beginning with a prefix from https://github.com/apache/iceberg/pull/4011\r\n\r\nRefer method name: `PropertyUtil.propertiesWithPrefix`","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062707574/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062759062","html_url":"https://github.com/apache/iceberg/pull/4267#issuecomment-1062759062","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4267","id":1062759062,"node_id":"IC_kwDOCW7NX84_WGqW","user":{"login":"rajarshisarkar","id":4561678,"node_id":"MDQ6VXNlcjQ1NjE2Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/4561678?v=4","gravatar_id":"","url":"https://api.github.com/users/rajarshisarkar","html_url":"https://github.com/rajarshisarkar","followers_url":"https://api.github.com/users/rajarshisarkar/followers","following_url":"https://api.github.com/users/rajarshisarkar/following{/other_user}","gists_url":"https://api.github.com/users/rajarshisarkar/gists{/gist_id}","starred_url":"https://api.github.com/users/rajarshisarkar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rajarshisarkar/subscriptions","organizations_url":"https://api.github.com/users/rajarshisarkar/orgs","repos_url":"https://api.github.com/users/rajarshisarkar/repos","events_url":"https://api.github.com/users/rajarshisarkar/events{/privacy}","received_events_url":"https://api.github.com/users/rajarshisarkar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T10:10:01Z","updated_at":"2022-03-09T10:10:01Z","author_association":"CONTRIBUTOR","body":"Thanks, for the review @kbendick @danielcweeks @rdblue! \r\n\r\nShould we consider merging this PR (or) wait for https://github.com/apache/iceberg/pull/4254 to be merged to master?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062759062/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062800028","html_url":"https://github.com/apache/iceberg/issues/4217#issuecomment-1062800028","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4217","id":1062800028,"node_id":"IC_kwDOCW7NX84_WQqc","user":{"login":"andrey-mindrin","id":62600799,"node_id":"MDQ6VXNlcjYyNjAwNzk5","avatar_url":"https://avatars.githubusercontent.com/u/62600799?v=4","gravatar_id":"","url":"https://api.github.com/users/andrey-mindrin","html_url":"https://github.com/andrey-mindrin","followers_url":"https://api.github.com/users/andrey-mindrin/followers","following_url":"https://api.github.com/users/andrey-mindrin/following{/other_user}","gists_url":"https://api.github.com/users/andrey-mindrin/gists{/gist_id}","starred_url":"https://api.github.com/users/andrey-mindrin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andrey-mindrin/subscriptions","organizations_url":"https://api.github.com/users/andrey-mindrin/orgs","repos_url":"https://api.github.com/users/andrey-mindrin/repos","events_url":"https://api.github.com/users/andrey-mindrin/events{/privacy}","received_events_url":"https://api.github.com/users/andrey-mindrin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T10:58:02Z","updated_at":"2022-03-09T10:58:02Z","author_association":"NONE","body":"I can confirm that iceberg performance on Spark 3.2 is similar to Hive tables. It seems the problem was in Spark 3.1 only.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062800028/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062830554","html_url":"https://github.com/apache/iceberg/issues/4288#issuecomment-1062830554","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4288","id":1062830554,"node_id":"IC_kwDOCW7NX84_WYHa","user":{"login":"igorcalabria","id":2111602,"node_id":"MDQ6VXNlcjIxMTE2MDI=","avatar_url":"https://avatars.githubusercontent.com/u/2111602?v=4","gravatar_id":"","url":"https://api.github.com/users/igorcalabria","html_url":"https://github.com/igorcalabria","followers_url":"https://api.github.com/users/igorcalabria/followers","following_url":"https://api.github.com/users/igorcalabria/following{/other_user}","gists_url":"https://api.github.com/users/igorcalabria/gists{/gist_id}","starred_url":"https://api.github.com/users/igorcalabria/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/igorcalabria/subscriptions","organizations_url":"https://api.github.com/users/igorcalabria/orgs","repos_url":"https://api.github.com/users/igorcalabria/repos","events_url":"https://api.github.com/users/igorcalabria/events{/privacy}","received_events_url":"https://api.github.com/users/igorcalabria/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T11:36:17Z","updated_at":"2022-03-09T11:36:17Z","author_association":"NONE","body":"I don't think `readObject` is called when using `KyroSerializer`. \r\n\r\nYou can test this using a local standalone cluster:\r\n`./bin/spark-shell --master spark://localhost:7077 --conf spark.serializer=org.apache.spark.serializer.KryoSerializer --repositories https://repository.apache.org/content/repositories/snapshots  --packages org.apache.iceberg:iceberg-spark-runtime-3.2_2.12:0.13.0-SNAPSHOT`\r\n\r\n```scala\r\nimport org.apache.iceberg.hadoop.HadoopMetricsContext\r\nimport org.apache.iceberg.io.FileIOMetricsContext\r\nimport org.apache.iceberg.metrics.MetricsContext\r\n\r\nval metricsContext = new HadoopMetricsContext(\"s3\")\r\n\r\nmetricsContext.initialize(new java.util.HashMap[String, String]())\r\nmetricsContext.counter(FileIOMetricsContext.WRITE_BYTES, classOf[java.lang.Long], MetricsContext.Unit.BYTES) // WORKS\r\nval broadcastContext =  spark.sparkContext.broadcast(metricsContext)\r\nval data = Seq((\"Thing\"))\r\nval rdd = spark.sparkContext.parallelize(data)\r\nrdd.map { row => \r\n    broadcastContext.value.counter(FileIOMetricsContext.WRITE_BYTES, classOf[java.lang.Long], MetricsContext.Unit.BYTES).increment() // NULLPOINTER\r\n}.collect()\r\n```\r\nWithout kyro, previous snippet works fine. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062830554/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062844207","html_url":"https://github.com/apache/iceberg/issues/4288#issuecomment-1062844207","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4288","id":1062844207,"node_id":"IC_kwDOCW7NX84_Wbcv","user":{"login":"singhpk234","id":35593236,"node_id":"MDQ6VXNlcjM1NTkzMjM2","avatar_url":"https://avatars.githubusercontent.com/u/35593236?v=4","gravatar_id":"","url":"https://api.github.com/users/singhpk234","html_url":"https://github.com/singhpk234","followers_url":"https://api.github.com/users/singhpk234/followers","following_url":"https://api.github.com/users/singhpk234/following{/other_user}","gists_url":"https://api.github.com/users/singhpk234/gists{/gist_id}","starred_url":"https://api.github.com/users/singhpk234/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/singhpk234/subscriptions","organizations_url":"https://api.github.com/users/singhpk234/orgs","repos_url":"https://api.github.com/users/singhpk234/repos","events_url":"https://api.github.com/users/singhpk234/events{/privacy}","received_events_url":"https://api.github.com/users/singhpk234/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T11:53:56Z","updated_at":"2022-03-09T11:57:56Z","author_association":"CONTRIBUTOR","body":"yup I think you are right as per this [SparkCodePointer](https://github.com/apache/spark/blob/master/core%2Fsrc%2Fmain%2Fscala%2Forg%2Fapache%2Fspark%2Fserializer%2FKryoSerializer.scala#L398-L411)\r\n\r\n```scala\r\n  override def deserialize[T: ClassTag](bytes: ByteBuffer): T = {\r\n    val kryo = borrowKryo()\r\n    try {\r\n      if (bytes.hasArray) {\r\n        input.setBuffer(bytes.array(), bytes.arrayOffset() + bytes.position(), bytes.remaining())\r\n      } else {\r\n        input.setBuffer(new Array[Byte](4096))\r\n        input.setInputStream(new ByteBufferInputStream(bytes))\r\n      }\r\n      kryo.readClassAndObject(input).asInstanceOf[T]\r\n    } finally {\r\n      releaseKryo(kryo)\r\n    }\r\n  }\r\n```\r\n\r\nkryo is using it's own readClassAndObject rather than readObject, whereas JavaSerializer uses readObject ([CodePointer1](https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/serializer/JavaSerializer.scala#L123), [CodePointer2](https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/serializer/JavaSerializer.scala#L87)).\r\n\r\nI beleive this could explain the NPE","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062844207/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062990591","html_url":"https://github.com/apache/iceberg/issues/644#issuecomment-1062990591","issue_url":"https://api.github.com/repos/apache/iceberg/issues/644","id":1062990591,"node_id":"IC_kwDOCW7NX84_W_L_","user":{"login":"melin","id":1145830,"node_id":"MDQ6VXNlcjExNDU4MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1145830?v=4","gravatar_id":"","url":"https://api.github.com/users/melin","html_url":"https://github.com/melin","followers_url":"https://api.github.com/users/melin/followers","following_url":"https://api.github.com/users/melin/following{/other_user}","gists_url":"https://api.github.com/users/melin/gists{/gist_id}","starred_url":"https://api.github.com/users/melin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/melin/subscriptions","organizations_url":"https://api.github.com/users/melin/orgs","repos_url":"https://api.github.com/users/melin/repos","events_url":"https://api.github.com/users/melin/events{/privacy}","received_events_url":"https://api.github.com/users/melin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T14:40:45Z","updated_at":"2022-03-09T14:43:34Z","author_association":"NONE","body":"> Great! The first step is to get ViewCatalog API into Spark.\r\nspark catalog view: https://github.com/apache/spark/pull/35636\r\nvery interested in view.  can provide iceberg patch code？ thanks\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1062990591/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063261715","html_url":"https://github.com/apache/iceberg/issues/3217#issuecomment-1063261715","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3217","id":1063261715,"node_id":"IC_kwDOCW7NX84_YBYT","user":{"login":"samredai","id":43911210,"node_id":"MDQ6VXNlcjQzOTExMjEw","avatar_url":"https://avatars.githubusercontent.com/u/43911210?v=4","gravatar_id":"","url":"https://api.github.com/users/samredai","html_url":"https://github.com/samredai","followers_url":"https://api.github.com/users/samredai/followers","following_url":"https://api.github.com/users/samredai/following{/other_user}","gists_url":"https://api.github.com/users/samredai/gists{/gist_id}","starred_url":"https://api.github.com/users/samredai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/samredai/subscriptions","organizations_url":"https://api.github.com/users/samredai/orgs","repos_url":"https://api.github.com/users/samredai/repos","events_url":"https://api.github.com/users/samredai/events{/privacy}","received_events_url":"https://api.github.com/users/samredai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T19:06:47Z","updated_at":"2022-03-09T19:07:39Z","author_association":"CONTRIBUTOR","body":"PR activity around expressions is picking up so I wanted to provide some ordering in terms of dependency that should be helpful. My understanding is this is the order that things need to be implemented (where 2 depends on 1, 3 depends on 2, etc...):\r\n\r\n1. Conversions (PR #4263)\r\n2. Literals (PR #4262)\r\n3. Operations\r\n4. Parsers\r\n5. Terms\r\n6. References\r\n7. Predicates\r\n8. Expression visitors\r\n9. Binders\r\n\r\n@jun-he can you re-order the list in the description?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063261715/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063271746","html_url":"https://github.com/apache/iceberg/pull/4301#issuecomment-1063271746","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4301","id":1063271746,"node_id":"IC_kwDOCW7NX84_YD1C","user":{"login":"wmoustafa","id":10084105,"node_id":"MDQ6VXNlcjEwMDg0MTA1","avatar_url":"https://avatars.githubusercontent.com/u/10084105?v=4","gravatar_id":"","url":"https://api.github.com/users/wmoustafa","html_url":"https://github.com/wmoustafa","followers_url":"https://api.github.com/users/wmoustafa/followers","following_url":"https://api.github.com/users/wmoustafa/following{/other_user}","gists_url":"https://api.github.com/users/wmoustafa/gists{/gist_id}","starred_url":"https://api.github.com/users/wmoustafa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wmoustafa/subscriptions","organizations_url":"https://api.github.com/users/wmoustafa/orgs","repos_url":"https://api.github.com/users/wmoustafa/repos","events_url":"https://api.github.com/users/wmoustafa/events{/privacy}","received_events_url":"https://api.github.com/users/wmoustafa/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T19:18:49Z","updated_at":"2022-03-09T19:18:49Z","author_association":"CONTRIBUTOR","body":"Could you please update the PR description to give a high level description of the changes introduced in this PR (e.g., the fact that it updates the documentation to describe the default value spec, and which aspects of the spec are covered)?\r\n@rdblue @RussellSpitzer ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063271746/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063280910","html_url":"https://github.com/apache/iceberg/pull/4293#issuecomment-1063280910","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4293","id":1063280910,"node_id":"IC_kwDOCW7NX84_YGEO","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T19:28:41Z","updated_at":"2022-03-09T19:28:41Z","author_association":"CONTRIBUTOR","body":"Let me take a look. Sorry for the delay.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063280910/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063293895","html_url":"https://github.com/apache/iceberg/pull/4242#issuecomment-1063293895","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4242","id":1063293895,"node_id":"IC_kwDOCW7NX84_YJPH","user":{"login":"wmoustafa","id":10084105,"node_id":"MDQ6VXNlcjEwMDg0MTA1","avatar_url":"https://avatars.githubusercontent.com/u/10084105?v=4","gravatar_id":"","url":"https://api.github.com/users/wmoustafa","html_url":"https://github.com/wmoustafa","followers_url":"https://api.github.com/users/wmoustafa/followers","following_url":"https://api.github.com/users/wmoustafa/following{/other_user}","gists_url":"https://api.github.com/users/wmoustafa/gists{/gist_id}","starred_url":"https://api.github.com/users/wmoustafa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wmoustafa/subscriptions","organizations_url":"https://api.github.com/users/wmoustafa/orgs","repos_url":"https://api.github.com/users/wmoustafa/repos","events_url":"https://api.github.com/users/wmoustafa/events{/privacy}","received_events_url":"https://api.github.com/users/wmoustafa/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T19:44:19Z","updated_at":"2022-03-09T19:44:19Z","author_association":"CONTRIBUTOR","body":"FYI @rdblue @RussellSpitzer ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063293895/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063369799","html_url":"https://github.com/apache/iceberg/pull/4293#issuecomment-1063369799","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4293","id":1063369799,"node_id":"IC_kwDOCW7NX84_YbxH","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T21:04:56Z","updated_at":"2022-03-09T21:04:56Z","author_association":"CONTRIBUTOR","body":"> One observation, DF.overwrite(filter) will be less aggressive than DF.overwritePartitions() in concurrent validation due to the two different API code paths. OverwriteFiles checks exactly for the file that will be re-written, so it will not throw an exception if another file was deleted in the same partition. This is unlike ReplacePartitions API which throws exception if any file was deleted in the same partition, as it does not keep track of files but rather whole partitions.\r\n\r\nThat's a bug. Let me fix it.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063369799/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063378619","html_url":"https://github.com/apache/iceberg/pull/4279#issuecomment-1063378619","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4279","id":1063378619,"node_id":"IC_kwDOCW7NX84_Yd67","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T21:16:40Z","updated_at":"2022-03-09T21:16:40Z","author_association":"MEMBER","body":"Thanks everyone for the reviews! I'll work on the V2 issue in another PR","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063378619/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063379903","html_url":"https://github.com/apache/iceberg/pull/4303#issuecomment-1063379903","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4303","id":1063379903,"node_id":"IC_kwDOCW7NX84_YeO_","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T21:17:58Z","updated_at":"2022-03-09T21:17:58Z","author_association":"CONTRIBUTOR","body":"@rdblue @szehon-ho @RussellSpitzer, could you take a look?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063379903/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063418921","html_url":"https://github.com/apache/iceberg/pull/4303#issuecomment-1063418921","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4303","id":1063418921,"node_id":"IC_kwDOCW7NX84_Ynwp","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T22:04:10Z","updated_at":"2022-03-09T22:04:10Z","author_association":"COLLABORATOR","body":"+1 from me too, glad we found and fixed it!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063418921/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063421558","html_url":"https://github.com/apache/iceberg/pull/4303#issuecomment-1063421558","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4303","id":1063421558,"node_id":"IC_kwDOCW7NX84_YoZ2","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T22:07:39Z","updated_at":"2022-03-09T22:07:39Z","author_association":"CONTRIBUTOR","body":"Thanks, @RussellSpitzer @szehon-ho! Merged to unblock Szehon's PR.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063421558/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063427863","html_url":"https://github.com/apache/iceberg/pull/4296#issuecomment-1063427863","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4296","id":1063427863,"node_id":"IC_kwDOCW7NX84_Yp8X","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T22:17:09Z","updated_at":"2022-03-09T22:17:09Z","author_association":"MEMBER","body":"I don't see the checkstyle rule change but the method changes look good to me","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063427863/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063456294","html_url":"https://github.com/apache/iceberg/pull/4285#issuecomment-1063456294","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4285","id":1063456294,"node_id":"IC_kwDOCW7NX84_Yw4m","user":{"login":"Fokko","id":1134248,"node_id":"MDQ6VXNlcjExMzQyNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1134248?v=4","gravatar_id":"","url":"https://api.github.com/users/Fokko","html_url":"https://github.com/Fokko","followers_url":"https://api.github.com/users/Fokko/followers","following_url":"https://api.github.com/users/Fokko/following{/other_user}","gists_url":"https://api.github.com/users/Fokko/gists{/gist_id}","starred_url":"https://api.github.com/users/Fokko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Fokko/subscriptions","organizations_url":"https://api.github.com/users/Fokko/orgs","repos_url":"https://api.github.com/users/Fokko/repos","events_url":"https://api.github.com/users/Fokko/events{/privacy}","received_events_url":"https://api.github.com/users/Fokko/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T22:46:47Z","updated_at":"2022-03-09T22:46:47Z","author_association":"CONTRIBUTOR","body":"Hey @samredai thanks for the feedback. I think we can remove the `setup.py` all together. Less is more :)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063456294/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063479055","html_url":"https://github.com/apache/iceberg/issues/4302#issuecomment-1063479055","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4302","id":1063479055,"node_id":"IC_kwDOCW7NX84_Y2cP","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T23:22:49Z","updated_at":"2022-03-09T23:22:49Z","author_association":"MEMBER","body":"Ok I totally forgot I fixed this already here\r\n\r\nhttps://github.com/apache/iceberg/blob/d6cbca0c2fb3d10083b304bcbdf16bf51e3b586b/spark/v3.2/spark/src/main/java/org/apache/iceberg/spark/actions/BaseRewriteDataFilesSparkAction.java#L190-L195\r\n\r\nIt looks like this is only an issue for the older code here\r\n\r\nhttps://github.com/apache/iceberg/blob/c6e68d832113266994c0eb06d342e032fc9cbca3/core/src/main/java/org/apache/iceberg/actions/BaseRewriteDataFilesAction.java#L258-L270\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063479055/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063486390","html_url":"https://github.com/apache/iceberg/pull/4052#issuecomment-1063486390","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4052","id":1063486390,"node_id":"IC_kwDOCW7NX84_Y4O2","user":{"login":"amogh-jahagirdar","id":87500546,"node_id":"MDQ6VXNlcjg3NTAwNTQ2","avatar_url":"https://avatars.githubusercontent.com/u/87500546?v=4","gravatar_id":"","url":"https://api.github.com/users/amogh-jahagirdar","html_url":"https://github.com/amogh-jahagirdar","followers_url":"https://api.github.com/users/amogh-jahagirdar/followers","following_url":"https://api.github.com/users/amogh-jahagirdar/following{/other_user}","gists_url":"https://api.github.com/users/amogh-jahagirdar/gists{/gist_id}","starred_url":"https://api.github.com/users/amogh-jahagirdar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amogh-jahagirdar/subscriptions","organizations_url":"https://api.github.com/users/amogh-jahagirdar/orgs","repos_url":"https://api.github.com/users/amogh-jahagirdar/repos","events_url":"https://api.github.com/users/amogh-jahagirdar/events{/privacy}","received_events_url":"https://api.github.com/users/amogh-jahagirdar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T23:34:57Z","updated_at":"2022-03-09T23:34:57Z","author_association":"CONTRIBUTOR","body":"@rdblue @danielcweeks @jackye1995 Sorry for the delay, I've updated the PR. Some fundamental changes from before:\r\n\r\n1.) No deleteFiles on FileIO. \r\n\r\n2.) public BulkOperation interface which is currently only implemented for S3FileIO. batch deletion exception are only for the S3 case (package private). \r\n\r\nIt does make it a bit cumbersome when we want to do batch deletion in removing orphan files, because we would have to do instanceOf check. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063486390/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063488197","html_url":"https://github.com/apache/iceberg/pull/3411#issuecomment-1063488197","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3411","id":1063488197,"node_id":"IC_kwDOCW7NX84_Y4rF","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T23:38:38Z","updated_at":"2022-03-09T23:38:38Z","author_association":"CONTRIBUTOR","body":"@ConeyLiu, can you update the description? It is really helpful to not only say what you're trying to fix, but also to describe the approach and why the changes are needed. Thanks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063488197/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063512029","html_url":"https://github.com/apache/iceberg/pull/2496#issuecomment-1063512029","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2496","id":1063512029,"node_id":"IC_kwDOCW7NX84_Y-fd","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T00:13:58Z","updated_at":"2022-03-10T00:13:58Z","author_association":"CONTRIBUTOR","body":"Closing this in favor of #4301.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063512029/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063569280","html_url":"https://github.com/apache/iceberg/pull/4293#issuecomment-1063569280","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4293","id":1063569280,"node_id":"IC_kwDOCW7NX84_ZMeA","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T01:46:59Z","updated_at":"2022-03-10T01:46:59Z","author_association":"COLLABORATOR","body":"@aokolnychyi thanks, will create another pr soon for the refactoring/cleanup of existing code to be consistent with this one.\r\n\r\nAdded another test for deleted data files after fix of #3581 , works now.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063569280/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063586068","html_url":"https://github.com/apache/iceberg/pull/4291#issuecomment-1063586068","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4291","id":1063586068,"node_id":"IC_kwDOCW7NX84_ZQkU","user":{"login":"hililiwei","id":59213263,"node_id":"MDQ6VXNlcjU5MjEzMjYz","avatar_url":"https://avatars.githubusercontent.com/u/59213263?v=4","gravatar_id":"","url":"https://api.github.com/users/hililiwei","html_url":"https://github.com/hililiwei","followers_url":"https://api.github.com/users/hililiwei/followers","following_url":"https://api.github.com/users/hililiwei/following{/other_user}","gists_url":"https://api.github.com/users/hililiwei/gists{/gist_id}","starred_url":"https://api.github.com/users/hililiwei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hililiwei/subscriptions","organizations_url":"https://api.github.com/users/hililiwei/orgs","repos_url":"https://api.github.com/users/hililiwei/repos","events_url":"https://api.github.com/users/hililiwei/events{/privacy}","received_events_url":"https://api.github.com/users/hililiwei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T02:22:11Z","updated_at":"2022-03-10T02:22:11Z","author_association":"CONTRIBUTOR","body":"cc @rdblue @openinx @zhongyujiang ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063586068/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063598748","html_url":"https://github.com/apache/iceberg/issues/4299#issuecomment-1063598748","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4299","id":1063598748,"node_id":"IC_kwDOCW7NX84_ZTqc","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T02:51:04Z","updated_at":"2022-03-10T02:51:04Z","author_association":"MEMBER","body":"@sap1ens The correct link is here: https://repo.maven.apache.org/maven2/org/apache/iceberg/iceberg-flink-1.14/\r\n\r\nSince iceberg 0.13.0,  we supported multiple flink versions in one iceberg branches. So we add the flink version suffix for the deployed artifacts.\r\n\r\nI will close this issue,  feel free to reopen it if any further question.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063598748/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063642306","html_url":"https://github.com/apache/iceberg/issues/4299#issuecomment-1063642306","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4299","id":1063642306,"node_id":"IC_kwDOCW7NX84_ZeTC","user":{"login":"sap1ens","id":260702,"node_id":"MDQ6VXNlcjI2MDcwMg==","avatar_url":"https://avatars.githubusercontent.com/u/260702?v=4","gravatar_id":"","url":"https://api.github.com/users/sap1ens","html_url":"https://github.com/sap1ens","followers_url":"https://api.github.com/users/sap1ens/followers","following_url":"https://api.github.com/users/sap1ens/following{/other_user}","gists_url":"https://api.github.com/users/sap1ens/gists{/gist_id}","starred_url":"https://api.github.com/users/sap1ens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sap1ens/subscriptions","organizations_url":"https://api.github.com/users/sap1ens/orgs","repos_url":"https://api.github.com/users/sap1ens/repos","events_url":"https://api.github.com/users/sap1ens/events{/privacy}","received_events_url":"https://api.github.com/users/sap1ens/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T04:05:10Z","updated_at":"2022-03-10T04:05:10Z","author_association":"NONE","body":"Ah, got it! Thanks for explaining. I guess [this page](https://iceberg.apache.org/docs/latest/flink/) needs to be updated (it still uses the URL I shared).","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063642306/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063718996","html_url":"https://github.com/apache/iceberg/pull/4293#issuecomment-1063718996","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4293","id":1063718996,"node_id":"IC_kwDOCW7NX84_ZxBU","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T06:47:46Z","updated_at":"2022-03-10T06:47:46Z","author_association":"COLLABORATOR","body":"Restarting as it looks like a temporary build artifact download failure","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1063718996/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064203828","html_url":"https://github.com/apache/iceberg/pull/4165#issuecomment-1064203828","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4165","id":1064203828,"node_id":"IC_kwDOCW7NX84_bnY0","user":{"login":"XN137","id":1204398,"node_id":"MDQ6VXNlcjEyMDQzOTg=","avatar_url":"https://avatars.githubusercontent.com/u/1204398?v=4","gravatar_id":"","url":"https://api.github.com/users/XN137","html_url":"https://github.com/XN137","followers_url":"https://api.github.com/users/XN137/followers","following_url":"https://api.github.com/users/XN137/following{/other_user}","gists_url":"https://api.github.com/users/XN137/gists{/gist_id}","starred_url":"https://api.github.com/users/XN137/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/XN137/subscriptions","organizations_url":"https://api.github.com/users/XN137/orgs","repos_url":"https://api.github.com/users/XN137/repos","events_url":"https://api.github.com/users/XN137/events{/privacy}","received_events_url":"https://api.github.com/users/XN137/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T15:47:25Z","updated_at":"2022-03-10T15:47:25Z","author_association":"CONTRIBUTOR","body":"rebased due to merge conflict","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064203828/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064323406","html_url":"https://github.com/apache/iceberg/issues/3941#issuecomment-1064323406","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3941","id":1064323406,"node_id":"IC_kwDOCW7NX84_cElO","user":{"login":"dharamsahoo","id":86925723,"node_id":"MDQ6VXNlcjg2OTI1NzIz","avatar_url":"https://avatars.githubusercontent.com/u/86925723?v=4","gravatar_id":"","url":"https://api.github.com/users/dharamsahoo","html_url":"https://github.com/dharamsahoo","followers_url":"https://api.github.com/users/dharamsahoo/followers","following_url":"https://api.github.com/users/dharamsahoo/following{/other_user}","gists_url":"https://api.github.com/users/dharamsahoo/gists{/gist_id}","starred_url":"https://api.github.com/users/dharamsahoo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dharamsahoo/subscriptions","organizations_url":"https://api.github.com/users/dharamsahoo/orgs","repos_url":"https://api.github.com/users/dharamsahoo/repos","events_url":"https://api.github.com/users/dharamsahoo/events{/privacy}","received_events_url":"https://api.github.com/users/dharamsahoo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T17:37:36Z","updated_at":"2022-03-10T17:37:36Z","author_association":"NONE","body":"Hi @aokolnychyi , thanks for the well illustrated writeup. I have a few comments related to the assumptions.\r\n\r\n> Output only delete and insert record types\r\n\r\nSome consumers might want to directly consume the CDC records and generate events/notifications. It would be useful for such consumers to have CDC records relate to the actual operation on Iceberg table record. So having an Update record type would help to segregate it from Insert and Delete records in more convenient way.\r\n\r\n> Delete records may only include values for identity columns\r\n\r\nFor consumers wanting to generate notifications which include old & new values like sending email for customer preference update OR generate events when an attribute value crosses a threshold, the inclusion of non-identity column(s) in the Delete record (related to an Update operation on Iceberg table) will be very useful.\r\n\r\nAlso, I noticed that in example 2 above, CDC records are generated for unchanged records (id=106). For Copy-On-Write tables, would this be the behaviour of CDC? If so, for snapshots where a small fraction of records are added/modified, there would be too many CDC records.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064323406/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064364071","html_url":"https://github.com/apache/iceberg/pull/4243#issuecomment-1064364071","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4243","id":1064364071,"node_id":"IC_kwDOCW7NX84_cOgn","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T18:26:08Z","updated_at":"2022-03-10T18:26:08Z","author_association":"COLLABORATOR","body":"Thanks for taking a look @aokolnychyi , changed to address comments ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064364071/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064384862","html_url":"https://github.com/apache/iceberg/pull/4255#issuecomment-1064384862","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4255","id":1064384862,"node_id":"IC_kwDOCW7NX84_cTle","user":{"login":"wypoon","id":3925490,"node_id":"MDQ6VXNlcjM5MjU0OTA=","avatar_url":"https://avatars.githubusercontent.com/u/3925490?v=4","gravatar_id":"","url":"https://api.github.com/users/wypoon","html_url":"https://github.com/wypoon","followers_url":"https://api.github.com/users/wypoon/followers","following_url":"https://api.github.com/users/wypoon/following{/other_user}","gists_url":"https://api.github.com/users/wypoon/gists{/gist_id}","starred_url":"https://api.github.com/users/wypoon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wypoon/subscriptions","organizations_url":"https://api.github.com/users/wypoon/orgs","repos_url":"https://api.github.com/users/wypoon/repos","events_url":"https://api.github.com/users/wypoon/events{/privacy}","received_events_url":"https://api.github.com/users/wypoon/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T18:51:48Z","updated_at":"2022-03-10T18:51:48Z","author_association":"CONTRIBUTOR","body":"@RussellSpitzer @kbendick mind reviewing this again? I have updated the text and rebased on master (after Sam Redai's reorg of docs). I hope it can be merged now.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064384862/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064425881","html_url":"https://github.com/apache/iceberg/issues/4288#issuecomment-1064425881","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4288","id":1064425881,"node_id":"IC_kwDOCW7NX84_cdmZ","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T19:41:30Z","updated_at":"2022-03-10T19:41:30Z","author_association":"CONTRIBUTOR","body":"at first glance my solution would be similar to the solution we use to handle S3 client serialization in S3FileIO, which is to store a function like\r\n\r\n```\r\nSerializableSupplier<FileSystem.Statistics> statsticsSupplier = () -> FileSystem.getStatistics(scheme, null);\r\n```\r\n\r\nand initialize the transient variable at the first invocation\r\n\r\n@singhpk234 let me know if you would like to take this issue","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064425881/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064427983","html_url":"https://github.com/apache/iceberg/issues/4288#issuecomment-1064427983","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4288","id":1064427983,"node_id":"IC_kwDOCW7NX84_ceHP","user":{"login":"singhpk234","id":35593236,"node_id":"MDQ6VXNlcjM1NTkzMjM2","avatar_url":"https://avatars.githubusercontent.com/u/35593236?v=4","gravatar_id":"","url":"https://api.github.com/users/singhpk234","html_url":"https://github.com/singhpk234","followers_url":"https://api.github.com/users/singhpk234/followers","following_url":"https://api.github.com/users/singhpk234/following{/other_user}","gists_url":"https://api.github.com/users/singhpk234/gists{/gist_id}","starred_url":"https://api.github.com/users/singhpk234/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/singhpk234/subscriptions","organizations_url":"https://api.github.com/users/singhpk234/orgs","repos_url":"https://api.github.com/users/singhpk234/repos","events_url":"https://api.github.com/users/singhpk234/events{/privacy}","received_events_url":"https://api.github.com/users/singhpk234/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T19:44:15Z","updated_at":"2022-03-10T19:44:15Z","author_association":"CONTRIBUTOR","body":"Thanks @jackye1995, I will pick this up.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064427983/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064472790","html_url":"https://github.com/apache/iceberg/pull/3681#issuecomment-1064472790","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3681","id":1064472790,"node_id":"IC_kwDOCW7NX84_cpDW","user":{"login":"stevenzwu","id":1545663,"node_id":"MDQ6VXNlcjE1NDU2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1545663?v=4","gravatar_id":"","url":"https://api.github.com/users/stevenzwu","html_url":"https://github.com/stevenzwu","followers_url":"https://api.github.com/users/stevenzwu/followers","following_url":"https://api.github.com/users/stevenzwu/following{/other_user}","gists_url":"https://api.github.com/users/stevenzwu/gists{/gist_id}","starred_url":"https://api.github.com/users/stevenzwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevenzwu/subscriptions","organizations_url":"https://api.github.com/users/stevenzwu/orgs","repos_url":"https://api.github.com/users/stevenzwu/repos","events_url":"https://api.github.com/users/stevenzwu/events{/privacy}","received_events_url":"https://api.github.com/users/stevenzwu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T20:26:37Z","updated_at":"2022-03-10T20:27:29Z","author_association":"CONTRIBUTOR","body":"> I have another concern about this change: should we bind the watermark strategy within the table metadata? I prefer binding it with the job instead of the table.\r\n\r\n+1 on @yittg 's suggestion. Different jobs may want to set the watermark differently.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064472790/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064489534","html_url":"https://github.com/apache/iceberg/pull/4308#issuecomment-1064489534","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4308","id":1064489534,"node_id":"IC_kwDOCW7NX84_ctI-","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T20:48:17Z","updated_at":"2022-03-10T20:48:17Z","author_association":"CONTRIBUTOR","body":"Can we limit this PR to only event parsers? The purpose is to breakdown the draft, not republish it","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064489534/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064596725","html_url":"https://github.com/apache/iceberg/issues/3941#issuecomment-1064596725","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3941","id":1064596725,"node_id":"IC_kwDOCW7NX84_dHT1","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T23:04:27Z","updated_at":"2022-03-11T00:20:10Z","author_association":"CONTRIBUTOR","body":"> So having an Update record type would help to segregate it from Insert and Delete records in more convenient way.\r\n\r\nThe problem right now is that there is no update in Iceberg. There are only inserts and deletes. An update is represented as a delete followed by an insert. That being said, there may be a way to construct an update record given delete and insert records. For example, we can shuffle the delete/insert records so that all record types for the same identity columns are next to each other. \r\n\r\n```\r\ndelete, s1, 100, null\r\ninsert, s1, 100, 1\r\n```\r\n\r\nIn this case, we can construct a post update image. I am not sure how we can construct a pre update image without joining the delete record with the target table (that's going to be expensive). We can do that more or less efficiently for position deletes and copy-on-write but equality deletes may include only values for identity columns. We will have to scan a lot of data to reconstruct a pre update image for equality deletes.\r\n\r\nThis would only work if the identity columns are not modified.\r\n\r\n> Also, I noticed that in example 2 above, CDC records are generated for unchanged records (id=106). For Copy-On-Write tables, would this be the behaviour of CDC?\r\n\r\nThis one is a little bit easier. To start with, we can report unchanged rows as it is exactly what happens in the table. Whenever we rewrite a file in copy-on-write, we delete all rows from that file and add new records where some records can be simply copied over. In the future, we can use the above idea and co-locate entries for the same identity columns. Then we can remove pairs where a record is deleted and added without any changes. This won't require any joins with the target table so won't be that expensive. Maybe, the action can have an option to perform this deduplication. That way, rows that were copied over in copy-on-write won't be part of the output.\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064596725/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064599459","html_url":"https://github.com/apache/iceberg/issues/3941#issuecomment-1064599459","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3941","id":1064599459,"node_id":"IC_kwDOCW7NX84_dH-j","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T23:08:29Z","updated_at":"2022-03-10T23:08:29Z","author_association":"CONTRIBUTOR","body":"The algorithm above is not complete and does not cover some edge cases. However, I think it makes sense to explore it and check if we can modify/extend it to cover more use cases.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064599459/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064599588","html_url":"https://github.com/apache/iceberg/pull/4310#issuecomment-1064599588","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4310","id":1064599588,"node_id":"IC_kwDOCW7NX84_dIAk","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T23:08:45Z","updated_at":"2022-03-10T23:08:45Z","author_association":"COLLABORATOR","body":"@aokolnychyi fyi","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064599588/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064655110","html_url":"https://github.com/apache/iceberg/issues/3295#issuecomment-1064655110","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3295","id":1064655110,"node_id":"IC_kwDOCW7NX84_dVkG","user":{"login":"1ambda","id":4968473,"node_id":"MDQ6VXNlcjQ5Njg0NzM=","avatar_url":"https://avatars.githubusercontent.com/u/4968473?v=4","gravatar_id":"","url":"https://api.github.com/users/1ambda","html_url":"https://github.com/1ambda","followers_url":"https://api.github.com/users/1ambda/followers","following_url":"https://api.github.com/users/1ambda/following{/other_user}","gists_url":"https://api.github.com/users/1ambda/gists{/gist_id}","starred_url":"https://api.github.com/users/1ambda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/1ambda/subscriptions","organizations_url":"https://api.github.com/users/1ambda/orgs","repos_url":"https://api.github.com/users/1ambda/repos","events_url":"https://api.github.com/users/1ambda/events{/privacy}","received_events_url":"https://api.github.com/users/1ambda/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T00:37:49Z","updated_at":"2022-03-11T00:37:49Z","author_association":"MEMBER","body":"Still having the same problem with Spark 3.2.1 / Iceberg 0.13.1 (table created from PrestoDB 0.270 Iceberg 0.12)\r\n\r\n```python\r\n\r\nPy4JJavaError: An error occurred while calling o191.showString.\r\n: org.apache.spark.SparkException: Job aborted due to stage failure: Task 0 in stage 3.0 failed 4 times, most recent failure: Lost task 0.3 in stage 3.0 (TID 13) (10.3.38.211 executor 1): java.lang.ClassCastException: [B cannot be cast to org.apache.spark.unsafe.types.UTF8String\r\n\tat org.apache.spark.sql.catalyst.expressions.BaseGenericInternalRow.getUTF8String(rows.scala:46)\r\n\tat org.apache.spark.sql.catalyst.expressions.BaseGenericInternalRow.getUTF8String$(rows.scala:46)\r\n\tat org.apache.spark.sql.catalyst.expressions.GenericInternalRow.getUTF8String(rows.scala:195)\r\n\tat org.apache.spark.sql.catalyst.expressions.GeneratedClass$GeneratedIteratorForCodegenStage1.processNext(Unknown Source)\r\n\tat org.apache.spark.sql.execution.BufferedRowIterator.hasNext(BufferedRowIterator.java:43)\r\n\tat org.apache.spark.sql.execution.WholeStageCodegenExec$$anon$1.hasNext(WholeStageCodegenExec.scala:759)\r\n\tat org.apache.spark.sql.execution.SparkPlan.$anonfun$getByteArrayRdd$1(SparkPlan.scala:349)\r\n\tat org.apache.spark.rdd.RDD.$anonfun$mapPartitionsInternal$2(RDD.scala:898)\r\n\tat org.apache.spark.rdd.RDD.$anonfun$mapPartitionsInternal$2$adapted(RDD.scala:898)\r\n\tat org.apache.spark.rdd.MapPartitionsRDD.compute(MapPartitionsRDD.scala:52)\r\n\tat org.apache.spark.rdd.RDD.computeOrReadCheckpoint(RDD.scala:373)\r\n\tat org.apache.spark.rdd.RDD.iterator(RDD.scala:337)\r\n\tat org.apache.spark.scheduler.ResultTask.runTask(ResultTask.scala:90)\r\n\tat org.apache.spark.scheduler.Task.run(Task.scala:131)\r\n\tat org.apache.spark.executor.Executor$TaskRunner.$anonfun$run$3(Executor.scala:506)\r\n\tat org.apache.spark.util.Utils$.tryWithSafeFinally(Utils.scala:1462)\r\n\tat org.apache.spark.executor.Executor$TaskRunner.run(Executor.scala:509)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\r\n\tat java.lang.Thread.run(Thread.java:748)\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064655110/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064688444","html_url":"https://github.com/apache/iceberg/pull/3784#issuecomment-1064688444","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3784","id":1064688444,"node_id":"IC_kwDOCW7NX84_dds8","user":{"login":"hililiwei","id":59213263,"node_id":"MDQ6VXNlcjU5MjEzMjYz","avatar_url":"https://avatars.githubusercontent.com/u/59213263?v=4","gravatar_id":"","url":"https://api.github.com/users/hililiwei","html_url":"https://github.com/hililiwei","followers_url":"https://api.github.com/users/hililiwei/followers","following_url":"https://api.github.com/users/hililiwei/following{/other_user}","gists_url":"https://api.github.com/users/hililiwei/gists{/gist_id}","starred_url":"https://api.github.com/users/hililiwei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hililiwei/subscriptions","organizations_url":"https://api.github.com/users/hililiwei/orgs","repos_url":"https://api.github.com/users/hililiwei/repos","events_url":"https://api.github.com/users/hililiwei/events{/privacy}","received_events_url":"https://api.github.com/users/hililiwei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T01:45:21Z","updated_at":"2022-03-11T01:45:21Z","author_association":"CONTRIBUTOR","body":"Thanks to @kbendick @dongjoon-hyun,, I'll try it after it's released.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064688444/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064689751","html_url":"https://github.com/apache/iceberg/pull/4258#issuecomment-1064689751","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4258","id":1064689751,"node_id":"IC_kwDOCW7NX84_deBX","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T01:48:37Z","updated_at":"2022-03-11T01:48:37Z","author_association":"COLLABORATOR","body":"@dylzlt sorry for the delay, I synced with @RussellSpitzer to reduce the back and forth, his main concern was to make sure we say IllegalArgumentException means it is never valid as opposed to it's not valid now because of other arguments.\r\n\r\nSo can you do something like?\r\n```\r\nException which is raised when the arguments are valid in isolation, but not in conjunction with other arguments or state, as opposed to {@link IllegalArgumentException} which is raised when an argument value is always invalid.  A ValidationException will cause the operation to abort.\r\n```\r\n\r\nI think it should be good to go after this.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064689751/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064712138","html_url":"https://github.com/apache/iceberg/pull/4297#issuecomment-1064712138","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4297","id":1064712138,"node_id":"IC_kwDOCW7NX84_djfK","user":{"login":"felixYyu","id":3785228,"node_id":"MDQ6VXNlcjM3ODUyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3785228?v=4","gravatar_id":"","url":"https://api.github.com/users/felixYyu","html_url":"https://github.com/felixYyu","followers_url":"https://api.github.com/users/felixYyu/followers","following_url":"https://api.github.com/users/felixYyu/following{/other_user}","gists_url":"https://api.github.com/users/felixYyu/gists{/gist_id}","starred_url":"https://api.github.com/users/felixYyu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felixYyu/subscriptions","organizations_url":"https://api.github.com/users/felixYyu/orgs","repos_url":"https://api.github.com/users/felixYyu/repos","events_url":"https://api.github.com/users/felixYyu/events{/privacy}","received_events_url":"https://api.github.com/users/felixYyu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T02:34:22Z","updated_at":"2022-03-11T02:34:22Z","author_association":"CONTRIBUTOR","body":"cc @rdblue @jackye1995 @aokolnychyi ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064712138/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064774148","html_url":"https://github.com/apache/iceberg/pull/4309#issuecomment-1064774148","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4309","id":1064774148,"node_id":"IC_kwDOCW7NX84_dyoE","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T05:00:38Z","updated_at":"2022-03-11T05:00:38Z","author_association":"CONTRIBUTOR","body":"I agree with @szehon-ho that it would probably be best to guard this in terms of multithreaded calling etc.  Especially as this is in `core`, so it could be running in so many various frameworks and contexts.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064774148/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064774168","html_url":"https://github.com/apache/iceberg/pull/4311#issuecomment-1064774168","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4311","id":1064774168,"node_id":"IC_kwDOCW7NX84_dyoY","user":{"login":"xloya","id":26177232,"node_id":"MDQ6VXNlcjI2MTc3MjMy","avatar_url":"https://avatars.githubusercontent.com/u/26177232?v=4","gravatar_id":"","url":"https://api.github.com/users/xloya","html_url":"https://github.com/xloya","followers_url":"https://api.github.com/users/xloya/followers","following_url":"https://api.github.com/users/xloya/following{/other_user}","gists_url":"https://api.github.com/users/xloya/gists{/gist_id}","starred_url":"https://api.github.com/users/xloya/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xloya/subscriptions","organizations_url":"https://api.github.com/users/xloya/orgs","repos_url":"https://api.github.com/users/xloya/repos","events_url":"https://api.github.com/users/xloya/events{/privacy}","received_events_url":"https://api.github.com/users/xloya/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T05:00:42Z","updated_at":"2022-03-11T05:07:14Z","author_association":"CONTRIBUTOR","body":"> Thanks for providing a patch @xloya.\r\n> \r\n> It would help if. you could provide more context. Is this something that needs to be special cased for flink `upsert` mode in some way? Modifying `core` and removing tests causes me concern at first sight.\r\n> \r\n> It's possible I missed something on the mailing list or some other discussion, forgive me if so. Is it possible there's an example scenario that can be given to help me understand?\r\n\r\nOf course, we have a scenario to write data to iceberg's v2 table through Flink CDC. They have non-primary key query scenarios. The current implementation in `core` will add a filter, which may lose the latest seq num equality delete files for Flink streaming writing.  \r\nE.g:  \r\nTable schema : (id int (primary key), date date)  \r\nWhen seq num=1, Flink writes a record with `id=1, date='2021-01-01'`, will insert a data record with `id=1, date='2021-01-01'`, and a equality delete data record with an `id=1, date='2021-01-01'`;  \r\nWhen seq num=2, writes a record with `id=1, date='2022-01-01'` to update, will insert a data record with `id=1, date='2022-01-01'`, and a equality delete record with `id=1 ,date='2022-01-01' `;  \r\nAt this time, when using `select * from xxx where date < '2022-01-01'` to query, due to the addition of the filter, the equality delete file written when seq num=2 will be filtered out.  \r\n\r\nThis is currently the easiest way to fix the problem. If we want to optimize for Flink upsert, then I think may need to read the latest records with the primary key that already exists in the table and write them to the equality delete file when writing, while instead of writing the inserted data to the equality delete file","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064774168/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064774980","html_url":"https://github.com/apache/iceberg/issues/3941#issuecomment-1064774980","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3941","id":1064774980,"node_id":"IC_kwDOCW7NX84_dy1E","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T05:02:39Z","updated_at":"2022-03-11T05:02:39Z","author_association":"CONTRIBUTOR","body":"After thinking more, we may change the assumptions a bit.\r\n\r\n### Revisited Assumptions\r\n\r\n- Changes are consumed per snapshot\r\n\r\nIceberg does not distinguish the order of records within a snapshot. That's why Iceberg can only report a summary of what changed in a snapshot. \r\n\r\nBy default, rows added and removed in the same snapshot (e.g. Flink CDC) are not shown in the output. In most cases, we just want to see a net delta per snapshot. If a use case requires all records to be seen, it is still doable. For example, if a snapshot adds a data file A with two records (pos 0, 1) and a position delete file D that removes pos 0, we can output something like this.\r\n\r\n```\r\n _record_type | _commit_snapshot_id | _commit_order | col1 | col2\r\n-------------------------------------------------------------------\r\ninsert, s1, 0, 100, a\r\ninsert, s1, 0, 101, a\r\ndelete, s1, 1, 100, null\r\n```\r\n\r\nThat means records within the same snapshot may have different `_commit_order`. Seems a little bit odd but kind of represents what happens in the Iceberg table. Audit use cases may need this.\r\n\r\n- Output only delete and insert record types by default\r\n\r\nIceberg does not have a notion of an update, which means constructing pre/post images will require some computation. In a lot of cases, this won't be needed (e.g. refresh of a materialized view, syncing changes with an external system). I think we should prefer a more efficient algorithm if possible. \r\n\r\nThere seems to be a way to build pre/post update images (see the comment above) but it will require joins and equality deletes will be the trickiest. For instance, a single equality delete may match a number of records and we have to report all of them.\r\n\r\n- Table must have identity columns defined\r\n\r\nWhenever we apply a delta log to a target table, most CDC use cases rely on a primary key or a set of identity columns. I think it is reasonable to assume Iceberg tables should have identity columns defined to support generation of CDC records.\r\n\r\n- Delete records may only include values for identity columns\r\n\r\nIt is not required to output the entire deleted record if other columns are not stored in equality delete files. If values for other columns are not persisted, this would require an expensive join to reconstruct the entire row.\r\n\r\n### Open questions\r\n\r\n- How to deal with changing identity columns?\r\n- How to deal with cases when an equality delete is issued using a set of columns that is different from identity columns?\r\n\r\n### MVP\r\n\r\n- Implement a Spark action that would output delete/update record types per snapshot.\r\n\r\n### Future\r\n\r\n- Option for outputting records added and removed in the same snapshot.\r\n- Option for pre/post update images.\r\n- Different ways to consume these changes (e.g. cdc metadata table).","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064774980/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064794777","html_url":"https://github.com/apache/iceberg/pull/4258#issuecomment-1064794777","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4258","id":1064794777,"node_id":"IC_kwDOCW7NX84_d3qZ","user":{"login":"hzluting","id":5558252,"node_id":"MDQ6VXNlcjU1NTgyNTI=","avatar_url":"https://avatars.githubusercontent.com/u/5558252?v=4","gravatar_id":"","url":"https://api.github.com/users/hzluting","html_url":"https://github.com/hzluting","followers_url":"https://api.github.com/users/hzluting/followers","following_url":"https://api.github.com/users/hzluting/following{/other_user}","gists_url":"https://api.github.com/users/hzluting/gists{/gist_id}","starred_url":"https://api.github.com/users/hzluting/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hzluting/subscriptions","organizations_url":"https://api.github.com/users/hzluting/orgs","repos_url":"https://api.github.com/users/hzluting/repos","events_url":"https://api.github.com/users/hzluting/events{/privacy}","received_events_url":"https://api.github.com/users/hzluting/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T05:48:48Z","updated_at":"2022-03-11T05:48:48Z","author_association":"CONTRIBUTOR","body":"> @dylzlt sorry for the delay, I synced with @RussellSpitzer to reduce the back and forth, his main concern was to make sure we say IllegalArgumentException means it is never valid as opposed to it's not valid now because of other arguments.\r\n> \r\n> So can you do something like?\r\n> \r\n> ```\r\n> Exception which is raised when the arguments are valid in isolation, but not in conjunction with other arguments or state, as opposed to {@link IllegalArgumentException} which is raised when an argument value is always invalid.  A ValidationException will cause the operation to abort.\r\n> ```\r\n> \r\n> I think it should be good to go after this.\r\nok, I get it. Thank you for your patience. I complete it.\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064794777/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064809386","html_url":"https://github.com/apache/iceberg/pull/3681#issuecomment-1064809386","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3681","id":1064809386,"node_id":"IC_kwDOCW7NX84_d7Oq","user":{"login":"hameizi","id":18445460,"node_id":"MDQ6VXNlcjE4NDQ1NDYw","avatar_url":"https://avatars.githubusercontent.com/u/18445460?v=4","gravatar_id":"","url":"https://api.github.com/users/hameizi","html_url":"https://github.com/hameizi","followers_url":"https://api.github.com/users/hameizi/followers","following_url":"https://api.github.com/users/hameizi/following{/other_user}","gists_url":"https://api.github.com/users/hameizi/gists{/gist_id}","starred_url":"https://api.github.com/users/hameizi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hameizi/subscriptions","organizations_url":"https://api.github.com/users/hameizi/orgs","repos_url":"https://api.github.com/users/hameizi/repos","events_url":"https://api.github.com/users/hameizi/events{/privacy}","received_events_url":"https://api.github.com/users/hameizi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T06:18:09Z","updated_at":"2022-03-11T06:18:09Z","author_association":"CONTRIBUTOR","body":"> > I have another concern about this change: should we bind the watermark strategy within the table metadata? I prefer binding it with the job instead of the table.\r\n> \r\n> +1 on @yittg 's suggestion. Different jobs may want to set the watermark differently.\r\n\r\nBut there is one question that where are we save watermark properties when we bind the  watermark strategy with job? Maybe it need extra storage?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064809386/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064812093","html_url":"https://github.com/apache/iceberg/pull/4309#issuecomment-1064812093","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4309","id":1064812093,"node_id":"IC_kwDOCW7NX84_d749","user":{"login":"singhpk234","id":35593236,"node_id":"MDQ6VXNlcjM1NTkzMjM2","avatar_url":"https://avatars.githubusercontent.com/u/35593236?v=4","gravatar_id":"","url":"https://api.github.com/users/singhpk234","html_url":"https://github.com/singhpk234","followers_url":"https://api.github.com/users/singhpk234/followers","following_url":"https://api.github.com/users/singhpk234/following{/other_user}","gists_url":"https://api.github.com/users/singhpk234/gists{/gist_id}","starred_url":"https://api.github.com/users/singhpk234/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/singhpk234/subscriptions","organizations_url":"https://api.github.com/users/singhpk234/orgs","repos_url":"https://api.github.com/users/singhpk234/repos","events_url":"https://api.github.com/users/singhpk234/events{/privacy}","received_events_url":"https://api.github.com/users/singhpk234/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T06:23:04Z","updated_at":"2022-03-11T06:23:04Z","author_association":"CONTRIBUTOR","body":"Thanks @szehon-ho @kbendick , added the handling for the same. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064812093/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064814103","html_url":"https://github.com/apache/iceberg/issues/3860#issuecomment-1064814103","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3860","id":1064814103,"node_id":"IC_kwDOCW7NX84_d8YX","user":{"login":"PiyushHurpadeDremio","id":71250524,"node_id":"MDQ6VXNlcjcxMjUwNTI0","avatar_url":"https://avatars.githubusercontent.com/u/71250524?v=4","gravatar_id":"","url":"https://api.github.com/users/PiyushHurpadeDremio","html_url":"https://github.com/PiyushHurpadeDremio","followers_url":"https://api.github.com/users/PiyushHurpadeDremio/followers","following_url":"https://api.github.com/users/PiyushHurpadeDremio/following{/other_user}","gists_url":"https://api.github.com/users/PiyushHurpadeDremio/gists{/gist_id}","starred_url":"https://api.github.com/users/PiyushHurpadeDremio/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PiyushHurpadeDremio/subscriptions","organizations_url":"https://api.github.com/users/PiyushHurpadeDremio/orgs","repos_url":"https://api.github.com/users/PiyushHurpadeDremio/repos","events_url":"https://api.github.com/users/PiyushHurpadeDremio/events{/privacy}","received_events_url":"https://api.github.com/users/PiyushHurpadeDremio/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T06:27:06Z","updated_at":"2022-03-11T06:27:06Z","author_association":"NONE","body":"Valid set of partition-spec-id's for a snapshot will be right requirement. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064814103/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064821091","html_url":"https://github.com/apache/iceberg/issues/3941#issuecomment-1064821091","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3941","id":1064821091,"node_id":"IC_kwDOCW7NX84_d-Fj","user":{"login":"coolderli","id":38486782,"node_id":"MDQ6VXNlcjM4NDg2Nzgy","avatar_url":"https://avatars.githubusercontent.com/u/38486782?v=4","gravatar_id":"","url":"https://api.github.com/users/coolderli","html_url":"https://github.com/coolderli","followers_url":"https://api.github.com/users/coolderli/followers","following_url":"https://api.github.com/users/coolderli/following{/other_user}","gists_url":"https://api.github.com/users/coolderli/gists{/gist_id}","starred_url":"https://api.github.com/users/coolderli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coolderli/subscriptions","organizations_url":"https://api.github.com/users/coolderli/orgs","repos_url":"https://api.github.com/users/coolderli/repos","events_url":"https://api.github.com/users/coolderli/events{/privacy}","received_events_url":"https://api.github.com/users/coolderli/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T06:41:48Z","updated_at":"2022-03-11T06:41:48Z","author_association":"CONTRIBUTOR","body":"Just share my thought.\r\n\r\n- Output only delete and insert record types by default\r\nConstructing pre/post images may be necessary. If the downstream is an external system that can handle the insert as upsert, the update_before(delete) can be dropped. But if the downstream requires aggregation operation like sum, the update_before can not be dropped.\r\nBecause in the current implementation, the records have no metadata like create_timestamp, we can't determine the time of deletion and insertion, so maybe we have to delete before inserting. But this is unacceptable, this will cause data to jitter, and users will see the data decrease, and then the data returns to normal.\r\n\r\n- How to deal with changing identity columns?\r\nMaybe we need to consider adding some restrictions like always storing all rows in equality delete files when there is a streaming read. Then maybe we can use the latest primary key.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064821091/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064830998","html_url":"https://github.com/apache/iceberg/pull/4309#issuecomment-1064830998","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4309","id":1064830998,"node_id":"IC_kwDOCW7NX84_eAgW","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T07:01:24Z","updated_at":"2022-03-11T07:01:24Z","author_association":"CONTRIBUTOR","body":"> Thanks @szehon-ho @kbendick , added the handling for the same.\r\n\r\nThanks @singhpk234. The other thing I would say this would benefit from is a test.\r\n\r\nCan we possibly add one using Spark for example to start? We don’t need to do all file formats etc, but kryo and java serde would be good to use such that we broadcast the table and it undergoes ser/de.\r\n\r\nWDYT?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064830998/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064887971","html_url":"https://github.com/apache/iceberg/pull/3681#issuecomment-1064887971","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3681","id":1064887971,"node_id":"IC_kwDOCW7NX84_eOaj","user":{"login":"kingeasternsun","id":5291739,"node_id":"MDQ6VXNlcjUyOTE3Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/5291739?v=4","gravatar_id":"","url":"https://api.github.com/users/kingeasternsun","html_url":"https://github.com/kingeasternsun","followers_url":"https://api.github.com/users/kingeasternsun/followers","following_url":"https://api.github.com/users/kingeasternsun/following{/other_user}","gists_url":"https://api.github.com/users/kingeasternsun/gists{/gist_id}","starred_url":"https://api.github.com/users/kingeasternsun/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingeasternsun/subscriptions","organizations_url":"https://api.github.com/users/kingeasternsun/orgs","repos_url":"https://api.github.com/users/kingeasternsun/repos","events_url":"https://api.github.com/users/kingeasternsun/events{/privacy}","received_events_url":"https://api.github.com/users/kingeasternsun/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T08:31:20Z","updated_at":"2022-03-11T08:37:31Z","author_association":"CONTRIBUTOR","body":"Hello everyOne, I think May be we can just use iceberg connector to solve this , no need to modify code. @hameizi  @yittg \r\n\r\nfirst of all,  use flink to create a iceberg table without  `Computed columns` or watermark, like this:\r\n```java\r\n    tenv.executeSql(\"CREATE CATALOG iceberg_catalog WITH (\\n\" +\r\n        \"  'type'='iceberg',\\n\" +\r\n        \"  'catalog-type'='hive',\" +\r\n        \"  'uri'='thrift://host:9083',\" +\r\n        \"  'warehouse'='hdfs://host:9009/user/hive/warehouse/'\" +\r\n        \")\");\r\n\r\n    tenv.useCatalog(\"iceberg_catalog\");\r\n    tenv.useDatabase(\"iceberg_db\");\r\n\r\n    String tableName = \"iceberg_origin\";\r\n\r\n    tenv.executeSql(\"create table if not exists  \" + tableName + \"(\\n\" +\r\n        \" order_id    STRING,\\n\" +\r\n        \" price       DECIMAL(32,2),\\n\" +\r\n        \" currency    STRING,\\n\" +\r\n        \" origin_order_time TIMESTAMP(6)\\n\" +\r\n        \") WITH (\\n\" +\r\n        \" 'format.version' = '2'\\n\" +\r\n        \")\"\r\n    );\r\n```\r\n\r\nthen use iceberg connector to create a Table source with `Computed columns`  and watermark support,like this  @stevenzwu \r\n```java\r\n    tenv.executeSql(\"create table if not exists  default_catalog.default_database.iceberg_table (\\n\" +\r\n        \" order_id    STRING,\\n\" +\r\n        \" price       DECIMAL(32,2),\\n\" +\r\n        \" currency    STRING,\\n\" +\r\n        \" origin_order_time TIMESTAMP(6),\\n\" +\r\n        \" order_time as cast(origin_order_time as TIMESTAMP(3)),\\n\" +\r\n        \" WATERMARK FOR order_time AS order_time - INTERVAL '5' MINUTE\\n\" +\r\n        \") WITH (\\n\" +\r\n        \" 'connector' = 'iceberg',\\n\" +\r\n        \" 'catalog-name' = 'iceberg_catalog',\\n\" +\r\n        \" 'catalog-database' = 'iceberg_db',\\n\" +\r\n        \" 'catalog-table' = 'iceberg_origin',\\n\" +\r\n        \"  'uri'='thrift://host:9083',\" +\r\n        \"  'warehouse'='hdfs://host:9009/user/hive/warehouse/'\" +\r\n        \")\"\r\n    );\r\n\r\n```\r\n\r\nif different watermark strategy is needed, we just need create another table source . for example, 10 MINUTES watermark \r\n```java\r\n    tenv.executeSql(\"create table if not exists  default_catalog.default_database.iceberg_table (\\n\" +\r\n        \" order_id    STRING,\\n\" +\r\n        \" price       DECIMAL(32,2),\\n\" +\r\n        \" currency    STRING,\\n\" +\r\n        \" origin_order_time TIMESTAMP(6),\\n\" +\r\n        \" order_time as cast(origin_order_time as TIMESTAMP(3)),\\n\" +\r\n        \" WATERMARK FOR order_time AS order_time - INTERVAL '10' MINUTE\\n\" +\r\n        \") WITH (\\n\" +\r\n        \" 'connector' = 'iceberg',\\n\" +\r\n        \" 'catalog-name' = 'iceberg_catalog',\\n\" +\r\n        \" 'catalog-database' = 'iceberg_db',\\n\" +\r\n        \" 'catalog-table' = 'iceberg_origin',\\n\" +\r\n        \"  'uri'='thrift://host:9083',\" +\r\n        \"  'warehouse'='hdfs://host:9009/user/hive/warehouse/'\" +\r\n        \")\"\r\n    );\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064887971/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064898875","html_url":"https://github.com/apache/iceberg/issues/644#issuecomment-1064898875","issue_url":"https://api.github.com/repos/apache/iceberg/issues/644","id":1064898875,"node_id":"IC_kwDOCW7NX84_eRE7","user":{"login":"melin","id":1145830,"node_id":"MDQ6VXNlcjExNDU4MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1145830?v=4","gravatar_id":"","url":"https://api.github.com/users/melin","html_url":"https://github.com/melin","followers_url":"https://api.github.com/users/melin/followers","following_url":"https://api.github.com/users/melin/following{/other_user}","gists_url":"https://api.github.com/users/melin/gists{/gist_id}","starred_url":"https://api.github.com/users/melin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/melin/subscriptions","organizations_url":"https://api.github.com/users/melin/orgs","repos_url":"https://api.github.com/users/melin/repos","events_url":"https://api.github.com/users/melin/events{/privacy}","received_events_url":"https://api.github.com/users/melin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T08:46:46Z","updated_at":"2022-03-11T08:46:46Z","author_association":"NONE","body":"> In Spark, our Iceberg catalog serves as TableCatalog, ViewCatalog ([Spark SPIP](https://docs.google.com/document/d/1XOxFtloiMuW24iqJ-zJnDzHl2KMxipTjJoxleJFz66A/edit?usp=sharing)), and FunctionCatalog simultaneously.\r\n\r\nSpark 3.2 Support FunctionCatalog","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064898875/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064904034","html_url":"https://github.com/apache/iceberg/pull/3681#issuecomment-1064904034","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3681","id":1064904034,"node_id":"IC_kwDOCW7NX84_eSVi","user":{"login":"yittg","id":4429171,"node_id":"MDQ6VXNlcjQ0MjkxNzE=","avatar_url":"https://avatars.githubusercontent.com/u/4429171?v=4","gravatar_id":"","url":"https://api.github.com/users/yittg","html_url":"https://github.com/yittg","followers_url":"https://api.github.com/users/yittg/followers","following_url":"https://api.github.com/users/yittg/following{/other_user}","gists_url":"https://api.github.com/users/yittg/gists{/gist_id}","starred_url":"https://api.github.com/users/yittg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yittg/subscriptions","organizations_url":"https://api.github.com/users/yittg/orgs","repos_url":"https://api.github.com/users/yittg/repos","events_url":"https://api.github.com/users/yittg/events{/privacy}","received_events_url":"https://api.github.com/users/yittg/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T08:54:03Z","updated_at":"2022-03-11T08:54:03Z","author_association":"CONTRIBUTOR","body":"@kingeasternsun, yeah it indeed works. honestly, we are using it like this way currently. Maybe nothing need be changed, but gotta to say it is weird, :)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1064904034/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1065034492","html_url":"https://github.com/apache/iceberg/pull/3681#issuecomment-1065034492","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3681","id":1065034492,"node_id":"IC_kwDOCW7NX84_eyL8","user":{"login":"yittg","id":4429171,"node_id":"MDQ6VXNlcjQ0MjkxNzE=","avatar_url":"https://avatars.githubusercontent.com/u/4429171?v=4","gravatar_id":"","url":"https://api.github.com/users/yittg","html_url":"https://github.com/yittg","followers_url":"https://api.github.com/users/yittg/followers","following_url":"https://api.github.com/users/yittg/following{/other_user}","gists_url":"https://api.github.com/users/yittg/gists{/gist_id}","starred_url":"https://api.github.com/users/yittg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yittg/subscriptions","organizations_url":"https://api.github.com/users/yittg/orgs","repos_url":"https://api.github.com/users/yittg/repos","events_url":"https://api.github.com/users/yittg/events{/privacy}","received_events_url":"https://api.github.com/users/yittg/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T11:38:52Z","updated_at":"2022-03-11T11:38:52Z","author_association":"CONTRIBUTOR","body":"I think saving the watermark information if provided in FlinkCatalog may be an option. How do you think , @stevenzwu @hameizi ?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1065034492/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1065424171","html_url":"https://github.com/apache/iceberg/pull/4309#issuecomment-1065424171","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4309","id":1065424171,"node_id":"IC_kwDOCW7NX84_gRUr","user":{"login":"singhpk234","id":35593236,"node_id":"MDQ6VXNlcjM1NTkzMjM2","avatar_url":"https://avatars.githubusercontent.com/u/35593236?v=4","gravatar_id":"","url":"https://api.github.com/users/singhpk234","html_url":"https://github.com/singhpk234","followers_url":"https://api.github.com/users/singhpk234/followers","following_url":"https://api.github.com/users/singhpk234/following{/other_user}","gists_url":"https://api.github.com/users/singhpk234/gists{/gist_id}","starred_url":"https://api.github.com/users/singhpk234/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/singhpk234/subscriptions","organizations_url":"https://api.github.com/users/singhpk234/orgs","repos_url":"https://api.github.com/users/singhpk234/repos","events_url":"https://api.github.com/users/singhpk234/events{/privacy}","received_events_url":"https://api.github.com/users/singhpk234/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T19:28:30Z","updated_at":"2022-03-11T19:28:30Z","author_association":"CONTRIBUTOR","body":"+1 @kbendick, I totally agree on adding test cases for the same. \r\n\r\nIIUC are you talking of creating an E2E test which actually does broadcasts and hence becomes a part of serDe as within spark itself we have such test's present with both serDe, but it doesn't broadcast rather does serilaization and deserilization on it's own and checks if it's reliable. \r\n\r\nI am referring to this : \r\n\r\nhttps://github.com/apache/iceberg/blob/1b774c2c3f054309024e0b0e62688ffa9e25fe20/spark/v3.2/spark/src/test/java/org/apache/iceberg/TestTableSerialization.java#L71-L101\r\n\r\nP.S have added a test which would have failed without this change. please let me know your thoughts on this approach","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1065424171/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1065427093","html_url":"https://github.com/apache/iceberg/issues/3941#issuecomment-1065427093","issue_url":"https://api.github.com/repos/apache/iceberg/issues/3941","id":1065427093,"node_id":"IC_kwDOCW7NX84_gSCV","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T19:32:40Z","updated_at":"2022-03-11T19:32:40Z","author_association":"CONTRIBUTOR","body":"> Constructing pre/post images may be necessary. If the downstream is an external system that can handle the insert as upsert, the update_before(delete) can be dropped.\r\n\r\nI agree pre/post images may be necessary and I think there will be a way to build them (like I mention in the comment above). It will require more resources and will be tricky for equality deletes. That's why the proposal is not to include them by default. However, I am not sure I agree that pre/post images are required to apply changes to other systems.\r\n\r\nFor example, consider the following CDC records (I ignored some columns).\r\n\r\n```\r\n _record_type | _commit_snapshot_id | _commit_order | id | value\r\n-------------------------------------------------------------------\r\ndelete, s1, 0, 100, null\r\ninsert, s1, 0, 100, a\r\ninsert, s1, 0, 101, a\r\n```\r\n\r\nIf the external system supports MERGE statements, we can issue the following command:\r\n\r\n```\r\nMERGE INTO target t USING source s\r\nON t.id = s.id AND s._record_type = 'delete'\r\nWHEN MATCHED\r\n  DELETE\r\nWHEN NOT MATCHED\r\n  INSERT …\r\n```\r\n\r\nEven though we only had deletes/inserts, we still managed to represent an update in the external system.\r\n\r\n> But if the downstream requires aggregation operation like sum, the update_before can not be dropped.\r\n\r\nCan you elaborate a little bit more to make sure I have a good example to think through? When I explored such cases, I though it would be sufficient to know what partitions/keys changed so that aggregations affected by this can be recomputed. For instance, if you have an aggregation by day and you know a particular day has either deletes or new inserts, the aggregation must be recomputed.\r\n\r\n> Because in the current implementation, the records have no metadata like create_timestamp, we can't determine the time of deletion and insertion, so maybe we have to delete before inserting. But this is unacceptable, this will cause data to jitter, and users will see the data decrease, and then the data returns to normal.\r\n\r\nCan you give an example here too? In my examples, I assumed deletes with the same `_commit_order` are applied before inserts. Changes from different snapshots will have different `_commit_order`.\r\n\r\n```\r\n _record_type | _commit_snapshot_id | _commit_order | id | value\r\n-------------------------------------------------------------------\r\ninsert, s1, 0, 100, a\r\ndelete, s2, 1, 100, null\r\ninsert, s2, 1, 100, b\r\ninsert, s3, 2, 101, a\r\n```\r\n\r\nThe above example would be append in `s1`, update in `s2`, another append in `s3`.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1065427093/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1065576920","html_url":"https://github.com/apache/iceberg/pull/4311#issuecomment-1065576920","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4311","id":1065576920,"node_id":"IC_kwDOCW7NX84_g2nY","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T22:07:45Z","updated_at":"2022-03-11T22:15:21Z","author_association":"COLLABORATOR","body":"I agree with @kbendick , changing core will break some other engine like Spark that depend on this for things like validation check for serializable isolation mode.  Also agree with his suggestion on consider how the Flink side using the filter, and see if we can add some other option to deleteFileIndex to support this use case.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1065576920/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1065580678","html_url":"https://github.com/apache/iceberg/pull/4306#issuecomment-1065580678","issue_url":"https://api.github.com/repos/apache/iceberg/issues/4306","id":1065580678,"node_id":"IC_kwDOCW7NX84_g3iG","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T22:14:36Z","updated_at":"2022-03-11T22:14:36Z","author_association":"CONTRIBUTOR","body":"Do we need to continuously upgrade gradle minor versions? Is there a benefit to doing this?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1065580678/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]