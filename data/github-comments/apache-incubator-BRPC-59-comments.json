[{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1468009786","html_url":"https://github.com/apache/brpc/issues/2163#issuecomment-1468009786","issue_url":"https://api.github.com/repos/apache/brpc/issues/2163","id":1468009786,"node_id":"IC_kwDOBhmkcs5XgA06","user":{"login":"xiedeacc","id":8072296,"node_id":"MDQ6VXNlcjgwNzIyOTY=","avatar_url":"https://avatars.githubusercontent.com/u/8072296?v=4","gravatar_id":"","url":"https://api.github.com/users/xiedeacc","html_url":"https://github.com/xiedeacc","followers_url":"https://api.github.com/users/xiedeacc/followers","following_url":"https://api.github.com/users/xiedeacc/following{/other_user}","gists_url":"https://api.github.com/users/xiedeacc/gists{/gist_id}","starred_url":"https://api.github.com/users/xiedeacc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiedeacc/subscriptions","organizations_url":"https://api.github.com/users/xiedeacc/orgs","repos_url":"https://api.github.com/users/xiedeacc/repos","events_url":"https://api.github.com/users/xiedeacc/events{/privacy}","received_events_url":"https://api.github.com/users/xiedeacc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-14T12:23:42Z","updated_at":"2023-03-14T12:23:42Z","author_association":"NONE","body":"最终发现时间窗口不能超过1小时导致\r\n\r\ncaidj ***@***.***> 于2023年3月14日周二 12:13写道：\r\n\r\n> 哪个版本触发的？可能是dump线程访问了销毁的bvar导致的。\r\n>\r\n> —\r\n> Reply to this email directly, view it on GitHub\r\n> <https://github.com/apache/brpc/issues/2163#issuecomment-1467329957>, or\r\n> unsubscribe\r\n> <https://github.com/notifications/unsubscribe-auth/AB5SY2HYVU7TC4DZMHQYDGTW37V67ANCNFSM6AAAAAAVYR7I6I>\r\n> .\r\n> You are receiving this because you authored the thread.Message ID:\r\n> ***@***.***>\r\n>\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1468009786/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1468038309","html_url":"https://github.com/apache/brpc/issues/2145#issuecomment-1468038309","issue_url":"https://api.github.com/repos/apache/brpc/issues/2145","id":1468038309,"node_id":"IC_kwDOBhmkcs5XgHyl","user":{"login":"TangSiyang2001","id":82279870,"node_id":"MDQ6VXNlcjgyMjc5ODcw","avatar_url":"https://avatars.githubusercontent.com/u/82279870?v=4","gravatar_id":"","url":"https://api.github.com/users/TangSiyang2001","html_url":"https://github.com/TangSiyang2001","followers_url":"https://api.github.com/users/TangSiyang2001/followers","following_url":"https://api.github.com/users/TangSiyang2001/following{/other_user}","gists_url":"https://api.github.com/users/TangSiyang2001/gists{/gist_id}","starred_url":"https://api.github.com/users/TangSiyang2001/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TangSiyang2001/subscriptions","organizations_url":"https://api.github.com/users/TangSiyang2001/orgs","repos_url":"https://api.github.com/users/TangSiyang2001/repos","events_url":"https://api.github.com/users/TangSiyang2001/events{/privacy}","received_events_url":"https://api.github.com/users/TangSiyang2001/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-14T12:44:27Z","updated_at":"2023-03-14T12:44:27Z","author_association":"CONTRIBUTOR","body":"> @TangSiyang2001 http解析消息的时候，是可以知道是不是header complete的，如果在这个之后判断，是不是能简化问题？ 因为method相关的，在header中就拿到了。\r\n\r\n确实如此，受教了，我修改下设计。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1468038309/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1469397084","html_url":"https://github.com/apache/brpc/issues/2163#issuecomment-1469397084","issue_url":"https://api.github.com/repos/apache/brpc/issues/2163","id":1469397084,"node_id":"IC_kwDOBhmkcs5XlThc","user":{"login":"larrylian","id":11072802,"node_id":"MDQ6VXNlcjExMDcyODAy","avatar_url":"https://avatars.githubusercontent.com/u/11072802?v=4","gravatar_id":"","url":"https://api.github.com/users/larrylian","html_url":"https://github.com/larrylian","followers_url":"https://api.github.com/users/larrylian/followers","following_url":"https://api.github.com/users/larrylian/following{/other_user}","gists_url":"https://api.github.com/users/larrylian/gists{/gist_id}","starred_url":"https://api.github.com/users/larrylian/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/larrylian/subscriptions","organizations_url":"https://api.github.com/users/larrylian/orgs","repos_url":"https://api.github.com/users/larrylian/repos","events_url":"https://api.github.com/users/larrylian/events{/privacy}","received_events_url":"https://api.github.com/users/larrylian/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-15T06:07:14Z","updated_at":"2023-03-15T06:23:35Z","author_association":"NONE","body":"![image](https://user-images.githubusercontent.com/11072802/225221450-c53c5853-2a52-4d06-8cb0-5e1c8847e6fe.png)\r\n我这边也遇到类似问题。 不知道是不是一样的问题。\r\n\r\n集成的brpc版本是：\r\nbrpc-0.9.7-rc05.tar.gz","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1469397084/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1469406103","html_url":"https://github.com/apache/brpc/issues/2166#issuecomment-1469406103","issue_url":"https://api.github.com/repos/apache/brpc/issues/2166","id":1469406103,"node_id":"IC_kwDOBhmkcs5XlVuX","user":{"login":"jingshi-ant","id":124752045,"node_id":"U_kgDOB2-QrQ","avatar_url":"https://avatars.githubusercontent.com/u/124752045?v=4","gravatar_id":"","url":"https://api.github.com/users/jingshi-ant","html_url":"https://github.com/jingshi-ant","followers_url":"https://api.github.com/users/jingshi-ant/followers","following_url":"https://api.github.com/users/jingshi-ant/following{/other_user}","gists_url":"https://api.github.com/users/jingshi-ant/gists{/gist_id}","starred_url":"https://api.github.com/users/jingshi-ant/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jingshi-ant/subscriptions","organizations_url":"https://api.github.com/users/jingshi-ant/orgs","repos_url":"https://api.github.com/users/jingshi-ant/repos","events_url":"https://api.github.com/users/jingshi-ant/events{/privacy}","received_events_url":"https://api.github.com/users/jingshi-ant/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-15T06:17:34Z","updated_at":"2023-03-15T06:17:34Z","author_association":"NONE","body":"update，进一步测试发现，启用tls后，相同 源+目的端 的 channel不能在很短的间隔内重复创建，否则会挂在tls内部。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1469406103/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1471209565","html_url":"https://github.com/apache/brpc/issues/1589#issuecomment-1471209565","issue_url":"https://api.github.com/repos/apache/brpc/issues/1589","id":1471209565,"node_id":"IC_kwDOBhmkcs5XsOBd","user":{"login":"egolearner","id":45122959,"node_id":"MDQ6VXNlcjQ1MTIyOTU5","avatar_url":"https://avatars.githubusercontent.com/u/45122959?v=4","gravatar_id":"","url":"https://api.github.com/users/egolearner","html_url":"https://github.com/egolearner","followers_url":"https://api.github.com/users/egolearner/followers","following_url":"https://api.github.com/users/egolearner/following{/other_user}","gists_url":"https://api.github.com/users/egolearner/gists{/gist_id}","starred_url":"https://api.github.com/users/egolearner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/egolearner/subscriptions","organizations_url":"https://api.github.com/users/egolearner/orgs","repos_url":"https://api.github.com/users/egolearner/repos","events_url":"https://api.github.com/users/egolearner/events{/privacy}","received_events_url":"https://api.github.com/users/egolearner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-16T02:58:54Z","updated_at":"2023-03-16T02:58:54Z","author_association":"CONTRIBUTOR","body":"Hi @KaneVV1 ，请问现在什么状态了？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1471209565/reactions","total_count":9,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":9},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1471357234","html_url":"https://github.com/apache/brpc/issues/859#issuecomment-1471357234","issue_url":"https://api.github.com/repos/apache/brpc/issues/859","id":1471357234,"node_id":"IC_kwDOBhmkcs5XsyEy","user":{"login":"haoyixin","id":4223641,"node_id":"MDQ6VXNlcjQyMjM2NDE=","avatar_url":"https://avatars.githubusercontent.com/u/4223641?v=4","gravatar_id":"","url":"https://api.github.com/users/haoyixin","html_url":"https://github.com/haoyixin","followers_url":"https://api.github.com/users/haoyixin/followers","following_url":"https://api.github.com/users/haoyixin/following{/other_user}","gists_url":"https://api.github.com/users/haoyixin/gists{/gist_id}","starred_url":"https://api.github.com/users/haoyixin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/haoyixin/subscriptions","organizations_url":"https://api.github.com/users/haoyixin/orgs","repos_url":"https://api.github.com/users/haoyixin/repos","events_url":"https://api.github.com/users/haoyixin/events{/privacy}","received_events_url":"https://api.github.com/users/haoyixin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-16T05:47:58Z","updated_at":"2023-03-16T05:47:58Z","author_association":"NONE","body":"> 临时解决方式： 设置 bvar_collector_expected_per_second=0\r\n\r\n这个什么原理？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1471357234/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1473000687","html_url":"https://github.com/apache/brpc/pull/2168#issuecomment-1473000687","issue_url":"https://api.github.com/repos/apache/brpc/issues/2168","id":1473000687,"node_id":"IC_kwDOBhmkcs5XzDTv","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-17T01:58:15Z","updated_at":"2023-03-17T01:58:15Z","author_association":"CONTRIBUTOR","body":"这个是否会影响代码的向前兼容性？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1473000687/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1473017765","html_url":"https://github.com/apache/brpc/pull/2168#issuecomment-1473017765","issue_url":"https://api.github.com/repos/apache/brpc/issues/2168","id":1473017765,"node_id":"IC_kwDOBhmkcs5XzHel","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-17T02:20:39Z","updated_at":"2023-03-17T02:20:39Z","author_association":"CONTRIBUTOR","body":"应该不影响，目前method name只在创建client span的时候使用了而已。\r\nhttps://github.com/apache/brpc/blob/fc885ad37d5a1dfae47f1a32d899569b55376dab/src/brpc/channel.cpp#L470-L479","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1473017765/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1473019021","html_url":"https://github.com/apache/brpc/pull/2168#issuecomment-1473019021","issue_url":"https://api.github.com/repos/apache/brpc/issues/2168","id":1473019021,"node_id":"IC_kwDOBhmkcs5XzHyN","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-17T02:22:39Z","updated_at":"2023-03-17T02:22:39Z","author_association":"CONTRIBUTOR","body":"如果担心有影响的话，也可以在CallMethod中，_get_method_name后method_name为空再设置为\"/\"。\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1473019021/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1474623576","html_url":"https://github.com/apache/brpc/issues/2167#issuecomment-1474623576","issue_url":"https://api.github.com/repos/apache/brpc/issues/2167","id":1474623576,"node_id":"IC_kwDOBhmkcs5X5PhY","user":{"login":"xiedeacc","id":8072296,"node_id":"MDQ6VXNlcjgwNzIyOTY=","avatar_url":"https://avatars.githubusercontent.com/u/8072296?v=4","gravatar_id":"","url":"https://api.github.com/users/xiedeacc","html_url":"https://github.com/xiedeacc","followers_url":"https://api.github.com/users/xiedeacc/followers","following_url":"https://api.github.com/users/xiedeacc/following{/other_user}","gists_url":"https://api.github.com/users/xiedeacc/gists{/gist_id}","starred_url":"https://api.github.com/users/xiedeacc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiedeacc/subscriptions","organizations_url":"https://api.github.com/users/xiedeacc/orgs","repos_url":"https://api.github.com/users/xiedeacc/repos","events_url":"https://api.github.com/users/xiedeacc/events{/privacy}","received_events_url":"https://api.github.com/users/xiedeacc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-18T02:30:49Z","updated_at":"2023-03-18T02:30:49Z","author_association":"NONE","body":"完全可行，用repo_mapping就好了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1474623576/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1474659471","html_url":"https://github.com/apache/brpc/issues/2167#issuecomment-1474659471","issue_url":"https://api.github.com/repos/apache/brpc/issues/2167","id":1474659471,"node_id":"IC_kwDOBhmkcs5X5YSP","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-18T03:22:53Z","updated_at":"2023-03-18T03:22:53Z","author_association":"CONTRIBUTOR","body":"> 完全可行，用repo_mapping就好了\r\n\r\n请问 boringssl 使用的是什么版本？最新的 boringssl 接口和当前 brpc使用的 openssl 不兼容（一些函数找不到）","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1474659471/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1476020080","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1476020080","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1476020080,"node_id":"IC_kwDOBhmkcs5X-kdw","user":{"login":"trevor211","id":5462911,"node_id":"MDQ6VXNlcjU0NjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/5462911?v=4","gravatar_id":"","url":"https://api.github.com/users/trevor211","html_url":"https://github.com/trevor211","followers_url":"https://api.github.com/users/trevor211/followers","following_url":"https://api.github.com/users/trevor211/following{/other_user}","gists_url":"https://api.github.com/users/trevor211/gists{/gist_id}","starred_url":"https://api.github.com/users/trevor211/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/trevor211/subscriptions","organizations_url":"https://api.github.com/users/trevor211/orgs","repos_url":"https://api.github.com/users/trevor211/repos","events_url":"https://api.github.com/users/trevor211/events{/privacy}","received_events_url":"https://api.github.com/users/trevor211/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-20T11:01:14Z","updated_at":"2023-03-20T11:01:14Z","author_association":"NONE","body":"请问“网络重启故障”具体是指什么呢？是如何注入的？我们也遇到了这个问题，client一直返回E112，直到重启才恢复，持续时间最长的client大约是40分钟。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1476020080/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1478841278","html_url":"https://github.com/apache/brpc/pull/2171#issuecomment-1478841278","issue_url":"https://api.github.com/repos/apache/brpc/issues/2171","id":1478841278,"node_id":"IC_kwDOBhmkcs5YJVO-","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-22T02:37:59Z","updated_at":"2023-03-22T02:37:59Z","author_association":"CONTRIBUTOR","body":"Mongo client有专门的支持naming service和load balancer吗？不是用目前brpc已有的支持naming service和load balancer？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1478841278/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1478867746","html_url":"https://github.com/apache/brpc/pull/2171#issuecomment-1478867746","issue_url":"https://api.github.com/repos/apache/brpc/issues/2171","id":1478867746,"node_id":"IC_kwDOBhmkcs5YJbsi","user":{"login":"TousakaRin","id":8801314,"node_id":"MDQ6VXNlcjg4MDEzMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8801314?v=4","gravatar_id":"","url":"https://api.github.com/users/TousakaRin","html_url":"https://github.com/TousakaRin","followers_url":"https://api.github.com/users/TousakaRin/followers","following_url":"https://api.github.com/users/TousakaRin/following{/other_user}","gists_url":"https://api.github.com/users/TousakaRin/gists{/gist_id}","starred_url":"https://api.github.com/users/TousakaRin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TousakaRin/subscriptions","organizations_url":"https://api.github.com/users/TousakaRin/orgs","repos_url":"https://api.github.com/users/TousakaRin/repos","events_url":"https://api.github.com/users/TousakaRin/events{/privacy}","received_events_url":"https://api.github.com/users/TousakaRin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-22T03:22:08Z","updated_at":"2023-03-22T03:22:08Z","author_association":"CONTRIBUTOR","body":"> Mongo client有专门的支持naming service和load balancer吗？不是用目前brpc已有的支持naming service和load balancer？\r\n\r\nmongodb 是支持主从和分片的，我觉得可以做成专用的lb和naming service，这块的细节还没怎么看","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1478867746/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1480579196","html_url":"https://github.com/apache/brpc/pull/2175#issuecomment-1480579196","issue_url":"https://api.github.com/repos/apache/brpc/issues/2175","id":1480579196,"node_id":"IC_kwDOBhmkcs5YP9h8","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-23T04:16:02Z","updated_at":"2023-03-23T04:16:02Z","author_association":"MEMBER","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1480579196/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1480761863","html_url":"https://github.com/apache/brpc/issues/2166#issuecomment-1480761863","issue_url":"https://api.github.com/repos/apache/brpc/issues/2166","id":1480761863,"node_id":"IC_kwDOBhmkcs5YQqIH","user":{"login":"jingshi-ant","id":124752045,"node_id":"U_kgDOB2-QrQ","avatar_url":"https://avatars.githubusercontent.com/u/124752045?v=4","gravatar_id":"","url":"https://api.github.com/users/jingshi-ant","html_url":"https://github.com/jingshi-ant","followers_url":"https://api.github.com/users/jingshi-ant/followers","following_url":"https://api.github.com/users/jingshi-ant/following{/other_user}","gists_url":"https://api.github.com/users/jingshi-ant/gists{/gist_id}","starred_url":"https://api.github.com/users/jingshi-ant/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jingshi-ant/subscriptions","organizations_url":"https://api.github.com/users/jingshi-ant/orgs","repos_url":"https://api.github.com/users/jingshi-ant/repos","events_url":"https://api.github.com/users/jingshi-ant/events{/privacy}","received_events_url":"https://api.github.com/users/jingshi-ant/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-23T08:17:15Z","updated_at":"2023-03-23T08:18:56Z","author_association":"NONE","body":"update:\r\n测试了下半同步发送，程序会因为ssl内部状态revive，从而出现类似上述重复创建channel导致的crash。增加如下补丁后，半同步发送的稳定性提升，请教下Disable renegotiation的原因？看ssl文档，这种场景下是可以重试的：\r\n``\r\ndiff --git a/src/brpc/socket.cpp b/src/brpc/socket.cpp\r\nindex e3878c19..b300206f 100644\r\n--- a/src/brpc/socket.cpp\r\n+++ b/src/brpc/socket.cpp\r\n@@ -1824,10 +1824,6 @@ ssize_t Socket::DoWrite(WriteRequest* req) {\r\n         break;\r\n \r\n     case SSL_ERROR_WANT_READ:\r\n-        // Disable renegotiation\r\n-        errno = EPROTO;\r\n-        return -1;\r\n-\r\n     case SSL_ERROR_WANT_WRITE:\r\n         errno = EAGAIN;\r\n         break;\r\n@@ -1973,9 +1969,8 @@ ssize_t Socket::DoRead(size_t size_hint) {\r\n         break;\r\n             \r\n     case SSL_ERROR_WANT_WRITE:\r\n-        // Disable renegotiation\r\n-        errno = EPROTO;\r\n-        return -1;\r\n+        errno = EAGAIN;\r\n+        break;\r\n \r\n     default: {\r\n         const unsigned long e = ERR_get_error();","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1480761863/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1482295456","html_url":"https://github.com/apache/brpc/issues/2142#issuecomment-1482295456","issue_url":"https://api.github.com/repos/apache/brpc/issues/2142","id":1482295456,"node_id":"IC_kwDOBhmkcs5YWgig","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-24T05:59:21Z","updated_at":"2023-03-24T05:59:21Z","author_association":"NONE","body":"> \r\n\r\n你这边开发的怎么样了, 我可以协助一起开发","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1482295456/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1482518630","html_url":"https://github.com/apache/brpc/issues/2142#issuecomment-1482518630","issue_url":"https://api.github.com/repos/apache/brpc/issues/2142","id":1482518630,"node_id":"IC_kwDOBhmkcs5YXXBm","user":{"login":"cooper-zhzhang","id":16239579,"node_id":"MDQ6VXNlcjE2MjM5NTc5","avatar_url":"https://avatars.githubusercontent.com/u/16239579?v=4","gravatar_id":"","url":"https://api.github.com/users/cooper-zhzhang","html_url":"https://github.com/cooper-zhzhang","followers_url":"https://api.github.com/users/cooper-zhzhang/followers","following_url":"https://api.github.com/users/cooper-zhzhang/following{/other_user}","gists_url":"https://api.github.com/users/cooper-zhzhang/gists{/gist_id}","starred_url":"https://api.github.com/users/cooper-zhzhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cooper-zhzhang/subscriptions","organizations_url":"https://api.github.com/users/cooper-zhzhang/orgs","repos_url":"https://api.github.com/users/cooper-zhzhang/repos","events_url":"https://api.github.com/users/cooper-zhzhang/events{/privacy}","received_events_url":"https://api.github.com/users/cooper-zhzhang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-24T09:43:05Z","updated_at":"2023-03-24T09:43:05Z","author_association":"NONE","body":"请问你那边开发到什么进度了？\r\n我这边已经实现了moved，但是在实现ASK时遇到了问题。能否交流下","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1482518630/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1483798708","html_url":"https://github.com/apache/brpc/issues/2142#issuecomment-1483798708","issue_url":"https://api.github.com/repos/apache/brpc/issues/2142","id":1483798708,"node_id":"IC_kwDOBhmkcs5YcPi0","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-25T11:19:43Z","updated_at":"2023-03-25T11:19:43Z","author_association":"NONE","body":"> 请问你那边开发到什么进度了？ 我这边已经实现了moved，但是在实现ASK时遇到了问题。能否交流下\r\n\r\n可以参考下sougou的workflow, workflow 支持 异步redis cluster","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1483798708/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1484523189","html_url":"https://github.com/apache/brpc/issues/2142#issuecomment-1484523189","issue_url":"https://api.github.com/repos/apache/brpc/issues/2142","id":1484523189,"node_id":"IC_kwDOBhmkcs5YfAa1","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-27T05:34:03Z","updated_at":"2023-03-27T05:34:03Z","author_association":"NONE","body":"> > 请问你那边开发到什么进度了？ 我这边已经实现了moved，但是在实现ASK时遇到了问题。能否交流下\r\n> \r\n> 可以参考下sougou的workflow, workflow 支持 异步redis cluster\r\n\r\n简单看了下源码啊, 好像不支持smart client, 只是简单处理了MOVED ASK错误","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1484523189/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1485021340","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1485021340","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1485021340,"node_id":"IC_kwDOBhmkcs5Yg6Cc","user":{"login":"jialei-jialei","id":13553842,"node_id":"MDQ6VXNlcjEzNTUzODQy","avatar_url":"https://avatars.githubusercontent.com/u/13553842?v=4","gravatar_id":"","url":"https://api.github.com/users/jialei-jialei","html_url":"https://github.com/jialei-jialei","followers_url":"https://api.github.com/users/jialei-jialei/followers","following_url":"https://api.github.com/users/jialei-jialei/following{/other_user}","gists_url":"https://api.github.com/users/jialei-jialei/gists{/gist_id}","starred_url":"https://api.github.com/users/jialei-jialei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jialei-jialei/subscriptions","organizations_url":"https://api.github.com/users/jialei-jialei/orgs","repos_url":"https://api.github.com/users/jialei-jialei/repos","events_url":"https://api.github.com/users/jialei-jialei/events{/privacy}","received_events_url":"https://api.github.com/users/jialei-jialei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-27T12:02:48Z","updated_at":"2023-03-27T12:05:08Z","author_association":"NONE","body":"> 请问“网络重启故障”具体是指什么呢？是如何注入的？我们也遇到了这个问题，client一直返回E112，直到重启才恢复，持续时间最长的client大约是40分钟。\r\n\r\n就是执行 service network restart，复现的概率比较低，但是一旦出现了，只有重启进程才能恢复，看代码应该是Socket管理的bug，那个地方很多原子操作，非常复杂","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1485021340/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1485037941","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1485037941","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1485037941,"node_id":"IC_kwDOBhmkcs5Yg-F1","user":{"login":"jialei-jialei","id":13553842,"node_id":"MDQ6VXNlcjEzNTUzODQy","avatar_url":"https://avatars.githubusercontent.com/u/13553842?v=4","gravatar_id":"","url":"https://api.github.com/users/jialei-jialei","html_url":"https://github.com/jialei-jialei","followers_url":"https://api.github.com/users/jialei-jialei/followers","following_url":"https://api.github.com/users/jialei-jialei/following{/other_user}","gists_url":"https://api.github.com/users/jialei-jialei/gists{/gist_id}","starred_url":"https://api.github.com/users/jialei-jialei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jialei-jialei/subscriptions","organizations_url":"https://api.github.com/users/jialei-jialei/orgs","repos_url":"https://api.github.com/users/jialei-jialei/repos","events_url":"https://api.github.com/users/jialei-jialei/events{/privacy}","received_events_url":"https://api.github.com/users/jialei-jialei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-27T12:13:20Z","updated_at":"2023-03-27T12:13:20Z","author_association":"NONE","body":"我升级到了brpc1.4版本，依然没有解决这个问题，不断注入网络故障：ifconfig down/up bond的一个口，又复现了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1485037941/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1485044876","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1485044876","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1485044876,"node_id":"IC_kwDOBhmkcs5Yg_yM","user":{"login":"jialei-jialei","id":13553842,"node_id":"MDQ6VXNlcjEzNTUzODQy","avatar_url":"https://avatars.githubusercontent.com/u/13553842?v=4","gravatar_id":"","url":"https://api.github.com/users/jialei-jialei","html_url":"https://github.com/jialei-jialei","followers_url":"https://api.github.com/users/jialei-jialei/followers","following_url":"https://api.github.com/users/jialei-jialei/following{/other_user}","gists_url":"https://api.github.com/users/jialei-jialei/gists{/gist_id}","starred_url":"https://api.github.com/users/jialei-jialei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jialei-jialei/subscriptions","organizations_url":"https://api.github.com/users/jialei-jialei/orgs","repos_url":"https://api.github.com/users/jialei-jialei/repos","events_url":"https://api.github.com/users/jialei-jialei/events{/privacy}","received_events_url":"https://api.github.com/users/jialei-jialei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-27T12:23:08Z","updated_at":"2023-03-27T12:23:08Z","author_association":"NONE","body":"这个问题对目前的业务影响很大，比较头疼。我想到的办法是：\r\n1.放弃使用brpc，改用grpc，但是grpc没brpc好，c++的grpc太臃肿了\r\n2.改源码，把Socket类改写掉，去掉那一堆复杂的原子计数，用最简单的方式实现\r\n3.应用层规避，brpc持续出现这个错误码，进程就自杀（把channel delete掉，重连，不知道是否有效果）","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1485044876/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1485045065","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1485045065","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1485045065,"node_id":"IC_kwDOBhmkcs5Yg_1J","user":{"login":"jialei-jialei","id":13553842,"node_id":"MDQ6VXNlcjEzNTUzODQy","avatar_url":"https://avatars.githubusercontent.com/u/13553842?v=4","gravatar_id":"","url":"https://api.github.com/users/jialei-jialei","html_url":"https://github.com/jialei-jialei","followers_url":"https://api.github.com/users/jialei-jialei/followers","following_url":"https://api.github.com/users/jialei-jialei/following{/other_user}","gists_url":"https://api.github.com/users/jialei-jialei/gists{/gist_id}","starred_url":"https://api.github.com/users/jialei-jialei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jialei-jialei/subscriptions","organizations_url":"https://api.github.com/users/jialei-jialei/orgs","repos_url":"https://api.github.com/users/jialei-jialei/repos","events_url":"https://api.github.com/users/jialei-jialei/events{/privacy}","received_events_url":"https://api.github.com/users/jialei-jialei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-27T12:23:21Z","updated_at":"2023-03-27T12:29:17Z","author_association":"NONE","body":"1","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1485045065/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1485045503","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1485045503","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1485045503,"node_id":"IC_kwDOBhmkcs5Yg_7_","user":{"login":"jialei-jialei","id":13553842,"node_id":"MDQ6VXNlcjEzNTUzODQy","avatar_url":"https://avatars.githubusercontent.com/u/13553842?v=4","gravatar_id":"","url":"https://api.github.com/users/jialei-jialei","html_url":"https://github.com/jialei-jialei","followers_url":"https://api.github.com/users/jialei-jialei/followers","following_url":"https://api.github.com/users/jialei-jialei/following{/other_user}","gists_url":"https://api.github.com/users/jialei-jialei/gists{/gist_id}","starred_url":"https://api.github.com/users/jialei-jialei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jialei-jialei/subscriptions","organizations_url":"https://api.github.com/users/jialei-jialei/orgs","repos_url":"https://api.github.com/users/jialei-jialei/repos","events_url":"https://api.github.com/users/jialei-jialei/events{/privacy}","received_events_url":"https://api.github.com/users/jialei-jialei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-27T12:23:55Z","updated_at":"2023-03-27T12:29:38Z","author_association":"NONE","body":"1","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1485045503/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1485376483","html_url":"https://github.com/apache/brpc/issues/2172#issuecomment-1485376483","issue_url":"https://api.github.com/repos/apache/brpc/issues/2172","id":1485376483,"node_id":"IC_kwDOBhmkcs5YiQvj","user":{"login":"warriorpaw","id":3822240,"node_id":"MDQ6VXNlcjM4MjIyNDA=","avatar_url":"https://avatars.githubusercontent.com/u/3822240?v=4","gravatar_id":"","url":"https://api.github.com/users/warriorpaw","html_url":"https://github.com/warriorpaw","followers_url":"https://api.github.com/users/warriorpaw/followers","following_url":"https://api.github.com/users/warriorpaw/following{/other_user}","gists_url":"https://api.github.com/users/warriorpaw/gists{/gist_id}","starred_url":"https://api.github.com/users/warriorpaw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/warriorpaw/subscriptions","organizations_url":"https://api.github.com/users/warriorpaw/orgs","repos_url":"https://api.github.com/users/warriorpaw/repos","events_url":"https://api.github.com/users/warriorpaw/events{/privacy}","received_events_url":"https://api.github.com/users/warriorpaw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-27T15:45:47Z","updated_at":"2023-03-27T15:53:05Z","author_association":"CONTRIBUTOR","body":"增加--usercode_in_pthread=true命令行参数再执行，asan的堆栈应该就是完整的，see: https://github.com/google/sanitizers/issues/189 ,asan不支持swapcontext，但是 bthread就是基于swapcontext 实现的，usercode_in_pthread参数会让brpc在pthread中执行。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1485376483/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486093174","html_url":"https://github.com/apache/brpc/issues/2172#issuecomment-1486093174","issue_url":"https://api.github.com/repos/apache/brpc/issues/2172","id":1486093174,"node_id":"IC_kwDOBhmkcs5Yk_t2","user":{"login":"zzjshaok","id":39356300,"node_id":"MDQ6VXNlcjM5MzU2MzAw","avatar_url":"https://avatars.githubusercontent.com/u/39356300?v=4","gravatar_id":"","url":"https://api.github.com/users/zzjshaok","html_url":"https://github.com/zzjshaok","followers_url":"https://api.github.com/users/zzjshaok/followers","following_url":"https://api.github.com/users/zzjshaok/following{/other_user}","gists_url":"https://api.github.com/users/zzjshaok/gists{/gist_id}","starred_url":"https://api.github.com/users/zzjshaok/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zzjshaok/subscriptions","organizations_url":"https://api.github.com/users/zzjshaok/orgs","repos_url":"https://api.github.com/users/zzjshaok/repos","events_url":"https://api.github.com/users/zzjshaok/events{/privacy}","received_events_url":"https://api.github.com/users/zzjshaok/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-28T01:54:38Z","updated_at":"2023-03-28T01:54:38Z","author_association":"NONE","body":"> 增加--usercode_in_pthread=true命令行参数再执行，asan的堆栈应该就是完整的，see: [google/sanitizers#189](https://github.com/google/sanitizers/issues/189) ,asan不支持swapcontext，但是 bthread就是基于swapcontext 实现的，usercode_in_pthread参数会让brpc在pthread中执行。\r\n\r\n\r\n谢谢！测试后确实是在这样的，加上--usercode_in_pthread=true后就可以显示完整堆栈了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486093174/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486094743","html_url":"https://github.com/apache/brpc/pull/2180#issuecomment-1486094743","issue_url":"https://api.github.com/repos/apache/brpc/issues/2180","id":1486094743,"node_id":"IC_kwDOBhmkcs5YlAGX","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-28T01:56:33Z","updated_at":"2023-03-28T01:56:33Z","author_association":"CONTRIBUTOR","body":"Does this affect performance?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486094743/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486096576","html_url":"https://github.com/apache/brpc/pull/2177#issuecomment-1486096576","issue_url":"https://api.github.com/repos/apache/brpc/issues/2177","id":1486096576,"node_id":"IC_kwDOBhmkcs5YlAjA","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-28T01:58:35Z","updated_at":"2023-03-28T01:58:35Z","author_association":"CONTRIBUTOR","body":"CI单测失败了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486096576/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486100599","html_url":"https://github.com/apache/brpc/pull/2180#issuecomment-1486100599","issue_url":"https://api.github.com/repos/apache/brpc/issues/2180","id":1486100599,"node_id":"IC_kwDOBhmkcs5YlBh3","user":{"login":"jingshi-ant","id":124752045,"node_id":"U_kgDOB2-QrQ","avatar_url":"https://avatars.githubusercontent.com/u/124752045?v=4","gravatar_id":"","url":"https://api.github.com/users/jingshi-ant","html_url":"https://github.com/jingshi-ant","followers_url":"https://api.github.com/users/jingshi-ant/followers","following_url":"https://api.github.com/users/jingshi-ant/following{/other_user}","gists_url":"https://api.github.com/users/jingshi-ant/gists{/gist_id}","starred_url":"https://api.github.com/users/jingshi-ant/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jingshi-ant/subscriptions","organizations_url":"https://api.github.com/users/jingshi-ant/orgs","repos_url":"https://api.github.com/users/jingshi-ant/repos","events_url":"https://api.github.com/users/jingshi-ant/events{/privacy}","received_events_url":"https://api.github.com/users/jingshi-ant/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-28T02:04:32Z","updated_at":"2023-03-28T02:04:32Z","author_association":"NONE","body":"> Does this affect performance?\r\n\r\nabout 20% slower in my 100w data set test. (mainly because of ssl enable. if remove lock and enable ssl, the speed is almost the same with lock added.)","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486100599/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486102286","html_url":"https://github.com/apache/brpc/pull/2177#issuecomment-1486102286","issue_url":"https://api.github.com/repos/apache/brpc/issues/2177","id":1486102286,"node_id":"IC_kwDOBhmkcs5YlB8O","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-28T02:07:05Z","updated_at":"2023-03-28T02:07:05Z","author_association":"CONTRIBUTOR","body":"> CI单测失败了\r\n\r\n嗯嗯。。 我先在本地调试一下。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486102286/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486126613","html_url":"https://github.com/apache/brpc/pull/2184#issuecomment-1486126613","issue_url":"https://api.github.com/repos/apache/brpc/issues/2184","id":1486126613,"node_id":"IC_kwDOBhmkcs5YlH4V","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-28T02:47:53Z","updated_at":"2023-03-28T02:47:53Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486126613/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486129388","html_url":"https://github.com/apache/brpc/issues/2174#issuecomment-1486129388","issue_url":"https://api.github.com/repos/apache/brpc/issues/2174","id":1486129388,"node_id":"IC_kwDOBhmkcs5YlIjs","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-28T02:52:58Z","updated_at":"2023-03-28T02:53:09Z","author_association":"CONTRIBUTOR","body":"暂时没有计划，bRPC中的压缩算法是可扩展的，有兴趣的话欢迎给bRPC提交PR，可以参考snappy,zlib,gzip的实现。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486129388/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486138968","html_url":"https://github.com/apache/brpc/pull/2180#issuecomment-1486138968","issue_url":"https://api.github.com/repos/apache/brpc/issues/2180","id":1486138968,"node_id":"IC_kwDOBhmkcs5YlK5Y","user":{"login":"warriorpaw","id":3822240,"node_id":"MDQ6VXNlcjM4MjIyNDA=","avatar_url":"https://avatars.githubusercontent.com/u/3822240?v=4","gravatar_id":"","url":"https://api.github.com/users/warriorpaw","html_url":"https://github.com/warriorpaw","followers_url":"https://api.github.com/users/warriorpaw/followers","following_url":"https://api.github.com/users/warriorpaw/following{/other_user}","gists_url":"https://api.github.com/users/warriorpaw/gists{/gist_id}","starred_url":"https://api.github.com/users/warriorpaw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/warriorpaw/subscriptions","organizations_url":"https://api.github.com/users/warriorpaw/orgs","repos_url":"https://api.github.com/users/warriorpaw/repos","events_url":"https://api.github.com/users/warriorpaw/events{/privacy}","received_events_url":"https://api.github.com/users/warriorpaw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-28T03:07:11Z","updated_at":"2023-03-28T03:07:11Z","author_association":"CONTRIBUTOR","body":"> Does this affect performance?\r\n\r\nBrpc already piped write requests by linked list and only one bthread calls ssl_write.\r\n\r\nIn data reading, brpc use epoll in edge triggered mode and an atomic variable to make sure there is only one bthread is calling ssl_read.\r\n\r\nAdding a mutex here will introduce some competition, but it should be very slight. Further this mutex will avoided the competition of using underlay socket fd. So, the impact of this change on performance should be almost none.\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1486138968/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1487903812","html_url":"https://github.com/apache/brpc/issues/2142#issuecomment-1487903812","issue_url":"https://api.github.com/repos/apache/brpc/issues/2142","id":1487903812,"node_id":"IC_kwDOBhmkcs5Yr5xE","user":{"login":"wayslog","id":8586449,"node_id":"MDQ6VXNlcjg1ODY0NDk=","avatar_url":"https://avatars.githubusercontent.com/u/8586449?v=4","gravatar_id":"","url":"https://api.github.com/users/wayslog","html_url":"https://github.com/wayslog","followers_url":"https://api.github.com/users/wayslog/followers","following_url":"https://api.github.com/users/wayslog/following{/other_user}","gists_url":"https://api.github.com/users/wayslog/gists{/gist_id}","starred_url":"https://api.github.com/users/wayslog/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wayslog/subscriptions","organizations_url":"https://api.github.com/users/wayslog/orgs","repos_url":"https://api.github.com/users/wayslog/repos","events_url":"https://api.github.com/users/wayslog/events{/privacy}","received_events_url":"https://api.github.com/users/wayslog/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-29T03:45:46Z","updated_at":"2023-03-29T03:45:46Z","author_association":"NONE","body":"> > > 请问你那边开发到什么进度了？ 我这边已经实现了moved，但是在实现ASK时遇到了问题。能否交流下\r\n> > \r\n> > \r\n> > 可以参考下sougou的workflow, workflow 支持 异步redis cluster\r\n> \r\n> 简单看了下源码啊, 好像不支持smart client, 只是简单处理了MOVED ASK错误\r\n\r\n我这边仍然在持续开发中，不过最近工作的事情比较忙，还需要一段时间来实现它。\r\n这里 MOVED/ASK 需要在 Controller 中加入一个抽象层级比较高、逻辑比较干净的重试策略。因为 Controller 本身涉及到的流程相当多，所以改起来是会比较难的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1487903812/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1488024746","html_url":"https://github.com/apache/brpc/issues/780#issuecomment-1488024746","issue_url":"https://api.github.com/repos/apache/brpc/issues/780","id":1488024746,"node_id":"IC_kwDOBhmkcs5YsXSq","user":{"login":"hubble-insight","id":7741814,"node_id":"MDQ6VXNlcjc3NDE4MTQ=","avatar_url":"https://avatars.githubusercontent.com/u/7741814?v=4","gravatar_id":"","url":"https://api.github.com/users/hubble-insight","html_url":"https://github.com/hubble-insight","followers_url":"https://api.github.com/users/hubble-insight/followers","following_url":"https://api.github.com/users/hubble-insight/following{/other_user}","gists_url":"https://api.github.com/users/hubble-insight/gists{/gist_id}","starred_url":"https://api.github.com/users/hubble-insight/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hubble-insight/subscriptions","organizations_url":"https://api.github.com/users/hubble-insight/orgs","repos_url":"https://api.github.com/users/hubble-insight/repos","events_url":"https://api.github.com/users/hubble-insight/events{/privacy}","received_events_url":"https://api.github.com/users/hubble-insight/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-29T06:39:05Z","updated_at":"2023-03-29T06:39:05Z","author_association":"NONE","body":"现在开源了吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1488024746/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1488029530","html_url":"https://github.com/apache/brpc/issues/2001#issuecomment-1488029530","issue_url":"https://api.github.com/repos/apache/brpc/issues/2001","id":1488029530,"node_id":"IC_kwDOBhmkcs5YsYda","user":{"login":"llwwjjj","id":37909462,"node_id":"MDQ6VXNlcjM3OTA5NDYy","avatar_url":"https://avatars.githubusercontent.com/u/37909462?v=4","gravatar_id":"","url":"https://api.github.com/users/llwwjjj","html_url":"https://github.com/llwwjjj","followers_url":"https://api.github.com/users/llwwjjj/followers","following_url":"https://api.github.com/users/llwwjjj/following{/other_user}","gists_url":"https://api.github.com/users/llwwjjj/gists{/gist_id}","starred_url":"https://api.github.com/users/llwwjjj/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/llwwjjj/subscriptions","organizations_url":"https://api.github.com/users/llwwjjj/orgs","repos_url":"https://api.github.com/users/llwwjjj/repos","events_url":"https://api.github.com/users/llwwjjj/events{/privacy}","received_events_url":"https://api.github.com/users/llwwjjj/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-29T06:44:28Z","updated_at":"2023-03-29T06:44:28Z","author_association":"NONE","body":"触发了这条日志 +1，想知道这个日志是非预期的还是真的有问题？bug 有计划修复吗～","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1488029530/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1488149408","html_url":"https://github.com/apache/brpc/issues/2142#issuecomment-1488149408","issue_url":"https://api.github.com/repos/apache/brpc/issues/2142","id":1488149408,"node_id":"IC_kwDOBhmkcs5Ys1ug","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-29T08:23:01Z","updated_at":"2023-03-29T08:23:01Z","author_association":"NONE","body":"> > > > 请问你那边开发到什么进度了？ 我这边已经实现了moved，但是在实现ASK时遇到了问题。能否交流下\r\n> > > \r\n> > > \r\n> > > 可以参考下sougou的workflow, workflow 支持 异步redis cluster\r\n> > \r\n> > \r\n> > 简单看了下源码啊, 好像不支持smart client, 只是简单处理了MOVED ASK错误\r\n> \r\n> 我这边仍然在持续开发中，不过最近工作的事情比较忙，还需要一段时间来实现它。 这里 MOVED/ASK 需要在 Controller 中加入一个抽象层级比较高、逻辑比较干净的重试策略。因为 Controller 本身涉及到的流程相当多，所以改起来是会比较难的。\r\n\r\n\r\nredis专门定义一个retry_policy如何, 专门处理MOVED ASKING   @wwbmmm ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1488149408/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1488309098","html_url":"https://github.com/apache/brpc/issues/2186#issuecomment-1488309098","issue_url":"https://api.github.com/repos/apache/brpc/issues/2186","id":1488309098,"node_id":"IC_kwDOBhmkcs5Ytctq","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-29T10:06:38Z","updated_at":"2023-03-29T10:06:38Z","author_association":"CONTRIBUTOR","body":"可以自定义 RetryPolicy","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1488309098/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1488311101","html_url":"https://github.com/apache/brpc/issues/2142#issuecomment-1488311101","issue_url":"https://api.github.com/repos/apache/brpc/issues/2142","id":1488311101,"node_id":"IC_kwDOBhmkcs5YtdM9","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-29T10:07:45Z","updated_at":"2023-03-29T10:07:45Z","author_association":"CONTRIBUTOR","body":"> redis专门定义一个retry_policy如何, 专门处理MOVED ASKING @wwbmmm\r\n\r\n这也是一个思路","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1488311101/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1488480641","html_url":"https://github.com/apache/brpc/issues/2186#issuecomment-1488480641","issue_url":"https://api.github.com/repos/apache/brpc/issues/2186","id":1488480641,"node_id":"IC_kwDOBhmkcs5YuGmB","user":{"login":"FancyJan","id":37871611,"node_id":"MDQ6VXNlcjM3ODcxNjEx","avatar_url":"https://avatars.githubusercontent.com/u/37871611?v=4","gravatar_id":"","url":"https://api.github.com/users/FancyJan","html_url":"https://github.com/FancyJan","followers_url":"https://api.github.com/users/FancyJan/followers","following_url":"https://api.github.com/users/FancyJan/following{/other_user}","gists_url":"https://api.github.com/users/FancyJan/gists{/gist_id}","starred_url":"https://api.github.com/users/FancyJan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/FancyJan/subscriptions","organizations_url":"https://api.github.com/users/FancyJan/orgs","repos_url":"https://api.github.com/users/FancyJan/repos","events_url":"https://api.github.com/users/FancyJan/events{/privacy}","received_events_url":"https://api.github.com/users/FancyJan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-29T12:07:38Z","updated_at":"2023-03-29T12:07:38Z","author_association":"CONTRIBUTOR","body":"> \r\n\r\n大佬的意思是实现一个RetryPolicy，然后这个RetryPolicy只对EHOSTDOWN做重试吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1488480641/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1488555318","html_url":"https://github.com/apache/brpc/issues/2186#issuecomment-1488555318","issue_url":"https://api.github.com/repos/apache/brpc/issues/2186","id":1488555318,"node_id":"IC_kwDOBhmkcs5YuY02","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-29T12:57:19Z","updated_at":"2023-03-29T12:57:19Z","author_association":"CONTRIBUTOR","body":"对","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1488555318/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1489585288","html_url":"https://github.com/apache/brpc/issues/2142#issuecomment-1489585288","issue_url":"https://api.github.com/repos/apache/brpc/issues/2142","id":1489585288,"node_id":"IC_kwDOBhmkcs5YyUSI","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-30T02:14:00Z","updated_at":"2023-03-30T02:14:00Z","author_association":"NONE","body":"> > > > > 请问你那边开发到什么进度了？ 我这边已经实现了moved，但是在实现ASK时遇到了问题。能否交流下\r\n> > > > \r\n> > > > \r\n> > > > 可以参考下sougou的workflow, workflow 支持 异步redis cluster\r\n> > > \r\n> > > \r\n> > > 简单看了下源码啊, 好像不支持smart client, 只是简单处理了MOVED ASK错误\r\n> > \r\n> > \r\n> > 我这边仍然在持续开发中，不过最近工作的事情比较忙，还需要一段时间来实现它。 这里 MOVED/ASK 需要在 Controller 中加入一个抽象层级比较高、逻辑比较干净的重试策略。因为 Controller 本身涉及到的流程相当多，所以改起来是会比较难的。\r\n> \r\n> redis专门定义一个retry_policy如何, 专门处理MOVED ASKING @wwbmmm\r\n\r\n@wwbmmm @wayslog \r\n![image](https://user-images.githubusercontent.com/17529657/228710094-74021982-1d0d-4a95-8474-54732d9dc8d9.png)\r\n![image](https://user-images.githubusercontent.com/17529657/228710243-2b88e602-473d-4dd1-b563-4ebc784679e1.png)\r\n这种方式实现MOVED和ASKING看起来自然而然, 基本无侵\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1489585288/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1489599370","html_url":"https://github.com/apache/brpc/issues/2185#issuecomment-1489599370","issue_url":"https://api.github.com/repos/apache/brpc/issues/2185","id":1489599370,"node_id":"IC_kwDOBhmkcs5YyXuK","user":{"login":"jiazhenjiang","id":16101364,"node_id":"MDQ6VXNlcjE2MTAxMzY0","avatar_url":"https://avatars.githubusercontent.com/u/16101364?v=4","gravatar_id":"","url":"https://api.github.com/users/jiazhenjiang","html_url":"https://github.com/jiazhenjiang","followers_url":"https://api.github.com/users/jiazhenjiang/followers","following_url":"https://api.github.com/users/jiazhenjiang/following{/other_user}","gists_url":"https://api.github.com/users/jiazhenjiang/gists{/gist_id}","starred_url":"https://api.github.com/users/jiazhenjiang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiazhenjiang/subscriptions","organizations_url":"https://api.github.com/users/jiazhenjiang/orgs","repos_url":"https://api.github.com/users/jiazhenjiang/repos","events_url":"https://api.github.com/users/jiazhenjiang/events{/privacy}","received_events_url":"https://api.github.com/users/jiazhenjiang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-30T02:37:41Z","updated_at":"2023-03-30T02:37:41Z","author_association":"NONE","body":"已经有解决方案了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1489599370/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1489613134","html_url":"https://github.com/apache/brpc/issues/2142#issuecomment-1489613134","issue_url":"https://api.github.com/repos/apache/brpc/issues/2142","id":1489613134,"node_id":"IC_kwDOBhmkcs5YybFO","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-30T02:57:37Z","updated_at":"2023-03-30T03:18:04Z","author_association":"NONE","body":"> > 计算节点的时候，通过请求带的 request_code 来（request_code 应该由 RedisClusterRequest 自动计算填充，通过 CRC32/16384 计算）。\r\n> \r\n> 目前RedisRequest支持批量，但是多个批量请求的key可能hash到不同的server，而当前一次RPC过程会把请求都发到同一个server，所以可能要加个限制，一次RPC的多个批量请求的key必须相同，否则实现起来会很复杂\r\n> \r\n> > 增加一个 Controller 逻辑，当客户端发现 redis cluster 返回 MOVED 之后，立即触发一次 RedisClusterNamingService 同步更新。同时修改 PreHashLoadBalancer 的路由表\r\n> \r\n> 目前Controller能拿到LB，但是拿不到NamingService对象。Controller耦合NamingService似乎不是一个好主意，可以考虑只更新LB就可以。\r\n> \r\n> > 增加 Controller 逻辑，当客户端发现 redis cluster 返回 ASK 之后，直接修改请求地址，并在请求之前增加一个 ASKING 指令并获得其返回值（ASKING 在每个 SLOT 变化的时候都需要重新发送至少一次），再重新 IssueRPC，做重定向。\r\n> \r\n> 这里需要一定的抽象，可以抽象一个通用的Controller Redirect流程\r\n> \r\n> > 是否需要自定义 Controller 来处理和控制 Redis Cluster 请求的 MOVE 和 ASK\r\n> \r\n> 继承Controller父类，来实现Redis Cluster请求流程，这也是一个思路，但需要考虑Controller父类需要留出哪些接口给子类实现。毕竟Controller里的逻辑很复杂，不可能让子类完全重写一遍。\r\n> \r\n> > 是否需要重新注册一个 Redis Cluster protocol 协议。因为从协议上来看，redis cluster protocol 和 redis 都用的 RESP2 协议。\r\n> \r\n> 看起来好像没必要？在协议解析这方面，并没有什么区别。\r\n> \r\n> > 是否需要单独独立一个 RedisClusterRequest ，还是在 RedisRequest 上加个字段来区分是否使用的 cluster 模式？\r\n> \r\n> 如果实现了自定义的RedisController，也可以放在那里做一些cluster特有逻辑，就不用在Request上做区分\r\n> \r\n> > 如果要计算 request_code 需要 aware 用户请求，那么需要修改 RedisRequest 的解析段。是否让用户主动传入，我们不做计算？（感觉这里如果放开了会是个暗坑）。\r\n> \r\n> 最好不要让用户传入\r\n\r\n感觉可以考虑让用户单独传入key, 这样省去了从cmd中抽取key的开销, 代码也简单很多","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1489613134/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1490110967","html_url":"https://github.com/apache/brpc/issues/2045#issuecomment-1490110967","issue_url":"https://api.github.com/repos/apache/brpc/issues/2045","id":1490110967,"node_id":"IC_kwDOBhmkcs5Y0Un3","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-30T11:06:29Z","updated_at":"2023-03-30T11:06:29Z","author_association":"NONE","body":"@wwbmmm 我想给brpc加上sentinel支持, 您有哪方面指导, 建议 或注意的点么","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1490110967/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1490197931","html_url":"https://github.com/apache/brpc/issues/2045#issuecomment-1490197931","issue_url":"https://api.github.com/repos/apache/brpc/issues/2045","id":1490197931,"node_id":"IC_kwDOBhmkcs5Y0p2r","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-30T12:12:42Z","updated_at":"2023-03-30T12:12:42Z","author_association":"CONTRIBUTOR","body":"> @wwbmmm 我想给brpc加上sentinel支持, 您有哪方面指导, 建议 或注意的点么\r\n\r\n可以先建个issue，讨论一下需求场景，大概的使用方式","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1490197931/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1490505516","html_url":"https://github.com/apache/brpc/issues/2188#issuecomment-1490505516","issue_url":"https://api.github.com/repos/apache/brpc/issues/2188","id":1490505516,"node_id":"IC_kwDOBhmkcs5Y108s","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-30T15:28:37Z","updated_at":"2023-03-30T15:28:37Z","author_association":"CONTRIBUTOR","body":"sentinel://ip/url:port这种形式吧，sentinel://对应redis sentinel的NamingService。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1490505516/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1491236903","html_url":"https://github.com/apache/brpc/issues/2188#issuecomment-1491236903","issue_url":"https://api.github.com/repos/apache/brpc/issues/2188","id":1491236903,"node_id":"IC_kwDOBhmkcs5Y4ngn","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-31T03:25:14Z","updated_at":"2023-03-31T03:25:14Z","author_association":"NONE","body":"> sentinel://ip/url:port这种形式吧，sentinel://对应redis sentinel的NamingService。\r\n\r\n好主意","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1491236903/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1491320166","html_url":"https://github.com/apache/brpc/issues/2188#issuecomment-1491320166","issue_url":"https://api.github.com/repos/apache/brpc/issues/2188","id":1491320166,"node_id":"IC_kwDOBhmkcs5Y471m","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-31T05:31:50Z","updated_at":"2023-03-31T05:31:50Z","author_association":"NONE","body":"> sentinel://ip/url:port这种形式吧，sentinel://对应redis sentinel的NamingService。\r\n\r\n这种只有一台server的, loadbalancer让用户传什么呢, 随便传就好?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1491320166/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1491344941","html_url":"https://github.com/apache/brpc/issues/2188#issuecomment-1491344941","issue_url":"https://api.github.com/repos/apache/brpc/issues/2188","id":1491344941,"node_id":"IC_kwDOBhmkcs5Y5B4t","user":{"login":"cooper-zhzhang","id":16239579,"node_id":"MDQ6VXNlcjE2MjM5NTc5","avatar_url":"https://avatars.githubusercontent.com/u/16239579?v=4","gravatar_id":"","url":"https://api.github.com/users/cooper-zhzhang","html_url":"https://github.com/cooper-zhzhang","followers_url":"https://api.github.com/users/cooper-zhzhang/followers","following_url":"https://api.github.com/users/cooper-zhzhang/following{/other_user}","gists_url":"https://api.github.com/users/cooper-zhzhang/gists{/gist_id}","starred_url":"https://api.github.com/users/cooper-zhzhang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cooper-zhzhang/subscriptions","organizations_url":"https://api.github.com/users/cooper-zhzhang/orgs","repos_url":"https://api.github.com/users/cooper-zhzhang/repos","events_url":"https://api.github.com/users/cooper-zhzhang/events{/privacy}","received_events_url":"https://api.github.com/users/cooper-zhzhang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-31T06:03:07Z","updated_at":"2023-03-31T06:03:07Z","author_association":"NONE","body":"rc://127.0.0.1:6379\r\n我目前的实现是这样传入的，rc是一个新的NamingService","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1491344941/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1491517083","html_url":"https://github.com/apache/brpc/issues/2188#issuecomment-1491517083","issue_url":"https://api.github.com/repos/apache/brpc/issues/2188","id":1491517083,"node_id":"IC_kwDOBhmkcs5Y5r6b","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-31T08:23:15Z","updated_at":"2023-03-31T08:23:15Z","author_association":"CONTRIBUTOR","body":"> > sentinel://ip/url:port这种形式吧，sentinel://对应redis sentinel的NamingService。\r\n> \r\n> 这种只有一台server的, loadbalancer让用户传什么呢, 随便传就好?\r\n\r\nlb都支持","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1491517083/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1491540432","html_url":"https://github.com/apache/brpc/issues/2189#issuecomment-1491540432","issue_url":"https://api.github.com/repos/apache/brpc/issues/2189","id":1491540432,"node_id":"IC_kwDOBhmkcs5Y5xnQ","user":{"login":"Flynn-Zh","id":23734538,"node_id":"MDQ6VXNlcjIzNzM0NTM4","avatar_url":"https://avatars.githubusercontent.com/u/23734538?v=4","gravatar_id":"","url":"https://api.github.com/users/Flynn-Zh","html_url":"https://github.com/Flynn-Zh","followers_url":"https://api.github.com/users/Flynn-Zh/followers","following_url":"https://api.github.com/users/Flynn-Zh/following{/other_user}","gists_url":"https://api.github.com/users/Flynn-Zh/gists{/gist_id}","starred_url":"https://api.github.com/users/Flynn-Zh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Flynn-Zh/subscriptions","organizations_url":"https://api.github.com/users/Flynn-Zh/orgs","repos_url":"https://api.github.com/users/Flynn-Zh/repos","events_url":"https://api.github.com/users/Flynn-Zh/events{/privacy}","received_events_url":"https://api.github.com/users/Flynn-Zh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-31T08:42:54Z","updated_at":"2023-03-31T08:49:37Z","author_association":"NONE","body":"补充：brpc server 2 进程做负载均衡，max_concurrency=100\r\n请问下，bthread_make_fcontext 之前的调用栈是什么？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1491540432/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1491556008","html_url":"https://github.com/apache/brpc/issues/2188#issuecomment-1491556008","issue_url":"https://api.github.com/repos/apache/brpc/issues/2188","id":1491556008,"node_id":"IC_kwDOBhmkcs5Y51ao","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-03-31T08:52:07Z","updated_at":"2023-03-31T08:52:07Z","author_association":"NONE","body":"> \r\n\r\n没看明白? 就是随便传一个lb就可以了?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1491556008/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1492836251","html_url":"https://github.com/apache/brpc/issues/2188#issuecomment-1492836251","issue_url":"https://api.github.com/repos/apache/brpc/issues/2188","id":1492836251,"node_id":"IC_kwDOBhmkcs5Y-t-b","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-01T05:12:29Z","updated_at":"2023-04-01T05:12:29Z","author_association":"CONTRIBUTOR","body":"是的，只要按照NamingService的接口实现并注册了。框架的lb都是能支持的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1492836251/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1493572721","html_url":"https://github.com/apache/brpc/issues/1363#issuecomment-1493572721","issue_url":"https://api.github.com/repos/apache/brpc/issues/1363","id":1493572721,"node_id":"IC_kwDOBhmkcs5ZBhxx","user":{"login":"leoncamel","id":218590,"node_id":"MDQ6VXNlcjIxODU5MA==","avatar_url":"https://avatars.githubusercontent.com/u/218590?v=4","gravatar_id":"","url":"https://api.github.com/users/leoncamel","html_url":"https://github.com/leoncamel","followers_url":"https://api.github.com/users/leoncamel/followers","following_url":"https://api.github.com/users/leoncamel/following{/other_user}","gists_url":"https://api.github.com/users/leoncamel/gists{/gist_id}","starred_url":"https://api.github.com/users/leoncamel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leoncamel/subscriptions","organizations_url":"https://api.github.com/users/leoncamel/orgs","repos_url":"https://api.github.com/users/leoncamel/repos","events_url":"https://api.github.com/users/leoncamel/events{/privacy}","received_events_url":"https://api.github.com/users/leoncamel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-03T03:02:28Z","updated_at":"2023-04-03T03:02:28Z","author_association":"NONE","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1493572721/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1495319116","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1495319116","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1495319116,"node_id":"IC_kwDOBhmkcs5ZIMJM","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-04T04:09:55Z","updated_at":"2023-04-04T04:09:55Z","author_association":"CONTRIBUTOR","body":"> 这个问题对目前的业务影响很大，比较头疼。我想到的办法是： 1.放弃使用brpc，改用grpc，但是grpc没brpc好，c++的grpc太臃肿了 2.改源码，把Socket类改写掉，去掉那一堆复杂的原子计数，用最简单的方式实现 3.应用层规避，brpc持续出现这个错误码，进程就自杀（把channel delete掉，重连，不知道是否有效果）\r\n\r\n问下现在连接类型是什么？短链接、长连接or连接池","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1495319116/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1495325800","html_url":"https://github.com/apache/brpc/pull/2137#issuecomment-1495325800","issue_url":"https://api.github.com/repos/apache/brpc/issues/2137","id":1495325800,"node_id":"IC_kwDOBhmkcs5ZINxo","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-04T04:21:43Z","updated_at":"2023-04-04T04:21:43Z","author_association":"CONTRIBUTOR","body":"LGTM\r\nI think this PR can be merged","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1495325800/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1495917958","html_url":"https://github.com/apache/brpc/issues/2193#issuecomment-1495917958","issue_url":"https://api.github.com/repos/apache/brpc/issues/2193","id":1495917958,"node_id":"IC_kwDOBhmkcs5ZKeWG","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-04T12:50:49Z","updated_at":"2023-04-04T12:54:58Z","author_association":"CONTRIBUTOR","body":"除了std还有hulu协议支持；http自然支持attachment，对应其message body。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1495917958/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1497464462","html_url":"https://github.com/apache/brpc/issues/2170#issuecomment-1497464462","issue_url":"https://api.github.com/repos/apache/brpc/issues/2170","id":1497464462,"node_id":"IC_kwDOBhmkcs5ZQX6O","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-05T13:12:18Z","updated_at":"2023-04-05T13:12:18Z","author_association":"CONTRIBUTOR","body":"https://brpc.apache.org/zh/docs/benchmark/#%E5%90%8C%E6%9C%BA%E5%8D%95client%E5%8D%95server%E5%9C%A8%E5%9B%BA%E5%AE%9Aqps%E4%B8%8B%E7%9A%84%E5%BB%B6%E6%97%B6cdfbuiltin-servicesvars%E7%BB%9F%E8%AE%A1%E5%92%8C%E6%9F%A5%E7%9C%8B%E5%88%86%E4%BD%8D%E5%80%BC%E8%B6%8A%E5%B7%A6%E8%B6%8A%E5%A5%BD%E8%B6%8A%E7%9B%B4%E8%B6%8A%E5%A5%BD 可以看下图片中的测试基准参数。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1497464462/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1498437289","html_url":"https://github.com/apache/brpc/issues/2194#issuecomment-1498437289","issue_url":"https://api.github.com/repos/apache/brpc/issues/2194","id":1498437289,"node_id":"IC_kwDOBhmkcs5ZUFap","user":{"login":"leoncamel","id":218590,"node_id":"MDQ6VXNlcjIxODU5MA==","avatar_url":"https://avatars.githubusercontent.com/u/218590?v=4","gravatar_id":"","url":"https://api.github.com/users/leoncamel","html_url":"https://github.com/leoncamel","followers_url":"https://api.github.com/users/leoncamel/followers","following_url":"https://api.github.com/users/leoncamel/following{/other_user}","gists_url":"https://api.github.com/users/leoncamel/gists{/gist_id}","starred_url":"https://api.github.com/users/leoncamel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leoncamel/subscriptions","organizations_url":"https://api.github.com/users/leoncamel/orgs","repos_url":"https://api.github.com/users/leoncamel/repos","events_url":"https://api.github.com/users/leoncamel/events{/privacy}","received_events_url":"https://api.github.com/users/leoncamel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-06T03:19:57Z","updated_at":"2023-04-06T03:19:57Z","author_association":"NONE","body":"As we investigate the function [DetectSSLState](https://github.com/apache/brpc/blob/master/src/brpc/details/ssl_helper.cpp#L567), it will auto-detect the first packet to enable SSL or not.\r\n\r\nThis seems cool feature for both plain-text & SSL/TLS connections. But, in case use want use ssl-only connections, is there any method we can do that?\r\n\r\nThanks, for any suggestion.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1498437289/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1498627455","html_url":"https://github.com/apache/brpc/issues/2120#issuecomment-1498627455","issue_url":"https://api.github.com/repos/apache/brpc/issues/2120","id":1498627455,"node_id":"IC_kwDOBhmkcs5ZUz1_","user":{"login":"yockie","id":2568971,"node_id":"MDQ6VXNlcjI1Njg5NzE=","avatar_url":"https://avatars.githubusercontent.com/u/2568971?v=4","gravatar_id":"","url":"https://api.github.com/users/yockie","html_url":"https://github.com/yockie","followers_url":"https://api.github.com/users/yockie/followers","following_url":"https://api.github.com/users/yockie/following{/other_user}","gists_url":"https://api.github.com/users/yockie/gists{/gist_id}","starred_url":"https://api.github.com/users/yockie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yockie/subscriptions","organizations_url":"https://api.github.com/users/yockie/orgs","repos_url":"https://api.github.com/users/yockie/repos","events_url":"https://api.github.com/users/yockie/events{/privacy}","received_events_url":"https://api.github.com/users/yockie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-06T07:42:31Z","updated_at":"2023-04-06T07:42:31Z","author_association":"CONTRIBUTOR","body":"mark，遇到相同的问题","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1498627455/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1499812817","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1499812817","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1499812817,"node_id":"IC_kwDOBhmkcs5ZZVPR","user":{"login":"trevor211","id":5462911,"node_id":"MDQ6VXNlcjU0NjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/5462911?v=4","gravatar_id":"","url":"https://api.github.com/users/trevor211","html_url":"https://github.com/trevor211","followers_url":"https://api.github.com/users/trevor211/followers","following_url":"https://api.github.com/users/trevor211/following{/other_user}","gists_url":"https://api.github.com/users/trevor211/gists{/gist_id}","starred_url":"https://api.github.com/users/trevor211/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/trevor211/subscriptions","organizations_url":"https://api.github.com/users/trevor211/orgs","repos_url":"https://api.github.com/users/trevor211/repos","events_url":"https://api.github.com/users/trevor211/events{/privacy}","received_events_url":"https://api.github.com/users/trevor211/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-07T01:10:28Z","updated_at":"2023-04-07T01:10:28Z","author_association":"NONE","body":"> 这个问题对目前的业务影响很大，比较头疼。我想到的办法是： 1.放弃使用brpc，改用grpc，但是grpc没brpc好，c++的grpc太臃肿了 2.改源码，把Socket类改写掉，去掉那一堆复杂的原子计数，用最简单的方式实现 3.应用层规避，brpc持续出现这个错误码，进程就自杀（把channel delete掉，重连，不知道是否有效果）\r\n\r\n第3点，应用层规避，这点应该解决不了问题，我们这边是每次都重新创建一个新的channel，但还是出现了这样的问题。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1499812817/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1499837221","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1499837221","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1499837221,"node_id":"IC_kwDOBhmkcs5ZZbMl","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-07T01:50:48Z","updated_at":"2023-04-07T01:50:48Z","author_association":"CONTRIBUTOR","body":"> \r\n> 第3点，应用层规避，这点应该解决不了问题，我们这边是每次都重新创建一个新的channel，但还是出现了这样的问题。\r\n\r\n试试重建channel的时候，设置不同的ChannelOptions::connection_group","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1499837221/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1499884991","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1499884991","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1499884991,"node_id":"IC_kwDOBhmkcs5ZZm2_","user":{"login":"jialei-jialei","id":13553842,"node_id":"MDQ6VXNlcjEzNTUzODQy","avatar_url":"https://avatars.githubusercontent.com/u/13553842?v=4","gravatar_id":"","url":"https://api.github.com/users/jialei-jialei","html_url":"https://github.com/jialei-jialei","followers_url":"https://api.github.com/users/jialei-jialei/followers","following_url":"https://api.github.com/users/jialei-jialei/following{/other_user}","gists_url":"https://api.github.com/users/jialei-jialei/gists{/gist_id}","starred_url":"https://api.github.com/users/jialei-jialei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jialei-jialei/subscriptions","organizations_url":"https://api.github.com/users/jialei-jialei/orgs","repos_url":"https://api.github.com/users/jialei-jialei/repos","events_url":"https://api.github.com/users/jialei-jialei/events{/privacy}","received_events_url":"https://api.github.com/users/jialei-jialei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-07T03:09:21Z","updated_at":"2023-04-07T03:09:21Z","author_association":"NONE","body":"> > 这个问题对目前的业务影响很大，比较头疼。我想到的办法是： 1.放弃使用brpc，改用grpc，但是grpc没brpc好，c++的grpc太臃肿了 2.改源码，把Socket类改写掉，去掉那一堆复杂的原子计数，用最简单的方式实现 3.应用层规避，brpc持续出现这个错误码，进程就自杀（把channel delete掉，重连，不知道是否有效果）\r\n> \r\n> 问下现在连接类型是什么？短链接、长连接or连接池\r\n\r\n是长链接","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1499884991/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501045608","html_url":"https://github.com/apache/brpc/issues/2198#issuecomment-1501045608","issue_url":"https://api.github.com/repos/apache/brpc/issues/2198","id":1501045608,"node_id":"IC_kwDOBhmkcs5ZeCNo","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-09T05:28:45Z","updated_at":"2023-04-09T05:28:45Z","author_association":"CONTRIBUTOR","body":"It has already been fixed in doris, right?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501045608/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501049363","html_url":"https://github.com/apache/brpc/issues/2176#issuecomment-1501049363","issue_url":"https://api.github.com/repos/apache/brpc/issues/2176","id":1501049363,"node_id":"IC_kwDOBhmkcs5ZeDIT","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-09T06:00:51Z","updated_at":"2023-04-09T06:00:51Z","author_association":"CONTRIBUTOR","body":"请问解决了么？看起来像是使用方式的问题","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501049363/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501432852","html_url":"https://github.com/apache/brpc/issues/2199#issuecomment-1501432852","issue_url":"https://api.github.com/repos/apache/brpc/issues/2199","id":1501432852,"node_id":"IC_kwDOBhmkcs5ZfgwU","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-10T06:02:52Z","updated_at":"2023-04-10T06:02:52Z","author_association":"CONTRIBUTOR","body":"The GID index is 11. Can you run \"show_gids\" to check the GID table?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501432852/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501455702","html_url":"https://github.com/apache/brpc/issues/2199#issuecomment-1501455702","issue_url":"https://api.github.com/repos/apache/brpc/issues/2199","id":1501455702,"node_id":"IC_kwDOBhmkcs5ZfmVW","user":{"login":"cldslnt","id":50004588,"node_id":"MDQ6VXNlcjUwMDA0NTg4","avatar_url":"https://avatars.githubusercontent.com/u/50004588?v=4","gravatar_id":"","url":"https://api.github.com/users/cldslnt","html_url":"https://github.com/cldslnt","followers_url":"https://api.github.com/users/cldslnt/followers","following_url":"https://api.github.com/users/cldslnt/following{/other_user}","gists_url":"https://api.github.com/users/cldslnt/gists{/gist_id}","starred_url":"https://api.github.com/users/cldslnt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cldslnt/subscriptions","organizations_url":"https://api.github.com/users/cldslnt/orgs","repos_url":"https://api.github.com/users/cldslnt/repos","events_url":"https://api.github.com/users/cldslnt/events{/privacy}","received_events_url":"https://api.github.com/users/cldslnt/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-10T06:32:46Z","updated_at":"2023-04-10T06:32:46Z","author_association":"NONE","body":"There are two VLAN under this bond interface, how can I choose which GID to use? I want to use GID 5 but client start with GID 9 in the following show_gids output.\r\n```\r\nmlx5_bond_0\t1\t4\t0000:0000:0000:0000:0000:ffff:0a00:018f\t10.0.1.143 \tv1\tbond0.121\r\nmlx5_bond_0\t1\t5\t0000:0000:0000:0000:0000:ffff:0a00:018f\t10.0.1.143 \tv2\tbond0.121\r\nmlx5_bond_0\t1\t6\tfe80:0000:0000:0000:0e42:a1ff:fea1:7d00\t\t\tv1\tbond0.121\r\nmlx5_bond_0\t1\t7\tfe80:0000:0000:0000:0e42:a1ff:fea1:7d00\t\t\tv2\tbond0.121\r\nmlx5_bond_0\t1\t8\tfe80:0000:0000:0000:0e42:a1ff:fea1:7d00\t\t\tv1\tbond0.104\r\nmlx5_bond_0\t1\t9\tfe80:0000:0000:0000:0e42:a1ff:fea1:7d00\t\t\tv2\tbond0.104\r\n```","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501455702/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501458146","html_url":"https://github.com/apache/brpc/issues/2199#issuecomment-1501458146","issue_url":"https://api.github.com/repos/apache/brpc/issues/2199","id":1501458146,"node_id":"IC_kwDOBhmkcs5Zfm7i","user":{"login":"cldslnt","id":50004588,"node_id":"MDQ6VXNlcjUwMDA0NTg4","avatar_url":"https://avatars.githubusercontent.com/u/50004588?v=4","gravatar_id":"","url":"https://api.github.com/users/cldslnt","html_url":"https://github.com/cldslnt","followers_url":"https://api.github.com/users/cldslnt/followers","following_url":"https://api.github.com/users/cldslnt/following{/other_user}","gists_url":"https://api.github.com/users/cldslnt/gists{/gist_id}","starred_url":"https://api.github.com/users/cldslnt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cldslnt/subscriptions","organizations_url":"https://api.github.com/users/cldslnt/orgs","repos_url":"https://api.github.com/users/cldslnt/repos","events_url":"https://api.github.com/users/cldslnt/events{/privacy}","received_events_url":"https://api.github.com/users/cldslnt/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-10T06:36:53Z","updated_at":"2023-04-10T06:36:53Z","author_association":"NONE","body":"I found this config in rdma_helper.cpp `DEFINE_int32(rdma_gid_index, -1, \"The GID index to use. -1 means using the last one.\");`, and my test runs ok now. Thanks for help","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501458146/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501465396","html_url":"https://github.com/apache/brpc/issues/2199#issuecomment-1501465396","issue_url":"https://api.github.com/repos/apache/brpc/issues/2199","id":1501465396,"node_id":"IC_kwDOBhmkcs5Zfos0","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-10T06:48:06Z","updated_at":"2023-04-10T06:48:06Z","author_association":"CONTRIBUTOR","body":"That's good.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501465396/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501732253","html_url":"https://github.com/apache/brpc/issues/2176#issuecomment-1501732253","issue_url":"https://api.github.com/repos/apache/brpc/issues/2176","id":1501732253,"node_id":"IC_kwDOBhmkcs5Zgp2d","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-10T11:55:34Z","updated_at":"2023-04-10T11:55:34Z","author_association":"NONE","body":"> 请问解决了么？看起来像是使用方式的问题\r\n\r\n还没, 直连没问题, 使用grpc作为server也没问题, 就是使用apisix作为grpc网关会出问题","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501732253/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501752959","html_url":"https://github.com/apache/brpc/issues/2176#issuecomment-1501752959","issue_url":"https://api.github.com/repos/apache/brpc/issues/2176","id":1501752959,"node_id":"IC_kwDOBhmkcs5Zgu5_","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-10T12:16:23Z","updated_at":"2023-04-10T12:16:54Z","author_association":"CONTRIBUTOR","body":"> > 请问解决了么？看起来像是使用方式的问题\r\n> \r\n> 还没, 直连没问题, 使用grpc作为server也没问题, 就是使用apisix作为grpc网关会出问题\r\n\r\n网上似乎有个类似的case https://github.com/Kong/kong/issues/8316， 感觉是apisix的问题😅","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1501752959/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1502936336","html_url":"https://github.com/apache/brpc/issues/2203#issuecomment-1502936336","issue_url":"https://api.github.com/repos/apache/brpc/issues/2203","id":1502936336,"node_id":"IC_kwDOBhmkcs5ZlP0Q","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-11T08:53:52Z","updated_at":"2023-04-11T08:53:52Z","author_association":"CONTRIBUTOR","body":"可以尝试开启 `usercode_in_pthread`， \r\n> 代码中广泛地使用pthread local传递session级别全局数据，在RPC前后均使用了相同的pthread local的数据，且数据有前后依赖性。比如在RPC前往pthread-local保存了一个值，RPC后又读出来希望和之前保存的相等，就会有问题。而像tcmalloc虽然也使用了pthread/LWP local，但每次使用之间没有直接的依赖，是安全的。\r\n对于这些情况，brpc提供了pthread模式，开启**-usercode_in_pthread**后，用户代码均会在pthread中运行，原先阻塞bthread的函数转而阻塞pthread。\r\n\r\n参考这个文档 https://github.com/apache/brpc/blob/master/docs/cn/server.md#pthread%E6%A8%A1%E5%BC%8F\r\n\r\n如果在 server 处理用户请求的代码中，如果没有发生能导致 bthread 阻塞的函数，例如 bthread::usleep、 bthread::bthread_start_urgent 等这些函数，线程是不会发生切换的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1502936336/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1504379860","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1504379860","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1504379860,"node_id":"IC_kwDOBhmkcs5ZqwPU","user":{"login":"jialei-jialei","id":13553842,"node_id":"MDQ6VXNlcjEzNTUzODQy","avatar_url":"https://avatars.githubusercontent.com/u/13553842?v=4","gravatar_id":"","url":"https://api.github.com/users/jialei-jialei","html_url":"https://github.com/jialei-jialei","followers_url":"https://api.github.com/users/jialei-jialei/followers","following_url":"https://api.github.com/users/jialei-jialei/following{/other_user}","gists_url":"https://api.github.com/users/jialei-jialei/gists{/gist_id}","starred_url":"https://api.github.com/users/jialei-jialei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jialei-jialei/subscriptions","organizations_url":"https://api.github.com/users/jialei-jialei/orgs","repos_url":"https://api.github.com/users/jialei-jialei/repos","events_url":"https://api.github.com/users/jialei-jialei/events{/privacy}","received_events_url":"https://api.github.com/users/jialei-jialei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-12T01:18:29Z","updated_at":"2023-04-12T01:18:29Z","author_association":"NONE","body":"> > 第3点，应用层规避，这点应该解决不了问题，我们这边是每次都重新创建一个新的channel，但还是出现了这样的问题。\r\n> \r\n> 试试重建channel的时候，设置不同的ChannelOptions::connection_group\r\n\r\n这个方法有效，我用了后，没有再出了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1504379860/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1504489670","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1504489670","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1504489670,"node_id":"IC_kwDOBhmkcs5ZrLDG","user":{"login":"trevor211","id":5462911,"node_id":"MDQ6VXNlcjU0NjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/5462911?v=4","gravatar_id":"","url":"https://api.github.com/users/trevor211","html_url":"https://github.com/trevor211","followers_url":"https://api.github.com/users/trevor211/followers","following_url":"https://api.github.com/users/trevor211/following{/other_user}","gists_url":"https://api.github.com/users/trevor211/gists{/gist_id}","starred_url":"https://api.github.com/users/trevor211/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/trevor211/subscriptions","organizations_url":"https://api.github.com/users/trevor211/orgs","repos_url":"https://api.github.com/users/trevor211/repos","events_url":"https://api.github.com/users/trevor211/events{/privacy}","received_events_url":"https://api.github.com/users/trevor211/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-12T02:56:33Z","updated_at":"2023-04-12T02:56:33Z","author_association":"NONE","body":"> 我升级到了brpc1.4版本，依然没有解决这个问题，不断注入网络故障：ifconfig down/up bond的一个口，又复现了\r\n\r\n请问你们网络故障注入的具体流程是怎样的，每次网络注入故障多久后恢复？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1504489670/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1504526525","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1504526525","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1504526525,"node_id":"IC_kwDOBhmkcs5ZrUC9","user":{"login":"jialei-jialei","id":13553842,"node_id":"MDQ6VXNlcjEzNTUzODQy","avatar_url":"https://avatars.githubusercontent.com/u/13553842?v=4","gravatar_id":"","url":"https://api.github.com/users/jialei-jialei","html_url":"https://github.com/jialei-jialei","followers_url":"https://api.github.com/users/jialei-jialei/followers","following_url":"https://api.github.com/users/jialei-jialei/following{/other_user}","gists_url":"https://api.github.com/users/jialei-jialei/gists{/gist_id}","starred_url":"https://api.github.com/users/jialei-jialei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jialei-jialei/subscriptions","organizations_url":"https://api.github.com/users/jialei-jialei/orgs","repos_url":"https://api.github.com/users/jialei-jialei/repos","events_url":"https://api.github.com/users/jialei-jialei/events{/privacy}","received_events_url":"https://api.github.com/users/jialei-jialei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-12T03:29:57Z","updated_at":"2023-04-12T03:29:57Z","author_association":"NONE","body":"> > 我升级到了brpc1.4版本，依然没有解决这个问题，不断注入网络故障：ifconfig down/up bond的一个口，又复现了\r\n> \r\n> 请问你们网络故障注入的具体流程是怎样的，每次网络注入故障多久后恢复？\r\n\r\n我们是bond4组网，ifconfig down/up bond的其中一个网口，注入故障10s内随机，一直循环10几个小时，最后恢复","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1504526525/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1504796017","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1504796017","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1504796017,"node_id":"IC_kwDOBhmkcs5ZsV1x","user":{"login":"trevor211","id":5462911,"node_id":"MDQ6VXNlcjU0NjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/5462911?v=4","gravatar_id":"","url":"https://api.github.com/users/trevor211","html_url":"https://github.com/trevor211","followers_url":"https://api.github.com/users/trevor211/followers","following_url":"https://api.github.com/users/trevor211/following{/other_user}","gists_url":"https://api.github.com/users/trevor211/gists{/gist_id}","starred_url":"https://api.github.com/users/trevor211/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/trevor211/subscriptions","organizations_url":"https://api.github.com/users/trevor211/orgs","repos_url":"https://api.github.com/users/trevor211/repos","events_url":"https://api.github.com/users/trevor211/events{/privacy}","received_events_url":"https://api.github.com/users/trevor211/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-12T07:26:58Z","updated_at":"2023-04-12T07:26:58Z","author_association":"NONE","body":"> > > 我升级到了brpc1.4版本，依然没有解决这个问题，不断注入网络故障：ifconfig down/up bond的一个口，又复现了\r\n> > \r\n> > \r\n> > 请问你们网络故障注入的具体流程是怎样的，每次网络注入故障多久后恢复？\r\n> \r\n> 我们是bond4组网，ifconfig down/up bond的其中一个网口，注入故障10s内随机，一直循环10几个小时，最后恢复\r\n\r\n请问在你们的环境中，大概多久能够复现呢？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1504796017/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1504833117","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1504833117","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1504833117,"node_id":"IC_kwDOBhmkcs5Zse5d","user":{"login":"jialei-jialei","id":13553842,"node_id":"MDQ6VXNlcjEzNTUzODQy","avatar_url":"https://avatars.githubusercontent.com/u/13553842?v=4","gravatar_id":"","url":"https://api.github.com/users/jialei-jialei","html_url":"https://github.com/jialei-jialei","followers_url":"https://api.github.com/users/jialei-jialei/followers","following_url":"https://api.github.com/users/jialei-jialei/following{/other_user}","gists_url":"https://api.github.com/users/jialei-jialei/gists{/gist_id}","starred_url":"https://api.github.com/users/jialei-jialei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jialei-jialei/subscriptions","organizations_url":"https://api.github.com/users/jialei-jialei/orgs","repos_url":"https://api.github.com/users/jialei-jialei/repos","events_url":"https://api.github.com/users/jialei-jialei/events{/privacy}","received_events_url":"https://api.github.com/users/jialei-jialei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-12T07:58:41Z","updated_at":"2023-04-12T08:06:13Z","author_association":"NONE","body":"> > > > 我升级到了brpc1.4版本，依然没有解决这个问题，不断注入网络故障：ifconfig down/up bond的一个口，又复现了\r\n> > > \r\n> > > \r\n> > > 请问你们网络故障注入的具体流程是怎样的，每次网络注入故障多久后恢复？\r\n> > \r\n> > \r\n> > 我们是bond4组网，ifconfig down/up bond的其中一个网口，注入故障10s内随机，一直循环10几个小时，最后恢复\r\n> \r\n> 请问在你们的环境中，大概多久能够复现呢？\r\n\r\n一般来说，这样的故障跑一个晚上，第二天早上看，brpc基本会出问题。最快的时候见过，1-2个小时就出了。\r\n复现的时候还见过除了E112以外的错误，E1008，一直返回超时，抓包看，没有包发到server端，bvar看connection是残缺的，2天都没自动恢复，所以我猜也是处于假死状态","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1504833117/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1505114580","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1505114580","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1505114580,"node_id":"IC_kwDOBhmkcs5ZtjnU","user":{"login":"trevor211","id":5462911,"node_id":"MDQ6VXNlcjU0NjI5MTE=","avatar_url":"https://avatars.githubusercontent.com/u/5462911?v=4","gravatar_id":"","url":"https://api.github.com/users/trevor211","html_url":"https://github.com/trevor211","followers_url":"https://api.github.com/users/trevor211/followers","following_url":"https://api.github.com/users/trevor211/following{/other_user}","gists_url":"https://api.github.com/users/trevor211/gists{/gist_id}","starred_url":"https://api.github.com/users/trevor211/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/trevor211/subscriptions","organizations_url":"https://api.github.com/users/trevor211/orgs","repos_url":"https://api.github.com/users/trevor211/repos","events_url":"https://api.github.com/users/trevor211/events{/privacy}","received_events_url":"https://api.github.com/users/trevor211/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-12T11:33:30Z","updated_at":"2023-04-12T11:33:30Z","author_association":"NONE","body":"> > > > > 我升级到了brpc1.4版本，依然没有解决这个问题，不断注入网络故障：ifconfig down/up bond的一个口，又复现了\r\n> > > > \r\n> > > > \r\n> > > > 请问你们网络故障注入的具体流程是怎样的，每次网络注入故障多久后恢复？\r\n> > > \r\n> > > \r\n> > > 我们是bond4组网，ifconfig down/up bond的其中一个网口，注入故障10s内随机，一直循环10几个小时，最后恢复\r\n> > \r\n> > \r\n> > 请问在你们的环境中，大概多久能够复现呢？\r\n> \r\n> 一般来说，这样的故障跑一个晚上，第二天早上看，brpc基本会出问题。最快的时候见过，1-2个小时就出了。 复现的时候还见过除了E112以外的错误，E1008，一直返回超时，抓包看，没有包发到server端，bvar看connection是残缺的，2天都没自动恢复，所以我猜也是处于假死状态\r\n\r\n请问你们的环境中，ifconfig up bond之后立即就进行下一轮的ifconfig down bond了吗？还是等待了一段时间呢？如果等待，等了多久呢？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1505114580/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1506190966","html_url":"https://github.com/apache/brpc/issues/2146#issuecomment-1506190966","issue_url":"https://api.github.com/repos/apache/brpc/issues/2146","id":1506190966,"node_id":"IC_kwDOBhmkcs5ZxqZ2","user":{"login":"jialei-jialei","id":13553842,"node_id":"MDQ6VXNlcjEzNTUzODQy","avatar_url":"https://avatars.githubusercontent.com/u/13553842?v=4","gravatar_id":"","url":"https://api.github.com/users/jialei-jialei","html_url":"https://github.com/jialei-jialei","followers_url":"https://api.github.com/users/jialei-jialei/followers","following_url":"https://api.github.com/users/jialei-jialei/following{/other_user}","gists_url":"https://api.github.com/users/jialei-jialei/gists{/gist_id}","starred_url":"https://api.github.com/users/jialei-jialei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jialei-jialei/subscriptions","organizations_url":"https://api.github.com/users/jialei-jialei/orgs","repos_url":"https://api.github.com/users/jialei-jialei/repos","events_url":"https://api.github.com/users/jialei-jialei/events{/privacy}","received_events_url":"https://api.github.com/users/jialei-jialei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-13T01:36:05Z","updated_at":"2023-04-13T01:36:05Z","author_association":"NONE","body":"> > > > > > 我升级到了brpc1.4版本，依然没有解决这个问题，不断注入网络故障：ifconfig down/up bond的一个口，又复现了\r\n> > > > > \r\n> > > > > \r\n> > > > > 请问你们网络故障注入的具体流程是怎样的，每次网络注入故障多久后恢复？\r\n> > > > \r\n> > > > \r\n> > > > 我们是bond4组网，ifconfig down/up bond的其中一个网口，注入故障10s内随机，一直循环10几个小时，最后恢复\r\n> > > \r\n> > > \r\n> > > 请问在你们的环境中，大概多久能够复现呢？\r\n> > \r\n> > \r\n> > 一般来说，这样的故障跑一个晚上，第二天早上看，brpc基本会出问题。最快的时候见过，1-2个小时就出了。 复现的时候还见过除了E112以外的错误，E1008，一直返回超时，抓包看，没有包发到server端，bvar看connection是残缺的，2天都没自动恢复，所以我猜也是处于假死状态\r\n> \r\n> 请问你们的环境中，ifconfig up bond之后立即就进行下一轮的ifconfig down bond了吗？还是等待了一段时间呢？如果等待，等了多久呢？\r\n\r\n这样表达，应该比较准确了：\r\nwhile (1) {\r\n  ifdown bond\r\n  sleep (rand(1, 99))\r\n  ifup bond\r\n  sleep(rand(1, 9))\r\n}\r\n这个方式只是复现的概率比较高，别的network restart，随机搞，也复现过","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1506190966/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1506261478","html_url":"https://github.com/apache/brpc/issues/2176#issuecomment-1506261478","issue_url":"https://api.github.com/repos/apache/brpc/issues/2176","id":1506261478,"node_id":"IC_kwDOBhmkcs5Zx7nm","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-13T03:00:13Z","updated_at":"2023-04-13T03:00:13Z","author_association":"NONE","body":"> > > 请问解决了么？看起来像是使用方式的问题\r\n> > \r\n> > \r\n> > 还没, 直连没问题, 使用grpc作为server也没问题, 就是使用apisix作为grpc网关会出问题\r\n> \r\n> 网上似乎有个类似的case [https://github.com/Kong/kong/issues/8316，](https://github.com/Kong/kong/issues/8316%EF%BC%8C) 感觉是apisix的问题😅\r\n\r\n链接没有内容,  grpc本身作为server没问题啊, 感觉是brpc作为grpc server 没完全适配grpc?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1506261478/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1506280140","html_url":"https://github.com/apache/brpc/pull/2207#issuecomment-1506280140","issue_url":"https://api.github.com/repos/apache/brpc/issues/2207","id":1506280140,"node_id":"IC_kwDOBhmkcs5ZyALM","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-13T03:26:13Z","updated_at":"2023-04-13T03:29:53Z","author_association":"CONTRIBUTOR","body":"UT中起了一些pthread线程调用同一个DoublyBufferedData实例的Read函数，发现随着线程数的增加，Read的性能会下降了很多。下面是ci上跑的结果：\r\n```shell\r\n[ RUN      ] LoadBalancerTest.performance\r\nI0413 03:14:47.417500 12655 brpc_load_balancer_unittest.cpp:1193]  thread_num=1 count=23258285 average_time=43.1315 qps=2.31849e+07\r\nI0413 03:14:48.421880 12655 brpc_load_balancer_unittest.cpp:1193]  thread_num=4 count=46279857 average_time=86.4463 qps=1.15679e+07\r\nI0413 03:14:49.426188 12655 brpc_load_balancer_unittest.cpp:1193]  thread_num=8 count=46356535 average_time=171.534 qps=5.82974e+06\r\nI0413 03:14:50.430695 12655 brpc_load_balancer_unittest.cpp:1193]  thread_num=12 count=46243444 average_time=256.458 qps=3.89927e+06\r\n```\r\n\r\nDoublyBufferedData中，不同线程之间的thread-local锁是没有竞争的，应该不会相互影响，导致性能下降才对。请问性能下降的原因是什么？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1506280140/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1506285505","html_url":"https://github.com/apache/brpc/pull/2207#issuecomment-1506285505","issue_url":"https://api.github.com/repos/apache/brpc/issues/2207","id":1506285505,"node_id":"IC_kwDOBhmkcs5ZyBfB","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-13T03:35:07Z","updated_at":"2023-04-18T10:00:11Z","author_association":"CONTRIBUTOR","body":"在自己的机器上测试，性能下降更加明显。\r\n\r\n```shell\r\nOS: Ubuntu 16.04 4.9.70-040970-generic\r\ncpu核数：64\r\nCompiler: GCC 5.4.0\r\n```\r\n\r\n```shell\r\nI0413 11:36:13.014777 {}  5136 18446744073709551615 brpc_doubly_buffered_data_unittest.cpp:414 [PerfTest]  thread_num=1 count=32320783 average_time=30.9982 qps=3.22599e+07\r\nI0413 11:36:14.018366 {}  5136 18446744073709551615 brpc_doubly_buffered_data_unittest.cpp:414 [PerfTest]  thread_num=4 count=5466436 average_time=732.553 qps=1.36509e+06\r\nI0413 11:36:15.022008 {}  5136 18446744073709551615 brpc_doubly_buffered_data_unittest.cpp:414 [PerfTest]  thread_num=8 count=5987282 average_time=1338.7 qps=746994\r\nI0413 11:36:16.026692 {}  5136 18446744073709551615 brpc_doubly_buffered_data_unittest.cpp:414 [PerfTest]  thread_num=12 count=5495214 average_time=2187.76 qps=457088\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1506285505/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1506295981","html_url":"https://github.com/apache/brpc/pull/2207#issuecomment-1506295981","issue_url":"https://api.github.com/repos/apache/brpc/issues/2207","id":1506295981,"node_id":"IC_kwDOBhmkcs5ZyECt","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-13T03:47:50Z","updated_at":"2023-04-13T03:47:50Z","author_association":"CONTRIBUTOR","body":"在自己机器上测试了每个pthread线程一个独立的pthread_mutex，只执行加锁解锁操作，性能下降的量级是一样的。\r\n\r\n```shell\r\nI0413 11:46:11.933795 {} 15638 18446744073709551615 brpc_doubly_buffered_data_unittest.cpp:414 [PerfTest]  thread_num=1 count=26259114 average_time=38.1216 qps=2.62318e+07\r\nI0413 11:46:12.937870 {} 15638 18446744073709551615 brpc_doubly_buffered_data_unittest.cpp:414 [PerfTest]  thread_num=4 count=4867834 average_time=823.195 qps=1.21478e+06\r\nI0413 11:46:13.941736 {} 15638 18446744073709551615 brpc_doubly_buffered_data_unittest.cpp:414 [PerfTest]  thread_num=8 count=4979021 average_time=1609.4 qps=621348\r\nI0413 11:46:14.945895 {} 15638 18446744073709551615 brpc_doubly_buffered_data_unittest.cpp:414 [PerfTest]  thread_num=12 count=5716892 average_time=2102.88 qps=475538\r\n```","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1506295981/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1506579232","html_url":"https://github.com/apache/brpc/issues/2208#issuecomment-1506579232","issue_url":"https://api.github.com/repos/apache/brpc/issues/2208","id":1506579232,"node_id":"IC_kwDOBhmkcs5ZzJMg","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-13T08:42:35Z","updated_at":"2023-04-13T08:42:42Z","author_association":"CONTRIBUTOR","body":"`jump_stack` 会切换到其他 bthread 执行任务，上下文切换了，当执行到下面的逻辑，`saved_errno` 和 `saved_unique_user_ptr`已经发生了更改，需要重新赋值。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1506579232/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1506662433","html_url":"https://github.com/apache/brpc/issues/2208#issuecomment-1506662433","issue_url":"https://api.github.com/repos/apache/brpc/issues/2208","id":1506662433,"node_id":"IC_kwDOBhmkcs5Zzdgh","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-13T09:39:57Z","updated_at":"2023-04-13T09:42:14Z","author_association":"NONE","body":"> `jump_stack` 会切换到其他 bthread 执行任务，上下文切换了，当执行到下面的逻辑，`saved_errno` 和 `saved_unique_user_ptr`已经发生了更改，需要重新赋值。\r\n\r\n我知道需要重新赋值, 我的意思是bthread首次运行, 那么在该bthread的栈里边还没有`saved_errno` 和 `saved_unique_user_ptr` 这两个局部变量啊, 那么这两个值对该 新bthread来说不是完全随机的么,  我理解某个用户自己`bthread_start_backgroud` 创建的 `bthread`首次执行的c++代码都是在jump_stack后面的那行代码吧","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1506662433/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1508066663","html_url":"https://github.com/apache/brpc/issues/1086#issuecomment-1508066663","issue_url":"https://api.github.com/repos/apache/brpc/issues/1086","id":1508066663,"node_id":"IC_kwDOBhmkcs5Z40Vn","user":{"login":"starrysky9959","id":47083984,"node_id":"MDQ6VXNlcjQ3MDgzOTg0","avatar_url":"https://avatars.githubusercontent.com/u/47083984?v=4","gravatar_id":"","url":"https://api.github.com/users/starrysky9959","html_url":"https://github.com/starrysky9959","followers_url":"https://api.github.com/users/starrysky9959/followers","following_url":"https://api.github.com/users/starrysky9959/following{/other_user}","gists_url":"https://api.github.com/users/starrysky9959/gists{/gist_id}","starred_url":"https://api.github.com/users/starrysky9959/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/starrysky9959/subscriptions","organizations_url":"https://api.github.com/users/starrysky9959/orgs","repos_url":"https://api.github.com/users/starrysky9959/repos","events_url":"https://api.github.com/users/starrysky9959/events{/privacy}","received_events_url":"https://api.github.com/users/starrysky9959/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-14T07:38:49Z","updated_at":"2023-04-14T07:43:59Z","author_association":"NONE","body":"```bash\r\n./mongodb/build/install/bin/mongod: symbol lookup error: /usr/lib/libbrpc.so: undefined symbol: pthread_mutex_lock\r\n```\r\n用静态链接一切正常，用动态链接能通过编译链接，但一运行就出现上述报错。nm看到的symbol和原issue一样，ldd看到的链接也都是正确的，尝试修改链接顺序还是没解决。\r\n\r\n> 使用cmake动态依赖brpc，编译显示正常，但是运行的时候报错： ![image](https://user-images.githubusercontent.com/29573385/79290344-718bc600-7efe-11ea-9948-909a47874238.png)\r\n> \r\n> nm查看libbrpc.so是有这个符号的 ![image](https://user-images.githubusercontent.com/29573385/79290386-8ff1c180-7efe-11ea-9365-75ac04a5ad17.png)\r\n> \r\n> ldd查看，可执行程序也确实链接了brpc和pthread，所以不知道问题出在哪里： ![image](https://user-images.githubusercontent.com/29573385/79290466-c2032380-7efe-11ea-87e6-28ff24e5f0c2.png)\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1508066663/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1510815256","html_url":"https://github.com/apache/brpc/pull/2202#issuecomment-1510815256","issue_url":"https://api.github.com/repos/apache/brpc/issues/2202","id":1510815256,"node_id":"IC_kwDOBhmkcs5aDTYY","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-17T07:06:01Z","updated_at":"2023-04-17T07:06:01Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1510815256/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1510816717","html_url":"https://github.com/apache/brpc/pull/2180#issuecomment-1510816717","issue_url":"https://api.github.com/repos/apache/brpc/issues/2180","id":1510816717,"node_id":"IC_kwDOBhmkcs5aDTvN","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-17T07:07:09Z","updated_at":"2023-04-17T07:07:09Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1510816717/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1510847680","html_url":"https://github.com/apache/brpc/pull/2168#issuecomment-1510847680","issue_url":"https://api.github.com/repos/apache/brpc/issues/2168","id":1510847680,"node_id":"IC_kwDOBhmkcs5aDbTA","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-17T07:32:47Z","updated_at":"2023-04-17T07:32:47Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1510847680/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1510849628","html_url":"https://github.com/apache/brpc/issues/2142#issuecomment-1510849628","issue_url":"https://api.github.com/repos/apache/brpc/issues/2142","id":1510849628,"node_id":"IC_kwDOBhmkcs5aDbxc","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-17T07:34:17Z","updated_at":"2023-04-17T07:34:17Z","author_association":"NONE","body":"@wayslog hi, 开发的怎么样了, 我可以协助一起开发","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1510849628/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1510854753","html_url":"https://github.com/apache/brpc/pull/2206#issuecomment-1510854753","issue_url":"https://api.github.com/repos/apache/brpc/issues/2206","id":1510854753,"node_id":"IC_kwDOBhmkcs5aDdBh","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-17T07:39:07Z","updated_at":"2023-04-17T07:39:07Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1510854753/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1510918042","html_url":"https://github.com/apache/brpc/issues/1086#issuecomment-1510918042","issue_url":"https://api.github.com/repos/apache/brpc/issues/1086","id":1510918042,"node_id":"IC_kwDOBhmkcs5aDsea","user":{"login":"starrysky9959","id":47083984,"node_id":"MDQ6VXNlcjQ3MDgzOTg0","avatar_url":"https://avatars.githubusercontent.com/u/47083984?v=4","gravatar_id":"","url":"https://api.github.com/users/starrysky9959","html_url":"https://github.com/starrysky9959","followers_url":"https://api.github.com/users/starrysky9959/followers","following_url":"https://api.github.com/users/starrysky9959/following{/other_user}","gists_url":"https://api.github.com/users/starrysky9959/gists{/gist_id}","starred_url":"https://api.github.com/users/starrysky9959/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/starrysky9959/subscriptions","organizations_url":"https://api.github.com/users/starrysky9959/orgs","repos_url":"https://api.github.com/users/starrysky9959/repos","events_url":"https://api.github.com/users/starrysky9959/events{/privacy}","received_events_url":"https://api.github.com/users/starrysky9959/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-17T08:25:27Z","updated_at":"2023-04-17T08:25:27Z","author_association":"NONE","body":"感觉本质是因为brpc通过`dlsym(RTLD_NEXT, \"pthread_mutex_lock\");`hook了`libpthread`中的`pthread_mutex_lock`方法导致的. `RTLD_NEXT`意味着在load dynamic libraries时, `libpthread`必须在`libbrpc`之后被load, 且两者中间不能有其他含有symbol为`pthread_mutex_lock`的library(虽然一般不会再有了). 以下几篇文章介绍了相关概念和实践.\r\n[https://optumsoft.com/dangers-of-using-dlsym-with-rtld_next/](https://optumsoft.com/dangers-of-using-dlsym-with-rtld_next/)\r\n\r\n[https://csstormq.github.io/blog/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%AF%87%E4%B9%8B%E9%93%BE%E6%8E%A5%EF%BC%8816%EF%BC%89%EF%BC%9A%E7%9C%9F%E6%AD%A3%E7%90%86%E8%A7%A3%20RTLD_NEXT%20%E7%9A%84%E4%BD%9C%E7%94%A8](https://csstormq.github.io/blog/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%B3%BB%E7%BB%9F%E7%AF%87%E4%B9%8B%E9%93%BE%E6%8E%A5%EF%BC%8816%EF%BC%89%EF%BC%9A%E7%9C%9F%E6%AD%A3%E7%90%86%E8%A7%A3%20RTLD_NEXT%20%E7%9A%84%E4%BD%9C%E7%94%A8)\r\n\r\n[https://zhuanlan.zhihu.com/p/44132805](https://zhuanlan.zhihu.com/p/44132805)\r\n\r\n\r\n我的项目中不方便修改pthread的链接位置，可以利用`LD_PRELOAD`来提前加载`libbrpc`以满足这一要求.\r\n```bash\r\nexport LD_PRELOAD=/lib/libbrpc.so\r\n```","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1510918042/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1511193631","html_url":"https://github.com/apache/brpc/issues/2209#issuecomment-1511193631","issue_url":"https://api.github.com/repos/apache/brpc/issues/2209","id":1511193631,"node_id":"IC_kwDOBhmkcs5aEvwf","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-17T11:49:31Z","updated_at":"2023-04-17T11:49:31Z","author_association":"CONTRIBUTOR","body":"是否可以把thread local的锁改成thread local的bthread::Mutex","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1511193631/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1511197353","html_url":"https://github.com/apache/brpc/issues/2203#issuecomment-1511197353","issue_url":"https://api.github.com/repos/apache/brpc/issues/2203","id":1511197353,"node_id":"IC_kwDOBhmkcs5aEwqp","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-17T11:52:28Z","updated_at":"2023-04-17T11:52:28Z","author_association":"CONTRIBUTOR","body":"可以把请求丢到bthread execution_queue去处理","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1511197353/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1511201564","html_url":"https://github.com/apache/brpc/pull/2121#issuecomment-1511201564","issue_url":"https://api.github.com/repos/apache/brpc/issues/2121","id":1511201564,"node_id":"IC_kwDOBhmkcs5aExsc","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-17T11:56:22Z","updated_at":"2023-04-17T11:56:22Z","author_association":"CONTRIBUTOR","body":"加了experimental命名空间","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1511201564/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1511518196","html_url":"https://github.com/apache/brpc/issues/2209#issuecomment-1511518196","issue_url":"https://api.github.com/repos/apache/brpc/issues/2209","id":1511518196,"node_id":"IC_kwDOBhmkcs5aF-_0","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-17T14:50:53Z","updated_at":"2023-04-17T14:50:53Z","author_association":"CONTRIBUTOR","body":"改成协程锁不太合适。thread local的线程锁是为了让不同线程之间的读无竞争的。如果换成了协程锁，某些情况下，对于同一个thread local的协程锁，会一直有竞争。例如，lb中使用了协程锁的实现，在更新实例信息时，读协程会被挂起，读协程被唤醒时可能被调度到其他worker线程。如果这些读协程比较多，则会跟后续的读协程形成竞争，导致后续的读协程被挂起，从而调度到其他worker线程。这个场景下，可能竞争就会一直存在了。所以使用线程锁比较合适吧。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1511518196/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1511535394","html_url":"https://github.com/apache/brpc/issues/2209#issuecomment-1511535394","issue_url":"https://api.github.com/repos/apache/brpc/issues/2209","id":1511535394,"node_id":"IC_kwDOBhmkcs5aGDMi","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-17T15:00:13Z","updated_at":"2023-04-18T07:18:02Z","author_association":"CONTRIBUTOR","body":"前面的方案对于写线程有一点比较友好：有一些读线程在写线程加锁前就看到了新前台，且已经不再读老前台了。写线程不需要等这些读线程，只需要等那些还在读老前台的读线程就行了。原来的写线程需要等读线程读完才能获取到锁。\r\n\r\n但是前面的方案不再支持保存用户自定义TLS数据了，即不支持DoublyBufferedData的第二个模板参数TLS。\r\n`template <typename T, typename TLS> class DoublyBufferedData;`","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1511535394/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1512363650","html_url":"https://github.com/apache/brpc/pull/2207#issuecomment-1512363650","issue_url":"https://api.github.com/repos/apache/brpc/issues/2207","id":1512363650,"node_id":"IC_kwDOBhmkcs5aJNaC","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-04-18T02:57:50Z","updated_at":"2023-04-18T02:57:50Z","author_association":"CONTRIBUTOR","body":"增加了在读的过程中更新DoublyBufferedData的场景","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1512363650/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]