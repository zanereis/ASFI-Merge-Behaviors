[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/860778557","html_url":"https://github.com/apache/couchdb/issues/3308#issuecomment-860778557","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3308","id":860778557,"node_id":"MDEyOklzc3VlQ29tbWVudDg2MDc3ODU1Nw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-14T15:29:46Z","updated_at":"2021-06-14T15:29:46Z","author_association":"CONTRIBUTOR","body":"> I am not able to understand this, not an expert on this matter. Are you suggesting that few steps of replication can be combined onto a single connections ?\r\n\r\nExactly! That's how connection sharing works. After the TCP connection is established to a host, port, SSL session is setup, it can be reused for multiple requests:\r\n\r\n*  `Connect to 192.168.1.1:443 + do the SSL handshake...`\r\n   * `GET /mydb  ...`\r\n   * `GET /mydb/_local/doc ...`\r\n\r\nThe time to connect and do the SSL handshake can be expensive, so instead of tearing down the connection and making a new one every time, it can be re-used. Some client libraries can do this too, for example with requests is may look like: https://docs.python-requests.org/en/master/user/advanced/\r\n\r\n\r\n   ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/860778557/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/860816607","html_url":"https://github.com/apache/couchdb/issues/3282#issuecomment-860816607","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3282","id":860816607,"node_id":"MDEyOklzc3VlQ29tbWVudDg2MDgxNjYwNw==","user":{"login":"itsmrajesh","id":39943032,"node_id":"MDQ6VXNlcjM5OTQzMDMy","avatar_url":"https://avatars.githubusercontent.com/u/39943032?v=4","gravatar_id":"","url":"https://api.github.com/users/itsmrajesh","html_url":"https://github.com/itsmrajesh","followers_url":"https://api.github.com/users/itsmrajesh/followers","following_url":"https://api.github.com/users/itsmrajesh/following{/other_user}","gists_url":"https://api.github.com/users/itsmrajesh/gists{/gist_id}","starred_url":"https://api.github.com/users/itsmrajesh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/itsmrajesh/subscriptions","organizations_url":"https://api.github.com/users/itsmrajesh/orgs","repos_url":"https://api.github.com/users/itsmrajesh/repos","events_url":"https://api.github.com/users/itsmrajesh/events{/privacy}","received_events_url":"https://api.github.com/users/itsmrajesh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-14T16:22:31Z","updated_at":"2021-06-14T16:22:31Z","author_association":"NONE","body":"It worked for me\r\n\r\nCouchDB Version: 3.1.1\r\n\r\nPOST: http://username:password@localhost:5984/_users\r\n\r\nHeader: content-type: application/json\r\n\r\nbody: \r\n\r\n```json\r\n{\r\n\r\n    \"_id\": \"org.couchdb.user:john\",\r\n\r\n    \"username\": \"john\",\r\n\r\n    \"type\": \"user\",\r\n\r\n    \"name\": \"john\",\r\n\r\n    \"password\": \"john@123\",\r\n\r\n    \"roles\": [\r\n\r\n        \"user\"\r\n\r\n    ]\r\n\r\n}\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/860816607/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/860998922","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-860998922","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":860998922,"node_id":"MDEyOklzc3VlQ29tbWVudDg2MDk5ODkyMg==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-14T21:13:36Z","updated_at":"2021-06-14T21:13:36Z","author_association":"CONTRIBUTOR","body":"> We did consider this format before as the opinionated style, as we very much liked this idea from Elixir.\r\n> But we found this style is uncommon in most erlang code bases.\r\n\r\n@awalterschulze Thanks, and I appreciate the nuances of the argument.\r\n\r\nWhen I first started with Erlang, I only ever recall seeing 1 empty line between functions and 0 between function clauses. However, in CouchDB it's essentially the standard (as sporadically enforced/suggested by [emilio](https://github.com/cloudant-labs/emilio)), and I've come to find it much more readable than the more common format.\r\n\r\nIMO, just because it's uncommon, doesn't mean it's worse.\r\n\r\nAnd if _erlfmt_ opinionatedly enforced that style, just think how much more common it could become!  ;)\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/860998922/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/863332986","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-863332986","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":863332986,"node_id":"MDEyOklzc3VlQ29tbWVudDg2MzMzMjk4Ng==","user":{"login":"awalterschulze","id":1829933,"node_id":"MDQ6VXNlcjE4Mjk5MzM=","avatar_url":"https://avatars.githubusercontent.com/u/1829933?v=4","gravatar_id":"","url":"https://api.github.com/users/awalterschulze","html_url":"https://github.com/awalterschulze","followers_url":"https://api.github.com/users/awalterschulze/followers","following_url":"https://api.github.com/users/awalterschulze/following{/other_user}","gists_url":"https://api.github.com/users/awalterschulze/gists{/gist_id}","starred_url":"https://api.github.com/users/awalterschulze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/awalterschulze/subscriptions","organizations_url":"https://api.github.com/users/awalterschulze/orgs","repos_url":"https://api.github.com/users/awalterschulze/repos","events_url":"https://api.github.com/users/awalterschulze/events{/privacy}","received_events_url":"https://api.github.com/users/awalterschulze/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-17T15:22:42Z","updated_at":"2021-06-17T15:22:42Z","author_association":"NONE","body":"> IMO, just because it's uncommon, doesn't mean it's worse.\r\n\r\nYeah I agree.   I am not saying our style is better.\r\nWe tried to mostly enforce the style that already exists in the erlang community, to increase chances of adoption rather than create a new better style.  We didn't achieve this in all cases, but this is at least what we tried to do.\r\nWe believe standardizing is more important than the exact style chosen.\r\nI hope that makes some sense.\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/863332986/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/863489694","html_url":"https://github.com/apache/couchdb/issues/3631#issuecomment-863489694","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3631","id":863489694,"node_id":"MDEyOklzc3VlQ29tbWVudDg2MzQ4OTY5NA==","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-17T19:00:32Z","updated_at":"2021-06-17T19:00:32Z","author_association":"CONTRIBUTOR","body":"Alright, I've opened up a CouchDB PR that fixes the `mem3_shards`, `fabric_util`, and `dreyfus_rpc` issues in https://github.com/apache/couchdb/pull/3633.\r\n\r\nI've got a related PR for the Hastings issue in: https://github.com/cloudant-labs/hastings/pull/31.\r\n\r\nI've left the 5986 creation of PQ shards issue as is, feedback welcome on what we should do there (if anything).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/863489694/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/863933342","html_url":"https://github.com/apache/couchdb/issues/3630#issuecomment-863933342","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3630","id":863933342,"node_id":"MDEyOklzc3VlQ29tbWVudDg2MzkzMzM0Mg==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-18T10:22:27Z","updated_at":"2021-06-18T10:22:27Z","author_association":"MEMBER","body":"hey hey, just a quick note without going into too much detail. The test you are running (creating a lot a lot of databases in a tight loop) is not a use-case that CouchDB 3.x will be very happy with. I’m sure there are things we can improve, but this isn’t a use-case I see us optimising for a lot, unless someone contributes compelling PRs.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/863933342/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/863951758","html_url":"https://github.com/apache/couchdb/pull/3632#issuecomment-863951758","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3632","id":863951758,"node_id":"MDEyOklzc3VlQ29tbWVudDg2Mzk1MTc1OA==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-18T10:56:02Z","updated_at":"2021-06-18T10:56:02Z","author_association":"CONTRIBUTOR","body":"Should we log cases when the configured size exceeds the limit? ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/863951758/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/864076808","html_url":"https://github.com/apache/couchdb/issues/3630#issuecomment-864076808","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3630","id":864076808,"node_id":"MDEyOklzc3VlQ29tbWVudDg2NDA3NjgwOA==","user":{"login":"vladimirralev","id":202417,"node_id":"MDQ6VXNlcjIwMjQxNw==","avatar_url":"https://avatars.githubusercontent.com/u/202417?v=4","gravatar_id":"","url":"https://api.github.com/users/vladimirralev","html_url":"https://github.com/vladimirralev","followers_url":"https://api.github.com/users/vladimirralev/followers","following_url":"https://api.github.com/users/vladimirralev/following{/other_user}","gists_url":"https://api.github.com/users/vladimirralev/gists{/gist_id}","starred_url":"https://api.github.com/users/vladimirralev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vladimirralev/subscriptions","organizations_url":"https://api.github.com/users/vladimirralev/orgs","repos_url":"https://api.github.com/users/vladimirralev/repos","events_url":"https://api.github.com/users/vladimirralev/events{/privacy}","received_events_url":"https://api.github.com/users/vladimirralev/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-18T14:23:36Z","updated_at":"2021-06-18T14:23:36Z","author_association":"NONE","body":"Thanks for the response. I think this loop is a common backup strategy - just replicate all DBs to a backup server as fast as you can overnight or otherwise. Sometimes in parallel.\r\n\r\nThat being said, this issue has been observed with a slow buildup of databases and the rate of creating the DBs in the example is probably not related to the root cause. I'll be trying to find the root cause of this and any hints are appreciated.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/864076808/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/864898487","html_url":"https://github.com/apache/couchdb/issues/3631#issuecomment-864898487","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3631","id":864898487,"node_id":"MDEyOklzc3VlQ29tbWVudDg2NDg5ODQ4Nw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-21T09:51:56Z","updated_at":"2021-06-21T09:51:56Z","author_association":"MEMBER","body":"@chewbranca exceptional sleuthing, thanks for putting all this together.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/864898487/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/864899924","html_url":"https://github.com/apache/couchdb/pull/3633#issuecomment-864899924","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3633","id":864899924,"node_id":"MDEyOklzc3VlQ29tbWVudDg2NDg5OTkyNA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-21T09:54:23Z","updated_at":"2021-06-21T09:54:23Z","author_association":"MEMBER","body":"I like this, modulo the things mentioned by @iilyak ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/864899924/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/865990065","html_url":"https://github.com/apache/couchdb/issues/3239#issuecomment-865990065","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3239","id":865990065,"node_id":"MDEyOklzc3VlQ29tbWVudDg2NTk5MDA2NQ==","user":{"login":"ricellis","id":10698320,"node_id":"MDQ6VXNlcjEwNjk4MzIw","avatar_url":"https://avatars.githubusercontent.com/u/10698320?v=4","gravatar_id":"","url":"https://api.github.com/users/ricellis","html_url":"https://github.com/ricellis","followers_url":"https://api.github.com/users/ricellis/followers","following_url":"https://api.github.com/users/ricellis/following{/other_user}","gists_url":"https://api.github.com/users/ricellis/gists{/gist_id}","starred_url":"https://api.github.com/users/ricellis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ricellis/subscriptions","organizations_url":"https://api.github.com/users/ricellis/orgs","repos_url":"https://api.github.com/users/ricellis/repos","events_url":"https://api.github.com/users/ricellis/events{/privacy}","received_events_url":"https://api.github.com/users/ricellis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-22T13:35:50Z","updated_at":"2021-06-22T13:35:50Z","author_association":"NONE","body":"This is probably related to https://github.com/apache/couchdb/issues/2235 and friends.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/865990065/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/866313261","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-866313261","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":866313261,"node_id":"MDEyOklzc3VlQ29tbWVudDg2NjMxMzI2MQ==","user":{"login":"noahshaw11","id":47468872,"node_id":"MDQ6VXNlcjQ3NDY4ODcy","avatar_url":"https://avatars.githubusercontent.com/u/47468872?v=4","gravatar_id":"","url":"https://api.github.com/users/noahshaw11","html_url":"https://github.com/noahshaw11","followers_url":"https://api.github.com/users/noahshaw11/followers","following_url":"https://api.github.com/users/noahshaw11/following{/other_user}","gists_url":"https://api.github.com/users/noahshaw11/gists{/gist_id}","starred_url":"https://api.github.com/users/noahshaw11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahshaw11/subscriptions","organizations_url":"https://api.github.com/users/noahshaw11/orgs","repos_url":"https://api.github.com/users/noahshaw11/repos","events_url":"https://api.github.com/users/noahshaw11/events{/privacy}","received_events_url":"https://api.github.com/users/noahshaw11/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-22T20:31:50Z","updated_at":"2021-06-22T20:31:50Z","author_association":"CONTRIBUTOR","body":"Being a new hire and contributor, I highly advocate for a universal standard for formatting. I spend a lot of time on formatting and use the format of other source code to make formatting decisions (often incorrectly). Not to mention having a wonderful script to handle the formatting for me.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/866313261/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/867145131","html_url":"https://github.com/apache/couchdb/issues/3473#issuecomment-867145131","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3473","id":867145131,"node_id":"MDEyOklzc3VlQ29tbWVudDg2NzE0NTEzMQ==","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-23T20:44:08Z","updated_at":"2021-06-23T20:44:08Z","author_association":"CONTRIBUTOR","body":"If the aim is to get `default.ini` to be fully commented, then I think it would be prudent to delete `config:get/2` [1] which injects a default value in. If we're expecting to have the config options fully defined in code, then i don't think there is a scenario where having a config value lookup but not having a default valued defined in the code is appropriate.\r\n\r\n[1] https://github.com/apache/couchdb-config/blob/main/src/config.erl#L156-L157","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/867145131/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/867531612","html_url":"https://github.com/apache/couchdb/pull/3636#issuecomment-867531612","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3636","id":867531612,"node_id":"MDEyOklzc3VlQ29tbWVudDg2NzUzMTYxMg==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-24T10:39:36Z","updated_at":"2021-06-24T10:39:36Z","author_association":"CONTRIBUTOR","body":" Very nice work. Thank you.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/867531612/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/867613831","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-867613831","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":867613831,"node_id":"MDEyOklzc3VlQ29tbWVudDg2NzYxMzgzMQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-24T12:55:36Z","updated_at":"2021-06-24T14:09:32Z","author_association":"MEMBER","body":"Thank you all for the reviews and contribution! I'm about to merge this.\r\n\r\nEdit: right after a rebase...","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/867613831/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":2,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/867747381","html_url":"https://github.com/apache/couchdb/issues/3473#issuecomment-867747381","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3473","id":867747381,"node_id":"MDEyOklzc3VlQ29tbWVudDg2Nzc0NzM4MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-24T15:47:56Z","updated_at":"2021-06-24T15:47:56Z","author_association":"MEMBER","body":"Nice work @jiahuili430 @iilyak and others!\r\n\r\n@chewbranca given this got closed, can you open a new issue for your comment?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/867747381/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/867929586","html_url":"https://github.com/apache/couchdb/pull/3633#issuecomment-867929586","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3633","id":867929586,"node_id":"MDEyOklzc3VlQ29tbWVudDg2NzkyOTU4Ng==","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-24T20:27:23Z","updated_at":"2021-06-24T20:27:23Z","author_association":"CONTRIBUTOR","body":"Huzzah, the test case and the temporary patch to rewind the fix resulted in CI detecting the failure: https://ci-couchdb.apache.org/job/jenkins-cm1/job/PullRequests/job/PR-3633/3/execution/node/127/log/?cloudbees-analytics-link=scm-reporting%2Ferror%2Fstep\r\n\r\n```\r\n13:15:36  module 'mem3_shards_test'\r\n13:15:36    mem3 shards partition query database properties tests\r\n13:15:41      mem3_shards_test:67: partitioned_shards_recreated_properly...*failed*\r\n13:15:41  in function mem3_shards_test:'-partitioned_shards_recreated_properly/1-fun-3-'/1 (test/eunit/mem3_shards_test.erl, line 78)\r\n13:15:41  in call from eunit_test:run_testfun/1 (eunit_test.erl, line 71)\r\n13:15:41  in call from eunit_proc:run_test/1 (eunit_proc.erl, line 510)\r\n13:15:41  in call from eunit_proc:with_timeout/3 (eunit_proc.erl, line 335)\r\n13:15:41  in call from eunit_proc:handle_test/2 (eunit_proc.erl, line 493)\r\n13:15:41  in call from eunit_proc:tests_inorder/3 (eunit_proc.erl, line 435)\r\n13:15:41  in call from eunit_proc:with_timeout/3 (eunit_proc.erl, line 325)\r\n13:15:41  in call from eunit_proc:run_group/2 (eunit_proc.erl, line 549)\r\n13:15:41  **error:{assert,[{module,mem3_shards_test},\r\n13:15:41           {line,78},\r\n13:15:41           {expression,\"is_partitioned ( Shard )\"},\r\n13:15:41           {expected,true},\r\n13:15:41           {value,false}]}\r\n13:15:41    output:<<\"\">>\r\n13:15:41  \r\n13:15:41      [done in 5.145 s]\r\n13:15:41    [done in 5.316 s]\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/867929586/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/867931038","html_url":"https://github.com/apache/couchdb/issues/3631#issuecomment-867931038","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3631","id":867931038,"node_id":"MDEyOklzc3VlQ29tbWVudDg2NzkzMTAzOA==","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-24T20:28:53Z","updated_at":"2021-06-24T20:28:53Z","author_association":"CONTRIBUTOR","body":"I managed to come up with a sneaky test case to induce one of these failures and confirmed it fails in CI: https://github.com/apache/couchdb/pull/3633#issuecomment-867929586","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/867931038/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/868083529","html_url":"https://github.com/apache/couchdb/pull/3633#issuecomment-868083529","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3633","id":868083529,"node_id":"MDEyOklzc3VlQ29tbWVudDg2ODA4MzUyOQ==","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-25T00:01:31Z","updated_at":"2021-06-25T00:01:31Z","author_association":"CONTRIBUTOR","body":"@janl @iilyak @tonysun83 alright I've reworked the current approach and managed to simplify things a fair bit. I looked closer and I don't think there's any advantage to using `couch_server:create` directly rather than indirectly by way of `couch_server:open with create_if_missing=true`.\r\n\r\nI think the new approach in this PR is decent, although still somewhat awkward in that `fabric_util:get_db` needs to potentially pass down the options. I've come up with an alternative strategy that simplifies things further in https://github.com/apache/couchdb/commit/b518f753339f9efa70ac82187afacd3b1d57cfed","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/868083529/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/868929899","html_url":"https://github.com/apache/couchdb/pull/3643#issuecomment-868929899","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3643","id":868929899,"node_id":"MDEyOklzc3VlQ29tbWVudDg2ODkyOTg5OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-26T02:22:01Z","updated_at":"2021-06-26T02:22:01Z","author_association":"MEMBER","body":"@jiahuili430 Did you mean to close this? It seems promising!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/868929899/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/868930340","html_url":"https://github.com/apache/couchdb/pull/3643#issuecomment-868930340","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3643","id":868930340,"node_id":"MDEyOklzc3VlQ29tbWVudDg2ODkzMDM0MA==","user":{"login":"jiahuili430","id":54631519,"node_id":"MDQ6VXNlcjU0NjMxNTE5","avatar_url":"https://avatars.githubusercontent.com/u/54631519?v=4","gravatar_id":"","url":"https://api.github.com/users/jiahuili430","html_url":"https://github.com/jiahuili430","followers_url":"https://api.github.com/users/jiahuili430/followers","following_url":"https://api.github.com/users/jiahuili430/following{/other_user}","gists_url":"https://api.github.com/users/jiahuili430/gists{/gist_id}","starred_url":"https://api.github.com/users/jiahuili430/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiahuili430/subscriptions","organizations_url":"https://api.github.com/users/jiahuili430/orgs","repos_url":"https://api.github.com/users/jiahuili430/repos","events_url":"https://api.github.com/users/jiahuili430/events{/privacy}","received_events_url":"https://api.github.com/users/jiahuili430/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-26T02:25:48Z","updated_at":"2021-06-26T02:25:48Z","author_association":"CONTRIBUTOR","body":"I will reopen this PR, and try to finish it next week.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/868930340/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/869580199","html_url":"https://github.com/apache/couchdb/pull/3568#issuecomment-869580199","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3568","id":869580199,"node_id":"MDEyOklzc3VlQ29tbWVudDg2OTU4MDE5OQ==","user":{"login":"slaykachu","id":53991702,"node_id":"MDQ6VXNlcjUzOTkxNzAy","avatar_url":"https://avatars.githubusercontent.com/u/53991702?v=4","gravatar_id":"","url":"https://api.github.com/users/slaykachu","html_url":"https://github.com/slaykachu","followers_url":"https://api.github.com/users/slaykachu/followers","following_url":"https://api.github.com/users/slaykachu/following{/other_user}","gists_url":"https://api.github.com/users/slaykachu/gists{/gist_id}","starred_url":"https://api.github.com/users/slaykachu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/slaykachu/subscriptions","organizations_url":"https://api.github.com/users/slaykachu/orgs","repos_url":"https://api.github.com/users/slaykachu/repos","events_url":"https://api.github.com/users/slaykachu/events{/privacy}","received_events_url":"https://api.github.com/users/slaykachu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-28T10:48:03Z","updated_at":"2021-06-28T10:48:15Z","author_association":"NONE","body":"> Seems like a lot of these changes are nice improvements, but some (like the 2 I've flagged) are much more intrusive. How much control do we have over the opinions of erlfmt?\r\n\r\nHi! You can disable formatting of a top-level expression with: \r\n```erlang\r\n%% erlfmt-ignore\r\n```\r\n\r\nTo disable formatting for the whole file, add this magic comment as first line: \r\n```erlang\r\n%%% % @format\r\n```\r\n\r\nYou might also be interested by ['respecting original format'](https://github.com/WhatsApp/erlfmt#respecting-original-format) hints.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/869580199/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/869588631","html_url":"https://github.com/apache/couchdb/pull/3640#issuecomment-869588631","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3640","id":869588631,"node_id":"MDEyOklzc3VlQ29tbWVudDg2OTU4ODYzMQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-28T11:02:31Z","updated_at":"2021-06-28T11:02:31Z","author_association":"MEMBER","body":"Thank you for the review, @nickva ! I'm about to merge this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/869588631/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/869622707","html_url":"https://github.com/apache/couchdb/pull/3639#issuecomment-869622707","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3639","id":869622707,"node_id":"MDEyOklzc3VlQ29tbWVudDg2OTYyMjcwNw==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-28T11:59:08Z","updated_at":"2021-06-28T11:59:08Z","author_association":"MEMBER","body":"Thank you for the review, @iilyak ! I'm about to merge this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/869622707/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/870118002","html_url":"https://github.com/apache/couchdb/issues/2080#issuecomment-870118002","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2080","id":870118002,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MDExODAwMg==","user":{"login":"mrsarm","id":1608415,"node_id":"MDQ6VXNlcjE2MDg0MTU=","avatar_url":"https://avatars.githubusercontent.com/u/1608415?v=4","gravatar_id":"","url":"https://api.github.com/users/mrsarm","html_url":"https://github.com/mrsarm","followers_url":"https://api.github.com/users/mrsarm/followers","following_url":"https://api.github.com/users/mrsarm/following{/other_user}","gists_url":"https://api.github.com/users/mrsarm/gists{/gist_id}","starred_url":"https://api.github.com/users/mrsarm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mrsarm/subscriptions","organizations_url":"https://api.github.com/users/mrsarm/orgs","repos_url":"https://api.github.com/users/mrsarm/repos","events_url":"https://api.github.com/users/mrsarm/events{/privacy}","received_events_url":"https://api.github.com/users/mrsarm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-28T23:38:26Z","updated_at":"2021-06-28T23:39:04Z","author_association":"NONE","body":"I don't know how Vagrant VM works, but must be similar to Docker creating its own network environment, in my cases I was getting this `...{conn_failed,{error,nxdomain}}...` error trying to sync 2 Couch DBs, one running locally and the other in a Docker container, and turns out it was because `somename.localhost` added to my `/etc/hosts` is not available in my Docker containers (because it has its own `/etc/hosts`), so clearly the message says that the domain name cannot be resolved and it was because of that. Solution: use the local IP of your machine instead of a domain name, e.g. 192.168.0.34.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/870118002/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/870334867","html_url":"https://github.com/apache/couchdb/pull/3638#issuecomment-870334867","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3638","id":870334867,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MDMzNDg2Nw==","user":{"login":"flimzy","id":8555063,"node_id":"MDQ6VXNlcjg1NTUwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8555063?v=4","gravatar_id":"","url":"https://api.github.com/users/flimzy","html_url":"https://github.com/flimzy","followers_url":"https://api.github.com/users/flimzy/followers","following_url":"https://api.github.com/users/flimzy/following{/other_user}","gists_url":"https://api.github.com/users/flimzy/gists{/gist_id}","starred_url":"https://api.github.com/users/flimzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flimzy/subscriptions","organizations_url":"https://api.github.com/users/flimzy/orgs","repos_url":"https://api.github.com/users/flimzy/repos","events_url":"https://api.github.com/users/flimzy/events{/privacy}","received_events_url":"https://api.github.com/users/flimzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-29T07:10:48Z","updated_at":"2021-06-29T07:10:48Z","author_association":"MEMBER","body":"Thanks for fixing this long-standing bug!  I'm in favor of merging it as soon as responsibly possible.  It is clearly a bug, but it's also such a long-standing one that merging it before a major release is likely to break someone, somewhere.  So as much as I'd love to see this merged into the 3.x branch, and I think a strong case can be made for that, the responsible thing is probably to merge it whenever 4.x lands.  Whatever workarounds people have been using since 1.x can continue to work until 4.x lands, I suppose.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/870334867/reactions","total_count":4,"+1":4,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/870453565","html_url":"https://github.com/apache/couchdb/issues/3517#issuecomment-870453565","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3517","id":870453565,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MDQ1MzU2NQ==","user":{"login":"konrad-ohms","id":40577406,"node_id":"MDQ6VXNlcjQwNTc3NDA2","avatar_url":"https://avatars.githubusercontent.com/u/40577406?v=4","gravatar_id":"","url":"https://api.github.com/users/konrad-ohms","html_url":"https://github.com/konrad-ohms","followers_url":"https://api.github.com/users/konrad-ohms/followers","following_url":"https://api.github.com/users/konrad-ohms/following{/other_user}","gists_url":"https://api.github.com/users/konrad-ohms/gists{/gist_id}","starred_url":"https://api.github.com/users/konrad-ohms/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/konrad-ohms/subscriptions","organizations_url":"https://api.github.com/users/konrad-ohms/orgs","repos_url":"https://api.github.com/users/konrad-ohms/repos","events_url":"https://api.github.com/users/konrad-ohms/events{/privacy}","received_events_url":"https://api.github.com/users/konrad-ohms/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-29T09:57:16Z","updated_at":"2021-06-29T09:57:16Z","author_association":"NONE","body":"Friendly reminder, if anyone could have a look, please?\r\nIt is blocking us to upgrade to CouchDB v3 at the moment.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/870453565/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/870692907","html_url":"https://github.com/apache/couchdb/pull/3643#issuecomment-870692907","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3643","id":870692907,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MDY5MjkwNw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-29T15:20:29Z","updated_at":"2021-06-29T15:20:29Z","author_association":"CONTRIBUTOR","body":"Do we recall the reason we couldn't use the Erlang provided `tls_dist` as described here: http://www1.erlang.org/doc/apps/ssl/ssl_distribution.html and use a custom module?\r\n\r\nAlso currently it seems this module won't be used anywhere it's not referenced from any place in the code (even in comments)\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/870692907/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/870885247","html_url":"https://github.com/apache/couchdb/pull/3632#issuecomment-870885247","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3632","id":870885247,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MDg4NTI0Nw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-29T20:13:55Z","updated_at":"2021-06-29T20:13:55Z","author_association":"CONTRIBUTOR","body":"For `max_document_id_length` I think it was chosen as 512 in the ML discussion. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/870885247/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/871589996","html_url":"https://github.com/apache/couchdb/pull/3632#issuecomment-871589996","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3632","id":871589996,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MTU4OTk5Ng==","user":{"login":"noahshaw11","id":47468872,"node_id":"MDQ6VXNlcjQ3NDY4ODcy","avatar_url":"https://avatars.githubusercontent.com/u/47468872?v=4","gravatar_id":"","url":"https://api.github.com/users/noahshaw11","html_url":"https://github.com/noahshaw11","followers_url":"https://api.github.com/users/noahshaw11/followers","following_url":"https://api.github.com/users/noahshaw11/following{/other_user}","gists_url":"https://api.github.com/users/noahshaw11/gists{/gist_id}","starred_url":"https://api.github.com/users/noahshaw11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahshaw11/subscriptions","organizations_url":"https://api.github.com/users/noahshaw11/orgs","repos_url":"https://api.github.com/users/noahshaw11/repos","events_url":"https://api.github.com/users/noahshaw11/events{/privacy}","received_events_url":"https://api.github.com/users/noahshaw11/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-30T17:20:57Z","updated_at":"2021-06-30T17:20:57Z","author_association":"CONTRIBUTOR","body":"> For `max_document_id_length` I think it was chosen as 512 in the ML discussion.\r\n\r\n`max_document_id_length` has been changed to 512 bytes instead of 238 bytes. 238 bytes was intended for the database name, not document ID.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/871589996/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/871816720","html_url":"https://github.com/apache/couchdb/pull/3633#issuecomment-871816720","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3633","id":871816720,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MTgxNjcyMA==","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-01T00:31:03Z","updated_at":"2021-07-01T00:31:03Z","author_association":"CONTRIBUTOR","body":"Alright, I've reworked the logic and pushed out a temporary proof of concept in fe75790d9. I took a closer look and the only thing that actually needs to use `couch_db:open` (or at least is _currently_ using it), so I duplicated the `mem3_util:get_or_create_db` function into a `get_or_create_db_int` version, where the differences between the two are `couch_db:open` vs `couch_db:open_int`. Turns out the `dreyfus_rpc` logic is kind of a middle ground, where it uses `open_int` to try and open the db in the fast case, but when it fails it goes through `couch_server:create` which performs the same validations that `couch_server:open` does. I don't want to merge this with the duplication, but I think that commit at least more clearly demonstrates the difference instances. Feedback welcome.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/871816720/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/871900635","html_url":"https://github.com/apache/couchdb/pull/3643#issuecomment-871900635","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3643","id":871900635,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MTkwMDYzNQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-01T04:10:25Z","updated_at":"2021-07-01T04:10:25Z","author_association":"CONTRIBUTOR","body":"It still seems we are just proxy-ing the callbacks directly to the Erlang/OTP provided `inet_tls` module?  So our module is not doing anything differently than the legacy behavior as described in https://erlang.org/doc/apps/ssl/ssl_distribution.html. There is even a newer way of specifying just a single conf file, which seems nice  `-proto_dist inet_tls  -ssl_dist_optfile \"/path/to/tls.conf\"` but perhaps we can just refer to those docs in the vm.arg or docs files.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/871900635/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/872093165","html_url":"https://github.com/apache/couchdb/issues/2868#issuecomment-872093165","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2868","id":872093165,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MjA5MzE2NQ==","user":{"login":"ErandaPeiris","id":36532414,"node_id":"MDQ6VXNlcjM2NTMyNDE0","avatar_url":"https://avatars.githubusercontent.com/u/36532414?v=4","gravatar_id":"","url":"https://api.github.com/users/ErandaPeiris","html_url":"https://github.com/ErandaPeiris","followers_url":"https://api.github.com/users/ErandaPeiris/followers","following_url":"https://api.github.com/users/ErandaPeiris/following{/other_user}","gists_url":"https://api.github.com/users/ErandaPeiris/gists{/gist_id}","starred_url":"https://api.github.com/users/ErandaPeiris/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ErandaPeiris/subscriptions","organizations_url":"https://api.github.com/users/ErandaPeiris/orgs","repos_url":"https://api.github.com/users/ErandaPeiris/repos","events_url":"https://api.github.com/users/ErandaPeiris/events{/privacy}","received_events_url":"https://api.github.com/users/ErandaPeiris/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-01T09:41:08Z","updated_at":"2021-07-01T09:43:19Z","author_association":"NONE","body":"Hi, \r\nI did the same steps but still, the issue remains. \r\n\r\n# sudo apt install -y couchdb\r\nReading package lists... Done\r\nBuilding dependency tree\r\nReading state information... Done\r\nSome packages could not be installed. This may mean that you have\r\nrequested an impossible situation or if you are using the unstable\r\ndistribution that some required packages have not yet been created\r\nor been moved out of Incoming.\r\nThe following information may help to resolve the situation:\r\n\r\nThe following packages have unmet dependencies:\r\n couchdb : Depends: libmozjs-68-0 (>= 68.6.0) but it is not installable\r\n           Depends: libc6 (>= 2.29) but 2.27-3ubuntu1.2 is to be installed\r\n           Depends: libgcc-s1 (>= 3.3.1) but it is not installable\r\n           Depends: libicu66 (>= 66.1-1~) but it is not installable\r\n           Depends: libstdc++6 (>= 9) but 8.4.0-1ubuntu1~18.04 is to be installed\r\n           Depends: libtinfo6 (>= 6) but it is not installable\r\nW: Target Packages (main/binary-amd64/Packages) is configured multiple times in /etc/apt/sources.list:58 and /etc/apt/sources.list.d/couchdb.list:1\r\nW: Target Packages (main/binary-all/Packages) is configured multiple times in /etc/apt/sources.list:58 and /etc/apt/sources.list.d/couchdb.list:1\r\nW: Target Translations (main/i18n/Translation-en_US) is configured multiple times in /etc/apt/sources.list:58 and /etc/apt/sources.list.d/couchdb.list:1\r\nW: Target Translations (main/i18n/Translation-en) is configured multiple times in /etc/apt/sources.list:58 and /etc/apt/sources.list.d/couchdb.list:1\r\nW: Target CNF (main/cnf/Commands-amd64) is configured multiple times in /etc/apt/sources.list:58 and /etc/apt/sources.list.d/couchdb.list:1\r\nW: Target CNF (main/cnf/Commands-all) is configured multiple times in /etc/apt/sources.list:58 and /etc/apt/sources.list.d/couchdb.list:1\r\nE: Unable to correct problems, you have held broken packages.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/872093165/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/872312480","html_url":"https://github.com/apache/couchdb/pull/3650#issuecomment-872312480","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3650","id":872312480,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MjMxMjQ4MA==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-01T14:51:21Z","updated_at":"2021-07-01T14:51:21Z","author_association":"MEMBER","body":"Thank you for the review, @nickva ! I'm about to merge this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/872312480/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/872448701","html_url":"https://github.com/apache/couchdb/issues/2868#issuecomment-872448701","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2868","id":872448701,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MjQ0ODcwMQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-01T18:08:24Z","updated_at":"2021-07-01T18:08:24Z","author_association":"MEMBER","body":"Looks like you are targeting `bionic` instead of `focal`. Check your `/etc/apt/sources.list.d/couchdb.list` file.\r\n\r\nIf you need more help please try our Slack or IRC channels; you can access these via https://couchdb.apache.org/ and click on Chat.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/872448701/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/872464784","html_url":"https://github.com/apache/couchdb/pull/3604#issuecomment-872464784","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3604","id":872464784,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MjQ2NDc4NA==","user":{"login":"noahshaw11","id":47468872,"node_id":"MDQ6VXNlcjQ3NDY4ODcy","avatar_url":"https://avatars.githubusercontent.com/u/47468872?v=4","gravatar_id":"","url":"https://api.github.com/users/noahshaw11","html_url":"https://github.com/noahshaw11","followers_url":"https://api.github.com/users/noahshaw11/followers","following_url":"https://api.github.com/users/noahshaw11/following{/other_user}","gists_url":"https://api.github.com/users/noahshaw11/gists{/gist_id}","starred_url":"https://api.github.com/users/noahshaw11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahshaw11/subscriptions","organizations_url":"https://api.github.com/users/noahshaw11/orgs","repos_url":"https://api.github.com/users/noahshaw11/repos","events_url":"https://api.github.com/users/noahshaw11/events{/privacy}","received_events_url":"https://api.github.com/users/noahshaw11/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-01T18:36:10Z","updated_at":"2021-07-01T18:36:10Z","author_association":"CONTRIBUTOR","body":"While this PR does correctly build `enc` and place it in `bin/`, the `enc` binary will never be used. This is because dependencies like [jiffy](https://github.com/davisp/jiffy) hard code the path to their `enc` binary like [here](https://github.com/davisp/jiffy/blob/master/rebar.config#L39-L40). While it can be argued that `enc` can just be added to the `$PATH`, this adds an extra dependency that is not necessarily needed. I am closing this for now.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/872464784/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/872947096","html_url":"https://github.com/apache/couchdb/pull/3604#issuecomment-872947096","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3604","id":872947096,"node_id":"MDEyOklzc3VlQ29tbWVudDg3Mjk0NzA5Ng==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-02T12:05:15Z","updated_at":"2021-07-02T12:05:15Z","author_association":"CONTRIBUTOR","body":"> dependencies like jiffy hard code the path to their enc binary like here. \r\n\r\nI've opened a PR with the upstream https://github.com/davisp/jiffy/pull/212","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/872947096/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/873022044","html_url":"https://github.com/apache/couchdb/issues/3517#issuecomment-873022044","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3517","id":873022044,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MzAyMjA0NA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-02T14:01:17Z","updated_at":"2021-07-02T14:01:17Z","author_association":"CONTRIBUTOR","body":"3.x decreased the default sharding factor (Q) from 8 to 2. I noticed your test script creates dbs with a default sharding factor 2 and before it was 8, and that might impact indexing times. Try explicitly passing `?q=8` on db creation.\r\n\r\nAlso 3.x has an index auto-builder and auto-compactor and those might be working the background while the test run and consume some resources.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/873022044/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/873069415","html_url":"https://github.com/apache/couchdb/pull/3604#issuecomment-873069415","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3604","id":873069415,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MzA2OTQxNQ==","user":{"login":"noahshaw11","id":47468872,"node_id":"MDQ6VXNlcjQ3NDY4ODcy","avatar_url":"https://avatars.githubusercontent.com/u/47468872?v=4","gravatar_id":"","url":"https://api.github.com/users/noahshaw11","html_url":"https://github.com/noahshaw11","followers_url":"https://api.github.com/users/noahshaw11/followers","following_url":"https://api.github.com/users/noahshaw11/following{/other_user}","gists_url":"https://api.github.com/users/noahshaw11/gists{/gist_id}","starred_url":"https://api.github.com/users/noahshaw11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahshaw11/subscriptions","organizations_url":"https://api.github.com/users/noahshaw11/orgs","repos_url":"https://api.github.com/users/noahshaw11/repos","events_url":"https://api.github.com/users/noahshaw11/events{/privacy}","received_events_url":"https://api.github.com/users/noahshaw11/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-02T15:08:46Z","updated_at":"2021-07-02T15:08:46Z","author_association":"CONTRIBUTOR","body":"Reopening PR since @iilyak has created an upstream PR for Jiffy.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/873069415/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/873099187","html_url":"https://github.com/apache/couchdb/pull/3643#issuecomment-873099187","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3643","id":873099187,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MzA5OTE4Nw==","user":{"login":"jiahuili430","id":54631519,"node_id":"MDQ6VXNlcjU0NjMxNTE5","avatar_url":"https://avatars.githubusercontent.com/u/54631519?v=4","gravatar_id":"","url":"https://api.github.com/users/jiahuili430","html_url":"https://github.com/jiahuili430","followers_url":"https://api.github.com/users/jiahuili430/followers","following_url":"https://api.github.com/users/jiahuili430/following{/other_user}","gists_url":"https://api.github.com/users/jiahuili430/gists{/gist_id}","starred_url":"https://api.github.com/users/jiahuili430/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiahuili430/subscriptions","organizations_url":"https://api.github.com/users/jiahuili430/orgs","repos_url":"https://api.github.com/users/jiahuili430/repos","events_url":"https://api.github.com/users/jiahuili430/events{/privacy}","received_events_url":"https://api.github.com/users/jiahuili430/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-02T15:56:51Z","updated_at":"2021-07-02T16:03:01Z","author_association":"CONTRIBUTOR","body":"@nickva \r\n> It still seems we are just proxy-ing the callbacks directly to the Erlang/OTP provided `inet_tls` module? So our module is not doing anything differently than the legacy behavior as described in https://erlang.org/doc/apps/ssl/ssl_distribution.html. There is even a newer way of specifying just a single conf file, which seems nice `-proto_dist inet_tls -ssl_dist_optfile \"/path/to/tls.conf\"` but perhaps we can just refer to those docs in the vm.arg or docs files.\r\n\r\nI haven't finished yet, still working on it. Just add TCP.\r\nThanks for the review","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/873099187/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/873102596","html_url":"https://github.com/apache/couchdb/pull/3643#issuecomment-873102596","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3643","id":873102596,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MzEwMjU5Ng==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-02T16:02:22Z","updated_at":"2021-07-02T16:02:22Z","author_association":"CONTRIBUTOR","body":"@jiahuili430 \r\n\r\n> I haven't finished yet, still working on it. Just add TCP.\r\n\r\nah, that makes sense\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/873102596/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/873263210","html_url":"https://github.com/apache/couchdb/issues/3608#issuecomment-873263210","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3608","id":873263210,"node_id":"MDEyOklzc3VlQ29tbWVudDg3MzI2MzIxMA==","user":{"login":"noahshaw11","id":47468872,"node_id":"MDQ6VXNlcjQ3NDY4ODcy","avatar_url":"https://avatars.githubusercontent.com/u/47468872?v=4","gravatar_id":"","url":"https://api.github.com/users/noahshaw11","html_url":"https://github.com/noahshaw11","followers_url":"https://api.github.com/users/noahshaw11/followers","following_url":"https://api.github.com/users/noahshaw11/following{/other_user}","gists_url":"https://api.github.com/users/noahshaw11/gists{/gist_id}","starred_url":"https://api.github.com/users/noahshaw11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahshaw11/subscriptions","organizations_url":"https://api.github.com/users/noahshaw11/orgs","repos_url":"https://api.github.com/users/noahshaw11/repos","events_url":"https://api.github.com/users/noahshaw11/events{/privacy}","received_events_url":"https://api.github.com/users/noahshaw11/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-02T21:22:52Z","updated_at":"2021-07-02T21:22:52Z","author_association":"CONTRIBUTOR","body":"After some investigating, I believe the response currently returned by `_bulk_get` for a deleted document is correct and standard. Currently, PouchDB returns a similar response as CouchDB does. Also, specifying and not specifying the `_rev` does not change the response returned.\r\n```\r\n% curl -X POST http://localhost:15984/demo/_bulk_get -H\"Authorization: Basic YWRtOnBhc3M=\" -H\"Content-Type: application/json\" -d '{\"docs\":[{\"id\":\"id\"}]}'\r\n{\"results\": [{\"id\": \"id\", \"docs\": [{\"ok\":{\"_id\":\"id\",\"_rev\":\"2-9b2e3bcc3752a3a952a3570b2ed4d27e\",\"_deleted\":true}}]}]}\r\n% curl -X POST http://localhost:15984/demo/_bulk_get -H\"Authorization: Basic YWRtOnBhc3M=\" -H\"Content-Type: application/json\" -d '{\"docs\":[{\"id\":\"id\",\"_rev\":\"1-59414e77c768bc202142ac82c2f129de\"}]}'\r\n{\"results\": [{\"id\": \"id\", \"docs\": [{\"ok\":{\"_id\":\"id\",\"_rev\":\"2-9b2e3bcc3752a3a952a3570b2ed4d27e\",\"_deleted\":true}}]}]}\r\n```\r\nThe current response is also related to the POST request to `_bulk_docs` to delete a doc:\r\n```\r\nPOST /db/_bulk_docs HTTP/1.1\r\nAccept: application/json\r\nContent-Length: 109\r\nContent-Type:application/json\r\nHost: localhost:5984\r\n{\r\n    \"docs\": [\r\n        {\r\n            \"_id\": \"FishStew\"\r\n        },\r\n        {\r\n            \"_id\": \"LambStew\",\r\n            \"_rev\": \"2-0786321986194c92dd3b57dfbfc741ce\",\r\n            \"_deleted\": true\r\n        }\r\n    ]\r\n}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/873263210/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/873961109","html_url":"https://github.com/apache/couchdb/issues/3630#issuecomment-873961109","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3630","id":873961109,"node_id":"MDEyOklzc3VlQ29tbWVudDg3Mzk2MTEwOQ==","user":{"login":"skeyby","id":1609532,"node_id":"MDQ6VXNlcjE2MDk1MzI=","avatar_url":"https://avatars.githubusercontent.com/u/1609532?v=4","gravatar_id":"","url":"https://api.github.com/users/skeyby","html_url":"https://github.com/skeyby","followers_url":"https://api.github.com/users/skeyby/followers","following_url":"https://api.github.com/users/skeyby/following{/other_user}","gists_url":"https://api.github.com/users/skeyby/gists{/gist_id}","starred_url":"https://api.github.com/users/skeyby/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/skeyby/subscriptions","organizations_url":"https://api.github.com/users/skeyby/orgs","repos_url":"https://api.github.com/users/skeyby/repos","events_url":"https://api.github.com/users/skeyby/events{/privacy}","received_events_url":"https://api.github.com/users/skeyby/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-05T09:30:11Z","updated_at":"2021-07-05T09:30:11Z","author_association":"NONE","body":"I experienced this problem as well on our clusters. After a lot of trial-and-errors I think the problem is related to the synchronization on the _dbs internal db across nodes. Maybe you can check a little with that.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/873961109/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/873973954","html_url":"https://github.com/apache/couchdb/issues/3630#issuecomment-873973954","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3630","id":873973954,"node_id":"MDEyOklzc3VlQ29tbWVudDg3Mzk3Mzk1NA==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-05T09:49:50Z","updated_at":"2021-07-05T09:49:50Z","author_association":"CONTRIBUTOR","body":"> That being said, this issue has been observed with a slow buildup of databases and the rate of creating the DBs in the example is probably not related to the root cause.\r\n\r\nIt could be related to the rate of creation of databases. CouchDB uses LRU cache and keeps only limited number of databases in opened state. When you create databases rapidly you exceed the LRU cache size. Since most of the requests are new database creations these are definitely not in the cache.  When the LRU cache size is over the limit CouchDB starts closing databases.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/873973954/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/874168606","html_url":"https://github.com/apache/couchdb/issues/3517#issuecomment-874168606","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3517","id":874168606,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NDE2ODYwNg==","user":{"login":"konrad-ohms","id":40577406,"node_id":"MDQ6VXNlcjQwNTc3NDA2","avatar_url":"https://avatars.githubusercontent.com/u/40577406?v=4","gravatar_id":"","url":"https://api.github.com/users/konrad-ohms","html_url":"https://github.com/konrad-ohms","followers_url":"https://api.github.com/users/konrad-ohms/followers","following_url":"https://api.github.com/users/konrad-ohms/following{/other_user}","gists_url":"https://api.github.com/users/konrad-ohms/gists{/gist_id}","starred_url":"https://api.github.com/users/konrad-ohms/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/konrad-ohms/subscriptions","organizations_url":"https://api.github.com/users/konrad-ohms/orgs","repos_url":"https://api.github.com/users/konrad-ohms/repos","events_url":"https://api.github.com/users/konrad-ohms/events{/privacy}","received_events_url":"https://api.github.com/users/konrad-ohms/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-05T14:48:48Z","updated_at":"2021-07-05T14:50:00Z","author_association":"NONE","body":"Thanks @nickva for investigating the issue.\r\nI tried to adjust the function from\r\n```\r\nsetupDbs() {\r\n    COUCHDB_PORT=${1}\r\n    waitForDb \"${COUCHDB_PORT}\"\r\n    SYSTEM_DBS=( _users _replicator _global_changes demo )\r\n    for CURRENT_DB in \"${SYSTEM_DBS[@]}\"\r\n    do\r\n        echo \"Creating ${CURRENT_DB}\"\r\n        curl -X PUT \"http://${COUCHDB_USER}:${COUCHDB_PASSWORD}@127.0.0.1:${COUCHDB_PORT}/${CURRENT_DB}\"\r\n    done\r\n}\r\n``` \r\nto\r\n```\r\nsetupDbs() {\r\n    COUCHDB_PORT=${1}\r\n    waitForDb \"${COUCHDB_PORT}\"\r\n    SYSTEM_DBS=( _users _replicator _global_changes demo )\r\n    for CURRENT_DB in \"${SYSTEM_DBS[@]}\"\r\n    do\r\n        echo \"Creating ${CURRENT_DB}\"\r\n        curl -X PUT \"http://${COUCHDB_USER}:${COUCHDB_PASSWORD}@127.0.0.1:${COUCHDB_PORT}/${CURRENT_DB}?q=8\"\r\n    done\r\n}\r\n```\r\n\r\nUnfortunately that did not solve the performance degradation of CouchDB 3.1.1 compared to v2.3.1. \r\n\r\nI checked that the databases are using the same number of shards:\r\n\r\nCouchDB 2:\r\n```\r\n$ curl -u \"xxx:xxx\" http://localhost:3002/demo/\r\n{\"db_name\":\"demo\",\"purge_seq\":\"0-g1AAAAEzeJzLYWBg4MhgTmHgzcvPy09JdcjLz8gvLskBCjPlsQBJhgYg9f____lZiQx41R2AqLuPW11SApBMqgcqImTWA4hZeNQlKYDMsifCrAUQs_bjVpfIkCSP3zIHkGXxEDVZAMg5YvY\",\"update_seq\":\"12001-g1AAAAFLeJzLYWBg4MhgTmHgzcvPy09JdcjLz8gvLskBCjMlMiTJ____PyuJgYH1Cw41SQpAMskeqoyNFZcyB5CyeJhpD3EpSwApq4cpO4hDWR4LkGRoAFJAlfPBStfjVboAonQ_WOl-vEoPQJTex-triNIHEKUQtz7JAgDbh2kI\",\"sizes\":{\"file\":11425440,\"external\":11923785,\"active\":11287083},\"other\":{\"data_size\":11923785},\"doc_del_count\":0,\"doc_count\":12001,\"disk_size\":11425440,\"disk_format_version\":7,\"data_size\":11287083,\"compact_running\":false,\"cluster\":{\"q\":8,\"n\":1,\"w\":1,\"r\":1},\"instance_start_time\":\"0\"}\r\n```\r\nCouchDB 3:\r\n```\r\n$ curl -u \"xxx:xxx\" http://localhost:3003/demo/\r\n{\"db_name\":\"demo\",\"purge_seq\":\"0-g1AAAAEzeJzLYWBg4MhgTmHgzcvPy09JdcjLz8gvLskBCjPlsQBJhgdA6j8QZCUy4FV3AKLuPiF1CyDq9hNS1wBRNx-3uqQEIJlUj9dtSQ4gNfH41SiA1NjjVZPIkCQPUZAFAN6AYvY\",\"update_seq\":\"12001-g1AAAAFLeJzLYWBg4MhgTmHgzcvPy09JdcjLz8gvLskBCjPlsQBJhgdA6j8QZCUxMLDew6v0AETpfbDSg3iVLoAo3Q9W-gKv0gaI0vlgpa9wKE1KAJJJ9TB33sGlzAGkLB6mDKdpCiBl9jBll3AoS2RIkoepuZEFAAsmagc\",\"sizes\":{\"file\":14468808,\"external\":9785687,\"active\":11343864},\"props\":{},\"doc_del_count\":0,\"doc_count\":12001,\"disk_format_version\":8,\"compact_running\":false,\"cluster\":{\"q\":8,\"n\":1,\"w\":1,\"r\":1},\"instance_start_time\":\"0\"}\r\n```\r\n\r\nBoth state:\r\n```\r\n\"cluster\":{\"q\":8,\"n\":1,\"w\":1,\"r\":1}\r\n```\r\n\r\nAfter injecting the data I waited multiple minutes before running the queries:\r\n```\r\n$ ./couchdb-test.sh query\r\nCouchDB performance regression test script\r\nAssuming that setup is already complete\r\n================ Query CouchDB 2.3.1 ================\r\n{\"couchdb\":\"Welcome\",\"version\":\"2.3.1\",\"git_sha\":\"c298091a4\",\"uuid\":\"5584fb6a7a94ff8ab44bbee93823352d\",\"features\":[\"pluggable-storage-engines\",\"scheduler\"],\"vendor\":{\"name\":\"The Apache Software Foundation\"}}\r\nQuery Database views on port 3002\r\nRound: 1/10\r\n\r\nreal\t0m8.534s\r\nuser\t0m0.017s\r\nsys\t0m0.013s\r\nRound: 2/10\r\n\r\nreal\t0m5.050s\r\nuser\t0m0.012s\r\nsys\t0m0.010s\r\nRound: 3/10\r\n\r\nreal\t0m4.677s\r\nuser\t0m0.010s\r\nsys\t0m0.011s\r\nRound: 4/10\r\n\r\nreal\t0m4.820s\r\nuser\t0m0.013s\r\nsys\t0m0.009s\r\nRound: 5/10\r\n\r\nreal\t0m4.798s\r\nuser\t0m0.011s\r\nsys\t0m0.011s\r\nRound: 6/10\r\n\r\nreal\t0m5.093s\r\nuser\t0m0.013s\r\nsys\t0m0.009s\r\nRound: 7/10\r\n\r\nreal\t0m5.285s\r\nuser\t0m0.015s\r\nsys\t0m0.007s\r\nRound: 8/10\r\n\r\nreal\t0m5.627s\r\nuser\t0m0.010s\r\nsys\t0m0.014s\r\nRound: 9/10\r\n\r\nreal\t0m5.459s\r\nuser\t0m0.013s\r\nsys\t0m0.010s\r\nRound: 10/10\r\n\r\nreal\t0m5.589s\r\nuser\t0m0.009s\r\nsys\t0m0.015s\r\n================ Query CouchDB 3.1.1 ================\r\n{\"couchdb\":\"Welcome\",\"version\":\"3.1.1\",\"git_sha\":\"ce596c65d\",\"uuid\":\"6445c39f1422b264fbf7837dbb055bb9\",\"features\":[\"access-ready\",\"partitioned\",\"pluggable-storage-engines\",\"reshard\",\"scheduler\"],\"vendor\":{\"name\":\"The Apache Software Foundation\"}}\r\nQuery Database views on port 3003\r\nRound: 1/10\r\n\r\nreal\t0m53.993s\r\nuser\t0m0.014s\r\nsys\t0m0.011s\r\nRound: 2/10\r\n\r\nreal\t0m53.707s\r\nuser\t0m0.016s\r\nsys\t0m0.009s\r\nRound: 3/10\r\n\r\nreal\t0m56.130s\r\nuser\t0m0.011s\r\nsys\t0m0.016s\r\nRound: 4/10\r\n\r\nreal\t0m56.537s\r\nuser\t0m0.012s\r\nsys\t0m0.014s\r\nRound: 5/10\r\n\r\nreal\t0m55.933s\r\nuser\t0m0.012s\r\nsys\t0m0.013s\r\nRound: 6/10\r\n\r\nreal\t0m52.887s\r\nuser\t0m0.013s\r\nsys\t0m0.014s\r\nRound: 7/10\r\n\r\nreal\t1m1.758s\r\nuser\t0m0.012s\r\nsys\t0m0.012s\r\nRound: 8/10\r\n\r\nreal\t0m52.182s\r\nuser\t0m0.010s\r\nsys\t0m0.018s\r\nRound: 9/10\r\n\r\nreal\t0m53.072s\r\nuser\t0m0.011s\r\nsys\t0m0.016s\r\nRound: 10/10\r\n\r\nreal\t0m53.720s\r\nuser\t0m0.014s\r\nsys\t0m0.013s\r\n```\r\n\r\nI am not sure if the default log level does not indicate the auto-builder and auto-compactor actions, but at least the container logs  are not reflecting such actions:\r\n\r\n```\r\n$ podman logs -f couchdb3\r\n...\r\n[notice] 2021-07-05T12:34:42.581798Z nonode@nohost <0.19894.3> 14ea633501 127.0.0.1:3003 10.0.2.100 admin POST /demo 201 ok 19\r\n[notice] 2021-07-05T12:34:42.618414Z nonode@nohost <0.19902.3> 96877188fc 127.0.0.1:3003 10.0.2.100 admin POST /demo 201 ok 22\r\n[notice] 2021-07-05T12:34:42.650066Z nonode@nohost <0.19910.3> c2fe735612 127.0.0.1:3003 10.0.2.100 admin POST /demo 201 ok 20\r\n[info] 2021-07-05T12:35:10.329291Z nonode@nohost <0.3652.0> -------- Starting index update for db: shards/40000000-5fffffff/demo.1625487748 idx: _design/demo\r\n[info] 2021-07-05T12:35:11.749276Z nonode@nohost <0.3652.0> -------- Index update finished for db: shards/40000000-5fffffff/demo.1625487748 idx: _design/demo\r\n[info] 2021-07-05T12:35:11.936249Z nonode@nohost <0.3778.0> -------- Starting index update for db: shards/00000000-1fffffff/demo.1625487748 idx: _design/demo\r\n[info] 2021-07-05T12:35:13.008010Z nonode@nohost <0.3778.0> -------- Index update finished for db: shards/00000000-1fffffff/demo.1625487748 idx: _design/demo\r\n[info] 2021-07-05T12:35:13.291704Z nonode@nohost <0.3817.0> -------- Starting index update for db: shards/e0000000-ffffffff/demo.1625487748 idx: _design/demo\r\n[info] 2021-07-05T12:35:14.564826Z nonode@nohost <0.3817.0> -------- Index update finished for db: shards/e0000000-ffffffff/demo.1625487748 idx: _design/demo\r\n[info] 2021-07-05T12:35:15.314002Z nonode@nohost <0.3907.0> -------- Starting index update for db: shards/20000000-3fffffff/demo.1625487748 idx: _design/demo\r\n[info] 2021-07-05T12:35:15.373015Z nonode@nohost <0.3975.0> -------- Starting index update for db: shards/60000000-7fffffff/demo.1625487748 idx: _design/demo\r\n[info] 2021-07-05T12:35:15.510076Z nonode@nohost <0.3621.0> -------- Starting index update for db: shards/c0000000-dfffffff/demo.1625487748 idx: _design/demo\r\n[info] 2021-07-05T12:35:16.010943Z nonode@nohost <0.4169.0> -------- Starting index update for db: shards/a0000000-bfffffff/demo.1625487748 idx: _design/demo\r\n[info] 2021-07-05T12:35:16.654203Z nonode@nohost <0.3975.0> -------- Index update finished for db: shards/60000000-7fffffff/demo.1625487748 idx: _design/demo\r\n[info] 2021-07-05T12:35:16.677526Z nonode@nohost <0.3907.0> -------- Index update finished for db: shards/20000000-3fffffff/demo.1625487748 idx: _design/demo\r\n[info] 2021-07-05T12:35:16.788062Z nonode@nohost <0.3621.0> -------- Index update finished for db: shards/c0000000-dfffffff/demo.1625487748 idx: _design/demo\r\n[info] 2021-07-05T12:35:17.306988Z nonode@nohost <0.4169.0> -------- Index update finished for db: shards/a0000000-bfffffff/demo.1625487748 idx: _design/demo\r\n[info] 2021-07-05T12:35:18.494925Z nonode@nohost <0.3686.0> -------- Starting index update for db: shards/80000000-9fffffff/demo.1625487748 idx: _design/demo\r\n[info] 2021-07-05T12:35:19.388880Z nonode@nohost <0.3686.0> -------- Index update finished for db: shards/80000000-9fffffff/demo.1625487748 idx: _design/demo\r\n[notice] 2021-07-05T14:32:23.887866Z nonode@nohost <0.13346.5> 61a2177aae 127.0.0.1:3003 10.0.2.100 admin GET / 200 ok 9\r\n[notice] 2021-07-05T14:33:17.881591Z nonode@nohost <0.13347.5> 39c531c67e 127.0.0.1:3003 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 53986\r\n[notice] 2021-07-05T14:34:11.588538Z nonode@nohost <0.13889.5> d3cc5e0fa8 127.0.0.1:3003 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 53700\r\n[notice] 2021-07-05T14:35:07.718592Z nonode@nohost <0.14346.5> 05b6354796 127.0.0.1:3003 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 56122\r\n[notice] 2021-07-05T14:36:04.255503Z nonode@nohost <0.14842.5> 1535baf654 127.0.0.1:3003 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 56529\r\n[notice] 2021-07-05T14:37:00.187963Z nonode@nohost <0.15334.5> 00a9c90ecf 127.0.0.1:3003 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 55926\r\n[notice] 2021-07-05T14:37:53.074959Z nonode@nohost <0.15818.5> e48cbf750a 127.0.0.1:3003 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 52880\r\n[notice] 2021-07-05T14:38:54.833050Z nonode@nohost <0.16272.5> 07b2646c16 127.0.0.1:3003 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 61751\r\n[notice] 2021-07-05T14:39:47.015319Z nonode@nohost <0.16808.5> a26c18d19d 127.0.0.1:3003 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 52175\r\n[notice] 2021-07-05T14:40:40.086929Z nonode@nohost <0.17255.5> 5267817a12 127.0.0.1:3003 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 53065\r\n[notice] 2021-07-05T14:41:33.807566Z nonode@nohost <0.17723.5> 21e5c4941c 127.0.0.1:3003 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 53713\r\n```\r\n\r\nCompared to couchdb2:\r\n```\r\n$ podman logs couchdb2\r\n...\r\n[notice] 2021-07-05T12:27:09.139663Z nonode@nohost <0.23495.2> 714b3e7a37 127.0.0.1:3002 10.0.2.100 admin POST /demo 201 ok 30\r\n[notice] 2021-07-05T12:27:09.165180Z nonode@nohost <0.23502.2> 9a12b27d94 127.0.0.1:3002 10.0.2.100 admin POST /demo 201 ok 18\r\n[info] 2021-07-05T13:22:11.293974Z nonode@nohost <0.12126.4> -------- Starting compaction for db \"shards/20000000-3fffffff/demo.1625487744\" at 1541\r\n[info] 2021-07-05T13:22:32.858211Z nonode@nohost <0.12139.4> -------- Starting compaction for db \"shards/00000000-1fffffff/demo.1625487744\" at 1524\r\n[info] 2021-07-05T13:22:54.395354Z nonode@nohost <0.12142.4> -------- Starting compaction for db \"shards/40000000-5fffffff/demo.1625487744\" at 1505\r\n[info] 2021-07-05T13:23:15.835989Z nonode@nohost <0.12145.4> -------- Starting compaction for db \"shards/60000000-7fffffff/demo.1625487744\" at 1473\r\n[info] 2021-07-05T13:23:37.277484Z nonode@nohost <0.12151.4> -------- Starting compaction for db \"shards/a0000000-bfffffff/demo.1625487744\" at 1471\r\n[info] 2021-07-05T13:23:58.739812Z nonode@nohost <0.12157.4> -------- Starting compaction for db \"shards/e0000000-ffffffff/demo.1625487744\" at 1508\r\n[info] 2021-07-05T13:24:20.179296Z nonode@nohost <0.12148.4> -------- Starting compaction for db \"shards/80000000-9fffffff/demo.1625487744\" at 1455\r\n[info] 2021-07-05T13:24:41.714250Z nonode@nohost <0.12154.4> -------- Starting compaction for db \"shards/c0000000-dfffffff/demo.1625487744\" at 1524\r\n[info] 2021-07-05T13:24:54.231782Z nonode@nohost <0.12450.4> -------- Starting compaction for db \"shards/c0000000-dfffffff/_global_changes.1625487744\" at 554\r\n[notice] 2021-07-05T14:31:28.936974Z nonode@nohost <0.15912.6> 312602f8c0 127.0.0.1:3002 10.0.2.100 admin GET / 200 ok 2\r\n[info] 2021-07-05T14:31:28.989213Z nonode@nohost <0.15983.6> -------- Starting index update for db: shards/00000000-1fffffff/demo.1625487744 idx: _design/demo\r\n[info] 2021-07-05T14:31:28.989257Z nonode@nohost <0.15984.6> -------- Starting index update for db: shards/20000000-3fffffff/demo.1625487744 idx: _design/demo\r\n[info] 2021-07-05T14:31:28.990506Z nonode@nohost <0.16010.6> -------- Starting index update for db: shards/40000000-5fffffff/demo.1625487744 idx: _design/demo\r\n[info] 2021-07-05T14:31:28.990507Z nonode@nohost <0.16011.6> -------- Starting index update for db: shards/a0000000-bfffffff/demo.1625487744 idx: _design/demo\r\n[info] 2021-07-05T14:31:28.990573Z nonode@nohost <0.16012.6> -------- Starting index update for db: shards/60000000-7fffffff/demo.1625487744 idx: _design/demo\r\n[info] 2021-07-05T14:31:28.990650Z nonode@nohost <0.16016.6> -------- Starting index update for db: shards/80000000-9fffffff/demo.1625487744 idx: _design/demo\r\n[info] 2021-07-05T14:31:28.990715Z nonode@nohost <0.16020.6> -------- Starting index update for db: shards/c0000000-dfffffff/demo.1625487744 idx: _design/demo\r\n[info] 2021-07-05T14:31:28.991237Z nonode@nohost <0.16025.6> -------- Starting index update for db: shards/e0000000-ffffffff/demo.1625487744 idx: _design/demo\r\n[info] 2021-07-05T14:31:32.578442Z nonode@nohost <0.16012.6> -------- Index update finished for db: shards/60000000-7fffffff/demo.1625487744 idx: _design/demo\r\n[info] 2021-07-05T14:31:32.592533Z nonode@nohost <0.16025.6> -------- Index update finished for db: shards/e0000000-ffffffff/demo.1625487744 idx: _design/demo\r\n[info] 2021-07-05T14:31:32.624614Z nonode@nohost <0.16011.6> -------- Index update finished for db: shards/a0000000-bfffffff/demo.1625487744 idx: _design/demo\r\n[info] 2021-07-05T14:31:32.630679Z nonode@nohost <0.16010.6> -------- Index update finished for db: shards/40000000-5fffffff/demo.1625487744 idx: _design/demo\r\n[info] 2021-07-05T14:31:32.641088Z nonode@nohost <0.16016.6> -------- Index update finished for db: shards/80000000-9fffffff/demo.1625487744 idx: _design/demo\r\n[info] 2021-07-05T14:31:32.682452Z nonode@nohost <0.15984.6> -------- Index update finished for db: shards/20000000-3fffffff/demo.1625487744 idx: _design/demo\r\n[info] 2021-07-05T14:31:32.729299Z nonode@nohost <0.16020.6> -------- Index update finished for db: shards/c0000000-dfffffff/demo.1625487744 idx: _design/demo\r\n[info] 2021-07-05T14:31:32.746659Z nonode@nohost <0.15983.6> -------- Index update finished for db: shards/00000000-1fffffff/demo.1625487744 idx: _design/demo\r\n[notice] 2021-07-05T14:31:37.472657Z nonode@nohost <0.15913.6> 3b98ddbf30 127.0.0.1:3002 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 8516\r\n[notice] 2021-07-05T14:31:42.522912Z nonode@nohost <0.16231.6> 139c6ac71b 127.0.0.1:3002 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 5042\r\n[notice] 2021-07-05T14:31:47.199986Z nonode@nohost <0.16315.6> 63625be9aa 127.0.0.1:3002 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 4671\r\n[notice] 2021-07-05T14:31:52.020073Z nonode@nohost <0.16417.6> 06140e6373 127.0.0.1:3002 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 4813\r\n[notice] 2021-07-05T14:31:56.818616Z nonode@nohost <0.16495.6> 73aef1519b 127.0.0.1:3002 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 4791\r\n[notice] 2021-07-05T14:32:01.911785Z nonode@nohost <0.16590.6> e7371ec8db 127.0.0.1:3002 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 5086\r\n[notice] 2021-07-05T14:32:07.196507Z nonode@nohost <0.16725.6> 19201fdd74 127.0.0.1:3002 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 5278\r\n[notice] 2021-07-05T14:32:12.823661Z nonode@nohost <0.16833.6> 1cfc7a7f8a 127.0.0.1:3002 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 5618\r\n[notice] 2021-07-05T14:32:18.282645Z nonode@nohost <0.16924.6> a70a1462dc 127.0.0.1:3002 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 5453\r\n[notice] 2021-07-05T14:32:23.871410Z nonode@nohost <0.17021.6> 8364bc2506 127.0.0.1:3002 10.0.2.100 admin GET /demo/_design/demo/_view/slow?reduce=true&group=true 200 ok 5581\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/874168606/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/874308851","html_url":"https://github.com/apache/couchdb/issues/3517#issuecomment-874308851","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3517","id":874308851,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NDMwODg1MQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-05T20:08:51Z","updated_at":"2021-07-05T20:08:51Z","author_association":"CONTRIBUTOR","body":"Thanks for trying with q=8, @konrad-ohms. The JS engine could be responsible as you indicated then. \r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/874308851/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/874622769","html_url":"https://github.com/apache/couchdb/issues/3630#issuecomment-874622769","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3630","id":874622769,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NDYyMjc2OQ==","user":{"login":"vladimirralev","id":202417,"node_id":"MDQ6VXNlcjIwMjQxNw==","avatar_url":"https://avatars.githubusercontent.com/u/202417?v=4","gravatar_id":"","url":"https://api.github.com/users/vladimirralev","html_url":"https://github.com/vladimirralev","followers_url":"https://api.github.com/users/vladimirralev/followers","following_url":"https://api.github.com/users/vladimirralev/following{/other_user}","gists_url":"https://api.github.com/users/vladimirralev/gists{/gist_id}","starred_url":"https://api.github.com/users/vladimirralev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vladimirralev/subscriptions","organizations_url":"https://api.github.com/users/vladimirralev/orgs","repos_url":"https://api.github.com/users/vladimirralev/repos","events_url":"https://api.github.com/users/vladimirralev/events{/privacy}","received_events_url":"https://api.github.com/users/vladimirralev/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-06T09:51:33Z","updated_at":"2021-07-06T09:51:33Z","author_association":"NONE","body":"I think CouchDB 3 does eager indexing which causes a huge CPU/IO follow-up load asynchronously after a replication is complete for specific DBs. I have to pace the replications based on this, but that's fine and not related to the issue. I am setting up a new build here with more logging in between the lines, but so far it looks like indeed each DB is polling independently for health or at least logs something that is causing the sudden spike of queued messages.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/874622769/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/874790032","html_url":"https://github.com/apache/couchdb/pull/3629#issuecomment-874790032","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3629","id":874790032,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NDc5MDAzMg==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-06T14:04:53Z","updated_at":"2021-07-06T14:04:53Z","author_association":"MEMBER","body":"I was speaking of the convention of only calling the \"top level\" module of an application, in order to allow changes within an application with minimal risk of breaking couchdb as a whole. so if we need something from mem3 from other places, add a function in mem3.erl that delegates to the internal mem3_sync module. high cohesion / low coupling.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/874790032/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/875139853","html_url":"https://github.com/apache/couchdb/pull/3633#issuecomment-875139853","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3633","id":875139853,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NTEzOTg1Mw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-06T23:06:13Z","updated_at":"2021-07-06T23:06:13Z","author_association":"CONTRIBUTOR","body":"+1 Nice work @chewbranca!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/875139853/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/875490066","html_url":"https://github.com/apache/couchdb/pull/3502#issuecomment-875490066","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3502","id":875490066,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NTQ5MDA2Ng==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-07T10:30:17Z","updated_at":"2021-07-07T10:32:32Z","author_association":"MEMBER","body":"I'm not sure I'll have the resources to work on this in the near future. I'm closing this and I'll open an issue instead, hoping someone can pick it up.\r\n\r\nEdit: just realized there's already a ticket: #3497 .","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/875490066/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/876713222","html_url":"https://github.com/apache/couchdb/pull/3633#issuecomment-876713222","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3633","id":876713222,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NjcxMzIyMg==","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-08T20:10:51Z","updated_at":"2021-07-08T20:10:51Z","author_association":"CONTRIBUTOR","body":"A lot of debugging of what initially appeared to be timing issues, turned out to be inconsistent ordering of shards as returned by `mem3:shards` on the CI system versus my local development machine. Sorting the resulting output fixed the new test case.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/876713222/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/876738187","html_url":"https://github.com/apache/couchdb/issues/3454#issuecomment-876738187","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3454","id":876738187,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NjczODE4Nw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-08T20:52:50Z","updated_at":"2021-07-08T20:52:50Z","author_association":"CONTRIBUTOR","body":"Working with @afsanjar and other members of the Power team we have a new PowerVS machine connecting to our Apache CouchDB Jenkins instance.\r\n\r\nIt's also added to the couchdb-infra-cm so it can be discovered and set-up that way (get the external IPs, run playbooks on it, etc). It's a bit of a special case still as `cloud.ibm.com` API for PowerVS instances is quite a bit different than for the other VPC instances.\r\n\r\nA few issues encountered currently are:\r\n\r\n * qemu cross platform architecture setup in couchdb-ci crashes with ppc64le build fails when building on MacOS BigSur (x86_64):\r\n```\r\nCONTAINERARCH=ppc64le ERLANGVERSION=21.3.8.17 ./build.sh platform debian-buster\r\n=> # qemu: uncaught target signal 4 (Illegal instruction) - core dumped\r\n```\r\n\r\n * I tried building on the machine itself and it looks like fails to build foundationdb. We have a setting to ignore missing intrinsics, however it later on stumbles on a missing __rdtsc instruction:\r\n```\r\napt-dependencies.sh in couchdb-ci repo:\r\n\r\nif [ \"${ARCH}\" == \"ppc64le\" ]; then\r\n    cmake -DCMAKE_CXX_FLAGS=\"-DNO_WARN_X86_INTRINSICS\" -G Ninja ..\r\n```\r\n\r\n```\r\n[108/751] Building CXX object flow/CMakeFiles/flow.dir/Net2.actor.g.cpp.o\r\nFAILED: flow/CMakeFiles/flow.dir/Net2.actor.g.cpp.o\r\n/usr/bin/c++  -DBOOST_ERROR_CODE_HEADER_ONLY -DBOOST_SYSTEM_NO_DEPRECATED -DHAS_ALIGNED_ALLOC -DNO_INTELLISENSE -DUSE_UCONTEXT -I../ -I. -isystem boostProject-prefix/src/boostProject -DNO_WARN_X86_INTRINSICS -O3 -DNDEBUG   -DCMAKE_BUILD -ggdb -fno-omit-frame-pointer -Wno-pragmas -Wno-attributes -Wno-error=format -Wunused-variable -Wno-deprecated -fvisibility=hidden -Wreturn-type -fPIC -DHAVE_OPENSSL -std=gnu++17 -MD -MT flow/CMakeFiles/flow.dir/Net2.actor.g.cpp.o -MF flow/CMakeFiles/flow.dir/Net2.actor.g.cpp.o.d -o flow/CMakeFiles/flow.dir/Net2.actor.g.cpp.o -c flow/Net2.actor.g.cpp\r\nIn file included from /foundationdb/flow/Net2.actor.cpp:21:\r\n/foundationdb/flow/Net2.actor.cpp: In member function 'virtual void N2::Net2::run()':\r\n../flow/Platform.h:438:28: error: '__rdtsc' was not declared in this scope\r\n #define timestampCounter() __rdtsc()\r\n                            ^~~~~~~\r\n/foundationdb/flow/Net2.actor.cpp:1186:15: note: in expansion of macro 'timestampCounter'\r\n    tscBegin = timestampCounter();\r\n               ^~~~~~~~~~~~~~~~\r\n../flow/Platform.h:438:28: note: suggested alternative: '__dt '\r\n\r\nninja: build stopped: subcommand failed.\r\n```\r\n   So to make it work I had to skip building foundationdb, so the image will work on 3.x only, and also build it on the Power machine in docker not via multi-arch docker+qemu setup in https://github.com/apache/couchdb-ci","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/876738187/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/876740080","html_url":"https://github.com/apache/couchdb/issues/3631#issuecomment-876740080","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3631","id":876740080,"node_id":"MDEyOklzc3VlQ29tbWVudDg3Njc0MDA4MA==","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-08T20:56:19Z","updated_at":"2021-07-08T20:56:19Z","author_association":"CONTRIBUTOR","body":"Alright, I've merged https://github.com/apache/couchdb/pull/3633, closing this out.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/876740080/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/877095981","html_url":"https://github.com/apache/couchdb/issues/2758#issuecomment-877095981","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2758","id":877095981,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NzA5NTk4MQ==","user":{"login":"nicknaychov","id":1932847,"node_id":"MDQ6VXNlcjE5MzI4NDc=","avatar_url":"https://avatars.githubusercontent.com/u/1932847?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknaychov","html_url":"https://github.com/nicknaychov","followers_url":"https://api.github.com/users/nicknaychov/followers","following_url":"https://api.github.com/users/nicknaychov/following{/other_user}","gists_url":"https://api.github.com/users/nicknaychov/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknaychov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknaychov/subscriptions","organizations_url":"https://api.github.com/users/nicknaychov/orgs","repos_url":"https://api.github.com/users/nicknaychov/repos","events_url":"https://api.github.com/users/nicknaychov/events{/privacy}","received_events_url":"https://api.github.com/users/nicknaychov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-09T10:49:48Z","updated_at":"2021-07-09T10:50:36Z","author_association":"NONE","body":"Hi \r\nwe are also having same error using 3 node cluster running 3.1.1 . \r\nI noticed that I can replicate the error using the web interface and forcing it to open 100 DBs on a page. Web will start 100 DB GET's simultaneously on a page scrolling. We have over 1000DBs.\r\n Other interesting fact is that after restart can not replicate it , but after couple days of processing requests. Here is our error:\r\n`[error] 2021-07-09T09:26:09.692989Z couchdb@pbx1-z1.xxxxxx.ca <0.23888.629> 8a92a1d7df rexi_server: from: couchdb@xxxxxxx.ca(<0.21851.628>) mfa: fabric_rpc:reduce_view/4 error:function_clause [{couch_db,incref,[undefined],[{file,\"src/couch_db.erl\"},{line,187}]},{couch_server,open_int,2,[{file,\"src/couch_server.erl\"},{line,94}]},{couch_server,open,2,[{file,\"src/couch_server.erl\"},{line,84}]},{mem3_util,get_or_create_db,2,[{file,\"src/mem3_util.erl\"},{line,512}]},{fabric_rpc,reduce_view,5,[{file,\"src/fabric_rpc.erl\"},{line,160}]},{rexi_server,init_p,3,[{file,\"src/rexi_server.erl\"},{line,138}]}]`\r\n\r\nDid anybody manage to solve it?\r\nThanks","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/877095981/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/877382436","html_url":"https://github.com/apache/couchdb/issues/3454#issuecomment-877382436","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3454","id":877382436,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NzM4MjQzNg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-09T18:39:15Z","updated_at":"2021-07-09T18:39:15Z","author_association":"CONTRIBUTOR","body":"Merged 3.x ppc64le CI support https://github.com/apache/couchdb/pull/3659\r\n\r\nFoundationDB doesn't build on ppc64le, but that's probably outside the scope of this ticket. If anyone is interested it maybe possible to follow along and do something similar to how aarch64 Linux port was enabled: https://github.com/apple/foundationdb/pull/2961/. At first sight doesn't seem too terribly bad - provide an equivalent `rdtsc` instruction and some SSE-like assembly equivalents.\r\n\r\nBut I think we can now close this ticket as fixed.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/877382436/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/877755965","html_url":"https://github.com/apache/couchdb/pull/3507#issuecomment-877755965","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3507","id":877755965,"node_id":"MDEyOklzc3VlQ29tbWVudDg3Nzc1NTk2NQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-11T07:38:36Z","updated_at":"2021-07-11T07:38:36Z","author_association":"MEMBER","body":"@rnewson is this more in line with what you were looking for here?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/877755965/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/877757559","html_url":"https://github.com/apache/couchdb/pull/3425#issuecomment-877757559","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3425","id":877757559,"node_id":"MDEyOklzc3VlQ29tbWVudDg3Nzc1NzU1OQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-11T07:53:24Z","updated_at":"2021-07-11T07:53:24Z","author_association":"MEMBER","body":"Thank you all for the input. I’ve reworked this to show Erlang and SM versions under `/_node/_local/_versions` admin-only:\r\n\r\n```\r\n> curl -s a:a@127.0.0.1:15984/_node/_local/_versions | jq\r\n{\r\n  \"erlang_version\": \"22.3.4.20\",\r\n  \"javascript_engine\": {\r\n    \"name\": \"spidermonkey\",\r\n    \"version\": \"86\"\r\n  }\r\n}\r\n\r\n> curl -s 127.0.0.1:15984/_node/_local/_versions | jq    \r\n{\r\n  \"error\": \"unauthorized\",\r\n  \"reason\": \"You are not a server admin.\"\r\n}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/877757559/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/877850387","html_url":"https://github.com/apache/couchdb/pull/3662#issuecomment-877850387","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3662","id":877850387,"node_id":"MDEyOklzc3VlQ29tbWVudDg3Nzg1MDM4Nw==","user":{"login":"roblabla","id":1069318,"node_id":"MDQ6VXNlcjEwNjkzMTg=","avatar_url":"https://avatars.githubusercontent.com/u/1069318?v=4","gravatar_id":"","url":"https://api.github.com/users/roblabla","html_url":"https://github.com/roblabla","followers_url":"https://api.github.com/users/roblabla/followers","following_url":"https://api.github.com/users/roblabla/following{/other_user}","gists_url":"https://api.github.com/users/roblabla/gists{/gist_id}","starred_url":"https://api.github.com/users/roblabla/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/roblabla/subscriptions","organizations_url":"https://api.github.com/users/roblabla/orgs","repos_url":"https://api.github.com/users/roblabla/repos","events_url":"https://api.github.com/users/roblabla/events{/privacy}","received_events_url":"https://api.github.com/users/roblabla/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-11T19:38:03Z","updated_at":"2021-07-11T19:38:03Z","author_association":"NONE","body":"Ah, this is already covered by #3617. Closing.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/877850387/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/878394090","html_url":"https://github.com/apache/couchdb/issues/3362#issuecomment-878394090","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3362","id":878394090,"node_id":"MDEyOklzc3VlQ29tbWVudDg3ODM5NDA5MA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-12T15:53:29Z","updated_at":"2021-07-12T15:54:02Z","author_association":"CONTRIBUTOR","body":"Leaving a note here that this should be checked against main branch as well. The same error may be present there\r\n\r\nI can take a look at that","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/878394090/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/878406861","html_url":"https://github.com/apache/couchdb/pull/3425#issuecomment-878406861","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3425","id":878406861,"node_id":"MDEyOklzc3VlQ29tbWVudDg3ODQwNjg2MQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-12T16:09:46Z","updated_at":"2021-07-12T16:09:46Z","author_association":"CONTRIBUTOR","body":"Looks pretty good @janl.\r\n\r\nWhat do you think about also removing the Erlang version from `server_header()` in https://github.com/apache/couchdb/blob/3.x/src/couch/src/couch_httpd.erl#L1050\r\n\r\nI can't think of a case when a client library might need to act differently if say Erlang version is 20 vs 24","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/878406861/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/878548265","html_url":"https://github.com/apache/couchdb/pull/3425#issuecomment-878548265","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3425","id":878548265,"node_id":"MDEyOklzc3VlQ29tbWVudDg3ODU0ODI2NQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-12T19:49:32Z","updated_at":"2021-07-12T19:49:32Z","author_association":"MEMBER","body":"@nickva I think since this is technically public-API, we’ll have to make it an option to disable and deprecate it, so we can remove it in 4.x, but no objections to that plan (in a separate PR)\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/878548265/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/878557156","html_url":"https://github.com/apache/couchdb/issues/2246#issuecomment-878557156","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2246","id":878557156,"node_id":"MDEyOklzc3VlQ29tbWVudDg3ODU1NzE1Ng==","user":{"login":"noahshaw11","id":47468872,"node_id":"MDQ6VXNlcjQ3NDY4ODcy","avatar_url":"https://avatars.githubusercontent.com/u/47468872?v=4","gravatar_id":"","url":"https://api.github.com/users/noahshaw11","html_url":"https://github.com/noahshaw11","followers_url":"https://api.github.com/users/noahshaw11/followers","following_url":"https://api.github.com/users/noahshaw11/following{/other_user}","gists_url":"https://api.github.com/users/noahshaw11/gists{/gist_id}","starred_url":"https://api.github.com/users/noahshaw11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahshaw11/subscriptions","organizations_url":"https://api.github.com/users/noahshaw11/orgs","repos_url":"https://api.github.com/users/noahshaw11/repos","events_url":"https://api.github.com/users/noahshaw11/events{/privacy}","received_events_url":"https://api.github.com/users/noahshaw11/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-12T20:04:20Z","updated_at":"2021-07-12T20:04:20Z","author_association":"CONTRIBUTOR","body":"After further testing, I am unsure how the author @b0wter was able to create a database with the invalid name `00-this-[is]-{an}-inv@lid-name`. Using bash, I receive\r\n```\r\n$ curl -X PUT http://localhost:15984/00-this-[is]-{an}-inv@lid-name/ -H\"Authorization: Basic YWRtOnBhc3M=\"\r\n{\"error\":\"illegal_database_name\",\"reason\":\"Name: '00-this-[is]-an-inv@lid-name'. Only lowercase characters (a-z), digits (0-9), and any of the characters _, $, (, ), +, -, and / are allowed. Must begin with a letter.\"}\r\n```\r\nwhich is expected.\r\nHowever, running\r\n```\r\n$ curl http://localhost:15984/00-this-[is]-{an}-inv@lid-name/ -X POST -H'Authorization: Basic YWRtOnBhc3M=' -H \"Content-Type: application/json\" -d '{\"servings\":4,\"subtitle\":\"Delicious with fresh bread\",\"title\":\"Fish Stew\"}'\r\n```\r\nbefore trying to create the database does return `{\"error\":\"not_found\",\"reason\":\"Database does not exist.\"}`. This is correct since the database has not been created. Perhaps this has been fixed since the opening of this ticket.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/878557156/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/878587824","html_url":"https://github.com/apache/couchdb/issues/2246#issuecomment-878587824","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2246","id":878587824,"node_id":"MDEyOklzc3VlQ29tbWVudDg3ODU4NzgyNA==","user":{"login":"b0wter","id":614261,"node_id":"MDQ6VXNlcjYxNDI2MQ==","avatar_url":"https://avatars.githubusercontent.com/u/614261?v=4","gravatar_id":"","url":"https://api.github.com/users/b0wter","html_url":"https://github.com/b0wter","followers_url":"https://api.github.com/users/b0wter/followers","following_url":"https://api.github.com/users/b0wter/following{/other_user}","gists_url":"https://api.github.com/users/b0wter/gists{/gist_id}","starred_url":"https://api.github.com/users/b0wter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/b0wter/subscriptions","organizations_url":"https://api.github.com/users/b0wter/orgs","repos_url":"https://api.github.com/users/b0wter/repos","events_url":"https://api.github.com/users/b0wter/events{/privacy}","received_events_url":"https://api.github.com/users/b0wter/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-12T20:54:05Z","updated_at":"2021-07-12T21:44:25Z","author_association":"NONE","body":"After reading the documentation it seemed logical to me that the api should return \"400 - database name invalid\" because otherwise it would not have been specified in the documentation since it will never be returned. It's the same for `delete`.  \r\n\r\nThe documentation of `head` and `get` makes me believe that _invalid database name_ should only be used with `put`? If that is the case I'll close this issue and will put up a pr for on update of the documentation.\r\n\r\nUsually I would not have noticed but I am writing a CouchDB client and use the documentation to define my integration tests.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/878587824/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/878845120","html_url":"https://github.com/apache/couchdb/pull/3425#issuecomment-878845120","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3425","id":878845120,"node_id":"MDEyOklzc3VlQ29tbWVudDg3ODg0NTEyMA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-13T07:23:45Z","updated_at":"2021-07-13T07:23:45Z","author_association":"CONTRIBUTOR","body":"@janl ah fair enough","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/878845120/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/879173361","html_url":"https://github.com/apache/couchdb/issues/3665#issuecomment-879173361","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3665","id":879173361,"node_id":"MDEyOklzc3VlQ29tbWVudDg3OTE3MzM2MQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-13T15:11:16Z","updated_at":"2021-07-13T15:11:16Z","author_association":"MEMBER","body":"You are correct that the iteration count is too low (the previous scheme is a single pass SHA1, which is as low as it goes).\r\n\r\nthe blocker here, for increasing iterations or for switching to sha256 or bcrypt/scrypt/yescrypt is that many tools use basic auth, rather than acquire a session cookie, so the desired auth time penalty of 0.5 - 1.0 sec renders the database unusable. There needs to be some more nuanced plan.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/879173361/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/879184870","html_url":"https://github.com/apache/couchdb/issues/3665#issuecomment-879184870","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3665","id":879184870,"node_id":"MDEyOklzc3VlQ29tbWVudDg3OTE4NDg3MA==","user":{"login":"DUG-nick","id":59562724,"node_id":"MDQ6VXNlcjU5NTYyNzI0","avatar_url":"https://avatars.githubusercontent.com/u/59562724?v=4","gravatar_id":"","url":"https://api.github.com/users/DUG-nick","html_url":"https://github.com/DUG-nick","followers_url":"https://api.github.com/users/DUG-nick/followers","following_url":"https://api.github.com/users/DUG-nick/following{/other_user}","gists_url":"https://api.github.com/users/DUG-nick/gists{/gist_id}","starred_url":"https://api.github.com/users/DUG-nick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DUG-nick/subscriptions","organizations_url":"https://api.github.com/users/DUG-nick/orgs","repos_url":"https://api.github.com/users/DUG-nick/repos","events_url":"https://api.github.com/users/DUG-nick/events{/privacy}","received_events_url":"https://api.github.com/users/DUG-nick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-13T15:25:26Z","updated_at":"2021-07-13T15:25:26Z","author_association":"NONE","body":"While I am thinking about this issue, I was wondering: would it be feasible for basic auth to generate a personal access token, as it is common practice with Github. \r\n\r\nOn the other hand, it would still be fantastic, if the security architect of any tool utilizing CouchDB could evaluate the risks and performance penalties for their own. So I think making the whole thing configurable would not hurt the system, but rather improve usability.\r\n\r\nFor now, the only real alternative I can find is a JWT approach with a separate user management. But when synchronizing with a per_user approach, I see a strong potential for error here. It would be great to have couch as kind of the single source of truth in this context.\r\n\r\nDoes anyone have some other feasible workaround idea?\r\n\r\n   ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/879184870/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/879229350","html_url":"https://github.com/apache/couchdb/pull/3507#issuecomment-879229350","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3507","id":879229350,"node_id":"MDEyOklzc3VlQ29tbWVudDg3OTIyOTM1MA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-13T16:26:30Z","updated_at":"2021-07-13T16:26:30Z","author_association":"MEMBER","body":"Yes, sorry for delay. +1.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/879229350/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/879927164","html_url":"https://github.com/apache/couchdb/issues/3660#issuecomment-879927164","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3660","id":879927164,"node_id":"MDEyOklzc3VlQ29tbWVudDg3OTkyNzE2NA==","user":{"login":"Nayana-ibm","id":20816038,"node_id":"MDQ6VXNlcjIwODE2MDM4","avatar_url":"https://avatars.githubusercontent.com/u/20816038?v=4","gravatar_id":"","url":"https://api.github.com/users/Nayana-ibm","html_url":"https://github.com/Nayana-ibm","followers_url":"https://api.github.com/users/Nayana-ibm/followers","following_url":"https://api.github.com/users/Nayana-ibm/following{/other_user}","gists_url":"https://api.github.com/users/Nayana-ibm/gists{/gist_id}","starred_url":"https://api.github.com/users/Nayana-ibm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Nayana-ibm/subscriptions","organizations_url":"https://api.github.com/users/Nayana-ibm/orgs","repos_url":"https://api.github.com/users/Nayana-ibm/repos","events_url":"https://api.github.com/users/Nayana-ibm/events{/privacy}","received_events_url":"https://api.github.com/users/Nayana-ibm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-14T14:11:18Z","updated_at":"2021-07-14T14:12:19Z","author_association":"NONE","body":"Hi @nickva \r\nI tried executing same steps mentioned by you however make itself failing at my end. \r\n```\r\n$ make\r\n==> couch_epi (compile)\r\nERROR: OTP release 20 does not match required regex 21|22|23|24\r\nERROR: compile failed while processing /home/jenkins/couchdb/src/couch_epi: rebar_abort\r\n```\r\nCould you please share\r\n1. output of configure and make command\r\n2. if any other dependency/configuration is used \r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/879927164/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/880056524","html_url":"https://github.com/apache/couchdb/issues/3660#issuecomment-880056524","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3660","id":880056524,"node_id":"MDEyOklzc3VlQ29tbWVudDg4MDA1NjUyNA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-14T16:58:42Z","updated_at":"2021-07-14T16:59:28Z","author_association":"CONTRIBUTOR","body":"@Nayana-ibm \r\n\r\nThanks for taking a look. Sorry I forgot to mention that this is for the 3.x branch only. So before the configure step, we'd switch to the 3.x branch.\r\n\r\n```\r\ngit checkout 3.x && ./configure --dev  --spidermonkey-version 60\r\n...\r\n```\r\n\r\nFoundationDB which is needed for the `main` branch (the future 4.x) can't compile on either ppc64le or s390x yet.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/880056524/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/880372407","html_url":"https://github.com/apache/couchdb/issues/3663#issuecomment-880372407","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3663","id":880372407,"node_id":"MDEyOklzc3VlQ29tbWVudDg4MDM3MjQwNw==","user":{"login":"adityayadav7","id":48221394,"node_id":"MDQ6VXNlcjQ4MjIxMzk0","avatar_url":"https://avatars.githubusercontent.com/u/48221394?v=4","gravatar_id":"","url":"https://api.github.com/users/adityayadav7","html_url":"https://github.com/adityayadav7","followers_url":"https://api.github.com/users/adityayadav7/followers","following_url":"https://api.github.com/users/adityayadav7/following{/other_user}","gists_url":"https://api.github.com/users/adityayadav7/gists{/gist_id}","starred_url":"https://api.github.com/users/adityayadav7/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adityayadav7/subscriptions","organizations_url":"https://api.github.com/users/adityayadav7/orgs","repos_url":"https://api.github.com/users/adityayadav7/repos","events_url":"https://api.github.com/users/adityayadav7/events{/privacy}","received_events_url":"https://api.github.com/users/adityayadav7/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-15T03:57:44Z","updated_at":"2021-07-15T03:57:44Z","author_association":"NONE","body":"@rnewson @nickva please look on this error","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/880372407/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/880387697","html_url":"https://github.com/apache/couchdb/issues/1840#issuecomment-880387697","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1840","id":880387697,"node_id":"MDEyOklzc3VlQ29tbWVudDg4MDM4NzY5Nw==","user":{"login":"khughitt","id":125001,"node_id":"MDQ6VXNlcjEyNTAwMQ==","avatar_url":"https://avatars.githubusercontent.com/u/125001?v=4","gravatar_id":"","url":"https://api.github.com/users/khughitt","html_url":"https://github.com/khughitt","followers_url":"https://api.github.com/users/khughitt/followers","following_url":"https://api.github.com/users/khughitt/following{/other_user}","gists_url":"https://api.github.com/users/khughitt/gists{/gist_id}","starred_url":"https://api.github.com/users/khughitt/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/khughitt/subscriptions","organizations_url":"https://api.github.com/users/khughitt/orgs","repos_url":"https://api.github.com/users/khughitt/repos","events_url":"https://api.github.com/users/khughitt/events{/privacy}","received_events_url":"https://api.github.com/users/khughitt/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-15T04:46:56Z","updated_at":"2021-07-15T04:46:56Z","author_association":"NONE","body":"I notice a similar issue with a single-node CouchDB 3.1.1 setup..\r\n\r\n- attempting to add docs to the userdb immediately after creating the user sometimes fails\r\n- waiting 5 seconds before attempting to add the docs works fine.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/880387697/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/880462753","html_url":"https://github.com/apache/couchdb/pull/3667#issuecomment-880462753","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3667","id":880462753,"node_id":"MDEyOklzc3VlQ29tbWVudDg4MDQ2Mjc1Mw==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-15T07:26:08Z","updated_at":"2021-07-15T07:26:08Z","author_association":"CONTRIBUTOR","body":"Hi @noahshaw11,\r\n \r\n Please, could you extend the test case for attachment deletion here?\r\n https://github.com/apache/couchdb/blob/main/test/elixir/test/attachments_test.exs#L102\r\n\r\nThanks!\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/880462753/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/880863120","html_url":"https://github.com/apache/couchdb/issues/2483#issuecomment-880863120","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2483","id":880863120,"node_id":"MDEyOklzc3VlQ29tbWVudDg4MDg2MzEyMA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-15T16:58:26Z","updated_at":"2021-07-15T16:58:26Z","author_association":"CONTRIBUTOR","body":"Thanks for trying it out @jiahuili430\r\n\r\nI think we can close it as reproduce-able the latest release. If we get more details steps or  something we missed in our setup we can re-open it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/880863120/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/881924037","html_url":"https://github.com/apache/couchdb/pull/3667#issuecomment-881924037","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3667","id":881924037,"node_id":"IC_kwDOAAMmUc40kRfF","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-17T16:37:14Z","updated_at":"2021-07-17T16:37:14Z","author_association":"CONTRIBUTOR","body":"Merged. This should apply to 3.x with some minor changes","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/881924037/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/882518977","html_url":"https://github.com/apache/couchdb/issues/3660#issuecomment-882518977","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3660","id":882518977,"node_id":"IC_kwDOAAMmUc40mivB","user":{"login":"Nayana-ibm","id":20816038,"node_id":"MDQ6VXNlcjIwODE2MDM4","avatar_url":"https://avatars.githubusercontent.com/u/20816038?v=4","gravatar_id":"","url":"https://api.github.com/users/Nayana-ibm","html_url":"https://github.com/Nayana-ibm","followers_url":"https://api.github.com/users/Nayana-ibm/followers","following_url":"https://api.github.com/users/Nayana-ibm/following{/other_user}","gists_url":"https://api.github.com/users/Nayana-ibm/gists{/gist_id}","starred_url":"https://api.github.com/users/Nayana-ibm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Nayana-ibm/subscriptions","organizations_url":"https://api.github.com/users/Nayana-ibm/orgs","repos_url":"https://api.github.com/users/Nayana-ibm/repos","events_url":"https://api.github.com/users/Nayana-ibm/events{/privacy}","received_events_url":"https://api.github.com/users/Nayana-ibm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-19T12:47:55Z","updated_at":"2021-07-19T12:47:55Z","author_association":"NONE","body":"Few observations: \r\nChecked apache/couchdbci-debian:buster-erlang-20.3.8.26-1 for amd64 and could see package couch-libmozjs185-dev installed \r\nHowever on s390x image, couldn't find this package. \r\n\r\nTried building and installing erlang 22.2, elixir 1.10.2, node v14.2.0 and spider monkey js-1.8.5 on ub18.04. Test are passing with couchdb 3.x with this.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/882518977/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/882739572","html_url":"https://github.com/apache/couchdb/issues/3660#issuecomment-882739572","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3660","id":882739572,"node_id":"IC_kwDOAAMmUc40nYl0","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-19T17:48:40Z","updated_at":"2021-07-19T17:48:40Z","author_association":"CONTRIBUTOR","body":"Good observation @Nayana-ibm. We use libmozjs185 on ppc64le so perhaps there some issue with the newer JS library and we should switch to libmozjs185 for s390x for the time being.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/882739572/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/884397448","html_url":"https://github.com/apache/couchdb/issues/3675#issuecomment-884397448","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3675","id":884397448,"node_id":"IC_kwDOAAMmUc40ttWI","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-21T18:23:36Z","updated_at":"2021-10-14T16:21:34Z","author_association":"CONTRIBUTOR","body":"I think it might be doable if we record a few more bits in the checkpoint documents and change their shape a bit.\r\n\r\n* That's true that we don't record target sequences in checkpoints [1]. We could add that and bump the checkpoint version format.\r\n\r\n * I think we'd need to uniquely identify endpoint instances by a UUID. Then, we could add a new type of checkpoints, in addition to the current ones, which might look like `_local/rep_checkpoint_$fromid_$toid`.  In `main`, we recently added a per-db instance \"uuid\" field[2] already! Now wondering if it would this be possible to add it to 3.x dbs too. A new field the _dbs docs perhaps...?\r\n\r\n * To have second-order transitive checks, we may have to add a step during checkpointing where the replication jobs would copy all the `_local/rep_checkpoint_$fromid_$toid` checkpoint docs from the source to the target. So when `us-west` -> `store1` is initiated, we'd look for common `$fromid` -...-> `store1` and `$fromid` -...-> `us-west` checkpoints and find `us-east` -> `store1` (on `store1` target) and `us-east` -> `us-west` (on `us-west` source).\r\n\r\n  * One thing I am not 100% sure on is if we could always compare sequences to pick the max start sequence. On `main` `update_seq`s are FDB versionstamps, on 3.x we have shard nodes and uuids in there. We could have case of a random graph with PouchDb, `main` and `3.x` clustered CouchDB endpoints and such.\r\n\r\n\r\n[1] example checkpoint:\r\n```json\r\n{\r\n    \"_id\": \"_local/d99e532c1129e9cacbf7ed085deca509\",\r\n    \"_rev\": \"0-17\",\r\n    \"history\": [\r\n        {\r\n            \"doc_write_failures\": 0,\r\n            \"docs_read\": 249,\r\n            \"docs_written\": 249,\r\n            \"end_last_seq\": \"249-g1AAAACTeJzLYWBgYMpgTmHgz8tPSTV0MDQy1zMAQsMckEQiQ1L9____szKYE5tygQLsZiaGqWlpxpjKcRqRxwIkGRqA1H-oSeVgk5JMkkxNkg0xdWUBAJ5nJWc\",\r\n            \"end_time\": \"Wed, 21 Jul 2021 17:10:06 GMT\",\r\n            \"missing_checked\": 253,\r\n            \"missing_found\": 249,\r\n            \"recorded_seq\": \"249-g1AAAACTeJzLYWBgYMpgTmHgz8tPSTV0MDQy1zMAQsMckEQiQ1L9____szKYE5tygQLsZiaGqWlpxpjKcRqRxwIkGRqA1H-oSeVgk5JMkkxNkg0xdWUBAJ5nJWc\",\r\n            \"session_id\": \"dc645ae85a7c3fe6c3ac5da8e73077ce\",\r\n            \"start_last_seq\": \"228-g1AAAACTeJzLYWBgYMpgTmHgz8tPSTV0MDQy1zMAQsMckEQiQ1L9____szKYE0tzgQLsZiaGqWlpxpjKcRqRxwIkGRqA1H-oSflgk5JMkkxNkg0xdWUBAJgFJVI\",\r\n            \"start_time\": \"Wed, 21 Jul 2021 17:01:21 GMT\"\r\n        },\r\n        ...\r\n    ],\r\n    \"replication_id_version\": 4,\r\n    \"session_id\": \"dc645ae85a7c3fe6c3ac5da8e73077ce\",\r\n    \"source_last_seq\": \"249-g1AAAACTeJzLYWBgYMpgTmHgz8tPSTV0MDQy1zMAQsMckEQiQ1L9____szKYE5tygQLsZiaGqWlpxpjKcRqRxwIkGRqA1H-oSeVgk5JMkkxNkg0xdWUBAJ5nJWc\"\r\n}\r\n```\r\n\r\n[2] Unique, per db-instance UUID on `main`\r\n```json\r\nhttp $DB/mydb1\r\n\r\n{\r\n    ...\r\n    \"instance_start_time\": \"0\",\r\n    \"sizes\": {\r\n        \"external\": 34,\r\n        \"views\": 0\r\n    },\r\n    \"update_seq\": \"00000008d5c93d5a00000000\",\r\n    \"uuid\": \"ce0279e40045b4f7cd6cd4f60ffd3b3c\"\r\n}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/884397448/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/884878042","html_url":"https://github.com/apache/couchdb/pull/3676#issuecomment-884878042","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3676","id":884878042,"node_id":"IC_kwDOAAMmUc40vira","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-22T12:36:49Z","updated_at":"2021-07-22T12:36:49Z","author_association":"CONTRIBUTOR","body":"Could you add reference to https://github.com/cloudant-labs/ateles/pull/29 in `Related Issues or Pull Requests` section in the PR description?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/884878042/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590081","html_url":"https://github.com/apache/couchdb/issues/4224#issuecomment-1280590081","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4224","id":1280590081,"node_id":"IC_kwDOAAMmUc5MVEEB","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-22T16:27:59Z","updated_at":"2021-07-22T16:27:59Z","author_association":"MEMBER","body":"Step 0 is that users should try and use Mango first - which is significantly more performant than ddocs and far easier to understand.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590081/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/885702529","html_url":"https://github.com/apache/couchdb/issues/3660#issuecomment-885702529","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3660","id":885702529,"node_id":"IC_kwDOAAMmUc40yr-B","user":{"login":"SriramaSharma","id":12134236,"node_id":"MDQ6VXNlcjEyMTM0MjM2","avatar_url":"https://avatars.githubusercontent.com/u/12134236?v=4","gravatar_id":"","url":"https://api.github.com/users/SriramaSharma","html_url":"https://github.com/SriramaSharma","followers_url":"https://api.github.com/users/SriramaSharma/followers","following_url":"https://api.github.com/users/SriramaSharma/following{/other_user}","gists_url":"https://api.github.com/users/SriramaSharma/gists{/gist_id}","starred_url":"https://api.github.com/users/SriramaSharma/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SriramaSharma/subscriptions","organizations_url":"https://api.github.com/users/SriramaSharma/orgs","repos_url":"https://api.github.com/users/SriramaSharma/repos","events_url":"https://api.github.com/users/SriramaSharma/events{/privacy}","received_events_url":"https://api.github.com/users/SriramaSharma/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-23T15:03:26Z","updated_at":"2021-07-23T15:03:26Z","author_association":"NONE","body":"@nickva So what is the plan you suggest to proceed further on this ? \r\nAs @Nayana-ibm has pointed, `couch-libmozjs185-dev` which is installed on `apache/couchdbci-debian:buster-erlang-20.3.8.26-1` but not available on `apache/couchdbci-debian:s390x-buster-erlang-20.3.8.26-1`. \r\n\r\nCan we build the js185 on s390x using the steps specified here - https://github.com/linux-on-ibm-z/scripts/blob/master/CouchDB/3.1.1/build_couchdb.sh#L170 ?  \r\nOR\r\nShould we have s390x version of `couch-libmozjs185-dev` package built similar to how its done on amd64 ? ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/885702529/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/885762200","html_url":"https://github.com/apache/couchdb/issues/3660#issuecomment-885762200","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3660","id":885762200,"node_id":"IC_kwDOAAMmUc40y6iY","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-23T16:38:50Z","updated_at":"2021-07-23T16:38:50Z","author_association":"CONTRIBUTOR","body":"Ideally we'd find why mozjs60 (spidermonkey version 60) doesn't work on s390x but for the time being we should probably try to build as a deb/rpm package just like we build it for amd64 and ppc64le.\r\n\r\nThe best place to start is with the readme file in https://github.com/apache/couchdb-pkg\r\n\r\nThen https://github.com/apache/couchdb-pkg/search?q=ppc64le shows how ppc64le is handled, I imagine s390x would look similar. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/885762200/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/886122658","html_url":"https://github.com/apache/couchdb/pull/3681#issuecomment-886122658","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3681","id":886122658,"node_id":"IC_kwDOAAMmUc400Sii","user":{"login":"ArchangeGabriel","id":490531,"node_id":"MDQ6VXNlcjQ5MDUzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/490531?v=4","gravatar_id":"","url":"https://api.github.com/users/ArchangeGabriel","html_url":"https://github.com/ArchangeGabriel","followers_url":"https://api.github.com/users/ArchangeGabriel/followers","following_url":"https://api.github.com/users/ArchangeGabriel/following{/other_user}","gists_url":"https://api.github.com/users/ArchangeGabriel/gists{/gist_id}","starred_url":"https://api.github.com/users/ArchangeGabriel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ArchangeGabriel/subscriptions","organizations_url":"https://api.github.com/users/ArchangeGabriel/orgs","repos_url":"https://api.github.com/users/ArchangeGabriel/repos","events_url":"https://api.github.com/users/ArchangeGabriel/events{/privacy}","received_events_url":"https://api.github.com/users/ArchangeGabriel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-24T23:21:09Z","updated_at":"2021-07-24T23:21:09Z","author_association":"NONE","body":"Actually I see the folder does not exist, so maybe not a typo?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/886122658/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/886123133","html_url":"https://github.com/apache/couchdb/pull/3681#issuecomment-886123133","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3681","id":886123133,"node_id":"IC_kwDOAAMmUc400Sp9","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-24T23:27:28Z","updated_at":"2021-07-24T23:27:28Z","author_association":"MEMBER","body":"Not a typo, intentional - both versions of JS are supported by the same code in the code base.\r\n\r\nGood eye, though!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/886123133/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/886123317","html_url":"https://github.com/apache/couchdb/pull/3681#issuecomment-886123317","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3681","id":886123317,"node_id":"IC_kwDOAAMmUc400Ss1","user":{"login":"ArchangeGabriel","id":490531,"node_id":"MDQ6VXNlcjQ5MDUzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/490531?v=4","gravatar_id":"","url":"https://api.github.com/users/ArchangeGabriel","html_url":"https://github.com/ArchangeGabriel","followers_url":"https://api.github.com/users/ArchangeGabriel/followers","following_url":"https://api.github.com/users/ArchangeGabriel/following{/other_user}","gists_url":"https://api.github.com/users/ArchangeGabriel/gists{/gist_id}","starred_url":"https://api.github.com/users/ArchangeGabriel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ArchangeGabriel/subscriptions","organizations_url":"https://api.github.com/users/ArchangeGabriel/orgs","repos_url":"https://api.github.com/users/ArchangeGabriel/repos","events_url":"https://api.github.com/users/ArchangeGabriel/events{/privacy}","received_events_url":"https://api.github.com/users/ArchangeGabriel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-24T23:29:40Z","updated_at":"2021-07-24T23:29:40Z","author_association":"NONE","body":"OK, thanks and sorry for the disturbance!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/886123317/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/887590002","html_url":"https://github.com/apache/couchdb/pull/3643#issuecomment-887590002","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3643","id":887590002,"node_id":"IC_kwDOAAMmUc4054xy","user":{"login":"jiahuili430","id":54631519,"node_id":"MDQ6VXNlcjU0NjMxNTE5","avatar_url":"https://avatars.githubusercontent.com/u/54631519?v=4","gravatar_id":"","url":"https://api.github.com/users/jiahuili430","html_url":"https://github.com/jiahuili430","followers_url":"https://api.github.com/users/jiahuili430/followers","following_url":"https://api.github.com/users/jiahuili430/following{/other_user}","gists_url":"https://api.github.com/users/jiahuili430/gists{/gist_id}","starred_url":"https://api.github.com/users/jiahuili430/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiahuili430/subscriptions","organizations_url":"https://api.github.com/users/jiahuili430/orgs","repos_url":"https://api.github.com/users/jiahuili430/repos","events_url":"https://api.github.com/users/jiahuili430/events{/privacy}","received_events_url":"https://api.github.com/users/jiahuili430/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T15:04:22Z","updated_at":"2021-07-27T15:04:22Z","author_association":"CONTRIBUTOR","body":"Thanks to everyone who helped me complete this PR, especially @nickva, @iilyak, and @rnewson.\r\n\r\n@nickva found the bug in `listen/2`, we cannot use `node()` to return node info. Because when setting up CouchDB, `node()` cannot return the name of the node because it is not connected to CouchDB yet.\r\n@iilyak, he helped the software design part to make the application more scalable and extensible.\r\nThank you, @rnewson. Without your code, we cannot figure out how to enable custom erlang network protocol for CouchDB.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/887590002/reactions","total_count":4,"+1":0,"-1":0,"laugh":1,"hooray":1,"confused":0,"heart":0,"rocket":2,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/887658844","html_url":"https://github.com/apache/couchdb/pull/3682#issuecomment-887658844","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3682","id":887658844,"node_id":"IC_kwDOAAMmUc406Jlc","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T16:31:37Z","updated_at":"2021-07-27T16:31:37Z","author_association":"CONTRIBUTOR","body":"@jiahuili430 one minor nit is I think you forgot to target this for 3.x not main :-)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/887658844/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/887660455","html_url":"https://github.com/apache/couchdb/pull/3682#issuecomment-887660455","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3682","id":887660455,"node_id":"IC_kwDOAAMmUc406J-n","user":{"login":"jiahuili430","id":54631519,"node_id":"MDQ6VXNlcjU0NjMxNTE5","avatar_url":"https://avatars.githubusercontent.com/u/54631519?v=4","gravatar_id":"","url":"https://api.github.com/users/jiahuili430","html_url":"https://github.com/jiahuili430","followers_url":"https://api.github.com/users/jiahuili430/followers","following_url":"https://api.github.com/users/jiahuili430/following{/other_user}","gists_url":"https://api.github.com/users/jiahuili430/gists{/gist_id}","starred_url":"https://api.github.com/users/jiahuili430/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiahuili430/subscriptions","organizations_url":"https://api.github.com/users/jiahuili430/orgs","repos_url":"https://api.github.com/users/jiahuili430/repos","events_url":"https://api.github.com/users/jiahuili430/events{/privacy}","received_events_url":"https://api.github.com/users/jiahuili430/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T16:34:05Z","updated_at":"2021-07-27T16:34:05Z","author_association":"CONTRIBUTOR","body":"CouchDB main doesn't use the dist protocol, so closed.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/887660455/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/887661620","html_url":"https://github.com/apache/couchdb/pull/3643#issuecomment-887661620","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3643","id":887661620,"node_id":"IC_kwDOAAMmUc406KQ0","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T16:35:41Z","updated_at":"2021-07-27T16:35:41Z","author_association":"CONTRIBUTOR","body":"We'd want documentation PR as well probably. It could probably re-iterate some of the comments in the vm.args file","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/887661620/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/887868414","html_url":"https://github.com/apache/couchdb/pull/3643#issuecomment-887868414","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3643","id":887868414,"node_id":"IC_kwDOAAMmUc4068v-","user":{"login":"jiahuili430","id":54631519,"node_id":"MDQ6VXNlcjU0NjMxNTE5","avatar_url":"https://avatars.githubusercontent.com/u/54631519?v=4","gravatar_id":"","url":"https://api.github.com/users/jiahuili430","html_url":"https://github.com/jiahuili430","followers_url":"https://api.github.com/users/jiahuili430/followers","following_url":"https://api.github.com/users/jiahuili430/following{/other_user}","gists_url":"https://api.github.com/users/jiahuili430/gists{/gist_id}","starred_url":"https://api.github.com/users/jiahuili430/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiahuili430/subscriptions","organizations_url":"https://api.github.com/users/jiahuili430/orgs","repos_url":"https://api.github.com/users/jiahuili430/repos","events_url":"https://api.github.com/users/jiahuili430/events{/privacy}","received_events_url":"https://api.github.com/users/jiahuili430/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-27T22:11:14Z","updated_at":"2021-07-27T22:11:14Z","author_association":"CONTRIBUTOR","body":"> We'd want documentation PR as well probably. It could probably re-iterate some of the comments in the vm.args file\r\n\r\nAdd documentation: https://github.com/apache/couchdb-documentation/pull/673","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/887868414/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888203471","html_url":"https://github.com/apache/couchdb/pull/3363#issuecomment-888203471","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3363","id":888203471,"node_id":"IC_kwDOAAMmUc408OjP","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T10:33:59Z","updated_at":"2021-07-28T10:33:59Z","author_association":"CONTRIBUTOR","body":"Not reproducible on main","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888203471/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888276499","html_url":"https://github.com/apache/couchdb/pull/3638#issuecomment-888276499","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3638","id":888276499,"node_id":"IC_kwDOAAMmUc408gYT","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T12:41:46Z","updated_at":"2021-07-28T12:41:46Z","author_association":"MEMBER","body":"I'm fine with this change but would appreciate pointers to relevant RFC's. in the original ticket there was a brief but lively (and unresolved) discussion around that.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888276499/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888278678","html_url":"https://github.com/apache/couchdb/pull/3638#issuecomment-888278678","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3638","id":888278678,"node_id":"IC_kwDOAAMmUc408g6W","user":{"login":"flimzy","id":8555063,"node_id":"MDQ6VXNlcjg1NTUwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8555063?v=4","gravatar_id":"","url":"https://api.github.com/users/flimzy","html_url":"https://github.com/flimzy","followers_url":"https://api.github.com/users/flimzy/followers","following_url":"https://api.github.com/users/flimzy/following{/other_user}","gists_url":"https://api.github.com/users/flimzy/gists{/gist_id}","starred_url":"https://api.github.com/users/flimzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flimzy/subscriptions","organizations_url":"https://api.github.com/users/flimzy/orgs","repos_url":"https://api.github.com/users/flimzy/repos","events_url":"https://api.github.com/users/flimzy/events{/privacy}","received_events_url":"https://api.github.com/users/flimzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T12:45:02Z","updated_at":"2021-07-28T12:45:02Z","author_association":"MEMBER","body":"> I'm fine with this change but would appreciate pointers to relevant RFC's. in the original ticket there was a brief but lively (and unresolved) discussion around that.\r\n\r\nI believe the relevant RFC, as I mentioned in my now-closed-as-duplicate bug https://github.com/apache/couchdb/issues/3565, is [RFC3986 2.2](https://datatracker.ietf.org/doc/html/rfc3986#section-2.2):\r\n\r\n\r\n>       gen-delims  = \":\" / \"/\" / \"?\" / \"#\" / \"[\" / \"]\" / \"@\"\r\n>\r\n> A subset of the reserved characters (gen-delims) is used as delimiters of the generic URI components described in Section 3.\r\n\r\nAnd the preamble to section 3:\r\n\r\n> The generic URI syntax consists of a hierarchical sequence of components referred to as the scheme, authority, path, query, and fragment.\r\n>\r\n>      URI         = scheme \":\" hier-part [ \"?\" query ] [ \"#\" fragment ]\r\n>\r\n>      hier-part   = \"//\" authority path-abempty\r\n>                  / path-absolute\r\n>                  / path-rootless\r\n>                  / path-empty\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888278678/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888394172","html_url":"https://github.com/apache/couchdb/pull/3638#issuecomment-888394172","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3638","id":888394172,"node_id":"IC_kwDOAAMmUc4089G8","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T15:15:12Z","updated_at":"2021-07-28T22:07:10Z","author_association":"CONTRIBUTOR","body":"I wonder if the fix is something we could submit to mochiweb. It would be a compatibility issue there [too](https://github.com/mochi/mochiweb/blob/main/src/mochiweb_request.erl#L212-L215)  and we can see how they'd want to handle it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888394172/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888419524","html_url":"https://github.com/apache/couchdb/pull/3638#issuecomment-888419524","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3638","id":888419524,"node_id":"IC_kwDOAAMmUc409DTE","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T15:48:26Z","updated_at":"2021-07-28T15:48:26Z","author_association":"MEMBER","body":"agreeing with nick that it would be nice to approach mochiweb first with a PR that either fixes the existing `unquote` function or, more likely, replaces it with a few unquote functions applying the distinct rules for different parts of a URI, and then have couchdb call the right ones. We can maintain that in our fork if there is an issue from upstream, but that upstream debate sounds like it would be valuable.\r\n\r\nFor the record, I'm onboard with making the change (jan/nick/myself are of the view to change default behaviour in 4.0 with an opt-in mode for 3.x) but I think it would be good to have the mochi-level discussion.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888419524/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888532402","html_url":"https://github.com/apache/couchdb/pull/3604#issuecomment-888532402","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3604","id":888532402,"node_id":"IC_kwDOAAMmUc409e2y","user":{"login":"noahshaw11","id":47468872,"node_id":"MDQ6VXNlcjQ3NDY4ODcy","avatar_url":"https://avatars.githubusercontent.com/u/47468872?v=4","gravatar_id":"","url":"https://api.github.com/users/noahshaw11","html_url":"https://github.com/noahshaw11","followers_url":"https://api.github.com/users/noahshaw11/followers","following_url":"https://api.github.com/users/noahshaw11/following{/other_user}","gists_url":"https://api.github.com/users/noahshaw11/gists{/gist_id}","starred_url":"https://api.github.com/users/noahshaw11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahshaw11/subscriptions","organizations_url":"https://api.github.com/users/noahshaw11/orgs","repos_url":"https://api.github.com/users/noahshaw11/repos","events_url":"https://api.github.com/users/noahshaw11/events{/privacy}","received_events_url":"https://api.github.com/users/noahshaw11/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T18:37:03Z","updated_at":"2021-07-28T18:37:03Z","author_association":"CONTRIBUTOR","body":"Closing this again. Upstream is not responding on merging the required PR.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888532402/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888640375","html_url":"https://github.com/apache/couchdb/pull/3638#issuecomment-888640375","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3638","id":888640375,"node_id":"IC_kwDOAAMmUc4095N3","user":{"login":"noahshaw11","id":47468872,"node_id":"MDQ6VXNlcjQ3NDY4ODcy","avatar_url":"https://avatars.githubusercontent.com/u/47468872?v=4","gravatar_id":"","url":"https://api.github.com/users/noahshaw11","html_url":"https://github.com/noahshaw11","followers_url":"https://api.github.com/users/noahshaw11/followers","following_url":"https://api.github.com/users/noahshaw11/following{/other_user}","gists_url":"https://api.github.com/users/noahshaw11/gists{/gist_id}","starred_url":"https://api.github.com/users/noahshaw11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahshaw11/subscriptions","organizations_url":"https://api.github.com/users/noahshaw11/orgs","repos_url":"https://api.github.com/users/noahshaw11/repos","events_url":"https://api.github.com/users/noahshaw11/events{/privacy}","received_events_url":"https://api.github.com/users/noahshaw11/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T21:41:27Z","updated_at":"2021-07-28T21:41:27Z","author_association":"CONTRIBUTOR","body":"I have submitted a PR upstream: https://github.com/mochi/mochiweb/pull/234","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888640375/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888644007","html_url":"https://github.com/apache/couchdb/pull/3643#issuecomment-888644007","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3643","id":888644007,"node_id":"IC_kwDOAAMmUc4096Gn","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-28T21:49:11Z","updated_at":"2021-07-28T21:49:11Z","author_association":"CONTRIBUTOR","body":"Well done, @jiahuili430. Merging to 3.x","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888644007/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888830706","html_url":"https://github.com/apache/couchdb/pull/3638#issuecomment-888830706","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3638","id":888830706,"node_id":"IC_kwDOAAMmUc40-nry","user":{"login":"noahshaw11","id":47468872,"node_id":"MDQ6VXNlcjQ3NDY4ODcy","avatar_url":"https://avatars.githubusercontent.com/u/47468872?v=4","gravatar_id":"","url":"https://api.github.com/users/noahshaw11","html_url":"https://github.com/noahshaw11","followers_url":"https://api.github.com/users/noahshaw11/followers","following_url":"https://api.github.com/users/noahshaw11/following{/other_user}","gists_url":"https://api.github.com/users/noahshaw11/gists{/gist_id}","starred_url":"https://api.github.com/users/noahshaw11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahshaw11/subscriptions","organizations_url":"https://api.github.com/users/noahshaw11/orgs","repos_url":"https://api.github.com/users/noahshaw11/repos","events_url":"https://api.github.com/users/noahshaw11/events{/privacy}","received_events_url":"https://api.github.com/users/noahshaw11/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T06:08:37Z","updated_at":"2021-07-29T06:08:37Z","author_association":"CONTRIBUTOR","body":"The PR upstream has been merged. I will repurpose this PR and make the changes to call the appropriate functions.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888830706/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":2,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888923713","html_url":"https://github.com/apache/couchdb/issues/3517#issuecomment-888923713","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3517","id":888923713,"node_id":"IC_kwDOAAMmUc40--ZB","user":{"login":"rkulkarni","id":338409,"node_id":"MDQ6VXNlcjMzODQwOQ==","avatar_url":"https://avatars.githubusercontent.com/u/338409?v=4","gravatar_id":"","url":"https://api.github.com/users/rkulkarni","html_url":"https://github.com/rkulkarni","followers_url":"https://api.github.com/users/rkulkarni/followers","following_url":"https://api.github.com/users/rkulkarni/following{/other_user}","gists_url":"https://api.github.com/users/rkulkarni/gists{/gist_id}","starred_url":"https://api.github.com/users/rkulkarni/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rkulkarni/subscriptions","organizations_url":"https://api.github.com/users/rkulkarni/orgs","repos_url":"https://api.github.com/users/rkulkarni/repos","events_url":"https://api.github.com/users/rkulkarni/events{/privacy}","received_events_url":"https://api.github.com/users/rkulkarni/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T08:39:44Z","updated_at":"2021-07-29T08:39:44Z","author_association":"NONE","body":"Hello folks, is there an update on this issue? I'm also facing this issue when I migrate from 2.3.1 to 3.1.1. View queries with reduce are significantly slower.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/888923713/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/889434143","html_url":"https://github.com/apache/couchdb/pull/3685#issuecomment-889434143","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3685","id":889434143,"node_id":"IC_kwDOAAMmUc41A7Af","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-29T20:24:48Z","updated_at":"2021-07-29T20:24:48Z","author_association":"CONTRIBUTOR","body":"I think we're still missing another corner case when we delete a document without a rev:\r\n\r\n```\r\n$ http delete $DB/db/doc/att1\r\nHTTP/1.1 404 Object Not Found\r\n\r\n{\r\n    \"error\": \"not_found\",\r\n    \"reason\": \"Document is missing attachment\"\r\n}\r\n```\r\n\r\nWe'd expect a 409 here but we get a 404.\r\n\r\nWe will probably have to check for the attachment existence in this part:\r\n\r\n```\r\nDoc = case extract_header_rev(Req, chttpd:qs_value(Req, \"rev\")) of\r\n        missing_rev -> % make the new doc\r\n            if Method =/= 'DELETE' -> ok; true ->\r\n                % check doc and attachment\r\n                couch_doc_open(Db, DocId, nil, [])\r\n```\r\n\r\nand in \r\n```\r\n       Rev ->\r\n            case fabric:open_revs(Db, DocId, [Rev], [{user_ctx,Ctx}]) of\r\n            {ok, [{ok, Doc0}]} ->\r\n                chttpd_stats:incr_reads(),\r\n                % check for existence of attachment....\r\n                Doc0;\r\n```\r\n\r\nAnd if those pass just let it fall through to the fabric:update_doc/3 and blow up with a 409 ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/889434143/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]