[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359524690","html_url":"https://github.com/apache/couchdb/issues/1122#issuecomment-359524690","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1122","id":359524690,"node_id":"MDEyOklzc3VlQ29tbWVudDM1OTUyNDY5MA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-22T18:48:07Z","updated_at":"2018-01-22T18:48:07Z","author_association":"MEMBER","body":"No, the test actually been calling `couch_db:delete/2` inside `cycle`, inside `loop`, inside `_assert,` inside `timeout`, inside a list comprehension - [right here](https://github.com/apache/couchdb/blob/e81c54e32d2a165dc762ad4217b753da723dc1fa/src/couch/test/couch_db_tests.erl#L127). It just hard to see because the thing been rather convoluted. \r\n\r\nThe semantics didn't changed, we are still calling same `couch_db:create/2`, `couch_db:close/1` (inside `create_db` helper) and then `couch_server:delete/2` inside `delete_db` helper repeatedly. \r\n\r\nWhat changed is wrapping `?_test` that ensure that we are not ignoring failures in preparation stages, i.e. that initial db creation or in between asserts, I suppose that's how it was passing before. I'll look into this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359524690/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359528544","html_url":"https://github.com/apache/couchdb/issues/1122#issuecomment-359528544","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1122","id":359528544,"node_id":"MDEyOklzc3VlQ29tbWVudDM1OTUyODU0NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-22T19:00:33Z","updated_at":"2018-01-22T19:00:33Z","author_association":"MEMBER","body":"Thanks, I'm not great at reading Erlang code.\r\n\r\nI appreciate you taking a look!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359528544/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359559291","html_url":"https://github.com/apache/couchdb/pull/1123#issuecomment-359559291","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1123","id":359559291,"node_id":"MDEyOklzc3VlQ29tbWVudDM1OTU1OTI5MQ==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-22T20:47:29Z","updated_at":"2018-01-22T20:47:29Z","author_association":"MEMBER","body":"@wohali This should fix Jenkins, but I guess it needs to hit \"master\" to confirm. Sorry about this mixup, the original test was kind of hard to untangle, that's mainly the reason I took on refactoring it.\r\n\r\nAlternatively we can just remote this \"100 times\" run, honestly it doesn't really prove or demonstrate anything \"10 times\" run doesn't show.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359559291/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359599179","html_url":"https://github.com/apache/couchdb/pull/1123#issuecomment-359599179","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1123","id":359599179,"node_id":"MDEyOklzc3VlQ29tbWVudDM1OTU5OTE3OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-22T22:55:42Z","updated_at":"2018-01-22T22:55:42Z","author_association":"MEMBER","body":"Nice, looks good. +1\r\n\r\nIf you want to also remove the 100x test, go for it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359599179/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359790233","html_url":"https://github.com/apache/couchdb/pull/1072#issuecomment-359790233","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1072","id":359790233,"node_id":"MDEyOklzc3VlQ29tbWVudDM1OTc5MDIzMw==","user":{"login":"jiangphcn","id":18000622,"node_id":"MDQ6VXNlcjE4MDAwNjIy","avatar_url":"https://avatars.githubusercontent.com/u/18000622?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangphcn","html_url":"https://github.com/jiangphcn","followers_url":"https://api.github.com/users/jiangphcn/followers","following_url":"https://api.github.com/users/jiangphcn/following{/other_user}","gists_url":"https://api.github.com/users/jiangphcn/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangphcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangphcn/subscriptions","organizations_url":"https://api.github.com/users/jiangphcn/orgs","repos_url":"https://api.github.com/users/jiangphcn/repos","events_url":"https://api.github.com/users/jiangphcn/events{/privacy}","received_events_url":"https://api.github.com/users/jiangphcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-23T13:28:44Z","updated_at":"2018-01-23T13:28:44Z","author_association":"CONTRIBUTOR","body":"https://tools.ietf.org/html/rfc4918#section-10.3\r\nhttps://tools.ietf.org/html/rfc3986\r\n\r\nFrom above links, we know that\r\n```\r\n10.3.  Destination Header\r\n\r\n   The Destination request header specifies the URI that identifies a\r\n   destination resource for methods such as COPY and MOVE, which take\r\n   two URIs as parameters.\r\n\r\n      Destination = \"Destination\" \":\" Simple-ref\r\n\r\n\r\n   If the Destination value is an absolute-URI (Section 4.3 of\r\n   [RFC3986]), it may name a different server (or different port or\r\n   scheme).  If the source server cannot attempt a copy to the remote\r\n   server, it MUST fail the request.  Note that copying and moving\r\n   resources to remote servers is not fully defined in this\r\n   specification (e.g., specific error conditions).\r\n```\r\n\r\n```\r\nAbstract\r\n\r\n   A Uniform Resource Identifier (URI) is a compact sequence of\r\n   characters that identifies an abstract or physical resource.  This\r\n   specification defines the generic URI syntax and a process for\r\n   resolving URI references that might be in relative form, along with\r\n   guidelines and security considerations for the use of URIs on the\r\n   Internet.  The URI syntax defines a grammar that is a superset of all\r\n   valid URIs, allowing an implementation to parse the common components\r\n   of a URI reference without knowing the scheme-specific requirements\r\n   of every possible identifier.  This specification does not define a\r\n   generative grammar for URIs; that task is performed by the individual\r\n   specifications of each URI scheme.\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359790233/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359790861","html_url":"https://github.com/apache/couchdb/pull/1072#issuecomment-359790861","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1072","id":359790861,"node_id":"MDEyOklzc3VlQ29tbWVudDM1OTc5MDg2MQ==","user":{"login":"jiangphcn","id":18000622,"node_id":"MDQ6VXNlcjE4MDAwNjIy","avatar_url":"https://avatars.githubusercontent.com/u/18000622?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangphcn","html_url":"https://github.com/jiangphcn","followers_url":"https://api.github.com/users/jiangphcn/followers","following_url":"https://api.github.com/users/jiangphcn/following{/other_user}","gists_url":"https://api.github.com/users/jiangphcn/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangphcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangphcn/subscriptions","organizations_url":"https://api.github.com/users/jiangphcn/orgs","repos_url":"https://api.github.com/users/jiangphcn/repos","events_url":"https://api.github.com/users/jiangphcn/events{/privacy}","received_events_url":"https://api.github.com/users/jiangphcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-23T13:31:05Z","updated_at":"2018-01-23T13:31:05Z","author_association":"CONTRIBUTOR","body":"My understanding is that it is not restricted to encode or un-encode URI. For with url encoding, it is safe from security's point of view.\r\n\r\nWhen discussing with Bob and Paul, Bob mentioned \"we should encode the destination header value, and decode it wherever we might need to (if anywhere)\".\r\n\r\nHere is one place we need to decode URI. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359790861/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359854883","html_url":"https://github.com/apache/couchdb/issues/1124#issuecomment-359854883","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1124","id":359854883,"node_id":"MDEyOklzc3VlQ29tbWVudDM1OTg1NDg4Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-23T16:50:31Z","updated_at":"2018-01-23T16:50:31Z","author_association":"MEMBER","body":"No, this is not something you can change. You will need to correct your \"datapower\" machine configuration.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359854883/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359929477","html_url":"https://github.com/apache/couchdb/issues/603#issuecomment-359929477","issue_url":"https://api.github.com/repos/apache/couchdb/issues/603","id":359929477,"node_id":"MDEyOklzc3VlQ29tbWVudDM1OTkyOTQ3Nw==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-23T21:03:02Z","updated_at":"2018-01-23T21:03:02Z","author_association":"CONTRIBUTOR","body":"I've also noticed this issue during my cluster testing. \r\nI think the problem is here https://github.com/apache/couchdb/blob/d16f2db901c9b3b24c7189acfec35ec42895bd25/src/fabric/src/fabric_db_create.erl#L143\r\n\r\nAccepted is returned if the number of responses are at least (W div 2 + 1). If you get less than this value an internal server error is returned. \r\n\r\nIn a three node cluster where the quorum is 2, you need at least 2 responses in order to get accepted as response which is the same number you need for a 200 status code response.\r\n\r\nThis seems not to be consistent with this description in the documentation \"[11.2 Theory](http://docs.couchdb.org/en/2.1.1/cluster/theory.html)\" which applies to document reads/writes not to db creation but I expected a similar behaviour .\r\n\r\n> The number of copies of a document with the same revision that have to be read before CouchDB returns with a 200 is equal to a **half of total copies of the document plus one**. It is the same for the number of nodes that need to save a document before a write is returned with 201. If there are less nodes than that number, then 202 is returned. Both read and write numbers can be specified with a request as r and w parameters accordingly.\r\n\r\nW div 2 + 1, seems to be the default quorum required for a 200 status code, not for a 202 status code response\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359929477/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359965144","html_url":"https://github.com/apache/couchdb/issues/1093#issuecomment-359965144","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1093","id":359965144,"node_id":"MDEyOklzc3VlQ29tbWVudDM1OTk2NTE0NA==","user":{"login":"ReeceStevens","id":5847947,"node_id":"MDQ6VXNlcjU4NDc5NDc=","avatar_url":"https://avatars.githubusercontent.com/u/5847947?v=4","gravatar_id":"","url":"https://api.github.com/users/ReeceStevens","html_url":"https://github.com/ReeceStevens","followers_url":"https://api.github.com/users/ReeceStevens/followers","following_url":"https://api.github.com/users/ReeceStevens/following{/other_user}","gists_url":"https://api.github.com/users/ReeceStevens/gists{/gist_id}","starred_url":"https://api.github.com/users/ReeceStevens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ReeceStevens/subscriptions","organizations_url":"https://api.github.com/users/ReeceStevens/orgs","repos_url":"https://api.github.com/users/ReeceStevens/repos","events_url":"https://api.github.com/users/ReeceStevens/events{/privacy}","received_events_url":"https://api.github.com/users/ReeceStevens/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-23T23:18:15Z","updated_at":"2018-01-23T23:18:15Z","author_association":"NONE","body":"Hi there @wohali ,\r\n\r\nPreface: I only had couchDB 2.0.0 to work with when trying your suggestions, but I believe the underlying behavior is identical to v2.1.1.\r\n\r\nSo I first watched message queues while the problem occurred-- I'm not sure what a relatively large message queue size is for couchDB but the only ones that rose significantly were `file_server_2` and `couch_index_server` (\"significantly\" meaning on the order of 100). However, this was always a transient increase, and by the time couch started throwing 500 errors they were both back at zero. I never saw `couch_server` increase at all. FWIW, I will post the `_system` node response after couch crashes at the bottom of this response.\r\n\r\nNext, I ran with the `update_lru_on_read = false` option set in my `local.ini`. This seemed to trigger the error more quickly. Before adding the option, couchDB would take about 24-26 iterations of my parallel replication script before crashing; after, it only took 4. This was consistent across multiple trials.\r\n\r\n### `_system` node response with `update_lru_on_read` not set\r\n\r\n```\r\n{\r\n  \"uptime\": 228,\r\n  \"memory\": {\r\n    \"other\": 108667722,\r\n    \"atom\": 504409,\r\n    \"atom_used\": 472138,\r\n    \"processes\": 34621392,\r\n    \"processes_used\": 34608264,\r\n    \"binary\": 813285896,\r\n    \"code\": 12084677,\r\n    \"ets\": 1842064\r\n  },\r\n  \"run_queue\": 0,\r\n  \"ets_table_count\": 86,\r\n  \"context_switches\": 7444084,\r\n  \"reductions\": 1233973042,\r\n  \"garbage_collection_count\": 842909,\r\n  \"words_reclaimed\": 1573709799,\r\n  \"io_input\": 7708805364,\r\n  \"io_output\": 6367883539,\r\n  \"os_proc_count\": 0,\r\n  \"stale_proc_count\": 0,\r\n  \"process_count\": 876,\r\n  \"process_limit\": 262144,\r\n  \"message_queues\": {\r\n    \"couch_file\": {\r\n      \"50\": 0,\r\n      \"90\": 0,\r\n      \"99\": 0,\r\n      \"count\": 216,\r\n      \"min\": 0,\r\n      \"max\": 0\r\n    },\r\n    \"couch_db_updater\": {\r\n      \"50\": 0,\r\n      \"90\": 0,\r\n      \"99\": 0,\r\n      \"count\": 176,\r\n      \"min\": 0,\r\n      \"max\": 0\r\n    },\r\n    \"error_logger\": 0,\r\n    \"couch_auth_cache\": 0,\r\n    \"mango_sup\": 0,\r\n    \"httpd_sup\": 0,\r\n    \"couch_log_sup\": 0,\r\n    \"couch_log_server\": 0,\r\n    \"erl_prim_loader\": 0,\r\n    \"global_group\": 0,\r\n    \"standard_error_sup\": 0,\r\n    \"erl_epmd\": 0,\r\n    \"couch_epi_sup\": 0,\r\n    \"couch_epi_functions_gen_couch_index\": 0,\r\n    \"couch_epi_functions_gen_chttpd_auth\": 0,\r\n    \"couch_epi_functions_gen_couch_db\": 0,\r\n    \"couch_epi_functions_gen_global_changes\": 0,\r\n    \"kernel_safe_sup\": 0,\r\n    \"couch_epi_functions_gen_chttpd_handlers\": 0,\r\n    \"couch_epi_functions_gen_chttpd\": 0,\r\n    \"auth\": 0,\r\n    \"code_server\": 0,\r\n    \"rexi_buffer_couchdb@localhost\": 0,\r\n    \"rexi_server_couchdb@localhost\": 0,\r\n    \"mem3_sync_nodes\": 0,\r\n    \"application_controller\": 0,\r\n    \"httpc_sup\": 0,\r\n    \"mochiweb_clock\": 0,\r\n    \"mem3_sync\": 0,\r\n    \"config_sup\": 0,\r\n    \"mem3_sup\": 0,\r\n    \"config\": 0,\r\n    \"httpc_profile_sup\": 0,\r\n    \"mem3_shards\": 0,\r\n    \"global_changes_sup\": 0,\r\n    \"inet_gethost_native_sup\": 0,\r\n    \"httpc_manager\": 0,\r\n    \"global_changes_server\": 0,\r\n    \"httpc_handler_sup\": 0,\r\n    \"runtime_tools_sup\": 0,\r\n    \"mem3_nodes\": 0,\r\n    \"net_kernel\": 0,\r\n    \"user\": 0,\r\n    \"ddoc_cache_sup\": 0,\r\n    \"ftp_sup\": 0,\r\n    \"rexi_sup\": 0,\r\n    \"ddoc_cache_opener\": 0,\r\n    \"rexi_server_sup\": 0,\r\n    \"rexi_server_mon\": 0,\r\n    \"rexi_server\": 0,\r\n    \"ddoc_cache_lru\": 0,\r\n    \"ioq_sup\": 0,\r\n    \"chttpd_auth_cache_lru\": 0,\r\n    \"memsup\": 0,\r\n    \"mem3_events\": 0,\r\n    \"disksup\": 0,\r\n    \"ioq\": 0,\r\n    \"couch_secondary_services\": 0,\r\n    \"cpu_sup\": 0,\r\n    \"couch_primary_services\": 0,\r\n    \"couch_replicator_sup\": 0,\r\n    \"ibrowse_sup\": 0,\r\n    \"couch_replicator_manager\": 0,\r\n    \"couch_replicator_job_sup\": 0,\r\n    \"couch_uuids\": 0,\r\n    \"rexi_buffer_mon\": 0,\r\n    \"config_event\": 0,\r\n    \"rexi_buffer_sup\": 0,\r\n    \"ibrowse\": 0,\r\n    \"couch_event_sup2\": 0,\r\n    \"couch_event_server\": 0,\r\n    \"couch_task_status\": 0,\r\n    \"couch_event_os_sup\": 0,\r\n    \"couch_sup\": 0,\r\n    \"release_handler\": 0,\r\n    \"couch_server\": 0,\r\n    \"os_mon_sup\": 0,\r\n    \"overload\": 0,\r\n    \"couch_proc_manager\": 0,\r\n    \"sasl_sup\": 0,\r\n    \"couch_stats_sup\": 0,\r\n    \"couch_stats_process_tracker\": 0,\r\n    \"couch_plugin\": 0,\r\n    \"couch_replication\": 0,\r\n    \"alarm_handler\": 0,\r\n    \"couch_os_daemons\": 0,\r\n    \"tftp_sup\": 0,\r\n    \"sasl_safe_sup\": 0,\r\n    \"couch_stats_aggregator\": 0,\r\n    \"timer_server\": 0,\r\n    \"couch_httpd_vhost\": 0,\r\n    \"folsom_sup\": 0,\r\n    \"couch_index_sup\": 0,\r\n    \"folsom_sample_slide_sup\": 0,\r\n    \"couch_index_server\": 0,\r\n    \"couch_httpd\": 0,\r\n    \"rex\": 0,\r\n    \"standard_error\": 0,\r\n    \"init\": 0,\r\n    \"net_sup\": 0,\r\n    \"tls_connection_sup\": 0,\r\n    \"chttpd_sup\": 0,\r\n    \"kernel_sup\": 0,\r\n    \"couch_external_manager\": 0,\r\n    \"global_name_server\": 0,\r\n    \"folsom_metrics_histogram_ets\": 0,\r\n    \"file_server_2\": 0,\r\n    \"couch_drv\": 0,\r\n    \"ssl_sup\": 0,\r\n    \"folsom_meter_timer_server\": 0,\r\n    \"chttpd_auth_cache\": 0,\r\n    \"setup_sup\": 0,\r\n    \"inet_gethost_native\": 0,\r\n    \"inet_db\": 0,\r\n    \"inets_sup\": 0,\r\n    \"ssl_manager\": 0,\r\n    \"ssl_listen_tracker_sup\": 0,\r\n    \"couch_compaction_daemon\": 0,\r\n    \"chttpd\": 0\r\n  },\r\n  \"internal_replication_jobs\": 0,\r\n  \"distribution\": {}\r\n}\r\n```\r\n\r\n### `_system` node response with `update_lru_on_read = false`\r\n\r\n```\r\n{\r\n  \"uptime\": 357,\r\n  \"memory\": {\r\n    \"other\": 107225738,\r\n    \"atom\": 504409,\r\n    \"atom_used\": 472138,\r\n    \"processes\": 26205048,\r\n    \"processes_used\": 26174352,\r\n    \"binary\": 572270512,\r\n    \"code\": 12084677,\r\n    \"ets\": 1700232\r\n  },\r\n  \"run_queue\": 0,\r\n  \"ets_table_count\": 86,\r\n  \"context_switches\": 5537983,\r\n  \"reductions\": 867477179,\r\n  \"garbage_collection_count\": 787554,\r\n  \"words_reclaimed\": 1465399318,\r\n  \"io_input\": 5019941144,\r\n  \"io_output\": 2954750043,\r\n  \"os_proc_count\": 0,\r\n  \"stale_proc_count\": 0,\r\n  \"process_count\": 736,\r\n  \"process_limit\": 262144,\r\n  \"message_queues\": {\r\n    \"couch_file\": {\r\n      \"50\": 0,\r\n      \"90\": 0,\r\n      \"99\": 0,\r\n      \"count\": 168,\r\n      \"min\": 0,\r\n      \"max\": 0\r\n    },\r\n    \"couch_db_updater\": {\r\n      \"50\": 0,\r\n      \"90\": 0,\r\n      \"99\": 0,\r\n      \"count\": 128,\r\n      \"min\": 0,\r\n      \"max\": 0\r\n    },\r\n    \"error_logger\": 0,\r\n    \"couch_auth_cache\": 0,\r\n    \"mango_sup\": 0,\r\n    \"httpd_sup\": 0,\r\n    \"couch_log_sup\": 0,\r\n    \"couch_log_server\": 0,\r\n    \"erl_prim_loader\": 0,\r\n    \"global_group\": 0,\r\n    \"standard_error_sup\": 0,\r\n    \"erl_epmd\": 0,\r\n    \"couch_epi_sup\": 0,\r\n    \"couch_epi_functions_gen_couch_index\": 0,\r\n    \"couch_epi_functions_gen_chttpd_auth\": 0,\r\n    \"couch_epi_functions_gen_couch_db\": 0,\r\n    \"couch_epi_functions_gen_global_changes\": 0,\r\n    \"kernel_safe_sup\": 0,\r\n    \"couch_epi_functions_gen_chttpd_handlers\": 0,\r\n    \"couch_epi_functions_gen_chttpd\": 0,\r\n    \"auth\": 0,\r\n    \"code_server\": 0,\r\n    \"rexi_buffer_couchdb@localhost\": 0,\r\n    \"rexi_server_couchdb@localhost\": 0,\r\n    \"mem3_sync_nodes\": 0,\r\n    \"application_controller\": 0,\r\n    \"httpc_sup\": 0,\r\n    \"mochiweb_clock\": 0,\r\n    \"mem3_sync\": 0,\r\n    \"config_sup\": 0,\r\n    \"mem3_sup\": 0,\r\n    \"config\": 0,\r\n    \"httpc_profile_sup\": 0,\r\n    \"mem3_shards\": 0,\r\n    \"global_changes_sup\": 0,\r\n    \"inet_gethost_native_sup\": 0,\r\n    \"httpc_manager\": 0,\r\n    \"global_changes_server\": 0,\r\n    \"httpc_handler_sup\": 0,\r\n    \"runtime_tools_sup\": 0,\r\n    \"mem3_nodes\": 0,\r\n    \"net_kernel\": 0,\r\n    \"user\": 0,\r\n    \"ddoc_cache_sup\": 0,\r\n    \"ftp_sup\": 0,\r\n    \"rexi_sup\": 0,\r\n    \"ddoc_cache_opener\": 0,\r\n    \"rexi_server_sup\": 0,\r\n    \"rexi_server_mon\": 0,\r\n    \"rexi_server\": 0,\r\n    \"ddoc_cache_lru\": 0,\r\n    \"ioq_sup\": 0,\r\n    \"chttpd_auth_cache_lru\": 0,\r\n    \"memsup\": 0,\r\n    \"mem3_events\": 0,\r\n    \"disksup\": 0,\r\n    \"ioq\": 0,\r\n    \"couch_secondary_services\": 0,\r\n    \"cpu_sup\": 0,\r\n    \"couch_primary_services\": 0,\r\n    \"couch_replicator_sup\": 0,\r\n    \"ibrowse_sup\": 0,\r\n    \"couch_replicator_manager\": 0,\r\n    \"couch_replicator_job_sup\": 0,\r\n    \"couch_uuids\": 0,\r\n    \"rexi_buffer_mon\": 0,\r\n    \"config_event\": 0,\r\n    \"rexi_buffer_sup\": 0,\r\n    \"ibrowse\": 0,\r\n    \"couch_event_sup2\": 0,\r\n    \"couch_event_server\": 0,\r\n    \"couch_task_status\": 0,\r\n    \"couch_event_os_sup\": 0,\r\n    \"couch_sup\": 0,\r\n    \"release_handler\": 0,\r\n    \"couch_server\": 0,\r\n    \"os_mon_sup\": 0,\r\n    \"couch_replication\": 0,\r\n    \"overload\": 0,\r\n    \"couch_proc_manager\": 0,\r\n    \"sasl_sup\": 0,\r\n    \"couch_stats_sup\": 0,\r\n    \"couch_stats_process_tracker\": 0,\r\n    \"couch_plugin\": 0,\r\n    \"alarm_handler\": 0,\r\n    \"couch_os_daemons\": 0,\r\n    \"tftp_sup\": 0,\r\n    \"sasl_safe_sup\": 0,\r\n    \"couch_stats_aggregator\": 0,\r\n    \"timer_server\": 0,\r\n    \"couch_httpd_vhost\": 0,\r\n    \"folsom_sup\": 0,\r\n    \"couch_index_sup\": 0,\r\n    \"folsom_sample_slide_sup\": 0,\r\n    \"couch_index_server\": 0,\r\n    \"couch_httpd\": 0,\r\n    \"rex\": 0,\r\n    \"standard_error\": 0,\r\n    \"init\": 0,\r\n    \"net_sup\": 0,\r\n    \"tls_connection_sup\": 0,\r\n    \"chttpd_sup\": 0,\r\n    \"kernel_sup\": 0,\r\n    \"couch_external_manager\": 0,\r\n    \"global_name_server\": 0,\r\n    \"folsom_metrics_histogram_ets\": 0,\r\n    \"file_server_2\": 0,\r\n    \"couch_drv\": 0,\r\n    \"ssl_sup\": 0,\r\n    \"folsom_meter_timer_server\": 0,\r\n    \"chttpd_auth_cache\": 0,\r\n    \"setup_sup\": 0,\r\n    \"inet_gethost_native\": 0,\r\n    \"inet_db\": 0,\r\n    \"inets_sup\": 0,\r\n    \"ssl_manager\": 0,\r\n    \"ssl_listen_tracker_sup\": 0,\r\n    \"couch_compaction_daemon\": 0,\r\n    \"chttpd\": 0\r\n  },\r\n  \"internal_replication_jobs\": 0,\r\n  \"distribution\": {}\r\n}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359965144/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359969903","html_url":"https://github.com/apache/couchdb/issues/1094#issuecomment-359969903","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1094","id":359969903,"node_id":"MDEyOklzc3VlQ29tbWVudDM1OTk2OTkwMw==","user":{"login":"elwin1234","id":3977962,"node_id":"MDQ6VXNlcjM5Nzc5NjI=","avatar_url":"https://avatars.githubusercontent.com/u/3977962?v=4","gravatar_id":"","url":"https://api.github.com/users/elwin1234","html_url":"https://github.com/elwin1234","followers_url":"https://api.github.com/users/elwin1234/followers","following_url":"https://api.github.com/users/elwin1234/following{/other_user}","gists_url":"https://api.github.com/users/elwin1234/gists{/gist_id}","starred_url":"https://api.github.com/users/elwin1234/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/elwin1234/subscriptions","organizations_url":"https://api.github.com/users/elwin1234/orgs","repos_url":"https://api.github.com/users/elwin1234/repos","events_url":"https://api.github.com/users/elwin1234/events{/privacy}","received_events_url":"https://api.github.com/users/elwin1234/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-23T23:40:46Z","updated_at":"2018-01-23T23:41:39Z","author_association":"NONE","body":"Hi,\r\n\r\nThanks for your reply!\r\n\r\nI had to make a `#!/bin/sh -x` (instead of `#!/bin/sh +x`) line in order to see output.\r\n\r\nThis is the end of it:\r\n```\r\n+ ip=127.0.0.1\r\n+ [ ! -z  ]\r\n+ url=http://127.0.0.1:5984\r\n+ grep -q _users\r\n+ curl -s http://127.0.0.1:5984/_users\r\n+ curl -s -X PUT http://127.0.0.1:5984/_users\r\ndpkg: error processing package couchdb (--configure):\r\n subprocess installed post-installation script returned error exit status 7\r\nErrors were encountered while processing:\r\n couchdb\r\nE: Sub-process /usr/bin/dpkg returned an error code (1)\r\n```\r\n\r\nIt seems like the 5984 port in the couchdb.postinst script is hardcoded instead of being read from config files. I use a different (non-default) port for couch2. After changing the port number in the postinst script (for now) the installation seemed to complete successfully.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359969903/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359972296","html_url":"https://github.com/apache/couchdb/issues/1094#issuecomment-359972296","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1094","id":359972296,"node_id":"MDEyOklzc3VlQ29tbWVudDM1OTk3MjI5Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-23T23:52:55Z","updated_at":"2018-01-23T23:52:55Z","author_association":"MEMBER","body":"Thanks, this is good. I've opened apache/couchdb-pkg#18 for this. If you can help me with my questions over there, I'd appreciate it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/359972296/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360027457","html_url":"https://github.com/apache/couchdb/pull/366#issuecomment-360027457","issue_url":"https://api.github.com/repos/apache/couchdb/issues/366","id":360027457,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDAyNzQ1Nw==","user":{"login":"alxndrsn","id":191496,"node_id":"MDQ6VXNlcjE5MTQ5Ng==","avatar_url":"https://avatars.githubusercontent.com/u/191496?v=4","gravatar_id":"","url":"https://api.github.com/users/alxndrsn","html_url":"https://github.com/alxndrsn","followers_url":"https://api.github.com/users/alxndrsn/followers","following_url":"https://api.github.com/users/alxndrsn/following{/other_user}","gists_url":"https://api.github.com/users/alxndrsn/gists{/gist_id}","starred_url":"https://api.github.com/users/alxndrsn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alxndrsn/subscriptions","organizations_url":"https://api.github.com/users/alxndrsn/orgs","repos_url":"https://api.github.com/users/alxndrsn/repos","events_url":"https://api.github.com/users/alxndrsn/events{/privacy}","received_events_url":"https://api.github.com/users/alxndrsn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T05:45:27Z","updated_at":"2018-01-24T05:45:27Z","author_association":"CONTRIBUTOR","body":"@wohali @janl I may be interested in reviving this for couchdb 2.x, depending on our roadmap.  Are there clear reasons why it stalled previously?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360027457/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360039562","html_url":"https://github.com/apache/couchdb/issues/1125#issuecomment-360039562","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1125","id":360039562,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDAzOTU2Mg==","user":{"login":"sergey-safarov","id":2562241,"node_id":"MDQ6VXNlcjI1NjIyNDE=","avatar_url":"https://avatars.githubusercontent.com/u/2562241?v=4","gravatar_id":"","url":"https://api.github.com/users/sergey-safarov","html_url":"https://github.com/sergey-safarov","followers_url":"https://api.github.com/users/sergey-safarov/followers","following_url":"https://api.github.com/users/sergey-safarov/following{/other_user}","gists_url":"https://api.github.com/users/sergey-safarov/gists{/gist_id}","starred_url":"https://api.github.com/users/sergey-safarov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sergey-safarov/subscriptions","organizations_url":"https://api.github.com/users/sergey-safarov/orgs","repos_url":"https://api.github.com/users/sergey-safarov/repos","events_url":"https://api.github.com/users/sergey-safarov/events{/privacy}","received_events_url":"https://api.github.com/users/sergey-safarov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T07:03:51Z","updated_at":"2018-01-24T07:03:51Z","author_association":"NONE","body":"Example of `_active_tasks` output (formated)\r\n```\r\n[  \r\n   {  \r\n      \"node\":\"couchdb@127.0.0.1\",\r\n      \"pid\":\"<0.23837.50>\",\r\n      \"changes_pending\":76072,\r\n      \"checkpoint_interval\":30000,\r\n      \"checkpointed_source_seq\":\"1-g1AAAAF1eJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfaE1TmA1MWD1GUwJzLmAnnsiWmmhhZpydj04DMpAWRSPUEb81iAJEMDkAIqnU-M2gUQtfuJUXsAovY-MWofQNSC3JsFAGwAZt4\",\r\n      \"continuous\":false,\r\n      \"database\":null,\r\n      \"doc_id\":null,\r\n      \"doc_write_failures\":0,\r\n      \"docs_read\":27,\r\n      \"docs_written\":27,\r\n      \"missing_revisions_found\":27,\r\n      \"replication_id\":\"83de18e815b496003e016afaca85d7bc+create_target\",\r\n      \"revisions_checked\":27,\r\n      \"source\":\"http://217.12.247.99:5984/account%2f63%2ff8%2f14795fd5b8c74aa04ee865c52f73-201712/\",\r\n      \"source_seq\":\"527-g1AAAAJjeJyd0L0KwjAQAOBgBV19AFFfQJK2adrJOjmIk7s2f6WUqpOzvom-ib6Jvkm9JB2L0BK4wB33cXcVQmhceApN5OUqCyVS4rMlhkcqKA04ErO6rsvC4-sTJEYS6yCmrK3hDyPmEMWqkQ5W8jVnWJGuUmqkYyMtrMRzSuJcdpUyI90aaWolnBCpVdftzkOI6A4fYA-jbawmIhUKzXtpT6e9jLa3WsIopoHqpb2d9jHazt1MRpFUfi_t6zR7t62bLQ5ZjltnK3-ySqGL\",\r\n      \"started_on\":1516774642,\r\n      \"target\":\"http://217.12.247.98:5984/account%2f63%2ff8%2f14795fd5b8c74aa04ee865c52f73-201712/\",\r\n      \"through_seq\":\"1-g1AAAAF1eJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfaE1TmA1MWD1GUwJzLmAnnsiWmmhhZpydj04DMpAWRSPUEb81iAJEMDkAIqnU-M2gUQtfuJUXsAovY-MWofQNSC3JsFAGwAZt4\",\r\n      \"type\":\"replication\",\r\n      \"updated_on\":1516776894,\r\n      \"user\":null\r\n   },\r\n   {  \r\n      \"node\":\"couchdb@127.0.0.1\",\r\n      \"pid\":\"<0.2536.290>\",\r\n      \"changes_pending\":null,\r\n      \"checkpoint_interval\":30000,\r\n      \"checkpointed_source_seq\":0,\r\n      \"continuous\":false,\r\n      \"database\":null,\r\n      \"doc_id\":null,\r\n      \"doc_write_failures\":0,\r\n      \"docs_read\":4,\r\n      \"docs_written\":4,\r\n      \"missing_revisions_found\":4,\r\n      \"replication_id\":\"880f88e653a7900c1e7c43461eff471d+create_target\",\r\n      \"revisions_checked\":4,\r\n      \"source\":\"http://217.12.247.99:5984/account%2fa4%2f87%2f97afcbf4c1782d55613a5f86b0bf-201712/\",\r\n      \"source_seq\":\"4-g1AAAAHbeJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfYgdRnMiYy5QB67RXJKinGKITY9-ExyAJkUj2KSobFpslGqGakmJYBMqifo9jwWIMnQAKSASucTo3YBRO1-hAvTzJMtTY2SSHQhxLQDENPuI0xLTTZLM0gjNeQgpj2AmAbycxYAxMp_Nw\",\r\n      \"started_on\":1516776088,\r\n      \"target\":\"http://217.12.247.98:5984/account%2fa4%2f87%2f97afcbf4c1782d55613a5f86b0bf-201712/\",\r\n      \"through_seq\":\"4-g1AAAAHbeJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfYgdRnMiYy5QB67RXJKinGKITY9-ExyAJkUj2KSobFpslGqGakmJYBMqifo9jwWIMnQAKSASucTo3YBRO1-hAvTzJMtTY2SSHQhxLQDENPuI0xLTTZLM0gjNeQgpj2AmAbycxYAxMp_Nw\",\r\n      \"type\":\"replication\",\r\n      \"updated_on\":1516776089,\r\n      \"user\":null\r\n   },\r\n   {  \r\n      \"node\":\"couchdb@127.0.0.1\",\r\n      \"pid\":\"<0.29148.294>\",\r\n      \"changes_pending\":null,\r\n      \"checkpoint_interval\":30000,\r\n      \"checkpointed_source_seq\":0,\r\n      \"continuous\":false,\r\n      \"database\":null,\r\n      \"doc_id\":null,\r\n      \"doc_write_failures\":0,\r\n      \"docs_read\":4,\r\n      \"docs_written\":4,\r\n      \"missing_revisions_found\":4,\r\n      \"replication_id\":\"1aebc296b560ed25c8153cda8f55069e+create_target\",\r\n      \"revisions_checked\":4,\r\n      \"source\":\"http://217.12.247.99:5984/account%2fa4%2f87%2f97afcbf4c1782d55613a5f86b0bf-201710/\",\r\n      \"source_seq\":\"4-g1AAAAG5eJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfYgdRnMiUy5QB67pYGhYWKiGTY9-ExyAJkUT9jGBJC6eqiNjGAbzSwtUw1SDEm0MY8FSDI0ACmgYfPx2wpRuwCidj_CZsMkI0NLM1OybD4AMe0-MTY_gKgFhU0WAEpFdiQ\",\r\n      \"started_on\":1516776027,\r\n      \"target\":\"http://217.12.247.98:5984/account%2fa4%2f87%2f97afcbf4c1782d55613a5f86b0bf-201710/\",\r\n      \"through_seq\":\"1-g1AAAAF1eJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfYgdRnMiYy5QB67pYGhYWKiGTY9-ExyAJkUT9jGBJC6eoLq8liAJEMDkAIqnU-M2gUQtfuJUXsAovY-MWofQNSC3JsFAMMyZnM\",\r\n      \"type\":\"replication\",\r\n      \"updated_on\":1516776028,\r\n      \"user\":null\r\n   },\r\n   {  \r\n      \"node\":\"couchdb@127.0.0.1\",\r\n      \"pid\":\"<0.31083.294>\",\r\n      \"changes_pending\":null,\r\n      \"checkpoint_interval\":30000,\r\n      \"checkpointed_source_seq\":0,\r\n      \"continuous\":false,\r\n      \"database\":null,\r\n      \"doc_id\":null,\r\n      \"doc_write_failures\":0,\r\n      \"docs_read\":4,\r\n      \"docs_written\":4,\r\n      \"missing_revisions_found\":4,\r\n      \"replication_id\":\"c125005084bccdfaffc089a2d25cdd43+create_target\",\r\n      \"revisions_checked\":4,\r\n      \"source\":\"http://217.12.247.99:5984/account%2fa4%2f87%2f97afcbf4c1782d55613a5f86b0bf-201711/\",\r\n      \"source_seq\":\"4-g1AAAAGXeJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____szKYE5lygQLsSSmWJoYWKdg04DEmSQFIJtmjmGRoamCSaG5AqkkOIJPiQSYlMuBTlwBSV09QXR4LkGRoAFJApfOJUbsAonY_MWoPQNTeJ0btA4hakHuzABv8bmY\",\r\n      \"started_on\":1516776055,\r\n      \"target\":\"http://217.12.247.98:5984/account%2fa4%2f87%2f97afcbf4c1782d55613a5f86b0bf-201711/\",\r\n      \"through_seq\":\"1-g1AAAAF1eJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfYgdRnMiYy5QB67oamBSaK5ATY9-ExyAJkUT9jGBJC6eoLq8liAJEMDkAIqnU-M2gUQtfuJUXsAovY-MWofQNSC3JsFAI3AZkI\",\r\n      \"type\":\"replication\",\r\n      \"updated_on\":1516776057,\r\n      \"user\":null\r\n   },\r\n   {  \r\n      \"node\":\"couchdb@127.0.0.1\",\r\n      \"pid\":\"<0.32724.392>\",\r\n      \"changes_pending\":null,\r\n      \"checkpoint_interval\":30000,\r\n      \"checkpointed_source_seq\":0,\r\n      \"continuous\":false,\r\n      \"database\":null,\r\n      \"doc_id\":null,\r\n      \"doc_write_failures\":0,\r\n      \"docs_read\":0,\r\n      \"docs_written\":0,\r\n      \"missing_revisions_found\":0,\r\n      \"replication_id\":\"7a796b343b45bb41d6cb9a76e6f9e675+create_target\",\r\n      \"revisions_checked\":0,\r\n      \"source\":\"http://217.12.247.99:5984/account%2fc3%2f43%2f646ab95638f945c8ec895263cf2e-201707/\",\r\n      \"source_seq\":0,\r\n      \"started_on\":1516776898,\r\n      \"target\":\"http://217.12.247.98:5984/account%2fc3%2f43%2f646ab95638f945c8ec895263cf2e-201707/\",\r\n      \"type\":\"replication\",\r\n      \"updated_on\":1516776898,\r\n      \"user\":null\r\n   },\r\n   {  \r\n      \"node\":\"couchdb@127.0.0.1\",\r\n      \"pid\":\"<0.7273.48>\",\r\n      \"changes_pending\":null,\r\n      \"checkpoint_interval\":30000,\r\n      \"checkpointed_source_seq\":0,\r\n      \"continuous\":false,\r\n      \"database\":null,\r\n      \"doc_id\":null,\r\n      \"doc_write_failures\":0,\r\n      \"docs_read\":8,\r\n      \"docs_written\":8,\r\n      \"missing_revisions_found\":8,\r\n      \"replication_id\":\"260c79c446f46814cdf361b5d02b59ce+create_target\",\r\n      \"revisions_checked\":8,\r\n      \"source\":\"http://217.12.247.99:5984/account%2f63%2ff8%2f14795fd5b8c74aa04ee865c52f73-201711/\",\r\n      \"source_seq\":\"1041-g1AAAAJjeJyd0LsNwjAQBmCLIEHLBDABivOyXZEdGABsn60oBKhoKICahhFgE1gEwSbBj5QRUqKT_pPudF9xFUJoXASAJnJ_kAWIHEdkHprClVkNOBLTuq7LIuBqawYjpkKuCGs7-MOImUmxaKSTkwSVOo1oVym30qqRjk4CAlpy6CqtrXRupKuXFERSdJV2Q5PoYprB7la7OY2zBHSGe2kPrz2t9vb_yqiMdT_t5bWP1ZZOIxR4Eqte2tdr7m8bp2nMaJSKtrvyB9O6pI8\",\r\n      \"started_on\":1516774615,\r\n      \"target\":\"http://217.12.247.98:5984/account%2f63%2ff8%2f14795fd5b8c74aa04ee865c52f73-201711/\",\r\n      \"through_seq\":\"3-g1AAAAGXeJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfaE1TmA1MUTVpcAUlcPUpfBnMiYC-Sxp6SmGCUnpWDTg8ekPBYgydAApICGzcdvK0TtAoja_cSoPQBRex_kSiawK80tUhJNjFPJcuUDiGmgsMkCAN8Hb1s\",\r\n      \"type\":\"replication\",\r\n      \"updated_on\":1516774616,\r\n      \"user\":null\r\n   }\r\n]\r\n```\r\nReplication to database `account%2f63%2ff8%2f14795fd5b8c74aa04ee865c52f73-201711` is now acrive about 1 hour, but processes only 8 doc.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360039562/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360057266","html_url":"https://github.com/apache/couchdb/issues/1125#issuecomment-360057266","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1125","id":360057266,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDA1NzI2Ng==","user":{"login":"sergey-safarov","id":2562241,"node_id":"MDQ6VXNlcjI1NjIyNDE=","avatar_url":"https://avatars.githubusercontent.com/u/2562241?v=4","gravatar_id":"","url":"https://api.github.com/users/sergey-safarov","html_url":"https://github.com/sergey-safarov","followers_url":"https://api.github.com/users/sergey-safarov/followers","following_url":"https://api.github.com/users/sergey-safarov/following{/other_user}","gists_url":"https://api.github.com/users/sergey-safarov/gists{/gist_id}","starred_url":"https://api.github.com/users/sergey-safarov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sergey-safarov/subscriptions","organizations_url":"https://api.github.com/users/sergey-safarov/orgs","repos_url":"https://api.github.com/users/sergey-safarov/repos","events_url":"https://api.github.com/users/sergey-safarov/events{/privacy}","received_events_url":"https://api.github.com/users/sergey-safarov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T08:32:14Z","updated_at":"2018-01-24T08:32:14Z","author_association":"NONE","body":"After two hours\r\n```\r\n[  \r\n   {  \r\n      \"node\":\"couchdb@127.0.0.1\",\r\n      \"pid\":\"<0.23837.50>\",\r\n      \"changes_pending\":76072,\r\n      \"checkpoint_interval\":30000,\r\n      \"checkpointed_source_seq\":\"1-g1AAAAF1eJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfaE1TmA1MWD1GUwJzLmAnnsiWmmhhZpydj04DMpAWRSPUEb81iAJEMDkAIqnU-M2gUQtfuJUXsAovY-MWofQNSC3JsFAGwAZt4\",\r\n      \"continuous\":false,\r\n      \"database\":null,\r\n      \"doc_id\":null,\r\n      \"doc_write_failures\":0,\r\n      \"docs_read\":878,\r\n      \"docs_written\":878,\r\n      \"missing_revisions_found\":878,\r\n      \"replication_id\":\"83de18e815b496003e016afaca85d7bc+create_target\",\r\n      \"revisions_checked\":878,\r\n      \"source\":\"http://217.12.247.99:5984/account%2f63%2ff8%2f14795fd5b8c74aa04ee865c52f73-201712/\",\r\n      \"source_seq\":\"878-g1AAAAJjeJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____szKYE3NzgQLsyQapxham5tg04DEmSQFIJtlDTeoEm2SUmmhukGJIqkkOIJPioSb5g01KTDM1tEhLJtWkBJBJ9VCTjMEmGVgaJqemkOq7PBYgydAApICGzQeZVgk2LcksxSQpNZEs0xZATNsPMq0VbJqluamBqXEKWaYdgJh2H2RaPSTMks3MklOMyDLtAcS0_wifWlqYmKcZYHVbFgBFpqLq\",\r\n      \"started_on\":1516774642,\r\n      \"target\":\"http://217.12.247.98:5984/account%2f63%2ff8%2f14795fd5b8c74aa04ee865c52f73-201712/\",\r\n      \"through_seq\":\"504-g1AAAAJjeJyd0EsKwjAQANBgBd16AFEvIEnbNC0IFlyqa5c2yaSUUnXlWm-iN9Gb6E1qPl0WoSUwgRnmMTMVQmhceIAm8nKVBYiU-GyJ9SOVLg04ErO6rsvC46uTTowkVkFMWVvDH0bMdRTrRjpYyVecYSBdpdRIx0ZaWInnlMS57CplRro10tRKOCFSQdftzkMd0V1_GnsYbWM1EUEoFO-lPZ32MtrOagmjmAbQS3s77WO0vbuZjCIJfi_t6zR7t62bLQ5ZjltnK3-QTqF0\",\r\n      \"type\":\"replication\",\r\n      \"updated_on\":1516781845,\r\n      \"user\":null\r\n   },\r\n   {  \r\n      \"node\":\"couchdb@127.0.0.1\",\r\n      \"pid\":\"<0.29148.294>\",\r\n      \"changes_pending\":null,\r\n      \"checkpoint_interval\":30000,\r\n      \"checkpointed_source_seq\":0,\r\n      \"continuous\":false,\r\n      \"database\":null,\r\n      \"doc_id\":null,\r\n      \"doc_write_failures\":0,\r\n      \"docs_read\":4,\r\n      \"docs_written\":4,\r\n      \"missing_revisions_found\":4,\r\n      \"replication_id\":\"1aebc296b560ed25c8153cda8f55069e+create_target\",\r\n      \"revisions_checked\":4,\r\n      \"source\":\"http://217.12.247.99:5984/account%2fa4%2f87%2f97afcbf4c1782d55613a5f86b0bf-201710/\",\r\n      \"source_seq\":\"4-g1AAAAG5eJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfYgdRnMiUy5QB67pYGhYWKiGTY9-ExyAJkUT9jGBJC6eqiNjGAbzSwtUw1SDEm0MY8FSDI0ACmgYfPx2wpRuwCidj_CZsMkI0NLM1OybD4AMe0-MTY_gKgFhU0WAEpFdiQ\",\r\n      \"started_on\":1516776027,\r\n      \"target\":\"http://217.12.247.98:5984/account%2fa4%2f87%2f97afcbf4c1782d55613a5f86b0bf-201710/\",\r\n      \"through_seq\":\"1-g1AAAAF1eJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfYgdRnMiYy5QB67pYGhYWKiGTY9-ExyAJkUT9jGBJC6eoLq8liAJEMDkAIqnU-M2gUQtfuJUXsAovY-MWofQNSC3JsFAMMyZnM\",\r\n      \"type\":\"replication\",\r\n      \"updated_on\":1516776028,\r\n      \"user\":null\r\n   },\r\n   {  \r\n      \"node\":\"couchdb@127.0.0.1\",\r\n      \"pid\":\"<0.31083.294>\",\r\n      \"changes_pending\":5214,\r\n      \"checkpoint_interval\":30000,\r\n      \"checkpointed_source_seq\":\"1-g1AAAAF1eJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfYgdRnMiYy5QB67oamBSaK5ATY9-ExyAJkUT9jGBJC6eoLq8liAJEMDkAIqnU-M2gUQtfuJUXsAovY-MWofQNSC3JsFAI3AZkI\",\r\n      \"continuous\":false,\r\n      \"database\":null,\r\n      \"doc_id\":null,\r\n      \"doc_write_failures\":0,\r\n      \"docs_read\":4,\r\n      \"docs_written\":4,\r\n      \"missing_revisions_found\":4,\r\n      \"replication_id\":\"c125005084bccdfaffc089a2d25cdd43+create_target\",\r\n      \"revisions_checked\":4,\r\n      \"source\":\"http://217.12.247.99:5984/account%2fa4%2f87%2f97afcbf4c1782d55613a5f86b0bf-201711/\",\r\n      \"source_seq\":\"4-g1AAAAGXeJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____szKYE5lygQLsSSmWJoYWKdg04DEmSQFIJtmjmGRoamCSaG5AqkkOIJPiQSYlMuBTlwBSV09QXR4LkGRoAFJApfOJUbsAonY_MWoPQNTeJ0btA4hakHuzABv8bmY\",\r\n      \"started_on\":1516776055,\r\n      \"target\":\"http://217.12.247.98:5984/account%2fa4%2f87%2f97afcbf4c1782d55613a5f86b0bf-201711/\",\r\n      \"through_seq\":\"1-g1AAAAF1eJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfYgdRnMiYy5QB67oamBSaK5ATY9-ExyAJkUT9jGBJC6eoLq8liAJEMDkAIqnU-M2gUQtfuJUXsAovY-MWofQNSC3JsFAI3AZkI\",\r\n      \"type\":\"replication\",\r\n      \"updated_on\":1516779838,\r\n      \"user\":null\r\n   },\r\n   {  \r\n      \"node\":\"couchdb@127.0.0.1\",\r\n      \"pid\":\"<0.7273.48>\",\r\n      \"changes_pending\":235248,\r\n      \"checkpoint_interval\":30000,\r\n      \"checkpointed_source_seq\":\"3-g1AAAAGXeJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfaE1TmA1MUTVpcAUlcPUpfBnMiYC-Sxp6SmGCUnpWDTg8ekPBYgydAApICGzcdvK0TtAoja_cSoPQBRex_kSiawK80tUhJNjFPJcuUDiGmgsMkCAN8Hb1s\",\r\n      \"continuous\":false,\r\n      \"database\":null,\r\n      \"doc_id\":null,\r\n      \"doc_write_failures\":0,\r\n      \"docs_read\":773,\r\n      \"docs_written\":773,\r\n      \"missing_revisions_found\":773,\r\n      \"replication_id\":\"260c79c446f46814cdf361b5d02b59ce+create_target\",\r\n      \"revisions_checked\":773,\r\n      \"source\":\"http://217.12.247.99:5984/account%2f63%2ff8%2f14795fd5b8c74aa04ee865c52f73-201711/\",\r\n      \"source_seq\":\"1041-g1AAAAJjeJyd0LsNwjAQBmCLIEHLBDABivOyXZEdGABsn60oBKhoKICahhFgE1gEwSbBj5QRUqKT_pPudF9xFUJoXASAJnJ_kAWIHEdkHprClVkNOBLTuq7LIuBqawYjpkKuCGs7-MOImUmxaKSTkwSVOo1oVym30qqRjk4CAlpy6CqtrXRupKuXFERSdJV2Q5PoYprB7la7OY2zBHSGe2kPrz2t9vb_yqiMdT_t5bWP1ZZOIxR4Eqte2tdr7m8bp2nMaJSKtrvyB9O6pI8\",\r\n      \"started_on\":1516774615,\r\n      \"target\":\"http://217.12.247.98:5984/account%2f63%2ff8%2f14795fd5b8c74aa04ee865c52f73-201711/\",\r\n      \"through_seq\":\"769-g1AAAAJjeJyd0EsKwjAQBuBgBd16Aj2BNOkj6crewYXgRjN5EEvVlWu9id5Eb6I3qXl04aIILQP_wAzzLaZGCE1NJNFMnC_CSCgxocvYFq7tasQRzJumqUzEt0c7mBQq5ooWXQd_GFjYhFUrKS8BEzojrK9UOmnXSsZLkkotuOwr7Z10baVDkJQkAvpKp7FNdLPNYnengdd4kUqd40HaI2jPn3_lTCR6mPYK2ttpa69RJnmaqEHaJ2j-bxuvaVwwkkHXXfUFtg-jfw\",\r\n      \"type\":\"replication\",\r\n      \"updated_on\":1516781818,\r\n      \"user\":null\r\n   }\r\n]\r\n```\r\nSame database. 773 docs written and 235248 pending changes.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360057266/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360077669","html_url":"https://github.com/apache/couchdb/issues/901#issuecomment-360077669","issue_url":"https://api.github.com/repos/apache/couchdb/issues/901","id":360077669,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDA3NzY2OQ==","user":{"login":"davidharman","id":23555695,"node_id":"MDQ6VXNlcjIzNTU1Njk1","avatar_url":"https://avatars.githubusercontent.com/u/23555695?v=4","gravatar_id":"","url":"https://api.github.com/users/davidharman","html_url":"https://github.com/davidharman","followers_url":"https://api.github.com/users/davidharman/followers","following_url":"https://api.github.com/users/davidharman/following{/other_user}","gists_url":"https://api.github.com/users/davidharman/gists{/gist_id}","starred_url":"https://api.github.com/users/davidharman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davidharman/subscriptions","organizations_url":"https://api.github.com/users/davidharman/orgs","repos_url":"https://api.github.com/users/davidharman/repos","events_url":"https://api.github.com/users/davidharman/events{/privacy}","received_events_url":"https://api.github.com/users/davidharman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T09:51:39Z","updated_at":"2018-01-24T09:51:39Z","author_association":"NONE","body":"This still seems to be an issue in CouchDB 2.1.1, is this correct? are there any workarounds?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360077669/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360101954","html_url":"https://github.com/apache/couchdb/issues/1074#issuecomment-360101954","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1074","id":360101954,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDEwMTk1NA==","user":{"login":"femiashiru1","id":2743359,"node_id":"MDQ6VXNlcjI3NDMzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/2743359?v=4","gravatar_id":"","url":"https://api.github.com/users/femiashiru1","html_url":"https://github.com/femiashiru1","followers_url":"https://api.github.com/users/femiashiru1/followers","following_url":"https://api.github.com/users/femiashiru1/following{/other_user}","gists_url":"https://api.github.com/users/femiashiru1/gists{/gist_id}","starred_url":"https://api.github.com/users/femiashiru1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/femiashiru1/subscriptions","organizations_url":"https://api.github.com/users/femiashiru1/orgs","repos_url":"https://api.github.com/users/femiashiru1/repos","events_url":"https://api.github.com/users/femiashiru1/events{/privacy}","received_events_url":"https://api.github.com/users/femiashiru1/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T11:27:02Z","updated_at":"2018-01-24T11:27:02Z","author_association":"NONE","body":"hi @ransanjeev  I have a similar problem and I'm curious to know how you figured it out","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360101954/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360104974","html_url":"https://github.com/apache/couchdb/issues/1074#issuecomment-360104974","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1074","id":360104974,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDEwNDk3NA==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T11:40:37Z","updated_at":"2018-01-24T11:40:37Z","author_association":"MEMBER","body":"Take a look at the user mailing list. This is a bitcoin miner running on your server. Your server is compromised you will have to rebuild it.\n\n________________________________\nFrom: femiashiru <notifications@github.com>\nSent: Wednesday, January 24, 2018 1:27:04 PM\nTo: apache/couchdb\nCc: Subscribed\nSubject: Re: [apache/couchdb] Couchdb user - fs-manager is taking 100% of the cpu. (#1074)\n\n\nhi @ransanjeev<https://github.com/ransanjeev> I have a similar problem and I'm curious to know how you figured it out\n\n\nYou are receiving this because you are subscribed to this thread.\nReply to this email directly, view it on GitHub<https://github.com/apache/couchdb/issues/1074#issuecomment-360101954>, or mute the thread<https://github.com/notifications/unsubscribe-auth/AAK9AmXCAS2yJ4oFR-64KDv6G7MgKpgNks5tNxOHgaJpZM4RFser>.\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360104974/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360109304","html_url":"https://github.com/apache/couchdb/issues/1125#issuecomment-360109304","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1125","id":360109304,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDEwOTMwNA==","user":{"login":"sergey-safarov","id":2562241,"node_id":"MDQ6VXNlcjI1NjIyNDE=","avatar_url":"https://avatars.githubusercontent.com/u/2562241?v=4","gravatar_id":"","url":"https://api.github.com/users/sergey-safarov","html_url":"https://github.com/sergey-safarov","followers_url":"https://api.github.com/users/sergey-safarov/followers","following_url":"https://api.github.com/users/sergey-safarov/following{/other_user}","gists_url":"https://api.github.com/users/sergey-safarov/gists{/gist_id}","starred_url":"https://api.github.com/users/sergey-safarov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sergey-safarov/subscriptions","organizations_url":"https://api.github.com/users/sergey-safarov/orgs","repos_url":"https://api.github.com/users/sergey-safarov/repos","events_url":"https://api.github.com/users/sergey-safarov/events{/privacy}","received_events_url":"https://api.github.com/users/sergey-safarov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T12:00:23Z","updated_at":"2018-01-24T12:00:23Z","author_association":"NONE","body":"Same database after 6 hours, 2542 docs written and 234248 pending changes.\r\n```\r\n[  \r\n   {  \r\n      \"node\":\"couchdb@127.0.0.1\",\r\n      \"pid\":\"<0.29148.294>\",\r\n      \"changes_pending\":6843,\r\n      \"checkpoint_interval\":30000,\r\n      \"checkpointed_source_seq\":\"1-g1AAAAF1eJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfYgdRnMiYy5QB67pYGhYWKiGTY9-ExyAJkUT9jGBJC6eoLq8liAJEMDkAIqnU-M2gUQtfuJUXsAovY-MWofQNSC3JsFAMMyZnM\",\r\n      \"continuous\":false,\r\n      \"database\":null,\r\n      \"doc_id\":null,\r\n      \"doc_write_failures\":0,\r\n      \"docs_read\":4,\r\n      \"docs_written\":4,\r\n      \"missing_revisions_found\":4,\r\n      \"replication_id\":\"1aebc296b560ed25c8153cda8f55069e+create_target\",\r\n      \"revisions_checked\":4,\r\n      \"source\":\"http://217.12.247.99:5984/account%2fa4%2f87%2f97afcbf4c1782d55613a5f86b0bf-201710/\",\r\n      \"source_seq\":\"4-g1AAAAG5eJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfYgdRnMiUy5QB67pYGhYWKiGTY9-ExyAJkUT9jGBJC6eqiNjGAbzSwtUw1SDEm0MY8FSDI0ACmgYfPx2wpRuwCidj_CZsMkI0NLM1OybD4AMe0-MTY_gKgFhU0WAEpFdiQ\",\r\n      \"started_on\":1516776027,\r\n      \"target\":\"http://217.12.247.98:5984/account%2fa4%2f87%2f97afcbf4c1782d55613a5f86b0bf-201710/\",\r\n      \"through_seq\":\"1-g1AAAAF1eJzLYWBg4MhgTmEQTM4vTc5ISXIwNDLXMwBCwxygFFMiQ5L8____sxIZ8ChKUgCSSfYgdRnMiYy5QB67pYGhYWKiGTY9-ExyAJkUT9jGBJC6eoLq8liAJEMDkAIqnU-M2gUQtfuJUXsAovY-MWofQNSC3JsFAMMyZnM\",\r\n      \"type\":\"replication\",\r\n      \"updated_on\":1516794240,\r\n      \"user\":null\r\n   },\r\n   {  \r\n      \"node\":\"couchdb@127.0.0.1\",\r\n      \"pid\":\"<0.7273.48>\",\r\n      \"changes_pending\":234248,\r\n      \"checkpoint_interval\":30000,\r\n      \"checkpointed_source_seq\":\"2041-g1AAAAJveJyd0EsKwjAQANBoBQVXbtzWE0iTfpKs7EEEzZdSqq5c60106S30Bh5Bdx4jpknBTRFaAhOYYR4zUwEAJkUgwUwcjqKQPIcILyP7YGVLQwZ4aIwpi4B9djYxpipiCtO2hj8MX9jIV17iAAymDuNE6BSRrlheY5sfFjpMYqkFk12xbY2dmh2Nl5REgneV9iMbwdl-Frs0o80dyGgidQZ7gVcP3htw7Q-XERHrfuDDg69635vTMJEsiVUv7e01d72n0zSkBKW8ra_8AuJDpH8\",\r\n      \"continuous\":false,\r\n      \"database\":null,\r\n      \"doc_id\":null,\r\n      \"doc_write_failures\":0,\r\n      \"docs_read\":2542,\r\n      \"docs_written\":2542,\r\n      \"missing_revisions_found\":2542,\r\n      \"replication_id\":\"260c79c446f46814cdf361b5d02b59ce+create_target\",\r\n      \"revisions_checked\":2542,\r\n      \"source\":\"http://217.12.247.99:5984/account%2f63%2ff8%2f14795fd5b8c74aa04ee865c52f73-201711/\",\r\n      \"source_seq\":\"2541-g1AAAAJ4eJyd0LsNwjAQBmBDkKClpggsgGLnYbsirEET_FQUBaioYRPoGAM2gRWYIDh2UBqElOik_6Q73VdcCQCY5J4EU3E4ilzyFCK8DEzB0qyGDHC_qqoi9zgAg9nOzMZUBUxh-uvmj8TnJvmqxTYW40ToGJGuWFpjWYtlFpNYasFkV2xbY6cWWztMSSR4V2w_MgnOphnv0oALCzIaSZ3AXuDVgfcGvLnfJUSEuh_4cODTgOxtNUwki0LVS3s57ftA34IaUoJi_uu0-AAzHaN5\",\r\n      \"started_on\":1516774615,\r\n      \"target\":\"http://217.12.247.98:5984/account%2f63%2ff8%2f14795fd5b8c74aa04ee865c52f73-201711/\",\r\n      \"through_seq\":\"2541-g1AAAAJ4eJyd0LsNwjAQBmBDkKClpggsgGLnYbsirEET_FQUBaioYRPoGAM2gRWYIDh2UBqElOik_6Q73VdcCQCY5J4EU3E4ilzyFCK8DEzB0qyGDHC_qqoi9zgAg9nOzMZUBUxh-uvmj8TnJvmqxTYW40ToGJGuWFpjWYtlFpNYasFkV2xbY6cWWztMSSR4V2w_MgnOphnv0oALCzIaSZ3AXuDVgfcGvLnfJUSEuh_4cODTgOxtNUwki0LVS3s57ftA34IaUoJi_uu0-AAzHaN5\",\r\n      \"type\":\"replication\",\r\n      \"updated_on\":1516792740,\r\n      \"user\":null\r\n   }\r\n]\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360109304/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360110795","html_url":"https://github.com/apache/couchdb/issues/1125#issuecomment-360110795","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1125","id":360110795,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDExMDc5NQ==","user":{"login":"sergey-safarov","id":2562241,"node_id":"MDQ6VXNlcjI1NjIyNDE=","avatar_url":"https://avatars.githubusercontent.com/u/2562241?v=4","gravatar_id":"","url":"https://api.github.com/users/sergey-safarov","html_url":"https://github.com/sergey-safarov","followers_url":"https://api.github.com/users/sergey-safarov/followers","following_url":"https://api.github.com/users/sergey-safarov/following{/other_user}","gists_url":"https://api.github.com/users/sergey-safarov/gists{/gist_id}","starred_url":"https://api.github.com/users/sergey-safarov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sergey-safarov/subscriptions","organizations_url":"https://api.github.com/users/sergey-safarov/orgs","repos_url":"https://api.github.com/users/sergey-safarov/repos","events_url":"https://api.github.com/users/sergey-safarov/events{/privacy}","received_events_url":"https://api.github.com/users/sergey-safarov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T12:07:23Z","updated_at":"2018-01-24T12:07:23Z","author_association":"NONE","body":"I guess that issue related to databases that contains docs with attachments.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360110795/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360167959","html_url":"https://github.com/apache/couchdb/issues/1125#issuecomment-360167959","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1125","id":360167959,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDE2Nzk1OQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T15:19:25Z","updated_at":"2018-01-24T15:19:25Z","author_association":"CONTRIBUTOR","body":"\r\nThanks for the report,  Sergey \r\n\r\nYou might be encountering this issue: https://github.com/apache/couchdb/issues/745\r\n\r\nA few questions to help narrow down the cause:\r\n\r\n * What is your exact version of CouchDB, is it 2.0.0, 2.1.1 or other\r\n\r\n * What is the size distribution of your documents (average, what are the largest ones)\r\n\r\n * What are the attachment sizes, what is their distribution (average, largest)\r\n\r\n* Are the databases which failed to replicate enough the ones with attachments? Do you have any that don't have attachments and those replicated fast enough?\r\n\r\n* If you can attach the contents of these config sections (but sanitize them to not contain database paths, username and other such things): `couchdb`, `replicator`, `chttpd` and `cluster`. It's easy to get those via the node local port (5986 one) and the _config section:\r\n\r\nHere is an example of my config from the `replicator` section (jq part is the json pretty printer)\r\n```\r\ncurl -s http://<adminuser>:<adminpas>@localhost:15986/_config/replicator | jq '.'\r\n{\r\n  \"startup_jitter\": \"5000\",\r\n  \"connection_timeout\": \"30000\",\r\n  \"max_churn\": \"20\",\r\n  \"interval\": \"60000\",\r\n  \"retries_per_request\": \"5\",\r\n  \"max_jobs\": \"500\",\r\n  \"verify_ssl_certificates\": \"false\",\r\n  \"http_connections\": \"20\",\r\n  \"ssl_certificate_max_depth\": \"3\",\r\n  \"socket_options\": \"[{keepalive, true}, {nodelay, false}]\",\r\n  \"worker_processes\": \"4\",\r\n  \"worker_batch_size\": \"500\"\r\n}\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360167959/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360202163","html_url":"https://github.com/apache/couchdb/issues/901#issuecomment-360202163","issue_url":"https://api.github.com/repos/apache/couchdb/issues/901","id":360202163,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDIwMjE2Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T17:01:28Z","updated_at":"2018-01-24T17:01:28Z","author_association":"MEMBER","body":"The issue is open, so it has not been resolved, that is correct. The workaround is to use a firewall, reverse proxy or similar to block access to that port.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360202163/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360202995","html_url":"https://github.com/apache/couchdb/issues/1074#issuecomment-360202995","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1074","id":360202995,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDIwMjk5NQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T17:04:03Z","updated_at":"2018-01-24T17:04:03Z","author_association":"MEMBER","body":"This is likely someone exploiting your server via a previously disclosed security violation:\r\n\r\nhttps://blog.couchdb.org/2017/11/14/apache-couchdb-cve-2017-12635-and-cve-2017-12636/\r\n\r\nWhen re-installing your server, be sure to use one of the patched versions of CouchDB: 2.1.1 or 1.7.1.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360202995/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360231866","html_url":"https://github.com/apache/couchdb/issues/1097#issuecomment-360231866","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1097","id":360231866,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDIzMTg2Ng==","user":{"login":"jvegaseg","id":12508470,"node_id":"MDQ6VXNlcjEyNTA4NDcw","avatar_url":"https://avatars.githubusercontent.com/u/12508470?v=4","gravatar_id":"","url":"https://api.github.com/users/jvegaseg","html_url":"https://github.com/jvegaseg","followers_url":"https://api.github.com/users/jvegaseg/followers","following_url":"https://api.github.com/users/jvegaseg/following{/other_user}","gists_url":"https://api.github.com/users/jvegaseg/gists{/gist_id}","starred_url":"https://api.github.com/users/jvegaseg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jvegaseg/subscriptions","organizations_url":"https://api.github.com/users/jvegaseg/orgs","repos_url":"https://api.github.com/users/jvegaseg/repos","events_url":"https://api.github.com/users/jvegaseg/events{/privacy}","received_events_url":"https://api.github.com/users/jvegaseg/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T18:39:29Z","updated_at":"2018-01-24T18:39:29Z","author_association":"NONE","body":"Here you have local.ini:\r\n\r\n```\r\n[cluster]\r\nq = 16\r\n\r\n[log]\r\nlevel = warning\r\n```\r\n\r\nInstallation is default installation with packages: yum install xxx","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360231866/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360251475","html_url":"https://github.com/apache/couchdb/issues/745#issuecomment-360251475","issue_url":"https://api.github.com/repos/apache/couchdb/issues/745","id":360251475,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDI1MTQ3NQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T19:46:29Z","updated_at":"2018-01-24T19:46:29Z","author_association":"CONTRIBUTOR","body":"(From discussion on IRC)\r\n\r\nThis might be related to setting a lower max http request limit:\r\n\r\nhttps://github.com/apache/couchdb/commit/e767b34cdf309a6efc095ea9e74a9f9dea5b746c\r\n\r\nBefore that was defaulting to 4GB which what the code has, but default.ini file set it to 64MB so that became the value being used.  Max request will limit will prevent larger attachments to replicate. Also 413 error is not always raised cleanly: (see https://github.com/apache/couchdb/issues/574 also referenced in the top description)\r\n\r\nTo confirm if this is the cause or is affecting this issue at all, can try to bump:\r\n\r\n```\r\n[httpd]\r\nmax_http_request_size = 67108864 ; 64 MB\r\n```\r\n\r\nTo a higher value, one that's larger than a two or three times the largest attachment or document perhaps (to account for some overhead).\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360251475/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360251940","html_url":"https://github.com/apache/couchdb/issues/1125#issuecomment-360251940","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1125","id":360251940,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDI1MTk0MA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T19:48:09Z","updated_at":"2018-01-24T19:48:09Z","author_association":"CONTRIBUTOR","body":"@sergey-safarov \r\n\r\nSee update to related ticket https://github.com/apache/couchdb/issues/745#issuecomment-360251475\r\n\r\nTry that fix and see if it changes anything.\r\n\r\nThanks again for your report","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360251940/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360254764","html_url":"https://github.com/apache/couchdb/issues/745#issuecomment-360254764","issue_url":"https://api.github.com/repos/apache/couchdb/issues/745","id":360254764,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDI1NDc2NA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T19:57:42Z","updated_at":"2018-01-24T19:57:42Z","author_association":"CONTRIBUTOR","body":"Related to this, we also started to enforce http request limits more strictly:\r\n\r\nhttps://github.com/apache/couchdb/commit/5d7170c472d2ca72d4a0dd41eb7ae4434266be7d","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360254764/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360265722","html_url":"https://github.com/apache/couchdb/issues/1093#issuecomment-360265722","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1093","id":360265722,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDI2NTcyMg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T20:38:20Z","updated_at":"2018-01-24T21:11:25Z","author_association":"MEMBER","body":"Thanks @ReeceStevens . So far, I can't reproduce with your script. 10 replications are taking 5-6 seconds to process with an upper limit of ~41s or so. I tried increasing the number of iterations and threads to no avail. My test machine is 2GB, 1 CPU @ 3.3GHz, SSD.\r\n\r\nAre you testing on HDD there? I can try and rig up a test on a slower disk.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360265722/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360267053","html_url":"https://github.com/apache/couchdb/issues/1093#issuecomment-360267053","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1093","id":360267053,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDI2NzA1Mw==","user":{"login":"ReeceStevens","id":5847947,"node_id":"MDQ6VXNlcjU4NDc5NDc=","avatar_url":"https://avatars.githubusercontent.com/u/5847947?v=4","gravatar_id":"","url":"https://api.github.com/users/ReeceStevens","html_url":"https://github.com/ReeceStevens","followers_url":"https://api.github.com/users/ReeceStevens/followers","following_url":"https://api.github.com/users/ReeceStevens/following{/other_user}","gists_url":"https://api.github.com/users/ReeceStevens/gists{/gist_id}","starred_url":"https://api.github.com/users/ReeceStevens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ReeceStevens/subscriptions","organizations_url":"https://api.github.com/users/ReeceStevens/orgs","repos_url":"https://api.github.com/users/ReeceStevens/repos","events_url":"https://api.github.com/users/ReeceStevens/events{/privacy}","received_events_url":"https://api.github.com/users/ReeceStevens/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T20:43:28Z","updated_at":"2018-01-24T20:43:28Z","author_association":"NONE","body":"@wohali I had initially been testing on a couchDB server under load when I used 10 threads. If you're using an otherwise-unloaded database, you can up the thread count to generate the error. `--threads 40 --single-source` definitely did the trick every time for me, even on an unloaded database. 40 threads is obviously a bit overkill, but this issue seems to be a race condition and occurs inconsistently. To get it to trigger every time, I had to lean in on the database pretty hard.\r\n\r\nIf you set `update_lru_on_read = false`, it should happen very quickly, probably in under 10 iterations.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360267053/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360267197","html_url":"https://github.com/apache/couchdb/issues/1093#issuecomment-360267197","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1093","id":360267197,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDI2NzE5Nw==","user":{"login":"ReeceStevens","id":5847947,"node_id":"MDQ6VXNlcjU4NDc5NDc=","avatar_url":"https://avatars.githubusercontent.com/u/5847947?v=4","gravatar_id":"","url":"https://api.github.com/users/ReeceStevens","html_url":"https://github.com/ReeceStevens","followers_url":"https://api.github.com/users/ReeceStevens/followers","following_url":"https://api.github.com/users/ReeceStevens/following{/other_user}","gists_url":"https://api.github.com/users/ReeceStevens/gists{/gist_id}","starred_url":"https://api.github.com/users/ReeceStevens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ReeceStevens/subscriptions","organizations_url":"https://api.github.com/users/ReeceStevens/orgs","repos_url":"https://api.github.com/users/ReeceStevens/repos","events_url":"https://api.github.com/users/ReeceStevens/events{/privacy}","received_events_url":"https://api.github.com/users/ReeceStevens/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T20:44:08Z","updated_at":"2018-01-24T20:44:08Z","author_association":"NONE","body":"And yes, the server we are testing is using an HDD","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360267197/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360280510","html_url":"https://github.com/apache/couchdb/issues/1093#issuecomment-360280510","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1093","id":360280510,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDI4MDUxMA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T21:32:44Z","updated_at":"2018-01-24T21:33:23Z","author_association":"MEMBER","body":"I can't get a replication on that test machine even using `--threads 100 --iterations 100 --single-source` and with `update_lru_on_read = false` I'm afraid  \r\n\r\nI'll have to track down an HDD and try again tomorrow.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360280510/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360281474","html_url":"https://github.com/apache/couchdb/issues/1093#issuecomment-360281474","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1093","id":360281474,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDI4MTQ3NA==","user":{"login":"ReeceStevens","id":5847947,"node_id":"MDQ6VXNlcjU4NDc5NDc=","avatar_url":"https://avatars.githubusercontent.com/u/5847947?v=4","gravatar_id":"","url":"https://api.github.com/users/ReeceStevens","html_url":"https://github.com/ReeceStevens","followers_url":"https://api.github.com/users/ReeceStevens/followers","following_url":"https://api.github.com/users/ReeceStevens/following{/other_user}","gists_url":"https://api.github.com/users/ReeceStevens/gists{/gist_id}","starred_url":"https://api.github.com/users/ReeceStevens/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ReeceStevens/subscriptions","organizations_url":"https://api.github.com/users/ReeceStevens/orgs","repos_url":"https://api.github.com/users/ReeceStevens/repos","events_url":"https://api.github.com/users/ReeceStevens/events{/privacy}","received_events_url":"https://api.github.com/users/ReeceStevens/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-24T21:36:13Z","updated_at":"2018-01-24T21:36:13Z","author_association":"NONE","body":"Ahh, that is unfortunate. Perhaps disk latency is playing a role in all of this. Thanks, definitely let me know if the repro script doesn't work on an HDD either.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360281474/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360358787","html_url":"https://github.com/apache/couchdb/issues/1086#issuecomment-360358787","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1086","id":360358787,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDM1ODc4Nw==","user":{"login":"sajeeval","id":29610949,"node_id":"MDQ6VXNlcjI5NjEwOTQ5","avatar_url":"https://avatars.githubusercontent.com/u/29610949?v=4","gravatar_id":"","url":"https://api.github.com/users/sajeeval","html_url":"https://github.com/sajeeval","followers_url":"https://api.github.com/users/sajeeval/followers","following_url":"https://api.github.com/users/sajeeval/following{/other_user}","gists_url":"https://api.github.com/users/sajeeval/gists{/gist_id}","starred_url":"https://api.github.com/users/sajeeval/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sajeeval/subscriptions","organizations_url":"https://api.github.com/users/sajeeval/orgs","repos_url":"https://api.github.com/users/sajeeval/repos","events_url":"https://api.github.com/users/sajeeval/events{/privacy}","received_events_url":"https://api.github.com/users/sajeeval/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-25T04:38:23Z","updated_at":"2018-01-25T04:38:23Z","author_association":"NONE","body":"Hi,\r\nThank you for your reply. One more question:\r\nIn case we want to rollback to an older version, say from 1.7.1 to 1.3.1, is that possible by copying the data directory?\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360358787/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360375987","html_url":"https://github.com/apache/couchdb/pull/1032#issuecomment-360375987","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1032","id":360375987,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDM3NTk4Nw==","user":{"login":"jiangphcn","id":18000622,"node_id":"MDQ6VXNlcjE4MDAwNjIy","avatar_url":"https://avatars.githubusercontent.com/u/18000622?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangphcn","html_url":"https://github.com/jiangphcn","followers_url":"https://api.github.com/users/jiangphcn/followers","following_url":"https://api.github.com/users/jiangphcn/following{/other_user}","gists_url":"https://api.github.com/users/jiangphcn/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangphcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangphcn/subscriptions","organizations_url":"https://api.github.com/users/jiangphcn/orgs","repos_url":"https://api.github.com/users/jiangphcn/repos","events_url":"https://api.github.com/users/jiangphcn/events{/privacy}","received_events_url":"https://api.github.com/users/jiangphcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-25T06:42:07Z","updated_at":"2018-01-25T06:42:07Z","author_association":"CONTRIBUTOR","body":"@wohali Hey Joan, documentation update PR is https://github.com/apache/couchdb-documentation/pull/241.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360375987/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360381079","html_url":"https://github.com/apache/couchdb/issues/1125#issuecomment-360381079","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1125","id":360381079,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDM4MTA3OQ==","user":{"login":"sergey-safarov","id":2562241,"node_id":"MDQ6VXNlcjI1NjIyNDE=","avatar_url":"https://avatars.githubusercontent.com/u/2562241?v=4","gravatar_id":"","url":"https://api.github.com/users/sergey-safarov","html_url":"https://github.com/sergey-safarov","followers_url":"https://api.github.com/users/sergey-safarov/followers","following_url":"https://api.github.com/users/sergey-safarov/following{/other_user}","gists_url":"https://api.github.com/users/sergey-safarov/gists{/gist_id}","starred_url":"https://api.github.com/users/sergey-safarov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sergey-safarov/subscriptions","organizations_url":"https://api.github.com/users/sergey-safarov/orgs","repos_url":"https://api.github.com/users/sergey-safarov/repos","events_url":"https://api.github.com/users/sergey-safarov/events{/privacy}","received_events_url":"https://api.github.com/users/sergey-safarov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-25T07:13:44Z","updated_at":"2018-01-25T07:13:44Z","author_association":"NONE","body":"Hello @nickva \r\nI use RPM package http://apache.bintray.com/couchdb-rpm/el7/x86_64/couchdb-2.1.1-2.el7.centos.x86_64.rpm\r\nAverage document size with attacmetns - `2,3Gb / 12876 docs = 179 byte per doc`\r\nLargest doc  - `not more 1 Kb without attachments`\r\nLargest attachment - `2,4Mb`\r\nAverage attachment - `800Kb`\r\nThink all databases without attachments is replicated normally.\r\nFormated config is attached (used default).\r\n```\r\n{  \r\n   \"native_query_servers\":{  \r\n      \"query\":\"{mango_native_proc, start_link, []}\"\r\n   },\r\n   \"httpd_design_handlers\":{  \r\n      \"_compact\":\"{couch_mrview_http, handle_compact_req}\",\r\n      \"_info\":\"{couch_mrview_http, handle_info_req}\",\r\n      \"_list\":\"{couch_mrview_show, handle_view_list_req}\",\r\n      \"_rewrite\":\"{couch_httpd_rewrite, handle_rewrite_req}\",\r\n      \"_show\":\"{couch_mrview_show, handle_doc_show_req}\",\r\n      \"_update\":\"{couch_mrview_show, handle_doc_update_req}\",\r\n      \"_view\":\"{couch_mrview_http, handle_view_req}\",\r\n      \"_view_changes\":\"{couch_mrview_http, handle_view_changes_req}\"\r\n   },\r\n   \"uuids\":{  \r\n      \"algorithm\":\"sequential\",\r\n      \"max_count\":\"1000\"\r\n   },\r\n   \"cluster\":{  \r\n      \"n\":\"3\",\r\n      \"q\":\"8\"\r\n   },\r\n   \"cors\":{  \r\n      \"credentials\":\"false\"\r\n   },\r\n   \"chttpd\":{  \r\n      \"backlog\":\"512\",\r\n      \"bind_address\":\"0.0.0.0\",\r\n      \"docroot\":\"./share/www\",\r\n      \"port\":\"5984\",\r\n      \"prefer_minimal\":\"Cache-Control, Content-Length, Content-Range, Content-Type, ETag, Server, Transfer-Encoding, Vary\",\r\n      \"require_valid_user\":\"false\",\r\n      \"socket_options\":\"[{recbuf, 262144}, {sndbuf, 262144}, {nodelay, true}]\"\r\n   },\r\n   \"httpd_global_handlers\":{  \r\n      \"/\":\"{couch_httpd_misc_handlers, handle_welcome_req, <<\\\"Welcome\\\">>}\",\r\n      \"_active_tasks\":\"{couch_httpd_misc_handlers, handle_task_status_req}\",\r\n      \"_all_dbs\":\"{couch_httpd_misc_handlers, handle_all_dbs_req}\",\r\n      \"_config\":\"{couch_httpd_misc_handlers, handle_config_req}\",\r\n      \"_plugins\":\"{couch_plugins_httpd, handle_req}\",\r\n      \"_replicate\":\"{couch_replicator_httpd, handle_req}\",\r\n      \"_restart\":\"{couch_httpd_misc_handlers, handle_restart_req}\",\r\n      \"_session\":\"{couch_httpd_auth, handle_session_req}\",\r\n      \"_stats\":\"{couch_stats_httpd, handle_stats_req}\",\r\n      \"_system\":\"{chttpd_misc, handle_system_req}\",\r\n      \"_utils\":\"{couch_httpd_misc_handlers, handle_utils_dir_req, \\\"./share/www\\\"}\",\r\n      \"_uuids\":\"{couch_httpd_misc_handlers, handle_uuids_req}\",\r\n      \"favicon.ico\":\"{couch_httpd_misc_handlers, handle_favicon_req, \\\"./share/www\\\"}\"\r\n   },\r\n   \"attachments\":{  \r\n      \"compressible_types\":\"text/*, application/javascript, application/json, application/xml\",\r\n      \"compression_level\":\"8\"\r\n   },\r\n   \"query_server_config\":{  \r\n      \"os_process_limit\":\"100\",\r\n      \"reduce_limit\":\"true\"\r\n   },\r\n   \"vendor\":{  \r\n      \"name\":\"The Apache Software Foundation\"\r\n   },\r\n   \"replicator\":{  \r\n      \"connection_timeout\":\"30000\",\r\n      \"http_connections\":\"20\",\r\n      \"interval\":\"60000\",\r\n      \"max_churn\":\"20\",\r\n      \"max_jobs\":\"500\",\r\n      \"retries_per_request\":\"5\",\r\n      \"socket_options\":\"[{keepalive, true}, {nodelay, false}]\",\r\n      \"ssl_certificate_max_depth\":\"3\",\r\n      \"startup_jitter\":\"5000\",\r\n      \"verify_ssl_certificates\":\"false\",\r\n      \"worker_batch_size\":\"500\",\r\n      \"worker_processes\":\"4\"\r\n   },\r\n   \"ssl\":{  \r\n      \"port\":\"6984\"\r\n   },\r\n   \"log\":{  \r\n      \"file\":\"/var/log/couchdb/couchdb.log\",\r\n      \"level\":\"info\",\r\n      \"writer\":\"file\"\r\n   },\r\n   \"indexers\":{  \r\n      \"couch_mrview\":\"true\"\r\n   },\r\n   \"view_compaction\":{  \r\n      \"keyvalue_buffer_size\":\"2097152\"\r\n   },\r\n   \"query_servers\":{  \r\n      \"coffeescript\":\"./bin/couchjs ./share/server/main-coffee.js\",\r\n      \"javascript\":\"./bin/couchjs ./share/server/main.js\"\r\n   },\r\n   \"features\":{  \r\n      \"scheduler\":\"true\"\r\n   },\r\n   \"daemons\":{  \r\n      \"auth_cache\":\"{couch_auth_cache, start_link, []}\",\r\n      \"compaction_daemon\":\"{couch_compaction_daemon, start_link, []}\",\r\n      \"external_manager\":\"{couch_external_manager, start_link, []}\",\r\n      \"httpd\":\"{couch_httpd, start_link, []}\",\r\n      \"index_server\":\"{couch_index_server, start_link, []}\",\r\n      \"os_daemons\":\"{couch_os_daemons, start_link, []}\",\r\n      \"query_servers\":\"{couch_proc_manager, start_link, []}\",\r\n      \"uuids\":\"{couch_uuids, start, []}\",\r\n      \"vhosts\":\"{couch_httpd_vhost, start_link, []}\"\r\n   },\r\n   \"couch_peruser\":{  \r\n      \"delete_dbs\":\"false\",\r\n      \"enable\":\"false\"\r\n   },\r\n   \"httpd\":{  \r\n      \"allow_jsonp\":\"false\",\r\n      \"authentication_handlers\":\"{couch_httpd_auth, cookie_authentication_handler}, {couch_httpd_auth, default_authentication_handler}\",\r\n      \"bind_address\":\"0.0.0.0\",\r\n      \"default_handler\":\"{couch_httpd_db, handle_request}\",\r\n      \"enable_cors\":\"false\",\r\n      \"enable_xframe_options\":\"false\",\r\n      \"max_http_request_size\":\"67108864\",\r\n      \"port\":\"5986\",\r\n      \"secure_rewrites\":\"true\",\r\n      \"socket_options\":\"[{recbuf, 262144}, {sndbuf, 262144}]\",\r\n      \"vhost_global_handlers\":\"_utils, _uuids, _session, _users\"\r\n   },\r\n   \"httpd_db_handlers\":{  \r\n      \"_all_docs\":\"{couch_mrview_http, handle_all_docs_req}\",\r\n      \"_changes\":\"{couch_httpd_db, handle_db_changes_req}\",\r\n      \"_compact\":\"{couch_httpd_db, handle_compact_req}\",\r\n      \"_design\":\"{couch_httpd_db, handle_design_req}\",\r\n      \"_design_docs\":\"{couch_mrview_http, handle_design_docs_req}\",\r\n      \"_local_docs\":\"{couch_mrview_http, handle_local_docs_req}\",\r\n      \"_temp_view\":\"{couch_mrview_http, handle_temp_view_req}\",\r\n      \"_view_cleanup\":\"{couch_mrview_http, handle_cleanup_req}\"\r\n   },\r\n   \"database_compaction\":{  \r\n      \"checkpoint_after\":\"5242880\",\r\n      \"doc_buffer_size\":\"524288\"\r\n   },\r\n   \"csp\":{  \r\n      \"enable\":\"true\"\r\n   },\r\n   \"couch_httpd_auth\":{  \r\n      \"allow_persistent_cookies\":\"false\",\r\n      \"auth_cache_size\":\"50\",\r\n      \"authentication_db\":\"_users\",\r\n      \"authentication_redirect\":\"/_utils/session.html\",\r\n      \"iterations\":\"10\",\r\n      \"require_valid_user\":\"false\",\r\n      \"timeout\":\"600\"\r\n   },\r\n   \"couchdb\":{  \r\n      \"attachment_stream_buffer_size\":\"4096\",\r\n      \"changes_doc_ids_optimization_threshold\":\"100\",\r\n      \"database_dir\":\"./data\",\r\n      \"default_security\":\"admin_local\",\r\n      \"delayed_commits\":\"false\",\r\n      \"file_compression\":\"snappy\",\r\n      \"max_dbs_open\":\"500\",\r\n      \"os_process_timeout\":\"5000\",\r\n      \"uuid\":\"aa251fc49c416b4b37f8ba8b1eb6f1aa\",\r\n      \"view_index_dir\":\"./data\"\r\n   },\r\n   \"compactions\":{  \r\n      \"_default\":\"[{db_fragmentation, \\\"70%\\\"}, {view_fragmentation, \\\"60%\\\"}]\"\r\n   },\r\n   \"compaction_daemon\":{  \r\n      \"check_interval\":\"300\",\r\n      \"min_file_size\":\"131072\"\r\n   }\r\n}\r\n```\r\nNext i will test recommended fix","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360381079/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360381435","html_url":"https://github.com/apache/couchdb/issues/1086#issuecomment-360381435","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1086","id":360381435,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDM4MTQzNQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-25T07:15:51Z","updated_at":"2018-01-25T07:15:51Z","author_association":"MEMBER","body":"No. You will have to replicate back. File formats are not reverse compatible.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360381435/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360407395","html_url":"https://github.com/apache/couchdb/issues/1125#issuecomment-360407395","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1125","id":360407395,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDQwNzM5NQ==","user":{"login":"sergey-safarov","id":2562241,"node_id":"MDQ6VXNlcjI1NjIyNDE=","avatar_url":"https://avatars.githubusercontent.com/u/2562241?v=4","gravatar_id":"","url":"https://api.github.com/users/sergey-safarov","html_url":"https://github.com/sergey-safarov","followers_url":"https://api.github.com/users/sergey-safarov/followers","following_url":"https://api.github.com/users/sergey-safarov/following{/other_user}","gists_url":"https://api.github.com/users/sergey-safarov/gists{/gist_id}","starred_url":"https://api.github.com/users/sergey-safarov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sergey-safarov/subscriptions","organizations_url":"https://api.github.com/users/sergey-safarov/orgs","repos_url":"https://api.github.com/users/sergey-safarov/repos","events_url":"https://api.github.com/users/sergey-safarov/events{/privacy}","received_events_url":"https://api.github.com/users/sergey-safarov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-25T09:17:58Z","updated_at":"2018-01-25T09:17:58Z","author_association":"NONE","body":"I increased `max_http_request_size` up to 10 times - issue is still persist.\r\nI can create VM with installed couchdb master and one database that cannot be replicated.\r\nIf you provide your public ssh key, then you can look issue on host.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360407395/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360500296","html_url":"https://github.com/apache/couchdb/issues/1081#issuecomment-360500296","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1081","id":360500296,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDUwMDI5Ng==","user":{"login":"Avaq","id":1217745,"node_id":"MDQ6VXNlcjEyMTc3NDU=","avatar_url":"https://avatars.githubusercontent.com/u/1217745?v=4","gravatar_id":"","url":"https://api.github.com/users/Avaq","html_url":"https://github.com/Avaq","followers_url":"https://api.github.com/users/Avaq/followers","following_url":"https://api.github.com/users/Avaq/following{/other_user}","gists_url":"https://api.github.com/users/Avaq/gists{/gist_id}","starred_url":"https://api.github.com/users/Avaq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Avaq/subscriptions","organizations_url":"https://api.github.com/users/Avaq/orgs","repos_url":"https://api.github.com/users/Avaq/repos","events_url":"https://api.github.com/users/Avaq/events{/privacy}","received_events_url":"https://api.github.com/users/Avaq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-25T15:28:01Z","updated_at":"2018-01-25T15:54:04Z","author_association":"NONE","body":"Hi @nickva, thank you for your response!\r\n\r\n> Noticed in the test behavior script you specified a heartbeat. In 2.x replicator doesn't use hearbeats, instead it uses timeouts\r\n\r\nI didn't know heartbeats were removed. It shouldn't really matter for my case though. The only reason I'm specifying a heartbeat in my tests is to make the result more visual (so you don't have to wait ten seconds using 1.6 to see if something is happening). \r\n\r\nI have adjusted my test.\r\n\r\n```sh\r\n# We create our test database\r\ncurl -X PUT localhost:5984/replication-source\r\n\r\n# We insert a design doc with a filter function that is guaranteed to take long\r\n# The reason is so we can simulate a database with a lot of documents which are\r\n# not going to pass in the filtering process.\r\ncurl -X PUT localhost:5984/replication-source/_design/test -d '{\"filters\":{\"test\":\"function(){var future = Date.now() + 2000; while(Date.now() < future){}; return false}\"}}'\r\n\r\n# We insert a bunch of documents so that filtering them will take time. Note\r\n# that I increased the number from 20 to 100, because I have more CPU cores\r\n# this time around (I didn't consider that before).\r\nfor i in {1..100}; do curl -X POST -H 'Content-Type: application/json' localhost:5984/replication-source -d '{\"foo\":\"bar\"}'; done\r\n```\r\n```sh\r\n# I send a request for changes to the database. This request resembles the request\r\n# a replication client might send very closely.\r\ncurl 'localhost:5984/replication-source/_changes?feed=normal&style=all_docs&since=0&filter=test%2Ftest&timeout=10000'\r\n```\r\n\r\nI'm getting better results now. I do indeed see the `{\"results\":[`-line printed after about ten seconds, followed by a periodic newline, until finally the last sequence number. Unfortunately, this is not what's happening on the production environment, but these results are a huge step forward! Thank you.\r\n\r\n> To double check, is the replication itself running on a 2.x cluster? What are the versions of the targets and source? Are they all 2.x as well?\r\n\r\nThere is one \"central server\" to which, and from which, a large number of clients push and pull subsets of information. The server runs a 2.x cluster, and the clients are single-node CouchDB instances ranging between version 1.6 on Windows XP and 2.x on Windows 10.\r\n\r\n> Are there any proxies or load balancers involved and do you think they could affect the connections?\r\n\r\nThe central server sits behind an nginx reverse proxy, which is now my prime suspect. Thank you for pointing this out to me.\r\n\r\n> How many replication jobs are running?\r\n\r\nThere are a few replication jobs running within the central server itself, but they do not cause problems. At any given time, some fifty clients running their own replication jobs will be polling the server for changes.\r\n\r\n> In case of filtered replications, with large source db and a restrictive filter, like you have, replications won't checkpoint unless they receive a document update via the filter. However if it takes too long and the job is swapped out by the scheduler, it might not have chance to checkpoint, it will be stopped. Next time starts will use 0 for the changes feed start 0, and it will wait again, not get a document, will be stopped, etc.\r\n\r\nThis sounds a lot like what I thought was happening, but every node only runs two replication jobs. One for upstream replication, and one for downstream. Neither are continuous.\r\n\r\n----\r\n\r\nI will be investigating whether nginx might be buffering the response before sending it along, causing connections to drop.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360500296/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360502226","html_url":"https://github.com/apache/couchdb/pull/1126#issuecomment-360502226","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1126","id":360502226,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDUwMjIyNg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-25T15:33:35Z","updated_at":"2018-01-25T15:33:35Z","author_association":"CONTRIBUTOR","body":"Looks good. First I thought it was a bit heavy handed to remove all headers but it's probably safer. See some requested changes then +1\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360502226/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360502678","html_url":"https://github.com/apache/couchdb/issues/1081#issuecomment-360502678","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1081","id":360502678,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDUwMjY3OA==","user":{"login":"Avaq","id":1217745,"node_id":"MDQ6VXNlcjEyMTc3NDU=","avatar_url":"https://avatars.githubusercontent.com/u/1217745?v=4","gravatar_id":"","url":"https://api.github.com/users/Avaq","html_url":"https://github.com/Avaq","followers_url":"https://api.github.com/users/Avaq/followers","following_url":"https://api.github.com/users/Avaq/following{/other_user}","gists_url":"https://api.github.com/users/Avaq/gists{/gist_id}","starred_url":"https://api.github.com/users/Avaq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Avaq/subscriptions","organizations_url":"https://api.github.com/users/Avaq/orgs","repos_url":"https://api.github.com/users/Avaq/repos","events_url":"https://api.github.com/users/Avaq/events{/privacy}","received_events_url":"https://api.github.com/users/Avaq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-25T15:35:02Z","updated_at":"2018-01-25T15:35:02Z","author_association":"NONE","body":":man_facepalming: https://www.nginx.com/resources/admin-guide/reverse-proxy/#buffers","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360502678/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360504857","html_url":"https://github.com/apache/couchdb/issues/1081#issuecomment-360504857","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1081","id":360504857,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDUwNDg1Nw==","user":{"login":"Avaq","id":1217745,"node_id":"MDQ6VXNlcjEyMTc3NDU=","avatar_url":"https://avatars.githubusercontent.com/u/1217745?v=4","gravatar_id":"","url":"https://api.github.com/users/Avaq","html_url":"https://github.com/Avaq","followers_url":"https://api.github.com/users/Avaq/followers","following_url":"https://api.github.com/users/Avaq/following{/other_user}","gists_url":"https://api.github.com/users/Avaq/gists{/gist_id}","starred_url":"https://api.github.com/users/Avaq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Avaq/subscriptions","organizations_url":"https://api.github.com/users/Avaq/orgs","repos_url":"https://api.github.com/users/Avaq/repos","events_url":"https://api.github.com/users/Avaq/events{/privacy}","received_events_url":"https://api.github.com/users/Avaq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-25T15:41:38Z","updated_at":"2018-01-25T15:51:35Z","author_association":"NONE","body":"I just added `proxy_buffering off;` to my nginx configuration and I already tested it. It solved all of my problems. Thank you so much for thinking about this issue! Sorry for taking your time.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360504857/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360561787","html_url":"https://github.com/apache/couchdb/issues/979#issuecomment-360561787","issue_url":"https://api.github.com/repos/apache/couchdb/issues/979","id":360561787,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDU2MTc4Nw==","user":{"login":"alleycat58uk","id":3010285,"node_id":"MDQ6VXNlcjMwMTAyODU=","avatar_url":"https://avatars.githubusercontent.com/u/3010285?v=4","gravatar_id":"","url":"https://api.github.com/users/alleycat58uk","html_url":"https://github.com/alleycat58uk","followers_url":"https://api.github.com/users/alleycat58uk/followers","following_url":"https://api.github.com/users/alleycat58uk/following{/other_user}","gists_url":"https://api.github.com/users/alleycat58uk/gists{/gist_id}","starred_url":"https://api.github.com/users/alleycat58uk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alleycat58uk/subscriptions","organizations_url":"https://api.github.com/users/alleycat58uk/orgs","repos_url":"https://api.github.com/users/alleycat58uk/repos","events_url":"https://api.github.com/users/alleycat58uk/events{/privacy}","received_events_url":"https://api.github.com/users/alleycat58uk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-25T18:48:04Z","updated_at":"2018-01-25T18:48:04Z","author_association":"NONE","body":"Works for me too.  Thanks","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360561787/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360578447","html_url":"https://github.com/apache/couchdb/issues/979#issuecomment-360578447","issue_url":"https://api.github.com/repos/apache/couchdb/issues/979","id":360578447,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDU3ODQ0Nw==","user":{"login":"bedney","id":13412,"node_id":"MDQ6VXNlcjEzNDEy","avatar_url":"https://avatars.githubusercontent.com/u/13412?v=4","gravatar_id":"","url":"https://api.github.com/users/bedney","html_url":"https://github.com/bedney","followers_url":"https://api.github.com/users/bedney/followers","following_url":"https://api.github.com/users/bedney/following{/other_user}","gists_url":"https://api.github.com/users/bedney/gists{/gist_id}","starred_url":"https://api.github.com/users/bedney/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bedney/subscriptions","organizations_url":"https://api.github.com/users/bedney/orgs","repos_url":"https://api.github.com/users/bedney/repos","events_url":"https://api.github.com/users/bedney/events{/privacy}","received_events_url":"https://api.github.com/users/bedney/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-25T19:44:56Z","updated_at":"2018-01-25T19:45:07Z","author_association":"NONE","body":"LGTM Jan :+1: - thanks!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360578447/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360688974","html_url":"https://github.com/apache/couchdb/issues/535#issuecomment-360688974","issue_url":"https://api.github.com/repos/apache/couchdb/issues/535","id":360688974,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDY4ODk3NA==","user":{"login":"mraygalaxy","id":966394,"node_id":"MDQ6VXNlcjk2NjM5NA==","avatar_url":"https://avatars.githubusercontent.com/u/966394?v=4","gravatar_id":"","url":"https://api.github.com/users/mraygalaxy","html_url":"https://github.com/mraygalaxy","followers_url":"https://api.github.com/users/mraygalaxy/followers","following_url":"https://api.github.com/users/mraygalaxy/following{/other_user}","gists_url":"https://api.github.com/users/mraygalaxy/gists{/gist_id}","starred_url":"https://api.github.com/users/mraygalaxy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mraygalaxy/subscriptions","organizations_url":"https://api.github.com/users/mraygalaxy/orgs","repos_url":"https://api.github.com/users/mraygalaxy/repos","events_url":"https://api.github.com/users/mraygalaxy/events{/privacy}","received_events_url":"https://api.github.com/users/mraygalaxy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-26T05:36:48Z","updated_at":"2018-01-26T05:36:48Z","author_association":"NONE","body":"@ptitjes This is working for me now on version 2.1.1. Thanks guys!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360688974/reactions","total_count":4,"+1":2,"-1":0,"laugh":0,"hooray":2,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360905619","html_url":"https://github.com/apache/couchdb/pull/1129#issuecomment-360905619","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1129","id":360905619,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MDkwNTYxOQ==","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-26T21:12:35Z","updated_at":"2018-01-26T21:12:35Z","author_association":"CONTRIBUTOR","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/360905619/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361073719","html_url":"https://github.com/apache/couchdb/issues/1096#issuecomment-361073719","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1096","id":361073719,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTA3MzcxOQ==","user":{"login":"jvegaseg","id":12508470,"node_id":"MDQ6VXNlcjEyNTA4NDcw","avatar_url":"https://avatars.githubusercontent.com/u/12508470?v=4","gravatar_id":"","url":"https://api.github.com/users/jvegaseg","html_url":"https://github.com/jvegaseg","followers_url":"https://api.github.com/users/jvegaseg/followers","following_url":"https://api.github.com/users/jvegaseg/following{/other_user}","gists_url":"https://api.github.com/users/jvegaseg/gists{/gist_id}","starred_url":"https://api.github.com/users/jvegaseg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jvegaseg/subscriptions","organizations_url":"https://api.github.com/users/jvegaseg/orgs","repos_url":"https://api.github.com/users/jvegaseg/repos","events_url":"https://api.github.com/users/jvegaseg/events{/privacy}","received_events_url":"https://api.github.com/users/jvegaseg/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-28T16:04:47Z","updated_at":"2018-01-28T16:04:47Z","author_association":"NONE","body":"Sometimes it returns 409-Conflict but waiting for a while and retrying it seams to work. DB is growing and these errors (500 and 409) appears more frequently.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361073719/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361079409","html_url":"https://github.com/apache/couchdb/issues/1053#issuecomment-361079409","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1053","id":361079409,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTA3OTQwOQ==","user":{"login":"mado89","id":975497,"node_id":"MDQ6VXNlcjk3NTQ5Nw==","avatar_url":"https://avatars.githubusercontent.com/u/975497?v=4","gravatar_id":"","url":"https://api.github.com/users/mado89","html_url":"https://github.com/mado89","followers_url":"https://api.github.com/users/mado89/followers","following_url":"https://api.github.com/users/mado89/following{/other_user}","gists_url":"https://api.github.com/users/mado89/gists{/gist_id}","starred_url":"https://api.github.com/users/mado89/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mado89/subscriptions","organizations_url":"https://api.github.com/users/mado89/orgs","repos_url":"https://api.github.com/users/mado89/repos","events_url":"https://api.github.com/users/mado89/events{/privacy}","received_events_url":"https://api.github.com/users/mado89/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-28T17:22:38Z","updated_at":"2018-01-28T17:22:38Z","author_association":"NONE","body":"Well that might have been the problem. I deleted the database as it was not important so there is no way to reproduce it now :(","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361079409/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361212568","html_url":"https://github.com/apache/couchdb/issues/979#issuecomment-361212568","issue_url":"https://api.github.com/repos/apache/couchdb/issues/979","id":361212568,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTIxMjU2OA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-29T11:06:52Z","updated_at":"2018-01-29T11:06:52Z","author_association":"MEMBER","body":"Thanks all for testing, deployed here: https://github.com/apache/couchdb-www/commit/c7fc8fc9863b387f4ea7aa8cf63ab2737cfef392","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361212568/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361229996","html_url":"https://github.com/apache/couchdb/issues/1086#issuecomment-361229996","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1086","id":361229996,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTIyOTk5Ng==","user":{"login":"sajeeval","id":29610949,"node_id":"MDQ6VXNlcjI5NjEwOTQ5","avatar_url":"https://avatars.githubusercontent.com/u/29610949?v=4","gravatar_id":"","url":"https://api.github.com/users/sajeeval","html_url":"https://github.com/sajeeval","followers_url":"https://api.github.com/users/sajeeval/followers","following_url":"https://api.github.com/users/sajeeval/following{/other_user}","gists_url":"https://api.github.com/users/sajeeval/gists{/gist_id}","starred_url":"https://api.github.com/users/sajeeval/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sajeeval/subscriptions","organizations_url":"https://api.github.com/users/sajeeval/orgs","repos_url":"https://api.github.com/users/sajeeval/repos","events_url":"https://api.github.com/users/sajeeval/events{/privacy}","received_events_url":"https://api.github.com/users/sajeeval/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-29T12:25:14Z","updated_at":"2018-01-29T12:25:14Z","author_association":"NONE","body":"Thanks Wohali","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361229996/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361333904","html_url":"https://github.com/apache/couchdb/issues/831#issuecomment-361333904","issue_url":"https://api.github.com/repos/apache/couchdb/issues/831","id":361333904,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTMzMzkwNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-29T18:08:48Z","updated_at":"2018-01-29T18:08:48Z","author_association":"MEMBER","body":"@nickva can you confirm that, for the Mango case, a pre-built Mango index is similarly not leveraged to speed up filtered replication for the same reasons as raised in #592? I would expect this is the case, since Mango uses mrview indices, correct?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361333904/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361359518","html_url":"https://github.com/apache/couchdb/issues/831#issuecomment-361359518","issue_url":"https://api.github.com/repos/apache/couchdb/issues/831","id":361359518,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTM1OTUxOA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-29T19:32:10Z","updated_at":"2018-01-29T19:32:10Z","author_association":"CONTRIBUTOR","body":"That's true. Currently the Mango selector passed to the changes feed doesn't use any Mango indices. It is a pure filter passed in with the request body. Could think of it for example, as a more optimized js filter function which doesn't live in a source _design document and doesn't need to do the extra work of going to/from external javascript engine process.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361359518/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361468099","html_url":"https://github.com/apache/couchdb/issues/1133#issuecomment-361468099","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1133","id":361468099,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTQ2ODA5OQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-30T03:45:51Z","updated_at":"2018-01-30T03:45:51Z","author_association":"CONTRIBUTOR","body":"Hi @ToanP,\r\n\r\nThanks for your report. I think you might be seeing this issue: https://github.com/apache/couchdb/issues/979\r\n\r\nCheck out the update at the bottom.\r\n\r\n(Direct link to the downloadable zip: https://dl.bintray.com/apache/couchdb/mac/2.1.1/Apache-CouchDB-2.1.1-1.zip)\r\n\r\n\r\n\r\nAlso it seems you are using the same document ID (`bc2a41170621c326ec68382f846d5764`) for all documents try to use different IDs if you can.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361468099/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361495466","html_url":"https://github.com/apache/couchdb/issues/1131#issuecomment-361495466","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1131","id":361495466,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTQ5NTQ2Ng==","user":{"login":"penkeysuresh","id":4910654,"node_id":"MDQ6VXNlcjQ5MTA2NTQ=","avatar_url":"https://avatars.githubusercontent.com/u/4910654?v=4","gravatar_id":"","url":"https://api.github.com/users/penkeysuresh","html_url":"https://github.com/penkeysuresh","followers_url":"https://api.github.com/users/penkeysuresh/followers","following_url":"https://api.github.com/users/penkeysuresh/following{/other_user}","gists_url":"https://api.github.com/users/penkeysuresh/gists{/gist_id}","starred_url":"https://api.github.com/users/penkeysuresh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/penkeysuresh/subscriptions","organizations_url":"https://api.github.com/users/penkeysuresh/orgs","repos_url":"https://api.github.com/users/penkeysuresh/repos","events_url":"https://api.github.com/users/penkeysuresh/events{/privacy}","received_events_url":"https://api.github.com/users/penkeysuresh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-30T07:00:48Z","updated_at":"2018-01-30T07:02:27Z","author_association":"NONE","body":"my bad, I've finally managed to fix it. Our goof up was, while we were logging in, the payload we sent was correct, but the Authorization header was little messed up. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361495466/reactions","total_count":2,"+1":1,"-1":0,"laugh":1,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361521575","html_url":"https://github.com/apache/couchdb/issues/1133#issuecomment-361521575","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1133","id":361521575,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTUyMTU3NQ==","user":{"login":"ToanP","id":17540332,"node_id":"MDQ6VXNlcjE3NTQwMzMy","avatar_url":"https://avatars.githubusercontent.com/u/17540332?v=4","gravatar_id":"","url":"https://api.github.com/users/ToanP","html_url":"https://github.com/ToanP","followers_url":"https://api.github.com/users/ToanP/followers","following_url":"https://api.github.com/users/ToanP/following{/other_user}","gists_url":"https://api.github.com/users/ToanP/gists{/gist_id}","starred_url":"https://api.github.com/users/ToanP/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ToanP/subscriptions","organizations_url":"https://api.github.com/users/ToanP/orgs","repos_url":"https://api.github.com/users/ToanP/repos","events_url":"https://api.github.com/users/ToanP/events{/privacy}","received_events_url":"https://api.github.com/users/ToanP/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-30T08:59:51Z","updated_at":"2018-01-30T08:59:51Z","author_association":"NONE","body":"Thank you nickva. I am using CouchDB2.1.0 and it works. I will check your downloadable zip when I am free.\r\n\r\nThanks again ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361521575/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361555093","html_url":"https://github.com/apache/couchdb/pull/1127#issuecomment-361555093","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1127","id":361555093,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTU1NTA5Mw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-30T10:47:20Z","updated_at":"2018-01-30T10:47:20Z","author_association":"MEMBER","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361555093/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361592392","html_url":"https://github.com/apache/couchdb/pull/1127#issuecomment-361592392","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1127","id":361592392,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTU5MjM5Mg==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-30T13:25:56Z","updated_at":"2018-01-30T13:25:56Z","author_association":"MEMBER","body":"@jjrodrig we wanted to make it so that `make test-cluster-with[out]-quorum` is run as part of `make check`, but this doesnt seem to work on Travis, would you be able to assist with debugging this?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361592392/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361594050","html_url":"https://github.com/apache/couchdb/pull/1127#issuecomment-361594050","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1127","id":361594050,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTU5NDA1MA==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-30T13:32:25Z","updated_at":"2018-01-30T13:32:25Z","author_association":"CONTRIBUTOR","body":"Ok, I'll check it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361594050/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361624601","html_url":"https://github.com/apache/couchdb/pull/1127#issuecomment-361624601","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1127","id":361624601,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTYyNDYwMQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-30T15:15:31Z","updated_at":"2018-01-30T15:15:31Z","author_association":"MEMBER","body":"Thank you! :)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361624601/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361632426","html_url":"https://github.com/apache/couchdb/pull/1127#issuecomment-361632426","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1127","id":361632426,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTYzMjQyNg==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-30T15:38:43Z","updated_at":"2018-01-30T15:38:43Z","author_association":"MEMBER","body":"Im trying a new variant where the new make targets run first in `make check`\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361632426/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361648968","html_url":"https://github.com/apache/couchdb/pull/1127#issuecomment-361648968","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1127","id":361648968,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTY0ODk2OA==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-30T16:25:49Z","updated_at":"2018-01-30T16:25:49Z","author_association":"CONTRIBUTOR","body":"@janl I've reproduced the problem in my environment. It seems that the stop after the mango test is collisioning with the start of the cluster test. \r\nIf you see this commit:\r\n\r\nhttps://github.com/jjrodrig/couchdb/commit/f45b404de930b7da81af7e01d2071451d21acde7\r\n\r\nI've introduced an sleep after mango tests and the check is working\r\n\r\nAlso, I've noticed that the mango test do not clean up dev/lib so it can be affected by previous test executions. \r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361648968/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361824663","html_url":"https://github.com/apache/couchdb/issues/1020#issuecomment-361824663","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1020","id":361824663,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTgyNDY2Mw==","user":{"login":"jhau","id":436372,"node_id":"MDQ6VXNlcjQzNjM3Mg==","avatar_url":"https://avatars.githubusercontent.com/u/436372?v=4","gravatar_id":"","url":"https://api.github.com/users/jhau","html_url":"https://github.com/jhau","followers_url":"https://api.github.com/users/jhau/followers","following_url":"https://api.github.com/users/jhau/following{/other_user}","gists_url":"https://api.github.com/users/jhau/gists{/gist_id}","starred_url":"https://api.github.com/users/jhau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jhau/subscriptions","organizations_url":"https://api.github.com/users/jhau/orgs","repos_url":"https://api.github.com/users/jhau/repos","events_url":"https://api.github.com/users/jhau/events{/privacy}","received_events_url":"https://api.github.com/users/jhau/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-31T05:02:23Z","updated_at":"2018-01-31T05:02:23Z","author_association":"NONE","body":"I tried setting config option in ~/Library/Preferences/couchdb2-local.ini and ~/Library/Application\\ Support/CouchDB2/etc/couchdb/local.ini but neither file has any effect, the only config file that seems to work is /Applications/Apache\\ CouchDB.app/Contents/Resources/couchdbx-core/etc/default.ini","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361824663/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361871793","html_url":"https://github.com/apache/couchdb/issues/1099#issuecomment-361871793","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1099","id":361871793,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTg3MTc5Mw==","user":{"login":"penkeysuresh","id":4910654,"node_id":"MDQ6VXNlcjQ5MTA2NTQ=","avatar_url":"https://avatars.githubusercontent.com/u/4910654?v=4","gravatar_id":"","url":"https://api.github.com/users/penkeysuresh","html_url":"https://github.com/penkeysuresh","followers_url":"https://api.github.com/users/penkeysuresh/followers","following_url":"https://api.github.com/users/penkeysuresh/following{/other_user}","gists_url":"https://api.github.com/users/penkeysuresh/gists{/gist_id}","starred_url":"https://api.github.com/users/penkeysuresh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/penkeysuresh/subscriptions","organizations_url":"https://api.github.com/users/penkeysuresh/orgs","repos_url":"https://api.github.com/users/penkeysuresh/repos","events_url":"https://api.github.com/users/penkeysuresh/events{/privacy}","received_events_url":"https://api.github.com/users/penkeysuresh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-31T09:20:50Z","updated_at":"2018-01-31T09:20:50Z","author_association":"NONE","body":"So for whatever it's worth, I went through the screenshot attached in the above issue and noticed that the 'Admin Party' is on. So theoretically anyone with the url could have went there and deleted the databases. @victor201801 you should check this out http://guide.couchdb.org/draft/security.html#party. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361871793/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361927737","html_url":"https://github.com/apache/couchdb/pull/1127#issuecomment-361927737","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1127","id":361927737,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTkyNzczNw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-31T13:11:54Z","updated_at":"2018-01-31T13:11:54Z","author_association":"MEMBER","body":"merged this, and filed an issue for cleaning up mango: https://github.com/apache/couchdb/issues/1134\r\n\r\nThanks a lot for this contribution!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361927737/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361947713","html_url":"https://github.com/apache/couchdb/issues/1134#issuecomment-361947713","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1134","id":361947713,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTk0NzcxMw==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-31T14:26:43Z","updated_at":"2018-01-31T14:26:43Z","author_association":"CONTRIBUTOR","body":"@janl I've cleaned up the commit just including the dev/lib removal","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361947713/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361960288","html_url":"https://github.com/apache/couchdb/issues/745#issuecomment-361960288","issue_url":"https://api.github.com/repos/apache/couchdb/issues/745","id":361960288,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTk2MDI4OA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-31T15:07:08Z","updated_at":"2018-01-31T15:07:08Z","author_association":"MEMBER","body":"Moar data from affected nodes. Ive listed process by `current_function` and sorted by occurrence\r\n\r\n<details>\r\n<summary>current function count/group script (click to reveal)</summary>\r\n\r\n```erlang\r\nio:format(\"~p\", [\r\n    lists:keysort(2,\r\n        maps:to_list(lists:foldl(\r\n            fun(Elm, Acc) ->\r\n                case Elm of\r\n                    {M, F, A} ->\r\n                        N = maps:get({M, F, A}, Acc, 0),\r\n                        maps:put({M, F, A}, N + 1, Acc);\r\n                    Else ->\r\n                        Acc\r\n                    end\r\n            end,\r\n            #{},\r\n            lists:map(\r\n                fun(Pid) ->\r\n                    case process_info(Pid) of\r\n                        undefined -> [];\r\n                        Info -> proplists:get_value(current_function, Info)\r\n                    end\r\n                end, \r\n                processes()\r\n            )\r\n        ))\r\n    )\r\n])\r\n```\r\n</details>\r\n\r\n### Output\r\n\r\nOutput from an affected node:\r\n\r\n```erlang\r\n[{{code_server,loop,1},1},\r\n {{couch_replicator_scheduler,stats_updater_loop,1},1},\r\n {{cpu_sup,measurement_server_loop,1},1},\r\n {{cpu_sup,port_server_loop,2},1},\r\n {{erl_eval,do_apply,6},1},\r\n {{erl_prim_loader,loop,3},1},\r\n {{erlang,hibernate,3},1},\r\n {{gen,do_call,4},1},\r\n {{global,loop_the_locker,1},1},\r\n {{global,loop_the_registrar,0},1},\r\n {{inet_gethost_native,main_loop,1},1},\r\n {{init,loop,1},1},\r\n {{mem3_shards,'-start_changes_listener/1-fun-0-',1},1},\r\n {{memsup,port_idle,1},1},\r\n {{net_kernel,ticker_loop,2},1},\r\n {{shell,shell_rep,4},1},\r\n {{standard_error,server_loop,1},1},\r\n {{user,server_loop,2},1},\r\n {{couch_changes,wait_updated,3},2},\r\n {{prim_inet,recv0,3},2},\r\n {{dist_util,con_loop,9},3},\r\n {{gen_event,fetch_msg,5},6},\r\n {{couch_os_process,'-init/1-fun-0-',2},23},\r\n {{application_master,loop_it,4},25},\r\n {{application_master,main_loop,2},25},\r\n {{prim_inet,accept0,2},29},\r\n {{couch_httpd_multipart,mp_parse_atts,2},31},\r\n {{fabric_db_update_listener,cleanup_monitor,3},210},\r\n {{fabric_db_update_listener,wait_db_updated,1},210},\r\n {{rexi_monitor,wait_monitors,1},210},\r\n {{rexi_utils,process_message,6},212},\r\n {{couch_event_listener,loop,2},412},\r\n {{couch_httpd_multipart,maybe_send_data,1},881},\r\n {{couch_doc,'-doc_from_multi_part_stream/4-fun-1-',1},912},\r\n {{gen_server,loop,6},2816}]\r\n```\r\n\r\nUnaffected node in the same cluster:\r\n\r\n```erlang\r\n[{{code_server,loop,1},1},\r\n {{couch_ejson_compare,less,2},1},\r\n {{couch_index_server,get_index,3},1},\r\n {{couch_replicator_scheduler,stats_updater_loop,1},1},\r\n {{cpu_sup,measurement_server_loop,1},1},\r\n {{cpu_sup,port_server_loop,2},1},\r\n {{erl_eval,do_apply,6},1},\r\n {{erl_prim_loader,loop,3},1},\r\n {{fabric_util,get_shard,4},1},\r\n {{global,loop_the_locker,1},1},\r\n {{global,loop_the_registrar,0},1},\r\n {{inet_gethost_native,main_loop,1},1},\r\n {{init,loop,1},1},\r\n {{mem3_shards,'-start_changes_listener/1-fun-0-',1},1},\r\n {{memsup,port_idle,1},1},\r\n {{net_kernel,ticker_loop,2},1},\r\n {{prim_inet,recv0,3},1},\r\n {{shell,shell_rep,4},1},\r\n {{standard_error,server_loop,1},1},\r\n {{user,server_loop,2},1},\r\n {{couch_changes,wait_updated,3},2},\r\n {{dist_util,con_loop,9},3},\r\n {{erlang,hibernate,3},3},\r\n {{gen_event,fetch_msg,5},6},\r\n {{rexi,wait_for_ack,2},8},\r\n {{couch_os_process,'-init/1-fun-0-',2},16},\r\n {{application_master,loop_it,4},25},\r\n {{application_master,main_loop,2},25},\r\n {{prim_inet,accept0,2},28},\r\n {{couch_httpd_multipart,mp_parse_atts,2},37},\r\n {{fabric_db_update_listener,wait_db_updated,1},112},\r\n {{fabric_db_update_listener,cleanup_monitor,3},113},\r\n {{rexi_monitor,wait_monitors,1},114},\r\n {{rexi_utils,process_message,6},114},\r\n {{couch_event_listener,loop,2},344},\r\n {{couch_httpd_multipart,maybe_send_data,1},361},\r\n {{couch_doc,'-doc_from_multi_part_stream/4-fun-1-',1},398},\r\n {{gen_server,loop,6},10270}]\r\n```\r\n\r\nOutput from a cluster that doesnt have attachments:\r\n\r\n```erlang\r\n{{code_server,loop,1},1},\r\n {{cpu_sup,measurement_server_loop,1},1},\r\n {{cpu_sup,port_server_loop,2},1},\r\n {{erl_eval,do_apply,6},1},\r\n {{erl_prim_loader,loop,3},1},\r\n {{erts_code_purger,loop,0},1},\r\n {{fabric_db_update_listener,cleanup_monitor,3},1},\r\n {{fabric_db_update_listener,wait_db_updated,1},1},\r\n {{global,loop_the_locker,1},1},\r\n {{global,loop_the_registrar,0},1},\r\n {{init,loop,1},1},\r\n {{net_kernel,ticker_loop,2},1},\r\n {{rexi_monitor,wait_monitors,1},1},\r\n {{rexi_utils,process_message,6},1},\r\n {{shell,shell_rep,4},1},\r\n {{standard_error,server_loop,1},1},\r\n {{timer,sleep,1},1},\r\n {{user,server_loop,2},1},\r\n {{dist_util,con_loop,2},3},\r\n {{gen_event,fetch_msg,5},6},\r\n {{couch_changes,wait_updated,3},10},\r\n {{couch_event_listener,loop,2},19},\r\n {{application_master,loop_it,4},24},\r\n {{application_master,main_loop,2},24},\r\n {{couch_os_process,'-init/1-fun-0-',2},32},\r\n {{prim_inet,accept0,2},33},\r\n {{erlang,hibernate,3},75},\r\n {{gen_server,loop,6},2521}]\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361960288/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361963734","html_url":"https://github.com/apache/couchdb/pull/1135#issuecomment-361963734","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1135","id":361963734,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTk2MzczNA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-31T15:18:04Z","updated_at":"2018-01-31T15:18:04Z","author_association":"MEMBER","body":"I think it'l be cleaner to just make `mango-test` target to depend on `devclean` target before `all`.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361963734/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361979990","html_url":"https://github.com/apache/couchdb/issues/745#issuecomment-361979990","issue_url":"https://api.github.com/repos/apache/couchdb/issues/745","id":361979990,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTk3OTk5MA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-31T16:05:23Z","updated_at":"2018-01-31T16:05:23Z","author_association":"CONTRIBUTOR","body":"Possible solution from davisp discussed on IRC:\r\n\r\nhttps://gist.github.com/davisp/27cd7ab54cdffeaa6e96590df4f988f9","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361979990/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361983212","html_url":"https://github.com/apache/couchdb/pull/1135#issuecomment-361983212","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1135","id":361983212,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTk4MzIxMg==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-31T16:14:55Z","updated_at":"2018-01-31T16:14:55Z","author_association":"CONTRIBUTOR","body":"Thanks @eiri\r\n\r\ndevclean is removing data directories `@rm -rf dev/lib/*/data`  but javascript test is remove all the dev/lib content `@rm -rf dev/lib`\r\nI think that the local.ini is modified by the dev/run script and it is not cleaned by devclean target. It is enough to clean just data?\r\n\r\nrm -rf dev/lib is done also by javascript, test-cluster-with-quorum and test-cluster-without-quorum targets. Should these targets also depend on devclean?\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361983212/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361990920","html_url":"https://github.com/apache/couchdb/issues/745#issuecomment-361990920","issue_url":"https://api.github.com/repos/apache/couchdb/issues/745","id":361990920,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTk5MDkyMA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-31T16:37:29Z","updated_at":"2018-01-31T16:37:29Z","author_association":"MEMBER","body":"Downside of the idea in that diff @nickva linked is that it doesn't work if the RPC workers die before contacting the parser process. So it might help, but also might not.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361990920/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361993545","html_url":"https://github.com/apache/couchdb/pull/1135#issuecomment-361993545","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1135","id":361993545,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MTk5MzU0NQ==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-31T16:45:22Z","updated_at":"2018-01-31T16:45:22Z","author_association":"MEMBER","body":"As far as I can tell `dev/run` overwrites `[admin]` and `[cluster]` sections on each run, so it should be enough just to remove leftover databases to get a clean start state, but you can modify `devclean` to remove whole `dev/lib` if you have any concerns.\r\n\r\nFor `javascript` and the new targets: yes, I think it's better to reduce cut'n'paste when makefile allows that. It's bigger than original scope of this PR, so you can make it for `mango-test` only if you don't feel like extending your changes and we can always return to this later.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/361993545/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362030072","html_url":"https://github.com/apache/couchdb/pull/1135#issuecomment-362030072","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1135","id":362030072,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjAzMDA3Mg==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-31T18:44:15Z","updated_at":"2018-01-31T18:44:15Z","author_association":"CONTRIBUTOR","body":"I've modified the javascript, test-cluster* and test-mango targets.\r\n\r\nsoak-javascript target seems to be not correct, a syntax error is raised. I didnt modify it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362030072/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362092566","html_url":"https://github.com/apache/couchdb/pull/1135#issuecomment-362092566","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1135","id":362092566,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjA5MjU2Ng==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-01-31T22:28:30Z","updated_at":"2018-01-31T22:28:30Z","author_association":"MEMBER","body":"@jjrodrig : Looks good. Thank you for the fix!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362092566/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362320636","html_url":"https://github.com/apache/couchdb/issues/1137#issuecomment-362320636","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1137","id":362320636,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjMyMDYzNg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-01T16:27:48Z","updated_at":"2018-02-01T16:27:48Z","author_association":"MEMBER","body":"Changing a design document (the definition of a \"map\" or a \"reduce\") will force a recalculation of the index on the next time you access that view. CouchDB determines if the definition has changed by performing a checksum on _the entire design document_.\r\n\r\nOn subsequent accesses to the index (without updating the design document) access should be rapid.\r\n\r\nIf you need many different kinds of map or reduce functions, add additional views to the same design document, or create multiple design documents.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362320636/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362321423","html_url":"https://github.com/apache/couchdb/issues/1138#issuecomment-362321423","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1138","id":362321423,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjMyMTQyMw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-01T16:30:19Z","updated_at":"2018-02-01T16:30:19Z","author_association":"MEMBER","body":"This is not a bug report.\r\n\r\nIn the future, please take these sorts of requests to our IRC/Slack channel, or to our user mailing list. Information on both is available at https://couchdb.apache.org/ .\r\n\r\n1. Yes, replication resumes based on private \"checkpoint documents\" the replicator stores. It doesn't matter if there were a lot of new changes or not.\r\n1. Same thing.\r\n1. Same thing.\r\n\r\nTry it yourself! It's an easy thing to experiment with.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362321423/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362322333","html_url":"https://github.com/apache/couchdb/issues/1125#issuecomment-362322333","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1125","id":362322333,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjMyMjMzMw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-01T16:33:03Z","updated_at":"2018-02-01T16:33:03Z","author_association":"MEMBER","body":"@sergey-safarov please follow apache/couchdb#745, this is likely a known issue with replication of documents with attachments.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362322333/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362327942","html_url":"https://github.com/apache/couchdb/issues/1119#issuecomment-362327942","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1119","id":362327942,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjMyNzk0Mg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-01T16:49:43Z","updated_at":"2018-02-01T16:49:43Z","author_association":"MEMBER","body":"For others, so you don't have to sign up for a JIRA account, here's the text (2600/teletype):\r\n\r\n> On debian 8.6 ander openvz container fax attachment cannot be attached to email.\r\n> Root of issue call \"file:read_file(ToFile)\" return enoent\r\n> Fragment of strace cammnad output\r\n`stat(\"/tmp/a0b205e547697bcd.pdf\", 0x7f5a29a1ed00) = -1 ENOENT (No such file or directory)`\r\n> Think OTP have bug that appears only Debian 8.6 virtualized under openvz on Proxmox 3.4 (two years old). Tested command `tiff2pdf -o ~s ~s &> /dev/null && echo -n \\\"success\\\"\"` on OTP-18.3.4.5\r\n\r\n@sergey-safarov This doesn't directly apply because the operation to open a CouchDB shard file is not an `os:cmd` operation, but an internal Erlang operation.\r\n\r\nYou may be right that in your specific configuration there is an issue, but the above information points more likely to a very slow disk (unable to open file for 4.0 seconds is *very very slow*.)\r\n\r\nAre you able to reproduce this issue when you are _not_ running under Docker and proxmox? We see sporadic reports of this type of behaviour and don't really have a good way to resolve this. Increasing this timeout as a default could lead to very bad performance for CouchDB in other situations; putting every single timeout into `local.ini` is not a good solution, either.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362327942/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362329750","html_url":"https://github.com/apache/couchdb/issues/1097#issuecomment-362329750","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1097","id":362329750,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjMyOTc1MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-01T16:54:56Z","updated_at":"2018-02-01T16:54:56Z","author_association":"MEMBER","body":"Can you let us know how much RAM all of your CouchDB-related processes are consuming? Show the output of `top` or `atop`. Are you running any other processes on the machines?\r\n\r\nDo these databases have attachments? If so you are likely running into apache/couchdb#745.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362329750/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362334698","html_url":"https://github.com/apache/couchdb/issues/1106#issuecomment-362334698","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1106","id":362334698,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjMzNDY5OA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-01T17:07:58Z","updated_at":"2018-02-01T17:07:58Z","author_association":"MEMBER","body":"Try replicating the `_users` database to another database.\r\n\r\nIf this works, you could try scheduling a maintenance window, deleting `_users`, recreating `_users` and replicating all of the content back to your `_users` database.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362334698/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362341539","html_url":"https://github.com/apache/couchdb/issues/666#issuecomment-362341539","issue_url":"https://api.github.com/repos/apache/couchdb/issues/666","id":362341539,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjM0MTUzOQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-01T17:30:54Z","updated_at":"2018-02-01T17:30:54Z","author_association":"MEMBER","body":"@abc3 can you open a pull request for this please? Your patch got lost :)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362341539/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362399706","html_url":"https://github.com/apache/couchdb/issues/1119#issuecomment-362399706","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1119","id":362399706,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjM5OTcwNg==","user":{"login":"sergey-safarov","id":2562241,"node_id":"MDQ6VXNlcjI1NjIyNDE=","avatar_url":"https://avatars.githubusercontent.com/u/2562241?v=4","gravatar_id":"","url":"https://api.github.com/users/sergey-safarov","html_url":"https://github.com/sergey-safarov","followers_url":"https://api.github.com/users/sergey-safarov/followers","following_url":"https://api.github.com/users/sergey-safarov/following{/other_user}","gists_url":"https://api.github.com/users/sergey-safarov/gists{/gist_id}","starred_url":"https://api.github.com/users/sergey-safarov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sergey-safarov/subscriptions","organizations_url":"https://api.github.com/users/sergey-safarov/orgs","repos_url":"https://api.github.com/users/sergey-safarov/repos","events_url":"https://api.github.com/users/sergey-safarov/events{/privacy}","received_events_url":"https://api.github.com/users/sergey-safarov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-01T20:59:04Z","updated_at":"2018-02-01T20:59:04Z","author_association":"NONE","body":"Hello @wohali \r\nAbout slow disk. Docker files located at RAID10 disk created from 6 SATA disk.\r\nShort test demonstrate that used partitions is not slow.\r\n```\r\n[root@node0 backup]# date; dd if=/dev/zero of=/var/lib/docker/volumes/test.img bs=1G count=10; date\r\nThu Feb  1 20:47:31 GMT 2018\r\n10+0 records in\r\n10+0 records out\r\n10737418240 bytes (11 GB, 10 GiB) copied, 5.62274 s, 1.9 GB/s\r\nThu Feb  1 20:47:36 GMT 2018\r\n[root@node0 backup]#\r\n``` \r\nI cannot use `couchdb 2.1.1`, issue https://github.com/apache/couchdb/issues/1119 is blocked me.\r\n@wohali how I can measure file opening operation for CouchDB?\r\nMay be via logs?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362399706/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362410116","html_url":"https://github.com/apache/couchdb/issues/1119#issuecomment-362410116","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1119","id":362410116,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjQxMDExNg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-01T21:37:27Z","updated_at":"2018-02-01T21:37:27Z","author_association":"MEMBER","body":"It's not about the speed of the disk, it's about the *latency* of disk operations from inside of the Docker image.\r\n\r\nYour log shows that, on occasion, the Docker environment has very slow disk performance.\r\n\r\nCouchDB performance is directly related to the latency of disk I/O operations.\r\n\r\nHave you tried using the [device storage mapper device](https://docs.docker.com/storage/storagedriver/device-mapper-driver/#image-layering-and-sharing) on real block devices rather than loopback mounted block devices? See https://github.com/moby/moby/issues/21485 for more information:\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362410116/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362427019","html_url":"https://github.com/apache/couchdb/issues/666#issuecomment-362427019","issue_url":"https://api.github.com/repos/apache/couchdb/issues/666","id":362427019,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjQyNzAxOQ==","user":{"login":"abc3","id":1172600,"node_id":"MDQ6VXNlcjExNzI2MDA=","avatar_url":"https://avatars.githubusercontent.com/u/1172600?v=4","gravatar_id":"","url":"https://api.github.com/users/abc3","html_url":"https://github.com/abc3","followers_url":"https://api.github.com/users/abc3/followers","following_url":"https://api.github.com/users/abc3/following{/other_user}","gists_url":"https://api.github.com/users/abc3/gists{/gist_id}","starred_url":"https://api.github.com/users/abc3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/abc3/subscriptions","organizations_url":"https://api.github.com/users/abc3/orgs","repos_url":"https://api.github.com/users/abc3/repos","events_url":"https://api.github.com/users/abc3/events{/privacy}","received_events_url":"https://api.github.com/users/abc3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-01T22:43:28Z","updated_at":"2018-02-01T22:43:28Z","author_association":"NONE","body":"Yes, sure.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362427019/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362465655","html_url":"https://github.com/apache/couchdb/issues/1119#issuecomment-362465655","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1119","id":362465655,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjQ2NTY1NQ==","user":{"login":"sergey-safarov","id":2562241,"node_id":"MDQ6VXNlcjI1NjIyNDE=","avatar_url":"https://avatars.githubusercontent.com/u/2562241?v=4","gravatar_id":"","url":"https://api.github.com/users/sergey-safarov","html_url":"https://github.com/sergey-safarov","followers_url":"https://api.github.com/users/sergey-safarov/followers","following_url":"https://api.github.com/users/sergey-safarov/following{/other_user}","gists_url":"https://api.github.com/users/sergey-safarov/gists{/gist_id}","starred_url":"https://api.github.com/users/sergey-safarov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sergey-safarov/subscriptions","organizations_url":"https://api.github.com/users/sergey-safarov/orgs","repos_url":"https://api.github.com/users/sergey-safarov/repos","events_url":"https://api.github.com/users/sergey-safarov/events{/privacy}","received_events_url":"https://api.github.com/users/sergey-safarov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-02T02:21:08Z","updated_at":"2018-02-02T02:23:42Z","author_association":"NONE","body":"Joan (@wohali) on provided link is not used volumes and used disk image via loopback + docker filesystem overlay. Your example is not applicable to this ticket.\r\n\r\nOn my host is installed Fedora 27 operation system + docker + overlay2 storage driver.\r\nFor Fedora is [recommended](https://docs.docker.com/storage/storagedriver/select-storage-driver/)\r\n\r\n> |Linux distribution |Recommended storage drivers                                                           |\r\n> |-------------------|--------------------------------------------------------------------------------------|\r\n> |Docker CE on Fedora|devicemapper, overlay2 (Fedora 26 or later, experimental), overlay (experimental), vfs|\r\n> \r\n>When possible, overlay2 is the recommended storage driver. When installing Docker for the first time, overlay2 is used by default.\r\n\r\nBut i use `volume` as permanent store for couchdb data and according this [page](https://docs.docker.com/storage/storagedriver/#data-volumes-and-the-storage-driver)  is not mater what is used storage driver\r\n\r\n> A data volume is a directory or file in the Docker hosts filesystem that is mounted directly into a container. Data volumes are not controlled by the storage driver. Reads and writes to data volumes bypass the storage driver and operate at native host speeds.\r\n\r\nI have googled about slow disk operation inside docker container. I find only related to docker for MacOS (not linux).\r\n\r\nAlso i have made test inside docker container\r\n```\r\n[root@node0 ~]# docker run --rm -it -v test:/home fedora:27 /bin/sh\r\nsh-4.4# date; dd if=/dev/zero of=/home/test.img bs=1G count=10; date\r\nFri Feb  2 02:19:51 UTC 2018\r\n10+0 records in\r\n10+0 records out\r\n10737418240 bytes (11 GB, 10 GiB) copied, 5.12558 s, 2.1 GB/s\r\nFri Feb  2 02:19:56 UTC 2018\r\nsh-4.4# \r\n```\r\nResults is same to test on host operation system.\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362465655/reactions","total_count":1,"+1":0,"-1":1,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362469041","html_url":"https://github.com/apache/couchdb/issues/1119#issuecomment-362469041","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1119","id":362469041,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjQ2OTA0MQ==","user":{"login":"sergey-safarov","id":2562241,"node_id":"MDQ6VXNlcjI1NjIyNDE=","avatar_url":"https://avatars.githubusercontent.com/u/2562241?v=4","gravatar_id":"","url":"https://api.github.com/users/sergey-safarov","html_url":"https://github.com/sergey-safarov","followers_url":"https://api.github.com/users/sergey-safarov/followers","following_url":"https://api.github.com/users/sergey-safarov/following{/other_user}","gists_url":"https://api.github.com/users/sergey-safarov/gists{/gist_id}","starred_url":"https://api.github.com/users/sergey-safarov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sergey-safarov/subscriptions","organizations_url":"https://api.github.com/users/sergey-safarov/orgs","repos_url":"https://api.github.com/users/sergey-safarov/repos","events_url":"https://api.github.com/users/sergey-safarov/events{/privacy}","received_events_url":"https://api.github.com/users/sergey-safarov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-02T02:42:43Z","updated_at":"2018-02-02T02:42:43Z","author_association":"NONE","body":"Joan (@wohali) my mistake. Link you provided is applicable.\r\nI will made additional test\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362469041/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362504677","html_url":"https://github.com/apache/couchdb/issues/1119#issuecomment-362504677","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1119","id":362504677,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjUwNDY3Nw==","user":{"login":"sergey-safarov","id":2562241,"node_id":"MDQ6VXNlcjI1NjIyNDE=","avatar_url":"https://avatars.githubusercontent.com/u/2562241?v=4","gravatar_id":"","url":"https://api.github.com/users/sergey-safarov","html_url":"https://github.com/sergey-safarov","followers_url":"https://api.github.com/users/sergey-safarov/followers","following_url":"https://api.github.com/users/sergey-safarov/following{/other_user}","gists_url":"https://api.github.com/users/sergey-safarov/gists{/gist_id}","starred_url":"https://api.github.com/users/sergey-safarov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sergey-safarov/subscriptions","organizations_url":"https://api.github.com/users/sergey-safarov/orgs","repos_url":"https://api.github.com/users/sergey-safarov/repos","events_url":"https://api.github.com/users/sergey-safarov/events{/privacy}","received_events_url":"https://api.github.com/users/sergey-safarov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-02T07:08:52Z","updated_at":"2018-02-02T07:12:50Z","author_association":"NONE","body":"Joan (@wohali)\r\nFirst i measured disk io operation when `tmpfs` mounted as volume inside container.\r\n```\r\n[root@node0 ~]# docker run --rm --read-only -it --mount type=tmpfs,destination=/opt/couchdb/data fedora:27 bash\r\n[root@c0ed791b0e7d /]# rm -f /workspace/* && time dd if=/dev/zero of=/opt/couchdb/data/test_container1.img bs=512 count=1000 oflag=dsync\r\n1000+0 records in\r\n1000+0 records out\r\n512000 bytes (512 kB, 500 KiB) copied, 0.00277375 s, 185 MB/s\r\n\r\nreal\t0m0.004s\r\nuser\t0m0.003s\r\nsys\t0m0.001s\r\n[root@c0ed791b0e7d /]# rm -f /workspace/* && time dd if=/dev/zero of=/opt/couchdb/data/test_container1.img bs=512 count=1000 oflag=dsync\r\n1000+0 records in\r\n1000+0 records out\r\n512000 bytes (512 kB, 500 KiB) copied, 0.00277794 s, 184 MB/s\r\n\r\nreal\t0m0.004s\r\nuser\t0m0.001s\r\nsys\t0m0.003s\r\n[root@c0ed791b0e7d /]# rm -f /workspace/* && time dd if=/dev/zero of=/opt/couchdb/data/test_container1.img bs=512 count=1000 oflag=dsync\r\n1000+0 records in\r\n1000+0 records out\r\n512000 bytes (512 kB, 500 KiB) copied, 0.00283199 s, 181 MB/s\r\n\r\nreal\t0m0.004s\r\nuser\t0m0.001s\r\nsys\t0m0.003s\r\n[root@c0ed791b0e7d /]# rm -f /workspace/* && time dd if=/dev/zero of=/opt/couchdb/data/test_container1.img bs=512 count=1000 oflag=dsync\r\n1000+0 records in\r\n1000+0 records out\r\n512000 bytes (512 kB, 500 KiB) copied, 0.00279983 s, 183 MB/s\r\n\r\nreal\t0m0.004s\r\nuser\t0m0.001s\r\nsys\t0m0.003s\r\n```\r\nThen i started couchdb container with mounter `tmpfs` as volume.  Added arg `--mount type=tmpfs,destination=/opt/couchdb/data`\r\n ```\r\ndocker run -t --rm=true --log-driver=none --network kazoo --name couchdb1 \\\r\n                 --hostname couchdb1.kazoo \\\r\n                 --ip 10.0.9.8 \\\r\n                 --ulimit nofile=999999 \\\r\n                 --mount type=tmpfs,destination=/opt/couchdb/data \\\r\n                 -v /etc/kazoo/couchdb/vm.args.node1:/opt/couchdb/etc/vm.args \\\r\n                 apache/couchdb:2.1.1\r\n```\r\n`vm.args` is same to default with added option `name`\r\n```\r\n[root@node0 ~]# docker exec -it couchdb1 cat /opt/couchdb/etc/vm.args\r\n# Licensed under the Apache License, Version 2.0 (the \"License\"); you may not\r\n# use this file except in compliance with the License. You may obtain a copy of\r\n# the License at\r\n#\r\n#   http://www.apache.org/licenses/LICENSE-2.0\r\n#\r\n# Unless required by applicable law or agreed to in writing, software\r\n# distributed under the License is distributed on an \"AS IS\" BASIS, WITHOUT\r\n# WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the\r\n# License for the specific language governing permissions and limitations under\r\n# the License.\r\n\r\n# Ensure that the Erlang VM listens on a known port\r\n-kernel inet_dist_listen_min 9100\r\n-kernel inet_dist_listen_max 9100\r\n\r\n# Tell kernel and SASL not to log anything\r\n-kernel error_logger silent\r\n-sasl sasl_error_logger false\r\n\r\n# Use kernel poll functionality if supported by emulator\r\n+K true\r\n\r\n# Start a pool of asynchronous IO threads\r\n+A 16\r\n\r\n# Comment this line out to enable the interactive Erlang shell on startup\r\n+Bd -noinput\r\n-setcookie monster\r\n-name couchdb@couchdb1.kazoo\r\n\r\n[root@node0 ~]# \r\n```\r\nNow disk layout inside container\r\n```\r\n[root@node0 ~]# docker exec -it couchdb1 df\r\nFilesystem                  1K-blocks     Used Available Use% Mounted on\r\noverlay                     268304384 76159032 192145352  29% /\r\ntmpfs                           65536        0     65536   0% /dev\r\ntmpfs                        65968072        0  65968072   0% /sys/fs/cgroup\r\n/dev/mapper/vgRAID10-root     2086912   157692   1929220   8% /etc/couchdb\r\n/dev/mapper/vgRAID10-docker 268304384 76159032 192145352  29% /etc/hosts\r\nshm                             65536        0     65536   0% /dev/shm\r\ntmpfs                        65968072       48  65968024   1% /opt/couchdb/data\r\ntmpfs                        65968072        0  65968072   0% /proc/scsi\r\ntmpfs                        65968072        0  65968072   0% /sys/firmware\r\n```\r\nHost total memory. Host have 128Gb of memory and used about 160 Mb of swap.\r\n```\r\ntop - 01:41:43 up 17 days, 15:46,  4 users,  load average: 1.78, 1.54, 0.87\r\nTasks: 900 total,   1 running, 283 sleeping,   0 stopped, 486 zombie\r\n%Cpu(s):  0.8 us,  0.8 sy,  0.0 ni, 98.3 id,  0.0 wa,  0.0 hi,  0.0 si,  0.0 st\r\nKiB Mem : 13193614+total, 12358560 free,  2934528 used, 11664305+buff/cache\r\nKiB Swap: 31457280+total, 31441177+free,   161036 used. 12743585+avail Mem \r\n\r\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                                \r\n 1332 root      20   0 1469936 452596   4084 S   6.3  0.3 587:28.21 beam.smp                                                                                                                               \r\n14915 root      20   0 1297128 295484   3928 S   5.6  0.2 510:51.97 beam.smp                                                                                                                               \r\n20715 root      20   0   54392   5120   3812 R   0.7  0.0   0:00.09 top\r\n```\r\nThen i started replication and after 5 hours i have folowing results.\r\nDisk layout inside couchdb container. CoucDB data size about 10Gb\r\n```\r\n[root@node0 ~]# docker exec -it couchdb1 df\r\nFilesystem                  1K-blocks     Used Available Use% Mounted on\r\noverlay                     268304384 76134184 192170200  29% /\r\ntmpfs                           65536        0     65536   0% /dev\r\ntmpfs                        65968072        0  65968072   0% /sys/fs/cgroup\r\n/dev/mapper/vgRAID10-root     2086912   157692   1929220   8% /etc/couchdb\r\n/dev/mapper/vgRAID10-docker 268304384 76134184 192170200  29% /etc/hosts\r\nshm                             65536        0     65536   0% /dev/shm\r\ntmpfs                        65968072 10083456  55884616  16% /opt/couchdb/data\r\ntmpfs                        65968072        0  65968072   0% /proc/scsi\r\ntmpfs                        65968072        0  65968072   0% /sys/firmware\r\n```\r\nHost memory usage. Swap usage not changed. All CouchDB data is located inside memory.\r\n```\r\ntop - 06:35:51 up 17 days, 20:40,  6 users,  load average: 1.03, 0.95, 0.82\r\nTasks: 938 total,   1 running, 322 sleeping,   0 stopped, 486 zombie\r\n%Cpu(s):  1.4 us,  1.1 sy,  0.0 ni, 97.2 id,  0.1 wa,  0.1 hi,  0.1 si,  0.0 st\r\nKiB Mem : 13193614+total, 87901344 free,  3644528 used, 40390272 buff/cache\r\nKiB Swap: 31457280+total, 31441177+free,   161036 used. 11659586+avail Mem \r\n\r\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                                                \r\n 5269 root      20   0   56704   5360   3876 R  11.8  0.0   0:00.03 top                                                                                                                                    \r\n14915 root      20   0 1315680 307456   5852 S  11.8  0.2 550:18.26 beam.smp                                                                                                                               \r\n 1332 root      20   0 1463408 452628   5444 S   5.9  0.3 615:53.69 beam.smp                                                                                                                               \r\n23036 root      20   0 1859228  63316  31484 S   5.9  0.0  30:43.66 dockerd \r\n```\r\nAfter 5 hours of replication to database located on memory disk (`tmpfs`) couchdb have following errors in log\r\n**Could not open shards** - total 2 error\r\n```\r\n2ea5274cd52c5bf0-201802/_local/75d3dc6ddfdfcae76e87a7acdfc5ed89 201 ok 42\r\nFeb 02 03:50:57 node0.docker.rcsnet.ru sh[28220]: [notice] 2018-02-02T03:50:57.866252Z couchdb@couchdb1.kazoo <0.357.0> -------- couch_replicator_scheduler: Job {\"75d3dc6ddfdfcae76e87a7acdfc5ed89\",\"+create_target\"} completed normally\r\nFeb 02 03:50:57 node0.docker.rcsnet.ru sh[28220]: [notice] 2018-02-02T03:50:57.866613Z couchdb@couchdb1.kazoo <0.22131.14> 8a931c0f9d 10.0.9.8:5984 10.0.9.8 undefined POST /_replicate 200 ok 2805\r\nFeb 02 03:50:57 node0.docker.rcsnet.ru sh[28220]: [notice] 2018-02-02T03:50:57.916222Z couchdb@couchdb1.kazoo <0.357.0> -------- couch_replicator_scheduler: Job {\"80f52a6352af0019a08ff5bf307e6192\",\"+create_target\"} started as <0.10587.13>\r\nFeb 02 03:50:59 node0.docker.rcsnet.ru sh[28220]: [error] 2018-02-02T03:50:59.599271Z couchdb@couchdb1.kazoo <0.14885.14> 4c046843ba Request to create N=3 DB but only 1 node(s)\r\nFeb 02 03:50:59 node0.docker.rcsnet.ru sh[28220]: [notice] 2018-02-02T03:50:59.629560Z couchdb@couchdb1.kazoo <0.14885.14> 4c046843ba 10.0.9.8:5984 10.0.9.8 undefined PUT /account%2f94%2f93%2f45d6587d8f195f1620b65b1eb063-201802/ 201 ok 32\r\nFeb 02 03:50:59 node0.docker.rcsnet.ru sh[28220]: [error] 2018-02-02T03:50:59.655204Z couchdb@couchdb1.kazoo <0.2117.13> -------- Could not open file ./data/shards/60000000-7fffffff/account/94/93/45d6587d8f195f1620b65b1eb063-201802.1517543459.couch: no such file or directory\r\nFeb 02 03:50:59 node0.docker.rcsnet.ru sh[28220]: [error] 2018-02-02T03:50:59.655216Z couchdb@couchdb1.kazoo <0.2121.13> -------- Could not open file ./data/shards/40000000-5fffffff/account/94/93/45d6587d8f195f1620b65b1eb063-201802.1517543459.couch: no such file or directory\r\nFeb 02 03:50:59 node0.docker.rcsnet.ru sh[28220]: [info] 2018-02-02T03:50:59.666163Z couchdb@couchdb1.kazoo <0.206.0> -------- open_result error {not_found,no_db_file} for shards/60000000-7fffffff/account/94/93/45d6587d8f195f1620b65b1eb063-201802.1517543459\r\nFeb 02 03:50:59 node0.docker.rcsnet.ru sh[28220]: [info] 2018-02-02T03:50:59.666210Z couchdb@couchdb1.kazoo <0.206.0> -------- open_result error {not_found,no_db_file} for shards/40000000-5fffffff/account/94/93/45d6587d8f195f1620b65b1eb063-201802.1517543459\r\nFeb 02 03:50:59 node0.docker.rcsnet.ru sh[28220]: [warning] 2018-02-02T03:50:59.666204Z couchdb@couchdb1.kazoo <0.2139.13> d9f2f7b03a creating missing database: shards/60000000-7fffffff/account/94/93/45d6587d8f195f1620b65b1eb063-201802.1517543459\r\nFeb 02 03:50:59 node0.docker.rcsnet.ru sh[28220]: [warning] 2018-02-02T03:50:59.666235Z couchdb@couchdb1.kazoo <0.2149.13> d9f2f7b03a creating missing database: shards/40000000-5fffffff/account/94/93/45d6587d8f195f1620b65b1eb063-201802.1517543459\r\nFeb 02 03:50:59 node0.docker.rcsnet.ru sh[28220]: [error] 2018-02-02T03:50:59.666644Z couchdb@couchdb1.kazoo <0.303.0> -------- mem3_shards tried to create shards/40000000-5fffffff/account/94/93/45d6587d8f195f1620b65b1eb063-201802.1517543459, got file_exists\r\nFeb 02 03:50:59 node0.docker.rcsnet.ru sh[28220]: [error] 2018-02-02T03:50:59.932281Z couchdb@couchdb1.kazoo <0.16410.7> -------- rexi_server: from: couchdb@couchdb1.kazoo(<0.16407.7>) mfa: fabric_rpc:all_docs/3 exit:timeout [{rexi,init_stream,1,[{file,\"src/rexi.erl\"},{line,256}]},{rexi,stream2,3,[{file,\"src/rexi.erl\"},{line,204}]},{fabric_rpc,view_cb,2,[{file,\"src/fabric_rpc.erl\"},{line,308}]},{couch_mrview,finish_fold,2,[{file,\"src/couch_mrview.erl\"},{line,642}]},{rexi_server,init_p,3,[{file,\"src/rexi_server.erl\"},{line,139}]}]\r\nFeb 02 03:50:59 node0.docker.rcsnet.ru sh[28220]: [error] 2018-02-02T03:50:59.932290Z couchdb@couchdb1.kazoo <0.16409.7> -------- rexi_server: from: couchdb@couchdb1.kazoo(<0.16407.7>) mfa: fabric_rpc:all_docs/3 exit:timeout [{rexi,init_stream,1,[{file,\"src/rexi.erl\"},{line,256}]},{rexi,stream2,3,[{file,\"src/rexi.erl\"},{line,204}]},{fabric_rpc,view_cb,2,[{file,\"src/fabric_rpc.erl\"},{line,308}]},{couch_mrview,finish_fold,2,[{file,\"src/couch_mrview.erl\"},{line,642}]},{rexi_server,init_p,3,[{file,\"src/rexi_server.erl\"},{line,139}]}]\r\n```\r\n**Replicator error. Cannot put document** - about 20 errors\r\n```\r\nFeb 02 04:04:51 node0.docker.rcsnet.ru sh[28220]: [error] 2018-02-02T04:04:51.673222Z couchdb@couchdb1.kazoo <0.8179.40> -------- rexi_server: from: couchdb@couchdb1.kazoo(<0.10464.36>) mfa: fabric_rpc:all_docs/3 exit:timeout [{rexi,init_stream,1,[{file,\"src/rexi.erl\"},{line,256}]},{rexi,stream2,3,[{file,\"src/rexi.erl\"},{line,204}]},{fabric_rpc,view_cb,2,[{file,\"src/fabric_rpc.erl\"},{line,308}]},{couch_mrview,finish_fold,2,[{file,\"src/couch_mrview.erl\"},{line,642}]},{rexi_server,init_p,3,[{file,\"src/rexi_server.erl\"},{line,139}]}]\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]: [error] 2018-02-02T04:04:55.012851Z couchdb@couchdb1.kazoo emulator -------- Error in process <0.10651.59> on node 'couchdb@couchdb1.kazoo' with exit value: {{nocatch,{mp_parser_died,noproc}},[{couch_att,'-foldl/4-fun-0-',3,[{file,\"src/couch_att.erl\"},{line,613}]},{couch_att,fold_streamed_data,4,[{file,\"src/couch_att.erl\"},{line,664}]},{couch_att,foldl,4,[{file,\"src/couch_att.erl\"},...\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]: [info] 2018-02-02T04:04:55.013064Z couchdb@couchdb1.kazoo <0.353.0> -------- Replication connection to: \"10.0.9.8\":5984 died with reason {{nocatch,{mp_parser_died,noproc}},[{couch_att,'-foldl/4-fun-0-',3,[{file,\"src/couch_att.erl\"},{line,613}]},{couch_att,fold_streamed_data,4,[{file,\"src/couch_att.erl\"},{line,664}]},{couch_att,foldl,4,[{file,\"src/couch_att.erl\"},{line,617}]},{couch_httpd_multipart,atts_to_mp,4,[{file,\"src/couch_httpd_multipart.erl\"},{line,208}]}]}\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]: [error] 2018-02-02T04:04:55.014366Z couchdb@couchdb1.kazoo <0.7570.55> 8967ff8316 req_err(4199105376) badmatch : ok\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]:     [<<\"chttpd_db:db_doc_req/3 L782\">>,<<\"chttpd:process_request/1 L295\">>,<<\"chttpd:handle_request_int/1 L231\">>,<<\"mochiweb_http:headers/6 L91\">>,<<\"proc_lib:init_p_do_apply/3 L237\">>]\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]: [notice] 2018-02-02T04:04:55.014881Z couchdb@couchdb1.kazoo <0.7570.55> 8967ff8316 10.0.9.8:5984 10.0.9.8 undefined PUT /account%2f0e%2fe2%2fb3fccd72d86299cf8f66f6caa6bd-201801/201801-b089783f4734b57244ea8b5613f8375a?new_edits=false 500 ok 2\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]: [error] 2018-02-02T04:04:55.015761Z couchdb@couchdb1.kazoo <0.5748.60> -------- Replicator, request PUT to \"http://10.0.9.8:5984/account%2f0e%2fe2%2fb3fccd72d86299cf8f66f6caa6bd-201801/201801-b089783f4734b57244ea8b5613f8375a?new_edits=false\" failed due to error {error,\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]:     {'EXIT',\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]:         {{{nocatch,{mp_parser_died,noproc}},\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]:           [{couch_att,'-foldl/4-fun-0-',3,\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]:                [{file,\"src/couch_att.erl\"},{line,613}]},\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]:            {couch_att,fold_streamed_data,4,\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]:                [{file,\"src/couch_att.erl\"},{line,664}]},\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]:            {couch_att,foldl,4,[{file,\"src/couch_att.erl\"},{line,617}]},\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]:            {couch_httpd_multipart,atts_to_mp,4,\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]:                [{file,\"src/couch_httpd_multipart.erl\"},{line,208}]}]},\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]:          {gen_server,call,\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]:              [<0.13476.55>,\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]:               {send_req,\r\nFeb 02 04:04:55 node0.docker.rcsnet.ru sh[28220]:                   {{url,\r\n```\r\nAbout replication error is important server IP `10.0.9.8`. This IP is assigned to destination CouchDB server.\r\n\r\nJoan (@wohali), I think issue not related to disk IO speed inside container. Test is made on RAM disk (`tmpfs`) with speed about 180 MB/s. That value is more greater then on real hard disk.\r\n ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362504677/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362628624","html_url":"https://github.com/apache/couchdb/issues/1140#issuecomment-362628624","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1140","id":362628624,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjYyODYyNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-02T16:08:42Z","updated_at":"2018-02-02T16:08:42Z","author_association":"MEMBER","body":"Your error log says: `{error,corrupted_data}`. Your on-disk data is corrupted.\r\n\r\nThis is not a CouchDB error. You should restore from backup.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362628624/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362628773","html_url":"https://github.com/apache/couchdb/issues/1119#issuecomment-362628773","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1119","id":362628773,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjYyODc3Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-02T16:09:14Z","updated_at":"2018-02-02T16:09:14Z","author_association":"MEMBER","body":"OK, then I do not know. Someone else will have to help you.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362628773/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362903540","html_url":"https://github.com/apache/couchdb/issues/1133#issuecomment-362903540","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1133","id":362903540,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjkwMzU0MA==","user":{"login":"Crispy1975","id":12525875,"node_id":"MDQ6VXNlcjEyNTI1ODc1","avatar_url":"https://avatars.githubusercontent.com/u/12525875?v=4","gravatar_id":"","url":"https://api.github.com/users/Crispy1975","html_url":"https://github.com/Crispy1975","followers_url":"https://api.github.com/users/Crispy1975/followers","following_url":"https://api.github.com/users/Crispy1975/following{/other_user}","gists_url":"https://api.github.com/users/Crispy1975/gists{/gist_id}","starred_url":"https://api.github.com/users/Crispy1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Crispy1975/subscriptions","organizations_url":"https://api.github.com/users/Crispy1975/orgs","repos_url":"https://api.github.com/users/Crispy1975/repos","events_url":"https://api.github.com/users/Crispy1975/events{/privacy}","received_events_url":"https://api.github.com/users/Crispy1975/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-04T12:35:09Z","updated_at":"2018-02-04T12:35:09Z","author_association":"NONE","body":"I would like to add to this issue, I am seeing the exact same issues, however I am running CouchDB 2.1.1 on Debian Jessie, as installed by the Apache repo at: [https://apache.bintray.com/couchdb-deb](https://apache.bintray.com/couchdb-deb)\r\n\r\nThe full version is: ` 2.1.1-1~jessie`\r\n\r\nWhen views are created either via an application or via Fauxton this results in the following log:\r\n\r\n```\r\n[info] 2018-02-04T12:22:49.560045Z couchdb@127.0.0.1 <0.211.0> -------- couch_proc_manager <0.3865.0> died normal\r\n[error] 2018-02-04T12:22:49.560146Z couchdb@127.0.0.1 <0.3195.0> -------- OS Process Error <0.3865.0> :: {os_process_error,\"OS process timed out.\"}\r\n[info] 2018-02-04T12:22:54.575971Z couchdb@127.0.0.1 <0.211.0> -------- couch_proc_manager <0.4000.0> died normal\r\n[error] 2018-02-04T12:22:54.576041Z couchdb@127.0.0.1 <0.3195.0> -------- OS Process Error <0.4000.0> :: {os_process_error,\"OS process timed out.\"}\r\n[info] 2018-02-04T12:22:59.595031Z couchdb@127.0.0.1 <0.211.0> -------- couch_proc_manager <0.4087.0> died normal\r\n[error] 2018-02-04T12:22:59.595142Z couchdb@127.0.0.1 <0.3195.0> -------- OS Process Error <0.4087.0> :: {os_process_error,\"OS process timed out.\"}\r\n[info] 2018-02-04T12:23:04.614970Z couchdb@127.0.0.1 <0.211.0> -------- couch_proc_manager <0.4175.0> died normal\r\n[error] 2018-02-04T12:23:04.615046Z couchdb@127.0.0.1 <0.3195.0> -------- OS Process Error <0.4175.0> :: {os_process_error,\"OS process timed out.\"}\r\n[error] 2018-02-04T12:23:09.530943Z couchdb@127.0.0.1 <0.3193.0> -------- fabric_worker_timeout update_docs,'couchdb@127.0.0.1',<<\"shards/80000000-9fffffff/test_accounts.1517357717\">>\r\n[notice] 2018-02-04T12:23:09.531226Z couchdb@127.0.0.1 <0.842.0> ab6dbafccb 127.0.0.1:59840 127.0.0.1 undefined PUT /test_accounts/_design/accounts 500 ok 60005\r\n[info] 2018-02-04T12:23:09.633011Z couchdb@127.0.0.1 <0.211.0> -------- couch_proc_manager <0.4262.0> died normal\r\n[error] 2018-02-04T12:23:09.633083Z couchdb@127.0.0.1 <0.3195.0> -------- OS Process Error <0.4262.0> :: {os_process_error,\"OS process timed out.\"}\r\n[info] 2018-02-04T12:23:14.654966Z couchdb@127.0.0.1 <0.211.0> -------- couch_proc_manager <0.4341.0> died normal\r\n[error] 2018-02-04T12:23:14.655034Z couchdb@127.0.0.1 <0.3195.0> -------- OS Process Error <0.4341.0> :: {os_process_error,\"OS process timed out.\"}\r\n[info] 2018-02-04T12:23:19.672990Z couchdb@127.0.0.1 <0.211.0> -------- couch_proc_manager <0.4428.0> died normal\r\n[error] 2018-02-04T12:23:19.673073Z couchdb@127.0.0.1 <0.3195.0> -------- OS Process Error <0.4428.0> :: {os_process_error,\"OS process timed out.\"}\r\n```\r\n\r\nThis results in processes spawning infinitely until CPU is used up and the machine grinds to a halt. Interestingly I also have a manual install of CouchDB 2.1.0-05d2e1e which does not suffer from this issue.\r\n\r\nI feel like this is very similar to what is happening on the macOS version.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362903540/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362927191","html_url":"https://github.com/apache/couchdb/issues/1133#issuecomment-362927191","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1133","id":362927191,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjkyNzE5MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-04T18:16:06Z","updated_at":"2018-02-04T18:16:06Z","author_association":"MEMBER","body":"@Crispy1975 It's not.\r\n\r\nThe macOS bug is specifically related to a missing shared library, which was added in the 2.1.1.1 download. People were able to work around it successfully by installing the shared library using the `brew` tool on their own.\r\n\r\nYour issue is that the view is taking too long to calculate. The default amount of time to wait for the external process is 5 seconds. That error, `{os_process_error,\"OS process timed out.\"}` doesn't say the process couldn't run at all.\r\n\r\nTry increasing the `[couchdb] os_process_timeout` value in your `local.ini` file to `10000` or higher. The value is in milliseconds.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362927191/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362936567","html_url":"https://github.com/apache/couchdb/issues/1133#issuecomment-362936567","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1133","id":362936567,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjkzNjU2Nw==","user":{"login":"Crispy1975","id":12525875,"node_id":"MDQ6VXNlcjEyNTI1ODc1","avatar_url":"https://avatars.githubusercontent.com/u/12525875?v=4","gravatar_id":"","url":"https://api.github.com/users/Crispy1975","html_url":"https://github.com/Crispy1975","followers_url":"https://api.github.com/users/Crispy1975/followers","following_url":"https://api.github.com/users/Crispy1975/following{/other_user}","gists_url":"https://api.github.com/users/Crispy1975/gists{/gist_id}","starred_url":"https://api.github.com/users/Crispy1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Crispy1975/subscriptions","organizations_url":"https://api.github.com/users/Crispy1975/orgs","repos_url":"https://api.github.com/users/Crispy1975/repos","events_url":"https://api.github.com/users/Crispy1975/events{/privacy}","received_events_url":"https://api.github.com/users/Crispy1975/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-04T20:24:49Z","updated_at":"2018-02-04T20:24:49Z","author_association":"NONE","body":"Many thanks for the reply @wohali I tried increasing the timeout value but to no avail. The DB is tiny, only 14 documents and 3 views. It's really odd that the error is triggering for such a small DB. As mentioned on a local machine with 2.1.0 (manual install) there are no issues. Are there any other areas I should perhaps investigate? Never had this error in the past.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362936567/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362937340","html_url":"https://github.com/apache/couchdb/issues/1133#issuecomment-362937340","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1133","id":362937340,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjkzNzM0MA==","user":{"login":"Crispy1975","id":12525875,"node_id":"MDQ6VXNlcjEyNTI1ODc1","avatar_url":"https://avatars.githubusercontent.com/u/12525875?v=4","gravatar_id":"","url":"https://api.github.com/users/Crispy1975","html_url":"https://github.com/Crispy1975","followers_url":"https://api.github.com/users/Crispy1975/followers","following_url":"https://api.github.com/users/Crispy1975/following{/other_user}","gists_url":"https://api.github.com/users/Crispy1975/gists{/gist_id}","starred_url":"https://api.github.com/users/Crispy1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Crispy1975/subscriptions","organizations_url":"https://api.github.com/users/Crispy1975/orgs","repos_url":"https://api.github.com/users/Crispy1975/repos","events_url":"https://api.github.com/users/Crispy1975/events{/privacy}","received_events_url":"https://api.github.com/users/Crispy1975/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-04T20:34:57Z","updated_at":"2018-02-04T20:34:57Z","author_association":"NONE","body":"With the logs I then get what seems to be an infinite amount of processes spawning and taking up CPU time...\r\n\r\n```\r\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND   \r\n22711 couchdb   20   0  107340   4748   3236 R  62.1  0.0   0:05.39 ./bin/couchjs ./share/server/main.js                                                                                                          \r\n22726 couchdb   20   0  108364   4752   3240 R  61.4  0.0   0:02.78 ./bin/couchjs ./share/server/main.js                                                                                                          \r\n22618 couchdb   20   0  107344   4752   3236 R  58.0  0.0   0:29.20 ./bin/couchjs ./share/server/main.js                                                                                                          \r\n22621 couchdb   20   0  108364   4752   3236 R  58.0  0.0   0:24.80 ./bin/couchjs ./share/server/main.js                                                                                                          \r\n22629 couchdb   20   0  108364   4748   3232 R  58.0  0.0   0:19.61 ./bin/couchjs ./share/server/main.js                                                                                                          \r\n22628 couchdb   20   0  107344   4748   3236 R  56.7  0.0   0:19.30 ./bin/couchjs ./share/server/main.js                                                                                                          \r\n22622 couchdb   20   0  107348   4748   3232 R  56.0  0.0   0:24.52 ./bin/couchjs ./share/server/main.js                                                                                                          \r\n22654 couchdb   20   0  107344   4756   3236 R  56.0  0.0   0:14.07 ./bin/couchjs ./share/server/main.js                                                                                                          \r\n22727 couchdb   20   0  106316   4744   3236 R  56.0  0.0   0:02.39 ./bin/couchjs ./share/server/main.js                                                                                                          \r\n22617 couchdb   20   0  106316   4748   3232 R  54.7  0.0   0:29.46 ./bin/couchjs ./share/server/main.js                                                                                                          \r\n22695 couchdb   20   0  107340   4744   3236 R  54.0  0.0   0:09.09 ./bin/couchjs ./share/server/main.js                                                                                                          \r\n22696 couchdb   20   0  108368   4748   3236 R  52.6  0.0   0:09.24 ./bin/couchjs ./share/server/main.js                                                                                                          \r\n22710 couchdb   20   0  108364   4752   3240 R  52.0  0.0   0:05.35 ./bin/couchjs ./share/server/main.js\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362937340/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362938186","html_url":"https://github.com/apache/couchdb/issues/1133#issuecomment-362938186","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1133","id":362938186,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MjkzODE4Ng==","user":{"login":"Crispy1975","id":12525875,"node_id":"MDQ6VXNlcjEyNTI1ODc1","avatar_url":"https://avatars.githubusercontent.com/u/12525875?v=4","gravatar_id":"","url":"https://api.github.com/users/Crispy1975","html_url":"https://github.com/Crispy1975","followers_url":"https://api.github.com/users/Crispy1975/followers","following_url":"https://api.github.com/users/Crispy1975/following{/other_user}","gists_url":"https://api.github.com/users/Crispy1975/gists{/gist_id}","starred_url":"https://api.github.com/users/Crispy1975/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Crispy1975/subscriptions","organizations_url":"https://api.github.com/users/Crispy1975/orgs","repos_url":"https://api.github.com/users/Crispy1975/repos","events_url":"https://api.github.com/users/Crispy1975/events{/privacy}","received_events_url":"https://api.github.com/users/Crispy1975/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-04T20:46:33Z","updated_at":"2018-02-04T20:46:33Z","author_association":"NONE","body":"Even the view check from the verify installation option causes the timeout. Might need to roll back to 2.1.0, but would prefer to use the latest version.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362938186/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362943276","html_url":"https://github.com/apache/couchdb/issues/1097#issuecomment-362943276","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1097","id":362943276,"node_id":"MDEyOklzc3VlQ29tbWVudDM2Mjk0MzI3Ng==","user":{"login":"jvegaseg","id":12508470,"node_id":"MDQ6VXNlcjEyNTA4NDcw","avatar_url":"https://avatars.githubusercontent.com/u/12508470?v=4","gravatar_id":"","url":"https://api.github.com/users/jvegaseg","html_url":"https://github.com/jvegaseg","followers_url":"https://api.github.com/users/jvegaseg/followers","following_url":"https://api.github.com/users/jvegaseg/following{/other_user}","gists_url":"https://api.github.com/users/jvegaseg/gists{/gist_id}","starred_url":"https://api.github.com/users/jvegaseg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jvegaseg/subscriptions","organizations_url":"https://api.github.com/users/jvegaseg/orgs","repos_url":"https://api.github.com/users/jvegaseg/repos","events_url":"https://api.github.com/users/jvegaseg/events{/privacy}","received_events_url":"https://api.github.com/users/jvegaseg/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-04T21:56:16Z","updated_at":"2018-02-04T21:57:00Z","author_association":"NONE","body":"Output of top command:\r\n\r\n```\r\ntop - 22:56:47 up 18 days, 19 min,  1 user,  load average: 0,07, 0,12, 0,08\r\nTasks:  37 total,   1 running,  36 sleeping,   0 stopped,   0 zombie\r\n%Cpu(s):  0,2 us,  0,1 sy,  0,0 ni, 99,7 id,  0,0 wa,  0,0 hi,  0,0 si,  0,0 st\r\nKiB Mem : 41943040 total,      280 free,   310608 used, 41632152 buff/cache\r\nKiB Swap:  5242880 total,  5195448 free,    47432 used. 38364196 avail Mem \r\n\r\n  PID USER      PR  NI    VIRT    RES    SHR S  %CPU %MEM     TIME+ COMMAND                                                                                                               \r\n 9441 couchdb   20   0 2757588 286632   2996 S   6,0  0,7   2878:49 beam.smp                                                                                                              \r\n24889 root      20   0  141660   5436   4176 S   0,0  0,0   0:00.06 sshd                                                                                                                  \r\n  940 root      20   0  533404   5040   1676 S   0,0  0,0   7:37.06 fail2ban-server                                                                                                       \r\n   79 root      20   0   45020   4524   4392 S   0,0  0,0   0:02.30 systemd-journal                                                                                                       \r\n  859 root      20   0  221880   4380   2720 S   0,0  0,0   0:41.31 httpd                                                                                                                 \r\n  109 root      20   0  234436   2844   2000 S   0,0  0,0   0:01.91 firewalld                                                                                                             \r\n17431 apache    20   0  221880   2744   1080 S   0,0  0,0   0:00.00 httpd                                                                                                                 \r\n    1 root      20   0   43132   2732   1868 S   0,0  0,0   0:54.24 systemd                                                                                                               \r\n24891 root      20   0  115392   2052   1612 S   0,0  0,0   0:00.00 bash                                                                                                                  \r\n24906 root      20   0  155488   2048   1472 R   0,0  0,0   0:00.31 top                                                                                                                   \r\n  105 root      20   0  253080   1964   1660 S   0,0  0,0   0:37.13 rsyslogd                                                                                                              \r\n  892 zabbix    20   0   83808   1668   1572 S   0,0  0,0   4:41.93 zabbix_agentd                                                                                                         \r\n  858 root      20   0  105996   1460   1360 S   0,0  0,0   0:00.01 sshd                                                                                                                  \r\n  110 root      20   0   24204   1372   1224 S   0,0  0,0   0:17.42 systemd-logind                                                                                                        \r\n 9486 couchdb   20   0    9516   1288   1084 S   0,0  0,0   0:00.27 sh                                                                                                                    \r\n  106 dbus      20   0   24412   1264   1076 S   0,0  0,0   0:36.32 dbus-daemon                                                                                                           \r\n  896 zabbix    20   0   84228   1212    980 S   0,0  0,0   2:14.52 zabbix_agentd                                                                                                         \r\n  893 zabbix    20   0   83932   1172   1040 S   0,0  0,0   1:50.20 zabbix_agentd                                                                                                         \r\n  894 zabbix    20   0   83932   1172   1040 S   0,0  0,0   1:48.44 zabbix_agentd                                                                                                         \r\n  895 zabbix    20   0   83932   1172   1040 S   0,0  0,0   1:49.75 zabbix_agentd                                                                                                         \r\n  115 root      20   0   22648    928    828 S   0,0  0,0   0:01.34 crond                                                                                                                 \r\n   94 root      20   0   41412    864    860 S   0,0  0,0   0:00.00 systemd-udevd                                                                                                         \r\n  885 root      20   0   88684    824    648 S   0,0  0,0   0:26.71 sendmail                                                                                                              \r\n  111 root      20   0    6456    624    620 S   0,0  0,0   0:00.00 agetty                                                                                                                \r\n  112 root      20   0    6456    624    620 S   0,0  0,0   0:00.00 agetty                                                                                                                \r\n 9487 couchdb   20   0    4300    596    500 S   0,0  0,0   0:03.36 memsup                                                                                                                \r\n  918 smmsp     20   0   84124    560    424 S   0,0  0,0   0:00.27 sendmail                                                                                                              \r\n  890 zabbix    20   0   83808    420    384 S   0,0  0,0   0:00.00 zabbix_agentd                                                                                                         \r\n 9490 couchdb   20   0   11544    384    284 S   0,0  0,0   0:00.00 inet_gethost                                                                                                          \r\n 9491 couchdb   20   0   11544    368    240 S   0,0  0,0   0:00.00 inet_gethost                                                                                                          \r\n 9488 couchdb   20   0    4300    344    268 S   0,0  0,0   0:00.00 cpu_sup                                                                                                               \r\n  863 root      20   0   24992    236    236 S   0,0  0,0   0:00.00 xinetd                                                                                                                \r\n 9449 couchdb   20   0   11580    212    196 S   0,0  0,0   0:07.18 epmd                                                                                                                  \r\n  117 root      20   0   71788    204    200 S   0,0  0,0   0:00.00 saslauthd   \r\n```\r\n\r\nYes, database has only documents with attachments. I do not see replication errors mentioned in apache/couchdb#745. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362943276/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362956397","html_url":"https://github.com/apache/couchdb/issues/1133#issuecomment-362956397","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1133","id":362956397,"node_id":"MDEyOklzc3VlQ29tbWVudDM2Mjk1NjM5Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-05T01:05:19Z","updated_at":"2018-02-05T01:05:19Z","author_association":"MEMBER","body":"Try running `couchjs` by hand and see if it works. You can also try `ldd /path/to/couchjs` and validate that all of the shared libraries are installed correctly.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/362956397/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/363143122","html_url":"https://github.com/apache/couchdb/issues/820#issuecomment-363143122","issue_url":"https://api.github.com/repos/apache/couchdb/issues/820","id":363143122,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MzE0MzEyMg==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-05T16:42:47Z","updated_at":"2018-02-05T16:42:47Z","author_association":"CONTRIBUTOR","body":"This introduces a problem with API consistency. Because the response schema changes depending on what is POSTed. This makes it quite hard to interact with from static type languages.\r\nIt is unfortunate we merged it already. @wohali is it really needed? If so would you be ok if we move the implementation to separate endpoint? ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/363143122/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/363172286","html_url":"https://github.com/apache/couchdb/issues/1103#issuecomment-363172286","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1103","id":363172286,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MzE3MjI4Ng==","user":{"login":"ericclack","id":903568,"node_id":"MDQ6VXNlcjkwMzU2OA==","avatar_url":"https://avatars.githubusercontent.com/u/903568?v=4","gravatar_id":"","url":"https://api.github.com/users/ericclack","html_url":"https://github.com/ericclack","followers_url":"https://api.github.com/users/ericclack/followers","following_url":"https://api.github.com/users/ericclack/following{/other_user}","gists_url":"https://api.github.com/users/ericclack/gists{/gist_id}","starred_url":"https://api.github.com/users/ericclack/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ericclack/subscriptions","organizations_url":"https://api.github.com/users/ericclack/orgs","repos_url":"https://api.github.com/users/ericclack/repos","events_url":"https://api.github.com/users/ericclack/events{/privacy}","received_events_url":"https://api.github.com/users/ericclack/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-05T18:16:38Z","updated_at":"2018-02-05T18:16:38Z","author_association":"NONE","body":"A progress update: I've tried the Erlang version from the Debian Stretch repo and then installing CouchDB from source and all seems to work well, so perhaps there is a problem with the Erlang package from Erlang Solutions repository?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/363172286/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/363205174","html_url":"https://github.com/apache/couchdb/issues/831#issuecomment-363205174","issue_url":"https://api.github.com/repos/apache/couchdb/issues/831","id":363205174,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MzIwNTE3NA==","user":{"login":"igorski89","id":56879,"node_id":"MDQ6VXNlcjU2ODc5","avatar_url":"https://avatars.githubusercontent.com/u/56879?v=4","gravatar_id":"","url":"https://api.github.com/users/igorski89","html_url":"https://github.com/igorski89","followers_url":"https://api.github.com/users/igorski89/followers","following_url":"https://api.github.com/users/igorski89/following{/other_user}","gists_url":"https://api.github.com/users/igorski89/gists{/gist_id}","starred_url":"https://api.github.com/users/igorski89/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/igorski89/subscriptions","organizations_url":"https://api.github.com/users/igorski89/orgs","repos_url":"https://api.github.com/users/igorski89/repos","events_url":"https://api.github.com/users/igorski89/events{/privacy}","received_events_url":"https://api.github.com/users/igorski89/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-05T20:05:54Z","updated_at":"2018-02-06T08:15:20Z","author_association":"NONE","body":"@nickva is theoretically possible to speed-up selectors passed in replicator to use indexes? I have the same issue as @redgeoff posted and rewriting my map functions as mango selectors. Since the map functions often time written somethine like:\r\n```js\r\nfunction (doc) {\r\n   if (doc.type == 'foo' && doc.safe && ...) {\r\n      emit(...)\r\n   } \r\n}\r\n```\r\nusing partial indexes would make a lot of sense overall.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/363205174/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/363307312","html_url":"https://github.com/apache/couchdb/issues/820#issuecomment-363307312","issue_url":"https://api.github.com/repos/apache/couchdb/issues/820","id":363307312,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MzMwNzMxMg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-06T04:27:42Z","updated_at":"2018-02-06T04:27:42Z","author_association":"MEMBER","body":"@iilyak Go ahead and move it, we haven't released it yet.\r\n\r\nIf you move it, you're responsible for fixing the docs :)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/363307312/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/363308685","html_url":"https://github.com/apache/couchdb/issues/820#issuecomment-363308685","issue_url":"https://api.github.com/repos/apache/couchdb/issues/820","id":363308685,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MzMwODY4NQ==","user":{"login":"jiangphcn","id":18000622,"node_id":"MDQ6VXNlcjE4MDAwNjIy","avatar_url":"https://avatars.githubusercontent.com/u/18000622?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangphcn","html_url":"https://github.com/jiangphcn","followers_url":"https://api.github.com/users/jiangphcn/followers","following_url":"https://api.github.com/users/jiangphcn/following{/other_user}","gists_url":"https://api.github.com/users/jiangphcn/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangphcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangphcn/subscriptions","organizations_url":"https://api.github.com/users/jiangphcn/orgs","repos_url":"https://api.github.com/users/jiangphcn/repos","events_url":"https://api.github.com/users/jiangphcn/events{/privacy}","received_events_url":"https://api.github.com/users/jiangphcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-06T04:38:38Z","updated_at":"2018-02-06T04:38:38Z","author_association":"CONTRIBUTOR","body":"@wohali thanks for response. I will take care of codes and docs.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/363308685/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/363455322","html_url":"https://github.com/apache/couchdb/issues/820#issuecomment-363455322","issue_url":"https://api.github.com/repos/apache/couchdb/issues/820","id":363455322,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MzQ1NTMyMg==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-06T15:21:48Z","updated_at":"2018-02-06T15:21:48Z","author_association":"CONTRIBUTOR","body":"Thank you @wohali ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/363455322/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/363460739","html_url":"https://github.com/apache/couchdb/issues/820#issuecomment-363460739","issue_url":"https://api.github.com/repos/apache/couchdb/issues/820","id":363460739,"node_id":"MDEyOklzc3VlQ29tbWVudDM2MzQ2MDczOQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-02-06T15:37:40Z","updated_at":"2018-02-06T15:37:40Z","author_association":"CONTRIBUTOR","body":"@ricellis Which one is preferable in terms of support in libraries and OpenAPI Specification:\r\n- `_all_docs/_query` / `_desing_docs/_query` / `_local_docs/_query`\r\n- `_all_docs_query` / `_desing_docs_query` / `_local_docs_query` ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/363460739/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]