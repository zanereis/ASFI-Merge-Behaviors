[{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2265804762","html_url":"https://github.com/apache/brpc/issues/2694#issuecomment-2265804762","issue_url":"https://api.github.com/repos/apache/brpc/issues/2694","id":2265804762,"node_id":"IC_kwDOBhmkcs6HDW_a","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-02T17:02:05Z","updated_at":"2024-08-02T17:02:05Z","author_association":"CONTRIBUTOR","body":"https://brpc.apache.org/zh/docs/builtin-services/cpu_profiler/#%E7%81%AB%E7%84%B0%E5%9B%BE\r\n\r\n设置好[FlameGraph](https://github.com/brendangregg/FlameGraph)路径后，在cpu内置服务可以选择火焰图展示profile结果。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2265804762/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2266450556","html_url":"https://github.com/apache/brpc/issues/2721#issuecomment-2266450556","issue_url":"https://api.github.com/repos/apache/brpc/issues/2721","id":2266450556,"node_id":"IC_kwDOBhmkcs6HF0p8","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-03T06:06:29Z","updated_at":"2024-08-03T06:07:13Z","author_association":"CONTRIBUTOR","body":"> I am currently trying to add a patch in vcpkg to remove the override keyword from those two functions, and I would like to confirm with you if this is a feasible solution.\r\n\r\nIt is best to refer to #2722 .","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2266450556/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267290639","html_url":"https://github.com/apache/brpc/issues/2668#issuecomment-2267290639","issue_url":"https://api.github.com/repos/apache/brpc/issues/2668","id":2267290639,"node_id":"IC_kwDOBhmkcs6HJBwP","user":{"login":"GreateCode","id":9795716,"node_id":"MDQ6VXNlcjk3OTU3MTY=","avatar_url":"https://avatars.githubusercontent.com/u/9795716?v=4","gravatar_id":"","url":"https://api.github.com/users/GreateCode","html_url":"https://github.com/GreateCode","followers_url":"https://api.github.com/users/GreateCode/followers","following_url":"https://api.github.com/users/GreateCode/following{/other_user}","gists_url":"https://api.github.com/users/GreateCode/gists{/gist_id}","starred_url":"https://api.github.com/users/GreateCode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GreateCode/subscriptions","organizations_url":"https://api.github.com/users/GreateCode/orgs","repos_url":"https://api.github.com/users/GreateCode/repos","events_url":"https://api.github.com/users/GreateCode/events{/privacy}","received_events_url":"https://api.github.com/users/GreateCode/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-04T04:01:01Z","updated_at":"2024-08-04T04:01:01Z","author_association":"CONTRIBUTOR","body":"> 容灾方面是不是可以全面一点？ （周期或者滑动窗口）统计请求的成功率，根据成功率可以做以下策略：\r\n> \r\n> 1. lb选实例时，减少访问可用性弱的实例；\r\n> 2. 减少重试（包括backup request）。\r\n> 3. 其他，待补充。\r\n\r\n1. lb可以参考现有的la或者通过LoadBalancerExtension()->RegisterOrDie(\"namexxxx\", new LBXXX)自定义新的。\r\n2. 但减少重试是个lazy行为，一开始发起A、B、C请求都配上backup_request，到backup_request_ms后，A已完成，只有B、C需要backup_request，假如此时只允许50%触发backup_request。就得在HandleBackupRequest里一开始拦截一下，避免触发EBACKUPREQUEST。这个feature需要支持下。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267290639/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267352667","html_url":"https://github.com/apache/brpc/issues/2668#issuecomment-2267352667","issue_url":"https://api.github.com/repos/apache/brpc/issues/2668","id":2267352667,"node_id":"IC_kwDOBhmkcs6HJQ5b","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-04T05:45:51Z","updated_at":"2024-08-04T05:45:51Z","author_association":"CONTRIBUTOR","body":"> 在HandleBackupRequest里一开始拦截一下，避免触发EBACKUPREQUEST。\r\n\r\n需要这么及时地拦截吗？\r\n\r\nChannelOptions支持一个backup_request_policy，支持动态backup_request时间，这样处理起来更统一，更能满足多样的需求吧。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267352667/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267358299","html_url":"https://github.com/apache/brpc/issues/2668#issuecomment-2267358299","issue_url":"https://api.github.com/repos/apache/brpc/issues/2668","id":2267358299,"node_id":"IC_kwDOBhmkcs6HJSRb","user":{"login":"GreateCode","id":9795716,"node_id":"MDQ6VXNlcjk3OTU3MTY=","avatar_url":"https://avatars.githubusercontent.com/u/9795716?v=4","gravatar_id":"","url":"https://api.github.com/users/GreateCode","html_url":"https://github.com/GreateCode","followers_url":"https://api.github.com/users/GreateCode/followers","following_url":"https://api.github.com/users/GreateCode/following{/other_user}","gists_url":"https://api.github.com/users/GreateCode/gists{/gist_id}","starred_url":"https://api.github.com/users/GreateCode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GreateCode/subscriptions","organizations_url":"https://api.github.com/users/GreateCode/orgs","repos_url":"https://api.github.com/users/GreateCode/repos","events_url":"https://api.github.com/users/GreateCode/events{/privacy}","received_events_url":"https://api.github.com/users/GreateCode/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-04T06:05:07Z","updated_at":"2024-08-04T06:05:43Z","author_association":"CONTRIBUTOR","body":"不在HandleBackupRequest里及时拦截的话，backup_request就发给下游server了，可能造成单server请求暴增。\r\n\r\nChannelOptions加backup_request_policy，是打散backup_request_ms吗？现在controller就可以设置请求粒度的backup_request_ms。而且 **backup_request最好是在< backup_request_ms内没响应的多个请求中选择触发某几个**。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267358299/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267410794","html_url":"https://github.com/apache/brpc/issues/2668#issuecomment-2267410794","issue_url":"https://api.github.com/repos/apache/brpc/issues/2668","id":2267410794,"node_id":"IC_kwDOBhmkcs6HJfFq","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-04T07:58:21Z","updated_at":"2024-08-04T07:58:21Z","author_association":"CONTRIBUTOR","body":"拦截是基于什么指标呢？这个指标不灵敏的话，在HandleBackupRequest或者backup_request_policy拦截，差别不大吧。\r\n\r\ncontroller设置backup_request_policy也是请求粒度的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267410794/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267428872","html_url":"https://github.com/apache/brpc/issues/2668#issuecomment-2267428872","issue_url":"https://api.github.com/repos/apache/brpc/issues/2668","id":2267428872,"node_id":"IC_kwDOBhmkcs6HJjgI","user":{"login":"GreateCode","id":9795716,"node_id":"MDQ6VXNlcjk3OTU3MTY=","avatar_url":"https://avatars.githubusercontent.com/u/9795716?v=4","gravatar_id":"","url":"https://api.github.com/users/GreateCode","html_url":"https://github.com/GreateCode","followers_url":"https://api.github.com/users/GreateCode/followers","following_url":"https://api.github.com/users/GreateCode/following{/other_user}","gists_url":"https://api.github.com/users/GreateCode/gists{/gist_id}","starred_url":"https://api.github.com/users/GreateCode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GreateCode/subscriptions","organizations_url":"https://api.github.com/users/GreateCode/orgs","repos_url":"https://api.github.com/users/GreateCode/repos","events_url":"https://api.github.com/users/GreateCode/events{/privacy}","received_events_url":"https://api.github.com/users/GreateCode/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-04T08:30:37Z","updated_at":"2024-08-04T08:32:50Z","author_association":"CONTRIBUTOR","body":"最简单的可以是允许backup_request_ms时未响应request做随机拦截，随机数可以做到，比如未响应请求里面只允许10%做去做backup_request。或者按请求优先级，这个先忽略。\r\n\r\n因为一开始发请求时，哪些请求在backup_request_ms未响应是未知的，所以都controller set_backup_request_policy，等backup_request_ms时间到了，此时怎么做10%真正触发backup_request呢？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267428872/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267450615","html_url":"https://github.com/apache/brpc/issues/2668#issuecomment-2267450615","issue_url":"https://api.github.com/repos/apache/brpc/issues/2668","id":2267450615,"node_id":"IC_kwDOBhmkcs6HJoz3","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-04T09:10:48Z","updated_at":"2024-08-04T09:11:19Z","author_association":"CONTRIBUTOR","body":"嗯嗯，理解这个场景了。其实跟RetryPolicy一样，让用户决定是否要继续发请求。\r\n\r\n或许backup_request_policy可以都支持：\r\n1. 支持动态timeout；\r\n2. 支持在HandleBackupRequest拦截。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267450615/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267458757","html_url":"https://github.com/apache/brpc/issues/2668#issuecomment-2267458757","issue_url":"https://api.github.com/repos/apache/brpc/issues/2668","id":2267458757,"node_id":"IC_kwDOBhmkcs6HJqzF","user":{"login":"GreateCode","id":9795716,"node_id":"MDQ6VXNlcjk3OTU3MTY=","avatar_url":"https://avatars.githubusercontent.com/u/9795716?v=4","gravatar_id":"","url":"https://api.github.com/users/GreateCode","html_url":"https://github.com/GreateCode","followers_url":"https://api.github.com/users/GreateCode/followers","following_url":"https://api.github.com/users/GreateCode/following{/other_user}","gists_url":"https://api.github.com/users/GreateCode/gists{/gist_id}","starred_url":"https://api.github.com/users/GreateCode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GreateCode/subscriptions","organizations_url":"https://api.github.com/users/GreateCode/orgs","repos_url":"https://api.github.com/users/GreateCode/repos","events_url":"https://api.github.com/users/GreateCode/events{/privacy}","received_events_url":"https://api.github.com/users/GreateCode/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-04T09:26:23Z","updated_at":"2024-08-04T09:26:23Z","author_association":"CONTRIBUTOR","body":"下周能提个pr吗，我们想用~~","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267458757/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267561473","html_url":"https://github.com/apache/brpc/issues/2668#issuecomment-2267561473","issue_url":"https://api.github.com/repos/apache/brpc/issues/2668","id":2267561473,"node_id":"IC_kwDOBhmkcs6HKD4B","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-04T14:22:47Z","updated_at":"2024-08-04T14:22:47Z","author_association":"CONTRIBUTOR","body":"我下周找时间搞一下。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267561473/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267568405","html_url":"https://github.com/apache/brpc/issues/2668#issuecomment-2267568405","issue_url":"https://api.github.com/repos/apache/brpc/issues/2668","id":2267568405,"node_id":"IC_kwDOBhmkcs6HKFkV","user":{"login":"GreateCode","id":9795716,"node_id":"MDQ6VXNlcjk3OTU3MTY=","avatar_url":"https://avatars.githubusercontent.com/u/9795716?v=4","gravatar_id":"","url":"https://api.github.com/users/GreateCode","html_url":"https://github.com/GreateCode","followers_url":"https://api.github.com/users/GreateCode/followers","following_url":"https://api.github.com/users/GreateCode/following{/other_user}","gists_url":"https://api.github.com/users/GreateCode/gists{/gist_id}","starred_url":"https://api.github.com/users/GreateCode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GreateCode/subscriptions","organizations_url":"https://api.github.com/users/GreateCode/orgs","repos_url":"https://api.github.com/users/GreateCode/repos","events_url":"https://api.github.com/users/GreateCode/events{/privacy}","received_events_url":"https://api.github.com/users/GreateCode/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-04T14:45:30Z","updated_at":"2024-08-04T14:47:29Z","author_association":"CONTRIBUTOR","body":"顺便提下，希望policy可以拿到对应的controller对象，进而取xxx某个属性，做优先级加权计算判断是否触发backup_request。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267568405/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267973391","html_url":"https://github.com/apache/brpc/issues/2668#issuecomment-2267973391","issue_url":"https://api.github.com/repos/apache/brpc/issues/2668","id":2267973391,"node_id":"IC_kwDOBhmkcs6HLocP","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-05T00:35:12Z","updated_at":"2024-08-05T00:35:12Z","author_association":"CONTRIBUTOR","body":"可以拿到controller的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2267973391/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2268051320","html_url":"https://github.com/apache/brpc/issues/2721#issuecomment-2268051320","issue_url":"https://api.github.com/repos/apache/brpc/issues/2721","id":2268051320,"node_id":"IC_kwDOBhmkcs6HL7d4","user":{"login":"Cheney-W","id":38240633,"node_id":"MDQ6VXNlcjM4MjQwNjMz","avatar_url":"https://avatars.githubusercontent.com/u/38240633?v=4","gravatar_id":"","url":"https://api.github.com/users/Cheney-W","html_url":"https://github.com/Cheney-W","followers_url":"https://api.github.com/users/Cheney-W/followers","following_url":"https://api.github.com/users/Cheney-W/following{/other_user}","gists_url":"https://api.github.com/users/Cheney-W/gists{/gist_id}","starred_url":"https://api.github.com/users/Cheney-W/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Cheney-W/subscriptions","organizations_url":"https://api.github.com/users/Cheney-W/orgs","repos_url":"https://api.github.com/users/Cheney-W/repos","events_url":"https://api.github.com/users/Cheney-W/events{/privacy}","received_events_url":"https://api.github.com/users/Cheney-W/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-05T02:23:52Z","updated_at":"2024-08-05T02:23:52Z","author_association":"NONE","body":"Thanks for your reply! I will modify my patch based on this PR.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2268051320/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2268120780","html_url":"https://github.com/apache/brpc/issues/2264#issuecomment-2268120780","issue_url":"https://api.github.com/repos/apache/brpc/issues/2264","id":2268120780,"node_id":"IC_kwDOBhmkcs6HMMbM","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-05T03:53:18Z","updated_at":"2024-08-11T11:10:55Z","author_association":"CONTRIBUTOR","body":"> 大概是一个提供 sslpolicy和nonsslpolicy的连接实现；具体再sslpolicy里面 需要处理ssl handshake等内容\r\n\r\n将ssl逻辑都抽成SSLPolicy来是一个好主意。\r\n\r\n虽然框架会基于目前框架的ssl设置提供一个默认的SSLPolicy，但是当用户需要自定义ssl handshake过程的时候，要这里逻辑写好，可能得去了解rpc实现（特别是Socket）。\r\n\r\n> 然而基于SSL本身的options非常的多，各个用户对于SSL的options要求也不一样以及同时SSL的版本也在不断更新等理由，\r\n导致brpc支持ssl功能代码难以具备普遍性，无法适应新的变化。\r\n\r\n基于这个原因，自定义ssl handshake的复杂度应该是可以接受。\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2268120780/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2270249695","html_url":"https://github.com/apache/brpc/issues/2723#issuecomment-2270249695","issue_url":"https://api.github.com/repos/apache/brpc/issues/2723","id":2270249695,"node_id":"IC_kwDOBhmkcs6HUULf","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-06T02:27:40Z","updated_at":"2024-08-06T02:27:40Z","author_association":"CONTRIBUTOR","body":"每种协议都有自己的规范，如果您想扩展实现自己的协议，可以参考[文档](https://github.com/apache/brpc/blob/master/docs/cn/new_protocol.md)。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2270249695/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2270423783","html_url":"https://github.com/apache/brpc/pull/2722#issuecomment-2270423783","issue_url":"https://api.github.com/repos/apache/brpc/issues/2722","id":2270423783,"node_id":"IC_kwDOBhmkcs6HU-rn","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-06T05:37:22Z","updated_at":"2024-08-06T05:37:22Z","author_association":"MEMBER","body":"Protobuf 升级 API 时不时就会不兼容，这个看有没有什么办法做隔离？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2270423783/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2270467940","html_url":"https://github.com/apache/brpc/pull/2722#issuecomment-2270467940","issue_url":"https://api.github.com/repos/apache/brpc/issues/2722","id":2270467940,"node_id":"IC_kwDOBhmkcs6HVJdk","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-06T06:16:13Z","updated_at":"2024-08-06T06:16:31Z","author_association":"CONTRIBUTOR","body":"只能跟着Protobuf版本兼容了吧。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2270467940/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2270973692","html_url":"https://github.com/apache/brpc/issues/1188#issuecomment-2270973692","issue_url":"https://api.github.com/repos/apache/brpc/issues/1188","id":2270973692,"node_id":"IC_kwDOBhmkcs6HXE78","user":{"login":"helloworld0xff","id":35884967,"node_id":"MDQ6VXNlcjM1ODg0OTY3","avatar_url":"https://avatars.githubusercontent.com/u/35884967?v=4","gravatar_id":"","url":"https://api.github.com/users/helloworld0xff","html_url":"https://github.com/helloworld0xff","followers_url":"https://api.github.com/users/helloworld0xff/followers","following_url":"https://api.github.com/users/helloworld0xff/following{/other_user}","gists_url":"https://api.github.com/users/helloworld0xff/gists{/gist_id}","starred_url":"https://api.github.com/users/helloworld0xff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/helloworld0xff/subscriptions","organizations_url":"https://api.github.com/users/helloworld0xff/orgs","repos_url":"https://api.github.com/users/helloworld0xff/repos","events_url":"https://api.github.com/users/helloworld0xff/events{/privacy}","received_events_url":"https://api.github.com/users/helloworld0xff/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-06T10:45:00Z","updated_at":"2024-08-06T10:45:00Z","author_association":"NONE","body":"解决了吗？1.10版本出现概率还挺高的","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2270973692/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2271081048","html_url":"https://github.com/apache/brpc/issues/2726#issuecomment-2271081048","issue_url":"https://api.github.com/repos/apache/brpc/issues/2726","id":2271081048,"node_id":"IC_kwDOBhmkcs6HXfJY","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-06T11:38:07Z","updated_at":"2024-08-07T04:18:14Z","author_association":"CONTRIBUTOR","body":"试一下#2727 看看还有没有问题。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2271081048/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2271591068","html_url":"https://github.com/apache/brpc/pull/2722#issuecomment-2271591068","issue_url":"https://api.github.com/repos/apache/brpc/issues/2722","id":2271591068,"node_id":"IC_kwDOBhmkcs6HZbqc","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-06T15:37:57Z","updated_at":"2024-08-06T15:38:48Z","author_association":"CONTRIBUTOR","body":"目前bRPC内部继承并实现google::protobuf::Message的原因：\r\n1. 序列化和打包的时候，通过Protobuf的反射机制来确定request和response具体类型，确保是具体协议要求的类型；\r\n2. CallMethod要求request和response是google::protobuf::Message类型。\r\n\r\n针对这两个问题，或许我们可以通过以下方法来接触对Protobuf的依赖。以下是初步的想法（可能还有其他未关注到得细节）：\r\n1. 实现内部的Message抽象类，并提供必要的反射机制；\r\n2. 增加CallMethod重载函数，支持内部Message类型；\r\n3. 协议注册机制支持内部Message类型。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2271591068/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2272559689","html_url":"https://github.com/apache/brpc/pull/2722#issuecomment-2272559689","issue_url":"https://api.github.com/repos/apache/brpc/issues/2722","id":2272559689,"node_id":"IC_kwDOBhmkcs6HdIJJ","user":{"login":"oathdruid","id":17508029,"node_id":"MDQ6VXNlcjE3NTA4MDI5","avatar_url":"https://avatars.githubusercontent.com/u/17508029?v=4","gravatar_id":"","url":"https://api.github.com/users/oathdruid","html_url":"https://github.com/oathdruid","followers_url":"https://api.github.com/users/oathdruid/followers","following_url":"https://api.github.com/users/oathdruid/following{/other_user}","gists_url":"https://api.github.com/users/oathdruid/gists{/gist_id}","starred_url":"https://api.github.com/users/oathdruid/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/oathdruid/subscriptions","organizations_url":"https://api.github.com/users/oathdruid/orgs","repos_url":"https://api.github.com/users/oathdruid/repos","events_url":"https://api.github.com/users/oathdruid/events{/privacy}","received_events_url":"https://api.github.com/users/oathdruid/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-07T03:47:38Z","updated_at":"2024-08-07T03:47:38Z","author_association":"CONTRIBUTOR","body":"[unreflectable_message.txt](https://github.com/user-attachments/files/16517931/unreflectable_message.txt)\r\n内部我是尝试整了一个基类归拢了一下和pb的版本适配相关的东西，每次新版本来的，改改倒是也还能用\r\n\r\nPS：最近pb的breaking change确实多","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2272559689/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2272701098","html_url":"https://github.com/apache/brpc/issues/2726#issuecomment-2272701098","issue_url":"https://api.github.com/repos/apache/brpc/issues/2726","id":2272701098,"node_id":"IC_kwDOBhmkcs6Hdqqq","user":{"login":"fausturs","id":25004087,"node_id":"MDQ6VXNlcjI1MDA0MDg3","avatar_url":"https://avatars.githubusercontent.com/u/25004087?v=4","gravatar_id":"","url":"https://api.github.com/users/fausturs","html_url":"https://github.com/fausturs","followers_url":"https://api.github.com/users/fausturs/followers","following_url":"https://api.github.com/users/fausturs/following{/other_user}","gists_url":"https://api.github.com/users/fausturs/gists{/gist_id}","starred_url":"https://api.github.com/users/fausturs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fausturs/subscriptions","organizations_url":"https://api.github.com/users/fausturs/orgs","repos_url":"https://api.github.com/users/fausturs/repos","events_url":"https://api.github.com/users/fausturs/events{/privacy}","received_events_url":"https://api.github.com/users/fausturs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-07T06:18:06Z","updated_at":"2024-08-07T06:19:08Z","author_association":"NONE","body":"> 试一下#2727 看看还有没有问题。\r\n@chenBright \r\n\r\n首先，感谢你的回复与支持。\r\n\r\nhttps://github.com/fausturs/test-brpc-jemalloc\r\n这里我给了一个小demo用于复现这个栈。\r\n\r\n\r\n从给出的修复来看，似乎是通过宏NO_PTHREAD_MUTEX_HOOK控制是否去覆盖pthread的符号。那么完全不覆盖pthread的mutex符号的时候，我想本issue的这个问题应该OK了。\r\n\r\n\r\n此外我有一点点好奇，对于brpc中，为什么要去hack pthread中的mutex相关符号呢，好处是什么？是能够在真正调用pthread之前，能够进行一些额外的统计信息吗？那是不是当我设置NO_PTHREAD_MUTEX_HOOK时，对pyhread mutex的操作，可能会更快？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2272701098/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2272722270","html_url":"https://github.com/apache/brpc/issues/2726#issuecomment-2272722270","issue_url":"https://api.github.com/repos/apache/brpc/issues/2726","id":2272722270,"node_id":"IC_kwDOBhmkcs6Hdv1e","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-07T06:32:34Z","updated_at":"2024-08-07T06:47:33Z","author_association":"CONTRIBUTOR","body":"主要是通过__dl_sym来hook，避免_dlerror_run申请内存导致malloc库死锁。不需要NO_PTHREAD_MUTEX_HOOK宏应该也是没问题的了。NO_PTHREAD_MUTEX_HOOK跟这个issue关系不大，主要解决没法调整动态库加载顺序导致找不到pthread_mutex_*符号的问题。\r\n\r\n> 对于brpc中，为什么要去hack pthread中的mutex相关符号呢\r\n\r\nhook pthread mutex是为了支持[contention profiler](https://github.com/apache/brpc/blob/master/docs/cn/contention_profiler.md)和[worker潜在死锁问题的检测](https://github.com/apache/brpc/pull/2692)。\r\n\r\n> 那是不是当我设置NO_PTHREAD_MUTEX_HOOK时，对pthread mutex的操作，可能会更快？\r\n\r\n没开contention profiler的情况下，只是多了一个判断和线程局部变量加减，性能应该没有差别的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2272722270/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2272734647","html_url":"https://github.com/apache/brpc/issues/2726#issuecomment-2272734647","issue_url":"https://api.github.com/repos/apache/brpc/issues/2726","id":2272734647,"node_id":"IC_kwDOBhmkcs6Hdy23","user":{"login":"fausturs","id":25004087,"node_id":"MDQ6VXNlcjI1MDA0MDg3","avatar_url":"https://avatars.githubusercontent.com/u/25004087?v=4","gravatar_id":"","url":"https://api.github.com/users/fausturs","html_url":"https://github.com/fausturs","followers_url":"https://api.github.com/users/fausturs/followers","following_url":"https://api.github.com/users/fausturs/following{/other_user}","gists_url":"https://api.github.com/users/fausturs/gists{/gist_id}","starred_url":"https://api.github.com/users/fausturs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fausturs/subscriptions","organizations_url":"https://api.github.com/users/fausturs/orgs","repos_url":"https://api.github.com/users/fausturs/repos","events_url":"https://api.github.com/users/fausturs/events{/privacy}","received_events_url":"https://api.github.com/users/fausturs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-07T06:41:39Z","updated_at":"2024-08-07T06:41:39Z","author_association":"NONE","body":"我通过我上述的小demo，使用`__dl_sym`代替`dlsym`，程序表现确实符合预期了。\r\n\r\n再次感谢你的回复，与支持。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2272734647/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2272755131","html_url":"https://github.com/apache/brpc/issues/2726#issuecomment-2272755131","issue_url":"https://api.github.com/repos/apache/brpc/issues/2726","id":2272755131,"node_id":"IC_kwDOBhmkcs6Hd327","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-07T06:56:01Z","updated_at":"2024-08-07T06:56:01Z","author_association":"CONTRIBUTOR","body":"好的，感谢反馈！","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2272755131/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2272979897","html_url":"https://github.com/apache/brpc/issues/2704#issuecomment-2272979897","issue_url":"https://api.github.com/repos/apache/brpc/issues/2704","id":2272979897,"node_id":"IC_kwDOBhmkcs6Heuu5","user":{"login":"wory117","id":22499231,"node_id":"MDQ6VXNlcjIyNDk5MjMx","avatar_url":"https://avatars.githubusercontent.com/u/22499231?v=4","gravatar_id":"","url":"https://api.github.com/users/wory117","html_url":"https://github.com/wory117","followers_url":"https://api.github.com/users/wory117/followers","following_url":"https://api.github.com/users/wory117/following{/other_user}","gists_url":"https://api.github.com/users/wory117/gists{/gist_id}","starred_url":"https://api.github.com/users/wory117/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wory117/subscriptions","organizations_url":"https://api.github.com/users/wory117/orgs","repos_url":"https://api.github.com/users/wory117/repos","events_url":"https://api.github.com/users/wory117/events{/privacy}","received_events_url":"https://api.github.com/users/wory117/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-07T09:02:07Z","updated_at":"2024-08-07T09:02:07Z","author_association":"NONE","body":"> 我理解现在就是这样的\r\n\r\n看了代码是调度到当前的 tg，并不是调度到原来的 td 啊","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2272979897/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2273016523","html_url":"https://github.com/apache/brpc/issues/2704#issuecomment-2273016523","issue_url":"https://api.github.com/repos/apache/brpc/issues/2704","id":2273016523,"node_id":"IC_kwDOBhmkcs6He3rL","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-07T09:20:54Z","updated_at":"2024-08-07T09:20:54Z","author_association":"CONTRIBUTOR","body":"> > 我理解现在就是这样的\r\n> \r\n> 看了代码是调度到当前的 tg，并不是调度到原来的 td 啊\r\n\r\n把代码贴出来看看，容易对齐。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2273016523/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2275037190","html_url":"https://github.com/apache/brpc/issues/2728#issuecomment-2275037190","issue_url":"https://api.github.com/repos/apache/brpc/issues/2728","id":2275037190,"node_id":"IC_kwDOBhmkcs6HmlAG","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-08T06:19:16Z","updated_at":"2024-08-08T06:19:16Z","author_association":"CONTRIBUTOR","body":"群里有人问了同样的问题，最新的版本是这个逻辑。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2275037190/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2275436111","html_url":"https://github.com/apache/brpc/pull/2718#issuecomment-2275436111","issue_url":"https://api.github.com/repos/apache/brpc/issues/2718","id":2275436111,"node_id":"IC_kwDOBhmkcs6HoGZP","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-08T10:02:37Z","updated_at":"2024-08-08T10:02:37Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2275436111/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2275444262","html_url":"https://github.com/apache/brpc/issues/2671#issuecomment-2275444262","issue_url":"https://api.github.com/repos/apache/brpc/issues/2671","id":2275444262,"node_id":"IC_kwDOBhmkcs6HoIYm","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-08T10:06:44Z","updated_at":"2024-08-08T10:06:44Z","author_association":"CONTRIBUTOR","body":"@oathdruid  see #2718  if there are any problems","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2275444262/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2275449005","html_url":"https://github.com/apache/brpc/pull/2719#issuecomment-2275449005","issue_url":"https://api.github.com/repos/apache/brpc/issues/2719","id":2275449005,"node_id":"IC_kwDOBhmkcs6HoJit","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-08T10:09:17Z","updated_at":"2024-08-08T10:09:17Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2275449005/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2276980305","html_url":"https://github.com/apache/brpc/pull/2730#issuecomment-2276980305","issue_url":"https://api.github.com/repos/apache/brpc/issues/2730","id":2276980305,"node_id":"IC_kwDOBhmkcs6Ht_ZR","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-09T01:23:06Z","updated_at":"2024-08-09T01:46:17Z","author_association":"CONTRIBUTOR","body":"一般什么情况下会两次解析呀，我这边确实没遇到过这样的场景，这块就做的不充分。\r\nbthread_concurrency_by_tag的默认值应该设置成等于bthread_concurrency的默认值，如果有多个tag的时候，两次解析是啥结果呢？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2276980305/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2277064209","html_url":"https://github.com/apache/brpc/pull/2730#issuecomment-2277064209","issue_url":"https://api.github.com/repos/apache/brpc/issues/2730","id":2277064209,"node_id":"IC_kwDOBhmkcs6HuT4R","user":{"login":"MJY-HUST","id":52315061,"node_id":"MDQ6VXNlcjUyMzE1MDYx","avatar_url":"https://avatars.githubusercontent.com/u/52315061?v=4","gravatar_id":"","url":"https://api.github.com/users/MJY-HUST","html_url":"https://github.com/MJY-HUST","followers_url":"https://api.github.com/users/MJY-HUST/followers","following_url":"https://api.github.com/users/MJY-HUST/following{/other_user}","gists_url":"https://api.github.com/users/MJY-HUST/gists{/gist_id}","starred_url":"https://api.github.com/users/MJY-HUST/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MJY-HUST/subscriptions","organizations_url":"https://api.github.com/users/MJY-HUST/orgs","repos_url":"https://api.github.com/users/MJY-HUST/repos","events_url":"https://api.github.com/users/MJY-HUST/events{/privacy}","received_events_url":"https://api.github.com/users/MJY-HUST/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-09T03:15:25Z","updated_at":"2024-08-09T03:15:25Z","author_association":"CONTRIBUTOR","body":"> 一般什么情况下会两次解析呀，我这边确实没遇到过这样的场景，这块就做的不充分。 bthread_concurrency_by_tag的默认值应该设置成等于bthread_concurrency的默认值\r\n\r\n两次解析是由于上层应用对其他的gflags有reload需求，但使用了类似ParseCommandLineFlags会调用所有flags的validate函数？或者只是代码的不规范导致的在链路中执行了两次ParseCommandLineFlags触发这个问题。这部分应该是可以通过修改上层应用的代码来避免，但是brpc应该也需要做到兼容这个场景。\r\n\r\n> 如果有多个tag的时候，两次解析是啥结果呢？\r\n\r\n如果内部实现有多个tag，一般来说第一次解析是在main函数开始出，此时第一次解析由于设置了never_set_bthread_concurrency_by_tag，task_control还是等于nullptr;后续如果在设置了tag的server没启动前出现第二次解析，此时task_control init之后只有tag 0，因此指定其他的tag时，tag_ngroup = 0，如果设置了bthread_concurrency_by_tag的值，那么只要其大于0，那么就会触发add_workers，不会有异常。如果在server启动之后第二次触发，就和正常的动态改变分组线程的流程一致了，应该也没有问题。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2277064209/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2277079114","html_url":"https://github.com/apache/brpc/pull/2730#issuecomment-2277079114","issue_url":"https://api.github.com/repos/apache/brpc/issues/2730","id":2277079114,"node_id":"IC_kwDOBhmkcs6HuXhK","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-09T03:36:44Z","updated_at":"2024-08-09T03:43:14Z","author_association":"CONTRIBUTOR","body":"> > 一般什么情况下会两次解析呀，我这边确实没遇到过这样的场景，这块就做的不充分。 bthread_concurrency_by_tag的默认值应该设置成等于bthread_concurrency的默认值\r\n> \r\n> 两次解析是由于上层应用对其他的gflags有reload需求，但使用了类似ParseCommandLineFlags会调用所有flags的validate函数？或者只是代码的不规范导致的在链路中执行了两次ParseCommandLineFlags触发这个问题。这部分应该是可以通过修改上层应用的代码来避免，但是brpc应该也需要做到兼容这个场景。\r\n> \r\n> > 如果有多个tag的时候，两次解析是啥结果呢？\r\n> \r\n> 如果内部实现有多个tag，一般来说第一次解析是在main函数开始出，此时第一次解析由于设置了never_set_bthread_concurrency_by_tag，task_control还是等于nullptr;后续如果在设置了tag的server没启动前出现第二次解析，此时task_control init之后只有tag 0，因此指定其他的tag时，tag_ngroup = 0，如果设置了bthread_concurrency_by_tag的值，那么只要其大于0，那么就会触发add_workers，不会有异常。如果在server启动之后第二次触发，就和正常的动态改变分组线程的流程一致了，应该也没有问题。\r\n\r\n我觉得得测试一下这些场景，如果设置了task_group_ntags=2，那么在task_control init的时候会把FLAGS_bthread_concurrency平均分配给每组。这时候再执行bthread_setconcurrency_by_tag把tag0的worker数量改变了，这个线程数量是你想要的吗？感觉这块考虑的是不是过于复杂了。\r\n可以把FLAGS_bthread_current_tag的默认值变成一个非法值BTHREAD_TAG_INVALID，然后，bthread_setconcurrency_by_tag(val, FLAGS_bthread_current_tag)  这个函数里面判断FLAGS_bthread_current_tag 是非法值，就直接返回成功，相当于没啥效果。把never_set_bthread_concurrency_by_tag这个就去掉了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2277079114/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2277100438","html_url":"https://github.com/apache/brpc/issues/2266#issuecomment-2277100438","issue_url":"https://api.github.com/repos/apache/brpc/issues/2266","id":2277100438,"node_id":"IC_kwDOBhmkcs6HucuW","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-09T03:59:34Z","updated_at":"2024-08-09T03:59:34Z","author_association":"CONTRIBUTOR","body":"@tangtang5156  可以试试使用`LD_PRELOAD=/path/to/libbrpc.so`启动程序看有没有问题","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2277100438/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2277310576","html_url":"https://github.com/apache/brpc/issues/2674#issuecomment-2277310576","issue_url":"https://api.github.com/repos/apache/brpc/issues/2674","id":2277310576,"node_id":"IC_kwDOBhmkcs6HvQBw","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-09T07:20:42Z","updated_at":"2024-08-09T07:20:42Z","author_association":"CONTRIBUTOR","body":"try https://github.com/apache/brpc/pull/2732","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2277310576/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2277492470","html_url":"https://github.com/apache/brpc/issues/2729#issuecomment-2277492470","issue_url":"https://api.github.com/repos/apache/brpc/issues/2729","id":2277492470,"node_id":"IC_kwDOBhmkcs6Hv8b2","user":{"login":"helloworld0xff","id":35884967,"node_id":"MDQ6VXNlcjM1ODg0OTY3","avatar_url":"https://avatars.githubusercontent.com/u/35884967?v=4","gravatar_id":"","url":"https://api.github.com/users/helloworld0xff","html_url":"https://github.com/helloworld0xff","followers_url":"https://api.github.com/users/helloworld0xff/followers","following_url":"https://api.github.com/users/helloworld0xff/following{/other_user}","gists_url":"https://api.github.com/users/helloworld0xff/gists{/gist_id}","starred_url":"https://api.github.com/users/helloworld0xff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/helloworld0xff/subscriptions","organizations_url":"https://api.github.com/users/helloworld0xff/orgs","repos_url":"https://api.github.com/users/helloworld0xff/repos","events_url":"https://api.github.com/users/helloworld0xff/events{/privacy}","received_events_url":"https://api.github.com/users/helloworld0xff/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-09T09:01:56Z","updated_at":"2024-08-09T09:01:56Z","author_association":"NONE","body":"几个core都指向ResourcePool，看了之前的一些提问，这是个很老的问题了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2277492470/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2277575711","html_url":"https://github.com/apache/brpc/issues/1188#issuecomment-2277575711","issue_url":"https://api.github.com/repos/apache/brpc/issues/1188","id":2277575711,"node_id":"IC_kwDOBhmkcs6HwQwf","user":{"login":"helloworld0xff","id":35884967,"node_id":"MDQ6VXNlcjM1ODg0OTY3","avatar_url":"https://avatars.githubusercontent.com/u/35884967?v=4","gravatar_id":"","url":"https://api.github.com/users/helloworld0xff","html_url":"https://github.com/helloworld0xff","followers_url":"https://api.github.com/users/helloworld0xff/followers","following_url":"https://api.github.com/users/helloworld0xff/following{/other_user}","gists_url":"https://api.github.com/users/helloworld0xff/gists{/gist_id}","starred_url":"https://api.github.com/users/helloworld0xff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/helloworld0xff/subscriptions","organizations_url":"https://api.github.com/users/helloworld0xff/orgs","repos_url":"https://api.github.com/users/helloworld0xff/repos","events_url":"https://api.github.com/users/helloworld0xff/events{/privacy}","received_events_url":"https://api.github.com/users/helloworld0xff/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-09T09:49:30Z","updated_at":"2024-08-09T09:49:30Z","author_association":"NONE","body":"> #1325 猜测是ResourcePool返回了一个超过65535的id，原因是看ResourcePool的逻辑是65536个group * 65536个Block * 256个元素，其容量远大于2^32。而bthread_id_t的计算方式是 resource_id << 32 | version，那么resource_id == 0 和 resource_id = 65536生成的bthread_id_t的值是一样的，这俩id在return_resource的时候会把resource_id == 0的元素return两遍，后续get_resouce就会有问题。 #1179 这个也有可能是这个原因，不过1179看起来不光是TimerTask相同，而且还连在一起了，概率感觉比较低，还没有想明白\r\n> \r\n> 这个issue另外一个问题是butex是nullptr，感觉可能是创建的时候就失败了，之前没有check，这个PR加了个check，#1326\r\n> \r\n> @jamesge @acelyc111 辛苦帮忙review下看我的猜测是否合理哈，感谢\r\n\r\n不对，我这边也是这个地方崩溃了，但是_ngroup的值是1，id值没有超过int max","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2277575711/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2279415630","html_url":"https://github.com/apache/brpc/issues/2668#issuecomment-2279415630","issue_url":"https://api.github.com/repos/apache/brpc/issues/2668","id":2279415630,"node_id":"IC_kwDOBhmkcs6H3R9O","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-10T05:33:33Z","updated_at":"2024-09-23T11:44:20Z","author_association":"CONTRIBUTOR","body":"> 嗯嗯，理解这个场景了。其实跟RetryPolicy一样，让用户决定是否要继续发请求。\r\n> \r\n> 或许backup_request_policy可以都支持：\r\n> \r\n> 1. 支持动态timeout；\r\n> 2. 支持在HandleBackupRequest拦截。\r\n\r\n@icexin @GreateCode  @xiaoma2015 @NuttyNull 提了个[PR](https://github.com/apache/brpc/pull/2734)，大家看看有什么建议？\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2279415630/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2282786473","html_url":"https://github.com/apache/brpc/pull/2719#issuecomment-2282786473","issue_url":"https://api.github.com/repos/apache/brpc/issues/2719","id":2282786473,"node_id":"IC_kwDOBhmkcs6IEI6p","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-11T14:51:09Z","updated_at":"2024-08-11T14:51:09Z","author_association":"CONTRIBUTOR","body":"@wwbmmm 有空再看看","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2282786473/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2283034768","html_url":"https://github.com/apache/brpc/issues/2356#issuecomment-2283034768","issue_url":"https://api.github.com/repos/apache/brpc/issues/2356","id":2283034768,"node_id":"IC_kwDOBhmkcs6IFFiQ","user":{"login":"MathildaStacy","id":85678690,"node_id":"MDQ6VXNlcjg1Njc4Njkw","avatar_url":"https://avatars.githubusercontent.com/u/85678690?v=4","gravatar_id":"","url":"https://api.github.com/users/MathildaStacy","html_url":"https://github.com/MathildaStacy","followers_url":"https://api.github.com/users/MathildaStacy/followers","following_url":"https://api.github.com/users/MathildaStacy/following{/other_user}","gists_url":"https://api.github.com/users/MathildaStacy/gists{/gist_id}","starred_url":"https://api.github.com/users/MathildaStacy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MathildaStacy/subscriptions","organizations_url":"https://api.github.com/users/MathildaStacy/orgs","repos_url":"https://api.github.com/users/MathildaStacy/repos","events_url":"https://api.github.com/users/MathildaStacy/events{/privacy}","received_events_url":"https://api.github.com/users/MathildaStacy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-12T02:58:24Z","updated_at":"2024-08-12T02:58:24Z","author_association":"NONE","body":"> > 同样的环境碰到同样的问题。请问最后的解决方案是什么？\r\n> \r\n> 已经找到解决方案。需要的可以私下咨询。\r\n\r\n为什么不能直接在这说呢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2283034768/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2285258279","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2285258279","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2285258279,"node_id":"IC_kwDOBhmkcs6INkYn","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-13T03:09:52Z","updated_at":"2024-08-13T03:09:52Z","author_association":"CONTRIBUTOR","body":"https://github.com/apache/brpc/blob/master/docs/cn/bthread_tagged_task_group.md 这个能否满足？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2285258279/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2285275431","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2285275431","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2285275431,"node_id":"IC_kwDOBhmkcs6INokn","user":{"login":"utopia9527","id":74170863,"node_id":"MDQ6VXNlcjc0MTcwODYz","avatar_url":"https://avatars.githubusercontent.com/u/74170863?v=4","gravatar_id":"","url":"https://api.github.com/users/utopia9527","html_url":"https://github.com/utopia9527","followers_url":"https://api.github.com/users/utopia9527/followers","following_url":"https://api.github.com/users/utopia9527/following{/other_user}","gists_url":"https://api.github.com/users/utopia9527/gists{/gist_id}","starred_url":"https://api.github.com/users/utopia9527/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/utopia9527/subscriptions","organizations_url":"https://api.github.com/users/utopia9527/orgs","repos_url":"https://api.github.com/users/utopia9527/repos","events_url":"https://api.github.com/users/utopia9527/events{/privacy}","received_events_url":"https://api.github.com/users/utopia9527/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-13T03:31:52Z","updated_at":"2024-08-13T03:31:52Z","author_association":"NONE","body":"> https://github.com/apache/brpc/blob/master/docs/cn/bthread_tagged_task_group.md 这个能否满足？\r\n\r\n似乎不太一样。 顺带请问教在上述这种当并发量过大，bthread_worker_usage 打满后为什么恢复不了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2285275431/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2285280537","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2285280537","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2285280537,"node_id":"IC_kwDOBhmkcs6INp0Z","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-13T03:38:54Z","updated_at":"2024-08-13T03:38:54Z","author_association":"CONTRIBUTOR","body":"打满了就是cpu用满了，扩展线程数？你这个场景打满了符合预期吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2285280537/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2285331689","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2285331689","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2285331689,"node_id":"IC_kwDOBhmkcs6IN2Tp","user":{"login":"utopia9527","id":74170863,"node_id":"MDQ6VXNlcjc0MTcwODYz","avatar_url":"https://avatars.githubusercontent.com/u/74170863?v=4","gravatar_id":"","url":"https://api.github.com/users/utopia9527","html_url":"https://github.com/utopia9527","followers_url":"https://api.github.com/users/utopia9527/followers","following_url":"https://api.github.com/users/utopia9527/following{/other_user}","gists_url":"https://api.github.com/users/utopia9527/gists{/gist_id}","starred_url":"https://api.github.com/users/utopia9527/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/utopia9527/subscriptions","organizations_url":"https://api.github.com/users/utopia9527/orgs","repos_url":"https://api.github.com/users/utopia9527/repos","events_url":"https://api.github.com/users/utopia9527/events{/privacy}","received_events_url":"https://api.github.com/users/utopia9527/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-13T04:46:07Z","updated_at":"2024-08-13T04:46:25Z","author_association":"NONE","body":"> 打满了就是cpu用满了，扩展线程数？你这个场景打满了符合预期吗？\r\n\r\ncpu没满，工作线程数满了，疑惑的是停止请求后，服务并不能恢复，还是直接卡死","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2285331689/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2285358403","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2285358403","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2285358403,"node_id":"IC_kwDOBhmkcs6IN81D","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-13T05:18:55Z","updated_at":"2024-08-13T05:18:55Z","author_association":"CONTRIBUTOR","body":"那我听上去是应用方面的bug呢。否则这问题并发大了，大家都应该会触发到。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2285358403/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2285414324","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2285414324","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2285414324,"node_id":"IC_kwDOBhmkcs6IOKe0","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-13T06:13:23Z","updated_at":"2024-08-13T06:13:23Z","author_association":"CONTRIBUTOR","body":"可以用gdb看看worker线程都卡在哪","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2285414324/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2286450670","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2286450670","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2286450670,"node_id":"IC_kwDOBhmkcs6ISHfu","user":{"login":"utopia9527","id":74170863,"node_id":"MDQ6VXNlcjc0MTcwODYz","avatar_url":"https://avatars.githubusercontent.com/u/74170863?v=4","gravatar_id":"","url":"https://api.github.com/users/utopia9527","html_url":"https://github.com/utopia9527","followers_url":"https://api.github.com/users/utopia9527/followers","following_url":"https://api.github.com/users/utopia9527/following{/other_user}","gists_url":"https://api.github.com/users/utopia9527/gists{/gist_id}","starred_url":"https://api.github.com/users/utopia9527/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/utopia9527/subscriptions","organizations_url":"https://api.github.com/users/utopia9527/orgs","repos_url":"https://api.github.com/users/utopia9527/repos","events_url":"https://api.github.com/users/utopia9527/events{/privacy}","received_events_url":"https://api.github.com/users/utopia9527/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-13T14:50:43Z","updated_at":"2024-08-13T18:38:03Z","author_association":"NONE","body":"> 可以用gdb看看worker线程都卡在哪\r\n都卡在了 CallMethod这里。 下述线程池中的bthread锁和条件变量都换成 std锁、条件变量之后不会发生这种问题。\r\n\r\n使用池子里的bthread 去进行redis rpc 调用，如果一开始给一个较小的并发调用，不会卡死，并发量增加时，直接卡死在这个方法(redis_channel->CallMethod(NULL, &cntl, &request, &response, NULL);)\r\n不太清楚是否和使用了 std::future 有关\r\n\r\n\r\n调试信息\r\n```\r\n#0  0x00007f2309b6952d in syscall () from /lib64/libc.so.6\r\n#1  0x00007f230a491841 in std::__atomic_futex_unsigned_base::_M_futex_wait_until(unsigned int*, unsigned int, bool, std::chrono::duration<long, std::ratio<1l, 1l> >, std::chrono::duration<long, std::ratio<1l, 1000000000l> >) () from /lib64/libstdc++.so.6\r\n#2  0x00000000004be95e in std::__atomic_futex_unsigned<2147483648u>::_M_load_and_test_until (this=0x7f22d05cb020, __assumed=0, __operand=1, __equal=true, __mo=std::memory_order_acquire, __has_timeout=false, __s=..., __ns=...) at /usr/include/c++/8/bits/atomic_futex.h:102\r\n#3  0x00000000004aee85 in std::__atomic_futex_unsigned<2147483648u>::_M_load_and_test (this=0x7f22d05cb020, __assumed=0, __operand=1, __equal=true, __mo=std::memory_order_acquire) at /usr/include/c++/8/bits/atomic_futex.h:122\r\n#4  0x000000000048f2c1 in std::__atomic_futex_unsigned<2147483648u>::_M_load_when_equal (__mo=std::memory_order_acquire, __val=1, this=0x7f22d05cb020) at /usr/include/c++/8/bits/atomic_futex.h:162\r\n#5  std::__future_base::_State_baseV2::wait (this=0x7f22d05cb010) at /usr/include/c++/8/future:337\r\n#6  0x00000000005a3577 in std::__basic_future<std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > >::_M_get_result (this=0x7f22d0028b80) at /usr/include/c++/8/future:717\r\n#7  0x00000000005a272a in std::future<std::vector<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> >, std::allocator<std::__cxx11::basic_string<char, std::char_traits<char>, std::allocator<char> > > > >::get (this=0x7f22d0028b80) at /usr/include/c++/8/future:796\r\n```\r\n\r\n代码\r\n```\r\n// 往池子里加任务\r\ntemplate <class F, class... Args>\r\nauto BThreadPool::enqueue(F&& f, Args&&... args)\r\n    -> std::future<typename std::invoke_result<F, Args...>::type> {\r\n  using return_type = typename std::invoke_result<F, Args...>::type;\r\n  auto task = std::make_shared<std::packaged_task<return_type()>>(\r\n      std::bind(std::forward<F>(f), std::forward<Args>(args)...));\r\n\r\n  std::future<return_type> res = task->get_future();\r\n  {\r\n    std::lock_guard<bthread_mutex_t> lock(queue_mutex_);\r\n    if (stop_) throw std::runtime_error(\"enqueue on stop_ped ThreadPool\");\r\n    tasks.emplace([task]() { (*task)(); });\r\n  }\r\n  bthread_cond_signal(&condition_);\r\n  return res;\r\n}\r\n\r\n// 从池子取出任务\r\nvoid* BThreadPool::TaskFunction(void* args) {\r\n  auto* tp = reinterpret_cast<BThreadPool*>(args);\r\n  while (true) {\r\n    std::function<void()> task;\r\n    {\r\n      // Already specialize \"std::lock_guard\" and \"std::unique_lock\" for\r\n      // bthread_mutex_t\r\n      std::lock_guard<bthread_mutex_t> lock(tp->queue_mutex_);\r\n      while (tp->tasks.empty()) {\r\n        if (tp->stop_) break;\r\n        bthread_cond_wait(&tp->condition_, &tp->queue_mutex_);\r\n      }\r\n      if (tp->stop_ && tp->tasks.empty()) {\r\n        return nullptr;\r\n      }\r\n      task = std::move(tp->tasks.front());\r\n      tp->tasks.pop();\r\n    }\r\n    task();\r\n  }\r\n}\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2286450670/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2286454596","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2286454596","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2286454596,"node_id":"IC_kwDOBhmkcs6ISIdE","user":{"login":"utopia9527","id":74170863,"node_id":"MDQ6VXNlcjc0MTcwODYz","avatar_url":"https://avatars.githubusercontent.com/u/74170863?v=4","gravatar_id":"","url":"https://api.github.com/users/utopia9527","html_url":"https://github.com/utopia9527","followers_url":"https://api.github.com/users/utopia9527/followers","following_url":"https://api.github.com/users/utopia9527/following{/other_user}","gists_url":"https://api.github.com/users/utopia9527/gists{/gist_id}","starred_url":"https://api.github.com/users/utopia9527/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/utopia9527/subscriptions","organizations_url":"https://api.github.com/users/utopia9527/orgs","repos_url":"https://api.github.com/users/utopia9527/repos","events_url":"https://api.github.com/users/utopia9527/events{/privacy}","received_events_url":"https://api.github.com/users/utopia9527/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-13T14:52:31Z","updated_at":"2024-08-13T14:52:31Z","author_association":"NONE","body":"> 那我听上去是应用方面的bug呢。否则这问题并发大了，大家都应该会触发到。\r\n\r\n是的，看上去是用法不对","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2286454596/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287579813","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2287579813","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2287579813,"node_id":"IC_kwDOBhmkcs6IWbKl","user":{"login":"ivanallen","id":12481610,"node_id":"MDQ6VXNlcjEyNDgxNjEw","avatar_url":"https://avatars.githubusercontent.com/u/12481610?v=4","gravatar_id":"","url":"https://api.github.com/users/ivanallen","html_url":"https://github.com/ivanallen","followers_url":"https://api.github.com/users/ivanallen/followers","following_url":"https://api.github.com/users/ivanallen/following{/other_user}","gists_url":"https://api.github.com/users/ivanallen/gists{/gist_id}","starred_url":"https://api.github.com/users/ivanallen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivanallen/subscriptions","organizations_url":"https://api.github.com/users/ivanallen/orgs","repos_url":"https://api.github.com/users/ivanallen/repos","events_url":"https://api.github.com/users/ivanallen/events{/privacy}","received_events_url":"https://api.github.com/users/ivanallen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-14T01:05:10Z","updated_at":"2024-08-14T01:05:10Z","author_association":"CONTRIBUTOR","body":"enqueue 返回 std::future ，外部在这个 future 上 wait 会阻塞线程。\r\n你可能需要单独写个适配 bthread 的 future，而不是直接使用标准库的 future。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287579813/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287714939","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2287714939","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2287714939,"node_id":"IC_kwDOBhmkcs6IW8J7","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-14T02:26:26Z","updated_at":"2024-08-14T02:26:26Z","author_association":"CONTRIBUTOR","body":"> enqueue 返回 std::future ，外部在这个 future 上 wait 会阻塞线程。 你可能需要单独写个适配 bthread 的 future，而不是直接使用标准库的 future。\r\n\r\nstd::future::get会阻塞worker线程，当std::future::get的并发数大于worker数，就会阻塞全部worker线程了，这时候没法调度其他bthread了。除非在其他独立线程上std::promise::set_value，但是这样只是不会”卡死“，长尾可能已经导致服务不可用了。\r\n\r\n可以用baidu最近开源的[babylon](https://github.com/baidu/babylon)，有支持bthread的[future](https://github.com/baidu/babylon/blob/main/docs/future.md)。\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287714939/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287717312","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2287717312","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2287717312,"node_id":"IC_kwDOBhmkcs6IW8vA","user":{"login":"utopia9527","id":74170863,"node_id":"MDQ6VXNlcjc0MTcwODYz","avatar_url":"https://avatars.githubusercontent.com/u/74170863?v=4","gravatar_id":"","url":"https://api.github.com/users/utopia9527","html_url":"https://github.com/utopia9527","followers_url":"https://api.github.com/users/utopia9527/followers","following_url":"https://api.github.com/users/utopia9527/following{/other_user}","gists_url":"https://api.github.com/users/utopia9527/gists{/gist_id}","starred_url":"https://api.github.com/users/utopia9527/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/utopia9527/subscriptions","organizations_url":"https://api.github.com/users/utopia9527/orgs","repos_url":"https://api.github.com/users/utopia9527/repos","events_url":"https://api.github.com/users/utopia9527/events{/privacy}","received_events_url":"https://api.github.com/users/utopia9527/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-14T02:29:21Z","updated_at":"2024-08-14T02:29:21Z","author_association":"NONE","body":"> > enqueue 返回 std::future ，外部在这个 future 上 wait 会阻塞线程。 你可能需要单独写个适配 bthread 的 future，而不是直接使用标准库的 future。\r\n> \r\n> std::future::get会阻塞worker线程，当std::future::get的并发数大于worker数，就会阻塞全部worker线程了，这时候没法调度其他bthread了。除非在其他独立线程上std::promise::set_value，但是这样只是不会”卡死“，长尾可能已经导致服务不可用了。\r\n> \r\n> 可以用baidu最近开源的[babylon](https://github.com/baidu/babylon)，有支持bthread的[future](https://github.com/baidu/babylon/blob/main/docs/future.md)。\r\n\r\n有个小问题， 线程池里面如果使用std:mutex的话不会出现这种现象。  是说可能加mutex锁的时候让当前worker的其它bthread 被\"偷过去\"了么","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287717312/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287729053","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2287729053","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2287729053,"node_id":"IC_kwDOBhmkcs6IW_md","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-14T02:44:22Z","updated_at":"2024-08-14T02:44:22Z","author_association":"CONTRIBUTOR","body":"使用std:mutex的话，会阻塞worker线程直到取出任务为止，是不是std::promise::set_value所在bthread会一直占有worker线程呢？\r\n\r\n可能只是概率小一些而已。当std::future::get的并发数大于worker数，就会阻塞全部worker线程了，这是潜在的问题，跟std:mutex还是bthread_mutex已经没啥关系了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287729053/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287793951","html_url":"https://github.com/apache/brpc/issues/2623#issuecomment-2287793951","issue_url":"https://api.github.com/repos/apache/brpc/issues/2623","id":2287793951,"node_id":"IC_kwDOBhmkcs6IXPcf","user":{"login":"helloworld0xff","id":35884967,"node_id":"MDQ6VXNlcjM1ODg0OTY3","avatar_url":"https://avatars.githubusercontent.com/u/35884967?v=4","gravatar_id":"","url":"https://api.github.com/users/helloworld0xff","html_url":"https://github.com/helloworld0xff","followers_url":"https://api.github.com/users/helloworld0xff/followers","following_url":"https://api.github.com/users/helloworld0xff/following{/other_user}","gists_url":"https://api.github.com/users/helloworld0xff/gists{/gist_id}","starred_url":"https://api.github.com/users/helloworld0xff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/helloworld0xff/subscriptions","organizations_url":"https://api.github.com/users/helloworld0xff/orgs","repos_url":"https://api.github.com/users/helloworld0xff/repos","events_url":"https://api.github.com/users/helloworld0xff/events{/privacy}","received_events_url":"https://api.github.com/users/helloworld0xff/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-14T03:55:01Z","updated_at":"2024-08-14T03:55:01Z","author_association":"NONE","body":"请问解决了吗？我也遇到同样的问题了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287793951/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287826113","html_url":"https://github.com/apache/brpc/issues/2623#issuecomment-2287826113","issue_url":"https://api.github.com/repos/apache/brpc/issues/2623","id":2287826113,"node_id":"IC_kwDOBhmkcs6IXXTB","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-14T04:22:28Z","updated_at":"2024-08-14T04:22:28Z","author_association":"CONTRIBUTOR","body":"可以先用[baidu-std wireshark插件](https://github.com/apache/brpc/blob/master/docs/cn/wireshark_baidu_std.md)抓包确认一下服务端有没有将包发出去和客户端有没有收到包。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287826113/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287884961","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2287884961","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2287884961,"node_id":"IC_kwDOBhmkcs6IXlqh","user":{"login":"utopia9527","id":74170863,"node_id":"MDQ6VXNlcjc0MTcwODYz","avatar_url":"https://avatars.githubusercontent.com/u/74170863?v=4","gravatar_id":"","url":"https://api.github.com/users/utopia9527","html_url":"https://github.com/utopia9527","followers_url":"https://api.github.com/users/utopia9527/followers","following_url":"https://api.github.com/users/utopia9527/following{/other_user}","gists_url":"https://api.github.com/users/utopia9527/gists{/gist_id}","starred_url":"https://api.github.com/users/utopia9527/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/utopia9527/subscriptions","organizations_url":"https://api.github.com/users/utopia9527/orgs","repos_url":"https://api.github.com/users/utopia9527/repos","events_url":"https://api.github.com/users/utopia9527/events{/privacy}","received_events_url":"https://api.github.com/users/utopia9527/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-14T05:28:14Z","updated_at":"2024-08-14T05:28:14Z","author_association":"NONE","body":"> mutex已经没啥关系了。\r\n确实也会卡住。 \r\n如果去掉池子，每次都创建多个bthread 来进行rpc 调用。 请教下这块频繁创建和销毁 bthread 带来的性能消耗有相关数值和参考资料么","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287884961/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287940709","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2287940709","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2287940709,"node_id":"IC_kwDOBhmkcs6IXzRl","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-14T06:17:25Z","updated_at":"2024-08-14T06:17:25Z","author_association":"CONTRIBUTOR","body":"没有。相对于rpc来说，创建和销毁bthread的性能开销不大吧，bthread meta和栈是从资源池或者对象池获取的，有复用机制，应该很快的。前面”bthread池“会有同步的消耗，不一定比创建性能高吧。你可以测一下，对比两者的性能。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287940709/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287942556","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2287942556","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2287942556,"node_id":"IC_kwDOBhmkcs6IXzuc","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-14T06:19:05Z","updated_at":"2024-08-14T06:19:05Z","author_association":"CONTRIBUTOR","body":"发异步rpc应该可以减少bthread数量吧。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287942556/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287960304","html_url":"https://github.com/apache/brpc/issues/2733#issuecomment-2287960304","issue_url":"https://api.github.com/repos/apache/brpc/issues/2733","id":2287960304,"node_id":"IC_kwDOBhmkcs6IX4Dw","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-14T06:33:23Z","updated_at":"2024-08-14T06:33:23Z","author_association":"CONTRIBUTOR","body":"新服务端不知道客户端是怎么建流的，所以只能用批量的StreamAccept了吧？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287960304/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287996510","html_url":"https://github.com/apache/brpc/issues/2736#issuecomment-2287996510","issue_url":"https://api.github.com/repos/apache/brpc/issues/2736","id":2287996510,"node_id":"IC_kwDOBhmkcs6IYA5e","user":{"login":"utopia9527","id":74170863,"node_id":"MDQ6VXNlcjc0MTcwODYz","avatar_url":"https://avatars.githubusercontent.com/u/74170863?v=4","gravatar_id":"","url":"https://api.github.com/users/utopia9527","html_url":"https://github.com/utopia9527","followers_url":"https://api.github.com/users/utopia9527/followers","following_url":"https://api.github.com/users/utopia9527/following{/other_user}","gists_url":"https://api.github.com/users/utopia9527/gists{/gist_id}","starred_url":"https://api.github.com/users/utopia9527/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/utopia9527/subscriptions","organizations_url":"https://api.github.com/users/utopia9527/orgs","repos_url":"https://api.github.com/users/utopia9527/repos","events_url":"https://api.github.com/users/utopia9527/events{/privacy}","received_events_url":"https://api.github.com/users/utopia9527/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-14T07:00:40Z","updated_at":"2024-08-14T07:00:40Z","author_association":"NONE","body":"> 没有。相对于rpc来说，创建和销毁bthread的性能开销不大吧，bthread meta和栈是从资源池或者对象池获取的，有复用机制，应该很快的。前面”bthread池“会有同步的消耗，不一定比创建性能高吧。你可以测一下，对比两者的性能。\r\n\r\n多谢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2287996510/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2290463758","html_url":"https://github.com/apache/brpc/issues/2733#issuecomment-2290463758","issue_url":"https://api.github.com/repos/apache/brpc/issues/2733","id":2290463758,"node_id":"IC_kwDOBhmkcs6IhbQO","user":{"login":"jenrryyou","id":4698734,"node_id":"MDQ6VXNlcjQ2OTg3MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/4698734?v=4","gravatar_id":"","url":"https://api.github.com/users/jenrryyou","html_url":"https://github.com/jenrryyou","followers_url":"https://api.github.com/users/jenrryyou/followers","following_url":"https://api.github.com/users/jenrryyou/following{/other_user}","gists_url":"https://api.github.com/users/jenrryyou/gists{/gist_id}","starred_url":"https://api.github.com/users/jenrryyou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jenrryyou/subscriptions","organizations_url":"https://api.github.com/users/jenrryyou/orgs","repos_url":"https://api.github.com/users/jenrryyou/repos","events_url":"https://api.github.com/users/jenrryyou/events{/privacy}","received_events_url":"https://api.github.com/users/jenrryyou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-15T03:09:51Z","updated_at":"2024-08-15T03:09:51Z","author_association":"CONTRIBUTOR","body":"对，按传过来的StreamIds的顺序批量accept，返回streamID顺序也会传入的StreamID对应","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2290463758/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2290509926","html_url":"https://github.com/apache/brpc/pull/2492#issuecomment-2290509926","issue_url":"https://api.github.com/repos/apache/brpc/issues/2492","id":2290509926,"node_id":"IC_kwDOBhmkcs6Ihmhm","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-15T03:46:02Z","updated_at":"2024-08-15T03:46:02Z","author_association":"CONTRIBUTOR","body":"@chenBright 这个对列，消费者是需要轮询吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2290509926/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2290520284","html_url":"https://github.com/apache/brpc/pull/2492#issuecomment-2290520284","issue_url":"https://api.github.com/repos/apache/brpc/issues/2492","id":2290520284,"node_id":"IC_kwDOBhmkcs6IhpDc","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-15T03:55:41Z","updated_at":"2024-08-15T03:55:41Z","author_association":"CONTRIBUTOR","body":"需要主动调出队的接口","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2290520284/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2290635641","html_url":"https://github.com/apache/brpc/pull/2492#issuecomment-2290635641","issue_url":"https://api.github.com/repos/apache/brpc/issues/2492","id":2290635641,"node_id":"IC_kwDOBhmkcs6IiFN5","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-15T05:11:04Z","updated_at":"2024-08-15T05:11:04Z","author_association":"CONTRIBUTOR","body":"如果对列没有内容，不会阻塞，需要轮询，或者自己实现一个唤醒的方式，是这样吧。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2290635641/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2290740199","html_url":"https://github.com/apache/brpc/pull/2492#issuecomment-2290740199","issue_url":"https://api.github.com/repos/apache/brpc/issues/2492","id":2290740199,"node_id":"IC_kwDOBhmkcs6Iievn","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-15T06:14:51Z","updated_at":"2024-08-15T06:14:51Z","author_association":"CONTRIBUTOR","body":"是的，没有同步机制。如果有需求，可以加一个同步机制吧。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2290740199/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2292648820","html_url":"https://github.com/apache/brpc/issues/2638#issuecomment-2292648820","issue_url":"https://api.github.com/repos/apache/brpc/issues/2638","id":2292648820,"node_id":"IC_kwDOBhmkcs6Ipwt0","user":{"login":"jgli","id":3295659,"node_id":"MDQ6VXNlcjMyOTU2NTk=","avatar_url":"https://avatars.githubusercontent.com/u/3295659?v=4","gravatar_id":"","url":"https://api.github.com/users/jgli","html_url":"https://github.com/jgli","followers_url":"https://api.github.com/users/jgli/followers","following_url":"https://api.github.com/users/jgli/following{/other_user}","gists_url":"https://api.github.com/users/jgli/gists{/gist_id}","starred_url":"https://api.github.com/users/jgli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgli/subscriptions","organizations_url":"https://api.github.com/users/jgli/orgs","repos_url":"https://api.github.com/users/jgli/repos","events_url":"https://api.github.com/users/jgli/events{/privacy}","received_events_url":"https://api.github.com/users/jgli/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-16T03:08:46Z","updated_at":"2024-08-16T03:08:46Z","author_association":"NONE","body":"![image](https://github.com/user-attachments/assets/cab5a5cd-ca40-4c71-84a3-318fb0dd40b8)\r\n![image](https://github.com/user-attachments/assets/7d1e72ff-77d7-42f6-ac65-9908ac5efd79)\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2292648820/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2293169274","html_url":"https://github.com/apache/brpc/issues/1342#issuecomment-2293169274","issue_url":"https://api.github.com/repos/apache/brpc/issues/1342","id":2293169274,"node_id":"IC_kwDOBhmkcs6Irvx6","user":{"login":"heartplus","id":46808880,"node_id":"MDQ6VXNlcjQ2ODA4ODgw","avatar_url":"https://avatars.githubusercontent.com/u/46808880?v=4","gravatar_id":"","url":"https://api.github.com/users/heartplus","html_url":"https://github.com/heartplus","followers_url":"https://api.github.com/users/heartplus/followers","following_url":"https://api.github.com/users/heartplus/following{/other_user}","gists_url":"https://api.github.com/users/heartplus/gists{/gist_id}","starred_url":"https://api.github.com/users/heartplus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/heartplus/subscriptions","organizations_url":"https://api.github.com/users/heartplus/orgs","repos_url":"https://api.github.com/users/heartplus/repos","events_url":"https://api.github.com/users/heartplus/events{/privacy}","received_events_url":"https://api.github.com/users/heartplus/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-16T09:31:47Z","updated_at":"2024-08-16T09:31:47Z","author_association":"NONE","body":"just try this one\r\nhttps://github.com/bilibili/redis_sdk_cxx","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2293169274/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2293170891","html_url":"https://github.com/apache/brpc/issues/2142#issuecomment-2293170891","issue_url":"https://api.github.com/repos/apache/brpc/issues/2142","id":2293170891,"node_id":"IC_kwDOBhmkcs6IrwLL","user":{"login":"heartplus","id":46808880,"node_id":"MDQ6VXNlcjQ2ODA4ODgw","avatar_url":"https://avatars.githubusercontent.com/u/46808880?v=4","gravatar_id":"","url":"https://api.github.com/users/heartplus","html_url":"https://github.com/heartplus","followers_url":"https://api.github.com/users/heartplus/followers","following_url":"https://api.github.com/users/heartplus/following{/other_user}","gists_url":"https://api.github.com/users/heartplus/gists{/gist_id}","starred_url":"https://api.github.com/users/heartplus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/heartplus/subscriptions","organizations_url":"https://api.github.com/users/heartplus/orgs","repos_url":"https://api.github.com/users/heartplus/repos","events_url":"https://api.github.com/users/heartplus/events{/privacy}","received_events_url":"https://api.github.com/users/heartplus/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-16T09:32:54Z","updated_at":"2024-08-16T09:32:54Z","author_association":"NONE","body":"https://github.com/bilibili/redis_sdk_cxx\r\n来试试看这个 ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2293170891/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2293171432","html_url":"https://github.com/apache/brpc/issues/511#issuecomment-2293171432","issue_url":"https://api.github.com/repos/apache/brpc/issues/511","id":2293171432,"node_id":"IC_kwDOBhmkcs6IrwTo","user":{"login":"heartplus","id":46808880,"node_id":"MDQ6VXNlcjQ2ODA4ODgw","avatar_url":"https://avatars.githubusercontent.com/u/46808880?v=4","gravatar_id":"","url":"https://api.github.com/users/heartplus","html_url":"https://github.com/heartplus","followers_url":"https://api.github.com/users/heartplus/followers","following_url":"https://api.github.com/users/heartplus/following{/other_user}","gists_url":"https://api.github.com/users/heartplus/gists{/gist_id}","starred_url":"https://api.github.com/users/heartplus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/heartplus/subscriptions","organizations_url":"https://api.github.com/users/heartplus/orgs","repos_url":"https://api.github.com/users/heartplus/repos","events_url":"https://api.github.com/users/heartplus/events{/privacy}","received_events_url":"https://api.github.com/users/heartplus/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-16T09:33:19Z","updated_at":"2024-08-16T09:33:19Z","author_association":"NONE","body":"https://github.com/bilibili/redis_sdk_cxx\r\n试试看这个","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2293171432/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2295142741","html_url":"https://github.com/apache/brpc/pull/2730#issuecomment-2295142741","issue_url":"https://api.github.com/repos/apache/brpc/issues/2730","id":2295142741,"node_id":"IC_kwDOBhmkcs6IzRlV","user":{"login":"MJY-HUST","id":52315061,"node_id":"MDQ6VXNlcjUyMzE1MDYx","avatar_url":"https://avatars.githubusercontent.com/u/52315061?v=4","gravatar_id":"","url":"https://api.github.com/users/MJY-HUST","html_url":"https://github.com/MJY-HUST","followers_url":"https://api.github.com/users/MJY-HUST/followers","following_url":"https://api.github.com/users/MJY-HUST/following{/other_user}","gists_url":"https://api.github.com/users/MJY-HUST/gists{/gist_id}","starred_url":"https://api.github.com/users/MJY-HUST/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MJY-HUST/subscriptions","organizations_url":"https://api.github.com/users/MJY-HUST/orgs","repos_url":"https://api.github.com/users/MJY-HUST/repos","events_url":"https://api.github.com/users/MJY-HUST/events{/privacy}","received_events_url":"https://api.github.com/users/MJY-HUST/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-18T06:51:56Z","updated_at":"2024-08-18T06:51:56Z","author_association":"CONTRIBUTOR","body":"> > > 一般什么情况下会两次解析呀，我这边确实没遇到过这样的场景，这块就做的不充分。 bthread_concurrency_by_tag的默认值应该设置成等于bthread_concurrency的默认值\r\n> > \r\n> > \r\n> > 两次解析是由于上层应用对其他的gflags有reload需求，但使用了类似ParseCommandLineFlags会调用所有flags的validate函数？或者只是代码的不规范导致的在链路中执行了两次ParseCommandLineFlags触发这个问题。这部分应该是可以通过修改上层应用的代码来避免，但是brpc应该也需要做到兼容这个场景。\r\n> > > 如果有多个tag的时候，两次解析是啥结果呢？\r\n> > \r\n> > \r\n> > 如果内部实现有多个tag，一般来说第一次解析是在main函数开始出，此时第一次解析由于设置了never_set_bthread_concurrency_by_tag，task_control还是等于nullptr;后续如果在设置了tag的server没启动前出现第二次解析，此时task_control init之后只有tag 0，因此指定其他的tag时，tag_ngroup = 0，如果设置了bthread_concurrency_by_tag的值，那么只要其大于0，那么就会触发add_workers，不会有异常。如果在server启动之后第二次触发，就和正常的动态改变分组线程的流程一致了，应该也没有问题。\r\n> \r\n> 我觉得得测试一下这些场景，如果设置了task_group_ntags=2，那么在task_control init的时候会把FLAGS_bthread_concurrency平均分配给每组。这时候再执行bthread_setconcurrency_by_tag把tag0的worker数量改变了，这个线程数量是你想要的吗？感觉这块考虑的是不是过于复杂了。 可以把FLAGS_bthread_current_tag的默认值变成一个非法值BTHREAD_TAG_INVALID，然后，bthread_setconcurrency_by_tag(val, FLAGS_bthread_current_tag) 这个函数里面判断FLAGS_bthread_current_tag 是非法值，就直接返回成功，相当于没啥效果。把never_set_bthread_concurrency_by_tag这个就去掉了。\r\n\r\n是的，默认设置为BTHREAD_TAG_INVALID更合理，按照你的意见修改了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2295142741/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2295510120","html_url":"https://github.com/apache/brpc/pull/2730#issuecomment-2295510120","issue_url":"https://api.github.com/repos/apache/brpc/issues/2730","id":2295510120,"node_id":"IC_kwDOBhmkcs6I0rRo","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T01:38:06Z","updated_at":"2024-08-19T01:38:06Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2295510120/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2295609704","html_url":"https://github.com/apache/brpc/pull/2492#issuecomment-2295609704","issue_url":"https://api.github.com/repos/apache/brpc/issues/2492","id":2295609704,"node_id":"IC_kwDOBhmkcs6I1Dlo","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T03:44:47Z","updated_at":"2024-08-19T03:44:47Z","author_association":"CONTRIBUTOR","body":"@chenBright PR里面我提了点问题，你有时间帮忙看看。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2295609704/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2295614443","html_url":"https://github.com/apache/brpc/issues/2674#issuecomment-2295614443","issue_url":"https://api.github.com/repos/apache/brpc/issues/2674","id":2295614443,"node_id":"IC_kwDOBhmkcs6I1Evr","user":{"login":"zhaoyulong","id":1088655,"node_id":"MDQ6VXNlcjEwODg2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/1088655?v=4","gravatar_id":"","url":"https://api.github.com/users/zhaoyulong","html_url":"https://github.com/zhaoyulong","followers_url":"https://api.github.com/users/zhaoyulong/followers","following_url":"https://api.github.com/users/zhaoyulong/following{/other_user}","gists_url":"https://api.github.com/users/zhaoyulong/gists{/gist_id}","starred_url":"https://api.github.com/users/zhaoyulong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhaoyulong/subscriptions","organizations_url":"https://api.github.com/users/zhaoyulong/orgs","repos_url":"https://api.github.com/users/zhaoyulong/repos","events_url":"https://api.github.com/users/zhaoyulong/events{/privacy}","received_events_url":"https://api.github.com/users/zhaoyulong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T03:50:34Z","updated_at":"2024-08-19T03:50:34Z","author_association":"NONE","body":"> try #2732\r\n\r\n(gdb) source /home/yulong.zhao/brpc/tools/gdb_bthread_stack.py\r\n(gdb) bthead_begin\r\nUndefined command: \"bthead_begin\".  Try \"help\".\r\n(gdb) bthread_begin\r\nwarning: Could not find DWO CU bazel-out/k8-dbg/bin/_objs/brpc/controller.pic.dwo(0xfc070064084a248f) referenced by CU at offset 0x48e [in module /home/yulong.zhao/.cache/bazel/_bazel_yulong.zhao/7f7db11ae0bdba045225157f9735c648/execroot/_main/bazel-out/k8-dbg/bin/example/echo_c++_server]\r\nPython Exception <class 'gdb.error'> No symbol \"bthread\" in current context.:\r\nError occurred in Python: No symbol \"bthread\" in current context.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2295614443/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2295753677","html_url":"https://github.com/apache/brpc/pull/2492#issuecomment-2295753677","issue_url":"https://api.github.com/repos/apache/brpc/issues/2492","id":2295753677,"node_id":"IC_kwDOBhmkcs6I1mvN","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T06:20:22Z","updated_at":"2024-08-19T06:20:22Z","author_association":"CONTRIBUTOR","body":"> @chenBright PR里面我提了点问题，你有时间帮忙看看。\r\n\r\n好像没看到","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2295753677/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2295802186","html_url":"https://github.com/apache/brpc/pull/2492#issuecomment-2295802186","issue_url":"https://api.github.com/repos/apache/brpc/issues/2492","id":2295802186,"node_id":"IC_kwDOBhmkcs6I1ylK","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T06:56:48Z","updated_at":"2024-08-19T06:56:48Z","author_association":"CONTRIBUTOR","body":"> > @chenBright PR里面我提了点问题，你有时间帮忙看看。\r\n> \r\n> 好像没看到\r\n\r\n_cur_enqueue_node看上去每次执行都要设置成NULL，这个是必要的吗？\r\n是不是把 node = _cur_enqueue_node.load(memory_order_relaxed);换成\r\nnode = _cur_enqueue_node.exchange(NULL, memory_order_relaxed); 就可以了呢？\r\n你们在实际场景用了吗？我这边有需求，打算用用。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2295802186/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296004886","html_url":"https://github.com/apache/brpc/pull/2492#issuecomment-2296004886","issue_url":"https://api.github.com/repos/apache/brpc/issues/2492","id":2296004886,"node_id":"IC_kwDOBhmkcs6I2kEW","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T08:41:42Z","updated_at":"2024-08-19T08:41:53Z","author_association":"CONTRIBUTOR","body":"确实没有必要，改成`node = _cur_enqueue_node.exchange(NULL, memory_order_relaxed);`就行。\r\n\r\n之前排查问题的时候在profiler采样场景下用了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296004886/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296006171","html_url":"https://github.com/apache/brpc/pull/2492#issuecomment-2296006171","issue_url":"https://api.github.com/repos/apache/brpc/issues/2492","id":2296006171,"node_id":"IC_kwDOBhmkcs6I2kYb","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T08:42:18Z","updated_at":"2024-08-19T08:42:18Z","author_association":"CONTRIBUTOR","body":"> 如果对列没有内容，不会阻塞，需要轮询，或者自己实现一个唤醒的方式，是这样吧。\r\n\r\n有同步的需求吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296006171/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296037447","html_url":"https://github.com/apache/brpc/pull/2492#issuecomment-2296037447","issue_url":"https://api.github.com/repos/apache/brpc/issues/2492","id":2296037447,"node_id":"IC_kwDOBhmkcs6I2sBH","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T08:56:59Z","updated_at":"2024-08-19T08:56:59Z","author_association":"CONTRIBUTOR","body":"> 确实没有必要，改成`node = _cur_enqueue_node.exchange(NULL, memory_order_relaxed);`就行。\r\n> \r\n> 之前排查问题的时候在profiler采样场景下用了。\r\n\r\n那我来改一下也行。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296037447/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296039737","html_url":"https://github.com/apache/brpc/pull/2492#issuecomment-2296039737","issue_url":"https://api.github.com/repos/apache/brpc/issues/2492","id":2296039737,"node_id":"IC_kwDOBhmkcs6I2sk5","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T08:58:05Z","updated_at":"2024-08-19T08:58:05Z","author_association":"CONTRIBUTOR","body":"> > 如果对列没有内容，不会阻塞，需要轮询，或者自己实现一个唤醒的方式，是这样吧。\r\n> \r\n> 有同步的需求吗？\r\n\r\n我琢磨了一下，同步应该用户自己实现，在这个mpsc里面不好做，因为不同用户的判断逻辑会很不一样。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296039737/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296127224","html_url":"https://github.com/apache/brpc/pull/2492#issuecomment-2296127224","issue_url":"https://api.github.com/repos/apache/brpc/issues/2492","id":2296127224,"node_id":"IC_kwDOBhmkcs6I3B74","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T09:40:32Z","updated_at":"2024-08-19T09:40:32Z","author_association":"CONTRIBUTOR","body":"用户自己实现更灵活。\r\n\r\nmpsc提供同步机制应该也不复杂，抽象一个同步基类作为mpsc模板参数，让用户传决定实现wait和wakeup（一般就是pthread实现和bthread实现，这两个可以由框架提供实现）。入队之后是队头且有waiter，就唤醒waiter。出队时没有数据就wait。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296127224/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296132464","html_url":"https://github.com/apache/brpc/pull/2732#issuecomment-2296132464","issue_url":"https://api.github.com/repos/apache/brpc/issues/2732","id":2296132464,"node_id":"IC_kwDOBhmkcs6I3DNw","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T09:42:55Z","updated_at":"2024-08-19T09:42:55Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296132464/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296154933","html_url":"https://github.com/apache/brpc/issues/2674#issuecomment-2296154933","issue_url":"https://api.github.com/repos/apache/brpc/issues/2674","id":2296154933,"node_id":"IC_kwDOBhmkcs6I3Is1","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T09:53:25Z","updated_at":"2024-09-27T09:14:58Z","author_association":"CONTRIBUTOR","body":"> > try #2732\r\n> \r\n> (gdb) source /home/yulong.zhao/brpc/tools/gdb_bthread_stack.py (gdb) bthead_begin Undefined command: \"bthead_begin\". Try \"help\". (gdb) bthread_begin warning: Could not find DWO CU bazel-out/k8-dbg/bin/_objs/brpc/controller.pic.dwo(0xfc070064084a248f) referenced by CU at offset 0x48e [in module /home/yulong.zhao/.cache/bazel/_bazel_yulong.zhao/7f7db11ae0bdba045225157f9735c648/execroot/_main/bazel-out/k8-dbg/bin/example/echo_c++_server] Python Exception <class 'gdb.error'> No symbol \"bthread\" in current context.: Error occurred in Python: No symbol \"bthread\" in current context.\r\n\r\n能方便给个 echo_c++_server 的 bin 以及gdb的版本吗？我本地使用 ubuntu 20.04 + clang8+ gdb13.1/9.2  可以正常调试。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296154933/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296167038","html_url":"https://github.com/apache/brpc/pull/2492#issuecomment-2296167038","issue_url":"https://api.github.com/repos/apache/brpc/issues/2492","id":2296167038,"node_id":"IC_kwDOBhmkcs6I3Lp-","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T09:59:03Z","updated_at":"2024-08-20T08:50:47Z","author_association":"CONTRIBUTOR","body":"你实现的这个无锁队列，理论上性能很好的，不希望这个唤醒影响到性能。\r\n我这边有这个唤醒需求的话，我根据自己的场景去实现，应该只需要一个原子变量就可以了，具体描述：\r\n1、消费者消费队列的内容，直到返回false，在持续返回false一段时间，就会设置一个flag为，need_wakeup_flag。\r\n2、生产者在往队列放内容的后，会根据need_wakeup_flag决定是否执行一次唤醒。\r\n因为这个need_wakeup_flag不会被频繁设置，因此，这个原子变量的更新预期不会很频繁。\r\n\r\n我建议这块不要做了，让用户自己去实现，因为场景不同，不太能很好的支持。比如，我们这边消费者可能是个异步的动作，判断消费者是否完成这些任务，不光要判断Dequeue是否返回false，还得有自己的逻辑判断那些异步请求是否都执行完了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296167038/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296171306","html_url":"https://github.com/apache/brpc/pull/2719#issuecomment-2296171306","issue_url":"https://api.github.com/repos/apache/brpc/issues/2719","id":2296171306,"node_id":"IC_kwDOBhmkcs6I3Msq","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T10:00:58Z","updated_at":"2024-08-19T10:00:58Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296171306/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296183777","html_url":"https://github.com/apache/brpc/pull/2737#issuecomment-2296183777","issue_url":"https://api.github.com/repos/apache/brpc/issues/2737","id":2296183777,"node_id":"IC_kwDOBhmkcs6I3Pvh","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T10:06:39Z","updated_at":"2024-08-19T10:06:39Z","author_association":"CONTRIBUTOR","body":"感谢贡献！\r\n能否顺便更新一下使用文档？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296183777/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296199254","html_url":"https://github.com/apache/brpc/pull/2730#issuecomment-2296199254","issue_url":"https://api.github.com/repos/apache/brpc/issues/2730","id":2296199254,"node_id":"IC_kwDOBhmkcs6I3ThW","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T10:10:29Z","updated_at":"2024-08-19T10:10:29Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296199254/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296368826","html_url":"https://github.com/apache/brpc/pull/2727#issuecomment-2296368826","issue_url":"https://api.github.com/repos/apache/brpc/issues/2727","id":2296368826,"node_id":"IC_kwDOBhmkcs6I3866","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-19T11:40:29Z","updated_at":"2024-08-19T11:40:29Z","author_association":"CONTRIBUTOR","body":"@wwbmmm 有空看看","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2296368826/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2297824620","html_url":"https://github.com/apache/brpc/pull/2737#issuecomment-2297824620","issue_url":"https://api.github.com/repos/apache/brpc/issues/2737","id":2297824620,"node_id":"IC_kwDOBhmkcs6I9gVs","user":{"login":"GreateCode","id":9795716,"node_id":"MDQ6VXNlcjk3OTU3MTY=","avatar_url":"https://avatars.githubusercontent.com/u/9795716?v=4","gravatar_id":"","url":"https://api.github.com/users/GreateCode","html_url":"https://github.com/GreateCode","followers_url":"https://api.github.com/users/GreateCode/followers","following_url":"https://api.github.com/users/GreateCode/following{/other_user}","gists_url":"https://api.github.com/users/GreateCode/gists{/gist_id}","starred_url":"https://api.github.com/users/GreateCode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GreateCode/subscriptions","organizations_url":"https://api.github.com/users/GreateCode/orgs","repos_url":"https://api.github.com/users/GreateCode/repos","events_url":"https://api.github.com/users/GreateCode/events{/privacy}","received_events_url":"https://api.github.com/users/GreateCode/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-20T02:03:22Z","updated_at":"2024-08-20T02:03:22Z","author_association":"CONTRIBUTOR","body":"好的，我近期更新下","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2297824620/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2298645737","html_url":"https://github.com/apache/brpc/pull/2739#issuecomment-2298645737","issue_url":"https://api.github.com/repos/apache/brpc/issues/2739","id":2298645737,"node_id":"IC_kwDOBhmkcs6JAozp","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-20T11:38:36Z","updated_at":"2024-08-20T11:38:36Z","author_association":"CONTRIBUTOR","body":"@chenBright","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2298645737/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2298646402","html_url":"https://github.com/apache/brpc/pull/2492#issuecomment-2298646402","issue_url":"https://api.github.com/repos/apache/brpc/issues/2492","id":2298646402,"node_id":"IC_kwDOBhmkcs6JAo-C","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-20T11:38:57Z","updated_at":"2024-08-20T11:38:57Z","author_association":"CONTRIBUTOR","body":"> > > @chenBright PR里面我提了点问题，你有时间帮忙看看。\r\n> > \r\n> > \r\n> > 好像没看到\r\n> \r\n> _cur_enqueue_node看上去每次执行都要设置成NULL，这个是必要的吗？ 是不是把 node = _cur_enqueue_node.load(memory_order_relaxed);换成 node = _cur_enqueue_node.exchange(NULL, memory_order_relaxed); 就可以了呢？ 你们在实际场景用了吗？我这边有需求，打算用用。\r\n\r\nhttps://github.com/apache/brpc/pull/2739","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2298646402/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2298707647","html_url":"https://github.com/apache/brpc/issues/2354#issuecomment-2298707647","issue_url":"https://api.github.com/repos/apache/brpc/issues/2354","id":2298707647,"node_id":"IC_kwDOBhmkcs6JA36_","user":{"login":"xiangpdu","id":11640492,"node_id":"MDQ6VXNlcjExNjQwNDky","avatar_url":"https://avatars.githubusercontent.com/u/11640492?v=4","gravatar_id":"","url":"https://api.github.com/users/xiangpdu","html_url":"https://github.com/xiangpdu","followers_url":"https://api.github.com/users/xiangpdu/followers","following_url":"https://api.github.com/users/xiangpdu/following{/other_user}","gists_url":"https://api.github.com/users/xiangpdu/gists{/gist_id}","starred_url":"https://api.github.com/users/xiangpdu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiangpdu/subscriptions","organizations_url":"https://api.github.com/users/xiangpdu/orgs","repos_url":"https://api.github.com/users/xiangpdu/repos","events_url":"https://api.github.com/users/xiangpdu/events{/privacy}","received_events_url":"https://api.github.com/users/xiangpdu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-20T12:12:23Z","updated_at":"2024-08-20T12:12:23Z","author_association":"NONE","body":"@zhoumo02  请问下这个功能目前还是没有开源的计划吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2298707647/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2300244668","html_url":"https://github.com/apache/brpc/issues/2354#issuecomment-2300244668","issue_url":"https://api.github.com/repos/apache/brpc/issues/2354","id":2300244668,"node_id":"IC_kwDOBhmkcs6JGvK8","user":{"login":"Aleda","id":9194433,"node_id":"MDQ6VXNlcjkxOTQ0MzM=","avatar_url":"https://avatars.githubusercontent.com/u/9194433?v=4","gravatar_id":"","url":"https://api.github.com/users/Aleda","html_url":"https://github.com/Aleda","followers_url":"https://api.github.com/users/Aleda/followers","following_url":"https://api.github.com/users/Aleda/following{/other_user}","gists_url":"https://api.github.com/users/Aleda/gists{/gist_id}","starred_url":"https://api.github.com/users/Aleda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Aleda/subscriptions","organizations_url":"https://api.github.com/users/Aleda/orgs","repos_url":"https://api.github.com/users/Aleda/repos","events_url":"https://api.github.com/users/Aleda/events{/privacy}","received_events_url":"https://api.github.com/users/Aleda/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-21T02:16:34Z","updated_at":"2024-08-21T02:16:34Z","author_association":"NONE","body":"目前bRPC flatbuffer版本在百度已经有初步有了一些部署规模，目前比较稳定。由于需要前后端统一改造后生效，我们的想法是继续在某个重要业务上灰度至70%之后启动开源至upstream，我觉得这个时间可能在24年底左右，请耐心等待，谢谢。\r\nThe bRPC flatbuffer version has already been deployed on a initial scale within Baidu and is currently quite stable. Since it requires coordinated changes on both the frontend and backend to take effect, our plan is to continue rolling out a gray release on a important service until reaching 70% deployment, after which we will do the open-sourcing to upstream. I anticipate this will likely happen around the end of 2024. Please be patient. Thank you.\r\n@xiangpdu ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2300244668/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2300314061","html_url":"https://github.com/apache/brpc/pull/2741#issuecomment-2300314061","issue_url":"https://api.github.com/repos/apache/brpc/issues/2741","id":2300314061,"node_id":"IC_kwDOBhmkcs6JHAHN","user":{"login":"ivanallen","id":12481610,"node_id":"MDQ6VXNlcjEyNDgxNjEw","avatar_url":"https://avatars.githubusercontent.com/u/12481610?v=4","gravatar_id":"","url":"https://api.github.com/users/ivanallen","html_url":"https://github.com/ivanallen","followers_url":"https://api.github.com/users/ivanallen/followers","following_url":"https://api.github.com/users/ivanallen/following{/other_user}","gists_url":"https://api.github.com/users/ivanallen/gists{/gist_id}","starred_url":"https://api.github.com/users/ivanallen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ivanallen/subscriptions","organizations_url":"https://api.github.com/users/ivanallen/orgs","repos_url":"https://api.github.com/users/ivanallen/repos","events_url":"https://api.github.com/users/ivanallen/events{/privacy}","received_events_url":"https://api.github.com/users/ivanallen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-21T02:27:55Z","updated_at":"2024-08-21T02:27:55Z","author_association":"CONTRIBUTOR","body":"@chenBright @wwbmmm ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2300314061/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2300412120","html_url":"https://github.com/apache/brpc/pull/2737#issuecomment-2300412120","issue_url":"https://api.github.com/repos/apache/brpc/issues/2737","id":2300412120,"node_id":"IC_kwDOBhmkcs6JHYDY","user":{"login":"GreateCode","id":9795716,"node_id":"MDQ6VXNlcjk3OTU3MTY=","avatar_url":"https://avatars.githubusercontent.com/u/9795716?v=4","gravatar_id":"","url":"https://api.github.com/users/GreateCode","html_url":"https://github.com/GreateCode","followers_url":"https://api.github.com/users/GreateCode/followers","following_url":"https://api.github.com/users/GreateCode/following{/other_user}","gists_url":"https://api.github.com/users/GreateCode/gists{/gist_id}","starred_url":"https://api.github.com/users/GreateCode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GreateCode/subscriptions","organizations_url":"https://api.github.com/users/GreateCode/orgs","repos_url":"https://api.github.com/users/GreateCode/repos","events_url":"https://api.github.com/users/GreateCode/events{/privacy}","received_events_url":"https://api.github.com/users/GreateCode/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-21T02:52:38Z","updated_at":"2024-08-21T02:52:38Z","author_association":"CONTRIBUTOR","body":"> 感谢贡献！ 能否顺便更新一下使用文档？\r\n\r\ndone","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2300412120/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2300528017","html_url":"https://github.com/apache/brpc/issues/2742#issuecomment-2300528017","issue_url":"https://api.github.com/repos/apache/brpc/issues/2742","id":2300528017,"node_id":"IC_kwDOBhmkcs6JH0WR","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-21T03:23:58Z","updated_at":"2024-08-21T08:51:18Z","author_association":"CONTRIBUTOR","body":"@Tuvie 辛苦评估一下，另外，我想再加个问题，现在的rdma可以配置成polling模式吗？或者增加这样的模式可行吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2300528017/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2302417602","html_url":"https://github.com/apache/brpc/pull/2718#issuecomment-2302417602","issue_url":"https://api.github.com/repos/apache/brpc/issues/2718","id":2302417602,"node_id":"IC_kwDOBhmkcs6JPBrC","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-21T15:48:18Z","updated_at":"2024-08-26T02:56:15Z","author_association":"CONTRIBUTOR","body":"1. 用户一般不会创建很多server，所以不需要全局的DefaultRpcPBMessageFactory，每个server new一个DefaultRpcPBMessageFactory即可。这样，可以简化一些逻辑。\r\n2. 更新server中文文档。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2302417602/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2303519050","html_url":"https://github.com/apache/brpc/pull/2737#issuecomment-2303519050","issue_url":"https://api.github.com/repos/apache/brpc/issues/2737","id":2303519050,"node_id":"IC_kwDOBhmkcs6JTOlK","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-22T01:51:32Z","updated_at":"2024-08-22T01:51:32Z","author_association":"CONTRIBUTOR","body":"bazel编译，也是动态链接libjemalloc.so库吗","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2303519050/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2303538640","html_url":"https://github.com/apache/brpc/pull/2737#issuecomment-2303538640","issue_url":"https://api.github.com/repos/apache/brpc/issues/2737","id":2303538640,"node_id":"IC_kwDOBhmkcs6JTTXQ","user":{"login":"GreateCode","id":9795716,"node_id":"MDQ6VXNlcjk3OTU3MTY=","avatar_url":"https://avatars.githubusercontent.com/u/9795716?v=4","gravatar_id":"","url":"https://api.github.com/users/GreateCode","html_url":"https://github.com/GreateCode","followers_url":"https://api.github.com/users/GreateCode/followers","following_url":"https://api.github.com/users/GreateCode/following{/other_user}","gists_url":"https://api.github.com/users/GreateCode/gists{/gist_id}","starred_url":"https://api.github.com/users/GreateCode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GreateCode/subscriptions","organizations_url":"https://api.github.com/users/GreateCode/orgs","repos_url":"https://api.github.com/users/GreateCode/repos","events_url":"https://api.github.com/users/GreateCode/events{/privacy}","received_events_url":"https://api.github.com/users/GreateCode/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-22T02:06:46Z","updated_at":"2024-08-22T02:06:46Z","author_association":"CONTRIBUTOR","body":"> bazel编译，也是动态链接libjemalloc.so库吗\r\n\r\n不强制，和编译方式无关，只需profiler时能找到mallctl即可。\r\n所以静态链接jemalloc时，不用LD_PRELOAD=/xxx/lib/libjemalloc.so，直接MALLOC_CONF=\"prof:true\" bin/xxx。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2303538640/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2303551884","html_url":"https://github.com/apache/brpc/pull/2737#issuecomment-2303551884","issue_url":"https://api.github.com/repos/apache/brpc/issues/2737","id":2303551884,"node_id":"IC_kwDOBhmkcs6JTWmM","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-22T02:22:51Z","updated_at":"2024-08-22T02:22:51Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2303551884/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2303563862","html_url":"https://github.com/apache/brpc/pull/2737#issuecomment-2303563862","issue_url":"https://api.github.com/repos/apache/brpc/issues/2737","id":2303563862,"node_id":"IC_kwDOBhmkcs6JTZhW","user":{"login":"GreateCode","id":9795716,"node_id":"MDQ6VXNlcjk3OTU3MTY=","avatar_url":"https://avatars.githubusercontent.com/u/9795716?v=4","gravatar_id":"","url":"https://api.github.com/users/GreateCode","html_url":"https://github.com/GreateCode","followers_url":"https://api.github.com/users/GreateCode/followers","following_url":"https://api.github.com/users/GreateCode/following{/other_user}","gists_url":"https://api.github.com/users/GreateCode/gists{/gist_id}","starred_url":"https://api.github.com/users/GreateCode/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GreateCode/subscriptions","organizations_url":"https://api.github.com/users/GreateCode/orgs","repos_url":"https://api.github.com/users/GreateCode/repos","events_url":"https://api.github.com/users/GreateCode/events{/privacy}","received_events_url":"https://api.github.com/users/GreateCode/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-08-22T02:37:46Z","updated_at":"2024-08-22T02:48:30Z","author_association":"CONTRIBUTOR","body":"补充下，用静态方式链接jemalloc，进程加载其他so库比如dlopen(\"/xxx/libjvm.so\", xx)，so里函数申请的内存，可能不会被profiler采样到。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2303563862/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]