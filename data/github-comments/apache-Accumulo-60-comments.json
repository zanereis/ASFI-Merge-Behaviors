[{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767195554","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-767195554","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":767195554,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzE5NTU1NA==","user":{"login":"keith-turner","id":1268739,"node_id":"MDQ6VXNlcjEyNjg3Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1268739?v=4","gravatar_id":"","url":"https://api.github.com/users/keith-turner","html_url":"https://github.com/keith-turner","followers_url":"https://api.github.com/users/keith-turner/followers","following_url":"https://api.github.com/users/keith-turner/following{/other_user}","gists_url":"https://api.github.com/users/keith-turner/gists{/gist_id}","starred_url":"https://api.github.com/users/keith-turner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keith-turner/subscriptions","organizations_url":"https://api.github.com/users/keith-turner/orgs","repos_url":"https://api.github.com/users/keith-turner/repos","events_url":"https://api.github.com/users/keith-turner/events{/privacy}","received_events_url":"https://api.github.com/users/keith-turner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T00:15:33Z","updated_at":"2021-01-26T00:15:33Z","author_association":"CONTRIBUTOR","body":"@dlmarion I ran another experiment where I manually did the following in zkCli to create some ephemeral nodes before starting the tserver.\r\n\r\n```\r\n[zk: localhost:2181(CONNECTED) 6] addauth digest accumulo:uno\r\n[zk: localhost:2181(CONNECTED) 7] create /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997\r\nCreated /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997\r\n[zk: localhost:2181(CONNECTED) 17] create -s -e /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#93852053-1721-4f2a-a8fe-ee4b9398389e# \r\nCreated /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000002\r\n[zk: localhost:2181(CONNECTED) 18] create -s -e /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#93852053-1721-4f2a-a8fe-ee4b9398389e# \r\nCreated /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000003\r\n[zk: localhost:2181(CONNECTED) 19] create -s -e /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#93852053-1721-4f2a-a8fe-ee4b9398389e# \r\nCreated /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000004\r\n[zk: localhost:2181(CONNECTED) 20] create -s -e /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#93852053-1721-4f2a-a8fe-ee4b9398389e# \r\nCreated /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000005\r\n[zk: localhost:2181(CONNECTED) 21] ls /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997\r\n[zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000002, zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000003, zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000004, zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000005]\r\n```\r\n\r\nThen I started the tserver and saw the following in the logs.\r\n\r\n```\r\n2021-01-25T19:04:20,067 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] Ephemeral node /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000009 created\r\n2021-01-25T19:04:20,080 [zookeeper.ZooLock] TRACE: Children nodes\r\n2021-01-25T19:04:20,080 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000002\r\n2021-01-25T19:04:20,080 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000003\r\n2021-01-25T19:04:20,080 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000004\r\n2021-01-25T19:04:20,080 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000005\r\n2021-01-25T19:04:20,080 [zookeeper.ZooLock] TRACE: - zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000006\r\n2021-01-25T19:04:20,080 [zookeeper.ZooLock] TRACE: - zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000007\r\n2021-01-25T19:04:20,080 [zookeeper.ZooLock] TRACE: - zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000008\r\n2021-01-25T19:04:20,080 [zookeeper.ZooLock] TRACE: - zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000009\r\n2021-01-25T19:04:20,081 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] lowest sequential node found: /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000006\r\n2021-01-25T19:04:20,081 [zookeeper.ZooLock] INFO : [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] Zookeeper client missed server response, multiple ephemeral child nodes created at /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#\r\n2021-01-25T19:04:20,081 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] higher sequential node found: zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000007, deleting it\r\n2021-01-25T19:04:20,087 [zookeeper.ZooLock] INFO : [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] Zookeeper client missed server response, multiple ephemeral child nodes created at /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#\r\n2021-01-25T19:04:20,087 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] higher sequential node found: zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000008, deleting it\r\n2021-01-25T19:04:20,089 [zookeeper.ZooLock] INFO : [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] Zookeeper client missed server response, multiple ephemeral child nodes created at /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#\r\n2021-01-25T19:04:20,089 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] higher sequential node found: zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000009, deleting it\r\n2021-01-25T19:04:20,093 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] Setting watcher on /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000006\r\n2021-01-25T19:04:20,102 [zookeeper.ZooLock] TRACE: Children nodes\r\n2021-01-25T19:04:20,102 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000002\r\n2021-01-25T19:04:20,102 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000003\r\n2021-01-25T19:04:20,102 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000004\r\n2021-01-25T19:04:20,102 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000005\r\n2021-01-25T19:04:20,102 [zookeeper.ZooLock] TRACE: - zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000006\r\n2021-01-25T19:04:20,102 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] Establishing watch on prior node /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000002\r\n2021-01-25T19:04:20,103 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] Deleting all at path: /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000006\r\n2021-01-25T19:04:20,109 [tserver.TabletServer] INFO : Waiting for tablet server lock\r\n2021-01-25T19:04:20,507 [server.ServerUtil] WARN : System swappiness setting is greater than ten (60) which can cause time-sensitive operations to be delayed. Accumulo is time sensitive because it needs to maintain distributed lock agreement.\r\n2021-01-25T19:04:20,507 [conf.SiteConfiguration] INFO : Found Accumulo configuration on classpath at /home/ubuntu/git-local/fluo-uno/install/accumulo-2.1.0-SNAPSHOT/conf/accumulo.properties\r\n2021-01-25T19:04:20,523 [fs.VolumeManager] DEBUG: Trying to read instance id from hdfs://localhost:8020/accumulo/instance_id\r\n2021-01-25T19:04:24,863 [server.GarbageCollectionLogger] DEBUG: gc G1 Young Generation=0.09(+0.00) secs G1 Old Generation=0.04(+0.00) secs freemem=707,227,944(-21,278,184) totalmem=805,306,368\r\n2021-01-25T19:04:25,138 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] Ephemeral node /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000013 created\r\n2021-01-25T19:04:25,139 [zookeeper.ZooLock] TRACE: Children nodes\r\n2021-01-25T19:04:25,139 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000002\r\n2021-01-25T19:04:25,139 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000003\r\n2021-01-25T19:04:25,139 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000004\r\n2021-01-25T19:04:25,139 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000005\r\n2021-01-25T19:04:25,139 [zookeeper.ZooLock] TRACE: - zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000010\r\n2021-01-25T19:04:25,139 [zookeeper.ZooLock] TRACE: - zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000011\r\n2021-01-25T19:04:25,139 [zookeeper.ZooLock] TRACE: - zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000012\r\n2021-01-25T19:04:25,139 [zookeeper.ZooLock] TRACE: - zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000013\r\n```\r\n\r\nThe above pattern continued until the following happened.\r\n\r\n```\r\n2021-01-25T19:06:15,889 [zookeeper.ZooLock] TRACE: Children nodes\r\n2021-01-25T19:06:15,889 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000002\r\n2021-01-25T19:06:15,889 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000003\r\n2021-01-25T19:06:15,889 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000004\r\n2021-01-25T19:06:15,889 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000005\r\n2021-01-25T19:06:15,889 [zookeeper.ZooLock] TRACE: - zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000098\r\n2021-01-25T19:06:15,889 [zookeeper.ZooLock] TRACE: - zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000099\r\n2021-01-25T19:06:15,889 [zookeeper.ZooLock] TRACE: - zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000100\r\n2021-01-25T19:06:15,889 [zookeeper.ZooLock] TRACE: - zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000101\r\n2021-01-25T19:06:15,889 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] lowest sequential node found: /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000098\r\n2021-01-25T19:06:15,889 [zookeeper.ZooLock] INFO : [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] Zookeeper client missed server response, multiple ephemeral child nodes created at /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#\r\n2021-01-25T19:06:15,889 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] higher sequential node found: zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000099, deleting it\r\n2021-01-25T19:06:15,891 [zookeeper.ZooLock] INFO : [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] Zookeeper client missed server response, multiple ephemeral child nodes created at /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#\r\n2021-01-25T19:06:15,891 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] higher sequential node found: zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000100, deleting it\r\n2021-01-25T19:06:15,892 [zookeeper.ZooLock] INFO : [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] Zookeeper client missed server response, multiple ephemeral child nodes created at /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#\r\n2021-01-25T19:06:15,892 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] higher sequential node found: zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000101, deleting it\r\n2021-01-25T19:06:15,895 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] Setting watcher on /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000098\r\n2021-01-25T19:06:15,897 [zookeeper.ZooLock] TRACE: Children nodes\r\n2021-01-25T19:06:15,897 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000002\r\n2021-01-25T19:06:15,897 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000003\r\n2021-01-25T19:06:15,897 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000004\r\n2021-01-25T19:06:15,897 [zookeeper.ZooLock] TRACE: - zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000005\r\n2021-01-25T19:06:15,897 [zookeeper.ZooLock] TRACE: - zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000098\r\n2021-01-25T19:06:15,897 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] Establishing watch on prior node /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#93852053-1721-4f2a-a8fe-ee4b9398389e#0000000002\r\n2021-01-25T19:06:15,897 [zookeeper.ZooLock] TRACE: [zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#] Deleting all at path: /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/tservers/accumulo:9997/zlock#252a29a2-a14d-4c10-9b61-01387d829ba5#0000000098\r\n2021-01-25T19:06:15,899 [tserver.TabletServer] INFO : Waiting for tablet server lock\r\n2021-01-25T19:06:19,557 [vfs.ContextManager] DEBUG: Managed Contexts: {}\r\n2021-01-25T19:06:19,557 [vfs.ContextManager] DEBUG: Configured Contexts: []\r\n2021-01-25T19:06:19,557 [vfs.ContextManager] DEBUG: Closing contexts: {}\r\n2021-01-25T19:06:19,740 [lru.LruBlockCache] DEBUG: Cache Stats: Sizes: Total=0.013473511MB (14128), Free=191.98653MB (201312464), Max=192.0MB (201326592), Counts: Blocks=0, Access=0, Hit=0, Miss=0, Evictions=0, Evicted=0,Ratios: Hit Ratio=NaN%, Miss Ratio=NaN%, Evicted/Run=NaN, Duplicate Reads=0\r\n2021-01-25T19:06:19,741 [lru.LruBlockCache] DEBUG: Cache Stats: Sizes: Total=0.0061035156MB (6400), Free=76.7939MB (80524236), Max=76.8MB (80530636), Counts: Blocks=0, Access=0, Hit=0, Miss=0, Evictions=0, Evicted=0,Ratios: Hit Ratio=NaN%, Miss Ratio=NaN%, Evicted/Run=NaN, Duplicate Reads=0\r\n2021-01-25T19:06:19,757 [lru.LruBlockCache] DEBUG: Cache Stats: Sizes: Total=0.0061035156MB (6400), Free=76.7939MB (80524236), Max=76.8MB (80530636), Counts: Blocks=0, Access=0, Hit=0, Miss=0, Evictions=0, Evicted=0,Ratios: Hit Ratio=NaN%, Miss Ratio=NaN%, Evicted/Run=NaN, Duplicate Reads=0\r\n2021-01-25T19:06:20,091 [server.GarbageCollectionLogger] DEBUG: gc G1 Young Generation=0.09(+0.00) secs G1 Old Generation=0.04(+0.00) secs freemem=684,956,760(-43,549,368) totalmem=805,306,368\r\n2021-01-25T19:06:20,911 [tserver.TabletServer] INFO : Too many retries, exiting.\r\n2021-01-25T19:06:20,912 [tserver.TabletServer] INFO : Could not obtain tablet server lock, exiting.\r\njava.lang.RuntimeException: Too many retries, exiting.\r\n        at org.apache.accumulo.tserver.TabletServer.announceExistence(TabletServer.java:679) ~[accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n        at org.apache.accumulo.tserver.TabletServer.run(TabletServer.java:740) ~[accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n        at java.lang.Thread.run(Thread.java:834) [?:?]\r\n2021-01-25T19:06:20,915 [start.Main] ERROR: Thread 'tserver' died.\r\njava.lang.RuntimeException: java.lang.RuntimeException: Too many retries, exiting.\r\n        at org.apache.accumulo.tserver.TabletServer.announceExistence(TabletServer.java:682) ~[accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n        at org.apache.accumulo.tserver.TabletServer.run(TabletServer.java:740) ~[accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n        at java.lang.Thread.run(Thread.java:834) [?:?]\r\nCaused by: java.lang.RuntimeException: Too many retries, exiting.\r\n        at org.apache.accumulo.tserver.TabletServer.announceExistence(TabletServer.java:679) ~[accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n        ... 2 more\r\n```\r\n\r\nDoes this seem like what you would expect?\r\n","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767195554/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767196667","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-767196667","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":767196667,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzE5NjY2Nw==","user":{"login":"keith-turner","id":1268739,"node_id":"MDQ6VXNlcjEyNjg3Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1268739?v=4","gravatar_id":"","url":"https://api.github.com/users/keith-turner","html_url":"https://github.com/keith-turner","followers_url":"https://api.github.com/users/keith-turner/followers","following_url":"https://api.github.com/users/keith-turner/following{/other_user}","gists_url":"https://api.github.com/users/keith-turner/gists{/gist_id}","starred_url":"https://api.github.com/users/keith-turner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keith-turner/subscriptions","organizations_url":"https://api.github.com/users/keith-turner/orgs","repos_url":"https://api.github.com/users/keith-turner/repos","events_url":"https://api.github.com/users/keith-turner/events{/privacy}","received_events_url":"https://api.github.com/users/keith-turner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T00:18:46Z","updated_at":"2021-01-26T00:18:46Z","author_association":"CONTRIBUTOR","body":"> Are you able to start 2 masters?\r\n\r\nI can look into that.  That would be a good thing to try.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767196667/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767196806","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-767196806","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":767196806,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzE5NjgwNg==","user":{"login":"dlmarion","id":567911,"node_id":"MDQ6VXNlcjU2NzkxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/567911?v=4","gravatar_id":"","url":"https://api.github.com/users/dlmarion","html_url":"https://github.com/dlmarion","followers_url":"https://api.github.com/users/dlmarion/followers","following_url":"https://api.github.com/users/dlmarion/following{/other_user}","gists_url":"https://api.github.com/users/dlmarion/gists{/gist_id}","starred_url":"https://api.github.com/users/dlmarion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dlmarion/subscriptions","organizations_url":"https://api.github.com/users/dlmarion/orgs","repos_url":"https://api.github.com/users/dlmarion/repos","events_url":"https://api.github.com/users/dlmarion/events{/privacy}","received_events_url":"https://api.github.com/users/dlmarion/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T00:19:10Z","updated_at":"2021-01-26T00:19:10Z","author_association":"CONTRIBUTOR","body":"Yes, that's what I would expect. The ephemeral nodes that you created had the \"lock\" because they had a lower sequence number. It cleaned up the extra ephemeral nodes that were created by the \"missed\" server responses, then it put a watcher on the lowest sequence number of the prior ephemeral node.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767196806/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767199022","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-767199022","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":767199022,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzE5OTAyMg==","user":{"login":"keith-turner","id":1268739,"node_id":"MDQ6VXNlcjEyNjg3Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1268739?v=4","gravatar_id":"","url":"https://api.github.com/users/keith-turner","html_url":"https://github.com/keith-turner","followers_url":"https://api.github.com/users/keith-turner/followers","following_url":"https://api.github.com/users/keith-turner/following{/other_user}","gists_url":"https://api.github.com/users/keith-turner/gists{/gist_id}","starred_url":"https://api.github.com/users/keith-turner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keith-turner/subscriptions","organizations_url":"https://api.github.com/users/keith-turner/orgs","repos_url":"https://api.github.com/users/keith-turner/repos","events_url":"https://api.github.com/users/keith-turner/events{/privacy}","received_events_url":"https://api.github.com/users/keith-turner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T00:25:38Z","updated_at":"2021-01-26T00:26:47Z","author_association":"CONTRIBUTOR","body":"> It cleaned up the extra ephemeral nodes that were created by the \"missed\" server responses, then it put a watcher on the lowest sequence number of the prior ephemeral node.\r\n\r\nYeah that seems to be working really well. I need to try to delete the ephemeral nodes I created (while the tserver is starting up).  I was curious about the repeated creation of ephemeral nodes and then the tserver dying.  That is probably caused by code outside zooklock in the tserver, was wondering if you had looked at that and if that was working in a way you would expect.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767199022/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767199913","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-767199913","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":767199913,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzE5OTkxMw==","user":{"login":"dlmarion","id":567911,"node_id":"MDQ6VXNlcjU2NzkxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/567911?v=4","gravatar_id":"","url":"https://api.github.com/users/dlmarion","html_url":"https://github.com/dlmarion","followers_url":"https://api.github.com/users/dlmarion/followers","following_url":"https://api.github.com/users/dlmarion/following{/other_user}","gists_url":"https://api.github.com/users/dlmarion/gists{/gist_id}","starred_url":"https://api.github.com/users/dlmarion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dlmarion/subscriptions","organizations_url":"https://api.github.com/users/dlmarion/orgs","repos_url":"https://api.github.com/users/dlmarion/repos","events_url":"https://api.github.com/users/dlmarion/events{/privacy}","received_events_url":"https://api.github.com/users/dlmarion/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T00:27:58Z","updated_at":"2021-01-26T00:27:58Z","author_association":"CONTRIBUTOR","body":">  That is probably caused by code outside zooklock in the tserver, was wondering if you had looked at that and if that was working in a way you would expect.\r\n\r\nI believe the code outside of ZooLock in the TServer is what caused the TServer to die after some period of time without the lock. I did not look at that code as I assume that functionality would be the same.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767199913/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767201470","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-767201470","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":767201470,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzIwMTQ3MA==","user":{"login":"keith-turner","id":1268739,"node_id":"MDQ6VXNlcjEyNjg3Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1268739?v=4","gravatar_id":"","url":"https://api.github.com/users/keith-turner","html_url":"https://github.com/keith-turner","followers_url":"https://api.github.com/users/keith-turner/followers","following_url":"https://api.github.com/users/keith-turner/following{/other_user}","gists_url":"https://api.github.com/users/keith-turner/gists{/gist_id}","starred_url":"https://api.github.com/users/keith-turner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keith-turner/subscriptions","organizations_url":"https://api.github.com/users/keith-turner/orgs","repos_url":"https://api.github.com/users/keith-turner/repos","events_url":"https://api.github.com/users/keith-turner/events{/privacy}","received_events_url":"https://api.github.com/users/keith-turner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T00:32:17Z","updated_at":"2021-01-26T00:32:17Z","author_association":"CONTRIBUTOR","body":"> I believe the code outside of ZooLock in the TServer is what caused the TServer to die after some period of time without the lock.  I did not look at that code as I assume that functionality would be the same.\r\n\r\nIf interested I found the code that is doing that.\r\n\r\nhttps://github.com/apache/accumulo/blob/680886a61158fe0906424f9fe43c2916f1f9f48f/server/tserver/src/main/java/org/apache/accumulo/tserver/TabletServer.java#L665-L676","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767201470/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767225146","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-767225146","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":767225146,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzIyNTE0Ng==","user":{"login":"keith-turner","id":1268739,"node_id":"MDQ6VXNlcjEyNjg3Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1268739?v=4","gravatar_id":"","url":"https://api.github.com/users/keith-turner","html_url":"https://github.com/keith-turner","followers_url":"https://api.github.com/users/keith-turner/followers","following_url":"https://api.github.com/users/keith-turner/following{/other_user}","gists_url":"https://api.github.com/users/keith-turner/gists{/gist_id}","starred_url":"https://api.github.com/users/keith-turner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keith-turner/subscriptions","organizations_url":"https://api.github.com/users/keith-turner/orgs","repos_url":"https://api.github.com/users/keith-turner/repos","events_url":"https://api.github.com/users/keith-turner/events{/privacy}","received_events_url":"https://api.github.com/users/keith-turner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T01:37:35Z","updated_at":"2021-01-26T01:37:35Z","author_association":"CONTRIBUTOR","body":"@dlmarion I ran a test w/ the manager and my modifications to zoolock, it went great.\r\n\r\nI did the following in zkCli.sh while Accumulo was stopped to create a few fake lock nodes.  This was similar to running 2 managers as you suggested, but I wanted to see what would happen w/ multiple ephemeral nodes that slowly go away. Zoolock would delete them too quickly if I started two managers.\r\n\r\n```\r\n[zk: localhost:2181(CONNECTED) 2] addauth digest accumulo:uno\r\n[zk: localhost:2181(CONNECTED) 3] create -s -e /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585# accumulo:9999\r\nCreated /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000004\r\n[zk: localhost:2181(CONNECTED) 4] create -s -e /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585# accumulo:9999\r\nCreated /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000005\r\n[zk: localhost:2181(CONNECTED) 5] create -s -e /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585# accumulo:9999\r\nCreated /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000006\r\n```\r\n\r\nThen I started Accumulo and saw the following in the manager logs.\r\n\r\n```\r\n2021-01-25T20:23:00,947 [master.Master] INFO : trying to get master lock\r\n2021-01-25T20:23:00,967 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] Ephemeral node /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#b6820baf-762d-4078-baef-dfbae8130606#0000000010 created\r\n2021-01-25T20:23:00,974 [zookeeper.ZooLock] TRACE: Children nodes\r\n2021-01-25T20:23:00,974 [zookeeper.ZooLock] TRACE: - zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000004\r\n2021-01-25T20:23:00,974 [zookeeper.ZooLock] TRACE: - zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000005\r\n2021-01-25T20:23:00,974 [zookeeper.ZooLock] TRACE: - zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000006\r\n2021-01-25T20:23:00,974 [zookeeper.ZooLock] TRACE: - zlock#b6820baf-762d-4078-baef-dfbae8130606#0000000007\r\n2021-01-25T20:23:00,975 [zookeeper.ZooLock] TRACE: - zlock#b6820baf-762d-4078-baef-dfbae8130606#0000000008\r\n2021-01-25T20:23:00,975 [zookeeper.ZooLock] TRACE: - zlock#b6820baf-762d-4078-baef-dfbae8130606#0000000009\r\n2021-01-25T20:23:00,975 [zookeeper.ZooLock] TRACE: - zlock#b6820baf-762d-4078-baef-dfbae8130606#0000000010\r\n2021-01-25T20:23:00,975 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] lowest sequential node found: /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#b6820baf-762d-4078-baef-dfbae8130606#0000000007\r\n2021-01-25T20:23:00,975 [zookeeper.ZooLock] INFO : [zlock#b6820baf-762d-4078-baef-dfbae8130606#] Zookeeper client missed server response, multiple ephemeral child nodes created at /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#b6820baf-762d-4078-baef-\r\ndfbae8130606#\r\n2021-01-25T20:23:00,975 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] higher sequential node found: zlock#b6820baf-762d-4078-baef-dfbae8130606#0000000008, deleting it\r\n2021-01-25T20:23:00,979 [zookeeper.ZooLock] INFO : [zlock#b6820baf-762d-4078-baef-dfbae8130606#] Zookeeper client missed server response, multiple ephemeral child nodes created at /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#b6820baf-762d-4078-baef-\r\ndfbae8130606#\r\n2021-01-25T20:23:00,979 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] higher sequential node found: zlock#b6820baf-762d-4078-baef-dfbae8130606#0000000009, deleting it\r\n2021-01-25T20:23:00,985 [zookeeper.ZooLock] INFO : [zlock#b6820baf-762d-4078-baef-dfbae8130606#] Zookeeper client missed server response, multiple ephemeral child nodes created at /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#b6820baf-762d-4078-baef-\r\ndfbae8130606#\r\n2021-01-25T20:23:00,985 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] higher sequential node found: zlock#b6820baf-762d-4078-baef-dfbae8130606#0000000010, deleting it\r\n2021-01-25T20:23:00,988 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] Setting watcher on /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#b6820baf-762d-4078-baef-dfbae8130606#0000000007\r\n2021-01-25T20:23:00,993 [zookeeper.ZooLock] TRACE: Children nodes\r\n2021-01-25T20:23:00,993 [zookeeper.ZooLock] TRACE: - zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000004\r\n2021-01-25T20:23:00,993 [zookeeper.ZooLock] TRACE: - zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000005\r\n2021-01-25T20:23:00,993 [zookeeper.ZooLock] TRACE: - zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000006\r\n2021-01-25T20:23:00,993 [zookeeper.ZooLock] TRACE: - zlock#b6820baf-762d-4078-baef-dfbae8130606#0000000007\r\n2021-01-25T20:23:00,994 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] Establishing watch on prior node /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000004\r\n```\r\n\r\nIn zkCli.sh I did the following\r\n\r\n```\r\n[zk: localhost:2181(CONNECTED) 6] delete /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000004\r\n```\r\n\r\nAfter that I saw the following in manager logs.\r\n\r\n```\r\n2021-01-25T20:24:39,724 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] Processing event:\r\n2021-01-25T20:24:39,724 [zookeeper.ZooLock] TRACE: - type  NodeDeleted\r\n2021-01-25T20:24:39,724 [zookeeper.ZooLock] TRACE: - path  /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000004\r\n2021-01-25T20:24:39,724 [zookeeper.ZooLock] TRACE: - state SyncConnected\r\n2021-01-25T20:24:39,724 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] Detected deletion of prior node /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000004, attempting to acquire lock\r\n2021-01-25T20:24:39,725 [zookeeper.ZooLock] TRACE: Children nodes\r\n2021-01-25T20:24:39,725 [zookeeper.ZooLock] TRACE: - zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000005\r\n2021-01-25T20:24:39,725 [zookeeper.ZooLock] TRACE: - zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000006\r\n2021-01-25T20:24:39,725 [zookeeper.ZooLock] TRACE: - zlock#b6820baf-762d-4078-baef-dfbae8130606#0000000007\r\n2021-01-25T20:24:39,725 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] Establishing watch on prior node /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000005\r\n```\r\n\r\nThen I did the following in zkCli.sh\r\n\r\n```\r\n[zk: localhost:2181(CONNECTED) 7] delete /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000005\r\n```\r\n\r\nThen I saw the following in the master logs.\r\n\r\n```\r\n2021-01-25T20:25:05,763 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] Processing event:\r\n2021-01-25T20:25:05,763 [zookeeper.ZooLock] TRACE: - type  NodeDeleted\r\n2021-01-25T20:25:05,763 [zookeeper.ZooLock] TRACE: - path  /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000005\r\n2021-01-25T20:25:05,764 [zookeeper.ZooLock] TRACE: - state SyncConnected\r\n2021-01-25T20:25:05,764 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] Detected deletion of prior node /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000005, attempting to acquire lock\r\n2021-01-25T20:25:05,764 [zookeeper.ZooLock] TRACE: Children nodes\r\n2021-01-25T20:25:05,764 [zookeeper.ZooLock] TRACE: - zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000006\r\n2021-01-25T20:25:05,764 [zookeeper.ZooLock] TRACE: - zlock#b6820baf-762d-4078-baef-dfbae8130606#0000000007\r\n2021-01-25T20:25:05,764 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] Establishing watch on prior node /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000006\r\n```\r\n\r\nThen I deleted the final fake lock node I had created in zkCli.sh\r\n\r\n```\r\n[zk: localhost:2181(CONNECTED) 8] delete /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000006\r\n```\r\n\r\nAfter that the manager got the lock and started managing.\r\n\r\n```\r\n2021-01-25T20:25:30,053 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] Processing event:\r\n2021-01-25T20:25:30,053 [zookeeper.ZooLock] TRACE: - type  NodeDeleted\r\n2021-01-25T20:25:30,053 [zookeeper.ZooLock] TRACE: - path  /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000006\r\n2021-01-25T20:25:30,053 [zookeeper.ZooLock] TRACE: - state SyncConnected\r\n2021-01-25T20:25:30,053 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] Detected deletion of prior node /accumulo/3cad24a9-53a9-4a6a-a846-ba24c5d747b9/masters/lock/zlock#d617d244-3ecc-43e6-8cc5-f140ca234585#0000000006, attempting to acquire lock\r\n2021-01-25T20:25:30,054 [zookeeper.ZooLock] TRACE: Children nodes\r\n2021-01-25T20:25:30,054 [zookeeper.ZooLock] TRACE: - zlock#b6820baf-762d-4078-baef-dfbae8130606#0000000007\r\n2021-01-25T20:25:30,054 [zookeeper.ZooLock] TRACE: [zlock#b6820baf-762d-4078-baef-dfbae8130606#] First candidate is my lock, acquiring\r\n2021-01-25T20:25:30,054 [master.Master] DEBUG: Acquired master lock\r\n2021-01-25T20:25:30,055 [master.EventCoordinator] INFO : State changed from INITIAL to HAVE_LOCK\r\n2021-01-25T20:25:30,092 [master.EventCoordinator] INFO : State changed from HAVE_LOCK to NORMAL\r\n```","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767225146/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767228304","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-767228304","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":767228304,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzIyODMwNA==","user":{"login":"keith-turner","id":1268739,"node_id":"MDQ6VXNlcjEyNjg3Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1268739?v=4","gravatar_id":"","url":"https://api.github.com/users/keith-turner","html_url":"https://github.com/keith-turner","followers_url":"https://api.github.com/users/keith-turner/followers","following_url":"https://api.github.com/users/keith-turner/following{/other_user}","gists_url":"https://api.github.com/users/keith-turner/gists{/gist_id}","starred_url":"https://api.github.com/users/keith-turner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keith-turner/subscriptions","organizations_url":"https://api.github.com/users/keith-turner/orgs","repos_url":"https://api.github.com/users/keith-turner/repos","events_url":"https://api.github.com/users/keith-turner/events{/privacy}","received_events_url":"https://api.github.com/users/keith-turner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T01:47:56Z","updated_at":"2021-01-26T01:47:56Z","author_association":"CONTRIBUTOR","body":"@dlmarion I am almost finished reviewing this.  I have not looked at the test yet (my least favorite thing to review, but I think one of the more important things to review) and I want to go over the changes in zoolock once more.  Hope to finish up reviewing it in the morning.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767228304/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767234811","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-767234811","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":767234811,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzIzNDgxMQ==","user":{"login":"dlmarion","id":567911,"node_id":"MDQ6VXNlcjU2NzkxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/567911?v=4","gravatar_id":"","url":"https://api.github.com/users/dlmarion","html_url":"https://github.com/dlmarion","followers_url":"https://api.github.com/users/dlmarion/followers","following_url":"https://api.github.com/users/dlmarion/following{/other_user}","gists_url":"https://api.github.com/users/dlmarion/gists{/gist_id}","starred_url":"https://api.github.com/users/dlmarion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dlmarion/subscriptions","organizations_url":"https://api.github.com/users/dlmarion/orgs","repos_url":"https://api.github.com/users/dlmarion/repos","events_url":"https://api.github.com/users/dlmarion/events{/privacy}","received_events_url":"https://api.github.com/users/dlmarion/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T02:07:28Z","updated_at":"2021-01-26T02:07:28Z","author_association":"CONTRIBUTOR","body":"That last test that you did with the three fake locks that you removed one at a time was a good test. I think you will find that it mirrors my parallel test to some degree. Thanks for testing this out, that gives me some confidence that I didn't break things even though my tests are working. I have a couple of items that you mentioned above, let me know what else you find. Thanks.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767234811/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767294128","html_url":"https://github.com/apache/accumulo/issues/1791#issuecomment-767294128","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1791","id":767294128,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzI5NDEyOA==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T04:49:25Z","updated_at":"2021-01-26T04:49:25Z","author_association":"MEMBER","body":"Hmm, based on where it's failing, it seems like it's possible that not all tablets are yet marked as suspended. The loop condition on line 213 only waits until there's *some* suspended tablets for at least two tservers that were killed. However, it doesn't loop until *all* tablets hosted on those tservers are marked as suspended, which is the check on line 225 that is failing.\r\n\r\nThe comment above line 225 says \"All suspended tablets should \"belong\" to the dead tablet servers\". However, it's not actually checking for that... what it's checking for is that \"all tablets belonging to the dead tablet servers are now suspended\"... but that's not a condition that we waited for in the loop at line 213.\r\n\r\nWe can probably wait for all tablets assigned to the dead tserver to be marked as suspended OR we can relax the check on line 225 to only verify what is in the comment, and not assume that all of them that had been assigned to that tserver have been suspended yet.\r\n\r\nThis is just a hunch, though, that not all the tablets have yet been marked as suspended. You could verify this hunch by checking the state of the other tablets that were assigned to the dead tserver when the equality check on line 225 would have failed (something like replacing `assertEquals` with `if not equals, then dump ds.hosted and fail()`).","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767294128/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767337152","html_url":"https://github.com/apache/accumulo/pull/1873#issuecomment-767337152","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1873","id":767337152,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzMzNzE1Mg==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T06:38:20Z","updated_at":"2021-01-26T06:41:03Z","author_association":"MEMBER","body":"@brianloss Assuming you're the one who will merge this in the end, don't forget to clean up the commit log message subject and body when squashing/merging. Some suggestions to include in that cleanup:\r\n\r\n* If you merge from the GitHub UI (which I recommend), GitHub will automatically append `(#1873)` to the end of the subject line (which is very helpful and should be preserved). If you merge manually from your CLI, then you should add that manually so there is a reference back to this PR from the git history.\r\n* The `(fixes #1640)` portion of the subject that you added to the initial commit can be moved to the body of the commit log message.\r\n* Most of the commit messages in my contributions to this PR were only useful in comparison to what they were amending. They won't be useful in the final commit, so they should be excluded. (though, feel free to preserve any 'co-authored-by' lines if you wish.\r\n* The end result should be a single commit with a commit message that just describes what that one commit changes, and not all the intermediate stuff that occurred during the PR / code review. By default, GitHub's UI will concatenate the log messages from every commit in this PR when it squashes... but that will create a monstrosity of a log message that will not be very friendly in future. Luckily, it also gives an opportunity to edit the message before submitting the squashed commit. Editing the message down to just what the final commit actually does will be more useful as a summary for future git archeological tasks.\r\n\r\nFor general reference, I always refer to https://chris.beams.io/posts/git-commit/ for writing good commit messages.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767337152/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767532028","html_url":"https://github.com/apache/accumulo/issues/1872#issuecomment-767532028","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1872","id":767532028,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzUzMjAyOA==","user":{"login":"EdColeman","id":7047700,"node_id":"MDQ6VXNlcjcwNDc3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/7047700?v=4","gravatar_id":"","url":"https://api.github.com/users/EdColeman","html_url":"https://github.com/EdColeman","followers_url":"https://api.github.com/users/EdColeman/followers","following_url":"https://api.github.com/users/EdColeman/following{/other_user}","gists_url":"https://api.github.com/users/EdColeman/gists{/gist_id}","starred_url":"https://api.github.com/users/EdColeman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/EdColeman/subscriptions","organizations_url":"https://api.github.com/users/EdColeman/orgs","repos_url":"https://api.github.com/users/EdColeman/repos","events_url":"https://api.github.com/users/EdColeman/events{/privacy}","received_events_url":"https://api.github.com/users/EdColeman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T13:12:01Z","updated_at":"2021-01-26T13:12:01Z","author_association":"CONTRIBUTOR","body":"When you say client, are you thinking the shell?  How would you handle this for automated clients? Feedback could be an intermediate step, but I think the desired behavior in almost all cases would be to terminate any outstanding operations and delete as quickly as possible.  \r\n\r\nIs there any value in waiting for a compaction to complete if the next thing to happen is that the table / file is deleted?  ","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767532028/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767551325","html_url":"https://github.com/apache/accumulo/pull/1873#issuecomment-767551325","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1873","id":767551325,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzU1MTMyNQ==","user":{"login":"brianloss","id":5400335,"node_id":"MDQ6VXNlcjU0MDAzMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5400335?v=4","gravatar_id":"","url":"https://api.github.com/users/brianloss","html_url":"https://github.com/brianloss","followers_url":"https://api.github.com/users/brianloss/followers","following_url":"https://api.github.com/users/brianloss/following{/other_user}","gists_url":"https://api.github.com/users/brianloss/gists{/gist_id}","starred_url":"https://api.github.com/users/brianloss/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brianloss/subscriptions","organizations_url":"https://api.github.com/users/brianloss/orgs","repos_url":"https://api.github.com/users/brianloss/repos","events_url":"https://api.github.com/users/brianloss/events{/privacy}","received_events_url":"https://api.github.com/users/brianloss/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T13:47:21Z","updated_at":"2021-01-26T13:47:21Z","author_association":"MEMBER","body":"@ctubbsii, it's all merged. Unfortunately the first time I tried to merge GitHub failed and told me I had to refresh the page. When I tried again, I forgot to remove the fixes marker from the commit title, but did follow your other suggestions.\r\n\r\nThanks for all of the feedback, help, and willingness to engage in debate over this issue.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767551325/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767566557","html_url":"https://github.com/apache/accumulo/issues/1872#issuecomment-767566557","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1872","id":767566557,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzU2NjU1Nw==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T14:11:29Z","updated_at":"2021-01-26T14:11:29Z","author_association":"CONTRIBUTOR","body":"> When you say client, are you thinking the shell? How would you handle this for automated clients? Feedback could be an intermediate step, but I think the desired behavior in almost all cases would be to terminate any outstanding operations and delete as quickly as possible.\r\n\r\nI was thinking of adding to the API, which could definitely be added to the Shell as a new command. We could add another API method (similar to how `flush` evolved) to evolve the current delete method.\r\n\r\nIn TableOperations.java:\r\n`  @Deprecated  \r\nvoid delete(String tableName)`\r\n`@since 2.1\r\nvoid delete(String tableName, boolean wait)`\r\n\r\n> Is there any value in waiting for a compaction to complete if the next thing to happen is that the table / file is deleted?\r\n\r\nNo that I know of but perhaps Keith may know of a reason.  There are checks in place for the compaction to cancel (see Keith's comments above) but I don't think they are foolproof since it depends on where along in the compaction process the delete occurs. ","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767566557/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767568385","html_url":"https://github.com/apache/accumulo/issues/1872#issuecomment-767568385","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1872","id":767568385,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzU2ODM4NQ==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T14:14:24Z","updated_at":"2021-01-26T14:14:24Z","author_association":"CONTRIBUTOR","body":"> I think the desired behavior in almost all cases would be to terminate any outstanding operations and delete as quickly as possible.\r\n\r\nI agree but I think we are seeing that this isn't always realistic since a highly active cluster can become gummed up with the way Accumulo is designed to cautiously delete tables and clean up afterwards.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767568385/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767577137","html_url":"https://github.com/apache/accumulo/issues/1086#issuecomment-767577137","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1086","id":767577137,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzU3NzEzNw==","user":{"login":"dlmarion","id":567911,"node_id":"MDQ6VXNlcjU2NzkxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/567911?v=4","gravatar_id":"","url":"https://api.github.com/users/dlmarion","html_url":"https://github.com/dlmarion","followers_url":"https://api.github.com/users/dlmarion/followers","following_url":"https://api.github.com/users/dlmarion/following{/other_user}","gists_url":"https://api.github.com/users/dlmarion/gists{/gist_id}","starred_url":"https://api.github.com/users/dlmarion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dlmarion/subscriptions","organizations_url":"https://api.github.com/users/dlmarion/orgs","repos_url":"https://api.github.com/users/dlmarion/repos","events_url":"https://api.github.com/users/dlmarion/events{/privacy}","received_events_url":"https://api.github.com/users/dlmarion/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T14:27:58Z","updated_at":"2021-01-26T14:28:21Z","author_association":"CONTRIBUTOR","body":"Created [PR](https://github.com/dlmarion/accumulo/pull/3) against the [637-validate-lock-acquired](https://github.com/apache/accumulo/pull/1866) branch. This new PR modifies ZooLock such that is uses the native ZooKeeper client instead of using ZooReaderWriter.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767577137/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767621584","html_url":"https://github.com/apache/accumulo/issues/1791#issuecomment-767621584","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1791","id":767621584,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzYyMTU4NA==","user":{"login":"DomGarguilo","id":47725857,"node_id":"MDQ6VXNlcjQ3NzI1ODU3","avatar_url":"https://avatars.githubusercontent.com/u/47725857?v=4","gravatar_id":"","url":"https://api.github.com/users/DomGarguilo","html_url":"https://github.com/DomGarguilo","followers_url":"https://api.github.com/users/DomGarguilo/followers","following_url":"https://api.github.com/users/DomGarguilo/following{/other_user}","gists_url":"https://api.github.com/users/DomGarguilo/gists{/gist_id}","starred_url":"https://api.github.com/users/DomGarguilo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DomGarguilo/subscriptions","organizations_url":"https://api.github.com/users/DomGarguilo/orgs","repos_url":"https://api.github.com/users/DomGarguilo/repos","events_url":"https://api.github.com/users/DomGarguilo/events{/privacy}","received_events_url":"https://api.github.com/users/DomGarguilo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T15:30:10Z","updated_at":"2021-01-26T15:30:10Z","author_association":"MEMBER","body":"> Hmm, based on where it's failing, it seems like it's possible that not all tablets are yet marked as suspended. The loop condition on line 213 only waits until there's _some_ suspended tablets for at least two tservers that were killed. However, it doesn't loop until _all_ tablets hosted on those tservers are marked as suspended, which is the check on line 225 that is failing.\r\n\r\nIt does seem like a good idea to wait until _all_ of the suspended tablets are marked as suspended before the assert on 225. I'm not sure that this is contributing to the test failure however, because the assert on line 225 compares the tablet locations before and after the tservers are killed to make sure that the location of the suspended tablets are the same as their hosted location before server death. The problem is that some of the locations of the suspended tablets are unexpected, that is, the suspended locations are on a different server than their hosted locations. Almost all of the time, all of the tablets are accounted for, they are just not in the expected locations.\r\n\r\n> The comment above line 225 says \"All suspended tablets should \"belong\" to the dead tablet servers\". However, it's not actually checking for that... what it's checking for is that \"all tablets belonging to the dead tablet servers are now suspended\"... but that's not a condition that we waited for in the loop at line 213.\r\n\r\nFrom what I can tell, the tablet locations of all servers are recorded, two servers are killed, then the suspended tablets on those dead servers are compared to see if they are in the same location as before the servers were killed.\r\n\r\n> We can probably wait for all tablets assigned to the dead tserver to be marked as suspended OR we can relax the check on line 225 to only verify what is in the comment, and not assume that all of them that had been assigned to that tserver have been suspended yet.\r\n\r\nI think its a good idea to wait for all tablets to be marked as suspended and from what I can tell, the assert does attempt to verify what is claimed in the comment. At the point of the assert, there are generally no tablets that are not suspended.\r\n\r\n> This is just a hunch, though, that not all the tablets have yet been marked as suspended. You could verify this hunch by checking the state of the other tablets that were assigned to the dead tserver when the equality check on line 225 would have failed (something like replacing `assertEquals` with `if not equals, then dump ds.hosted and fail()`).\r\n\r\nI have tried doing something like this and posted the results in an [above comment](https://github.com/apache/accumulo/issues/1791#issuecomment-763099727). It shows the migration of tablets between the two killed servers sometime between their death and the measurement of the suspended tablet locations.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767621584/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767729792","html_url":"https://github.com/apache/accumulo/issues/1791#issuecomment-767729792","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1791","id":767729792,"node_id":"MDEyOklzc3VlQ29tbWVudDc2NzcyOTc5Mg==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T18:12:48Z","updated_at":"2021-01-26T18:12:48Z","author_association":"MEMBER","body":"It was suggested on a private call that extending the suspend duration might be helpful, because it may not be long enough. Also, it may help to ensure the system is initially balanced by creating the table with initial split points, rather than adding split points after the table is created. That could help avoid active migrations before the tservers are taken offline.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767729792/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767766716","html_url":"https://github.com/apache/accumulo/pull/1873#issuecomment-767766716","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1873","id":767766716,"node_id":"MDEyOklzc3VlQ29tbWVudDc2Nzc2NjcxNg==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T19:15:08Z","updated_at":"2021-01-26T19:15:08Z","author_association":"MEMBER","body":"> @ctubbsii, it's all merged. Unfortunately the first time I tried to merge GitHub failed and told me I had to refresh the page.\r\n\r\nNo problem. BTW, @keith-turner had the experience where a merge failed on GitHub, and he was offered the \"retry\" option. However, the \"retry\" converted his squash merge to a merge commit, leaving in some intermediate commits that he didn't want. I mention this in case it happens to you in future, it's best to avoid the \"retry\" option if one is presented by GitHub. Refreshing the page and trying again from the beginning definitely seems safer than an automatic \"retry\" option. Perhaps GitHub fixed that? Personally, I haven't seen this failure from GitHub (yet).","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767766716/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767767952","html_url":"https://github.com/apache/accumulo/issues/1775#issuecomment-767767952","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1775","id":767767952,"node_id":"MDEyOklzc3VlQ29tbWVudDc2Nzc2Nzk1Mg==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T19:17:08Z","updated_at":"2021-01-26T19:17:08Z","author_association":"MEMBER","body":"This was backported to 1.10 in 48e483b6fab9006a224b4630dfdc3449110cb9a0","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767767952/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767770867","html_url":"https://github.com/apache/accumulo/pull/1677#issuecomment-767770867","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1677","id":767770867,"node_id":"MDEyOklzc3VlQ29tbWVudDc2Nzc3MDg2Nw==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T19:22:23Z","updated_at":"2021-01-26T19:22:23Z","author_association":"MEMBER","body":"@dlmarion This was closed as marked as \"Done\" for 2.1.0, but I don't think it was merged. I think it's being addressed via a different approach. Is that correct?","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767770867/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767783669","html_url":"https://github.com/apache/accumulo/issues/1884#issuecomment-767783669","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1884","id":767783669,"node_id":"MDEyOklzc3VlQ29tbWVudDc2Nzc4MzY2OQ==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T19:44:39Z","updated_at":"2021-01-26T19:44:39Z","author_association":"MEMBER","body":"@liusheng While most users probably deploy Accumulo on `x86_64` servers, Accumulo doesn't do a lot that could be considered architecture dependent, so we're probably not aware of any specific problems on ARM64 or other architectures.\r\n\r\nAre you aware of any specific problems with building or running Accumulo on ARM64? If not, I'm not sure what there is to do be done here. If you are aware of such problems, it would be good to create specific bug reports or PRs for each problem.\r\n\r\nIf you'd like to discuss ARM64 support with other users who may be interested in that, I encourage you to discuss it on our user mailing list. If it becomes necessary to discuss large changes to support ARM64 (for smaller changes, a PR is fine), that discussion would be appropriate for our dev mailing list. Information about both mailing lists can be found at https://accumulo.apache.org/contact-us\r\n\r\nRegarding the proposed work to run test cases and CI jobs on ARM64, I think it might be a little premature to devote effort into that, since we're a relatively small community compared to Hadoop and it's not yet clear there is a significant interest or volunteers available to perform that work.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767783669/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767789538","html_url":"https://github.com/apache/accumulo/pull/1677#issuecomment-767789538","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1677","id":767789538,"node_id":"MDEyOklzc3VlQ29tbWVudDc2Nzc4OTUzOA==","user":{"login":"dlmarion","id":567911,"node_id":"MDQ6VXNlcjU2NzkxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/567911?v=4","gravatar_id":"","url":"https://api.github.com/users/dlmarion","html_url":"https://github.com/dlmarion","followers_url":"https://api.github.com/users/dlmarion/followers","following_url":"https://api.github.com/users/dlmarion/following{/other_user}","gists_url":"https://api.github.com/users/dlmarion/gists{/gist_id}","starred_url":"https://api.github.com/users/dlmarion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dlmarion/subscriptions","organizations_url":"https://api.github.com/users/dlmarion/orgs","repos_url":"https://api.github.com/users/dlmarion/repos","events_url":"https://api.github.com/users/dlmarion/events{/privacy}","received_events_url":"https://api.github.com/users/dlmarion/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T19:55:50Z","updated_at":"2021-01-26T19:55:58Z","author_association":"CONTRIBUTOR","body":"I deleted the previous PR and branch as it's being addressed [here](https://github.com/dlmarion/accumulo/pull/3). It looks like `automation` marked it `Done`.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767789538/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767841919","html_url":"https://github.com/apache/accumulo/pull/1480#issuecomment-767841919","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1480","id":767841919,"node_id":"MDEyOklzc3VlQ29tbWVudDc2Nzg0MTkxOQ==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T21:33:25Z","updated_at":"2021-01-26T21:33:25Z","author_association":"CONTRIBUTOR","body":"@keith-turner have you been able to get this logging to work with log4j2?  I believe we have these lines in log4j2-service.properties for the TabletLogger but I am not seeing any Tablet logging when I run Uno. :\r\n<pre>\r\nlogger.accumulo.name = org.apache.accumulo\r\nlogger.accumulo.level = debug\r\n</pre>","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767841919/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767845873","html_url":"https://github.com/apache/accumulo/pull/1480#issuecomment-767845873","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1480","id":767845873,"node_id":"MDEyOklzc3VlQ29tbWVudDc2Nzg0NTg3Mw==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T21:41:19Z","updated_at":"2021-01-26T21:41:19Z","author_association":"MEMBER","body":"> @keith-turner have you been able to get this logging to work with log4j2?\r\n\r\n@milleruntime I confirmed it was working in my comment at https://github.com/apache/accumulo/pull/1881#discussion_r564850362","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767845873/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767857981","html_url":"https://github.com/apache/accumulo/pull/1480#issuecomment-767857981","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1480","id":767857981,"node_id":"MDEyOklzc3VlQ29tbWVudDc2Nzg1Nzk4MQ==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-26T22:05:18Z","updated_at":"2021-01-26T22:05:18Z","author_association":"CONTRIBUTOR","body":"Nevermind @keith-turner , I was running a build from an experimental branch I have and I guess it's not behaving correctly. I built again from main branch and am now seeing all the logging. Sorry!","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/767857981/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768247124","html_url":"https://github.com/apache/accumulo/pull/1824#issuecomment-768247124","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1824","id":768247124,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODI0NzEyNA==","user":{"login":"Manno15","id":29436247,"node_id":"MDQ6VXNlcjI5NDM2MjQ3","avatar_url":"https://avatars.githubusercontent.com/u/29436247?v=4","gravatar_id":"","url":"https://api.github.com/users/Manno15","html_url":"https://github.com/Manno15","followers_url":"https://api.github.com/users/Manno15/followers","following_url":"https://api.github.com/users/Manno15/following{/other_user}","gists_url":"https://api.github.com/users/Manno15/gists{/gist_id}","starred_url":"https://api.github.com/users/Manno15/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Manno15/subscriptions","organizations_url":"https://api.github.com/users/Manno15/orgs","repos_url":"https://api.github.com/users/Manno15/repos","events_url":"https://api.github.com/users/Manno15/events{/privacy}","received_events_url":"https://api.github.com/users/Manno15/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-27T12:17:08Z","updated_at":"2021-01-28T14:28:54Z","author_association":"CONTRIBUTOR","body":"I am running into an issue getting these changes to run with zookeeper 3.6.2 on fluo-uno. I will investigate. Specific error below: \r\n\r\n<pre>\r\nException in thread \"shell\" java.lang.UnsatisfiedLinkError: 'int org.fusesource.jansi.internal.CLibrary.ioctl(int, long, org.fusesource.jansi.internal.CLibrary$WinSize)'\r\n\tat org.fusesource.jansi.internal.CLibrary.ioctl(Native Method)\r\n\tat org.jline.terminal.impl.jansi.JansiNativePty.getSize(JansiNativePty.java:146)\r\n\tat org.jline.terminal.impl.AbstractPosixTerminal.getSize(AbstractPosixTerminal.java:60)\r\n\tat org.jline.terminal.Terminal.getBufferSize(Terminal.java:216)\r\n\tat org.jline.reader.impl.LineReaderImpl.doDisplay(LineReaderImpl.java:746)\r\n\tat org.jline.reader.impl.LineReaderImpl.<init>(LineReaderImpl.java:303)\r\n\tat org.jline.reader.LineReaderBuilder.build(LineReaderBuilder.java:115)\r\n\tat org.apache.accumulo.shell.Shell.config(Shell.java:275)\r\n\tat org.apache.accumulo.shell.Shell.execute(Shell.java:520)\r\n\tat org.apache.accumulo.start.Main.lambda$execKeyword$0(Main.java:126)\r\n\tat java.base/java.lang.Thread.run(Thread.java:834)\r\n\r\n</pre>\r\n\r\n\r\nEDIT: My guess is for some reason LineReader is trying to default to using Jansi for the terminal and we don't have the correct libraries for it? I will push a commit that tells the terminal to not allow Jansi so it should default to a different type. I believe the old default type was xterm so not sure why the new zookeeper version updates the default to Jansi.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768247124/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768349093","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-768349093","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":768349093,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODM0OTA5Mw==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-27T15:07:46Z","updated_at":"2021-01-27T15:07:46Z","author_association":"MEMBER","body":"I ran all the ITs with this change and saw ZooLockIT fail with an AssertionError.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768349093/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768350434","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-768350434","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":768350434,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODM1MDQzNA==","user":{"login":"dlmarion","id":567911,"node_id":"MDQ6VXNlcjU2NzkxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/567911?v=4","gravatar_id":"","url":"https://api.github.com/users/dlmarion","html_url":"https://github.com/dlmarion","followers_url":"https://api.github.com/users/dlmarion/followers","following_url":"https://api.github.com/users/dlmarion/following{/other_user}","gists_url":"https://api.github.com/users/dlmarion/gists{/gist_id}","starred_url":"https://api.github.com/users/dlmarion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dlmarion/subscriptions","organizations_url":"https://api.github.com/users/dlmarion/orgs","repos_url":"https://api.github.com/users/dlmarion/repos","events_url":"https://api.github.com/users/dlmarion/events{/privacy}","received_events_url":"https://api.github.com/users/dlmarion/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-27T15:09:43Z","updated_at":"2021-01-27T15:09:43Z","author_association":"CONTRIBUTOR","body":"Do you have any further information? ","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768350434/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768390431","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-768390431","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":768390431,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODM5MDQzMQ==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-27T16:05:41Z","updated_at":"2021-01-27T20:46:49Z","author_association":"MEMBER","body":"> Do you have any further information?\r\n\r\nI have a stack trace, but I'm replying on mobile at the moment and don't have a convenient way to paste it. So, I thought it'd be easier to just mention the failing test so you can try it yourself. I can post the stack trace later if you can't reproduce it.\r\n\r\n<details>\r\n<summary>EDIT: @dlmarion stack trace is below (was for commit f36a90d1158e5c93a2308f6fbf4246883a9b022e, so may be OBE by more recent commits):</summary>\r\n\r\n```java\r\njava.lang.AssertionError\r\n\tat org.junit.Assert.fail(Assert.java:87)\r\n\tat org.junit.Assert.assertTrue(Assert.java:42)\r\n\tat org.junit.Assert.assertFalse(Assert.java:65)\r\n\tat org.junit.Assert.assertFalse(Assert.java:75)\r\n\tat org.apache.accumulo.test.fate.zookeeper.ZooLockIT.testDeleteWaiting(ZooLockIT.java:285)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\r\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\r\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:288)\r\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:282)\r\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n\tat java.base/java.lang.Thread.run(Thread.java:834)\r\n```\r\n\r\nSTDOUT was:\r\n\r\n```\r\n2021-01-27T06:27:55,424 [miniclusterImpl.MiniAccumuloClusterImpl] INFO : Starting MAC against instance miniInstance and zookeeper(s) localhost:44585.\r\n2021-01-27T06:27:59,070 [zookeeper.ZooSession] DEBUG: Connecting to localhost:44585 with timeout 30000 with auth\r\n2021-01-27T06:27:59,089 [common.X509Util] INFO : Setting -D jdk.tls.rejectClientInitiatedRenegotiation=true to disable client-initiated TLS renegotiation\r\n2021-01-27T06:28:00,389 [zookeeper.ZooLock] DEBUG: [zlock#29bc7352-8de9-4704-a1e9-456afa308ace#] Ephemeral node /zltest-1523279423-l1/zlock#29bc7352-8de9-4704-a1e9-456afa308ace#0000000000 created\r\n2021-01-27T06:28:00,397 [zookeeper.ZooLock] DEBUG: Children nodes: 1\r\n2021-01-27T06:28:00,398 [zookeeper.ZooLock] DEBUG: - zlock#29bc7352-8de9-4704-a1e9-456afa308ace#0000000000\r\n2021-01-27T06:28:00,398 [zookeeper.ZooLock] DEBUG: [zlock#29bc7352-8de9-4704-a1e9-456afa308ace#] Setting watcher on /zltest-1523279423-l1/zlock#29bc7352-8de9-4704-a1e9-456afa308ace#0000000000\r\n2021-01-27T06:28:00,402 [zookeeper.ZooLock] DEBUG: Children nodes: 1\r\n2021-01-27T06:28:00,402 [zookeeper.ZooLock] DEBUG: - zlock#29bc7352-8de9-4704-a1e9-456afa308ace#0000000000\r\n2021-01-27T06:28:00,402 [zookeeper.ZooLock] DEBUG: [zlock#29bc7352-8de9-4704-a1e9-456afa308ace#] First candidate is my lock, acquiring...\r\n2021-01-27T06:28:00,406 [zookeeper.ZooLock] DEBUG: [zlock#29bc7352-8de9-4704-a1e9-456afa308ace#] Ephemeral node /zltest-1523279423-l1/zlock#29bc7352-8de9-4704-a1e9-456afa308ace#0000000001 created\r\n2021-01-27T06:28:00,408 [zookeeper.ZooLock] DEBUG: Children nodes: 2\r\n2021-01-27T06:28:00,408 [zookeeper.ZooLock] DEBUG: - zlock#29bc7352-8de9-4704-a1e9-456afa308ace#0000000000\r\n2021-01-27T06:28:00,408 [zookeeper.ZooLock] DEBUG: - zlock#29bc7352-8de9-4704-a1e9-456afa308ace#0000000001\r\n2021-01-27T06:28:00,409 [zookeeper.ZooLock] DEBUG: [zlock#29bc7352-8de9-4704-a1e9-456afa308ace#] lowest sequential node found: /zltest-1523279423-l1/zlock#29bc7352-8de9-4704-a1e9-456afa308ace#0000000000\r\n2021-01-27T06:28:00,409 [zookeeper.ZooLock] INFO : [zlock#29bc7352-8de9-4704-a1e9-456afa308ace#] Zookeeper client missed server response, multiple ephemeral child nodes created at /zltest-1523279423-l1/zlock#29bc7352-8de9-4704-a1e9-456afa308ace#\r\n2021-01-27T06:28:00,409 [zookeeper.ZooLock] DEBUG: [zlock#29bc7352-8de9-4704-a1e9-456afa308ace#] higher sequential node found: zlock#29bc7352-8de9-4704-a1e9-456afa308ace#0000000001, deleting it\r\n2021-01-27T06:28:00,419 [zookeeper.ZooLock] DEBUG: [zlock#29bc7352-8de9-4704-a1e9-456afa308ace#] Setting watcher on /zltest-1523279423-l1/zlock#29bc7352-8de9-4704-a1e9-456afa308ace#0000000000\r\n2021-01-27T06:28:00,424 [zookeeper.ZooLock] DEBUG: Children nodes: 1\r\n2021-01-27T06:28:00,424 [zookeeper.ZooLock] DEBUG: - zlock#29bc7352-8de9-4704-a1e9-456afa308ace#0000000000\r\n2021-01-27T06:28:00,424 [zookeeper.ZooLock] DEBUG: [zlock#29bc7352-8de9-4704-a1e9-456afa308ace#] First candidate is my lock, acquiring...\r\n```\r\n\r\n</details>","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768390431/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768404276","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-768404276","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":768404276,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODQwNDI3Ng==","user":{"login":"dlmarion","id":567911,"node_id":"MDQ6VXNlcjU2NzkxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/567911?v=4","gravatar_id":"","url":"https://api.github.com/users/dlmarion","html_url":"https://github.com/dlmarion","followers_url":"https://api.github.com/users/dlmarion/followers","following_url":"https://api.github.com/users/dlmarion/following{/other_user}","gists_url":"https://api.github.com/users/dlmarion/gists{/gist_id}","starred_url":"https://api.github.com/users/dlmarion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dlmarion/subscriptions","organizations_url":"https://api.github.com/users/dlmarion/orgs","repos_url":"https://api.github.com/users/dlmarion/repos","events_url":"https://api.github.com/users/dlmarion/events{/privacy}","received_events_url":"https://api.github.com/users/dlmarion/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-27T16:26:19Z","updated_at":"2021-01-27T16:26:19Z","author_association":"CONTRIBUTOR","body":"I'm working on that right now.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768404276/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768427260","html_url":"https://github.com/apache/accumulo/issues/1872#issuecomment-768427260","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1872","id":768427260,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODQyNzI2MA==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-27T17:00:59Z","updated_at":"2021-01-27T17:00:59Z","author_association":"CONTRIBUTOR","body":"Created one potential improvement for this here: https://github.com/apache/accumulo/pull/1887","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768427260/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768574469","html_url":"https://github.com/apache/accumulo/issues/1841#issuecomment-768574469","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1841","id":768574469,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODU3NDQ2OQ==","user":{"login":"DomGarguilo","id":47725857,"node_id":"MDQ6VXNlcjQ3NzI1ODU3","avatar_url":"https://avatars.githubusercontent.com/u/47725857?v=4","gravatar_id":"","url":"https://api.github.com/users/DomGarguilo","html_url":"https://github.com/DomGarguilo","followers_url":"https://api.github.com/users/DomGarguilo/followers","following_url":"https://api.github.com/users/DomGarguilo/following{/other_user}","gists_url":"https://api.github.com/users/DomGarguilo/gists{/gist_id}","starred_url":"https://api.github.com/users/DomGarguilo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DomGarguilo/subscriptions","organizations_url":"https://api.github.com/users/DomGarguilo/orgs","repos_url":"https://api.github.com/users/DomGarguilo/repos","events_url":"https://api.github.com/users/DomGarguilo/events{/privacy}","received_events_url":"https://api.github.com/users/DomGarguilo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-27T21:01:17Z","updated_at":"2021-01-27T21:09:55Z","author_association":"MEMBER","body":"I tried pre-splitting the table for this test and saw a huge decrease in the time it takes to complete. I saw a decrease on the order of minutes by pre-splitting the table. It almost doesn't seem like pre-splitting alone would yield these results so I'm a bit sceptical but I think that if pre-splitting is a valid cause of this time decrease then it should be implemented in this test and possibly others as well. I will continue looking into this to see if this time decrease can be trusted.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768574469/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768581325","html_url":"https://github.com/apache/accumulo/issues/1841#issuecomment-768581325","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1841","id":768581325,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODU4MTMyNQ==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-27T21:14:08Z","updated_at":"2021-01-27T21:14:08Z","author_association":"MEMBER","body":"> It almost doesn't seem like pre-splitting alone would yield these results so I'm a bit sceptical but I think that if pre-splitting is a valid cause of this time decrease then it should be implemented in this test and possibly others as well.\r\n\r\nIt can definitely be a huge improvement. It eliminates the need to go through cycles of updating metadata, by taking tablets offline and online and migrating tablets to balance, on each split point added. There are many tests that could possibly benefit from this feature. There's probably only a few that actually need to create the splits after the table already exists. A PR to address that would be a great improvement to see.\r\n","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768581325/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768674007","html_url":"https://github.com/apache/accumulo/pull/1888#issuecomment-768674007","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1888","id":768674007,"node_id":"MDEyOklzc3VlQ29tbWVudDc2ODY3NDAwNw==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-28T00:41:44Z","updated_at":"2021-01-28T00:41:44Z","author_association":"MEMBER","body":"I tried building and running just this single test, and it timed out on my machine. After adding `-Dtimeout.factor=3`, I got past the timeout, but then I ran into:\r\n\r\n<details>\r\n<summary>\r\n\r\n```java\r\n[ERROR] Tests run: 2, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 605.616 s <<< FAILURE! - in org.apache.accumulo.test.master.SuspendedTabletsIT\r\n[ERROR] crashAndResumeTserver(org.apache.accumulo.test.master.SuspendedTabletsIT)  Time elapsed: 347.964 s  <<< FAILURE!\r\n```\r\n\r\n</summary>\r\n\r\n```java\r\njava.lang.AssertionError: Scanning of metadata failed, aborting\r\n\tat org.junit.Assert.fail(Assert.java:89)\r\n\tat org.apache.accumulo.test.master.SuspendedTabletsIT$TabletLocations.retrieve(SuspendedTabletsIT.java:306)\r\n\tat org.apache.accumulo.test.master.SuspendedTabletsIT.suspensionTestBody(SuspendedTabletsIT.java:208)\r\n\tat org.apache.accumulo.test.master.SuspendedTabletsIT.crashAndResumeTserver(SuspendedTabletsIT.java:101)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\r\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\r\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\r\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\r\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:288)\r\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:282)\r\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n\tat java.base/java.lang.Thread.run(Thread.java:834)\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n\r\n<summary>\r\n\r\nInterestingly, the scanning of the metadata failed in this case because a file for the metadata was deleted by the garbage collector about a minute before the TabletServer needed it to scan for metadata. I'm not sure how that happened:\r\n\r\n</summary>\r\n\r\n```java\r\n2021-01-27T17:59:14,161 [gc.SimpleGarbageCollector] DEBUG: Deleting file:/home/christopher/git/apache/accumulo/accumulo/test/target/mini-tests/org.apache.accumulo.test.master.SuspendedTabletsIT_crashAndResumeTserver/accumulo/tables/\r\n```\r\n\r\n```java\r\n2021-01-27T18:00:10,691 [tserver.FileManager] ERROR: Failed to open file file:/home/christopher/git/apache/accumulo/accumulo/test/target/mini-tests/org.apache.accumulo.test.master.SuspendedTabletsIT_crashAndResumeTserver/accumulo/tables/!0/table_info/F0000038.rf java.io.FileNotFoundException: File file:/home/christopher/git/apache/accumulo/accumulo/test/target/mini-tests/org.apache.accumulo.test.master.SuspendedTabletsIT_crashAndResumeTserver/accumulo/tables/!0/table_info/F0000038.rf does not exist\r\n2021-01-27T18:00:10,693 [tserver.FileManager] ERROR: Failed to open file file:/home/christopher/git/apache/accumulo/accumulo/test/target/mini-tests/org.apache.accumulo.test.master.SuspendedTabletsIT_crashAndResumeTserver/accumulo/tables/!0/table_info/F0000038.rf java.io.FileNotFoundException: File file:/home/christopher/git/apache/accumulo/accumulo/test/target/mini-tests/org.apache.accumulo.test.master.SuspendedTabletsIT_crashAndResumeTserver/accumulo/tables/!0/table_info/F0000038.rf does not exist\r\n2021-01-27T18:00:10,693 [tserver.FileManager] ERROR: Failed to open file file:/home/christopher/git/apache/accumulo/accumulo/test/target/mini-tests/org.apache.accumulo.test.master.SuspendedTabletsIT_crashAndResumeTserver/accumulo/tables/!0/table_info/F0000038.rf java.io.FileNotFoundException: File file:/home/christopher/git/apache/accumulo/accumulo/test/target/mini-tests/org.apache.accumulo.test.master.SuspendedTabletsIT_crashAndResumeTserver/accumulo/tables/!0/table_info/F0000038.rf does not exist\r\n2021-01-27T18:00:10,694 [problems.ProblemReports] DEBUG: Filing problem report !0 FILE_READ file:/home/christopher/git/apache/accumulo/accumulo/test/target/mini-tests/org.apache.accumulo.test.master.SuspendedTabletsIT_crashAndResumeTserver/accumulo/tables/!0/table_info/F0000038.rf\r\n2021-01-27T18:00:10,694 [scan.LookupTask] WARN : lookup failed for tablet !0;~<                     \r\njava.io.IOException: Failed to open file:/home/christopher/git/apache/accumulo/accumulo/test/target/mini-tests/org.apache.accumulo.test.master.SuspendedTabletsIT_crashAndResumeTserver/accumulo/tables/!0/table_info/F0000038.rf\r\n  at org.apache.accumulo.tserver.FileManager.reserveReaders(FileManager.java:331) ~[accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.tserver.FileManager$ScanFileManager.openFiles(FileManager.java:492) ~[accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.tserver.FileManager$ScanFileManager.openFiles(FileManager.java:501) ~[accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.tserver.tablet.ScanDataSource.createIterator(ScanDataSource.java:164) ~[accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.tserver.tablet.ScanDataSource.iterator(ScanDataSource.java:120) ~[accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.iteratorsImpl.system.SourceSwitchingIterator.seek(SourceSwitchingIterator.java:228) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.tserver.tablet.Tablet.lookup(Tablet.java:493) ~[accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.tserver.tablet.Tablet.lookup(Tablet.java:646) ~[accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.tserver.scan.LookupTask.run(LookupTask.java:117) [accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.tserver.session.ScanSession$ScanMeasurer.run(ScanSession.java:54) [accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.htrace.wrappers.TraceRunnable.run(TraceRunnable.java:57) [htrace-core-3.2.0-incubating.jar:3.2.0-incubating]\r\n  at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]          \r\n  at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]          \r\n  at java.lang.Thread.run(Thread.java:834) [?:?]                                                    \r\nCaused by: java.io.UncheckedIOException: java.io.FileNotFoundException: File file:/home/christopher/git/apache/accumulo/accumulo/test/target/mini-tests/org.apache.accumulo.test.master.SuspendedTabletsIT_crashAndResumeTserver/accumulo/tables/!0/table_info/F0000038.rf does not exist\r\n  at org.apache.accumulo.core.file.blockfile.impl.CachableBlockFile$Reader$BCFileLoader.load(CachableBlockFile.java:227) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.blockfile.cache.lru.SynchronousLoadingBlockCache.getBlock(SynchronousLoadingBlockCache.java:127) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.blockfile.cache.lru.SynchronousLoadingBlockCache.resolveDependencies(SynchronousLoadingBlockCache.java:64) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.blockfile.cache.lru.SynchronousLoadingBlockCache.getBlock(SynchronousLoadingBlockCache.java:109) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.blockfile.impl.CachableBlockFile$Reader.getMetaBlock(CachableBlockFile.java:381) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.rfile.RFile$Reader.<init>(RFile.java:1164) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.rfile.RFile$Reader.<init>(RFile.java:1256) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.rfile.RFileOperations.getReader(RFileOperations.java:55) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.rfile.RFileOperations.openReader(RFileOperations.java:70) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.DispatchingFileFactory.openReader(DispatchingFileFactory.java:85) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.FileOperations$ReaderBuilder.build(FileOperations.java:449) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.tserver.FileManager.reserveReaders(FileManager.java:309) ~[accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  ... 13 more                                                                                       \r\nCaused by: java.io.FileNotFoundException: File file:/home/christopher/git/apache/accumulo/accumulo/test/target/mini-tests/org.apache.accumulo.test.master.SuspendedTabletsIT_crashAndResumeTserver/accumulo/tables/!0/table_info/F0000038.rf does not exist\r\n  at org.apache.hadoop.fs.RawLocalFileSystem.deprecatedGetFileStatus(RawLocalFileSystem.java:668) ~[hadoop-client-api-3.3.0.jar:?]\r\n  at org.apache.hadoop.fs.RawLocalFileSystem.getFileLinkStatusInternal(RawLocalFileSystem.java:989) ~[hadoop-client-api-3.3.0.jar:?]\r\n  at org.apache.hadoop.fs.RawLocalFileSystem.getFileStatus(RawLocalFileSystem.java:658) ~[hadoop-client-api-3.3.0.jar:?]\r\n  at org.apache.hadoop.fs.FilterFileSystem.getFileStatus(FilterFileSystem.java:460) ~[hadoop-client-api-3.3.0.jar:?]\r\n  at org.apache.hadoop.fs.ChecksumFileSystem$ChecksumFSInputChecker.<init>(ChecksumFileSystem.java:155) ~[hadoop-client-api-3.3.0.jar:?]\r\n  at org.apache.hadoop.fs.ChecksumFileSystem.open(ChecksumFileSystem.java:356) ~[hadoop-client-api-3.3.0.jar:?]\r\n  at org.apache.hadoop.fs.FileSystem.open(FileSystem.java:945) ~[hadoop-client-api-3.3.0.jar:?]     \r\n  at org.apache.accumulo.core.file.blockfile.impl.CachableBlockFile$CachableBuilder.lambda$fsPath$0(CachableBlockFile.java:92) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.blockfile.impl.CachableBlockFile$Reader.getBCFile(CachableBlockFile.java:167) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.blockfile.impl.CachableBlockFile$Reader$BCFileLoader.load(CachableBlockFile.java:225) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.blockfile.cache.lru.SynchronousLoadingBlockCache.getBlock(SynchronousLoadingBlockCache.java:127) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.blockfile.cache.lru.SynchronousLoadingBlockCache.resolveDependencies(SynchronousLoadingBlockCache.java:64) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.blockfile.cache.lru.SynchronousLoadingBlockCache.getBlock(SynchronousLoadingBlockCache.java:109) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.blockfile.impl.CachableBlockFile$Reader.getMetaBlock(CachableBlockFile.java:381) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.rfile.RFile$Reader.<init>(RFile.java:1164) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.rfile.RFile$Reader.<init>(RFile.java:1256) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.rfile.RFileOperations.getReader(RFileOperations.java:55) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.rfile.RFileOperations.openReader(RFileOperations.java:70) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.DispatchingFileFactory.openReader(DispatchingFileFactory.java:85) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.core.file.FileOperations$ReaderBuilder.build(FileOperations.java:449) ~[accumulo-core-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  at org.apache.accumulo.tserver.FileManager.reserveReaders(FileManager.java:309) ~[accumulo-tserver-2.1.0-SNAPSHOT.jar:2.1.0-SNAPSHOT]\r\n  ... 13 more    \r\n```\r\n\r\n</details>","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/768674007/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769239757","html_url":"https://github.com/apache/accumulo/pull/1888#issuecomment-769239757","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1888","id":769239757,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTIzOTc1Nw==","user":{"login":"DomGarguilo","id":47725857,"node_id":"MDQ6VXNlcjQ3NzI1ODU3","avatar_url":"https://avatars.githubusercontent.com/u/47725857?v=4","gravatar_id":"","url":"https://api.github.com/users/DomGarguilo","html_url":"https://github.com/DomGarguilo","followers_url":"https://api.github.com/users/DomGarguilo/followers","following_url":"https://api.github.com/users/DomGarguilo/following{/other_user}","gists_url":"https://api.github.com/users/DomGarguilo/gists{/gist_id}","starred_url":"https://api.github.com/users/DomGarguilo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DomGarguilo/subscriptions","organizations_url":"https://api.github.com/users/DomGarguilo/orgs","repos_url":"https://api.github.com/users/DomGarguilo/repos","events_url":"https://api.github.com/users/DomGarguilo/events{/privacy}","received_events_url":"https://api.github.com/users/DomGarguilo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-28T17:15:41Z","updated_at":"2021-01-28T17:15:41Z","author_association":"MEMBER","body":"@ctubbsii interesting. I have not gotten this error and have not yet been able to reproduce it. My guess is this is this happens when the test hangs on its `retrieve()` method which scans the tablet locations. The test often hits the retrieval timeout and then continues successfully so I'm guessing if the scan hangs here for too long, the files are GC'd which leads to the error. I will look into this.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769239757/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769276457","html_url":"https://github.com/apache/accumulo/issues/1460#issuecomment-769276457","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1460","id":769276457,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTI3NjQ1Nw==","user":{"login":"keith-turner","id":1268739,"node_id":"MDQ6VXNlcjEyNjg3Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1268739?v=4","gravatar_id":"","url":"https://api.github.com/users/keith-turner","html_url":"https://github.com/keith-turner","followers_url":"https://api.github.com/users/keith-turner/followers","following_url":"https://api.github.com/users/keith-turner/following{/other_user}","gists_url":"https://api.github.com/users/keith-turner/gists{/gist_id}","starred_url":"https://api.github.com/users/keith-turner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keith-turner/subscriptions","organizations_url":"https://api.github.com/users/keith-turner/orgs","repos_url":"https://api.github.com/users/keith-turner/repos","events_url":"https://api.github.com/users/keith-turner/events{/privacy}","received_events_url":"https://api.github.com/users/keith-turner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-28T18:12:42Z","updated_at":"2021-01-28T18:12:42Z","author_association":"CONTRIBUTOR","body":"Looking into this code a bit, below are some potential problems.\r\n\r\n 1. When there is a problem connecting to a tserver, it [tries to connect to the tserver to ask it to halt](https://github.com/apache/accumulo/blob/6af856b38bb57f49418547a8b9c262c66a1fe31e/server/manager/src/main/java/org/apache/accumulo/master/Master.java#L931-L934).\r\n 2. Since the code for dealing with potentially bad tservers is in the code path for getting stats, it could potentially impede getting status from functioning tservers.\r\n 3.  The code [uses a hard coded count](https://github.com/apache/accumulo/blob/6af856b38bb57f49418547a8b9c262c66a1fe31e/server/manager/src/main/java/org/apache/accumulo/master/Master.java#L170) of the number of times a tserver could not be connected to decide if a tserver is bad.\r\n 4. The code has no concept of the big picture, if there is 1/1000 bad server vs 999/1000.  Each bad tserver is handled independently.  The rate limiting changes made in #1456 dealt with this in a way.\r\n\r\nI think there is value in what the code is attempting to do (react to tservers that the manager can not connect to), but it could be improved.   Accumulo tservers must maintain a heartbeat with a ZK server inorder to be considered alive.  There are situations where a tservers is maintaining this ZK heartbeat, but new connections can not be made to the tserver.  When the manager attempts to get status from a tserver, it does not currently use a pooled connection.  If the manager can not form a new connection, then clients likely can not either.\r\n\r\nOne possible improvement that could be made to address problems above is the creation of an internal service in the manager to deal with bad tservers.   The code that gathers status would queue tservers it had problems connecting with to this service.  The service would decide when to react and have its own threads for reacting.  The service can consider the big picture and queuing something for it to process does not need to block gathering status.\r\n\r\nFor problem 3, the hard coded count,  this criteria for classifying a tserver as bad does not seem ideal.  Seems like a configurable criteria based on time and count would be better.  Like if at least Y attempt to contact a tserver in a X minute period failed, classify it as bad.\r\n\r\nFor problem 1, asking the tserver to halt, if the manager can not connect to the tserver to get status then its chances of connecting to the tserver to ask it to halt are diminished.  May be better to delete its ZK lock and/or ask it to halt.\r\n\r\nOverall, I am thinking there is value in what the code is attempting to do and that it needs to be improved.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769276457/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769278129","html_url":"https://github.com/apache/accumulo/issues/1460#issuecomment-769278129","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1460","id":769278129,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTI3ODEyOQ==","user":{"login":"keith-turner","id":1268739,"node_id":"MDQ6VXNlcjEyNjg3Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1268739?v=4","gravatar_id":"","url":"https://api.github.com/users/keith-turner","html_url":"https://github.com/keith-turner","followers_url":"https://api.github.com/users/keith-turner/followers","following_url":"https://api.github.com/users/keith-turner/following{/other_user}","gists_url":"https://api.github.com/users/keith-turner/gists{/gist_id}","starred_url":"https://api.github.com/users/keith-turner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keith-turner/subscriptions","organizations_url":"https://api.github.com/users/keith-turner/orgs","repos_url":"https://api.github.com/users/keith-turner/repos","events_url":"https://api.github.com/users/keith-turner/events{/privacy}","received_events_url":"https://api.github.com/users/keith-turner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-28T18:15:25Z","updated_at":"2021-01-28T18:21:43Z","author_association":"CONTRIBUTOR","body":"I removed the blocker label, I don't think the code should be removed even though it does need improvement.  The improvements needed are not well defined and therefore should not block a release.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769278129/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769442373","html_url":"https://github.com/apache/accumulo/issues/1889#issuecomment-769442373","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1889","id":769442373,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTQ0MjM3Mw==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-28T22:30:44Z","updated_at":"2021-01-28T22:30:44Z","author_association":"MEMBER","body":"@alerman The environment is provided to the iterator by Accumulo itself, and Accumulo should never provide a null environment. What is the use case for supporting the receipt of a null environment rather than recognizing that as an exception? Is it for testing your iterator? If so, why not create a mock environment?","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769442373/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769449213","html_url":"https://github.com/apache/accumulo/pull/1888#issuecomment-769449213","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1888","id":769449213,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTQ0OTIxMw==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-28T22:45:59Z","updated_at":"2021-01-28T22:45:59Z","author_association":"MEMBER","body":"> I will look into this.\r\n\r\nThanks. This might be an entirely separate issue to track, and may be independent of this SuspendedTabletsIT. It definitely shouldn't be the case that Accumulo can delete a file that is later still needed. If you are able to confirm in your investigation that this is a separate issue (or at least, if you are unable to rule out that possibility), feel free to create a new issue to track it.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769449213/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769747733","html_url":"https://github.com/apache/accumulo/issues/1889#issuecomment-769747733","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1889","id":769747733,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTc0NzczMw==","user":{"login":"alerman","id":119506,"node_id":"MDQ6VXNlcjExOTUwNg==","avatar_url":"https://avatars.githubusercontent.com/u/119506?v=4","gravatar_id":"","url":"https://api.github.com/users/alerman","html_url":"https://github.com/alerman","followers_url":"https://api.github.com/users/alerman/followers","following_url":"https://api.github.com/users/alerman/following{/other_user}","gists_url":"https://api.github.com/users/alerman/gists{/gist_id}","starred_url":"https://api.github.com/users/alerman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alerman/subscriptions","organizations_url":"https://api.github.com/users/alerman/orgs","repos_url":"https://api.github.com/users/alerman/repos","events_url":"https://api.github.com/users/alerman/events{/privacy}","received_events_url":"https://api.github.com/users/alerman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T11:24:44Z","updated_at":"2021-01-29T11:24:44Z","author_association":"CONTRIBUTOR","body":"@ctubbsii In this case our code was calling the init function itself. I can see the argument that we shouldnt be doing that but 1) its public and 2) this worked in 1.9.x and it is a behavior change in a minor release. I have put up a PR to our codebase to have it send in an empty environment rather than null, so this won't affect us any longer, but this could still affect anyone else that was doing it. ","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769747733/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769785635","html_url":"https://github.com/apache/accumulo/pull/1824#issuecomment-769785635","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1824","id":769785635,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTc4NTYzNQ==","user":{"login":"Manno15","id":29436247,"node_id":"MDQ6VXNlcjI5NDM2MjQ3","avatar_url":"https://avatars.githubusercontent.com/u/29436247?v=4","gravatar_id":"","url":"https://api.github.com/users/Manno15","html_url":"https://github.com/Manno15","followers_url":"https://api.github.com/users/Manno15/followers","following_url":"https://api.github.com/users/Manno15/following{/other_user}","gists_url":"https://api.github.com/users/Manno15/gists{/gist_id}","starred_url":"https://api.github.com/users/Manno15/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Manno15/subscriptions","organizations_url":"https://api.github.com/users/Manno15/orgs","repos_url":"https://api.github.com/users/Manno15/repos","events_url":"https://api.github.com/users/Manno15/events{/privacy}","received_events_url":"https://api.github.com/users/Manno15/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T12:48:19Z","updated_at":"2021-01-29T12:48:19Z","author_association":"CONTRIBUTOR","body":"@ctubbsii  I believe I hit on everyones questions and suggestions. Do you have anything further to add or any concerns?  ","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769785635/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769821977","html_url":"https://github.com/apache/accumulo/pull/1887#issuecomment-769821977","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1887","id":769821977,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTgyMTk3Nw==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T14:00:57Z","updated_at":"2021-01-29T14:00:57Z","author_association":"CONTRIBUTOR","body":"I forgot to run the ITs when I opened this the other day.  This changes touches important code so running them now.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769821977/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769831349","html_url":"https://github.com/apache/accumulo/issues/1889#issuecomment-769831349","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1889","id":769831349,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTgzMTM0OQ==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T14:17:53Z","updated_at":"2021-01-29T14:17:53Z","author_association":"CONTRIBUTOR","body":"@alerman I am not sure what change you are refering to but the bug fix I did for the Combiner was in 1.10.  PR: https://github.com/apache/accumulo/pull/1680\r\nAnd here is the commit: e3a14cd083848917b1f3f739eb79e6ea65a3e704","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769831349/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769843956","html_url":"https://github.com/apache/accumulo/pull/1824#issuecomment-769843956","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1824","id":769843956,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTg0Mzk1Ng==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T14:40:03Z","updated_at":"2021-01-29T14:40:03Z","author_association":"MEMBER","body":"> @ctubbsii I believe I hit on everyones questions and suggestions. Do you have anything further to add or any concerns?\r\n\r\nI can take another look today and re-run the ITs.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769843956/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769853196","html_url":"https://github.com/apache/accumulo/issues/1889#issuecomment-769853196","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1889","id":769853196,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTg1MzE5Ng==","user":{"login":"alerman","id":119506,"node_id":"MDQ6VXNlcjExOTUwNg==","avatar_url":"https://avatars.githubusercontent.com/u/119506?v=4","gravatar_id":"","url":"https://api.github.com/users/alerman","html_url":"https://github.com/alerman","followers_url":"https://api.github.com/users/alerman/followers","following_url":"https://api.github.com/users/alerman/following{/other_user}","gists_url":"https://api.github.com/users/alerman/gists{/gist_id}","starred_url":"https://api.github.com/users/alerman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/alerman/subscriptions","organizations_url":"https://api.github.com/users/alerman/orgs","repos_url":"https://api.github.com/users/alerman/repos","events_url":"https://api.github.com/users/alerman/events{/privacy}","received_events_url":"https://api.github.com/users/alerman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T14:55:38Z","updated_at":"2021-01-29T14:55:38Z","author_association":"CONTRIBUTOR","body":"reopened as I had closed by mistake.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769853196/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769881303","html_url":"https://github.com/apache/accumulo/issues/1889#issuecomment-769881303","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1889","id":769881303,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTg4MTMwMw==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T15:43:26Z","updated_at":"2021-01-29T15:43:26Z","author_association":"MEMBER","body":"Since this was re-opened, I will reply to the points that were made:\r\n\r\n> 1) its public\r\n\r\nThe fact that the method is public says nothing about whether the arguments can be null, and in the absence of documentation (javadoc, annotations, etc.), the behavior is not defined. The behavior didn't break... a user's invalid assumption was broken. However, in this case, the API is clearly designed to be called by Accumulo, which always provides an concrete environment. It isn't designed for the user to call init themselves, never mind pass null. Rather, it is designed for a user to implement an initialization *given* an environment (which Accumulo provides, and is never null). So, given the design that Accumulo provides the argument, it's not surprising that we didn't document requirements for the argument for the user to pass, but we can address that with updated javadoc in SortedKeyValueIterator, if necessary.\r\n\r\nOther than testing, I have not seen a use case articulated for a user calling init themselves, and for testing, one should simulate what Accumulo might provide with a mock environment. If there is a use case, I'd have to understand it better before suggesting a solution beyond updating the javadoc.\r\n\r\n> 2) this worked in 1.9.x and it is a behavior change in a minor release. \r\n\r\nI'm not so sure it did work in 1.9. The use of the environment to check the scope of the major compaction was added in 1.6.5 and 1.7.1 to fix a serious bug. See https://issues.apache.org/jira/browse/ACCUMULO-2232 . The code may have been re-ordered more recently to manifest itself earlier, but the expectation that the environment be non-null has been baked into this method's implementation for a very long time.\r\n\r\nEven if it did work in 1.9, it was only because of an invalid user assumption that it was safe to call the method themselves with a null argument. Accumulo's own behavior has not changed, because it always provided a non-null environment.\r\n","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769881303/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769882589","html_url":"https://github.com/apache/accumulo/issues/1889#issuecomment-769882589","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1889","id":769882589,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTg4MjU4OQ==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T15:45:39Z","updated_at":"2021-01-29T15:45:39Z","author_association":"MEMBER","body":"In short, I don't think there's a bug here, or any code to fix. But, it may be helpful to improve SortedKeyValueIterator's javadoc for the init method.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769882589/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769886922","html_url":"https://github.com/apache/accumulo/pull/1890#issuecomment-769886922","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1890","id":769886922,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTg4NjkyMg==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T15:53:02Z","updated_at":"2021-01-29T15:53:02Z","author_association":"MEMBER","body":"`sync()` ensures the server's view of ZooKeeper state is immediately up-to-date with the consensus of the ZooKeeper cluster. It normally does this asynchronously, with a callback, but our wrapper method in ZooReader will wait until it is sync'd. It should probably be called before the existence check.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769886922/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769891862","html_url":"https://github.com/apache/accumulo/pull/1890#issuecomment-769891862","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1890","id":769891862,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTg5MTg2Mg==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T16:01:20Z","updated_at":"2021-01-29T16:01:20Z","author_association":"CONTRIBUTOR","body":"> `sync()` ensures the server's view of ZooKeeper state is immediately up-to-date with the consensus of the ZooKeeper cluster. It normally does this asynchronously, with a callback, but our wrapper method in ZooReader will wait until it is sync'd. It should probably be called before the existence check.\r\n\r\nOK I had a hunch that is what it is doing but wasn't positive.  I will move the sync before the existence check.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769891862/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769945883","html_url":"https://github.com/apache/accumulo/pull/1887#issuecomment-769945883","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1887","id":769945883,"node_id":"MDEyOklzc3VlQ29tbWVudDc2OTk0NTg4Mw==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T17:36:45Z","updated_at":"2021-01-29T17:36:45Z","author_association":"CONTRIBUTOR","body":"I saw a timeout failure in org.apache.accumulo.test.functional.ConcurrentDeleteTableIT.  I didn't see any obvious errors but didn't have a chance to look into it further.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/769945883/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770065868","html_url":"https://github.com/apache/accumulo/pull/1887#issuecomment-770065868","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1887","id":770065868,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDA2NTg2OA==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T21:42:14Z","updated_at":"2021-01-29T21:42:14Z","author_association":"MEMBER","body":"> I saw a timeout failure in org.apache.accumulo.test.functional.ConcurrentDeleteTableIT. I didn't see any obvious errors but didn't have a chance to look into it further.\r\n\r\nThat's a known flaky test. It is unlikely this has anything to do with that.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770065868/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770071413","html_url":"https://github.com/apache/accumulo/pull/1824#issuecomment-770071413","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1824","id":770071413,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDA3MTQxMw==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T21:55:52Z","updated_at":"2021-01-29T21:55:52Z","author_association":"MEMBER","body":"> > @ctubbsii I believe I hit on everyones questions and suggestions. Do you have anything further to add or any concerns?\r\n> \r\n> I can take another look today and re-run the ITs.\r\n\r\nI re-ran all the ITs, and they all pass, except for a few known flaky ones.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770071413/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770085271","html_url":"https://github.com/apache/accumulo/pull/1888#issuecomment-770085271","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1888","id":770085271,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDA4NTI3MQ==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T22:32:03Z","updated_at":"2021-01-29T22:48:00Z","author_association":"MEMBER","body":"I ran the full ITs with this PR on Jenkins and the only test that failed was this one:\r\n\r\n```java\r\njava.lang.AssertionError\r\n\tat org.junit.Assert.fail(Assert.java:87)\r\n\tat org.junit.Assert.assertTrue(Assert.java:42)\r\n\tat org.junit.Assert.assertTrue(Assert.java:53)\r\n\tat org.apache.accumulo.test.master.SuspendedTabletsIT.suspensionTestBody(SuspendedTabletsIT.java:253)\r\n\tat org.apache.accumulo.test.master.SuspendedTabletsIT.shutdownAndResumeTserver(SuspendedTabletsIT.java:118)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\t...\r\n```\r\n\r\n<details>\r\n<summary>More output from several subsequent runs:</summary>\r\n\r\n```java\r\n[INFO] Running org.apache.accumulo.test.master.SuspendedTabletsIT\r\n[ERROR] Tests run: 9, Failures: 3, Errors: 5, Skipped: 0, Time elapsed: 1,333.444 s <<< FAILURE! - in org.apache.accumulo.test.master.SuspendedTabletsIT\r\n[ERROR] shutdownAndResumeTserver(org.apache.accumulo.test.master.SuspendedTabletsIT)  Time elapsed: 182.585 s  <<< FAILURE!\r\njava.lang.AssertionError\r\n\tat org.junit.Assert.fail(Assert.java:87)\r\n\tat org.junit.Assert.assertTrue(Assert.java:42)\r\n\tat org.junit.Assert.assertTrue(Assert.java:53)\r\n\tat org.apache.accumulo.test.master.SuspendedTabletsIT.suspensionTestBody(SuspendedTabletsIT.java:253)\r\n\tat org.apache.accumulo.test.master.SuspendedTabletsIT.shutdownAndResumeTserver(SuspendedTabletsIT.java:118)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\r\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\r\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\r\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\r\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:288)\r\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:282)\r\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n\tat java.base/java.lang.Thread.run(Thread.java:834)\r\n\r\n[ERROR] shutdownAndResumeTserver(org.apache.accumulo.test.master.SuspendedTabletsIT)  Time elapsed: 125.98 s  <<< FAILURE!\r\njava.lang.AssertionError: expected:<[1;21;20, 1;1<, 1;10;1, 1;19;18, 1;13;12, 1;24;23, 1;26;25, 1;3;29, 1;17;16, 1;8;7]> but was:<[1;1<, 1;10;1, 1;19;18, 1;3;29, 1;21;20, 1;12;11, 1;13;12, 1;24;23, 1;4;3, 1;26;25, 1;27;26, 1;17;16, 1;8;7]>\r\n\tat org.junit.Assert.fail(Assert.java:89)\r\n\tat org.junit.Assert.failNotEquals(Assert.java:835)\r\n\tat org.junit.Assert.assertEquals(Assert.java:120)\r\n\tat org.junit.Assert.assertEquals(Assert.java:146)\r\n\tat org.apache.accumulo.test.master.SuspendedTabletsIT.suspensionTestBody(SuspendedTabletsIT.java:243)\r\n\tat org.apache.accumulo.test.master.SuspendedTabletsIT.shutdownAndResumeTserver(SuspendedTabletsIT.java:118)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\r\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\r\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\r\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\r\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:288)\r\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:282)\r\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n\tat java.base/java.lang.Thread.run(Thread.java:834)\r\n\r\n[ERROR] shutdownAndResumeTserver(org.apache.accumulo.test.master.SuspendedTabletsIT)  Time elapsed: 194.216 s  <<< FAILURE!\r\njava.lang.AssertionError: expected:<[1;9;8, 1;1<, 1;19;18, 1;23;22, 1;4;3, 1;14;13, 1;16;15, 1;7;6, 1;17;16]> but was:<[1;9;8, 1;1<, 1;11;10, 1;19;18, 1;23;22, 1;4;3, 1;14;13, 1;16;15, 1;7;6, 1;17;16]>\r\n\tat org.junit.Assert.fail(Assert.java:89)\r\n\tat org.junit.Assert.failNotEquals(Assert.java:835)\r\n\tat org.junit.Assert.assertEquals(Assert.java:120)\r\n\tat org.junit.Assert.assertEquals(Assert.java:146)\r\n\tat org.apache.accumulo.test.master.SuspendedTabletsIT.suspensionTestBody(SuspendedTabletsIT.java:225)\r\n\tat org.apache.accumulo.test.master.SuspendedTabletsIT.shutdownAndResumeTserver(SuspendedTabletsIT.java:118)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\r\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\r\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\r\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\r\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:288)\r\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:282)\r\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n\tat java.base/java.lang.Thread.run(Thread.java:834)\r\n\r\n[ERROR] shutdownAndResumeTserver(org.apache.accumulo.test.master.SuspendedTabletsIT)  Time elapsed: 24.635 s  <<< ERROR!\r\norg.apache.accumulo.core.client.AccumuloException: Failed to connect to zookeeper (localhost:35593) within 2x zookeeper timeout period 5000\r\n\tat org.apache.accumulo.core.clientImpl.TableOperationsImpl.doFateOperation(TableOperationsImpl.java:402)\r\n\tat org.apache.accumulo.core.clientImpl.TableOperationsImpl.doFateOperation(TableOperationsImpl.java:354)\r\n\tat org.apache.accumulo.core.clientImpl.TableOperationsImpl.doTableFateOperation(TableOperationsImpl.java:1692)\r\n\tat org.apache.accumulo.core.clientImpl.TableOperationsImpl.create(TableOperationsImpl.java:245)\r\n\tat org.apache.accumulo.test.master.SuspendedTabletsIT.suspensionTestBody(SuspendedTabletsIT.java:179)\r\n\tat org.apache.accumulo.test.master.SuspendedTabletsIT.shutdownAndResumeTserver(SuspendedTabletsIT.java:118)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\r\n\tat org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n\tat org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\r\n\tat org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n\tat org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\r\n\tat org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\r\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:288)\r\n\tat org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:282)\r\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n\tat java.base/java.lang.Thread.run(Thread.java:834)\r\nCaused by: java.lang.RuntimeException: Failed to connect to zookeeper (localhost:35593) within 2x zookeeper timeout period 5000\r\n\tat org.apache.accumulo.fate.zookeeper.ZooSession.connect(ZooSession.java:162)\r\n\tat org.apache.accumulo.fate.zookeeper.ZooSession.getSession(ZooSession.java:215)\r\n\tat org.apache.accumulo.fate.zookeeper.ZooSession.getAnonymousSession(ZooSession.java:188)\r\n\tat org.apache.accumulo.fate.zookeeper.ZooReader.getZooKeeper(ZooReader.java:57)\r\n\tat org.apache.accumulo.fate.zookeeper.ZooCache.getZooKeeper(ZooCache.java:150)\r\n\tat org.apache.accumulo.fate.zookeeper.ZooCache$2.run(ZooCache.java:414)\r\n\tat org.apache.accumulo.fate.zookeeper.ZooCache$2.run(ZooCache.java:387)\r\n\tat org.apache.accumulo.fate.zookeeper.ZooCache$ZooRunnable.retry(ZooCache.java:279)\r\n\tat org.apache.accumulo.fate.zookeeper.ZooCache.get(ZooCache.java:442)\r\n\tat org.apache.accumulo.fate.zookeeper.ZooCache.get(ZooCache.java:372)\r\n\tat org.apache.accumulo.core.clientImpl.ClientContext.getInstanceID(ClientContext.java:414)\r\n\tat org.apache.accumulo.core.clientImpl.ClientContext.getInstanceID(ClientContext.java:403)\r\n\tat org.apache.accumulo.core.clientImpl.ClientContext.getMasterLocations(ClientContext.java:364)\r\n\tat org.apache.accumulo.core.clientImpl.MasterClient.getConnection(MasterClient.java:59)\r\n\tat org.apache.accumulo.core.clientImpl.MasterClient.getConnectionWithRetry(MasterClient.java:49)\r\n\tat org.apache.accumulo.core.clientImpl.TableOperationsImpl.beginFateOperation(TableOperationsImpl.java:257)\r\n\tat org.apache.accumulo.core.clientImpl.TableOperationsImpl.doFateOperation(TableOperationsImpl.java:364)\r\n\t... 19 more\r\n\r\n[ERROR] shutdownAndResumeTserver(org.apache.accumulo.test.master.SuspendedTabletsIT)  Time elapsed: 300.013 s  <<< ERROR!\r\norg.junit.runners.model.TestTimedOutException: test timed out after 300 seconds\r\n\tat java.base@11.0.9.1/java.net.SocketInputStream.socketRead0(Native Method)\r\n\tat java.base@11.0.9.1/java.net.SocketInputStream.socketRead(SocketInputStream.java:115)\r\n\tat java.base@11.0.9.1/java.net.SocketInputStream.read(SocketInputStream.java:168)\r\n\tat java.base@11.0.9.1/java.net.SocketInputStream.read(SocketInputStream.java:140)\r\n\tat java.base@11.0.9.1/java.io.BufferedInputStream.fill(BufferedInputStream.java:252)\r\n\tat java.base@11.0.9.1/java.io.BufferedInputStream.read1(BufferedInputStream.java:292)\r\n\tat java.base@11.0.9.1/java.io.BufferedInputStream.read(BufferedInputStream.java:351)\r\n\tat app//org.apache.thrift.transport.TIOStreamTransport.read(TIOStreamTransport.java:127)\r\n\tat app//org.apache.thrift.transport.TTransport.readAll(TTransport.java:86)\r\n\tat app//org.apache.thrift.transport.TFramedTransport.readFrame(TFramedTransport.java:132)\r\n\tat app//org.apache.thrift.transport.TFramedTransport.read(TFramedTransport.java:100)\r\n\tat app//org.apache.thrift.transport.TTransport.readAll(TTransport.java:86)\r\n\tat app//org.apache.accumulo.core.clientImpl.ThriftTransportPool$CachedTTransport.readAll(ThriftTransportPool.java:546)\r\n\tat app//org.apache.thrift.protocol.TCompactProtocol.readByte(TCompactProtocol.java:637)\r\n\tat app//org.apache.thrift.protocol.TCompactProtocol.readMessageBegin(TCompactProtocol.java:505)\r\n\tat app//org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:77)\r\n\tat app//org.apache.accumulo.core.master.thrift.MasterClientService$Client.recv_shutdownTabletServer(MasterClientService.java:404)\r\n\tat app//org.apache.accumulo.core.master.thrift.MasterClientService$Client.shutdownTabletServer(MasterClientService.java:388)\r\n\tat app//org.apache.accumulo.test.master.SuspendedTabletsIT.lambda$shutdownAndResumeTserver$1(SuspendedTabletsIT.java:132)\r\n\tat app//org.apache.accumulo.test.master.SuspendedTabletsIT$$Lambda$208/0x00000008402d7440.execute(Unknown Source)\r\n\tat app//org.apache.accumulo.core.clientImpl.MasterClient.executeGeneric(MasterClient.java:139)\r\n\tat app//org.apache.accumulo.core.clientImpl.MasterClient.executeVoid(MasterClient.java:190)\r\n\tat app//org.apache.accumulo.test.master.SuspendedTabletsIT.lambda$shutdownAndResumeTserver$2(SuspendedTabletsIT.java:130)\r\n\tat app//org.apache.accumulo.test.master.SuspendedTabletsIT$$Lambda$143/0x00000008401e7c40.eliminateTabletServers(Unknown Source)\r\n\tat app//org.apache.accumulo.test.master.SuspendedTabletsIT.suspensionTestBody(SuspendedTabletsIT.java:204)\r\n\tat app//org.apache.accumulo.test.master.SuspendedTabletsIT.shutdownAndResumeTserver(SuspendedTabletsIT.java:118)\r\n\tat java.base@11.0.9.1/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base@11.0.9.1/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base@11.0.9.1/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base@11.0.9.1/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat app//org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\r\n\tat app//org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n\tat app//org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\r\n\tat app//org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n\tat app//org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\r\n\tat app//org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\r\n\tat app//org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:288)\r\n\tat app//org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:282)\r\n\tat java.base@11.0.9.1/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n\tat java.base@11.0.9.1/java.lang.Thread.run(Thread.java:834)\r\n\r\n[ERROR] shutdownAndResumeTserver(org.apache.accumulo.test.master.SuspendedTabletsIT)  Time elapsed: 300.013 s  <<< ERROR!\r\njava.lang.Exception: Appears to be stuck in thread Time-limited test-SendThread(localhost:42101)\r\n\tat java.base@11.0.9.1/sun.nio.ch.EPoll.wait(Native Method)\r\n\tat java.base@11.0.9.1/sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:120)\r\n\tat java.base@11.0.9.1/sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:124)\r\n\tat java.base@11.0.9.1/sun.nio.ch.SelectorImpl.select(SelectorImpl.java:136)\r\n\tat app//org.apache.zookeeper.ClientCnxnSocketNIO.doTransport(ClientCnxnSocketNIO.java:347)\r\n\tat app//org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1223)\r\n\r\n[ERROR] shutdownAndResumeTserver(org.apache.accumulo.test.master.SuspendedTabletsIT)  Time elapsed: 300.007 s  <<< ERROR!\r\norg.junit.runners.model.TestTimedOutException: test timed out after 300 seconds\r\n\tat java.base@11.0.9.1/java.net.SocketInputStream.socketRead0(Native Method)\r\n\tat java.base@11.0.9.1/java.net.SocketInputStream.socketRead(SocketInputStream.java:115)\r\n\tat java.base@11.0.9.1/java.net.SocketInputStream.read(SocketInputStream.java:168)\r\n\tat java.base@11.0.9.1/java.net.SocketInputStream.read(SocketInputStream.java:140)\r\n\tat java.base@11.0.9.1/java.io.BufferedInputStream.fill(BufferedInputStream.java:252)\r\n\tat java.base@11.0.9.1/java.io.BufferedInputStream.read1(BufferedInputStream.java:292)\r\n\tat java.base@11.0.9.1/java.io.BufferedInputStream.read(BufferedInputStream.java:351)\r\n\tat app//org.apache.thrift.transport.TIOStreamTransport.read(TIOStreamTransport.java:127)\r\n\tat app//org.apache.thrift.transport.TTransport.readAll(TTransport.java:86)\r\n\tat app//org.apache.thrift.transport.TFramedTransport.readFrame(TFramedTransport.java:132)\r\n\tat app//org.apache.thrift.transport.TFramedTransport.read(TFramedTransport.java:100)\r\n\tat app//org.apache.thrift.transport.TTransport.readAll(TTransport.java:86)\r\n\tat app//org.apache.accumulo.core.clientImpl.ThriftTransportPool$CachedTTransport.readAll(ThriftTransportPool.java:546)\r\n\tat app//org.apache.thrift.protocol.TCompactProtocol.readByte(TCompactProtocol.java:637)\r\n\tat app//org.apache.thrift.protocol.TCompactProtocol.readMessageBegin(TCompactProtocol.java:505)\r\n\tat app//org.apache.thrift.TServiceClient.receiveBase(TServiceClient.java:77)\r\n\tat app//org.apache.accumulo.core.master.thrift.MasterClientService$Client.recv_shutdownTabletServer(MasterClientService.java:404)\r\n\tat app//org.apache.accumulo.core.master.thrift.MasterClientService$Client.shutdownTabletServer(MasterClientService.java:388)\r\n\tat app//org.apache.accumulo.test.master.SuspendedTabletsIT.lambda$shutdownAndResumeTserver$1(SuspendedTabletsIT.java:132)\r\n\tat app//org.apache.accumulo.test.master.SuspendedTabletsIT$$Lambda$208/0x00000008402d7440.execute(Unknown Source)\r\n\tat app//org.apache.accumulo.core.clientImpl.MasterClient.executeGeneric(MasterClient.java:139)\r\n\tat app//org.apache.accumulo.core.clientImpl.MasterClient.executeVoid(MasterClient.java:190)\r\n\tat app//org.apache.accumulo.test.master.SuspendedTabletsIT.lambda$shutdownAndResumeTserver$2(SuspendedTabletsIT.java:130)\r\n\tat app//org.apache.accumulo.test.master.SuspendedTabletsIT$$Lambda$143/0x00000008401e7c40.eliminateTabletServers(Unknown Source)\r\n\tat app//org.apache.accumulo.test.master.SuspendedTabletsIT.suspensionTestBody(SuspendedTabletsIT.java:204)\r\n\tat app//org.apache.accumulo.test.master.SuspendedTabletsIT.shutdownAndResumeTserver(SuspendedTabletsIT.java:118)\r\n\tat java.base@11.0.9.1/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base@11.0.9.1/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base@11.0.9.1/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base@11.0.9.1/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat app//org.junit.runners.model.FrameworkMethod$1.runReflectiveCall(FrameworkMethod.java:59)\r\n\tat app//org.junit.internal.runners.model.ReflectiveCallable.run(ReflectiveCallable.java:12)\r\n\tat app//org.junit.runners.model.FrameworkMethod.invokeExplosively(FrameworkMethod.java:56)\r\n\tat app//org.junit.internal.runners.statements.InvokeMethod.evaluate(InvokeMethod.java:17)\r\n\tat app//org.junit.internal.runners.statements.RunBefores.evaluate(RunBefores.java:26)\r\n\tat app//org.junit.internal.runners.statements.RunAfters.evaluate(RunAfters.java:27)\r\n\tat app//org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:288)\r\n\tat app//org.junit.internal.runners.statements.FailOnTimeout$CallableStatement.call(FailOnTimeout.java:282)\r\n\tat java.base@11.0.9.1/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n\tat java.base@11.0.9.1/java.lang.Thread.run(Thread.java:834)\r\n\r\n[ERROR] shutdownAndResumeTserver(org.apache.accumulo.test.master.SuspendedTabletsIT)  Time elapsed: 300.007 s  <<< ERROR!\r\njava.lang.Exception: Appears to be stuck in thread Time-limited test-SendThread(localhost:35265)\r\n\tat java.base@11.0.9.1/sun.nio.ch.EPoll.wait(Native Method)\r\n\tat java.base@11.0.9.1/sun.nio.ch.EPollSelectorImpl.doSelect(EPollSelectorImpl.java:120)\r\n\tat java.base@11.0.9.1/sun.nio.ch.SelectorImpl.lockAndDoSelect(SelectorImpl.java:124)\r\n\tat java.base@11.0.9.1/sun.nio.ch.SelectorImpl.select(SelectorImpl.java:136)\r\n\tat app//org.apache.zookeeper.ClientCnxnSocketNIO.doTransport(ClientCnxnSocketNIO.java:347)\r\n\tat app//org.apache.zookeeper.ClientCnxn$SendThread.run(ClientCnxn.java:1223)\r\n```\r\n\r\n</details>","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770085271/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770102235","html_url":"https://github.com/apache/accumulo/pull/1824#issuecomment-770102235","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1824","id":770102235,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDEwMjIzNQ==","user":{"login":"Manno15","id":29436247,"node_id":"MDQ6VXNlcjI5NDM2MjQ3","avatar_url":"https://avatars.githubusercontent.com/u/29436247?v=4","gravatar_id":"","url":"https://api.github.com/users/Manno15","html_url":"https://github.com/Manno15","followers_url":"https://api.github.com/users/Manno15/followers","following_url":"https://api.github.com/users/Manno15/following{/other_user}","gists_url":"https://api.github.com/users/Manno15/gists{/gist_id}","starred_url":"https://api.github.com/users/Manno15/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Manno15/subscriptions","organizations_url":"https://api.github.com/users/Manno15/orgs","repos_url":"https://api.github.com/users/Manno15/repos","events_url":"https://api.github.com/users/Manno15/events{/privacy}","received_events_url":"https://api.github.com/users/Manno15/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-29T23:24:34Z","updated_at":"2021-01-29T23:24:34Z","author_association":"CONTRIBUTOR","body":"> I think this is probably mostly okay to merge now. However, I haven't done any manual testing... only code inspection and running tests. So, we should be careful to observe any behavioral changes to the shell as we continue development/testing on 2.1.\r\n\r\nUnderstandable. Fortunately, most of the commands themselves have stayed the same. The things that have changed the most is tab completion and how the history file is set. Those I have tested thoroughly. The tests have also changed quite a bit and possible improvements could be made to those in future versions of Jline. \r\n\r\nAnother possible concern is how the terminal and reader will be set up on different machines. We let Jline determine the best terminal type and use the default implementations for other various features that maybe we would want to add later on.  This isn't different from what we did in Jline2 so it isn't a big concern but I have already noticed several changes in functionality between `ConsoleReader` and the `terminal`/`lineReader` combo that is used now.  \r\n\r\n> There is one more thing that does need to be done before this can be merged, though:\r\n  the LICENSE file in the assembly tarball needs to be updated (assemble/src/main/resources/LICENSE) based on the upstream license information (there are only slight differences with https://github.com/jline/jline3/blob/jline-parent-3.17.1/LICENSE.txt\r\nBy the way, you may wish to consider updating to 3.19.0, in case some things have improved since you started working on this\r\n\r\nI will add these Monday. I am curious to see what they changed in 3.19. \r\n","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770102235/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770112981","html_url":"https://github.com/apache/accumulo/issues/1893#issuecomment-770112981","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1893","id":770112981,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDExMjk4MQ==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-30T00:03:45Z","updated_at":"2021-01-30T00:03:45Z","author_association":"MEMBER","body":"I recall discussing this in the past. There may be some old JIRA issues that this would supersede that could be closed with this.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770112981/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770151558","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-770151558","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":770151558,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDE1MTU1OA==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-30T03:52:59Z","updated_at":"2021-01-30T03:52:59Z","author_association":"MEMBER","body":"VolumeIT is failing with these changes.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770151558/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770261846","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-770261846","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":770261846,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDI2MTg0Ng==","user":{"login":"dlmarion","id":567911,"node_id":"MDQ6VXNlcjU2NzkxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/567911?v=4","gravatar_id":"","url":"https://api.github.com/users/dlmarion","html_url":"https://github.com/dlmarion","followers_url":"https://api.github.com/users/dlmarion/followers","following_url":"https://api.github.com/users/dlmarion/following{/other_user}","gists_url":"https://api.github.com/users/dlmarion/gists{/gist_id}","starred_url":"https://api.github.com/users/dlmarion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dlmarion/subscriptions","organizations_url":"https://api.github.com/users/dlmarion/orgs","repos_url":"https://api.github.com/users/dlmarion/repos","events_url":"https://api.github.com/users/dlmarion/events{/privacy}","received_events_url":"https://api.github.com/users/dlmarion/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-01-30T18:42:21Z","updated_at":"2021-01-30T18:42:21Z","author_association":"CONTRIBUTOR","body":"I'll look at that.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770261846/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770876560","html_url":"https://github.com/apache/accumulo/pull/1824#issuecomment-770876560","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1824","id":770876560,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDg3NjU2MA==","user":{"login":"Manno15","id":29436247,"node_id":"MDQ6VXNlcjI5NDM2MjQ3","avatar_url":"https://avatars.githubusercontent.com/u/29436247?v=4","gravatar_id":"","url":"https://api.github.com/users/Manno15","html_url":"https://github.com/Manno15","followers_url":"https://api.github.com/users/Manno15/followers","following_url":"https://api.github.com/users/Manno15/following{/other_user}","gists_url":"https://api.github.com/users/Manno15/gists{/gist_id}","starred_url":"https://api.github.com/users/Manno15/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Manno15/subscriptions","organizations_url":"https://api.github.com/users/Manno15/orgs","repos_url":"https://api.github.com/users/Manno15/repos","events_url":"https://api.github.com/users/Manno15/events{/privacy}","received_events_url":"https://api.github.com/users/Manno15/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T13:59:20Z","updated_at":"2021-02-01T13:59:20Z","author_association":"CONTRIBUTOR","body":"I updated the license and upgraded to 3.19.0. There wasn't anything noticeable to the upgrade that would benefit us so no further changes from it. I will merge this today unless there are any objections. ","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770876560/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770888503","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-770888503","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":770888503,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDg4ODUwMw==","user":{"login":"dlmarion","id":567911,"node_id":"MDQ6VXNlcjU2NzkxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/567911?v=4","gravatar_id":"","url":"https://api.github.com/users/dlmarion","html_url":"https://github.com/dlmarion","followers_url":"https://api.github.com/users/dlmarion/followers","following_url":"https://api.github.com/users/dlmarion/following{/other_user}","gists_url":"https://api.github.com/users/dlmarion/gists{/gist_id}","starred_url":"https://api.github.com/users/dlmarion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dlmarion/subscriptions","organizations_url":"https://api.github.com/users/dlmarion/orgs","repos_url":"https://api.github.com/users/dlmarion/repos","events_url":"https://api.github.com/users/dlmarion/events{/privacy}","received_events_url":"https://api.github.com/users/dlmarion/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T14:15:46Z","updated_at":"2021-02-01T14:15:46Z","author_association":"CONTRIBUTOR","body":"@ctubbsii - I pushed a fix for VolumeIT. Are you seeing any other test failures?","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770888503/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770900835","html_url":"https://github.com/apache/accumulo/issues/1893#issuecomment-770900835","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1893","id":770900835,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDkwMDgzNQ==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T14:33:24Z","updated_at":"2021-02-01T14:33:24Z","author_association":"CONTRIBUTOR","body":"Some parts of the code could use this util:\r\nhttps://github.com/apache/accumulo/blob/3fd5cad92f9b63ac19e4466f3f2d5237b905262c/core/src/main/java/org/apache/accumulo/fate/util/UtilWaitThread.java#L49\r\nBut it should probably be moved out of the FATE package.  It is already used in a bunch of ITs.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770900835/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770987478","html_url":"https://github.com/apache/accumulo/issues/1666#issuecomment-770987478","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1666","id":770987478,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDk4NzQ3OA==","user":{"login":"dlmarion","id":567911,"node_id":"MDQ6VXNlcjU2NzkxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/567911?v=4","gravatar_id":"","url":"https://api.github.com/users/dlmarion","html_url":"https://github.com/dlmarion","followers_url":"https://api.github.com/users/dlmarion/followers","following_url":"https://api.github.com/users/dlmarion/following{/other_user}","gists_url":"https://api.github.com/users/dlmarion/gists{/gist_id}","starred_url":"https://api.github.com/users/dlmarion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dlmarion/subscriptions","organizations_url":"https://api.github.com/users/dlmarion/orgs","repos_url":"https://api.github.com/users/dlmarion/repos","events_url":"https://api.github.com/users/dlmarion/events{/privacy}","received_events_url":"https://api.github.com/users/dlmarion/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T16:36:31Z","updated_at":"2021-02-01T16:36:31Z","author_association":"CONTRIBUTOR","body":"@EdColeman - can you point me to the code that you are referring to when you say \"reading and caching the tablet markers in a wal file?\" Are you referring suggesting making this [map](https://github.com/apache/accumulo/blob/main/server/tserver/src/main/java/org/apache/accumulo/tserver/log/SortedLogRecovery.java#L142) a cache, or something else?","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770987478/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770998940","html_url":"https://github.com/apache/accumulo/pull/1887#issuecomment-770998940","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1887","id":770998940,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MDk5ODk0MA==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T16:53:06Z","updated_at":"2021-02-01T16:53:06Z","author_association":"CONTRIBUTOR","body":"I was doing some testing using Uno running 2 RW MultiTable jobs and saw a bad situation with this change. The `LargestFirstMemoryManager` will select the largest tablets to be flushed (default for _tserver.compaction.minor.concurrent.max_ is 4) and if they all happen to be in the table being deleted, no tablets will get flushed and things on the tserver will get stuck. Something is preventing the tablets from being unloaded and this new check stops them from being flushed. I am not sure why they still aren't being unloaded but we may need to revert this change.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/770998940/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771002073","html_url":"https://github.com/apache/accumulo/pull/1887#issuecomment-771002073","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1887","id":771002073,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTAwMjA3Mw==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T16:57:19Z","updated_at":"2021-02-01T16:57:19Z","author_association":"MEMBER","body":"> ... no tablets will get flushed and things on the tserver will get stuck. Something is preventing the tablets from being unloaded and this new check stops them from being flushed. I am not sure why they still aren't being unloaded but we may need to revert this change.\r\n\r\n@milleruntime This sounds serious. Have you already created a blocker issue to track this? I wouldn't want it to get lost.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771002073/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771004529","html_url":"https://github.com/apache/accumulo/pull/1887#issuecomment-771004529","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1887","id":771004529,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTAwNDUyOQ==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T17:01:10Z","updated_at":"2021-02-01T17:01:10Z","author_association":"CONTRIBUTOR","body":"> > ... no tablets will get flushed and things on the tserver will get stuck. Something is preventing the tablets from being unloaded and this new check stops them from being flushed. I am not sure why they still aren't being unloaded but we may need to revert this change.\r\n> \r\n> @milleruntime This sounds serious. Have you already created a blocker issue to track this? I wouldn't want it to get lost.\r\n\r\nNo I was about to revert the commit.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771004529/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771007878","html_url":"https://github.com/apache/accumulo/pull/1887#issuecomment-771007878","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1887","id":771007878,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTAwNzg3OA==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T17:06:07Z","updated_at":"2021-02-01T17:06:07Z","author_association":"CONTRIBUTOR","body":"Reverted this commit with fd001c9ec3a55aa6427667c4143f1d6772739c86 due to my previous comment about the bad situation.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771007878/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771031662","html_url":"https://github.com/apache/accumulo/issues/1893#issuecomment-771031662","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1893","id":771031662,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTAzMTY2Mg==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T17:42:26Z","updated_at":"2021-02-01T17:42:26Z","author_association":"MEMBER","body":"> Some parts of the code could use this util:\r\n> https://github.com/apache/accumulo/blob/3fd5cad92f9b63ac19e4466f3f2d5237b905262c/core/src/main/java/org/apache/accumulo/fate/util/UtilWaitThread.java#L49\r\n> \r\n> \r\n> But it should probably be moved out of the FATE package. It is already used in a bunch of ITs.\r\n\r\nThis is a holdover from when accumulo-fate was a separate jar. A lot of the fate stuff was left in their current packages to avoid making any changes that might affect FaTE serialization. This one is probably safe to move, since it is a static void method only, and there's probably other generic utilities that can be moved as well, but since it's all internal, it doesn't matter that much to move it. But, if somebody does move it, they should be careful to avoid breaking FaTE serialization by moving serialized objects.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771031662/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771051465","html_url":"https://github.com/apache/accumulo/issues/1666#issuecomment-771051465","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1666","id":771051465,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTA1MTQ2NQ==","user":{"login":"EdColeman","id":7047700,"node_id":"MDQ6VXNlcjcwNDc3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/7047700?v=4","gravatar_id":"","url":"https://api.github.com/users/EdColeman","html_url":"https://github.com/EdColeman","followers_url":"https://api.github.com/users/EdColeman/followers","following_url":"https://api.github.com/users/EdColeman/following{/other_user}","gists_url":"https://api.github.com/users/EdColeman/gists{/gist_id}","starred_url":"https://api.github.com/users/EdColeman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/EdColeman/subscriptions","organizations_url":"https://api.github.com/users/EdColeman/orgs","repos_url":"https://api.github.com/users/EdColeman/repos","events_url":"https://api.github.com/users/EdColeman/events{/privacy}","received_events_url":"https://api.github.com/users/EdColeman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T18:13:19Z","updated_at":"2021-02-01T18:13:19Z","author_association":"CONTRIBUTOR","body":"I'll look @keith-turner suggested this approach - from what I recall, during recovery the logs would show repeated messages from reading / processing the wals.\r\n\r\nI think it may have been the list of wals was processed multiple times - once for each tablet?  I believe the idea was that the processing could occur once and then be cached for the duration of that recovery session.  I didn't explore if that cache should be a map or another in-memory representation.\r\n","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771051465/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771057716","html_url":"https://github.com/apache/accumulo/pull/1866#issuecomment-771057716","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1866","id":771057716,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTA1NzcxNg==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T18:19:46Z","updated_at":"2021-02-01T18:20:04Z","author_association":"MEMBER","body":"> @ctubbsii - I pushed a fix for VolumeIT. Are you seeing any other test failures?\r\n\r\nThat was the only one I saw. I haven't re-run all of them with your latest. I don't have any objections to this change being merged in if you've fixed that, but there are a few unresolved comment threads above that you might want to mark as resolved, or address, before merging.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771057716/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771065722","html_url":"https://github.com/apache/accumulo/issues/1893#issuecomment-771065722","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1893","id":771065722,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTA2NTcyMg==","user":{"login":"EdColeman","id":7047700,"node_id":"MDQ6VXNlcjcwNDc3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/7047700?v=4","gravatar_id":"","url":"https://api.github.com/users/EdColeman","html_url":"https://github.com/EdColeman","followers_url":"https://api.github.com/users/EdColeman/followers","following_url":"https://api.github.com/users/EdColeman/following{/other_user}","gists_url":"https://api.github.com/users/EdColeman/gists{/gist_id}","starred_url":"https://api.github.com/users/EdColeman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/EdColeman/subscriptions","organizations_url":"https://api.github.com/users/EdColeman/orgs","repos_url":"https://api.github.com/users/EdColeman/repos","events_url":"https://api.github.com/users/EdColeman/events{/privacy}","received_events_url":"https://api.github.com/users/EdColeman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T18:32:31Z","updated_at":"2021-02-01T18:32:31Z","author_association":"CONTRIBUTOR","body":"It seems that there were multiple packaging decisions that were originally made with the FATE design - I believe the stated goal was that FATEs could become a stand-alone product outside of Accumulo.  Should we revisit that?  If moving the method would impact FATE serialization should other changes be made concurrently so that FATE serialization would only change once?  Also, I believe that during upgrades it is necessary to insure that no FATE transactions are pending or the upgrade aborts - so changes in serialization should not be a factor between upgrades.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771065722/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771107330","html_url":"https://github.com/apache/accumulo/pull/1895#issuecomment-771107330","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1895","id":771107330,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTEwNzMzMA==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T19:39:35Z","updated_at":"2021-02-01T19:39:35Z","author_association":"MEMBER","body":"@dlmarion This was closed without comment. Was this included in, or superseded by, #1866 ?","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771107330/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771128349","html_url":"https://github.com/apache/accumulo/pull/1891#issuecomment-771128349","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1891","id":771128349,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTEyODM0OQ==","user":{"login":"brianloss","id":5400335,"node_id":"MDQ6VXNlcjU0MDAzMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5400335?v=4","gravatar_id":"","url":"https://api.github.com/users/brianloss","html_url":"https://github.com/brianloss","followers_url":"https://api.github.com/users/brianloss/followers","following_url":"https://api.github.com/users/brianloss/following{/other_user}","gists_url":"https://api.github.com/users/brianloss/gists{/gist_id}","starred_url":"https://api.github.com/users/brianloss/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brianloss/subscriptions","organizations_url":"https://api.github.com/users/brianloss/orgs","repos_url":"https://api.github.com/users/brianloss/repos","events_url":"https://api.github.com/users/brianloss/events{/privacy}","received_events_url":"https://api.github.com/users/brianloss/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T20:15:06Z","updated_at":"2021-02-01T20:15:06Z","author_association":"MEMBER","body":"> This is a big PR, I feel like I can only review it in chunks. Here's a few comments from stuff I noticed today.\r\n\r\nYeah, and I even tried to keep it as small as I could. One thing to keep in mind that could help... The balancers and tests are all just copies of those in the org.apache.accumulo.server.master.balancer package, but updated with the new interface and types added to the SPI package. If you check this branch out, then you can diff each balancer new file with its deprecated equivalent.\r\n\r\nI figured any improvements to the balancers themselves could be addressed as we want with a follow-on issue/pull request.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771128349/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771150438","html_url":"https://github.com/apache/accumulo/issues/1893#issuecomment-771150438","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1893","id":771150438,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTE1MDQzOA==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T20:53:34Z","updated_at":"2021-02-01T20:53:34Z","author_association":"MEMBER","body":"> It seems that there were multiple packaging decisions that were originally made with the FATE design - I believe the stated goal was that FATEs could become a stand-alone product outside of Accumulo.\r\n\r\nWhile that may have been something that was considered, the implementation was, and has always been, very tightly coupled to Accumulo itself.\r\n\r\n> Should we revisit that? If moving the method would impact FATE serialization should other changes be made concurrently so that FATE serialization would only change once?\r\n\r\nThe problem is that we use Java serialization (in hindsight, a bad choice), and therefore, lots of Java objects can accidentally leak into our serialized FaTE objects. We have, for example, unintentionally serialized Thrift objects (I believe TInfo was one). I don't know of any currently active proposals to redesign FaTE to decouple it from Accumulo, or to change how we serialize objects there any time soon.\r\n\r\nI don't see any compelling reason to revisit FaTE serialization at this time. But, if we did do something like that, it certainly would be better to do it across the board all at once. One future compelling reason might be the introduction of record objects in a future Java release, which may have safe and reliable serialization strategies. Another compelling reason would be to take advantage of some protobuf or thrift serialization for storage efficiency or performance, or something else. However, libraries like protobuf and thrift are notoriously problematic with dependency convergence.\r\n\r\n> Also, I believe that during upgrades it is necessary to insure that no FATE transactions are pending or the upgrade aborts - so changes in serialization should not be a factor between upgrades.\r\n\r\nIn general, that is true for major releases, but not for patch/bugfix releases. I don't know off the top of my head what we've done for minor releases, or what our current upgrade code would expect before upgrading from 2.0 to 2.1. However, the more incompatibilities we avoid, the easier our upgrade code and testing paths are.\r\n\r\nIn any case, I think it should be fine to relocate UtilWaitThread, though I don't see a huge value in it. I'm just suggesting caution whenever relocating any object that has potential to be serialized. Classes in packages marked as \"fate\" have a higher likelihood of being serialized, but they are not the only objects that could be affected by class relocations.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771150438/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771153815","html_url":"https://github.com/apache/accumulo/issues/1893#issuecomment-771153815","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1893","id":771153815,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTE1MzgxNQ==","user":{"login":"dlmarion","id":567911,"node_id":"MDQ6VXNlcjU2NzkxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/567911?v=4","gravatar_id":"","url":"https://api.github.com/users/dlmarion","html_url":"https://github.com/dlmarion","followers_url":"https://api.github.com/users/dlmarion/followers","following_url":"https://api.github.com/users/dlmarion/following{/other_user}","gists_url":"https://api.github.com/users/dlmarion/gists{/gist_id}","starred_url":"https://api.github.com/users/dlmarion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dlmarion/subscriptions","organizations_url":"https://api.github.com/users/dlmarion/orgs","repos_url":"https://api.github.com/users/dlmarion/repos","events_url":"https://api.github.com/users/dlmarion/events{/privacy}","received_events_url":"https://api.github.com/users/dlmarion/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T20:59:18Z","updated_at":"2021-02-01T20:59:18Z","author_association":"CONTRIBUTOR","body":"May want to look at [flatbuffers](https://google.github.io/flatbuffers/) if you have not done so already.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771153815/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771170172","html_url":"https://github.com/apache/accumulo/pull/1887#issuecomment-771170172","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1887","id":771170172,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTE3MDE3Mg==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T21:27:19Z","updated_at":"2021-02-01T21:27:19Z","author_association":"CONTRIBUTOR","body":"I think this wait in `Tablet.completeClose()` is what might have been holding up the tablets from being closed:\r\nhttps://github.com/apache/accumulo/blob/fd001c9ec3a55aa6427667c4143f1d6772739c86/server/tserver/src/main/java/org/apache/accumulo/tserver/tablet/Tablet.java#L1268\r\nThat would explain why the tablet wouldn't close but I am not sure why minor compaction was started, maybe it was being flushed by another processes? The wait above should only happen if this code was called:\r\nhttps://github.com/apache/accumulo/blob/4051a8c23be6f901585e07a6170b57383b2ecd69/server/tserver/src/main/java/org/apache/accumulo/tserver/tablet/TabletMemory.java#L61","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771170172/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771183971","html_url":"https://github.com/apache/accumulo/pull/1803#issuecomment-771183971","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1803","id":771183971,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTE4Mzk3MQ==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T21:52:03Z","updated_at":"2021-02-01T21:52:03Z","author_association":"MEMBER","body":"Since the original issue in #1303 was to \"explore\" the idea of creating unique directories, and a solution hasn't been identified in over 2 months, I'm inclined to think that this has been \"explored\" enough, and we should probably just close this, and the original issue #1303 , rather than continue to pursue it. ... unless somebody has some new strategy ready-to-try. Thoughts? Is #1303 worth continuing to pursue or no?","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771183971/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771220401","html_url":"https://github.com/apache/accumulo/pull/1887#issuecomment-771220401","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1887","id":771220401,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTIyMDQwMQ==","user":{"login":"keith-turner","id":1268739,"node_id":"MDQ6VXNlcjEyNjg3Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1268739?v=4","gravatar_id":"","url":"https://api.github.com/users/keith-turner","html_url":"https://github.com/keith-turner","followers_url":"https://api.github.com/users/keith-turner/followers","following_url":"https://api.github.com/users/keith-turner/following{/other_user}","gists_url":"https://api.github.com/users/keith-turner/gists{/gist_id}","starred_url":"https://api.github.com/users/keith-turner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keith-turner/subscriptions","organizations_url":"https://api.github.com/users/keith-turner/orgs","repos_url":"https://api.github.com/users/keith-turner/repos","events_url":"https://api.github.com/users/keith-turner/events{/privacy}","received_events_url":"https://api.github.com/users/keith-turner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-01T22:59:26Z","updated_at":"2021-02-01T23:00:20Z","author_association":"CONTRIBUTOR","body":"@milleruntime do you have any tserver stack traces from when it got stuck?  I have been poking around in the code looking for a possible cause, have not found anything yet.\r\n\r\nIt does seems like the LargestFirstMemManager may only return a subset of the tablets.  So if the subset it returns is always in the deleting state maybe that held up minor compactions from starting.  However something getting stuck in at  `getTabletMemory().waitForMinC()` should be waiting on a compaction that is runnning or queued to run.  If the threads in the executor service for minor compactions were gummed up, that could cause a problem (but have not seen a cause for that).\r\n\r\n> I think this wait in Tablet.completeClose() is what might have been holding up the tablets from being closed:\r\n\r\nWhat made you think this?","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771220401/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771595094","html_url":"https://github.com/apache/accumulo/pull/1803#issuecomment-771595094","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1803","id":771595094,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTU5NTA5NA==","user":{"login":"Manno15","id":29436247,"node_id":"MDQ6VXNlcjI5NDM2MjQ3","avatar_url":"https://avatars.githubusercontent.com/u/29436247?v=4","gravatar_id":"","url":"https://api.github.com/users/Manno15","html_url":"https://github.com/Manno15","followers_url":"https://api.github.com/users/Manno15/followers","following_url":"https://api.github.com/users/Manno15/following{/other_user}","gists_url":"https://api.github.com/users/Manno15/gists{/gist_id}","starred_url":"https://api.github.com/users/Manno15/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Manno15/subscriptions","organizations_url":"https://api.github.com/users/Manno15/orgs","repos_url":"https://api.github.com/users/Manno15/repos","events_url":"https://api.github.com/users/Manno15/events{/privacy}","received_events_url":"https://api.github.com/users/Manno15/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-02T12:15:56Z","updated_at":"2021-02-02T12:17:10Z","author_association":"CONTRIBUTOR","body":"> Since the original issue in #1303 was to \"explore\" the idea of creating unique directories, and a solution hasn't been identified in over 2 months, I'm inclined to think that this has been \"explored\" enough, and we should probably just close this, and the original issue #1303 , rather than continue to pursue it. ... unless somebody has some new strategy ready-to-try. Thoughts? Is #1303 worth continuing to pursue or no?\r\n\r\nFWIW, I do think this is possible to implement. Either with the current mechanism, something similar, or a rewrite of how we do the recovery process currently. Just depends on much this feature is desired and beneficial. Especially on a large scale cluster. ","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771595094/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771659242","html_url":"https://github.com/apache/accumulo/issues/1893#issuecomment-771659242","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1893","id":771659242,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTY1OTI0Mg==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-02T14:08:19Z","updated_at":"2021-02-02T14:09:41Z","author_association":"CONTRIBUTOR","body":"> In any case, I think it should be fine to relocate UtilWaitThread, though I don't see a huge value in it. I'm just suggesting caution whenever relocating any object that has potential to be serialized. Classes in packages marked as \"fate\" have a higher likelihood of being serialized, but they are not the only objects that could be affected by class relocations.\r\n\r\nI agree. I only recommended its use as an easy way to standardize our handling of the sleep and catch IterruptedException use case, one of the situations this ticket aims to fix.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771659242/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771677164","html_url":"https://github.com/apache/accumulo/pull/1887#issuecomment-771677164","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1887","id":771677164,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTY3NzE2NA==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-02T14:34:54Z","updated_at":"2021-02-02T14:34:54Z","author_association":"CONTRIBUTOR","body":"> @milleruntime do you have any tserver stack traces from when it got stuck? I have been poking around in the code looking for a possible cause, have not found anything yet.\r\n\r\nThere weren't any errors, it was just the state of the tserver that I observed. It seemed no flushes from the memory manager were happening because the 4 tablets that were chosen by `LargestFirstMemoryManager.tabletsToMinorCompact()` were being rejected.  Here is what was showing up in the logs repeatedly:\r\n<pre>\r\n2021-02-01T15:26:09,855 [memory.LargestFirstMemoryManager] DEBUG: COMPACTING 2k;6;5  total = 178,210,928 ingestMemory = 178,210,928\r\n2021-02-01T15:26:09,855 [memory.LargestFirstMemoryManager] DEBUG: chosenMem = 2,614,281 chosenIT = 313.02 load 3,326,974\r\n2021-02-01T15:26:09,855 [memory.LargestFirstMemoryManager] DEBUG: COMPACTING 2k;9;8  total = 178,210,928 ingestMemory = 178,210,928\r\n2021-02-01T15:26:09,855 [memory.LargestFirstMemoryManager] DEBUG: chosenMem = 2,544,515 chosenIT = 313.02 load 3,238,194\r\n2021-02-01T15:26:09,855 [memory.LargestFirstMemoryManager] DEBUG: COMPACTING 2k<;9  total = 178,210,928 ingestMemory = 178,210,928\r\n2021-02-01T15:26:09,855 [memory.LargestFirstMemoryManager] DEBUG: chosenMem = 2,534,061 chosenIT = 313.02 load 3,224,885\r\n2021-02-01T15:26:09,855 [memory.LargestFirstMemoryManager] DEBUG: COMPACTING 2k;4;3  total = 178,210,928 ingestMemory = 178,210,928\r\n2021-02-01T15:26:09,855 [memory.LargestFirstMemoryManager] DEBUG: chosenMem = 2,431,564 chosenIT = 313.02 load 3,094,446\r\n2021-02-01T15:26:09,855 [tablet.Tablet] DEBUG: Table 2k is being deleted so don't flush 2k;6;5\r\n2021-02-01T15:26:09,855 [tserver.TabletServerResourceManager] INFO : Ignoring memory manager recommendation: not minor compacting 2k;6;5\r\n2021-02-01T15:26:09,855 [tablet.Tablet] DEBUG: Table 2k is being deleted so don't flush 2k;9;8\r\n2021-02-01T15:26:09,855 [tserver.TabletServerResourceManager] INFO : Ignoring memory manager recommendation: not minor compacting 2k;9;8\r\n2021-02-01T15:26:09,855 [tablet.Tablet] DEBUG: Table 2k is being deleted so don't flush 2k<;9\r\n2021-02-01T15:26:09,855 [tserver.TabletServerResourceManager] INFO : Ignoring memory manager recommendation: not minor compacting 2k<;9\r\n2021-02-01T15:26:09,855 [tablet.Tablet] DEBUG: Table 2k is being deleted so don't flush 2k;4;3\r\n2021-02-01T15:26:09,855 [tserver.TabletServerResourceManager] INFO : Ignoring memory manager recommendation: not minor compacting 2k;4;3\r\n</pre>\r\n \r\n> > I think this wait in Tablet.completeClose() is what might have been holding up the tablets from being closed:\r\n> \r\n> What made you think this?\r\n\r\nSince the tablets should have been unloaded, I was just looking through the code to try and figure out what was preventing them from unloading. I was guessing that something else triggered a flush for the tablet calling `Tablet.prepareForMinC()` and would prevent the `getTabletMemory().waitForMinC()` call in the close from finishing. But now that I think about it more, if this happened, there shouldn't have been anything preventing the other flush thread from completing since the check I added is in `Tablet.initiateMinorCompaction()`.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771677164/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771744382","html_url":"https://github.com/apache/accumulo/pull/1887#issuecomment-771744382","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1887","id":771744382,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTc0NDM4Mg==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-02T16:06:11Z","updated_at":"2021-02-02T16:06:11Z","author_association":"CONTRIBUTOR","body":"It could just be a lack of resources when it gets to the state where the largest tablets are being deleted. The Memory mgr isn't able to clear out the biggest chunks of memory so everything slows down. I saw it happen again but eventually the tablets get unloaded and deleted. So maybe this change just needs more work. I am thinking we might be able to just remove the tablets being deleted from the memory reports, moving things along.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771744382/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771838288","html_url":"https://github.com/apache/accumulo/issues/1870#issuecomment-771838288","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1870","id":771838288,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTgzODI4OA==","user":{"login":"slackwinner","id":50567198,"node_id":"MDQ6VXNlcjUwNTY3MTk4","avatar_url":"https://avatars.githubusercontent.com/u/50567198?v=4","gravatar_id":"","url":"https://api.github.com/users/slackwinner","html_url":"https://github.com/slackwinner","followers_url":"https://api.github.com/users/slackwinner/followers","following_url":"https://api.github.com/users/slackwinner/following{/other_user}","gists_url":"https://api.github.com/users/slackwinner/gists{/gist_id}","starred_url":"https://api.github.com/users/slackwinner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/slackwinner/subscriptions","organizations_url":"https://api.github.com/users/slackwinner/orgs","repos_url":"https://api.github.com/users/slackwinner/repos","events_url":"https://api.github.com/users/slackwinner/events{/privacy}","received_events_url":"https://api.github.com/users/slackwinner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-02T17:51:47Z","updated_at":"2021-02-02T17:51:47Z","author_association":"CONTRIBUTOR","body":"@ctubbsii I have integrated the Accumulo jshell command into \"bin/accumulo\". In addition, I am currently working on automating the import process for the Accumulo public API into jshell. Will push over a working version of the modified files soon.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771838288/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771883813","html_url":"https://github.com/apache/accumulo/pull/1803#issuecomment-771883813","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1803","id":771883813,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTg4MzgxMw==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-02T18:47:40Z","updated_at":"2021-02-02T18:47:40Z","author_association":"MEMBER","body":"It occurs to me that even if we could get this working, during recovery it would be possible that it could repeatedly fail and each new attempt would fill DFS even more as it kept trying. Given the increasing complexity of this issue, and the potential for downsides, with the upside being not entirely clear, I'm thinking that this issue has been explored enough, and this, along with #1303 should be closed.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771883813/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771925803","html_url":"https://github.com/apache/accumulo/pull/1887#issuecomment-771925803","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1887","id":771925803,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTkyNTgwMw==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-02T19:43:29Z","updated_at":"2021-02-02T19:43:29Z","author_association":"CONTRIBUTOR","body":"I created an enhanced version of this change in https://github.com/apache/accumulo/pull/1899","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771925803/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771930792","html_url":"https://github.com/apache/accumulo/pull/1899#issuecomment-771930792","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1899","id":771930792,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTkzMDc5Mg==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-02T19:50:39Z","updated_at":"2021-02-02T19:50:39Z","author_association":"CONTRIBUTOR","body":"I tested this enhancement on Uno with 2 tservers running 2 RW MultiTable jobs and a Conditional job for increased pressure. It worked well and I saw a few situations where the largest tablet to be flushed was being deleted and dropped from the memory report. I was able to get the cluster up to 200+ tables with 2000+ tablets before the GC started running low on memory.\r\n\r\n<pre>\r\n2021-02-02T13:59:35,144 [tablet.Tablet] DEBUG: Table 6z is being deleted so don't flush 6z;4;3\r\n2021-02-02T13:59:35,144 [tserver.TabletServerResourceManager] DEBUG: Cleaned up report for closed/deleted tablet 6z;4;3\r\n2021-02-02T13:59:35,144 [tserver.TabletServerResourceManager] DEBUG: Ignoring memory manager recommendation: not minor compacting closed tablet 6z;4;3\r\n</pre>","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771930792/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771955872","html_url":"https://github.com/apache/accumulo/issues/1898#issuecomment-771955872","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1898","id":771955872,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MTk1NTg3Mg==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-02T20:24:31Z","updated_at":"2021-02-02T20:24:31Z","author_association":"MEMBER","body":"@billierinaldi Do you happen to remember what was wrong with the one you saw?","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/771955872/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772040550","html_url":"https://github.com/apache/accumulo/issues/1898#issuecomment-772040550","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1898","id":772040550,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MjA0MDU1MA==","user":{"login":"billierinaldi","id":1810597,"node_id":"MDQ6VXNlcjE4MTA1OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1810597?v=4","gravatar_id":"","url":"https://api.github.com/users/billierinaldi","html_url":"https://github.com/billierinaldi","followers_url":"https://api.github.com/users/billierinaldi/followers","following_url":"https://api.github.com/users/billierinaldi/following{/other_user}","gists_url":"https://api.github.com/users/billierinaldi/gists{/gist_id}","starred_url":"https://api.github.com/users/billierinaldi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/billierinaldi/subscriptions","organizations_url":"https://api.github.com/users/billierinaldi/orgs","repos_url":"https://api.github.com/users/billierinaldi/repos","events_url":"https://api.github.com/users/billierinaldi/events{/privacy}","received_events_url":"https://api.github.com/users/billierinaldi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-02T22:12:46Z","updated_at":"2021-02-02T22:12:46Z","author_association":"CONTRIBUTOR","body":"I started looking into it, but have not completed an exhaustive analysis. It looked like DataTables and Bootstrap were added to the monitor source and do not appear in the source tarball license file. In the binary tarball, I started looking at the included jars and it seemed like there were a number of them that might require inclusion in the license or notice file.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772040550/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772628843","html_url":"https://github.com/apache/accumulo/issues/1659#issuecomment-772628843","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1659","id":772628843,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MjYyODg0Mw==","user":{"login":"keith-turner","id":1268739,"node_id":"MDQ6VXNlcjEyNjg3Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1268739?v=4","gravatar_id":"","url":"https://api.github.com/users/keith-turner","html_url":"https://github.com/keith-turner","followers_url":"https://api.github.com/users/keith-turner/followers","following_url":"https://api.github.com/users/keith-turner/following{/other_user}","gists_url":"https://api.github.com/users/keith-turner/gists{/gist_id}","starred_url":"https://api.github.com/users/keith-turner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keith-turner/subscriptions","organizations_url":"https://api.github.com/users/keith-turner/orgs","repos_url":"https://api.github.com/users/keith-turner/repos","events_url":"https://api.github.com/users/keith-turner/events{/privacy}","received_events_url":"https://api.github.com/users/keith-turner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T16:15:11Z","updated_at":"2021-02-03T16:15:11Z","author_association":"CONTRIBUTOR","body":"I was looking at VolumeChooser and it has some new methods added for 2.1.  Thinking it would be a good candidate for moving to SPI, possibly only adding the new methods in the SPI.  I am going to look into doing this.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772628843/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772633212","html_url":"https://github.com/apache/accumulo/pull/1892#issuecomment-772633212","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1892","id":772633212,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MjYzMzIxMg==","user":{"login":"DomGarguilo","id":47725857,"node_id":"MDQ6VXNlcjQ3NzI1ODU3","avatar_url":"https://avatars.githubusercontent.com/u/47725857?v=4","gravatar_id":"","url":"https://api.github.com/users/DomGarguilo","html_url":"https://github.com/DomGarguilo","followers_url":"https://api.github.com/users/DomGarguilo/followers","following_url":"https://api.github.com/users/DomGarguilo/following{/other_user}","gists_url":"https://api.github.com/users/DomGarguilo/gists{/gist_id}","starred_url":"https://api.github.com/users/DomGarguilo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/DomGarguilo/subscriptions","organizations_url":"https://api.github.com/users/DomGarguilo/orgs","repos_url":"https://api.github.com/users/DomGarguilo/repos","events_url":"https://api.github.com/users/DomGarguilo/events{/privacy}","received_events_url":"https://api.github.com/users/DomGarguilo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T16:20:58Z","updated_at":"2021-02-03T16:20:58Z","author_association":"MEMBER","body":"The most recent commit contains the remaining cases where the conversion to pre-split tables seems appropriate. The remaining cases that add splits after the table is created seemed to do so on purpose so they were left alone.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772633212/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772634739","html_url":"https://github.com/apache/accumulo/issues/1900#issuecomment-772634739","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1900","id":772634739,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MjYzNDczOQ==","user":{"login":"keith-turner","id":1268739,"node_id":"MDQ6VXNlcjEyNjg3Mzk=","avatar_url":"https://avatars.githubusercontent.com/u/1268739?v=4","gravatar_id":"","url":"https://api.github.com/users/keith-turner","html_url":"https://github.com/keith-turner","followers_url":"https://api.github.com/users/keith-turner/followers","following_url":"https://api.github.com/users/keith-turner/following{/other_user}","gists_url":"https://api.github.com/users/keith-turner/gists{/gist_id}","starred_url":"https://api.github.com/users/keith-turner/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/keith-turner/subscriptions","organizations_url":"https://api.github.com/users/keith-turner/orgs","repos_url":"https://api.github.com/users/keith-turner/repos","events_url":"https://api.github.com/users/keith-turner/events{/privacy}","received_events_url":"https://api.github.com/users/keith-turner/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T16:23:01Z","updated_at":"2021-02-03T16:23:01Z","author_association":"CONTRIBUTOR","body":"Below are two commits that changed the interface for 2.1.0-SNAP\r\n\r\nbd2ddba861a466aa8bdfe59fcab53ab6003a03be\r\n9af60eacc570ccc807201cb0673123c67d3e6d07","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772634739/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772741980","html_url":"https://github.com/apache/accumulo/issues/1902#issuecomment-772741980","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1902","id":772741980,"node_id":"MDEyOklzc3VlQ29tbWVudDc3Mjc0MTk4MA==","user":{"login":"dlmarion","id":567911,"node_id":"MDQ6VXNlcjU2NzkxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/567911?v=4","gravatar_id":"","url":"https://api.github.com/users/dlmarion","html_url":"https://github.com/dlmarion","followers_url":"https://api.github.com/users/dlmarion/followers","following_url":"https://api.github.com/users/dlmarion/following{/other_user}","gists_url":"https://api.github.com/users/dlmarion/gists{/gist_id}","starred_url":"https://api.github.com/users/dlmarion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dlmarion/subscriptions","organizations_url":"https://api.github.com/users/dlmarion/orgs","repos_url":"https://api.github.com/users/dlmarion/repos","events_url":"https://api.github.com/users/dlmarion/events{/privacy}","received_events_url":"https://api.github.com/users/dlmarion/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T18:58:37Z","updated_at":"2021-02-03T18:58:37Z","author_association":"CONTRIBUTOR","body":"So, https://issues.apache.org/jira/browse/ACCUMULO-2360 implemented a fix for large messages so that an OOME does not occur. https://issues.apache.org/jira/browse/ACCUMULO-2367 suggests that each service should have its own configurable thrift buffer pools. https://issues.apache.org/jira/browse/ACCUMULO-2352 is for adding one to the master specifically. I have the following questions:\r\n\r\n1. What's the downside to the Manager using a larger than needed buffer?\r\n2. What's the optimal size for the buffer for the Manager?\r\n3. What's the side effect if a user makes it too small?\r\n\r\nIf the answer to #1 is \"none\" or something similar then I would suggest that we don't implement this change for several reasons.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772741980/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772758439","html_url":"https://github.com/apache/accumulo/issues/603#issuecomment-772758439","issue_url":"https://api.github.com/repos/apache/accumulo/issues/603","id":772758439,"node_id":"MDEyOklzc3VlQ29tbWVudDc3Mjc1ODQzOQ==","user":{"login":"dlmarion","id":567911,"node_id":"MDQ6VXNlcjU2NzkxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/567911?v=4","gravatar_id":"","url":"https://api.github.com/users/dlmarion","html_url":"https://github.com/dlmarion","followers_url":"https://api.github.com/users/dlmarion/followers","following_url":"https://api.github.com/users/dlmarion/following{/other_user}","gists_url":"https://api.github.com/users/dlmarion/gists{/gist_id}","starred_url":"https://api.github.com/users/dlmarion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dlmarion/subscriptions","organizations_url":"https://api.github.com/users/dlmarion/orgs","repos_url":"https://api.github.com/users/dlmarion/repos","events_url":"https://api.github.com/users/dlmarion/events{/privacy}","received_events_url":"https://api.github.com/users/dlmarion/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T19:24:23Z","updated_at":"2021-02-03T19:24:23Z","author_association":"CONTRIBUTOR","body":"@ctubbsii It looks like this may have been addressed in https://github.com/apache/accumulo/pull/781","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772758439/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772768740","html_url":"https://github.com/apache/accumulo/issues/1872#issuecomment-772768740","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1872","id":772768740,"node_id":"MDEyOklzc3VlQ29tbWVudDc3Mjc2ODc0MA==","user":{"login":"milleruntime","id":11872539,"node_id":"MDQ6VXNlcjExODcyNTM5","avatar_url":"https://avatars.githubusercontent.com/u/11872539?v=4","gravatar_id":"","url":"https://api.github.com/users/milleruntime","html_url":"https://github.com/milleruntime","followers_url":"https://api.github.com/users/milleruntime/followers","following_url":"https://api.github.com/users/milleruntime/following{/other_user}","gists_url":"https://api.github.com/users/milleruntime/gists{/gist_id}","starred_url":"https://api.github.com/users/milleruntime/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/milleruntime/subscriptions","organizations_url":"https://api.github.com/users/milleruntime/orgs","repos_url":"https://api.github.com/users/milleruntime/repos","events_url":"https://api.github.com/users/milleruntime/events{/privacy}","received_events_url":"https://api.github.com/users/milleruntime/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T19:36:29Z","updated_at":"2021-02-03T19:36:29Z","author_association":"CONTRIBUTOR","body":"Another area I want to look into is here in Tablet.completeClose():\r\nhttps://github.com/apache/accumulo/blob/fd001c9ec3a55aa6427667c4143f1d6772739c86/server/tserver/src/main/java/org/apache/accumulo/tserver/tablet/Tablet.java#L1260\r\n\r\nIt looks like every bulk import call to a tablet will increase `writesInProgress`. So if a tablet has a lot of Bulk Imports or one large one, it could cause the close to wait there for a while.\r\n","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772768740/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772823356","html_url":"https://github.com/apache/accumulo/pull/1904#issuecomment-772823356","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1904","id":772823356,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MjgyMzM1Ng==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T21:07:09Z","updated_at":"2021-02-03T21:07:09Z","author_association":"MEMBER","body":"> TableState is used in the AbstractInputFormat classes\r\n\r\nAt some future point, we should ensure that the mapreduce classes in the new mapreduce module, only use public API, but I don't think it's a concern here for the reason you mentioned, as this is relatively low risk (we version and ship the mapreduce module ourselves).","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772823356/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772829931","html_url":"https://github.com/apache/accumulo/issues/1902#issuecomment-772829931","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1902","id":772829931,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MjgyOTkzMQ==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T21:17:32Z","updated_at":"2021-02-03T21:17:32Z","author_association":"MEMBER","body":"> ACCUMULO-2367 suggests that each service should have its own configurable thrift buffer pools.\r\n\r\nI don't think this has really been a problem. The 2367 was pretty speculative about the possible benefits from this.\r\n\r\n> If the answer to #1 is \"none\" or something similar then I would suggest that we don't implement this change for several reasons.\r\n\r\nI think the downside is probably small to none. If this hasn't been a problem since 2014 when the issue was created, I'm inclined to recommend closing this and ACCUMULO-2367 as \"not a problem\".","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772829931/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772831083","html_url":"https://github.com/apache/accumulo/issues/1902#issuecomment-772831083","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1902","id":772831083,"node_id":"MDEyOklzc3VlQ29tbWVudDc3MjgzMTA4Mw==","user":{"login":"dlmarion","id":567911,"node_id":"MDQ6VXNlcjU2NzkxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/567911?v=4","gravatar_id":"","url":"https://api.github.com/users/dlmarion","html_url":"https://github.com/dlmarion","followers_url":"https://api.github.com/users/dlmarion/followers","following_url":"https://api.github.com/users/dlmarion/following{/other_user}","gists_url":"https://api.github.com/users/dlmarion/gists{/gist_id}","starred_url":"https://api.github.com/users/dlmarion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dlmarion/subscriptions","organizations_url":"https://api.github.com/users/dlmarion/orgs","repos_url":"https://api.github.com/users/dlmarion/repos","events_url":"https://api.github.com/users/dlmarion/events{/privacy}","received_events_url":"https://api.github.com/users/dlmarion/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T21:19:18Z","updated_at":"2021-02-03T21:19:18Z","author_association":"CONTRIBUTOR","body":"+1 to closing.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772831083/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772866045","html_url":"https://github.com/apache/accumulo/issues/1903#issuecomment-772866045","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1903","id":772866045,"node_id":"MDEyOklzc3VlQ29tbWVudDc3Mjg2NjA0NQ==","user":{"login":"ctubbsii","id":1280725,"node_id":"MDQ6VXNlcjEyODA3MjU=","avatar_url":"https://avatars.githubusercontent.com/u/1280725?v=4","gravatar_id":"","url":"https://api.github.com/users/ctubbsii","html_url":"https://github.com/ctubbsii","followers_url":"https://api.github.com/users/ctubbsii/followers","following_url":"https://api.github.com/users/ctubbsii/following{/other_user}","gists_url":"https://api.github.com/users/ctubbsii/gists{/gist_id}","starred_url":"https://api.github.com/users/ctubbsii/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ctubbsii/subscriptions","organizations_url":"https://api.github.com/users/ctubbsii/orgs","repos_url":"https://api.github.com/users/ctubbsii/repos","events_url":"https://api.github.com/users/ctubbsii/events{/privacy}","received_events_url":"https://api.github.com/users/ctubbsii/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T22:20:39Z","updated_at":"2021-02-03T22:20:39Z","author_association":"MEMBER","body":"@Manno15 issues should generally not be questions, but clear well-defined tasks whenever possible. This is especially true for those with the \"good first issue\" label, because those can attract new contributors. If a new contributor tries to work on a task with an open ended question, it can create a very confusing and unpleasant experience for them if the community hasn't yet decided on a course of action. If you want to get feedback or consensus from the community on an idea, the best place to do that is on the developer mailing list, rather than in the body of a new issue.\r\n\r\nThere is a subtlety in the implementation here... the `-s`, `-t`, `-p`, or `-ns` define the scope of where the permission is being granted, not the type of permission. It's just that the system scope is implied by the fact that system permission types can only be granted on the system scope. That may not be true in the future, although I don't have a current use case since, up to now, we've duplicated permission types for different scopes (such as `System.CREATE_TABLE` and `Namespace.CREATE_TABLE`, rather than allowing setting `System.CREATE_TABLE` in the namespace scope).\r\n\r\nFurthermore, the original design was to enforce exclusivity by requiring exactly one of `-s` or `-t` (later expanded to include `-p` and `-ns`). I'm not sure if that exclusivity is still enforced, but it should be. It shouldn't be possible to set more than one of any of those at a time. It may have been broken at some point by relaxing the requirement to specify the table with `-t` and infer the table based on the current shell state.\r\n\r\nI lean heavily towards keeping the requirement for the `-s` for a few reasons. First, it aligns with the design described above (the difference between the \"scope\" of where it is set vs. the \"type\" of permission being set). Second, I still think there's value in enforcing the mutual exclusivity and requiring exactly one of `-s`, `-t`, `-p`, and `-ns`. And finally, system permissions should be granted with care, and I am okay having a speed bump here.\r\n\r\nA better option would probably be to recognize the missing `-s` and provide a more helpful error message. I think originally, the mutual exclusivity was enforced, the error message should have been something like \"missing one of -s, -t\" or similar. If that was relaxed at any point, it may have introduced the worse error message.","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772866045/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772871032","html_url":"https://github.com/apache/accumulo/issues/1903#issuecomment-772871032","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1903","id":772871032,"node_id":"MDEyOklzc3VlQ29tbWVudDc3Mjg3MTAzMg==","user":{"login":"Manno15","id":29436247,"node_id":"MDQ6VXNlcjI5NDM2MjQ3","avatar_url":"https://avatars.githubusercontent.com/u/29436247?v=4","gravatar_id":"","url":"https://api.github.com/users/Manno15","html_url":"https://github.com/Manno15","followers_url":"https://api.github.com/users/Manno15/followers","following_url":"https://api.github.com/users/Manno15/following{/other_user}","gists_url":"https://api.github.com/users/Manno15/gists{/gist_id}","starred_url":"https://api.github.com/users/Manno15/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Manno15/subscriptions","organizations_url":"https://api.github.com/users/Manno15/orgs","repos_url":"https://api.github.com/users/Manno15/repos","events_url":"https://api.github.com/users/Manno15/events{/privacy}","received_events_url":"https://api.github.com/users/Manno15/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T22:30:13Z","updated_at":"2021-02-03T22:30:13Z","author_association":"CONTRIBUTOR","body":"> @Manno15 issues should generally not be questions, but clear well-defined tasks whenever possible. This is especially true for those with the \"good first issue\" label, because those can attract new contributors. If a new contributor tries to work on a task with an open ended question, it can create a very confusing and unpleasant experience for them if the community hasn't yet decided on a course of action. If you want to get feedback or consensus from the community on an idea, the best place to do that is on the developer mailing list, rather than in the body of a new issue.\r\n\r\nMy apologies. that makes sense. I will keep that in mind in the future so I don't make the same mistake. \r\n\r\n> A better option would probably be to recognize the missing -s and provide a more helpful error message. I think originally, the mutual exclusivity was enforced, the error message should have been something like \"missing one of -s, -t\" or similar. If that was relaxed at any point, it may have introduced the worse error message.\r\n\r\nI will look into this tomorrow. I am open to closing this issue as is. \r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772871032/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772871953","html_url":"https://github.com/apache/accumulo/issues/1902#issuecomment-772871953","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1902","id":772871953,"node_id":"MDEyOklzc3VlQ29tbWVudDc3Mjg3MTk1Mw==","user":{"login":"Manno15","id":29436247,"node_id":"MDQ6VXNlcjI5NDM2MjQ3","avatar_url":"https://avatars.githubusercontent.com/u/29436247?v=4","gravatar_id":"","url":"https://api.github.com/users/Manno15","html_url":"https://github.com/Manno15","followers_url":"https://api.github.com/users/Manno15/followers","following_url":"https://api.github.com/users/Manno15/following{/other_user}","gists_url":"https://api.github.com/users/Manno15/gists{/gist_id}","starred_url":"https://api.github.com/users/Manno15/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Manno15/subscriptions","organizations_url":"https://api.github.com/users/Manno15/orgs","repos_url":"https://api.github.com/users/Manno15/repos","events_url":"https://api.github.com/users/Manno15/events{/privacy}","received_events_url":"https://api.github.com/users/Manno15/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T22:32:02Z","updated_at":"2021-02-03T22:32:02Z","author_association":"CONTRIBUTOR","body":"I am open to closing both. I will leave this open until tomorrow in case anyone else wants to add in their feedback and opinions. ","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772871953/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772874729","html_url":"https://github.com/apache/accumulo/pull/1891#issuecomment-772874729","issue_url":"https://api.github.com/repos/apache/accumulo/issues/1891","id":772874729,"node_id":"MDEyOklzc3VlQ29tbWVudDc3Mjg3NDcyOQ==","user":{"login":"brianloss","id":5400335,"node_id":"MDQ6VXNlcjU0MDAzMzU=","avatar_url":"https://avatars.githubusercontent.com/u/5400335?v=4","gravatar_id":"","url":"https://api.github.com/users/brianloss","html_url":"https://github.com/brianloss","followers_url":"https://api.github.com/users/brianloss/followers","following_url":"https://api.github.com/users/brianloss/following{/other_user}","gists_url":"https://api.github.com/users/brianloss/gists{/gist_id}","starred_url":"https://api.github.com/users/brianloss/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brianloss/subscriptions","organizations_url":"https://api.github.com/users/brianloss/orgs","repos_url":"https://api.github.com/users/brianloss/repos","events_url":"https://api.github.com/users/brianloss/events{/privacy}","received_events_url":"https://api.github.com/users/brianloss/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-02-03T22:37:47Z","updated_at":"2021-02-03T22:37:47Z","author_association":"MEMBER","body":"> My only request for a change in this PR before it is merged is to rename the newly introduced SPI \"DefaultLoadBalancer\" to something like \"BasicLoadBalancer\" or \"SimpleLoadBalancer\" (unless there's a better, more descriptive name based on how it actually works), and with a brief class-level javadoc to describe the basic strategy.\r\n> \r\n> While the rename and addition of a javadoc could occur in a subsequent task, I think it makes more sense to have the better name (and basic description) in its initial introduction, since it is a wholly new class.\r\n\r\n@ctubbsii this is done in the latest commit. Let me know if you see anything else that needs addressed. Thanks!","reactions":{"url":"https://api.github.com/repos/apache/accumulo/issues/comments/772874729/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]