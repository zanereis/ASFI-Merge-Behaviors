[{"url":"https://api.github.com/repos/apache/drill/issues/comments/1008264094","html_url":"https://github.com/apache/drill/pull/2425#issuecomment-1008264094","issue_url":"https://api.github.com/repos/apache/drill/issues/2425","id":1008264094,"node_id":"IC_kwDOAFa5xc48GOOe","user":{"login":"vvysotskyi","id":20928429,"node_id":"MDQ6VXNlcjIwOTI4NDI5","avatar_url":"https://avatars.githubusercontent.com/u/20928429?v=4","gravatar_id":"","url":"https://api.github.com/users/vvysotskyi","html_url":"https://github.com/vvysotskyi","followers_url":"https://api.github.com/users/vvysotskyi/followers","following_url":"https://api.github.com/users/vvysotskyi/following{/other_user}","gists_url":"https://api.github.com/users/vvysotskyi/gists{/gist_id}","starred_url":"https://api.github.com/users/vvysotskyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vvysotskyi/subscriptions","organizations_url":"https://api.github.com/users/vvysotskyi/orgs","repos_url":"https://api.github.com/users/vvysotskyi/repos","events_url":"https://api.github.com/users/vvysotskyi/events{/privacy}","received_events_url":"https://api.github.com/users/vvysotskyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-09T09:44:25Z","updated_at":"2022-01-09T09:44:25Z","author_association":"MEMBER","body":"@kingswanwho, please fix the build. With the new version generated proto classes were changed, so please apply patch from the `Github CI / Run checkstyle and generate protobufs` job output.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1008264094/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1008308065","html_url":"https://github.com/apache/drill/pull/2419#issuecomment-1008308065","issue_url":"https://api.github.com/repos/apache/drill/issues/2419","id":1008308065,"node_id":"IC_kwDOAFa5xc48GY9h","user":{"login":"luocooong","id":50079619,"node_id":"MDQ6VXNlcjUwMDc5NjE5","avatar_url":"https://avatars.githubusercontent.com/u/50079619?v=4","gravatar_id":"","url":"https://api.github.com/users/luocooong","html_url":"https://github.com/luocooong","followers_url":"https://api.github.com/users/luocooong/followers","following_url":"https://api.github.com/users/luocooong/following{/other_user}","gists_url":"https://api.github.com/users/luocooong/gists{/gist_id}","starred_url":"https://api.github.com/users/luocooong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/luocooong/subscriptions","organizations_url":"https://api.github.com/users/luocooong/orgs","repos_url":"https://api.github.com/users/luocooong/repos","events_url":"https://api.github.com/users/luocooong/events{/privacy}","received_events_url":"https://api.github.com/users/luocooong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-09T14:28:10Z","updated_at":"2022-01-09T14:28:10Z","author_association":"MEMBER","body":"@paul-rogers Thank you for this great contribution, especially the key component: execution engine.\n\nIn the meantime, we will see the latest version of EVF in service and be friendly to the developers.\n\nWhat would you say if we were to define the 10 highlights of the latest version of EVF?","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1008308065/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1008495754","html_url":"https://github.com/apache/drill/pull/2419#issuecomment-1008495754","issue_url":"https://api.github.com/repos/apache/drill/issues/2419","id":1008495754,"node_id":"IC_kwDOAFa5xc48HGyK","user":{"login":"paul-rogers","id":3248881,"node_id":"MDQ6VXNlcjMyNDg4ODE=","avatar_url":"https://avatars.githubusercontent.com/u/3248881?v=4","gravatar_id":"","url":"https://api.github.com/users/paul-rogers","html_url":"https://github.com/paul-rogers","followers_url":"https://api.github.com/users/paul-rogers/followers","following_url":"https://api.github.com/users/paul-rogers/following{/other_user}","gists_url":"https://api.github.com/users/paul-rogers/gists{/gist_id}","starred_url":"https://api.github.com/users/paul-rogers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paul-rogers/subscriptions","organizations_url":"https://api.github.com/users/paul-rogers/orgs","repos_url":"https://api.github.com/users/paul-rogers/repos","events_url":"https://api.github.com/users/paul-rogers/events{/privacy}","received_events_url":"https://api.github.com/users/paul-rogers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T02:28:25Z","updated_at":"2022-01-10T02:28:25Z","author_association":"CONTRIBUTOR","body":"@luocooong, the 10 highlights of the latest version? There actually are not that many. If we talk just about this PR, the key bits are:\r\n\r\n* Simple integration with the Easy Format plugin.\r\n* Integrated limit-push-down support.\r\n\r\nIf we talk about EVF V2 compared with EVF V1:\r\n\r\n* Simpler developer API.\r\n* Full support for combining provided, table, and discovered schemas. (Provided is that given by the planner. Table is that which a reader can infer at open time, as for Parquet, CSV, JDBC, etc. Discovered is that which is found as the data is read, as in JDBC.)\r\n* Full schema reconciliation support for all data types, including the complex ones such as nested maps and arrays.\r\n\r\nAnd if we talk about EVF itself vs. \"classic\" roll-your-own vector code:\r\n\r\n* Simple API to write to vectors.\r\n* Control batch and individual vector sizes.\r\n* Foundation for the `RowSet` family of testing tools.\r\n* Highlighted the limitations of \"schema on read\" and \"schema evolution.\"\r\n* Extensible support for type conversion from \"native\" reader types to Drill types, and between Drill types.\r\n\r\nFinally, if we talk about the Grand Plan for World Domination, the column accessor and row set mechanisms allow:\r\n\r\n* Single interface to all data in Drill, allowing us to eventually consider evolving our storage layer.\r\n\r\nNow, why do we need all this? Partly because working with value vectors directly is tedious and error prone: it's like using assembly language. Partly because Drill, for better or worse, went crazy with the complex data types it supports: maps, arrays, arrays of maps that contain more arrays of more maps... That is, Drill has full JSON support. Getting that right, three levels down in nesting, when working directly with value vectors is near impossible. We've had years of bugs because it is so complex. The EVF and related mechanisms are intended to bring some sanity to the complex types. If we can't convince ourselves to get rid of them, then we have to make them actually work.\r\n\r\nThat's all behind the scenes. Most community contributions these days occurs in storage and format plugins. For that, EVF just makes the developer's job easier by handling all the common boilerplate code.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1008495754/reactions","total_count":4,"+1":1,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":1,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1008510147","html_url":"https://github.com/apache/drill/issues/2421#issuecomment-1008510147","issue_url":"https://api.github.com/repos/apache/drill/issues/2421","id":1008510147,"node_id":"IC_kwDOAFa5xc48HKTD","user":{"login":"paul-rogers","id":3248881,"node_id":"MDQ6VXNlcjMyNDg4ODE=","avatar_url":"https://avatars.githubusercontent.com/u/3248881?v=4","gravatar_id":"","url":"https://api.github.com/users/paul-rogers","html_url":"https://github.com/paul-rogers","followers_url":"https://api.github.com/users/paul-rogers/followers","following_url":"https://api.github.com/users/paul-rogers/following{/other_user}","gists_url":"https://api.github.com/users/paul-rogers/gists{/gist_id}","starred_url":"https://api.github.com/users/paul-rogers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paul-rogers/subscriptions","organizations_url":"https://api.github.com/users/paul-rogers/orgs","repos_url":"https://api.github.com/users/paul-rogers/repos","events_url":"https://api.github.com/users/paul-rogers/events{/privacy}","received_events_url":"https://api.github.com/users/paul-rogers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T03:16:17Z","updated_at":"2022-01-10T03:16:17Z","author_association":"CONTRIBUTOR","body":"@jnturton, I think you're starting down a slippery slope, one that will end up with you convinced to simply move to Arrow (or enhance Drill's value vectors.) You are assuming that you can get a big win from vectorization in selected compute or hash operations -- at no cost elsewhere. The gist of my argument where, if that were true, Drill should already be in good shape: we'd only need to add some SIMD code and we'd rock. You're also assuming that there are SIMD hash functions: I'm not sure those exist: a search came up with somewhat random results. (SHA exists, however.)\r\n\r\nThe hard truth is that vectors are good in very limited cases: those you outlined. As said above, Drill does far more than that. For all those other things, vectors are hugely complex and expensive.\r\n\r\nSo, if we ignore the parts where vectors are inefficient, and ignore the operations that don't benefit from vectors, and ignore complexity of vectors in client code and their horrible effect on exchanges... and instead focus on some ideal cases where vectors might be faster... then, yes, we end up back where we are today. This is, the classic marketing position: vectors are great, if we ignore the bad stuff. The problem is, in making all those assumptions, we ignore the actual reality of what we've learned over many years.\r\n\r\nUntil I see some numbers, I'm not convinced that there is ever a case, other than in ideal lab conditions, where the gain from vectors in some operations makes up for the cost everywhere else. Still, if we wanted to find out, we could tinker a bit:\r\n\r\n* Limit vector batches to a decent number of records, say 1K. Avoid the 4K, 8K or 64K behemoths. That will be friendlier on memory usage, deliver results to downstream fragments faster. And, since we don't actually have SIMD support, our SIMD features remain unaffected.\r\n* In exchanges, limit outgoing batches to a small row count. Add a timeout: if the batch is not filled in, say, x seconds, ship what we have to avoid near-deadlock at scale.\r\n* Since the Gandiva code from Arrow has to, at core, work on a block of direct memory, use it for a few select operations. That is, if we see that a projection is only one of your ideal cases, generate Gandiva code instead of Java code. If the operations are real-world messy, then stick with the Java code we have.\r\n* Even if we moved toward a row-based approach, keep the ability for a row to be comprised of multiple \"column groups\", each as individual columns or as groups of columns. For example, when reading from a file, one \"column group\" contains the file data, another has the \"implicit\" fields. If we do this, we can split out single columns if we want to run the hash (or other) function efficiently.\r\n\r\nThere is no free lunch. If we focus only on the idea cases, then any gain we get in those cases is more than given back by the overall complexity and slowness of other cases.\r\n\r\nAt some point, someone's got to actually do some benchmarks to gather actual facts...","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1008510147/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1008584600","html_url":"https://github.com/apache/drill/pull/2425#issuecomment-1008584600","issue_url":"https://api.github.com/repos/apache/drill/issues/2425","id":1008584600,"node_id":"IC_kwDOAFa5xc48HceY","user":{"login":"kingswanwho","id":15710469,"node_id":"MDQ6VXNlcjE1NzEwNDY5","avatar_url":"https://avatars.githubusercontent.com/u/15710469?v=4","gravatar_id":"","url":"https://api.github.com/users/kingswanwho","html_url":"https://github.com/kingswanwho","followers_url":"https://api.github.com/users/kingswanwho/followers","following_url":"https://api.github.com/users/kingswanwho/following{/other_user}","gists_url":"https://api.github.com/users/kingswanwho/gists{/gist_id}","starred_url":"https://api.github.com/users/kingswanwho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingswanwho/subscriptions","organizations_url":"https://api.github.com/users/kingswanwho/orgs","repos_url":"https://api.github.com/users/kingswanwho/repos","events_url":"https://api.github.com/users/kingswanwho/events{/privacy}","received_events_url":"https://api.github.com/users/kingswanwho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T06:55:25Z","updated_at":"2022-01-10T06:55:25Z","author_association":"CONTRIBUTOR","body":"> @kingswanwho, please fix the build. With the new version generated proto classes were changed, so please apply patch from the `Github CI / Run checkstyle and generate protobufs` job output.\r\n\r\nHi @vvysotskyi, I found that protobuf build files in \"contrib/native/client/src/protobuf\" are still in 3.11.1 version. However, \r\n CI environment would regenerate 3.16.1 version build files, CI would diff those two versions, and error get throw. I am trying to regenerate protobuf on my local, and use the new build files to replace the old one.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1008584600/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1008596721","html_url":"https://github.com/apache/drill/issues/2421#issuecomment-1008596721","issue_url":"https://api.github.com/repos/apache/drill/issues/2421","id":1008596721,"node_id":"IC_kwDOAFa5xc48Hfbx","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T07:18:00Z","updated_at":"2022-01-10T07:27:33Z","author_association":"CONTRIBUTOR","body":"@paul-rogers my personal bias, FWIW, is that it would take a major overall speedup on _real world_ Drill workloads to budge me from the cleanest and simplest memory format (which sounds like rows).  Something like a genuine 5x before it started getting hard for me to wave it away, and again I don't mean in a synthetic benchmark.  I'm just circulating material for the sake of enhancing the discussion.\r\n\r\n> You're also assuming that there are SIMD hash functions: I'm not sure those exist: a search came up with somewhat random results. (SHA exists, however.)\r\n\r\nVenturing a little off topic now but as a point of general interest, there is reason to believe at least a few such algorithms must exist.  The \"moon boys\" that kill the planet mining crypto ponzi tokens tend to use GPUs for that work.  Security researchers made news a few years back by producing collisions in MD5 using a Playstation 3 cluster.  From the hardware employed I conclude that the hash functions being brute forced in these stories must admit data-parallel algorithms and would also get some speed up from SIMD.\r\n\r\nEDIT: after a moment's thought, data parallelism in brute forcing must arise naturally from the need to compute a single hash function over many independent inputs.  I think it would arise in the same way in a hash join.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1008596721/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1008780966","html_url":"https://github.com/apache/drill/pull/2425#issuecomment-1008780966","issue_url":"https://api.github.com/repos/apache/drill/issues/2425","id":1008780966,"node_id":"IC_kwDOAFa5xc48IMam","user":{"login":"vvysotskyi","id":20928429,"node_id":"MDQ6VXNlcjIwOTI4NDI5","avatar_url":"https://avatars.githubusercontent.com/u/20928429?v=4","gravatar_id":"","url":"https://api.github.com/users/vvysotskyi","html_url":"https://github.com/vvysotskyi","followers_url":"https://api.github.com/users/vvysotskyi/followers","following_url":"https://api.github.com/users/vvysotskyi/following{/other_user}","gists_url":"https://api.github.com/users/vvysotskyi/gists{/gist_id}","starred_url":"https://api.github.com/users/vvysotskyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vvysotskyi/subscriptions","organizations_url":"https://api.github.com/users/vvysotskyi/orgs","repos_url":"https://api.github.com/users/vvysotskyi/repos","events_url":"https://api.github.com/users/vvysotskyi/events{/privacy}","received_events_url":"https://api.github.com/users/vvysotskyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T11:24:29Z","updated_at":"2022-01-10T11:24:29Z","author_association":"MEMBER","body":"@kingswanwho, yes, please update it also for `contrib/native/client/src/protobuf`. Regarding build failure, you can either regenerate classes locally or copy the output of the job starting after this line:\r\n```\r\nThe following changes are found in files after regenerating protobufs (output may be used as a patchto apply):\r\n```","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1008780966/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1010065143","html_url":"https://github.com/apache/drill/pull/2425#issuecomment-1010065143","issue_url":"https://api.github.com/repos/apache/drill/issues/2425","id":1010065143,"node_id":"IC_kwDOAFa5xc48NF73","user":{"login":"kingswanwho","id":15710469,"node_id":"MDQ6VXNlcjE1NzEwNDY5","avatar_url":"https://avatars.githubusercontent.com/u/15710469?v=4","gravatar_id":"","url":"https://api.github.com/users/kingswanwho","html_url":"https://github.com/kingswanwho","followers_url":"https://api.github.com/users/kingswanwho/followers","following_url":"https://api.github.com/users/kingswanwho/following{/other_user}","gists_url":"https://api.github.com/users/kingswanwho/gists{/gist_id}","starred_url":"https://api.github.com/users/kingswanwho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingswanwho/subscriptions","organizations_url":"https://api.github.com/users/kingswanwho/orgs","repos_url":"https://api.github.com/users/kingswanwho/repos","events_url":"https://api.github.com/users/kingswanwho/events{/privacy}","received_events_url":"https://api.github.com/users/kingswanwho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-11T15:17:41Z","updated_at":"2022-01-12T07:01:22Z","author_association":"CONTRIBUTOR","body":"> @kingswanwho, yes, please update it also for `contrib/native/client/src/protobuf`. Regarding build failure, you can either regenerate classes locally or copy the output of the job starting after this line:\r\n> \r\n> ```\r\n> The following changes are found in files after regenerating protobufs (output may be used as a patchto apply):\r\n> ```\r\nHi @vvysotskyi , thanks for your instruction, many lines are changed, I am afraid I could miss something if I copy the change directly, so I am building on my local. Due to the network problem, it wastes some time. I hope I could finish build ASAP.\r\n","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1010065143/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1010708407","html_url":"https://github.com/apache/drill/pull/2425#issuecomment-1010708407","issue_url":"https://api.github.com/repos/apache/drill/issues/2425","id":1010708407,"node_id":"IC_kwDOAFa5xc48Pi-3","user":{"login":"kingswanwho","id":15710469,"node_id":"MDQ6VXNlcjE1NzEwNDY5","avatar_url":"https://avatars.githubusercontent.com/u/15710469?v=4","gravatar_id":"","url":"https://api.github.com/users/kingswanwho","html_url":"https://github.com/kingswanwho","followers_url":"https://api.github.com/users/kingswanwho/followers","following_url":"https://api.github.com/users/kingswanwho/following{/other_user}","gists_url":"https://api.github.com/users/kingswanwho/gists{/gist_id}","starred_url":"https://api.github.com/users/kingswanwho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingswanwho/subscriptions","organizations_url":"https://api.github.com/users/kingswanwho/orgs","repos_url":"https://api.github.com/users/kingswanwho/repos","events_url":"https://api.github.com/users/kingswanwho/events{/privacy}","received_events_url":"https://api.github.com/users/kingswanwho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T07:08:21Z","updated_at":"2022-01-12T07:14:34Z","author_association":"CONTRIBUTOR","body":"Hi @vvysotskyi, when I build drill on my local by using JDK 8, build failed with same issue which reported in gihub CI either:  \r\n\r\n> This is likely due to you adding new dependencies to a java-exec and not updating the excludes in this module. This is important as it minimizes the size of the dependency of Drill application users.\r\n/home/parallels/Code/drill/exec/jdbc-all/target/drill-jdbc-all-1.20.0-SNAPSHOT.jar size (46602310) too large. Max. is 46600000/home/parallels/Code/drill/exec/jdbc-all/target/drill-jdbc-all-1.20.0-SNAPSHOT.jar\r\n\r\nJDK 17 also has this issue, should we increase the max size of dependency, or exclude some dependency like: https://github.com/apache/drill/pull/1486.\r\n\r\nAnd I am trying to use JDK 11 to build drill which can pass build in github CI, and use this environment to generate: \r\n> contrib/native/client/src/protobuf\r\n\r\nThanks!","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1010708407/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1010769955","html_url":"https://github.com/apache/drill/pull/2425#issuecomment-1010769955","issue_url":"https://api.github.com/repos/apache/drill/issues/2425","id":1010769955,"node_id":"IC_kwDOAFa5xc48PyAj","user":{"login":"vvysotskyi","id":20928429,"node_id":"MDQ6VXNlcjIwOTI4NDI5","avatar_url":"https://avatars.githubusercontent.com/u/20928429?v=4","gravatar_id":"","url":"https://api.github.com/users/vvysotskyi","html_url":"https://github.com/vvysotskyi","followers_url":"https://api.github.com/users/vvysotskyi/followers","following_url":"https://api.github.com/users/vvysotskyi/following{/other_user}","gists_url":"https://api.github.com/users/vvysotskyi/gists{/gist_id}","starred_url":"https://api.github.com/users/vvysotskyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vvysotskyi/subscriptions","organizations_url":"https://api.github.com/users/vvysotskyi/orgs","repos_url":"https://api.github.com/users/vvysotskyi/repos","events_url":"https://api.github.com/users/vvysotskyi/events{/privacy}","received_events_url":"https://api.github.com/users/vvysotskyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T08:29:17Z","updated_at":"2022-01-12T08:29:17Z","author_association":"MEMBER","body":"Yes, please increase the limit, it is ok to do that for this case.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1010769955/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1010790689","html_url":"https://github.com/apache/drill/pull/2425#issuecomment-1010790689","issue_url":"https://api.github.com/repos/apache/drill/issues/2425","id":1010790689,"node_id":"IC_kwDOAFa5xc48P3Eh","user":{"login":"kingswanwho","id":15710469,"node_id":"MDQ6VXNlcjE1NzEwNDY5","avatar_url":"https://avatars.githubusercontent.com/u/15710469?v=4","gravatar_id":"","url":"https://api.github.com/users/kingswanwho","html_url":"https://github.com/kingswanwho","followers_url":"https://api.github.com/users/kingswanwho/followers","following_url":"https://api.github.com/users/kingswanwho/following{/other_user}","gists_url":"https://api.github.com/users/kingswanwho/gists{/gist_id}","starred_url":"https://api.github.com/users/kingswanwho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingswanwho/subscriptions","organizations_url":"https://api.github.com/users/kingswanwho/orgs","repos_url":"https://api.github.com/users/kingswanwho/repos","events_url":"https://api.github.com/users/kingswanwho/events{/privacy}","received_events_url":"https://api.github.com/users/kingswanwho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T08:52:56Z","updated_at":"2022-01-12T08:52:56Z","author_association":"CONTRIBUTOR","body":"> Yes, please increase the limit, it is ok to do that for this case.\r\n\r\nSure, drill build by JDK 11 passed, and generated protobuf files for 3.16.1. I will increase the limit, and submit a new commit with those two updates.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1010790689/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1010881586","html_url":"https://github.com/apache/drill/pull/2425#issuecomment-1010881586","issue_url":"https://api.github.com/repos/apache/drill/issues/2425","id":1010881586,"node_id":"IC_kwDOAFa5xc48QNQy","user":{"login":"kingswanwho","id":15710469,"node_id":"MDQ6VXNlcjE1NzEwNDY5","avatar_url":"https://avatars.githubusercontent.com/u/15710469?v=4","gravatar_id":"","url":"https://api.github.com/users/kingswanwho","html_url":"https://github.com/kingswanwho","followers_url":"https://api.github.com/users/kingswanwho/followers","following_url":"https://api.github.com/users/kingswanwho/following{/other_user}","gists_url":"https://api.github.com/users/kingswanwho/gists{/gist_id}","starred_url":"https://api.github.com/users/kingswanwho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingswanwho/subscriptions","organizations_url":"https://api.github.com/users/kingswanwho/orgs","repos_url":"https://api.github.com/users/kingswanwho/repos","events_url":"https://api.github.com/users/kingswanwho/events{/privacy}","received_events_url":"https://api.github.com/users/kingswanwho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T10:17:24Z","updated_at":"2022-01-12T14:06:26Z","author_association":"CONTRIBUTOR","body":"> > Yes, please increase the limit, it is ok to do that for this case.\r\n> \r\n> Sure, drill build by JDK 11 passed, and generated protobuf files for 3.16.1. I will increase the limit, and submit a new commit with those two updates.\r\n\r\nSeems files in \r\n\r\n> /contrib/native/client/src/include/drill/protobuf/ \r\n\r\nand \r\n\r\n> /protocol/src/main/java/org/apache/drill/common/types/\r\n\r\nneed to be updated either.\r\n\r\nI guess main build has to be finished first, and run protobuf build. Otherwise, files in those two paths cannot be regenerated. I will try this then.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1010881586/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1011095972","html_url":"https://github.com/apache/drill/pull/2389#issuecomment-1011095972","issue_url":"https://api.github.com/repos/apache/drill/issues/2389","id":1011095972,"node_id":"IC_kwDOAFa5xc48RBmk","user":{"login":"luocooong","id":50079619,"node_id":"MDQ6VXNlcjUwMDc5NjE5","avatar_url":"https://avatars.githubusercontent.com/u/50079619?v=4","gravatar_id":"","url":"https://api.github.com/users/luocooong","html_url":"https://github.com/luocooong","followers_url":"https://api.github.com/users/luocooong/followers","following_url":"https://api.github.com/users/luocooong/following{/other_user}","gists_url":"https://api.github.com/users/luocooong/gists{/gist_id}","starred_url":"https://api.github.com/users/luocooong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/luocooong/subscriptions","organizations_url":"https://api.github.com/users/luocooong/orgs","repos_url":"https://api.github.com/users/luocooong/repos","events_url":"https://api.github.com/users/luocooong/events{/privacy}","received_events_url":"https://api.github.com/users/luocooong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T14:23:21Z","updated_at":"2022-01-12T14:23:21Z","author_association":"MEMBER","body":"@vvysotskyi Vova, I found that in `PluginProjectRel#super(convention, cluster, traitSet, input, projects, rowType)`, got the `projects` was `[$0, ITEM($0, 'o_totalprice')]`, but the `rowType` was `RecordType(ANY c_orders)`..\r\nIt seems the `projectPushInfo.createNewRowType(project.getCluster().getTypeFactory())` did not create the row type correctly, two row types are required?","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1011095972/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1011200152","html_url":"https://github.com/apache/drill/pull/2389#issuecomment-1011200152","issue_url":"https://api.github.com/repos/apache/drill/issues/2389","id":1011200152,"node_id":"IC_kwDOAFa5xc48RbCY","user":{"login":"vvysotskyi","id":20928429,"node_id":"MDQ6VXNlcjIwOTI4NDI5","avatar_url":"https://avatars.githubusercontent.com/u/20928429?v=4","gravatar_id":"","url":"https://api.github.com/users/vvysotskyi","html_url":"https://github.com/vvysotskyi","followers_url":"https://api.github.com/users/vvysotskyi/followers","following_url":"https://api.github.com/users/vvysotskyi/following{/other_user}","gists_url":"https://api.github.com/users/vvysotskyi/gists{/gist_id}","starred_url":"https://api.github.com/users/vvysotskyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vvysotskyi/subscriptions","organizations_url":"https://api.github.com/users/vvysotskyi/orgs","repos_url":"https://api.github.com/users/vvysotskyi/repos","events_url":"https://api.github.com/users/vvysotskyi/events{/privacy}","received_events_url":"https://api.github.com/users/vvysotskyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T16:03:57Z","updated_at":"2022-01-12T16:03:57Z","author_association":"MEMBER","body":"@luocooong, yes, two row types should be there.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1011200152/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1011419554","html_url":"https://github.com/apache/drill/pull/2426#issuecomment-1011419554","issue_url":"https://api.github.com/repos/apache/drill/issues/2426","id":1011419554,"node_id":"IC_kwDOAFa5xc48SQmi","user":{"login":"pjfanning","id":11783444,"node_id":"MDQ6VXNlcjExNzgzNDQ0","avatar_url":"https://avatars.githubusercontent.com/u/11783444?v=4","gravatar_id":"","url":"https://api.github.com/users/pjfanning","html_url":"https://github.com/pjfanning","followers_url":"https://api.github.com/users/pjfanning/followers","following_url":"https://api.github.com/users/pjfanning/following{/other_user}","gists_url":"https://api.github.com/users/pjfanning/gists{/gist_id}","starred_url":"https://api.github.com/users/pjfanning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pjfanning/subscriptions","organizations_url":"https://api.github.com/users/pjfanning/orgs","repos_url":"https://api.github.com/users/pjfanning/repos","events_url":"https://api.github.com/users/pjfanning/events{/privacy}","received_events_url":"https://api.github.com/users/pjfanning/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T20:22:04Z","updated_at":"2022-01-12T20:22:04Z","author_association":"CONTRIBUTOR","body":"Current PR does not yet fully fix the code - I'm still getting issues with the sample file - but a different one from when I started.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1011419554/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1011448293","html_url":"https://github.com/apache/drill/pull/2426#issuecomment-1011448293","issue_url":"https://api.github.com/repos/apache/drill/issues/2426","id":1011448293,"node_id":"IC_kwDOAFa5xc48SXnl","user":{"login":"pjfanning","id":11783444,"node_id":"MDQ6VXNlcjExNzgzNDQ0","avatar_url":"https://avatars.githubusercontent.com/u/11783444?v=4","gravatar_id":"","url":"https://api.github.com/users/pjfanning","html_url":"https://github.com/pjfanning","followers_url":"https://api.github.com/users/pjfanning/followers","following_url":"https://api.github.com/users/pjfanning/following{/other_user}","gists_url":"https://api.github.com/users/pjfanning/gists{/gist_id}","starred_url":"https://api.github.com/users/pjfanning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pjfanning/subscriptions","organizations_url":"https://api.github.com/users/pjfanning/orgs","repos_url":"https://api.github.com/users/pjfanning/repos","events_url":"https://api.github.com/users/pjfanning/events{/privacy}","received_events_url":"https://api.github.com/users/pjfanning/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T21:02:11Z","updated_at":"2022-01-12T21:02:11Z","author_association":"CONTRIBUTOR","body":"I think the code is now basically fixed.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1011448293/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1011533498","html_url":"https://github.com/apache/drill/pull/2426#issuecomment-1011533498","issue_url":"https://api.github.com/repos/apache/drill/issues/2426","id":1011533498,"node_id":"IC_kwDOAFa5xc48Ssa6","user":{"login":"lgtm-com[bot]","id":43144390,"node_id":"MDM6Qm90NDMxNDQzOTA=","avatar_url":"https://avatars.githubusercontent.com/in/17324?v=4","gravatar_id":"","url":"https://api.github.com/users/lgtm-com%5Bbot%5D","html_url":"https://github.com/apps/lgtm-com","followers_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/followers","following_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/repos","events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T23:08:10Z","updated_at":"2022-01-12T23:08:10Z","author_association":"NONE","body":"This pull request **fixes 1 alert** when merging e323da71239981a8a9dcd8de541913c4874a7774 into e3150e3a33ebc6c1c1fe41029ffb077c11f445bc - [view on LGTM.com](https://lgtm.com/projects/g/apache/drill/rev/pr-4a2378c5f765a5ba59e00929b40340ea3782f9f2)\n\n**fixed alerts:**\n\n* 1 for Dereferenced variable may be null","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1011533498/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1011728735","html_url":"https://github.com/apache/drill/pull/2426#issuecomment-1011728735","issue_url":"https://api.github.com/repos/apache/drill/issues/2426","id":1011728735,"node_id":"IC_kwDOAFa5xc48TcFf","user":{"login":"cgivre","id":5513150,"node_id":"MDQ6VXNlcjU1MTMxNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5513150?v=4","gravatar_id":"","url":"https://api.github.com/users/cgivre","html_url":"https://github.com/cgivre","followers_url":"https://api.github.com/users/cgivre/followers","following_url":"https://api.github.com/users/cgivre/following{/other_user}","gists_url":"https://api.github.com/users/cgivre/gists{/gist_id}","starred_url":"https://api.github.com/users/cgivre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgivre/subscriptions","organizations_url":"https://api.github.com/users/cgivre/orgs","repos_url":"https://api.github.com/users/cgivre/repos","events_url":"https://api.github.com/users/cgivre/events{/privacy}","received_events_url":"https://api.github.com/users/cgivre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-13T03:02:31Z","updated_at":"2022-01-13T03:02:31Z","author_association":"CONTRIBUTOR","body":"@pjfanning Here is a spreadsheet with anonymized data that you can use for a quick UT.\r\n[missing_data.xlsx](https://github.com/apache/drill/files/7859494/missing_data.xlsx)\r\n ","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1011728735/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1011843235","html_url":"https://github.com/apache/drill/pull/2425#issuecomment-1011843235","issue_url":"https://api.github.com/repos/apache/drill/issues/2425","id":1011843235,"node_id":"IC_kwDOAFa5xc48T4Cj","user":{"login":"kingswanwho","id":15710469,"node_id":"MDQ6VXNlcjE1NzEwNDY5","avatar_url":"https://avatars.githubusercontent.com/u/15710469?v=4","gravatar_id":"","url":"https://api.github.com/users/kingswanwho","html_url":"https://github.com/kingswanwho","followers_url":"https://api.github.com/users/kingswanwho/followers","following_url":"https://api.github.com/users/kingswanwho/following{/other_user}","gists_url":"https://api.github.com/users/kingswanwho/gists{/gist_id}","starred_url":"https://api.github.com/users/kingswanwho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingswanwho/subscriptions","organizations_url":"https://api.github.com/users/kingswanwho/orgs","repos_url":"https://api.github.com/users/kingswanwho/repos","events_url":"https://api.github.com/users/kingswanwho/events{/privacy}","received_events_url":"https://api.github.com/users/kingswanwho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-13T06:45:37Z","updated_at":"2022-01-13T09:18:47Z","author_association":"CONTRIBUTOR","body":"Hi @vvysotskyi, protobuf version in travis.yml CI script also needs to be updated, submit the update and squash 4 commits together.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1011843235/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1012134713","html_url":"https://github.com/apache/drill/pull/2426#issuecomment-1012134713","issue_url":"https://api.github.com/repos/apache/drill/issues/2426","id":1012134713,"node_id":"IC_kwDOAFa5xc48U_M5","user":{"login":"pjfanning","id":11783444,"node_id":"MDQ6VXNlcjExNzgzNDQ0","avatar_url":"https://avatars.githubusercontent.com/u/11783444?v=4","gravatar_id":"","url":"https://api.github.com/users/pjfanning","html_url":"https://github.com/pjfanning","followers_url":"https://api.github.com/users/pjfanning/followers","following_url":"https://api.github.com/users/pjfanning/following{/other_user}","gists_url":"https://api.github.com/users/pjfanning/gists{/gist_id}","starred_url":"https://api.github.com/users/pjfanning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pjfanning/subscriptions","organizations_url":"https://api.github.com/users/pjfanning/orgs","repos_url":"https://api.github.com/users/pjfanning/repos","events_url":"https://api.github.com/users/pjfanning/events{/privacy}","received_events_url":"https://api.github.com/users/pjfanning/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-13T13:26:10Z","updated_at":"2022-01-13T13:26:10Z","author_association":"CONTRIBUTOR","body":"the new test case is failing and I need to get back to it to debug it","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1012134713/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1012157820","html_url":"https://github.com/apache/drill/pull/2426#issuecomment-1012157820","issue_url":"https://api.github.com/repos/apache/drill/issues/2426","id":1012157820,"node_id":"IC_kwDOAFa5xc48VE18","user":{"login":"lgtm-com[bot]","id":43144390,"node_id":"MDM6Qm90NDMxNDQzOTA=","avatar_url":"https://avatars.githubusercontent.com/in/17324?v=4","gravatar_id":"","url":"https://api.github.com/users/lgtm-com%5Bbot%5D","html_url":"https://github.com/apps/lgtm-com","followers_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/followers","following_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/repos","events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2022-01-13T13:54:46Z","updated_at":"2022-01-13T13:54:46Z","author_association":"NONE","body":"This pull request **fixes 1 alert** when merging 138701c54110bec157907331ffd88f3631516cdc into e3150e3a33ebc6c1c1fe41029ffb077c11f445bc - [view on LGTM.com](https://lgtm.com/projects/g/apache/drill/rev/pr-13f74dd720fb2645575073d8a0bd7511b693dced)\n\n**fixed alerts:**\n\n* 1 for Dereferenced variable may be null","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1012157820/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1012405515","html_url":"https://github.com/apache/drill/pull/2426#issuecomment-1012405515","issue_url":"https://api.github.com/repos/apache/drill/issues/2426","id":1012405515,"node_id":"IC_kwDOAFa5xc48WBUL","user":{"login":"pjfanning","id":11783444,"node_id":"MDQ6VXNlcjExNzgzNDQ0","avatar_url":"https://avatars.githubusercontent.com/u/11783444?v=4","gravatar_id":"","url":"https://api.github.com/users/pjfanning","html_url":"https://github.com/pjfanning","followers_url":"https://api.github.com/users/pjfanning/followers","following_url":"https://api.github.com/users/pjfanning/following{/other_user}","gists_url":"https://api.github.com/users/pjfanning/gists{/gist_id}","starred_url":"https://api.github.com/users/pjfanning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pjfanning/subscriptions","organizations_url":"https://api.github.com/users/pjfanning/orgs","repos_url":"https://api.github.com/users/pjfanning/repos","events_url":"https://api.github.com/users/pjfanning/events{/privacy}","received_events_url":"https://api.github.com/users/pjfanning/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-13T18:38:18Z","updated_at":"2022-01-13T18:38:18Z","author_association":"CONTRIBUTOR","body":"@cgivre I have the unit test passing locally now so hopefully this should be ready to merge after the CI build","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1012405515/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1012413942","html_url":"https://github.com/apache/drill/issues/2415#issuecomment-1012413942","issue_url":"https://api.github.com/repos/apache/drill/issues/2415","id":1012413942,"node_id":"IC_kwDOAFa5xc48WDX2","user":{"login":"cgivre","id":5513150,"node_id":"MDQ6VXNlcjU1MTMxNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5513150?v=4","gravatar_id":"","url":"https://api.github.com/users/cgivre","html_url":"https://github.com/cgivre","followers_url":"https://api.github.com/users/cgivre/followers","following_url":"https://api.github.com/users/cgivre/following{/other_user}","gists_url":"https://api.github.com/users/cgivre/gists{/gist_id}","starred_url":"https://api.github.com/users/cgivre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgivre/subscriptions","organizations_url":"https://api.github.com/users/cgivre/orgs","repos_url":"https://api.github.com/users/cgivre/repos","events_url":"https://api.github.com/users/cgivre/events{/privacy}","received_events_url":"https://api.github.com/users/cgivre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-13T18:50:19Z","updated_at":"2022-01-13T18:50:19Z","author_association":"CONTRIBUTOR","body":"@mohamedkashifuddin Did this get sorted out?  Can we close this?","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1012413942/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1012463168","html_url":"https://github.com/apache/drill/pull/2426#issuecomment-1012463168","issue_url":"https://api.github.com/repos/apache/drill/issues/2426","id":1012463168,"node_id":"IC_kwDOAFa5xc48WPZA","user":{"login":"lgtm-com[bot]","id":43144390,"node_id":"MDM6Qm90NDMxNDQzOTA=","avatar_url":"https://avatars.githubusercontent.com/in/17324?v=4","gravatar_id":"","url":"https://api.github.com/users/lgtm-com%5Bbot%5D","html_url":"https://github.com/apps/lgtm-com","followers_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/followers","following_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/repos","events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2022-01-13T20:00:36Z","updated_at":"2022-01-13T20:00:36Z","author_association":"NONE","body":"This pull request **fixes 1 alert** when merging bcc5b1e50b0bdb4a35c1554a938a578bcc1f553e into e3150e3a33ebc6c1c1fe41029ffb077c11f445bc - [view on LGTM.com](https://lgtm.com/projects/g/apache/drill/rev/pr-6fbbd18970e93d6afbe2a6101db68f9bb63abd51)\n\n**fixed alerts:**\n\n* 1 for Dereferenced variable may be null","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1012463168/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1012781186","html_url":"https://github.com/apache/drill/issues/2415#issuecomment-1012781186","issue_url":"https://api.github.com/repos/apache/drill/issues/2415","id":1012781186,"node_id":"IC_kwDOAFa5xc48XdCC","user":{"login":"mohamedkashifuddin","id":59591190,"node_id":"MDQ6VXNlcjU5NTkxMTkw","avatar_url":"https://avatars.githubusercontent.com/u/59591190?v=4","gravatar_id":"","url":"https://api.github.com/users/mohamedkashifuddin","html_url":"https://github.com/mohamedkashifuddin","followers_url":"https://api.github.com/users/mohamedkashifuddin/followers","following_url":"https://api.github.com/users/mohamedkashifuddin/following{/other_user}","gists_url":"https://api.github.com/users/mohamedkashifuddin/gists{/gist_id}","starred_url":"https://api.github.com/users/mohamedkashifuddin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mohamedkashifuddin/subscriptions","organizations_url":"https://api.github.com/users/mohamedkashifuddin/orgs","repos_url":"https://api.github.com/users/mohamedkashifuddin/repos","events_url":"https://api.github.com/users/mohamedkashifuddin/events{/privacy}","received_events_url":"https://api.github.com/users/mohamedkashifuddin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-14T05:08:51Z","updated_at":"2022-01-14T05:08:51Z","author_association":"NONE","body":"@cgivre Yes we can close it","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1012781186/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013124268","html_url":"https://github.com/apache/drill/pull/2388#issuecomment-1013124268","issue_url":"https://api.github.com/repos/apache/drill/issues/2388","id":1013124268,"node_id":"IC_kwDOAFa5xc48Ywys","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-14T13:36:51Z","updated_at":"2022-01-14T13:36:51Z","author_association":"CONTRIBUTOR","body":"I've added @paul-rogers to the reviewers since he's familiar with the storage plugin registry and might spot gotchas that were missed in this less-than-obvious change set.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013124268/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013197378","html_url":"https://github.com/apache/drill/pull/2388#issuecomment-1013197378","issue_url":"https://api.github.com/repos/apache/drill/issues/2388","id":1013197378,"node_id":"IC_kwDOAFa5xc48ZCpC","user":{"login":"lgtm-com[bot]","id":43144390,"node_id":"MDM6Qm90NDMxNDQzOTA=","avatar_url":"https://avatars.githubusercontent.com/in/17324?v=4","gravatar_id":"","url":"https://api.github.com/users/lgtm-com%5Bbot%5D","html_url":"https://github.com/apps/lgtm-com","followers_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/followers","following_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/repos","events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2022-01-14T14:55:40Z","updated_at":"2022-01-14T14:55:40Z","author_association":"NONE","body":"This pull request **introduces 1 alert** when merging 8579a1ef1d27786907ac7ac141670986245552bd into bd0458e027bc90c1332fa1d5376d9616b720213a - [view on LGTM.com](https://lgtm.com/projects/g/apache/drill/rev/pr-e5a608d80b17cb6b79e854ec9b67040e7ed56862)\n\n**new alerts:**\n\n* 1 for Spurious Javadoc @param tags","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013197378/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013228280","html_url":"https://github.com/apache/drill/pull/2425#issuecomment-1013228280","issue_url":"https://api.github.com/repos/apache/drill/issues/2425","id":1013228280,"node_id":"IC_kwDOAFa5xc48ZKL4","user":{"login":"kingswanwho","id":15710469,"node_id":"MDQ6VXNlcjE1NzEwNDY5","avatar_url":"https://avatars.githubusercontent.com/u/15710469?v=4","gravatar_id":"","url":"https://api.github.com/users/kingswanwho","html_url":"https://github.com/kingswanwho","followers_url":"https://api.github.com/users/kingswanwho/followers","following_url":"https://api.github.com/users/kingswanwho/following{/other_user}","gists_url":"https://api.github.com/users/kingswanwho/gists{/gist_id}","starred_url":"https://api.github.com/users/kingswanwho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingswanwho/subscriptions","organizations_url":"https://api.github.com/users/kingswanwho/orgs","repos_url":"https://api.github.com/users/kingswanwho/repos","events_url":"https://api.github.com/users/kingswanwho/events{/privacy}","received_events_url":"https://api.github.com/users/kingswanwho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-14T15:33:51Z","updated_at":"2022-01-14T15:33:51Z","author_association":"CONTRIBUTOR","body":"Hi @vvysotskyi, all CI checks have passed, could you please give another review, thanks!\r\n","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013228280/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013328835","html_url":"https://github.com/apache/drill/pull/2388#issuecomment-1013328835","issue_url":"https://api.github.com/repos/apache/drill/issues/2388","id":1013328835,"node_id":"IC_kwDOAFa5xc48ZivD","user":{"login":"lgtm-com[bot]","id":43144390,"node_id":"MDM6Qm90NDMxNDQzOTA=","avatar_url":"https://avatars.githubusercontent.com/in/17324?v=4","gravatar_id":"","url":"https://api.github.com/users/lgtm-com%5Bbot%5D","html_url":"https://github.com/apps/lgtm-com","followers_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/followers","following_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/repos","events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2022-01-14T17:45:15Z","updated_at":"2022-01-14T17:45:15Z","author_association":"NONE","body":"This pull request **introduces 1 alert** when merging d029bf133deba496772dffa4e4c5680e2d3bc1b6 into bd0458e027bc90c1332fa1d5376d9616b720213a - [view on LGTM.com](https://lgtm.com/projects/g/apache/drill/rev/pr-70a5b8fc109f90fe37c7f12ae6ff506dfc15a5d2)\n\n**new alerts:**\n\n* 1 for Spurious Javadoc @param tags","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013328835/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013768187","html_url":"https://github.com/apache/drill/pull/2427#issuecomment-1013768187","issue_url":"https://api.github.com/repos/apache/drill/issues/2427","id":1013768187,"node_id":"IC_kwDOAFa5xc48bN_7","user":{"login":"pjfanning","id":11783444,"node_id":"MDQ6VXNlcjExNzgzNDQ0","avatar_url":"https://avatars.githubusercontent.com/u/11783444?v=4","gravatar_id":"","url":"https://api.github.com/users/pjfanning","html_url":"https://github.com/pjfanning","followers_url":"https://api.github.com/users/pjfanning/followers","following_url":"https://api.github.com/users/pjfanning/following{/other_user}","gists_url":"https://api.github.com/users/pjfanning/gists{/gist_id}","starred_url":"https://api.github.com/users/pjfanning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pjfanning/subscriptions","organizations_url":"https://api.github.com/users/pjfanning/orgs","repos_url":"https://api.github.com/users/pjfanning/repos","events_url":"https://api.github.com/users/pjfanning/events{/privacy}","received_events_url":"https://api.github.com/users/pjfanning/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-15T23:04:12Z","updated_at":"2022-01-15T23:04:12Z","author_association":"CONTRIBUTOR","body":"@cgivre see latest comment on https://issues.apache.org/jira/browse/DRILL-8095 - not loading the styles breaks existing Drill tests - so I abandoned that bit of the change","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013768187/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013768959","html_url":"https://github.com/apache/drill/pull/2427#issuecomment-1013768959","issue_url":"https://api.github.com/repos/apache/drill/issues/2427","id":1013768959,"node_id":"IC_kwDOAFa5xc48bOL_","user":{"login":"cgivre","id":5513150,"node_id":"MDQ6VXNlcjU1MTMxNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5513150?v=4","gravatar_id":"","url":"https://api.github.com/users/cgivre","html_url":"https://github.com/cgivre","followers_url":"https://api.github.com/users/cgivre/followers","following_url":"https://api.github.com/users/cgivre/following{/other_user}","gists_url":"https://api.github.com/users/cgivre/gists{/gist_id}","starred_url":"https://api.github.com/users/cgivre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgivre/subscriptions","organizations_url":"https://api.github.com/users/cgivre/orgs","repos_url":"https://api.github.com/users/cgivre/repos","events_url":"https://api.github.com/users/cgivre/events{/privacy}","received_events_url":"https://api.github.com/users/cgivre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-15T23:10:25Z","updated_at":"2022-01-15T23:10:25Z","author_association":"CONTRIBUTOR","body":"> @cgivre see latest comment on https://issues.apache.org/jira/browse/DRILL-8095 - not loading the styles breaks existing Drill tests - so I abandoned that bit of the change\r\n\r\nRoger that.... Sorry I didn't see that.  We don't have to include it in this PR, but if you can recommend a better way of inferring the data type that would be more performant, I'm all ears.  I did it using the Cell style because that seemed to make the most sense.   Thanks!","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013768959/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013769560","html_url":"https://github.com/apache/drill/pull/2427#issuecomment-1013769560","issue_url":"https://api.github.com/repos/apache/drill/issues/2427","id":1013769560,"node_id":"IC_kwDOAFa5xc48bOVY","user":{"login":"pjfanning","id":11783444,"node_id":"MDQ6VXNlcjExNzgzNDQ0","avatar_url":"https://avatars.githubusercontent.com/u/11783444?v=4","gravatar_id":"","url":"https://api.github.com/users/pjfanning","html_url":"https://github.com/pjfanning","followers_url":"https://api.github.com/users/pjfanning/followers","following_url":"https://api.github.com/users/pjfanning/following{/other_user}","gists_url":"https://api.github.com/users/pjfanning/gists{/gist_id}","starred_url":"https://api.github.com/users/pjfanning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pjfanning/subscriptions","organizations_url":"https://api.github.com/users/pjfanning/orgs","repos_url":"https://api.github.com/users/pjfanning/repos","events_url":"https://api.github.com/users/pjfanning/events{/privacy}","received_events_url":"https://api.github.com/users/pjfanning/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-15T23:16:25Z","updated_at":"2022-01-15T23:16:25Z","author_association":"CONTRIBUTOR","body":"tbh styles should used if you are inferring the schema - I just thought the existing code wasn't using them\r\n\r\nOne enhancement that I think Drill needs is to allow the format-excel code to process a number of rows (maybe defaulting to something like 5 or 10) when inferring the schema - this would help if the first data row has null values in some columns - or you might have a column that some times has numeric values but other times text and in that case the schema would need to make that cell text based.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013769560/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013770006","html_url":"https://github.com/apache/drill/pull/2427#issuecomment-1013770006","issue_url":"https://api.github.com/repos/apache/drill/issues/2427","id":1013770006,"node_id":"IC_kwDOAFa5xc48bOcW","user":{"login":"cgivre","id":5513150,"node_id":"MDQ6VXNlcjU1MTMxNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5513150?v=4","gravatar_id":"","url":"https://api.github.com/users/cgivre","html_url":"https://github.com/cgivre","followers_url":"https://api.github.com/users/cgivre/followers","following_url":"https://api.github.com/users/cgivre/following{/other_user}","gists_url":"https://api.github.com/users/cgivre/gists{/gist_id}","starred_url":"https://api.github.com/users/cgivre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgivre/subscriptions","organizations_url":"https://api.github.com/users/cgivre/orgs","repos_url":"https://api.github.com/users/cgivre/repos","events_url":"https://api.github.com/users/cgivre/events{/privacy}","received_events_url":"https://api.github.com/users/cgivre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-15T23:21:09Z","updated_at":"2022-01-15T23:21:09Z","author_association":"CONTRIBUTOR","body":"> tbh styles should used if you are inferring the schema - I just thought the existing code wasn't using them\r\n> \r\n> One enhancement that I think Drill needs is to allow the format-excel code to process a number of rows (maybe defaulting to something like 5 or 10) when inferring the schema - this would help if the first data row has null values in some columns - or you might have a column that some times has numeric values but other times text and in that case the schema would need to make that cell text based.\r\n\r\nI'd definitely agree with this approach.  I am actually working on a storage plugin for Google Sheets [1] which does exactly that.  There is a `typifier` class which reads the data from a column and attempts to infer the data type.  Perhaps once that gets merged, we can reuse the `typifier` for the Excel reader and use this approach. \r\n\r\n\r\n[1]: https://github.com/cgivre/drill/tree/storage-googlesheets/contrib/storage-googlesheets","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013770006/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013781073","html_url":"https://github.com/apache/drill/pull/2428#issuecomment-1013781073","issue_url":"https://api.github.com/repos/apache/drill/issues/2428","id":1013781073,"node_id":"IC_kwDOAFa5xc48bRJR","user":{"login":"cgivre","id":5513150,"node_id":"MDQ6VXNlcjU1MTMxNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5513150?v=4","gravatar_id":"","url":"https://api.github.com/users/cgivre","html_url":"https://github.com/cgivre","followers_url":"https://api.github.com/users/cgivre/followers","following_url":"https://api.github.com/users/cgivre/following{/other_user}","gists_url":"https://api.github.com/users/cgivre/gists{/gist_id}","starred_url":"https://api.github.com/users/cgivre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgivre/subscriptions","organizations_url":"https://api.github.com/users/cgivre/orgs","repos_url":"https://api.github.com/users/cgivre/repos","events_url":"https://api.github.com/users/cgivre/events{/privacy}","received_events_url":"https://api.github.com/users/cgivre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-16T00:21:24Z","updated_at":"2022-01-16T00:21:24Z","author_association":"CONTRIBUTOR","body":"@pjfanning Would you mind doing a quick review of this PR?","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013781073/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013839564","html_url":"https://github.com/apache/drill/issues/2421#issuecomment-1013839564","issue_url":"https://api.github.com/repos/apache/drill/issues/2421","id":1013839564,"node_id":"IC_kwDOAFa5xc48bfbM","user":{"login":"Leon-WTF","id":25920008,"node_id":"MDQ6VXNlcjI1OTIwMDA4","avatar_url":"https://avatars.githubusercontent.com/u/25920008?v=4","gravatar_id":"","url":"https://api.github.com/users/Leon-WTF","html_url":"https://github.com/Leon-WTF","followers_url":"https://api.github.com/users/Leon-WTF/followers","following_url":"https://api.github.com/users/Leon-WTF/following{/other_user}","gists_url":"https://api.github.com/users/Leon-WTF/gists{/gist_id}","starred_url":"https://api.github.com/users/Leon-WTF/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Leon-WTF/subscriptions","organizations_url":"https://api.github.com/users/Leon-WTF/orgs","repos_url":"https://api.github.com/users/Leon-WTF/repos","events_url":"https://api.github.com/users/Leon-WTF/events{/privacy}","received_events_url":"https://api.github.com/users/Leon-WTF/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-16T09:20:37Z","updated_at":"2022-01-16T09:20:37Z","author_association":"CONTRIBUTOR","body":"@paul-rogers  Thanks paul for your knowledge, but for the example of the serialized sort and merge, I don't quite understand. Why the sort and merge are in the same major fragment(f4)? And they are also on the same machine? It exists  more than one merge fragment? not just one? Could you please share more details about it? Thanks.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013839564/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013901708","html_url":"https://github.com/apache/drill/pull/2429#issuecomment-1013901708","issue_url":"https://api.github.com/repos/apache/drill/issues/2429","id":1013901708,"node_id":"IC_kwDOAFa5xc48bumM","user":{"login":"cgivre","id":5513150,"node_id":"MDQ6VXNlcjU1MTMxNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5513150?v=4","gravatar_id":"","url":"https://api.github.com/users/cgivre","html_url":"https://github.com/cgivre","followers_url":"https://api.github.com/users/cgivre/followers","following_url":"https://api.github.com/users/cgivre/following{/other_user}","gists_url":"https://api.github.com/users/cgivre/gists{/gist_id}","starred_url":"https://api.github.com/users/cgivre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgivre/subscriptions","organizations_url":"https://api.github.com/users/cgivre/orgs","repos_url":"https://api.github.com/users/cgivre/repos","events_url":"https://api.github.com/users/cgivre/events{/privacy}","received_events_url":"https://api.github.com/users/cgivre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-16T15:57:54Z","updated_at":"2022-01-16T15:57:54Z","author_association":"CONTRIBUTOR","body":"@vdiravka Thanks for submitting this.  Would you mind showing exactly what someone has to do to build Drill with Hadoop 2 in the docs?  Like the exact Maven command?\r\nThanks!\r\n","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1013901708/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1014342585","html_url":"https://github.com/apache/drill/pull/2429#issuecomment-1014342585","issue_url":"https://api.github.com/repos/apache/drill/issues/2429","id":1014342585,"node_id":"IC_kwDOAFa5xc48daO5","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-17T10:03:55Z","updated_at":"2022-01-17T13:31:53Z","author_association":"CONTRIBUTOR","body":"@cgivre I've just added instructions for using this profile to\r\n\r\nhttps://drill.apache.org/docs/compiling-drill-from-source/\r\n\r\n.  Well, I thought I had.  Something's wrong with the website CI for now.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1014342585/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1014548764","html_url":"https://github.com/apache/drill/pull/2429#issuecomment-1014548764","issue_url":"https://api.github.com/repos/apache/drill/issues/2429","id":1014548764,"node_id":"IC_kwDOAFa5xc48eMkc","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-17T13:32:56Z","updated_at":"2022-01-17T13:32:56Z","author_association":"CONTRIBUTOR","body":"@vdiravka am I right that our CI builds won't test the new hadoop-2 profile automatically?","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1014548764/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1014685897","html_url":"https://github.com/apache/drill/pull/2416#issuecomment-1014685897","issue_url":"https://api.github.com/repos/apache/drill/issues/2416","id":1014685897,"node_id":"IC_kwDOAFa5xc48euDJ","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-17T15:56:19Z","updated_at":"2022-01-17T15:56:19Z","author_association":"CONTRIBUTOR","body":"Hi @Leon-WTF, sorry about the long delay here.  I wanted to try to remove `if` statements but hadn't noticed that lazy splitting is possible for postive index values making the cases more different than I'd realised.  I came up with an alternative implementation with the negative index case based on reversing the original string, and the delimiter, then doing lazy splitting in the forward direction and then reversing the selected part for the answer but in the end I think it was worse than what's here.\r\n\r\nI'll approve shortly.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1014685897/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1014689249","html_url":"https://github.com/apache/drill/pull/2416#issuecomment-1014689249","issue_url":"https://api.github.com/repos/apache/drill/issues/2416","id":1014689249,"node_id":"IC_kwDOAFa5xc48eu3h","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-17T16:00:21Z","updated_at":"2022-01-17T16:00:21Z","author_association":"CONTRIBUTOR","body":"P.S. Had Google implemented a lazy Splitter that operates backwards from the end of the string there might have been a nice simplification.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1014689249/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1014927069","html_url":"https://github.com/apache/drill/issues/2421#issuecomment-1014927069","issue_url":"https://api.github.com/repos/apache/drill/issues/2421","id":1014927069,"node_id":"IC_kwDOAFa5xc48fo7d","user":{"login":"paul-rogers","id":3248881,"node_id":"MDQ6VXNlcjMyNDg4ODE=","avatar_url":"https://avatars.githubusercontent.com/u/3248881?v=4","gravatar_id":"","url":"https://api.github.com/users/paul-rogers","html_url":"https://github.com/paul-rogers","followers_url":"https://api.github.com/users/paul-rogers/followers","following_url":"https://api.github.com/users/paul-rogers/following{/other_user}","gists_url":"https://api.github.com/users/paul-rogers/gists{/gist_id}","starred_url":"https://api.github.com/users/paul-rogers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paul-rogers/subscriptions","organizations_url":"https://api.github.com/users/paul-rogers/orgs","repos_url":"https://api.github.com/users/paul-rogers/repos","events_url":"https://api.github.com/users/paul-rogers/events{/privacy}","received_events_url":"https://api.github.com/users/paul-rogers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-17T22:29:28Z","updated_at":"2022-01-17T22:29:28Z","author_association":"CONTRIBUTOR","body":"@Leon-WTF, you ask a good question. I'm afraid the answer is rather complex: hard to describe in a few words. Read if you're interested.\r\n\r\nLet's take a simple query. We have 10 scan fragments feeding 10 sort fragments that feed a single merge/\"screen\" fragment. Drill uses a random exchange to shuffle data from the 10 scan fragments to the 10 sorts, so that every sort gets data from every reader, balancing the load. There is an ordered exchange from the sorts to the merge. In \"Impala notation\":\r\n\r\n```text\r\nScreen\r\n|\r\nMerge\r\n|\r\nOrdered Receiver\r\n|   -   -   -   -   -   -   -   -\r\nOrdered Sender\r\n|\r\nSort\r\n|\r\nUnordered Receiver\r\n|  -   -   -   -   -   -   -   -\r\nRandom Sender\r\n|\r\nScan \r\n```\r\n\r\nThe dotted lines are an ad-hoc addition to represent fragment boundaries. Remember there are 10 each of the lower two fragments, 1 of the top.\r\n\r\nFirst,lets consider the in-memory case. The scans read data and forward batches to random sorts. The sorts sort each incoming batches, sorts each one, and buffer them. When the sort sees EOF from all its inputs, it merges the buffered batches and sends the data downstream to the merge, one batch at a time.\r\n\r\nThe merge needs a batch from each sort to proceed, so the merge can't start until the last sort finishes. (This is why a Sort is called a \"blocking operator\" or \"buffering operator\": it won't produce its first result until it has consumed all its input batches.)\r\n\r\nEverything is in memory, so each Sort can consume batches about as fast as the scans can produce them. The sorts all work in parallel, as we'd hope. The merge kicks in last, but that's to be expected: one can't merge without having first sorted all the data.\r\n\r\nOK, now for the spilling case, where the problems seem to crop up. (Full disclosure: I rewrote the current version of the Sort spilling code.) Now, data is too large to fit into memory for the sort. Let's focus on one sort, call it Sort 1. Sort 1 reads input batches until it fills its buffer. Then, Sort 1 pauses to write its sorted batches to disk. Simple enough. But, here is where things get tricky.\r\n\r\nAll the scans must fill their output batches. Because we're doing random exchanges to the sorts, all outgoing batches are about the same size. Let's now pick one scan to focus on, Scan 2. Scan 2 fill up the outgoing batch for Sort 1, but Sort 1 is busy spilling, so Sort 1 can't read that batch. As a result, Scan 2 is blocked: it needs to add one more row for Sort 1, but it can't because the outgoing batch is full, and the downstream Sort won't accept it. So, Scan 2 grinds to a halt.\r\n\r\nThe same is true for all other scans: as soon as they want to send to Sort 1 (which is spilling), they block. Soon, all scans are blocked. This means that all the other Sorts stop working: they have no incoming batches, so they are starved.\r\n\r\nEventually, Sort 1 completes its spill and starts reading again. This means Scan 2 can send and start working again. The same is true of the other Scans. Now, the next Sort, Sort 2, needs to spill. (Remember, the data is randomly distributed, so all Sorts see about the same number of rows.) So, the whole show occurs again. The scans can't send to Sort 2, so they stall. The other scans become starved for inputs, and so they stop.\r\n\r\nBasically, the entire system becomes serialized on the sort spills: effectively, across the cluster only one spill will be active at any time, and that spill blocks senders which blocks the other sorts. We have a 10-way distributed, single-threaded query.\r\n\r\nNow, I've omitted some details. One is that, in Drill, every receiver is obligated to buffer three incoming batches before it blocks. So, the scenario above is not exactly right: there is buffering in the Unordered Receiver below each Sort. But, the net effect is the same once that three-batch buffer is filled.\r\n\r\nEven here there is an issue: remember: each scan hast to buffer 1024 for every sort. We have 10 scans and 10 sorts, so we're buffering 100 batches or 100K rows. And, the sorts have buffers of 3 batches each, so that's another 30 batches total, or 30K rows. All that consumes memory which is not available for the sort, hence the sort has to spill. That is, the memory design for Drill takes a narrow, per-operator view, and does not optimize memory use across the whole query.\r\n\r\nAll of the above is conjecture based on watching large queries grind to a crawl. Drill provides overall metrics, but not metrics broken down by time slices, so we have no good way to visualize behavior. Using ASCII graphics, here's what we'd expect to see:\r\n\r\n```text\r\nSort 1: rrrsss____________r_______r_______rsss_________\r\nSort 2: rr___rsss__________r_______r_______rsss________\r\n....\r\nScan 1: www__w____________www_____www_____www___\r\nScan 2: www__w____________www_____www_____www___\r\n```\r\n\r\nWhere \"r\" means \"read and sort a batch\", \"s\" means \"spill\", \"w\" means \"write a batch downstream, and \"_\" means \"blocked or starved.\" Everything is parallel until the first spill, then everything serializes. There are 10 scans, so the extra wait time is for the other 8 scans to do their thing. All very complex!\r\n\r\nAnd, this problem grows with the square of the number of nodes. With 100 fragments, we buffer 10K batches of 1K rows each, or 10M rows sitting in send buffers. This should be screaming at us, \"you're doing it wrong!\"\r\n\r\nAnother detail I omitted is that Drill has something called a \"Mux Exchange\". \r\n```text\r\n...\r\n|\r\nUnordered Receiver\r\n|    -   -   -   -   -   -   -   -\r\n| Mux Sender\r\n|\r\n| Mux Receiver\r\n|    -   -   -   -   -   -   -   -\r\nUnordered Sender\r\n...\r\n```\r\n\r\nAll the scans on a single node share a set of outgoing buffers. Now, nobody understands this beast, and it is implemented as a separate layer of exchanges, which seems to make things worse. I remember back in the day, someone tried to characterize its behavior. But, since we didn't understand it, we just kept trying \"Mux On/Mux Off\" with out really knowing what was happening. Having a part of the system that no one understands is never a great way to proceed.\r\n\r\nStill, the Mux thing is a good idea even if the implementation is flawed. Ideally, it would reduce the number of outgoing batches from n^2 to just n. But, it adds so much complexity, with vectors, that the benefit could never be clearly seen.\r\n\r\nHow would rows work better than vectors? With vectors, we build up, say, 1024 rows in each batch before sending. We can't send until the batch is full, but if any batch is full, we can't add another row until we send the batch we've got. This is too crude and leads to the above scenario. The Mux exchange can consume rows so that the scans don't have to build up full batches to forward to the Mux.\r\n\r\nBetter would be to have a buffer of up to 1024 rows, but we send whatever we have after some time. Now, each scan can continue to send to other sorts even while holding rows for Scan 1 while it spills, In this case, some of the other sorts will also fill their buffers and start to spill concurrently with Scan 1.\r\n\r\nAnother idea is to do what Apex and other systems do: spill to disk if the receiver is blocked. (Or, equivalently, spill to disk on the receiver side if the consuming operator does not consume rows.)\r\n\r\nYet another solution is to run the Sort in multiple threads so that it spills and consumes concurrently. (The current design is single-threaded and is pretty aggressive about how much is spilled: we inherited that logic from the \"first-generation\" sort spill code.)\r\n\r\nNow, I've focused on the Sort because I know that code best. But, the same is true for other blocking operators: joins, aggregations, etc.\r\n\r\nWhen Drill is used embedded, or at small scale, you will never see this issue. When Drill runs at large scale, so that spilling kicks in, then this issue becomes the dominant problem that prevents high performance.\r\n\r\nSorry that this is all rather complex. Since it is complex, it goes unseen and unfixed. This is probably even a well-known problem in distributed computing circles: if any one knows of a good reference, please post it.\r\n\r\nFor Drill 2.0, we have to decide if we want to stay in the large-scale distributed system business, or just diddle around as an embedded desktop app to read PDF files and Excel spreadsheets. At scale, we have to fix the above issues. As a desktop app, we can rip out all the complex distributed cruft that no one understands and just be a decent several node solution.\r\n\r\nBut, there is no path that says we compete with Presto/Trino/Impala, etc. at scale while focusing on desktop concerns. Distributed system are *hard*, and we have to know what we're doing to offer an effective solution.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1014927069/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1015148877","html_url":"https://github.com/apache/drill/pull/1710#issuecomment-1015148877","issue_url":"https://api.github.com/repos/apache/drill/issues/1710","id":1015148877,"node_id":"IC_kwDOAFa5xc48gfFN","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-18T07:48:42Z","updated_at":"2022-01-18T07:48:42Z","author_association":"CONTRIBUTOR","body":"@Agirish can we close or reassign this?","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1015148877/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1015503422","html_url":"https://github.com/apache/drill/pull/2430#issuecomment-1015503422","issue_url":"https://api.github.com/repos/apache/drill/issues/2430","id":1015503422,"node_id":"IC_kwDOAFa5xc48h1o-","user":{"login":"lgtm-com[bot]","id":43144390,"node_id":"MDM6Qm90NDMxNDQzOTA=","avatar_url":"https://avatars.githubusercontent.com/in/17324?v=4","gravatar_id":"","url":"https://api.github.com/users/lgtm-com%5Bbot%5D","html_url":"https://github.com/apps/lgtm-com","followers_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/followers","following_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/repos","events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2022-01-18T15:06:57Z","updated_at":"2022-01-18T15:06:57Z","author_association":"NONE","body":"This pull request **introduces 1 alert** when merging 1781dfc3b444c07eb6d596a69628732927fedc17 into 55e94c4e1c4a05ac7010391daea8f4f0804b0286 - [view on LGTM.com](https://lgtm.com/projects/g/apache/drill/rev/pr-09aabdde3d672d39317d77c0374f1eb95c0cbf67)\n\n**new alerts:**\n\n* 1 for Dereferenced variable may be null","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1015503422/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1015618627","html_url":"https://github.com/apache/drill/pull/2401#issuecomment-1015618627","issue_url":"https://api.github.com/repos/apache/drill/issues/2401","id":1015618627,"node_id":"IC_kwDOAFa5xc48iRxD","user":{"login":"cgivre","id":5513150,"node_id":"MDQ6VXNlcjU1MTMxNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5513150?v=4","gravatar_id":"","url":"https://api.github.com/users/cgivre","html_url":"https://github.com/cgivre","followers_url":"https://api.github.com/users/cgivre/followers","following_url":"https://api.github.com/users/cgivre/following{/other_user}","gists_url":"https://api.github.com/users/cgivre/gists{/gist_id}","starred_url":"https://api.github.com/users/cgivre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgivre/subscriptions","organizations_url":"https://api.github.com/users/cgivre/orgs","repos_url":"https://api.github.com/users/cgivre/repos","events_url":"https://api.github.com/users/cgivre/events{/privacy}","received_events_url":"https://api.github.com/users/cgivre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-18T16:58:36Z","updated_at":"2022-01-18T16:58:36Z","author_association":"CONTRIBUTOR","body":"@vvysotskyi  I added a parameter to put the access token in the URL instead of the header.  This is technically not part of the OAuth spec....","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1015618627/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1016155831","html_url":"https://github.com/apache/drill/pull/886#issuecomment-1016155831","issue_url":"https://api.github.com/repos/apache/drill/issues/886","id":1016155831,"node_id":"IC_kwDOAFa5xc48kU63","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-19T07:25:48Z","updated_at":"2022-01-19T07:25:48Z","author_association":"CONTRIBUTOR","body":"Thank you for the pull request.  If you'd like to revisit it, please open a new pull request against the apache/drill-site repo.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1016155831/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1016222748","html_url":"https://github.com/apache/drill/pull/2424#issuecomment-1016222748","issue_url":"https://api.github.com/repos/apache/drill/issues/2424","id":1016222748,"node_id":"IC_kwDOAFa5xc48klQc","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-19T09:02:37Z","updated_at":"2022-01-19T09:02:37Z","author_association":"CONTRIBUTOR","body":"> @paul-rogers yes, of course. I'll see if I can expand the scope of this refactoring PR to add that in.\r\n\r\nIn the paginated case, a separate batch reader is created for each page of data returned by the HTTP API.\r\n\r\n- This plugin's JSON batch reader uses JsonLoader from EVF which will try to fill up a Drill batch for each page of API data.\r\n- Its CSV batch reader makes direct use of the Univocity CSV parse rather than going via CompliantTextBatchReader (why?) but includes its own batch-filling loop.\r\n- Its XML batch reader uses XmlReader from the format-xml which is also EVF-based and tries to fill up a Drill batch.\r\n\r\nSo I think the \"A natural structure is to create one Drill batch per HTTP page\" comment is already addressed.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1016222748/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1016228933","html_url":"https://github.com/apache/drill/pull/2424#issuecomment-1016228933","issue_url":"https://api.github.com/repos/apache/drill/issues/2424","id":1016228933,"node_id":"IC_kwDOAFa5xc48kmxF","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-19T09:10:04Z","updated_at":"2022-01-19T09:10:04Z","author_association":"CONTRIBUTOR","body":"Since I'm not aware of any outstanding concerns I'll merge this once the CI test run passes.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1016228933/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1016404261","html_url":"https://github.com/apache/drill/pull/2422#issuecomment-1016404261","issue_url":"https://api.github.com/repos/apache/drill/issues/2422","id":1016404261,"node_id":"IC_kwDOAFa5xc48lRkl","user":{"login":"lgtm-com[bot]","id":43144390,"node_id":"MDM6Qm90NDMxNDQzOTA=","avatar_url":"https://avatars.githubusercontent.com/in/17324?v=4","gravatar_id":"","url":"https://api.github.com/users/lgtm-com%5Bbot%5D","html_url":"https://github.com/apps/lgtm-com","followers_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/followers","following_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/repos","events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2022-01-19T12:07:09Z","updated_at":"2022-01-20T10:19:23Z","author_association":"NONE","body":"This pull request **introduces 1 alert** when merging 2a2e37ca73f127731cf849bcd8bce006f5c8c7a0 into ee874af953ed99614c8e7291ea9164b4ddc5ff24 - [view on LGTM.com](https://lgtm.com/projects/g/apache/drill/rev/pr-9217048ea766a8f5841fc4cdae019a262ea5c758)\n\n**new alerts:**\n\n* 1 for Potential database resource leak","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1016404261/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1016577142","html_url":"https://github.com/apache/drill/pull/2401#issuecomment-1016577142","issue_url":"https://api.github.com/repos/apache/drill/issues/2401","id":1016577142,"node_id":"IC_kwDOAFa5xc48l7x2","user":{"login":"cgivre","id":5513150,"node_id":"MDQ6VXNlcjU1MTMxNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5513150?v=4","gravatar_id":"","url":"https://api.github.com/users/cgivre","html_url":"https://github.com/cgivre","followers_url":"https://api.github.com/users/cgivre/followers","following_url":"https://api.github.com/users/cgivre/following{/other_user}","gists_url":"https://api.github.com/users/cgivre/gists{/gist_id}","starred_url":"https://api.github.com/users/cgivre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgivre/subscriptions","organizations_url":"https://api.github.com/users/cgivre/orgs","repos_url":"https://api.github.com/users/cgivre/repos","events_url":"https://api.github.com/users/cgivre/events{/privacy}","received_events_url":"https://api.github.com/users/cgivre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-19T15:24:42Z","updated_at":"2022-01-19T15:24:42Z","author_association":"CONTRIBUTOR","body":"@vvysotskyi Thanks for the review.  I fixed the merge conflicts and addressed the comments. ","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1016577142/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017072684","html_url":"https://github.com/apache/drill/pull/2401#issuecomment-1017072684","issue_url":"https://api.github.com/repos/apache/drill/issues/2401","id":1017072684,"node_id":"IC_kwDOAFa5xc48n0ws","user":{"login":"cgivre","id":5513150,"node_id":"MDQ6VXNlcjU1MTMxNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5513150?v=4","gravatar_id":"","url":"https://api.github.com/users/cgivre","html_url":"https://github.com/cgivre","followers_url":"https://api.github.com/users/cgivre/followers","following_url":"https://api.github.com/users/cgivre/following{/other_user}","gists_url":"https://api.github.com/users/cgivre/gists{/gist_id}","starred_url":"https://api.github.com/users/cgivre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgivre/subscriptions","organizations_url":"https://api.github.com/users/cgivre/orgs","repos_url":"https://api.github.com/users/cgivre/repos","events_url":"https://api.github.com/users/cgivre/events{/privacy}","received_events_url":"https://api.github.com/users/cgivre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-20T03:02:17Z","updated_at":"2022-01-20T03:02:17Z","author_association":"CONTRIBUTOR","body":"@vvysotskyi \r\nTo answer your questions, I actually first attempted this with a dedicated `OAuthCredentialProvider` class.  The issue I ran into was that it needed the `SimpleHttp` class within the `HttpStoragePlugin` to actually do all the REST calls.  For instance, if a user has a certificate store or web proxy configured, that would all be done in the config for the HTTP plugin and thus, you'd need that when making the token refreshes. \r\n\r\nI was thinking about trying to make this reusable for other plugins that may use OAuth.  The issue there is that while the flow is the same, there are a lot of pieces which are different.  For example, I've been poking at a  storage plugin for Google Sheets, which uses OAuth. While both use OAuth, the configuration is completely different and it unfortunately isn't really possible to reuse much in that situation. \r\n\r\nThe other thing to consider is that right now, the OAuth work only uses the `PlainCredentialProvider`, however users might want to store these tokens in Vault.  I was thinking as a v2, to extend the functionality so that the tokens can be stored using the `VaultCredentialProvider`, but that will have to wait for another PR.  Since some of these tokens are sensitive, it actually would make a lot of sense to store them more securely than in plain text in Zookeeper. ;-)\r\n\r\nRegarding concurrency, let's say that two users execute a query at virtually the same time.  Let's say that `access_token_A` is expired.  What should happen is that the first query to hit that server will get a 401 error.  Drill would then send a new request with the `refresh_token` and update the access token to `access_token_B`.   My understanding of OAuth is that the tokens time out, but during that time, if userB requested a new access token using the same refresh_token, userB would get the same updated access token (`access_token_b`).  In this situation, I think the worst case scenario would be that a few extra refresh requests are sent.\r\n\r\nI think I may have mentioned this, but I'm also working on extending this a bit to allow for per-user tokens and credentials, so when that gets implemented, the chances of collisions happening is even less. \r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017072684/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017238018","html_url":"https://github.com/apache/drill/pull/2431#issuecomment-1017238018","issue_url":"https://api.github.com/repos/apache/drill/issues/2431","id":1017238018,"node_id":"IC_kwDOAFa5xc48odIC","user":{"login":"vvysotskyi","id":20928429,"node_id":"MDQ6VXNlcjIwOTI4NDI5","avatar_url":"https://avatars.githubusercontent.com/u/20928429?v=4","gravatar_id":"","url":"https://api.github.com/users/vvysotskyi","html_url":"https://github.com/vvysotskyi","followers_url":"https://api.github.com/users/vvysotskyi/followers","following_url":"https://api.github.com/users/vvysotskyi/following{/other_user}","gists_url":"https://api.github.com/users/vvysotskyi/gists{/gist_id}","starred_url":"https://api.github.com/users/vvysotskyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vvysotskyi/subscriptions","organizations_url":"https://api.github.com/users/vvysotskyi/orgs","repos_url":"https://api.github.com/users/vvysotskyi/repos","events_url":"https://api.github.com/users/vvysotskyi/events{/privacy}","received_events_url":"https://api.github.com/users/vvysotskyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-20T08:40:43Z","updated_at":"2022-01-20T08:40:43Z","author_association":"MEMBER","body":"@cdmikechen, please make sure that this change doesn't break the support for Hive 2. If I recall correctly, `LongWritable` was added in Hive 3. Please make sure that after your changes Drill is able to build with the following extra properties:\r\n`-Dhive.version=2.3.2 -Dfreemarker.conf.file=src/main/codegen/config.fmpp`","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017238018/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017358574","html_url":"https://github.com/apache/drill/pull/2422#issuecomment-1017358574","issue_url":"https://api.github.com/repos/apache/drill/issues/2422","id":1017358574,"node_id":"IC_kwDOAFa5xc48o6ju","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-20T10:49:48Z","updated_at":"2022-01-20T10:49:48Z","author_association":"CONTRIBUTOR","body":"Hi @luocooong!  Has @vdiravka addressed everything with this latest push?  Excuse my nudging but this is one of two open PRs for 1.20.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017358574/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017360665","html_url":"https://github.com/apache/drill/pull/2389#issuecomment-1017360665","issue_url":"https://api.github.com/repos/apache/drill/issues/2389","id":1017360665,"node_id":"IC_kwDOAFa5xc48o7EZ","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-20T10:51:03Z","updated_at":"2022-01-20T10:51:03Z","author_association":"CONTRIBUTOR","body":"Hi @luocooong and @vvysotskyi!  Do we know the final steps needed to merge this PR?  Excuse my nudging but this is one of two open PRs for 1.20.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017360665/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017483944","html_url":"https://github.com/apache/drill/pull/2431#issuecomment-1017483944","issue_url":"https://api.github.com/repos/apache/drill/issues/2431","id":1017483944,"node_id":"IC_kwDOAFa5xc48pZKo","user":{"login":"cdmikechen","id":12069428,"node_id":"MDQ6VXNlcjEyMDY5NDI4","avatar_url":"https://avatars.githubusercontent.com/u/12069428?v=4","gravatar_id":"","url":"https://api.github.com/users/cdmikechen","html_url":"https://github.com/cdmikechen","followers_url":"https://api.github.com/users/cdmikechen/followers","following_url":"https://api.github.com/users/cdmikechen/following{/other_user}","gists_url":"https://api.github.com/users/cdmikechen/gists{/gist_id}","starred_url":"https://api.github.com/users/cdmikechen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdmikechen/subscriptions","organizations_url":"https://api.github.com/users/cdmikechen/orgs","repos_url":"https://api.github.com/users/cdmikechen/repos","events_url":"https://api.github.com/users/cdmikechen/events{/privacy}","received_events_url":"https://api.github.com/users/cdmikechen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-20T13:01:53Z","updated_at":"2022-01-20T13:02:15Z","author_association":"CONTRIBUTOR","body":"@vvysotskyi  \r\nHi~ `org.apache.hadoop.io.LongWritable` is in `hadoop-common` package, and it is used from hive1. it can build with hive2 and hive3.\r\nYou should be talking about `org.apache.hadoop.hive.serde2.io.TimestampWritableV2`, it is used from hive3.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017483944/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017487425","html_url":"https://github.com/apache/drill/pull/2431#issuecomment-1017487425","issue_url":"https://api.github.com/repos/apache/drill/issues/2431","id":1017487425,"node_id":"IC_kwDOAFa5xc48paBB","user":{"login":"cdmikechen","id":12069428,"node_id":"MDQ6VXNlcjEyMDY5NDI4","avatar_url":"https://avatars.githubusercontent.com/u/12069428?v=4","gravatar_id":"","url":"https://api.github.com/users/cdmikechen","html_url":"https://github.com/cdmikechen","followers_url":"https://api.github.com/users/cdmikechen/followers","following_url":"https://api.github.com/users/cdmikechen/following{/other_user}","gists_url":"https://api.github.com/users/cdmikechen/gists{/gist_id}","starred_url":"https://api.github.com/users/cdmikechen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdmikechen/subscriptions","organizations_url":"https://api.github.com/users/cdmikechen/orgs","repos_url":"https://api.github.com/users/cdmikechen/repos","events_url":"https://api.github.com/users/cdmikechen/events{/privacy}","received_events_url":"https://api.github.com/users/cdmikechen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-20T13:06:30Z","updated_at":"2022-01-20T13:06:30Z","author_association":"CONTRIBUTOR","body":"@cgivre\r\nOk~ I will add a test case later","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017487425/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017499339","html_url":"https://github.com/apache/drill/issues/2418#issuecomment-1017499339","issue_url":"https://api.github.com/repos/apache/drill/issues/2418","id":1017499339,"node_id":"IC_kwDOAFa5xc48pc7L","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-20T13:22:00Z","updated_at":"2022-01-20T13:22:00Z","author_association":"CONTRIBUTOR","body":"P.S. a fix has been merged into master.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017499339/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017566899","html_url":"https://github.com/apache/drill/pull/2308#issuecomment-1017566899","issue_url":"https://api.github.com/repos/apache/drill/issues/2308","id":1017566899,"node_id":"IC_kwDOAFa5xc48ptaz","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-20T14:29:52Z","updated_at":"2022-01-20T14:29:52Z","author_association":"CONTRIBUTOR","body":"I've picked this and some other dependency updates up in #2432.  Closing this in favour of that.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017566899/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017579431","html_url":"https://github.com/apache/drill/pull/2416#issuecomment-1017579431","issue_url":"https://api.github.com/repos/apache/drill/issues/2416","id":1017579431,"node_id":"IC_kwDOAFa5xc48pwen","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-20T14:42:25Z","updated_at":"2022-01-20T14:44:46Z","author_association":"CONTRIBUTOR","body":"@Leon-WTF if there is a chance to move any logic to setup() just send another PR reusing this existing Jira DRILL-8094.  But if index is allowed to be a variable expression and not just a constant then maybe nothing can move to setup()...","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017579431/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017659175","html_url":"https://github.com/apache/drill/pull/2401#issuecomment-1017659175","issue_url":"https://api.github.com/repos/apache/drill/issues/2401","id":1017659175,"node_id":"IC_kwDOAFa5xc48qD8n","user":{"login":"vvysotskyi","id":20928429,"node_id":"MDQ6VXNlcjIwOTI4NDI5","avatar_url":"https://avatars.githubusercontent.com/u/20928429?v=4","gravatar_id":"","url":"https://api.github.com/users/vvysotskyi","html_url":"https://github.com/vvysotskyi","followers_url":"https://api.github.com/users/vvysotskyi/followers","following_url":"https://api.github.com/users/vvysotskyi/following{/other_user}","gists_url":"https://api.github.com/users/vvysotskyi/gists{/gist_id}","starred_url":"https://api.github.com/users/vvysotskyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vvysotskyi/subscriptions","organizations_url":"https://api.github.com/users/vvysotskyi/orgs","repos_url":"https://api.github.com/users/vvysotskyi/repos","events_url":"https://api.github.com/users/vvysotskyi/events{/privacy}","received_events_url":"https://api.github.com/users/vvysotskyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-20T16:02:22Z","updated_at":"2022-01-20T16:02:22Z","author_association":"MEMBER","body":"@cgivre, for now, we can query Dropbox using the file storage plugin, but Dropbox also supports OAuth (in their docs I didn't find differences with OAuth), so extracting that logic to the OAuth creds provider and removing dependency to HTTP plugin will automatically enable this and other similar cases. If we have some specific logic for Google Sheets, in the future we can extend that implementation of the OAuth creds provider to handle additional cases.\r\n\r\nRegarding concurrent updates of the token, I think it is a major issue because we could have high concurrent queries (even for a single user) that will be slowed down because of unnecessary updating of the access_token. Please take a look at the versioned persistent store, I think it can be used to solve that issue.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017659175/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017659713","html_url":"https://github.com/apache/drill/issues/2421#issuecomment-1017659713","issue_url":"https://api.github.com/repos/apache/drill/issues/2421","id":1017659713,"node_id":"IC_kwDOAFa5xc48qEFB","user":{"login":"Leon-WTF","id":25920008,"node_id":"MDQ6VXNlcjI1OTIwMDA4","avatar_url":"https://avatars.githubusercontent.com/u/25920008?v=4","gravatar_id":"","url":"https://api.github.com/users/Leon-WTF","html_url":"https://github.com/Leon-WTF","followers_url":"https://api.github.com/users/Leon-WTF/followers","following_url":"https://api.github.com/users/Leon-WTF/following{/other_user}","gists_url":"https://api.github.com/users/Leon-WTF/gists{/gist_id}","starred_url":"https://api.github.com/users/Leon-WTF/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Leon-WTF/subscriptions","organizations_url":"https://api.github.com/users/Leon-WTF/orgs","repos_url":"https://api.github.com/users/Leon-WTF/repos","events_url":"https://api.github.com/users/Leon-WTF/events{/privacy}","received_events_url":"https://api.github.com/users/Leon-WTF/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-20T16:02:57Z","updated_at":"2022-01-20T16:03:26Z","author_association":"CONTRIBUTOR","body":"@paul-rogers Thanks paul for your detailed explanation. One more question, why scan2 send to other sorts also blocked  when scan2 send to sort1 is blocked? Do you think it's better to make each communication pair execute separately? I see that the PartitionSender can do the partion and flush task in a thread pool.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1017659713/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1018440761","html_url":"https://github.com/apache/drill/pull/2432#issuecomment-1018440761","issue_url":"https://api.github.com/repos/apache/drill/issues/2432","id":1018440761,"node_id":"IC_kwDOAFa5xc48tCw5","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-21T11:55:21Z","updated_at":"2022-01-21T11:55:21Z","author_association":"CONTRIBUTOR","body":"Hi @tdunning.  This PR includes an update of t-digest from 3.2 to 3.3 and I think that has caused a unit test of metastore statistics to fail with\r\n```\r\nError:  Failures: \r\nError:    TestAnalyze.testHistogramWithDataTypes1:501 Did not find expected pattern in plan: Filter\\(condition.*\\).*rowcount = 676.*,.*\r\n```\r\n, where what's changed is the row count estimate for the results of an integer inequality predicate `store_id < 15` which has gone from 676 to 699.  Have some approximate stats computed by t-digest shifted in this version, e.g. an accuracy improvement?  If so, and this is expected, then I'll update the unit test's expectations accordingly...","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1018440761/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1018676376","html_url":"https://github.com/apache/drill/pull/2432#issuecomment-1018676376","issue_url":"https://api.github.com/repos/apache/drill/issues/2432","id":1018676376,"node_id":"IC_kwDOAFa5xc48t8SY","user":{"login":"tdunning","id":250490,"node_id":"MDQ6VXNlcjI1MDQ5MA==","avatar_url":"https://avatars.githubusercontent.com/u/250490?v=4","gravatar_id":"","url":"https://api.github.com/users/tdunning","html_url":"https://github.com/tdunning","followers_url":"https://api.github.com/users/tdunning/followers","following_url":"https://api.github.com/users/tdunning/following{/other_user}","gists_url":"https://api.github.com/users/tdunning/gists{/gist_id}","starred_url":"https://api.github.com/users/tdunning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tdunning/subscriptions","organizations_url":"https://api.github.com/users/tdunning/orgs","repos_url":"https://api.github.com/users/tdunning/repos","events_url":"https://api.github.com/users/tdunning/events{/privacy}","received_events_url":"https://api.github.com/users/tdunning/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-21T16:42:46Z","updated_at":"2022-01-21T16:42:46Z","author_association":"CONTRIBUTOR","body":"The meaning of the compression parameter became a bit more strict in this\nlatest version. As such, the digest should be a bit smaller and tails\nshould be a bit more accurate. It is OK to increase the compression\nparameter if you want, but it has to be recognized that the results are\napproximate and a bit randomized.\n\nCan you describe a bit more about what the test is looking at?  I could\ncomment more specifically about what to expect if you like.\n\n\n\nOn Fri, Jan 21, 2022 at 3:55 AM James Turton ***@***.***>\nwrote:\n\n> Hi @tdunning <https://github.com/tdunning>. This PR includes an update of\n> t-digest from 3.2 to 3.3 and I think that has caused a unit test of\n> metastore statistics to fail with\n>\n> Error:  Failures:\n> Error:    TestAnalyze.testHistogramWithDataTypes1:501 Did not find expected pattern in plan: Filter\\(condition.*\\).*rowcount = 676.*,.*\n>\n> , where what's changed is the row count estimate for the results of an\n> integer inequality predicate store_id < 15 which has gone from 676 to\n> 699. Have some approximate stats computed by t-digest shifted in this\n> version, e.g. an accuracy improvement? If so, and this is expected, then\n> I'll update the unit test's expectations accordingly...\n>\n> \n> Reply to this email directly, view it on GitHub\n> <https://github.com/apache/drill/pull/2432#issuecomment-1018440761>, or\n> unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AAB5E6SSUDJZ52QF6OIMLK3UXFCTLANCNFSM5MM2LDFQ>\n> .\n> Triage notifications on the go with GitHub Mobile for iOS\n> <https://apps.apple.com/app/apple-store/id1477376905?ct=notification-email&mt=8&pt=524675>\n> or Android\n> <https://play.google.com/store/apps/details?id=com.github.android&referrer=utm_campaign%3Dnotification-email%26utm_medium%3Demail%26utm_source%3Dgithub>.\n>\n> You are receiving this because you were mentioned.Message ID:\n> ***@***.***>\n>\n","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1018676376/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1019033520","html_url":"https://github.com/apache/drill/issues/2421#issuecomment-1019033520","issue_url":"https://api.github.com/repos/apache/drill/issues/2421","id":1019033520,"node_id":"IC_kwDOAFa5xc48vTew","user":{"login":"paul-rogers","id":3248881,"node_id":"MDQ6VXNlcjMyNDg4ODE=","avatar_url":"https://avatars.githubusercontent.com/u/3248881?v=4","gravatar_id":"","url":"https://api.github.com/users/paul-rogers","html_url":"https://github.com/paul-rogers","followers_url":"https://api.github.com/users/paul-rogers/followers","following_url":"https://api.github.com/users/paul-rogers/following{/other_user}","gists_url":"https://api.github.com/users/paul-rogers/gists{/gist_id}","starred_url":"https://api.github.com/users/paul-rogers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paul-rogers/subscriptions","organizations_url":"https://api.github.com/users/paul-rogers/orgs","repos_url":"https://api.github.com/users/paul-rogers/repos","events_url":"https://api.github.com/users/paul-rogers/events{/privacy}","received_events_url":"https://api.github.com/users/paul-rogers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-22T03:37:51Z","updated_at":"2022-01-22T03:37:51Z","author_association":"CONTRIBUTOR","body":"@Leon-WTF, good question, as always. We don't actually *want* any scan to be blocked: this is the problem we need to fix. Every scan fragment has a set of outgoing buffers. The problem is, in normal Drill operation, we don't send them until they are full. But, to absorb delays, we want to keep them empty most of the time, and allow them to absorb rows when the receiver is blocked.\r\n\r\nOur example had 10 sort fragments, so there are 10 outgoing buffers per scan fragment (ignoring the Mux exchange.) Let's look at this from the scan's perspective. It can fill each outgoing buffer to, say 1024 rows.\r\n\r\nThe scan chugs along, producing rows. The random exchange assigns each to one of the outgoing buffers and copies it across. (Note the copy: we get no benefit from vectors during this operation.)\r\n\r\nOur data is evenly distributed, so we start with 0 rows per outgoing buffer. After a while, most buffers have, say, 3 rows. Some have more, some less, since things are random. We chug along some more. Now we're up to an average of 1000 rows. Pretty soon, one of the buffers fills to 1024.\r\n\r\nAt this point, the scan fragment can't add another row to that buffer, so off the buffer goes across the wire to its target sort fragment. All good. This continues, the next buffer gets to 1024 and is sent off. Again, because of even distribution, pretty soon all are full and sent. Now the scan can chug along and refill them.\r\n\r\nNow, let's say that Sort 1 can only buffer 9 incoming batches, so it now wants to spill when, say, Scan 8 sends it the 10th batch.\r\n\r\nNow, back to scan 1, it has filled its buffers again, and it happens that the one for Sort 1 (the one which is spilling) is filled first. So, it has to be sent off before the Scan can produce another row. Why? There is no other place to put that row, and we can't get to the row behind that until we dispose of the current wow. But, the destination is blocked, doing a spill (ignoring the three-buffer rule), so the full buffer can't be sent, and so we can't add to it, since it is full.\r\n\r\nSo, here's the heart of the problem. Scan 1 has just produced a row (or a batch with a row) that must go to Scan 1. The outgoing buffer is full, but it can't be sent. Scan 1 can't go any further until it can get rid of that current row. So...it...waits...\r\n\r\nIn effect, our buffer to absorb delays can sometimes be as small as 0 or 1 rows (though it will average to 512 rows.)\r\n\r\nEven if we have separate channels (which we do), we can't use them. We could send off all the other partly-full buffers and it still wouldn't help us with that one we most care about: the one that has to take the current row but can't (because it is full and we're blocked sending that buffer). Sending the other buffers _might_ get the other sorts to spill sooner, so we get concurrent spilling. (Something for us to consider as a partial fix.)\r\n\r\nThis is what I meant by a 10-way distributed query that begins to act as a single thread. Each scan can only send as fast as the slowest soft. Any spilling sort blocks all scans, which blocks all sorts. Definitely A Bad Thing.\r\n\r\nNow, if we have a row-based exchange, things might work better. Each scan might now have a rule:\r\n\r\n* Keep a buffer of up to 1024 rows (just picking a number).\r\n* Send the buffer if it is full, or if non-empty and has not been sent in the last 100 ms. (pick any time interval).\r\n\r\nWith that rule (properly tuned), the scans will typically have mostly empty send buffers. When Sort 1 stars spilling, Scan 1 can buffer up to 1024 rows for that sort, while also sending partial buffers to other scans, to get them closer to spilling. Once Sort 1 is blocked, its rows are sent and maybe some other Sort's outgoing buffer starts to fill. We get closer to doing spills in parallel rather than sequentially.\r\n\r\nIn this way, we normally have empty buffers, and have logs of margin to absorb blocking. Contrast this to the current scheme in which we have no leeway when a buffer fills and the receiver blocks.\r\n\r\nI don't have hard numbers, but I suspect (based on my experience with Impala) that the row-based schema would not fall prey to the single-threading that the vector-based approach does. (And, of course, we could implement the above idea with vectors, but it would normally lead to small batches downstream which might cause unexpected other problems in the current design.)\r\n\r\nTo see this, we need more detailed instrumentation (a time series of events, not just a summary), and a beefy cluster, with a large data set, to run tests.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1019033520/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1019575466","html_url":"https://github.com/apache/drill/issues/2421#issuecomment-1019575466","issue_url":"https://api.github.com/repos/apache/drill/issues/2421","id":1019575466,"node_id":"IC_kwDOAFa5xc48xXyq","user":{"login":"paul-rogers","id":3248881,"node_id":"MDQ6VXNlcjMyNDg4ODE=","avatar_url":"https://avatars.githubusercontent.com/u/3248881?v=4","gravatar_id":"","url":"https://api.github.com/users/paul-rogers","html_url":"https://github.com/paul-rogers","followers_url":"https://api.github.com/users/paul-rogers/followers","following_url":"https://api.github.com/users/paul-rogers/following{/other_user}","gists_url":"https://api.github.com/users/paul-rogers/gists{/gist_id}","starred_url":"https://api.github.com/users/paul-rogers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paul-rogers/subscriptions","organizations_url":"https://api.github.com/users/paul-rogers/orgs","repos_url":"https://api.github.com/users/paul-rogers/repos","events_url":"https://api.github.com/users/paul-rogers/events{/privacy}","received_events_url":"https://api.github.com/users/paul-rogers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-23T21:58:04Z","updated_at":"2022-01-23T21:58:04Z","author_association":"CONTRIBUTOR","body":"One more factor to consider: memory management. Row-based solutions are far, far easier to memory manage than vectors. Row solutions reduce internal fragmentation from 1/4 of batch size to 1/2 of the (much smaller) row size.\r\n\r\nWe talked early on about the difficulty of sizing vectors and batches. If a record has 20 columns, then each is a vector. If the columns are fixed-width (`INT`, `BIGINT`, etc.) then we can predict the size of a batch with, say, 1K rows. What we can't predict is the size of variable-width columns (`VARCHAR`, say) so sometimes we have a vector of size 1K (because all the `VARCHAR` values are one byte) and sometimes we have 1GB (because all the values are 1MB.) Drill now has nots of ad-hoc code to try to guess the size, which is much better than the early days, but still not great.\r\n\r\nWe often want to go the other way: we want to control memory use, so we allocate, say, 1MB per batch. When we do this, if we know the sort is given 1GB of buffer space, then we know we can store 1024 batches. (Picking simple numbers here just for discussion: actual numbers will vary.) So, what do we do to limit overall batch size to 1MB?\r\n\r\nBefore EVF, we couldn't and batch sizes could become large and cause intermittent OOM errors. With EVF, there is complex and elaborate code to detect when the next doubling of any vector could push us past the target size. EVF reports \"your batch is full\", and the batch is sent downstream. Today, this works only in the scan; all other operators retain their ad-hoc \"batch sizer\" based solutions. (Full disclosure: I originally wrote the batch sizer as a quick & dirty solution for the sort, hence its silly name. Little did I realize it would spread to other operators and still be with us years later: I thought EVF would have won the battle by now. Sigh...)\r\n\r\nWhen sizing vectors this way, we end up with a large amount of *internal fragmentation* unused space within vectors. On average, the last half of a vector will be half used, meaning that the vector is, on average 3/4 full. (The reason is subtle: we doubled the vector when it was full. After the doubling, the vector is half full. Variable-width vector sizes are uncorrelated, so, on average we'll have half-filled the second half when the batch as a whole fills.) So, with our 1MB batch, about 1/4 or 256K goes unused. That's pretty inefficient!\r\n\r\nNow, consider a row-based solution. Again we allocate 1MB for our buffer. We fill it with rows, end-to-end. When the buffer fills, we will, on average, have written half a row. We shift that row to a new buffer and send the current one on its way. Now, our fragmentation is 1/2 the row width. If rows width is << the buffer size, then we're making much better use of our scarce memory resource (especially in buffering operators such as sort, join, and aggregation.)\r\n\r\nLest you think this is somehow a Drill bug, recall how Parquet is built. The entire data set is buffered in memory before it is written to the file. Why? Parquet has no idea how large a column or row group will be until the columnar data blocks are actually created. To pack data optimally in the file, it is sub-optimally all buffered in memory prior to writes. In a way, this Parquet buffering (and the resulting memory pressure) is very similar to the exchange buffering we discussed in prior notes.\r\n\r\nThere is another huge win for row-based buffers: they are all of the same size (or, if we get very fancy, of a few sizes.) Rather than needing a malloc-style variable-block size allocator, we can use a much simpler DB-style buffer pool. New buffers come out of the pool, retired buffers go back in. We know exactly how many buffers we have, and can easily allocate quantities to queries and fragments. All the guesswork evaporates from sort, join and aggregate planning: they instead know exactly how many buffers they have to work with, and can plan spilling accordingly. None of this is new; you'll find it written up in any book on DB internals.\r\n\r\nThus, in just about every dimension, columnar storage is suboptimal as an internal query engine data format. The Impala guys knew this and benefited from their row-based structure. Drill is still suffering from its early misunderstanding that the benefits of columnar storage somehow translate into benefits as an internal data format.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1019575466/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1020723253","html_url":"https://github.com/apache/drill/pull/2433#issuecomment-1020723253","issue_url":"https://api.github.com/repos/apache/drill/issues/2433","id":1020723253,"node_id":"IC_kwDOAFa5xc481wA1","user":{"login":"luocooong","id":50079619,"node_id":"MDQ6VXNlcjUwMDc5NjE5","avatar_url":"https://avatars.githubusercontent.com/u/50079619?v=4","gravatar_id":"","url":"https://api.github.com/users/luocooong","html_url":"https://github.com/luocooong","followers_url":"https://api.github.com/users/luocooong/followers","following_url":"https://api.github.com/users/luocooong/following{/other_user}","gists_url":"https://api.github.com/users/luocooong/gists{/gist_id}","starred_url":"https://api.github.com/users/luocooong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/luocooong/subscriptions","organizations_url":"https://api.github.com/users/luocooong/orgs","repos_url":"https://api.github.com/users/luocooong/repos","events_url":"https://api.github.com/users/luocooong/events{/privacy}","received_events_url":"https://api.github.com/users/luocooong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-25T01:42:26Z","updated_at":"2022-01-25T01:42:26Z","author_association":"MEMBER","body":"@paul-rogers Could you please take a look? Thank you very much.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1020723253/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1021909426","html_url":"https://github.com/apache/drill/pull/2434#issuecomment-1021909426","issue_url":"https://api.github.com/repos/apache/drill/issues/2434","id":1021909426,"node_id":"IC_kwDOAFa5xc486Rmy","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-26T06:34:49Z","updated_at":"2022-01-26T06:34:49Z","author_association":"CONTRIBUTOR","body":"@cgivre looks like we've found our way back to occasional test run timeout country.  We can launch them again but since this PR does nothing but delete one exactly duplicated test, I can't see that it can produce new failures...","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1021909426/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1021932269","html_url":"https://github.com/apache/drill/pull/2435#issuecomment-1021932269","issue_url":"https://api.github.com/repos/apache/drill/issues/2435","id":1021932269,"node_id":"IC_kwDOAFa5xc486XLt","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-26T07:22:29Z","updated_at":"2022-01-26T07:22:29Z","author_association":"CONTRIBUTOR","body":"The JDK 11 test run included a failure for TestHttpPlugin#testSlowResponse which I'm going to attribute to test reproducability issues and not this PR which has nothing to do with the HTTP plugin.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1021932269/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1022065612","html_url":"https://github.com/apache/drill/pull/2432#issuecomment-1022065612","issue_url":"https://api.github.com/repos/apache/drill/issues/2432","id":1022065612,"node_id":"IC_kwDOAFa5xc4863vM","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-26T10:27:24Z","updated_at":"2022-01-26T10:27:55Z","author_association":"CONTRIBUTOR","body":"@tdunning, that would be great thanks.  Here the selectivity of a range predicate on an integer column is estimated using a set of quantile estimates, here termed an equidepth histogram (see [NumericEquiDepthHistogram](https://github.com/apache/drill/blob/4aefcef2b665c5737471664912a26ef6ed9a6cfc/exec/java-exec/src/main/java/org/apache/drill/exec/planner/common/NumericEquiDepthHistogram.java)).  The quantile estimates are recovered from a MergingDigest over the integer column that was created by an earlier `ANALYSE TABLE` command.  If said quantile estimates have shifted then that would explain what we're seeing...","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1022065612/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1022299941","html_url":"https://github.com/apache/drill/pull/2419#issuecomment-1022299941","issue_url":"https://api.github.com/repos/apache/drill/issues/2419","id":1022299941,"node_id":"IC_kwDOAFa5xc487w8l","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-26T15:18:36Z","updated_at":"2022-01-26T15:18:36Z","author_association":"CONTRIBUTOR","body":"Hi @paul-rogers, the timestamp handling changes raise some concerns ([see my comments on DRILL-8100](https://issues.apache.org/jira/browse/DRILL-8100)).  I want to move them all out to their own pull request so that they don't further delay the merger of EVF v2.  I'm happy to help out with this piece if you don't have bandwidth at the moment?\r\n\r\nP.S. when a PR naturally subdivides into multiple disjoint areas, please endeavour to send finer grained commits aligned to those areas to give us the opportunity to use Git to easily cherry pick a subset of the PR, should that be wanted for whatever reason.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1022299941/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1022642104","html_url":"https://github.com/apache/drill/pull/2432#issuecomment-1022642104","issue_url":"https://api.github.com/repos/apache/drill/issues/2432","id":1022642104,"node_id":"IC_kwDOAFa5xc489Ee4","user":{"login":"tdunning","id":250490,"node_id":"MDQ6VXNlcjI1MDQ5MA==","avatar_url":"https://avatars.githubusercontent.com/u/250490?v=4","gravatar_id":"","url":"https://api.github.com/users/tdunning","html_url":"https://github.com/tdunning","followers_url":"https://api.github.com/users/tdunning/followers","following_url":"https://api.github.com/users/tdunning/following{/other_user}","gists_url":"https://api.github.com/users/tdunning/gists{/gist_id}","starred_url":"https://api.github.com/users/tdunning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tdunning/subscriptions","organizations_url":"https://api.github.com/users/tdunning/orgs","repos_url":"https://api.github.com/users/tdunning/repos","events_url":"https://api.github.com/users/tdunning/events{/privacy}","received_events_url":"https://api.github.com/users/tdunning/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-26T22:00:43Z","updated_at":"2022-01-26T22:00:43Z","author_association":"CONTRIBUTOR","body":"If you want equal absolute error across the range then you can set the\nscale function on the t-digest to K_0 so it doesn't prioritize the tails.\n\nThis can give roughly 2:1 improvement on median accuracy.\n\n\n\nOn Wed, Jan 26, 2022 at 2:27 AM James Turton ***@***.***>\nwrote:\n\n> @tdunning <https://github.com/tdunning>, that would be great thanks. Here\n> the selectivity of a range predicate on an integer column is estimated from\n> an a set of quantile estimates, here termed an equidepth histogram (see\n> NumericEquiDepthHistogram\n> <https://github.com/apache/drill/blob/4aefcef2b665c5737471664912a26ef6ed9a6cfc/exec/java-exec/src/main/java/org/apache/drill/exec/planner/common/NumericEquiDepthHistogram.java>).\n> The quantile estimates are recovered from a MergingDigest over the integer\n> column that was created by an earlier ANALYSE TABLE command. If said\n> quantile estimates have shifted then that would explain what we're seeing...\n>\n> \n> Reply to this email directly, view it on GitHub\n> <https://github.com/apache/drill/pull/2432#issuecomment-1022065612>, or\n> unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AAB5E6WPTDXIWKPQKL6TAK3UX7EBPANCNFSM5MM2LDFQ>\n> .\n> Triage notifications on the go with GitHub Mobile for iOS\n> <https://apps.apple.com/app/apple-store/id1477376905?ct=notification-email&mt=8&pt=524675>\n> or Android\n> <https://play.google.com/store/apps/details?id=com.github.android&referrer=utm_campaign%3Dnotification-email%26utm_medium%3Demail%26utm_source%3Dgithub>.\n>\n> You are receiving this because you were mentioned.Message ID:\n> ***@***.***>\n>\n","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1022642104/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1022695179","html_url":"https://github.com/apache/drill/issues/2437#issuecomment-1022695179","issue_url":"https://api.github.com/repos/apache/drill/issues/2437","id":1022695179,"node_id":"IC_kwDOAFa5xc489RcL","user":{"login":"luocooong","id":50079619,"node_id":"MDQ6VXNlcjUwMDc5NjE5","avatar_url":"https://avatars.githubusercontent.com/u/50079619?v=4","gravatar_id":"","url":"https://api.github.com/users/luocooong","html_url":"https://github.com/luocooong","followers_url":"https://api.github.com/users/luocooong/followers","following_url":"https://api.github.com/users/luocooong/following{/other_user}","gists_url":"https://api.github.com/users/luocooong/gists{/gist_id}","starred_url":"https://api.github.com/users/luocooong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/luocooong/subscriptions","organizations_url":"https://api.github.com/users/luocooong/orgs","repos_url":"https://api.github.com/users/luocooong/repos","events_url":"https://api.github.com/users/luocooong/events{/privacy}","received_events_url":"https://api.github.com/users/luocooong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-26T23:22:47Z","updated_at":"2022-01-26T23:22:47Z","author_association":"MEMBER","body":"@GavinRay97 Hi, Have you tried this link?\r\nhttps://bit.ly/3t4rozO","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1022695179/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1022718968","html_url":"https://github.com/apache/drill/pull/2422#issuecomment-1022718968","issue_url":"https://api.github.com/repos/apache/drill/issues/2422","id":1022718968,"node_id":"IC_kwDOAFa5xc489XP4","user":{"login":"luocooong","id":50079619,"node_id":"MDQ6VXNlcjUwMDc5NjE5","avatar_url":"https://avatars.githubusercontent.com/u/50079619?v=4","gravatar_id":"","url":"https://api.github.com/users/luocooong","html_url":"https://github.com/luocooong","followers_url":"https://api.github.com/users/luocooong/followers","following_url":"https://api.github.com/users/luocooong/following{/other_user}","gists_url":"https://api.github.com/users/luocooong/gists{/gist_id}","starred_url":"https://api.github.com/users/luocooong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/luocooong/subscriptions","organizations_url":"https://api.github.com/users/luocooong/orgs","repos_url":"https://api.github.com/users/luocooong/repos","events_url":"https://api.github.com/users/luocooong/events{/privacy}","received_events_url":"https://api.github.com/users/luocooong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-27T00:09:45Z","updated_at":"2022-01-27T00:09:45Z","author_association":"MEMBER","body":"@vdiravka Thanks for the revision, we got better results.\r\nThere are a few small suggestions that need to be worked on (marked \"this one\"), and we can squash all commits after the new revision is complete.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1022718968/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1022857519","html_url":"https://github.com/apache/drill/pull/2401#issuecomment-1022857519","issue_url":"https://api.github.com/repos/apache/drill/issues/2401","id":1022857519,"node_id":"IC_kwDOAFa5xc4895Ev","user":{"login":"cgivre","id":5513150,"node_id":"MDQ6VXNlcjU1MTMxNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5513150?v=4","gravatar_id":"","url":"https://api.github.com/users/cgivre","html_url":"https://github.com/cgivre","followers_url":"https://api.github.com/users/cgivre/followers","following_url":"https://api.github.com/users/cgivre/following{/other_user}","gists_url":"https://api.github.com/users/cgivre/gists{/gist_id}","starred_url":"https://api.github.com/users/cgivre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgivre/subscriptions","organizations_url":"https://api.github.com/users/cgivre/orgs","repos_url":"https://api.github.com/users/cgivre/repos","events_url":"https://api.github.com/users/cgivre/events{/privacy}","received_events_url":"https://api.github.com/users/cgivre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-27T05:17:47Z","updated_at":"2022-01-27T05:17:47Z","author_association":"CONTRIBUTOR","body":"@vvysotskyi Thanks for your review comments.  I believe I addressed all your concerns.  The ephemeral tokens are now stored in a persistent store, with the `client_id` and `client_secret` being stored using the `credential provider`. \r\nThanks!","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1022857519/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1022893297","html_url":"https://github.com/apache/drill/pull/2401#issuecomment-1022893297","issue_url":"https://api.github.com/repos/apache/drill/issues/2401","id":1022893297,"node_id":"IC_kwDOAFa5xc48-Bzx","user":{"login":"lgtm-com[bot]","id":43144390,"node_id":"MDM6Qm90NDMxNDQzOTA=","avatar_url":"https://avatars.githubusercontent.com/in/17324?v=4","gravatar_id":"","url":"https://api.github.com/users/lgtm-com%5Bbot%5D","html_url":"https://github.com/apps/lgtm-com","followers_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/followers","following_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/repos","events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2022-01-27T06:36:50Z","updated_at":"2022-01-27T06:36:50Z","author_association":"NONE","body":"This pull request **introduces 1 alert** when merging ee140b987d7f9a1b753d9f9a98aa84ba1310e3af into 239a8f8336936ac51707fbf4a73da86a1156cd59 - [view on LGTM.com](https://lgtm.com/projects/g/apache/drill/rev/pr-436d18816b7d5c6bc46c8113f1942e3032274467)\n\n**new alerts:**\n\n* 1 for Potential input resource leak","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1022893297/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023204744","html_url":"https://github.com/apache/drill/pull/2432#issuecomment-1023204744","issue_url":"https://api.github.com/repos/apache/drill/issues/2432","id":1023204744,"node_id":"IC_kwDOAFa5xc48_N2I","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-27T13:21:25Z","updated_at":"2022-01-27T13:21:25Z","author_association":"CONTRIBUTOR","body":"@tdunning when you say \"median accuracy\" there, do you mean median estimate error across the entire distribution, or do you mean estimate error specifically near the distribution's median?  Do you think that in the case of Drill we'd make no assumptions about user data distributions, and opt for a t-digest scale factor that optimises an _overall_ accuracy statistic rather than one that targets any specific area (e.g. tails, median).  PS I'm waving my hands a bit here, I don't know if what I've said is well defined...","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023204744/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023246627","html_url":"https://github.com/apache/drill/pull/2401#issuecomment-1023246627","issue_url":"https://api.github.com/repos/apache/drill/issues/2401","id":1023246627,"node_id":"IC_kwDOAFa5xc48_YEj","user":{"login":"lgtm-com[bot]","id":43144390,"node_id":"MDM6Qm90NDMxNDQzOTA=","avatar_url":"https://avatars.githubusercontent.com/in/17324?v=4","gravatar_id":"","url":"https://api.github.com/users/lgtm-com%5Bbot%5D","html_url":"https://github.com/apps/lgtm-com","followers_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/followers","following_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/repos","events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2022-01-27T14:07:08Z","updated_at":"2022-01-27T14:07:08Z","author_association":"NONE","body":"This pull request **introduces 1 alert** when merging 6ea7ecea23b41c03072611f4342ce61fdebead73 into 493ac43af92f165f31e6f6ca3182bd1f324823e3 - [view on LGTM.com](https://lgtm.com/projects/g/apache/drill/rev/pr-c5d9cb72d827b6171726fd5912d296edd9421e47)\n\n**new alerts:**\n\n* 1 for Potential input resource leak","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023246627/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023298894","html_url":"https://github.com/apache/drill/issues/2437#issuecomment-1023298894","issue_url":"https://api.github.com/repos/apache/drill/issues/2437","id":1023298894,"node_id":"IC_kwDOAFa5xc48_k1O","user":{"login":"GavinRay97","id":26604994,"node_id":"MDQ6VXNlcjI2NjA0OTk0","avatar_url":"https://avatars.githubusercontent.com/u/26604994?v=4","gravatar_id":"","url":"https://api.github.com/users/GavinRay97","html_url":"https://github.com/GavinRay97","followers_url":"https://api.github.com/users/GavinRay97/followers","following_url":"https://api.github.com/users/GavinRay97/following{/other_user}","gists_url":"https://api.github.com/users/GavinRay97/gists{/gist_id}","starred_url":"https://api.github.com/users/GavinRay97/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GavinRay97/subscriptions","organizations_url":"https://api.github.com/users/GavinRay97/orgs","repos_url":"https://api.github.com/users/GavinRay97/repos","events_url":"https://api.github.com/users/GavinRay97/events{/privacy}","received_events_url":"https://api.github.com/users/GavinRay97/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-27T14:59:14Z","updated_at":"2022-01-27T14:59:14Z","author_association":"NONE","body":"That works, thank you!","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023298894/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023305677","html_url":"https://github.com/apache/drill/pull/2436#issuecomment-1023305677","issue_url":"https://api.github.com/repos/apache/drill/issues/2436","id":1023305677,"node_id":"IC_kwDOAFa5xc48_mfN","user":{"login":"vvysotskyi","id":20928429,"node_id":"MDQ6VXNlcjIwOTI4NDI5","avatar_url":"https://avatars.githubusercontent.com/u/20928429?v=4","gravatar_id":"","url":"https://api.github.com/users/vvysotskyi","html_url":"https://github.com/vvysotskyi","followers_url":"https://api.github.com/users/vvysotskyi/followers","following_url":"https://api.github.com/users/vvysotskyi/following{/other_user}","gists_url":"https://api.github.com/users/vvysotskyi/gists{/gist_id}","starred_url":"https://api.github.com/users/vvysotskyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vvysotskyi/subscriptions","organizations_url":"https://api.github.com/users/vvysotskyi/orgs","repos_url":"https://api.github.com/users/vvysotskyi/repos","events_url":"https://api.github.com/users/vvysotskyi/events{/privacy}","received_events_url":"https://api.github.com/users/vvysotskyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-27T15:04:44Z","updated_at":"2022-01-27T15:04:44Z","author_association":"MEMBER","body":"@luocooong, thanks for the review!","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023305677/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023352554","html_url":"https://github.com/apache/drill/pull/2401#issuecomment-1023352554","issue_url":"https://api.github.com/repos/apache/drill/issues/2401","id":1023352554,"node_id":"IC_kwDOAFa5xc48_x7q","user":{"login":"lgtm-com[bot]","id":43144390,"node_id":"MDM6Qm90NDMxNDQzOTA=","avatar_url":"https://avatars.githubusercontent.com/in/17324?v=4","gravatar_id":"","url":"https://api.github.com/users/lgtm-com%5Bbot%5D","html_url":"https://github.com/apps/lgtm-com","followers_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/followers","following_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/repos","events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2022-01-27T15:44:52Z","updated_at":"2022-01-27T15:44:52Z","author_association":"NONE","body":"This pull request **introduces 1 alert** when merging 92b0e070ecf7d173e9b248e5818aeb8285efae8e into 493ac43af92f165f31e6f6ca3182bd1f324823e3 - [view on LGTM.com](https://lgtm.com/projects/g/apache/drill/rev/pr-285426c242f7dbf085187dbc9e2752f5676f9285)\n\n**new alerts:**\n\n* 1 for Potential input resource leak","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023352554/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023413118","html_url":"https://github.com/apache/drill/pull/2432#issuecomment-1023413118","issue_url":"https://api.github.com/repos/apache/drill/issues/2432","id":1023413118,"node_id":"IC_kwDOAFa5xc49AAt-","user":{"login":"tdunning","id":250490,"node_id":"MDQ6VXNlcjI1MDQ5MA==","avatar_url":"https://avatars.githubusercontent.com/u/250490?v=4","gravatar_id":"","url":"https://api.github.com/users/tdunning","html_url":"https://github.com/tdunning","followers_url":"https://api.github.com/users/tdunning/followers","following_url":"https://api.github.com/users/tdunning/following{/other_user}","gists_url":"https://api.github.com/users/tdunning/gists{/gist_id}","starred_url":"https://api.github.com/users/tdunning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tdunning/subscriptions","organizations_url":"https://api.github.com/users/tdunning/orgs","repos_url":"https://api.github.com/users/tdunning/repos","events_url":"https://api.github.com/users/tdunning/events{/privacy}","received_events_url":"https://api.github.com/users/tdunning/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-27T16:31:14Z","updated_at":"2022-01-27T16:31:14Z","author_association":"CONTRIBUTOR","body":"Oops, @James Turton ***@***.***>\n\nGood catch. My language was very ambiguous.\n\nWhat I meant was estimation of the value of the median of the original data.\n\nThe issue is that t-digest is focused on estimation of the value of\nquantiles (which are just generalized percentiles) that are near the tails\nof the distribution. Because of this focus, the algorithm is designed to\nestimate things like the 0.1%-ile or 99.9%-ile very accurately, but to\nestimate the 50th %-ile is lower priority to t-digest so it allocates less\nof its internal information budget to that estimate.\n\nThat prioritization can be adjusted by something called the scale function.\nThe default is to use a scale function called K_2 which puts a very large\nemphasis on the tails. There is an alternative called K_0 which puts even\nemphasis on all estimates.\n\nThe effect of K_2 is that estimates of the 50th %-ile might be 1 % while\nthe estimate of the 99.99th %-ile would be 0.002 %. Tha makes sense some\ndays for things like latencies.\n\nMy impression is that K_0 might be more appropriate because we could get\nsomething like 0.2% from 0%-ile to 100%-ile.\n\nThe specific values here can all be adjusted by setting the compression\nparameter.\n\nI can help with any of this if somebody tells me the purpose of the\nt-digest.\n\n\n\n\nOn Thu, Jan 27, 2022 at 5:21 AM James Turton ***@***.***>\nwrote:\n\n> @tdunning <https://github.com/tdunning> when you say \"median accuracy\"\n> there, do you mean median estimate error across the entire distribution, or\n> do you mean estimate error specifically near the distribution's median? Do\n> you think that in the case of Drill we'd make no assumptions about user\n> data distributions, and opt for a t-digest scale factor that optimises an\n> *overall* accuracy statistic rather than one that targets any specific\n> area (e.g. tails, median). PS I'm waving my hands a bit here, I don't know\n> if what I've said is well defined...\n>\n> \n> Reply to this email directly, view it on GitHub\n> <https://github.com/apache/drill/pull/2432#issuecomment-1023204744>, or\n> unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AAB5E6TSAIXX4HTKXZAGJPTUYFBGJANCNFSM5MM2LDFQ>\n> .\n> Triage notifications on the go with GitHub Mobile for iOS\n> <https://apps.apple.com/app/apple-store/id1477376905?ct=notification-email&mt=8&pt=524675>\n> or Android\n> <https://play.google.com/store/apps/details?id=com.github.android&referrer=utm_campaign%3Dnotification-email%26utm_medium%3Demail%26utm_source%3Dgithub>.\n>\n> You are receiving this because you were mentioned.Message ID:\n> ***@***.***>\n>\n","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023413118/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023528517","html_url":"https://github.com/apache/drill/pull/2432#issuecomment-1023528517","issue_url":"https://api.github.com/repos/apache/drill/issues/2432","id":1023528517,"node_id":"IC_kwDOAFa5xc49Ac5F","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-27T18:38:25Z","updated_at":"2022-01-27T18:45:06Z","author_association":"CONTRIBUTOR","body":"@tdunning thank you for clarifying.  I speak under correction but the application of the t-digest here will be to help the query planner to estimate relation cardinalities, those being statistics which it will then use to decide e.g. which of two relations should be the \"build side\" of a hash join.  Optimally, the smaller relation goes on the build side in that example.\r\n\r\nTo estimate a relation's cardinality after a range predicate has been applied, the planner can reach for quantiles that with luck were precomputed over the relevant column.  I can't see a reason why real-world range predicates would in general be more focused on the tails of distributions, the shapes of which we'd probably like to assume nothing about anyway.\r\n\r\nMy take is that probably any t-digest scale factor is quite accurate enough for a query planner, but of them all I'd agree that K_0 is probably the best choice under the assumptions here.  We can now either hard code Drill to K_0 or default it to K_0 and add a config option so that users can override.  I'm not convinced the config option will justify its inclusion because it is one that users would need to vary from table to table depending on specifics of the data there.  So I'm inclined to just hard code a good general default.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023528517/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023645917","html_url":"https://github.com/apache/drill/pull/2432#issuecomment-1023645917","issue_url":"https://api.github.com/repos/apache/drill/issues/2432","id":1023645917,"node_id":"IC_kwDOAFa5xc49A5jd","user":{"login":"tdunning","id":250490,"node_id":"MDQ6VXNlcjI1MDQ5MA==","avatar_url":"https://avatars.githubusercontent.com/u/250490?v=4","gravatar_id":"","url":"https://api.github.com/users/tdunning","html_url":"https://github.com/tdunning","followers_url":"https://api.github.com/users/tdunning/followers","following_url":"https://api.github.com/users/tdunning/following{/other_user}","gists_url":"https://api.github.com/users/tdunning/gists{/gist_id}","starred_url":"https://api.github.com/users/tdunning/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tdunning/subscriptions","organizations_url":"https://api.github.com/users/tdunning/orgs","repos_url":"https://api.github.com/users/tdunning/repos","events_url":"https://api.github.com/users/tdunning/events{/privacy}","received_events_url":"https://api.github.com/users/tdunning/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-27T21:16:18Z","updated_at":"2022-01-27T21:16:18Z","author_association":"CONTRIBUTOR","body":"The best general default is the t-digest default. Even when you don't think\nyou care about tail accuracy, it can creep in.\n\nFurthermore, the loss of accuracy near the median is something like 2:1.\nThe difference in accuracy near the tails, however, can be 1,000,000:1.\n\nSo you don't lose much with the default setting and you gain a ton (in the\nright circumstances).\n\n\n\nOn Thu, Jan 27, 2022 at 10:38 AM James Turton ***@***.***>\nwrote:\n\n> @tdunning <https://github.com/tdunning> thank you for clarifying. I speak\n> under correction but the application of the t-digest here will be to help\n> the query planner to estimate relation cardinalities, those being\n> statistics which it will then use to decide e.g. which of two relations\n> should be the \"build side\" of a hash join. Optimally, the smaller relation\n> goes on the build side in that example.\n>\n> To estimate a relation's cardinality after a range predicate has been\n> applied, the planner can each for quantiles that with luck were precomputed\n> over the relevant column. I can't see a reason why real-world range\n> predicates would be more focused on the tails of distributions, the shapes\n> of which we'd probably like to assume nothing about anyway.\n>\n> My take is that probably any t-digest scale factor is quite accurate\n> enough for a query planner, but of them all I'd agree that K_0 is probably\n> the best choice under the assumptions here. We can now either hard code\n> Drill to K_0 or default it to K_0 and add a config option so that users can\n> override. I'm not convinced the config option will justify its inclusion\n> because it is one that users would need to vary from table to table\n> depending on specifics of the data there. So I'm inclined to just hard code\n> a good general default.\n>\n> \n> Reply to this email directly, view it on GitHub\n> <https://github.com/apache/drill/pull/2432#issuecomment-1023528517>, or\n> unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/AAB5E6VCK4NTTOXTLWM4ADLUYGGK7ANCNFSM5MM2LDFQ>\n> .\n> Triage notifications on the go with GitHub Mobile for iOS\n> <https://apps.apple.com/app/apple-store/id1477376905?ct=notification-email&mt=8&pt=524675>\n> or Android\n> <https://play.google.com/store/apps/details?id=com.github.android&referrer=utm_campaign%3Dnotification-email%26utm_medium%3Demail%26utm_source%3Dgithub>.\n>\n> You are receiving this because you were mentioned.Message ID:\n> ***@***.***>\n>\n","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023645917/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023912890","html_url":"https://github.com/apache/drill/pull/2419#issuecomment-1023912890","issue_url":"https://api.github.com/repos/apache/drill/issues/2419","id":1023912890,"node_id":"IC_kwDOAFa5xc49B6u6","user":{"login":"paul-rogers","id":3248881,"node_id":"MDQ6VXNlcjMyNDg4ODE=","avatar_url":"https://avatars.githubusercontent.com/u/3248881?v=4","gravatar_id":"","url":"https://api.github.com/users/paul-rogers","html_url":"https://github.com/paul-rogers","followers_url":"https://api.github.com/users/paul-rogers/followers","following_url":"https://api.github.com/users/paul-rogers/following{/other_user}","gists_url":"https://api.github.com/users/paul-rogers/gists{/gist_id}","starred_url":"https://api.github.com/users/paul-rogers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paul-rogers/subscriptions","organizations_url":"https://api.github.com/users/paul-rogers/orgs","repos_url":"https://api.github.com/users/paul-rogers/repos","events_url":"https://api.github.com/users/paul-rogers/events{/privacy}","received_events_url":"https://api.github.com/users/paul-rogers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-28T06:01:52Z","updated_at":"2022-01-28T06:01:52Z","author_association":"CONTRIBUTOR","body":"@jnturton, happy to split up the PR. Let me see what can be done. A key reason this one has \"unrelated\" stuff is that those fixes were needed to get a clean build. So, maybe I can make those fixes in one PR and move this one to a draft until the preliminaries are merged, then rebase and do this one. Over the weekend I'll see what can be done. ","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023912890/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023990781","html_url":"https://github.com/apache/drill/pull/2419#issuecomment-1023990781","issue_url":"https://api.github.com/repos/apache/drill/issues/2419","id":1023990781,"node_id":"IC_kwDOAFa5xc49CNv9","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-28T08:27:56Z","updated_at":"2022-01-28T08:27:56Z","author_association":"CONTRIBUTOR","body":"> @jnturton A key reason this one has \"unrelated\" stuff is that those fixes were needed to get a clean build. So, maybe I can make those fixes in one PR and move this one to a draft until the preliminaries are merged, then rebase and do this one. Over the weekend I'll see what can be done.\r\n\r\nThank you @paul-rogers.  The timestamp changes aren't needed for a clean build _here in the GitHub CI_, even if that's only because it happens on UTC machines.  So I think that they are not really a prerequisite for merging EVF v2.  Additionally, in my tests the timestamp changes introduce a new bug (exhibited on the Jira issue).\r\n\r\nSo in my opinion the opposite merge ordering is preferable once they're split out.  First we should merge EVF v2, which looks great and not deserving of being sent back to draft, _then_ we can relook our zoneless timestamps and possible short and long term fixes.  Obviously we do want the build and all tests to start working on non-UTC machines, but that is not EVF v2's cross to bear?","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1023990781/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1024731093","html_url":"https://github.com/apache/drill/pull/2431#issuecomment-1024731093","issue_url":"https://api.github.com/repos/apache/drill/issues/2431","id":1024731093,"node_id":"IC_kwDOAFa5xc49FCfV","user":{"login":"cdmikechen","id":12069428,"node_id":"MDQ6VXNlcjEyMDY5NDI4","avatar_url":"https://avatars.githubusercontent.com/u/12069428?v=4","gravatar_id":"","url":"https://api.github.com/users/cdmikechen","html_url":"https://github.com/cdmikechen","followers_url":"https://api.github.com/users/cdmikechen/followers","following_url":"https://api.github.com/users/cdmikechen/following{/other_user}","gists_url":"https://api.github.com/users/cdmikechen/gists{/gist_id}","starred_url":"https://api.github.com/users/cdmikechen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cdmikechen/subscriptions","organizations_url":"https://api.github.com/users/cdmikechen/orgs","repos_url":"https://api.github.com/users/cdmikechen/repos","events_url":"https://api.github.com/users/cdmikechen/events{/privacy}","received_events_url":"https://api.github.com/users/cdmikechen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-28T23:08:54Z","updated_at":"2022-01-28T23:08:54Z","author_association":"CONTRIBUTOR","body":"@cgivre\r\nHi~ I have added a test case and update codes to newest. You can see whether the current test case is ok.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1024731093/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1024924548","html_url":"https://github.com/apache/drill/pull/2432#issuecomment-1024924548","issue_url":"https://api.github.com/repos/apache/drill/issues/2432","id":1024924548,"node_id":"IC_kwDOAFa5xc49FxuE","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-29T14:44:04Z","updated_at":"2022-01-29T14:44:04Z","author_association":"CONTRIBUTOR","body":"> After exluding libs from jdbc-all it is necessary to check Drill jdbc driver within any jdbc client, such as SQuirrel. There are no unit tests for that\r\n\r\n@vdiravka thanks for this pointer. I configured DBeaver to use the JDBC driver built by this branch and was able to query a local Drillbit with it. ","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1024924548/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1025158214","html_url":"https://github.com/apache/drill/issues/2350#issuecomment-1025158214","issue_url":"https://api.github.com/repos/apache/drill/issues/2350","id":1025158214,"node_id":"IC_kwDOAFa5xc49GqxG","user":{"login":"cgivre","id":5513150,"node_id":"MDQ6VXNlcjU1MTMxNTA=","avatar_url":"https://avatars.githubusercontent.com/u/5513150?v=4","gravatar_id":"","url":"https://api.github.com/users/cgivre","html_url":"https://github.com/cgivre","followers_url":"https://api.github.com/users/cgivre/followers","following_url":"https://api.github.com/users/cgivre/following{/other_user}","gists_url":"https://api.github.com/users/cgivre/gists{/gist_id}","starred_url":"https://api.github.com/users/cgivre/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cgivre/subscriptions","organizations_url":"https://api.github.com/users/cgivre/orgs","repos_url":"https://api.github.com/users/cgivre/repos","events_url":"https://api.github.com/users/cgivre/events{/privacy}","received_events_url":"https://api.github.com/users/cgivre/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-30T14:44:39Z","updated_at":"2022-01-30T14:44:39Z","author_association":"CONTRIBUTOR","body":"@jnturton Can we close this issue?","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1025158214/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1025185654","html_url":"https://github.com/apache/drill/pull/2443#issuecomment-1025185654","issue_url":"https://api.github.com/repos/apache/drill/issues/2443","id":1025185654,"node_id":"IC_kwDOAFa5xc49Gxd2","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-30T17:03:35Z","updated_at":"2022-01-30T17:03:35Z","author_association":"CONTRIBUTOR","body":"Thanks for this PR.  This Xerces update is already part of an open PR (#2432) that has run into other problems trying to update the vulnerable H2 DB lib.  No harm in sending in this in early. ","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1025185654/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1025847513","html_url":"https://github.com/apache/drill/pull/2433#issuecomment-1025847513","issue_url":"https://api.github.com/repos/apache/drill/issues/2433","id":1025847513,"node_id":"IC_kwDOAFa5xc49JTDZ","user":{"login":"vvysotskyi","id":20928429,"node_id":"MDQ6VXNlcjIwOTI4NDI5","avatar_url":"https://avatars.githubusercontent.com/u/20928429?v=4","gravatar_id":"","url":"https://api.github.com/users/vvysotskyi","html_url":"https://github.com/vvysotskyi","followers_url":"https://api.github.com/users/vvysotskyi/followers","following_url":"https://api.github.com/users/vvysotskyi/following{/other_user}","gists_url":"https://api.github.com/users/vvysotskyi/gists{/gist_id}","starred_url":"https://api.github.com/users/vvysotskyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vvysotskyi/subscriptions","organizations_url":"https://api.github.com/users/vvysotskyi/orgs","repos_url":"https://api.github.com/users/vvysotskyi/repos","events_url":"https://api.github.com/users/vvysotskyi/events{/privacy}","received_events_url":"https://api.github.com/users/vvysotskyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-31T15:02:09Z","updated_at":"2022-01-31T15:02:09Z","author_association":"MEMBER","body":"@paul-rogers, thanks for the review, I've addressed the CR comment.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1025847513/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1026489976","html_url":"https://github.com/apache/drill/issues/2446#issuecomment-1026489976","issue_url":"https://api.github.com/repos/apache/drill/issues/2446","id":1026489976,"node_id":"IC_kwDOAFa5xc49Lv54","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-01T05:23:50Z","updated_at":"2022-02-01T08:46:47Z","author_association":"CONTRIBUTOR","body":"There was some discussion in the mailing list in Novemever that might help you, maybe you can collaborate with @rymarm (who sent the emails) on this...\r\n\r\nEDIT: Oh dear, it looks like Pony Mail isn't very good at URLs.  But try searching for \"Start embedded Drill on JDBC connection\" with a date range of \"the last year\" here:\r\n\r\nhttps://lists.apache.org/list?dev@drill.apache.org","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1026489976/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1026502775","html_url":"https://github.com/apache/drill/pull/2445#issuecomment-1026502775","issue_url":"https://api.github.com/repos/apache/drill/issues/2445","id":1026502775,"node_id":"IC_kwDOAFa5xc49LzB3","user":{"login":"lgtm-com[bot]","id":43144390,"node_id":"MDM6Qm90NDMxNDQzOTA=","avatar_url":"https://avatars.githubusercontent.com/in/17324?v=4","gravatar_id":"","url":"https://api.github.com/users/lgtm-com%5Bbot%5D","html_url":"https://github.com/apps/lgtm-com","followers_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/followers","following_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/repos","events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/lgtm-com%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2022-02-01T05:57:44Z","updated_at":"2022-02-01T05:57:44Z","author_association":"NONE","body":"This pull request **introduces 2 alerts** when merging 95bdfdccbfc01673f093c8ba92b90ea763738624 into 2b47cec3a95966e119dac643050544c93b45be15 - [view on LGTM.com](https://lgtm.com/projects/g/apache/drill/rev/pr-b8dcf02bc29774b0c9617f26d1e616cbc2b41b3a)\n\n**new alerts:**\n\n* 2 for Contradictory type checks","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1026502775/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1026540149","html_url":"https://github.com/apache/drill/issues/2446#issuecomment-1026540149","issue_url":"https://api.github.com/repos/apache/drill/issues/2446","id":1026540149,"node_id":"IC_kwDOAFa5xc49L8J1","user":{"login":"paul-rogers","id":3248881,"node_id":"MDQ6VXNlcjMyNDg4ODE=","avatar_url":"https://avatars.githubusercontent.com/u/3248881?v=4","gravatar_id":"","url":"https://api.github.com/users/paul-rogers","html_url":"https://github.com/paul-rogers","followers_url":"https://api.github.com/users/paul-rogers/followers","following_url":"https://api.github.com/users/paul-rogers/following{/other_user}","gists_url":"https://api.github.com/users/paul-rogers/gists{/gist_id}","starred_url":"https://api.github.com/users/paul-rogers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paul-rogers/subscriptions","organizations_url":"https://api.github.com/users/paul-rogers/orgs","repos_url":"https://api.github.com/users/paul-rogers/repos","events_url":"https://api.github.com/users/paul-rogers/events{/privacy}","received_events_url":"https://api.github.com/users/paul-rogers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-01T07:15:37Z","updated_at":"2022-02-01T07:15:37Z","author_association":"CONTRIBUTOR","body":"Great idea. I wrote a lot of that code originally, let me know if you have questions. The dependencies might be related to things like the test-only row set classes, integrations with JUnit for temporary directories and so on. It may be possible to split the class so that one class has only those bits and pieces needed for client apps. and a subclass adds the additional parts used by tests.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1026540149/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1026594592","html_url":"https://github.com/apache/drill/pull/2432#issuecomment-1026594592","issue_url":"https://api.github.com/repos/apache/drill/issues/2432","id":1026594592,"node_id":"IC_kwDOAFa5xc49MJcg","user":{"login":"vdiravka","id":11904420,"node_id":"MDQ6VXNlcjExOTA0NDIw","avatar_url":"https://avatars.githubusercontent.com/u/11904420?v=4","gravatar_id":"","url":"https://api.github.com/users/vdiravka","html_url":"https://github.com/vdiravka","followers_url":"https://api.github.com/users/vdiravka/followers","following_url":"https://api.github.com/users/vdiravka/following{/other_user}","gists_url":"https://api.github.com/users/vdiravka/gists{/gist_id}","starred_url":"https://api.github.com/users/vdiravka/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vdiravka/subscriptions","organizations_url":"https://api.github.com/users/vdiravka/orgs","repos_url":"https://api.github.com/users/vdiravka/repos","events_url":"https://api.github.com/users/vdiravka/events{/privacy}","received_events_url":"https://api.github.com/users/vdiravka/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-01T08:37:02Z","updated_at":"2022-02-01T08:37:02Z","author_association":"MEMBER","body":"The changes look good to me. But need to solve jdk8 build for sure. What do you think what lib affects requiring more memory? `t-diggest`? And looks like the aggregation function require more memory (`TestAggregateFunctions`).\r\nTo understand better the memory usage during execution it is possible to check that test case in debug mode with VisualVM or Intellij Idea profiler tool\r\n","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1026594592/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1026600514","html_url":"https://github.com/apache/drill/issues/2350#issuecomment-1026600514","issue_url":"https://api.github.com/repos/apache/drill/issues/2350","id":1026600514,"node_id":"IC_kwDOAFa5xc49MK5C","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-01T08:45:52Z","updated_at":"2022-02-01T08:45:52Z","author_association":"CONTRIBUTOR","body":"I've added this information to the relevant Dev wiki page, thank you for sharing it.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1026600514/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1026653802","html_url":"https://github.com/apache/drill/pull/2433#issuecomment-1026653802","issue_url":"https://api.github.com/repos/apache/drill/issues/2433","id":1026653802,"node_id":"IC_kwDOAFa5xc49MX5q","user":{"login":"luocooong","id":50079619,"node_id":"MDQ6VXNlcjUwMDc5NjE5","avatar_url":"https://avatars.githubusercontent.com/u/50079619?v=4","gravatar_id":"","url":"https://api.github.com/users/luocooong","html_url":"https://github.com/luocooong","followers_url":"https://api.github.com/users/luocooong/followers","following_url":"https://api.github.com/users/luocooong/following{/other_user}","gists_url":"https://api.github.com/users/luocooong/gists{/gist_id}","starred_url":"https://api.github.com/users/luocooong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/luocooong/subscriptions","organizations_url":"https://api.github.com/users/luocooong/orgs","repos_url":"https://api.github.com/users/luocooong/repos","events_url":"https://api.github.com/users/luocooong/events{/privacy}","received_events_url":"https://api.github.com/users/luocooong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-01T09:49:01Z","updated_at":"2022-02-01T09:49:01Z","author_association":"MEMBER","body":"@vvysotskyi It looks like there are conflicts to resolve before merging, thank you.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1026653802/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1026745794","html_url":"https://github.com/apache/drill/issues/2446#issuecomment-1026745794","issue_url":"https://api.github.com/repos/apache/drill/issues/2446","id":1026745794,"node_id":"IC_kwDOAFa5xc49MuXC","user":{"login":"rymarm","id":62295633,"node_id":"MDQ6VXNlcjYyMjk1NjMz","avatar_url":"https://avatars.githubusercontent.com/u/62295633?v=4","gravatar_id":"","url":"https://api.github.com/users/rymarm","html_url":"https://github.com/rymarm","followers_url":"https://api.github.com/users/rymarm/followers","following_url":"https://api.github.com/users/rymarm/following{/other_user}","gists_url":"https://api.github.com/users/rymarm/gists{/gist_id}","starred_url":"https://api.github.com/users/rymarm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rymarm/subscriptions","organizations_url":"https://api.github.com/users/rymarm/orgs","repos_url":"https://api.github.com/users/rymarm/repos","events_url":"https://api.github.com/users/rymarm/events{/privacy}","received_events_url":"https://api.github.com/users/rymarm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-01T11:31:21Z","updated_at":"2022-02-01T11:31:21Z","author_association":"MEMBER","body":"@GavinRay97 several months before I have found that Drill can be run in \"embedded mode\" with a pretty simple configuration. To achieve this, you need to add the next dependencies to your project `pom.xml`:\r\n```xml\r\n<dependencies>\r\n        <dependency>\r\n            <groupId>org.apache.drill.exec</groupId>\r\n            <artifactId>drill-java-exec</artifactId>\r\n            <version>1.19.0</version>\r\n            <exclusions>\r\n                <exclusion>\r\n                    <groupId>org.slf4j</groupId>\r\n                    <artifactId>log4j-over-slf4j</artifactId>\r\n                </exclusion>\r\n                <exclusion>\r\n                    <groupId>org.slf4j</groupId>\r\n                    <artifactId>slf4j-log4j12</artifactId>\r\n                </exclusion>\r\n            </exclusions>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>org.apache.drill.exec</groupId>\r\n            <artifactId>drill-jdbc</artifactId>\r\n            <version>1.19.0</version>\r\n            <exclusions>\r\n                <exclusion>\r\n                    <groupId>org.slf4j</groupId>\r\n                    <artifactId>log4j-over-slf4j</artifactId>\r\n                </exclusion>\r\n                <exclusion>\r\n                    <groupId>org.slf4j</groupId>\r\n                    <artifactId>slf4j-log4j12</artifactId>\r\n                </exclusion>\r\n            </exclusions>\r\n        </dependency>\r\n        <dependency>\r\n            <groupId>com.google.guava</groupId>\r\n            <artifactId>guava</artifactId>\r\n            <version>21.0</version>\r\n        </dependency>\r\n    </dependencies>\r\n```\r\nAnd after that, you will be able to run embedded Drill with the following example code:\r\n```java\r\n    // This part is responsible for running the embedded Drill and establishing a connection to it.\r\n    // \"jdbc:drill:zk=local\" is connection string to run embedded Drill \r\n    Connection connection = DriverManager.getConnection(\"jdbc:drill:zk=local\"); \r\n    // Example of executing simple query\r\n    Statement st = connection.createStatement();\r\n    // `/home/maksym/Desktop/sample.csv` is path to csv file that I've created for the example\r\n    ResultSet rs = st.executeQuery(\"select * from dfs.`/home/maksym/Desktop/sample.csv`\");\r\n    while (rs.next()) {\r\n      System.out.println(rs.getString(1));\r\n    }\r\n    connection.close();\r\n```\r\n\r\nI didn't find exhausting information on how exactly should be configured application: what dependencies are required, what properties are available, and so on. But you can dive into code and look at how embedded mode was implemented. Here is the departure point:\r\nhttps://github.com/apache/drill/blob/15b2f52260e4f0026f2dfafa23c5d32e0fb66502/exec/jdbc/src/main/java/org/apache/drill/jdbc/impl/DrillConnectionImpl.java#L104\r\n\r\nBesides this, you also find many Jira tickets that belong to issues with embedded Drill, here are several of them:\r\n[DRILL-2126](https://issues.apache.org/jira/browse/DRILL-2126),\r\n[DRILL-1654](https://issues.apache.org/jira/browse/DRILL-1654),\r\n[DRILL-1409](https://issues.apache.org/jira/browse/DRILL-1409)\r\n\r\nAccording to my investigation of code and manual tests, it seems, that embedded Drill works pretty well and the only issue is dependency conflicts, that is why in my example above, I added guava and excluded log jars. \r\n\r\nI would like to gather as much information as possible about embedded Drill and add it to Drill documentation or make some code improvements to let users freely use this mode for their application. Of course, Drill was created as a distributed system, but Drill is so powerful tool that is also very useful even in single, embedded node mode. ","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1026745794/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1027598044","html_url":"https://github.com/apache/drill/pull/2364#issuecomment-1027598044","issue_url":"https://api.github.com/repos/apache/drill/issues/2364","id":1027598044,"node_id":"IC_kwDOAFa5xc49P-bc","user":{"login":"paul-rogers","id":3248881,"node_id":"MDQ6VXNlcjMyNDg4ODE=","avatar_url":"https://avatars.githubusercontent.com/u/3248881?v=4","gravatar_id":"","url":"https://api.github.com/users/paul-rogers","html_url":"https://github.com/paul-rogers","followers_url":"https://api.github.com/users/paul-rogers/followers","following_url":"https://api.github.com/users/paul-rogers/following{/other_user}","gists_url":"https://api.github.com/users/paul-rogers/gists{/gist_id}","starred_url":"https://api.github.com/users/paul-rogers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paul-rogers/subscriptions","organizations_url":"https://api.github.com/users/paul-rogers/orgs","repos_url":"https://api.github.com/users/paul-rogers/repos","events_url":"https://api.github.com/users/paul-rogers/events{/privacy}","received_events_url":"https://api.github.com/users/paul-rogers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-02T05:24:39Z","updated_at":"2022-02-02T05:28:21Z","author_association":"CONTRIBUTOR","body":"@vdiravka reached out to me on this bug. His explanation:\r\n\r\n> The issue is the schema is changed for the second batch and it is reported by SchemaTracker#isSameSchema\r\nI suppose V1 reader just compared the same field type, but the new one compares vectors by identity. So schemaChange is right thing for that test case. But Drill Hash aggregate doesn't support schema change.\r\n\r\nHere is my analysis:\r\n\r\nYou are tight that the `SchemaTracker` is the thing in EVF which looks for schema changes. The rule is pretty simple: if the the kind of vector differs from the previous batch, then a schema change occurred. This is based, in part, on the observation that the sort operator can't handle any schema changes at all: not INT/BIGINT, not NOT NULL to NULL. Sort combines vectors, and if they are of a different type, the values won't fit together. The same is probably true of the hash agg.\r\n\r\nOK, so we agree that a type change is bad. What you're describing is the same type, but a different vector. This is a bug in several ways, and not the way you might think.\r\n\r\nFirst, it seems logical that if column x is a non-null INT in one batch, and is a non-null INT in the next batch, that no schema change has occurred. But, Drill will surprise you. Most operators assume that the vector itself has not changed: only the data stored within the vector. This is a subtle point, so let me expand it.\r\n\r\nA vector is a permanent holder or a column. The vector holds one or more data buffers. Those buffers change from batch to batch. Think of it as a bucket brigade: the old-style way that people fought fires. A chain of people forms (the vectors). They hand buckets one to the next (the data buffers).\r\n\r\nNow, I was pretty surprised when I first discovered this. So was Boaz when he wrote hash agg. But, most of Drill's code assumes that, in setup, the code binds to a specific vector. In the next batch, that same binding is valid; only the data changes. This shows up in code gen and other places. In fact, a goodly part of EVF is concerned with this need for \"vector continuity\" even across readers. (Let that sink in: two readers that have nothing to do with each other must somehow still share common vectors. That alone should tell us the vector design in Drill is a bit strange and needs rethinking. But, that's another topic.)\r\n\r\nSo, now let's review the bug. On the one hand, `SchemaTracker` has noticed the vectors changed, and is (correctly) telling the downstream operators that they must redo their bindings to the new vector.\r\n\r\nBut, on the other hand, `SchemaTracker` has been presented with two different vectors for the same column. That should never happen unless there is an actual type change (non-null to null, INT to BIGINT, etc.) There are elaborate mechanisms to reuse vectors from one reader to the next.\r\n\r\nSo, the first thing to check is if the types are at all different. (If the \"major types\" differ.) If so, then we have a legitimate schema change that Drill can't handle.\r\n\r\nNow, if you find that the types are the same, then we have a bug in EVF, specifically in the `ResultVectorCacheImpl` class, since that's the thing which is supposed to do the magic.\r\n\r\nLet me ask another question. When this occurs, is it in the first batch of the second (or later) reader? If so, then that reader should have pulled the vector from the cache. The question is, why didn't it?\r\n\r\nIf the error occurs within the first reader, then the bug is more subtle. How could the JSON reader accomplish that? The `ResultSetLoader` hides all that detail, and it defers to the `ResultVectorCacheImpl `for vector continuity.\r\n\r\nYet another question is why these tests didn't fail 3 months ago when the tests first ran. And, why did the tests pass way back when I wrote this code? Did anything change elsewhere that could trigger this? I don't see how, but we should probably ask the question. \r\n\r\nStill another possibility is that there has always been a schema change, the prior code failed to point out the schema change (by returning a `OK_NEW_SCHEMA` status) yet somehow the hash agg handled that case. If so, then there is a whole chain of bug. That would not surprise me: I had to fix bug after bug after bug to get the EVF stuff working: often someone broke something in one place to work around something broken in another. When I fixed one, the other failed when it should not have. Loads of fun.\r\n\r\nFortunately, these are unit tests, so we should be able to sort out the issues without too much trouble.\r\n\r\nI'll also note that there were a few fixes to EVF V2 that I made in my PR, but those were around a subtle but in implicit columns.\r\n\r\nSuggestion: give the above a shot to see if you can see the problem. Otherwise, tomorrow I'll try to squeeze in time to grab this branch and do some debugging. After all, I wrote this stuff originally, so I should try to make it work.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1027598044/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1027605931","html_url":"https://github.com/apache/drill/issues/2446#issuecomment-1027605931","issue_url":"https://api.github.com/repos/apache/drill/issues/2446","id":1027605931,"node_id":"IC_kwDOAFa5xc49QAWr","user":{"login":"paul-rogers","id":3248881,"node_id":"MDQ6VXNlcjMyNDg4ODE=","avatar_url":"https://avatars.githubusercontent.com/u/3248881?v=4","gravatar_id":"","url":"https://api.github.com/users/paul-rogers","html_url":"https://github.com/paul-rogers","followers_url":"https://api.github.com/users/paul-rogers/followers","following_url":"https://api.github.com/users/paul-rogers/following{/other_user}","gists_url":"https://api.github.com/users/paul-rogers/gists{/gist_id}","starred_url":"https://api.github.com/users/paul-rogers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paul-rogers/subscriptions","organizations_url":"https://api.github.com/users/paul-rogers/orgs","repos_url":"https://api.github.com/users/paul-rogers/repos","events_url":"https://api.github.com/users/paul-rogers/events{/privacy}","received_events_url":"https://api.github.com/users/paul-rogers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-02T05:37:29Z","updated_at":"2022-02-02T05:40:14Z","author_association":"CONTRIBUTOR","body":"Thanks @rymarm  for the info! This is one of those cases where bug becomes a feature. The reason embedded Drill works via JDBC is that most of Drill ends up getting sucked into the JDBC driver for no good reason other than that the RPC code depends on everything else. That's lucky for you, but not so great for folks who just want a simple JDBC driver.\r\n\r\nAs it turns out, the reason that SqlLine can run an embedded Drill is because the JDBC driver contains all the code. But, do we want a JDBC driver to include a Spunk connector, a PDF reader, support for Hadoop and all the rest? Kind of creates a rather fat client, and all those libraries conflict with that the surrounding app wants to do. This is why the JDBC driver build chucks a bunch of dependencies overboard.\r\n\r\nAt some point (maybe Drill 2.0?) we need to create a simpler JDBC driver. At that point, the mechanism that @GavinRay97 original requested will be needed to start the server that the JDBC driver then connects to. We're not there now (far from it), but that's kind of where we should head. (There is a whole vector discussion that includes this topic.)","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1027605931/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1027942224","html_url":"https://github.com/apache/drill/pull/2447#issuecomment-1027942224","issue_url":"https://api.github.com/repos/apache/drill/issues/2447","id":1027942224,"node_id":"IC_kwDOAFa5xc49RSdQ","user":{"login":"jnturton","id":9107319,"node_id":"MDQ6VXNlcjkxMDczMTk=","avatar_url":"https://avatars.githubusercontent.com/u/9107319?v=4","gravatar_id":"","url":"https://api.github.com/users/jnturton","html_url":"https://github.com/jnturton","followers_url":"https://api.github.com/users/jnturton/followers","following_url":"https://api.github.com/users/jnturton/following{/other_user}","gists_url":"https://api.github.com/users/jnturton/gists{/gist_id}","starred_url":"https://api.github.com/users/jnturton/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jnturton/subscriptions","organizations_url":"https://api.github.com/users/jnturton/orgs","repos_url":"https://api.github.com/users/jnturton/repos","events_url":"https://api.github.com/users/jnturton/events{/privacy}","received_events_url":"https://api.github.com/users/jnturton/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-02T13:29:30Z","updated_at":"2022-02-02T13:29:30Z","author_association":"CONTRIBUTOR","body":"@vvysotskyi sorry, I wrote an @vdiravka but it was you who commented.  The idea behind this GC is to reduce memory usage in low mem environments like our CI.  The trade off is that it has some worse pause times than the newer GCs but some longer pauses are better than a crashed CI.  My prediction is that reverting it will bring back \"JVM process terminated unexpectedly\" for the JDK 8 build specifically.  But it can be set in another PR, I just needed a CI pass here for deps updates reasons.  It was just a means to an end for me.","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1027942224/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/drill/issues/comments/1028638636","html_url":"https://github.com/apache/drill/pull/2364#issuecomment-1028638636","issue_url":"https://api.github.com/repos/apache/drill/issues/2364","id":1028638636,"node_id":"IC_kwDOAFa5xc49T8es","user":{"login":"paul-rogers","id":3248881,"node_id":"MDQ6VXNlcjMyNDg4ODE=","avatar_url":"https://avatars.githubusercontent.com/u/3248881?v=4","gravatar_id":"","url":"https://api.github.com/users/paul-rogers","html_url":"https://github.com/paul-rogers","followers_url":"https://api.github.com/users/paul-rogers/followers","following_url":"https://api.github.com/users/paul-rogers/following{/other_user}","gists_url":"https://api.github.com/users/paul-rogers/gists{/gist_id}","starred_url":"https://api.github.com/users/paul-rogers/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/paul-rogers/subscriptions","organizations_url":"https://api.github.com/users/paul-rogers/orgs","repos_url":"https://api.github.com/users/paul-rogers/repos","events_url":"https://api.github.com/users/paul-rogers/events{/privacy}","received_events_url":"https://api.github.com/users/paul-rogers/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-03T06:19:01Z","updated_at":"2022-02-03T06:19:01Z","author_association":"CONTRIBUTOR","body":"Oddly, `TestE2EUnnestAndLateral` works just fine in Eclipse on my machine with this branch. Is that the correct test which was failing? Also, I see in the panel here in GitHub that all tests passed. Can you explain the issue a bit more?","reactions":{"url":"https://api.github.com/repos/apache/drill/issues/comments/1028638636/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]