[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416352071","html_url":"https://github.com/apache/couchdb/issues/1578#issuecomment-416352071","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1578","id":416352071,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjM1MjA3MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-27T20:09:15Z","updated_at":"2018-08-27T20:09:35Z","author_association":"MEMBER","body":"@nickva Is there anything to be done here from a development perspective other than document this restriction on rolling upgrades for future admins?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416352071/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416355445","html_url":"https://github.com/apache/couchdb/issues/1578#issuecomment-416355445","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1578","id":416355445,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjM1NTQ0NQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-27T20:21:10Z","updated_at":"2018-08-27T20:21:10Z","author_association":"CONTRIBUTOR","body":"We already did the most important work of switching away from closures. For upgrades notes, it would be a comment about upgrading from version less than 2.2 to 2.2 and higher and that attachment uploading during mixed cluster operation could throw errors. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416355445/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416390284","html_url":"https://github.com/apache/couchdb/issues/1583#issuecomment-416390284","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1583","id":416390284,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjM5MDI4NA==","user":{"login":"ermouth","id":1540047,"node_id":"MDQ6VXNlcjE1NDAwNDc=","avatar_url":"https://avatars.githubusercontent.com/u/1540047?v=4","gravatar_id":"","url":"https://api.github.com/users/ermouth","html_url":"https://github.com/ermouth","followers_url":"https://api.github.com/users/ermouth/followers","following_url":"https://api.github.com/users/ermouth/following{/other_user}","gists_url":"https://api.github.com/users/ermouth/gists{/gist_id}","starred_url":"https://api.github.com/users/ermouth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ermouth/subscriptions","organizations_url":"https://api.github.com/users/ermouth/orgs","repos_url":"https://api.github.com/users/ermouth/repos","events_url":"https://api.github.com/users/ermouth/events{/privacy}","received_events_url":"https://api.github.com/users/ermouth/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-27T22:31:38Z","updated_at":"2018-08-27T22:31:38Z","author_association":"CONTRIBUTOR","body":"Please see #1544 for solution.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416390284/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416405375","html_url":"https://github.com/apache/couchdb/issues/1583#issuecomment-416405375","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1583","id":416405375,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjQwNTM3NQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-27T23:52:10Z","updated_at":"2018-08-27T23:52:10Z","author_association":"MEMBER","body":"Duplicate of #1544","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416405375/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416636466","html_url":"https://github.com/apache/couchdb/issues/1584#issuecomment-416636466","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1584","id":416636466,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjYzNjQ2Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-28T15:43:29Z","updated_at":"2018-08-28T15:43:29Z","author_association":"MEMBER","body":"@jvegaseg Did this result in any poor behaviour on the server, or just a logged error message? Couch can throw a lot of error messages even during normal operation, it can be noisy that way.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416636466/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416750252","html_url":"https://github.com/apache/couchdb/issues/1585#issuecomment-416750252","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1585","id":416750252,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjc1MDI1Mg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-28T21:41:08Z","updated_at":"2018-08-28T21:41:08Z","author_association":"MEMBER","body":"Any attempts to access `/_*` endpoints are not real databases, but system endpoints.\r\n\r\nPort 6004 is unusual, can you confirm this is the standard clustered (port 5984) port and not the node-local (port 5986) port?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416750252/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416759796","html_url":"https://github.com/apache/couchdb/issues/1584#issuecomment-416759796","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1584","id":416759796,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjc1OTc5Ng==","user":{"login":"jvegaseg","id":12508470,"node_id":"MDQ6VXNlcjEyNTA4NDcw","avatar_url":"https://avatars.githubusercontent.com/u/12508470?v=4","gravatar_id":"","url":"https://api.github.com/users/jvegaseg","html_url":"https://github.com/jvegaseg","followers_url":"https://api.github.com/users/jvegaseg/followers","following_url":"https://api.github.com/users/jvegaseg/following{/other_user}","gists_url":"https://api.github.com/users/jvegaseg/gists{/gist_id}","starred_url":"https://api.github.com/users/jvegaseg/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jvegaseg/subscriptions","organizations_url":"https://api.github.com/users/jvegaseg/orgs","repos_url":"https://api.github.com/users/jvegaseg/repos","events_url":"https://api.github.com/users/jvegaseg/events{/privacy}","received_events_url":"https://api.github.com/users/jvegaseg/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-28T22:21:01Z","updated_at":"2018-08-28T22:21:01Z","author_association":"NONE","body":"I think just a logged error message and I have no idea of the cause.\r\nSo, have I to be worried about it?\r\nRegards,","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416759796/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416830038","html_url":"https://github.com/apache/couchdb/issues/1585#issuecomment-416830038","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1585","id":416830038,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjgzMDAzOA==","user":{"login":"flimzy","id":8555063,"node_id":"MDQ6VXNlcjg1NTUwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8555063?v=4","gravatar_id":"","url":"https://api.github.com/users/flimzy","html_url":"https://github.com/flimzy","followers_url":"https://api.github.com/users/flimzy/followers","following_url":"https://api.github.com/users/flimzy/following{/other_user}","gists_url":"https://api.github.com/users/flimzy/gists{/gist_id}","starred_url":"https://api.github.com/users/flimzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flimzy/subscriptions","organizations_url":"https://api.github.com/users/flimzy/orgs","repos_url":"https://api.github.com/users/flimzy/repos","events_url":"https://api.github.com/users/flimzy/events{/privacy}","received_events_url":"https://api.github.com/users/flimzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-29T05:36:04Z","updated_at":"2018-08-29T05:36:04Z","author_association":"MEMBER","body":"Yes, sorry, 6004 is mapped to 5984 on my docker container (the unusual port mapping is to accommodate multiple versions of CouchDB running).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416830038/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416945701","html_url":"https://github.com/apache/couchdb/pull/1577#issuecomment-416945701","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1577","id":416945701,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNjk0NTcwMQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-29T13:06:52Z","updated_at":"2018-08-29T13:06:52Z","author_association":"MEMBER","body":"merged manually, closing.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/416945701/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417030783","html_url":"https://github.com/apache/couchdb/pull/1568#issuecomment-417030783","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1568","id":417030783,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNzAzMDc4Mw==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-29T17:08:51Z","updated_at":"2018-08-29T17:08:51Z","author_association":"CONTRIBUTOR","body":"I've squashed into a single commit. @rnewson do you mind merging this?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417030783/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417052247","html_url":"https://github.com/apache/couchdb/issues/1585#issuecomment-417052247","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1585","id":417052247,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNzA1MjI0Nw==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-29T18:14:59Z","updated_at":"2018-08-29T18:14:59Z","author_association":"MEMBER","body":"@flimzy thank you for reporting. This is a result of refactoring where previously the calls to a non-existent database were intercepted up the chain by auxiliary security check. I've opened PR apache/couchdb#1588 to address this issue.\r\n\r\nBy the way, I don't know if you aware, but in 2.x a call to `/db/_ensure_full_commit` is a noop operation that's always returning 201. I don't know for sure, but I suspect it was done just to keep API's back compatibility.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417052247/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417059810","html_url":"https://github.com/apache/couchdb/issues/1585#issuecomment-417059810","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1585","id":417059810,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNzA1OTgxMA==","user":{"login":"flimzy","id":8555063,"node_id":"MDQ6VXNlcjg1NTUwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8555063?v=4","gravatar_id":"","url":"https://api.github.com/users/flimzy","html_url":"https://github.com/flimzy","followers_url":"https://api.github.com/users/flimzy/followers","following_url":"https://api.github.com/users/flimzy/following{/other_user}","gists_url":"https://api.github.com/users/flimzy/gists{/gist_id}","starred_url":"https://api.github.com/users/flimzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flimzy/subscriptions","organizations_url":"https://api.github.com/users/flimzy/orgs","repos_url":"https://api.github.com/users/flimzy/repos","events_url":"https://api.github.com/users/flimzy/events{/privacy}","received_events_url":"https://api.github.com/users/flimzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-29T18:36:20Z","updated_at":"2018-08-29T18:36:20Z","author_association":"MEMBER","body":"> By the way, I don't know if you aware, but in 2.x a call to /db/_ensure_full_commit is a noop operation \r\n\r\nI wasn't aware. It looks like this needs to be updated in the documentation. I'll try to find time to do that soon, if nobody beats me to it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417059810/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417100566","html_url":"https://github.com/apache/couchdb/pull/1588#issuecomment-417100566","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1588","id":417100566,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNzEwMDU2Ng==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-29T20:48:27Z","updated_at":"2018-08-29T20:48:27Z","author_association":"MEMBER","body":"@iilyak ok, updated with the comment. does it look sufficient for you?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417100566/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417126255","html_url":"https://github.com/apache/couchdb/pull/1586#issuecomment-417126255","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1586","id":417126255,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNzEyNjI1NQ==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-29T22:22:51Z","updated_at":"2018-08-29T22:22:51Z","author_association":"CONTRIBUTOR","body":"test passes locally:\r\n```\r\n$ make eunit apps=couch tests=mrview_cleanup_index_files_test_\r\n==> couch (eunit)\r\n    Running test function(s):\r\n      couchdb_mrview_tests:mrview_cleanup_index_files_test_/0\r\n======================== EUnit ========================\r\nCheck index files cleanup\r\n  clustered\r\n    couchdb_mrview_tests:146: should_cleanup_index_files...[0.210 s] ok\r\n    [done in 0.215 s]\r\n=======================================================\r\n  Test passed.\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417126255/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417306819","html_url":"https://github.com/apache/couchdb/issues/1373#issuecomment-417306819","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1373","id":417306819,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNzMwNjgxOQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-30T12:47:16Z","updated_at":"2018-08-30T12:47:16Z","author_association":"CONTRIBUTOR","body":"# Compromise solution\r\n\r\n## All developers would agree on\r\n\r\n1. all new log statements should receive proplist type for args. \r\n2. we should discourage use of string formatter directives (such as `~p`)\r\n3. The Message in the call shouldn't have any data embedded\r\n\r\n## Implementation\r\n\r\n1. We would implement `couch_log:Level(Message, Args, Meta)` interface using parse_transform and merl. \r\n2. The implementation would support both plane list and proplist for Args (for compatibility reasons)\r\n3. The `io_lib:format` call would be done in the formatters (which need it).\r\n4. In case when keys supplied via Args collide with automatically injected in Meta, Args takes precedence. \r\n\r\n## Examples\r\n\r\n### Old style logging call\r\n\r\n`couch_log:error(\"Compaction started for ~p~n\", [\"shards/....\"])` \r\n\r\nline formatter output\r\n\r\n`Compaction started for shards/..... [pid=<0.11.0>, line=123, file=couch_db_updater.erl, arg_1=\"shards/...\"]`\r\n\r\njson formatter output\r\n\r\n```\r\n{\r\n    \"message\": \"Compaction started for ~p~n\",\r\n    \"line\": 123,\r\n    \"file\": \"couch_db_updater.erl\",\r\n    \"pid\": \"<0.11.0>\",\r\n    \"arg_1\": \"shards/...\" \r\n}\r\n```\r\n\r\n### New style logging\r\n\r\n`couch_log:error(\"Compaction started\", [{shard, \"shards/...\"}], [{user, \"foo\"}]).`\r\n\r\nline formatter output\r\n\r\n`Compaction started. [pid=<0.11.0>, line=123, file=couch_db_updater.erl, shard=\"shards/...\", user=\"foo\"]`\r\n\r\njson formatter output\r\n\r\n```\r\n{\r\n    \"message\": \"Compaction started for ~p~n\",\r\n    \"line\": 123,\r\n    \"file\": \"couch_db_updater.erl\",\r\n    \"pid\": \"<0.11.0>\",\r\n    \"shard\": \"shards/...\",\r\n    \"user\": \"foo\"\r\n}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417306819/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417602224","html_url":"https://github.com/apache/couchdb/issues/1373#issuecomment-417602224","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1373","id":417602224,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNzYwMjIyNA==","user":{"login":"mikerhodes","id":453210,"node_id":"MDQ6VXNlcjQ1MzIxMA==","avatar_url":"https://avatars.githubusercontent.com/u/453210?v=4","gravatar_id":"","url":"https://api.github.com/users/mikerhodes","html_url":"https://github.com/mikerhodes","followers_url":"https://api.github.com/users/mikerhodes/followers","following_url":"https://api.github.com/users/mikerhodes/following{/other_user}","gists_url":"https://api.github.com/users/mikerhodes/gists{/gist_id}","starred_url":"https://api.github.com/users/mikerhodes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikerhodes/subscriptions","organizations_url":"https://api.github.com/users/mikerhodes/orgs","repos_url":"https://api.github.com/users/mikerhodes/repos","events_url":"https://api.github.com/users/mikerhodes/events{/privacy}","received_events_url":"https://api.github.com/users/mikerhodes/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-31T09:05:02Z","updated_at":"2018-08-31T09:05:02Z","author_association":"CONTRIBUTOR","body":"I think a move to structured logging will be very helpful. As @eiri points out, at least in my experience it makes one think more deeply about useful log ... _content_ I'll call it ðŸ˜„ \r\n\r\nFWIW I have tended to think of the \"message\" as the human readable bit that will show up by default in tools like Kibana or Splunk. In this thinking should therefore be a useful one line to scan. So for the compaction example, I would likely choose to output the message of \"Compaction started for shards/.....\" rather than just \"Compaction started.\". I think this is my only main insight that I haven't seen in the awesome discussion on this ticket so far :) \r\n\r\nWhile I think @eiri is right that message is \"just another field\", most solutions appear to output a `message` field by default in the UI and have disclosure arrows to view other things, so I do think that these messages need to be useful for a human reading the logs.\r\n\r\nFor the other fields, I've tended to think about what would be useful from a searching perspective. So \"action: compaction_start\" might be a useful one that these examples miss out. Broadly: what should I include that means that a search doesn't have to include free-text searches of the message field. In practice this usually means duplicated information between the message and the fields.\r\n\r\nFor the API specifics:\r\n\r\n- I side with @eiri that a single \"bin\" for the extra fields in the JSON is easier, it's not obvious to me whether there's a natural mapping. For the meta-info of line etc. perhaps the macro/parse transform needs to validate no name clashes once its validated the log level? Problem here is that you need good test code coverage to make sure this doesn't explode (could a transform do this check at compile time?).\r\n- I like something like:\r\n          \r\n        couch_log:error(FormatString, FormatArgs, ExtraFields)\r\n\r\n    which ends up like:\r\n\r\n        couch_log:error(\"Compaction started for ~p\", [{shard, \"shards/...\"}], [{user, \"foo\"}, {shard, \"shards/...\"}])\r\n\r\n    Note the duplication of shard info, but I think this makes reading the logs and searching them simpler. Arguably you could have named bit in the string formatting that could read fields from `ExtraFields` to avoid having to have the `FormatArgs` argument. I don't know if Erlang's formatting supports it though.\r\n- I have always liked the \"log4X\" pattern where what to log is separate from the format of the log, and they are configured separately. At a scan, the Erlang 21 logger @kocolosk links to follows this pattern; I've always liked python's `logger` class too, though it's a bit long in the tooth.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417602224/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417637717","html_url":"https://github.com/apache/couchdb/issues/1373#issuecomment-417637717","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1373","id":417637717,"node_id":"MDEyOklzc3VlQ29tbWVudDQxNzYzNzcxNw==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-08-31T11:36:21Z","updated_at":"2018-08-31T11:36:21Z","author_association":"CONTRIBUTOR","body":"Thank you @mikerhodes. \r\n\r\n> So \"action: compaction_start\" might be a useful one that these examples miss out. \r\n\r\nWe definitely missed `action` field. How would you add it to API? Are you proposing to add into ExtraFields?\r\n\r\n> Arguably you could have named bit in the string formatting that could read fields from ExtraFields to avoid having to have the FormatArgs argument. I don't know if Erlang's formatting supports it though.\r\n\r\nUnfortunately Erlang `io_lib:format` doesn't support named arguments or interpolation. However your comment lead me to one idea which I would like to hear some feedback about from a wider audience. The idea is to use maps for fields and pass list of fields to use in formatter in the order of appearance in the format string. \r\n\r\n```\r\ncouch_log:error(\"Compaction started for ~p\", [shard], #{\r\n     user => \"foo\", \r\n     shard => \"shards/...\"\r\n}).\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/417637717/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/418168273","html_url":"https://github.com/apache/couchdb/issues/1592#issuecomment-418168273","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1592","id":418168273,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODE2ODI3Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-03T17:44:24Z","updated_at":"2018-09-03T17:44:24Z","author_association":"MEMBER","body":"Thanks, this is a documentation bug, we'll take care of it. `changes_timeout` is correct.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/418168273/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/418370850","html_url":"https://github.com/apache/couchdb/issues/1373#issuecomment-418370850","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1373","id":418370850,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODM3MDg1MA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-04T13:40:16Z","updated_at":"2018-09-04T13:40:16Z","author_association":"MEMBER","body":"I think an `action` field is a good idea with one caveat that without formal naming strategy it's fairly simple to get a lot of inconsistencies in there and have for example `starting_compaction` in one place and `compaction_start` in another. Can't think of a good way to solve it without defining some naming rules beforehand and then adding a check for compliance as a part of a review process. \r\nThan again I might be overthinking this and it doesn't matter as long as the actions are unique and greppable in code.\r\n\r\nOn another note, here seems to be a general believe that `FormatArgs` always represent data worth adding to a data portion of logs. I personally don't think that's the case, with a message `log(\"Starting compaction for shard ~p on update sequence ~p\", [<<\"shard\">>, 12])` it would be helpful to have an ability to query by `shard` field, much less so for `update_sequence` field. Let's not forget that data points are not free, each represent an index on a receiving side meaning storage size and log processing rate.\r\n\r\nIf we are insist on treating `FormatArgs` and `ExtraFields` as the same, then probably we are better to give up on `io_lib:format` for message formatting and switch to a proper templating like [mustache](https://github.com/mojombo/mustache.erl) or [dtl](https://github.com/erlydtl/erlydtl), if we can't keep things simple we as well can go whole way.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/418370850/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/418497012","html_url":"https://github.com/apache/couchdb/issues/1594#issuecomment-418497012","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1594","id":418497012,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODQ5NzAxMg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-04T19:54:44Z","updated_at":"2018-09-04T19:54:44Z","author_association":"MEMBER","body":"Hi @ahayes, thanks for this report.\r\n\r\nYou've made changes to a packaged config file. We very rarely, but occasionally, make changes to `local.ini` to change the commented-out defaults to their new values, or to add new values to it. This did happen with 2.2.0.\r\n\r\nThe Debian/Ubuntu warnings on the conffile are part of us adhering to Debian policy which [dictates ](http://www.debian.org/doc/debian-policy/ch-files.html#s-config-files) that package upgrades MUST take care of preserving user changes to configuration files. We can't simultaneously do that while updating the contents of that file with new guidance or recommendations.\r\n\r\nYou have two options available to you the way things are today:\r\n\r\n1. Pass the appropriate option to `dpkg` from `apt` when doing an upgrade, as [documented here](https://raphaelhertzog.com/2010/09/21/debian-conffile-configuration-file-managed-by-dpkg/). In your case, I expect you'd prefer to have our new version installed as `local.ini.dpkg-dist`. This can be done with:\r\n```bash\r\n$ apt-get -o Dpkg::Options::\"-force-confdef\" -o Dpkg::Options::\"--force-confold\" install --only-upgrade couchdb\r\n```\r\n  * The first option tells dpkg to decide on its own whenever possible, prompting only when necessary, and overwriting any config files that have not been modified.\r\n  * The second option says to not modify the current configuration file if changed, and install the new version from tha package with the `.dpkg-dist` suffix.\r\n  * I've shown `install --only-upgrade couchdb` to limit this process to just the `couchdb` package. If you'd used `dist-upgrade` there, `apt-get` would proceed to apply the same approach across all packages, not just `couchdb`. You can use this if you want.\r\n2. Another workaround is for you to simply not modify `local.ini`, and instead place new files inside of the `local.d` directory named with a `.ini` extension. These files are processed after all other files, including `local.ini`, [per the order described in the documentation](http://docs.couchdb.org/en/stable/config/intro.html#configuration-files). In this case, there will never be a change to `local.ini` that will conflict with your changes.\r\n\r\nI agree with your assessment that we should improve this going forward. Ideally, we wouldn't have `default.ini` or `local.ini` files at all, and would just use the contents of the `local.d` directory as provided by you, the end user. This would be part of a larger config subsystem rewrite that would address concerns like #777. I will open a new ticket on the roadmap for this (it's been under discussion for a while, but no roadmap ticket exists yet) and link back to this one so you can follow its progress in the future.\r\n\r\nThanks again for your interest in Apache CouchDB!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/418497012/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/418500681","html_url":"https://github.com/apache/couchdb/issues/1594#issuecomment-418500681","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1594","id":418500681,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODUwMDY4MQ==","user":{"login":"ahayes","id":1750076,"node_id":"MDQ6VXNlcjE3NTAwNzY=","avatar_url":"https://avatars.githubusercontent.com/u/1750076?v=4","gravatar_id":"","url":"https://api.github.com/users/ahayes","html_url":"https://github.com/ahayes","followers_url":"https://api.github.com/users/ahayes/followers","following_url":"https://api.github.com/users/ahayes/following{/other_user}","gists_url":"https://api.github.com/users/ahayes/gists{/gist_id}","starred_url":"https://api.github.com/users/ahayes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ahayes/subscriptions","organizations_url":"https://api.github.com/users/ahayes/orgs","repos_url":"https://api.github.com/users/ahayes/repos","events_url":"https://api.github.com/users/ahayes/events{/privacy}","received_events_url":"https://api.github.com/users/ahayes/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-04T20:07:16Z","updated_at":"2018-09-04T20:07:16Z","author_association":"NONE","body":"Thank you very much for the detailed response with options for me and for linking back so I can stay in the loop!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/418500681/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/418505776","html_url":"https://github.com/apache/couchdb/issues/1595#issuecomment-418505776","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1595","id":418505776,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODUwNTc3Ng==","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-04T20:24:46Z","updated_at":"2018-09-04T20:24:46Z","author_association":"CONTRIBUTOR","body":"Related to `2.` on the topic of default config values, if we're going to spend the time reworking config, I would really like to see sane defaults for _all_ config lookups directly in the code, even potentially getting rid of the `config:get/2` lookup which drops in the default `undefined` value. There's a number of places in the code that break if you don't have a default.ini with the relevant values, and I think we should aim to be able to run without any .ini files in place.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/418505776/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/418506673","html_url":"https://github.com/apache/couchdb/issues/1595#issuecomment-418506673","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1595","id":418506673,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODUwNjY3Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-04T20:27:39Z","updated_at":"2018-09-04T20:27:39Z","author_association":"MEMBER","body":"@chewbranca as long as we don't violate DRY here, and defaults are always specified once, in one place, that can be automatically parsed for inclusion in documentation, I don't really care how it's done.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/418506673/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/418953842","html_url":"https://github.com/apache/couchdb/pull/1470#issuecomment-418953842","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1470","id":418953842,"node_id":"MDEyOklzc3VlQ29tbWVudDQxODk1Mzg0Mg==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-06T03:37:03Z","updated_at":"2018-09-06T03:37:03Z","author_association":"MEMBER","body":"@davisp Hey Paul, sorry this took ages to follow up, I kept been distracted by shiny things in Kubernetes land.\r\n\r\nIt turned out that you right and it's quite possible to have a deleted (with `_deleted` field) doc with attachment, so I removed bits around deleted flag from external size calculation and changed the tests to be more explicit about been ordered.\r\n\r\nI also fixed a crash on attempt to restore a doc with attachment and added even more confusing foreachx tests in an attachments tests suite.\r\n\r\nCan you please take a look if this looks right to you?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/418953842/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419169919","html_url":"https://github.com/apache/couchdb/pull/1596#issuecomment-419169919","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1596","id":419169919,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTE2OTkxOQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-06T17:06:30Z","updated_at":"2018-09-06T17:25:34Z","author_association":"CONTRIBUTOR","body":"The issue is reproducible with this script (in a remsh):\r\n\r\n```\r\nf(FuzzIt), FuzzIt = fun(DbName, Tries, WaitMax) ->\r\n        Ref = erlang:monitor(process, whereis(couch_server)),\r\n        [begin\r\n             [begin\r\n                CallRefs = [Open1Ref, DeleteRef, Open2Ref] = [make_ref(), make_ref(), make_ref()],\r\n                whereis(couch_server) ! {'$gen_call', {self(), Open1Ref}, {create, DbName, []}},\r\n                timer:sleep(W),\r\n                whereis(couch_server) ! {'$gen_call', {self(), DeleteRef}, {delete, DbName, []}},\r\n                whereis(couch_server) ! {'$gen_call', {self(), Open2Ref}, {open, DbName, []}},\r\n                [receive {R, _} -> ok end || R <- CallRefs]\r\n             end || W <- lists:seq(0, WaitMax)]\r\n         end || _ <- lists:seq(1, Tries)],\r\n        receive  {'DOWN', Ref, _, _, Reason} ->  {bam, Reason}\r\n        after 5000 -> nope\r\n        end\r\nend.\r\n```\r\nWhen run like this for example:\r\n```\r\nFuzzIt(<<\"blah\">>, 100, 15).\r\n```  \r\n\r\nIt might help to have a few dbs open and some activity, like say a bunch of replication jobs running as well.\r\n\r\nThe node would crash and possibly restart leaving something like this in the log:\r\n```\r\n[error] 2018-09-06T17:01:48.085468Z node1@127.0.0.1 <0.243.0> -------- couch_server terminating with {function_clause,[{couch_server,'-handle_call/3-lc$^1/1-1-',[undefined],[{file,\"src/couch_server.erl\"},{line,434}]},{couch_server,handle_call,3,[{file,\"src/couch_server.erl\"},\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419169919/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419209060","html_url":"https://github.com/apache/couchdb/pull/1596#issuecomment-419209060","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1596","id":419209060,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTIwOTA2MA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-06T19:12:02Z","updated_at":"2018-09-06T19:12:02Z","author_association":"MEMBER","body":"@nickva And to be clear, you didn't manage to reproduce it with that script after this fix right?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419209060/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419209179","html_url":"https://github.com/apache/couchdb/pull/1596#issuecomment-419209179","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1596","id":419209179,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTIwOTE3OQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-06T19:12:30Z","updated_at":"2018-09-06T19:12:30Z","author_association":"MEMBER","body":"Ah, @iilyak confirmed. Taking that as all good.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419209179/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419253500","html_url":"https://github.com/apache/couchdb/pull/1597#issuecomment-419253500","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1597","id":419253500,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTI1MzUwMA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-06T21:53:29Z","updated_at":"2018-09-06T21:53:29Z","author_association":"CONTRIBUTOR","body":"Good idea, @davisp \r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419253500/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419262317","html_url":"https://github.com/apache/couchdb/pull/1593#issuecomment-419262317","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1593","id":419262317,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTI2MjMxNw==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-06T22:31:27Z","updated_at":"2018-09-06T22:31:27Z","author_association":"MEMBER","body":"Another thing we should consider is sending the Timeout value in the open messages so that couch_server can discard any requests from a client that's already wandered off.\r\n\r\nhttps://github.com/apache/couchdb/blob/4afed4e386f3f8f1908ba989f49aaff506177be4/src/couch/src/couch_server.erl#L89","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419262317/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419262745","html_url":"https://github.com/apache/couchdb/pull/1593#issuecomment-419262745","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1593","id":419262745,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTI2Mjc0NQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-06T22:33:15Z","updated_at":"2018-09-06T22:33:15Z","author_association":"MEMBER","body":"And by timeout, I mean we should send an expiry in the message. So something like \"now + Timestamp\" and then couch_server can throw it away if that's in the past.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419262745/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419451121","html_url":"https://github.com/apache/couchdb/issues/1598#issuecomment-419451121","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1598","id":419451121,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTQ1MTEyMQ==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-07T14:08:51Z","updated_at":"2018-09-07T14:08:51Z","author_association":"MEMBER","body":"Ah, this is already possible, just under documented ðŸ˜ž  There are also a configuration for cookie domain, for what it's worth.\r\n\r\nThe configuration looks like this:\r\n```ini\r\n[couch_httpd_auth]\r\nallow_persistent_cookies = true\r\ntimeout = 600\r\ncookie_domain = .asgard.org\r\n```\r\nand this gives:\r\n```bash\r\n$ curl -v http://127.0.0.1:15984/_session -H 'Content-Type: application/json' -d '{\"name\":\"odin\",\"password\":\"asgard\"}'\r\n*   Trying 127.0.0.1...\r\n* Connected to 127.0.0.1 (127.0.0.1) port 15984 (#0)\r\n> POST /_session HTTP/1.1\r\n...\r\n< Set-Cookie: AuthSession=b2Rpbjo1QjkyODYzQzpzHjxQ0b7aKwit3CnK7cCJ3Gt8PA; Version=1; Expires=Fri, 07-Sep-2018 14:17:56 GMT; Max-Age=600; Domain=.asgard.org; Path=/; HttpOnly\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419451121/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419463294","html_url":"https://github.com/apache/couchdb/issues/1598#issuecomment-419463294","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1598","id":419463294,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTQ2MzI5NA==","user":{"login":"flimzy","id":8555063,"node_id":"MDQ6VXNlcjg1NTUwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8555063?v=4","gravatar_id":"","url":"https://api.github.com/users/flimzy","html_url":"https://github.com/flimzy","followers_url":"https://api.github.com/users/flimzy/followers","following_url":"https://api.github.com/users/flimzy/following{/other_user}","gists_url":"https://api.github.com/users/flimzy/gists{/gist_id}","starred_url":"https://api.github.com/users/flimzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flimzy/subscriptions","organizations_url":"https://api.github.com/users/flimzy/orgs","repos_url":"https://api.github.com/users/flimzy/repos","events_url":"https://api.github.com/users/flimzy/events{/privacy}","received_events_url":"https://api.github.com/users/flimzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-07T14:48:10Z","updated_at":"2018-09-07T14:48:10Z","author_association":"MEMBER","body":"Oh thanks, I'll see about creating a PR to highlight this in the documentation. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419463294/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419629095","html_url":"https://github.com/apache/couchdb/issues/1218#issuecomment-419629095","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1218","id":419629095,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTYyOTA5NQ==","user":{"login":"tiangolo","id":1326112,"node_id":"MDQ6VXNlcjEzMjYxMTI=","avatar_url":"https://avatars.githubusercontent.com/u/1326112?v=4","gravatar_id":"","url":"https://api.github.com/users/tiangolo","html_url":"https://github.com/tiangolo","followers_url":"https://api.github.com/users/tiangolo/followers","following_url":"https://api.github.com/users/tiangolo/following{/other_user}","gists_url":"https://api.github.com/users/tiangolo/gists{/gist_id}","starred_url":"https://api.github.com/users/tiangolo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tiangolo/subscriptions","organizations_url":"https://api.github.com/users/tiangolo/orgs","repos_url":"https://api.github.com/users/tiangolo/repos","events_url":"https://api.github.com/users/tiangolo/events{/privacy}","received_events_url":"https://api.github.com/users/tiangolo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-08T10:08:16Z","updated_at":"2018-09-08T10:08:16Z","author_association":"NONE","body":"I'm sorry I couldn't test with the master branch, I didn't have the environment set up (nor any experience with Erlang).\r\n\r\nBut I just tested it with the lateset `2.2.0` Docker image and I'm happy to report that I couldn't reproduce any of the issues. Everything reported here seems to be fixed.\r\n\r\nThanks @garrensmith ! :tada: ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419629095/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419642623","html_url":"https://github.com/apache/couchdb/issues/1218#issuecomment-419642623","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1218","id":419642623,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTY0MjYyMw==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-08T13:37:19Z","updated_at":"2018-09-08T13:37:19Z","author_association":"MEMBER","body":"Excellent. Thanks for your help\r\n\r\n________________________________\r\nFrom: SebastiÃ¡n RamÃ­rez <notifications@github.com>\r\nSent: Saturday, September 8, 2018 12:08:18 PM\r\nTo: apache/couchdb\r\nCc: garren smith; Mention\r\nSubject: Re: [apache/couchdb] _find with query ranges uses (or not) the index depending on order of JSON selector object keys (#1218)\r\n\r\n\r\nI'm sorry I couldn't test with the master branch, I didn't have the environment set up (nor any experience with Erlang).\r\n\r\nBut I just tested it with the lateset 2.2.0 Docker image and I'm happy to report that I couldn't reproduce any of the issues. Everything reported here seems to be fixed.\r\n\r\nThanks @garrensmith<https://github.com/garrensmith> ! ðŸŽ‰\r\n\r\nâ€”\r\nYou are receiving this because you were mentioned.\r\nReply to this email directly, view it on GitHub<https://github.com/apache/couchdb/issues/1218#issuecomment-419629095>, or mute the thread<https://github.com/notifications/unsubscribe-auth/AAK9AsoM-e95FEHBJsJjd73xCMWeHYNyks5uY5cSgaJpZM4Sll2O>.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419642623/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419807068","html_url":"https://github.com/apache/couchdb/issues/840#issuecomment-419807068","issue_url":"https://api.github.com/repos/apache/couchdb/issues/840","id":419807068,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTgwNzA2OA==","user":{"login":"diachedelic","id":310464,"node_id":"MDQ6VXNlcjMxMDQ2NA==","avatar_url":"https://avatars.githubusercontent.com/u/310464?v=4","gravatar_id":"","url":"https://api.github.com/users/diachedelic","html_url":"https://github.com/diachedelic","followers_url":"https://api.github.com/users/diachedelic/followers","following_url":"https://api.github.com/users/diachedelic/following{/other_user}","gists_url":"https://api.github.com/users/diachedelic/gists{/gist_id}","starred_url":"https://api.github.com/users/diachedelic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/diachedelic/subscriptions","organizations_url":"https://api.github.com/users/diachedelic/orgs","repos_url":"https://api.github.com/users/diachedelic/repos","events_url":"https://api.github.com/users/diachedelic/events{/privacy}","received_events_url":"https://api.github.com/users/diachedelic/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-10T06:51:29Z","updated_at":"2018-09-10T11:09:49Z","author_association":"NONE","body":"Upon upgrading to MacOS High Sierra, CouchDB fails to start.  For legacy reasons I need to to run v1.6.0 (we use a [deprecated river](https://github.com/elastic/elasticsearch-river-couchdb) to sync with ElasticSearch).  Following @wohali 's suggestion, I patched and [rebuilt Erlang](http://erlang.org/documentation/doc-5.10.2/doc/installation_guide/INSTALL.html), then modified `couchdbx-core/bin/erl` to point to the new binaries.  However, I still get the exact same error as before:\r\n\r\n```\r\nSegmentation fault: 11\r\n```\r\n\r\nCould it be I also need to rebuild CouchDB's Erlang libs using that patch?\r\n\r\nEdit:\r\n\r\nI think my issue was that in `bin/erl` I was modifying `BINDIR` but not `ROOTDIR`.  I installed `R16B01` using [kerl](https://github.com/kerl/kerl), and now Couch is running happily.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419807068/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419879529","html_url":"https://github.com/apache/couchdb/pull/1551#issuecomment-419879529","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1551","id":419879529,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTg3OTUyOQ==","user":{"login":"adrienverge","id":5244945,"node_id":"MDQ6VXNlcjUyNDQ5NDU=","avatar_url":"https://avatars.githubusercontent.com/u/5244945?v=4","gravatar_id":"","url":"https://api.github.com/users/adrienverge","html_url":"https://github.com/adrienverge","followers_url":"https://api.github.com/users/adrienverge/followers","following_url":"https://api.github.com/users/adrienverge/following{/other_user}","gists_url":"https://api.github.com/users/adrienverge/gists{/gist_id}","starred_url":"https://api.github.com/users/adrienverge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adrienverge/subscriptions","organizations_url":"https://api.github.com/users/adrienverge/orgs","repos_url":"https://api.github.com/users/adrienverge/repos","events_url":"https://api.github.com/users/adrienverge/events{/privacy}","received_events_url":"https://api.github.com/users/adrienverge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-10T11:21:13Z","updated_at":"2018-09-10T11:21:13Z","author_association":"CONTRIBUTOR","body":"Hi, I'm looking forward to seeing this on my servers (I can't upgrade to 2.2.0 because of #1550). Do you know the approximate date of the next release? Thanks in advance!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419879529/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419994959","html_url":"https://github.com/apache/couchdb/issues/1599#issuecomment-419994959","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1599","id":419994959,"node_id":"MDEyOklzc3VlQ29tbWVudDQxOTk5NDk1OQ==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-10T17:30:09Z","updated_at":"2018-09-10T17:30:09Z","author_association":"MEMBER","body":"No!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/419994959/reactions","total_count":15,"+1":0,"-1":11,"laugh":2,"hooray":0,"confused":2,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/420035242","html_url":"https://github.com/apache/couchdb/pull/1593#issuecomment-420035242","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1593","id":420035242,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMDAzNTI0Mg==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-10T19:41:17Z","updated_at":"2018-09-10T19:41:17Z","author_association":"MEMBER","body":"Here's a quick stab at a deadline implementation:\r\n\r\nhttps://github.com/apache/couchdb/commit/d2bf663482168036f408de39a74ed01ead472a9b","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/420035242/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/420211080","html_url":"https://github.com/apache/couchdb/issues/1595#issuecomment-420211080","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1595","id":420211080,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMDIxMTA4MA==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-11T09:35:31Z","updated_at":"2018-09-11T09:35:31Z","author_association":"CONTRIBUTOR","body":"I think we also should reconsider using complex erlang terms as values in the config. CouchDB users are not erlang developers and they are unfamiliar with its syntax.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/420211080/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/420247812","html_url":"https://github.com/apache/couchdb/issues/1373#issuecomment-420247812","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1373","id":420247812,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMDI0NzgxMg==","user":{"login":"mikerhodes","id":453210,"node_id":"MDQ6VXNlcjQ1MzIxMA==","avatar_url":"https://avatars.githubusercontent.com/u/453210?v=4","gravatar_id":"","url":"https://api.github.com/users/mikerhodes","html_url":"https://github.com/mikerhodes","followers_url":"https://api.github.com/users/mikerhodes/followers","following_url":"https://api.github.com/users/mikerhodes/following{/other_user}","gists_url":"https://api.github.com/users/mikerhodes/gists{/gist_id}","starred_url":"https://api.github.com/users/mikerhodes/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikerhodes/subscriptions","organizations_url":"https://api.github.com/users/mikerhodes/orgs","repos_url":"https://api.github.com/users/mikerhodes/repos","events_url":"https://api.github.com/users/mikerhodes/events{/privacy}","received_events_url":"https://api.github.com/users/mikerhodes/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-11T11:57:18Z","updated_at":"2018-09-11T11:57:18Z","author_association":"CONTRIBUTOR","body":"@iilyak  said:\r\n>> So \"action: compaction_start\" might be a useful one that these examples miss out.\r\n>\r\n> We definitely missed action field. How would you add it to API? Are you proposing to add into ExtraFields?\r\n\r\nYes, I'd have it in extra fields. Not all log messages need it. Make it convention rather than enforced.\r\n\r\n@eiri said:\r\n\r\n> I think an action field is a good idea with one caveat that without formal naming strategy it's fairly simple to get a lot of inconsistencies in there and have for example starting_compaction in one place and compaction_start in another. \r\n\r\nI can totally see this. I'd prefer to start with seeing if it's a problem in practice. Hopefully we are not starting the same process in many places ðŸ˜„ \r\n\r\n> I personally don't think that's the case, with a message log(\"Starting compaction for shard ~p on update sequence ~p\", [<<\"shard\">>, 12]) it would be helpful to have an ability to query by shard field, much less so for update_sequence field.\r\n\r\nThat's a really good point. Looking at other things I've used in the past, they do split up the idea of the format args for the message from the extra structured fields args. \r\n\r\nI think @iilyak's proposal takes that into account:\r\n\r\n```\r\ncouch_log:error(\"Compaction started for ~p\", [shard], #{\r\n     user => \"foo\", \r\n     shard => \"shards/...\"\r\n}).\r\n```\r\n\r\nI, at least, found this a very readable code stanza.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/420247812/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/420745387","html_url":"https://github.com/apache/couchdb/pull/1593#issuecomment-420745387","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1593","id":420745387,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMDc0NTM4Nw==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-12T18:10:46Z","updated_at":"2018-09-12T18:10:46Z","author_association":"MEMBER","body":"+1 to merge ignoring my deadline commit","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/420745387/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/420790043","html_url":"https://github.com/apache/couchdb/pull/1601#issuecomment-420790043","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1601","id":420790043,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMDc5MDA0Mw==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-12T20:41:05Z","updated_at":"2018-09-12T20:41:05Z","author_association":"CONTRIBUTOR","body":"Reusing +1 from previous review of the same change https://github.com/apache/couchdb-couch/pull/215#issuecomment-263934828","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/420790043/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421311043","html_url":"https://github.com/apache/couchdb/pull/1602#issuecomment-421311043","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1602","id":421311043,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTMxMTA0Mw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-14T10:24:41Z","updated_at":"2018-11-09T10:44:44Z","author_association":"MEMBER","body":"Depends on: https://github.com/apache/couchdb-config/pull/20\r\nDocs PR: https://github.com/apache/couchdb-documentation/pull/328","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421311043/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421339669","html_url":"https://github.com/apache/couchdb/pull/1602#issuecomment-421339669","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1602","id":421339669,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTMzOTY2OQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-14T12:12:32Z","updated_at":"2018-09-14T12:12:32Z","author_association":"MEMBER","body":"Iâ€™m working through the test fails, but this is worth reviewing already.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421339669/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421404856","html_url":"https://github.com/apache/couchdb/pull/1602#issuecomment-421404856","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1602","id":421404856,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTQwNDg1Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-14T16:01:07Z","updated_at":"2018-09-14T16:01:07Z","author_association":"MEMBER","body":"So far, the `couchdb.cmd` file looks good, but I haven't run a full test yet. Waiting until the test suite is cleaned up.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421404856/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421553807","html_url":"https://github.com/apache/couchdb/pull/1602#issuecomment-421553807","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1602","id":421553807,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTU1MzgwNw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-15T11:19:09Z","updated_at":"2018-09-15T11:19:09Z","author_association":"MEMBER","body":"Latest push also removes `couch_httpd_proxy` and `os_daemons` completely","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421553807/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421652363","html_url":"https://github.com/apache/couchdb/pull/1602#issuecomment-421652363","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1602","id":421652363,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTY1MjM2Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-15T23:19:29Z","updated_at":"2018-09-15T23:20:39Z","author_association":"MEMBER","body":"Question: on the `COUCHDB_QUERY_SERVER_lang` syntax, what happens when `lang` is `erlang`? Does this conflict with `[native_query_servers] enable_erlang_query_server = true` ?\r\n\r\nOr `query` for Mango - same question?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421652363/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421714081","html_url":"https://github.com/apache/couchdb/issues/1600#issuecomment-421714081","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1600","id":421714081,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTcxNDA4MQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-16T07:16:02Z","updated_at":"2018-09-16T07:16:02Z","author_association":"CONTRIBUTOR","body":"Interesting find, @flimzy \r\n\r\nI have seen this error before as well. But don't have a good explanation for it yet. I wonder how it correlates with Erlang versions. For example, have you seen it on some Erlang versions (20.0) happen more than on others ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421714081/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421746021","html_url":"https://github.com/apache/couchdb/issues/1600#issuecomment-421746021","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1600","id":421746021,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTc0NjAyMQ==","user":{"login":"flimzy","id":8555063,"node_id":"MDQ6VXNlcjg1NTUwNjM=","avatar_url":"https://avatars.githubusercontent.com/u/8555063?v=4","gravatar_id":"","url":"https://api.github.com/users/flimzy","html_url":"https://github.com/flimzy","followers_url":"https://api.github.com/users/flimzy/followers","following_url":"https://api.github.com/users/flimzy/following{/other_user}","gists_url":"https://api.github.com/users/flimzy/gists{/gist_id}","starred_url":"https://api.github.com/users/flimzy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flimzy/subscriptions","organizations_url":"https://api.github.com/users/flimzy/orgs","repos_url":"https://api.github.com/users/flimzy/repos","events_url":"https://api.github.com/users/flimzy/events{/privacy}","received_events_url":"https://api.github.com/users/flimzy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-16T11:04:15Z","updated_at":"2018-09-16T11:04:15Z","author_association":"MEMBER","body":"I've been testing against the official Docker images for CouchDB 1.7.1 through 2.2.0, which corresponds with Erlang OTP/17 through Erlang OTP/19, respectively.  I have seen the error on every version, and have not noticed a higher occurrence on any specific version, but I also likely would not have noticed if one version happened more than the other, since a single failure will cause my test suite to report a failure.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421746021/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421817349","html_url":"https://github.com/apache/couchdb/pull/1602#issuecomment-421817349","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1602","id":421817349,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTgxNzM0OQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-16T19:24:20Z","updated_at":"2018-09-16T19:24:20Z","author_association":"MEMBER","body":"@wohali good catch, if someone were to do that, itâ€™d override the internal ones. I think thatâ€™s still okay, if someone wanted to write a mango engine in, say, Python. We could forbid the configuring of those two specifically, but itâ€™d be introducing quite fiddly code for not much benefit IMHO. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421817349/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421817369","html_url":"https://github.com/apache/couchdb/pull/1602#issuecomment-421817369","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1602","id":421817369,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTgxNzM2OQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-16T19:24:29Z","updated_at":"2018-09-16T19:24:29Z","author_association":"MEMBER","body":"This is good to review now","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421817369/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421988917","html_url":"https://github.com/apache/couchdb/pull/1602#issuecomment-421988917","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1602","id":421988917,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTk4ODkxNw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-17T12:10:28Z","updated_at":"2018-09-17T12:10:28Z","author_association":"MEMBER","body":"I'm +1 on removing runtime configurability but would prefer that the configuration is expressed in the .app files of the respective erlang applications. This will allow package maintainers (etc) to more easily tweak at build time if necessary without introducing the runtime malleability that concerns us.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421988917/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421993464","html_url":"https://github.com/apache/couchdb/pull/1602#issuecomment-421993464","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1602","id":421993464,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMTk5MzQ2NA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-17T12:24:38Z","updated_at":"2018-09-17T12:24:38Z","author_association":"MEMBER","body":"@rnewson Iâ€™m happy to add query server defaults to the .app file for your use-case. I *also* want to retain the possibility for folks who run binary builds to add their third party query servers via env vars.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/421993464/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422001312","html_url":"https://github.com/apache/couchdb/pull/1602#issuecomment-422001312","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1602","id":422001312,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjAwMTMxMg==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-17T12:48:26Z","updated_at":"2018-09-17T12:49:22Z","author_association":"MEMBER","body":"    {application,appname, [\r\n     {description, \"blah\"},\r\n     {vsn, git},\r\n     {registered,[]},\r\n     {applications,[kernel,stdlib,config,couch_stats]},\r\n     {mod,{appname_app,[]}},\r\n     {env, [\r\n         {httpd_global_handlers, [\r\n             {_all_dbs, couch_httpd_misc_handlers, handle_all_dbs_req},\r\n             ...},\r\n         ...\r\n       ]}\r\n    ]}. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422001312/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422013135","html_url":"https://github.com/apache/couchdb/issues/1378#issuecomment-422013135","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1378","id":422013135,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjAxMzEzNQ==","user":{"login":"LastStarDust","id":8758474,"node_id":"MDQ6VXNlcjg3NTg0NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/8758474?v=4","gravatar_id":"","url":"https://api.github.com/users/LastStarDust","html_url":"https://github.com/LastStarDust","followers_url":"https://api.github.com/users/LastStarDust/followers","following_url":"https://api.github.com/users/LastStarDust/following{/other_user}","gists_url":"https://api.github.com/users/LastStarDust/gists{/gist_id}","starred_url":"https://api.github.com/users/LastStarDust/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LastStarDust/subscriptions","organizations_url":"https://api.github.com/users/LastStarDust/orgs","repos_url":"https://api.github.com/users/LastStarDust/repos","events_url":"https://api.github.com/users/LastStarDust/events{/privacy}","received_events_url":"https://api.github.com/users/LastStarDust/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-17T13:21:02Z","updated_at":"2018-09-17T13:24:15Z","author_association":"NONE","body":"Hello! I am experiencing the same problem on a single-node configuration of CouchDB (not clustered).\r\nI am not using CouchDB directly but only through another application called [Pyrame](http://llr.in2p3.fr/sites/pyrame/documentation/_modules/cmd_rundb.html#del_acq_rundb).\r\nIn the link, you can look at the portion of code that throws the error. In turn, this application makes use of the `purge` function offered by the [couchdb-python](https://github.com/djc/couchdb-python) package.\r\nI am a physicists and not a server administrator so my knowledge of the inner working of CouchDB is very limited. I read from above that there is a workaround but I cannot understand how to use it.\r\nCould you please explain to me how to modify the Pyrame or couchdb-python code to make use of the workaround? I know that it is not strictly \"your job\" to do so and apologize for the strange request.\r\nI am using CouchDB 2.2.0~bionic  and Ubuntu 18.04. CouchDB was installed from the repositories.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422013135/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422020455","html_url":"https://github.com/apache/couchdb/issues/1378#issuecomment-422020455","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1378","id":422020455,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjAyMDQ1NQ==","user":{"login":"jiangphcn","id":18000622,"node_id":"MDQ6VXNlcjE4MDAwNjIy","avatar_url":"https://avatars.githubusercontent.com/u/18000622?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangphcn","html_url":"https://github.com/jiangphcn","followers_url":"https://api.github.com/users/jiangphcn/followers","following_url":"https://api.github.com/users/jiangphcn/following{/other_user}","gists_url":"https://api.github.com/users/jiangphcn/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangphcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangphcn/subscriptions","organizations_url":"https://api.github.com/users/jiangphcn/orgs","repos_url":"https://api.github.com/users/jiangphcn/repos","events_url":"https://api.github.com/users/jiangphcn/events{/privacy}","received_events_url":"https://api.github.com/users/jiangphcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-17T13:40:19Z","updated_at":"2018-09-17T13:40:19Z","author_association":"CONTRIBUTOR","body":"@LastStarDust Clustered purge is not in CouchDB 2.2, but was just merged to CouchDB master branch. You can see more information about this new feature from https://github.com/apache/couchdb-documentation/pull/285/files.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422020455/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422050434","html_url":"https://github.com/apache/couchdb/issues/1378#issuecomment-422050434","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1378","id":422050434,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjA1MDQzNA==","user":{"login":"LastStarDust","id":8758474,"node_id":"MDQ6VXNlcjg3NTg0NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/8758474?v=4","gravatar_id":"","url":"https://api.github.com/users/LastStarDust","html_url":"https://github.com/LastStarDust","followers_url":"https://api.github.com/users/LastStarDust/followers","following_url":"https://api.github.com/users/LastStarDust/following{/other_user}","gists_url":"https://api.github.com/users/LastStarDust/gists{/gist_id}","starred_url":"https://api.github.com/users/LastStarDust/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LastStarDust/subscriptions","organizations_url":"https://api.github.com/users/LastStarDust/orgs","repos_url":"https://api.github.com/users/LastStarDust/repos","events_url":"https://api.github.com/users/LastStarDust/events{/privacy}","received_events_url":"https://api.github.com/users/LastStarDust/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-17T14:57:27Z","updated_at":"2018-09-17T14:57:27Z","author_association":"NONE","body":"@jiangphcn Thank you for the hint. Anyway I am using a single-node configuration and I am getting the same error. I tried to compile from source the master branch but I got stuck because of other errors. If possible I would like to stick using the repository version of couchdb.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422050434/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422066423","html_url":"https://github.com/apache/couchdb/issues/1378#issuecomment-422066423","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1378","id":422066423,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjA2NjQyMw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-17T15:40:19Z","updated_at":"2018-09-17T15:40:30Z","author_association":"MEMBER","body":"@LastStarDust The next released version of CouchDB will include purge functionality. Or, you can go back to CouchDB 1.x.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422066423/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422075300","html_url":"https://github.com/apache/couchdb/pull/1602#issuecomment-422075300","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1602","id":422075300,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjA3NTMwMA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-17T16:06:38Z","updated_at":"2018-09-17T16:06:38Z","author_association":"MEMBER","body":"also noting that changing couchjs stack size is an important ability.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422075300/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422075745","html_url":"https://github.com/apache/couchdb/pull/1602#issuecomment-422075745","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1602","id":422075745,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjA3NTc0NQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-17T16:08:03Z","updated_at":"2018-09-17T16:08:03Z","author_association":"MEMBER","body":"> also noting that changing couchjs stack size is an important ability.\r\n\r\ndef agree! we could introduce `[query_server_config] js_stack_size` (and other options) param, and have it apply to new instances spawned after a config change.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422075745/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422188351","html_url":"https://github.com/apache/couchdb/pull/1602#issuecomment-422188351","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1602","id":422188351,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjE4ODM1MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-17T22:09:51Z","updated_at":"2018-09-17T22:09:51Z","author_association":"MEMBER","body":"+1 on the env var approach vs. app files - this makes modification in e.g. Docker containers very straightforward, as well as systemd unit files / init files. \"Why not both\" is totally fine for me :)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422188351/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422193330","html_url":"https://github.com/apache/couchdb/issues/1604#issuecomment-422193330","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1604","id":422193330,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjE5MzMzMA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-17T22:31:45Z","updated_at":"2018-09-17T22:31:45Z","author_association":"MEMBER","body":"Confirmed, this is a concern. We need to manually grab the _security object and replicate it over.\r\n\r\nThe problem is that if your _users database doesn't have the same content, the security settings may prevent appropriate access to the database for non-server-admins.\r\n\r\nWould you be OK if this was optional functionality enabled with a command line flag?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422193330/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422194411","html_url":"https://github.com/apache/couchdb/issues/1378#issuecomment-422194411","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1378","id":422194411,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjE5NDQxMQ==","user":{"login":"LastStarDust","id":8758474,"node_id":"MDQ6VXNlcjg3NTg0NzQ=","avatar_url":"https://avatars.githubusercontent.com/u/8758474?v=4","gravatar_id":"","url":"https://api.github.com/users/LastStarDust","html_url":"https://github.com/LastStarDust","followers_url":"https://api.github.com/users/LastStarDust/followers","following_url":"https://api.github.com/users/LastStarDust/following{/other_user}","gists_url":"https://api.github.com/users/LastStarDust/gists{/gist_id}","starred_url":"https://api.github.com/users/LastStarDust/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/LastStarDust/subscriptions","organizations_url":"https://api.github.com/users/LastStarDust/orgs","repos_url":"https://api.github.com/users/LastStarDust/repos","events_url":"https://api.github.com/users/LastStarDust/events{/privacy}","received_events_url":"https://api.github.com/users/LastStarDust/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-17T22:36:51Z","updated_at":"2018-09-17T22:36:51Z","author_association":"NONE","body":"Ok clear! I will downgrade to \r\n1.x for the time being.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422194411/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422413062","html_url":"https://github.com/apache/couchdb/pull/1605#issuecomment-422413062","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1605","id":422413062,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjQxMzA2Mg==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-18T14:21:21Z","updated_at":"2018-09-18T14:21:21Z","author_association":"MEMBER","body":"The majority of tests for partitions are currently here https://github.com/cloudant/partition_tests\r\nI wanted to write the tests in elixir so I've kept them in a separate repo until the elixir branch is merged in. Once that is merged in I can move the partition tests into the CouchDB repo","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422413062/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422421466","html_url":"https://github.com/apache/couchdb/pull/1605#issuecomment-422421466","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1605","id":422421466,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjQyMTQ2Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-18T14:41:41Z","updated_at":"2018-09-18T14:41:41Z","author_association":"MEMBER","body":"@garrensmith would you consider merging the tests into our elixir branch?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422421466/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422429939","html_url":"https://github.com/apache/couchdb/pull/1605#issuecomment-422429939","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1605","id":422429939,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjQyOTkzOQ==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-18T15:02:12Z","updated_at":"2018-09-18T15:02:12Z","author_association":"MEMBER","body":"@wohali sure I can do that once this PR is a little further down the line\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422429939/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422438217","html_url":"https://github.com/apache/couchdb/issues/1606#issuecomment-422438217","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1606","id":422438217,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjQzODIxNw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-18T15:23:47Z","updated_at":"2018-09-18T15:23:47Z","author_association":"MEMBER","body":"@anilbhanushali are Mango selectors an option for you instead? I know this doesn't solve the root cause, but it might be a workaround.\r\n\r\nAlso, does the same issue persist in 2.2.0?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422438217/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422501948","html_url":"https://github.com/apache/couchdb/issues/1606#issuecomment-422501948","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1606","id":422501948,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjUwMTk0OA==","user":{"login":"anilbhanushali","id":7549804,"node_id":"MDQ6VXNlcjc1NDk4MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/7549804?v=4","gravatar_id":"","url":"https://api.github.com/users/anilbhanushali","html_url":"https://github.com/anilbhanushali","followers_url":"https://api.github.com/users/anilbhanushali/followers","following_url":"https://api.github.com/users/anilbhanushali/following{/other_user}","gists_url":"https://api.github.com/users/anilbhanushali/gists{/gist_id}","starred_url":"https://api.github.com/users/anilbhanushali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anilbhanushali/subscriptions","organizations_url":"https://api.github.com/users/anilbhanushali/orgs","repos_url":"https://api.github.com/users/anilbhanushali/repos","events_url":"https://api.github.com/users/anilbhanushali/events{/privacy}","received_events_url":"https://api.github.com/users/anilbhanushali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-18T18:37:23Z","updated_at":"2018-09-18T18:37:23Z","author_association":"NONE","body":"@wohali yes, using selector is a workaround but as you said it's not a proper solution. \r\nThis issue is also persistant in 2.2.0","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422501948/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422725500","html_url":"https://github.com/apache/couchdb/pull/1551#issuecomment-422725500","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1551","id":422725500,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjcyNTUwMA==","user":{"login":"H--o-l","id":10905922,"node_id":"MDQ6VXNlcjEwOTA1OTIy","avatar_url":"https://avatars.githubusercontent.com/u/10905922?v=4","gravatar_id":"","url":"https://api.github.com/users/H--o-l","html_url":"https://github.com/H--o-l","followers_url":"https://api.github.com/users/H--o-l/followers","following_url":"https://api.github.com/users/H--o-l/following{/other_user}","gists_url":"https://api.github.com/users/H--o-l/gists{/gist_id}","starred_url":"https://api.github.com/users/H--o-l/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/H--o-l/subscriptions","organizations_url":"https://api.github.com/users/H--o-l/orgs","repos_url":"https://api.github.com/users/H--o-l/repos","events_url":"https://api.github.com/users/H--o-l/events{/privacy}","received_events_url":"https://api.github.com/users/H--o-l/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-19T09:25:44Z","updated_at":"2018-09-19T09:25:44Z","author_association":"NONE","body":"Hi !\r\nSame remark as @adrienverge , we are stuck in version 2.1.2 due to issue #1550.\r\nWe would love to update but we need this fix in order to.\r\nDo you know when a version 2.2.1 could be expected ?\r\n\r\nThanks in advance !","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422725500/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422799520","html_url":"https://github.com/apache/couchdb/issues/1254#issuecomment-422799520","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1254","id":422799520,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjc5OTUyMA==","user":{"login":"glynnbird","id":697925,"node_id":"MDQ6VXNlcjY5NzkyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/697925?v=4","gravatar_id":"","url":"https://api.github.com/users/glynnbird","html_url":"https://github.com/glynnbird","followers_url":"https://api.github.com/users/glynnbird/followers","following_url":"https://api.github.com/users/glynnbird/following{/other_user}","gists_url":"https://api.github.com/users/glynnbird/gists{/gist_id}","starred_url":"https://api.github.com/users/glynnbird/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/glynnbird/subscriptions","organizations_url":"https://api.github.com/users/glynnbird/orgs","repos_url":"https://api.github.com/users/glynnbird/repos","events_url":"https://api.github.com/users/glynnbird/events{/privacy}","received_events_url":"https://api.github.com/users/glynnbird/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-19T13:17:29Z","updated_at":"2018-09-19T13:17:29Z","author_association":"CONTRIBUTOR","body":"I was asked by @willholley to contribute this Markdown which describes a possible `aggregator` syntax for supporting aggregations in Mango. \r\n\r\n--------\r\n\r\n# What would Mango aggregation look like?\r\n\r\n\r\nAt the moment, the Mango query language only performs data selection - a portion of a larger data set can be returned by providing a JSON query. If my data looks like this:\r\n\r\n```js\r\n{\r\n  _id: \"someid\",\r\n  date: \"2018-08-24\",\r\n  status: \"provisional\",\r\n  invoiceAddress: {\r\n    street: \"10 Front Street\",\r\n    city: \"Dallas\",\r\n    state: \"Texas\"\r\n  },\r\n  amount: 7.99,\r\n  tax: 0,\r\n  totalAmount: 7.99,\r\n  customerId: \"A65522\",\r\n  lineItems: [\r\n    {\r\n      productId: \"P1\",\r\n      name: \"fish\",\r\n      cost: 6.0\r\n    },\r\n     {\r\n      productId: \"P2\",\r\n      name: \"chips\",\r\n      cost: 1.99\r\n    }\r\n  ]\r\n}\r\n```  \r\n\r\nand I want only the \"complete\" orders from a database I could perform a query.\r\n\r\n```js\r\n{\r\n  selector: {\r\n     status : \"complete\"\r\n  },\r\n  fields: [\"totalAmount\", \"date\"]\r\n}\r\n```\r\n\r\nwhich would give a paged result set in blocks of 200 records:\r\n\r\n```js\r\n{\r\n\t\"docs\": [\r\n\t  {\r\n\t    \"totalAmount\": 7.99,\r\n\t    \"date\": \"2018-08-24\"\r\n          },\r\n\t  {\r\n\t    \"totalAmount\": 4.50,\r\n\t    \"date\": \"2018-08-24\"\r\n          },\r\n\t  ...\r\n\t],\r\n\t\"bookmark\": \"g1AAAAA6eJzLYWBgYMpgSmHgKy5JLCrJTq2MT8lPzkzJBYqzVqUmFSWCJDlgkgjhLADXERDn\",\r\n\t\"execution_stats\": {\r\n\t\t\"total_keys_examined\": 0,\r\n\t\t\"total_docs_examined\": 10,\r\n\t\t\"total_quorum_docs_examined\": 0,\r\n\t\t\"results_returned\": 8,\r\n\t\t\"execution_time_ms\": 2.75\r\n\t},\r\n\t\"warning\": \"no matching index found, create an index to optimize query time\"\r\n}\r\n```\r\n\r\nBut what I really want is a grand total of the `totalAmount` fields, grouped by `date` but Mango only supports *selection* not *aggregation*. I would have to page through all the results and perform the aggregation in my code.\r\n\r\nThis document imagines that Mango magically *does* support aggregation. Everything that follows is fictional syntax in my imaginary world.\r\n\r\n--- start of imaginary world ---\r\n\r\n## My first Mango aggregation\r\n\r\nI can use the new \"aggregator\" object in a Mango query. My query still has a selector, because I don't want to aggregate ALL the documents, only the \"complete\" orders as before:\r\n\r\n```js\r\n{\r\n  selector: {\r\n    status : \"complete\"\r\n  },\r\n  aggregator: {\r\n    operation: \"sum\",\r\n    of: [\"totalAmount\"]\r\n  }\r\n}\r\n```\r\n\r\nNote:\r\n\r\n- I no longer need to supply a `fields` object at the top level. Mango knows the fields it needs from those specified in the aggregator object.\r\n- the `aggregator.operation` field can be one of `sum`, `count` or `stats`.\r\n- `aggregator.of` is an array - we'll see how this works later.\r\n\r\nIf I'm using the `count` aggregation, I needn't supplied an `aggregation.of` array:\r\n\r\n```js\r\n{\r\n  selector: {\r\n    status : \"complete\"\r\n  },\r\n  aggregator: {\r\n    operation: \"count\"\r\n  }\r\n}\r\n```\r\n\r\n## A grand total example\r\n\r\nUsing an `aggreator.operation` of `sum` allows me to get a grand total of a field:\r\n\r\n```\r\n{\r\n  selector: {\r\n    status : \"complete\"\r\n  },\r\n  aggregator: {\r\n    operation: \"sum\",\r\n    of: [\"totalAmount\"]\r\n  }\r\n}\r\n```\r\n\r\nor fields:\r\n\r\n```\r\n{\r\n  selector: {\r\n    status : \"complete\"\r\n  },\r\n  aggregator: {\r\n    operation: \"sum\",\r\n    of: [\"totalAmount\", \"tax\"]\r\n  }\r\n}\r\n```\r\n\r\nor by emptying the \"selector\", all documents are aggregated:\r\n\r\n```\r\n{\r\n  selector: { },\r\n  aggregator: {\r\n    operation: \"sum\",\r\n    of: [\"totalAmount\", \"tax\"]\r\n  }\r\n}\r\n```\r\n\r\n## Grouping\r\n\r\nIn this example I am performing a more complex selector and introduce grouping:\r\n\r\n```\r\n{\r\n  selector: {\r\n    \"$or\": {\r\n      status : \"complete\",\r\n      status: \"refunded\"\r\n    }\r\n  },\r\n  aggregator: {\r\n    operation: \"sum\",\r\n    of: [\"totalAmount\", \"tax\"],\r\n    group: [\"date\"]\r\n  }\r\n}\r\n```\r\n\r\nAny valid Mango selector is allowed in the \"selector\" object. The \"selector\" is evaluated at index time and decides which portion of the data makes it to the index. If the selector is changed, a new index is required to calculate the result.\r\n\r\nThe optional \"aggregator.group\" is an array of keys by which the sum is grouped in the result set. It is an array, so I can have multi-dimensional grouping:\r\n\r\n\r\n```\r\n{\r\n  selector: {\r\n    \"$or\": {\r\n      status : \"complete\",\r\n      status: \"refunded\"\r\n    }\r\n  },\r\n  aggregator: {\r\n    operation: \"sum\",\r\n    of: [\"totalAmount\", \"tax\"],\r\n    group: [\"date\", \"invoiceAddress.state\"]\r\n  }\r\n}\r\n```\r\n\r\nThe above example groups by \"invoiceAddress.state\" which demonstrates selecting data from a sub-object.\r\n\r\n\r\n## How this works\r\n\r\nCouchDB cannot perform aggregations without an index, but instead of insisting that the user perform an additional \"index\" step, CouchDB will create the appropriate index (if it doesn't already exist) and return the results once indexing is complete.\r\n\r\n** this is a big leap - but, hey, this is an imaginary world **\r\n\r\ne.g. for an aggregation query like this:\r\n\r\n```\r\n{\r\n  selector: {\r\n    status : \"complete\"\r\n  },\r\n  aggregator: {\r\n    operation: \"sum\",\r\n    of: [\"totalAmount\"],\r\n    group: [\"date\"]\r\n  }\r\n}\r\n```\r\n\r\nwe need an index that looks like this in old-school JavaScript MapReduce\r\n\r\n```js\r\nmap: \r\n\tfunction(doc) {\r\n\t  if (doc.status === 'complete') {\r\n\t    emit([doc.date], [doc.amount])\r\n\t  }\r\n\t}\r\nreduce:\r\n   \"_sum\"\r\n```\r\n\r\nThe \"selector\" in an aggregation is really a `partial_filter_selector` so that the index only contains a sub-set of the documents.\r\n\r\n## Limit the result set with range\r\n\r\nThe trouble with this approach is that the aggregation query always returns all of the aggregations e.g. if one sum per day for every day that you have data. You may only want this month's per-day aggregates. This is where `aggregator.range` comes in:\r\n\r\n```\r\n{\r\n  selector: {\r\n    \"$or\": {\r\n      status : \"complete\",\r\n      status: \"refunded\"\r\n    }\r\n  },\r\n  aggregator: {\r\n    operation: \"sum\",\r\n    of: [\"totalAmount\", \"tax\"],\r\n    group: [\"date\", \"invoiceAddress.state\"],\r\n    range: {\r\n      start: [\"2018-08-01\"],\r\n      end: [\"2018-09-01\"]\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nThe `aggregator.range` object can be used at query time to return a smaller proportion of the aggregated result, whether grouping or not.\r\n\r\n---- end of imaginary world ---","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422799520/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422843552","html_url":"https://github.com/apache/couchdb/pull/1551#issuecomment-422843552","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1551","id":422843552,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjg0MzU1Mg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-19T15:18:06Z","updated_at":"2018-09-19T15:18:06Z","author_association":"MEMBER","body":"2.3.0 is being planned for release now. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422843552/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422922449","html_url":"https://github.com/apache/couchdb/issues/718#issuecomment-422922449","issue_url":"https://api.github.com/repos/apache/couchdb/issues/718","id":422922449,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjkyMjQ0OQ==","user":{"login":"Richard-O-Wood","id":43390481,"node_id":"MDQ6VXNlcjQzMzkwNDgx","avatar_url":"https://avatars.githubusercontent.com/u/43390481?v=4","gravatar_id":"","url":"https://api.github.com/users/Richard-O-Wood","html_url":"https://github.com/Richard-O-Wood","followers_url":"https://api.github.com/users/Richard-O-Wood/followers","following_url":"https://api.github.com/users/Richard-O-Wood/following{/other_user}","gists_url":"https://api.github.com/users/Richard-O-Wood/gists{/gist_id}","starred_url":"https://api.github.com/users/Richard-O-Wood/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Richard-O-Wood/subscriptions","organizations_url":"https://api.github.com/users/Richard-O-Wood/orgs","repos_url":"https://api.github.com/users/Richard-O-Wood/repos","events_url":"https://api.github.com/users/Richard-O-Wood/events{/privacy}","received_events_url":"https://api.github.com/users/Richard-O-Wood/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-19T19:06:16Z","updated_at":"2018-09-19T19:06:16Z","author_association":"NONE","body":"I was having a very similar problem until earlier this morning. \r\nI am running V2.1.0 on Windows Server 2012 R2\r\nI am using a WSSO_Proxy server for authentication.\r\nHowever, I do have an OpenSSL certificate and CA installed and referenced in my local.ini\r\n\r\nMy Fauxton Databases page was working fine on HTTP (port 5984) but on HTTPS (port 6984) I was getting shards instead of my databases.  I read through the explanations from @wohali above, and tried a number of different combinations.  Finally got a local.ini file that would work.  I thought I would share my file for reference.  I changed a few things in the attached file for obfuscation purposes like the IP address company name in the URL and some characters in the hash values.  \r\n\r\nHopefully this will help someone else.\r\nAlso, if anyone spots something \"wrong\" in my local.ini, please let me know.\r\n\r\n[local.ini](https://github.com/apache/couchdb/files/2398383/local_ini.txt) \r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422922449/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422994860","html_url":"https://github.com/apache/couchdb/issues/1611#issuecomment-422994860","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1611","id":422994860,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMjk5NDg2MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-19T23:52:51Z","updated_at":"2018-09-19T23:52:51Z","author_association":"MEMBER","body":"@arifcse019 Can you provide a minimal example for us with a script that uses cURL? I've personally performed the steps you mention above (1-4) many times and have never run across this.\r\n\r\nWhat technique are you using to move the shards? There is newly updated documentation on the approved approach online, can you follow that?\r\n\r\nhttp://docs.couchdb.org/en/stable/cluster/sharding.html","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/422994860/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423034534","html_url":"https://github.com/apache/couchdb/pull/1605#issuecomment-423034534","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1605","id":423034534,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzAzNDUzNA==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-20T04:14:01Z","updated_at":"2018-09-20T04:14:01Z","author_association":"CONTRIBUTOR","body":"@garrensmith I notice that the tests in https://github.com/cloudant/partition_tests/tree/master/test don't have a common prefix, which although fine for now, I think will become less cohesive once they are merged with the main elixir suite. Would you consider renaming them so they all start with `partition_`?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423034534/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423123650","html_url":"https://github.com/apache/couchdb/issues/1603#issuecomment-423123650","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1603","id":423123650,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzEyMzY1MA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-20T10:04:10Z","updated_at":"2018-09-20T10:04:10Z","author_association":"MEMBER","body":"I think this is a docs error, since _design_docs with a namespace isnâ€™t handled any special in the `_all_docs` code path, only `_local` docs are. See https://github.com/apache/couchdb/blob/master/src/fabric/src/fabric_view_all_docs.erl#L85-L92 and https://github.com/apache/couchdb/blob/master/src/fabric/src/fabric_view_all_docs.erl#L99-L105\r\n\r\nIâ€™d like corroboration on this one tho: cc @eiri @nickva.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423123650/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423123976","html_url":"https://github.com/apache/couchdb/issues/1604#issuecomment-423123976","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1604","id":423123976,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzEyMzk3Ng==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-20T10:05:07Z","updated_at":"2018-09-20T10:05:07Z","author_association":"MEMBER","body":"@wohali Iâ€™d make it opt-out for folks who run into that. I think the default should be â€œmake exactly the same as sourceâ€","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423123976/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423124229","html_url":"https://github.com/apache/couchdb/pull/1272#issuecomment-423124229","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1272","id":423124229,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzEyNDIyOQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-20T10:05:58Z","updated_at":"2018-09-20T10:05:58Z","author_association":"MEMBER","body":"@rnewson do you wanna bring this feature forward? Iâ€™m asking for a 2.3.0 milestone :)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423124229/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423126764","html_url":"https://github.com/apache/couchdb/pull/1405#issuecomment-423126764","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1405","id":423126764,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzEyNjc2NA==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-20T10:12:49Z","updated_at":"2018-09-20T10:12:49Z","author_association":"MEMBER","body":"It looks like mochiweb now support 21, but they havenâ€™t made a release yet. Are we comfortable tagging their master in one of our releases? (Iâ€™m not really).\r\n\r\nDepending on how the other issues are going on the 2.3.0 milestone, this might mean we leave 21 support for 2.4.0 (which Iâ€™d be okay with).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423126764/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423132522","html_url":"https://github.com/apache/couchdb/pull/1406#issuecomment-423132522","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1406","id":423132522,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzEzMjUyMg==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-20T10:31:39Z","updated_at":"2018-09-20T10:31:39Z","author_association":"MEMBER","body":"Getting errors when running this, is there anything obvious Iâ€™m missing?\r\n\r\nI donâ€™t think it is related, but Iâ€™ve had to do a PATH hack to allow CouchDB to be built with Erlang 20 and Elixir to ru under Erlang 21 because Homebrew.\r\n\r\n```\r\n> elixir --erl -i\r\njan@rose (12:28:30) ~/Work/couchdb (elixir-suite) \r\n> make elixir\r\n[ * ] Setup environment ... ok\r\n[ * ] Ensure CouchDB is built ... ok\r\n[ * ] Prepare configuration files ... ok\r\n[ * ] Start node node1 ... ok\r\n[ * ] Start node node2 ... ok\r\n[ * ] Start node node3 ... ok\r\n[ * ] Check node at http://127.0.0.1:15984/ ... ok\r\n[ * ] Check node at http://127.0.0.1:25984/ ... ok\r\n[ * ] Check node at http://127.0.0.1:35984/ ... ok\r\n[ * ] Running cluster setup ... ok\r\n[ * ] Exec command test/elixir/run ... Resolving Hex dependencies...\r\nDependency resolution completed:\r\n  httpotion 3.0.3\r\n  ibrowse 4.4.0\r\n  jiffy 0.14.11\r\nAll dependencies up to date\r\n===> Compiling jiffy\r\nCompiling c_src/decoder.c\r\nCompiling c_src/encoder.c\r\nCompiling c_src/jiffy.c\r\nCompiling c_src/utf8.c\r\nCompiling c_src/util.c\r\nCompiling c_src/doubles.cc\r\nCompiling c_src/double-conversion/bignum-dtoa.cc\r\nCompiling c_src/double-conversion/bignum.cc\r\nCompiling c_src/double-conversion/cached-powers.cc\r\nCompiling c_src/double-conversion/diy-fp.cc\r\nCompiling c_src/double-conversion/double-conversion.cc\r\nCompiling c_src/double-conversion/fast-dtoa.cc\r\nCompiling c_src/double-conversion/fixed-dtoa.cc\r\nCompiling c_src/double-conversion/strtod.cc\r\n===> Compiling ibrowse\r\n==> httpotion\r\nCompiling 1 file (.ex)\r\nGenerated httpotion app\r\n==> foo\r\nCompiling 1 file (.ex)\r\nGenerated foo app\r\nwarning: found quoted keyword \"_id\" but the quotes are not required. Note that keywords are always atoms, even when quoted, and quotes should only be used to introduce keywords with foreign characters in them\r\n  test/test_helper.exs:178\r\n\r\nwarning: found quoted keyword \"bar\" but the quotes are not required. Note that keywords are always atoms, even when quoted, and quotes should only be used to introduce keywords with foreign characters in them\r\n  test/test_helper.exs:179\r\n\r\nExcluding tags: [pending: true]\r\n\r\n\r\n== Compilation error in file test/compact_test.exs ==\r\n** (CompileError) test/compact_test.exs:83: defp rev/2 already defined as def\r\n    test/compact_test.exs:83: (module)\r\n    (stdlib) erl_eval.erl:677: :erl_eval.do_apply/6\r\n    (elixir) lib/code.ex:767: Code.require_file/2\r\n    (elixir) lib/kernel/parallel_compiler.ex:209: anonymous fn/4 in Kernel.ParallelCompiler.spawn_workers/6\r\nmake: *** [elixir] Error 1\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423132522/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423170362","html_url":"https://github.com/apache/couchdb/issues/1254#issuecomment-423170362","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1254","id":423170362,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzE3MDM2Mg==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-20T12:48:08Z","updated_at":"2018-09-20T12:48:08Z","author_association":"MEMBER","body":"@glynnbird a really nice concept. This has some really great potential. Thanks for sharing.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423170362/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423223171","html_url":"https://github.com/apache/couchdb/pull/1405#issuecomment-423223171","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1405","id":423223171,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzIyMzE3MQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-20T15:18:26Z","updated_at":"2018-09-20T15:18:26Z","author_association":"CONTRIBUTOR","body":"There is an issue with the CI not passing with the 21 fixes:\r\n\r\nhttps://travis-ci.org/mochi/mochiweb/builds/407452186?utm_source=github_status&utm_medium=notification\r\n\r\nHaven't dug enough to discover the reason yet but it seems like the tuple_call flag wasn't propagated somehow to all the module. https://travis-ci.org/mochi/mochiweb/jobs/407452187#L522","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423223171/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423227153","html_url":"https://github.com/apache/couchdb/issues/1607#issuecomment-423227153","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1607","id":423227153,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzIyNzE1Mw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-20T15:28:50Z","updated_at":"2018-09-20T15:28:50Z","author_association":"CONTRIBUTOR","body":"Made a script to replicate the issue:\r\n\r\n```shell\r\n#!/bin/bash\r\n\r\nS=localhost:15984\r\nSA=adm:pass@${S}\r\nJSON=\"Content-Type: application/json\"\r\n\r\ncurl -s -XDELETE $SA/db > /dev/null\r\ncurl -s -XDELETE $SA/srcdb > /dev/null\r\ncurl -s -XDELETE $SA/_replicator > /dev/null\r\ncurl -s -XPUT $SA/db > /dev/null\r\ncurl -s -XPUT $SA/srcdb > /dev/null\r\n\r\necho \"Setting [couch_httpd_auth] timeout = 5\"\r\ncurl -s -XPUT adm:pass@localhost:15986/_config/couch_httpd_auth/timeout -d '\"5\"' > /dev/null\r\ncurl -s -XPUT adm:pass@localhost:25986/_config/couch_httpd_auth/timeout -d '\"5\"' > /dev/null\r\ncurl -s -XPUT adm:pass@localhost:35986/_config/couch_httpd_auth/timeout -d '\"5\"' > /dev/null\r\n\r\necho \"Adding VDU to target\"\r\ncat <<EOF > /tmp/vdu.json\r\n  {\r\n    \"_id\": \"_design/vdu\",\r\n    \"validate_doc_update\":\"function(newDoc, oldDoc, userCtx) { log(userCtx); if (newDoc.name != userCtx.name) { throw({'forbidden': 'VDU failed'}); } }\"\r\n  }\r\nEOF\r\ncurl -s -XPUT $SA/db/_design/vdu -H \"$JSON\" -T /tmp/vdu.json > /dev/null\r\n\r\necho \"Replicating from srcdb to db\"\r\ncurl -s XDELETE $SA/_replicate -H \"$JSON\" -d '{\"source\":\"http://adm:pass@localhost:15984/srcdb\", \"target\":\"http://adm:pass@localhost:15984/db\", \"worker_proceses\":1, \"continuous\":true}' > /dev/null\r\ncurl -s XPOST   $SA/_replicate -H \"$JSON\" -d '{\"source\":\"http://adm:pass@localhost:15984/srcdb\", \"target\":\"http://adm:pass@localhost:15984/db\", \"worker_proceses\":1, \"continuous\":true}' > /dev/null\r\n\r\nsleep 3\r\n\r\nDOCID=0\r\n\r\necho \"With frequent enough updates, session is getting refreshed\"\r\nwhile [ $DOCID -lt 2 ]; do\r\n    let DOCID++\r\n    echo \"\"\r\n    echo \"DocID: $DOCID\"\r\n    curl -s -XPUT $SA/srcdb/$DOCID -H \"$JSON\" -d '{\"name\":\"adm\"}' > /dev/null\r\n    echo \"Doc added to source, sleeping 2 seconds\"\r\n    sleep 2\r\n    echo \"Getting doc from target:\"\r\n    curl $SA/db/$DOCID\r\ndone\r\n\r\necho \"With long sleeps, sesssion will timeout and not get refreshed\"\r\nsleep 10\r\n\r\nwhile [ $DOCID -lt 10 ]; do\r\n    let DOCID++\r\n    echo \"\"\r\n    echo \"DocID: $DOCID\"\r\n    curl -s -XPUT $SA/srcdb/$DOCID -H \"$JSON\" -d '{\"name\":\"adm\"}' > /dev/null\r\n    echo \"Doc added to source, sleeping 7 seconds\"\r\n    sleep 7\r\n    echo \"Getting doc from target:\"\r\n    curl $SA/db/$DOCID\r\ndone\r\n\r\n```\r\n\r\nIt can be run against a default dev cluster:\r\n\r\n```\r\n$. /replicate_session_with_vdu_auth.sh\r\nSetting [couch_httpd_auth] timeout = 5\r\nAdding VDU to target\r\nReplicating from srcdb to db\r\nWith frequent enough updates, session is getting refreshed\r\n\r\nDocID: 1\r\nDoc added to source, sleeping 2 seconds\r\nGetting doc from target:\r\n{\"_id\":\"1\",\"_rev\":\"1-66e95cbbe626e928747ecc225341b2d6\",\"name\":\"adm\"}\r\n\r\nDocID: 2\r\nDoc added to source, sleeping 2 seconds\r\nGetting doc from target:\r\n{\"_id\":\"2\",\"_rev\":\"1-66e95cbbe626e928747ecc225341b2d6\",\"name\":\"adm\"}\r\nWith long sleeps, sesssion will timeout and not get refreshed\r\n\r\nDocID: 3\r\nDoc added to source, sleeping 7 seconds\r\nGetting doc from target:\r\n{\"error\":\"not_found\",\"reason\":\"missing\"}\r\n\r\nDocID: 4\r\nDoc added to source, sleeping 7 seconds\r\nGetting doc from target:\r\n{\"error\":\"not_found\",\"reason\":\"missing\"}\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423227153/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423229700","html_url":"https://github.com/apache/couchdb/issues/1607#issuecomment-423229700","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1607","id":423229700,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzIyOTcwMA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-20T15:36:03Z","updated_at":"2018-09-20T15:40:40Z","author_association":"CONTRIBUTOR","body":"An interesting observation is that a 403 HTTP response, which a `forbidden` could generate for individual docs will trigger a cookie refresh.\r\n\r\nHowever replicator, in the normal case would write documents using a `_bulk_docs`  endpoint and the result of that is `201` even though some documents in the batch failed with a `forbidden` error.\r\n\r\nIt is possible to trick the replicator to use single requests if attachments are used. Indeed, I had waited till the after the session expired and added a document with an attachment to the source:\r\n\r\n```\r\n curl -s -XPUT adm:pass@localhost:15984/srcdb/1/att1?rev=1-66e95cbbe626e928747ecc225341b2d6 -H 'Content-Type: application/octet-stream' -T 1mb\r\n{\"ok\":true,\"id\":\"1\",\"rev\":\"2-3dec55150ee06ac046419c71f00f5351\"}\r\n```\r\n\r\nThe script was running in the part with long sleep but as soon as the attachment was added, the session was refreshed and the a few writes succeeded:\r\n\r\n```\r\nDocID: 4\r\nDoc added to source, sleeping 7 seconds\r\nGetting doc from target:\r\n{\"error\":\"not_found\",\"reason\":\"missing\"}\r\n\r\nDocID: 5\r\nDoc added to source, sleeping 7 seconds\r\nGetting doc from target:\r\n{\"_id\":\"5\",\"_rev\":\"1-66e95cbbe626e928747ecc225341b2d6\",\"name\":\"adm\"}\r\n\r\nDocID: 6\r\nDoc added to source, sleeping 7 seconds\r\nGetting doc from target:\r\n{\"error\":\"not_found\",\"reason\":\"missing\"}\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423229700/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423235481","html_url":"https://github.com/apache/couchdb/issues/1611#issuecomment-423235481","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1611","id":423235481,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzIzNTQ4MQ==","user":{"login":"arifcse019","id":10591704,"node_id":"MDQ6VXNlcjEwNTkxNzA0","avatar_url":"https://avatars.githubusercontent.com/u/10591704?v=4","gravatar_id":"","url":"https://api.github.com/users/arifcse019","html_url":"https://github.com/arifcse019","followers_url":"https://api.github.com/users/arifcse019/followers","following_url":"https://api.github.com/users/arifcse019/following{/other_user}","gists_url":"https://api.github.com/users/arifcse019/gists{/gist_id}","starred_url":"https://api.github.com/users/arifcse019/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arifcse019/subscriptions","organizations_url":"https://api.github.com/users/arifcse019/orgs","repos_url":"https://api.github.com/users/arifcse019/repos","events_url":"https://api.github.com/users/arifcse019/events{/privacy}","received_events_url":"https://api.github.com/users/arifcse019/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-20T15:52:16Z","updated_at":"2018-09-20T16:02:01Z","author_association":"NONE","body":"@wohali I am using the following two ruby scripts to move shards: first to update cluster metadata to add the shards to the new node, second one to update cluster metadata to stop looking for those shards in the old one.\r\n\r\nhttps://gist.github.com/arifcse019/43a638e4ce837b029d62d59fd0b9a20f (move_shards_in.rb)\r\nhttps://gist.github.com/arifcse019/c8a7096275e16d344f6c53ad884716ea (move_shards_out.rb)\r\n\r\nAnd the steps are as I described in my issue. These two scripts are run as part of step 2\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423235481/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423255970","html_url":"https://github.com/apache/couchdb/issues/1610#issuecomment-423255970","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1610","id":423255970,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzI1NTk3MA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-20T16:53:56Z","updated_at":"2018-09-20T16:53:56Z","author_association":"CONTRIBUTOR","body":"It seems it's using RFC2109\r\n\r\nhttps://tools.ietf.org/html/rfc2109#section-10.1.2\r\n\r\n```\r\n10.1.2  Expires and Max-Age\r\n\r\n   Netscape's original proposal defined an Expires header that took a\r\n   date value in a fixed-length variant format in place of Max-Age:\r\n\r\n   Wdy, DD-Mon-YY HH:MM:SS GMT\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423255970/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423287022","html_url":"https://github.com/apache/couchdb/pull/1406#issuecomment-423287022","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1406","id":423287022,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzI4NzAyMg==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-20T18:30:43Z","updated_at":"2018-09-20T19:03:31Z","author_association":"CONTRIBUTOR","body":"@janl that compilation error is my bad, sorry! https://github.com/apache/couchdb/pull/1617 should fix it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423287022/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423413387","html_url":"https://github.com/apache/couchdb/pull/1609#issuecomment-423413387","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1609","id":423413387,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzQxMzM4Nw==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-21T04:57:30Z","updated_at":"2018-09-21T04:57:30Z","author_association":"CONTRIBUTOR","body":"Test scenarios verified:\r\n\r\n1) Reproduced error (non-matching documents) on 6 node cluster that had 3 nodes with https://github.com/apache/couchdb/commit/a6bc72e76c56a1befa8675b06016ecda46ef3a2d and 3 nodes with an older version that did not have the commit.\r\n\r\n2) Changed the environment 3 nodes with this PR's commit and and older version without this commit. Ran the same set of test suites several times without non-matching documents surfacing.\r\n\r\nEunit tests also pass.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423413387/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423413405","html_url":"https://github.com/apache/couchdb/pull/1609#issuecomment-423413405","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1609","id":423413405,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzQxMzQwNQ==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-21T04:57:38Z","updated_at":"2018-09-21T04:57:38Z","author_association":"CONTRIBUTOR","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423413405/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423519223","html_url":"https://github.com/apache/couchdb/issues/1610#issuecomment-423519223","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1610","id":423519223,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzUxOTIyMw==","user":{"login":"kmoe","id":5575356,"node_id":"MDQ6VXNlcjU1NzUzNTY=","avatar_url":"https://avatars.githubusercontent.com/u/5575356?v=4","gravatar_id":"","url":"https://api.github.com/users/kmoe","html_url":"https://github.com/kmoe","followers_url":"https://api.github.com/users/kmoe/followers","following_url":"https://api.github.com/users/kmoe/following{/other_user}","gists_url":"https://api.github.com/users/kmoe/gists{/gist_id}","starred_url":"https://api.github.com/users/kmoe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kmoe/subscriptions","organizations_url":"https://api.github.com/users/kmoe/orgs","repos_url":"https://api.github.com/users/kmoe/repos","events_url":"https://api.github.com/users/kmoe/events{/privacy}","received_events_url":"https://api.github.com/users/kmoe/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-21T12:47:38Z","updated_at":"2018-09-21T12:47:38Z","author_association":"NONE","body":"Thanks @nickva, that looks like the correct format.\r\n\r\nI was curious at the phrase `Netscape's original proposal` in RFC2109, which implies that the date format specified there is not normative. RFC2109 also does not define another date format despite making normative statements such as\r\n\r\n```\r\nHTTP/1.1 servers must send Expires: old-date (where old-date is a date long in the past)\r\n```\r\n\r\nRFC2109 is obsoleted by [RFC2965](https://tools.ietf.org/html/rfc2965), which is in turn obsoleted by RFC6265. The former contains a reference to this undated Netscape proposal, which is no longer available at the cited URL but is hosted here:\r\n\r\nhttps://curl.haxx.se/rfc/cookie_spec.html\r\n\r\n```\r\nThe date string is formatted as:\r\n\r\nWdy, DD-Mon-YYYY HH:MM:SS GMT\r\nThis is based on RFC 822, RFC 850, RFC 1036, and RFC 1123, with the variations that the only legal time zone is GMT and the separators between the elements of the date must be dashes.\r\n```\r\n\r\nYou may want to update the [Cloudant docs](https://console.bluemix.net/docs/services/Cloudant/api/authentication.html#cookie-authentication), since the example response uses the wrong format for `Expires`.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423519223/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423579872","html_url":"https://github.com/apache/couchdb/issues/1618#issuecomment-423579872","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1618","id":423579872,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzU3OTg3Mg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-21T15:44:51Z","updated_at":"2018-09-21T15:44:51Z","author_association":"MEMBER","body":"What happens if you remove the `sum` from your reduce?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423579872/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423612552","html_url":"https://github.com/apache/couchdb/pull/1619#issuecomment-423612552","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1619","id":423612552,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzYxMjU1Mg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-21T17:25:19Z","updated_at":"2018-09-21T17:25:19Z","author_association":"CONTRIBUTOR","body":"For another test besides the unit test can try this script\r\n\r\n```\r\n#!/bin/bash\r\n\r\nS=localhost:15984\r\nSA=adm:pass@${S}\r\nJSON=\"Content-Type: application/json\"\r\n\r\ncurl -s -XDELETE $SA/db > /dev/null\r\ncurl -s -XDELETE $SA/srcdb > /dev/null\r\ncurl -s -XDELETE $SA/_replicator > /dev/null\r\ncurl -s -XPUT $SA/db > /dev/null\r\ncurl -s -XPUT $SA/srcdb > /dev/null\r\n\r\necho \"Setting [couch_httpd_auth] timeout = 5\"\r\ncurl -s -XPUT adm:pass@localhost:15986/_config/couch_httpd_auth/timeout -d '\"5\"' > /dev/null\r\ncurl -s -XPUT adm:pass@localhost:25986/_config/couch_httpd_auth/timeout -d '\"5\"' > /dev/null\r\ncurl -s -XPUT adm:pass@localhost:35986/_config/couch_httpd_auth/timeout -d '\"5\"' > /dev/null\r\n\r\necho \"Set session force refresh = 4\"\r\ncurl -s -XPUT adm:pass@localhost:15986/_config/replicator/session_force_refresh_interval_sec -d '\"4\"' > /dev/null\r\ncurl -s -XPUT adm:pass@localhost:25986/_config/replicator/session_force_refresh_interval_sec -d '\"4\"' > /dev/null\r\ncurl -s -XPUT adm:pass@localhost:35986/_config/replicator/session_force_refresh_interval_sec -d '\"4\"' > /dev/null\r\n\r\necho \"Adding VDU to target\"\r\ncat <<EOF > /tmp/vdu.json\r\n  {\r\n    \"_id\": \"_design/vdu\",\r\n    \"validate_doc_update\":\"function(newDoc, oldDoc, userCtx) { log(userCtx); if (newDoc.name != userCtx.name) { throw({'forbidden': 'VDU failed'}); } }\"\r\n  }\r\nEOF\r\ncurl -s -XPUT $SA/db/_design/vdu -H \"$JSON\" -T /tmp/vdu.json > /dev/null\r\n\r\necho \"Replicating from srcdb to db\"\r\ncurl -s XDELETE $SA/_replicate -H \"$JSON\" -d '{\"source\":\"http://adm:pass@localhost:15984/srcdb\", \"target\":\"http://adm:pass@localhost:15984/db\", \"worker_proceses\":1, \"continuous\":true}' > /dev/null\r\ncurl -s XPOST   $SA/_replicate -H \"$JSON\" -d '{\"source\":\"http://adm:pass@localhost:15984/srcdb\", \"target\":\"http://adm:pass@localhost:15984/db\", \"worker_proceses\":1, \"continuous\":true}' > /dev/null\r\n\r\nsleep 3\r\n\r\nDOCID=0\r\n\r\necho \"With frequent enough updates, session is getting refreshed\"\r\nwhile [ $DOCID -lt 2 ]; do\r\n    let DOCID++\r\n    echo \"\"\r\n    echo \"DocID: $DOCID\"\r\n    curl -s -XPUT $SA/srcdb/$DOCID -H \"$JSON\" -d '{\"name\":\"adm\"}' > /dev/null\r\n    echo \"Doc added to source, sleeping 2 seconds\"\r\n    sleep 2\r\n    echo \"Getting doc from target:\"\r\n    curl $SA/db/$DOCID\r\ndone\r\n\r\necho \"Now trying with longer sleeps\"\r\nsleep 10\r\n\r\nwhile [ $DOCID -lt 10 ]; do\r\n    let DOCID++\r\n    echo \"\"\r\n    echo \"DocID: $DOCID\"\r\n    curl -s -XPUT $SA/srcdb/$DOCID -H \"$JSON\" -d '{\"name\":\"adm\"}' > /dev/null\r\n    echo \"Doc added to source, sleeping 7 seconds\"\r\n    sleep 7\r\n    echo \"Getting doc from target:\"\r\n    curl $SA/db/$DOCID\r\ndone\r\n```\r\n\r\nComment the part where the force refresh setting is set to 4 seconds and docs 5,6,7... etc should fail with \r\n```\r\nDocID: 5\r\nDoc added to source, sleeping 7 seconds\r\nGetting doc from target:\r\n{\"error\":\"not_found\",\"reason\":\"missing\"}\r\n\r\nDocID: 6\r\nDoc added to source, sleeping 7 seconds\r\nGetting doc from target:\r\n{\"error\":\"not_found\",\"reason\":\"missing\"}\r\n```\r\n\r\nUncomment the setting and they should be replicating\r\n\r\n```\r\n\r\nDocID: 5\r\nDoc added to source, sleeping 7 seconds\r\nGetting doc from target:\r\n{\"_id\":\"5\",\"_rev\":\"1-66e95cbbe626e928747ecc225341b2d6\",\"name\":\"adm\"}\r\n\r\nDocID: 6\r\nDoc added to source, sleeping 7 seconds\r\nGetting doc from target:\r\n{\"_id\":\"6\",\"_rev\":\"1-66e95cbbe626e928747ecc225341b2d6\",\"name\":\"adm\"}\r\n\r\nDocID: 7\r\nDoc added to source, sleeping 7 seconds\r\nGetting doc from target:\r\n{\"_id\":\"7\",\"_rev\":\"1-66e95cbbe626e928747ecc225341b2d6\",\"name\":\"adm\"}\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423612552/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423612694","html_url":"https://github.com/apache/couchdb/issues/1607#issuecomment-423612694","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1607","id":423612694,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzYxMjY5NA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-21T17:25:46Z","updated_at":"2018-09-21T17:25:46Z","author_association":"CONTRIBUTOR","body":"Implemented a fix: https://github.com/apache/couchdb/pull/1619\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423612694/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423637556","html_url":"https://github.com/apache/couchdb/issues/1610#issuecomment-423637556","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1610","id":423637556,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzYzNzU1Ng==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-21T18:53:20Z","updated_at":"2018-09-21T18:53:20Z","author_association":"CONTRIBUTOR","body":"@kmoe Thanks for digging in and finding the reference to the RFCs.  \r\n\r\nSo they added a restriction to use dashes and only GMT for timezone. Interesting.\r\n\r\nI also found the reason Cloudant's documentation has other date format. It was generated prior to this commit:\r\n\r\nhttps://github.com/mochi/mochiweb/commit/5e682defe214f8f18559a1422843bfb5f637ba68\r\n\r\nNoticed in that commit the web server CouchDB uses was switched to generate cookies in  RFC 2109 format from the RFC 1123 one. Don't know the context as it happened 7 years ago.\r\n\r\nI'll pass along the request to update the docs, thanks again!\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423637556/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423647650","html_url":"https://github.com/apache/couchdb/pull/1620#issuecomment-423647650","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1620","id":423647650,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzY0NzY1MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-21T19:32:04Z","updated_at":"2018-09-21T19:32:04Z","author_association":"MEMBER","body":"Hi @ermouth , next release of CouchDB will be 2.3.0, can you re-do this PR against `master` please? Thanks.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423647650/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423740434","html_url":"https://github.com/apache/couchdb/pull/1620#issuecomment-423740434","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1620","id":423740434,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzc0MDQzNA==","user":{"login":"ermouth","id":1540047,"node_id":"MDQ6VXNlcjE1NDAwNDc=","avatar_url":"https://avatars.githubusercontent.com/u/1540047?v=4","gravatar_id":"","url":"https://api.github.com/users/ermouth","html_url":"https://github.com/ermouth","followers_url":"https://api.github.com/users/ermouth/followers","following_url":"https://api.github.com/users/ermouth/following{/other_user}","gists_url":"https://api.github.com/users/ermouth/gists{/gist_id}","starred_url":"https://api.github.com/users/ermouth/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ermouth/subscriptions","organizations_url":"https://api.github.com/users/ermouth/orgs","repos_url":"https://api.github.com/users/ermouth/repos","events_url":"https://api.github.com/users/ermouth/events{/privacy}","received_events_url":"https://api.github.com/users/ermouth/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-22T12:23:01Z","updated_at":"2018-09-22T12:23:01Z","author_association":"CONTRIBUTOR","body":"Is it now ok?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423740434/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423754495","html_url":"https://github.com/apache/couchdb/issues/1618#issuecomment-423754495","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1618","id":423754495,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzc1NDQ5NQ==","user":{"login":"strelok1010","id":42271054,"node_id":"MDQ6VXNlcjQyMjcxMDU0","avatar_url":"https://avatars.githubusercontent.com/u/42271054?v=4","gravatar_id":"","url":"https://api.github.com/users/strelok1010","html_url":"https://github.com/strelok1010","followers_url":"https://api.github.com/users/strelok1010/followers","following_url":"https://api.github.com/users/strelok1010/following{/other_user}","gists_url":"https://api.github.com/users/strelok1010/gists{/gist_id}","starred_url":"https://api.github.com/users/strelok1010/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strelok1010/subscriptions","organizations_url":"https://api.github.com/users/strelok1010/orgs","repos_url":"https://api.github.com/users/strelok1010/repos","events_url":"https://api.github.com/users/strelok1010/events{/privacy}","received_events_url":"https://api.github.com/users/strelok1010/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-22T16:07:12Z","updated_at":"2018-09-22T16:07:12Z","author_association":"NONE","body":"I can try, but Â¿It's \"sum\" necessary for the result that I want? I want count all documents from this data base. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423754495/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423775197","html_url":"https://github.com/apache/couchdb/pull/1620#issuecomment-423775197","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1620","id":423775197,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzc3NTE5Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-22T21:37:13Z","updated_at":"2018-09-22T21:37:13Z","author_association":"MEMBER","body":"@ermouth  Perfect.\r\n\r\nCan I get a +1 from someone familiar with this code, e.g. @janl ?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423775197/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423775234","html_url":"https://github.com/apache/couchdb/issues/1618#issuecomment-423775234","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1618","id":423775234,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzc3NTIzNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-22T21:37:58Z","updated_at":"2018-09-22T21:37:58Z","author_association":"MEMBER","body":"@strelok1010 Then try replacing `sum` with `count` for me? It's just a test. Also test without any reduce at all. Trying to narrow down the problem.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423775234/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423947218","html_url":"https://github.com/apache/couchdb/issues/1610#issuecomment-423947218","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1610","id":423947218,"node_id":"MDEyOklzc3VlQ29tbWVudDQyMzk0NzIxOA==","user":{"login":"kmoe","id":5575356,"node_id":"MDQ6VXNlcjU1NzUzNTY=","avatar_url":"https://avatars.githubusercontent.com/u/5575356?v=4","gravatar_id":"","url":"https://api.github.com/users/kmoe","html_url":"https://github.com/kmoe","followers_url":"https://api.github.com/users/kmoe/followers","following_url":"https://api.github.com/users/kmoe/following{/other_user}","gists_url":"https://api.github.com/users/kmoe/gists{/gist_id}","starred_url":"https://api.github.com/users/kmoe/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kmoe/subscriptions","organizations_url":"https://api.github.com/users/kmoe/orgs","repos_url":"https://api.github.com/users/kmoe/repos","events_url":"https://api.github.com/users/kmoe/events{/privacy}","received_events_url":"https://api.github.com/users/kmoe/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-24T11:43:07Z","updated_at":"2018-09-24T11:43:07Z","author_association":"NONE","body":"Interesting, thank you. That explains why I couldn't find the code for generating the date in the CouchDB codebase.\r\n\r\nTo finish answering my original post, `:hackney_date` provides a `rfc2109_to_date` function, which correctly parses the date in the CouchDB Set-Cookie header: \r\nhttps://github.com/benoitc/hackney/blob/master/src/hackney_date.erl#L64\r\n\r\nI consider this solved with the `mochiweb` reference.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/423947218/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/424007800","html_url":"https://github.com/apache/couchdb/issues/1621#issuecomment-424007800","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1621","id":424007800,"node_id":"MDEyOklzc3VlQ29tbWVudDQyNDAwNzgwMA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-09-24T15:05:03Z","updated_at":"2018-09-24T15:05:03Z","author_association":"CONTRIBUTOR","body":"@adrienverge \r\n\r\nThanks for your report. A lot of local documents could increase the file size like that.\r\n\r\nDo you know which type you have more of _local/<id> or _local/shard-sync-<id>?\r\n\r\nIf it is the first kind (_local/<id>), then those are the result of using the database as a replication endpoint.  CouchDB writes _local checkpoint documents on the source and target, so next time it restarts the replication between source and target it will resume from changes feed from the checkpointed value and not from the very beginning. \r\n\r\nHowever that means that each {source, target} pair (along with a few other thing like if there a filter) generates a _local document. If say source is used for a public demo, then there could be a very large number of {source, target} pairs generated and thus a large number of _local/<id> documents present. \r\n\r\nThere is an option to avoid this http://docs.couchdb.org/en/stable/config/replicator.html#replicator/use_checkpoints and it could help in these cases. Read additional info and the warning regarding using that option, but it sounds like it might help your case.\r\n\r\nIf you see more of the second kind (_local/shard-sync-<id>), then it is hard to say without more debugging why that's happening.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/424007800/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]