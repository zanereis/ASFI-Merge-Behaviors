[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1092889972","html_url":"https://github.com/apache/couchdb/issues/3988#issuecomment-1092889972","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3988","id":1092889972,"node_id":"IC_kwDOAAMmUc5BJC10","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-08T13:59:21Z","updated_at":"2022-04-08T13:59:21Z","author_association":"CONTRIBUTOR","body":"@tan-tony I remember 2.3.1 having a few bugs like that. Unfortunately we don't support 2.x any longer. See if you can reproduce the issue with a recent 3.x release perhaps","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1092889972/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1092894123","html_url":"https://github.com/apache/couchdb/issues/3986#issuecomment-1092894123","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3986","id":1092894123,"node_id":"IC_kwDOAAMmUc5BJD2r","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-08T14:03:25Z","updated_at":"2022-04-08T14:03:25Z","author_association":"CONTRIBUTOR","body":"@sbagati It looks like the the connection failed with a timeout `{error,{error,{conn_failed,{error,etimedout}}}}}`. It's hard to say why it failed beyond that. Could be a proxy/firewall issue, invalid port, or a resource limitation somewhere perhaps.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1092894123/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1093065906","html_url":"https://github.com/apache/couchdb/issues/3976#issuecomment-1093065906","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3976","id":1093065906,"node_id":"IC_kwDOAAMmUc5BJtyy","user":{"login":"ig3","id":5712613,"node_id":"MDQ6VXNlcjU3MTI2MTM=","avatar_url":"https://avatars.githubusercontent.com/u/5712613?v=4","gravatar_id":"","url":"https://api.github.com/users/ig3","html_url":"https://github.com/ig3","followers_url":"https://api.github.com/users/ig3/followers","following_url":"https://api.github.com/users/ig3/following{/other_user}","gists_url":"https://api.github.com/users/ig3/gists{/gist_id}","starred_url":"https://api.github.com/users/ig3/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ig3/subscriptions","organizations_url":"https://api.github.com/users/ig3/orgs","repos_url":"https://api.github.com/users/ig3/repos","events_url":"https://api.github.com/users/ig3/events{/privacy}","received_events_url":"https://api.github.com/users/ig3/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-08T16:28:31Z","updated_at":"2022-04-08T16:28:31Z","author_association":"NONE","body":"No, my server does not completely die. I am able to continue sending requests. I don't notice any unaccepted requests but there is no load on the server, just my testing.\r\n\r\nI am running a single node.\r\n\r\nThere are four processes running:\r\n\r\n```\r\ncouchdb   108694       1  3 Mar29 ?        09:07:04 /home/couchdb/couchdb/bin/../erts-11.1.8/bin/beam.smp -K true -A 16 -Bd -- -root /home/couchdb/couchdb/bin/.. -progname couchdb -- -home /home/couchdb -- -boot /home/couchdb/couchdb/bin/../releases/3.2.0/couchdb -name couchdb@127.0.0.1 -setcookie monster -kernel error_logger silent -sasl sasl_error_logger false -noshell -noinput -smp enable -ssl session_lifetime 300 -- -config /home/couchdb/couchdb/bin/../releases/3.2.0/sys.config --\r\ncouchdb   108724  108694  0 Mar29 ?        00:00:00 erl_child_setup 65536\r\ncouchdb   121212  108724  0 Mar29 ?        00:00:00 inet_gethost 4\r\ncouchdb   121213  121212  0 Mar29 ?        00:00:00 inet_gethost 4\r\ncouchdb   128655  108724  0 Mar30 ?        00:00:00 ./bin/couchjs ./share/server/main.js\r\n```\r\nAfter the 'CRASH', there is no change to the set of processes. Whatever is crashing, it is internal to CouchDB and not manifest at the operating system level as a process terminating and a new process being started.\r\n\r\nMy clients do not see a reply. For example, the tests with curl produce:\r\n\r\n```\r\n*   Trying ::1:5984...\r\n* connect to ::1 port 5984 failed: Connection refused\r\n*   Trying 127.0.0.1:5984...\r\n* Connected to localhost (127.0.0.1) port 5984 (#0)\r\n> GET /test HTTP/1.1\r\n> Host: localhost:5984\r\n> User-Agent: curl/7.74.0\r\n> Accept: application/json\r\n> Content-Type: application/json; charset=utf-8\r\n> Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImZvbyJ9.eyJraWQiOiJmb28iLCJzdWIiOiJhZG1pbiIsIm5hbWUiOiJhZG1pbiIsInJvbGVzIjpbInRlc3QxIiwidGVzdDIiXX0=.xftH2byj7LV9/YqqacmyZfcxQt+/h0etsgtRj6aL4AE=\r\n> \r\n* Empty reply from server\r\n* Connection #0 to host localhost left intact\r\ncurl: (52) Empty reply from server\r\n```\r\nAt the network layer I see:\r\n\r\n```\r\nNo.     Time           Source                Destination           Protocol Length Info\r\n      1 0.000000000    ::1                   ::1                   TCP      94     39212 â†’ 5984 [SYN] Seq=0 Win=65476 Len=0 MSS=65476 SACK_PERM=1 TSval=3974581731 TSecr=0 WS=128\r\n      2 0.000004993    ::1                   ::1                   TCP      74     5984 â†’ 39212 [RST, ACK] Seq=1 Ack=1 Win=0 Len=0\r\n      3 0.000057414    127.0.0.1             127.0.0.1             TCP      74     58268 â†’ 5984 [SYN] Seq=0 Win=65495 Len=0 MSS=65495 SACK_PERM=1 TSval=3683328382 TSecr=0 WS=128\r\n      4 0.000063329    127.0.0.1             127.0.0.1             TCP      74     5984 â†’ 58268 [SYN, ACK] Seq=0 Ack=1 Win=65483 Len=0 MSS=65495 SACK_PERM=1 TSval=3683328382 TSecr=3683328382 WS=128\r\n      5 0.000068053    127.0.0.1             127.0.0.1             TCP      66     58268 â†’ 5984 [ACK] Seq=1 Ack=1 Win=65536 Len=0 TSval=3683328382 TSecr=3683328382\r\n      6 0.000123111    127.0.0.1             127.0.0.1             HTTP     422    GET /test HTTP/1.1\r\n      7 0.000141033    127.0.0.1             127.0.0.1             TCP      66     5984 â†’ 58268 [ACK] Seq=1 Ack=357 Win=65152 Len=0 TSval=3683328382 TSecr=3683328382\r\n      8 0.000641134    127.0.0.1             127.0.0.1             TCP      66     5984 â†’ 58268 [FIN, ACK] Seq=1 Ack=357 Win=65536 Len=0 TSval=3683328383 TSecr=3683328382\r\n      9 0.000779854    127.0.0.1             127.0.0.1             TCP      66     58268 â†’ 5984 [FIN, ACK] Seq=357 Ack=2 Win=65536 Len=0 TSval=3683328383 TSecr=3683328383\r\n     10 0.000785487    127.0.0.1             127.0.0.1             TCP      66     5984 â†’ 58268 [ACK] Seq=2 Ack=358 Win=65536 Len=0 TSval=3683328383 TSecr=3683328383\r\n```\r\nSo the TCP connection is promptly reset by the server, without sending any response.\r\n\r\nBut I am able to send another request immediately after:\r\n\r\n```\r\n$ bash testLocal.sh; bash testLocal.sh\r\n*   Trying ::1:5984...\r\n* connect to ::1 port 5984 failed: Connection refused\r\n*   Trying 127.0.0.1:5984...\r\n* Connected to localhost (127.0.0.1) port 5984 (#0)\r\n> GET /test HTTP/1.1\r\n> Host: localhost:5984\r\n> User-Agent: curl/7.74.0\r\n> Accept: application/json\r\n> Content-Type: application/json; charset=utf-8\r\n> Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImZvbyJ9.eyJraWQiOiJmb28iLCJzdWIiOiJhZG1pbiIsIm5hbWUiOiJhZG1pbiIsInJvbGVzIjpbInRlc3QxIiwidGVzdDIiXX0=.xftH2byj7LV9/YqqacmyZfcxQt+/h0etsgtRj6aL4AE=\r\n> \r\n* Empty reply from server\r\n* Connection #0 to host localhost left intact\r\ncurl: (52) Empty reply from server\r\n*   Trying ::1:5984...\r\n* connect to ::1 port 5984 failed: Connection refused\r\n*   Trying 127.0.0.1:5984...\r\n* Connected to localhost (127.0.0.1) port 5984 (#0)\r\n> GET /test HTTP/1.1\r\n> Host: localhost:5984\r\n> User-Agent: curl/7.74.0\r\n> Accept: application/json\r\n> Content-Type: application/json; charset=utf-8\r\n> Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6ImZvbyJ9.eyJraWQiOiJmb28iLCJzdWIiOiJhZG1pbiIsIm5hbWUiOiJhZG1pbiIsInJvbGVzIjpbInRlc3QxIiwidGVzdDIiXX0=.xftH2byj7LV9/YqqacmyZfcxQt+/h0etsgtRj6aL4AE=\r\n> \r\n* Empty reply from server\r\n* Connection #0 to host localhost left intact\r\ncurl: (52) Empty reply from server\r\n```\r\n\r\nThat second request is not really immediately after, but as fast as my system can run a bash shell and instance of curl. The script has nothing in it but the curl command.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1093065906/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1093740610","html_url":"https://github.com/apache/couchdb/issues/3988#issuecomment-1093740610","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3988","id":1093740610,"node_id":"IC_kwDOAAMmUc5BMShC","user":{"login":"tan-tony","id":52731609,"node_id":"MDQ6VXNlcjUyNzMxNjA5","avatar_url":"https://avatars.githubusercontent.com/u/52731609?v=4","gravatar_id":"","url":"https://api.github.com/users/tan-tony","html_url":"https://github.com/tan-tony","followers_url":"https://api.github.com/users/tan-tony/followers","following_url":"https://api.github.com/users/tan-tony/following{/other_user}","gists_url":"https://api.github.com/users/tan-tony/gists{/gist_id}","starred_url":"https://api.github.com/users/tan-tony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tan-tony/subscriptions","organizations_url":"https://api.github.com/users/tan-tony/orgs","repos_url":"https://api.github.com/users/tan-tony/repos","events_url":"https://api.github.com/users/tan-tony/events{/privacy}","received_events_url":"https://api.github.com/users/tan-tony/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-09T06:29:42Z","updated_at":"2022-04-09T06:29:42Z","author_association":"NONE","body":"Hi @nickva we are not ready to move on to 3.x yet, due to API changes. \r\nDo you recall any methods that could stop these replications in the meantime?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1093740610/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1094035088","html_url":"https://github.com/apache/couchdb/issues/3976#issuecomment-1094035088","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3976","id":1094035088,"node_id":"IC_kwDOAAMmUc5BNaaQ","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-09T13:47:22Z","updated_at":"2022-04-09T13:47:22Z","author_association":"CONTRIBUTOR","body":"@davisp Would you like to take a look please - you are the jiffy expert ðŸ˜‰","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1094035088/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1094078449","html_url":"https://github.com/apache/couchdb/issues/3988#issuecomment-1094078449","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3988","id":1094078449,"node_id":"IC_kwDOAAMmUc5BNk_x","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-09T16:22:49Z","updated_at":"2022-04-09T16:22:49Z","author_association":"CONTRIBUTOR","body":"@tan-tony a quick server restart would clear them out. \r\n\r\nI don't recall if we had a remsh (erlang shell) set up in 2.3.1 but if there is one you could also connect to  \"couchdb@db02.xxx\" then use the `exit(<0.9876.2>, kill)` to kill that process directly.\r\n\r\nAnother thing to try is to delete it via the POST to _replicate https://docs.couchdb.org/en/stable/api/server/common.html#replicate using the replication_id `cancel: true`. That might not work though but it's worth trying.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1094078449/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1095448166","html_url":"https://github.com/apache/couchdb/issues/3976#issuecomment-1095448166","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3976","id":1095448166,"node_id":"IC_kwDOAAMmUc5BSzZm","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-11T19:06:10Z","updated_at":"2022-04-11T19:06:10Z","author_association":"MEMBER","body":"@big-r81 This isn't a jiffy issue really. Jiffy is just saying that it got passed something that's not encodable as JSON, namely `{bad_block, 88}` and then nothing catches the error before blowing up the socket.\r\n\r\nLikely we just need to format that error into something that can be reported better. I'm not super familiar with the JWT code, maybe @rnewson or @nickva would have a better idea on where to start looking for that.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1095448166/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1095668585","html_url":"https://github.com/apache/couchdb/issues/3988#issuecomment-1095668585","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3988","id":1095668585,"node_id":"IC_kwDOAAMmUc5BTpNp","user":{"login":"tan-tony","id":52731609,"node_id":"MDQ6VXNlcjUyNzMxNjA5","avatar_url":"https://avatars.githubusercontent.com/u/52731609?v=4","gravatar_id":"","url":"https://api.github.com/users/tan-tony","html_url":"https://github.com/tan-tony","followers_url":"https://api.github.com/users/tan-tony/followers","following_url":"https://api.github.com/users/tan-tony/following{/other_user}","gists_url":"https://api.github.com/users/tan-tony/gists{/gist_id}","starred_url":"https://api.github.com/users/tan-tony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tan-tony/subscriptions","organizations_url":"https://api.github.com/users/tan-tony/orgs","repos_url":"https://api.github.com/users/tan-tony/repos","events_url":"https://api.github.com/users/tan-tony/events{/privacy}","received_events_url":"https://api.github.com/users/tan-tony/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-11T22:54:35Z","updated_at":"2022-04-11T22:54:35Z","author_association":"NONE","body":"@nickva  We have tried roling restart nodes before and didnt seem to help, does every node have to be stopped first and then start back up?\r\nYeah, also tried `cancel: true` before and didn't work.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1095668585/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1095677870","html_url":"https://github.com/apache/couchdb/issues/3988#issuecomment-1095677870","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3988","id":1095677870,"node_id":"IC_kwDOAAMmUc5BTreu","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-11T23:09:26Z","updated_at":"2022-04-11T23:09:26Z","author_association":"CONTRIBUTOR","body":"The `{\"node\": \"couchdb@db02.xxx\", \"pid\": \"<0.9876.2>\"}` part indicates it is running on `db02.xxx` and has a process ID `<0.9876.2>` after restart if you still see that job means the restart didn't happen properly, or the document may still be in the `_replicator` database. Perhaps the document was deleted but there is a conflict and the replication manager sees the deleted document.  Try fetching the document with `?deleted=true`. \r\n\r\nThere could be DNS mixup and you might be reaching a different node than the indented one...?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1095677870/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1095701638","html_url":"https://github.com/apache/couchdb/issues/3988#issuecomment-1095701638","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3988","id":1095701638,"node_id":"IC_kwDOAAMmUc5BTxSG","user":{"login":"tan-tony","id":52731609,"node_id":"MDQ6VXNlcjUyNzMxNjA5","avatar_url":"https://avatars.githubusercontent.com/u/52731609?v=4","gravatar_id":"","url":"https://api.github.com/users/tan-tony","html_url":"https://github.com/tan-tony","followers_url":"https://api.github.com/users/tan-tony/followers","following_url":"https://api.github.com/users/tan-tony/following{/other_user}","gists_url":"https://api.github.com/users/tan-tony/gists{/gist_id}","starred_url":"https://api.github.com/users/tan-tony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tan-tony/subscriptions","organizations_url":"https://api.github.com/users/tan-tony/orgs","repos_url":"https://api.github.com/users/tan-tony/repos","events_url":"https://api.github.com/users/tan-tony/events{/privacy}","received_events_url":"https://api.github.com/users/tan-tony/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-11T23:46:03Z","updated_at":"2022-04-11T23:46:03Z","author_association":"NONE","body":"DNS should be ok, our cluster is functioning everyday for production. \r\nI tried deleted flag just now and still the same case.\r\nKilling the process probably will work, but I'm afraid it might come back again after a restart.\r\n```\r\n$ curl 'http://db02.xxx:5984/_replicator/72ad82ac143cbef8896eef52bc08e5f0?deleted=true' | jq .\r\n  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current\r\n                                 Dload  Upload   Total   Spent    Left  Speed\r\n100    41  100    41    0     0    211      0 --:--:-- --:--:-- --:--:--   211\r\n{\r\n  \"error\": \"not_found\",\r\n  \"reason\": \"missing\"\r\n}\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1095701638/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1098706250","html_url":"https://github.com/apache/couchdb/issues/3988#issuecomment-1098706250","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3988","id":1098706250,"node_id":"IC_kwDOAAMmUc5BfO1K","user":{"login":"tan-tony","id":52731609,"node_id":"MDQ6VXNlcjUyNzMxNjA5","avatar_url":"https://avatars.githubusercontent.com/u/52731609?v=4","gravatar_id":"","url":"https://api.github.com/users/tan-tony","html_url":"https://github.com/tan-tony","followers_url":"https://api.github.com/users/tan-tony/followers","following_url":"https://api.github.com/users/tan-tony/following{/other_user}","gists_url":"https://api.github.com/users/tan-tony/gists{/gist_id}","starred_url":"https://api.github.com/users/tan-tony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tan-tony/subscriptions","organizations_url":"https://api.github.com/users/tan-tony/orgs","repos_url":"https://api.github.com/users/tan-tony/repos","events_url":"https://api.github.com/users/tan-tony/events{/privacy}","received_events_url":"https://api.github.com/users/tan-tony/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-14T04:49:40Z","updated_at":"2022-04-14T04:49:40Z","author_association":"NONE","body":"@nickva Decided to clean up all these and deleted the whole _replicator database today then restarted couch. These tasks are still running somehow.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1098706250/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1098865348","html_url":"https://github.com/apache/couchdb/issues/3976#issuecomment-1098865348","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3976","id":1098865348,"node_id":"IC_kwDOAAMmUc5Bf1rE","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-14T08:43:38Z","updated_at":"2022-04-14T08:43:38Z","author_association":"MEMBER","body":"so, two points.\r\n\r\n1) this isn't a \"crash\". The erlang process specifically for the request with the malformed input terminates unsuccessfully. As the OP noted, this doesn't affect any other request or cause a server restart. This is intentionally how CouchDB (and Erlang) handles unexpected situations.\r\n\r\n2) We should enhance the jwtf code to catch when jiffy throws an exception during decode and send a clean 400 instead.\r\n\r\nIn summary, we can, and should, improve the quality of CouchDB's response to a malformed request, but there's no deeper problem for CouchDB's resilience.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1098865348/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1098915497","html_url":"https://github.com/apache/couchdb/issues/3976#issuecomment-1098915497","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3976","id":1098915497,"node_id":"IC_kwDOAAMmUc5BgB6p","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-14T09:21:05Z","updated_at":"2022-04-14T09:21:05Z","author_association":"MEMBER","body":"heh, it's actually simpler. jwtf _does_ catch the error and throws {bad_request, Reason}. This would cause a 400 bad request. Unfortunately the reason from jiffy is not a binary (it's `{bad_block,88}` as above) and so we fail to generate the response body. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1098915497/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1100437229","html_url":"https://github.com/apache/couchdb/issues/3988#issuecomment-1100437229","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3988","id":1100437229,"node_id":"IC_kwDOAAMmUc5Bl1bt","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-15T22:08:44Z","updated_at":"2022-04-15T22:08:44Z","author_association":"CONTRIBUTOR","body":"@tan-tony are there any other _replicator databases?. Perhaps the cluster is partitioned? The replication job has to be started somewhere if you restart all the nodes and it's still running, something is still creating it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1100437229/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1101883696","html_url":"https://github.com/apache/couchdb/pull/3985#issuecomment-1101883696","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3985","id":1101883696,"node_id":"IC_kwDOAAMmUc5BrWkw","user":{"login":"noahshaw11","id":47468872,"node_id":"MDQ6VXNlcjQ3NDY4ODcy","avatar_url":"https://avatars.githubusercontent.com/u/47468872?v=4","gravatar_id":"","url":"https://api.github.com/users/noahshaw11","html_url":"https://github.com/noahshaw11","followers_url":"https://api.github.com/users/noahshaw11/followers","following_url":"https://api.github.com/users/noahshaw11/following{/other_user}","gists_url":"https://api.github.com/users/noahshaw11/gists{/gist_id}","starred_url":"https://api.github.com/users/noahshaw11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahshaw11/subscriptions","organizations_url":"https://api.github.com/users/noahshaw11/orgs","repos_url":"https://api.github.com/users/noahshaw11/repos","events_url":"https://api.github.com/users/noahshaw11/events{/privacy}","received_events_url":"https://api.github.com/users/noahshaw11/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-19T00:39:16Z","updated_at":"2022-04-19T00:39:30Z","author_association":"CONTRIBUTOR","body":"@iilyak The logic between the two functions below is circular and causes an infinite loop. How should this be implemented?\r\n```\r\nresource_hoggers_data(MemoryInfo, InfoKey, KeyFun) when is_atom(InfoKey) ->\r\n    resource_hoggers_data(MemoryInfo, Info, KeyFun, 20).\r\n\r\nresource_hoggers_data(MemoryInfo, InfoKey, KeyFun, N) when is_atom(InfoKey) ->\r\n    SortedTuples = resource_hoggers_data(MemoryInfo, InfoKey, undefined),\r\n    {TopN, _} = lists:split(20, SortedTuples),\r\n    TopN.\r\n```\r\nAlso, is `MemoryInfo` expected to be the return value of `memory_info` implemented here: https://github.com/apache/couchdb/pull/3984 ?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1101883696/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1102220773","html_url":"https://github.com/apache/couchdb/issues/3956#issuecomment-1102220773","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3956","id":1102220773,"node_id":"IC_kwDOAAMmUc5Bso3l","user":{"login":"rudasn","id":27783,"node_id":"MDQ6VXNlcjI3Nzgz","avatar_url":"https://avatars.githubusercontent.com/u/27783?v=4","gravatar_id":"","url":"https://api.github.com/users/rudasn","html_url":"https://github.com/rudasn","followers_url":"https://api.github.com/users/rudasn/followers","following_url":"https://api.github.com/users/rudasn/following{/other_user}","gists_url":"https://api.github.com/users/rudasn/gists{/gist_id}","starred_url":"https://api.github.com/users/rudasn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rudasn/subscriptions","organizations_url":"https://api.github.com/users/rudasn/orgs","repos_url":"https://api.github.com/users/rudasn/repos","events_url":"https://api.github.com/users/rudasn/events{/privacy}","received_events_url":"https://api.github.com/users/rudasn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-19T07:44:35Z","updated_at":"2022-04-19T07:44:35Z","author_association":"NONE","body":"Do you have any document attachments in that database, or any views that emit a lot of rows and/or data, or a lot of deleted/removed documents? I think those factors could explain the disk usage.\r\n\r\nAlso, what is the disk usage of the replicated database? Is it similar to the original one?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1102220773/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1102361235","html_url":"https://github.com/apache/couchdb/issues/3998#issuecomment-1102361235","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3998","id":1102361235,"node_id":"IC_kwDOAAMmUc5BtLKT","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-19T09:14:42Z","updated_at":"2022-04-19T09:14:42Z","author_association":"CONTRIBUTOR","body":"Hi,\r\n\r\nI updated your comment for better readability of the json source. Please use code blocks.\r\n\r\nYour query isn't using your index, which is shown:\r\n```json\r\n\"index\": {\r\n        \"ddoc\": null,\r\n        \"name\": \"_all_docs\",\r\n        \"type\": \"special\",\r\n        \"def\": {\r\n            \"fields\": [{\r\n                \"_id\": \"asc\"\r\n            }]\r\n        }\r\n    },\r\n```\r\nIt's using the `_all_docs` endpoint for quering your results.\r\n\r\nDid you try to explicitly use `use_index` in your `_find` query to use your index?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1102361235/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1102641790","html_url":"https://github.com/apache/couchdb/issues/3998#issuecomment-1102641790","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3998","id":1102641790,"node_id":"IC_kwDOAAMmUc5BuPp-","user":{"login":"shrikantgarg17","id":56015673,"node_id":"MDQ6VXNlcjU2MDE1Njcz","avatar_url":"https://avatars.githubusercontent.com/u/56015673?v=4","gravatar_id":"","url":"https://api.github.com/users/shrikantgarg17","html_url":"https://github.com/shrikantgarg17","followers_url":"https://api.github.com/users/shrikantgarg17/followers","following_url":"https://api.github.com/users/shrikantgarg17/following{/other_user}","gists_url":"https://api.github.com/users/shrikantgarg17/gists{/gist_id}","starred_url":"https://api.github.com/users/shrikantgarg17/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shrikantgarg17/subscriptions","organizations_url":"https://api.github.com/users/shrikantgarg17/orgs","repos_url":"https://api.github.com/users/shrikantgarg17/repos","events_url":"https://api.github.com/users/shrikantgarg17/events{/privacy}","received_events_url":"https://api.github.com/users/shrikantgarg17/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-19T13:19:05Z","updated_at":"2022-04-19T13:19:05Z","author_association":"NONE","body":"Yeah.. that is the problem.. even when i use use_index in my query it is not picking my index and always using _all_docs. Not sure what is the probelm.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1102641790/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1102795535","html_url":"https://github.com/apache/couchdb/issues/3998#issuecomment-1102795535","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3998","id":1102795535,"node_id":"IC_kwDOAAMmUc5Bu1MP","user":{"login":"willholley","id":97787,"node_id":"MDQ6VXNlcjk3Nzg3","avatar_url":"https://avatars.githubusercontent.com/u/97787?v=4","gravatar_id":"","url":"https://api.github.com/users/willholley","html_url":"https://github.com/willholley","followers_url":"https://api.github.com/users/willholley/followers","following_url":"https://api.github.com/users/willholley/following{/other_user}","gists_url":"https://api.github.com/users/willholley/gists{/gist_id}","starred_url":"https://api.github.com/users/willholley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willholley/subscriptions","organizations_url":"https://api.github.com/users/willholley/orgs","repos_url":"https://api.github.com/users/willholley/repos","events_url":"https://api.github.com/users/willholley/events{/privacy}","received_events_url":"https://api.github.com/users/willholley/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-19T15:31:37Z","updated_at":"2022-04-19T15:31:37Z","author_association":"MEMBER","body":"@shrikantgarg17 array elements are not indexed independently when using a `json` index (see https://github.com/apache/couchdb/issues/1388 for the explanation). At query time, CouchDB will ignore the `$elemMatch` operator when evaluating which indexes can be used. Given the only other clause in your selector is `_id > 0`, you end up with a full database scan. \r\n\r\nAs a solution, you can either use a [view](https://docs.couchdb.org/en/3.2.0/ddocs/views/index.html) directly and emit each element in the index as a key, or add the [search plugin](https://docs.couchdb.org/en/3.2.0/ddocs/search.html) and use the `text` type index, which can index array elements independently.\r\n\r\nThe view solution would be a map function like:\r\n```\r\nfunction(doc) {\r\n    if(doc.shri && doc.shri.tags) {\r\n        for (var i = 0; i <  doc.shri.tags.length; i++) { \r\n            emit(doc.shri.tags[i], null);\r\n        }\r\n    }\r\n}\r\n```\r\n\r\nand then all the view using `http://couchdburl/db/_design/my_ddoc/_view?key=\"xyz\"`","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1102795535/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1102812121","html_url":"https://github.com/apache/couchdb/issues/3998#issuecomment-1102812121","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3998","id":1102812121,"node_id":"IC_kwDOAAMmUc5Bu5PZ","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-19T15:47:21Z","updated_at":"2022-04-19T15:49:55Z","author_association":"CONTRIBUTOR","body":"I think the answer is much simpler:\r\n\r\nThere is a special default index only for `_id` which is for me:\r\n```json\r\n{\r\n  \"total_rows\": 2,\r\n  \"indexes\": [\r\n    {\r\n      \"ddoc\": null,\r\n      \"name\": \"_all_docs\",\r\n      \"type\": \"special\",\r\n      \"def\": { \"fields\": [{ \"_id\": \"asc\" }] }\r\n    },\r\n    {\r\n      \"ddoc\": \"_design/c3f8e5d6df2ef807ee1016949098ac4e6287d31c\",\r\n      \"name\": \"tags-json-index\",\r\n      \"type\": \"json\",\r\n      \"partitioned\": false,\r\n      \"def\": { \"fields\": [{ \"_id\": \"asc\" }, { \"shri\": \"asc\" }] }\r\n    }\r\n  ]\r\n}\r\n```\r\n\r\nIf I only sort for `_id` the \"special\" index is used. If I use \r\n```json\r\n  \"sort\" : [\"_id\", \"shri\"]\r\n```\r\nin the query, with the following ddoc\r\n```json\r\n{\r\n  \"_id\": \"_design/c3f8e5d6df2ef807ee1016949098ac4e6287d31c\",\r\n  \"_rev\": \"3-bbb25abe2218156af2ad8a5d6648ce1d\",\r\n  \"language\": \"query\",\r\n  \"views\": {\r\n    \"tags-json-index\": {\r\n      \"map\": {\r\n        \"fields\": {\r\n          \"_id\": \"asc\",\r\n          \"shri\": \"asc\"\r\n        },\r\n        \"partial_filter_selector\": {}\r\n      },\r\n      \"reduce\": \"_count\",\r\n      \"options\": {\r\n        \"def\": {\r\n          \"fields\": [\r\n            \"_id\",\r\n            \"shri\"\r\n          ]\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n```\r\nthen the the mango query uses this index...\r\n\r\n```json\r\n{\r\n \"dbname\": \"test\",\r\n \"index\": {\r\n  \"ddoc\": \"_design/c3f8e5d6df2ef807ee1016949098ac4e6287d31c\",\r\n  \"name\": \"tags-json-index\",\r\n  \"type\": \"json\",\r\n  \"partitioned\": false,\r\n  \"def\": {\r\n   \"fields\": [\r\n    {\r\n     \"_id\": \"asc\"\r\n    },\r\n    {\r\n     \"shri\": \"asc\"\r\n    }\r\n   ]\r\n  }\r\n },\r\n \"partitioned\": false,\r\n \"selector\": {\r\n  \"$and\": [\r\n   {\r\n    \"shri.tags\": {\r\n     \"$elemMatch\": {\r\n      \"\": {\r\n       \"$eq\": \"java\"\r\n      }\r\n     }\r\n    }\r\n   },\r\n   {\r\n    \"_id\": {\r\n     \"$gte\": \"0\"\r\n    }\r\n   }\r\n  ]\r\n },\r\n \"opts\": {\r\n  \"use_index\": [],\r\n  \"bookmark\": \"nil\",\r\n  \"limit\": 501,\r\n  \"skip\": 0,\r\n  \"sort\": {\r\n   \"_id\": \"asc\",\r\n   \"shri\": \"asc\"\r\n  },\r\n  \"fields\": [\r\n   \"_id\"\r\n  ],\r\n  \"partition\": \"\",\r\n  \"r\": [\r\n   49\r\n  ],\r\n  \"conflicts\": false,\r\n  \"stale\": false,\r\n  \"update\": true,\r\n  \"stable\": false,\r\n  \"execution_stats\": false\r\n },\r\n \"limit\": 501,\r\n \"skip\": 0,\r\n \"fields\": [\r\n  \"_id\"\r\n ],\r\n \"mrargs\": {\r\n  \"include_docs\": true,\r\n  \"view_type\": \"map\",\r\n  \"reduce\": false,\r\n  \"partition\": null,\r\n  \"start_key\": [\r\n   \"0\"\r\n  ],\r\n  \"end_key\": [\r\n   \"<MAX>\"\r\n  ],\r\n  \"direction\": \"fwd\",\r\n  \"stable\": false,\r\n  \"update\": true,\r\n  \"conflicts\": \"undefined\"\r\n }\r\n}\r\n```\r\n\r\nBut you are right, with your view function, you have the possibility to use a dynamic query for the tag...","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1102812121/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1102840724","html_url":"https://github.com/apache/couchdb/issues/3996#issuecomment-1102840724","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3996","id":1102840724,"node_id":"IC_kwDOAAMmUc5BvAOU","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-19T16:16:04Z","updated_at":"2022-04-19T16:16:57Z","author_association":"CONTRIBUTOR","body":"Hi,\r\n\r\nyou need to encode the `+` to `%2b`. A `+`in an url is a special char (whitespace).\r\n\r\nTry\r\n```bash\r\ncurl -X PUT http://127.0.0.1:15984/test%2bdatabase\r\n```\r\nand you get\r\n```json\r\n{\"ok\":true}\r\n```\r\nList all dbs:\r\n```json\r\n[\"_replicator\",\"_users\",\"test\",\"test+database\"]\r\n```\r\n\r\nIn Fauxton it worked too!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1102840724/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1102926714","html_url":"https://github.com/apache/couchdb/issues/3998#issuecomment-1102926714","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3998","id":1102926714,"node_id":"IC_kwDOAAMmUc5BvVN6","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-19T17:51:30Z","updated_at":"2022-04-19T17:51:30Z","author_association":"CONTRIBUTOR","body":"Moving to discussions...","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1102926714/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1103258683","html_url":"https://github.com/apache/couchdb/issues/3988#issuecomment-1103258683","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3988","id":1103258683,"node_id":"IC_kwDOAAMmUc5BwmQ7","user":{"login":"tan-tony","id":52731609,"node_id":"MDQ6VXNlcjUyNzMxNjA5","avatar_url":"https://avatars.githubusercontent.com/u/52731609?v=4","gravatar_id":"","url":"https://api.github.com/users/tan-tony","html_url":"https://github.com/tan-tony","followers_url":"https://api.github.com/users/tan-tony/followers","following_url":"https://api.github.com/users/tan-tony/following{/other_user}","gists_url":"https://api.github.com/users/tan-tony/gists{/gist_id}","starred_url":"https://api.github.com/users/tan-tony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tan-tony/subscriptions","organizations_url":"https://api.github.com/users/tan-tony/orgs","repos_url":"https://api.github.com/users/tan-tony/repos","events_url":"https://api.github.com/users/tan-tony/events{/privacy}","received_events_url":"https://api.github.com/users/tan-tony/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-19T23:30:01Z","updated_at":"2022-04-19T23:35:16Z","author_association":"NONE","body":"@nickva  I couldn't find any other _replicator db, searched through _all_dbs. The cluster is running with q=1.\r\nIt's there a way to find out which node started the jobs","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1103258683/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1103885590","html_url":"https://github.com/apache/couchdb/pull/4000#issuecomment-1103885590","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4000","id":1103885590,"node_id":"IC_kwDOAAMmUc5By_UW","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-20T12:40:26Z","updated_at":"2022-04-20T12:40:26Z","author_association":"MEMBER","body":"I've revised the intent here since I started after learning (more than I really wanted to!) about couchjs and spidermonkey. Object.prototype.toSource() is available in all versions of spidermonkey that we support but, in later versions, must be explicitly enabled. The value of the result of toSource() is significant and we'd like to keep it.\r\n\r\nWe missed a spot when enabling the flag, which this PR corrects.\r\n\r\nSince toSource() will always work, I have removed all the guarding that would call toString() (with its unhelpful output) as a fallback.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1103885590/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104002432","html_url":"https://github.com/apache/couchdb/pull/4000#issuecomment-1104002432","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4000","id":1104002432,"node_id":"IC_kwDOAAMmUc5Bzb2A","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-20T14:30:07Z","updated_at":"2022-04-20T14:30:07Z","author_association":"CONTRIBUTOR","body":"Good find!  However, his would undo the [work](https://github.com/apache/couchdb/commit/aaa3921cb1cc1c96052630ac8a53ec2471e638d8) to make the JS code compatible with v8, or other JS engines, and would make it SpiderMonkey only code. I think in case of that commit we did actually have Cloudant's ateles engine as an alternative working JS engine. But, still, even for 3.x, I think it would be nice to maintain the compatibility with other engines at least for the future. So, perhaps we can `enableToSource` but also keep the `obj.toString() | err.stack` logic since it's already there?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104002432/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104330144","html_url":"https://github.com/apache/couchdb/issues/4001#issuecomment-1104330144","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4001","id":1104330144,"node_id":"IC_kwDOAAMmUc5B0r2g","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-20T18:43:20Z","updated_at":"2022-04-20T18:43:20Z","author_association":"MEMBER","body":"hi, we're fixing a security issue here so if at all possible please try to get 3.2.2 installed. you need to specify a value for couchdb/cookie. It should be possible to preseed it with debconf-set-selections. I'm trying it locally, unfortunately without success, so there might be a new package for 3.2.2 in the very near future.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104330144/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104387152","html_url":"https://github.com/apache/couchdb/issues/4001#issuecomment-1104387152","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4001","id":1104387152,"node_id":"IC_kwDOAAMmUc5B05xQ","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-20T19:40:14Z","updated_at":"2022-04-20T19:40:14Z","author_association":"MEMBER","body":"figured it out. will post a fix soon.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104387152/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104396938","html_url":"https://github.com/apache/couchdb/issues/4001#issuecomment-1104396938","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4001","id":1104396938,"node_id":"IC_kwDOAAMmUc5B08KK","user":{"login":"jefferbrecht","id":89024676,"node_id":"MDQ6VXNlcjg5MDI0Njc2","avatar_url":"https://avatars.githubusercontent.com/u/89024676?v=4","gravatar_id":"","url":"https://api.github.com/users/jefferbrecht","html_url":"https://github.com/jefferbrecht","followers_url":"https://api.github.com/users/jefferbrecht/followers","following_url":"https://api.github.com/users/jefferbrecht/following{/other_user}","gists_url":"https://api.github.com/users/jefferbrecht/gists{/gist_id}","starred_url":"https://api.github.com/users/jefferbrecht/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jefferbrecht/subscriptions","organizations_url":"https://api.github.com/users/jefferbrecht/orgs","repos_url":"https://api.github.com/users/jefferbrecht/repos","events_url":"https://api.github.com/users/jefferbrecht/events{/privacy}","received_events_url":"https://api.github.com/users/jefferbrecht/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-20T19:51:11Z","updated_at":"2022-04-20T19:51:11Z","author_association":"NONE","body":"Thanks! I just found a workaround at the same time you commented, which is to change this line in `/opt/couchdb/etc/vm.args`:\r\n\r\n```\r\n# -setcookie\r\n```\r\n\r\nto\r\n\r\n```\r\n-setcookie somestring\r\n```\r\n\r\nI wasn't able to get `debconf-set-selections` to work either; it looked like the DEBIAN/config script in the package was always overwriting any preseeded values as long as that blank commented line existed in that file:\r\n\r\n```bash\r\nif [ -e /opt/couchdb/etc/vm.args ] ; then\r\n  cookie=\"$(grep '^-setcookie' /opt/couchdb/etc/vm.args | cut -d ' ' -f 2 | stripwhitespace)\"\r\n  nodename=\"$(grep '^-name' /opt/couchdb/etc/vm.args | cut -d ' ' -f 2 | stripwhitespace)\"\r\n  db_set couchdb/cookie \"${cookie}\" # <-- ${cookie} is blank here\r\n  if [ \"${nodename}\" != \"couchdb@127.0.0.1\" ]; then\r\n    db_set couchdb/nodename \"${nodename}\"\r\n  fi\r\nfi\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104396938/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104403418","html_url":"https://github.com/apache/couchdb/issues/4001#issuecomment-1104403418","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4001","id":1104403418,"node_id":"IC_kwDOAAMmUc5B09va","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-20T19:59:09Z","updated_at":"2022-04-20T19:59:09Z","author_association":"MEMBER","body":"I think this is the fix;\r\n\r\n```\r\ndiff --git a/debian/couchdb.config b/debian/couchdb.config\r\nindex df9518c..e21d9e7 100755\r\n--- a/debian/couchdb.config\r\n+++ b/debian/couchdb.config\r\n@@ -84,7 +84,9 @@ promptcookie() {\r\n if [ -e /opt/couchdb/etc/vm.args ] ; then\r\n   cookie=\"$(grep '^-setcookie' /opt/couchdb/etc/vm.args | cut -d ' ' -f 2 | stripwhitespace)\"\r\n   nodename=\"$(grep '^-name' /opt/couchdb/etc/vm.args | cut -d ' ' -f 2 | stripwhitespace)\"\r\n-  db_set couchdb/cookie \"${cookie}\"\r\n+  if [ -n \"$cookie\" ]; then\r\n+      db_set couchdb/cookie \"${cookie}\"\r\n+  fi\r\n   if [ \"${nodename}\" != \"couchdb@127.0.0.1\" ]; then\r\n     db_set couchdb/nodename \"${nodename}\"\r\n   fi\r\n```\r\n\r\nWhat's happening is the couchdb.config forcibly sets couchdb/cookie to the empty string (because it's now empty in the original vm.args file), so even if you set it with debconf, it won't help. \r\n\r\nMy change above guards against setting the debconf variable if there is no existing value.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104403418/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104404530","html_url":"https://github.com/apache/couchdb/issues/4001#issuecomment-1104404530","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4001","id":1104404530,"node_id":"IC_kwDOAAMmUc5B0-Ay","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-20T20:00:29Z","updated_at":"2022-04-20T20:00:29Z","author_association":"MEMBER","body":"the preseed instructions are at https://github.com/apache/couchdb-pkg/blob/main/debian/README.Debian, though you will need the two lines from 'clustered' for couchdb/cookie even when doing the standalone install, but only once my bug fix is applied. Trying to get this tested locally first and then get a new build out. sorry for the fuss.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104404530/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104405253","html_url":"https://github.com/apache/couchdb/issues/4001#issuecomment-1104405253","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4001","id":1104405253,"node_id":"IC_kwDOAAMmUc5B0-MF","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-20T20:01:19Z","updated_at":"2022-04-20T20:01:19Z","author_association":"MEMBER","body":"and your workaround is good too! and remember to choose a big and random value.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104405253/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104720084","html_url":"https://github.com/apache/couchdb/issues/4001#issuecomment-1104720084","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4001","id":1104720084,"node_id":"IC_kwDOAAMmUc5B2LDU","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-21T05:21:11Z","updated_at":"2022-04-21T05:21:11Z","author_association":"CONTRIBUTOR","body":"I updated the deb packages with a new version 3.2.2-1 with @rnewson's fix\r\n\r\nWe should update the docs to indicate that `DEBIAN_FRONTEND=noninteractive ...` only would fail and needs the additional template setup.\r\n\r\nHere is how I tested: \r\n\r\n```\r\n# COUCHDB_PASSWORD=password\r\n# COUCHDB_COOKIE=$(openssl rand -hex 32)\r\n# echo \"couchdb couchdb/mode select standalone\r\ncouchdb couchdb/mode seen true\r\ncouchdb couchdb/bindaddress string 127.0.0.1\r\ncouchdb couchdb/bindaddress seen true\r\ncouchdb couchdb/cookie string ${COUCHDB_COOKIE}\r\ncouchdb couchdb/cookie seen true\r\ncouchdb couchdb/adminpass password ${COUCHDB_PASSWORD}\r\ncouchdb couchdb/adminpass seen true\r\ncouchdb couchdb/adminpass_again password ${COUCHDB_PASSWORD}\r\ncouchdb couchdb/adminpass_again seen true\" | debconf-set-selections\r\n\r\n# DEBIAN_FRONTEND=noninteractive dpkg -i couchdb_3.2.2-1~bullseye_amd64.deb\r\n(Reading database ... 146938 files and directories currently installed.)\r\nPreparing to unpack couchdb_3.2.2-1~bullseye_amd64.deb ...\r\nUnpacking couchdb (3.2.2-1~bullseye) over (3.2.2~bullseye) ...\r\nSetting up couchdb (3.2.2-1~bullseye) ...\r\nCreated symlink /etc/systemd/system/multi-user.target.wants/couchdb.service â†’ /lib/systemd/system/couchdb.service.\r\nProcessing triggers for man-db (2.9.4-2) ...\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1104720084/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1105313994","html_url":"https://github.com/apache/couchdb/issues/4001#issuecomment-1105313994","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4001","id":1105313994,"node_id":"IC_kwDOAAMmUc5B4cDK","user":{"login":"jefferbrecht","id":89024676,"node_id":"MDQ6VXNlcjg5MDI0Njc2","avatar_url":"https://avatars.githubusercontent.com/u/89024676?v=4","gravatar_id":"","url":"https://api.github.com/users/jefferbrecht","html_url":"https://github.com/jefferbrecht","followers_url":"https://api.github.com/users/jefferbrecht/followers","following_url":"https://api.github.com/users/jefferbrecht/following{/other_user}","gists_url":"https://api.github.com/users/jefferbrecht/gists{/gist_id}","starred_url":"https://api.github.com/users/jefferbrecht/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jefferbrecht/subscriptions","organizations_url":"https://api.github.com/users/jefferbrecht/orgs","repos_url":"https://api.github.com/users/jefferbrecht/repos","events_url":"https://api.github.com/users/jefferbrecht/events{/privacy}","received_events_url":"https://api.github.com/users/jefferbrecht/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-21T14:42:35Z","updated_at":"2022-04-21T14:42:35Z","author_association":"NONE","body":"I can confirm that 3.2.2-1 resolves this issue. Thanks for the quick turnaround!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1105313994/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1105380085","html_url":"https://github.com/apache/couchdb/issues/3988#issuecomment-1105380085","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3988","id":1105380085,"node_id":"IC_kwDOAAMmUc5B4sL1","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-21T15:26:52Z","updated_at":"2022-04-21T15:26:52Z","author_association":"CONTRIBUTOR","body":"@tan-tony another option could be that the `_replicator` was created as a node-local (non-clustered) db.\r\n\r\nSee if you look in `curl .../_node/_local/_all_dbs` or, if 2.3.1 doesn't have the `_node/_local` API, check the local port 5986 (by default) `curl http://localhost:5986` and see if `_replicator` shows up there.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1105380085/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1106870320","html_url":"https://github.com/apache/couchdb/issues/4002#issuecomment-1106870320","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4002","id":1106870320,"node_id":"IC_kwDOAAMmUc5B-YAw","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-22T21:14:24Z","updated_at":"2022-04-22T21:14:24Z","author_association":"CONTRIBUTOR","body":"It is provided when we release infos about the fixed CVE. It should be available next week.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1106870320/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1106878971","html_url":"https://github.com/apache/couchdb/issues/4002#issuecomment-1106878971","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4002","id":1106878971,"node_id":"IC_kwDOAAMmUc5B-aH7","user":{"login":"ArchangeGabriel","id":490531,"node_id":"MDQ6VXNlcjQ5MDUzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/490531?v=4","gravatar_id":"","url":"https://api.github.com/users/ArchangeGabriel","html_url":"https://github.com/ArchangeGabriel","followers_url":"https://api.github.com/users/ArchangeGabriel/followers","following_url":"https://api.github.com/users/ArchangeGabriel/following{/other_user}","gists_url":"https://api.github.com/users/ArchangeGabriel/gists{/gist_id}","starred_url":"https://api.github.com/users/ArchangeGabriel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ArchangeGabriel/subscriptions","organizations_url":"https://api.github.com/users/ArchangeGabriel/orgs","repos_url":"https://api.github.com/users/ArchangeGabriel/repos","events_url":"https://api.github.com/users/ArchangeGabriel/events{/privacy}","received_events_url":"https://api.github.com/users/ArchangeGabriel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-22T21:24:04Z","updated_at":"2022-04-22T21:24:04Z","author_association":"NONE","body":"OK, I see, thanks. I was looking for the commit that made https://github.com/apache/couchdb/issues/999#issuecomment-382410495= the default, but could not use the diff between tags feature to find it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1106878971/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1108806256","html_url":"https://github.com/apache/couchdb/pull/4006#issuecomment-1108806256","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4006","id":1108806256,"node_id":"IC_kwDOAAMmUc5CFwpw","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T16:47:19Z","updated_at":"2022-04-25T16:47:19Z","author_association":"CONTRIBUTOR","body":"Maybe we need to update this too?\r\nhttps://github.com/apache/couchdb-ci/blob/aabb296f70fe0c20c63c0ae9ef4b1f7fa9c7eb9f/build.sh#L45","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1108806256/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1108814905","html_url":"https://github.com/apache/couchdb/pull/4006#issuecomment-1108814905","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4006","id":1108814905,"node_id":"IC_kwDOAAMmUc5CFyw5","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T16:56:32Z","updated_at":"2022-04-25T16:56:32Z","author_association":"CONTRIBUTOR","body":"@big-r81 good point, there is https://github.com/apache/couchdb-pkg as well that has references to stretch","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1108814905/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1109023409","html_url":"https://github.com/apache/couchdb/pull/4006#issuecomment-1109023409","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4006","id":1109023409,"node_id":"IC_kwDOAAMmUc5CGlqx","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-25T20:44:44Z","updated_at":"2022-04-25T20:44:44Z","author_association":"CONTRIBUTOR","body":"<img width=\"582\" alt=\"Screen Shot 2022-04-25 at 4 44 22 PM\" src=\"https://user-images.githubusercontent.com/211822/165171696-f1c2b479-1b3a-45c1-923c-4e94be0164c7.png\">\r\n\r\nNice work @lostnet and @big-r81 \r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1109023409/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1109758384","html_url":"https://github.com/apache/couchdb/issues/999#issuecomment-1109758384","issue_url":"https://api.github.com/repos/apache/couchdb/issues/999","id":1109758384,"node_id":"IC_kwDOAAMmUc5CJZGw","user":{"login":"ArchangeGabriel","id":490531,"node_id":"MDQ6VXNlcjQ5MDUzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/490531?v=4","gravatar_id":"","url":"https://api.github.com/users/ArchangeGabriel","html_url":"https://github.com/ArchangeGabriel","followers_url":"https://api.github.com/users/ArchangeGabriel/followers","following_url":"https://api.github.com/users/ArchangeGabriel/following{/other_user}","gists_url":"https://api.github.com/users/ArchangeGabriel/gists{/gist_id}","starred_url":"https://api.github.com/users/ArchangeGabriel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ArchangeGabriel/subscriptions","organizations_url":"https://api.github.com/users/ArchangeGabriel/orgs","repos_url":"https://api.github.com/users/ArchangeGabriel/repos","events_url":"https://api.github.com/users/ArchangeGabriel/events{/privacy}","received_events_url":"https://api.github.com/users/ArchangeGabriel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-26T12:52:04Z","updated_at":"2022-04-26T12:52:04Z","author_association":"NONE","body":"So just to be sure, with the 3.2.2 release both settings are now the default and unnecessary?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1109758384/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1111854424","html_url":"https://github.com/apache/couchdb/issues/3956#issuecomment-1111854424","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3956","id":1111854424,"node_id":"IC_kwDOAAMmUc5CRY1Y","user":{"login":"guanfeix","id":34960209,"node_id":"MDQ6VXNlcjM0OTYwMjA5","avatar_url":"https://avatars.githubusercontent.com/u/34960209?v=4","gravatar_id":"","url":"https://api.github.com/users/guanfeix","html_url":"https://github.com/guanfeix","followers_url":"https://api.github.com/users/guanfeix/followers","following_url":"https://api.github.com/users/guanfeix/following{/other_user}","gists_url":"https://api.github.com/users/guanfeix/gists{/gist_id}","starred_url":"https://api.github.com/users/guanfeix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guanfeix/subscriptions","organizations_url":"https://api.github.com/users/guanfeix/orgs","repos_url":"https://api.github.com/users/guanfeix/repos","events_url":"https://api.github.com/users/guanfeix/events{/privacy}","received_events_url":"https://api.github.com/users/guanfeix/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-28T07:40:39Z","updated_at":"2022-04-28T09:35:15Z","author_association":"NONE","body":"> Do you have any document attachments in that database, or any views that emit a lot of rows and/or data, or a lot of deleted/removed documents? I think those factors could explain the disk usage.\r\n> \r\n> Also, what is the disk usage of the replicated database? Is it similar to the original one?\r\n\r\nYes, a lot of views in some of most common use databaseï¼Œit maybe cache a lot data. And I learn about difference between df and du cmd, is  phantom file.So when use lsof|grep deleted, I found a lot of such  deleted file in ubuntu.But how can I to avoid such use by that.\r\nAs for the replicated database,it have little difference.\r\n![å›¾ç‰‡](https://user-images.githubusercontent.com/34960209/165722314-8df09cf3-706d-4c4b-a3ae-4526358b7ed5.png)\r\n![å›¾ç‰‡](https://user-images.githubusercontent.com/34960209/165723765-b2cf1a57-f45a-422a-b9b7-ef1c95726a23.png)\r\n\r\n![å›¾ç‰‡](https://user-images.githubusercontent.com/34960209/165701763-2fd1438d-1dee-4fb0-a5d9-a79442e41a67.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1111854424/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1112096540","html_url":"https://github.com/apache/couchdb/issues/3937#issuecomment-1112096540","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3937","id":1112096540,"node_id":"IC_kwDOAAMmUc5CST8c","user":{"login":"jo","id":17586,"node_id":"MDQ6VXNlcjE3NTg2","avatar_url":"https://avatars.githubusercontent.com/u/17586?v=4","gravatar_id":"","url":"https://api.github.com/users/jo","html_url":"https://github.com/jo","followers_url":"https://api.github.com/users/jo/followers","following_url":"https://api.github.com/users/jo/following{/other_user}","gists_url":"https://api.github.com/users/jo/gists{/gist_id}","starred_url":"https://api.github.com/users/jo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jo/subscriptions","organizations_url":"https://api.github.com/users/jo/orgs","repos_url":"https://api.github.com/users/jo/repos","events_url":"https://api.github.com/users/jo/events{/privacy}","received_events_url":"https://api.github.com/users/jo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-28T11:34:03Z","updated_at":"2022-05-04T21:04:19Z","author_association":"CONTRIBUTOR","body":"also very nice for `_changes` and `_bulk_get`","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1112096540/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1112526575","html_url":"https://github.com/apache/couchdb/issues/1305#issuecomment-1112526575","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1305","id":1112526575,"node_id":"IC_kwDOAAMmUc5CT87v","user":{"login":"FoxUSA","id":886680,"node_id":"MDQ6VXNlcjg4NjY4MA==","avatar_url":"https://avatars.githubusercontent.com/u/886680?v=4","gravatar_id":"","url":"https://api.github.com/users/FoxUSA","html_url":"https://github.com/FoxUSA","followers_url":"https://api.github.com/users/FoxUSA/followers","following_url":"https://api.github.com/users/FoxUSA/following{/other_user}","gists_url":"https://api.github.com/users/FoxUSA/gists{/gist_id}","starred_url":"https://api.github.com/users/FoxUSA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/FoxUSA/subscriptions","organizations_url":"https://api.github.com/users/FoxUSA/orgs","repos_url":"https://api.github.com/users/FoxUSA/repos","events_url":"https://api.github.com/users/FoxUSA/events{/privacy}","received_events_url":"https://api.github.com/users/FoxUSA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-28T18:24:16Z","updated_at":"2022-04-28T18:24:16Z","author_association":"NONE","body":"> [httpd]\r\n> WWW-Authenticate = Basic realm=\"administrator\"\r\n\r\n@wohali \r\nIs this changing? I see folks link to documents that do not have this noted.\r\n\r\n\r\n> Hi there,\r\n> \r\n> On macOS, i finally managed to resolve this with the following config :\r\n> \r\n> ```\r\n> # ~/Library/Preferences/couchdb2-local.ini\r\n> \r\n> [httpd]\r\n> WWW-Authenticate = Basic realm=\"Welcome to the Couch!\"\r\n> ```\r\n> \r\n> Found in the [official documentation](https://docs.couchdb.org/en/stable/config/http.html#httpd/WWW-Authenticate) :)\r\n> \r\n> Hope this helps, Regards\r\n\r\nWhen using the [Docker image](https://hub.docker.com/_/couchdb), you don't see this note in the ini and it is not [noted on the documentation](https://docs.couchdb.org/en/stable/config/auth.html#chttpd/require_valid_user) for the `require_valid_user` field.\r\n\r\nSo the only way to know about this is to hit it from what I can see.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1112526575/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1113774877","html_url":"https://github.com/apache/couchdb/pull/3940#issuecomment-1113774877","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3940","id":1113774877,"node_id":"IC_kwDOAAMmUc5CYtsd","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-29T21:44:29Z","updated_at":"2022-04-29T21:44:29Z","author_association":"CONTRIBUTOR","body":"@kocolosk Since I had some of this paged in memory, since we looked at it recently, thought I'd give it a try and continue updating the PR.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1113774877/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1113828032","html_url":"https://github.com/apache/couchdb/pull/3940#issuecomment-1113828032","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3940","id":1113828032,"node_id":"IC_kwDOAAMmUc5CY6rA","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-29T22:29:05Z","updated_at":"2022-05-14T15:12:55Z","author_association":"CONTRIBUTOR","body":"I updated the PR to handle multiple attachments and even (potentially) multiple parser processes. Then added a few \"belt and suspenders\" checks.\r\n\r\nAnother issue not sure yet how to solve is when all the the workers already have the attachment(s), and we never consume (flush) the socket attachment data. That would leave data in the socket and mess up the subsequent client request if they are re-using HTTP connections. Perhaps we should try to flush the data (up to some timeout / size) in order to help out with connection logic/reuse. Then if not all data has flushed, tell mochiweb to force close the connection as it's not safe to re-use.\r\n\r\nThinking about MP parser upload I also remembered  the interesting behavior where we responded to the user before we had actually waited to upload the MP data and how it generated some odd logs which confused users. It would be this snippet https://github.com/apache/couchdb/blob/fedf37da2d9edc92340cc9d92e6affa346ab01f6/src/chttpd/src/chttpd_db.erl#L1196-L1198\r\n\r\nIt might make sense to make the fabric request first, then call the wait function, and only then reply to the client?\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1113828032/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1113982850","html_url":"https://github.com/apache/couchdb/issues/3981#issuecomment-1113982850","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3981","id":1113982850,"node_id":"IC_kwDOAAMmUc5CZgeC","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-30T12:44:23Z","updated_at":"2022-04-30T12:44:23Z","author_association":"CONTRIBUTOR","body":"Hi,\r\n\r\nI would say that this problem is not related to CouchDB. So maybe you should talk again to the people of Budibase.\r\nMove this issue to discussions.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1113982850/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1113983490","html_url":"https://github.com/apache/couchdb/issues/4010#issuecomment-1113983490","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4010","id":1113983490,"node_id":"IC_kwDOAAMmUc5CZgoC","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-04-30T12:48:55Z","updated_at":"2022-04-30T12:48:55Z","author_association":"CONTRIBUTOR","body":"Please dont open topics as issue and discussion. Closing this for now. Continue in #4009","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1113983490/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1114516844","html_url":"https://github.com/apache/couchdb/pull/3979#issuecomment-1114516844","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3979","id":1114516844,"node_id":"IC_kwDOAAMmUc5Cbi1s","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-02T05:44:21Z","updated_at":"2022-05-02T05:44:21Z","author_association":"CONTRIBUTOR","body":"@nickva mind taking a second look at this?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1114516844/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1115375364","html_url":"https://github.com/apache/couchdb/pull/3979#issuecomment-1115375364","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3979","id":1115375364,"node_id":"IC_kwDOAAMmUc5Ce0cE","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-02T21:14:12Z","updated_at":"2022-05-02T21:14:12Z","author_association":"CONTRIBUTOR","body":"@tonysun83 looks pretty good, nice work!\r\n\r\nI think one more thing we're missing is turning the {error, ResultsOrErrors} into a proper 500 where users get the actual errors instead of a clause match.\r\n\r\nI wonder if something like this could work?\r\n\r\n```diff\r\nindex cfae8ad5f..157467104 100644\r\n--- a/src/chttpd/src/chttpd_db.erl\r\n+++ b/src/chttpd/src/chttpd_db.erl\r\n@@ -633,6 +633,15 @@ db_req(#httpd{method = 'POST', path_parts = [_, <<\"_bulk_docs\">>], user_ctx = Ct\r\n                         Results\r\n                     ),\r\n                     send_json(Req, 202, DocResults);\r\n+                {error, Results} ->\r\n+                    % output the results\r\n+                    chttpd_stats:incr_writes(length(Results)),\r\n+                    DocResults = lists:zipwith(\r\n+                        fun update_doc_result_to_json/2,\r\n+                        Docs,\r\n+                        Results\r\n+                    ),\r\n+                    send_json(Req, 500, DocResults);\r\n                 {aborted, Errors} ->\r\n                     ErrorsJson =\r\n                         lists:map(fun update_doc_result_to_json/1, Errors),\r\n@@ -647,8 +656,12 @@ db_req(#httpd{method = 'POST', path_parts = [_, <<\"_bulk_docs\">>], user_ctx = Ct\r\n                 {accepted, Errors} ->\r\n                     chttpd_stats:incr_writes(length(Docs)),\r\n                     ErrorsJson = lists:map(fun update_doc_result_to_json/1, Errors),\r\n-                    send_json(Req, 202, ErrorsJson)\r\n-            end;\r\n+                    send_json(Req, 202, ErrorsJson);\r\n+                {error, Errors} ->\r\n+                    chttpd_stats:incr_writes(length(Docs)),\r\n+                    ErrorsJson = lists:map(fun update_doc_result_to_json/1, Errors),\r\n+                    send_json(Req, 500, ErrorsJson)\r\n+             end;\r\n         _ ->\r\n             throw({bad_request, <<\"`new_edits` parameter must be a boolean.\">>})\r\n     end;\r\n@@ -1472,6 +1485,12 @@ receive_request_data(Req, LenLeft) when LenLeft > 0 ->\r\n receive_request_data(_Req, _) ->\r\n     throw(<<\"expected more data\">>).\r\n\r\n+update_doc_result_to_json({error, _} = Error) ->\r\n+    {_Code, Err, Msg} = chttpd:error_info(Error),\r\n+    {[\r\n+         {error, Err},\r\n+         {reson, Msg}\r\n+    ]};\r\n update_doc_result_to_json({{Id, Rev}, Error}) ->\r\n     {_Code, Err, Msg} = chttpd:error_info(Error),\r\n     {[\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1115375364/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1115509189","html_url":"https://github.com/apache/couchdb/pull/3979#issuecomment-1115509189","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3979","id":1115509189,"node_id":"IC_kwDOAAMmUc5CfVHF","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-03T00:50:09Z","updated_at":"2022-05-03T00:50:46Z","author_association":"CONTRIBUTOR","body":"@nickva updated with your changes. I realized that I when I called `erlang:error`, bubbled up as a 500 so we didn't need to add the extra clause. But now since we're returning {error, internal_server_error}, then we do it need. Nice catch. If you get a chance mind running the script on your end to see we actually get the correct 500? My python packages broke for some reason and I get some weird `decode` error coming from couchdb python library.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1115509189/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1117748528","html_url":"https://github.com/apache/couchdb/issues/3948#issuecomment-1117748528","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3948","id":1117748528,"node_id":"IC_kwDOAAMmUc5Cn30w","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-04T19:33:23Z","updated_at":"2022-05-04T19:33:23Z","author_association":"CONTRIBUTOR","body":"This was fixed. Thanks @tonysun83 !","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1117748528/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590018","html_url":"https://github.com/apache/couchdb/issues/4222#issuecomment-1280590018","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4222","id":1280590018,"node_id":"IC_kwDOAAMmUc5MVEDC","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-05T11:15:59Z","updated_at":"2022-05-05T11:15:59Z","author_association":"CONTRIBUTOR","body":"Hi, is this still a problem? How do you check for a running CouchDB?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590018/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1119980295","html_url":"https://github.com/apache/couchdb/pull/4016#issuecomment-1119980295","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4016","id":1119980295,"node_id":"IC_kwDOAAMmUc5CwYsH","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-06T20:19:06Z","updated_at":"2022-05-06T20:19:06Z","author_association":"CONTRIBUTOR","body":"As an additional note for reviewers: the `{DocId, Err}` is generated in https://github.com/apache/couchdb/blob/6462712b755f5b4c40e575776438e6c66e4e684b/src/couch/src/couch_db.erl#L1168-L1171\r\n\r\nReplicated changes return `[]` on success so they need to keep the `DocId` value in the error responses, otherwise it's impossible to know which document failed.  Interactive updates, on the other hand, can return just the results (for example, `{forbidden, Reason}`) and the coordinator will always map every document to every response.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1119980295/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1120167341","html_url":"https://github.com/apache/couchdb/issues/1510#issuecomment-1120167341","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1510","id":1120167341,"node_id":"IC_kwDOAAMmUc5CxGWt","user":{"login":"jeremielodi","id":25838121,"node_id":"MDQ6VXNlcjI1ODM4MTIx","avatar_url":"https://avatars.githubusercontent.com/u/25838121?v=4","gravatar_id":"","url":"https://api.github.com/users/jeremielodi","html_url":"https://github.com/jeremielodi","followers_url":"https://api.github.com/users/jeremielodi/followers","following_url":"https://api.github.com/users/jeremielodi/following{/other_user}","gists_url":"https://api.github.com/users/jeremielodi/gists{/gist_id}","starred_url":"https://api.github.com/users/jeremielodi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeremielodi/subscriptions","organizations_url":"https://api.github.com/users/jeremielodi/orgs","repos_url":"https://api.github.com/users/jeremielodi/repos","events_url":"https://api.github.com/users/jeremielodi/events{/privacy}","received_events_url":"https://api.github.com/users/jeremielodi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-07T08:43:44Z","updated_at":"2022-05-08T01:07:06Z","author_association":"NONE","body":"Why not to incorporation  features like https://github.com/AlaSQL/alasql for retrieving data?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1120167341/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1120228804","html_url":"https://github.com/apache/couchdb/issues/1753#issuecomment-1120228804","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1753","id":1120228804,"node_id":"IC_kwDOAAMmUc5CxVXE","user":{"login":"ParkSeungwon","id":11606527,"node_id":"MDQ6VXNlcjExNjA2NTI3","avatar_url":"https://avatars.githubusercontent.com/u/11606527?v=4","gravatar_id":"","url":"https://api.github.com/users/ParkSeungwon","html_url":"https://github.com/ParkSeungwon","followers_url":"https://api.github.com/users/ParkSeungwon/followers","following_url":"https://api.github.com/users/ParkSeungwon/following{/other_user}","gists_url":"https://api.github.com/users/ParkSeungwon/gists{/gist_id}","starred_url":"https://api.github.com/users/ParkSeungwon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ParkSeungwon/subscriptions","organizations_url":"https://api.github.com/users/ParkSeungwon/orgs","repos_url":"https://api.github.com/users/ParkSeungwon/repos","events_url":"https://api.github.com/users/ParkSeungwon/events{/privacy}","received_events_url":"https://api.github.com/users/ParkSeungwon/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-07T15:32:41Z","updated_at":"2022-05-07T15:32:41Z","author_association":"NONE","body":"Compaction configuration seems to have changed in 3.2.\r\nHow can I disable auto compaction in couchdb version 3.2?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1120228804/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1131767871","html_url":"https://github.com/apache/couchdb/issues/4029#issuecomment-1131767871","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4029","id":1131767871,"node_id":"IC_kwDOAAMmUc5DdWg_","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-09T08:04:39Z","updated_at":"2022-05-09T08:04:39Z","author_association":"CONTRIBUTOR","body":"Hi,\r\n\r\ncan you show me the content of your `vm.args` file please?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1131767871/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1120822776","html_url":"https://github.com/apache/couchdb/issues/2306#issuecomment-1120822776","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2306","id":1120822776,"node_id":"IC_kwDOAAMmUc5CzmX4","user":{"login":"ArchangeGabriel","id":490531,"node_id":"MDQ6VXNlcjQ5MDUzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/490531?v=4","gravatar_id":"","url":"https://api.github.com/users/ArchangeGabriel","html_url":"https://github.com/ArchangeGabriel","followers_url":"https://api.github.com/users/ArchangeGabriel/followers","following_url":"https://api.github.com/users/ArchangeGabriel/following{/other_user}","gists_url":"https://api.github.com/users/ArchangeGabriel/gists{/gist_id}","starred_url":"https://api.github.com/users/ArchangeGabriel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ArchangeGabriel/subscriptions","organizations_url":"https://api.github.com/users/ArchangeGabriel/orgs","repos_url":"https://api.github.com/users/ArchangeGabriel/repos","events_url":"https://api.github.com/users/ArchangeGabriel/events{/privacy}","received_events_url":"https://api.github.com/users/ArchangeGabriel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-09T08:49:17Z","updated_at":"2022-05-09T08:49:17Z","author_association":"NONE","body":"FTR, all this was discussed in #999.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1120822776/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1120831878","html_url":"https://github.com/apache/couchdb/issues/999#issuecomment-1120831878","issue_url":"https://api.github.com/repos/apache/couchdb/issues/999","id":1120831878,"node_id":"IC_kwDOAAMmUc5CzomG","user":{"login":"ArchangeGabriel","id":490531,"node_id":"MDQ6VXNlcjQ5MDUzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/490531?v=4","gravatar_id":"","url":"https://api.github.com/users/ArchangeGabriel","html_url":"https://github.com/ArchangeGabriel","followers_url":"https://api.github.com/users/ArchangeGabriel/followers","following_url":"https://api.github.com/users/ArchangeGabriel/following{/other_user}","gists_url":"https://api.github.com/users/ArchangeGabriel/gists{/gist_id}","starred_url":"https://api.github.com/users/ArchangeGabriel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ArchangeGabriel/subscriptions","organizations_url":"https://api.github.com/users/ArchangeGabriel/orgs","repos_url":"https://api.github.com/users/ArchangeGabriel/repos","events_url":"https://api.github.com/users/ArchangeGabriel/events{/privacy}","received_events_url":"https://api.github.com/users/ArchangeGabriel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-09T08:57:49Z","updated_at":"2022-05-09T08:57:49Z","author_association":"NONE","body":"After a simple testing, the `ERL_EPMD_ADDRESS=127.0.0.1` bit is still required even with 3.2.2. Is that expected? I could see the addition of the `vm.args` bit in the 3.2.1 to 3.2.2 diff, but nothing regarding `epmd` bidding. Is that correct? What should do distro packagers then? Set this variable by default?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1120831878/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1120885056","html_url":"https://github.com/apache/couchdb/issues/999#issuecomment-1120885056","issue_url":"https://api.github.com/repos/apache/couchdb/issues/999","id":1120885056,"node_id":"IC_kwDOAAMmUc5Cz1lA","user":{"login":"ArchangeGabriel","id":490531,"node_id":"MDQ6VXNlcjQ5MDUzMQ==","avatar_url":"https://avatars.githubusercontent.com/u/490531?v=4","gravatar_id":"","url":"https://api.github.com/users/ArchangeGabriel","html_url":"https://github.com/ArchangeGabriel","followers_url":"https://api.github.com/users/ArchangeGabriel/followers","following_url":"https://api.github.com/users/ArchangeGabriel/following{/other_user}","gists_url":"https://api.github.com/users/ArchangeGabriel/gists{/gist_id}","starred_url":"https://api.github.com/users/ArchangeGabriel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ArchangeGabriel/subscriptions","organizations_url":"https://api.github.com/users/ArchangeGabriel/orgs","repos_url":"https://api.github.com/users/ArchangeGabriel/repos","events_url":"https://api.github.com/users/ArchangeGabriel/events{/privacy}","received_events_url":"https://api.github.com/users/ArchangeGabriel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-09T09:46:54Z","updated_at":"2022-05-09T09:46:54Z","author_association":"NONE","body":"So that part of the fix is indeed solved at packaging level, thanks to @janl for pointing to https://github.com/apache/couchdb-pkg/pull/92/files on oss-security.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1120885056/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1122728929","html_url":"https://github.com/apache/couchdb/issues/3988#issuecomment-1122728929","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3988","id":1122728929,"node_id":"IC_kwDOAAMmUc5C63vh","user":{"login":"tan-tony","id":52731609,"node_id":"MDQ6VXNlcjUyNzMxNjA5","avatar_url":"https://avatars.githubusercontent.com/u/52731609?v=4","gravatar_id":"","url":"https://api.github.com/users/tan-tony","html_url":"https://github.com/tan-tony","followers_url":"https://api.github.com/users/tan-tony/followers","following_url":"https://api.github.com/users/tan-tony/following{/other_user}","gists_url":"https://api.github.com/users/tan-tony/gists{/gist_id}","starred_url":"https://api.github.com/users/tan-tony/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tan-tony/subscriptions","organizations_url":"https://api.github.com/users/tan-tony/orgs","repos_url":"https://api.github.com/users/tan-tony/repos","events_url":"https://api.github.com/users/tan-tony/events{/privacy}","received_events_url":"https://api.github.com/users/tan-tony/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-10T18:27:23Z","updated_at":"2022-05-10T18:27:23Z","author_association":"NONE","body":"@nickva  you were right about this. _replicator is not longer available under 5984 but still shows under 5986/_all_dbs\r\n```\r\n  \"_replicator\",\r\n  \"shards/00000000-ffffffff/_replicator.1490425937\",\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1122728929/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1122884739","html_url":"https://github.com/apache/couchdb/issues/3988#issuecomment-1122884739","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3988","id":1122884739,"node_id":"IC_kwDOAAMmUc5C7dyD","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-10T21:26:04Z","updated_at":"2022-05-10T21:26:04Z","author_association":"CONTRIBUTOR","body":"I think that solves the mystery! Let's close the issue","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1122884739/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1124304376","html_url":"https://github.com/apache/couchdb/pull/4021#issuecomment-1124304376","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4021","id":1124304376,"node_id":"IC_kwDOAAMmUc5DA4X4","user":{"login":"noahshaw11","id":47468872,"node_id":"MDQ6VXNlcjQ3NDY4ODcy","avatar_url":"https://avatars.githubusercontent.com/u/47468872?v=4","gravatar_id":"","url":"https://api.github.com/users/noahshaw11","html_url":"https://github.com/noahshaw11","followers_url":"https://api.github.com/users/noahshaw11/followers","following_url":"https://api.github.com/users/noahshaw11/following{/other_user}","gists_url":"https://api.github.com/users/noahshaw11/gists{/gist_id}","starred_url":"https://api.github.com/users/noahshaw11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahshaw11/subscriptions","organizations_url":"https://api.github.com/users/noahshaw11/orgs","repos_url":"https://api.github.com/users/noahshaw11/repos","events_url":"https://api.github.com/users/noahshaw11/events{/privacy}","received_events_url":"https://api.github.com/users/noahshaw11/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-11T21:18:23Z","updated_at":"2022-05-11T21:18:23Z","author_association":"CONTRIBUTOR","body":"You may want to change it in `smoosh_channel.erl` too. That is where the majority of logging comes from.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1124304376/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1125319110","html_url":"https://github.com/apache/couchdb/pull/3940#issuecomment-1125319110","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3940","id":1125319110,"node_id":"IC_kwDOAAMmUc5DEwHG","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-12T18:52:19Z","updated_at":"2022-05-13T20:40:09Z","author_association":"CONTRIBUTOR","body":"With the latest update I made sure the PUT request always waits for the attachment data to upload before responding to the user. If the revisions are all already present with a `new_edits=false` the MP parser will go into `mp_abort_parse_atts` where it will keep draining the uploaded attachment data.\r\n\r\nTo verify that, enhanced the attachment elixir tests to upload larger attachments more times in a row. Use `[{:max_sessions, 1}, {:max_pipeline_size, 1}]` ibrowse options to help ensure the connections are actually re-used.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1125319110/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1126371484","html_url":"https://github.com/apache/couchdb/issues/4023#issuecomment-1126371484","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4023","id":1126371484,"node_id":"IC_kwDOAAMmUc5DIxCc","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-13T19:21:14Z","updated_at":"2022-05-13T19:21:14Z","author_association":"CONTRIBUTOR","body":"@tudordumitriu a replication worker is one of the 4 (by default) processes spawned by each replication job. They perform `GET /_revs_diff` requests on the target to get the missing revisions, then a `GET` with open_revs to the source to fetch all the missing revisions, then, finally, a ` POST /_bulk_docs` to the target to insert the docs. So it could be any of those requests which returned an invalid_json response.\r\n\r\n`invalid_json` can often mean that the connection is abruptly terminated, for example if a rate limit is reached or the connection times out, maybe max size is reached and the response it terminated and so on. It's hard to say which one of those or other error happened without extra log or information. Would you be able to get more logs form the servers, or ideally capture the request/response bodies?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1126371484/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1126565245","html_url":"https://github.com/apache/couchdb/pull/3940#issuecomment-1126565245","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3940","id":1126565245,"node_id":"IC_kwDOAAMmUc5DJgV9","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-13T23:01:15Z","updated_at":"2022-05-13T23:01:15Z","author_association":"CONTRIBUTOR","body":"Doing another PR check made sure that:\r\n  * Every time we handle `get_bytes` we also handle `hello_from_writer` message.\r\n  * The [update_writer clause](https://github.com/apache/couchdb/pull/3940/files#diff-cf3da248d520cba953ab4acd454b69bf3caad22d2213f044934a8f848acb029bR224-R227), where we don't find an existing `WriterPid -> {WriterRef, 0}` from a `hello_from_writer` entry, also would ensure attachments continue working in a mixed cluster environment during a rolling upgrade. In that case old version nodes won't be sending `hello_from_writer` messages.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1126565245/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1129346942","html_url":"https://github.com/apache/couchdb/pull/3940#issuecomment-1129346942","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3940","id":1129346942,"node_id":"IC_kwDOAAMmUc5DUHd-","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-17T21:46:26Z","updated_at":"2022-05-17T21:46:26Z","author_association":"CONTRIBUTOR","body":"> With the latest update I made sure the PUT request always waits for the attachment data to upload before responding to the user. If the revisions are all already present with a `new_edits=false` the MP parser will go into `mp_abort_parse_atts` where it will keep draining the uploaded attachment data.\r\n\r\nWould you consider this a change in behavior to warrant a documentation change and/or a release note?\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1129346942/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1129350000","html_url":"https://github.com/apache/couchdb/pull/3940#issuecomment-1129350000","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3940","id":1129350000,"node_id":"IC_kwDOAAMmUc5DUINw","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-17T21:50:40Z","updated_at":"2022-05-17T21:50:40Z","author_association":"CONTRIBUTOR","body":"> Would you consider this a change in behavior to warrant a documentation change and/or a release note?\r\n\r\n@jaydoane it would be a bug fix, I think. We were responding to the user that we created the resource but we hadn't actually created the full resource yet (the document and attachment).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1129350000/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1129856868","html_url":"https://github.com/apache/couchdb/issues/4026#issuecomment-1129856868","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4026","id":1129856868,"node_id":"IC_kwDOAAMmUc5DWD9k","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-18T10:47:01Z","updated_at":"2022-05-18T10:47:01Z","author_association":"MEMBER","body":"This is non-trivial. The N copies of the database are not in the same order, and the indexes are in the order of the corresponding data shard. It is not just a case of reading multiple indexes to form a quorum.\r\n\r\nThe only plausible fix is to ensure that all the N replicas of a database are in the same order, which involves adding strong consensus.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1129856868/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1129858497","html_url":"https://github.com/apache/couchdb/issues/4026#issuecomment-1129858497","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4026","id":1129858497,"node_id":"IC_kwDOAAMmUc5DWEXB","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-18T10:49:02Z","updated_at":"2022-05-18T10:49:02Z","author_association":"MEMBER","body":"as for \"Many endpoints respond only when a quorum of replicas have responded\" I think it's actually a minority. Specifically only those that read or write documents. Even that quorum is not guaranteed, couchdb will lower the quorum threshold all the way down to one if it believes the other nodes are unavailable (e.g, during a network partition that isolated a single node, that node would continue to serve read and write requests for the documents it hosts).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1129858497/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1130222316","html_url":"https://github.com/apache/couchdb/pull/3985#issuecomment-1130222316","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3985","id":1130222316,"node_id":"IC_kwDOAAMmUc5DXdLs","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-18T16:18:19Z","updated_at":"2022-05-18T16:18:19Z","author_association":"CONTRIBUTOR","body":"I have a bunch of compilation warnings due to missed export of an API function.\r\n\r\n```\r\nsrc/couch/src/couch_debug.erl:675: Warning: function resource_hoggers_snapshot/1 is unused\r\nsrc/couch/src/couch_debug.erl:693: Warning: function update_delta/2 is unused\r\nsrc/couch/src/couch_debug.erl:705: Warning: function analyze_resource_hoggers/2 is unused\r\nsrc/couch/src/couch_debug.erl:706: Warning: variable 'Id' is unused\r\nsrc/couch/src/couch_debug.erl:706: Warning: variable 'Pid' is unused\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1130222316/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1130332490","html_url":"https://github.com/apache/couchdb/pull/3940#issuecomment-1130332490","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3940","id":1130332490,"node_id":"IC_kwDOAAMmUc5DX4FK","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-18T18:02:48Z","updated_at":"2022-05-18T18:02:48Z","author_association":"CONTRIBUTOR","body":"We discussed this in CouchDB dev Slack channel https://couchdb.slack.com/archives/C01TBE2J197/p1652884254041759\r\n\r\nThe consensus was that it's the better of all the (not great) choices.\r\n \r\nThanks for @jcoglan for digging in, discovering and help debug the problem!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1130332490/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1130448735","html_url":"https://github.com/apache/couchdb/pull/3985#issuecomment-1130448735","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3985","id":1130448735,"node_id":"IC_kwDOAAMmUc5DYUdf","user":{"login":"noahshaw11","id":47468872,"node_id":"MDQ6VXNlcjQ3NDY4ODcy","avatar_url":"https://avatars.githubusercontent.com/u/47468872?v=4","gravatar_id":"","url":"https://api.github.com/users/noahshaw11","html_url":"https://github.com/noahshaw11","followers_url":"https://api.github.com/users/noahshaw11/followers","following_url":"https://api.github.com/users/noahshaw11/following{/other_user}","gists_url":"https://api.github.com/users/noahshaw11/gists{/gist_id}","starred_url":"https://api.github.com/users/noahshaw11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahshaw11/subscriptions","organizations_url":"https://api.github.com/users/noahshaw11/orgs","repos_url":"https://api.github.com/users/noahshaw11/repos","events_url":"https://api.github.com/users/noahshaw11/events{/privacy}","received_events_url":"https://api.github.com/users/noahshaw11/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-18T19:37:55Z","updated_at":"2022-05-18T22:08:10Z","author_association":"CONTRIBUTOR","body":"Example return from `resource_hoggers`:\r\n```\r\n(node1@127.0.0.1)5> couch_debug:resource_hoggers(MI, memory).\r\n|                        id                        |       memory\r\n|                 config[<0.136.0>]                |      1115104\r\n|         couch_prometheus_server[<0.279.0>]       |       973176\r\n|               code_server[<0.51.0>]              |       689448\r\n|             erlang:apply/2[<0.972.0>]            |       689368\r\n|     couch_epi_data_gen_flags_config[<0.158.0>]   |       284640\r\n|             erlang:apply/2[<0.971.0>]            |       264040\r\n|            couch_log_server[<0.167.0>]           |       263944\r\n|  ouch_epi_functions_gen_chttpd_handlers[<0.145.0>|       196912\r\n|             erl_prim_loader[<0.10.0>]            |       196904\r\n|         couch_stats_aggregator[<0.183.0>]        |       176296\r\n|    couch_epi_functions_gen_couch_db[<0.149.0>]   |       176216\r\n|           couch_proc_manager[<0.337.0>]          |       142872\r\n|        couch_secondary_services[<0.335.0>]       |       110240\r\n|  couch_epi_data_gen_dreyfus_black_list[<0.153.0>]|       109280\r\n|              config_event[<0.137.0>]             |       57016\r\n|               couch_httpd[<0.393.0>]             |       43728\r\n|              standard_error[<0.68.0>]            |       42304\r\n|  couch_epi_functions_gen_global_changes[<0.160.0>|       42264\r\n|  couch_epi_functions_gen_feature_flags[<0.156.0>]|       42264\r\n|   couch_epi_functions_gen_couch_index[<0.151.0>] |       42264\r\nok\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1130448735/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1130492693","html_url":"https://github.com/apache/couchdb/pull/3985#issuecomment-1130492693","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3985","id":1130492693,"node_id":"IC_kwDOAAMmUc5DYfMV","user":{"login":"noahshaw11","id":47468872,"node_id":"MDQ6VXNlcjQ3NDY4ODcy","avatar_url":"https://avatars.githubusercontent.com/u/47468872?v=4","gravatar_id":"","url":"https://api.github.com/users/noahshaw11","html_url":"https://github.com/noahshaw11","followers_url":"https://api.github.com/users/noahshaw11/followers","following_url":"https://api.github.com/users/noahshaw11/following{/other_user}","gists_url":"https://api.github.com/users/noahshaw11/gists{/gist_id}","starred_url":"https://api.github.com/users/noahshaw11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahshaw11/subscriptions","organizations_url":"https://api.github.com/users/noahshaw11/orgs","repos_url":"https://api.github.com/users/noahshaw11/repos","events_url":"https://api.github.com/users/noahshaw11/events{/privacy}","received_events_url":"https://api.github.com/users/noahshaw11/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-18T20:15:37Z","updated_at":"2022-05-18T22:07:01Z","author_association":"CONTRIBUTOR","body":"Example return from `analyze_resource_hoggers`:\r\n```\r\n(node1@127.0.0.1)4> couch_debug:analyze_resource_hoggers(RHS, 2).\r\nNumber of snapshots: 1\r\nTop 2 by binary\r\n|                        id                        |       binary\r\n|               code_server[<0.51.0>]              |       106956\r\n|         couch_prometheus_server[<0.279.0>]       |       47233\r\nTop 2 by dictionary\r\n|                        id                        |     dictionary\r\n|               global_group[<0.64.0>]             |         5\r\n|            couch_file:init/1[<0.935.0>]          |         4\r\nTop 2 by heap_size\r\n|                        id                        |     heap_size\r\n|         couch_prometheus_server[<0.279.0>]       |       121536\r\n|                 config[<0.136.0>]                |       17731\r\nTop 2 by links\r\n|                        id                        |       links\r\n|              config_event[<0.137.0>]             |         50\r\n|          application_controller[<0.44.0>]        |         31\r\nTop 2 by memory\r\n|                        id                        |       memory\r\n|                 config[<0.136.0>]                |      1115104\r\n|         couch_prometheus_server[<0.279.0>]       |       973176\r\nTop 2 by message_queue_len\r\n|                        id                        | message_queue_len\r\n|      couch_multidb_changes:init/1[<0.1006.0>]    |         0\r\n|             erlang:apply/2[<0.971.0>]            |         0\r\nTop 2 by monitored_by\r\n|                        id                        |    monitored_by\r\n|     fabric_db_update_listener:go/4[<0.545.0>]    |         3\r\n|            couch_file:init/1[<0.935.0>]          |         2\r\nTop 2 by monitors\r\n|                        id                        |      monitors\r\n|           couch_event_server[<0.258.0>]          |         28\r\n|          logger_handler_watcher[<0.75.0>]        |         2\r\nTop 2 by stack_size\r\n|                        id                        |     stack_size\r\n|  chttpd_auth_cache:listen_for_changes/1[<0.486.0>|         27\r\n|     fabric_db_update_listener:go/4[<0.545.0>]    |         25\r\nTop 2 by total_heap_size\r\n|                        id                        |  total_heap_size\r\n|                 config[<0.136.0>]                |       139267\r\n|         couch_prometheus_server[<0.279.0>]       |       121536\r\n[ok,ok,ok,ok,ok,ok,ok,ok,ok,ok]\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1130492693/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1132104867","html_url":"https://github.com/apache/couchdb/issues/3882#issuecomment-1132104867","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3882","id":1132104867,"node_id":"IC_kwDOAAMmUc5Deoyj","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-19T19:14:00Z","updated_at":"2022-05-19T20:01:33Z","author_association":"CONTRIBUTOR","body":"@rg54 The log line you have is from journalctl so it looks like it was forwarded there somehow. I verified on a system which runs just rsyslog that we are sending logs to `local2` facility. I can see the messages have the appropriate `<Priority>` prefix.  (`Priority` for syslog is `Facility * 8 + Level`).\r\n\r\nIn your case perhaps it helps to see how log forwarding happens to the journal, at some point the message priorities may be overridden to have the general \"daemon\" facility since they end up in journald...\r\n\r\nCould try, for example, to change `local2` to `local3` or `local1` and see if `priority` and `syslog_facility` values in the journal would change accordingly.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1132104867/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1132911389","html_url":"https://github.com/apache/couchdb/issues/3882#issuecomment-1132911389","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3882","id":1132911389,"node_id":"IC_kwDOAAMmUc5Dhtsd","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-20T13:36:57Z","updated_at":"2022-05-20T13:36:57Z","author_association":"CONTRIBUTOR","body":"Hi,\r\n\r\ni tried to configure rsyslog to log messages for facility `local2` into a separate file, but no luck. It's always landing  in the daemon.log file (facility 3)...\r\n\r\nMy rsyslog.conf:\r\n```\r\n# /etc/rsyslog.conf configuration file for rsyslog\r\n#\r\n# For more information install rsyslog-doc and see\r\n# /usr/share/doc/rsyslog-doc/html/configuration/index.html\r\n\r\n\r\n#################\r\n#### MODULES ####\r\n#################\r\n\r\nmodule(load=\"imuxsock\") # provides support for local system logging\r\nmodule(load=\"imklog\")   # provides kernel logging support\r\n#module(load=\"immark\")  # provides --MARK-- message capability\r\n\r\n# provides UDP syslog reception\r\n#module(load=\"imudp\")\r\n#input(type=\"imudp\" port=\"514\")\r\n\r\n# provides TCP syslog reception\r\n#module(load=\"imtcp\")\r\n#input(type=\"imtcp\" port=\"514\")\r\n\r\n\r\n###########################\r\n#### GLOBAL DIRECTIVES ####\r\n###########################\r\n\r\n#\r\n# Use traditional timestamp format.\r\n# To enable high precision timestamps, comment out the following line.\r\n#\r\n$ActionFileDefaultTemplate RSYSLOG_TraditionalFileFormat\r\n\r\n#\r\n# Set the default permissions for all log files.\r\n#\r\n$FileOwner root\r\n$FileGroup adm\r\n$FileCreateMode 0640\r\n$DirCreateMode 0755\r\n$Umask 0022\r\n\r\n#\r\n# Where to place spool and state files\r\n#\r\n$WorkDirectory /var/spool/rsyslog\r\n\r\n#\r\n# Include all config files in /etc/rsyslog.d/\r\n#\r\n$IncludeConfig /etc/rsyslog.d/*.conf\r\n\r\n\r\n###############\r\n#### RULES ####\r\n###############\r\n\r\nlocal2.*\t\t\t-/var/log/local2.log\r\n#local3.*\t\t\t/var/log/local2.log\r\n& stop\r\n\r\n#\r\n# First some standard log files.  Log by facility.\r\n#\r\nauth,authpriv.*\t\t\t/var/log/auth.log\r\n*.*;auth,authpriv.none\t\t-/var/log/syslog\r\n#cron.*\t\t\t\t/var/log/cron.log\r\ndaemon.*\t\t\t-/var/log/daemon.log\r\nkern.*\t\t\t\t-/var/log/kern.log\r\nlpr.*\t\t\t\t-/var/log/lpr.log\r\nmail.*\t\t\t\t-/var/log/mail.log\r\nuser.*\t\t\t\t-/var/log/user.log\r\n\r\n#\r\n# Logging for the mail system.  Split it up so that\r\n# it is easy to write scripts to parse these files.\r\n#\r\nmail.info\t\t\t-/var/log/mail.info\r\nmail.warn\t\t\t-/var/log/mail.warn\r\nmail.err\t\t\t/var/log/mail.err\r\n\r\n#\r\n# Some \"catch-all\" log files.\r\n#\r\n*.=debug;\\\r\n\tauth,authpriv.none;\\\r\n\tmail.none\t\t-/var/log/debug\r\n*.=info;*.=notice;*.=warn;\\\r\n\tauth,authpriv.none;\\\r\n\tcron,daemon.none;\\\r\n\tmail.none;\t\t-/var/log/messages\r\n\r\n#\r\n# Emergencies are sent to everybody logged in.\r\n#\r\n*.emerg\t\t\t\t:omusrmsg:*\r\n```\r\n\r\nIf i run\r\n```\r\nlogger -p local2.info \"Test\"\r\n```\r\nit's written to `/var/log/local2.log`.\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1132911389/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1133531414","html_url":"https://github.com/apache/couchdb/issues/3882#issuecomment-1133531414","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3882","id":1133531414,"node_id":"IC_kwDOAAMmUc5DkFEW","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-21T04:47:58Z","updated_at":"2022-05-21T04:47:58Z","author_association":"CONTRIBUTOR","body":"CouchDB's syslog only knows how to use UDP logging. In order to make it work need two changes:\r\n\r\n * Enable UDP socket rsyslog module\r\n```\r\n# provides UDP syslog reception\r\nmodule(load=\"imudp\")\r\ninput(type=\"imudp\" port=\"514\")\r\nlocal2.*\t\t\t-/var/log/local2.log\r\n```\r\n * Make sure to specify a host for the CouchDB's log syslog parameter (localhost should work)\r\n```\r\n[log]\r\nlevel = info\r\nwriter = syslog\r\nsyslog_host = localhost\r\nsyslog_appid = couchdb\r\nsyslog_facility = local2\r\n```\r\n\r\nThen both CouchDB and logger should work. For logger make sure to explicitly force it to use UDP logging otherwise it will still log also to the journal.\r\n\r\n```\r\n$ logger  -P 514 -p local2.info -n 127.0.0.1 -d \"Test1\"\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1133531414/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280589932","html_url":"https://github.com/apache/couchdb/issues/4218#issuecomment-1280589932","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4218","id":1280589932,"node_id":"IC_kwDOAAMmUc5MVEBs","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-21T05:33:06Z","updated_at":"2022-05-21T05:33:06Z","author_association":"CONTRIBUTOR","body":"We do not advise pausing compaction to preserve the history of database. Once database revisions reach past 1000 (_revs_limit) they will start to be removed anyway. Database history should be preserved by the application. When documents are updated, can create a separate document with the old contents and link them together with an ID.\r\n\r\nCompaction can be disabled if there is an operational issue of some sort, There is a `[smoosh.ignore] $dbshard = true` configuration value which can be set for individual shards. For instance:\r\n\r\n```\r\n[smoosh.ignore]\r\nshards/80000000-ffffffff/db1.1122445 = true\r\n```\r\n\r\nBut you'll have to list all the db shards there.\r\n\r\nIf you want to disable all dbs compaction can try:\r\n\r\n```\r\n[smoosh]\r\ndb_channels = upgrade_dbs\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280589932/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280589940","html_url":"https://github.com/apache/couchdb/issues/4218#issuecomment-1280589940","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4218","id":1280589940,"node_id":"IC_kwDOAAMmUc5MVEB0","user":{"login":"ParkSeungwon","id":11606527,"node_id":"MDQ6VXNlcjExNjA2NTI3","avatar_url":"https://avatars.githubusercontent.com/u/11606527?v=4","gravatar_id":"","url":"https://api.github.com/users/ParkSeungwon","html_url":"https://github.com/ParkSeungwon","followers_url":"https://api.github.com/users/ParkSeungwon/followers","following_url":"https://api.github.com/users/ParkSeungwon/following{/other_user}","gists_url":"https://api.github.com/users/ParkSeungwon/gists{/gist_id}","starred_url":"https://api.github.com/users/ParkSeungwon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ParkSeungwon/subscriptions","organizations_url":"https://api.github.com/users/ParkSeungwon/orgs","repos_url":"https://api.github.com/users/ParkSeungwon/repos","events_url":"https://api.github.com/users/ParkSeungwon/events{/privacy}","received_events_url":"https://api.github.com/users/ParkSeungwon/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-21T11:11:18Z","updated_at":"2022-05-21T11:11:18Z","author_association":"NONE","body":"Thanks a lot. Finally I got an answer.\r\nBecause shards will be constantly changing.\r\nI would rather use another option you suggested.\r\n\r\nCould you explain the difference between these two?\r\nBecause to comment out the setting is in the default init file\r\nI presume that this will also disable auto compaction?\r\n\r\n1. \r\n[smoosh]\r\n; db_channels = upgrade_dbs, ratio_dbs, slack_dbs\r\n\r\n2.\r\n[smoosh]\r\ndb_channels = upgrade_dbs\r\n\r\n\r\n---------------------------------------------\r\nI have a suggestion.\r\nIf you are a developer of couchdb, why don't you let people do configuration like this.\r\n[smoosh.ignore]\r\ndb_name = true\r\n\r\nthis will be much easier than listing all shards.\r\nOne of strong point of couchdb is its unique versioning system.\r\nI myself used couchdb because couchdb offers history of db and do not delete old document while updating.\r\nThis is a really cool feature in some cases especially when the data is very important.\r\nI don't understand why you are not giving options to on and off auto compaction to the DB users.\r\nPlease consider this..\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280589940/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1133605103","html_url":"https://github.com/apache/couchdb/issues/3882#issuecomment-1133605103","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3882","id":1133605103,"node_id":"IC_kwDOAAMmUc5DkXDv","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-21T11:40:00Z","updated_at":"2022-05-21T11:40:00Z","author_association":"CONTRIBUTOR","body":"Okay, will try it out. But this info about UDP needs to go into the docs, because itâ€™s not obvious for the syslog writerâ€¦ ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1133605103/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1133659659","html_url":"https://github.com/apache/couchdb/issues/3882#issuecomment-1133659659","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3882","id":1133659659,"node_id":"IC_kwDOAAMmUc5DkkYL","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-21T15:54:21Z","updated_at":"2022-05-21T15:54:21Z","author_association":"CONTRIBUTOR","body":"@big-r81 good call about the documentation gap. Definitely needs updated.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1133659659/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1134622219","html_url":"https://github.com/apache/couchdb/issues/4023#issuecomment-1134622219","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4023","id":1134622219,"node_id":"IC_kwDOAAMmUc5DoPYL","user":{"login":"tudordumitriu","id":4671554,"node_id":"MDQ6VXNlcjQ2NzE1NTQ=","avatar_url":"https://avatars.githubusercontent.com/u/4671554?v=4","gravatar_id":"","url":"https://api.github.com/users/tudordumitriu","html_url":"https://github.com/tudordumitriu","followers_url":"https://api.github.com/users/tudordumitriu/followers","following_url":"https://api.github.com/users/tudordumitriu/following{/other_user}","gists_url":"https://api.github.com/users/tudordumitriu/gists{/gist_id}","starred_url":"https://api.github.com/users/tudordumitriu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tudordumitriu/subscriptions","organizations_url":"https://api.github.com/users/tudordumitriu/orgs","repos_url":"https://api.github.com/users/tudordumitriu/repos","events_url":"https://api.github.com/users/tudordumitriu/events{/privacy}","received_events_url":"https://api.github.com/users/tudordumitriu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-23T12:36:50Z","updated_at":"2022-05-23T12:36:50Z","author_association":"NONE","body":"Hi @nickva \r\nThanks for the answer, but the problem was not the connection but there was actually an invalid json document, from the server to server replication point of view, and I shall explain.\r\nFirst, we did disable all ip rate limiters, firewalls and so on, but nothing got better.\r\nSo, if we did try to back up the db to a local db, the replication was working perfectly (the only difference was the url and credentials)\r\nBut if we were trying to replicate (by pull) from the target server, it was just stopping and maybe the document was logged but I have never managed to get to it.\r\nNow, when tried to do the replication by push, from the source to target, I did notice the document in the logs.\r\nWhat is strange is that document was created from an iOS platform (I suspect the iOS file paths) and was replicated from PouchDB to CouchDB and back to other PouchDB dbs (various platforms) without a problem (including the above mentioned local replication). \r\nThe file is attached, hope it helps.\r\n[Crash.zip](https://github.com/apache/couchdb/files/8754526/Crash.zip)\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1134622219/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1134726394","html_url":"https://github.com/apache/couchdb/issues/4034#issuecomment-1134726394","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4034","id":1134726394,"node_id":"IC_kwDOAAMmUc5Dooz6","user":{"login":"tudordumitriu","id":4671554,"node_id":"MDQ6VXNlcjQ2NzE1NTQ=","avatar_url":"https://avatars.githubusercontent.com/u/4671554?v=4","gravatar_id":"","url":"https://api.github.com/users/tudordumitriu","html_url":"https://github.com/tudordumitriu","followers_url":"https://api.github.com/users/tudordumitriu/followers","following_url":"https://api.github.com/users/tudordumitriu/following{/other_user}","gists_url":"https://api.github.com/users/tudordumitriu/gists{/gist_id}","starred_url":"https://api.github.com/users/tudordumitriu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tudordumitriu/subscriptions","organizations_url":"https://api.github.com/users/tudordumitriu/orgs","repos_url":"https://api.github.com/users/tudordumitriu/repos","events_url":"https://api.github.com/users/tudordumitriu/events{/privacy}","received_events_url":"https://api.github.com/users/tudordumitriu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-23T14:08:13Z","updated_at":"2022-05-23T14:08:13Z","author_association":"NONE","body":"Few updates.\r\nMaybe is just me but the _revs_diffs handled seems to be a bit more problematic to query / call. In trying to understand what is going on, I was trying to issues calls to revs_diffs via Postman (same server, db, credentials, and mostly same headers, and ofc the body identical) but the response returned to Postman request is empty.\r\nWhat is even stranger is that if I issue the same request to the old server (that was used to replicate the db to the new one) (so just changing the url and credentials) the response is returned correctly. \r\nAgain, maybe it's just me, but hard to believe it after all these tries.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1134726394/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1134870969","html_url":"https://github.com/apache/couchdb/issues/3973#issuecomment-1134870969","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3973","id":1134870969,"node_id":"IC_kwDOAAMmUc5DpMG5","user":{"login":"CanRau","id":5196971,"node_id":"MDQ6VXNlcjUxOTY5NzE=","avatar_url":"https://avatars.githubusercontent.com/u/5196971?v=4","gravatar_id":"","url":"https://api.github.com/users/CanRau","html_url":"https://github.com/CanRau","followers_url":"https://api.github.com/users/CanRau/followers","following_url":"https://api.github.com/users/CanRau/following{/other_user}","gists_url":"https://api.github.com/users/CanRau/gists{/gist_id}","starred_url":"https://api.github.com/users/CanRau/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/CanRau/subscriptions","organizations_url":"https://api.github.com/users/CanRau/orgs","repos_url":"https://api.github.com/users/CanRau/repos","events_url":"https://api.github.com/users/CanRau/events{/privacy}","received_events_url":"https://api.github.com/users/CanRau/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-23T16:11:52Z","updated_at":"2022-05-23T16:11:52Z","author_association":"NONE","body":"Tried the same yesterday and got \"invalid URL\" it's a pity ðŸ¥º","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1134870969/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1134996907","html_url":"https://github.com/apache/couchdb/issues/4034#issuecomment-1134996907","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4034","id":1134996907,"node_id":"IC_kwDOAAMmUc5Dpq2r","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-23T18:22:10Z","updated_at":"2022-05-23T18:22:10Z","author_association":"CONTRIBUTOR","body":"The response to `_revs_diff` will be empty if the revisions from the POST request are already on the server. If the revisions are not on the server it will return them.\r\n\r\nThe possible ancestors are computed only if the are missing revisions, and it returns the leaf revisions from the documents on the server (deleted or regular) if their revision depth (their level in the revision tree) is less than *any* of the missing revision. So if the missing revisions are {5, \"abc\"}, {7, \"def\"}, and the leaf revisions from the doc on the server are {1, \"xyz\"}, {6, \"klm\"}, {10, \"ghi\"} then possible ancestors would be {1, \"xyz\"} and {6, \"klm\"}. \r\n\r\nA large number of possible ancestor points to there being a a lot of conflicts in the revision tree. You could try purging all those revisions on the source and then on the target, but make sure to purge every conflicted revision. \r\n\r\nIf there a chance you use clustering on any of the endpoints where the _purge was run and some nodes at the time were disconnected, it maybe possible some purge requests haven't propagated to all the nodes. Make sure to enable  `[mem3] replicate_purges = true` as I think by default that option was left as false and so purge requests might not propagate to all the nodes when more nodes reconnect.\r\n\r\nHere is away to filter out conflicts using replication and VDUs https://blog.cloudant.com/2020/11/26/Repairing-a-Database-With-Conflicts.html\r\n ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1134996907/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1135753168","html_url":"https://github.com/apache/couchdb/pull/3166#issuecomment-1135753168","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3166","id":1135753168,"node_id":"IC_kwDOAAMmUc5DsjfQ","user":{"login":"meveno","id":11720214,"node_id":"MDQ6VXNlcjExNzIwMjE0","avatar_url":"https://avatars.githubusercontent.com/u/11720214?v=4","gravatar_id":"","url":"https://api.github.com/users/meveno","html_url":"https://github.com/meveno","followers_url":"https://api.github.com/users/meveno/followers","following_url":"https://api.github.com/users/meveno/following{/other_user}","gists_url":"https://api.github.com/users/meveno/gists{/gist_id}","starred_url":"https://api.github.com/users/meveno/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meveno/subscriptions","organizations_url":"https://api.github.com/users/meveno/orgs","repos_url":"https://api.github.com/users/meveno/repos","events_url":"https://api.github.com/users/meveno/events{/privacy}","received_events_url":"https://api.github.com/users/meveno/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-24T10:41:15Z","updated_at":"2022-05-24T10:41:15Z","author_association":"NONE","body":"Hello.\r\nI'm trying to use JWT security access with a keycloak access token.\r\nBut I can manage to make it work with this properly.\r\n\r\nHow is the syntax for json nested objects inside JWT token ?\r\n\r\n```\r\n[jwt_auth]\r\nrequired_claims = exp, {iss, \"http://localhost:9080/auth/realms/ovalt\"}\r\nroles_claim_name = resource_access.web-pgc.roles\r\n```\r\n\r\nWhen I use another claim of type 'array' without nested objects like \"aud\", it works ...\r\nBut the values defined in aud are not really roles ...\r\n\r\n```\r\n[jwt_auth]\r\nrequired_claims = exp, {iss, \"http://localhost:9080/auth/realms/ovalt\"}\r\nroles_claim_name = aud\r\n```\r\n\r\nThe token looks like this :\r\n\r\n```\r\n{\r\n  \"exp\": 1653424065,\r\n  \"iat\": 1653388086,\r\n  \"auth_time\": 1653388065,\r\n  \"jti\": \"e1689137-43e7-47f2-a87f-c2111ea30f7d\",\r\n  \"iss\": \"http://localhost:9080/auth/realms/ovalt\",\r\n  \"aud\": [\r\n    \"web-pgc\",\r\n    \"account\"\r\n  ],\r\n  \"sub\": \"df053ed9-a9ce-41bf-9143-85e75ee2657c\",\r\n  \"typ\": \"Bearer\",\r\n  \"azp\": \"web-cockpit\",\r\n  \"nonce\": \"f122afad-f839-4f11-89ba-84cd9cb57802\",\r\n  \"session_state\": \"606b3c5c-eb5c-4a29-814e-1e964104db3e\",\r\n  \"acr\": \"0\",\r\n  \"allowed-origins\": [\r\n    \"http://localhost:8080\",\r\n    \"http://localhost:3000\"\r\n  ],\r\n  \"realm_access\": {\r\n    \"roles\": [\r\n      \"default-roles-ovalt\",\r\n      \"offline_access\",\r\n      \"uma_authorization\"\r\n    ]\r\n  },\r\n  \"resource_access\": {\r\n    \"web-pgc\": {\r\n      \"roles\": [\r\n        \"pgc_user\"\r\n      ]\r\n    },\r\n    \"account\": {\r\n      \"roles\": [\r\n        \"manage-account\",\r\n        \"manage-account-links\",\r\n        \"view-profile\"\r\n      ]\r\n    }\r\n  },\r\n  \"scope\": \"openid email profile\",\r\n  \"sid\": \"606b3c5c-eb5c-4a29-814e-1e964104db3e\",\r\n  \"email_verified\": false,\r\n  \"preferred_username\": \"testuser\"\r\n}\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1135753168/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136312812","html_url":"https://github.com/apache/couchdb/pull/4037#issuecomment-1136312812","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4037","id":1136312812,"node_id":"IC_kwDOAAMmUc5DusHs","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-24T18:46:24Z","updated_at":"2022-05-24T18:46:24Z","author_association":"MEMBER","body":"nope. turns out both jwerl and jwtf are wrong, the `ES*` signatures have a different format and need converting to and from. \r\n\r\nExcept jwtf is now fixed.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136312812/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136441146","html_url":"https://github.com/apache/couchdb/issues/4035#issuecomment-1136441146","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4035","id":1136441146,"node_id":"IC_kwDOAAMmUc5DvLc6","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-24T21:17:38Z","updated_at":"2022-05-24T21:17:38Z","author_association":"CONTRIBUTOR","body":"It looks there a view term which could not be opened and decompressed. I noticed you use `file_compression none` wonder if that has anything to do with it.\r\n\r\nWould there be a chance the files were restored from backup or somehow altered outside of CouchDB's control?\r\n\r\nIs there a way to reproduce the issue?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136441146/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136447465","html_url":"https://github.com/apache/couchdb/issues/4035#issuecomment-1136447465","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4035","id":1136447465,"node_id":"IC_kwDOAAMmUc5DvM_p","user":{"login":"jeydude","id":841011,"node_id":"MDQ6VXNlcjg0MTAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/841011?v=4","gravatar_id":"","url":"https://api.github.com/users/jeydude","html_url":"https://github.com/jeydude","followers_url":"https://api.github.com/users/jeydude/followers","following_url":"https://api.github.com/users/jeydude/following{/other_user}","gists_url":"https://api.github.com/users/jeydude/gists{/gist_id}","starred_url":"https://api.github.com/users/jeydude/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeydude/subscriptions","organizations_url":"https://api.github.com/users/jeydude/orgs","repos_url":"https://api.github.com/users/jeydude/repos","events_url":"https://api.github.com/users/jeydude/events{/privacy}","received_events_url":"https://api.github.com/users/jeydude/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-24T21:26:18Z","updated_at":"2022-05-24T22:11:18Z","author_association":"NONE","body":"We had ```file_compression = snappy```  before in default.ini, thought snappy compression is causing error so we have updated to ```file_compression = none```\r\n\r\nToday we noticed one more thing, if we run the query with sort we are getting the invalid_compression error:\r\n```{\r\n  \"selector\": {\r\n    \"#parent\": \"U3359490690\",\r\n    \"sensor\": \"lamp.steps\"\r\n  },\r\n  \"sort\": [\r\n    {\r\n      \"timestamp\": \"asc\"\r\n    }\r\n  ]\r\n}\r\n```\r\nbut if we remove the sort option, then we are getting the values, any reason why sorting throws compression error.\r\n```\r\n{\r\n  \"selector\": {\r\n    \"#parent\": \"U3359490690\",\r\n    \"sensor\": \"lamp.steps\"\r\n  }\r\n}\r\n```\r\n\r\nOnly our application is inserting/reading data, we do not have any other controls to modify the couchdb database.\r\n\r\nThis error is happening only for the sensor_events database which has millions of data.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136447465/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136478622","html_url":"https://github.com/apache/couchdb/issues/4035#issuecomment-1136478622","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4035","id":1136478622,"node_id":"IC_kwDOAAMmUc5DvUme","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-24T22:09:22Z","updated_at":"2022-05-24T22:09:22Z","author_association":"CONTRIBUTOR","body":"@jeydude makes sense.\r\n\r\nWhen you switched from snappy to `none`, that was the same database? In other words, snappy was used, db was filled with data, then compression was switched to none? Or, did you create a new database, after switching compression to none, and then filled it with all the data? The issue could still be with the snappy compression as switching compression doesn't re-compress the data already written to disk. \r\n\r\nPerhaps somehow your view files got corrupt, if you have ability you can try to reset your view and let it rebuild. Try using `deflate_6`  compression (that's what we use at Cloudant by default).\r\n\r\nA more drastic fix could be to switch to `deflate_6`, re-create the db using a larger sharding factor, say Q=16 if your database is that large, and replicate your data into that database. That way your view files would be smaller and may be build faster.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136478622/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136487955","html_url":"https://github.com/apache/couchdb/issues/4035#issuecomment-1136487955","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4035","id":1136487955,"node_id":"IC_kwDOAAMmUc5DvW4T","user":{"login":"jeydude","id":841011,"node_id":"MDQ6VXNlcjg0MTAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/841011?v=4","gravatar_id":"","url":"https://api.github.com/users/jeydude","html_url":"https://github.com/jeydude","followers_url":"https://api.github.com/users/jeydude/followers","following_url":"https://api.github.com/users/jeydude/following{/other_user}","gists_url":"https://api.github.com/users/jeydude/gists{/gist_id}","starred_url":"https://api.github.com/users/jeydude/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeydude/subscriptions","organizations_url":"https://api.github.com/users/jeydude/orgs","repos_url":"https://api.github.com/users/jeydude/repos","events_url":"https://api.github.com/users/jeydude/events{/privacy}","received_events_url":"https://api.github.com/users/jeydude/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-24T22:25:10Z","updated_at":"2022-05-24T22:46:16Z","author_association":"NONE","body":"Good to know. Thanks @nickva for sharing the information. We did not create new database after switching to none. \r\n\r\nWe did apply below changes in the default.ini\r\n```\r\n[cluster]\r\nq=16\r\nn=1\r\n```\r\nand in local.ini\r\n```\r\n[compactions]\r\n_default = \r\n```\r\nq=16 Modification applies only the new database, not to the existing database.\r\n\r\nHow can I rebuild the view for the sensor_event database? Is there a command I can apply?\r\n\r\nI will try applying deflate_6 compression. Once l set deflate_6, to apply this compression to senser_event database, is there anything I need to do? Thanks!\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136487955/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136491573","html_url":"https://github.com/apache/couchdb/issues/4035#issuecomment-1136491573","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4035","id":1136491573,"node_id":"IC_kwDOAAMmUc5DvXw1","user":{"login":"jeydude","id":841011,"node_id":"MDQ6VXNlcjg0MTAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/841011?v=4","gravatar_id":"","url":"https://api.github.com/users/jeydude","html_url":"https://github.com/jeydude","followers_url":"https://api.github.com/users/jeydude/followers","following_url":"https://api.github.com/users/jeydude/following{/other_user}","gists_url":"https://api.github.com/users/jeydude/gists{/gist_id}","starred_url":"https://api.github.com/users/jeydude/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeydude/subscriptions","organizations_url":"https://api.github.com/users/jeydude/orgs","repos_url":"https://api.github.com/users/jeydude/repos","events_url":"https://api.github.com/users/jeydude/events{/privacy}","received_events_url":"https://api.github.com/users/jeydude/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-24T22:31:32Z","updated_at":"2022-05-24T22:33:36Z","author_association":"NONE","body":"http://hostname/sensor_event/_design/parent-sensor-timestamp-index/_view/parent-sensor-timestamp\r\n\r\ngave me \r\n{\r\n  \"error\": \"invalid_compression\",\r\n  \"reason\": \"[{couch_compress,decompress,1,[{file,\\\"src/couch_compress.erl\\\"},{line,71}]},\\n {couch_file,pread_term,2,[{file,\\\"src/couch_file.erl\\\"},{line,161}]},\\n {couch_btree,get_node,2,[{file,\\\"src/couch_btree.erl\\\"},{line,435}]},\\n {couch_btree,modify_node,4,[{file,\\\"src/couch_btree.erl\\\"},{line,388}]},\\n {couch_btree,modify_kpnode,6,[{file,\\\"src/couch_btree.erl\\\"},{line,535}]},\\n {couch_btree,modify_node,4,[{file,\\\"src/couch_btree.erl\\\"},{line,394}]},\\n {couch_btree,modify_kpnode,6,[{file,\\\"src/couch_btree.erl\\\"},{line,535}]},\\n {couch_btree,modify_node,4,[{file,\\\"src/couch_btree.erl\\\"},{line,394}]}]\",\r\n  \"ref\": 3722911048\r\n}\r\n\r\nhttp://hostname/sensor_event/_design/parent-timestamp-index/_view/parent-timestamp\r\ngave me \r\n{\r\n  \"rows\": [\r\n    {\r\n      \"key\": null,\r\n      \"value\": 775776868\r\n    }\r\n  ]\r\n}\r\n\r\nis there a way to fix the corrupted view? or re-build again?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136491573/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136495808","html_url":"https://github.com/apache/couchdb/issues/4035#issuecomment-1136495808","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4035","id":1136495808,"node_id":"IC_kwDOAAMmUc5DvYzA","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-24T22:38:57Z","updated_at":"2022-05-24T22:38:57Z","author_association":"CONTRIBUTOR","body":"When the view is rebuilding it won't be able to return results. So make sure to account for that. At 280Gb that could take quite a while. First, apply `deflate_6` compression, so the rebuilt view can use that compression. When you're ready, you could try modifying the _design document of the corrupt view a bit (add a comment or a semicolon) that would change the view signature and start rebuilding the view. Make sure to account for the extra disk space and CPU resources as well.\r\n\r\nTo migrate the database to have a higher Q sharding factor, after you apply `deflate_6`,  creating a `sensor_event_1` and then replicate from `sensor_event` to `sensor_event_1`. That would take quite a bit at 280Gb, could be a few days. Also make sure you have enough disk and CPU capacity. After that can try querying your views to ensure they have been built and return results. Then you'd need to update your client code to read from the `sensor_event_1` instead of `sensor_event`","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136495808/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136500247","html_url":"https://github.com/apache/couchdb/issues/4035#issuecomment-1136500247","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4035","id":1136500247,"node_id":"IC_kwDOAAMmUc5DvZ4X","user":{"login":"jeydude","id":841011,"node_id":"MDQ6VXNlcjg0MTAxMQ==","avatar_url":"https://avatars.githubusercontent.com/u/841011?v=4","gravatar_id":"","url":"https://api.github.com/users/jeydude","html_url":"https://github.com/jeydude","followers_url":"https://api.github.com/users/jeydude/followers","following_url":"https://api.github.com/users/jeydude/following{/other_user}","gists_url":"https://api.github.com/users/jeydude/gists{/gist_id}","starred_url":"https://api.github.com/users/jeydude/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jeydude/subscriptions","organizations_url":"https://api.github.com/users/jeydude/orgs","repos_url":"https://api.github.com/users/jeydude/repos","events_url":"https://api.github.com/users/jeydude/events{/privacy}","received_events_url":"https://api.github.com/users/jeydude/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-24T22:47:01Z","updated_at":"2022-05-24T22:47:01Z","author_association":"NONE","body":"Thanks!, will try it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136500247/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136908062","html_url":"https://github.com/apache/couchdb/issues/3758#issuecomment-1136908062","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3758","id":1136908062,"node_id":"IC_kwDOAAMmUc5Dw9ce","user":{"login":"meveno","id":11720214,"node_id":"MDQ6VXNlcjExNzIwMjE0","avatar_url":"https://avatars.githubusercontent.com/u/11720214?v=4","gravatar_id":"","url":"https://api.github.com/users/meveno","html_url":"https://github.com/meveno","followers_url":"https://api.github.com/users/meveno/followers","following_url":"https://api.github.com/users/meveno/following{/other_user}","gists_url":"https://api.github.com/users/meveno/gists{/gist_id}","starred_url":"https://api.github.com/users/meveno/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/meveno/subscriptions","organizations_url":"https://api.github.com/users/meveno/orgs","repos_url":"https://api.github.com/users/meveno/repos","events_url":"https://api.github.com/users/meveno/events{/privacy}","received_events_url":"https://api.github.com/users/meveno/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-25T07:49:12Z","updated_at":"2022-05-25T07:49:12Z","author_association":"NONE","body":"Hello.\r\nI'm trying to use JWT security access with a keycloak access token.\r\nBut I can manage to make it work with this properly.\r\n\r\nHow is the syntax for json nested objects inside JWT token ?\r\n\r\n```\r\n[jwt_auth]\r\nrequired_claims = exp, {iss, \"http://localhost:9080/auth/realms/ovalt\"}\r\nroles_claim_name = resource_access.web-pgc.roles\r\n```\r\n\r\nWhen I use another claim of type 'array' without nested objects like \"aud\", it works ...\r\nBut the values defined in aud are not really roles ...\r\n\r\n```\r\n[jwt_auth]\r\nrequired_claims = exp, {iss, \"http://localhost:9080/auth/realms/ovalt\"}\r\nroles_claim_name = aud\r\n```\r\n\r\nThe token looks like this :\r\n\r\n```\r\n{\r\n  \"exp\": 1653424065,\r\n  \"iat\": 1653388086,\r\n  \"auth_time\": 1653388065,\r\n  \"jti\": \"e1689137-43e7-47f2-a87f-c2111ea30f7d\",\r\n  \"iss\": \"http://localhost:9080/auth/realms/ovalt\",\r\n  \"aud\": [\r\n    \"web-pgc\",\r\n    \"account\"\r\n  ],\r\n  \"sub\": \"df053ed9-a9ce-41bf-9143-85e75ee2657c\",\r\n  \"typ\": \"Bearer\",\r\n  \"azp\": \"web-cockpit\",\r\n  \"nonce\": \"f122afad-f839-4f11-89ba-84cd9cb57802\",\r\n  \"session_state\": \"606b3c5c-eb5c-4a29-814e-1e964104db3e\",\r\n  \"acr\": \"0\",\r\n  \"allowed-origins\": [\r\n    \"http://localhost:8080\",\r\n    \"http://localhost:3000\"\r\n  ],\r\n  \"realm_access\": {\r\n    \"roles\": [\r\n      \"default-roles-ovalt\",\r\n      \"offline_access\",\r\n      \"uma_authorization\"\r\n    ]\r\n  },\r\n  \"resource_access\": {\r\n    \"web-pgc\": {\r\n      \"roles\": [\r\n        \"pgc_user\"\r\n      ]\r\n    },\r\n    \"account\": {\r\n      \"roles\": [\r\n        \"manage-account\",\r\n        \"manage-account-links\",\r\n        \"view-profile\"\r\n      ]\r\n    }\r\n  },\r\n  \"scope\": \"openid email profile\",\r\n  \"sid\": \"606b3c5c-eb5c-4a29-814e-1e964104db3e\",\r\n  \"email_verified\": false,\r\n  \"preferred_username\": \"testuser\"\r\n}\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1136908062/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1137391269","html_url":"https://github.com/apache/couchdb/issues/4034#issuecomment-1137391269","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4034","id":1137391269,"node_id":"IC_kwDOAAMmUc5Dyzal","user":{"login":"tudordumitriu","id":4671554,"node_id":"MDQ6VXNlcjQ2NzE1NTQ=","avatar_url":"https://avatars.githubusercontent.com/u/4671554?v=4","gravatar_id":"","url":"https://api.github.com/users/tudordumitriu","html_url":"https://github.com/tudordumitriu","followers_url":"https://api.github.com/users/tudordumitriu/followers","following_url":"https://api.github.com/users/tudordumitriu/following{/other_user}","gists_url":"https://api.github.com/users/tudordumitriu/gists{/gist_id}","starred_url":"https://api.github.com/users/tudordumitriu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tudordumitriu/subscriptions","organizations_url":"https://api.github.com/users/tudordumitriu/orgs","repos_url":"https://api.github.com/users/tudordumitriu/repos","events_url":"https://api.github.com/users/tudordumitriu/events{/privacy}","received_events_url":"https://api.github.com/users/tudordumitriu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-25T14:58:40Z","updated_at":"2022-05-25T14:58:40Z","author_association":"NONE","body":"Thanks @nickva \r\nThat purging all the missing revisions indeed helped. \r\nThe `replicate_purge = true` flag was set to true anyways but this is a single node cluster for now.\r\nAnother interesting aspect was that these missing revs were replicated back quite a lot (that document was replicated in common dbs and in client pouch dbs , and getting rid of the properly was quite difficult - we had to clear out all the client dbs and delete simultaneously on the server in all dbs).\r\nMy last question would be how can we correctly purge these, or is purging them manually (via a scheduled task) the only way?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1137391269/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1137765688","html_url":"https://github.com/apache/couchdb/issues/4034#issuecomment-1137765688","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4034","id":1137765688,"node_id":"IC_kwDOAAMmUc5D0O04","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-25T19:26:34Z","updated_at":"2022-05-25T19:26:34Z","author_association":"CONTRIBUTOR","body":"@tudordumitriu if replications are set up, and a particular document is updated, thenthe  replicator will attempt to replicate all the missing revisions from the source to the target. So, for instance, if revision `{\"_id\":\"doc1\", \"_rev\":\"2-def\"} is purged from the target, but not the source, then when \"doc1\" gets updated on the source with {\"_id\":\"doc1\", \"_rev\":\"3-xyz\"}, then both \"2-def\" and \"3-xyz\" will be replicated to the target.\r\n\r\nIt's a bit tricky to purge them, currently. There is no ability to replicate purges and the replicator wants to replicate everything, as that's its main job. You could try purging those via a scheduled task or try to somehow minimize generation of conflicts to start with. Setting a low (25) revs_limit might contribute to it somewhat. I am thinking of cases where a document might receive more than 25 updates in row before it gets a chance to be replicated, so some revisions might be pruned already (the root might look like \"26-jkl\") and it might result in conflicts being generated during replication.\r\n\r\nPerhaps we (CouchDB) would come up with a few more replication options, such as, for example:\r\n  * skip_deleted = true (To skip deleted revision branches, to allow users to filter out tombstones)\r\n  * winning_revs_only = true (To replicated only winning revisions)\r\n \r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1137765688/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1138135594","html_url":"https://github.com/apache/couchdb/issues/4034#issuecomment-1138135594","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4034","id":1138135594,"node_id":"IC_kwDOAAMmUc5D1pIq","user":{"login":"tudordumitriu","id":4671554,"node_id":"MDQ6VXNlcjQ2NzE1NTQ=","avatar_url":"https://avatars.githubusercontent.com/u/4671554?v=4","gravatar_id":"","url":"https://api.github.com/users/tudordumitriu","html_url":"https://github.com/tudordumitriu","followers_url":"https://api.github.com/users/tudordumitriu/followers","following_url":"https://api.github.com/users/tudordumitriu/following{/other_user}","gists_url":"https://api.github.com/users/tudordumitriu/gists{/gist_id}","starred_url":"https://api.github.com/users/tudordumitriu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tudordumitriu/subscriptions","organizations_url":"https://api.github.com/users/tudordumitriu/orgs","repos_url":"https://api.github.com/users/tudordumitriu/repos","events_url":"https://api.github.com/users/tudordumitriu/events{/privacy}","received_events_url":"https://api.github.com/users/tudordumitriu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-26T04:16:09Z","updated_at":"2022-05-26T04:16:09Z","author_association":"NONE","body":"Thanks @nickva \r\nThese options would be very useful in my opinion and would help a lot, so if you will plan to add them we'll be the first to enable them.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1138135594/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1138161534","html_url":"https://github.com/apache/couchdb/pull/4040#issuecomment-1138161534","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4040","id":1138161534,"node_id":"IC_kwDOAAMmUc5D1vd-","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-26T05:14:17Z","updated_at":"2022-05-26T05:14:17Z","author_association":"CONTRIBUTOR","body":"> I'm curious what generates {shutdown, Err} [here](https://github.com/apache/couchdb/pull/4040/files#diff-a8cd08c496b1621f5f9ddeb3bf001005c1ebaf7db81432fde01f7624a35ea8dcR1137)?\r\n\r\nThere it might be when the mochiweb process crashes, but then we could catch it log the error, then call `exit(shutdown)`. However, that could be running inside another `try ... catch` which now catches the `exit(shutdown)` and then ends up generating log noise about an unhandled `unknown` error.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1138161534/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1140441624","html_url":"https://github.com/apache/couchdb/issues/1514#issuecomment-1140441624","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1514","id":1140441624,"node_id":"IC_kwDOAAMmUc5D-cIY","user":{"login":"nkosi23","id":6731436,"node_id":"MDQ6VXNlcjY3MzE0MzY=","avatar_url":"https://avatars.githubusercontent.com/u/6731436?v=4","gravatar_id":"","url":"https://api.github.com/users/nkosi23","html_url":"https://github.com/nkosi23","followers_url":"https://api.github.com/users/nkosi23/followers","following_url":"https://api.github.com/users/nkosi23/following{/other_user}","gists_url":"https://api.github.com/users/nkosi23/gists{/gist_id}","starred_url":"https://api.github.com/users/nkosi23/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nkosi23/subscriptions","organizations_url":"https://api.github.com/users/nkosi23/orgs","repos_url":"https://api.github.com/users/nkosi23/repos","events_url":"https://api.github.com/users/nkosi23/events{/privacy}","received_events_url":"https://api.github.com/users/nkosi23/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-29T12:42:02Z","updated_at":"2022-05-29T12:42:02Z","author_association":"NONE","body":"This sounds really exciting, has progress been made on this idea behind the scenes? Also, does this mean that the indexing process would be radically faster than it is now if a JS engine is directly linked into the Erlang VM? \r\n\r\nI am a happy couchdb user, the only worry I have is about the duration of indexing at scale (for a database with billions of documents). I wonder if indexing will be able to catch up if 10s of millions of documents are added on a daily basis. I am also thinking about the scenarios when for some reasons an index must be built from scratch on such a large database. Because of the network overhead with the Query Server (if i understand correctly), I am worried that indexing may never converge. \r\n\r\nBoosting the performance of indexing and enabling the process to saturate bare metal would give users peace of mind when planning such large systems. So I am curious to know if the Query Server Protocol v2 would help with that or if this is out of scope.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1140441624/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1140873430","html_url":"https://github.com/apache/couchdb/pull/4041#issuecomment-1140873430","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4041","id":1140873430,"node_id":"IC_kwDOAAMmUc5EAFjW","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-05-30T08:41:13Z","updated_at":"2022-06-02T13:08:19Z","author_association":"CONTRIBUTOR","body":"I updated the PR with the following logic:\r\n\r\nWe have now different code paths, how a list of couchdb roles can get into the system (inclusive backwards compatibility). \r\nI want to explain it in detail:\r\n\r\n| roles_claim_name | roles_claim_path | _couchdb.roles in JWT token | used in CouchDB | log message |\r\n| ---  | --- | --- | --- | --- |\r\n| `undef`  | `undef` | `undef` | --- | --- |\r\n| `undef`  | `undef` | `def` | `_couchdb.roles` |  implicit values found and used, migrate to path |\r\n| `undef`  | `def` | `undef` | `roles_claim_path` | --- |\r\n| `undef`  | `def` | `def` | `_couchdb.roles` |  implicit values found and used, migrate to path |\r\n| `def`  | `undef` | `undef` | `roles_claim_name` | Use of 'roles_claim_name' is deprecated. Please migrate to 'roles_claim_path'! |\r\n| `def`  | `undef` | `def` | `roles_claim_name` | Use of 'roles_claim_name' is deprecated. Please migrate to 'roles_claim_path'! |\r\n| `def`  | `def` | `undef` | `roles_claim_name` | Both, 'roles_claim_name' and 'roles_claim_path' are set. For backwards compatibility, only `roles_claim_name` is used! |\r\n| `def`  | `def` | `def` | `roles_claim_name` | Both, 'roles_claim_name' and 'roles_claim_path' are set. For backwards compatibility, only `roles_claim_name` is used! |\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1140873430/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]