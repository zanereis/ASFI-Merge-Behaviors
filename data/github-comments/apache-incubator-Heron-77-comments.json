[{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/803676491","html_url":"https://github.com/apache/incubator-heron/issues/3684#issuecomment-803676491","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3684","id":803676491,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMzY3NjQ5MQ==","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-21T23:08:25Z","updated_at":"2021-03-21T23:08:25Z","author_association":"CONTRIBUTOR","body":"Hmm, those `netrc` issues are what we saw back in the older versions of Bazel. What do you see when you run `bazel --version` ?\r\n\r\nThe issue could also be related to Ant, which was added as a new dependency for the newer Zookeeper client library build process.\r\n\r\nI tested a build on Ubuntu 20.04 using our docker script and it worked.\r\nYou can try a build also using this command to spin up a dev docker container: \r\n`./docker/scripts/dev-env-create.sh bazel2 ubuntu20.04`\r\n\r\nThis is the Dockerfile for that setup. You can compare your Ubuntu system with the list of packages that we install. I wonder if the instructions you were using perhaps are missing a package such as `ant`.\r\nhttps://github.com/apache/incubator-heron/blob/master/docker/compile/Dockerfile.ubuntu20.04\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/803676491/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/839708275","html_url":"https://github.com/apache/incubator-heron/issues/3686#issuecomment-839708275","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3686","id":839708275,"node_id":"MDEyOklzc3VlQ29tbWVudDgzOTcwODI3NQ==","user":{"login":"thinker0","id":357785,"node_id":"MDQ6VXNlcjM1Nzc4NQ==","avatar_url":"https://avatars.githubusercontent.com/u/357785?v=4","gravatar_id":"","url":"https://api.github.com/users/thinker0","html_url":"https://github.com/thinker0","followers_url":"https://api.github.com/users/thinker0/followers","following_url":"https://api.github.com/users/thinker0/following{/other_user}","gists_url":"https://api.github.com/users/thinker0/gists{/gist_id}","starred_url":"https://api.github.com/users/thinker0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thinker0/subscriptions","organizations_url":"https://api.github.com/users/thinker0/orgs","repos_url":"https://api.github.com/users/thinker0/repos","events_url":"https://api.github.com/users/thinker0/events{/privacy}","received_events_url":"https://api.github.com/users/thinker0/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-12T11:50:35Z","updated_at":"2021-05-12T11:50:35Z","author_association":"MEMBER","body":"\r\n```bash\r\nPEX_VERBOSE=9 heron version\r\n..........\r\npex: Failed to resolve a requirement: The 'pyyaml' distribution was not found and is required by the application\r\npex: Failed to resolve a requirement: The 'netifaces' distribution was not found and is required by the application\r\npex: Activating PEX virtual environment from /Users/thinker0/bin/heron :: Resolving six from [Requirement.parse('six==1.16.0; python_version != \"3.0.*\" and python_version != \"3.1.*\"pex: Unresolved requirements:\r\npex:   - pyyaml\r\npex:   - netifaces\r\npex: Distributions contained within this pex:\r\npex:   - PyYAML-3.13-cp38-cp38-macosx_10_15_x86_64.whl\r\npex:   - colorlog-2.6.1-py2.py3-none-any.whl\r\npex:   - netifaces-0.10.6-cp38-cp38-macosx_10_15_x86_64.whl\r\npex:   - protobuf-3.8.0-py2.py3-none-any.whl\r\npex:   - requests-2.12.3-py2.py3-none-any.whl\r\npex:   - setuptools-46.1.3-py3-none-any.whl\r\npex:   - six-1.16.0-py2.py3-none-any.whl\r\nFailed to execute PEX file. Needed macosx_11_3_x86_64-cp-37-cp37m compatible dependencies for:\r\n 1: pyyaml\r\n    But this pex only contains:\r\n      PyYAML-3.13-cp38-cp38-macosx_10_15_x86_64.whl\r\n 2: netifaces\r\n    But this pex only contains:\r\n      netifaces-0.10.6-cp38-cp38-macosx_10_15_x86_64.whl\r\n```","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/839708275/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/841854043","html_url":"https://github.com/apache/incubator-heron/pull/3691#issuecomment-841854043","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3691","id":841854043,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MTg1NDA0Mw==","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-16T18:08:33Z","updated_at":"2021-05-16T18:08:33Z","author_association":"CONTRIBUTOR","body":"Continuing the work on #3692 ","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/841854043/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/841856602","html_url":"https://github.com/apache/incubator-heron/pull/3692#issuecomment-841856602","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3692","id":841856602,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MTg1NjYwMg==","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-16T18:26:56Z","updated_at":"2021-05-16T18:26:56Z","author_association":"CONTRIBUTOR","body":"Converting to draft because I want to do some additional testing in Kubernetes. Will report back soon.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/841856602/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/842495049","html_url":"https://github.com/apache/incubator-heron/pull/3693#issuecomment-842495049","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3693","id":842495049,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MjQ5NTA0OQ==","user":{"login":"joshfischer1108","id":5785700,"node_id":"MDQ6VXNlcjU3ODU3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5785700?v=4","gravatar_id":"","url":"https://api.github.com/users/joshfischer1108","html_url":"https://github.com/joshfischer1108","followers_url":"https://api.github.com/users/joshfischer1108/followers","following_url":"https://api.github.com/users/joshfischer1108/following{/other_user}","gists_url":"https://api.github.com/users/joshfischer1108/gists{/gist_id}","starred_url":"https://api.github.com/users/joshfischer1108/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshfischer1108/subscriptions","organizations_url":"https://api.github.com/users/joshfischer1108/orgs","repos_url":"https://api.github.com/users/joshfischer1108/repos","events_url":"https://api.github.com/users/joshfischer1108/events{/privacy}","received_events_url":"https://api.github.com/users/joshfischer1108/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-17T17:16:55Z","updated_at":"2021-05-17T17:16:55Z","author_association":"MEMBER","body":"closing this as it has an incorrectly merged branch.  Will be back with a fixed PR.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/842495049/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/842765324","html_url":"https://github.com/apache/incubator-heron/pull/3694#issuecomment-842765324","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3694","id":842765324,"node_id":"MDEyOklzc3VlQ29tbWVudDg0Mjc2NTMyNA==","user":{"login":"joshfischer1108","id":5785700,"node_id":"MDQ6VXNlcjU3ODU3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5785700?v=4","gravatar_id":"","url":"https://api.github.com/users/joshfischer1108","html_url":"https://github.com/joshfischer1108","followers_url":"https://api.github.com/users/joshfischer1108/followers","following_url":"https://api.github.com/users/joshfischer1108/following{/other_user}","gists_url":"https://api.github.com/users/joshfischer1108/gists{/gist_id}","starred_url":"https://api.github.com/users/joshfischer1108/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshfischer1108/subscriptions","organizations_url":"https://api.github.com/users/joshfischer1108/orgs","repos_url":"https://api.github.com/users/joshfischer1108/repos","events_url":"https://api.github.com/users/joshfischer1108/events{/privacy}","received_events_url":"https://api.github.com/users/joshfischer1108/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-18T01:59:07Z","updated_at":"2021-05-18T01:59:07Z","author_association":"MEMBER","body":"Will wait to merge this until the official docker image is published","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/842765324/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/842805033","html_url":"https://github.com/apache/incubator-heron/pull/3692#issuecomment-842805033","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3692","id":842805033,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MjgwNTAzMw==","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-18T03:53:41Z","updated_at":"2021-05-18T03:53:41Z","author_association":"CONTRIBUTOR","body":"This was the error and resulting fix I found that explains why I had to update Guava library.\r\nhttps://stackoverflow.com/questions/45247193/nosuchmethoderror-com-google-common-base-preconditions-checkargumentzljava-lan","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/842805033/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/842805418","html_url":"https://github.com/apache/incubator-heron/pull/3692#issuecomment-842805418","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3692","id":842805418,"node_id":"MDEyOklzc3VlQ29tbWVudDg0MjgwNTQxOA==","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-18T03:55:04Z","updated_at":"2021-05-18T03:55:04Z","author_association":"CONTRIBUTOR","body":"I was able to successfully submit a topology to a Helm installed Heron cluster running in Kubernetes. So the DLog upload/download should be fine.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/842805418/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/844459016","html_url":"https://github.com/apache/incubator-heron/pull/3692#issuecomment-844459016","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3692","id":844459016,"node_id":"MDEyOklzc3VlQ29tbWVudDg0NDQ1OTAxNg==","user":{"login":"nwangtw","id":6353055,"node_id":"MDQ6VXNlcjYzNTMwNTU=","avatar_url":"https://avatars.githubusercontent.com/u/6353055?v=4","gravatar_id":"","url":"https://api.github.com/users/nwangtw","html_url":"https://github.com/nwangtw","followers_url":"https://api.github.com/users/nwangtw/followers","following_url":"https://api.github.com/users/nwangtw/following{/other_user}","gists_url":"https://api.github.com/users/nwangtw/gists{/gist_id}","starred_url":"https://api.github.com/users/nwangtw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nwangtw/subscriptions","organizations_url":"https://api.github.com/users/nwangtw/orgs","repos_url":"https://api.github.com/users/nwangtw/repos","events_url":"https://api.github.com/users/nwangtw/events{/privacy}","received_events_url":"https://api.github.com/users/nwangtw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-19T20:45:01Z","updated_at":"2021-05-19T20:45:01Z","author_association":"CONTRIBUTOR","body":"This is great. Thanks!","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/844459016/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/862868128","html_url":"https://github.com/apache/incubator-heron/pull/3692#issuecomment-862868128","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3692","id":862868128,"node_id":"MDEyOklzc3VlQ29tbWVudDg2Mjg2ODEyOA==","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-06-17T02:30:38Z","updated_at":"2021-06-17T02:30:38Z","author_association":"CONTRIBUTOR","body":"Adding this for historical context. This merge request was created to resolve this Bookkeeper issue: https://github.com/apache/bookkeeper/issues/2302","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/862868128/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/876973270","html_url":"https://github.com/apache/incubator-heron/pull/3702#issuecomment-876973270","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3702","id":876973270,"node_id":"MDEyOklzc3VlQ29tbWVudDg3Njk3MzI3MA==","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-09T07:19:13Z","updated_at":"2021-07-09T07:19:13Z","author_association":"CONTRIBUTOR","body":"Currently testing. I was able to add a secret as a volume mount, but the submission failed when I tried to add an ENV variable. Will try to fix that code next.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/876973270/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/877386048","html_url":"https://github.com/apache/incubator-heron/pull/3702#issuecomment-877386048","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3702","id":877386048,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NzM4NjA0OA==","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-09T18:45:21Z","updated_at":"2021-07-09T18:45:21Z","author_association":"CONTRIBUTOR","body":"Apparently `Array.asList` produces a fixed sized array. This code existed for the two already existing EnvVars. This was causing my code to fail when trying to add a third. I was finally able to test. Can now mount Secrets as files and as ENV variables.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/877386048/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/877396638","html_url":"https://github.com/apache/incubator-heron/pull/3702#issuecomment-877396638","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3702","id":877396638,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NzM5NjYzOA==","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-09T19:03:16Z","updated_at":"2021-07-09T19:03:16Z","author_association":"CONTRIBUTOR","body":"To test you can create a secret like this: \r\n```\r\nkubectl create secret generic dev-user-pass \\\r\n  --from-literal=username=devuser \\\r\n  --from-literal=password='S!B\\*d$zDsb='\r\n  ```\r\n  Can then use it with the following config-properties:\r\n  `--config-property heron.kubernetes.pod.secret.db-user-pass=/heron/db-pass`\r\n  This will mount a secret to a path. `db-user-pass` secret to `/heron/db-pass` volume\r\n  Can also make an ENV variable:\r\n  `--config-property heron.kubernetes.pod.secretKeyRef.DBPASS=db-user-pass:password`\r\n  This will create a `DBPASS` ENV variable which has the `password` key from the `db-user-user` secret.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/877396638/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/877408475","html_url":"https://github.com/apache/incubator-heron/pull/3702#issuecomment-877408475","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3702","id":877408475,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NzQwODQ3NQ==","user":{"login":"joshfischer1108","id":5785700,"node_id":"MDQ6VXNlcjU3ODU3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5785700?v=4","gravatar_id":"","url":"https://api.github.com/users/joshfischer1108","html_url":"https://github.com/joshfischer1108","followers_url":"https://api.github.com/users/joshfischer1108/followers","following_url":"https://api.github.com/users/joshfischer1108/following{/other_user}","gists_url":"https://api.github.com/users/joshfischer1108/gists{/gist_id}","starred_url":"https://api.github.com/users/joshfischer1108/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshfischer1108/subscriptions","organizations_url":"https://api.github.com/users/joshfischer1108/orgs","repos_url":"https://api.github.com/users/joshfischer1108/repos","events_url":"https://api.github.com/users/joshfischer1108/events{/privacy}","received_events_url":"https://api.github.com/users/joshfischer1108/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-09T19:26:17Z","updated_at":"2021-07-09T19:26:17Z","author_association":"MEMBER","body":"Thanks @nicknezis .  Could you add this feature to the documentation somewhere?  I'd hate for it to get lost.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/877408475/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/877427296","html_url":"https://github.com/apache/incubator-heron/pull/3702#issuecomment-877427296","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3702","id":877427296,"node_id":"MDEyOklzc3VlQ29tbWVudDg3NzQyNzI5Ng==","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-07-09T20:05:15Z","updated_at":"2021-07-09T20:05:15Z","author_association":"CONTRIBUTOR","body":"> Thanks @nicknezis .  Could you add this feature to the documentation somewhere?  I'd hate for it to get lost.\n\nYeah we currently have two pages dedicated to the Kubernetes scheduler. I'd like to consolidate them and have a good location for general config information like this. Was planning to do that as another ticket related to all of these changes I'm making. I'll try to add that soon.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/877427296/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/906540313","html_url":"https://github.com/apache/incubator-heron/issues/3474#issuecomment-906540313","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3474","id":906540313,"node_id":"IC_kwDOApKMps42CLUZ","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-26T16:01:21Z","updated_at":"2021-08-26T20:57:02Z","author_association":"MEMBER","body":"Hi @nicknezis, I am trying to get acquainted with the code-base and was wondering if this has been resolved yet? I am looking at the following files:\r\n\r\n[heron/schedulers/src/java/org/apache/heron/scheduler/kubernetes/KubernetesContext.java](https://github.com/apache/incubator-heron/blob/4d9a7de106d6f1f6de6a96f996735c5fc636011b/heron/schedulers/src/java/org/apache/heron/scheduler/kubernetes/KubernetesContext.java)\r\n[heron/schedulers/src/java/org/apache/heron/scheduler/kubernetes/KubernetesScheduler.java](https://github.com/apache/incubator-heron/blob/4d9a7de106d6f1f6de6a96f996735c5fc636011b/heron/schedulers/src/java/org/apache/heron/scheduler/kubernetes/KubernetesScheduler.java)\\\r\n[heron/spi/src/java/org/apache/heron/spi/common/Config.java](https://github.com/apache/incubator-heron/blob/4d9a7de106d6f1f6de6a96f996735c5fc636011b/heron/spi/src/java/org/apache/heron/spi/common/Config.java)\r\n\r\nTests @ [heron/schedulers/tests/java/org/apache/heron/scheduler/kubernetes/KubernetesSchedulerTest.java](https://github.com/apache/incubator-heron/blob/4d9a7de106d6f1f6de6a96f996735c5fc636011b/heron/schedulers/tests/java/org/apache/heron/scheduler/kubernetes/KubernetesSchedulerTest.java)\r\n\r\nI have `grep`'d the code base for `SecurityContext` but was unable to find anything, are you referring to the Kubernetes configurations for [`Security Context`](https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.22/#securitycontext-v1-core)? I have located the [`Config.Builder`](https://heron.apache.org/api/java/org/apache/heron/spi/common/Config.Builder.html) in the [`org.apache.heron.spi.common`](https://heron.apache.org/api/java/org/apache/heron/spi/common/package-summary.html) package. From the `Config.Builder` I will need to use the `put` method to add the Key-Value pairs for `<SecurityContext Field, Value>` under the `spec::containers::securityContext` YAML entry?\r\n\r\nI would appreciate any direction you can provide, this is my first ~hour or so rummaging through the code-base.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/906540313/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/908350348","html_url":"https://github.com/apache/incubator-heron/issues/3474#issuecomment-908350348","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3474","id":908350348,"node_id":"IC_kwDOApKMps42JFOM","user":{"login":"joshfischer1108","id":5785700,"node_id":"MDQ6VXNlcjU3ODU3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5785700?v=4","gravatar_id":"","url":"https://api.github.com/users/joshfischer1108","html_url":"https://github.com/joshfischer1108","followers_url":"https://api.github.com/users/joshfischer1108/followers","following_url":"https://api.github.com/users/joshfischer1108/following{/other_user}","gists_url":"https://api.github.com/users/joshfischer1108/gists{/gist_id}","starred_url":"https://api.github.com/users/joshfischer1108/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshfischer1108/subscriptions","organizations_url":"https://api.github.com/users/joshfischer1108/orgs","repos_url":"https://api.github.com/users/joshfischer1108/repos","events_url":"https://api.github.com/users/joshfischer1108/events{/privacy}","received_events_url":"https://api.github.com/users/joshfischer1108/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-30T13:37:18Z","updated_at":"2021-08-30T13:37:18Z","author_association":"MEMBER","body":"@nicknezis Did you see this?","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/908350348/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/908593378","html_url":"https://github.com/apache/incubator-heron/issues/3474#issuecomment-908593378","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3474","id":908593378,"node_id":"IC_kwDOApKMps42KAji","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-30T18:44:37Z","updated_at":"2021-08-30T18:44:37Z","author_association":"CONTRIBUTOR","body":"@surahman This has not been resolved yet. Although I believe Kubernetes support for Pod Security Policy may be deprecated and evolving to something else. I believe the Security Context is still worth supporting. I have had some further thoughts on this topic when comparing how other analytic frameworks have solved it. \r\n\r\nI've created a [Project board](https://github.com/apache/incubator-heron/projects/5) to capture various Kubernetes Scheduler improvements I think we should make. Many of the designs mirror what the Apache Spark Kubernetes scheduler does. One of the tickets would solve this SecurityContext issue. Specifically the Pod Template feature in [this issue](https://github.com/apache/incubator-heron/issues/3707). If we provide support for Pod Templates, then this would provide a mechanism to provide complex Pod Security Context without needing to do extensive mapping from Config properties to Security Context.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/908593378/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/908609728","html_url":"https://github.com/apache/incubator-heron/issues/3707#issuecomment-908609728","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3707","id":908609728,"node_id":"IC_kwDOApKMps42KEjA","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-30T19:07:17Z","updated_at":"2021-08-30T19:07:17Z","author_association":"CONTRIBUTOR","body":"This is the Spark Scala step that is used to create the Pod spec based on a ConfigMap PodTemplate.\r\n\r\nhttps://github.com/apache/spark/blob/de59e01aa4853ef951da080c0d1908d53d133ebe/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/deploy/k8s/features/PodTemplateConfigMapStep.scala","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/908609728/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/908778398","html_url":"https://github.com/apache/incubator-heron/issues/3707#issuecomment-908778398","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3707","id":908778398,"node_id":"IC_kwDOApKMps42Ktue","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-08-30T23:33:05Z","updated_at":"2021-08-31T18:24:25Z","author_association":"MEMBER","body":"Hi @nicknezis, I have started poking around in the code base for `Heron` again and I am trying to wrap my head around what needs to happen here. Again, I do not have any experience in the codebase.\r\n\r\n> By providing a Pod Template as a ConfigMap, the Heron Kubernetes Scheduler can retrieve the template and provide it as a base starting point for Pod definition.\r\n\r\nThis appears to be setting up the `Config` on the Scheduler:\r\nhttps://github.com/apache/incubator-heron/blob/4d9a7de106d6f1f6de6a96f996735c5fc636011b/heron/schedulers/src/java/org/apache/heron/scheduler/kubernetes/KubernetesScheduler.java#L57-L83\r\n\r\nThe following code block appears to be creating the YAML config based on the required record structures:\r\nhttps://github.com/apache/spark/blob/de59e01aa4853ef951da080c0d1908d53d133ebe/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/deploy/k8s/features/PodTemplateConfigMapStep.scala#L39-L66\r\n\r\nI am trying to figure out what my starting point for this should be on the `Heron` side, any ideas? What functionality is available as far as building the YAML record structures (`Config.Builder`)?\r\n\r\nThe following utility is preparing the `ConfigMap` and storing the YAML `<Key, Value>` pairs from the `topologyConfig`:\r\nhttps://github.com/apache/incubator-heron/blob/4d9a7de106d6f1f6de6a96f996735c5fc636011b/heron/api/src/java/org/apache/heron/api/utils/TopologyUtils.java#L295-L323\r\n","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/908778398/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/911104179","html_url":"https://github.com/apache/incubator-heron/pull/3709#issuecomment-911104179","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3709","id":911104179,"node_id":"IC_kwDOApKMps42Tliz","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-02T03:26:45Z","updated_at":"2021-09-02T03:26:45Z","author_association":"CONTRIBUTOR","body":"Thank you for the submission!","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/911104179/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/911841877","html_url":"https://github.com/apache/incubator-heron/pull/3709#issuecomment-911841877","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3709","id":911841877,"node_id":"IC_kwDOApKMps42WZpV","user":{"login":"joshfischer1108","id":5785700,"node_id":"MDQ6VXNlcjU3ODU3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5785700?v=4","gravatar_id":"","url":"https://api.github.com/users/joshfischer1108","html_url":"https://github.com/joshfischer1108","followers_url":"https://api.github.com/users/joshfischer1108/followers","following_url":"https://api.github.com/users/joshfischer1108/following{/other_user}","gists_url":"https://api.github.com/users/joshfischer1108/gists{/gist_id}","starred_url":"https://api.github.com/users/joshfischer1108/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshfischer1108/subscriptions","organizations_url":"https://api.github.com/users/joshfischer1108/orgs","repos_url":"https://api.github.com/users/joshfischer1108/repos","events_url":"https://api.github.com/users/joshfischer1108/events{/privacy}","received_events_url":"https://api.github.com/users/joshfischer1108/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-02T16:08:11Z","updated_at":"2021-09-02T16:08:11Z","author_association":"MEMBER","body":"Thank you for the contribution @zhangshaoning1 ","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/911841877/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/911959524","html_url":"https://github.com/apache/incubator-heron/issues/3707#issuecomment-911959524","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3707","id":911959524,"node_id":"IC_kwDOApKMps42W2Xk","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-02T18:44:57Z","updated_at":"2021-09-08T02:58:36Z","author_association":"MEMBER","body":"A quick review of the code in the `heron/schedulers/src/java/org/apache/heron/scheduler/kubernetes/` directory, and some other related code:\r\n\r\n* `KubernetesConstants`: namespaced constants for configurations.\r\n* `KubernetesContext`: child class of `Context` with Kubernetes specific keys used to lookup values (no \"setters\", only \"getters\") stored in the supplied `Config` object.\r\n* `KubernetesController`: the basic interface with Kubernetes to recover info about the topology configs as well as submit/kill/restart them.\r\n* `KubernetesLauncher`: used to submit a topology to the Kubernetes cluster.\r\n* `KubernetesScheduler`: the interface to manage the cluster, get info, kill, restart, resize, and update the cluster size based on the topology. It contains a `KubernetesController` object which facilitates the comms with the cluster.\r\n* `KubernetesUtils`: various logging utilities.\r\n* `V1Controller`: child class of the `KubernetesController` which contains the actual logic to interface with the Kubernetes cluster. The `PackingPlan` for the instances is central to operations with configurations stored in a `ContainerPlan` object.\r\n* `Volumes`: utilities used to configure the clusters storage volumes.\r\n* `PackingPlan`: `heron/spi/src/java/org/apache/heron/spi/packing/` has the classes for `PackingPlan`, `InstancePlan` and `ContainerPlan`.\r\n\r\nI have very quickly compiled a basic `Pod Config`:\r\n```YAML\r\n# POD CONFIG WITH TEMPLATE:\r\napiVersion: v1\r\nkind: Pod\r\nmetadata:\r\n  name: heron-node\r\nspec:\r\n  replicas: 2\r\n  selector:\r\n    matchLabels:\r\n      app: heron-node\r\n  template:\r\n    metadata:\r\n      labels:\r\n        app: heron-node\r\n    spec:\r\n      containers:\r\n      - name: heron-node\r\n        image: centos:8\r\n        command: ['sh', '-c', 'echo \"Heron Kubernetes node.\" && sleep 3600']\r\n        resources:\r\n          requests:\r\n            memory: \"1Gb\"\r\n            cpu: \"250m\"\r\n          limits:\r\n            memory: \"5Gb\"\r\n            cpu: \"500m\"\r\n        securityContext:\r\n          allowPrivilegeEscalation: false\r\n          capabilities:\r\n            add: [\"NET_ADMIN\", \"SYS_TIME\"]\r\n      restartPolicy: OnFailure\r\n```\r\n\r\nThe code [snippet](https://github.com/apache/spark/blob/de59e01aa4853ef951da080c0d1908d53d133ebe/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/deploy/k8s/features/PodTemplateConfigMapStep.scala#L39-L54) from Spark is appending the following to the pod config, which creates a `Volume` mount pointing to the pod config template:\r\n\r\n```YAML\r\n  volumes:\r\n    - name: pod-template-name  # from <POD_TEMPLATE_VOLUME>.\r\n      configMap:\r\n        name: configmap-name  # from <configmapName>.\r\n        items:\r\n        - key: pod-template-key  # from <POD_TEMPLATE_KEY>.\r\n          path: executor-pod-spec-template-file-name # from <EXECUTOR_POD_SPEC_TEMPLATE_FILE_NAME>.\r\n```\r\n\r\nThis code [snippet](https://github.com/apache/spark/blob/de59e01aa4853ef951da080c0d1908d53d133ebe/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/deploy/k8s/features/PodTemplateConfigMapStep.scala#L56-L61) is adding the `Volume` mount pointing to a container config template:\r\n\r\n```YAML\r\n  volumes:\r\n    - name: pod-template-name  # from <POD_TEMPLATE_VOLUME>.\r\n      path: executor-pod-spec-template-mount-path # from <EXECUTOR_POD_SPEC_TEMPLATE_MOUNTPATH>.\r\n```\r\n\r\nThe constants (caps naming convention) are defined [here](https://github.com/apache/spark/blob/de59e01aa4853ef951da080c0d1908d53d133ebe/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/deploy/k8s/Constants.scala#L81-L85). If we are to follow what Spark is doing, we will need to declare these constants as conventions and document them. The most prudent place for these constants is `KubernetesConstants` as they will not be required outside. The `configmapName` is being acquired as [such](https://github.com/apache/spark/blob/de59e01aa4853ef951da080c0d1908d53d133ebe/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/deploy/k8s/features/PodTemplateConfigMapStep.scala#L37).\r\n\r\nThe remaining two routines in the Spark code appear to be extracting information from the configs - they are not modifying them.\r\n\r\nThe question now is what functionality exists within Heron to modify the `Config` object to append the YAML elements to the `Config` as well as where (object) the actual pod/container configs are stored within the `Config`. Another question is if there is support for both containers and pods configs, and what the structure within the `Config` object is. Once we have an understanding of these things I can hammer out a solution.\r\n\r\nThe following are client API components to interface with Kubernetes:\r\n* `V1PodSpec`: [io.kubernetes.client.openapi.models.V1PodSpec](https://javadoc.io/static/io.kubernetes/client-java-api/13.0.0/io/kubernetes/client/openapi/models/V1PodSpec.html) configuration for the pods. Includes methods to `setVolumes` as well as `setSecurityContext`. This will be set in a `Pod Template`.\r\n* `V1PodTemplateSpec`: [io.kubernetes.client.openapi.models.V1PodTemplateSpec\r\n](https://javadoc.io/static/io.kubernetes/client-java-api/13.0.0/io/kubernetes/client/openapi/models/V1PodTemplateSpec.html) is the pod template config. This needs to be put into a `Stateful Set`.\r\n* `V1StatefulSetSpec`: [io.kubernetes.client.openapi.models.V1StatefulSetSpec](https://javadoc.io/static/io.kubernetes/client-java-api/11.0.0/io/kubernetes/client/openapi/models/V1StatefulSetSpec.html) sateful set config.\r\n* `V1StatefulSetSpecBuilder`: [io.kubernetes.client.openapi.models.V1StatefulSetSpecBuilder](https://javadoc.io/static/io.kubernetes/client-java-api/11.0.0/io/kubernetes/client/openapi/models/V1StatefulSetSpecBuilder.html) used to build/generate the `Stateful Set` configs.\r\n\r\nI have never used Heron and am learning about the workflow and setup as I go, so please bear with me. I am also still getting familiar with the vast codebase.\r\n","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/911959524/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/915455115","html_url":"https://github.com/apache/incubator-heron/issues/3707#issuecomment-915455115","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3707","id":915455115,"node_id":"IC_kwDOApKMps42kLyL","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-08T18:04:31Z","updated_at":"2021-09-08T18:04:31Z","author_association":"MEMBER","body":"Hi @nicknezis, I have a plan put together   and will start to hammer things out. I shall generate a WIP PR into the Heron repo once I have some of the more substantial components put together.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/915455115/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/917699893","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-917699893","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":917699893,"node_id":"IC_kwDOApKMps42sv01","user":{"login":"joshfischer1108","id":5785700,"node_id":"MDQ6VXNlcjU3ODU3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5785700?v=4","gravatar_id":"","url":"https://api.github.com/users/joshfischer1108","html_url":"https://github.com/joshfischer1108","followers_url":"https://api.github.com/users/joshfischer1108/followers","following_url":"https://api.github.com/users/joshfischer1108/following{/other_user}","gists_url":"https://api.github.com/users/joshfischer1108/gists{/gist_id}","starred_url":"https://api.github.com/users/joshfischer1108/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshfischer1108/subscriptions","organizations_url":"https://api.github.com/users/joshfischer1108/orgs","repos_url":"https://api.github.com/users/joshfischer1108/repos","events_url":"https://api.github.com/users/joshfischer1108/events{/privacy}","received_events_url":"https://api.github.com/users/joshfischer1108/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-12T19:54:58Z","updated_at":"2021-09-12T19:54:58Z","author_association":"MEMBER","body":"@surahman Is this ready for review?  ","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/917699893/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/917709147","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-917709147","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":917709147,"node_id":"IC_kwDOApKMps42syFb","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-12T20:58:36Z","updated_at":"2021-09-12T20:58:36Z","author_association":"MEMBER","body":"@joshfischer1108, yes please. I think it would be beneficial at this point to get some people who are more experienced with the codebase to once over things. We can iterate from there as needed.\n\nWe also need someone who can deploy and test the usage of Pod Templates in a `ConfigMap`s.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/917709147/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/917716337","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-917716337","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":917716337,"node_id":"IC_kwDOApKMps42sz1x","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-12T21:48:17Z","updated_at":"2021-09-12T21:48:17Z","author_association":"CONTRIBUTOR","body":"I'll try testing this tonight. I hadn't noticed that the Spark code used a volume mount. Will have to review that this does what we need. As you said, if not, we can iterate as needed. Thank you for working this feature request.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/917716337/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/917719201","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-917719201","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":917719201,"node_id":"IC_kwDOApKMps42s0ih","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-12T22:09:00Z","updated_at":"2021-09-12T22:09:00Z","author_association":"MEMBER","body":"@nicknezis thank you, I do not have a workload I can actually test this with.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/917719201/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/917741666","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-917741666","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":917741666,"node_id":"IC_kwDOApKMps42s6Bi","user":{"login":"joshfischer1108","id":5785700,"node_id":"MDQ6VXNlcjU3ODU3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5785700?v=4","gravatar_id":"","url":"https://api.github.com/users/joshfischer1108","html_url":"https://github.com/joshfischer1108","followers_url":"https://api.github.com/users/joshfischer1108/followers","following_url":"https://api.github.com/users/joshfischer1108/following{/other_user}","gists_url":"https://api.github.com/users/joshfischer1108/gists{/gist_id}","starred_url":"https://api.github.com/users/joshfischer1108/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshfischer1108/subscriptions","organizations_url":"https://api.github.com/users/joshfischer1108/orgs","repos_url":"https://api.github.com/users/joshfischer1108/repos","events_url":"https://api.github.com/users/joshfischer1108/events{/privacy}","received_events_url":"https://api.github.com/users/joshfischer1108/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T00:17:50Z","updated_at":"2021-09-13T00:17:50Z","author_association":"MEMBER","body":"@surahman Please add unit tests to cover the current code changes.  I realize there are no unit tests atm on this file.  But I think this is a good time to start.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/917741666/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/917798710","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-917798710","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":917798710,"node_id":"IC_kwDOApKMps42tH82","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-13T03:05:59Z","updated_at":"2021-09-13T18:25:53Z","author_association":"MEMBER","body":"@joshfischer1108 I have added some tests for the exposed code but the routines in the `V1Controller` are scoped to private. Testing these routines would mean having to make them protected and then exposing them using an accessor testing class that extends the `V1Controller`. I am not sure if changing the access level for the methods in V1Controller makes sense.\r\n\r\nI have also added tests for the new Constants which were added to ensure complete patch code coverage. I feel testing them is redundant and that testing should be limited to routines and generated objects.\r\n\r\nEdit: I have object reflection setup in the testing base for the `V1ControllerTest` to gain access to the private routines..","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/917798710/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/918745197","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-918745197","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":918745197,"node_id":"IC_kwDOApKMps42wvBt","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T02:35:38Z","updated_at":"2021-09-14T02:37:12Z","author_association":"MEMBER","body":"There are some issues with testing the `createStatefulSet` method in the `V1Controller`, namely with the private scope and an inability to mock it. It also performs some reads from the disk for files when it is setting up the Topology config. This requires mocking to simulate the disk reads, and there is no such functionality in place within the `ToplogyUtilsTest`s.\r\n\r\nI have a WIP `testCreateStatefulSet` method setup but it seems like it might have to be removed along with a refactoring of everything else.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/918745197/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/918882195","html_url":"https://github.com/apache/incubator-heron/pull/3709#issuecomment-918882195","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3709","id":918882195,"node_id":"IC_kwDOApKMps42xQeT","user":{"login":"zhangshaoning1","id":32099766,"node_id":"MDQ6VXNlcjMyMDk5NzY2","avatar_url":"https://avatars.githubusercontent.com/u/32099766?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangshaoning1","html_url":"https://github.com/zhangshaoning1","followers_url":"https://api.github.com/users/zhangshaoning1/followers","following_url":"https://api.github.com/users/zhangshaoning1/following{/other_user}","gists_url":"https://api.github.com/users/zhangshaoning1/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangshaoning1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangshaoning1/subscriptions","organizations_url":"https://api.github.com/users/zhangshaoning1/orgs","repos_url":"https://api.github.com/users/zhangshaoning1/repos","events_url":"https://api.github.com/users/zhangshaoning1/events{/privacy}","received_events_url":"https://api.github.com/users/zhangshaoning1/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T07:22:43Z","updated_at":"2021-09-14T07:22:43Z","author_association":"CONTRIBUTOR","body":"@nwangtw @nickmerwin @billonahill \r\nWho can review and merge this submissionThank you all~","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/918882195/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/919134335","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-919134335","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":919134335,"node_id":"IC_kwDOApKMps42yOB_","user":{"login":"joshfischer1108","id":5785700,"node_id":"MDQ6VXNlcjU3ODU3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5785700?v=4","gravatar_id":"","url":"https://api.github.com/users/joshfischer1108","html_url":"https://github.com/joshfischer1108","followers_url":"https://api.github.com/users/joshfischer1108/followers","following_url":"https://api.github.com/users/joshfischer1108/following{/other_user}","gists_url":"https://api.github.com/users/joshfischer1108/gists{/gist_id}","starred_url":"https://api.github.com/users/joshfischer1108/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshfischer1108/subscriptions","organizations_url":"https://api.github.com/users/joshfischer1108/orgs","repos_url":"https://api.github.com/users/joshfischer1108/repos","events_url":"https://api.github.com/users/joshfischer1108/events{/privacy}","received_events_url":"https://api.github.com/users/joshfischer1108/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T13:09:06Z","updated_at":"2021-09-14T13:09:06Z","author_association":"MEMBER","body":"> @joshfischer1108 I have added some tests for the exposed code but the routines in the `V1Controller` are scoped to private. Testing these routines would mean having to make them protected and then exposing them using an accessor testing class that extends the `V1Controller`. I am not sure if changing the access level for the methods in V1Controller makes sense.\r\n> \r\n> I have also added tests for the new Constants which were added to ensure complete patch code coverage. I feel testing them is redundant and that testing should be limited to routines and generated objects.\r\n> \r\n> Edit: I have object reflection setup in the testing base for the `V1ControllerTest` to gain access to the private routines..\r\n\r\nWell done.  Thank you.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/919134335/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/919135566","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-919135566","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":919135566,"node_id":"IC_kwDOApKMps42yOVO","user":{"login":"joshfischer1108","id":5785700,"node_id":"MDQ6VXNlcjU3ODU3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5785700?v=4","gravatar_id":"","url":"https://api.github.com/users/joshfischer1108","html_url":"https://github.com/joshfischer1108","followers_url":"https://api.github.com/users/joshfischer1108/followers","following_url":"https://api.github.com/users/joshfischer1108/following{/other_user}","gists_url":"https://api.github.com/users/joshfischer1108/gists{/gist_id}","starred_url":"https://api.github.com/users/joshfischer1108/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshfischer1108/subscriptions","organizations_url":"https://api.github.com/users/joshfischer1108/orgs","repos_url":"https://api.github.com/users/joshfischer1108/repos","events_url":"https://api.github.com/users/joshfischer1108/events{/privacy}","received_events_url":"https://api.github.com/users/joshfischer1108/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T13:10:27Z","updated_at":"2021-09-14T13:10:27Z","author_association":"MEMBER","body":"> There are some issues with testing the `createStatefulSet` method in the `V1Controller`, namely with the private scope and an inability to mock it. It also performs some reads from the disk for files when it is setting up the Topology config. This requires mocking to simulate the disk reads, and there is no such functionality in place within the `ToplogyUtilsTest`s.\r\n> \r\n> I have a WIP `testCreateStatefulSet` method setup but it seems like it might have to be removed along with a refactoring of everything else.\r\n\r\nOk, let's create an issue around this and clean this up later.\r\n","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/919135566/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/919251511","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-919251511","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":919251511,"node_id":"IC_kwDOApKMps42yqo3","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-14T15:17:44Z","updated_at":"2021-09-15T20:19:02Z","author_association":"MEMBER","body":"I will write up what I have found on the issue with testing `createStatefulSet`. It is achievable but will be rather involved and require some serious digging in the codebase. I think your judgement is sound to not convolve this issue with the other.\r\n\r\nOn a side note, I think it is time to switch over from Travis CI to Github Actions. From personal experience, I feel that GH Actions are faster to run than Travis CI and it might speed things up to not rely on a third-party service.\r\n\r\nEDIT: I have created issue #3713 with my findings on the `V1Controller` test suite. If anyone has insights or comments please post there.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/919251511/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/920430681","html_url":"https://github.com/apache/incubator-heron/issues/3713#issuecomment-920430681","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3713","id":920430681,"node_id":"IC_kwDOApKMps423KhZ","user":{"login":"nwangtw","id":6353055,"node_id":"MDQ6VXNlcjYzNTMwNTU=","avatar_url":"https://avatars.githubusercontent.com/u/6353055?v=4","gravatar_id":"","url":"https://api.github.com/users/nwangtw","html_url":"https://github.com/nwangtw","followers_url":"https://api.github.com/users/nwangtw/followers","following_url":"https://api.github.com/users/nwangtw/following{/other_user}","gists_url":"https://api.github.com/users/nwangtw/gists{/gist_id}","starred_url":"https://api.github.com/users/nwangtw/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nwangtw/subscriptions","organizations_url":"https://api.github.com/users/nwangtw/orgs","repos_url":"https://api.github.com/users/nwangtw/repos","events_url":"https://api.github.com/users/nwangtw/events{/privacy}","received_events_url":"https://api.github.com/users/nwangtw/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-15T22:29:53Z","updated_at":"2021-09-15T22:29:53Z","author_association":"CONTRIBUTOR","body":"Sounds good to me~ Thanks!\n\nOn Wed, Sep 15, 2021 at 1:17 PM Saad Ur Rahman ***@***.***>\nwrote:\n\n> *Is your feature request related to a problem? Please describe.*\n> There is little to no coverage of the code within the Kubernetes\n> V1Controller class. To be able to add and augment features to the\n> V1Controller we must ensure that we do not break existing functionality\n> and that all code, old and new, is fully covered with tests.\n>\n> *Describe the solution you'd like*\n> There is a basic test suite setup under\n> heron/schedulers/tests/java/org/apache/heron/scheduler/kubernetes/V1ControllerTest.java\n> in a WIP PR which needs to be extended for 100% code coverage of the entire\n> class.\n>\n> The major issue with testing this class is the private scoping of the\n> methods, but this constraint can be overcome using Java Reflections.\n> There is an example in the WIP PR on how to achieve this. A lot of the\n> statements within the methods go fairly deep into various other classes and\n> it is infeasible to generate a fully populated Config object to satisfy\n> the requirements. I encountered a number of null pointer exceptions, some\n> of which were drilled down into file reads. I feel like the best way to\n> handle testing the methods in the V1Controller class is to approach each\n> method individually and mock (mockito) the calls to methods outside the\n> class.\n>\n> I have created a checkPodTemplateConfigMap method in the test suite to\n> test the output of the Pod Template ConfigMap volume mounting. This was\n> done to permit a check of whether the statements added to include the\n> ConfigMap were correctly executed within createStatefulSet. The correct\n> way of handling this would be to setup a mock test that checks to see if\n> the podTemplateConfigMapName is called within createStatefulSet. It is\n> unnecessary to check if the ConfigMap is correct here as there is already\n> an isolated test for it. It would be prudent to refactor the\n> checkPodTemplateConfigMap into testPodTemplateConfigMapVolume once a mock\n> of createStatefulSet is completed.\n>\n> *Describe alternatives you've considered*\n> I have tried to generate fully populated Config Objects to try and\n> satisfy the requirements to use simple JUnit tests to no avail.\n>\n> *Additional context*\n> There is little to no test coverage of this class as it is right now. If\n> things can break, they will break.\n>\n> \n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/apache/incubator-heron/issues/3713>, or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/ABQPBH4JJAFJO7WD6CAVLGTUCD5PNANCNFSM5EDHKEEQ>\n> .\n> Triage notifications on the go with GitHub Mobile for iOS\n> <https://apps.apple.com/app/apple-store/id1477376905?ct=notification-email&mt=8&pt=524675>\n> or Android\n> <https://play.google.com/store/apps/details?id=com.github.android&referrer=utm_campaign%3Dnotification-email%26utm_medium%3Demail%26utm_source%3Dgithub>.\n>\n>\n","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/920430681/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/920537024","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-920537024","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":920537024,"node_id":"IC_kwDOApKMps423kfA","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-16T02:59:56Z","updated_at":"2021-09-16T02:59:56Z","author_association":"CONTRIBUTOR","body":"Looking over the code, I think I failed to point out an important aspect of what Spark is doing with this feature. This code is important to understand the goal. When the scheduler is defining the Pod, it will check for a PodTemplate, and if not defined create a default. Currently the Heron scheduler only starts with a default Pod that it creates from scratch.\r\n\r\nThis [Spark code](https://github.com/apache/spark/blob/0494dc90af48ce7da0625485a4dc6917a244d580/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/deploy/k8s/submit/KubernetesDriverBuilder.scala#L30-L38) illustrates the branching logic that checks for an existing PodTemplate config item.\r\n\r\nThis is the [method](https://github.com/apache/spark/blob/bbb33af2e4c90d679542298f56073a71de001fb7/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/deploy/k8s/KubernetesUtils.scala#L96) used by Spark to actually load the template and create the pod spec.\r\n\r\nThe mounting of the ConfigMap as a volume, is actually something Spark specific that we might not need in Heron. In Spark there is a concept of a driver pod, and this creates the executor pods. So this is why they mount the Executor's PodTemplate ConfigMap into the Driver pod. If I'm not mistaken, our version of `loadPodFromTemplate` could directly lookup the ConfigMap PodTemplate without the need to mount the ConfigMap into the pod.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/920537024/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/920551592","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-920551592","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":920551592,"node_id":"IC_kwDOApKMps423oCo","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-16T03:42:47Z","updated_at":"2021-09-16T18:11:46Z","author_association":"MEMBER","body":"I think I have an idea of what needs to happen... time to iterate :wink:.\r\n\r\n@nicknezis You are correct, Spark's architecture has a driver/coordinator with a fleet of executors. Is there already a `loadPodFromTemplate` in Heron or do we need to put one together? I could not find anything in the `V1Controller` or K8S scheduler codebase in Heron. The [`getContainer`](https://github.com/apache/incubator-heron/blob/7322335a5f4e824a8af2797a3b0dc82e315e3dfb/heron/schedulers/src/java/org/apache/heron/scheduler/kubernetes/V1Controller.java#L510-L574) routine is configuring the Docker container for executor deployment, is this the routine you are referring to?\r\n\r\nThere is also [this](https://github.com/apache/spark/blob/bbb33af2e4c90d679542298f56073a71de001fb7/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/deploy/k8s/KubernetesUtils.scala#L105) which indicates there is a built-in function in the K8S client library (scala and this potentially java too) that should handle the parse and assembly of the Pod Template.\r\n\r\nCurrently `createStatefulSet` relies on the `V1` K8S API to put together a default Pod Template in which most of the fields are simply set to `null`.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/920551592/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/920728629","html_url":"https://github.com/apache/incubator-heron/issues/3600#issuecomment-920728629","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3600","id":920728629,"node_id":"IC_kwDOApKMps424TQ1","user":{"login":"idlecloud","id":5828967,"node_id":"MDQ6VXNlcjU4Mjg5Njc=","avatar_url":"https://avatars.githubusercontent.com/u/5828967?v=4","gravatar_id":"","url":"https://api.github.com/users/idlecloud","html_url":"https://github.com/idlecloud","followers_url":"https://api.github.com/users/idlecloud/followers","following_url":"https://api.github.com/users/idlecloud/following{/other_user}","gists_url":"https://api.github.com/users/idlecloud/gists{/gist_id}","starred_url":"https://api.github.com/users/idlecloud/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/idlecloud/subscriptions","organizations_url":"https://api.github.com/users/idlecloud/orgs","repos_url":"https://api.github.com/users/idlecloud/repos","events_url":"https://api.github.com/users/idlecloud/events{/privacy}","received_events_url":"https://api.github.com/users/idlecloud/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-16T09:12:26Z","updated_at":"2021-09-16T09:12:26Z","author_association":"NONE","body":"I hava the same question, I use python 3.6.5, bazel 4.1.0","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/920728629/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/921719677","html_url":"https://github.com/apache/incubator-heron/pull/3715#issuecomment-921719677","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3715","id":921719677,"node_id":"IC_kwDOApKMps428FN9","user":{"login":"joshfischer1108","id":5785700,"node_id":"MDQ6VXNlcjU3ODU3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5785700?v=4","gravatar_id":"","url":"https://api.github.com/users/joshfischer1108","html_url":"https://github.com/joshfischer1108","followers_url":"https://api.github.com/users/joshfischer1108/followers","following_url":"https://api.github.com/users/joshfischer1108/following{/other_user}","gists_url":"https://api.github.com/users/joshfischer1108/gists{/gist_id}","starred_url":"https://api.github.com/users/joshfischer1108/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshfischer1108/subscriptions","organizations_url":"https://api.github.com/users/joshfischer1108/orgs","repos_url":"https://api.github.com/users/joshfischer1108/repos","events_url":"https://api.github.com/users/joshfischer1108/events{/privacy}","received_events_url":"https://api.github.com/users/joshfischer1108/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-17T11:24:22Z","updated_at":"2021-09-17T11:24:22Z","author_association":"MEMBER","body":"closing for cleaner commit history.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/921719677/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/921926947","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-921926947","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":921926947,"node_id":"IC_kwDOApKMps42830j","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-17T16:27:49Z","updated_at":"2021-09-17T16:27:49Z","author_association":"CONTRIBUTOR","body":"Correct, Heron does not yet have a `loadPodFromTemplate` function. This PR's goal is to add it. We need to look up the ConfigMap, get the embedded template and then pass that into the `kubernetesClient.pods().load(templateFile).get()` call. \r\n\r\nI don't think we can mount the template ConfigMap into the scheduler, so I think instead we will need to do a K8s call to get the ConfigMap. When we get to actually testing, perhaps we will need to add new K8s permissions, but we can figure that out once we can test running the new logic.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/921926947/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/921992801","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-921992801","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":921992801,"node_id":"IC_kwDOApKMps429H5h","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-17T18:19:59Z","updated_at":"2021-09-17T18:36:25Z","author_association":"MEMBER","body":"Okay, so I am going to endeavour to break this down - please bear with me as I am still relatively new to the codebase and K8s API...\r\n\r\n---\r\n\r\nStarting with the reference code in [Spark](https://github.com/apache/spark/blob/bbb33af2e4c90d679542298f56073a71de001fb7/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/deploy/k8s/KubernetesUtils.scala#L96-L113), and keeping in mind that the Spark architecture is different from Heron's:\r\n\r\nThis simply gets the Hadoop config from the driver/coordinator:\r\n\r\n```scala\r\nval hadoopConf = SparkHadoopUtil.get.newConfiguration(conf)\r\n```\r\n\r\nThese two lines are going to download the remote file from the driver/coordinator and make them local to a machine. The first line [downloads](https://github.com/joan38/kubernetes-client/blob/6fbf23b7a997e572456256c4714222ea734bd845/kubernetes-client/src/com/goyeau/kubernetes/client/api/PodsApi.scala#L119-L148) the file, assuming I am looking at the correct Scala K8s API, and the second retrieves a file descriptor/handle on the downloaded file:\r\n\r\n```scala\r\nval localFile = downloadFile(templateFileName, Utils.createTempDir(), conf, hadoopConf)\r\nval templateFile = new File(new java.net.URI(localFile).getPath)\r\n```\r\n\r\nThis third line then does the heavy lifting of reading the Pod Template into a Pod Config from the newly copied local file:\r\n\r\n```scala\r\nval pod = kubernetesClient.pods().load(templateFile).get()\r\n```\r\n\r\nThe final line sets up the Spark container with the Pod Template and specified name:\r\n\r\n```scala\r\nselectSparkContainer(pod, containerName)\r\n```\r\n\r\n---\r\n\r\nMoving on to what we need to do on the Heron side:\r\n\r\n1. Read the `ConfigMap` name from the `--config-property` option. I set the key for this to `heron.kubernetes.pod.template.configmap.name` with the value being the file name.\r\n2. Read the YAML `ConfigMap` and extract the YAML node tree which contains the Pod Template. For this, we will either need a YAML parser or need to find a utility in the K8s Java API to do the job. I think the K8s Java API should include a utility for this, a lack thereof would remain a significant oversight on their part.\r\n3. Create a `V1PodTemplateSpec` object using the results from step 2.\r\n4. Iron out permission issues during testing, should they arise.\r\n\r\nI am not familiar with the K8s API but will start digging around for a YAML config to V1 object parser, if anyone is aware of where it is please let me know. There are some suggestions [here](https://github.com/kubernetes-client/java/issues/170) and the YAML reader within K8s is found [here](https://javadoc.io/static/io.kubernetes/client-java/6.0.1/io/kubernetes/client/util/Yaml.html).","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/921992801/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/922011806","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-922011806","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":922011806,"node_id":"IC_kwDOApKMps429Mie","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-17T18:54:50Z","updated_at":"2021-09-17T18:54:50Z","author_association":"CONTRIBUTOR","body":"I think that's correct, but steps 2 might be somewhat simpler than you describe. I'll try to find a better example, but I think step 2 should be something like [this example](https://github.com/fabric8io/kubernetes-client/blob/04e0b2e2530751c90aeb9c0465ad3219c46a636f/kubernetes-examples/src/main/java/io/fabric8/kubernetes/examples/ConfigMapExample.java#L52). It is Fabric8 API, but there should be a similar `get` method using the official k8s api.\r\n\r\nOnce you lookup the ConfigMap object, you should be able to call [`getData()`](https://github.com/kubernetes-client/java/blob/69cc44bac6764a93d9d8e384c326554a21bb2d89/kubernetes/src/main/java/io/kubernetes/client/openapi/models/V1ConfigMap.java#L145) to retrieve the ConfigMap's value which should be the `template` that is passed into `kubernetesClient.pods().load(template).get()`.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/922011806/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/922017460","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-922017460","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":922017460,"node_id":"IC_kwDOApKMps429N60","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-17T19:05:06Z","updated_at":"2021-09-17T19:05:06Z","author_association":"CONTRIBUTOR","body":"Doing a bit of research, I see a `listNamespacedConfigMap` method that returns `V1ConfigMapList`. That class has a `getItems` [method](https://github.com/kubernetes-client/java/blob/f20788272291c0e79a8c831d8d5a7dd94d96d2de/kubernetes/src/main/java/io/kubernetes/client/openapi/models/V1ConfigMapList.java#L91) that returns a `List<V1ConfigMap>`. Not sure if there is a more direct way to get the specifically named `ConfigMap`, but this seems to match the logic in that Fabric8 example I previously linked to.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/922017460/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/922103249","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-922103249","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":922103249,"node_id":"IC_kwDOApKMps429i3R","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-17T21:57:40Z","updated_at":"2021-09-17T21:57:40Z","author_association":"MEMBER","body":"My confusion seems to stem from when the K8s cluster is provided with the K8s executor pod configs. Judging from [this](https://github.com/apache/incubator-heron/blob/master/website2/docs/schedulers-k8s-by-hand.md) a config file is not submitted to the cluster for the executor Pods, but a default one is created by `createStatefulSet` and [submitted](https://github.com/apache/incubator-heron/blob/396f2b848da0f56dcfda1d917928358133851cf5/heron/schedulers/src/java/org/apache/heron/scheduler/kubernetes/V1Controller.java#L126) with the job.\r\n\r\nIf that is the case, and that has been my assumption thus far, then we would then need to read in the [ConfigMap](https://kubernetes.io/docs/concepts/configuration/configmap/) file that was provided as a parameter to `--config-property`. We would then do a simple check around [here](https://github.com/apache/incubator-heron/blob/396f2b848da0f56dcfda1d917928358133851cf5/heron/schedulers/src/java/org/apache/heron/scheduler/kubernetes/V1Controller.java#L386) and insert the contents of the ConfigMap into the `PodTemplateSpec`. If this is correct, would it not be simpler to declare a Pod Template file for the executor Pods and provide that as a parameter to `--config-property`, read it in using the k8s V1 YAML parser and place it into the `PodTemplateSpec` in the `StatefulSet`?\r\n\r\nIf there is a k8s config submitted (I do not have any experience with Heron with k8s) then we could locate the configs in the `Config` object and linearly probe the `V1ConfigMapList` for a name provided by the `--config-property` and insert that.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/922103249/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/922162384","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-922162384","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":922162384,"node_id":"IC_kwDOApKMps429xTQ","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-18T02:14:49Z","updated_at":"2021-09-18T02:14:49Z","author_association":"CONTRIBUTOR","body":"Yes, I think we might be saying the same thing. The pod configs would be loaded before job submission. The K8s scheduler exists in the Heron API Server. So someone wanting to use this feature would install Heron API Server and the specifically named ConfigMap PodTemplate. Then when submitting the topology with the new `--config-property`, the Heron scheduler would lookup and use the PodTemplate, instead of making the default StatefulSet with `createStatefulSet`.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/922162384/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/922278498","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-922278498","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":922278498,"node_id":"IC_kwDOApKMps42-Npi","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-18T13:44:28Z","updated_at":"2021-09-19T21:04:04Z","author_association":"MEMBER","body":"I have begun the completed the [logic](https://github.com/surahman/incubator-heron/commit/e3d72c9a81b7c359794c3c1a7c121ad24646e234). I have linked the API references below. The API reference for `listNamespacedConfigMap` states that only the namespace is a required parameter but I am running into issues with just providing the namespace. If you have any guidance on what to set these to it would be greatly appreciated, I am working on figuring them out.\r\n\r\nWe need to iterate over the `ConfigMap`s in the `KubernetesConstants.DEFAULT_NAMESPACE` and probe each for a key with the specified `podTemplateConfigMapName`. This data is stored as a String which will require the V1 YAML parser to convert it to the `V1PodTemplateSpec`. The routine will return the default constructed (empty) `V1PodTemplateSpec` if no Pod Template name is set via `--config-property`.\r\n\r\n[`listNameSpacedConfigMapName`](https://javadoc.io/doc/io.kubernetes/client-java-api/latest/io/kubernetes/client/openapi/apis/CoreV1Api.html#listNamespacedConfigMap-java.lang.String-java.lang.String-java.lang.Boolean-java.lang.String-java.lang.String-java.lang.String-java.lang.Integer-java.lang.String-java.lang.String-java.lang.Integer-java.lang.Boolean-) API.\r\n\r\n[`V1ConfigMap`](https://javadoc.io/static/io.kubernetes/client-java-api/7.0.0/io/kubernetes/client/openapi/models/V1ConfigMap.html) API.\r\n\r\n**Edit:**  I have merged the dev branch to bring the code changes into view for review. Testing private methods is rather complicated and contrived. We might need to reconsider the access level of methods that require testing to be protected instead.\r\n\r\nRunning a Style Check prior to commits is not flagging issues locally. We need style files that are compatible with newer versions of [CheckStyle](https://github.com/checkstyle/checkstyle) linter app and IDE plugins:\r\n`tools/java/src/org/apache/bazel/checkstyle/heron_coding_style.xml`\r\nThe current workaround is to install the plugin and use an older version of the engine.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/922278498/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/923142393","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-923142393","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":923142393,"node_id":"IC_kwDOApKMps43Bgj5","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-20T17:46:42Z","updated_at":"2021-09-21T21:39:16Z","author_association":"MEMBER","body":"I am not sure why the following tests keep timing out:\r\n```bash\r\n//heron/stmgr/tests/cpp/server:stmgr_unittest                           TIMEOUT in 3 out of 3 in 315.0s\r\n  Stats over 3 runs: max = 315.0s, min = 315.0s, avg = 315.0s, dev = 0.0s\r\nTest cases: finished with 6 passing and 1 failing out of 7 test cases\r\n```\r\nThere are no details being provided and my code is not doing anything which would deviate from generating the default Pod Template when no parameter is set using `--config-property`.\r\n\r\n**_Edit:_**\r\nI have extracted the `getConfigMaps` routine for stubbing purposes to simplify testing. I have rejigged and refactored the tests to support checks for the exception messages being thrown. More complex and complete tests are to follow. Updates are on the parallel `dev` branch.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/923142393/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/924531062","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-924531062","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":924531062,"node_id":"IC_kwDOApKMps43Gzl2","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-22T02:28:26Z","updated_at":"2021-09-22T17:15:06Z","author_association":"MEMBER","body":"Hi @nicknezis, could you please clarify whether this is what a `ConfigMap` with a `Pod Template` would look like, and if not could you please provide an example?\r\n\r\n```yaml\r\napiVersion: v1\r\nkind: ConfigMap\r\nmetadata:\r\n  name: some-config-map-name\r\ndata:\r\n  configmap-name: |\r\n    apiVersion: apps/v1\r\n    kind: PodTemplate\r\n    metadata:\r\n      name: heron-tracker\r\n      namespace: default\r\n    template:\r\n      metadata:\r\n        labels:\r\n          app: heron-tracker\r\n      spec:\r\n        containers:\r\n          - name: heron-tracker\r\n            image: apache/heron:latest\r\n            ports:\r\n              - containerPort: 8888\r\n                name: api-port\r\n            resources:\r\n              requests:\r\n                cpu: \"100m\"\r\n                memory: \"200M\"\r\n              limits:\r\n                cpu: \"400m\"\r\n                memory: \"512M\"\r\n```\r\n\r\nI am in the final stages of testing the code and need to make sure I have the correct format for the `ConfigMap`s in case I need to make tweaks. The `heron.kubernetes.pod.template.configmap.name` is the key variable in the Java code but in the actual document, it will be the value associated with the key.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/924531062/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/925185069","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-925185069","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":925185069,"node_id":"IC_kwDOApKMps43JTQt","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-22T18:32:28Z","updated_at":"2021-09-22T18:32:28Z","author_association":"MEMBER","body":"The test suite is complete. The builds keep failing with a timeout on one specific test and I am unsure of how to adjust it:\r\n```bash\r\n//heron/stmgr/tests/cpp/server:stmgr_unittest                           TIMEOUT in 3 out of 3 in 315.0s\r\n  Stats over 3 runs: max = 315.0s, min = 315.0s, avg = 315.0s, dev = 0.0s\r\n```\r\nI think the timer for the tests is too aggressive for the Travis CI build machines. There was a point earlier where it did pass build but there tend to be random failures of varying varieties during the builds.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/925185069/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926128468","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-926128468","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":926128468,"node_id":"IC_kwDOApKMps43M5lU","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-23T20:25:29Z","updated_at":"2021-09-24T00:03:43Z","author_association":"MEMBER","body":"This is a preplexing issue. The tests appear to pass on fresh Ubuntu18.04 Docker Container on a better spec'd machine but fail on a lower spec'd machine. Commands to setup and execute the build and test are as follows:\r\n\r\n```bash\r\ncd heron_root_dir\r\ndocker/scripts/dev-env-create.sh heron-dev\r\n\r\n./bazel_configure.py\r\nbazel build --config=ubuntu heron/...\r\n\r\nbazel test --config=ubuntu --test_output=errors --cache_test_results=no --test_verbose_timeout_warnings heron/...\r\nbazel test --config=ubuntu --test_output=all --cache_test_results=no --test_verbose_timeout_warnings heron/stmgr/tests/cpp/server:stmgr_unittest\r\n```\r\n\r\nWhen I `cat` the `V1Controller.java` file in the containers terminal `loadPodFromTemplate` it is as it should be and wired up correctly in `createStatefulSet` on line 387. Could someone else please clone the repo and test if it passes the build? @joshfischer1108, @nicknezis, and anyone else who has some time, I could use an extra set of objective eyes on this. I am sure it is just something silly that got overlooked.\r\n\r\nI have also cleaned out the `loadPodFromTemplate` function and set it up to simple return a new/empty `V1PodTemplateSpec` to no avail on the more constrained system:\r\n\r\n```java\r\n  private V1PodTemplateSpec loadPodFromTemplate() {\r\n\r\n    return new V1PodTemplateSpec();\r\n  }\r\n```\r\n\r\n<details><summary>Complete test ouput - higher spec</summary>\r\n<p>\r\n\r\n```bash\r\nINFO: Elapsed time: 459.454s, Critical Path: 42.93s\r\nINFO: 1374 processes: 331 internal, 1043 local.\r\nINFO: Build completed successfully, 1374 total actions\r\n//heron/api/tests/cpp:serialization_unittest                             PASSED in 0.0s\r\n//heron/api/tests/java:BaseWindowedBoltTest                              PASSED in 0.3s\r\n//heron/api/tests/java:ConfigTest                                        PASSED in 0.2s\r\n//heron/api/tests/java:CountStatAndMetricTest                            PASSED in 0.3s\r\n//heron/api/tests/java:GeneralReduceByKeyAndWindowOperatorTest           PASSED in 0.4s\r\n//heron/api/tests/java:HeronSubmitterTest                                PASSED in 1.9s\r\n//heron/api/tests/java:JoinOperatorTest                                  PASSED in 0.4s\r\n//heron/api/tests/java:KVStreamletShadowTest                             PASSED in 0.5s\r\n//heron/api/tests/java:KeyByOperatorTest                                 PASSED in 0.5s\r\n//heron/api/tests/java:LatencyStatAndMetricTest                          PASSED in 0.3s\r\n//heron/api/tests/java:ReduceByKeyAndWindowOperatorTest                  PASSED in 0.4s\r\n//heron/api/tests/java:StreamletImplTest                                 PASSED in 0.4s\r\n//heron/api/tests/java:StreamletShadowTest                               PASSED in 0.4s\r\n//heron/api/tests/java:StreamletUtilsTest                                PASSED in 0.3s\r\n//heron/api/tests/java:UtilsTest                                         PASSED in 0.3s\r\n//heron/api/tests/java:WaterMarkEventGeneratorTest                       PASSED in 0.4s\r\n//heron/api/tests/java:WindowManagerTest                                 PASSED in 0.3s\r\n//heron/api/tests/java:WindowedBoltExecutorTest                          PASSED in 0.5s\r\n//heron/api/tests/scala:api-scala-test                                   PASSED in 0.9s\r\n  WARNING: //heron/api/tests/scala:api-scala-test: Test execution time (0.9s excluding execution overhead) outside of range for MODERATE tests. Consider setting timeout=\"short\" or size=\"small\".\r\n//heron/ckptmgr/tests/java:CheckpointManagerServerTest                   PASSED in 0.6s\r\n//heron/common/tests/cpp/basics:fileutils_unittest                       PASSED in 0.0s\r\n//heron/common/tests/cpp/basics:rid_unittest                             PASSED in 0.0s\r\n//heron/common/tests/cpp/basics:strutils_unittest                        PASSED in 0.0s\r\n//heron/common/tests/cpp/basics:utils_unittest                           PASSED in 0.0s\r\n//heron/common/tests/cpp/config:topology-config-helper_unittest          PASSED in 0.0s\r\n//heron/common/tests/cpp/errors:errors_unittest                          PASSED in 0.0s\r\n//heron/common/tests/cpp/errors:module_unittest                          PASSED in 0.0s\r\n//heron/common/tests/cpp/errors:syserrs_unittest                         PASSED in 0.0s\r\n//heron/common/tests/cpp/metrics:count-metric_unittest                   PASSED in 0.0s\r\n//heron/common/tests/cpp/metrics:mean-metric_unittest                    PASSED in 0.0s\r\n//heron/common/tests/cpp/metrics:multi-count-metric_unittest             PASSED in 0.0s\r\n//heron/common/tests/cpp/metrics:multi-mean-metric_unittest              PASSED in 0.0s\r\n//heron/common/tests/cpp/metrics:time-spent-metric_unittest              PASSED in 1.3s\r\n//heron/common/tests/cpp/network:http_unittest                           PASSED in 0.1s\r\n//heron/common/tests/cpp/network:order_unittest                          PASSED in 0.1s\r\n//heron/common/tests/cpp/network:packet_unittest                         PASSED in 0.0s\r\n//heron/common/tests/cpp/network:piper_unittest                          PASSED in 2.0s\r\n//heron/common/tests/cpp/network:rate_limit_unittest                     PASSED in 4.1s\r\n//heron/common/tests/cpp/network:switch_unittest                         PASSED in 0.2s\r\n//heron/common/tests/cpp/threads:spcountdownlatch_unittest               PASSED in 2.0s\r\n//heron/common/tests/java:ByteAmountTest                                 PASSED in 0.3s\r\n//heron/common/tests/java:CommunicatorTest                               PASSED in 0.3s\r\n//heron/common/tests/java:ConfigReaderTest                               PASSED in 0.3s\r\n//heron/common/tests/java:EchoTest                                       PASSED in 0.6s\r\n//heron/common/tests/java:FileUtilsTest                                  PASSED in 1.0s\r\n//heron/common/tests/java:HeronServerTest                                PASSED in 1.5s\r\n//heron/common/tests/java:PackageTypeTest                                PASSED in 0.3s\r\n//heron/common/tests/java:SysUtilsTest                                   PASSED in 4.9s\r\n//heron/common/tests/java:SystemConfigTest                               PASSED in 0.4s\r\n//heron/common/tests/java:TopologyUtilsTest                              PASSED in 0.4s\r\n//heron/common/tests/java:WakeableLooperTest                             PASSED in 1.3s\r\n//heron/common/tests/python/pex_loader:pex_loader_unittest               PASSED in 0.7s\r\n//heron/downloaders/tests/java:DLDownloaderTest                          PASSED in 0.8s\r\n//heron/downloaders/tests/java:ExtractorTests                            PASSED in 0.4s\r\n//heron/downloaders/tests/java:RegistryTest                              PASSED in 0.4s\r\n//heron/executor/tests/python:executor_unittest                          PASSED in 1.0s\r\n//heron/healthmgr/tests/java:BackPressureDetectorTest                    PASSED in 0.6s\r\n//heron/healthmgr/tests/java:BackPressureSensorTest                      PASSED in 0.6s\r\n//heron/healthmgr/tests/java:BufferSizeSensorTest                        PASSED in 0.5s\r\n//heron/healthmgr/tests/java:DataSkewDiagnoserTest                       PASSED in 0.5s\r\n//heron/healthmgr/tests/java:ExecuteCountSensorTest                      PASSED in 0.5s\r\n//heron/healthmgr/tests/java:GrowingWaitQueueDetectorTest                PASSED in 0.5s\r\n//heron/healthmgr/tests/java:HealthManagerTest                           PASSED in 0.9s\r\n//heron/healthmgr/tests/java:HealthPolicyConfigReaderTest                PASSED in 0.5s\r\n//heron/healthmgr/tests/java:LargeWaitQueueDetectorTest                  PASSED in 0.7s\r\n//heron/healthmgr/tests/java:MetricsCacheMetricsProviderTest             PASSED in 0.6s\r\n//heron/healthmgr/tests/java:PackingPlanProviderTest                     PASSED in 0.6s\r\n//heron/healthmgr/tests/java:ProcessingRateSkewDetectorTest              PASSED in 0.6s\r\n//heron/healthmgr/tests/java:ScaleUpResolverTest                         PASSED in 0.7s\r\n//heron/healthmgr/tests/java:SlowInstanceDiagnoserTest                   PASSED in 0.6s\r\n//heron/healthmgr/tests/java:UnderProvisioningDiagnoserTest              PASSED in 0.5s\r\n//heron/healthmgr/tests/java:WaitQueueSkewDetectorTest                   PASSED in 0.5s\r\n//heron/instance/tests/java:ActivateDeactivateTest                       PASSED in 0.5s\r\n//heron/instance/tests/java:BoltInstanceTest                             PASSED in 0.5s\r\n//heron/instance/tests/java:BoltStatefulInstanceTest                     PASSED in 2.5s\r\n//heron/instance/tests/java:ConnectTest                                  PASSED in 0.6s\r\n//heron/instance/tests/java:CustomGroupingTest                           PASSED in 0.6s\r\n//heron/instance/tests/java:EmitDirectBoltTest                           PASSED in 0.6s\r\n//heron/instance/tests/java:EmitDirectSpoutTest                          PASSED in 0.8s\r\n//heron/instance/tests/java:GlobalMetricsTest                            PASSED in 0.3s\r\n//heron/instance/tests/java:HandleReadTest                               PASSED in 0.7s\r\n//heron/instance/tests/java:HandleWriteTest                              PASSED in 5.8s\r\n//heron/instance/tests/java:MultiAssignableMetricTest                    PASSED in 0.3s\r\n//heron/instance/tests/java:SpoutInstanceTest                            PASSED in 2.6s\r\n//heron/instance/tests/java:SpoutStatefulInstanceTest                    PASSED in 2.5s\r\n//heron/instance/tests/python/network:event_looper_unittest              PASSED in 2.9s\r\n//heron/instance/tests/python/network:gateway_looper_unittest            PASSED in 10.8s\r\n//heron/instance/tests/python/network:heron_client_unittest              PASSED in 0.9s\r\n//heron/instance/tests/python/network:metricsmgr_client_unittest         PASSED in 1.0s\r\n//heron/instance/tests/python/network:protocol_unittest                  PASSED in 0.9s\r\n//heron/instance/tests/python/network:st_stmgrcli_unittest               PASSED in 0.9s\r\n//heron/instance/tests/python/utils:communicator_unittest                PASSED in 0.9s\r\n//heron/instance/tests/python/utils:custom_grouping_unittest             PASSED in 0.9s\r\n//heron/instance/tests/python/utils:global_metrics_unittest              PASSED in 1.0s\r\n//heron/instance/tests/python/utils:log_unittest                         PASSED in 0.8s\r\n//heron/instance/tests/python/utils:metrics_helper_unittest              PASSED in 1.0s\r\n//heron/instance/tests/python/utils:outgoing_tuple_helper_unittest       PASSED in 0.9s\r\n//heron/instance/tests/python/utils:pplan_helper_unittest                PASSED in 1.0s\r\n//heron/instance/tests/python/utils:py_metrics_unittest                  PASSED in 0.9s\r\n//heron/instance/tests/python/utils:topology_context_impl_unittest       PASSED in 0.9s\r\n//heron/instance/tests/python/utils:tuple_helper_unittest                PASSED in 0.9s\r\n//heron/io/dlog/tests/java:DLInputStreamTest                             PASSED in 0.5s\r\n//heron/io/dlog/tests/java:DLOutputStreamTest                            PASSED in 0.5s\r\n//heron/metricscachemgr/tests/java:CacheCoreTest                         PASSED in 0.5s\r\n//heron/metricscachemgr/tests/java:MetricsCacheQueryUtilsTest            PASSED in 0.4s\r\n//heron/metricscachemgr/tests/java:MetricsCacheTest                      PASSED in 0.4s\r\n//heron/metricsmgr/tests/java:FileSinkTest                               PASSED in 0.5s\r\n//heron/metricsmgr/tests/java:HandleTManagerLocationTest                 PASSED in 0.5s\r\n//heron/metricsmgr/tests/java:MetricsCacheSinkTest                       PASSED in 9.4s\r\n//heron/metricsmgr/tests/java:MetricsManagerServerTest                   PASSED in 0.6s\r\n//heron/metricsmgr/tests/java:MetricsUtilTests                           PASSED in 0.4s\r\n//heron/metricsmgr/tests/java:PrometheusSinkTests                        PASSED in 0.4s\r\n//heron/metricsmgr/tests/java:SinkExecutorTest                           PASSED in 0.5s\r\n//heron/metricsmgr/tests/java:TManagerSinkTest                           PASSED in 9.4s\r\n//heron/metricsmgr/tests/java:WebSinkTest                                PASSED in 0.5s\r\n//heron/packing/tests/java:FirstFitDecreasingPackingTest                 PASSED in 0.6s\r\n//heron/packing/tests/java:PackingPlanBuilderTest                        PASSED in 0.4s\r\n//heron/packing/tests/java:PackingUtilsTest                              PASSED in 0.4s\r\n//heron/packing/tests/java:ResourceCompliantRRPackingTest                PASSED in 0.8s\r\n//heron/packing/tests/java:RoundRobinPackingTest                         PASSED in 0.6s\r\n//heron/packing/tests/java:ScorerTest                                    PASSED in 0.2s\r\n//heron/scheduler-core/tests/java:HttpServiceSchedulerClientTest         PASSED in 1.0s\r\n//heron/scheduler-core/tests/java:JsonFormatterUtilsTest                 PASSED in 0.4s\r\n//heron/scheduler-core/tests/java:LaunchRunnerTest                       PASSED in 1.1s\r\n//heron/scheduler-core/tests/java:LauncherUtilsTest                      PASSED in 1.7s\r\n//heron/scheduler-core/tests/java:LibrarySchedulerClientTest             PASSED in 0.5s\r\n//heron/scheduler-core/tests/java:RuntimeManagerMainTest                 PASSED in 2.3s\r\n//heron/scheduler-core/tests/java:RuntimeManagerRunnerTest               PASSED in 2.1s\r\n//heron/scheduler-core/tests/java:SchedulerClientFactoryTest             PASSED in 1.1s\r\n//heron/scheduler-core/tests/java:SchedulerMainTest                      PASSED in 3.0s\r\n//heron/scheduler-core/tests/java:SchedulerServerTest                    PASSED in 0.5s\r\n//heron/scheduler-core/tests/java:SchedulerUtilsTest                     PASSED in 1.2s\r\n//heron/scheduler-core/tests/java:SubmitDryRunRenderTest                 PASSED in 1.6s\r\n//heron/scheduler-core/tests/java:SubmitterMainTest                      PASSED in 1.1s\r\n//heron/scheduler-core/tests/java:UpdateDryRunRenderTest                 PASSED in 1.5s\r\n//heron/scheduler-core/tests/java:UpdateTopologyManagerTest              PASSED in 11.9s\r\n//heron/schedulers/tests/java:AuroraCLIControllerTest                    PASSED in 0.5s\r\n//heron/schedulers/tests/java:AuroraContextTest                          PASSED in 0.3s\r\n//heron/schedulers/tests/java:AuroraLauncherTest                         PASSED in 0.8s\r\n//heron/schedulers/tests/java:AuroraSchedulerTest                        PASSED in 2.9s\r\n//heron/schedulers/tests/java:HeronExecutorTaskTest                      PASSED in 1.5s\r\n//heron/schedulers/tests/java:HeronMasterDriverTest                      PASSED in 1.7s\r\n//heron/schedulers/tests/java:KubernetesContextTest                      PASSED in 0.3s\r\n//heron/schedulers/tests/java:KubernetesControllerTest                   PASSED in 0.3s\r\n//heron/schedulers/tests/java:KubernetesLauncherTest                     PASSED in 0.7s\r\n//heron/schedulers/tests/java:KubernetesSchedulerTest                    PASSED in 0.7s\r\n//heron/schedulers/tests/java:LaunchableTaskTest                         PASSED in 0.5s\r\n//heron/schedulers/tests/java:LocalLauncherTest                          PASSED in 0.9s\r\n//heron/schedulers/tests/java:LocalSchedulerTest                         PASSED in 0.6s\r\n//heron/schedulers/tests/java:MarathonControllerTest                     PASSED in 1.0s\r\n//heron/schedulers/tests/java:MarathonLauncherTest                       PASSED in 0.7s\r\n//heron/schedulers/tests/java:MarathonSchedulerTest                      PASSED in 0.4s\r\n//heron/schedulers/tests/java:MesosFrameworkTest                         PASSED in 0.6s\r\n//heron/schedulers/tests/java:MesosLauncherTest                          PASSED in 0.5s\r\n//heron/schedulers/tests/java:MesosSchedulerTest                         PASSED in 0.6s\r\n//heron/schedulers/tests/java:NomadSchedulerTest                         PASSED in 1.9s\r\n//heron/schedulers/tests/java:SlurmControllerTest                        PASSED in 1.1s\r\n//heron/schedulers/tests/java:SlurmLauncherTest                          PASSED in 0.9s\r\n//heron/schedulers/tests/java:SlurmSchedulerTest                         PASSED in 1.1s\r\n//heron/schedulers/tests/java:TaskResourcesTest                          PASSED in 0.3s\r\n//heron/schedulers/tests/java:TaskUtilsTest                              PASSED in 0.3s\r\n//heron/schedulers/tests/java:V1ControllerTest                           PASSED in 1.6s\r\n//heron/schedulers/tests/java:VolumesTests                               PASSED in 0.3s\r\n//heron/schedulers/tests/java:YarnLauncherTest                           PASSED in 0.6s\r\n//heron/schedulers/tests/java:YarnSchedulerTest                          PASSED in 0.4s\r\n//heron/simulator/tests/java:AllGroupingTest                             PASSED in 0.3s\r\n//heron/simulator/tests/java:CustomGroupingTest                          PASSED in 0.3s\r\n//heron/simulator/tests/java:FieldsGroupingTest                          PASSED in 0.7s\r\n//heron/simulator/tests/java:InstanceExecutorTest                        PASSED in 0.5s\r\n//heron/simulator/tests/java:LowestGroupingTest                          PASSED in 0.3s\r\n//heron/simulator/tests/java:RotatingMapTest                             PASSED in 0.3s\r\n//heron/simulator/tests/java:ShuffleGroupingTest                         PASSED in 0.3s\r\n//heron/simulator/tests/java:SimulatorTest                               PASSED in 0.4s\r\n//heron/simulator/tests/java:TopologyManagerTest                         PASSED in 0.4s\r\n//heron/simulator/tests/java:TupleCacheTest                              PASSED in 0.3s\r\n//heron/simulator/tests/java:XORManagerTest                              PASSED in 0.4s\r\n//heron/spi/tests/java:ConfigLoaderTest                                  PASSED in 1.3s\r\n//heron/spi/tests/java:ConfigTest                                        PASSED in 0.9s\r\n//heron/spi/tests/java:ContextTest                                       PASSED in 0.3s\r\n//heron/spi/tests/java:ExceptionInfoTest                                 PASSED in 0.2s\r\n//heron/spi/tests/java:KeysTest                                          PASSED in 0.2s\r\n//heron/spi/tests/java:MetricsInfoTest                                   PASSED in 0.2s\r\n//heron/spi/tests/java:MetricsRecordTest                                 PASSED in 0.2s\r\n//heron/spi/tests/java:NetworkUtilsTest                                  PASSED in 1.5s\r\n//heron/spi/tests/java:PackingPlanTest                                   PASSED in 0.3s\r\n//heron/spi/tests/java:ResourceTest                                      PASSED in 0.3s\r\n//heron/spi/tests/java:ShellUtilsTest                                    PASSED in 2.2s\r\n//heron/spi/tests/java:TokenSubTest                                      PASSED in 0.4s\r\n//heron/spi/tests/java:UploaderUtilsTest                                 PASSED in 0.5s\r\n//heron/statefulstorages/tests/java:DlogStorageTest                      PASSED in 1.9s\r\n//heron/statefulstorages/tests/java:HDFSStorageTest                      PASSED in 2.0s\r\n//heron/statefulstorages/tests/java:LocalFileSystemStorageTest           PASSED in 0.9s\r\n//heron/statemgrs/tests/cpp:zk-statemgr_unittest                         PASSED in 0.0s\r\n//heron/statemgrs/tests/java:CuratorStateManagerTest                     PASSED in 0.6s\r\n//heron/statemgrs/tests/java:LocalFileSystemStateManagerTest             PASSED in 1.2s\r\n//heron/statemgrs/tests/java:ZkUtilsTest                                 PASSED in 1.0s\r\n//heron/statemgrs/tests/python:configloader_unittest                     PASSED in 1.0s\r\n//heron/statemgrs/tests/python:statemanagerfactory_unittest              PASSED in 0.8s\r\n//heron/statemgrs/tests/python:zkstatemanager_unittest                   PASSED in 0.9s\r\n//heron/stmgr/tests/cpp/grouping:all-grouping_unittest                   PASSED in 0.0s\r\n//heron/stmgr/tests/cpp/grouping:custom-grouping_unittest                PASSED in 0.0s\r\n//heron/stmgr/tests/cpp/grouping:fields-grouping_unittest                PASSED in 0.0s\r\n//heron/stmgr/tests/cpp/grouping:lowest-grouping_unittest                PASSED in 0.0s\r\n//heron/stmgr/tests/cpp/grouping:shuffle-grouping_unittest               PASSED in 0.0s\r\n//heron/stmgr/tests/cpp/server:checkpoint-gateway_unittest               PASSED in 1.2s\r\n  WARNING: //heron/stmgr/tests/cpp/server:checkpoint-gateway_unittest: Test execution time (1.2s excluding execution overhead) outside of range for MODERATE tests. Consider setting timeout=\"short\" or size=\"small\".\r\n//heron/stmgr/tests/cpp/server:stateful-restorer_unittest                PASSED in 0.0s\r\n  WARNING: //heron/stmgr/tests/cpp/server:stateful-restorer_unittest: Test execution time (0.0s excluding execution overhead) outside of range for MODERATE tests. Consider setting timeout=\"short\" or size=\"small\".\r\n//heron/stmgr/tests/cpp/server:stmgr_unittest                            PASSED in 38.3s\r\n//heron/stmgr/tests/cpp/util:neighbour_calculator_unittest               PASSED in 0.0s\r\n  WARNING: //heron/stmgr/tests/cpp/util:neighbour_calculator_unittest: Test execution time (0.0s excluding execution overhead) outside of range for MODERATE tests. Consider setting timeout=\"short\" or size=\"small\".\r\n//heron/stmgr/tests/cpp/util:rotating-map_unittest                       PASSED in 0.0s\r\n//heron/stmgr/tests/cpp/util:tuple-cache_unittest                        PASSED in 3.6s\r\n//heron/stmgr/tests/cpp/util:xor-manager_unittest                        PASSED in 4.0s\r\n//heron/tmanager/tests/cpp/server:stateful_checkpointer_unittest         PASSED in 0.0s\r\n//heron/tmanager/tests/cpp/server:stateful_restorer_unittest             PASSED in 5.0s\r\n//heron/tmanager/tests/cpp/server:tcontroller_unittest                   PASSED in 0.0s\r\n//heron/tmanager/tests/cpp/server:tmanager_unittest                      PASSED in 26.1s\r\n//heron/tools/apiserver/tests/java:ConfigUtilsTests                      PASSED in 0.5s\r\n//heron/tools/apiserver/tests/java:TopologyResourceTests                 PASSED in 1.1s\r\n//heron/tools/cli/tests/python:client_command_unittest                   PASSED in 1.1s\r\n//heron/tools/cli/tests/python:opts_unittest                             PASSED in 0.8s\r\n//heron/tools/explorer/tests/python:explorer_unittest                    PASSED in 1.1s\r\n//heron/tools/tracker/tests/python:query_operator_unittest               PASSED in 1.4s\r\n//heron/tools/tracker/tests/python:query_unittest                        PASSED in 1.3s\r\n//heron/tools/tracker/tests/python:topology_unittest                     PASSED in 1.2s\r\n//heron/tools/tracker/tests/python:tracker_unittest                      PASSED in 1.4s\r\n//heron/uploaders/tests/java:DlogUploaderTest                            PASSED in 0.6s\r\n//heron/uploaders/tests/java:GcsUploaderTests                            PASSED in 0.7s\r\n//heron/uploaders/tests/java:HdfsUploaderTest                            PASSED in 0.4s\r\n//heron/uploaders/tests/java:HttpUploaderTest                            PASSED in 0.6s\r\n//heron/uploaders/tests/java:LocalFileSystemConfigTest                   PASSED in 0.3s\r\n//heron/uploaders/tests/java:LocalFileSystemContextTest                  PASSED in 0.3s\r\n//heron/uploaders/tests/java:LocalFileSystemUploaderTest                 PASSED in 0.4s\r\n//heron/uploaders/tests/java:S3UploaderTest                              PASSED in 0.9s\r\n//heron/uploaders/tests/java:ScpUploaderTest                             PASSED in 0.5s\r\n\r\nINFO: Build completed successfully, 1374 total actions\r\n```\r\n\r\n</p>\r\n</details>\r\n\r\n<details><summary>//heron/stmgr/tests/cpp/server:stmgr_unittest - higher spec</summary>\r\n<p>\r\n\r\n```bash\r\n==================== Test output for //heron/stmgr/tests/cpp/server:stmgr_unittest:\r\nCurrent working directory (to find stmgr logs) /root/.cache/bazel/_bazel_root/f4ab758bd53020512013f7dfa13b6902/execroot/org_apache_heron/bazel-out/k8-fastbuild/bin/heron/stmgr/tests/cpp/server/stmgr_unittest.runfiles/org_apache_heron\r\nUsing config file heron/config/src/yaml/conf/test/test_heron_internals.yaml\r\n[==========] Running 11 tests from 1 test case.\r\n[----------] Global test environment set-up.\r\n[----------] 11 tests from StMgr\r\n[ RUN      ] StMgr.test_pplan_decode\r\n[warn] Added a signal to event base 0x55c0c05e0840 with signals already added to event_base 0x55c0c05e0580.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e0b00 with signals already added to event_base 0x55c0c05e0840.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e0dc0 with signals already added to event_base 0x55c0c05e0b00.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e1080 with signals already added to event_base 0x55c0c05e0dc0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e1600 with signals already added to event_base 0x55c0c05e1080.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e1b80 with signals already added to event_base 0x55c0c05e1600.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e2100 with signals already added to event_base 0x55c0c05e1b80.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e2680 with signals already added to event_base 0x55c0c05e2100.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e2c00 with signals already added to event_base 0x55c0c05e2680.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e3180 with signals already added to event_base 0x55c0c05e2c00.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e3700 with signals already added to event_base 0x55c0c05e3180.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e3c80 with signals already added to event_base 0x55c0c05e3700.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072c2c0 with signals already added to event_base 0x55c0c05e3c80.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072d080 with signals already added to event_base 0x55c0c072c2c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072c840 with signals already added to event_base 0x55c0c072d080.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072d8c0 with signals already added to event_base 0x55c0c072c840.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072d600 with signals already added to event_base 0x55c0c072d8c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072d340 with signals already added to event_base 0x55c0c072d600.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072de40 with signals already added to event_base 0x55c0c072d340.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072e100 with signals already added to event_base 0x55c0c072de40.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072cdc0 with signals already added to event_base 0x55c0c072e100.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072db80 with signals already added to event_base 0x55c0c072cdc0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072cb00 with signals already added to event_base 0x55c0c072db80.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[       OK ] StMgr.test_pplan_decode (2013 ms)\r\n[ RUN      ] StMgr.test_tuple_route\r\n[warn] Added a signal to event base 0x55c0c072e100 with signals already added to event_base (nil).  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072de40 with signals already added to event_base 0x55c0c072e100.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072db80 with signals already added to event_base 0x55c0c072de40.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072d8c0 with signals already added to event_base 0x55c0c072db80.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072d600 with signals already added to event_base 0x55c0c072d8c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072d080 with signals already added to event_base 0x55c0c072d600.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072cb00 with signals already added to event_base 0x55c0c072d080.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072c840 with signals already added to event_base 0x55c0c072cb00.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072c2c0 with signals already added to event_base 0x55c0c072c840.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e39c0 with signals already added to event_base 0x55c0c072c2c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[       OK ] StMgr.test_tuple_route (2006 ms)\r\n[ RUN      ] StMgr.test_custom_grouping_route\r\n[warn] Added a signal to event base 0x55c0c072c2c0 with signals already added to event_base 0x55c0c05e39c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072c840 with signals already added to event_base 0x55c0c072c2c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072cb00 with signals already added to event_base 0x55c0c072c840.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072d080 with signals already added to event_base 0x55c0c072cb00.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e1340 with signals already added to event_base 0x55c0c072d080.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e3700 with signals already added to event_base 0x55c0c05e1340.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e3180 with signals already added to event_base 0x55c0c05e3700.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e2c00 with signals already added to event_base 0x55c0c05e3180.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e2680 with signals already added to event_base 0x55c0c05e2c00.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[       OK ] StMgr.test_custom_grouping_route (2009 ms)\r\n[ RUN      ] StMgr.test_back_pressure_instance\r\n[warn] Added a signal to event base 0x55c0c05e2c00 with signals already added to event_base 0x55c0c05e2680.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e3180 with signals already added to event_base 0x55c0c05e2c00.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e3700 with signals already added to event_base 0x55c0c05e3180.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e1340 with signals already added to event_base 0x55c0c05e3700.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e3c80 with signals already added to event_base 0x55c0c05e1340.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e2100 with signals already added to event_base 0x55c0c05e3c80.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e1b80 with signals already added to event_base 0x55c0c05e2100.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[       OK ] StMgr.test_back_pressure_instance (4002 ms)\r\n[ RUN      ] StMgr.test_spout_death_under_backpressure\r\n[warn] Added a signal to event base 0x55c0c05e2100 with signals already added to event_base 0x55c0c05e1b80.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e3c80 with signals already added to event_base 0x55c0c05e2100.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e1340 with signals already added to event_base 0x55c0c05e3c80.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e18c0 with signals already added to event_base 0x55c0c05e1340.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e1600 with signals already added to event_base 0x55c0c05e18c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e1e40 with signals already added to event_base 0x55c0c05e1600.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e23c0 with signals already added to event_base 0x55c0c05e1e40.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e2940 with signals already added to event_base 0x55c0c05e23c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072cdc0 with signals already added to event_base 0x55c0c05e2940.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[       OK ] StMgr.test_spout_death_under_backpressure (6144 ms)\r\n[ RUN      ] StMgr.test_back_pressure_stmgr\r\n[warn] Added a signal to event base 0x55c0c05e2940 with signals already added to event_base 0x55c0c072cdc0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e23c0 with signals already added to event_base 0x55c0c05e2940.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e1e40 with signals already added to event_base 0x55c0c05e23c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e1600 with signals already added to event_base 0x55c0c05e1e40.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e18c0 with signals already added to event_base 0x55c0c05e1600.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072e3c0 with signals already added to event_base 0x55c0c05e18c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072f180 with signals already added to event_base 0x55c0c072e3c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072f700 with signals already added to event_base 0x55c0c072f180.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e2ec0 with signals already added to event_base 0x55c0c072f700.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c05e3440 with signals already added to event_base 0x55c0c05e2ec0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[       OK ] StMgr.test_back_pressure_stmgr (5005 ms)\r\n[ RUN      ] StMgr.test_back_pressure_stmgr_reconnect\r\n[warn] Added a signal to event base 0x55c0c05e2ec0 with signals already added to event_base 0x55c0c05e3440.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072f700 with signals already added to event_base 0x55c0c05e2ec0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072f180 with signals already added to event_base 0x55c0c072f700.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072e3c0 with signals already added to event_base 0x55c0c072f180.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072f440 with signals already added to event_base 0x55c0c072e3c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072e680 with signals already added to event_base 0x55c0c072f440.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072e940 with signals already added to event_base 0x55c0c072e680.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072ec00 with signals already added to event_base 0x55c0c072e940.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[       OK ] StMgr.test_back_pressure_stmgr_reconnect (4035 ms)\r\n[ RUN      ] StMgr.test_tmanager_restart_on_new_address\r\n[warn] Added a signal to event base 0x55c0c072e940 with signals already added to event_base 0x55c0c072ec00.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072e680 with signals already added to event_base 0x55c0c072e940.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072f440 with signals already added to event_base 0x55c0c072e680.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072e3c0 with signals already added to event_base 0x55c0c072f440.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072eec0 with signals already added to event_base 0x55c0c072e3c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072c580 with signals already added to event_base 0x55c0c072eec0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072d080 with signals already added to event_base 0x55c0c072c580.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072d340 with signals already added to event_base 0x55c0c072d080.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072d600 with signals already added to event_base 0x55c0c072d340.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072f9c0 with signals already added to event_base 0x55c0c072d600.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[       OK ] StMgr.test_tmanager_restart_on_new_address (5015 ms)\r\n[ RUN      ] StMgr.test_tmanager_restart_on_same_address\r\n[warn] Added a signal to event base 0x55c0c072d340 with signals already added to event_base 0x55c0c072f9c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072d080 with signals already added to event_base 0x55c0c072d340.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072c580 with signals already added to event_base 0x55c0c072d080.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072eec0 with signals already added to event_base 0x55c0c072c580.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072c000 with signals already added to event_base 0x55c0c072eec0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c072fc80 with signals already added to event_base 0x55c0c072c000.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c1cca000 with signals already added to event_base 0x55c0c072fc80.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c1cca2c0 with signals already added to event_base 0x55c0c1cca000.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c1cca580 with signals already added to event_base 0x55c0c1cca2c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c1cca840 with signals already added to event_base 0x55c0c1cca580.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[       OK ] StMgr.test_tmanager_restart_on_same_address (4008 ms)\r\n[ RUN      ] StMgr.test_metricsmgr_reconnect\r\n[warn] Added a signal to event base 0x55c0c1cccc00 with signals already added to event_base 0x55c0c1cca840.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c1ccc940 with signals already added to event_base 0x55c0c1cccc00.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c1ccc680 with signals already added to event_base 0x55c0c1ccc940.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c1ccc3c0 with signals already added to event_base 0x55c0c1ccc680.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c1ccc100 with signals already added to event_base 0x55c0c1ccc3c0.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c1ccbb80 with signals already added to event_base 0x55c0c1ccc100.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c1ccb600 with signals already added to event_base 0x55c0c1ccbb80.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c1ccb340 with signals already added to event_base 0x55c0c1ccb600.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[warn] Added a signal to event base 0x55c0c1ccb080 with signals already added to event_base 0x55c0c1ccb340.  Only one can have signals at a time with the epoll backend.  The base with the most recently added signal or the most recent event_base_loop() call gets preference; do not rely on this behavior in future Libevent versions.\r\n[       OK ] StMgr.test_metricsmgr_reconnect (4004 ms)\r\n[ RUN      ] StMgr.test_PatchPhysicalPlanWithHydratedTopology\r\n[       OK ] StMgr.test_PatchPhysicalPlanWithHydratedTopology (0 ms)\r\n[----------] 11 tests from StMgr (38241 ms total)\r\n\r\n[----------] Global test environment tear-down\r\n[==========] 11 tests from 1 test case ran. (38241 ms total)\r\n[  PASSED  ] 11 tests.\r\n================================================================================\r\nTarget //heron/stmgr/tests/cpp/server:stmgr_unittest up-to-date:\r\n  bazel-bin/heron/stmgr/tests/cpp/server/stmgr_unittest\r\nINFO: Elapsed time: 39.218s, Critical Path: 38.29s\r\nINFO: 2 processes: 1 internal, 1 local.\r\nINFO: Build completed successfully, 2 total actions\r\n//heron/stmgr/tests/cpp/server:stmgr_unittest                            PASSED in 38.3s\r\n\r\nINFO: Build completed successfully, 2 total actions\r\n```\r\n</p>\r\n</details>\r\n\r\n**_Edit:_** Build finally passed with all changes on Travis CI. Bringing in some tweaks which should not break the build... Travis CI please pass the build.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926128468/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926265633","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-926265633","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":926265633,"node_id":"IC_kwDOApKMps43NbEh","user":{"login":"joshfischer1108","id":5785700,"node_id":"MDQ6VXNlcjU3ODU3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5785700?v=4","gravatar_id":"","url":"https://api.github.com/users/joshfischer1108","html_url":"https://github.com/joshfischer1108","followers_url":"https://api.github.com/users/joshfischer1108/followers","following_url":"https://api.github.com/users/joshfischer1108/following{/other_user}","gists_url":"https://api.github.com/users/joshfischer1108/gists{/gist_id}","starred_url":"https://api.github.com/users/joshfischer1108/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshfischer1108/subscriptions","organizations_url":"https://api.github.com/users/joshfischer1108/orgs","repos_url":"https://api.github.com/users/joshfischer1108/repos","events_url":"https://api.github.com/users/joshfischer1108/events{/privacy}","received_events_url":"https://api.github.com/users/joshfischer1108/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-24T00:52:27Z","updated_at":"2021-09-24T00:52:27Z","author_association":"MEMBER","body":"> ```shell\r\n> docker/scripts/dev-env-create.sh heron-dev\r\n> ```\r\n\r\nThank you for steps to reproduce.  Will look more into this tonight.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926265633/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926304481","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-926304481","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":926304481,"node_id":"IC_kwDOApKMps43Nkjh","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-24T02:58:05Z","updated_at":"2021-09-24T02:58:05Z","author_association":"MEMBER","body":"> Thank you for steps to reproduce. Will look more into this tonight.\r\n\r\nThank you @joshfischer1108, Travis CI seems to be passing all tests now. I think we are well-positioned to review and test to see if any adjustments need to be made.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926304481/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926527047","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-926527047","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":926527047,"node_id":"IC_kwDOApKMps43Oa5H","user":{"login":"joshfischer1108","id":5785700,"node_id":"MDQ6VXNlcjU3ODU3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5785700?v=4","gravatar_id":"","url":"https://api.github.com/users/joshfischer1108","html_url":"https://github.com/joshfischer1108","followers_url":"https://api.github.com/users/joshfischer1108/followers","following_url":"https://api.github.com/users/joshfischer1108/following{/other_user}","gists_url":"https://api.github.com/users/joshfischer1108/gists{/gist_id}","starred_url":"https://api.github.com/users/joshfischer1108/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshfischer1108/subscriptions","organizations_url":"https://api.github.com/users/joshfischer1108/orgs","repos_url":"https://api.github.com/users/joshfischer1108/repos","events_url":"https://api.github.com/users/joshfischer1108/events{/privacy}","received_events_url":"https://api.github.com/users/joshfischer1108/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-24T10:41:21Z","updated_at":"2021-09-24T10:41:21Z","author_association":"MEMBER","body":"> > Thank you for steps to reproduce. Will look more into this tonight.\r\n> \r\n> Thank you @joshfischer1108, Travis CI seems to be passing all tests now. I think we are well-positioned to review and test to see if any adjustments need to be made.\r\n\r\nI had some issues building last night.  I was hoping that all would work in the Docker image, but no luck. But this shouldn't affect the work that you have done. I\"m working on a Mac M1 and we still have some extra work for this platform.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926527047/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926550224","html_url":"https://github.com/apache/incubator-heron/pull/3709#issuecomment-926550224","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3709","id":926550224,"node_id":"IC_kwDOApKMps43OgjQ","user":{"login":"joshfischer1108","id":5785700,"node_id":"MDQ6VXNlcjU3ODU3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5785700?v=4","gravatar_id":"","url":"https://api.github.com/users/joshfischer1108","html_url":"https://github.com/joshfischer1108","followers_url":"https://api.github.com/users/joshfischer1108/followers","following_url":"https://api.github.com/users/joshfischer1108/following{/other_user}","gists_url":"https://api.github.com/users/joshfischer1108/gists{/gist_id}","starred_url":"https://api.github.com/users/joshfischer1108/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshfischer1108/subscriptions","organizations_url":"https://api.github.com/users/joshfischer1108/orgs","repos_url":"https://api.github.com/users/joshfischer1108/repos","events_url":"https://api.github.com/users/joshfischer1108/events{/privacy}","received_events_url":"https://api.github.com/users/joshfischer1108/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-24T11:24:34Z","updated_at":"2021-09-24T11:24:34Z","author_association":"MEMBER","body":"@zhangshaoning1 I apologize for the delay.  I'm good with this work.  Will merge.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926550224/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926707909","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-926707909","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":926707909,"node_id":"IC_kwDOApKMps43PHDF","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-24T15:15:11Z","updated_at":"2021-09-24T15:22:36Z","author_association":"MEMBER","body":"Thank you @joshfischer1108. I am hoping that updating the build scripts and bringing the dependencies up to date will resolve some, if not all, of the Apple silicon issues. I am aware there are a few virtualization issues with Apple silicon. Updating the build scripts and dependencies will likely be an involved and  \"all available hands\" situation.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926707909/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926714865","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-926714865","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":926714865,"node_id":"IC_kwDOApKMps43PIvx","user":{"login":"joshfischer1108","id":5785700,"node_id":"MDQ6VXNlcjU3ODU3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5785700?v=4","gravatar_id":"","url":"https://api.github.com/users/joshfischer1108","html_url":"https://github.com/joshfischer1108","followers_url":"https://api.github.com/users/joshfischer1108/followers","following_url":"https://api.github.com/users/joshfischer1108/following{/other_user}","gists_url":"https://api.github.com/users/joshfischer1108/gists{/gist_id}","starred_url":"https://api.github.com/users/joshfischer1108/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshfischer1108/subscriptions","organizations_url":"https://api.github.com/users/joshfischer1108/orgs","repos_url":"https://api.github.com/users/joshfischer1108/repos","events_url":"https://api.github.com/users/joshfischer1108/events{/privacy}","received_events_url":"https://api.github.com/users/joshfischer1108/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-24T15:24:16Z","updated_at":"2021-09-24T15:24:16Z","author_association":"MEMBER","body":"@surahman Would you be willing to write the documentation on how to use your contribution to Heron?  e.g.  Add a page our two to our current heron site explaining use cases, why people would use this and etc?","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926714865/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926720725","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-926720725","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":926720725,"node_id":"IC_kwDOApKMps43PKLV","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-24T15:32:02Z","updated_at":"2021-09-24T15:32:02Z","author_association":"MEMBER","body":"@joshfischer1108 sure, but we still need to run some deployment testing and need @nicknezis's feedback when he has time. I shall write up the basics but this is really Nick's feature and he is more knowledgeable about K8s, so I would ask him to add to it and sign off on the documentation.\r\n\r\nI have tried to be very careful with code from a security standpoint: hard failures and nothing silent or byzantine. We do not want a situation where a Pod Template is set but there is a path in the code that allows a bad configuration through. We need very critical and careful reviewing.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926720725/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926736471","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-926736471","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":926736471,"node_id":"IC_kwDOApKMps43POBX","user":{"login":"joshfischer1108","id":5785700,"node_id":"MDQ6VXNlcjU3ODU3MDA=","avatar_url":"https://avatars.githubusercontent.com/u/5785700?v=4","gravatar_id":"","url":"https://api.github.com/users/joshfischer1108","html_url":"https://github.com/joshfischer1108","followers_url":"https://api.github.com/users/joshfischer1108/followers","following_url":"https://api.github.com/users/joshfischer1108/following{/other_user}","gists_url":"https://api.github.com/users/joshfischer1108/gists{/gist_id}","starred_url":"https://api.github.com/users/joshfischer1108/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/joshfischer1108/subscriptions","organizations_url":"https://api.github.com/users/joshfischer1108/orgs","repos_url":"https://api.github.com/users/joshfischer1108/repos","events_url":"https://api.github.com/users/joshfischer1108/events{/privacy}","received_events_url":"https://api.github.com/users/joshfischer1108/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-24T15:53:19Z","updated_at":"2021-09-24T15:53:19Z","author_association":"MEMBER","body":"> @joshfischer1108 sure, but we still need to run some deployment testing and need @nicknezis's feedback when he has time. I shall write up the basics but this is really Nick's feature and he is more knowledgeable about K8s, so I would ask him to add to it and sign off on the documentation.\r\n> \r\n> I have tried to be very careful with code from a security standpoint: hard failures and nothing silent or byzantine. We do not want a situation where a Pod Template is set but there is a path in the code that allows a bad configuration through. We need very critical and careful reviewing.\r\n\r\nAgreed on Nick's sign off.  I think it would be good for you to author the docs with Nick's guidance.  I can help in some aspects as well..  The documentation can come with a different pull request.  ","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926736471/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926938136","html_url":"https://github.com/apache/incubator-heron/pull/3717#issuecomment-926938136","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3717","id":926938136,"node_id":"IC_kwDOApKMps43P_QY","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-24T21:50:29Z","updated_at":"2021-09-24T21:50:29Z","author_association":"MEMBER","body":"Hi @joshfischer1108, I have created a very quick document outlining usage. There was an issue I found in the way I have handled looking up the Pod Templates but I will write that up in #3710.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926938136/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926946450","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-926946450","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":926946450,"node_id":"IC_kwDOApKMps43QBSS","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-24T22:13:04Z","updated_at":"2021-09-24T22:13:04Z","author_association":"MEMBER","body":"I uncovered an issue where if you have Pod Templates with the same target name in multiple `ConfigMaps` the first one we come across will be loaded up. This possesses the potential of being a silent error. As an alternative, I propose we implement the following protocol for naming and referencing the Pod Templates:\r\n`CONFIGMAP-NAME.POD-TEMPLATE-NAME`.\r\n\r\nThe `CONFIGMAP-NAME` would be the name of the ConfigMap where the Pod Template, named `POD-TEMPLATE-NAME` is located. The user would concatenate the two names with a `.`. We can safely rely on `kubectl` to ensure the ConfigMap and Pod Template names are unique.\r\n\r\nThis would mean creating a new protected method in `V1Controller` called `getPodTemplateLocation` which will return a `Pair` <`CONFIGMAP-NAME`, `POD-TEMPLATE-NAME`>. The string would be split on the first occurrence of a `.`, and if it is invalid an exception will be thrown.\r\n\r\nI will update the documentation being written up as soon as I have the new method completed, tested, and wired into `loadPodFromTemplate` with updated tests.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926946450/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926950066","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-926950066","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":926950066,"node_id":"IC_kwDOApKMps43QCKy","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-24T22:23:11Z","updated_at":"2021-09-24T22:23:11Z","author_association":"CONTRIBUTOR","body":"It seems that Spark has a [hardcoded key](https://github.com/apache/spark/blob/ff3f3c45668364da9bd10992791b5ee9a46fea21/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/deploy/k8s/Constants.scala#L86) for the ConfigMap, but I think this is because they create the ConfigMap and mount it. I like the flexibility of your suggested modification to the config value.\r\n\r\nI'm sorry that I've been a bit busy lately. I will try to review the code and test a bit tonight.\r\n\r\nThanks again for helping add this feature. I'm already excited to add more subtle improvements to the Kubernetes scheduler. :)","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926950066/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926956359","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-926956359","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":926956359,"node_id":"IC_kwDOApKMps43QDtH","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-24T22:44:13Z","updated_at":"2021-09-24T23:15:14Z","author_association":"MEMBER","body":"Hi @nicknezis, no worries.\r\n\r\n~What I will do is set the Pod Template name to [`podspec-configmap-key`](https://github.com/apache/spark/blob/ff3f3c45668364da9bd10992791b5ee9a46fea21/resource-managers/kubernetes/core/src/main/scala/org/apache/spark/deploy/k8s/Constants.scala#L86) to keep things familiar with Spark's methodology and reserve the CLI input via `--config-property` to the name of the actual ConfigMap to lookup from the list returned from the client.~\r\n\r\nSorry, just re-read your comment - I shall go ahead with my previous plan.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926956359/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926962947","html_url":"https://github.com/apache/incubator-heron/pull/3717#issuecomment-926962947","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3717","id":926962947,"node_id":"IC_kwDOApKMps43QFUD","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-24T23:07:57Z","updated_at":"2021-09-24T23:07:57Z","author_association":"CONTRIBUTOR","body":"This is great. I'll be adding a similar document for the last Kubernetes scheduler feature I added. \r\n\r\nNot asking you to do this refactor, but mentioning it to share the idea... I would like to combine the Kubernetes related documentation into a single page under the Schedulers menu. Then we can have sub-menu items for the various aspects of this scheduler. Something similar to this [Spark document](https://spark.apache.org/docs/latest/running-on-kubernetes.html).","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/926962947/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/927132082","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-927132082","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":927132082,"node_id":"IC_kwDOApKMps43Qumy","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-25T14:51:42Z","updated_at":"2021-09-25T20:57:15Z","author_association":"MEMBER","body":"I have made the changes to support the `--config-map heron.kubernetes.pod.template.configmap.name=CONFIGMAP-NAME.POD-TEMPLATE-NAME` parameter.\r\n\r\nLocal build and the full battery of tests are passing. TravisCI appears to be really flaky and is failing even the documentation build which is based on the current `master/main` branch. I think it is time to seriously look at Github Actions which are run natively on Azure. My experience with GH Actions is that it is lightning fast compared to TravisCI but we may need to ask GH about unlimited open-source runner time.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/927132082/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/927137689","html_url":"https://github.com/apache/incubator-heron/pull/3717#issuecomment-927137689","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3717","id":927137689,"node_id":"IC_kwDOApKMps43Qv-Z","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-25T15:33:52Z","updated_at":"2021-09-25T15:33:52Z","author_association":"MEMBER","body":"I have updated the instructions for the `CONFIGMAP-NAME.POD-TEMPLATE-NAME` change.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/927137689/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/927182139","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-927182139","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":927182139,"node_id":"IC_kwDOApKMps43Q607","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-25T20:59:48Z","updated_at":"2021-09-26T15:51:42Z","author_association":"MEMBER","body":"I have added `INFO` level logging to `loadPodFromTemplate` to indicate whether a default or custom Pod Template was configured. The builds and all tests are passing locally but I have not merged in case there are Travis CI issues. The changes are at the head of the `dev` branch.\r\n\r\nEdit: Merged, TravisCI .","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/927182139/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/928631544","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-928631544","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":928631544,"node_id":"IC_kwDOApKMps43Wcr4","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-28T02:17:59Z","updated_at":"2021-09-28T02:17:59Z","author_association":"MEMBER","body":"Build and all tests passing locally. It should be safe to ignore the flaky Travis CI build & test check. There must be a more practical way to trigger a recheck without a `git push` action. I do not believe there is any point in triggering a re-check.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/928631544/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/929833982","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-929833982","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":929833982,"node_id":"IC_kwDOApKMps43bCP-","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-29T04:51:42Z","updated_at":"2021-09-29T04:51:42Z","author_association":"CONTRIBUTOR","body":"I'm slowly finding time to test. So far here are a couple of minor tweaks we will need to make:\r\n1. Add configmaps k8s role permissions\r\n```\r\nrules:\r\n- apiGroups: \r\n  - \"\"\r\n  resources: \r\n  - configmaps\r\n  verbs: \r\n  - get\r\n  - watch\r\n  - list\r\n```\r\n2. The `listConfigMaps` call is looking in the default namespace, but it should be using `getNamespace()` instead for that value.\r\n\r\nI'm making the edits and testing locally. Will report back with any other findings.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/929833982/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/930300053","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-930300053","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":930300053,"node_id":"IC_kwDOApKMps43c0CV","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-29T15:44:33Z","updated_at":"2021-09-29T15:44:33Z","author_association":"MEMBER","body":"Thank you @nicknezis, I have begun to affect changes on `dev`.\r\n\r\n> 1. Add configmaps k8s role permissions\r\n> \r\n> ```\r\n> rules:\r\n> - apiGroups: \r\n>   - \"\"\r\n>   resources: \r\n>   - configmaps\r\n>   verbs: \r\n>   - get\r\n>   - watch\r\n>   - list\r\n> ```\r\n\r\nI have looked into K8s `RBAC` on the v11 API and found [`createNamespacedRole`](https://github.com/kubernetes-client/java/blob/release-11/kubernetes/docs/RbacAuthorizationV1Api.md#createNamespacedRole) within the [`RbacAuthorizationV1Api`](https://github.com/kubernetes-client/java/blob/release-11/kubernetes/docs/RbacAuthorizationV1Api.md). It seems reasonably straightforward to get the above role into a [`V1Role`](https://github.com/kubernetes-client/java/blob/release-11/kubernetes/docs/V1Role.md) but it does require an API key. This can be set up in the `V1Controller` constructor.\r\n\r\n> 2. The `listConfigMaps` call is looking in the default namespace, but it should be using `getNamespace()` instead for that value.\r\n\r\nGood point, do not access directly and use the getter routine, resolved.\r\n","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/930300053/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/930428115","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-930428115","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":930428115,"node_id":"IC_kwDOApKMps43dTTT","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-09-29T18:17:51Z","updated_at":"2021-10-02T02:21:50Z","author_association":"MEMBER","body":"A very quick attempt at setting up `RBAC` for K8s. We need to get the K8s API key and I am unsure if this is already in the `configuration` object. There is a `setSecretKeyRefs` but this is setting up environment variables for the containers.\r\n\r\nI have not wired the `configureRBAC` into the `V1Controller` constructor yet until I can get the K8s API key set up in the routine.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/930428115/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/931809880","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-931809880","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":931809880,"node_id":"IC_kwDOApKMps43ikpY","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-01T00:57:58Z","updated_at":"2021-10-01T00:57:58Z","author_association":"CONTRIBUTOR","body":"I might be wrong, but I think the RBAC is handled automatically. When you get the default API, it knows to use the embedded token that is mounted in every pod. I thought my updating the `Role` would fix it, but I still get `Forbidden` in the API server's log output. I'll play a bit more with it tonight.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/931809880/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/932331781","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-932331781","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":932331781,"node_id":"IC_kwDOApKMps43kkEF","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-01T15:30:54Z","updated_at":"2021-10-01T15:41:54Z","author_association":"MEMBER","body":"From the error, this is undoubtedly a permissions issue and I am wondering if the `verb` actions in the role are adequate. I believe `configMapRef` are resolved by `kubelet` and it may have permissions to access the ConfigMaps. Pods presumably do not since they are in the concluding stages of bootstrapping - assuming the principle of least privilege. With all that said, if you have tested by manually applying a role via `kubectl` then there might be a deeper issue.\r\n\r\nThe call to `listNamespacedConfigMap`s does not deviate far from the default, so it is not undertaking anything which should have a need for specific permissions. From the fact that the Heron API Server is able to submit a topology to K8s using the V1 API, I think it is safe to assume that it does have a valid/accepted bearer token and credentials.\r\n\r\nMy testing capabilities are severely restricted by system resources.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/932331781/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/932461676","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-932461676","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":932461676,"node_id":"IC_kwDOApKMps43lDxs","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-01T18:31:19Z","updated_at":"2021-10-01T18:31:19Z","author_association":"MEMBER","body":"If it so happens that a Role is required it might [not be feasible](https://unofficial-kubernetes.readthedocs.io/en/latest/admin/authorization/rbac/) to set it up programmatically:\r\n\r\n> A user can only create/update a role if they already have all the permissions contained in the role, at the same scope as the role (cluster-wide for a `ClusterRole`, within the same namespace or cluster-wide for a `Role`).\r\n\r\nThere is an example of a Role that can read a specific ConfigMap:\r\n```yaml\r\nrules:\r\n- apiGroups: [\"\"]\r\n  resources: [\"configmaps\"]\r\n  resourceNames: [\"my-config\"]\r\n  verbs: [\"get\"]\r\n```\r\n\r\nIt might also be better to require the user to manually configure the Role in K8s than silently forcing it upon them.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/932461676/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/932636387","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-932636387","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":932636387,"node_id":"IC_kwDOApKMps43lubj","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-01T23:45:36Z","updated_at":"2021-10-02T17:41:47Z","author_association":"MEMBER","body":"I am not sure if you tried this but think we need to set up a [`Service Account`](https://kubernetes.io/docs/tasks/configure-pod-container/configure-service-account/) and assign it to the Heron API Server Pod. We then bind the Role to the `Service Account` [like so](https://kubernetes.io/docs/reference/access-authn-authz/rbac/#referring-to-subjects).\r\n\r\nFrom [Stack Overflow](https://stackoverflow.com/questions/52995962/kubernetes-namespace-default-service-account):\r\n\r\n> 5. The default permissions for a service account don't allow it to list or modify any resources. The default service account isn't allowed to view cluster state let alone modify it in any way.\r\n\r\n**_Edit:_**\r\nIt appears as though the `ClusterRoles` and `ServiceAccount` are in the K8s configs for the Heron API Server:\r\n\r\n* [General](https://github.com/apache/incubator-heron/blob/master/deploy/kubernetes/general/apiserver.yaml)\r\n* [Minikube](https://github.com/apache/incubator-heron/blob/master/deploy/kubernetes/minikube/apiserver.yaml)\r\n\r\nThis makes life a lot easier with only the following being additionally required:\r\n\r\n<details>\r\n  <summary>Role</summary>\r\n\r\n```yaml\r\napiVersion: rbac.authorization.k8s.io/v1\r\nkind: Role\r\nmetadata:\r\n  name: heron-apiserver-configmap-role\r\n  namespace: default\r\nrules:\r\n- apiGroups:\r\n  - \"\"\r\n  resources:\r\n  - configmaps\r\n  verbs:\r\n  - get\r\n  - watch\r\n  - list\r\n```\r\n</details>\r\n\r\n<details>\r\n  <summary>RoleBinding</summary>\r\n\r\n```yaml\r\napiVersion: rbac.authorization.k8s.io/v1\r\nkind: RoleBinding\r\nmetadata:\r\n  name: heron-apiserver-configmap-rolebinding\r\n  namespace: default\r\nroleRef:\r\n  apiGroup: rbac.authorization.k8s.io\r\n  kind: Role\r\n  name: heron-apiserver-configmap-role\r\nsubjects:\r\n- kind: ServiceAccount\r\n  name: heron-apiserver\r\n  namespace: default\r\n```\r\n</details>\r\n\r\nI think it would be safe to add these to the Heron API Server K8s configs because it is adequately restrictive. It would be very unwise of anyone to place sensitive information in a general resource in any namespace, they should be using a `Secret`, and I believe we should not be opening a security loophole here.\r\n\r\nI also believe it is possible to assign multiple `Role`s and `ClusterRole`s to the same `ServiceAccount`. RBAC is additive and only whitelists permissions. @nicknezis, when you have some time, could you please once-over the `Role`s and test? If all is well I can update the K8s deployment scripts.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/932636387/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/932798773","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-932798773","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":932798773,"node_id":"IC_kwDOApKMps43mWE1","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-02T18:25:49Z","updated_at":"2021-10-02T18:25:49Z","author_association":"CONTRIBUTOR","body":"So I think I was running an old version of the image. I'm able to pull the configmap with the role edit I provided. But it's failing to create the podtemplate with the config map I loaded. So I'm researching how best to create a podtemplate from a file. Spark uses Fabric8 API, but I need to figure out the official java API equivalent.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/932798773/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/932808466","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-932808466","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":932808466,"node_id":"IC_kwDOApKMps43mYcS","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-02T19:26:40Z","updated_at":"2021-10-02T20:18:13Z","author_association":"MEMBER","body":"Is there an issue parsing the Pod Template or is it at the K8s deployment level? Could it be a permission issue? Either issue will arise again even if you read directly from a template file.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/932808466/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/933893882","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-933893882","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":933893882,"node_id":"IC_kwDOApKMps43qhb6","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-04T22:09:26Z","updated_at":"2021-10-04T22:11:33Z","author_association":"MEMBER","body":"Hi @nicknezis, I have spun up the K8s Heron locally but only have 4 cores and 4gb I can allocate. As such the `acking` topology remains in a `pending` state. I will test further later. The topology appears to be launching just fine, but I am unsure if the template is being used. No additional `Roles` or `RoleBindings` were required:\r\n\r\n<details>\r\n  <summary>Config Map of Pod Template</summary>\r\n\r\n```bash\r\nminikube kubectl -- get configmaps configmap-pod-template -o yaml\r\n```\r\n\r\n```yaml\r\napiVersion: v1\r\ndata:\r\n  pod_template.yaml: |\r\n    apiVersion: v1\r\n    kind: PodTemplate\r\n    metadata:\r\n      name: pod-template-example\r\n      namespace: default\r\n    template:\r\n      metadata:\r\n        name: acking-pod-template-example\r\nkind: ConfigMap\r\nmetadata:\r\n  creationTimestamp: \"2021-10-04T21:49:11Z\"\r\n  name: configmap-pod-template\r\n  namespace: default\r\n  resourceVersion: \"1021\"\r\n  uid: da578cac-27cc-4378-8cf3-664a208fcd96\r\n```\r\n</details>\r\n\r\n<details>\r\n  <summary>Heron Submit</summary>\r\n\r\n```bash\r\n kubernetes ~/.heron/examples/heron-api-examples.jar \\\r\n--verbose \\\r\n--config-property heron.kubernetes.pod.template.configmap.name=configmap-pod-template.pod_template.yaml \\\r\norg.apache.heron.examples.api.AckingTopology acking\r\n```\r\n\r\n```bash\r\n[2021-10-04 17:54:40 -0400] [DEBUG]: Input Command Line Args: {'cluster/[role]/[env]': 'kubernetes', 'topology-file-name': '/home/saad/.heron/examples/heron-api-examples.jar', 'topology-class-name': 'org.apache.heron.examples.api.AckingTopology', 'config_path': '/home/saad/.heron/conf', 'config_property': ['heron.kubernetes.pod.template.configmap.name=configmap-pod-template.pod_template.yaml'], 'deploy_deactivated': False, 'dry_run': False, 'dry_run_format': 'colored_table', 'extra_launch_classpath': '', 'release_yaml_file': '', 'service_url': '', 'topology_main_jvm_property': [], 'verbose': 'True', 'verbose_gc': False, 'subcommand': 'submit'}\r\n[2021-10-04 17:54:40 -0400] [DEBUG]: Input Command Line Args: {'cluster/[role]/[env]': 'kubernetes', 'topology-file-name': '/home/saad/.heron/examples/heron-api-examples.jar', 'topology-class-name': 'org.apache.heron.examples.api.AckingTopology', 'config_path': '/home/saad/.heron/conf', 'config_property': ['heron.kubernetes.pod.template.configmap.name=configmap-pod-template.pod_template.yaml'], 'deploy_deactivated': False, 'dry_run': False, 'dry_run_format': 'colored_table', 'extra_launch_classpath': '', 'release_yaml_file': '', 'service_url': '', 'topology_main_jvm_property': [], 'verbose': 'True', 'verbose_gc': False, 'subcommand': 'submit'}\r\n[2021-10-04 17:54:40 -0400] [DEBUG]: Using cluster definition from file /home/saad/.config/heron/kubernetes/cli.yaml\r\n[2021-10-04 17:54:40 -0400] [DEBUG]: Processed Command Line Args: {'topology-file-name': '/home/saad/.heron/examples/heron-api-examples.jar', 'topology-class-name': 'org.apache.heron.examples.api.AckingTopology', 'config_path': '/home/saad/.heron/conf', 'config_property': ['heron.kubernetes.pod.template.configmap.name=configmap-pod-template.pod_template.yaml'], 'deploy_deactivated': False, 'dry_run': False, 'dry_run_format': 'colored_table', 'extra_launch_classpath': '', 'release_yaml_file': '', 'service_url': 'http://localhost:8001/api/v1/namespaces/default/services/heron-apiserver:9000/proxy', 'topology_main_jvm_property': [], 'verbose': 'True', 'verbose_gc': False, 'subcommand': 'submit', 'cluster': 'kubernetes', 'role': 'saad', 'environ': 'default', 'submit_user': 'saad', 'deploy_mode': 'server'}\r\n[2021-10-04 17:54:40 -0400] [DEBUG]: Submit Args {'topology-file-name': '/home/saad/.heron/examples/heron-api-examples.jar', 'topology-class-name': 'org.apache.heron.examples.api.AckingTopology', 'config_path': '/home/saad/.heron/conf', 'config_property': ['heron.kubernetes.pod.template.configmap.name=configmap-pod-template.pod_template.yaml'], 'deploy_deactivated': False, 'dry_run': False, 'dry_run_format': 'colored_table', 'extra_launch_classpath': '', 'release_yaml_file': '', 'service_url': 'http://localhost:8001/api/v1/namespaces/default/services/heron-apiserver:9000/proxy', 'topology_main_jvm_property': [], 'verbose': 'True', 'verbose_gc': False, 'subcommand': 'submit', 'cluster': 'kubernetes', 'role': 'saad', 'environ': 'default', 'submit_user': 'saad', 'deploy_mode': 'server'}\r\n[2021-10-04 17:54:40 -0400] [DEBUG]: Invoking class using command: `/usr/bin/java -client -Xmx1g -cp '/home/saad/.heron/examples/heron-api-examples.jar:/home/saad/.heron/lib/third_party/*' org.apache.heron.examples.api.AckingTopology acking`\r\n[2021-10-04 17:54:40 -0400] [DEBUG]: Heron options: {cmdline.topologydefn.tmpdirectory=/tmp/tmpvj0pjzzc,cmdline.topology.initial.state=RUNNING,cmdline.topology.role=saad,cmdline.topology.environment=default,cmdline.topology.cluster=kubernetes,cmdline.topology.file_name=/home/saad/.heron/examples/heron-api-examples.jar,cmdline.topology.class_name=org.apache.heron.examples.api.AckingTopology,cmdline.topology.submit_user=saad}\r\n[2021-10-04 17:54:40 -0400] [DEBUG]: Topology config: kvs {\r\n  key: \"topology.component.rammap\"\r\n  value: \"word:1073741824,exclaim1:1073741824\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.team.environment\"\r\n  serialized_value: \"\\254\\355\\000\\005t\\000\\007default\"\r\n  type: JAVA_SERIALIZED_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.container.disk\"\r\n  value: \"2147483648\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.container.ram\"\r\n  value: \"4294967296\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.enable.message.timeouts\"\r\n  value: \"true\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.serializer.classname\"\r\n  value: \"org.apache.heron.api.serializer.KryoSerializer\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.debug\"\r\n  value: \"true\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.max.spout.pending\"\r\n  value: \"1000000000\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.container.cpu\"\r\n  value: \"3.0\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.stateful.spill.state\"\r\n  value: \"false\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.name\"\r\n  value: \"acking\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.team.name\"\r\n  value: \"saad\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.stateful.spill.state.location\"\r\n  value: \"./spilled-state/\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.component.parallelism\"\r\n  value: \"1\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.stmgrs\"\r\n  value: \"2\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.worker.childopts\"\r\n  value: \"-XX:+HeapDumpOnOutOfMemoryError\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.reliability.mode\"\r\n  value: \"ATLEAST_ONCE\"\r\n  type: STRING_VALUE\r\n}\r\nkvs {\r\n  key: \"topology.message.timeout.secs\"\r\n  value: \"10\"\r\n  type: STRING_VALUE\r\n}\r\n\r\n[2021-10-04 17:54:40 -0400] [DEBUG]: Component config:\r\n[2021-10-04 17:54:40 -0400] [DEBUG]: word => kvs {\r\n  key: \"topology.component.parallelism\"\r\n  value: \"2\"\r\n  type: STRING_VALUE\r\n}\r\n\r\n[2021-10-04 17:54:40 -0400] [DEBUG]: exclaim1 => kvs {\r\n  key: \"topology.component.parallelism\"\r\n  value: \"2\"\r\n  type: STRING_VALUE\r\n}\r\n\r\n[2021-10-04 17:54:40 -0400] [INFO]: Launching topology: 'acking'\r\n[2021-10-04 17:54:40 -0400] [INFO]: {'topology-file-name': '/home/saad/.heron/examples/heron-api-examples.jar', 'topology-class-name': 'org.apache.heron.examples.api.AckingTopology', 'config_path': '/home/saad/.heron/conf', 'config_property': ['heron.kubernetes.pod.template.configmap.name=configmap-pod-template.pod_template.yaml'], 'deploy_deactivated': False, 'dry_run': False, 'dry_run_format': 'colored_table', 'extra_launch_classpath': '', 'release_yaml_file': '/home/saad/.heron/release.yaml', 'service_url': 'http://localhost:8001/api/v1/namespaces/default/services/heron-apiserver:9000/proxy', 'topology_main_jvm_property': [], 'verbose': 'True', 'verbose_gc': False, 'subcommand': 'submit', 'cluster': 'kubernetes', 'role': 'saad', 'environ': 'default', 'submit_user': 'saad', 'deploy_mode': 'server'}\r\n[2021-10-04 17:54:40 -0400] [DEBUG]: Starting new HTTP connection (1): localhost\r\n[2021-10-04 17:54:43 -0400] [DEBUG]: http://localhost:8001 \"POST /api/v1/namespaces/default/services/heron-apiserver:9000/proxy/api/v1/topologies HTTP/1.1\" 201 78\r\n[2021-10-04 17:54:43 -0400] [INFO]: Successfully launched topology 'acking' \r\n[2021-10-04 17:54:43 -0400] [DEBUG]: Elapsed time: 2.732s.\r\n```\r\n</details>\r\n\r\n<details>\r\n  <summary>Describe Pods</summary>\r\n\r\n```bash\r\nName:           acking-0\r\nNamespace:      default\r\nPriority:       0\r\nNode:           <none>\r\nLabels:         app=heron\r\n                controller-revision-hash=acking-566bc767b6\r\n                statefulset.kubernetes.io/pod-name=acking-0\r\n                topology=acking\r\nAnnotations:    prometheus.io/port: 8080\r\n                prometheus.io/scrape: true\r\nStatus:         Pending\r\nIP:             \r\nIPs:            <none>\r\nControlled By:  StatefulSet/acking\r\nContainers:\r\n  executor:\r\n    Image:       apache/heron:testbuild\r\n    Ports:       6002/TCP, 6003/TCP, 6001/TCP, 6009/TCP, 6008/TCP, 6004/TCP, 6006/TCP, 6007/TCP, 6005/TCP\r\n    Host Ports:  0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP\r\n    Command:\r\n      sh\r\n      -c\r\n      ./heron-core/bin/heron-downloader-config kubernetes && ./heron-core/bin/heron-downloader distributedlog://zookeeper:2181/heronbkdl/acking-saad-tag-0--3038063642361095900.tar.gz . && SHARD_ID=${POD_NAME##*-} && echo shardId=${SHARD_ID} && ./heron-core/bin/heron-executor --topology-name=acking --topology-id=acking56b40818-10c0-4cda-ac3a-2c27303fef23 --topology-defn-file=acking.defn --state-manager-connection=zookeeper:2181 --state-manager-root=/heron --state-manager-config-file=./heron-conf/statemgr.yaml --tmanager-binary=./heron-core/bin/heron-tmanager --stmgr-binary=./heron-core/bin/heron-stmgr --metrics-manager-classpath=./heron-core/lib/metricsmgr/* --instance-jvm-opts=\"LVhYOitIZWFwRHVtcE9uT3V0T2ZNZW1vcnlFcnJvcg(61)(61)\" --classpath=heron-api-examples.jar --heron-internals-config-file=./heron-conf/heron_internals.yaml --override-config-file=./heron-conf/override.yaml --component-ram-map=exclaim1:1073741824,word:1073741824 --component-jvm-opts=\"\" --pkg-type=jar --topology-binary-file=heron-api-examples.jar --heron-java-home=$JAVA_HOME --heron-shell-binary=./heron-core/bin/heron-shell --cluster=kubernetes --role=saad --environment=default --instance-classpath=./heron-core/lib/instance/* --metrics-sinks-config-file=./heron-conf/metrics_sinks.yaml --scheduler-classpath=./heron-core/lib/scheduler/*:./heron-core/lib/packing/*:./heron-core/lib/statemgr/* --python-instance-binary=./heron-core/bin/heron-python-instance --cpp-instance-binary=./heron-core/bin/heron-cpp-instance --metricscache-manager-classpath=./heron-core/lib/metricscachemgr/* --metricscache-manager-mode=disabled --is-stateful=false --checkpoint-manager-classpath=./heron-core/lib/ckptmgr/*:./heron-core/lib/statefulstorage/*: --stateful-config-file=./heron-conf/stateful.yaml --checkpoint-manager-ram=1073741824 --health-manager-mode=disabled --health-manager-classpath=./heron-core/lib/healthmgr/* --shard=$SHARD_ID --server-port=6001 --tmanager-controller-port=6002 --tmanager-stats-port=6003 --shell-port=6004 --metrics-manager-port=6005 --scheduler-port=6006 --metricscache-manager-server-port=6007 --metricscache-manager-stats-port=6008 --checkpoint-manager-port=6009\r\n    Limits:\r\n      cpu:     3\r\n      memory:  4Gi\r\n    Requests:\r\n      cpu:     3\r\n      memory:  4Gi\r\n    Environment:\r\n      HOST:       (v1:status.podIP)\r\n      POD_NAME:  acking-0 (v1:metadata.name)\r\n    Mounts:\r\n      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-xfcf2 (ro)\r\nConditions:\r\n  Type           Status\r\n  PodScheduled   False \r\nVolumes:\r\n  kube-api-access-xfcf2:\r\n    Type:                    Projected (a volume that contains injected data from multiple sources)\r\n    TokenExpirationSeconds:  3607\r\n    ConfigMapName:           kube-root-ca.crt\r\n    ConfigMapOptional:       <nil>\r\n    DownwardAPI:             true\r\nQoS Class:                   Guaranteed\r\nNode-Selectors:              <none>\r\nTolerations:                 node.alpha.kubernetes.io/notReady:NoExecute op=Exists for 10s\r\n                             node.alpha.kubernetes.io/unreachable:NoExecute op=Exists for 10s\r\n                             node.kubernetes.io/not-ready:NoExecute op=Exists for 10s\r\n                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s\r\nEvents:\r\n  Type     Reason            Age   From               Message\r\n  ----     ------            ----  ----               -------\r\n  Warning  FailedScheduling  58s   default-scheduler  0/1 nodes are available: 1 Insufficient cpu.\r\n\r\n\r\nName:           acking-1\r\nNamespace:      default\r\nPriority:       0\r\nNode:           <none>\r\nLabels:         app=heron\r\n                controller-revision-hash=acking-566bc767b6\r\n                statefulset.kubernetes.io/pod-name=acking-1\r\n                topology=acking\r\nAnnotations:    prometheus.io/port: 8080\r\n                prometheus.io/scrape: true\r\nStatus:         Pending\r\nIP:             \r\nIPs:            <none>\r\nControlled By:  StatefulSet/acking\r\nContainers:\r\n  executor:\r\n    Image:       apache/heron:testbuild\r\n    Ports:       6002/TCP, 6003/TCP, 6001/TCP, 6009/TCP, 6008/TCP, 6004/TCP, 6006/TCP, 6007/TCP, 6005/TCP\r\n    Host Ports:  0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP\r\n    Command:\r\n      sh\r\n      -c\r\n      ./heron-core/bin/heron-downloader-config kubernetes && ./heron-core/bin/heron-downloader distributedlog://zookeeper:2181/heronbkdl/acking-saad-tag-0--3038063642361095900.tar.gz . && SHARD_ID=${POD_NAME##*-} && echo shardId=${SHARD_ID} && ./heron-core/bin/heron-executor --topology-name=acking --topology-id=acking56b40818-10c0-4cda-ac3a-2c27303fef23 --topology-defn-file=acking.defn --state-manager-connection=zookeeper:2181 --state-manager-root=/heron --state-manager-config-file=./heron-conf/statemgr.yaml --tmanager-binary=./heron-core/bin/heron-tmanager --stmgr-binary=./heron-core/bin/heron-stmgr --metrics-manager-classpath=./heron-core/lib/metricsmgr/* --instance-jvm-opts=\"LVhYOitIZWFwRHVtcE9uT3V0T2ZNZW1vcnlFcnJvcg(61)(61)\" --classpath=heron-api-examples.jar --heron-internals-config-file=./heron-conf/heron_internals.yaml --override-config-file=./heron-conf/override.yaml --component-ram-map=exclaim1:1073741824,word:1073741824 --component-jvm-opts=\"\" --pkg-type=jar --topology-binary-file=heron-api-examples.jar --heron-java-home=$JAVA_HOME --heron-shell-binary=./heron-core/bin/heron-shell --cluster=kubernetes --role=saad --environment=default --instance-classpath=./heron-core/lib/instance/* --metrics-sinks-config-file=./heron-conf/metrics_sinks.yaml --scheduler-classpath=./heron-core/lib/scheduler/*:./heron-core/lib/packing/*:./heron-core/lib/statemgr/* --python-instance-binary=./heron-core/bin/heron-python-instance --cpp-instance-binary=./heron-core/bin/heron-cpp-instance --metricscache-manager-classpath=./heron-core/lib/metricscachemgr/* --metricscache-manager-mode=disabled --is-stateful=false --checkpoint-manager-classpath=./heron-core/lib/ckptmgr/*:./heron-core/lib/statefulstorage/*: --stateful-config-file=./heron-conf/stateful.yaml --checkpoint-manager-ram=1073741824 --health-manager-mode=disabled --health-manager-classpath=./heron-core/lib/healthmgr/* --shard=$SHARD_ID --server-port=6001 --tmanager-controller-port=6002 --tmanager-stats-port=6003 --shell-port=6004 --metrics-manager-port=6005 --scheduler-port=6006 --metricscache-manager-server-port=6007 --metricscache-manager-stats-port=6008 --checkpoint-manager-port=6009\r\n    Limits:\r\n      cpu:     3\r\n      memory:  4Gi\r\n    Requests:\r\n      cpu:     3\r\n      memory:  4Gi\r\n    Environment:\r\n      HOST:       (v1:status.podIP)\r\n      POD_NAME:  acking-1 (v1:metadata.name)\r\n    Mounts:\r\n      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-c7vwm (ro)\r\nConditions:\r\n  Type           Status\r\n  PodScheduled   False \r\nVolumes:\r\n  kube-api-access-c7vwm:\r\n    Type:                    Projected (a volume that contains injected data from multiple sources)\r\n    TokenExpirationSeconds:  3607\r\n    ConfigMapName:           kube-root-ca.crt\r\n    ConfigMapOptional:       <nil>\r\n    DownwardAPI:             true\r\nQoS Class:                   Guaranteed\r\nNode-Selectors:              <none>\r\nTolerations:                 node.alpha.kubernetes.io/notReady:NoExecute op=Exists for 10s\r\n                             node.alpha.kubernetes.io/unreachable:NoExecute op=Exists for 10s\r\n                             node.kubernetes.io/not-ready:NoExecute op=Exists for 10s\r\n                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s\r\nEvents:\r\n  Type     Reason            Age   From               Message\r\n  ----     ------            ----  ----               -------\r\n  Warning  FailedScheduling  58s   default-scheduler  0/1 nodes are available: 1 Insufficient cpu.\r\n\r\n\r\nName:           acking-2\r\nNamespace:      default\r\nPriority:       0\r\nNode:           <none>\r\nLabels:         app=heron\r\n                controller-revision-hash=acking-566bc767b6\r\n                statefulset.kubernetes.io/pod-name=acking-2\r\n                topology=acking\r\nAnnotations:    prometheus.io/port: 8080\r\n                prometheus.io/scrape: true\r\nStatus:         Pending\r\nIP:             \r\nIPs:            <none>\r\nControlled By:  StatefulSet/acking\r\nContainers:\r\n  executor:\r\n    Image:       apache/heron:testbuild\r\n    Ports:       6002/TCP, 6003/TCP, 6001/TCP, 6009/TCP, 6008/TCP, 6004/TCP, 6006/TCP, 6007/TCP, 6005/TCP\r\n    Host Ports:  0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP\r\n    Command:\r\n      sh\r\n      -c\r\n      ./heron-core/bin/heron-downloader-config kubernetes && ./heron-core/bin/heron-downloader distributedlog://zookeeper:2181/heronbkdl/acking-saad-tag-0--3038063642361095900.tar.gz . && SHARD_ID=${POD_NAME##*-} && echo shardId=${SHARD_ID} && ./heron-core/bin/heron-executor --topology-name=acking --topology-id=acking56b40818-10c0-4cda-ac3a-2c27303fef23 --topology-defn-file=acking.defn --state-manager-connection=zookeeper:2181 --state-manager-root=/heron --state-manager-config-file=./heron-conf/statemgr.yaml --tmanager-binary=./heron-core/bin/heron-tmanager --stmgr-binary=./heron-core/bin/heron-stmgr --metrics-manager-classpath=./heron-core/lib/metricsmgr/* --instance-jvm-opts=\"LVhYOitIZWFwRHVtcE9uT3V0T2ZNZW1vcnlFcnJvcg(61)(61)\" --classpath=heron-api-examples.jar --heron-internals-config-file=./heron-conf/heron_internals.yaml --override-config-file=./heron-conf/override.yaml --component-ram-map=exclaim1:1073741824,word:1073741824 --component-jvm-opts=\"\" --pkg-type=jar --topology-binary-file=heron-api-examples.jar --heron-java-home=$JAVA_HOME --heron-shell-binary=./heron-core/bin/heron-shell --cluster=kubernetes --role=saad --environment=default --instance-classpath=./heron-core/lib/instance/* --metrics-sinks-config-file=./heron-conf/metrics_sinks.yaml --scheduler-classpath=./heron-core/lib/scheduler/*:./heron-core/lib/packing/*:./heron-core/lib/statemgr/* --python-instance-binary=./heron-core/bin/heron-python-instance --cpp-instance-binary=./heron-core/bin/heron-cpp-instance --metricscache-manager-classpath=./heron-core/lib/metricscachemgr/* --metricscache-manager-mode=disabled --is-stateful=false --checkpoint-manager-classpath=./heron-core/lib/ckptmgr/*:./heron-core/lib/statefulstorage/*: --stateful-config-file=./heron-conf/stateful.yaml --checkpoint-manager-ram=1073741824 --health-manager-mode=disabled --health-manager-classpath=./heron-core/lib/healthmgr/* --shard=$SHARD_ID --server-port=6001 --tmanager-controller-port=6002 --tmanager-stats-port=6003 --shell-port=6004 --metrics-manager-port=6005 --scheduler-port=6006 --metricscache-manager-server-port=6007 --metricscache-manager-stats-port=6008 --checkpoint-manager-port=6009\r\n    Limits:\r\n      cpu:     3\r\n      memory:  4Gi\r\n    Requests:\r\n      cpu:     3\r\n      memory:  4Gi\r\n    Environment:\r\n      HOST:       (v1:status.podIP)\r\n      POD_NAME:  acking-2 (v1:metadata.name)\r\n    Mounts:\r\n      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-snvvp (ro)\r\nConditions:\r\n  Type           Status\r\n  PodScheduled   False \r\nVolumes:\r\n  kube-api-access-snvvp:\r\n    Type:                    Projected (a volume that contains injected data from multiple sources)\r\n    TokenExpirationSeconds:  3607\r\n    ConfigMapName:           kube-root-ca.crt\r\n    ConfigMapOptional:       <nil>\r\n    DownwardAPI:             true\r\nQoS Class:                   Guaranteed\r\nNode-Selectors:              <none>\r\nTolerations:                 node.alpha.kubernetes.io/notReady:NoExecute op=Exists for 10s\r\n                             node.alpha.kubernetes.io/unreachable:NoExecute op=Exists for 10s\r\n                             node.kubernetes.io/not-ready:NoExecute op=Exists for 10s\r\n                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s\r\nEvents:\r\n  Type     Reason            Age   From               Message\r\n  ----     ------            ----  ----               -------\r\n  Warning  FailedScheduling  58s   default-scheduler  0/1 nodes are available: 1 Insufficient cpu.\r\n```\r\n\r\n</details>\r\n\r\n<details>\r\n<summary>Get Pods</summary>\r\n\r\n```bash\r\nNAME   READY   STATUS    RESTARTS   AGE\r\nzk-0   0/1     Pending   0          0s\r\nzk-0   0/1     Pending   0          0s\r\nzk-0   0/1     ContainerCreating   0          0s\r\nzk-0   0/1     Running             0          1s\r\nbookie-m8p4c   0/1     Pending             0          0s\r\nbookie-m8p4c   0/1     Pending             0          0s\r\nbookie-m8p4c   0/1     Init:0/1            0          0s\r\nzk-0           1/1     Running             0          10s\r\nbookie-m8p4c   0/1     Init:0/1            0          36s\r\nbookie-m8p4c   0/1     PodInitializing     0          38s\r\nbookie-m8p4c   1/1     Running             0          39s\r\nheron-tracker-7559f9cb58-fr2w5   0/2     Pending             0          0s\r\nheron-tracker-7559f9cb58-fr2w5   0/2     Pending             0          0s\r\nheron-tracker-7559f9cb58-fr2w5   0/2     ContainerCreating   0          0s\r\nheron-tracker-7559f9cb58-fr2w5   2/2     Running             0          1s\r\nheron-apiserver-76cf46fc94-fdwbs   0/1     Pending             0          0s\r\nheron-apiserver-76cf46fc94-fdwbs   0/1     Pending             0          0s\r\nheron-apiserver-76cf46fc94-fdwbs   0/1     Init:0/1            0          0s\r\nheron-apiserver-76cf46fc94-fdwbs   0/1     PodInitializing     0          2s\r\nheron-apiserver-76cf46fc94-fdwbs   1/1     Running             0          3s\r\nacking-0                           0/1     Pending             0          0s\r\nacking-1                           0/1     Pending             0          0s\r\nacking-0                           0/1     Pending             0          0s\r\nacking-2                           0/1     Pending             0          0s\r\nacking-1                           0/1     Pending             0          0s\r\nacking-2                           0/1     Pending             0          0s\r\n```\r\n</details>","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/933893882/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/933895467","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-933895467","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":933895467,"node_id":"IC_kwDOApKMps43qh0r","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-04T22:12:07Z","updated_at":"2021-10-04T22:12:07Z","author_association":"CONTRIBUTOR","body":"Oh cool. I'll test this out tonight. I was having trouble creating a pod template that would parse properly. I can test with the one you posted.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/933895467/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/933896528","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-933896528","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":933896528,"node_id":"IC_kwDOApKMps43qiFQ","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-04T22:13:55Z","updated_at":"2021-10-04T23:22:49Z","author_association":"MEMBER","body":"I suspect it might be the API version. It should be:\r\n```yaml\r\napiVersion: v1\r\n```\r\nand not:\r\n\r\n```yaml\r\napiVersion: apps/v1\r\n```\r\n\r\n**_Edit:_**\r\n\r\nVerifying the Pod Template using the `metadata`, `annotations`, and `labels` will be misleading:\r\nhttps://github.com/apache/incubator-heron/blob/2190502da0ad723db86a13216f5d9acd0b4c6474/heron/schedulers/src/java/org/apache/heron/scheduler/kubernetes/V1Controller.java#L388-L394\r\n\r\nI also find [kubeval](https://kubeval.instrumenta.dev/) helpful.\r\n\r\nThere are some code modifications that will be coming in soon. I need to perform the check for the Pod Template earlier in `submit` rather than in `createStatefulSet`. This is to avoid orphaned/failed topologies from persisting.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/933896528/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/933998100","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-933998100","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":933998100,"node_id":"IC_kwDOApKMps43q64U","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-05T02:05:51Z","updated_at":"2021-10-05T02:05:51Z","author_association":"CONTRIBUTOR","body":"Yes that did help. `Kubeval` is definitely helpful. Making a valid PodTemplate was taking me longer than expected. \r\n\r\nI was able to have the submit succeed, but I'm not able to see things persist. I tried adding an InitContainer, but I didn't see it in the resulting StatefulSet. I'll try looking over the logic to find the issue, but this might be related to some of the changes you mentioned you will soon be making?","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/933998100/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/934004555","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-934004555","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":934004555,"node_id":"IC_kwDOApKMps43q8dL","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-05T02:22:09Z","updated_at":"2021-10-05T02:22:09Z","author_association":"MEMBER","body":"Thank you for testing things out. I have reverted the changes I made to where the checks for a valid Pod Template occur as it was not resolving the issue. An issue arises when attempting to submit a topology with a bad ConfigMap/Pod Template where the topology persists but pods are not created. For some reason this does not do what it is supposed to:\r\n\r\nhttps://github.com/apache/incubator-heron/blob/2190502da0ad723db86a13216f5d9acd0b4c6474/heron/scheduler-core/src/java/org/apache/heron/scheduler/LaunchRunner.java#L172-L178\r\n\r\nIf there is an issue with persisted state in the submitted Pods to K8s it might be an issue further downstream. The test suite validates that `loadPodFromTemplate` is creating the `V1PodTemplateSpec` from input. It would be great to have a second set of eyes on this.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/934004555/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/934007453","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-934007453","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":934007453,"node_id":"IC_kwDOApKMps43q9Kd","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-05T02:30:56Z","updated_at":"2021-10-05T02:30:56Z","author_association":"CONTRIBUTOR","body":"I suspect what I had in the ConfigMap was being replaced with `getPodSpec()` in the code. We may need to merge the code configured aspects with anything loaded from the PodTemplate.\r\n\r\nFor example from the Spark PodTemplate documentation:\r\n\r\n```\r\nIt is important to note that Spark is opinionated about certain pod configurations so there are values in the pod template that will always be overwritten by Spark. Therefore, users of this feature should note that specifying the pod template file only lets Spark start with a template pod instead of an empty pod during the pod-building process. For details, see the full list of pod template values that will be overwritten by spark.\r\n\r\nPod template files can also define multiple containers. In such cases, you can use the spark properties spark.kubernetes.driver.podTemplateContainerName and spark.kubernetes.executor.podTemplateContainerName to indicate which container should be used as a basis for the driver or executor. If not specified, or if the container name is not valid, Spark will assume that the first container in the list will be the driver or executor container.\r\n```","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/934007453/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/934010151","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-934010151","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":934010151,"node_id":"IC_kwDOApKMps43q90n","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-05T02:39:43Z","updated_at":"2021-10-05T02:39:43Z","author_association":"MEMBER","body":"> I suspect what I had in the ConfigMap was being replaced with `getPodSpec()` in the code. We may need to merge the code configured aspects with anything loaded from the PodTemplate.\r\n\r\nThat makes perfect sense, thank you! I shall have a look at how the two `V1PodSpec` can be merged.\r\n\r\n> It is important to note that Spark is opinionated about certain pod configurations so there are values in the pod template that will always be overwritten by Spark. Therefore, users of this feature should note that specifying the pod template file only lets Spark start with a template pod instead of an empty pod during the pod-building process. For details, see the full list of pod template values that will be overwritten by spark.\r\n\r\nI think we will need to follow the same protocol and standards and document this information. Not all fields are lists or maps...","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/934010151/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/934013942","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-934013942","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":934013942,"node_id":"IC_kwDOApKMps43q-v2","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-05T02:50:27Z","updated_at":"2021-10-05T02:50:27Z","author_association":"CONTRIBUTOR","body":"> \r\n> I think we will need to follow the same protocol and standards and document this information. Not all fields are lists or maps...\r\n\r\nYes, and I added some logic to set labels and annotations with config properties. So no need to use PodTemplate for setting those. We should list the parts of the PodTemplate that will be replaced, and the config items that can be used to set them (i.e. Env variables, labels, annotations).\r\n\r\nFor `getPodSpec()`, maybe we just always modify the `PodSpec` that exists on the PodTemplate (instead of setting a brand new `PodSpec`).","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/934013942/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/934015788","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-934015788","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":934015788,"node_id":"IC_kwDOApKMps43q_Ms","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-05T02:55:35Z","updated_at":"2021-10-05T02:55:35Z","author_association":"MEMBER","body":"> Yes, and I added some logic to set labels and annotations with config properties. So no need to use PodTemplate for setting those. \r\n\r\n \r\n\r\n> We should list the parts of the PodTemplate that will be replaced, and the config items that can be used to set them (i.e. Env variables, labels, annotations).\r\n\r\nWe shall add that to the other PR for documentation - I shall add a note there.\r\n\r\n> For `getPodSpec()`, maybe we just always modify the `PodSpec` that exists on the PodTemplate (instead of setting a brand new `PodSpec`).\r\n\r\nSounds like a plan.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/934015788/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/934016410","html_url":"https://github.com/apache/incubator-heron/pull/3717#issuecomment-934016410","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3717","id":934016410,"node_id":"IC_kwDOApKMps43q_Wa","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-05T02:57:21Z","updated_at":"2021-10-05T02:57:21Z","author_association":"MEMBER","body":"**_TODO:_** as per @nicknezis  suggestion, list the parts of the PodTemplate that will be replaced and the config items that can be used to set them (i.e. Env variables, labels, annotations).","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/934016410/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/934905204","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-934905204","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":934905204,"node_id":"IC_kwDOApKMps43uYV0","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-05T21:56:20Z","updated_at":"2021-10-08T19:51:39Z","author_association":"MEMBER","body":"Sysadmins will probably want a kill switch for this feature, and as such a boot flag that will turn this off must be provided.\r\n\r\nAny idea on if the `-D` boot/command line flag for the `heron-apiserver` adds the Key-Value pair to the `Config` object? I have base logic completed, and I am writing the test suite.\r\n\r\n```bash\r\nheron-apiserver\r\n--base-template kubernetes\r\n--cluster kubernetes\r\n<ALL OTHER -D FLAG PARAMETERS>\r\n-D heron.kubernetes.pod.template.configmap.disabled=true\r\n```\r\n\r\n**_Edit:_** I am confirming this feature as working.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/934905204/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/938047280","html_url":"https://github.com/apache/incubator-heron/pull/3717#issuecomment-938047280","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3717","id":938047280,"node_id":"IC_kwDOApKMps436Xcw","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-07T18:26:55Z","updated_at":"2021-10-07T18:26:55Z","author_association":"MEMBER","body":"Updated, please feel free to add detail and make adjustments through GH review.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/938047280/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/938223306","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-938223306","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":938223306,"node_id":"IC_kwDOApKMps437CbK","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-07T23:23:42Z","updated_at":"2021-10-08T02:56:23Z","author_association":"MEMBER","body":"I have made some enhancements to allow the merging of the default executor container configuration with one which is provided in the Pod Template. The Heron defaults will overwrite anything provided in the Pod Template by a user. This enhancement allows for some tweaking of the executor container specs within constraints.\r\n\r\nOnly a single container is permitted per executor. This is important to avoid the launching of additional containers within a Pod.\r\n\r\nWhat are your thoughts? Should we be allowing the executor container to be modified?\r\n\r\n**_Edit:_** If we do want a Pod Template to be able to provide additional configs I am going to   and  the `mergeExecutorContainer` and just modify the  `getContainer`. It is a simpler and cleaner solution to just pass in the `V1Container` object when has been parsed from input and let `getContainer` overwrite with `Heron` defaults .","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/938223306/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/939094577","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-939094577","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":939094577,"node_id":"IC_kwDOApKMps43-XIx","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-08T20:20:46Z","updated_at":"2021-10-08T20:20:46Z","author_association":"MEMBER","body":"Confirming from the API Server logs, thank you @nicknezis for helping me get to them, that the pod template loading is working from both the `ConfigMap` as well as the default. I can also confirm that the kill switch is working as it is supposed to.\r\n\r\nThe current issue is surrounding whether the custom Pod Templates are being loaded. I am using the following Pod Template:\r\n```yaml\r\napiVersion: v1\r\nkind: PodTemplate\r\nmetadata:\r\n  name: pod-template-example\r\n  namespace: default\r\ntemplate:\r\n  metadata:\r\n    name: acking-pod-template-example\r\n  spec:\r\n    containers:\r\n      - name: executor\r\n        securityContext:\r\n          allowPrivilegeEscalation: false\r\n```\r\n\r\nand seeing the following on my laptop:\r\n\r\n<details><summary>describe pod acking-0</summary>\r\n\r\n```bash\r\nName:         acking-0\r\nNamespace:    default\r\nPriority:     0\r\nNode:         minikube/192.168.49.2\r\nStart Time:   Fri, 08 Oct 2021 16:11:20 -0400\r\nLabels:       app=heron\r\n              controller-revision-hash=acking-6bb45848bd\r\n              statefulset.kubernetes.io/pod-name=acking-0\r\n              topology=acking\r\nAnnotations:  prometheus.io/port: 8080\r\n              prometheus.io/scrape: true\r\nStatus:       Running\r\nIP:           172.17.0.7\r\nIPs:\r\n  IP:           172.17.0.7\r\nControlled By:  StatefulSet/acking\r\nContainers:\r\n  executor:\r\n    Container ID:  docker://63224408899b2581937fc81e36cd59bb5b9f2e9f091fc80c07c1d5abc33bf552\r\n    Image:         apache/heron:testbuild\r\n    Image ID:      docker://sha256:cccb4b3998bb9266c58c47115165e4bf63dead8e26d315436bec099f1bc475aa\r\n    Ports:         6005/TCP, 6001/TCP, 6008/TCP, 6004/TCP, 6009/TCP, 6003/TCP, 6006/TCP, 6002/TCP, 6007/TCP\r\n    Host Ports:    0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP\r\n    Command:\r\n      sh\r\n      -c\r\n      ./heron-core/bin/heron-downloader-config kubernetes && ./heron-core/bin/heron-downloader distributedlog://zookeeper:2181/heronbkdl/acking-saad-tag-0-3360812953995423633.tar.gz . && SHARD_ID=${POD_NAME##*-} && echo shardId=${SHARD_ID} && ./heron-core/bin/heron-executor --topology-name=acking --topology-id=ackinge310cae0-1eaf-4a6b-9134-9e9b310e74d0 --topology-defn-file=acking.defn --state-manager-connection=zookeeper:2181 --state-manager-root=/heron --state-manager-config-file=./heron-conf/statemgr.yaml --tmanager-binary=./heron-core/bin/heron-tmanager --stmgr-binary=./heron-core/bin/heron-stmgr --metrics-manager-classpath=./heron-core/lib/metricsmgr/* --instance-jvm-opts=\"LVhYOitIZWFwRHVtcE9uT3V0T2ZNZW1vcnlFcnJvcg(61)(61)\" --classpath=heron-api-examples.jar --heron-internals-config-file=./heron-conf/heron_internals.yaml --override-config-file=./heron-conf/override.yaml --component-ram-map=exclaim1:1073741824,word:1073741824 --component-jvm-opts=\"\" --pkg-type=jar --topology-binary-file=heron-api-examples.jar --heron-java-home=$JAVA_HOME --heron-shell-binary=./heron-core/bin/heron-shell --cluster=kubernetes --role=saad --environment=default --instance-classpath=./heron-core/lib/instance/* --metrics-sinks-config-file=./heron-conf/metrics_sinks.yaml --scheduler-classpath=./heron-core/lib/scheduler/*:./heron-core/lib/packing/*:./heron-core/lib/statemgr/* --python-instance-binary=./heron-core/bin/heron-python-instance --cpp-instance-binary=./heron-core/bin/heron-cpp-instance --metricscache-manager-classpath=./heron-core/lib/metricscachemgr/* --metricscache-manager-mode=disabled --is-stateful=false --checkpoint-manager-classpath=./heron-core/lib/ckptmgr/*:./heron-core/lib/statefulstorage/*: --stateful-config-file=./heron-conf/stateful.yaml --checkpoint-manager-ram=1073741824 --health-manager-mode=disabled --health-manager-classpath=./heron-core/lib/healthmgr/* --shard=$SHARD_ID --server-port=6001 --tmanager-controller-port=6002 --tmanager-stats-port=6003 --shell-port=6004 --metrics-manager-port=6005 --scheduler-port=6006 --metricscache-manager-server-port=6007 --metricscache-manager-stats-port=6008 --checkpoint-manager-port=6009\r\n    State:          Running\r\n      Started:      Fri, 08 Oct 2021 16:11:21 -0400\r\n    Ready:          True\r\n    Restart Count:  0\r\n    Limits:\r\n      cpu:     3\r\n      memory:  4Gi\r\n    Requests:\r\n      cpu:     3\r\n      memory:  4Gi\r\n    Environment:\r\n      HOST:       (v1:status.podIP)\r\n      POD_NAME:  acking-0 (v1:metadata.name)\r\n    Mounts:\r\n      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-6vjzm (ro)\r\nConditions:\r\n  Type              Status\r\n  Initialized       True \r\n  Ready             True \r\n  ContainersReady   True \r\n  PodScheduled      True \r\nVolumes:\r\n  kube-api-access-6vjzm:\r\n    Type:                    Projected (a volume that contains injected data from multiple sources)\r\n    TokenExpirationSeconds:  3607\r\n    ConfigMapName:           kube-root-ca.crt\r\n    ConfigMapOptional:       <nil>\r\n    DownwardAPI:             true\r\nQoS Class:                   Guaranteed\r\nNode-Selectors:              <none>\r\nTolerations:                 node.alpha.kubernetes.io/notReady:NoExecute op=Exists for 10s\r\n                             node.alpha.kubernetes.io/unreachable:NoExecute op=Exists for 10s\r\n                             node.kubernetes.io/not-ready:NoExecute op=Exists for 10s\r\n                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s\r\nEvents:\r\n  Type    Reason     Age    From               Message\r\n  ----    ------     ----   ----               -------\r\n  Normal  Scheduled  4m58s  default-scheduler  Successfully assigned default/acking-0 to minikube\r\n  Normal  Pulled     4m57s  kubelet            Container image \"apache/heron:testbuild\" already present on machine\r\n  Normal  Created    4m57s  kubelet            Created container executor\r\n  Normal  Started    4m57s  kubelet            Started container executor\r\n```\r\n\r\n</details>","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/939094577/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/939336529","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-939336529","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":939336529,"node_id":"IC_kwDOApKMps43_SNR","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-09T17:57:28Z","updated_at":"2021-10-09T17:57:28Z","author_association":"MEMBER","body":"@nicknezis I am confirming that all items are being carried over from the provided Pod Template. `Environment` and `Limits` variables are being augmented with all Heron defaults taking precedence. We need to consider whether we need to augment the `Ports`, `Volume Mounts`, and the `Resource Requests`. \r\n\r\nAny container provided in the Pod Template that is not named as `executor` is being discarded. The image provided for the `executor`  is overwritten by the Heron default value. This is for security concerns.\r\n\r\nIn the example below I have added some random `Environment` variables to demonstrate:\r\n\r\n<details><summary>pos-template.yaml</summary>\r\n\r\n```yaml\r\napiVersion: v1\r\nkind: PodTemplate\r\nmetadata:\r\n  name: pod-template-example\r\n  namespace: default\r\ntemplate:\r\n  metadata:\r\n    name: acking-pod-template-example\r\n  spec:\r\n    containers:\r\n      - name: executor\r\n        securityContext:\r\n          allowPrivilegeEscalation: false\r\n        env:\r\n        - name: Porsche\r\n          value: \"992 4S GTS\"\r\n        - name: Porsche\r\n          value: \"992 GT3 Touring\"\r\n        - name: Everything-Else\r\n          value: \"turds\"\r\n      - name: BusyBox\r\n        image: busybox:latest\r\n        env:\r\n        - name: BusyBox_ENV\r\n          value: \"should not exist\"\r\n```\r\n\r\n</details>\r\n\r\n<details><summary>kubectl describe pods acking-0</summary>\r\n\r\n```bash\r\nName:         acking-0\r\nNamespace:    default\r\nPriority:     0\r\nNode:         minikube/192.168.49.2\r\nStart Time:   Sat, 09 Oct 2021 13:39:11 -0400\r\nLabels:       app=heron\r\n              controller-revision-hash=acking-7f746f959c\r\n              statefulset.kubernetes.io/pod-name=acking-0\r\n              topology=acking\r\nAnnotations:  prometheus.io/port: 8080\r\n              prometheus.io/scrape: true\r\nStatus:       Running\r\nIP:           172.17.0.9\r\nIPs:\r\n  IP:           172.17.0.9\r\nControlled By:  StatefulSet/acking\r\nContainers:\r\n  executor:\r\n    Container ID:  docker://2dfcf887ef3eb6893716ebf8a97953a94c27723b2df7649dadb1763e8d5408f5\r\n    Image:         apache/heron:testbuild\r\n    Image ID:      docker://sha256:dfea9b424c7cf8061d495969b54cf862a2cabb582b1576d0f9d0f7cd060a1f7e\r\n    Ports:         6005/TCP, 6006/TCP, 6008/TCP, 6003/TCP, 6004/TCP, 6009/TCP, 6001/TCP, 6002/TCP, 6007/TCP\r\n    Host Ports:    0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP\r\n    Command:\r\n      sh\r\n      -c\r\n      ./heron-core/bin/heron-downloader-config kubernetes && ./heron-core/bin/heron-downloader distributedlog://zookeeper:2181/heronbkdl/acking-saad-tag-0--1080570153153064408.tar.gz . && SHARD_ID=${POD_NAME##*-} && echo shardId=${SHARD_ID} && ./heron-core/bin/heron-executor --topology-name=acking --topology-id=ackingfef5147f-5e10-4515-98bd-82342e957919 --topology-defn-file=acking.defn --state-manager-connection=zookeeper:2181 --state-manager-root=/heron --state-manager-config-file=./heron-conf/statemgr.yaml --tmanager-binary=./heron-core/bin/heron-tmanager --stmgr-binary=./heron-core/bin/heron-stmgr --metrics-manager-classpath=./heron-core/lib/metricsmgr/* --instance-jvm-opts=\"LVhYOitIZWFwRHVtcE9uT3V0T2ZNZW1vcnlFcnJvcg(61)(61)\" --classpath=heron-api-examples.jar --heron-internals-config-file=./heron-conf/heron_internals.yaml --override-config-file=./heron-conf/override.yaml --component-ram-map=exclaim1:1073741824,word:1073741824 --component-jvm-opts=\"\" --pkg-type=jar --topology-binary-file=heron-api-examples.jar --heron-java-home=$JAVA_HOME --heron-shell-binary=./heron-core/bin/heron-shell --cluster=kubernetes --role=saad --environment=default --instance-classpath=./heron-core/lib/instance/* --metrics-sinks-config-file=./heron-conf/metrics_sinks.yaml --scheduler-classpath=./heron-core/lib/scheduler/*:./heron-core/lib/packing/*:./heron-core/lib/statemgr/* --python-instance-binary=./heron-core/bin/heron-python-instance --cpp-instance-binary=./heron-core/bin/heron-cpp-instance --metricscache-manager-classpath=./heron-core/lib/metricscachemgr/* --metricscache-manager-mode=disabled --is-stateful=false --checkpoint-manager-classpath=./heron-core/lib/ckptmgr/*:./heron-core/lib/statefulstorage/*: --stateful-config-file=./heron-conf/stateful.yaml --checkpoint-manager-ram=1073741824 --health-manager-mode=disabled --health-manager-classpath=./heron-core/lib/healthmgr/* --shard=$SHARD_ID --server-port=6001 --tmanager-controller-port=6002 --tmanager-stats-port=6003 --shell-port=6004 --metrics-manager-port=6005 --scheduler-port=6006 --metricscache-manager-server-port=6007 --metricscache-manager-stats-port=6008 --checkpoint-manager-port=6009\r\n    State:          Running\r\n      Started:      Sat, 09 Oct 2021 13:39:12 -0400\r\n    Ready:          True\r\n    Restart Count:  0\r\n    Limits:\r\n      cpu:     3\r\n      memory:  4Gi\r\n    Requests:\r\n      cpu:     3\r\n      memory:  4Gi\r\n    Environment:\r\n      Everything-Else:  turds\r\n      Porsche:          992 GT3 Touring\r\n      POD_NAME:         acking-0 (v1:metadata.name)\r\n      Porsche:          992 4S GTS\r\n      HOST:              (v1:status.podIP)\r\n    Mounts:\r\n      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-p9hwk (ro)\r\nConditions:\r\n  Type              Status\r\n  Initialized       True \r\n  Ready             True \r\n  ContainersReady   True \r\n  PodScheduled      True \r\nVolumes:\r\n  kube-api-access-p9hwk:\r\n    Type:                    Projected (a volume that contains injected data from multiple sources)\r\n    TokenExpirationSeconds:  3607\r\n    ConfigMapName:           kube-root-ca.crt\r\n    ConfigMapOptional:       <nil>\r\n    DownwardAPI:             true\r\nQoS Class:                   Guaranteed\r\nNode-Selectors:              <none>\r\nTolerations:                 node.alpha.kubernetes.io/notReady:NoExecute op=Exists for 10s\r\n                             node.alpha.kubernetes.io/unreachable:NoExecute op=Exists for 10s\r\n                             node.kubernetes.io/not-ready:NoExecute op=Exists for 10s\r\n                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s\r\nEvents:\r\n  Type    Reason     Age   From               Message\r\n  ----    ------     ----  ----               -------\r\n  Normal  Scheduled  21s   default-scheduler  Successfully assigned default/acking-0 to minikube\r\n  Normal  Pulled     20s   kubelet            Container image \"apache/heron:testbuild\" already present on machine\r\n  Normal  Created    20s   kubelet            Created container executor\r\n  Normal  Started    20s   kubelet            Started container executor\r\n```\r\n\r\n</details>","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/939336529/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/939338054","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-939338054","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":939338054,"node_id":"IC_kwDOApKMps43_SlG","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-09T18:06:30Z","updated_at":"2021-10-09T18:06:30Z","author_association":"CONTRIBUTOR","body":"Allowing for other containers might be good. It seems like one of the key benefits of the Podtemplate feature. It allows for running sidecar containers.\n\nThe image name being replaced is good. We already have that exposed as a config item on the Heron API server.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/939338054/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/939395365","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-939395365","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":939395365,"node_id":"IC_kwDOApKMps43_gkl","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-10T02:43:36Z","updated_at":"2021-10-10T02:43:36Z","author_association":"MEMBER","body":"I have gone ahead and added the ability for additional `Container`s to be included. If a System Admin takes issue with this functionality, they can disable it with the provided flag.\r\n\r\nI shall go ahead and add the overwriting-merge for the `Volume Mounts` and `Ports`. These are essential for sidecars and various other support container patterns.\r\n\r\nThe Pod Template is simple with the sidecar loading an `alpine` image. I performed some tests on merging spec lists and encountered a bug, which I have squashed. All changes remain on `dev` pending a merge.\r\n\r\nI am working on a desktop that is CPU constrained so the Pods will remain in a `pending` state.\r\n\r\n<details><summary>Pod Template</summary>\r\n\r\n```yaml\r\napiVersion: v1\r\nkind: PodTemplate\r\nmetadata:\r\n  name: pod-template-example\r\n  namespace: default\r\ntemplate:\r\n  metadata:\r\n    name: acking-pod-template-example\r\n  spec:\r\n    containers:\r\n      # Executor container\r\n      - name: executor\r\n        securityContext:\r\n          allowPrivilegeEscalation: false\r\n        env:\r\n        - name: Var_One\r\n          value: \"First Variable\"\r\n        - name: Var_Two\r\n          value: \"Second Variable\"\r\n        - name: Var_Three\r\n          value: \"Third Variable\"\r\n        - name: POD_NAME\r\n          value: \"MUST BE OVERWRITTEN\"\r\n        - name: HOST\r\n          value: \"REPLACED WITH ACTUAL HOST\"\r\n\r\n      # Sidecar container\r\n      - name: sidecar-container\r\n        image: alpine\r\n```\r\n\r\n</details>\r\n\r\n<details><summary>describe pods acking-0</summary>\r\n\r\n```bash\r\nName:           acking-0\r\nNamespace:      default\r\nPriority:       0\r\nNode:           <none>\r\nLabels:         app=heron\r\n                controller-revision-hash=acking-74f89d8bd9\r\n                statefulset.kubernetes.io/pod-name=acking-0\r\n                topology=acking\r\nAnnotations:    prometheus.io/port: 8080\r\n                prometheus.io/scrape: true\r\nStatus:         Pending\r\nIP:             \r\nIPs:            <none>\r\nControlled By:  StatefulSet/acking\r\nContainers:\r\n  executor:\r\n    Image:       apache/heron:testbuild\r\n    Ports:       6008/TCP, 6001/TCP, 6002/TCP, 6009/TCP, 6004/TCP, 6006/TCP, 6007/TCP, 6005/TCP, 6003/TCP\r\n    Host Ports:  0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP\r\n    Command:\r\n      sh\r\n      -c\r\n      ./heron-core/bin/heron-downloader-config kubernetes && ./heron-core/bin/heron-downloader distributedlog://zookeeper:2181/heronbkdl/acking-saad-tag-0-3560430130176919824.tar.gz . && SHARD_ID=${POD_NAME##*-} && echo shardId=${SHARD_ID} && ./heron-core/bin/heron-executor --topology-name=acking --topology-id=acking196b29f8-aad9-42c2-a6c8-7987ef4602e9 --topology-defn-file=acking.defn --state-manager-connection=zookeeper:2181 --state-manager-root=/heron --state-manager-config-file=./heron-conf/statemgr.yaml --tmanager-binary=./heron-core/bin/heron-tmanager --stmgr-binary=./heron-core/bin/heron-stmgr --metrics-manager-classpath=./heron-core/lib/metricsmgr/* --instance-jvm-opts=\"LVhYOitIZWFwRHVtcE9uT3V0T2ZNZW1vcnlFcnJvcg(61)(61)\" --classpath=heron-api-examples.jar --heron-internals-config-file=./heron-conf/heron_internals.yaml --override-config-file=./heron-conf/override.yaml --component-ram-map=exclaim1:1073741824,word:1073741824 --component-jvm-opts=\"\" --pkg-type=jar --topology-binary-file=heron-api-examples.jar --heron-java-home=$JAVA_HOME --heron-shell-binary=./heron-core/bin/heron-shell --cluster=kubernetes --role=saad --environment=default --instance-classpath=./heron-core/lib/instance/* --metrics-sinks-config-file=./heron-conf/metrics_sinks.yaml --scheduler-classpath=./heron-core/lib/scheduler/*:./heron-core/lib/packing/*:./heron-core/lib/statemgr/* --python-instance-binary=./heron-core/bin/heron-python-instance --cpp-instance-binary=./heron-core/bin/heron-cpp-instance --metricscache-manager-classpath=./heron-core/lib/metricscachemgr/* --metricscache-manager-mode=disabled --is-stateful=false --checkpoint-manager-classpath=./heron-core/lib/ckptmgr/*:./heron-core/lib/statefulstorage/*: --stateful-config-file=./heron-conf/stateful.yaml --checkpoint-manager-ram=1073741824 --health-manager-mode=disabled --health-manager-classpath=./heron-core/lib/healthmgr/* --shard=$SHARD_ID --server-port=6001 --tmanager-controller-port=6002 --tmanager-stats-port=6003 --shell-port=6004 --metrics-manager-port=6005 --scheduler-port=6006 --metricscache-manager-server-port=6007 --metricscache-manager-stats-port=6008 --checkpoint-manager-port=6009\r\n    Limits:\r\n      cpu:     3\r\n      memory:  4Gi\r\n    Requests:\r\n      cpu:     3\r\n      memory:  4Gi\r\n    Environment:\r\n      HOST:        (v1:status.podIP)\r\n      POD_NAME:   acking-0 (v1:metadata.name)\r\n      Var_One:    First Variable\r\n      Var_Three:  Third Variable\r\n      Var_Two:    Second Variable\r\n    Mounts:\r\n      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-h62wk (ro)\r\n  sidecar-container:\r\n    Image:        alpine\r\n    Port:         <none>\r\n    Host Port:    <none>\r\n    Environment:  <none>\r\n    Mounts:\r\n      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-h62wk (ro)\r\nConditions:\r\n  Type           Status\r\n  PodScheduled   False \r\nVolumes:\r\n  kube-api-access-h62wk:\r\n    Type:                    Projected (a volume that contains injected data from multiple sources)\r\n    TokenExpirationSeconds:  3607\r\n    ConfigMapName:           kube-root-ca.crt\r\n    ConfigMapOptional:       <nil>\r\n    DownwardAPI:             true\r\nQoS Class:                   Burstable\r\nNode-Selectors:              <none>\r\nTolerations:                 node.alpha.kubernetes.io/notReady:NoExecute op=Exists for 10s\r\n                             node.alpha.kubernetes.io/unreachable:NoExecute op=Exists for 10s\r\n                             node.kubernetes.io/not-ready:NoExecute op=Exists for 10s\r\n                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s\r\nEvents:\r\n  Type     Reason            Age                 From               Message\r\n  ----     ------            ----                ----               -------\r\n  Warning  FailedScheduling  38s (x2 over 115s)  default-scheduler  0/1 nodes are available: 1 Insufficient cpu.\r\n```\r\n\r\n</details>\r\n","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/939395365/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/939633719","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-939633719","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":939633719,"node_id":"IC_kwDOApKMps44Aaw3","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-11T02:48:30Z","updated_at":"2021-10-11T02:48:30Z","author_association":"MEMBER","body":"I have finalised the feature. I am moving on to tracing where the `submit` command originates within the `scheduler-core` to locate where to delete the topologies from in the event of a failed submission to K8s. I shall update the documentation shortly. Input on what follows is genuinely appreciated and we need broader testing.\r\n\r\n<details><summary>Pod Template</summary>\r\n\r\n```yaml\r\napiVersion: v1\r\nkind: PodTemplate\r\nmetadata:\r\n  name: pod-template-example\r\n  namespace: default\r\ntemplate:\r\n  metadata:\r\n    name: acking-pod-template-example\r\n  spec:\r\n    containers:\r\n      # Executor container\r\n      - name: executor\r\n        securityContext:\r\n          allowPrivilegeEscalation: false\r\n        env:\r\n        - name: var_one\r\n          value: \"variable one\"\r\n        - name: var_two\r\n          value: \"variable two\"\r\n        - name: var_three\r\n          value: \"variable three\"\r\n        - name: POD_NAME\r\n          value: \"MUST BE OVERWRITTEN\"\r\n        - name: HOST\r\n          value: \"REPLACED WITH ACTUAL HOST\"\r\n        ports:\r\n        - name: overwritten\r\n          protocol: TCP\r\n          containerPort: 6001\r\n        - name: tcp-port-kept\r\n          protocol: TCP\r\n          containerPort: 5555\r\n        - name: udp-port-kept\r\n          protocol: UDP\r\n          containerPort: 5556\r\n        volumeMounts:\r\n        - name: shared-volume\r\n          mountPath: /shared_volume\r\n\r\n      # Sidecar container\r\n      - name: sidecar-container\r\n        image: alpine\r\n        volumeMounts:\r\n        - name: shared-volume\r\n          mountPath: /shared_volume\r\n\r\n    # Volumes\r\n    volumes:\r\n    - name: shared-volume\r\n      emptyDir: {}\r\n```\r\n\r\n</details>\r\n\r\n<details><summary>describe pod acking-0</summary>\r\n\r\n```bash\r\nName:           acking-0\r\nNamespace:      default\r\nPriority:       0\r\nNode:           <none>\r\nLabels:         app=heron\r\n                controller-revision-hash=acking-748f986d6f\r\n                statefulset.kubernetes.io/pod-name=acking-0\r\n                topology=acking\r\nAnnotations:    prometheus.io/port: 8080\r\n                prometheus.io/scrape: true\r\nStatus:         Pending\r\nIP:             \r\nIPs:            <none>\r\nControlled By:  StatefulSet/acking\r\nContainers:\r\n  executor:\r\n    Image:       apache/heron:testbuild\r\n    Ports:       5555/TCP, 5556/UDP, 6001/TCP, 6002/TCP, 6003/TCP, 6004/TCP, 6005/TCP, 6006/TCP, 6007/TCP, 6008/TCP, 6009/TCP\r\n    Host Ports:  0/TCP, 0/UDP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP, 0/TCP\r\n    Command:\r\n      sh\r\n      -c\r\n      ./heron-core/bin/heron-downloader-config kubernetes && ./heron-core/bin/heron-downloader distributedlog://zookeeper:2181/heronbkdl/acking-saad-tag-0-5579618957728031586.tar.gz . && SHARD_ID=${POD_NAME##*-} && echo shardId=${SHARD_ID} && ./heron-core/bin/heron-executor --topology-name=acking --topology-id=acking6276c0d9-866f-4ac4-b8af-d54a9d51b3f9 --topology-defn-file=acking.defn --state-manager-connection=zookeeper:2181 --state-manager-root=/heron --state-manager-config-file=./heron-conf/statemgr.yaml --tmanager-binary=./heron-core/bin/heron-tmanager --stmgr-binary=./heron-core/bin/heron-stmgr --metrics-manager-classpath=./heron-core/lib/metricsmgr/* --instance-jvm-opts=\"LVhYOitIZWFwRHVtcE9uT3V0T2ZNZW1vcnlFcnJvcg(61)(61)\" --classpath=heron-api-examples.jar --heron-internals-config-file=./heron-conf/heron_internals.yaml --override-config-file=./heron-conf/override.yaml --component-ram-map=exclaim1:1073741824,word:1073741824 --component-jvm-opts=\"\" --pkg-type=jar --topology-binary-file=heron-api-examples.jar --heron-java-home=$JAVA_HOME --heron-shell-binary=./heron-core/bin/heron-shell --cluster=kubernetes --role=saad --environment=default --instance-classpath=./heron-core/lib/instance/* --metrics-sinks-config-file=./heron-conf/metrics_sinks.yaml --scheduler-classpath=./heron-core/lib/scheduler/*:./heron-core/lib/packing/*:./heron-core/lib/statemgr/* --python-instance-binary=./heron-core/bin/heron-python-instance --cpp-instance-binary=./heron-core/bin/heron-cpp-instance --metricscache-manager-classpath=./heron-core/lib/metricscachemgr/* --metricscache-manager-mode=disabled --is-stateful=false --checkpoint-manager-classpath=./heron-core/lib/ckptmgr/*:./heron-core/lib/statefulstorage/*: --stateful-config-file=./heron-conf/stateful.yaml --checkpoint-manager-ram=1073741824 --health-manager-mode=disabled --health-manager-classpath=./heron-core/lib/healthmgr/* --shard=$SHARD_ID --server-port=6001 --tmanager-controller-port=6002 --tmanager-stats-port=6003 --shell-port=6004 --metrics-manager-port=6005 --scheduler-port=6006 --metricscache-manager-server-port=6007 --metricscache-manager-stats-port=6008 --checkpoint-manager-port=6009\r\n    Limits:\r\n      cpu:     3\r\n      memory:  4Gi\r\n    Requests:\r\n      cpu:     3\r\n      memory:  4Gi\r\n    Environment:\r\n      HOST:        (v1:status.podIP)\r\n      POD_NAME:   acking-0 (v1:metadata.name)\r\n      var_one:    variable one\r\n      var_three:  variable three\r\n      var_two:    variable two\r\n    Mounts:\r\n      /shared_volume from shared-volume (rw)\r\n      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-csb95 (ro)\r\n  sidecar-container:\r\n    Image:        alpine\r\n    Port:         <none>\r\n    Host Port:    <none>\r\n    Environment:  <none>\r\n    Mounts:\r\n      /shared_volume from shared-volume (rw)\r\n      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-csb95 (ro)\r\nConditions:\r\n  Type           Status\r\n  PodScheduled   False \r\nVolumes:\r\n  shared-volume:\r\n    Type:       EmptyDir (a temporary directory that shares a pod's lifetime)\r\n    Medium:     \r\n    SizeLimit:  <unset>\r\n  kube-api-access-csb95:\r\n    Type:                    Projected (a volume that contains injected data from multiple sources)\r\n    TokenExpirationSeconds:  3607\r\n    ConfigMapName:           kube-root-ca.crt\r\n    ConfigMapOptional:       <nil>\r\n    DownwardAPI:             true\r\nQoS Class:                   Burstable\r\nNode-Selectors:              <none>\r\nTolerations:                 node.alpha.kubernetes.io/notReady:NoExecute op=Exists for 10s\r\n                             node.alpha.kubernetes.io/unreachable:NoExecute op=Exists for 10s\r\n                             node.kubernetes.io/not-ready:NoExecute op=Exists for 10s\r\n                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s\r\nEvents:\r\n  Type     Reason            Age   From               Message\r\n  ----     ------            ----  ----               -------\r\n  Warning  FailedScheduling  17s   default-scheduler  0/1 nodes are available: 1 Insufficient cpu.\r\n```\r\n\r\n</details>\r\n\r\n## Heron Configured Items in Pod Templates\r\n\r\nHeron will locate the container named `executor` in the Pod Template and customize it as outlined below. All other containers within the Pod Template will remain unchanged.\r\n\r\n### Executor Container\r\n\r\nAll metadata for the `executor` container will be overwritten by Heron. In some other cases, values from the Pod Template for the `executor` will be overwritten by Heron as outline below.\r\n\r\n| Name | Description | Policy |\r\n|---|---|---|\r\n| `image` | The `executor` container's image. | Overwritten by Heron using values form the config.\r\n| `env` | Environment variables are made available within the container. The `HOST` and `POD_NAME` keys are required by Heron and are thus reserved. | Merged with Heron's values taking precedence. Deduplication is based on `name`.\r\n| `ports` | Port numbers opened within the container. Some of these port number are required by Heron and are thus reserved. The reserved ports are defined in Heron's constants as [`6001`-`6010`]. | Merged with Heron's values taking precedence. Deduplication is based on the `containerPort` value.\r\n| `limits` | Heron will attempt to load values for `cpu` and `memory` from its configs. If these values are not provided in the containers specs, Heron will place values from its configs. | User input takes precedence over Heron's values. This allows for per job custom resource limits.\r\n| `volumeMounts` | These are the mount points within the `executor` container for the `volumes` available in the Pod. | Merged with Heron's values taking precedence. Deduplication is based on the `name` value.\r\n| Annotation: `prometheus.io/scrape` | Flag to indicate whether Prometheus logs can be scraped and is set to `true`. | Value is are overridden by Heron. |\r\n| Annotation `prometheus.io/port` | Port address for Prometheus log scraping and is set to `8080`. | Values are overridden by Heron.\r\n| Annotation: Pod | Pod's revision/version hash. | Automatically set.\r\n| Annotation: Service | Labels services can use to attach to the Pod. | Automatically set.\r\n| Label: `app` | Name of the application lauching the Pod and is set to `Heron`. | Values are overridden by Heron.\r\n| Label: `topology`| The name of topology which was provided when submitting. | User defined and supplied on the CLI.\r\n\r\n### Pod\r\n\r\nThe following items will be set in the Pod Template's `spec` by Heron.\r\n\r\n| Name | Description | Policy |\r\n|---|---|---|\r\n`terminationGracePeriodSeconds` | Grace period to wait before shutting down the Pod after a `SIGTERM` signal and is set to `0` seconds. | Values are overridden by Heron.\r\n| `tolerations` | Attempts to colocate Pods with `tolerations` and `taints` onto nodes hosting Pods with matching `tolerations` and `taints`. <br>  Keys:<br>`node.kubernetes.io/not-ready` <br> `node.alpha.kubernetes.io/notReady` <br> `node.alpha.kubernetes.io/unreachable`. <br> Values (common):<br> `operator: \"Exists\"`<br> `effect: NoExecute`<br> `tolerationSeconds: 10L` | Values are overridden by Heron.\r\n| `containers` | Container images to be used on the executor Pods. | All `containers`, excluding the `executor`, are loaded as-is.\r\n| `volumes` | Volumes to be made available to the entire Pod. | Merged with Heron's values taking precedence. Deduplication is based on the `name` value.\r\n| `secretVolumes` | Secrets to be mounted as volumes within the Pod. | Loaded from the Heron configs if present.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/939633719/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/941290266","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-941290266","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":941290266,"node_id":"IC_kwDOApKMps44GvMa","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-12T18:49:54Z","updated_at":"2021-10-12T18:49:54Z","author_association":"MEMBER","body":"Dangling references to topologies that fail to launch are now removed from the `Topology Manager` and `Scheduler`. I am updating the `docs` as well. I think we have an RC here.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/941290266/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/943297568","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-943297568","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":943297568,"node_id":"IC_kwDOApKMps44OZQg","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-14T12:12:40Z","updated_at":"2021-10-14T12:12:40Z","author_association":"CONTRIBUTOR","body":"We should also make `getPodTemplateConfigMapDisabled(Config config)` return `false` by default when it isn't set so that it is consistent with the yamls.\r\n\r\nFor the Helm chart, we just need the add the following line to `tools.yaml`:\r\n```\r\n-D heron.kubernetes.pod.template.configmap.disabled={{ .Values.disablePodTemplates }}\r\n```\r\nAnd in the `values.yaml.template`:\r\n```\r\n# Support for ConfigMap mounted PodTemplates\r\ndisablePodTemplates: false\r\n```","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/943297568/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/943306744","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-943306744","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":943306744,"node_id":"IC_kwDOApKMps44Obf4","user":{"login":"nicknezis","id":181930,"node_id":"MDQ6VXNlcjE4MTkzMA==","avatar_url":"https://avatars.githubusercontent.com/u/181930?v=4","gravatar_id":"","url":"https://api.github.com/users/nicknezis","html_url":"https://github.com/nicknezis","followers_url":"https://api.github.com/users/nicknezis/followers","following_url":"https://api.github.com/users/nicknezis/following{/other_user}","gists_url":"https://api.github.com/users/nicknezis/gists{/gist_id}","starred_url":"https://api.github.com/users/nicknezis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nicknezis/subscriptions","organizations_url":"https://api.github.com/users/nicknezis/orgs","repos_url":"https://api.github.com/users/nicknezis/repos","events_url":"https://api.github.com/users/nicknezis/events{/privacy}","received_events_url":"https://api.github.com/users/nicknezis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-14T12:25:16Z","updated_at":"2021-10-14T12:25:16Z","author_association":"CONTRIBUTOR","body":"I didn't realize I had the ability to push to your branch. I made the Helm chart update so that should be good.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/943306744/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/943445404","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-943445404","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":943445404,"node_id":"IC_kwDOApKMps44O9Wc","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-14T15:02:59Z","updated_at":"2021-10-14T15:02:59Z","author_association":"MEMBER","body":"> I didn't realize I had the ability to push to your branch.\r\n\r\nThese permissions are part of the GH PR workflow and are only on the PR branch. You will not be able to push to the `dev` branch. GH assigns itself permissions, for inline code suggestion committing, as well as for assignees for the PR branch.\r\n\r\n> I made the Helm chart update so that should be good.\r\n \r\nThank you  \r\n\r\n> We should also make `getPodTemplateConfigMapDisabled(Config config)` return `false` by default when it isn't set so that it is consistent with the yamls.\r\n\r\nIt should already do this and the tests in `KubernetesContextTest` confirm this:\r\n\r\n```java\r\n    Assert.assertFalse(KubernetesContext.getPodTemplateConfigMapDisabled(config));\r\n    Assert.assertFalse(KubernetesContext\r\n        .getPodTemplateConfigMapDisabled(configWithPodTemplateConfigMap));\r\n\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/943445404/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/943854000","html_url":"https://github.com/apache/incubator-heron/pull/3710#issuecomment-943854000","issue_url":"https://api.github.com/repos/apache/incubator-heron/issues/3710","id":943854000,"node_id":"IC_kwDOApKMps44QhGw","user":{"login":"surahman","id":3979925,"node_id":"MDQ6VXNlcjM5Nzk5MjU=","avatar_url":"https://avatars.githubusercontent.com/u/3979925?v=4","gravatar_id":"","url":"https://api.github.com/users/surahman","html_url":"https://github.com/surahman","followers_url":"https://api.github.com/users/surahman/followers","following_url":"https://api.github.com/users/surahman/following{/other_user}","gists_url":"https://api.github.com/users/surahman/gists{/gist_id}","starred_url":"https://api.github.com/users/surahman/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/surahman/subscriptions","organizations_url":"https://api.github.com/users/surahman/orgs","repos_url":"https://api.github.com/users/surahman/repos","events_url":"https://api.github.com/users/surahman/events{/privacy}","received_events_url":"https://api.github.com/users/surahman/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-10-15T00:08:08Z","updated_at":"2021-10-15T00:08:08Z","author_association":"MEMBER","body":"I have changed the package scoping on a few methods in the `V1Controller` to enable testing. They have all been annotated to indicate purpose. These tests should make all of my changes verifiable.\r\n\r\nWe **_really_** need to update JUnit, Mockito, and PowerMock.","reactions":{"url":"https://api.github.com/repos/apache/incubator-heron/issues/comments/943854000/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]