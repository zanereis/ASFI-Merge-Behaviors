[{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044015379","html_url":"https://github.com/apache/ratis/pull/598#issuecomment-1044015379","issue_url":"https://api.github.com/repos/apache/ratis/issues/598","id":1044015379,"node_id":"IC_kwDOBMxbGc4-OmkT","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-18T06:52:03Z","updated_at":"2022-02-18T06:52:03Z","author_association":"CONTRIBUTOR","body":"@szetszwo PTAL again.\r\nAfter this MR, we may complete the work according to this progress:\r\nChange the code related to RaftServerImpl to support starting in the form of Listener;\r\nAdd ListenerState related code and modify LeaderStateImpl related code to support passing journals to Listener\r\nDo you have any suggestions for future work? Thanks!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044015379/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044058182","html_url":"https://github.com/apache/ratis/pull/598#issuecomment-1044058182","issue_url":"https://api.github.com/repos/apache/ratis/issues/598","id":1044058182,"node_id":"IC_kwDOBMxbGc4-OxBG","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-18T07:29:47Z","updated_at":"2022-02-18T07:29:47Z","author_association":"CONTRIBUTOR","body":"@codings-dan, The testLeaderStepDown just has failed in the build.  Please take a look.\r\nsee [502](https://github.com/apache/ratis/runs/5243753207?check_suite_focus=true#step:5:502)\r\n```\r\nError:  Tests run: 3, Failures: 1, Errors: 0, Skipped: 0, Time elapsed: 2.995 s <<< FAILURE!\r\n - in org.apache.ratis.netty.TestPreAppendLeaderStepDownWithNetty\r\nError:  testLeaderStepDown(org.apache.ratis.netty.TestPreAppendLeaderStepDownWithNetty)\r\n  Time elapsed: 0.601 s  <<< FAILURE!\r\njava.lang.AssertionError\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044058182/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044120032","html_url":"https://github.com/apache/ratis/pull/598#issuecomment-1044120032","issue_url":"https://api.github.com/repos/apache/ratis/issues/598","id":1044120032,"node_id":"IC_kwDOBMxbGc4-PAHg","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-18T08:16:48Z","updated_at":"2022-02-18T08:16:48Z","author_association":"CONTRIBUTOR","body":"@szetszwo It seems that the ci test of github is not stable enough, I can run UT locally.\r\n\r\n![image](https://user-images.githubusercontent.com/26144703/154644322-0d110ffb-1a14-4566-9a24-39e486f0ebc2.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044120032/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044124999","html_url":"https://github.com/apache/ratis/pull/598#issuecomment-1044124999","issue_url":"https://api.github.com/repos/apache/ratis/issues/598","id":1044124999,"node_id":"IC_kwDOBMxbGc4-PBVH","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-18T08:21:04Z","updated_at":"2022-02-18T08:21:04Z","author_association":"CONTRIBUTOR","body":"@codings-dan , please run it 100 times and see if it would fail.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044124999/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044130236","html_url":"https://github.com/apache/ratis/pull/598#issuecomment-1044130236","issue_url":"https://api.github.com/repos/apache/ratis/issues/598","id":1044130236,"node_id":"IC_kwDOBMxbGc4-PCm8","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-18T08:25:38Z","updated_at":"2022-02-18T08:25:38Z","author_association":"CONTRIBUTOR","body":"@codings-dan , actually, it is an old test but not the newly added test.  Let's see if we can reproduce the failure.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044130236/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044133661","html_url":"https://github.com/apache/ratis/pull/598#issuecomment-1044133661","issue_url":"https://api.github.com/repos/apache/ratis/issues/598","id":1044133661,"node_id":"IC_kwDOBMxbGc4-PDcd","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-18T08:28:47Z","updated_at":"2022-02-18T08:28:47Z","author_association":"CONTRIBUTOR","body":"> @codings-dan , actually, it is an old test but not the newly added test. Let's see if we can reproduce the failure.\r\n\r\nI will have a try.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044133661/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044146744","html_url":"https://github.com/apache/ratis/pull/598#issuecomment-1044146744","issue_url":"https://api.github.com/repos/apache/ratis/issues/598","id":1044146744,"node_id":"IC_kwDOBMxbGc4-PGo4","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-18T08:41:03Z","updated_at":"2022-02-18T08:43:40Z","author_association":"CONTRIBUTOR","body":"@szetszwo It seems that the stepdown leader related work may have bug, the previous problem did not reproduce, but a new problem appeared. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044146744/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044227151","html_url":"https://github.com/apache/ratis/pull/604#issuecomment-1044227151","issue_url":"https://api.github.com/repos/apache/ratis/issues/604","id":1044227151,"node_id":"IC_kwDOBMxbGc4-PaRP","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-18T09:42:02Z","updated_at":"2022-02-18T09:42:02Z","author_association":"CONTRIBUTOR","body":"@szetszwo Please take a look.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044227151/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044250710","html_url":"https://github.com/apache/ratis/pull/604#issuecomment-1044250710","issue_url":"https://api.github.com/repos/apache/ratis/issues/604","id":1044250710,"node_id":"IC_kwDOBMxbGc4-PgBW","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-18T09:57:49Z","updated_at":"2022-02-18T09:57:49Z","author_association":"CONTRIBUTOR","body":"@szetszwo Has been modified","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1044250710/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1046254323","html_url":"https://github.com/apache/ratis/pull/598#issuecomment-1046254323","issue_url":"https://api.github.com/repos/apache/ratis/issues/598","id":1046254323,"node_id":"IC_kwDOBMxbGc4-XJLz","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-20T14:49:38Z","updated_at":"2022-02-20T14:49:38Z","author_association":"CONTRIBUTOR","body":"> @szetszwo PTAL again. After this MR, we may complete the work according to this progress: Change the code related to RaftServerImpl to support starting in the form of Listener; Add ListenerState related code and modify LeaderStateImpl related code to support passing journals to Listener Do you have any suggestions for future work? Thanks!\r\n\r\n@szetszwo What do you think about the follow-up code development in this way? Can you give some suggestions? Thank you!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1046254323/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1046811836","html_url":"https://github.com/apache/ratis/pull/603#issuecomment-1046811836","issue_url":"https://api.github.com/repos/apache/ratis/issues/603","id":1046811836,"node_id":"IC_kwDOBMxbGc4-ZRS8","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-21T12:11:55Z","updated_at":"2022-02-21T12:11:55Z","author_association":"CONTRIBUTOR","body":"@szetszwo I did code splitting related to election command, PTAL, thx!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1046811836/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1046867967","html_url":"https://github.com/apache/ratis/pull/598#issuecomment-1046867967","issue_url":"https://api.github.com/repos/apache/ratis/issues/598","id":1046867967,"node_id":"IC_kwDOBMxbGc4-Ze__","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-21T13:15:05Z","updated_at":"2022-02-21T13:15:05Z","author_association":"CONTRIBUTOR","body":"@codings-dan , the next task could be removing the old APIs below and replacing them with the new API.\r\n```\r\n+++ b/ratis-server/src/main/java/org/apache/ratis/server/impl/PeerConfiguration.java\r\n@@ -63,10 +63,6 @@ class PeerConfiguration {\r\n     return Collections.unmodifiableMap(map);\r\n   }\r\n \r\n-  PeerConfiguration(Iterable<RaftPeer> peers) {\r\n-    this(peers, Collections.emptyList());\r\n-  }\r\n-\r\n   PeerConfiguration(Iterable<RaftPeer> peers, Iterable<RaftPeer> listeners) {\r\n     this.peers = newMap(peers, \"peers\", Collections.emptyMap());\r\n     this.listeners = newMap(listeners, \"listeners\", this.peers);\r\ndiff --git a/ratis-server/src/main/java/org/apache/ratis/server/impl/RaftConfigurationImpl.java b/ratis-server/src/main/java/org/apache/ratis/server/impl/RaftConfigurationImpl.java\r\nindex 4bab3650..b46a2fbd 100644\r\n--- a/ratis-server/src/main/java/org/apache/ratis/server/impl/RaftConfigurationImpl.java\r\n+++ b/ratis-server/src/main/java/org/apache/ratis/server/impl/RaftConfigurationImpl.java\r\n@@ -63,10 +63,6 @@ final class RaftConfigurationImpl implements RaftConfiguration {\r\n       return this;\r\n     }\r\n \r\n-    Builder setConf(Iterable<RaftPeer> peers) {\r\n-      return setConf(new PeerConfiguration(peers));\r\n-    }\r\n-\r\n     Builder setConf(Iterable<RaftPeer> peers, Iterable<RaftPeer> listeners) {\r\n       return setConf(new PeerConfiguration(peers, listeners));\r\n     }\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1046867967/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1046868511","html_url":"https://github.com/apache/ratis/pull/598#issuecomment-1046868511","issue_url":"https://api.github.com/repos/apache/ratis/issues/598","id":1046868511,"node_id":"IC_kwDOBMxbGc4-ZfIf","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-21T13:15:37Z","updated_at":"2022-02-21T13:15:37Z","author_association":"CONTRIBUTOR","body":"@codings-dan, we may also think about how to  change SetConfigurationRequest and LeaderStateImpl.startSetConfiguration to support listeners. ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1046868511/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1046947031","html_url":"https://github.com/apache/ratis/pull/603#issuecomment-1046947031","issue_url":"https://api.github.com/repos/apache/ratis/issues/603","id":1046947031,"node_id":"IC_kwDOBMxbGc4-ZyTX","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-21T14:38:08Z","updated_at":"2022-02-21T14:38:08Z","author_association":"CONTRIBUTOR","body":"```\r\n+++ b/ratis-shell/src/main/java/org/apache/ratis/shell/cli/sh/RatisShell.java\r\n@@ -72,9 +72,12 @@ public class RatisShell extends AbstractShell {\r\n       // Add commands from <pkgName>.command.*\r\n       if (cls.getPackage().getName().equals(pkgName + \".command\")\r\n           && !Modifier.isAbstract(cls.getModifiers())) {\r\n+        System.out.println(\"Found \" + cls);\r\n         // Only instantiate a concrete class\r\n         final Command cmd = ReflectionUtils.newInstance(cls, classArgs, objectArgs);\r\n         commandsMap.put(cmd.getCommandName(), cmd);\r\n+      } else {\r\n+        System.out.println(\"Ignored \" + cls);\r\n       }\r\n     }\r\n```\r\n@codings-dan , if we add the code above, the new subcommnads will be ignored.\r\n```\r\nIgnored class org.apache.ratis.shell.cli.sh.command.AbstractRatisCommand\r\nFound class org.apache.ratis.shell.cli.sh.command.PeerCommand\r\nFound class org.apache.ratis.shell.cli.sh.command.ElectionCommand\r\nIgnored class org.apache.ratis.shell.cli.sh.group.GroupListCommand\r\nFound class org.apache.ratis.shell.cli.sh.command.SetPriorityCommand\r\nIgnored class org.apache.ratis.shell.cli.sh.group.GroupInfoCommand\r\nIgnored class org.apache.ratis.shell.cli.sh.snapshot.TakeSnapshotCommand\r\nIgnored class org.apache.ratis.shell.cli.sh.election.PauseCommand\r\nFound class org.apache.ratis.shell.cli.sh.command.SnapshotCommand\r\nFound class org.apache.ratis.shell.cli.sh.command.GroupCommand\r\nIgnored class org.apache.ratis.shell.cli.sh.election.TransferCommand\r\nIgnored class org.apache.ratis.shell.cli.sh.election.ResumeCommand\r\nUsage: ratis sh [generic options]\r\n\t [election [resume] [transfer] [pause]]                    \r\n\t [group [list] [info]]                                     \r\n\t [peer -peers <PEER0_HOST:PEER0_PORT,PEER1_HOST:PEER1_PORT,PEER2_HOST:PEER2_PORT> [-groupid <RAFT_GROUP_ID>] -remove <PEER_HOST:PEER_PORT> -add <PEER_HOST:PEER_PORT>]\r\n\t [setPriority -peers <PEER0_HOST:PEER0_PORT,PEER1_HOST:PEER1_PORT,PEER2_HOST:PEER2_PORT> [-groupid <RAFT_GROUP_ID>] -addressPriority <PEER_HOST:PEER_PORT|PRIORITY>]\r\n\t [snapshot [create]]                                       \r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1046947031/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047354253","html_url":"https://github.com/apache/ratis/pull/603#issuecomment-1047354253","issue_url":"https://api.github.com/repos/apache/ratis/issues/603","id":1047354253,"node_id":"IC_kwDOBMxbGc4-bVuN","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-22T01:59:05Z","updated_at":"2022-02-22T01:59:05Z","author_association":"CONTRIBUTOR","body":"> ```\r\n> +++ b/ratis-shell/src/main/java/org/apache/ratis/shell/cli/sh/RatisShell.java\r\n> @@ -72,9 +72,12 @@ public class RatisShell extends AbstractShell {\r\n>        // Add commands from <pkgName>.command.*\r\n>        if (cls.getPackage().getName().equals(pkgName + \".command\")\r\n>            && !Modifier.isAbstract(cls.getModifiers())) {\r\n> +        System.out.println(\"Found \" + cls);\r\n>          // Only instantiate a concrete class\r\n>          final Command cmd = ReflectionUtils.newInstance(cls, classArgs, objectArgs);\r\n>          commandsMap.put(cmd.getCommandName(), cmd);\r\n> +      } else {\r\n> +        System.out.println(\"Ignored \" + cls);\r\n>        }\r\n>      }\r\n> ```\r\n> \r\n> @codings-dan , if we add the code above, the new subcommnads will be ignored.\r\n> \r\n> ```\r\n> Ignored class org.apache.ratis.shell.cli.sh.command.AbstractRatisCommand\r\n> Found class org.apache.ratis.shell.cli.sh.command.PeerCommand\r\n> Found class org.apache.ratis.shell.cli.sh.command.ElectionCommand\r\n> Ignored class org.apache.ratis.shell.cli.sh.group.GroupListCommand\r\n> Found class org.apache.ratis.shell.cli.sh.command.SetPriorityCommand\r\n> Ignored class org.apache.ratis.shell.cli.sh.group.GroupInfoCommand\r\n> Ignored class org.apache.ratis.shell.cli.sh.snapshot.TakeSnapshotCommand\r\n> Ignored class org.apache.ratis.shell.cli.sh.election.PauseCommand\r\n> Found class org.apache.ratis.shell.cli.sh.command.SnapshotCommand\r\n> Found class org.apache.ratis.shell.cli.sh.command.GroupCommand\r\n> Ignored class org.apache.ratis.shell.cli.sh.election.TransferCommand\r\n> Ignored class org.apache.ratis.shell.cli.sh.election.ResumeCommand\r\n> Usage: ratis sh [generic options]\r\n> \t [election [resume] [transfer] [pause]]                    \r\n> \t [group [list] [info]]                                     \r\n> \t [peer -peers <PEER0_HOST:PEER0_PORT,PEER1_HOST:PEER1_PORT,PEER2_HOST:PEER2_PORT> [-groupid <RAFT_GROUP_ID>] -remove <PEER_HOST:PEER_PORT> -add <PEER_HOST:PEER_PORT>]\r\n> \t [setPriority -peers <PEER0_HOST:PEER0_PORT,PEER1_HOST:PEER1_PORT,PEER2_HOST:PEER2_PORT> [-groupid <RAFT_GROUP_ID>] -addressPriority <PEER_HOST:PEER_PORT|PRIORITY>]\r\n> \t [snapshot [create]]                                       \r\n> ```\r\n\r\nDo you mean we add these lines of code and then display this information during compilation?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047354253/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047597602","html_url":"https://github.com/apache/ratis/pull/603#issuecomment-1047597602","issue_url":"https://api.github.com/repos/apache/ratis/issues/603","id":1047597602,"node_id":"IC_kwDOBMxbGc4-cRIi","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-22T09:33:20Z","updated_at":"2022-02-22T09:33:20Z","author_association":"CONTRIBUTOR","body":"> Do you mean we add these lines of code and then display this information during compilation?\r\n\r\n@codings-dan, The code lines are for printing debug messages.  Currently, the debug messages show that many of the command classes are ignored since they are not under the `org.apache.ratis.shell.cli.sh.command` package.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047597602/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047669741","html_url":"https://github.com/apache/ratis/pull/603#issuecomment-1047669741","issue_url":"https://api.github.com/repos/apache/ratis/issues/603","id":1047669741,"node_id":"IC_kwDOBMxbGc4-civt","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-22T10:52:23Z","updated_at":"2022-02-22T10:54:43Z","author_association":"CONTRIBUTOR","body":"@szetszwo  We don't need load classes outside the `org.apache.ratis.shell.cli.sh.command` package, they are all sub-commands, and their baseCommand are in the command package. BaseCommand maintains a map of the mapping relationship between sub-command name and sub-command. See `org.apache.ratis.shell.cli.AbstractShell.java#run`","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047669741/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047687370","html_url":"https://github.com/apache/ratis/pull/605#issuecomment-1047687370","issue_url":"https://api.github.com/repos/apache/ratis/issues/605","id":1047687370,"node_id":"IC_kwDOBMxbGc4-cnDK","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-22T11:12:49Z","updated_at":"2022-02-22T11:12:49Z","author_association":"CONTRIBUTOR","body":"@szetszwo Can you help take a look at this MR, this demo can easily start 3 ratis server applications in Intellij IDEA and debug them.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047687370/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047735266","html_url":"https://github.com/apache/ratis/pull/603#issuecomment-1047735266","issue_url":"https://api.github.com/repos/apache/ratis/issues/603","id":1047735266,"node_id":"IC_kwDOBMxbGc4-cyvi","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-22T12:13:48Z","updated_at":"2022-02-22T12:13:48Z","author_association":"CONTRIBUTOR","body":"@codings-dan , I see.  The print out is a little bit confusing.  Thanks for explaining it.\r\n\r\nI suggest that we move the setPriority command as a subcommand of the peer command and change the peer command with the following subcommands.\r\n- add\r\n- remove\r\n- setPriority\r\n\r\nSee if you are interested working on it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047735266/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047740004","html_url":"https://github.com/apache/ratis/pull/603#issuecomment-1047740004","issue_url":"https://api.github.com/repos/apache/ratis/issues/603","id":1047740004,"node_id":"IC_kwDOBMxbGc4-cz5k","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-22T12:19:52Z","updated_at":"2022-02-22T12:19:52Z","author_association":"CONTRIBUTOR","body":"> @codings-dan , I see. The print out is a little bit confusing. Thanks for explaining it.\r\n> \r\n> I suggest that we move the setPriority command as a subcommand of the peer command and change the peer command with the following subcommands.\r\n> \r\n> * add\r\n> * remove\r\n> * setPriority\r\n> \r\n> See if you are interested working on it.\r\n\r\nGood idea, since this change has nothing to do with this jira, I will complete the code change in the future.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047740004/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047766020","html_url":"https://github.com/apache/ratis/pull/605#issuecomment-1047766020","issue_url":"https://api.github.com/repos/apache/ratis/issues/605","id":1047766020,"node_id":"IC_kwDOBMxbGc4-c6QE","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-22T12:52:12Z","updated_at":"2022-02-22T12:52:12Z","author_association":"CONTRIBUTOR","body":"@codings-dan , sure.  Could you give some instructions for running the demo?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047766020/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047773813","html_url":"https://github.com/apache/ratis/pull/606#issuecomment-1047773813","issue_url":"https://api.github.com/repos/apache/ratis/issues/606","id":1047773813,"node_id":"IC_kwDOBMxbGc4-c8J1","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-22T13:01:50Z","updated_at":"2022-02-22T13:01:50Z","author_association":"CONTRIBUTOR","body":"@szetszwo What do you think of this change?\r\n\r\nUpdate the proxyMap when an exception occurs.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047773813/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047777075","html_url":"https://github.com/apache/ratis/pull/605#issuecomment-1047777075","issue_url":"https://api.github.com/repos/apache/ratis/issues/605","id":1047777075,"node_id":"IC_kwDOBMxbGc4-c88z","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-22T13:05:42Z","updated_at":"2022-02-22T13:08:29Z","author_association":"CONTRIBUTOR","body":"@szetszwo With this demo, We can run `dev-support/intellij/install-runconfig.sh`, then, in the `.idea/runConfigurations`, there will be 3 xml files related to ratis server generated, And we can select the server application and run it. See below.\r\n![image](https://user-images.githubusercontent.com/26144703/155138157-07fe3426-b7a6-4604-8c3f-1a1098accd46.png)\r\n\r\nThen, We can set breakpoints and debug it. BTW, If this demo is valuable, I will add corresponding docs to it later","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1047777075/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1048455004","html_url":"https://github.com/apache/ratis/pull/605#issuecomment-1048455004","issue_url":"https://api.github.com/repos/apache/ratis/issues/605","id":1048455004,"node_id":"IC_kwDOBMxbGc4-fidc","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T05:12:58Z","updated_at":"2022-02-23T05:12:58Z","author_association":"CONTRIBUTOR","body":"@codings-dan , I see the your point now.  Let's split this into two JIRAs:\r\n- example change\r\n- intelliJ change\r\n\r\nThanks.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1048455004/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1048505675","html_url":"https://github.com/apache/ratis/pull/605#issuecomment-1048505675","issue_url":"https://api.github.com/repos/apache/ratis/issues/605","id":1048505675,"node_id":"IC_kwDOBMxbGc4-fu1L","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T07:21:20Z","updated_at":"2022-02-23T07:21:20Z","author_association":"CONTRIBUTOR","body":"will do","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1048505675/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1048696739","html_url":"https://github.com/apache/ratis/pull/605#issuecomment-1048696739","issue_url":"https://api.github.com/repos/apache/ratis/issues/605","id":1048696739,"node_id":"IC_kwDOBMxbGc4-gdej","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T11:42:29Z","updated_at":"2022-02-23T11:42:29Z","author_association":"CONTRIBUTOR","body":"@szetszwo I remove intelliJ change related code, PTAL, thx!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1048696739/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1048752317","html_url":"https://github.com/apache/ratis/pull/603#issuecomment-1048752317","issue_url":"https://api.github.com/repos/apache/ratis/issues/603","id":1048752317,"node_id":"IC_kwDOBMxbGc4-grC9","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T12:53:50Z","updated_at":"2022-02-23T12:53:50Z","author_association":"CONTRIBUTOR","body":"> @codings-dan , I see. The print out is a little bit confusing. Thanks for explaining it.\r\n> \r\n> I suggest that we move the setPriority command as a subcommand of the peer command and change the peer command with the following subcommands.\r\n> \r\n> * add\r\n> * remove\r\n> * setPriority\r\n> \r\n> See if you are interested working on it.\r\n\r\n@szetszwo I have refactored the code, PTAL, thx!\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1048752317/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1048832769","html_url":"https://github.com/apache/ratis/pull/606#issuecomment-1048832769","issue_url":"https://api.github.com/repos/apache/ratis/issues/606","id":1048832769,"node_id":"IC_kwDOBMxbGc4-g-sB","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T14:23:26Z","updated_at":"2022-02-23T14:23:26Z","author_association":"CONTRIBUTOR","body":"It has been changed to Catch IOE. @szetszwo ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1048832769/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1048837921","html_url":"https://github.com/apache/ratis/pull/607#issuecomment-1048837921","issue_url":"https://api.github.com/repos/apache/ratis/issues/607","id":1048837921,"node_id":"IC_kwDOBMxbGc4-g_8h","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T14:28:26Z","updated_at":"2022-02-23T14:28:26Z","author_association":"CONTRIBUTOR","body":"I'm going to add metric, is that ok? @szetszwo Please look at this PR for me.  thanks.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1048837921/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1049492664","html_url":"https://github.com/apache/ratis/pull/609#issuecomment-1049492664","issue_url":"https://api.github.com/repos/apache/ratis/issues/609","id":1049492664,"node_id":"IC_kwDOBMxbGc4-jfy4","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-24T04:50:17Z","updated_at":"2022-02-24T04:50:17Z","author_association":"CONTRIBUTOR","body":"@szetszwo PTAL","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1049492664/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1049752421","html_url":"https://github.com/apache/ratis/pull/605#issuecomment-1049752421","issue_url":"https://api.github.com/repos/apache/ratis/issues/605","id":1049752421,"node_id":"IC_kwDOBMxbGc4-kfNl","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-24T11:15:21Z","updated_at":"2022-02-24T11:15:21Z","author_association":"CONTRIBUTOR","body":"@szetszwo PTAL, thx!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1049752421/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1050065609","html_url":"https://github.com/apache/ratis/pull/609#issuecomment-1050065609","issue_url":"https://api.github.com/repos/apache/ratis/issues/609","id":1050065609,"node_id":"IC_kwDOBMxbGc4-lrrJ","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-24T17:03:23Z","updated_at":"2022-02-24T17:03:23Z","author_association":"CONTRIBUTOR","body":"@OneSizeFitsQuorum , thanks again.\r\n\r\nPlease use the JRIA number and title for the commit message.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1050065609/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1050417997","html_url":"https://github.com/apache/ratis/pull/609#issuecomment-1050417997","issue_url":"https://api.github.com/repos/apache/ratis/issues/609","id":1050417997,"node_id":"IC_kwDOBMxbGc4-nBtN","user":{"login":"OneSizeFitsQuorum","id":32640567,"node_id":"MDQ6VXNlcjMyNjQwNTY3","avatar_url":"https://avatars.githubusercontent.com/u/32640567?v=4","gravatar_id":"","url":"https://api.github.com/users/OneSizeFitsQuorum","html_url":"https://github.com/OneSizeFitsQuorum","followers_url":"https://api.github.com/users/OneSizeFitsQuorum/followers","following_url":"https://api.github.com/users/OneSizeFitsQuorum/following{/other_user}","gists_url":"https://api.github.com/users/OneSizeFitsQuorum/gists{/gist_id}","starred_url":"https://api.github.com/users/OneSizeFitsQuorum/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/OneSizeFitsQuorum/subscriptions","organizations_url":"https://api.github.com/users/OneSizeFitsQuorum/orgs","repos_url":"https://api.github.com/users/OneSizeFitsQuorum/repos","events_url":"https://api.github.com/users/OneSizeFitsQuorum/events{/privacy}","received_events_url":"https://api.github.com/users/OneSizeFitsQuorum/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-25T01:10:03Z","updated_at":"2022-02-25T01:10:03Z","author_association":"CONTRIBUTOR","body":"> Please use the JRIA number and title for the commit message.\r\n\r\nI'll be careful next time.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1050417997/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1050688515","html_url":"https://github.com/apache/ratis/pull/607#issuecomment-1050688515","issue_url":"https://api.github.com/repos/apache/ratis/issues/607","id":1050688515,"node_id":"IC_kwDOBMxbGc4-oDwD","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-25T09:33:07Z","updated_at":"2022-02-25T09:33:07Z","author_association":"CONTRIBUTOR","body":"I test PROM effect on ozone Datanode:\r\n![image](https://user-images.githubusercontent.com/5122636/155691130-93e577ec-5e3d-4b1b-b01d-9df541b08ccc.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1050688515/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1050893287","html_url":"https://github.com/apache/ratis/pull/611#issuecomment-1050893287","issue_url":"https://api.github.com/repos/apache/ratis/issues/611","id":1050893287,"node_id":"IC_kwDOBMxbGc4-o1vn","user":{"login":"SincereXIA","id":20393870,"node_id":"MDQ6VXNlcjIwMzkzODcw","avatar_url":"https://avatars.githubusercontent.com/u/20393870?v=4","gravatar_id":"","url":"https://api.github.com/users/SincereXIA","html_url":"https://github.com/SincereXIA","followers_url":"https://api.github.com/users/SincereXIA/followers","following_url":"https://api.github.com/users/SincereXIA/following{/other_user}","gists_url":"https://api.github.com/users/SincereXIA/gists{/gist_id}","starred_url":"https://api.github.com/users/SincereXIA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SincereXIA/subscriptions","organizations_url":"https://api.github.com/users/SincereXIA/orgs","repos_url":"https://api.github.com/users/SincereXIA/repos","events_url":"https://api.github.com/users/SincereXIA/events{/privacy}","received_events_url":"https://api.github.com/users/SincereXIA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-25T14:20:31Z","updated_at":"2022-02-25T14:20:31Z","author_association":"CONTRIBUTOR","body":"Hi, @szetszwo,  Really appreciate your suggestion. my code looks much cleaner, thank you!\r\n\r\nIn addition to what you suggested, I added a line of code to the run loop to check if flush is required, which ensures that the previous logEntry can be flush in time when there are no subsequent tasks. Do you think this is ok?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1050893287/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1051447136","html_url":"https://github.com/apache/ratis/pull/600#issuecomment-1051447136","issue_url":"https://api.github.com/repos/apache/ratis/issues/600","id":1051447136,"node_id":"IC_kwDOBMxbGc4-q89g","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-26T01:57:22Z","updated_at":"2022-02-26T01:57:22Z","author_association":"CONTRIBUTOR","body":"After a period of testing, no significant performance improvement was found","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1051447136/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1051447835","html_url":"https://github.com/apache/ratis/pull/600#issuecomment-1051447835","issue_url":"https://api.github.com/repos/apache/ratis/issues/600","id":1051447835,"node_id":"IC_kwDOBMxbGc4-q9Ib","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-26T01:57:57Z","updated_at":"2022-02-26T01:57:57Z","author_association":"CONTRIBUTOR","body":"@szetszwo I close this PR","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1051447835/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1051608483","html_url":"https://github.com/apache/ratis/pull/600#issuecomment-1051608483","issue_url":"https://api.github.com/repos/apache/ratis/issues/600","id":1051608483,"node_id":"IC_kwDOBMxbGc4-rkWj","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-26T05:29:34Z","updated_at":"2022-02-26T05:29:34Z","author_association":"CONTRIBUTOR","body":"@guohao-rosicky , thanks for testing it.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1051608483/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1053928276","html_url":"https://github.com/apache/ratis/pull/607#issuecomment-1053928276","issue_url":"https://api.github.com/repos/apache/ratis/issues/607","id":1053928276,"node_id":"IC_kwDOBMxbGc4-0atU","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-28T06:19:05Z","updated_at":"2022-02-28T06:19:05Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks, review my pr.  I have apply your patch. \r\n\r\nI will improve more metric in another PR later, mostly about Netty.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1053928276/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1054123012","html_url":"https://github.com/apache/ratis/pull/612#issuecomment-1054123012","issue_url":"https://api.github.com/repos/apache/ratis/issues/612","id":1054123012,"node_id":"IC_kwDOBMxbGc4-1KQE","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-28T10:43:31Z","updated_at":"2022-02-28T10:43:31Z","author_association":"CONTRIBUTOR","body":"@szetszwo Can you help take a look at this MR, thx!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1054123012/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1054437465","html_url":"https://github.com/apache/ratis/pull/613#issuecomment-1054437465","issue_url":"https://api.github.com/repos/apache/ratis/issues/613","id":1054437465,"node_id":"IC_kwDOBMxbGc4-2XBZ","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-28T16:31:06Z","updated_at":"2022-02-28T16:31:06Z","author_association":"CONTRIBUTOR","body":"@adoroszlai , thanks a lot for testing this.  Just have reverted some changes in GrpcTlsConfig.  Could you take a look?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1054437465/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1054489900","html_url":"https://github.com/apache/ratis/pull/613#issuecomment-1054489900","issue_url":"https://api.github.com/repos/apache/ratis/issues/613","id":1054489900,"node_id":"IC_kwDOBMxbGc4-2j0s","user":{"login":"adoroszlai","id":6454655,"node_id":"MDQ6VXNlcjY0NTQ2NTU=","avatar_url":"https://avatars.githubusercontent.com/u/6454655?v=4","gravatar_id":"","url":"https://api.github.com/users/adoroszlai","html_url":"https://github.com/adoroszlai","followers_url":"https://api.github.com/users/adoroszlai/followers","following_url":"https://api.github.com/users/adoroszlai/following{/other_user}","gists_url":"https://api.github.com/users/adoroszlai/gists{/gist_id}","starred_url":"https://api.github.com/users/adoroszlai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adoroszlai/subscriptions","organizations_url":"https://api.github.com/users/adoroszlai/orgs","repos_url":"https://api.github.com/users/adoroszlai/repos","events_url":"https://api.github.com/users/adoroszlai/events{/privacy}","received_events_url":"https://api.github.com/users/adoroszlai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-28T17:26:32Z","updated_at":"2022-02-28T17:26:32Z","author_association":"CONTRIBUTOR","body":"> Just have reverted some changes in GrpcTlsConfig. Could you take a look?\r\n\r\nThanks @szetszwo, it works now.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1054489900/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1055311811","html_url":"https://github.com/apache/ratis/pull/613#issuecomment-1055311811","issue_url":"https://api.github.com/repos/apache/ratis/issues/613","id":1055311811,"node_id":"IC_kwDOBMxbGc4-5sfD","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-01T11:07:28Z","updated_at":"2022-03-01T11:07:28Z","author_association":"CONTRIBUTOR","body":"@adoroszlai , thanks a lot for reviewing this.  Just have pushed a new commit for addressing your comments.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1055311811/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1056859829","html_url":"https://github.com/apache/ratis/pull/614#issuecomment-1056859829","issue_url":"https://api.github.com/repos/apache/ratis/issues/614","id":1056859829,"node_id":"IC_kwDOBMxbGc4-_ma1","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-02T12:11:31Z","updated_at":"2022-03-02T12:11:52Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks for reviewing the code, I have chenge code according to the comment you left. PTAL ,thx!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1056859829/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1056860682","html_url":"https://github.com/apache/ratis/pull/614#issuecomment-1056860682","issue_url":"https://api.github.com/repos/apache/ratis/issues/614","id":1056860682,"node_id":"IC_kwDOBMxbGc4-_moK","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-02T12:12:33Z","updated_at":"2022-03-02T12:12:33Z","author_association":"CONTRIBUTOR","body":"> @codings-dan , let's focus on changing proto and AdminImpl here. See https://issues.apache.org/jira/secure/attachment/13040593/614_review.patch\r\n> \r\n> * We need to keep in mind that old peers can become a listener.  Similarly, old listeners can become a peer.\r\n> * We should not remove the old PeerConfiguration constructor since listeners are optional.\r\n\r\n@szetszwo Thanks for reminding me, I fell into a misunderstanding that listener and peer still maintain their original identities in new conf and will not convert to each other. So, before and after setConfiguration, they can be converted to each other, so what is the difference between learner and listener?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1056860682/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1056960826","html_url":"https://github.com/apache/ratis/pull/614#issuecomment-1056960826","issue_url":"https://api.github.com/repos/apache/ratis/issues/614","id":1056960826,"node_id":"IC_kwDOBMxbGc4-__E6","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-02T13:58:51Z","updated_at":"2022-03-02T13:58:51Z","author_association":"CONTRIBUTOR","body":"> ... so what is the difference between learner and listener?\r\n\r\nA Learner will automatically convert to a voting member when it catches up, but a Listener will never convert automatically.\r\n\r\nThen, why we do need Learners?  It is for starting many new servers at the same time.  For example, a group originally has 3 nodes and we want to change it to 11 nodes.  If we add all the new nodes as voting members, the leader suddenly cannot commit anymore transactions since it no longer can commit to the majority.  It has to wait for some of the new nodes catching up.\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1056960826/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1057579760","html_url":"https://github.com/apache/ratis/pull/614#issuecomment-1057579760","issue_url":"https://api.github.com/repos/apache/ratis/issues/614","id":1057579760,"node_id":"IC_kwDOBMxbGc4_CWLw","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-03T01:51:46Z","updated_at":"2022-03-03T01:51:46Z","author_association":"CONTRIBUTOR","body":"> > ... so what is the difference between learner and listener?\r\n> \r\n> A Learner will automatically convert to a voting member when it catches up, but a Listener will never convert automatically.\r\n> \r\n> Then, why we do need Learners? It is for starting many new servers at the same time. For example, a group originally has 3 nodes and we want to change it to 11 nodes. If we add all the new nodes as voting members, the leader suddenly cannot commit anymore transactions since it no longer can commit to the majority. It has to wait for some of the new nodes catching up.\r\n\r\nThanks for the explanation, I understand now.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1057579760/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1057856722","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1057856722","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1057856722,"node_id":"IC_kwDOBMxbGc4_DZzS","user":{"login":"SincereXIA","id":20393870,"node_id":"MDQ6VXNlcjIwMzkzODcw","avatar_url":"https://avatars.githubusercontent.com/u/20393870?v=4","gravatar_id":"","url":"https://api.github.com/users/SincereXIA","html_url":"https://github.com/SincereXIA","followers_url":"https://api.github.com/users/SincereXIA/followers","following_url":"https://api.github.com/users/SincereXIA/following{/other_user}","gists_url":"https://api.github.com/users/SincereXIA/gists{/gist_id}","starred_url":"https://api.github.com/users/SincereXIA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SincereXIA/subscriptions","organizations_url":"https://api.github.com/users/SincereXIA/orgs","repos_url":"https://api.github.com/users/SincereXIA/repos","events_url":"https://api.github.com/users/SincereXIA/events{/privacy}","received_events_url":"https://api.github.com/users/SincereXIA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-03T09:39:35Z","updated_at":"2022-03-03T09:39:35Z","author_association":"CONTRIBUTOR","body":"Hi @szetszwo,  this pr is related to https://github.com/apache/ratis/pull/611,  can you help review this?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1057856722/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1058117693","html_url":"https://github.com/apache/ratis/pull/617#issuecomment-1058117693","issue_url":"https://api.github.com/repos/apache/ratis/issues/617","id":1058117693,"node_id":"IC_kwDOBMxbGc4_EZg9","user":{"login":"captainzmc","id":13825159,"node_id":"MDQ6VXNlcjEzODI1MTU5","avatar_url":"https://avatars.githubusercontent.com/u/13825159?v=4","gravatar_id":"","url":"https://api.github.com/users/captainzmc","html_url":"https://github.com/captainzmc","followers_url":"https://api.github.com/users/captainzmc/followers","following_url":"https://api.github.com/users/captainzmc/following{/other_user}","gists_url":"https://api.github.com/users/captainzmc/gists{/gist_id}","starred_url":"https://api.github.com/users/captainzmc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/captainzmc/subscriptions","organizations_url":"https://api.github.com/users/captainzmc/orgs","repos_url":"https://api.github.com/users/captainzmc/repos","events_url":"https://api.github.com/users/captainzmc/events{/privacy}","received_events_url":"https://api.github.com/users/captainzmc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-03T14:49:23Z","updated_at":"2022-03-03T14:49:23Z","author_association":"MEMBER","body":"Thanks @szetszwo and @adoroszlai  for the suggestion.  Agree with you, lets improve TestRatisPipelineLeader to avoid this error.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1058117693/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1058829576","html_url":"https://github.com/apache/ratis/pull/615#issuecomment-1058829576","issue_url":"https://api.github.com/repos/apache/ratis/issues/615","id":1058829576,"node_id":"IC_kwDOBMxbGc4_HHUI","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-04T04:59:36Z","updated_at":"2022-03-04T04:59:36Z","author_association":"CONTRIBUTOR","body":"Tested similar changes in https://issues.apache.org/jira/browse/RATIS-1546.  It worked fine.  I will if we can add some unit tests in https://issues.apache.org/jira/browse/RATIS-1542 .","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1058829576/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1058988882","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1058988882","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1058988882,"node_id":"IC_kwDOBMxbGc4_HuNS","user":{"login":"SincereXIA","id":20393870,"node_id":"MDQ6VXNlcjIwMzkzODcw","avatar_url":"https://avatars.githubusercontent.com/u/20393870?v=4","gravatar_id":"","url":"https://api.github.com/users/SincereXIA","html_url":"https://github.com/SincereXIA","followers_url":"https://api.github.com/users/SincereXIA/followers","following_url":"https://api.github.com/users/SincereXIA/following{/other_user}","gists_url":"https://api.github.com/users/SincereXIA/gists{/gist_id}","starred_url":"https://api.github.com/users/SincereXIA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SincereXIA/subscriptions","organizations_url":"https://api.github.com/users/SincereXIA/orgs","repos_url":"https://api.github.com/users/SincereXIA/repos","events_url":"https://api.github.com/users/SincereXIA/events{/privacy}","received_events_url":"https://api.github.com/users/SincereXIA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-04T09:25:16Z","updated_at":"2022-03-04T09:25:16Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks for your attention to this issue, Our tests show that using the thread pool scheme to asynchronous flush has obvious performance improvement over synchronous flush, but a little worse performance than using a separate thread\r\n\r\n\r\n![image](https://user-images.githubusercontent.com/20393870/156735017-8a6d3d91-fac7-45f7-a57a-2768cd77080a.png)\r\n\r\n\r\nDo you think this is ok?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1058988882/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059031028","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1059031028","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1059031028,"node_id":"IC_kwDOBMxbGc4_H4f0","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-04T10:21:22Z","updated_at":"2022-03-04T10:21:22Z","author_association":"CONTRIBUTOR","body":"@SincereXIA , could you try also async flush with 3s flush interval?  It seems that ExecutorService and single thread are supposed to have the same performance.  Thanks.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059031028/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059143121","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1059143121","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1059143121,"node_id":"IC_kwDOBMxbGc4_IT3R","user":{"login":"SincereXIA","id":20393870,"node_id":"MDQ6VXNlcjIwMzkzODcw","avatar_url":"https://avatars.githubusercontent.com/u/20393870?v=4","gravatar_id":"","url":"https://api.github.com/users/SincereXIA","html_url":"https://github.com/SincereXIA","followers_url":"https://api.github.com/users/SincereXIA/followers","following_url":"https://api.github.com/users/SincereXIA/following{/other_user}","gists_url":"https://api.github.com/users/SincereXIA/gists{/gist_id}","starred_url":"https://api.github.com/users/SincereXIA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SincereXIA/subscriptions","organizations_url":"https://api.github.com/users/SincereXIA/orgs","repos_url":"https://api.github.com/users/SincereXIA/repos","events_url":"https://api.github.com/users/SincereXIA/events{/privacy}","received_events_url":"https://api.github.com/users/SincereXIA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-04T13:02:17Z","updated_at":"2022-03-04T13:03:01Z","author_association":"CONTRIBUTOR","body":"> @SincereXIA , could you try also async flush with 3s flush interval? It seems that ExecutorService and single thread are supposed to have the same performance. Thanks.\r\n\r\nHi @szetszwo , I tried increasing the interval between async flushes like this: https://github.com/SincereXIA/ratis/commit/118b2e5ec5339b2fb105c29e738c066644112d59\r\n\r\nand I repeated the test, but I couldn't find a difference in performance by use 3s flush interval. The average write time is almost the same as the last column in the table. \r\n\r\nI think maybe the time it takes to create the async task is causing the slight drop in performance.\r\n\r\nBy the way, is it a good idea to add a configurable flush interval? If yes, I can add it.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059143121/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059244053","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1059244053","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1059244053,"node_id":"IC_kwDOBMxbGc4_IsgV","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-04T15:08:05Z","updated_at":"2022-03-04T15:08:32Z","author_association":"CONTRIBUTOR","body":"> I tried increasing the interval between async flushes like this: https://github.com/SincereXIA/ratis/commit/118b2e5ec5339b2fb105c29e738c066644112d59\r\n\r\n@SincereXIA , It seems the sleep in https://github.com/SincereXIA/ratis/commit/118b2e5ec5339b2fb105c29e738c066644112d59  is the problem.\r\n\r\nCould you try https://issues.apache.org/jira/secure/attachment/13040724/616_asyncFlush.patch (applying to master) ?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059244053/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059247558","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1059247558","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1059247558,"node_id":"IC_kwDOBMxbGc4_ItXG","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-04T15:12:03Z","updated_at":"2022-03-04T15:12:03Z","author_association":"CONTRIBUTOR","body":"> By the way, is it a good idea to add a configurable flush interval? If yes, I can add it.\r\n\r\n@SincereXIA , We already have raft.server.log.flush.interval.min .  Do you mean adding another flush interval?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059247558/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059340901","html_url":"https://github.com/apache/ratis/pull/614#issuecomment-1059340901","issue_url":"https://api.github.com/repos/apache/ratis/issues/614","id":1059340901,"node_id":"IC_kwDOBMxbGc4_JEJl","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-04T17:00:01Z","updated_at":"2022-03-04T17:00:01Z","author_association":"CONTRIBUTOR","body":"@szetszwo Now that this pull request has been merged, I want to change the code related to LeaderStateImpl#startSetConfiguration in the next pull request, what do you think?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059340901/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059378190","html_url":"https://github.com/apache/ratis/pull/614#issuecomment-1059378190","issue_url":"https://api.github.com/repos/apache/ratis/issues/614","id":1059378190,"node_id":"IC_kwDOBMxbGc4_JNQO","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-04T17:39:16Z","updated_at":"2022-03-04T17:39:16Z","author_association":"CONTRIBUTOR","body":"@codings-dan , sure, thanks a lot!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059378190/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059641731","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1059641731","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1059641731,"node_id":"IC_kwDOBMxbGc4_KNmD","user":{"login":"SincereXIA","id":20393870,"node_id":"MDQ6VXNlcjIwMzkzODcw","avatar_url":"https://avatars.githubusercontent.com/u/20393870?v=4","gravatar_id":"","url":"https://api.github.com/users/SincereXIA","html_url":"https://github.com/SincereXIA","followers_url":"https://api.github.com/users/SincereXIA/followers","following_url":"https://api.github.com/users/SincereXIA/following{/other_user}","gists_url":"https://api.github.com/users/SincereXIA/gists{/gist_id}","starred_url":"https://api.github.com/users/SincereXIA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SincereXIA/subscriptions","organizations_url":"https://api.github.com/users/SincereXIA/orgs","repos_url":"https://api.github.com/users/SincereXIA/repos","events_url":"https://api.github.com/users/SincereXIA/events{/privacy}","received_events_url":"https://api.github.com/users/SincereXIA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-05T01:29:30Z","updated_at":"2022-03-05T01:29:30Z","author_association":"CONTRIBUTOR","body":"> > I tried increasing the interval between async flushes like this: [SincereXIA@118b2e5](https://github.com/SincereXIA/ratis/commit/118b2e5ec5339b2fb105c29e738c066644112d59)\r\n> \r\n> @SincereXIA , It seems the sleep in [SincereXIA@118b2e5](https://github.com/SincereXIA/ratis/commit/118b2e5ec5339b2fb105c29e738c066644112d59) is the problem.\r\n> \r\n> Could you try https://issues.apache.org/jira/secure/attachment/13040724/616_asyncFlush.patch (applying to master) ?\r\n\r\nHi @szetszwo ,   This commit: https://github.com/SincereXIA/ratis/commit/118b2e5ec5339b2fb105c29e738c066644112d59 is only in my test branch, and is not included in this pr. So I think the changes in this pr is same as this patch: https://issues.apache.org/jira/secure/attachment/13040724/616_asyncFlush.patch , and the test result is here: \r\n\r\n![image](https://user-images.githubusercontent.com/20393870/156861964-d1515d03-b13b-491d-8332-440107bdc5c6.png)\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059641731/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059888027","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1059888027","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1059888027,"node_id":"IC_kwDOBMxbGc4_LJub","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-06T03:36:35Z","updated_at":"2022-03-06T03:36:35Z","author_association":"CONTRIBUTOR","body":"@SincereXIA , we need to make sure that the flushIndex is updated only after flush has completed.  Here is the idea https://issues.apache.org/jira/secure/attachment/13040750/616_FlushWorker.patch .  Please see if you agree with the approach.  Thanks.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1059888027/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1060288959","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1060288959","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1060288959,"node_id":"IC_kwDOBMxbGc4_Mrm_","user":{"login":"SincereXIA","id":20393870,"node_id":"MDQ6VXNlcjIwMzkzODcw","avatar_url":"https://avatars.githubusercontent.com/u/20393870?v=4","gravatar_id":"","url":"https://api.github.com/users/SincereXIA","html_url":"https://github.com/SincereXIA","followers_url":"https://api.github.com/users/SincereXIA/followers","following_url":"https://api.github.com/users/SincereXIA/following{/other_user}","gists_url":"https://api.github.com/users/SincereXIA/gists{/gist_id}","starred_url":"https://api.github.com/users/SincereXIA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SincereXIA/subscriptions","organizations_url":"https://api.github.com/users/SincereXIA/orgs","repos_url":"https://api.github.com/users/SincereXIA/repos","events_url":"https://api.github.com/users/SincereXIA/events{/privacy}","received_events_url":"https://api.github.com/users/SincereXIA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-07T07:58:55Z","updated_at":"2022-03-07T08:39:47Z","author_association":"CONTRIBUTOR","body":"> @SincereXIA , we need to make sure that the flushIndex is updated only after flush has completed. Here is the idea https://issues.apache.org/jira/secure/attachment/13040750/616_FlushWorker.patch . Please see if you agree with the approach. Thanks.\r\n\r\nHi @szetszwo, Thank you. We tested this patch, but we found that calling `updateFlushedIndexIncreasingly()` after the flush cause \r\nratis performance is almost the same as synchronous flush. The RaftLog can't be committed until we call  `updateFlushedIndexIncreasingly()` . So, may work will still be blocked by the out.flush() call.\r\n\r\n![image](https://user-images.githubusercontent.com/20393870/156990731-2820ac55-734b-4dae-a3b5-8764a41711fd.png)\r\n\r\n \r\nCommitting the raft log before the flush is fully completed may indeed be a security issue. But I I want to know if we can add a switch to allow users to choose whether they can accept sacrificing a little security in exchange for higher performance. Thanks.\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1060288959/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1060452546","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1060452546","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1060452546,"node_id":"IC_kwDOBMxbGc4_NTjC","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-07T10:26:19Z","updated_at":"2022-03-07T10:26:19Z","author_association":"CONTRIBUTOR","body":"@SincereXIA , thanks a lot for testing it.\r\n\r\n> ... But I I want to know if we can add a switch ...\r\n\r\nYes, that's a good idea, especially for the groups with 3 or more nodes.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1060452546/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1060500184","html_url":"https://github.com/apache/ratis/pull/618#issuecomment-1060500184","issue_url":"https://api.github.com/repos/apache/ratis/issues/618","id":1060500184,"node_id":"IC_kwDOBMxbGc4_NfLY","user":{"login":"JacksonYao287","id":80438902,"node_id":"MDQ6VXNlcjgwNDM4OTAy","avatar_url":"https://avatars.githubusercontent.com/u/80438902?v=4","gravatar_id":"","url":"https://api.github.com/users/JacksonYao287","html_url":"https://github.com/JacksonYao287","followers_url":"https://api.github.com/users/JacksonYao287/followers","following_url":"https://api.github.com/users/JacksonYao287/following{/other_user}","gists_url":"https://api.github.com/users/JacksonYao287/gists{/gist_id}","starred_url":"https://api.github.com/users/JacksonYao287/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JacksonYao287/subscriptions","organizations_url":"https://api.github.com/users/JacksonYao287/orgs","repos_url":"https://api.github.com/users/JacksonYao287/repos","events_url":"https://api.github.com/users/JacksonYao287/events{/privacy}","received_events_url":"https://api.github.com/users/JacksonYao287/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-07T10:51:32Z","updated_at":"2022-03-07T10:51:32Z","author_association":"NONE","body":"thanks @szetszwo for the review !","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1060500184/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1060774230","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1060774230","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1060774230,"node_id":"IC_kwDOBMxbGc4_OiFW","user":{"login":"captainzmc","id":13825159,"node_id":"MDQ6VXNlcjEzODI1MTU5","avatar_url":"https://avatars.githubusercontent.com/u/13825159?v=4","gravatar_id":"","url":"https://api.github.com/users/captainzmc","html_url":"https://github.com/captainzmc","followers_url":"https://api.github.com/users/captainzmc/followers","following_url":"https://api.github.com/users/captainzmc/following{/other_user}","gists_url":"https://api.github.com/users/captainzmc/gists{/gist_id}","starred_url":"https://api.github.com/users/captainzmc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/captainzmc/subscriptions","organizations_url":"https://api.github.com/users/captainzmc/orgs","repos_url":"https://api.github.com/users/captainzmc/repos","events_url":"https://api.github.com/users/captainzmc/events{/privacy}","received_events_url":"https://api.github.com/users/captainzmc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-07T14:54:28Z","updated_at":"2022-03-07T14:54:28Z","author_association":"MEMBER","body":"> @SincereXIA , thanks a lot for testing it.\r\n> \r\n> > ... But I I want to know if we can add a switch ...\r\n> \r\n> Yes, that's a good idea, especially for the groups with 3 or more nodes.\r\n\r\n+1 For make this configurable. After all, in most cases, we have a three replication.  Async flush not only optimizes streaming, but also improves async write performance by more than 35% by we tested.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1060774230/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061477782","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1061477782","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1061477782,"node_id":"IC_kwDOBMxbGc4_RN2W","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T07:14:50Z","updated_at":"2022-03-08T07:14:50Z","author_association":"CONTRIBUTOR","body":"@SincereXIA , if we want to support unsafe-flush (i.e. increase flush index without waiting flush to complete), we don't need to use FlushWorker anymore since it is for safe-flush.  We should answer the following two questions:\r\n- Why async flush is slower then the single-thread flush?\r\n- Why async flush with current flushIntervalMin causing a bug?\r\n\r\nCould you test https://issues.apache.org/jira/secure/attachment/13040828/616_unsafeFlush.patch ?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061477782/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061496165","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1061496165","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1061496165,"node_id":"IC_kwDOBMxbGc4_RSVl","user":{"login":"kaijchen","id":5821159,"node_id":"MDQ6VXNlcjU4MjExNTk=","avatar_url":"https://avatars.githubusercontent.com/u/5821159?v=4","gravatar_id":"","url":"https://api.github.com/users/kaijchen","html_url":"https://github.com/kaijchen","followers_url":"https://api.github.com/users/kaijchen/followers","following_url":"https://api.github.com/users/kaijchen/following{/other_user}","gists_url":"https://api.github.com/users/kaijchen/gists{/gist_id}","starred_url":"https://api.github.com/users/kaijchen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaijchen/subscriptions","organizations_url":"https://api.github.com/users/kaijchen/orgs","repos_url":"https://api.github.com/users/kaijchen/repos","events_url":"https://api.github.com/users/kaijchen/events{/privacy}","received_events_url":"https://api.github.com/users/kaijchen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T07:45:17Z","updated_at":"2022-03-08T11:42:59Z","author_association":"CONTRIBUTOR","body":"> * Why async flush with current flushIntervalMin causing a bug?\r\n\r\n`flushIntervalMin` is actually max time to wait (for a full batch) before flush.\r\nIt will introduce latency while improve throughput.\r\nIf it is set to something like `3s`, each log can take `up to 3s` to be committed.\r\n\r\nIt's not a bug, but this value needs to be set carefully.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061496165/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061541975","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1061541975","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1061541975,"node_id":"IC_kwDOBMxbGc4_RdhX","user":{"login":"SincereXIA","id":20393870,"node_id":"MDQ6VXNlcjIwMzkzODcw","avatar_url":"https://avatars.githubusercontent.com/u/20393870?v=4","gravatar_id":"","url":"https://api.github.com/users/SincereXIA","html_url":"https://github.com/SincereXIA","followers_url":"https://api.github.com/users/SincereXIA/followers","following_url":"https://api.github.com/users/SincereXIA/following{/other_user}","gists_url":"https://api.github.com/users/SincereXIA/gists{/gist_id}","starred_url":"https://api.github.com/users/SincereXIA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SincereXIA/subscriptions","organizations_url":"https://api.github.com/users/SincereXIA/orgs","repos_url":"https://api.github.com/users/SincereXIA/repos","events_url":"https://api.github.com/users/SincereXIA/events{/privacy}","received_events_url":"https://api.github.com/users/SincereXIA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T08:48:23Z","updated_at":"2022-03-08T09:00:42Z","author_association":"CONTRIBUTOR","body":"Hi @szetszwo, Thanks for your opinion. I made a small change and tested your patch, and the result is here:\r\n\r\n![image](https://user-images.githubusercontent.com/20393870/157200066-6f105e4d-20ad-4ada-8e8e-426dba69c7b5.png)\r\n\r\nWhen unsafe flush + interval 3s is enabled, the average write performance of Ozone streaming is improved by 25%\r\n\r\n> Why async flush is slower then the single-thread flush?\r\n\r\nIn the first version I implemented, I pulled `out.flush()` off the main thread and executed it every fixed time interval in a separate thread.\r\nSo `out.flush()` was executed less than async flush. I guess that is the reason why async flush is a little slower.\r\n\r\n> Why async flush with current flushIntervalMin causing a bug?\r\n\r\nFor this question, @kaijchen is right. Exactly, it's not a bug. In the last pr, I didn't consider that extending the refresh interval will cause the log submission time to be extended. The performance did not meet our expectations. \r\n\r\nIn the current version, I use flushIntervalMin to control the flush interval of unsafe flush, which will not prolong the time that the log is finally committed.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061541975/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061562137","html_url":"https://github.com/apache/ratis/pull/615#issuecomment-1061562137","issue_url":"https://api.github.com/repos/apache/ratis/issues/615","id":1061562137,"node_id":"IC_kwDOBMxbGc4_RicZ","user":{"login":"lokeshj1703","id":9255455,"node_id":"MDQ6VXNlcjkyNTU0NTU=","avatar_url":"https://avatars.githubusercontent.com/u/9255455?v=4","gravatar_id":"","url":"https://api.github.com/users/lokeshj1703","html_url":"https://github.com/lokeshj1703","followers_url":"https://api.github.com/users/lokeshj1703/followers","following_url":"https://api.github.com/users/lokeshj1703/following{/other_user}","gists_url":"https://api.github.com/users/lokeshj1703/gists{/gist_id}","starred_url":"https://api.github.com/users/lokeshj1703/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lokeshj1703/subscriptions","organizations_url":"https://api.github.com/users/lokeshj1703/orgs","repos_url":"https://api.github.com/users/lokeshj1703/repos","events_url":"https://api.github.com/users/lokeshj1703/events{/privacy}","received_events_url":"https://api.github.com/users/lokeshj1703/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T09:12:37Z","updated_at":"2022-03-08T09:12:37Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks for the contribution! I have committed the PR to master branch.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061562137/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061639906","html_url":"https://github.com/apache/ratis/pull/615#issuecomment-1061639906","issue_url":"https://api.github.com/repos/apache/ratis/issues/615","id":1061639906,"node_id":"IC_kwDOBMxbGc4_R1bi","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T10:40:41Z","updated_at":"2022-03-08T10:40:41Z","author_association":"CONTRIBUTOR","body":"@lokeshj1703 , thanks for reviewing and merging this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061639906/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061650030","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1061650030","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1061650030,"node_id":"IC_kwDOBMxbGc4_R35u","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T10:53:48Z","updated_at":"2022-03-08T10:53:48Z","author_association":"CONTRIBUTOR","body":"> In the first version I implemented, I pulled out.flush() off the main thread and executed it every fixed time interval in a separate thread.\r\n\r\n@SincereXIA , do you think that the first version is better?  We should use it if it is the case.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061650030/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061667024","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1061667024","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1061667024,"node_id":"IC_kwDOBMxbGc4_R8DQ","user":{"login":"SincereXIA","id":20393870,"node_id":"MDQ6VXNlcjIwMzkzODcw","avatar_url":"https://avatars.githubusercontent.com/u/20393870?v=4","gravatar_id":"","url":"https://api.github.com/users/SincereXIA","html_url":"https://github.com/SincereXIA","followers_url":"https://api.github.com/users/SincereXIA/followers","following_url":"https://api.github.com/users/SincereXIA/following{/other_user}","gists_url":"https://api.github.com/users/SincereXIA/gists{/gist_id}","starred_url":"https://api.github.com/users/SincereXIA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SincereXIA/subscriptions","organizations_url":"https://api.github.com/users/SincereXIA/orgs","repos_url":"https://api.github.com/users/SincereXIA/repos","events_url":"https://api.github.com/users/SincereXIA/events{/privacy}","received_events_url":"https://api.github.com/users/SincereXIA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T11:13:29Z","updated_at":"2022-03-08T11:13:29Z","author_association":"CONTRIBUTOR","body":"> @SincereXIA , do you think that the first version is better? We should use it if it is the case.\r\n\r\n@szetszwo , I think this version now is better, In the first version, there will always be a thread that repeatedly does meaningless flush. And the performance of the previous version is tested without locking. It is not safe. After add lock at the `SegmentedRaftLogOutputStream`, the performance of the previous version may be not better than the current version.\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061667024/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061709022","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1061709022","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1061709022,"node_id":"IC_kwDOBMxbGc4_SGTe","user":{"login":"kaijchen","id":5821159,"node_id":"MDQ6VXNlcjU4MjExNTk=","avatar_url":"https://avatars.githubusercontent.com/u/5821159?v=4","gravatar_id":"","url":"https://api.github.com/users/kaijchen","html_url":"https://github.com/kaijchen","followers_url":"https://api.github.com/users/kaijchen/followers","following_url":"https://api.github.com/users/kaijchen/following{/other_user}","gists_url":"https://api.github.com/users/kaijchen/gists{/gist_id}","starred_url":"https://api.github.com/users/kaijchen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaijchen/subscriptions","organizations_url":"https://api.github.com/users/kaijchen/orgs","repos_url":"https://api.github.com/users/kaijchen/repos","events_url":"https://api.github.com/users/kaijchen/events{/privacy}","received_events_url":"https://api.github.com/users/kaijchen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T12:07:06Z","updated_at":"2022-03-08T12:07:06Z","author_association":"CONTRIBUTOR","body":"@szetszwo @SincereXIA, Actually, there **is** a bug in current master.\r\nWe need check the flush interval against first log pending to flush, not last flush.\r\n\r\nThe following patch demonstrates the fix on current master (a4ffad20dfcc3f61d723e835db9aac075286deb3).\r\n\r\n```java\r\ndiff --git a/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLogWorker.java b/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLogWorker.java\r\nindex 9e5eb7e1..b6e10a4c 100644\r\n--- a/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLogWorker.java\r\n+++ b/ratis-server/src/main/java/org/apache/ratis/server/raftlog/segmented/SegmentedRaftLogWorker.java\r\n@@ -177,6 +177,7 @@ class SegmentedRaftLogWorker {\r\n   private int flushBatchSize;\r\n \r\n   private Timestamp lastFlush;\r\n+  private Timestamp firstArrival;\r\n   private final TimeDuration flushIntervalMin;\r\n \r\n   private final StateMachineDataPolicy stateMachineDataPolicy;\r\n@@ -218,6 +219,7 @@ class SegmentedRaftLogWorker {\r\n     final int bufferSize = RaftServerConfigKeys.Log.writeBufferSize(properties).getSizeInt();\r\n     this.writeBuffer = ByteBuffer.allocateDirect(bufferSize);\r\n     this.lastFlush = Timestamp.currentTime();\r\n+    this.firstArrival = Timestamp.currentTime();\r\n     this.flushIntervalMin = RaftServerConfigKeys.Log.flushIntervalMin(properties);\r\n   }\r\n \r\n@@ -355,7 +357,10 @@ class SegmentedRaftLogWorker {\r\n     } else if (pendingFlushNum >= forceSyncNum) {\r\n       return true;\r\n     }\r\n-    return pendingFlushNum > 0 && queue.isEmpty() && lastFlush.elapsedTime().compareTo(flushIntervalMin) > 0;\r\n+    if (lastFlush.compareTo(firstArrival) >= 0) {\r\n+      firstArrival = Timestamp.currentTime();\r\n+    }\r\n+    return pendingFlushNum > 0 && queue.isEmpty() && firstArrival.elapsedTime().compareTo(flushIntervalMin) > 0;\r\n   }\r\n \r\n   @SuppressFBWarnings(\"NP_NULL_PARAM_DEREF\")\r\n-- \r\n2.27.0\r\n```","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061709022/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061720501","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1061720501","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1061720501,"node_id":"IC_kwDOBMxbGc4_SJG1","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-08T12:21:03Z","updated_at":"2022-03-08T12:21:03Z","author_association":"CONTRIBUTOR","body":"@SincereXIA , thanks for the update.\r\n\r\n> We found errors like this during testing: ...\r\n\r\nSince FileChannel is thread safe, let's call FileChannel.force(..) asynchronously so that we don't have to synchronize all the output stream calls; see https://issues.apache.org/jira/secure/attachment/13040845/616_asyncFileChannelForce.patch","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1061720501/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1062472448","html_url":"https://github.com/apache/ratis/pull/573#issuecomment-1062472448","issue_url":"https://api.github.com/repos/apache/ratis/issues/573","id":1062472448,"node_id":"IC_kwDOBMxbGc4_VAsA","user":{"login":"hanishakoneru","id":10237377,"node_id":"MDQ6VXNlcjEwMjM3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/10237377?v=4","gravatar_id":"","url":"https://api.github.com/users/hanishakoneru","html_url":"https://github.com/hanishakoneru","followers_url":"https://api.github.com/users/hanishakoneru/followers","following_url":"https://api.github.com/users/hanishakoneru/following{/other_user}","gists_url":"https://api.github.com/users/hanishakoneru/gists{/gist_id}","starred_url":"https://api.github.com/users/hanishakoneru/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hanishakoneru/subscriptions","organizations_url":"https://api.github.com/users/hanishakoneru/orgs","repos_url":"https://api.github.com/users/hanishakoneru/repos","events_url":"https://api.github.com/users/hanishakoneru/events{/privacy}","received_events_url":"https://api.github.com/users/hanishakoneru/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T01:51:10Z","updated_at":"2022-03-09T01:51:10Z","author_association":"CONTRIBUTOR","body":"@Xushaohong, please bear with me as I try to understand what is happening here and root causing the issue. \r\n\r\n> Actually, Leader will send an appendEntries request. It keeps send empty appendEntries requests to follower to keep in contact with follower as shouldNotifyToInstallSnapshot() is true as the below.\r\nHence The follower will send back INCONSISTENCY to the leader and the leader will updateNextIndex.\r\n\r\nWhat is the follower sends SNAPSHOT_INSTALLATION_IN_PROGRESS status instead of INCONSISTENCY status to the appendEntries request? IIUC, the issue is occurring because of this inconsistency reply to appendEntries request from Leader.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1062472448/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1062522977","html_url":"https://github.com/apache/ratis/pull/573#issuecomment-1062522977","issue_url":"https://api.github.com/repos/apache/ratis/issues/573","id":1062522977,"node_id":"IC_kwDOBMxbGc4_VNBh","user":{"login":"Xushaohong","id":10106574,"node_id":"MDQ6VXNlcjEwMTA2NTc0","avatar_url":"https://avatars.githubusercontent.com/u/10106574?v=4","gravatar_id":"","url":"https://api.github.com/users/Xushaohong","html_url":"https://github.com/Xushaohong","followers_url":"https://api.github.com/users/Xushaohong/followers","following_url":"https://api.github.com/users/Xushaohong/following{/other_user}","gists_url":"https://api.github.com/users/Xushaohong/gists{/gist_id}","starred_url":"https://api.github.com/users/Xushaohong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Xushaohong/subscriptions","organizations_url":"https://api.github.com/users/Xushaohong/orgs","repos_url":"https://api.github.com/users/Xushaohong/repos","events_url":"https://api.github.com/users/Xushaohong/events{/privacy}","received_events_url":"https://api.github.com/users/Xushaohong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T03:39:57Z","updated_at":"2022-03-11T02:59:54Z","author_association":"CONTRIBUTOR","body":"> What is the follower sends SNAPSHOT_INSTALLATION_IN_PROGRESS status instead of INCONSISTENCY status to the appendEntries request? \r\n\r\nSry, I do not get this since I have not modified the follower to send back this status.\r\n\r\n> IIUC, the issue is occurring because of this inconsistency reply to appendEntries request from Leader.\r\n\r\nYep, this is nearly the root cause. \r\n\r\nPrecondition:\r\nThere are two communicating threads between the leader and follower. One is to notify install snapshot, and the other is appendEntries thread(sending heartbeat and entries).\r\n\r\nThe statemachine installing snapshot(let's say thread A) and return progress of installing snapshot(lets say t thread B) are asynchronous. The update of the index(commit index and next index) is executed serially by thread A. \r\nIn practice, the statemachine installing snapshot takes increasing time to finish. The main thread (thread B) will respond `IN_PROGRESS` during the install, but once the install is done, the follower needs a new request to return  `SNAPSHOT_INSTALLED`, since the last request should have already replied IN_PROGRESS.\r\n\r\n\r\nIf we keep the non-blocking style to let the follower respond to the leader with its instant status, there are two problems.\r\n 1. Once the snapshot is done, the updated index could be reached first by appendentries thread(lets say thread C), and C will return the updated nextIndex to the leader. The leader hence will misunderstand the status of the follower and not send the notification. The follower needs the new notification to send back SNAPSHOT_INSTALLED. The consequence is that thread B will get stuck, and thread C will wait for B done and always return INCONSISTENCY to the leader.\r\n\t\r\nMy solution: let update of index be executed by the main thread B, so the follower can ensure to send out the SNAPSHOT_INSTALLED after update of index.\r\n\r\n2. Currently, appendentries thread C return the `state.getNextIndex()` when snapshot installation in progress.  The nextIndex is calculated by Math.max(logNextIndex, snapshotNextIndex). Here snapshotNextIndex is got through server.getStateMachine().getLatestSnapshot(). We should return the index updated by main thread(thread B) instead of statemachines.\r\n\r\nMy solution: replace `snapshotNextIndex = getSnapshotIndex() + 1;` with `snapshotNextIndex = log.getSnapshotIndex() + 1;`\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1062522977/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1062524549","html_url":"https://github.com/apache/ratis/pull/573#issuecomment-1062524549","issue_url":"https://api.github.com/repos/apache/ratis/issues/573","id":1062524549,"node_id":"IC_kwDOBMxbGc4_VNaF","user":{"login":"Xushaohong","id":10106574,"node_id":"MDQ6VXNlcjEwMTA2NTc0","avatar_url":"https://avatars.githubusercontent.com/u/10106574?v=4","gravatar_id":"","url":"https://api.github.com/users/Xushaohong","html_url":"https://github.com/Xushaohong","followers_url":"https://api.github.com/users/Xushaohong/followers","following_url":"https://api.github.com/users/Xushaohong/following{/other_user}","gists_url":"https://api.github.com/users/Xushaohong/gists{/gist_id}","starred_url":"https://api.github.com/users/Xushaohong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Xushaohong/subscriptions","organizations_url":"https://api.github.com/users/Xushaohong/orgs","repos_url":"https://api.github.com/users/Xushaohong/repos","events_url":"https://api.github.com/users/Xushaohong/events{/privacy}","received_events_url":"https://api.github.com/users/Xushaohong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T03:43:48Z","updated_at":"2022-03-09T03:43:48Z","author_association":"CONTRIBUTOR","body":"![install_snapshot drawio](https://user-images.githubusercontent.com/10106574/157368618-f3b30de4-1f9e-4d1e-a925-c09b5ee2ecab.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1062524549/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1062524876","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1062524876","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1062524876,"node_id":"IC_kwDOBMxbGc4_VNfM","user":{"login":"SincereXIA","id":20393870,"node_id":"MDQ6VXNlcjIwMzkzODcw","avatar_url":"https://avatars.githubusercontent.com/u/20393870?v=4","gravatar_id":"","url":"https://api.github.com/users/SincereXIA","html_url":"https://github.com/SincereXIA","followers_url":"https://api.github.com/users/SincereXIA/followers","following_url":"https://api.github.com/users/SincereXIA/following{/other_user}","gists_url":"https://api.github.com/users/SincereXIA/gists{/gist_id}","starred_url":"https://api.github.com/users/SincereXIA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SincereXIA/subscriptions","organizations_url":"https://api.github.com/users/SincereXIA/orgs","repos_url":"https://api.github.com/users/SincereXIA/repos","events_url":"https://api.github.com/users/SincereXIA/events{/privacy}","received_events_url":"https://api.github.com/users/SincereXIA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T03:44:31Z","updated_at":"2022-03-09T03:44:31Z","author_association":"CONTRIBUTOR","body":"> Since FileChannel is thread safe, let's call FileChannel.force(..) asynchronously so that we don't have to synchronize all the output stream calls; see https://issues.apache.org/jira/secure/attachment/13040845/616_asyncFileChannelForce.patch\r\n\r\n@szetszwo , Thanks for your opinion. We tested the performance of this patch:\r\n\r\n![image](https://user-images.githubusercontent.com/20393870/157368650-63a25a0e-5d5b-4df2-a43c-dc99189c8bb8.png)\r\n\r\n\r\nDirect call `FileChannel.force(..)` does have better performance than synchronize all the output stream calls.\r\n\r\nBut we find a issue, sleep at here is useless. Because this will block the main thread and will not reduce the total number of flushes. So I removed `flushIntervalMin` for now.\r\n\r\n![image](https://user-images.githubusercontent.com/20393870/157367808-01217f80-b84b-46f1-93d5-31e796adc7db.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1062524876/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1062539537","html_url":"https://github.com/apache/ratis/pull/620#issuecomment-1062539537","issue_url":"https://api.github.com/repos/apache/ratis/issues/620","id":1062539537,"node_id":"IC_kwDOBMxbGc4_VRER","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T04:20:36Z","updated_at":"2022-03-09T04:20:36Z","author_association":"CONTRIBUTOR","body":"What do you think of this feature? @szetszwo ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1062539537/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1062559448","html_url":"https://github.com/apache/ratis/pull/616#issuecomment-1062559448","issue_url":"https://api.github.com/repos/apache/ratis/issues/616","id":1062559448,"node_id":"IC_kwDOBMxbGc4_VV7Y","user":{"login":"SincereXIA","id":20393870,"node_id":"MDQ6VXNlcjIwMzkzODcw","avatar_url":"https://avatars.githubusercontent.com/u/20393870?v=4","gravatar_id":"","url":"https://api.github.com/users/SincereXIA","html_url":"https://github.com/SincereXIA","followers_url":"https://api.github.com/users/SincereXIA/followers","following_url":"https://api.github.com/users/SincereXIA/following{/other_user}","gists_url":"https://api.github.com/users/SincereXIA/gists{/gist_id}","starred_url":"https://api.github.com/users/SincereXIA/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SincereXIA/subscriptions","organizations_url":"https://api.github.com/users/SincereXIA/orgs","repos_url":"https://api.github.com/users/SincereXIA/repos","events_url":"https://api.github.com/users/SincereXIA/events{/privacy}","received_events_url":"https://api.github.com/users/SincereXIA/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T05:08:50Z","updated_at":"2022-03-09T05:08:50Z","author_association":"CONTRIBUTOR","body":"> +1 the change looks good.\r\n> \r\n> @SincereXIA , let's merge this version? Or, would you like to test it more?\r\n\r\n@szetszwo, I have tested it, it looks ok. I think this version is ready for merge. Thank you.\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1062559448/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1062626001","html_url":"https://github.com/apache/ratis/pull/620#issuecomment-1062626001","issue_url":"https://api.github.com/repos/apache/ratis/issues/620","id":1062626001,"node_id":"IC_kwDOBMxbGc4_VmLR","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-09T07:24:11Z","updated_at":"2022-03-09T07:32:41Z","author_association":"CONTRIBUTOR","body":"1. Ctx.writeAndFlush() actually puts the request into the socket buffer. It just returns a Future object, and we need to add a listener to get its status\r\n2. If channel inactive, we will fail to send with the current channel, so we need to trigger reconnection\r\n3. When connect to server, we add a listener to get the state of the connection","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1062626001/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1063699673","html_url":"https://github.com/apache/ratis/pull/621#issuecomment-1063699673","issue_url":"https://api.github.com/repos/apache/ratis/issues/621","id":1063699673,"node_id":"IC_kwDOBMxbGc4_ZsTZ","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T06:11:13Z","updated_at":"2022-03-10T06:11:13Z","author_association":"CONTRIBUTOR","body":"What do you think of this feature? @szetszwo","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1063699673/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1064137764","html_url":"https://github.com/apache/ratis/pull/620#issuecomment-1064137764","issue_url":"https://api.github.com/repos/apache/ratis/issues/620","id":1064137764,"node_id":"IC_kwDOBMxbGc4_bXQk","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T14:43:46Z","updated_at":"2022-03-10T14:43:46Z","author_association":"CONTRIBUTOR","body":"@guohao-rosicky , please add some tests.  We cannot easily tell if the change is working.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1064137764/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1064146736","html_url":"https://github.com/apache/ratis/pull/621#issuecomment-1064146736","issue_url":"https://api.github.com/repos/apache/ratis/issues/621","id":1064146736,"node_id":"IC_kwDOBMxbGc4_bZcw","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-10T14:52:40Z","updated_at":"2022-03-10T14:52:40Z","author_association":"CONTRIBUTOR","body":"@guohao-rosicky , it seems that we won't get much benefit when optimizing the case when the queue is empty (i.e. when there are no requests.)\r\n\r\nAlso, running tasks in the background actually may make the worst case (when there are many requests) more worst.  What do you think?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1064146736/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1064662748","html_url":"https://github.com/apache/ratis/pull/573#issuecomment-1064662748","issue_url":"https://api.github.com/repos/apache/ratis/issues/573","id":1064662748,"node_id":"IC_kwDOBMxbGc4_dXbc","user":{"login":"hanishakoneru","id":10237377,"node_id":"MDQ6VXNlcjEwMjM3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/10237377?v=4","gravatar_id":"","url":"https://api.github.com/users/hanishakoneru","html_url":"https://github.com/hanishakoneru","followers_url":"https://api.github.com/users/hanishakoneru/followers","following_url":"https://api.github.com/users/hanishakoneru/following{/other_user}","gists_url":"https://api.github.com/users/hanishakoneru/gists{/gist_id}","starred_url":"https://api.github.com/users/hanishakoneru/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hanishakoneru/subscriptions","organizations_url":"https://api.github.com/users/hanishakoneru/orgs","repos_url":"https://api.github.com/users/hanishakoneru/repos","events_url":"https://api.github.com/users/hanishakoneru/events{/privacy}","received_events_url":"https://api.github.com/users/hanishakoneru/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T00:53:58Z","updated_at":"2022-03-11T00:53:58Z","author_association":"CONTRIBUTOR","body":"Thanks @Xushaohong for the detailed explanation. Appreciate it.\r\n\r\nI understand the problem now and your change makes sense to me. The overall logic LGTM. I will take closer look at it tomorrow. Can you please check the CI failures if they are related. Thanks.\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1064662748/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1064754317","html_url":"https://github.com/apache/ratis/pull/620#issuecomment-1064754317","issue_url":"https://api.github.com/repos/apache/ratis/issues/620","id":1064754317,"node_id":"IC_kwDOBMxbGc4_dtyN","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T04:12:55Z","updated_at":"2022-03-11T04:12:55Z","author_association":"CONTRIBUTOR","body":"@captainzmc  can you  talk about the test results of this patch?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1064754317/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1064953507","html_url":"https://github.com/apache/ratis/pull/620#issuecomment-1064953507","issue_url":"https://api.github.com/repos/apache/ratis/issues/620","id":1064953507,"node_id":"IC_kwDOBMxbGc4_eeaj","user":{"login":"captainzmc","id":13825159,"node_id":"MDQ6VXNlcjEzODI1MTU5","avatar_url":"https://avatars.githubusercontent.com/u/13825159?v=4","gravatar_id":"","url":"https://api.github.com/users/captainzmc","html_url":"https://github.com/captainzmc","followers_url":"https://api.github.com/users/captainzmc/followers","following_url":"https://api.github.com/users/captainzmc/following{/other_user}","gists_url":"https://api.github.com/users/captainzmc/gists{/gist_id}","starred_url":"https://api.github.com/users/captainzmc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/captainzmc/subscriptions","organizations_url":"https://api.github.com/users/captainzmc/orgs","repos_url":"https://api.github.com/users/captainzmc/repos","events_url":"https://api.github.com/users/captainzmc/events{/privacy}","received_events_url":"https://api.github.com/users/captainzmc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-11T09:55:04Z","updated_at":"2022-03-11T09:55:04Z","author_association":"MEMBER","body":"Thanks @guohao-rosicky  update this. I did a comparative test and found that this patch can indeed optimize the problem of client hung.  While testing three clients to write 400 files concurrently, ratis master hung every time, but RATIS-1549 runs normally.\r\n![image](https://user-images.githubusercontent.com/13825159/157841596-fda8285c-feae-4245-90f0-247b283f8a9e.png)\r\n\r\nHi @szetszwo, In UT it is difficult to simulate a broken connection during write. Can we continue to discuss this patch based on the above test results?\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1064953507/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1066037981","html_url":"https://github.com/apache/ratis/pull/620#issuecomment-1066037981","issue_url":"https://api.github.com/repos/apache/ratis/issues/620","id":1066037981,"node_id":"IC_kwDOBMxbGc4_inLd","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-13T06:43:08Z","updated_at":"2022-03-13T06:43:08Z","author_association":"CONTRIBUTOR","body":"@captainzmc , @guohao-rosicky , thanks for testing it manually.  I will review this change first.  Let me think about how to add a unit test.  ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1066037981/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1066055079","html_url":"https://github.com/apache/ratis/pull/620#issuecomment-1066055079","issue_url":"https://api.github.com/repos/apache/ratis/issues/620","id":1066055079,"node_id":"IC_kwDOBMxbGc4_irWn","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-13T08:51:19Z","updated_at":"2022-03-13T08:51:19Z","author_association":"CONTRIBUTOR","body":"@guohao-rosicky , I suggest to refactor the connection related code to a class; see https://issues.apache.org/jira/secure/attachment/13041023/620_review.patch","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1066055079/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1066560612","html_url":"https://github.com/apache/ratis/pull/620#issuecomment-1066560612","issue_url":"https://api.github.com/repos/apache/ratis/issues/620","id":1066560612,"node_id":"IC_kwDOBMxbGc4_kmxk","user":{"login":"guohao-rosicky","id":5122636,"node_id":"MDQ6VXNlcjUxMjI2MzY=","avatar_url":"https://avatars.githubusercontent.com/u/5122636?v=4","gravatar_id":"","url":"https://api.github.com/users/guohao-rosicky","html_url":"https://github.com/guohao-rosicky","followers_url":"https://api.github.com/users/guohao-rosicky/followers","following_url":"https://api.github.com/users/guohao-rosicky/following{/other_user}","gists_url":"https://api.github.com/users/guohao-rosicky/gists{/gist_id}","starred_url":"https://api.github.com/users/guohao-rosicky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guohao-rosicky/subscriptions","organizations_url":"https://api.github.com/users/guohao-rosicky/orgs","repos_url":"https://api.github.com/users/guohao-rosicky/repos","events_url":"https://api.github.com/users/guohao-rosicky/events{/privacy}","received_events_url":"https://api.github.com/users/guohao-rosicky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-14T09:29:49Z","updated_at":"2022-03-14T09:29:49Z","author_association":"CONTRIBUTOR","body":"@szetszwo  I have applied your patch","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1066560612/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1066788841","html_url":"https://github.com/apache/ratis/pull/622#issuecomment-1066788841","issue_url":"https://api.github.com/repos/apache/ratis/issues/622","id":1066788841,"node_id":"IC_kwDOBMxbGc4_lefp","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-14T13:31:01Z","updated_at":"2022-03-14T13:31:01Z","author_association":"CONTRIBUTOR","body":"@codings-dan , It seems that we don't need a different LogAppender for Listeners since LogAppender just send raft log to the other side.  So how about we keep using FollowerInfo for Listeners?  We may change the interface name to PeerInfo later on.\r\n\r\nIn LeaderStateImpl, there are senders and voterLists.\r\n- senders could include both Followers and Listeners.\r\n- voterLists only includes Followers.\r\n\r\nWhat do you think?","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1066788841/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1066887380","html_url":"https://github.com/apache/ratis/pull/622#issuecomment-1066887380","issue_url":"https://api.github.com/repos/apache/ratis/issues/622","id":1066887380,"node_id":"IC_kwDOBMxbGc4_l2jU","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-14T14:43:41Z","updated_at":"2022-03-14T14:43:41Z","author_association":"CONTRIBUTOR","body":"@szetszwo It is a good idea to reuse the FollowerInfo interface. If reused, I think we need to add corresponding methods to distinguish Listener and follower.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1066887380/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1066906369","html_url":"https://github.com/apache/ratis/pull/622#issuecomment-1066906369","issue_url":"https://api.github.com/repos/apache/ratis/issues/622","id":1066906369,"node_id":"IC_kwDOBMxbGc4_l7MB","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-14T14:58:55Z","updated_at":"2022-03-14T14:58:55Z","author_association":"CONTRIBUTOR","body":"> ...  add corresponding methods to distinguish Listener and follower.\r\n\r\n@codings-dan , maybe.  The role info (Listener or Follower) should comes from RaftConfiguration.  We are currently passing a RaftConfiguration to divdeFollowers(..) in LeaderStateImpl in order to get voterLists.  I wonder if it is already good enough, i.e. we can use voterLists to distinguish Listener and Follower.  We use voterLists for calculating majority; see getMajorityMin(..).","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1066906369/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1069045729","html_url":"https://github.com/apache/ratis/pull/619#issuecomment-1069045729","issue_url":"https://api.github.com/repos/apache/ratis/issues/619","id":1069045729,"node_id":"IC_kwDOBMxbGc4_uFfh","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-16T11:55:16Z","updated_at":"2022-03-16T11:55:16Z","author_association":"CONTRIBUTOR","body":"@lokeshj1703 , thanks a lot for reviewing this.\r\n\r\n> What is the purpose of generate.sh file?\r\n\r\nIt is to show how to generate the keys and certs.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1069045729/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1069420084","html_url":"https://github.com/apache/ratis/pull/617#issuecomment-1069420084","issue_url":"https://api.github.com/repos/apache/ratis/issues/617","id":1069420084,"node_id":"IC_kwDOBMxbGc4_vg40","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-16T18:26:05Z","updated_at":"2022-03-16T18:26:05Z","author_association":"CONTRIBUTOR","body":"@captainzmc , filed https://issues.apache.org/jira/browse/HDDS-6461 for updating Ratis snapshot version including fixing TestRatisPipelineLeader; see https://github.com/apache/ozone/pull/3205","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1069420084/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1070228726","html_url":"https://github.com/apache/ratis/pull/623#issuecomment-1070228726","issue_url":"https://api.github.com/repos/apache/ratis/issues/623","id":1070228726,"node_id":"IC_kwDOBMxbGc4_ymT2","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-17T03:34:18Z","updated_at":"2022-03-17T03:34:18Z","author_association":"CONTRIBUTOR","body":"@adoroszlai , thanks a lot for reviewing this!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1070228726/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1070816876","html_url":"https://github.com/apache/ratis/pull/622#issuecomment-1070816876","issue_url":"https://api.github.com/repos/apache/ratis/issues/622","id":1070816876,"node_id":"IC_kwDOBMxbGc4_015s","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-17T11:31:17Z","updated_at":"2022-03-17T11:32:17Z","author_association":"CONTRIBUTOR","body":"@szetszwo Thanks for helping change the code, the introduction of this variable really reduces a lot of redundant code! I have changed the code, PTAL again, thx!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1070816876/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1070932479","html_url":"https://github.com/apache/ratis/pull/622#issuecomment-1070932479","issue_url":"https://api.github.com/repos/apache/ratis/issues/622","id":1070932479,"node_id":"IC_kwDOBMxbGc4_1SH_","user":{"login":"codings-dan","id":26144703,"node_id":"MDQ6VXNlcjI2MTQ0NzAz","avatar_url":"https://avatars.githubusercontent.com/u/26144703?v=4","gravatar_id":"","url":"https://api.github.com/users/codings-dan","html_url":"https://github.com/codings-dan","followers_url":"https://api.github.com/users/codings-dan/followers","following_url":"https://api.github.com/users/codings-dan/following{/other_user}","gists_url":"https://api.github.com/users/codings-dan/gists{/gist_id}","starred_url":"https://api.github.com/users/codings-dan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/codings-dan/subscriptions","organizations_url":"https://api.github.com/users/codings-dan/orgs","repos_url":"https://api.github.com/users/codings-dan/repos","events_url":"https://api.github.com/users/codings-dan/events{/privacy}","received_events_url":"https://api.github.com/users/codings-dan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-17T13:34:42Z","updated_at":"2022-03-17T13:34:42Z","author_association":"CONTRIBUTOR","body":"@szetszwo Now that the `SetConfiguration` part has been developed, can we reuse the code of `FollowerInfo` and `FollowerState` in the next step to support Listener, so that the related code of listener is completed.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1070932479/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1071945785","html_url":"https://github.com/apache/ratis/pull/625#issuecomment-1071945785","issue_url":"https://api.github.com/repos/apache/ratis/issues/625","id":1071945785,"node_id":"IC_kwDOBMxbGc4_5Jg5","user":{"login":"szetszwo","id":907380,"node_id":"MDQ6VXNlcjkwNzM4MA==","avatar_url":"https://avatars.githubusercontent.com/u/907380?v=4","gravatar_id":"","url":"https://api.github.com/users/szetszwo","html_url":"https://github.com/szetszwo","followers_url":"https://api.github.com/users/szetszwo/followers","following_url":"https://api.github.com/users/szetszwo/following{/other_user}","gists_url":"https://api.github.com/users/szetszwo/gists{/gist_id}","starred_url":"https://api.github.com/users/szetszwo/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szetszwo/subscriptions","organizations_url":"https://api.github.com/users/szetszwo/orgs","repos_url":"https://api.github.com/users/szetszwo/repos","events_url":"https://api.github.com/users/szetszwo/events{/privacy}","received_events_url":"https://api.github.com/users/szetszwo/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-18T01:58:47Z","updated_at":"2022-03-18T01:58:47Z","author_association":"CONTRIBUTOR","body":"@kaijchen , thanks for the suggestion.\r\n\r\nLet's do not enable AvoidStarImport.  Let's spend more time on the code but not on the imports.  I really appreciate your effort!","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1071945785/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1071948522","html_url":"https://github.com/apache/ratis/pull/625#issuecomment-1071948522","issue_url":"https://api.github.com/repos/apache/ratis/issues/625","id":1071948522,"node_id":"IC_kwDOBMxbGc4_5KLq","user":{"login":"kaijchen","id":5821159,"node_id":"MDQ6VXNlcjU4MjExNTk=","avatar_url":"https://avatars.githubusercontent.com/u/5821159?v=4","gravatar_id":"","url":"https://api.github.com/users/kaijchen","html_url":"https://github.com/kaijchen","followers_url":"https://api.github.com/users/kaijchen/followers","following_url":"https://api.github.com/users/kaijchen/following{/other_user}","gists_url":"https://api.github.com/users/kaijchen/gists{/gist_id}","starred_url":"https://api.github.com/users/kaijchen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kaijchen/subscriptions","organizations_url":"https://api.github.com/users/kaijchen/orgs","repos_url":"https://api.github.com/users/kaijchen/repos","events_url":"https://api.github.com/users/kaijchen/events{/privacy}","received_events_url":"https://api.github.com/users/kaijchen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-18T02:04:10Z","updated_at":"2022-03-18T02:04:10Z","author_association":"CONTRIBUTOR","body":"> Let's do not enable AvoidStarImport. Let's spend more time on the code but not on the imports. I really appreciate your effort!\r\n\r\nSure.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1071948522/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1072960157","html_url":"https://github.com/apache/ratis/pull/573#issuecomment-1072960157","issue_url":"https://api.github.com/repos/apache/ratis/issues/573","id":1072960157,"node_id":"IC_kwDOBMxbGc4_9BKd","user":{"login":"Xushaohong","id":10106574,"node_id":"MDQ6VXNlcjEwMTA2NTc0","avatar_url":"https://avatars.githubusercontent.com/u/10106574?v=4","gravatar_id":"","url":"https://api.github.com/users/Xushaohong","html_url":"https://github.com/Xushaohong","followers_url":"https://api.github.com/users/Xushaohong/followers","following_url":"https://api.github.com/users/Xushaohong/following{/other_user}","gists_url":"https://api.github.com/users/Xushaohong/gists{/gist_id}","starred_url":"https://api.github.com/users/Xushaohong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Xushaohong/subscriptions","organizations_url":"https://api.github.com/users/Xushaohong/orgs","repos_url":"https://api.github.com/users/Xushaohong/repos","events_url":"https://api.github.com/users/Xushaohong/events{/privacy}","received_events_url":"https://api.github.com/users/Xushaohong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-19T07:23:31Z","updated_at":"2022-03-19T07:28:16Z","author_association":"CONTRIBUTOR","body":"> thanks @Xushaohong for the work! in the background thread , which is started by `stateMachine.followerEvent().notifyInstallSnapshotFromLeader.whenComplete()`, `inProgressInstallSnapshotRequest` will be set back to `0` if snapshot is installed successfully.\r\n> \r\n> there may be a case that `inProgressInstallSnapshotRequest` is just set back to `0` in the background thread, a `notifyInstallSnapshot` request from leader comes and `stateMachine.followerEvent().notifyInstallSnapshotFromLeader.whenComplete()` will be called again. is this a problem? i think we should add some check to see if the`firstAvailableLogTermIndex` included in the request is larger than the lastTermIndex in the current follower`s log Please let me know if I am missing something here.\r\n\r\nOnly when an exception happens will the ```inProgressInstallSnapshotRequest``` set be 0 immediately, otherwise it will set ```installedSnapshotTermIndex``` value as what successful snapshot index is and wait for another notify install snapshot request comeing, and when the notify main thread finds that this.installedSnapshotTermIndex.get() is not 0, then it unsets ```inProgressInstallSnapshotRequest``` to 0 to ensure the safety. \r\n\r\n@JacksonYao287  thx Jackson for the review~\r\n\r\nThe compare between lastTermIndex in the current follower`s log and ```firstAvailableLogTermIndex``` is already considered in the original code, and it will return ```InstallSnapshotResult.ALREADY_INSTALLED``` ","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1072960157/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1073834393","html_url":"https://github.com/apache/ratis/pull/573#issuecomment-1073834393","issue_url":"https://api.github.com/repos/apache/ratis/issues/573","id":1073834393,"node_id":"IC_kwDOBMxbGc5AAWmZ","user":{"login":"Xushaohong","id":10106574,"node_id":"MDQ6VXNlcjEwMTA2NTc0","avatar_url":"https://avatars.githubusercontent.com/u/10106574?v=4","gravatar_id":"","url":"https://api.github.com/users/Xushaohong","html_url":"https://github.com/Xushaohong","followers_url":"https://api.github.com/users/Xushaohong/followers","following_url":"https://api.github.com/users/Xushaohong/following{/other_user}","gists_url":"https://api.github.com/users/Xushaohong/gists{/gist_id}","starred_url":"https://api.github.com/users/Xushaohong/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Xushaohong/subscriptions","organizations_url":"https://api.github.com/users/Xushaohong/orgs","repos_url":"https://api.github.com/users/Xushaohong/repos","events_url":"https://api.github.com/users/Xushaohong/events{/privacy}","received_events_url":"https://api.github.com/users/Xushaohong/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-03-21T12:30:16Z","updated_at":"2022-03-21T12:30:16Z","author_association":"CONTRIBUTOR","body":"> thanks @Xushaohong for the explanation. the changes overall looks good to me. i left several comments , please take a look. when the follower is installing snapshot , leader will send a lot of notifyInstallSnapshot requests repeatedly, which is unnecessaryso can you please create a jira to solve this problem? or handle this issue in this patch?\r\n\r\nYep, i have a patch in my local env to fix it and this PR is the prerequisite. I would create a new PR ASAP.","reactions":{"url":"https://api.github.com/repos/apache/ratis/issues/comments/1073834393/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]