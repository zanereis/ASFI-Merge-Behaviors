[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297750848","html_url":"https://github.com/apache/couchdb/pull/490#issuecomment-297750848","issue_url":"https://api.github.com/repos/apache/couchdb/issues/490","id":297750848,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Nzc1MDg0OA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-27T15:34:05Z","updated_at":"2017-04-27T15:34:05Z","author_association":"CONTRIBUTOR","body":"@iilyak I think we forgot to revert back changes to couch_lru.erl. Specifically this part:\r\n\r\n```\r\n close_int(none, _) ->\r\n-    erlang:error(all_dbs_active);\r\n+    false;\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297750848/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297758272","html_url":"https://github.com/apache/couchdb/pull/490#issuecomment-297758272","issue_url":"https://api.github.com/repos/apache/couchdb/issues/490","id":297758272,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Nzc1ODI3Mg==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-27T15:59:21Z","updated_at":"2017-04-27T15:59:21Z","author_association":"CONTRIBUTOR","body":"@nickva: It is a little bit trickier than that. We want to revert this particular change (Add sys_db to the LRU) but keep new ets based implementation. Therefore it is not a simple `git revert` but rather a new commit which I am currently working on. I'll force push new version into this PR and let you know.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297758272/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297758888","html_url":"https://github.com/apache/couchdb/pull/490#issuecomment-297758888","issue_url":"https://api.github.com/repos/apache/couchdb/issues/490","id":297758888,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Nzc1ODg4OA==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-27T16:01:31Z","updated_at":"2017-04-27T16:01:31Z","author_association":"CONTRIBUTOR","body":"Actually I'll try your suggestion first.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297758888/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297764431","html_url":"https://github.com/apache/couchdb/pull/490#issuecomment-297764431","issue_url":"https://api.github.com/repos/apache/couchdb/issues/490","id":297764431,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Nzc2NDQzMQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-27T16:15:38Z","updated_at":"2017-04-27T16:15:38Z","author_association":"CONTRIBUTOR","body":"@iilyak Yap I understand. The ETS lru can stay but I meant the semantics of throwing the `all_dbs_active` has to come back. Other than that couch_lru wasn't touched by the original commit. (There was a fix to a gb_sets operation but that's gone now).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297764431/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297769329","html_url":"https://github.com/apache/couchdb/pull/490#issuecomment-297769329","issue_url":"https://api.github.com/repos/apache/couchdb/issues/490","id":297769329,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Nzc2OTMyOQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-27T16:33:19Z","updated_at":"2017-04-27T16:33:19Z","author_association":"CONTRIBUTOR","body":"@nickva: I pushed one more commit prior to your last message. I am not sure if you saw it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297769329/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297780528","html_url":"https://github.com/apache/couchdb/pull/487#issuecomment-297780528","issue_url":"https://api.github.com/repos/apache/couchdb/issues/487","id":297780528,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Nzc4MDUyOA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-27T17:15:42Z","updated_at":"2017-04-27T17:15:42Z","author_association":"MEMBER","body":"We don't presently check for all of our dependencies in the configure script.\r\n\r\nFor instance, we'll error out if you don't have Erlang installed, or if you are missing Sphinx, you'll get a similar error down in the documentation build.\r\n\r\nSo, for now, no.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297780528/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297786641","html_url":"https://github.com/apache/couchdb/pull/490#issuecomment-297786641","issue_url":"https://api.github.com/repos/apache/couchdb/issues/490","id":297786641,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Nzc4NjY0MQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-27T17:39:22Z","updated_at":"2017-04-27T17:39:22Z","author_association":"CONTRIBUTOR","body":"@iilyak oh ok, so we not raising the error in couch_lru module but moved to doing that in couch_server. I was mainly going by the file changes and noticed couch_lru wasn't touched in this commit but was touched in the original. Yap this should work, sorry didn't pay attention well enough at first","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297786641/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297810438","html_url":"https://github.com/apache/couchdb/pull/487#issuecomment-297810438","issue_url":"https://api.github.com/repos/apache/couchdb/issues/487","id":297810438,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzgxMDQzOA==","user":{"login":"ianpartridge","id":1423497,"node_id":"MDQ6VXNlcjE0MjM0OTc=","avatar_url":"https://avatars.githubusercontent.com/u/1423497?v=4","gravatar_id":"","url":"https://api.github.com/users/ianpartridge","html_url":"https://github.com/ianpartridge","followers_url":"https://api.github.com/users/ianpartridge/followers","following_url":"https://api.github.com/users/ianpartridge/following{/other_user}","gists_url":"https://api.github.com/users/ianpartridge/gists{/gist_id}","starred_url":"https://api.github.com/users/ianpartridge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ianpartridge/subscriptions","organizations_url":"https://api.github.com/users/ianpartridge/orgs","repos_url":"https://api.github.com/users/ianpartridge/repos","events_url":"https://api.github.com/users/ianpartridge/events{/privacy}","received_events_url":"https://api.github.com/users/ianpartridge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-27T19:08:58Z","updated_at":"2017-04-27T19:08:58Z","author_association":"NONE","body":"OK thanks I didn't realise that the `configure` script isn't designed to check for prerequisites (like they do in Autotools based projects).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297810438/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297819573","html_url":"https://github.com/apache/couchdb/pull/497#issuecomment-297819573","issue_url":"https://api.github.com/repos/apache/couchdb/issues/497","id":297819573,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzgxOTU3Mw==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-27T19:46:26Z","updated_at":"2017-04-27T19:46:26Z","author_association":"CONTRIBUTOR","body":"Please remove `BugzID: 85773.` and provide JIRA reference instead. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297819573/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297821046","html_url":"https://github.com/apache/couchdb/pull/487#issuecomment-297821046","issue_url":"https://api.github.com/repos/apache/couchdb/issues/487","id":297821046,"node_id":"MDEyOklzc3VlQ29tbWVudDI5NzgyMTA0Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-27T19:52:50Z","updated_at":"2017-04-27T19:52:50Z","author_association":"MEMBER","body":"We actually moved away from GNU Autotools intentionally for many reasons, not the least of which was that it made the Windows port very difficult. ;)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297821046/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297845488","html_url":"https://github.com/apache/couchdb/issues/498#issuecomment-297845488","issue_url":"https://api.github.com/repos/apache/couchdb/issues/498","id":297845488,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Nzg0NTQ4OA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-27T21:33:20Z","updated_at":"2017-04-27T21:33:20Z","author_association":"MEMBER","body":"I think you are mistaken in your belief that CouchDB no longer requires the revision value for updating a document.\r\n\r\n```\r\n$ curl -X PUT localhost:5984/foo\r\n{\"ok\":true}\r\n$ curl -X PUT localhost:5984/foo/bar -d '{\"joan\": \"is great\"}'\r\n{\"ok\":true,\"id\":\"bar\",\"rev\":\"1-9b0890fa11b66dc9f0cc4917e11553d1\"}\r\n$ curl localhost:5984/foo/bar\r\n{\"_id\":\"bar\",\"_rev\":\"1-9b0890fa11b66dc9f0cc4917e11553d1\",\"joan\":\"is great\"}\r\n$ curl -X PUT localhost:5984/foo/bar -d '{\"joan\": \"is still great\"}'\r\n{\"error\":\"conflict\",\"reason\":\"Document update conflict.\"}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297845488/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297849966","html_url":"https://github.com/apache/couchdb/issues/498#issuecomment-297849966","issue_url":"https://api.github.com/repos/apache/couchdb/issues/498","id":297849966,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Nzg0OTk2Ng==","user":{"login":"Aaron-Zhao","id":4712808,"node_id":"MDQ6VXNlcjQ3MTI4MDg=","avatar_url":"https://avatars.githubusercontent.com/u/4712808?v=4","gravatar_id":"","url":"https://api.github.com/users/Aaron-Zhao","html_url":"https://github.com/Aaron-Zhao","followers_url":"https://api.github.com/users/Aaron-Zhao/followers","following_url":"https://api.github.com/users/Aaron-Zhao/following{/other_user}","gists_url":"https://api.github.com/users/Aaron-Zhao/gists{/gist_id}","starred_url":"https://api.github.com/users/Aaron-Zhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Aaron-Zhao/subscriptions","organizations_url":"https://api.github.com/users/Aaron-Zhao/orgs","repos_url":"https://api.github.com/users/Aaron-Zhao/repos","events_url":"https://api.github.com/users/Aaron-Zhao/events{/privacy}","received_events_url":"https://api.github.com/users/Aaron-Zhao/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-27T21:54:45Z","updated_at":"2017-04-27T21:54:45Z","author_association":"NONE","body":"You're right. It still requires rev for updates. Sorry, I wasn't aware of that I actually had rev passed in the call.\r\n\r\nJust curious, why would CouchDB team decided to have rev as required for an update? Why not design it as what GET /{db}/{docid} is where the default is always the latest rev if previous rev is wanted we can always pass it in the query parameter.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297849966/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297854113","html_url":"https://github.com/apache/couchdb/issues/498#issuecomment-297854113","issue_url":"https://api.github.com/repos/apache/couchdb/issues/498","id":297854113,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Nzg1NDExMw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-27T22:14:46Z","updated_at":"2017-04-27T22:14:46Z","author_association":"MEMBER","body":"Because CouchDB is eventually consistent by design - our entire replication structure (*the* key feature of CouchDB) requires revisions to be part of the API to ensure consistency. You can learn more about this at http://guide.couchdb.org/draft/consistency.html","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297854113/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297855039","html_url":"https://github.com/apache/couchdb/issues/498#issuecomment-297855039","issue_url":"https://api.github.com/repos/apache/couchdb/issues/498","id":297855039,"node_id":"MDEyOklzc3VlQ29tbWVudDI5Nzg1NTAzOQ==","user":{"login":"Aaron-Zhao","id":4712808,"node_id":"MDQ6VXNlcjQ3MTI4MDg=","avatar_url":"https://avatars.githubusercontent.com/u/4712808?v=4","gravatar_id":"","url":"https://api.github.com/users/Aaron-Zhao","html_url":"https://github.com/Aaron-Zhao","followers_url":"https://api.github.com/users/Aaron-Zhao/followers","following_url":"https://api.github.com/users/Aaron-Zhao/following{/other_user}","gists_url":"https://api.github.com/users/Aaron-Zhao/gists{/gist_id}","starred_url":"https://api.github.com/users/Aaron-Zhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Aaron-Zhao/subscriptions","organizations_url":"https://api.github.com/users/Aaron-Zhao/orgs","repos_url":"https://api.github.com/users/Aaron-Zhao/repos","events_url":"https://api.github.com/users/Aaron-Zhao/events{/privacy}","received_events_url":"https://api.github.com/users/Aaron-Zhao/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-27T22:19:37Z","updated_at":"2017-04-27T22:19:37Z","author_association":"NONE","body":"Thanks for the info! That's helpful.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/297855039/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298042548","html_url":"https://github.com/apache/couchdb/pull/497#issuecomment-298042548","issue_url":"https://api.github.com/repos/apache/couchdb/issues/497","id":298042548,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODA0MjU0OA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-28T16:21:11Z","updated_at":"2017-04-28T16:21:11Z","author_association":"MEMBER","body":"+1 to the logic. Just a few minor style issues to clean up and then this should be good to go.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298042548/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298070744","html_url":"https://github.com/apache/couchdb/pull/477#issuecomment-298070744","issue_url":"https://api.github.com/repos/apache/couchdb/issues/477","id":298070744,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODA3MDc0NA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-28T18:20:22Z","updated_at":"2017-04-28T18:20:22Z","author_association":"MEMBER","body":"Mulling this over it looks more or less like the obvious approach to adding the same LRU that couch_server has. For the most part it reads fine. Though I'm mulling over the new monitor that's returned that has to be closed. I keep thinking there must be something a bit cleaner here with exposing a new API function to ask the module if its index is idle.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298070744/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298084037","html_url":"https://github.com/apache/couchdb/pull/477#issuecomment-298084037","issue_url":"https://api.github.com/repos/apache/couchdb/issues/477","id":298084037,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODA4NDAzNw==","user":{"login":"sagelywizard","id":167249,"node_id":"MDQ6VXNlcjE2NzI0OQ==","avatar_url":"https://avatars.githubusercontent.com/u/167249?v=4","gravatar_id":"","url":"https://api.github.com/users/sagelywizard","html_url":"https://github.com/sagelywizard","followers_url":"https://api.github.com/users/sagelywizard/followers","following_url":"https://api.github.com/users/sagelywizard/following{/other_user}","gists_url":"https://api.github.com/users/sagelywizard/gists{/gist_id}","starred_url":"https://api.github.com/users/sagelywizard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sagelywizard/subscriptions","organizations_url":"https://api.github.com/users/sagelywizard/orgs","repos_url":"https://api.github.com/users/sagelywizard/repos","events_url":"https://api.github.com/users/sagelywizard/events{/privacy}","received_events_url":"https://api.github.com/users/sagelywizard/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-28T19:16:43Z","updated_at":"2017-04-28T19:16:43Z","author_association":"MEMBER","body":"@davisp What do you think about doing something similar to the `#db{}` record for views (and holding the ref in its state, like `#db{}`? It'd involve changing a lot of LOC, but it seems cleaner on the surface and would be consistent.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298084037/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298085790","html_url":"https://github.com/apache/couchdb/pull/490#issuecomment-298085790","issue_url":"https://api.github.com/repos/apache/couchdb/issues/490","id":298085790,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODA4NTc5MA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-28T19:24:58Z","updated_at":"2017-04-28T19:24:58Z","author_association":"CONTRIBUTOR","body":"I compared the code before lru commit and this branch to see what's changed. Looks good.\r\n\r\nTests pass  All 1141 tests passed.\r\n\r\nStarted up a an instance with max_dbs_open set to 100. Then spawned 10 replications in 10 different replicator dbs (8 shards each). ```rep.replicate_1_to_n_and_compare(10, db_per_doc=True)```\r\n\r\nWhile that was running created 200 new databases ``` for i in xrange(200): srv.create(\"XXXXXX_\"+str(i))``` then opened observer and monitored ETS tables and kept an eye on the logs. Everything seems to behave as expected\r\n\r\n![screen shot 2017-04-28 at 3 16 49 pm](https://cloud.githubusercontent.com/assets/211822/25544011/b5ce908c-2c26-11e7-94c5-54d62478498f.png)\r\n\r\nETS tables stay at 100 and older un-monitored dbs are pushed out by newly created ones.\r\n\r\n+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298085790/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298108567","html_url":"https://github.com/apache/couchdb/pull/470#issuecomment-298108567","issue_url":"https://api.github.com/repos/apache/couchdb/issues/470","id":298108567,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODEwODU2Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-28T21:15:44Z","updated_at":"2017-04-28T21:15:44Z","author_association":"MEMBER","body":"@redgeoff As far as I'm aware, CouchDB doesn't make any attempt to check system/process ulimit on max fds. If I recall correctly, you'll start getting `{error, system_limit}` when you hit this limit. (Don't forget that the `erl` process itself by default limits Erlang to 65536 max simultaneous ports open or 8196 on Windows, which can be adjusted with `+Q` in `vm.args` or on the command line.) If the test passes as @nickva shows with a sufficiently high ulimit, I don't see any need to block this PR.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298108567/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298124062","html_url":"https://github.com/apache/couchdb/pull/470#issuecomment-298124062","issue_url":"https://api.github.com/repos/apache/couchdb/issues/470","id":298124062,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODEyNDA2Mg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-28T22:50:16Z","updated_at":"2017-04-28T22:50:16Z","author_association":"MEMBER","body":"\\o/ congrats! so exciting.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298124062/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298131099","html_url":"https://github.com/apache/couchdb/pull/470#issuecomment-298131099","issue_url":"https://api.github.com/repos/apache/couchdb/issues/470","id":298131099,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODEzMTA5OQ==","user":{"login":"redgeoff","id":3378986,"node_id":"MDQ6VXNlcjMzNzg5ODY=","avatar_url":"https://avatars.githubusercontent.com/u/3378986?v=4","gravatar_id":"","url":"https://api.github.com/users/redgeoff","html_url":"https://github.com/redgeoff","followers_url":"https://api.github.com/users/redgeoff/followers","following_url":"https://api.github.com/users/redgeoff/following{/other_user}","gists_url":"https://api.github.com/users/redgeoff/gists{/gist_id}","starred_url":"https://api.github.com/users/redgeoff/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/redgeoff/subscriptions","organizations_url":"https://api.github.com/users/redgeoff/orgs","repos_url":"https://api.github.com/users/redgeoff/repos","events_url":"https://api.github.com/users/redgeoff/events{/privacy}","received_events_url":"https://api.github.com/users/redgeoff/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-28T23:49:31Z","updated_at":"2017-04-28T23:49:31Z","author_association":"CONTRIBUTOR","body":"Sorry, I haven't had time to follow up. I'll try to test this soon, but\nplease don't hold this up. In general though, I was hoping that these\nchanges would make it so that you could more efficiently implement\nreplication with less connections/handles so that you could support more\ndatabases/users (with replications) on a single box. I'm not sure if these\nenhancements target this detail.\n\nOn Fri, Apr 28, 2017, 15:50 Joan Touzet <notifications@github.com> wrote:\n\n> \\o/ congrats! so exciting.\n>\n> —\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/apache/couchdb/pull/470#issuecomment-298124062>, or mute\n> the thread\n> <https://github.com/notifications/unsubscribe-auth/ADOPKn3BpC-XvvbHv5OG-FvtNziBAhpgks5r0m0rgaJpZM4Mzi0E>\n> .\n>\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298131099/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298137265","html_url":"https://github.com/apache/couchdb/pull/470#issuecomment-298137265","issue_url":"https://api.github.com/repos/apache/couchdb/issues/470","id":298137265,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODEzNzI2NQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-29T01:05:48Z","updated_at":"2017-04-29T01:05:48Z","author_association":"MEMBER","body":"The good news is that yes, this commit DOES more efficiently handle replication with less connections, but only for multiple replications between the same hosts. So it's great for clusters and data center backups and so on, but doesn't really help the database-and-replication-per-user model very much.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298137265/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298139476","html_url":"https://github.com/apache/couchdb/pull/500#issuecomment-298139476","issue_url":"https://api.github.com/repos/apache/couchdb/issues/500","id":298139476,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODEzOTQ3Ng==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-29T01:45:12Z","updated_at":"2017-04-29T01:45:12Z","author_association":"CONTRIBUTOR","body":"@wohali Thank you for noticing this. Sorry I missed your comment in the main PR about adding it and noticed it only in reading my email later in the evening. So I made a separate PR.\r\n\r\nBut I might need your help to test this. I don't have any windows machines handy.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298139476/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298145010","html_url":"https://github.com/apache/couchdb/pull/500#issuecomment-298145010","issue_url":"https://api.github.com/repos/apache/couchdb/issues/500","id":298145010,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODE0NTAxMA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-29T03:53:01Z","updated_at":"2017-04-29T03:53:01Z","author_association":"MEMBER","body":"Drop the quotation marks since there is no space in what is being passed, and everything should be fine. +1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298145010/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298146453","html_url":"https://github.com/apache/couchdb/pull/500#issuecomment-298146453","issue_url":"https://api.github.com/repos/apache/couchdb/issues/500","id":298146453,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODE0NjQ1Mw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-29T04:31:11Z","updated_at":"2017-04-29T04:31:11Z","author_association":"CONTRIBUTOR","body":"Makes sense. Thank you!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298146453/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298247870","html_url":"https://github.com/apache/couchdb/pull/484#issuecomment-298247870","issue_url":"https://api.github.com/repos/apache/couchdb/issues/484","id":298247870,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODI0Nzg3MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-30T18:17:00Z","updated_at":"2017-04-30T18:17:00Z","author_association":"MEMBER","body":"@nickva Seeing conflicts here, does this still make sense with the scheduler merged?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298247870/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298247963","html_url":"https://github.com/apache/couchdb/pull/496#issuecomment-298247963","issue_url":"https://api.github.com/repos/apache/couchdb/issues/496","id":298247963,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODI0Nzk2Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-30T18:18:41Z","updated_at":"2017-04-30T18:18:41Z","author_association":"MEMBER","body":"@davisp IMO write the docs and have that PR land at the same time as this one, or they might get left behind.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298247963/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298248149","html_url":"https://github.com/apache/couchdb/pull/475#issuecomment-298248149","issue_url":"https://api.github.com/repos/apache/couchdb/issues/475","id":298248149,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODI0ODE0OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-30T18:22:05Z","updated_at":"2017-04-30T18:22:05Z","author_association":"MEMBER","body":"Hi @fkaempfer thank you for your contribution to CouchDB! Do you think you could add a test to confirm this? Either EUnit or JavaScript would be fine.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298248149/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298252499","html_url":"https://github.com/apache/couchdb/pull/465#issuecomment-298252499","issue_url":"https://api.github.com/repos/apache/couchdb/issues/465","id":298252499,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODI1MjQ5OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-30T19:45:14Z","updated_at":"2017-04-30T19:45:14Z","author_association":"MEMBER","body":"HI @benel,\r\n\r\nSorry to be a bother here. You have 2 PRs, apache/couchdb-couch#59 and apache/couchdb-chttpd#36, that need to be merged into this PR as well. CouchDB moved to a monorepo approach.\r\n\r\nWith the fixes here alongside the test, I'll be able to confirm the correct behaviour with Travis CI and Jenkins, and can +1 your student's patch so we can merge it in.\r\n\r\nReally appreciate your help and patience here!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298252499/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298252727","html_url":"https://github.com/apache/couchdb/pull/389#issuecomment-298252727","issue_url":"https://api.github.com/repos/apache/couchdb/issues/389","id":298252727,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODI1MjcyNw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-30T19:49:14Z","updated_at":"2017-04-30T19:49:14Z","author_association":"MEMBER","body":"@kxepal Are you able to help finish this PR?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298252727/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298252852","html_url":"https://github.com/apache/couchdb/pull/373#issuecomment-298252852","issue_url":"https://api.github.com/repos/apache/couchdb/issues/373","id":298252852,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODI1Mjg1Mg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-30T19:51:16Z","updated_at":"2017-04-30T19:51:16Z","author_association":"MEMBER","body":"@janl Hey, can you merge apache/couchdb-chttpd#97 and apache/couchdb-couch#132 into this PR now that we have a monorepo?\r\n\r\nAlso, any chance of a test? ;)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298252852/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298252919","html_url":"https://github.com/apache/couchdb/pull/501#issuecomment-298252919","issue_url":"https://api.github.com/repos/apache/couchdb/issues/501","id":298252919,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODI1MjkxOQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-30T19:52:23Z","updated_at":"2017-04-30T19:52:23Z","author_association":"MEMBER","body":"I think the bigger issue here is that `mem3_util:ensure_exists/1` is racey in that if multiple concurrent clients attempt to ensure a missing database exists simultaneously only one of them will succeed. A better approach would be to allow for an expected file_exists return and for the client that receives it to try re-opening a second time. Something along these lines:\r\n\r\n```diff\r\ndiff --git a/src/mem3/src/mem3_util.erl b/src/mem3/src/mem3_util.erl\r\nindex 4e1b5fd7d..deb2c6640 100644\r\n--- a/src/mem3/src/mem3_util.erl\r\n+++ b/src/mem3/src/mem3_util.erl\r\n@@ -224,11 +224,21 @@ shard_info(DbName) ->\r\n ensure_exists(DbName) when is_list(DbName) ->\r\n     ensure_exists(list_to_binary(DbName));\r\n ensure_exists(DbName) ->\r\n-    case couch_db:open(DbName, [nologifmissing, sys_db | [?ADMIN_CTX]]) of\r\n-    {ok, Db} ->\r\n-        {ok, Db};\r\n-    _ ->\r\n-        couch_server:create(DbName, [?ADMIN_CTX])\r\n+    Options = [nologifmissing, sys_db, ?ADMIN_CTX],\r\n+    case couch_db:open(DbName, Options) of\r\n+        {ok, Db} ->\r\n+            {ok, Db};\r\n+        _ ->\r\n+            case couch_server:create(DbName, Options) of\r\n+                {ok, Db} ->\r\n+                    {ok, Db};\r\n+                file_exists ->\r\n+                    % Try opening again in case there was a race to\r\n+                    % create the database.\r\n+                    couch_db:open(DbName, Options);\r\n+                Error ->\r\n+                    Error\r\n+            end\r\n     end.\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298252919/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298252929","html_url":"https://github.com/apache/couchdb/pull/367#issuecomment-298252929","issue_url":"https://api.github.com/repos/apache/couchdb/issues/367","id":298252929,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODI1MjkyOQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-30T19:52:34Z","updated_at":"2017-04-30T19:52:34Z","author_association":"MEMBER","body":"Closing for now. We can revisit if the OP decides to revisit.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298252929/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298253522","html_url":"https://github.com/apache/couchdb/pull/373#issuecomment-298253522","issue_url":"https://api.github.com/repos/apache/couchdb/issues/373","id":298253522,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODI1MzUyMg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-30T20:03:22Z","updated_at":"2017-04-30T20:03:22Z","author_association":"MEMBER","body":"The alternative is we do code clearance and merge https://github.com/cloudant/delegated_auth instead. /cc @eiri @rnewson ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298253522/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298254054","html_url":"https://github.com/apache/couchdb/pull/312#issuecomment-298254054","issue_url":"https://api.github.com/repos/apache/couchdb/issues/312","id":298254054,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODI1NDA1NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-30T20:12:46Z","updated_at":"2017-04-30T20:12:46Z","author_association":"MEMBER","body":"I'm going to merge this for now, since it's not referenced in the actual build yet. We can decide what we want to do for 2.1 during the next release cycle.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298254054/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298254353","html_url":"https://github.com/apache/couchdb/issues/499#issuecomment-298254353","issue_url":"https://api.github.com/repos/apache/couchdb/issues/499","id":298254353,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODI1NDM1Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-30T20:17:24Z","updated_at":"2017-04-30T20:17:24Z","author_association":"MEMBER","body":"I have gone through and tagged all the open PRs against apache/couchdb as a test of the labelling system. It seems to make sense to me.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298254353/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298255107","html_url":"https://github.com/apache/couchdb/pull/501#issuecomment-298255107","issue_url":"https://api.github.com/repos/apache/couchdb/issues/501","id":298255107,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODI1NTEwNw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-30T20:30:25Z","updated_at":"2017-05-01T05:23:33Z","author_association":"MEMBER","body":"@davisp I agree, I was worried about making that change but I like the parallelism between your approach and what is done in e.g. https://github.com/apache/couchdb/blob/350a67b3bc2372b4a88649768805deb896c86451/src/couch/src/couch_server.erl#L83-L88 .\r\n\r\nQuestion: Why not call couch_db:open/2 with Options including `create_if_missing` once, and if that fails with file_exists, just call it again without that option?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298255107/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298257533","html_url":"https://github.com/apache/couchdb/pull/389#issuecomment-298257533","issue_url":"https://api.github.com/repos/apache/couchdb/issues/389","id":298257533,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODI1NzUzMw==","user":{"login":"kxepal","id":785983,"node_id":"MDQ6VXNlcjc4NTk4Mw==","avatar_url":"https://avatars.githubusercontent.com/u/785983?v=4","gravatar_id":"","url":"https://api.github.com/users/kxepal","html_url":"https://github.com/kxepal","followers_url":"https://api.github.com/users/kxepal/followers","following_url":"https://api.github.com/users/kxepal/following{/other_user}","gists_url":"https://api.github.com/users/kxepal/gists{/gist_id}","starred_url":"https://api.github.com/users/kxepal/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kxepal/subscriptions","organizations_url":"https://api.github.com/users/kxepal/orgs","repos_url":"https://api.github.com/users/kxepal/repos","events_url":"https://api.github.com/users/kxepal/events{/privacy}","received_events_url":"https://api.github.com/users/kxepal/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-04-30T21:13:52Z","updated_at":"2017-04-30T21:13:52Z","author_association":"MEMBER","body":"@wohali oh...it wasnt' merged! On 3th of May will catch it. Thanks for reminder!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298257533/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298339418","html_url":"https://github.com/apache/couchdb/pull/501#issuecomment-298339418","issue_url":"https://api.github.com/repos/apache/couchdb/issues/501","id":298339418,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODMzOTQxOA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-01T14:08:37Z","updated_at":"2017-05-01T14:08:37Z","author_association":"MEMBER","body":"That'd be more concise yeah. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298339418/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298342496","html_url":"https://github.com/apache/couchdb/pull/484#issuecomment-298342496","issue_url":"https://api.github.com/repos/apache/couchdb/issues/484","id":298342496,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODM0MjQ5Ng==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-01T14:26:12Z","updated_at":"2017-05-01T14:26:12Z","author_association":"CONTRIBUTOR","body":"@wohali you're right this will need to be updated for the scheduling replicator. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298342496/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298617779","html_url":"https://github.com/apache/couchdb/pull/494#issuecomment-298617779","issue_url":"https://api.github.com/repos/apache/couchdb/issues/494","id":298617779,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODYxNzc3OQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-02T12:12:09Z","updated_at":"2017-05-02T12:12:09Z","author_association":"MEMBER","body":"utf-8 is the defined charset when interpreting application/json, this is unnecessary.\r\n\r\nhttps://www.ietf.org/rfc/rfc4627.txt\r\n\r\n\"3.  Encoding\r\n\r\n   JSON text SHALL be encoded in Unicode.  The default encoding is\r\n   UTF-8.\"","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298617779/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298633590","html_url":"https://github.com/apache/couchdb/pull/475#issuecomment-298633590","issue_url":"https://api.github.com/repos/apache/couchdb/issues/475","id":298633590,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODYzMzU5MA==","user":{"login":"fkaempfer","id":2357885,"node_id":"MDQ6VXNlcjIzNTc4ODU=","avatar_url":"https://avatars.githubusercontent.com/u/2357885?v=4","gravatar_id":"","url":"https://api.github.com/users/fkaempfer","html_url":"https://github.com/fkaempfer","followers_url":"https://api.github.com/users/fkaempfer/followers","following_url":"https://api.github.com/users/fkaempfer/following{/other_user}","gists_url":"https://api.github.com/users/fkaempfer/gists{/gist_id}","starred_url":"https://api.github.com/users/fkaempfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkaempfer/subscriptions","organizations_url":"https://api.github.com/users/fkaempfer/orgs","repos_url":"https://api.github.com/users/fkaempfer/repos","events_url":"https://api.github.com/users/fkaempfer/events{/privacy}","received_events_url":"https://api.github.com/users/fkaempfer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-02T13:21:38Z","updated_at":"2017-05-02T13:21:38Z","author_association":"CONTRIBUTOR","body":"OK, this is my first erlang code ever written, so perhaps it could still be improved ;).\r\n\r\nThe test shows (fails on master) that it is possible for unauthorized users to trigger compaction when no security is in place. \r\n\r\nWhen security is in place for a db, members can also trigger compaction, but should not be able to (only admins should). I did not set up a test for this special case, because it is fairly complicated to create a user in the _users db and set up _security in the test code. This is also fixed by the PR.\r\n\r\nI only wonder if it should be possible for db admins to trigger _compaction/_view_cleanup or just for server admins. This PR allows it only for server admins (and not DB admins), which would be much more complex to implement.\r\n\r\nThanks for reviewing this PR.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298633590/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298691336","html_url":"https://github.com/apache/couchdb/pull/501#issuecomment-298691336","issue_url":"https://api.github.com/repos/apache/couchdb/issues/501","id":298691336,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODY5MTMzNg==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-02T16:42:46Z","updated_at":"2017-05-02T16:42:46Z","author_association":"CONTRIBUTOR","body":"> Question: Why not call couch_db:open/2 with Options including create_if_missing once, and if that fails with file_exists, just call it again without that option?\r\n\r\nThank you @wohali your suggestion is great. Following works locally:\r\n```\r\ndiff --git a/src/mem3/src/mem3_util.erl b/src/mem3/src/mem3_util.erl\r\nindex 2cd444d..71ef5b6 100644\r\n--- a/src/mem3/src/mem3_util.erl\r\n+++ b/src/mem3/src/mem3_util.erl\r\n@@ -214,11 +214,12 @@ shard_info(DbName) ->\r\n ensure_exists(DbName) when is_list(DbName) ->\r\n     ensure_exists(list_to_binary(DbName));\r\n ensure_exists(DbName) ->\r\n-    case couch_db:open(DbName, [nologifmissing, sys_db | [?ADMIN_CTX]]) of\r\n+    Options = [nologifmissing, sys_db, {create_if_missing, true}, ?ADMIN_CTX],\r\n+    case couch_db:open(DbName, Options) of\r\n     {ok, Db} ->\r\n         {ok, Db};\r\n-    _ ->\r\n-        couch_server:create(DbName, [?ADMIN_CTX])\r\n+    file_exists ->\r\n+        couch_db:open(DbName, [sys_db, ?ADMIN_CTX])\r\n     end.\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298691336/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298694987","html_url":"https://github.com/apache/couchdb/pull/501#issuecomment-298694987","issue_url":"https://api.github.com/repos/apache/couchdb/issues/501","id":298694987,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODY5NDk4Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-02T16:55:55Z","updated_at":"2017-05-02T16:55:55Z","author_association":"MEMBER","body":"Yup @iilyak I got busy with something else yesterday but will redo my PR in the next hour and merge it along the lines of what you show assuming tests pass.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298694987/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298695381","html_url":"https://github.com/apache/couchdb/pull/475#issuecomment-298695381","issue_url":"https://api.github.com/repos/apache/couchdb/issues/475","id":298695381,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODY5NTM4MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-02T16:57:17Z","updated_at":"2017-05-02T18:02:14Z","author_association":"MEMBER","body":"@fkaempfer Do you have a CouchDB 1.6 lying around? Can you test what it does? Your PR should, for now, match 1.6's behaviour when it comes to db admins vs. server admins. If you don't have time I can take a look for you.\r\n\r\nAlso if you can squash these commits I'd greatly appreciate it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298695381/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298774969","html_url":"https://github.com/apache/couchdb/issues/499#issuecomment-298774969","issue_url":"https://api.github.com/repos/apache/couchdb/issues/499","id":298774969,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODc3NDk2OQ==","user":{"login":"sagelywizard","id":167249,"node_id":"MDQ6VXNlcjE2NzI0OQ==","avatar_url":"https://avatars.githubusercontent.com/u/167249?v=4","gravatar_id":"","url":"https://api.github.com/users/sagelywizard","html_url":"https://github.com/sagelywizard","followers_url":"https://api.github.com/users/sagelywizard/followers","following_url":"https://api.github.com/users/sagelywizard/following{/other_user}","gists_url":"https://api.github.com/users/sagelywizard/gists{/gist_id}","starred_url":"https://api.github.com/users/sagelywizard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sagelywizard/subscriptions","organizations_url":"https://api.github.com/users/sagelywizard/orgs","repos_url":"https://api.github.com/users/sagelywizard/repos","events_url":"https://api.github.com/users/sagelywizard/events{/privacy}","received_events_url":"https://api.github.com/users/sagelywizard/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-02T22:04:32Z","updated_at":"2017-05-02T22:04:32Z","author_association":"MEMBER","body":"I'm generally +1 to everything here. I'd say we should add a `CONTRIBUTING.md` file. Also, I'm a bit confused how we'd use milestones. Would we have a \"next minor release\" milestone and add all minor-release-type issues to that milestone? And then move those to the specific \"release 2.1.6\" milestone when the code ends up in master?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298774969/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298794021","html_url":"https://github.com/apache/couchdb/issues/499#issuecomment-298794021","issue_url":"https://api.github.com/repos/apache/couchdb/issues/499","id":298794021,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODc5NDAyMQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-02T23:59:39Z","updated_at":"2017-05-02T23:59:39Z","author_association":"MEMBER","body":"Yes, I think you've got exactly the right thing for \"next minor release,\" except that we'd simply edit the label to become \"2.2.0\" once we knew what the numbering might be. (major.minor.patch right?) Alternately we can simply start with defining 2.1.0, 2.2.0, 3.0.0 etc and just assign things as necessary, and move them out to another milestone (or to no milestone if we can't make a commitment).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298794021/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298887096","html_url":"https://github.com/apache/couchdb/pull/475#issuecomment-298887096","issue_url":"https://api.github.com/repos/apache/couchdb/issues/475","id":298887096,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODg4NzA5Ng==","user":{"login":"fkaempfer","id":2357885,"node_id":"MDQ6VXNlcjIzNTc4ODU=","avatar_url":"https://avatars.githubusercontent.com/u/2357885?v=4","gravatar_id":"","url":"https://api.github.com/users/fkaempfer","html_url":"https://github.com/fkaempfer","followers_url":"https://api.github.com/users/fkaempfer/followers","following_url":"https://api.github.com/users/fkaempfer/following{/other_user}","gists_url":"https://api.github.com/users/fkaempfer/gists{/gist_id}","starred_url":"https://api.github.com/users/fkaempfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkaempfer/subscriptions","organizations_url":"https://api.github.com/users/fkaempfer/orgs","repos_url":"https://api.github.com/users/fkaempfer/repos","events_url":"https://api.github.com/users/fkaempfer/events{/privacy}","received_events_url":"https://api.github.com/users/fkaempfer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-03T11:37:25Z","updated_at":"2017-05-03T11:37:25Z","author_association":"CONTRIBUTOR","body":"I verified that the behaviour of 1.6.1 is indeed that db admins are also allowed to perform compaction:\r\n- anonymous: disallowed\r\n- member: disallowed\r\n- db admin: allowed\r\n- server admin: allowed\r\n\r\nI guess the same is true for view compaction, which I have not tested.\r\n\r\nThis would mean the pull request needs to be changed to get the actual permission response from the corresponding shard via RPC as far as I understand. This is a bit more tricky to implement and requires changing a couple of method signatures.\r\n\r\nIf you think it's worth persuing I can try doing it. Or perhaps you prefer that somebody from the CouchDB team does it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298887096/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298974879","html_url":"https://github.com/apache/couchdb/pull/475#issuecomment-298974879","issue_url":"https://api.github.com/repos/apache/couchdb/issues/475","id":298974879,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODk3NDg3OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-03T17:10:33Z","updated_at":"2017-05-03T17:10:33Z","author_association":"MEMBER","body":"Thanks for doing the legwork! Indeed I do think it's worth pursuing, and it'd be great if you could give it a go. We'll be sure to get someone to review your work.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298974879/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298983295","html_url":"https://github.com/apache/couchdb/pull/503#issuecomment-298983295","issue_url":"https://api.github.com/repos/apache/couchdb/issues/503","id":298983295,"node_id":"MDEyOklzc3VlQ29tbWVudDI5ODk4MzI5NQ==","user":{"login":"GinoCubeddu","id":8820175,"node_id":"MDQ6VXNlcjg4MjAxNzU=","avatar_url":"https://avatars.githubusercontent.com/u/8820175?v=4","gravatar_id":"","url":"https://api.github.com/users/GinoCubeddu","html_url":"https://github.com/GinoCubeddu","followers_url":"https://api.github.com/users/GinoCubeddu/followers","following_url":"https://api.github.com/users/GinoCubeddu/following{/other_user}","gists_url":"https://api.github.com/users/GinoCubeddu/gists{/gist_id}","starred_url":"https://api.github.com/users/GinoCubeddu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GinoCubeddu/subscriptions","organizations_url":"https://api.github.com/users/GinoCubeddu/orgs","repos_url":"https://api.github.com/users/GinoCubeddu/repos","events_url":"https://api.github.com/users/GinoCubeddu/events{/privacy}","received_events_url":"https://api.github.com/users/GinoCubeddu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-03T17:42:24Z","updated_at":"2017-05-03T17:42:24Z","author_association":"NONE","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/298983295/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299026530","html_url":"https://github.com/apache/couchdb/pull/504#issuecomment-299026530","issue_url":"https://api.github.com/repos/apache/couchdb/issues/504","id":299026530,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTAyNjUzMA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-03T20:31:48Z","updated_at":"2017-05-03T20:31:48Z","author_association":"CONTRIBUTOR","body":"Some tests are failing in `couch_btree` module\r\n\r\n```\r\nin call from couch_btree:add_remove/3 (src/couch_btree.erl, line 235)\r\n\r\nin call from couch_btree_tests:'-test_add_remove/3-fun-0-'/2 (test/couch_btree_tests.erl, line 496)\r\n\r\n**error:function_clause\r\n\r\n  output:<<\"\">>\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299026530/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299041887","html_url":"https://github.com/apache/couchdb/pull/504#issuecomment-299041887","issue_url":"https://api.github.com/repos/apache/couchdb/issues/504","id":299041887,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTA0MTg4Nw==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-03T21:32:13Z","updated_at":"2017-05-03T21:32:13Z","author_association":"MEMBER","body":"@nickva Yeap. Missed a dumb case when I was trying to be defensive for the is_append_only function. Fixed now.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299041887/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299050952","html_url":"https://github.com/apache/couchdb/issues/506#issuecomment-299050952","issue_url":"https://api.github.com/repos/apache/couchdb/issues/506","id":299050952,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTA1MDk1Mg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-03T22:15:09Z","updated_at":"2017-05-03T22:15:09Z","author_association":"CONTRIBUTOR","body":"@wohali \r\n\r\nThanks for taking a look!\r\n\r\nBy default scheduling replicator does not update replication documents with transient states such as \"triggered\", \"crashing\", \"error\". This is one of the improvements and it is what allows it to run more replication jobs (since they don't write to disk as much).\r\n\r\nTo observe the state of the replications created in by that document, try to do one of these things (or both):\r\n\r\n1) Query `http://127.0.0.1:15984/_scheduler/docs` endpoint. You'd get all the replication documents there. Or query the specific document. `http://127.0.0.1:15984/_scheduler/docs/foo_error_rep`\r\n\r\n2) Enable compatibility mode `[replicator] update_docs = True` then  replicator will behave very similarly to the old one and you should see error or triggered there. And you can still query document as before.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299050952/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299054310","html_url":"https://github.com/apache/couchdb/pull/505#issuecomment-299054310","issue_url":"https://api.github.com/repos/apache/couchdb/issues/505","id":299054310,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTA1NDMxMA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-03T22:32:57Z","updated_at":"2017-05-03T22:32:57Z","author_association":"CONTRIBUTOR","body":"@davisp pointed out that current code already has TCO and this is not needed\r\n\r\nUsed this script from him (with a modification to just print the memory of the process) to verify:\r\n\r\n```\r\n-module(foo).\r\n-compile(export_all).\r\na() ->\r\n    a(0).\r\na(I) ->\r\n    if (I+1) rem 1000 /= 0 -> ok; true ->\r\n        io:format(\"~p~n\", [process_info(self(), memory)])\r\n    end,\r\n    try\r\n        throw(bar)\r\n    catch throw:bar ->\r\n        c(a, I+1)\r\n    end.\r\nb() ->\r\n    b(0).\r\nb(I) ->\r\n    if (I+1) rem 1000 /= 0 -> ok; true ->\r\n        io:format(\"~p~n\", [process_info(self(), memory)])\r\n    end,\r\n    try\r\n        c(b, I+1)\r\n    catch throw:bar ->\r\n        foo\r\n    end.\r\nc(F, I) ->\r\n    ?MODULE:F(I).\r\n```\r\n\r\nfoo:b() ends up producing\r\n\r\n```\r\n...\r\n{memory,102684144}\r\n{memory,102684144}\r\n{memory,102684144}\r\n{memory,102684144}\r\n```\r\n\r\nfoo:a() is stable \r\n```\r\n...\r\n{memory,16672}\r\n{memory,24576}\r\n{memory,11784}\r\n{memory,16672}\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299054310/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299055579","html_url":"https://github.com/apache/couchdb/pull/505#issuecomment-299055579","issue_url":"https://api.github.com/repos/apache/couchdb/issues/505","id":299055579,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTA1NTU3OQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-03T22:40:20Z","updated_at":"2017-05-03T22:40:20Z","author_association":"CONTRIBUTOR","body":"Thank you Paul and Nick for pointing out that I was wrong. The code would work as is. @nickva could you close the PR?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299055579/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299063118","html_url":"https://github.com/apache/couchdb/issues/506#issuecomment-299063118","issue_url":"https://api.github.com/repos/apache/couchdb/issues/506","id":299063118,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTA2MzExOA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-03T23:25:09Z","updated_at":"2017-05-03T23:25:09Z","author_association":"MEMBER","body":"OK, I've rebuilt from master, and I've shifted over to using `/_scheduler/docs/foo_error_rep` which always shows up as a 404. I'm still getting a failure:\r\n\r\n```\r\n[notice] 2017-05-03T22:57:34.454264Z node1@127.0.0.1 <0.309.0> cc86958549 127.0.0.1:15984 127.0.0.1 undefined PUT /test_suite_db_hhyyrpqf%2F_replicator/foo_error_rep 201 ok 99\r\n[notice] 2017-05-03T22:57:34.486167Z node1@127.0.0.1 <0.309.0> 79abcb1691 127.0.0.1:15984 127.0.0.1 undefined GET /_scheduler/docs/foo_error_rep 404 ok 30\r\n...\r\n[notice] 2017-05-03T22:57:38.881115Z node1@127.0.0.1 <0.343.0> -------- couch_replicator_clustering : publish cluster `stable` event\r\n[notice] 2017-05-03T22:57:38.881746Z node1@127.0.0.1 <0.398.0> -------- Started replicator db changes listener <0.769.0>\r\n[notice] 2017-05-03T22:57:38.916464Z node1@127.0.0.1 <0.348.0> -------- starting new replication `6e12fe920e76120ef871df8e18d208b0` at <0.811.0> (`http://127.0.0.1:15984/test_suite_db_dhrvtir/` -> `http://127.0.0.1:15984/nonexistent_test_db/`)\r\n[notice] 2017-05-03T22:57:38.916701Z node1@127.0.0.1 <0.349.0> -------- couch_replicator_scheduler: Job {\"6e12fe920e76120ef871df8e18d208b0\",[]} started as <0.811.0>\r\n[notice] 2017-05-03T22:57:38.918651Z node1@127.0.0.1 <0.309.0> 9e5593616e 127.0.0.1:15984 127.0.0.1 undefined GET /_scheduler/docs/foo_error_rep 404 ok 1\r\n[notice] 2017-05-03T22:57:38.970437Z node1@127.0.0.1 <0.309.0> bdd084312b 127.0.0.1:15984 127.0.0.1 undefined GET /_scheduler/docs/foo_error_rep 404 ok 1\r\n[notice] 2017-05-03T22:57:39.013987Z node1@127.0.0.1 <0.712.0> 0bab9a6ac6 127.0.0.1:15984 127.0.0.1 undefined GET /test_suite_db_dhrvtir/ 200 ok 81\r\n[notice] 2017-05-03T22:57:39.016448Z node1@127.0.0.1 <0.712.0> 116c67f1f5 127.0.0.1:15984 127.0.0.1 undefined GET /nonexistent_test_db/ 404 ok 1\r\n[error] 2017-05-03T22:57:39.018030Z node1@127.0.0.1 <0.811.0> -------- throw:{db_not_found,<<\"could not open http://127.0.0.1:15984/nonexistent_test_db/\">>}: Replication failed to start for args {rep,{\"6e12fe920e76120ef871df8e18d208b0\",[]},{httpdb,\"http://127.0.0.1:15984/test_suite_db_dhrvtir/\",nil,[{\"Accept\",\"application/json\"},{\"User-Agent\",\"CouchDB-Replicator/2.1.0-5cad2a4\"}],30000,[{socket_options,[{keepalive,true},{nodelay,false}]}],10,250,nil,20,nil,undefined},{httpdb,\"http://127.0.0.1:15984/nonexistent_test_db/\",nil,[{\"Accept\",\"application/json\"},{\"User-Agent\",\"CouchDB-Replicator/2.1.0-5cad2a4\"}],30000,[{socket_options,[{keepalive,true},{nodelay,false}]}],10,250,nil,20,nil,undefined},[{checkpoint_interval,30000},{connection_timeout,30000},{http_connections,20},{retries,10},{socket_options,[{keepalive,true},{nodelay,false}]},{use_checkpoints,true},{worker_batch_size,500},{worker_processes,4}],{user_ctx,null,[],undefined},db,nil,<<\"foo_error_rep\">>,<<\"shards/00000000-1fffffff/test_suite_db_hhyyrpqf/_replicator.1493852250\">>,{1493,852258,915293}}: [{couch_replicator_api_wrap,db_open,3,[{file,\"src/couch_replicator_api_wrap.erl\"},{line,109}]},{couch_replicator_scheduler_job,init_state,1,[{file,\"src/couch_replicator_scheduler_job.erl\"},{line,568}]},{couch_replicator_scheduler_job,do_init,1,[{file,\"src/couch_replicator_scheduler_job.erl\"},{line,127}]},{couch_replicator_scheduler_job,handle_info,2,[{file,\"src/couch_replicator_scheduler_job.erl\"},{line,357}]},{gen_server,handle_msg,5,[{file,\"gen_server.erl\"},{line,599}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,237}]}]\r\n[notice] 2017-05-03T22:57:39.022584Z node1@127.0.0.1 <0.309.0> 46149cd223 127.0.0.1:15984 127.0.0.1 undefined GET /_scheduler/docs/foo_error_rep 404 ok 1\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299063118/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299068632","html_url":"https://github.com/apache/couchdb/pull/505#issuecomment-299068632","issue_url":"https://api.github.com/repos/apache/couchdb/issues/505","id":299068632,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTA2ODYzMg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-04T00:03:42Z","updated_at":"2017-05-04T00:03:42Z","author_association":"CONTRIBUTOR","body":"@iilyak ah no worries, I assumed it needed TCO as well, so I think it was a useful exercise to understand how it works.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299068632/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299068678","html_url":"https://github.com/apache/couchdb/issues/506#issuecomment-299068678","issue_url":"https://api.github.com/repos/apache/couchdb/issues/506","id":299068678,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTA2ODY3OA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-04T00:04:02Z","updated_at":"2017-05-04T00:04:02Z","author_association":"MEMBER","body":"After investigation and chatting with you on IRC, I think this is because the standard JS harness is creating a custom replicator DB at `test_suite_db_<letters>%2F_replicator` and the scheduling replicator doesn't know what to do about that when a job fails.\r\n\r\nAfter PUTting a doc into that database, waiting the requisite time, and getting a failure, I did a `GET /_scheduler/docs` and get back: `{\"total_rows\":0,\"offset\":0,\"docs\":[]}` so I think my hunch is correct.\r\n\r\nIt also occurs to me that you're going to have to de-duplicate doc IDs from different _replicator databases so perhaps the right thing to do is to prepend the replicator DB's name to the doc ID if it's not the default `_replicator`. In this case that means I'd have to `GET /_scheduler/docs/test_suite_db_quzroaxh%2F_replicator/foo_error_rep` which is acceptable, if ugly.\r\n\r\nEdited log:\r\n```\r\n[notice] 2017-05-03T23:58:22.747195Z node1@127.0.0.1 <0.309.0> 9bde503c0a 127.0.0.1:15984 127.0.0.1 undefined PUT /test_suite_db_quzroaxh%2F_replicator/foo_error_rep 201 ok 136\r\n[notice] 2017-05-03T23:58:27.179010Z node1@127.0.0.1 <0.348.0> -------- starting new replication `8742b3ea46dfe82f96a36485f46c6738` at <0.639.0> (`http://127.0.0.1:15984/test_suite_db_euuinovc/` -> `http://127.0.0.1:15984/nonexistent_test_db/`)\r\n[notice] 2017-05-03T23:58:27.179239Z node1@127.0.0.1 <0.349.0> -------- couch_replicator_scheduler: Job {\"8742b3ea46dfe82f96a36485f46c6738\",[]} started as <0.639.0>\r\n[error] 2017-05-03T23:58:27.303437Z node1@127.0.0.1 <0.639.0> -------- throw:{db_not_found,<<\"could not open http://127.0.0.1:15984/nonexistent_test_db/\">>}: Replication failed to start for args {rep,{\"8742b3ea46dfe82f96a36485f46c6738\",[]},{httpdb,\"http://127.0.0.1:15984/test_suite_db_euuinovc/\",nil,[{\"Accept\",\"application/json\"},{\"User-Agent\",\"CouchDB-Replicator/2.1.0-5cad2a4\"}],30000,[{socket_options,[{keepalive,true},{nodelay,false}]}],10,250,nil,20,nil,undefined},{httpdb,\"http://127.0.0.1:15984/nonexistent_test_db/\",nil,[{\"Accept\",\"application/json\"},{\"User-Agent\",\"CouchDB-Replicator/2.1.0-5cad2a4\"}],30000,[{socket_options,[{keepalive,true},{nodelay,false}]}],10,250,nil,20,nil,undefined},[{checkpoint_interval,30000},{connection_timeout,30000},{http_connections,20},{retries,10},{socket_options,[{keepalive,true},{nodelay,false}]},{use_checkpoints,true},{worker_batch_size,500},{worker_processes,4}],{user_ctx,null,[],undefined},db,nil,<<\"foo_error_rep\">>,<<\"shards/00000000-1fffffff/test_suite_db_quzroaxh/_replicator.1493855893\">>,{1493,855907,177746}}: [{couch_replicator_api_wrap,db_open,3,[{file,\"src/couch_replicator_api_wrap.erl\"},{line,109}]},{couch_replicator_scheduler_job,init_state,1,[{file,\"src/couch_replicator_scheduler_job.erl\"},{line,568}]},{couch_replicator_scheduler_job,do_init,1,[{file,\"src/couch_replicator_scheduler_job.erl\"},{line,127}]},{couch_replicator_scheduler_job,handle_info,2,[{file,\"src/couch_replicator_scheduler_job.erl\"},{line,357}]},{gen_server,handle_msg,5,[{file,\"gen_server.erl\"},{line,599}]},{proc_lib,init_p_do_apply,3,[{file,\"proc_lib.erl\"},{line,237}]}]\r\n[notice] 2017-05-03T23:58:27.752731Z node1@127.0.0.1 <0.309.0> 6e697a45b0 127.0.0.1:15984 127.0.0.1 undefined GET /_scheduler/docs 200 ok 4\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299068678/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299138654","html_url":"https://github.com/apache/couchdb/pull/496#issuecomment-299138654","issue_url":"https://api.github.com/repos/apache/couchdb/issues/496","id":299138654,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTEzODY1NA==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-04T09:35:48Z","updated_at":"2017-05-22T08:56:12Z","author_association":"MEMBER","body":"Here are the steps to use this branch with a [couch_ngen](https://github.com/cloudant/couch_ngen)\r\nMost of this is obvious for someone experienced with Erlang development. But for someone like me who is not that familiar with erlang, I needed to complete all these steps.\r\n\r\n# Erlang dirty scheduler\r\n`couch_ngen` requires erlang with a dirty scheduler. So to install that on a mac:\r\n```\r\nbrew install kerl\r\nKERL_CONFIGURE_OPTIONS=--enable-dirty-schedulers kerl build 19.3 19.3-dirty\r\nkerl install 19.3-dirty /Users/username/kerl/19.3-dirty\r\n. /Users/username/kerl/19.3-dirty/activate\r\n```\r\n# Setup dependancies \r\nIn the CouchDB repo add these two lines to the `rebar.config.script` in the `DepDescs` section:\r\n\r\n```\r\n%% PSE\r\n{couch_ngen,  {url, \"https://github.com/cloudant/couch_ngen\"}, \"45c73d3d822e7cf42fbe60cd3e316f4ff12c2399\"},\r\n{nifile,  {url, \"https://github.com/cloudant/nifile\"}, \"d5f3b909846137f616cd5e754b810246802394e1\"},\r\n```\r\n\r\nThen run `rebar get-deps`. \r\n\r\n# Edit local.ini\r\n\r\nEdit `rel/overlay/etc/local.ini and add these settings in:\r\n```\r\n[couchdb]\r\ndefault_engine = bt_engine\r\n\r\n[couchdb_engines]\r\ncouch = couch_bt_engine\r\nngen = couch_ngen\r\n```\r\nThis sets up the list of supported engines and which is the default engine. If you change `default_engine=ngen` then that will be the default storage engine used.\r\n\r\n*Important to note*, don't add these settings to the bottom of the file if you are using `dev/run` it will break `dev/run`. Rather add it somewhere in the middle.\r\n\r\n# Build CouchDB\r\n\r\n`make clean && make` to build a new version\r\n\r\n# Run CouchDB\r\n\r\n`dev/run --with-haproxy -a tester:testerpass`\r\n\r\n# Create database with couch_ngen\r\nIf `couch_ngen` isn't the default storage engine. To create a database using that engine:\r\n\r\n```\r\ncurl -X PUT http://testuser:testpass@127.0.0.1:5984/testdbname?engine=ngen\r\n```\r\n\r\nBoom! You now have multiple storage engines running.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299138654/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299222303","html_url":"https://github.com/apache/couchdb/pull/496#issuecomment-299222303","issue_url":"https://api.github.com/repos/apache/couchdb/issues/496","id":299222303,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTIyMjMwMw==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-04T15:34:00Z","updated_at":"2017-05-04T15:34:00Z","author_association":"MEMBER","body":"Awesome, thanks for the notes @garrensmith!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299222303/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299289833","html_url":"https://github.com/apache/couchdb/pull/504#issuecomment-299289833","issue_url":"https://api.github.com/repos/apache/couchdb/issues/504","id":299289833,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTI4OTgzMw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-04T19:47:29Z","updated_at":"2017-05-04T19:51:17Z","author_association":"CONTRIBUTOR","body":"Made a script https://gist.github.com/nickva/b418ebf043fa93dfe2395f2d767d122d which creates views using a combination of various parameters.\r\n\r\nThis is an example of 2 runs, one the left is with this PR then on the right is master. \r\n\r\n[btree_patched.txt](https://github.com/apache/couchdb/files/977339/btree_patched.txt)\r\n\r\nThe script is adding 1000 documents, then varying `size `of emitted value - 10,1000, 10000, whether view should be queried after each inserted document or once at the end (`query`). Whether keys are ordered or random (`random_keys`) and a minimal key size (`min_key_size`). In case key is smaller than `min_key_size` it is expanded to be larger.\r\n\r\n\r\n\r\n(There is a better version of the script which generates a nicer output, will post that below when it finishes running https://gist.github.com/nickva/2304bc2f738769c15fac116b8453ec04)\r\n\r\nInteresting things to note:\r\n\r\n * For large emitted values and sequential keys this improves the size by more than 50% \r\n    12243075 vs 27463811      \r\n\r\n * With random keys sometime generated views are slightly larger\r\n\r\nOverall there is not significant increase in view_size and there is large ~increase~ decrease in some cases.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299289833/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299290283","html_url":"https://github.com/apache/couchdb/pull/504#issuecomment-299290283","issue_url":"https://api.github.com/repos/apache/couchdb/issues/504","id":299290283,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTI5MDI4Mw==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-04T19:49:30Z","updated_at":"2017-05-04T19:49:30Z","author_association":"MEMBER","body":"Did you mean large *decrease* on that last line?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299290283/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299491424","html_url":"https://github.com/apache/couchdb/pull/504#issuecomment-299491424","issue_url":"https://api.github.com/repos/apache/couchdb/issues/504","id":299491424,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTQ5MTQyNA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-05T15:10:52Z","updated_at":"2017-05-05T15:10:52Z","author_association":"CONTRIBUTOR","body":"Another set of tests ran with this version of the script:\r\n\r\nhttps://gist.github.com/nickva/2304bc2f738769c15fac116b8453ec04\r\n\r\n```\r\n./scripts/viewsize.py -n 1000 -s 10 -s 10000 -q true -q false -x true -x false -m 'function(d){emit(1,1);}' -m 'function(d){emit(\"K\"+d._id, d.v);}' -r \"\" -r \"_count\"\r\n\r\nPATCH              MASTER\r\n---------------    ---------------\r\nfile      dtavg    file      dtavg\r\n\r\n2367619   0.026    2424963   0.024   2.4%    size=10,query=True,random_keys=True,map_fun=function(d){emit(1,1);},reduce_fun=\r\n2560141   0.008    2392205   0.008   -7.0%   size=10,query=True,random_keys=True,map_fun=function(d){emit(1,1);},reduce_fun=_count\r\n2592899   0.027    2564227   0.021   -1.1%   size=10,query=True,random_keys=True,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=\r\n2601101   0.009    2564237   0.009   -1.4%   size=10,query=True,random_keys=True,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=_count\r\n577667    0.012    598147    0.020   3.4%    size=10,query=True,random_keys=False,map_fun=function(d){emit(1,1);},reduce_fun=\r\n581773    0.007    598157    0.008   2.7%    size=10,query=True,random_keys=False,map_fun=function(d){emit(1,1);},reduce_fun=_count\r\n880771    0.012    917635    0.013   4.0%    size=10,query=True,random_keys=False,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=\r\n880781    0.007    921741    0.007   4.4%    size=10,query=True,random_keys=False,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=_count\r\n180355    0.157    221315    0.168   18.5%   size=10,query=False,random_keys=True,map_fun=function(d){emit(1,1);},reduce_fun=\r\n229517    0.131    233613    0.139   1.8%    size=10,query=False,random_keys=True,map_fun=function(d){emit(1,1);},reduce_fun=_count\r\n299139    0.202    245891    0.182   -21.7%  size=10,query=False,random_keys=True,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=\r\n307341    0.154    307341    0.159   0.0%    size=10,query=False,random_keys=True,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=_count\r\n16515     0.115    16515     0.133   0.0%    size=10,query=False,random_keys=False,map_fun=function(d){emit(1,1);},reduce_fun=\r\n16525     0.103    16525     0.108   0.0%    size=10,query=False,random_keys=False,map_fun=function(d){emit(1,1);},reduce_fun=_count\r\n32899     0.119    32899     0.115   0.0%    size=10,query=False,random_keys=False,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=\r\n32909     0.104    32909     0.105   0.0%    size=10,query=False,random_keys=False,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=_count\r\n2371715   0.022    2400387   0.024   1.2%    size=10000,query=True,random_keys=True,map_fun=function(d){emit(1,1);},reduce_fun=\r\n2543757   0.009    2568333   0.009   1.0%    size=10000,query=True,random_keys=True,map_fun=function(d){emit(1,1);},reduce_fun=_count\r\n28131459  0.098    28356739  0.083   0.8%    size=10000,query=True,random_keys=True,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=\r\n28229773  0.013    28471437  0.014   0.8%    size=10000,query=True,random_keys=True,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=_count\r\n589955    0.021    598147    0.019   1.4%    size=10000,query=True,random_keys=False,map_fun=function(d){emit(1,1);},reduce_fun=\r\n585869    0.008    602253    0.008   2.7%    size=10000,query=True,random_keys=False,map_fun=function(d){emit(1,1);},reduce_fun=_count\r\n12251267  0.109    27328643  0.078   55.2%   size=10000,query=True,random_keys=False,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=\r\n12218509  0.011    27299981  0.012   55.2%   size=10000,query=True,random_keys=False,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=_count\r\n270467    0.649    270467    0.721   0.0%    size=10000,query=False,random_keys=True,map_fun=function(d){emit(1,1);},reduce_fun=\r\n266381    0.616    270477    0.612   1.5%    size=10000,query=False,random_keys=True,map_fun=function(d){emit(1,1);},reduce_fun=_count\r\n18886787  1.366    18673795  1.364   -1.1%   size=10000,query=False,random_keys=True,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=\r\n18854029  1.221    18800781  1.211   -0.3%   size=10000,query=False,random_keys=True,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=_count\r\n16515     0.587    16515     0.691   0.0%    size=10000,query=False,random_keys=False,map_fun=function(d){emit(1,1);},reduce_fun=\r\n16525     0.601    16525     0.579   0.0%    size=10000,query=False,random_keys=False,map_fun=function(d){emit(1,1);},reduce_fun=_count\r\n7590019   0.896    7757955   0.935   2.2%    size=10000,query=False,random_keys=False,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=\r\n7594125   0.795    7757965   0.774   2.1%    size=10000,query=False,random_keys=False,map_fun=function(d){emit(\"K\"+d._id, d.v);},reduce_fun=_count\r\n```\r\n\r\nThe observation is the same as above. Massive improvement in the case of large emit sizes and sequential keys. Small improvements in other cases where keys are not random. Biggest regression was in the case of:\r\n\r\n` -21.7%  size=10,query=False,random_keys=True`\r\n\r\nThat is small emit values, querying the view once at the end of all the updates and using random keys.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299491424/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299566233","html_url":"https://github.com/apache/couchdb/issues/502#issuecomment-299566233","issue_url":"https://api.github.com/repos/apache/couchdb/issues/502","id":299566233,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTU2NjIzMw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-05T20:21:12Z","updated_at":"2017-05-05T20:21:42Z","author_association":"MEMBER","body":"The error seems to occur especially when `max_dbs_open` is set extremely low, in this case `< q`. This is an edge case that we probably don't need to spend too much time on.\r\n\r\nRemoving this from the 2.1.0 milestone.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299566233/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299571445","html_url":"https://github.com/apache/couchdb/pull/475#issuecomment-299571445","issue_url":"https://api.github.com/repos/apache/couchdb/issues/475","id":299571445,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTU3MTQ0NQ==","user":{"login":"fkaempfer","id":2357885,"node_id":"MDQ6VXNlcjIzNTc4ODU=","avatar_url":"https://avatars.githubusercontent.com/u/2357885?v=4","gravatar_id":"","url":"https://api.github.com/users/fkaempfer","html_url":"https://github.com/fkaempfer","followers_url":"https://api.github.com/users/fkaempfer/followers","following_url":"https://api.github.com/users/fkaempfer/following{/other_user}","gists_url":"https://api.github.com/users/fkaempfer/gists{/gist_id}","starred_url":"https://api.github.com/users/fkaempfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkaempfer/subscriptions","organizations_url":"https://api.github.com/users/fkaempfer/orgs","repos_url":"https://api.github.com/users/fkaempfer/repos","events_url":"https://api.github.com/users/fkaempfer/events{/privacy}","received_events_url":"https://api.github.com/users/fkaempfer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-05T20:46:17Z","updated_at":"2017-05-05T20:46:17Z","author_association":"CONTRIBUTOR","body":"I have updated the PR. \r\n\r\nFor the three cases db compaction, view compaction and view cleanup, the calls in fabric now receive a response from the nodes and return an error in case of failure, instead of just sending the request and returning OK. \r\n\r\nI have also added the necessary security checks in couch_db.erl. These security checks cause tests to fail (for example couchdb_view_tests:compact_db), because they do not supply an admin context.\r\n\r\nLet me know what you think of the fixes. I'm new to erlang and couchdb source, so it's not unlikely there are some things I have missed.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299571445/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299573022","html_url":"https://github.com/apache/couchdb/issues/506#issuecomment-299573022","issue_url":"https://api.github.com/repos/apache/couchdb/issues/506","id":299573022,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTU3MzAyMg==","user":{"login":"sagelywizard","id":167249,"node_id":"MDQ6VXNlcjE2NzI0OQ==","avatar_url":"https://avatars.githubusercontent.com/u/167249?v=4","gravatar_id":"","url":"https://api.github.com/users/sagelywizard","html_url":"https://github.com/sagelywizard","followers_url":"https://api.github.com/users/sagelywizard/followers","following_url":"https://api.github.com/users/sagelywizard/following{/other_user}","gists_url":"https://api.github.com/users/sagelywizard/gists{/gist_id}","starred_url":"https://api.github.com/users/sagelywizard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sagelywizard/subscriptions","organizations_url":"https://api.github.com/users/sagelywizard/orgs","repos_url":"https://api.github.com/users/sagelywizard/repos","events_url":"https://api.github.com/users/sagelywizard/events{/privacy}","received_events_url":"https://api.github.com/users/sagelywizard/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-05T20:53:40Z","updated_at":"2017-05-05T20:53:40Z","author_association":"MEMBER","body":"Most sensible solution to me solution is to make two changes:\r\n\r\n1. add `GET /_scheduler/docs/:db/:doc` endpoint. `:db` would need to be URL-encoded for slashes. Should be a pretty straightforward change.\r\n2. make the `GET /_scheduler/docs` endpoint use a `couch_replicator_fabric:docs`-type function to make requests to shards of all known replicator DBs rather than just `_replicator`. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299573022/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299589912","html_url":"https://github.com/apache/couchdb/issues/499#issuecomment-299589912","issue_url":"https://api.github.com/repos/apache/couchdb/issues/499","id":299589912,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTU4OTkxMg==","user":{"login":"sagelywizard","id":167249,"node_id":"MDQ6VXNlcjE2NzI0OQ==","avatar_url":"https://avatars.githubusercontent.com/u/167249?v=4","gravatar_id":"","url":"https://api.github.com/users/sagelywizard","html_url":"https://github.com/sagelywizard","followers_url":"https://api.github.com/users/sagelywizard/followers","following_url":"https://api.github.com/users/sagelywizard/following{/other_user}","gists_url":"https://api.github.com/users/sagelywizard/gists{/gist_id}","starred_url":"https://api.github.com/users/sagelywizard/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sagelywizard/subscriptions","organizations_url":"https://api.github.com/users/sagelywizard/orgs","repos_url":"https://api.github.com/users/sagelywizard/repos","events_url":"https://api.github.com/users/sagelywizard/events{/privacy}","received_events_url":"https://api.github.com/users/sagelywizard/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-05T22:27:04Z","updated_at":"2017-05-05T22:27:04Z","author_association":"MEMBER","body":"Would it make more sense to use tags for that? I'm not super familiar with the release process, but it seems like we'd want \"next major/minor/patch release\" tags so the release-maker-person would know which issues are going into the next release (and then the tags could be changed to the release name). Milestones might be nice if we decide that certain issues are going to block a release from being pushed. Does that still happen post-2.0? I'm not sold on anything, just thinking.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299589912/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299590828","html_url":"https://github.com/apache/couchdb/issues/499#issuecomment-299590828","issue_url":"https://api.github.com/repos/apache/couchdb/issues/499","id":299590828,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTU5MDgyOA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-05T22:33:36Z","updated_at":"2017-05-05T22:39:55Z","author_association":"MEMBER","body":"The point of GitHub's milestones is to associate a milestone name, description, and optional due date with one or more issues. Milestones can also be open or closed. Typically I see milestones showing what work remains to get a release out the door - you get a nice little bargraph in the UI, for instance. But milestones could also be feature related.\r\n\r\nTags don't give you the bar graph or due date, and the tag space can get cluttered quickly (we already have 30 tags to choose from.) I'm nominally against using tags to coordinate releases as a result.\r\n\r\nIf we mirror what we've done in the past in JIRA, there are 2 scenarios where we've used the \"Fixed in release\" field that would match the GH Milestone function:\r\n\r\n1. To show we've fixed a reported bug and that it'll be patched in the next release\r\n2. To put a stake in the ground to say an issue is a release blocker\r\n3. Generating release notes\r\n\r\nIn that way I'm in favour of porting over exactly those 3 scenarios from JIRA \"Fixed in Release\" to GH Milestones.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299590828/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299729328","html_url":"https://github.com/apache/couchdb/pull/475#issuecomment-299729328","issue_url":"https://api.github.com/repos/apache/couchdb/issues/475","id":299729328,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTcyOTMyOA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-07T19:40:36Z","updated_at":"2017-05-07T19:40:36Z","author_association":"MEMBER","body":"Hi @fkaempfer.  A couple of things:\r\n\r\n1. You need to fix the EUnit test cases you just broke: https://travis-ci.org/apache/couchdb/builds/229280412 You'll also want to check the JavaScript test cases, you can run these with `make javascript`.\r\n2. We probably want a double-check from someone like @nickva to be sure we're not breaking things downstream from us (like Cloudant's alternative authentication layer.)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299729328/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299732919","html_url":"https://github.com/apache/couchdb/issues/508#issuecomment-299732919","issue_url":"https://api.github.com/repos/apache/couchdb/issues/508","id":299732919,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTczMjkxOQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-07T20:38:23Z","updated_at":"2017-05-07T20:38:23Z","author_association":"MEMBER","body":"Hi there,\r\n\r\nThis is a known issue we will address with the next release of CouchDB. For now, you will need to update the permissions of your C:\\CouchDB directory (and all children directories) to allow write access to whatever user is running your service.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299732919/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299737579","html_url":"https://github.com/apache/couchdb/pull/475#issuecomment-299737579","issue_url":"https://api.github.com/repos/apache/couchdb/issues/475","id":299737579,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTczNzU3OQ==","user":{"login":"fkaempfer","id":2357885,"node_id":"MDQ6VXNlcjIzNTc4ODU=","avatar_url":"https://avatars.githubusercontent.com/u/2357885?v=4","gravatar_id":"","url":"https://api.github.com/users/fkaempfer","html_url":"https://github.com/fkaempfer","followers_url":"https://api.github.com/users/fkaempfer/followers","following_url":"https://api.github.com/users/fkaempfer/following{/other_user}","gists_url":"https://api.github.com/users/fkaempfer/gists{/gist_id}","starred_url":"https://api.github.com/users/fkaempfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkaempfer/subscriptions","organizations_url":"https://api.github.com/users/fkaempfer/orgs","repos_url":"https://api.github.com/users/fkaempfer/repos","events_url":"https://api.github.com/users/fkaempfer/events{/privacy}","received_events_url":"https://api.github.com/users/fkaempfer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-07T21:50:34Z","updated_at":"2017-05-07T21:50:34Z","author_association":"CONTRIBUTOR","body":"Hi @wohali and thanks again.\r\n1. I have fixed the 3 failing calls to compact by opening the db as admin.  The Javascript test cases also pass fine.\r\n2. Yes absolutely. In any case it's good to have a third set of eyes on the code. Let me know if you want me to change something.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299737579/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299844250","html_url":"https://github.com/apache/couchdb/issues/508#issuecomment-299844250","issue_url":"https://api.github.com/repos/apache/couchdb/issues/508","id":299844250,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTg0NDI1MA==","user":{"login":"driglou","id":5339578,"node_id":"MDQ6VXNlcjUzMzk1Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/5339578?v=4","gravatar_id":"","url":"https://api.github.com/users/driglou","html_url":"https://github.com/driglou","followers_url":"https://api.github.com/users/driglou/followers","following_url":"https://api.github.com/users/driglou/following{/other_user}","gists_url":"https://api.github.com/users/driglou/gists{/gist_id}","starred_url":"https://api.github.com/users/driglou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/driglou/subscriptions","organizations_url":"https://api.github.com/users/driglou/orgs","repos_url":"https://api.github.com/users/driglou/repos","events_url":"https://api.github.com/users/driglou/events{/privacy}","received_events_url":"https://api.github.com/users/driglou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-08T11:39:21Z","updated_at":"2017-05-08T11:39:21Z","author_association":"NONE","body":"Thank you for quick response.\r\n\r\nI did what you said, however the problem still remains.\r\nI added full access the the C:\\CouchDB and its childrens, I restarted PC and but the issue still remains as it was.\r\nEither I need to do something more or I did not do exactly what you suggested me to do.\r\n\r\n![2](https://cloud.githubusercontent.com/assets/5339578/25802687/183b8676-33fc-11e7-8941-ec4e9f165cc5.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299844250/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299903832","html_url":"https://github.com/apache/couchdb/issues/506#issuecomment-299903832","issue_url":"https://api.github.com/repos/apache/couchdb/issues/506","id":299903832,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTkwMzgzMg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-08T15:38:45Z","updated_at":"2017-05-08T21:13:38Z","author_association":"CONTRIBUTOR","body":" 1. Yap. Can be done relatively simply. Also it looks like we could even allow un-escaped dbname and then rebuild the db name from path. The reason this is possible is because _replicator is not a valid document ID.\r\n\r\n2. This will be harder to implement. Currently _scheduler/docs mimics (and maybe ven shares some code with) `_all_docs`.  Doing a multi-db _all_docs kind of thing might be tricky, especially in respect to handling limit, offset, total_rows. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299903832/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299930506","html_url":"https://github.com/apache/couchdb/pull/504#issuecomment-299930506","issue_url":"https://api.github.com/repos/apache/couchdb/issues/504","id":299930506,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTkzMDUwNg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-08T17:16:39Z","updated_at":"2017-05-08T17:16:39Z","author_association":"CONTRIBUTOR","body":"After another update to script to make random keys the same size as sequential ones, I see that patched version wins most of the time.\r\n\r\nScript version:\r\n \r\nhttps://gist.github.com/nickva/2304bc2f738769c15fac116b8453ec04\r\n\r\n![patch_vs_master_same_size_keys](https://cloud.githubusercontent.com/assets/211822/25815943/7a8f1f2e-33f0-11e7-8c9b-fd7304119b06.png)\r\n\r\n+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299930506/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299951233","html_url":"https://github.com/apache/couchdb/pull/509#issuecomment-299951233","issue_url":"https://api.github.com/repos/apache/couchdb/issues/509","id":299951233,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTk1MTIzMw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-08T18:30:30Z","updated_at":"2017-05-08T18:30:47Z","author_association":"MEMBER","body":"What about a document in `_replicator` named `other%2f_replicator` ?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299951233/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299951757","html_url":"https://github.com/apache/couchdb/issues/508#issuecomment-299951757","issue_url":"https://api.github.com/repos/apache/couchdb/issues/508","id":299951757,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTk1MTc1Nw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-08T18:32:27Z","updated_at":"2017-05-08T18:32:27Z","author_association":"MEMBER","body":"Try adding the \"LOCAL SERVICE\" account and give it full control. Users shouldn't have it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299951757/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299970364","html_url":"https://github.com/apache/couchdb/issues/508#issuecomment-299970364","issue_url":"https://api.github.com/repos/apache/couchdb/issues/508","id":299970364,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTk3MDM2NA==","user":{"login":"driglou","id":5339578,"node_id":"MDQ6VXNlcjUzMzk1Nzg=","avatar_url":"https://avatars.githubusercontent.com/u/5339578?v=4","gravatar_id":"","url":"https://api.github.com/users/driglou","html_url":"https://github.com/driglou","followers_url":"https://api.github.com/users/driglou/followers","following_url":"https://api.github.com/users/driglou/following{/other_user}","gists_url":"https://api.github.com/users/driglou/gists{/gist_id}","starred_url":"https://api.github.com/users/driglou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/driglou/subscriptions","organizations_url":"https://api.github.com/users/driglou/orgs","repos_url":"https://api.github.com/users/driglou/repos","events_url":"https://api.github.com/users/driglou/events{/privacy}","received_events_url":"https://api.github.com/users/driglou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-08T19:44:31Z","updated_at":"2017-05-08T19:44:31Z","author_association":"NONE","body":"The problem still remains exactly as it was.\r\n\r\nIs there anything more I can do?\r\n\r\nAlso before when I installed CouchDB for the first time few month ago, everything was working perfectly out of the box, it was still v2 at that time I think. How can I make sure to have clean install of it?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299970364/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299997999","html_url":"https://github.com/apache/couchdb/pull/509#issuecomment-299997999","issue_url":"https://api.github.com/repos/apache/couchdb/issues/509","id":299997999,"node_id":"MDEyOklzc3VlQ29tbWVudDI5OTk5Nzk5OQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-08T21:36:13Z","updated_at":"2017-05-09T01:30:04Z","author_association":"CONTRIBUTOR","body":"@wohali \r\n\r\nArgh! You're right. \r\n\r\nHmm, what if user wants to query a particular document they have to always specify the database?\r\n\r\nSo `/docid` case should go away and it's always `/:db/:doc`. That removes the ambiguity between \r\n`/other%2f_replicator` being a document in the default `_replicator` db or `other/_replicator` database.\r\n\r\nThis would still be consistent with `_scheduler/docs` output in a way as there we always tell the user the database:\r\n\r\n```\r\n        {\r\n            \"docs\": [\r\n                {\r\n                    \"database\": \"_replicator\",\r\n                    \"doc_id\": \"cdyno-0000001-0000002\",\r\n                    ....\r\n               }\r\n           ]\r\n      }\r\n```\r\n\r\nSo they would also specify it the database when querying for a particular doc.\r\n\r\n`_scheduler/docs/_replicator/cdyno-0000001-0000002` in this case.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/299997999/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300035655","html_url":"https://github.com/apache/couchdb/pull/509#issuecomment-300035655","issue_url":"https://api.github.com/repos/apache/couchdb/issues/509","id":300035655,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDAzNTY1NQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-09T01:27:31Z","updated_at":"2017-05-09T01:27:31Z","author_association":"MEMBER","body":"👍 do it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300035655/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300045928","html_url":"https://github.com/apache/couchdb/pull/510#issuecomment-300045928","issue_url":"https://api.github.com/repos/apache/couchdb/issues/510","id":300045928,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDA0NTkyOA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-09T02:43:08Z","updated_at":"2017-05-09T02:43:08Z","author_association":"MEMBER","body":"Reminder to myself that if we agree to do this in 2.x, we might want to do it in the 1.6.x branch as well.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300045928/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300087051","html_url":"https://github.com/apache/couchdb/pull/509#issuecomment-300087051","issue_url":"https://api.github.com/repos/apache/couchdb/issues/509","id":300087051,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDA4NzA1MQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-09T07:43:15Z","updated_at":"2017-05-09T07:43:15Z","author_association":"CONTRIBUTOR","body":"@wohali \r\n\r\nUpdated to handle the ambiguous case better. Take a look, see what you think!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300087051/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300294261","html_url":"https://github.com/apache/couchdb/pull/509#issuecomment-300294261","issue_url":"https://api.github.com/repos/apache/couchdb/issues/509","id":300294261,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDI5NDI2MQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-09T20:39:01Z","updated_at":"2017-05-09T20:39:01Z","author_association":"MEMBER","body":":+1: please merge! (or rebase and merge or whatever) 🐕  🥇 🍤 ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300294261/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300294473","html_url":"https://github.com/apache/couchdb/issues/506#issuecomment-300294473","issue_url":"https://api.github.com/repos/apache/couchdb/issues/506","id":300294473,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDI5NDQ3Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-09T20:39:51Z","updated_at":"2017-05-09T20:39:51Z","author_association":"MEMBER","body":"Fixed by #509.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300294473/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300310871","html_url":"https://github.com/apache/couchdb/pull/504#issuecomment-300310871","issue_url":"https://api.github.com/repos/apache/couchdb/issues/504","id":300310871,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDMxMDg3MQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-09T21:44:27Z","updated_at":"2017-05-09T21:44:27Z","author_association":"MEMBER","body":"Closing this in favor of #512 which covers more than just KV nodes and is in all ways better.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300310871/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300320535","html_url":"https://github.com/apache/couchdb/pull/512#issuecomment-300320535","issue_url":"https://api.github.com/repos/apache/couchdb/issues/512","id":300320535,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDMyMDUzNQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-09T22:30:47Z","updated_at":"2017-05-09T22:30:47Z","author_association":"CONTRIBUTOR","body":"Wrote this script:\r\n\r\nhttps://gist.github.com/nickva/2304bc2f738769c15fac116b8453ec04\r\n\r\nTo check view sizes for various combinations of parameters. The script was run like this:\r\n\r\n```\r\n ./viewsize.py -n 1000 -s 10 -s 10000 -q true -q false -x true -x false -m 'function(d){emit(1,1);}' -m 'function(d){emit(\"K\"+d._id,d.v);}'\r\n```\r\nThat roughly means \"Write 1000 documents. Check emit sizes: 10 and 10k. Query after every insert and query at the end (`-q`). Using random and then sequential keys (`-x`). Emit the document ids and generated value, and also try a trivial example where key = 1 and value = 1 (`-m`)\". The script will generates all combinations of those parameters automatically.\r\n\r\nScript was run on master code and on the PR branch. These are the results:\r\n\r\n![pr_vs_master](https://cloud.githubusercontent.com/assets/211822/25875249/6a7ea1f0-34e4-11e7-8105-6e18f344aed7.png)\r\n\r\n`PR` and `MASTER` columns show file sizes in bytes as reported by views' `_info` endpoint. Regressions if they were any would have been shown in red in the percentage column.\r\n\r\nThis PR shows a dramatic (20-55%) improvement in disk usage without any detected regressions.\r\n\r\nGreat work @davisp !\r\n\r\n+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300320535/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300533707","html_url":"https://github.com/apache/couchdb/pull/492#issuecomment-300533707","issue_url":"https://api.github.com/repos/apache/couchdb/issues/492","id":300533707,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDUzMzcwNw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-10T16:13:30Z","updated_at":"2017-05-10T16:13:30Z","author_association":"CONTRIBUTOR","body":"```\r\n    Running test function(s):\r\n      mem3_shards:mem3_shards_changes_test_/0\r\n======================== EUnit ========================\r\nTest mem3_shards changes listener\r\n  mem3_shards:765: should_kill_changes_listener_on_shutdown...[0.014 s] ok\r\n  [done in 0.017 s]\r\n=======================================================\r\n  Test passed.\r\n==> rel (eunit)\r\n```\r\n\r\nSaw you made changes @iilyak suggested. I didn't know we had that test_util function either, so learned something new.\r\n\r\nTest passes.\r\n\r\n+1\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300533707/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300536273","html_url":"https://github.com/apache/couchdb/pull/512#issuecomment-300536273","issue_url":"https://api.github.com/repos/apache/couchdb/issues/512","id":300536273,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDUzNjI3Mw==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-10T16:22:34Z","updated_at":"2017-05-10T16:40:29Z","author_association":"MEMBER","body":"I've ran a separate test comparing view disk size difference between master and this PR. My setup is a single view index emitting pseudo-random value of fixed size 32k with pre-generated sequential and (on a second run) random keys. I've inserted 10000 documents in one-by-one fashion, triggering view reindexing after each insert to maximize number of changes for view's btree. Index sizes were taken after each 10 inserts as reported by `_info` endpoint.\r\n\r\nThe results are pretty impressive. I see 129% of disk size improvement for sequential keys and 51% disk size improvement for random keys. Obviously this is an extreme setup done to maximize \"garbage\" and emphasize effect of this patch, in real life the numbers are going to be more humble, but still this is a great improvement. [Here is the complete jupiter's notebook with results](https://cdn.rawgit.com/eiri/d6a5abc7dbf180eabf965fe54cf5a215/raw/bc4704c634b82301d6077dc5308bad3c4c20fa3b/Compare%20view%20sizes%20for%20COUCHDB-3298.html)\r\n\r\nOut of curiosity I've ran btree analysis on final view index for each case, to calculate number of kp and kv nodes and max and min length of the nodes per branch/leaf. Here the results:\r\n\r\nSequential keys:\r\nView's btree before:\r\n`{\r\n  \"depth\": 4,\r\n  \"kp_nodes\": {\r\n    \"count\": 209,\r\n    \"min\": 8,\r\n    \"max\": 25\r\n  },\r\n  \"kv_nodes\": {\r\n    \"count\": 5000,\r\n    \"min\": 2,\r\n    \"max\": 25\r\n  }\r\n}`\r\n\r\nView's btree after the patch:\r\n`{\r\n   \"depth\": 5,\r\n   \"kp_nodes\": {\r\n     \"count\": 419,\r\n     \"min\": 3,\r\n     \"max\": 13\r\n   },\r\n   \"kv_nodes\": {\r\n     \"count\": 5001,\r\n     \"min\": 1,\r\n     \"max\": 13\r\n   }\r\n}`\r\n\r\nRandom keys:\r\nView's btree before:\r\n`{\r\n  \"depth\": 6,\r\n  \"kp_nodes\": {\r\n    \"count\": 865,\r\n    \"min\": 2,\r\n    \"max\": 18\r\n  },\r\n  \"kv_nodes\": {\r\n    \"count\": 4286,\r\n    \"min\": 2,\r\n    \"max\": 18\r\n  }\r\n}`\r\n\r\nView's btree after the patch:\r\n`{\r\n  \"depth\": 5,\r\n  \"kp_nodes\": {\r\n    \"count\": 833,\r\n    \"min\": 1,\r\n    \"max\": 16\r\n  },\r\n  \"kv_nodes\": {\r\n    \"count\": 5480,\r\n    \"min\": 1,\r\n    \"max\": 16\r\n  }\r\n}`\r\n\r\nI second Nick, this is a great work!\r\n\r\n+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300536273/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300541050","html_url":"https://github.com/apache/couchdb/pull/512#issuecomment-300541050","issue_url":"https://api.github.com/repos/apache/couchdb/issues/512","id":300541050,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDU0MTA1MA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-10T16:38:53Z","updated_at":"2017-05-10T16:38:53Z","author_association":"MEMBER","body":"For reference, cfcheck is a tool we wrote to analyze trees in databases and views and I've just realized its not open source which is silly since its just bits of couchdb extracted so we could run it while a server was online. Am now trying to figure out how many lawyers it'll take for me to open that up.\r\n\r\nThe numbers have their obvious meaning. If this IBM process turns into a thing I'll make a gist that does the same counting in a remsh if anyone is curious.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300541050/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300582599","html_url":"https://github.com/apache/couchdb/pull/510#issuecomment-300582599","issue_url":"https://api.github.com/repos/apache/couchdb/issues/510","id":300582599,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDU4MjU5OQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-10T19:06:22Z","updated_at":"2017-05-10T19:06:22Z","author_association":"MEMBER","body":"> Reminder to myself that if we agree to do this in 2.x, we might want to do it in the 1.6.x branch as well.\r\n\r\n+1 ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300582599/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300637779","html_url":"https://github.com/apache/couchdb/pull/510#issuecomment-300637779","issue_url":"https://api.github.com/repos/apache/couchdb/issues/510","id":300637779,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDYzNzc3OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-10T23:09:40Z","updated_at":"2017-05-10T23:09:40Z","author_association":"MEMBER","body":"@janl Already done! https://github.com/apache/couchdb/commit/f073391aece76bbd0f90d7f74bb548753897a465","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300637779/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300658610","html_url":"https://github.com/apache/couchdb/pull/514#issuecomment-300658610","issue_url":"https://api.github.com/repos/apache/couchdb/issues/514","id":300658610,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDY1ODYxMA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-11T01:39:53Z","updated_at":"2017-05-11T01:39:53Z","author_association":"MEMBER","body":"URL of the interesting failure document: http://couchdb-vm.apache.org:5984/ci_errorlogs/travis-couchdb-230990141-2017-05-11T01%3A02%3A46.653747\r\n\r\nCheck out the couchlog.tar.gz attachment.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300658610/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300660810","html_url":"https://github.com/apache/couchdb/pull/514#issuecomment-300660810","issue_url":"https://api.github.com/repos/apache/couchdb/issues/514","id":300660810,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDY2MDgxMA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-11T01:55:35Z","updated_at":"2017-05-11T01:56:03Z","author_association":"MEMBER","body":"Ironically, another test failed in the PR itself (couch compress failure):\r\n\r\nhttp://couchdb-vm.apache.org:5984/ci_errorlogs/travis-couchdb-230996527-2017-05-11T01%3A39%3A36.199020/couchlog.tar.gz\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300660810/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300694363","html_url":"https://github.com/apache/couchdb/pull/512#issuecomment-300694363","issue_url":"https://api.github.com/repos/apache/couchdb/issues/512","id":300694363,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDY5NDM2Mw==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-11T06:23:22Z","updated_at":"2017-05-11T06:23:22Z","author_association":"CONTRIBUTOR","body":"While I don't pretend to understand the details of the algorithm, I found the thorough description very helpful, especially the aside about how a btree update works. All eunit tests are passing for me. My only complaint is that I find `if` statements to be less easy to read than `case` statements.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300694363/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300817604","html_url":"https://github.com/apache/couchdb/pull/512#issuecomment-300817604","issue_url":"https://api.github.com/repos/apache/couchdb/issues/512","id":300817604,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDgxNzYwNA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-11T15:03:06Z","updated_at":"2017-05-11T15:03:06Z","author_association":"MEMBER","body":"Managed to not have to sacrifice a teddy bear to the legal department.\r\n\r\nhttps://github.com/cloudant-labs/cfcheck\r\n\r\nIts a fairly simple and obvious tool but its there for anyone that wants to play with it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300817604/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300845762","html_url":"https://github.com/apache/couchdb/pull/514#issuecomment-300845762","issue_url":"https://api.github.com/repos/apache/couchdb/issues/514","id":300845762,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDg0NTc2Mg==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-11T16:35:31Z","updated_at":"2017-05-11T16:35:31Z","author_association":"MEMBER","body":"+1 to the PR and to the HTTPSification if possible.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300845762/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300852921","html_url":"https://github.com/apache/couchdb/pull/515#issuecomment-300852921","issue_url":"https://api.github.com/repos/apache/couchdb/issues/515","id":300852921,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDg1MjkyMQ==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-11T17:01:52Z","updated_at":"2017-05-11T17:01:52Z","author_association":"CONTRIBUTOR","body":"@davisp : made the changes you suggested\r\n\r\n```\r\n[notice] 2017-05-11T16:56:25.382380Z node1@127.0.0.1 <0.1945.0> -------- Compaction swap for view /Users/tonysun/github/apache/couchdb/dev/lib/node1/data/.shards/00000000-1fffffff/testdb.1494473014_design/mrview/f39a9b2d4ad85d129c9a9b6d0018bb36.view 8296 4200\r\n\r\n[notice] 2017-05-11T16:59:19.584582Z node1@127.0.0.1 <0.826.0> -------- Compaction swap for db: /Users/tonysun/github/apache/couchdb/dev/lib/node1/data/shards/00000000-1fffffff/mydb.1494471596.couch 49305 16537\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300852921/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300854872","html_url":"https://github.com/apache/couchdb/pull/516#issuecomment-300854872","issue_url":"https://api.github.com/repos/apache/couchdb/issues/516","id":300854872,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMDg1NDg3Mg==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-11T17:09:22Z","updated_at":"2017-05-11T17:09:22Z","author_association":"MEMBER","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/300854872/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/301118357","html_url":"https://github.com/apache/couchdb/pull/512#issuecomment-301118357","issue_url":"https://api.github.com/repos/apache/couchdb/issues/512","id":301118357,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMTExODM1Nw==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-12T16:06:50Z","updated_at":"2017-05-12T16:06:50Z","author_association":"MEMBER","body":"Rebased and amended the commit subject that was out of date.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/301118357/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/301118579","html_url":"https://github.com/apache/couchdb/pull/495#issuecomment-301118579","issue_url":"https://api.github.com/repos/apache/couchdb/issues/495","id":301118579,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMTExODU3OQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-12T16:07:47Z","updated_at":"2017-05-12T16:07:47Z","author_association":"MEMBER","body":"Rebased onto master for the new replicator and couch_server work. Also squashed the few requested changes to their respective commits.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/301118579/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/301202995","html_url":"https://github.com/apache/couchdb/pull/495#issuecomment-301202995","issue_url":"https://api.github.com/repos/apache/couchdb/issues/495","id":301202995,"node_id":"MDEyOklzc3VlQ29tbWVudDMwMTIwMjk5NQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2017-05-12T22:50:15Z","updated_at":"2017-05-12T22:50:15Z","author_association":"CONTRIBUTOR","body":"This is a nice cleanup of code even outside the context of PSE. More functions instead of records everywhere, `couch_server` looks more sane, some new helpers in couch_db module.\r\n\r\nI ran couchdyno's replicator tests https://github.com/cloudant-labs/couchdyno/blob/master/README_tests.md \r\n\r\nThen a few custom scripts which do concurrent db and doc creations. Here is one of them:\r\n\r\nhttps://gist.github.com/nickva/d0e0813c7039ba824489fb017159f1be \r\n\r\nIt turns out 500 conflict errors is something we return on db creation sometimes, that was a surprise for me. But master behaves the same, so it's not an issue with this PR\r\n\r\nThen with  `./dev/run` setup killed `node3` and re-spawned it with master code and ran some tests on the mixed cluster.\r\n\r\nDidn't find any issues during testing\r\n\r\n+1\r\n\r\nNice work @davisp","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/301202995/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]