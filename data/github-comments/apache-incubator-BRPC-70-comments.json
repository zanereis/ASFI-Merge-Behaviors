[{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1891379296","html_url":"https://github.com/apache/brpc/issues/2506#issuecomment-1891379296","issue_url":"https://api.github.com/repos/apache/brpc/issues/2506","id":1891379296,"node_id":"IC_kwDOBhmkcs5wvChg","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-15T06:25:36Z","updated_at":"2024-01-15T06:25:36Z","author_association":"CONTRIBUTOR","body":"bRPC不支持windows哦","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1891379296/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1891553034","html_url":"https://github.com/apache/brpc/issues/2507#issuecomment-1891553034","issue_url":"https://api.github.com/repos/apache/brpc/issues/2507","id":1891553034,"node_id":"IC_kwDOBhmkcs5wvs8K","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-15T08:28:23Z","updated_at":"2024-01-15T08:28:23Z","author_association":"CONTRIBUTOR","body":"直接在pthread上执行就行了吧，有必要用bthread吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1891553034/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1891619650","html_url":"https://github.com/apache/brpc/issues/2507#issuecomment-1891619650","issue_url":"https://api.github.com/repos/apache/brpc/issues/2507","id":1891619650,"node_id":"IC_kwDOBhmkcs5wv9NC","user":{"login":"MJY-HUST","id":52315061,"node_id":"MDQ6VXNlcjUyMzE1MDYx","avatar_url":"https://avatars.githubusercontent.com/u/52315061?v=4","gravatar_id":"","url":"https://api.github.com/users/MJY-HUST","html_url":"https://github.com/MJY-HUST","followers_url":"https://api.github.com/users/MJY-HUST/followers","following_url":"https://api.github.com/users/MJY-HUST/following{/other_user}","gists_url":"https://api.github.com/users/MJY-HUST/gists{/gist_id}","starred_url":"https://api.github.com/users/MJY-HUST/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MJY-HUST/subscriptions","organizations_url":"https://api.github.com/users/MJY-HUST/orgs","repos_url":"https://api.github.com/users/MJY-HUST/repos","events_url":"https://api.github.com/users/MJY-HUST/events{/privacy}","received_events_url":"https://api.github.com/users/MJY-HUST/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-15T09:00:49Z","updated_at":"2024-01-15T09:03:11Z","author_association":"CONTRIBUTOR","body":"场景是：server中会处理一些io任务。每个pthread worker维护一个thread local IO_uring实例用于提交和收割IO，使用server收到rpc请求后直接基于bthread来处理，此时，对于每个pthread worker想维护一个定时任务，用于提交请求。\r\n如果可以直接在server 处理逻辑对应的pthread上执行绑定的bthread任务，可以避免额外线程的创建","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1891619650/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1891646836","html_url":"https://github.com/apache/brpc/issues/2507#issuecomment-1891646836","issue_url":"https://api.github.com/repos/apache/brpc/issues/2507","id":1891646836,"node_id":"IC_kwDOBhmkcs5wwD10","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-15T09:18:35Z","updated_at":"2024-01-15T09:18:35Z","author_association":"CONTRIBUTOR","body":"目前应该没法支持绑定处理请求的worker pthread。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1891646836/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1892181285","html_url":"https://github.com/apache/brpc/pull/1996#issuecomment-1892181285","issue_url":"https://api.github.com/repos/apache/brpc/issues/1996","id":1892181285,"node_id":"IC_kwDOBhmkcs5wyGUl","user":{"login":"fansehep","id":75058860,"node_id":"MDQ6VXNlcjc1MDU4ODYw","avatar_url":"https://avatars.githubusercontent.com/u/75058860?v=4","gravatar_id":"","url":"https://api.github.com/users/fansehep","html_url":"https://github.com/fansehep","followers_url":"https://api.github.com/users/fansehep/followers","following_url":"https://api.github.com/users/fansehep/following{/other_user}","gists_url":"https://api.github.com/users/fansehep/gists{/gist_id}","starred_url":"https://api.github.com/users/fansehep/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fansehep/subscriptions","organizations_url":"https://api.github.com/users/fansehep/orgs","repos_url":"https://api.github.com/users/fansehep/repos","events_url":"https://api.github.com/users/fansehep/events{/privacy}","received_events_url":"https://api.github.com/users/fansehep/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-15T13:30:20Z","updated_at":"2024-01-15T13:30:20Z","author_association":"CONTRIBUTOR","body":"> Any chance to support protobuf 3.21.9 Tensorflow 2.15.0 not Compatible with protobuf 3.19.1\r\n> \r\n> Simply change the protobuf version got this error message\r\n> \r\n> ERROR: brpc/example/BUILD.bazel:40:14: every rule of type proto_library implicitly depends upon the target '@com_google_protobuf//:protoc', but this target could not be found because of: error loading package '@com_google_protobuf//': cannot load '@com_google_protobuf//:compiler_config_setting.bzl': no such file\r\n\r\n`Problems with rhombic dependence`, Can try change the build stricp brpc protobuf name to fix it. ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1892181285/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1893987978","html_url":"https://github.com/apache/brpc/pull/2505#issuecomment-1893987978","issue_url":"https://api.github.com/repos/apache/brpc/issues/2505","id":1893987978,"node_id":"IC_kwDOBhmkcs5w4_aK","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-16T15:33:48Z","updated_at":"2024-01-16T15:33:48Z","author_association":"CONTRIBUTOR","body":"> 这个要考虑成为memory service么？(/memory)，那样的话似乎比较适合以后适配新的allocator\r\n\r\n已经改成memory service","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1893987978/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1894806712","html_url":"https://github.com/apache/brpc/issues/2315#issuecomment-1894806712","issue_url":"https://api.github.com/repos/apache/brpc/issues/2315","id":1894806712,"node_id":"IC_kwDOBhmkcs5w8HS4","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-17T01:52:21Z","updated_at":"2024-01-17T01:52:21Z","author_association":"CONTRIBUTOR","body":"@wwbmmm 这个问题我最近想出一个方案来解决，想和你讨论一下：\r\n现在启动bthread如果加上BTHREAD_INHERIT_SPAN标志，bthread会继承span，为了修复这个问题，简单的方法是在创建bthread的时候，如果有BTHREAD_INHERIT_SPAN这个标志，就执行一次Span::CreateClientSpan，创建一个client span，让这个client span成为m->local_storage.rpcz_parent_span。\r\n这样做的\r\n优势在于，创建span仍然是能够完全规避了线程竞争，所以对性能应该很友好。\r\n缺点在于，会增加一些span的数量。\r\n实现难度很低，但是也会有个问题，就是需要在bthread层面调用Span::CreateClientSpan，但是Span::CreateClientSpan是在brpc这个层面上，代码调用关系可能有些不合理。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1894806712/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1894821458","html_url":"https://github.com/apache/brpc/pull/2509#issuecomment-1894821458","issue_url":"https://api.github.com/repos/apache/brpc/issues/2509","id":1894821458,"node_id":"IC_kwDOBhmkcs5w8K5S","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-17T02:09:47Z","updated_at":"2024-01-17T02:09:47Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1894821458/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1894833757","html_url":"https://github.com/apache/brpc/pull/2493#issuecomment-1894833757","issue_url":"https://api.github.com/repos/apache/brpc/issues/2493","id":1894833757,"node_id":"IC_kwDOBhmkcs5w8N5d","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-17T02:25:15Z","updated_at":"2024-01-17T02:25:15Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1894833757/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1894837536","html_url":"https://github.com/apache/brpc/pull/2504#issuecomment-1894837536","issue_url":"https://api.github.com/repos/apache/brpc/issues/2504","id":1894837536,"node_id":"IC_kwDOBhmkcs5w8O0g","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-17T02:30:09Z","updated_at":"2024-01-17T02:30:09Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1894837536/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1894838704","html_url":"https://github.com/apache/brpc/pull/2505#issuecomment-1894838704","issue_url":"https://api.github.com/repos/apache/brpc/issues/2505","id":1894838704,"node_id":"IC_kwDOBhmkcs5w8PGw","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-17T02:31:46Z","updated_at":"2024-01-17T02:31:46Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1894838704/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1894841294","html_url":"https://github.com/apache/brpc/pull/2413#issuecomment-1894841294","issue_url":"https://api.github.com/repos/apache/brpc/issues/2413","id":1894841294,"node_id":"IC_kwDOBhmkcs5w8PvO","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-17T02:35:43Z","updated_at":"2024-01-17T02:35:43Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1894841294/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1895121010","html_url":"https://github.com/apache/brpc/pull/2358#issuecomment-1895121010","issue_url":"https://api.github.com/repos/apache/brpc/issues/2358","id":1895121010,"node_id":"IC_kwDOBhmkcs5w9UBy","user":{"login":"vinllen","id":6987398,"node_id":"MDQ6VXNlcjY5ODczOTg=","avatar_url":"https://avatars.githubusercontent.com/u/6987398?v=4","gravatar_id":"","url":"https://api.github.com/users/vinllen","html_url":"https://github.com/vinllen","followers_url":"https://api.github.com/users/vinllen/followers","following_url":"https://api.github.com/users/vinllen/following{/other_user}","gists_url":"https://api.github.com/users/vinllen/gists{/gist_id}","starred_url":"https://api.github.com/users/vinllen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vinllen/subscriptions","organizations_url":"https://api.github.com/users/vinllen/orgs","repos_url":"https://api.github.com/users/vinllen/repos","events_url":"https://api.github.com/users/vinllen/events{/privacy}","received_events_url":"https://api.github.com/users/vinllen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-17T06:46:40Z","updated_at":"2024-01-17T06:46:40Z","author_association":"NONE","body":"@yanglimingcn 大佬请教个问题，我在你代码基础上修改了一下，一个server内部分service，然后每个service绑定一个bthread group tag，收到消息后根据tag进行分发。现在有一个问题，发现bthread_count监控数值不对，比如3个tag，总和是对的，但是有些group tag不对，看起来应该是task原来在group1上运行，但是退出是跑到group2上：\r\n```\r\n# curl -s 127.0.0.1:47791/vars | grep bthread_count\r\nbthread_count : 14\r\nbthread_count_0 : 118431\r\nbthread_count_1 : 1\r\nbthread_count_2 : -118418\r\n```\r\n\r\n我的处理是在`void ProcessRpcRequest(InputMessageBase* msg_base)`函数中，在`svc->CallMethod`之前判断tag，然后进行分发到对应的tag：\r\n```\r\nvoid ProcessRpcRequest(InputMessageBase* msg_base) {\r\n    ....\r\n    if (!FLAGS_usercode_in_pthread) {\r\n            // check bthread worker tag\r\n            LOG(WARNING) << \"bthread tag: \" << mp->bthread_worker_tag << \", service_name:\" << svc_name << \", method_name:\" << mp->method->name() << std::endl;\r\n            if (mp->bthread_worker_tag != BTHREAD_TAG_DEFAULT) {\r\n                bthread_t th;\r\n                bthread_attr_t attr = BTHREAD_ATTR_NORMAL;\r\n                attr.tag = mp->bthread_worker_tag;\r\n\r\n                bthread::CountdownEvent event(1);\r\n                auto func = [method, &cntl, &req, &res, done, svc, &event]() {\r\n                    svc->CallMethod(method, cntl.release(),\r\n                                    req.release(), res.release(), done);\r\n                    event.signal();\r\n                };\r\n                std::function<void()> func_cp(func);\r\n                LOG(WARNING) << \"BthreadCallMethodRun before\";\r\n                int ret = bthread_start_background(&th, &attr, BthreadCallMethodRun, &func_cp);\r\n                // int ret = 0;\r\n                // (*BthreadCallMethodRun)(&func_cp);\r\n                LOG(WARNING) << \"BthreadCallMethodRun ret: \" << ret;\r\n                event.wait();\r\n                LOG(WARNING) << \"BthreadCallMethodRun after wait: \" << ret;\r\n                if (ret != 0) {\r\n                    LOG(FATAL) << \"Fail to start bthread_worker_tag\";\r\n                    // return svc->CallMethod(method, cntl.release(),\r\n                    //                        req.release(), res.release(), done);\r\n                }\r\n                return;\r\n            } else {\r\n                return svc->CallMethod(method, cntl.release(),\r\n                                       req.release(), res.release(), done);\r\n            }\r\n        }\r\n}\r\n```\r\ntag是service注册时打上的。\r\n大佬帮忙看看是我修改的问题哪里没考虑到吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1895121010/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1895586701","html_url":"https://github.com/apache/brpc/pull/2358#issuecomment-1895586701","issue_url":"https://api.github.com/repos/apache/brpc/issues/2358","id":1895586701,"node_id":"IC_kwDOBhmkcs5w_FuN","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-17T11:07:21Z","updated_at":"2024-01-17T11:10:26Z","author_association":"CONTRIBUTOR","body":"> @yanglimingcn 大佬请教个问题，我在你代码基础上修改了一下，一个server内部分service，然后每个service绑定一个bthread group tag，收到消息后根据tag进行分发。现在有一个问题，发现bthread_count监控数值不对，比如3个tag，总和是对的，但是有些group tag不对，看起来应该是task原来在group1上运行，但是退出是跑到group2上：\r\n> \r\n> ```\r\n> # curl -s 127.0.0.1:47791/vars | grep bthread_count\r\n> bthread_count : 14\r\n> bthread_count_0 : 118431\r\n> bthread_count_1 : 1\r\n> bthread_count_2 : -118418\r\n> ```\r\n> \r\n> 我的处理是在`void ProcessRpcRequest(InputMessageBase* msg_base)`函数中，在`svc->CallMethod`之前判断tag，然后进行分发到对应的tag：\r\n> \r\n> ```\r\n> void ProcessRpcRequest(InputMessageBase* msg_base) {\r\n>     ....\r\n>     if (!FLAGS_usercode_in_pthread) {\r\n>             // check bthread worker tag\r\n>             LOG(WARNING) << \"bthread tag: \" << mp->bthread_worker_tag << \", service_name:\" << svc_name << \", method_name:\" << mp->method->name() << std::endl;\r\n>             if (mp->bthread_worker_tag != BTHREAD_TAG_DEFAULT) {\r\n>                 bthread_t th;\r\n>                 bthread_attr_t attr = BTHREAD_ATTR_NORMAL;\r\n>                 attr.tag = mp->bthread_worker_tag;\r\n> \r\n>                 bthread::CountdownEvent event(1);\r\n>                 auto func = [method, &cntl, &req, &res, done, svc, &event]() {\r\n>                     svc->CallMethod(method, cntl.release(),\r\n>                                     req.release(), res.release(), done);\r\n>                     event.signal();\r\n>                 };\r\n>                 std::function<void()> func_cp(func);\r\n>                 LOG(WARNING) << \"BthreadCallMethodRun before\";\r\n>                 int ret = bthread_start_background(&th, &attr, BthreadCallMethodRun, &func_cp);\r\n>                 // int ret = 0;\r\n>                 // (*BthreadCallMethodRun)(&func_cp);\r\n>                 LOG(WARNING) << \"BthreadCallMethodRun ret: \" << ret;\r\n>                 event.wait();\r\n>                 LOG(WARNING) << \"BthreadCallMethodRun after wait: \" << ret;\r\n>                 if (ret != 0) {\r\n>                     LOG(FATAL) << \"Fail to start bthread_worker_tag\";\r\n>                     // return svc->CallMethod(method, cntl.release(),\r\n>                     //                        req.release(), res.release(), done);\r\n>                 }\r\n>                 return;\r\n>             } else {\r\n>                 return svc->CallMethod(method, cntl.release(),\r\n>                                        req.release(), res.release(), done);\r\n>             }\r\n>         }\r\n> }\r\n> ```\r\n> \r\n> tag是service注册时打上的。 大佬帮忙看看是我修改的问题哪里没考虑到吗？\r\n\r\n你这个func_cp里面执行什么内容了呢，如果执行done->Run可能会有tag切换吧，因为你这么改的话，epoll_wait这个线程只能属于tag0吧，所以它的执行上下文都是tag0的。\r\nhttps://github.com/apache/brpc/pull/2476 这个PR你代码里面合入了吗？\r\n你可以分段调试一下，比如 func_cp里面，先答应一下bthread_self_tag()，不执行别的，没问题，再执行done->Run，看看问题发生在哪个阶段","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1895586701/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1895596634","html_url":"https://github.com/apache/brpc/issues/2478#issuecomment-1895596634","issue_url":"https://api.github.com/repos/apache/brpc/issues/2478","id":1895596634,"node_id":"IC_kwDOBhmkcs5w_IJa","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-17T11:13:55Z","updated_at":"2024-01-17T11:13:55Z","author_association":"CONTRIBUTOR","body":"我修改一下","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1895596634/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1895942738","html_url":"https://github.com/apache/brpc/issues/2507#issuecomment-1895942738","issue_url":"https://api.github.com/repos/apache/brpc/issues/2507","id":1895942738,"node_id":"IC_kwDOBhmkcs5xAcpS","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-17T14:36:31Z","updated_at":"2024-01-17T14:36:31Z","author_association":"CONTRIBUTOR","body":"> 场景是：server中会处理一些io任务。每个pthread worker维护一个thread local IO_uring实例用于提交和收割IO，使用server收到rpc请求后直接基于bthread来处理，此时，对于每个pthread worker想维护一个定时任务，用于提交请求。 如果可以直接在server 处理逻辑对应的pthread上执行绑定的bthread任务，可以避免额外线程的创建\r\n\r\n为啥要一个定时器提交请求，收到rpc请求，直接提交到当前thread local的io_uring就可以了吧","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1895942738/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1897706695","html_url":"https://github.com/apache/brpc/issues/2507#issuecomment-1897706695","issue_url":"https://api.github.com/repos/apache/brpc/issues/2507","id":1897706695,"node_id":"IC_kwDOBhmkcs5xHLTH","user":{"login":"MJY-HUST","id":52315061,"node_id":"MDQ6VXNlcjUyMzE1MDYx","avatar_url":"https://avatars.githubusercontent.com/u/52315061?v=4","gravatar_id":"","url":"https://api.github.com/users/MJY-HUST","html_url":"https://github.com/MJY-HUST","followers_url":"https://api.github.com/users/MJY-HUST/followers","following_url":"https://api.github.com/users/MJY-HUST/following{/other_user}","gists_url":"https://api.github.com/users/MJY-HUST/gists{/gist_id}","starred_url":"https://api.github.com/users/MJY-HUST/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MJY-HUST/subscriptions","organizations_url":"https://api.github.com/users/MJY-HUST/orgs","repos_url":"https://api.github.com/users/MJY-HUST/repos","events_url":"https://api.github.com/users/MJY-HUST/events{/privacy}","received_events_url":"https://api.github.com/users/MJY-HUST/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T03:14:12Z","updated_at":"2024-01-18T03:14:12Z","author_association":"CONTRIBUTOR","body":"> > 场景是：server中会处理一些io任务。每个pthread worker维护一个thread local IO_uring实例用于提交和收割IO，使用server收到rpc请求后直接基于bthread来处理，此时，对于每个pthread worker想维护一个定时任务，用于提交请求。 如果可以直接在server 处理逻辑对应的pthread上执行绑定的bthread任务，可以避免额外线程的创建\r\n> \r\n> 为啥要一个定时器提交请求，收到rpc请求，直接提交到当前thread local的io_uring就可以了吧\r\n\r\n说错了，是收割请求。整体的逻辑是提交请求后让bthread sleep，然后收割请求后使用bthread_t来唤醒sleep的bthread继续执行。想让每个task group 所在的pthread固定周期执行收割请求的任务。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1897706695/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1897863838","html_url":"https://github.com/apache/brpc/issues/2315#issuecomment-1897863838","issue_url":"https://api.github.com/repos/apache/brpc/issues/2315","id":1897863838,"node_id":"IC_kwDOBhmkcs5xHxqe","user":{"login":"fausturs","id":25004087,"node_id":"MDQ6VXNlcjI1MDA0MDg3","avatar_url":"https://avatars.githubusercontent.com/u/25004087?v=4","gravatar_id":"","url":"https://api.github.com/users/fausturs","html_url":"https://github.com/fausturs","followers_url":"https://api.github.com/users/fausturs/followers","following_url":"https://api.github.com/users/fausturs/following{/other_user}","gists_url":"https://api.github.com/users/fausturs/gists{/gist_id}","starred_url":"https://api.github.com/users/fausturs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fausturs/subscriptions","organizations_url":"https://api.github.com/users/fausturs/orgs","repos_url":"https://api.github.com/users/fausturs/repos","events_url":"https://api.github.com/users/fausturs/events{/privacy}","received_events_url":"https://api.github.com/users/fausturs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T06:09:46Z","updated_at":"2024-01-18T06:09:46Z","author_association":"NONE","body":"> 优势在于，创建span仍然是能够完全规避了线程竞争，所以对性能应该很友好。\r\n\r\n这个修改没有想象中那么简单，至少还涉及了rpcz相关的代码。这里会出现多个trace id，span id一样的span对象。\r\n那么存入leveldb时，可能要考虑是否合并到一起。\r\n如果不合并则要考虑rpcz的展示需要做一些修改。\r\n\r\n所以，加一个锁，或者一个lockfree的队列会来的更快。\r\n\r\n另外还注意到TRACEPRINTF这个宏其实可能也有线程安全问题，最终其实是调用到Span::Annotate这个函数。\r\n如果是多个线程同时写，则显然需要一个锁。\r\n\r\n所以总的来说，除非trace部分整体重新设计一遍，否则，使用锁是一个看上去更清晰的方案。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1897863838/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1897896527","html_url":"https://github.com/apache/brpc/pull/2512#issuecomment-1897896527","issue_url":"https://api.github.com/repos/apache/brpc/issues/2512","id":1897896527,"node_id":"IC_kwDOBhmkcs5xH5pP","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T06:46:38Z","updated_at":"2024-01-18T06:46:38Z","author_association":"NONE","body":"@wwbmmm @chenBright 麻烦帮忙review下","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1897896527/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1897980232","html_url":"https://github.com/apache/brpc/pull/2358#issuecomment-1897980232","issue_url":"https://api.github.com/repos/apache/brpc/issues/2358","id":1897980232,"node_id":"IC_kwDOBhmkcs5xIOFI","user":{"login":"vinllen","id":6987398,"node_id":"MDQ6VXNlcjY5ODczOTg=","avatar_url":"https://avatars.githubusercontent.com/u/6987398?v=4","gravatar_id":"","url":"https://api.github.com/users/vinllen","html_url":"https://github.com/vinllen","followers_url":"https://api.github.com/users/vinllen/followers","following_url":"https://api.github.com/users/vinllen/following{/other_user}","gists_url":"https://api.github.com/users/vinllen/gists{/gist_id}","starred_url":"https://api.github.com/users/vinllen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vinllen/subscriptions","organizations_url":"https://api.github.com/users/vinllen/orgs","repos_url":"https://api.github.com/users/vinllen/repos","events_url":"https://api.github.com/users/vinllen/events{/privacy}","received_events_url":"https://api.github.com/users/vinllen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T08:01:27Z","updated_at":"2024-01-18T08:01:27Z","author_association":"NONE","body":"done我感觉应该没问题的，是跑在对应tag的bthread里面，这个func_cp就是调用服务端的代码了。我合一下 #2476 这个PR再试试","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1897980232/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1898157329","html_url":"https://github.com/apache/brpc/issues/2485#issuecomment-1898157329","issue_url":"https://api.github.com/repos/apache/brpc/issues/2485","id":1898157329,"node_id":"IC_kwDOBhmkcs5xI5UR","user":{"login":"duishuhaoqi","id":50567662,"node_id":"MDQ6VXNlcjUwNTY3NjYy","avatar_url":"https://avatars.githubusercontent.com/u/50567662?v=4","gravatar_id":"","url":"https://api.github.com/users/duishuhaoqi","html_url":"https://github.com/duishuhaoqi","followers_url":"https://api.github.com/users/duishuhaoqi/followers","following_url":"https://api.github.com/users/duishuhaoqi/following{/other_user}","gists_url":"https://api.github.com/users/duishuhaoqi/gists{/gist_id}","starred_url":"https://api.github.com/users/duishuhaoqi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duishuhaoqi/subscriptions","organizations_url":"https://api.github.com/users/duishuhaoqi/orgs","repos_url":"https://api.github.com/users/duishuhaoqi/repos","events_url":"https://api.github.com/users/duishuhaoqi/events{/privacy}","received_events_url":"https://api.github.com/users/duishuhaoqi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T09:59:04Z","updated_at":"2024-01-18T09:59:04Z","author_association":"NONE","body":"> 可以打开rpcz，然后在查询时根据lantecy进行过滤超过500ms的请求，一般来说很容易看到。另外可以检查以下代码里是否使用了brpc的timer功能并且在callback里使用了可能阻塞的代码（不管是阻塞bthread还是phtread都可能会导致这个问题）\r\n\r\n看了下bvar但是不清楚为什么负载这么高，此外还观察到了brpc的报错controller.cpp:327] timeout_ms is limited to 0x7fffffff (roughly 24 days)，不知道有没有关联","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1898157329/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1898158835","html_url":"https://github.com/apache/brpc/issues/2485#issuecomment-1898158835","issue_url":"https://api.github.com/repos/apache/brpc/issues/2485","id":1898158835,"node_id":"IC_kwDOBhmkcs5xI5rz","user":{"login":"duishuhaoqi","id":50567662,"node_id":"MDQ6VXNlcjUwNTY3NjYy","avatar_url":"https://avatars.githubusercontent.com/u/50567662?v=4","gravatar_id":"","url":"https://api.github.com/users/duishuhaoqi","html_url":"https://github.com/duishuhaoqi","followers_url":"https://api.github.com/users/duishuhaoqi/followers","following_url":"https://api.github.com/users/duishuhaoqi/following{/other_user}","gists_url":"https://api.github.com/users/duishuhaoqi/gists{/gist_id}","starred_url":"https://api.github.com/users/duishuhaoqi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duishuhaoqi/subscriptions","organizations_url":"https://api.github.com/users/duishuhaoqi/orgs","repos_url":"https://api.github.com/users/duishuhaoqi/repos","events_url":"https://api.github.com/users/duishuhaoqi/events{/privacy}","received_events_url":"https://api.github.com/users/duishuhaoqi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T09:59:58Z","updated_at":"2024-01-18T09:59:58Z","author_association":"NONE","body":"![image](https://github.com/apache/brpc/assets/50567662/76db2167-ab47-4417-94b0-392aafe53d5d)\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1898158835/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1898328926","html_url":"https://github.com/apache/brpc/issues/2485#issuecomment-1898328926","issue_url":"https://api.github.com/repos/apache/brpc/issues/2485","id":1898328926,"node_id":"IC_kwDOBhmkcs5xJjNe","user":{"login":"duishuhaoqi","id":50567662,"node_id":"MDQ6VXNlcjUwNTY3NjYy","avatar_url":"https://avatars.githubusercontent.com/u/50567662?v=4","gravatar_id":"","url":"https://api.github.com/users/duishuhaoqi","html_url":"https://github.com/duishuhaoqi","followers_url":"https://api.github.com/users/duishuhaoqi/followers","following_url":"https://api.github.com/users/duishuhaoqi/following{/other_user}","gists_url":"https://api.github.com/users/duishuhaoqi/gists{/gist_id}","starred_url":"https://api.github.com/users/duishuhaoqi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/duishuhaoqi/subscriptions","organizations_url":"https://api.github.com/users/duishuhaoqi/orgs","repos_url":"https://api.github.com/users/duishuhaoqi/repos","events_url":"https://api.github.com/users/duishuhaoqi/events{/privacy}","received_events_url":"https://api.github.com/users/duishuhaoqi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T11:47:59Z","updated_at":"2024-01-18T11:47:59Z","author_association":"NONE","body":"rpc_timeout_ms很长会导致bthread阻塞吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1898328926/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1898444623","html_url":"https://github.com/apache/brpc/issues/2315#issuecomment-1898444623","issue_url":"https://api.github.com/repos/apache/brpc/issues/2315","id":1898444623,"node_id":"IC_kwDOBhmkcs5xJ_dP","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T13:05:11Z","updated_at":"2024-01-18T13:05:11Z","author_association":"CONTRIBUTOR","body":"> > 优势在于，创建span仍然是能够完全规避了线程竞争，所以对性能应该很友好。\r\n> \r\n> 这个修改没有想象中那么简单，至少还涉及了rpcz相关的代码。这里会出现多个trace id，span id一样的span对象。 那么存入leveldb时，可能要考虑是否合并到一起。 如果不合并则要考虑rpcz的展示需要做一些修改。\r\n> \r\n> 所以，加一个锁，或者一个lockfree的队列会来的更快。\r\n> \r\n> 另外还注意到TRACEPRINTF这个宏其实可能也有线程安全问题，最终其实是调用到Span::Annotate这个函数。 如果是多个线程同时写，则显然需要一个锁。\r\n> \r\n> 所以总的来说，除非trace部分整体重新设计一遍，否则，使用锁是一个看上去更清晰的方案。\r\n\r\n单线程调用内部多次调用createClientSpan，这个应该不会造成重复spanId吧，多线程调用Annotate相当于多线程并发处理一个请求？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1898444623/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1898476775","html_url":"https://github.com/apache/brpc/issues/2507#issuecomment-1898476775","issue_url":"https://api.github.com/repos/apache/brpc/issues/2507","id":1898476775,"node_id":"IC_kwDOBhmkcs5xKHTn","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T13:25:40Z","updated_at":"2024-01-18T13:25:40Z","author_association":"CONTRIBUTOR","body":"> > > 场景是：server中会处理一些io任务。每个pthread worker维护一个thread local IO_uring实例用于提交和收割IO，使用server收到rpc请求后直接基于bthread来处理，此时，对于每个pthread worker想维护一个定时任务，用于提交请求。 如果可以直接在server 处理逻辑对应的pthread上执行绑定的bthread任务，可以避免额外线程的创建\r\n> > \r\n> > \r\n> > 为啥要一个定时器提交请求，收到rpc请求，直接提交到当前thread local的io_uring就可以了吧\r\n> \r\n> 说错了，是收割请求。整体的逻辑是提交请求后让bthread sleep，然后收割请求后使用bthread_t来唤醒sleep的bthread继续执行。想让每个task group 所在的pthread固定周期执行收割请求的任务。\r\n\r\n你专门启动一个专门的协程收割都有io_uring的请求？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1898476775/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1898497980","html_url":"https://github.com/apache/brpc/issues/2507#issuecomment-1898497980","issue_url":"https://api.github.com/repos/apache/brpc/issues/2507","id":1898497980,"node_id":"IC_kwDOBhmkcs5xKMe8","user":{"login":"MJY-HUST","id":52315061,"node_id":"MDQ6VXNlcjUyMzE1MDYx","avatar_url":"https://avatars.githubusercontent.com/u/52315061?v=4","gravatar_id":"","url":"https://api.github.com/users/MJY-HUST","html_url":"https://github.com/MJY-HUST","followers_url":"https://api.github.com/users/MJY-HUST/followers","following_url":"https://api.github.com/users/MJY-HUST/following{/other_user}","gists_url":"https://api.github.com/users/MJY-HUST/gists{/gist_id}","starred_url":"https://api.github.com/users/MJY-HUST/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MJY-HUST/subscriptions","organizations_url":"https://api.github.com/users/MJY-HUST/orgs","repos_url":"https://api.github.com/users/MJY-HUST/repos","events_url":"https://api.github.com/users/MJY-HUST/events{/privacy}","received_events_url":"https://api.github.com/users/MJY-HUST/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T13:38:39Z","updated_at":"2024-01-18T13:45:13Z","author_association":"CONTRIBUTOR","body":"> io_uring\r\n\r\n\r\n\r\n> > > > 场景是：server中会处理一些io任务。每个pthread worker维护一个thread local IO_uring实例用于提交和收割IO，使用server收到rpc请求后直接基于bthread来处理，此时，对于每个pthread worker想维护一个定时任务，用于提交请求。 如果可以直接在server 处理逻辑对应的pthread上执行绑定的bthread任务，可以避免额外线程的创建\r\n> > > \r\n> > > \r\n> > > 为啥要一个定时器提交请求，收到rpc请求，直接提交到当前thread local的io_uring就可以了吧\r\n> > \r\n> > \r\n> > 说错了，是收割请求。整体的逻辑是提交请求后让bthread sleep，然后收割请求后使用bthread_t来唤醒sleep的bthread继续执行。想让每个task group 所在的pthread固定周期执行收割请求的任务。\r\n> \r\n> 你专门启动一个专门的协程收割都有io_uring的请求？\r\n\r\n如果IO_uring是thread_local的话，协程如果收割要io_uring，则必须运行在对应的task group中，但是目前的协程可能会被其他task group steal。\r\n所以除非把IO_uring设置为全局的，然后再使用一个协程/线程来处理收割逻辑？\r\n如果基于bthread的task group来做的话，不太清楚是否有可行的方法","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1898497980/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1898584056","html_url":"https://github.com/apache/brpc/issues/2507#issuecomment-1898584056","issue_url":"https://api.github.com/repos/apache/brpc/issues/2507","id":1898584056,"node_id":"IC_kwDOBhmkcs5xKhf4","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-18T14:27:25Z","updated_at":"2024-01-18T14:27:25Z","author_association":"CONTRIBUTOR","body":"> > io_uring\r\n> \r\n> > > > > 场景是：server中会处理一些io任务。每个pthread worker维护一个thread local IO_uring实例用于提交和收割IO，使用server收到rpc请求后直接基于bthread来处理，此时，对于每个pthread worker想维护一个定时任务，用于提交请求。 如果可以直接在server 处理逻辑对应的pthread上执行绑定的bthread任务，可以避免额外线程的创建\r\n> > > > \r\n> > > > \r\n> > > > 为啥要一个定时器提交请求，收到rpc请求，直接提交到当前thread local的io_uring就可以了吧\r\n> > > \r\n> > > \r\n> > > 说错了，是收割请求。整体的逻辑是提交请求后让bthread sleep，然后收割请求后使用bthread_t来唤醒sleep的bthread继续执行。想让每个task group 所在的pthread固定周期执行收割请求的任务。\r\n> > \r\n> > \r\n> > 你专门启动一个专门的协程收割都有io_uring的请求？\r\n> \r\n> 如果IO_uring是thread_local的话，协程如果收割要io_uring，则必须运行在对应的task group中，但是目前的协程可能会被其他task group steal。 所以除非把IO_uring设置为全局的，然后再使用一个协程/线程来处理收割逻辑？ 如果基于bthread的task group来做的话，不太清楚是否有可行的方法\r\n\r\nthread local的指针可以存到一个全局数组中，那个专门的协程可以得到所以io_uring","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1898584056/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1899527921","html_url":"https://github.com/apache/brpc/pull/2513#issuecomment-1899527921","issue_url":"https://api.github.com/repos/apache/brpc/issues/2513","id":1899527921,"node_id":"IC_kwDOBhmkcs5xOH7x","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-19T02:09:15Z","updated_at":"2024-01-19T02:09:15Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1899527921/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1900046696","html_url":"https://github.com/apache/brpc/pull/2358#issuecomment-1900046696","issue_url":"https://api.github.com/repos/apache/brpc/issues/2358","id":1900046696,"node_id":"IC_kwDOBhmkcs5xQGlo","user":{"login":"vinllen","id":6987398,"node_id":"MDQ6VXNlcjY5ODczOTg=","avatar_url":"https://avatars.githubusercontent.com/u/6987398?v=4","gravatar_id":"","url":"https://api.github.com/users/vinllen","html_url":"https://github.com/vinllen","followers_url":"https://api.github.com/users/vinllen/followers","following_url":"https://api.github.com/users/vinllen/following{/other_user}","gists_url":"https://api.github.com/users/vinllen/gists{/gist_id}","starred_url":"https://api.github.com/users/vinllen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vinllen/subscriptions","organizations_url":"https://api.github.com/users/vinllen/orgs","repos_url":"https://api.github.com/users/vinllen/repos","events_url":"https://api.github.com/users/vinllen/events{/privacy}","received_events_url":"https://api.github.com/users/vinllen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-19T09:23:52Z","updated_at":"2024-01-19T09:37:55Z","author_association":"NONE","body":"@yanglimingcn 我知道问题所在了，的确是done的调用问题，我们用了另外一个braft的库，里面调用done是塞入到bthread::ExecutionQueue里面，这块代码没有改导致的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1900046696/reactions","total_count":1,"+1":0,"-1":0,"laugh":1,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1901122922","html_url":"https://github.com/apache/brpc/issues/2011#issuecomment-1901122922","issue_url":"https://api.github.com/repos/apache/brpc/issues/2011","id":1901122922,"node_id":"IC_kwDOBhmkcs5xUNVq","user":{"login":"Superskyyy","id":26076517,"node_id":"MDQ6VXNlcjI2MDc2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/26076517?v=4","gravatar_id":"","url":"https://api.github.com/users/Superskyyy","html_url":"https://github.com/Superskyyy","followers_url":"https://api.github.com/users/Superskyyy/followers","following_url":"https://api.github.com/users/Superskyyy/following{/other_user}","gists_url":"https://api.github.com/users/Superskyyy/gists{/gist_id}","starred_url":"https://api.github.com/users/Superskyyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Superskyyy/subscriptions","organizations_url":"https://api.github.com/users/Superskyyy/orgs","repos_url":"https://api.github.com/users/Superskyyy/repos","events_url":"https://api.github.com/users/Superskyyy/events{/privacy}","received_events_url":"https://api.github.com/users/Superskyyy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-19T21:13:35Z","updated_at":"2024-01-19T21:13:35Z","author_association":"MEMBER","body":"This is gonna be very helpful, looking forward to see it. ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1901122922/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1902920830","html_url":"https://github.com/apache/brpc/issues/2315#issuecomment-1902920830","issue_url":"https://api.github.com/repos/apache/brpc/issues/2315","id":1902920830,"node_id":"IC_kwDOBhmkcs5xbER-","user":{"login":"fausturs","id":25004087,"node_id":"MDQ6VXNlcjI1MDA0MDg3","avatar_url":"https://avatars.githubusercontent.com/u/25004087?v=4","gravatar_id":"","url":"https://api.github.com/users/fausturs","html_url":"https://github.com/fausturs","followers_url":"https://api.github.com/users/fausturs/followers","following_url":"https://api.github.com/users/fausturs/following{/other_user}","gists_url":"https://api.github.com/users/fausturs/gists{/gist_id}","starred_url":"https://api.github.com/users/fausturs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fausturs/subscriptions","organizations_url":"https://api.github.com/users/fausturs/orgs","repos_url":"https://api.github.com/users/fausturs/repos","events_url":"https://api.github.com/users/fausturs/events{/privacy}","received_events_url":"https://api.github.com/users/fausturs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-22T02:19:05Z","updated_at":"2024-01-22T02:21:05Z","author_association":"NONE","body":"> > > 优势在于，创建span仍然是能够完全规避了线程竞争，所以对性能应该很友好。\r\n> > \r\n> > \r\n> > 这个修改没有想象中那么简单，至少还涉及了rpcz相关的代码。这里会出现多个trace id，span id一样的span对象。 那么存入leveldb时，可能要考虑是否合并到一起。 如果不合并则要考虑rpcz的展示需要做一些修改。\r\n> > 所以，加一个锁，或者一个lockfree的队列会来的更快。\r\n> > 另外还注意到TRACEPRINTF这个宏其实可能也有线程安全问题，最终其实是调用到Span::Annotate这个函数。 如果是多个线程同时写，则显然需要一个锁。\r\n> > 所以总的来说，除非trace部分整体重新设计一遍，否则，使用锁是一个看上去更清晰的方案。\r\n> \r\n> 单线程调用内部多次调用createClientSpan，这个应该不会造成重复spanId吧，多线程调用Annotate相当于多线程并发处理一个请求？\r\n\r\n如果span id不相同，那么是不是会意味着逻辑上的一个span，在代码中实际上被处理成多个不同的span了？当然，处理成多个不同的span倒是也还蛮好，或许可以参考open telemetry，使用一个新的span类型，比如叫internal span。\r\n\r\n关于TRACEPRINTF，我想表达的意思是，在现有的情况下，是对bthread::tls_bls.rpcz_parent_span这个对象进行写入，当多个线程同时写入的时候，会不会有线程安全问题？不过按照你描述的这种改法来看，修改后应该不存在这个问题了。\r\nhttps://github.com/apache/brpc/blob/master/src/brpc/span.cpp#L298\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1902920830/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1902926229","html_url":"https://github.com/apache/brpc/issues/2502#issuecomment-1902926229","issue_url":"https://api.github.com/repos/apache/brpc/issues/2502","id":1902926229,"node_id":"IC_kwDOBhmkcs5xbFmV","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-22T02:21:09Z","updated_at":"2024-01-22T02:21:09Z","author_association":"CONTRIBUTOR","body":"这看着和brpc没关系吧，更像是业务代码问题，你用的std的线程，它的生命周期应该是你来维护而不是期望brpc来维护，先看看自己的业务代码有没有什么问题吧，是不是在里面分配了内存","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1902926229/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1902928661","html_url":"https://github.com/apache/brpc/issues/2500#issuecomment-1902928661","issue_url":"https://api.github.com/repos/apache/brpc/issues/2500","id":1902928661,"node_id":"IC_kwDOBhmkcs5xbGMV","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-22T02:22:07Z","updated_at":"2024-01-22T02:22:07Z","author_association":"CONTRIBUTOR","body":"@serverglen 有时间可以看一眼","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1902928661/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1902988655","html_url":"https://github.com/apache/brpc/issues/2502#issuecomment-1902988655","issue_url":"https://api.github.com/repos/apache/brpc/issues/2502","id":1902988655,"node_id":"IC_kwDOBhmkcs5xbU1v","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-22T02:46:03Z","updated_at":"2024-01-22T02:46:03Z","author_association":"CONTRIBUTOR","body":"可以用heap profiler确认一下哪里有内存泄漏","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1902988655/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1903396084","html_url":"https://github.com/apache/brpc/issues/2315#issuecomment-1903396084","issue_url":"https://api.github.com/repos/apache/brpc/issues/2315","id":1903396084,"node_id":"IC_kwDOBhmkcs5xc4T0","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-22T07:21:19Z","updated_at":"2024-01-22T07:21:19Z","author_association":"CONTRIBUTOR","body":"> 实现难度很低，但是也会有个问题，就是需要在bthread层面调用Span::CreateClientSpan，但是Span::CreateClientSpan是在brpc这个层面上，代码调用关系可能有些不合理。\r\n\r\n这个可以让bthread开放一个set_create_span_func的方法，然后在brpc代码里将真正实现的方法设置进去","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1903396084/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1905191387","html_url":"https://github.com/apache/brpc/pull/2511#issuecomment-1905191387","issue_url":"https://api.github.com/repos/apache/brpc/issues/2511","id":1905191387,"node_id":"IC_kwDOBhmkcs5xjunb","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-23T02:40:13Z","updated_at":"2024-01-23T02:40:13Z","author_association":"CONTRIBUTOR","body":"@wwbmmm 有空看看这个问题","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1905191387/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1905236057","html_url":"https://github.com/apache/brpc/pull/2517#issuecomment-1905236057","issue_url":"https://api.github.com/repos/apache/brpc/issues/2517","id":1905236057,"node_id":"IC_kwDOBhmkcs5xj5hZ","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-23T03:35:50Z","updated_at":"2024-01-23T03:35:50Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1905236057/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1905240486","html_url":"https://github.com/apache/brpc/pull/2518#issuecomment-1905240486","issue_url":"https://api.github.com/repos/apache/brpc/issues/2518","id":1905240486,"node_id":"IC_kwDOBhmkcs5xj6mm","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-23T03:42:31Z","updated_at":"2024-01-23T03:42:31Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1905240486/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1905243010","html_url":"https://github.com/apache/brpc/pull/2511#issuecomment-1905243010","issue_url":"https://api.github.com/repos/apache/brpc/issues/2511","id":1905243010,"node_id":"IC_kwDOBhmkcs5xj7OC","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-23T03:46:18Z","updated_at":"2024-01-23T03:46:18Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1905243010/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1905314242","html_url":"https://github.com/apache/brpc/pull/2479#issuecomment-1905314242","issue_url":"https://api.github.com/repos/apache/brpc/issues/2479","id":1905314242,"node_id":"IC_kwDOBhmkcs5xkMnC","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-23T05:24:00Z","updated_at":"2024-01-23T05:24:00Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1905314242/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1905316904","html_url":"https://github.com/apache/brpc/pull/2462#issuecomment-1905316904","issue_url":"https://api.github.com/repos/apache/brpc/issues/2462","id":1905316904,"node_id":"IC_kwDOBhmkcs5xkNQo","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-23T05:26:46Z","updated_at":"2024-01-23T05:26:46Z","author_association":"CONTRIBUTOR","body":"和主干新合入的功能有冲突导致编译失败 @Divyansh200102 ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1905316904/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1905318925","html_url":"https://github.com/apache/brpc/pull/2462#issuecomment-1905318925","issue_url":"https://api.github.com/repos/apache/brpc/issues/2462","id":1905318925,"node_id":"IC_kwDOBhmkcs5xkNwN","user":{"login":"Divyansh200102","id":146909065,"node_id":"U_kgDOCMGniQ","avatar_url":"https://avatars.githubusercontent.com/u/146909065?v=4","gravatar_id":"","url":"https://api.github.com/users/Divyansh200102","html_url":"https://github.com/Divyansh200102","followers_url":"https://api.github.com/users/Divyansh200102/followers","following_url":"https://api.github.com/users/Divyansh200102/following{/other_user}","gists_url":"https://api.github.com/users/Divyansh200102/gists{/gist_id}","starred_url":"https://api.github.com/users/Divyansh200102/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Divyansh200102/subscriptions","organizations_url":"https://api.github.com/users/Divyansh200102/orgs","repos_url":"https://api.github.com/users/Divyansh200102/repos","events_url":"https://api.github.com/users/Divyansh200102/events{/privacy}","received_events_url":"https://api.github.com/users/Divyansh200102/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-23T05:29:12Z","updated_at":"2024-01-23T05:29:12Z","author_association":"CONTRIBUTOR","body":"> 和主干新合入的功能有冲突导致编译失败 @Divyansh200102\r\n\r\n 我会调查一下 @wwbmmm ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1905318925/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1907267039","html_url":"https://github.com/apache/brpc/issues/2315#issuecomment-1907267039","issue_url":"https://api.github.com/repos/apache/brpc/issues/2315","id":1907267039,"node_id":"IC_kwDOBhmkcs5xrpXf","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-24T02:56:53Z","updated_at":"2024-01-24T02:56:53Z","author_association":"CONTRIBUTOR","body":"> > 实现难度很低，但是也会有个问题，就是需要在bthread层面调用Span::CreateClientSpan，但是Span::CreateClientSpan是在brpc这个层面上，代码调用关系可能有些不合理。\r\n> \r\n> 这个可以让bthread开放一个set_create_span_func的方法，然后在brpc代码里将真正实现的方法设置进去\r\n\r\n#2519","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1907267039/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1908815512","html_url":"https://github.com/apache/brpc/issues/208#issuecomment-1908815512","issue_url":"https://api.github.com/repos/apache/brpc/issues/208","id":1908815512,"node_id":"IC_kwDOBhmkcs5xxjaY","user":{"login":"Superskyyy","id":26076517,"node_id":"MDQ6VXNlcjI2MDc2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/26076517?v=4","gravatar_id":"","url":"https://api.github.com/users/Superskyyy","html_url":"https://github.com/Superskyyy","followers_url":"https://api.github.com/users/Superskyyy/followers","following_url":"https://api.github.com/users/Superskyyy/following{/other_user}","gists_url":"https://api.github.com/users/Superskyyy/gists{/gist_id}","starred_url":"https://api.github.com/users/Superskyyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Superskyyy/subscriptions","organizations_url":"https://api.github.com/users/Superskyyy/orgs","repos_url":"https://api.github.com/users/Superskyyy/repos","events_url":"https://api.github.com/users/Superskyyy/events{/privacy}","received_events_url":"https://api.github.com/users/Superskyyy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-24T19:52:07Z","updated_at":"2024-01-24T19:52:07Z","author_association":"MEMBER","body":"Is this fixed and can be closed?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1908815512/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1909271249","html_url":"https://github.com/apache/brpc/issues/208#issuecomment-1909271249","issue_url":"https://api.github.com/repos/apache/brpc/issues/208","id":1909271249,"node_id":"IC_kwDOBhmkcs5xzSrR","user":{"login":"jamesge","id":6566535,"node_id":"MDQ6VXNlcjY1NjY1MzU=","avatar_url":"https://avatars.githubusercontent.com/u/6566535?v=4","gravatar_id":"","url":"https://api.github.com/users/jamesge","html_url":"https://github.com/jamesge","followers_url":"https://api.github.com/users/jamesge/followers","following_url":"https://api.github.com/users/jamesge/following{/other_user}","gists_url":"https://api.github.com/users/jamesge/gists{/gist_id}","starred_url":"https://api.github.com/users/jamesge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jamesge/subscriptions","organizations_url":"https://api.github.com/users/jamesge/orgs","repos_url":"https://api.github.com/users/jamesge/repos","events_url":"https://api.github.com/users/jamesge/events{/privacy}","received_events_url":"https://api.github.com/users/jamesge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-25T03:09:20Z","updated_at":"2024-01-25T03:09:20Z","author_association":"CONTRIBUTOR","body":"> Is this fixed and can be closed?\r\nalready fixed and should be closed","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1909271249/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1909416055","html_url":"https://github.com/apache/brpc/pull/2462#issuecomment-1909416055","issue_url":"https://api.github.com/repos/apache/brpc/issues/2462","id":1909416055,"node_id":"IC_kwDOBhmkcs5xz2B3","user":{"login":"Divyansh200102","id":146909065,"node_id":"U_kgDOCMGniQ","avatar_url":"https://avatars.githubusercontent.com/u/146909065?v=4","gravatar_id":"","url":"https://api.github.com/users/Divyansh200102","html_url":"https://github.com/Divyansh200102","followers_url":"https://api.github.com/users/Divyansh200102/followers","following_url":"https://api.github.com/users/Divyansh200102/following{/other_user}","gists_url":"https://api.github.com/users/Divyansh200102/gists{/gist_id}","starred_url":"https://api.github.com/users/Divyansh200102/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Divyansh200102/subscriptions","organizations_url":"https://api.github.com/users/Divyansh200102/orgs","repos_url":"https://api.github.com/users/Divyansh200102/repos","events_url":"https://api.github.com/users/Divyansh200102/events{/privacy}","received_events_url":"https://api.github.com/users/Divyansh200102/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-25T06:08:12Z","updated_at":"2024-01-25T06:15:48Z","author_association":"CONTRIBUTOR","body":"你能看看为什么最后一次检查失败吗 @wwbmmm ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1909416055/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1910054663","html_url":"https://github.com/apache/brpc/pull/2517#issuecomment-1910054663","issue_url":"https://api.github.com/repos/apache/brpc/issues/2517","id":1910054663,"node_id":"IC_kwDOBhmkcs5x2R8H","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-25T12:04:49Z","updated_at":"2024-01-25T12:04:49Z","author_association":"CONTRIBUTOR","body":"关闭该PR，因为可能会导致线程锁里调Singleton场景出现死锁问题。\r\n\r\n有在构造函数中挂起协程操作的需求，可以使用 #2520 的特性。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1910054663/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1910139575","html_url":"https://github.com/apache/brpc/pull/2523#issuecomment-1910139575","issue_url":"https://api.github.com/repos/apache/brpc/issues/2523","id":1910139575,"node_id":"IC_kwDOBhmkcs5x2mq3","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-25T12:51:30Z","updated_at":"2024-01-25T12:51:30Z","author_association":"CONTRIBUTOR","body":"@wwbmmm 有空看看","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1910139575/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1911515523","html_url":"https://github.com/apache/brpc/issues/2522#issuecomment-1911515523","issue_url":"https://api.github.com/repos/apache/brpc/issues/2522","id":1911515523,"node_id":"IC_kwDOBhmkcs5x72mD","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-26T05:38:45Z","updated_at":"2024-01-26T05:38:45Z","author_association":"MEMBER","body":"Protobuf with version >= 22 is not supported by now.\r\n\r\n- https://github.com/protocolbuffers/protobuf/releases/tag/v22.0\r\n- https://github.com/protocolbuffers/protobuf/pull/10416","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1911515523/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1911533588","html_url":"https://github.com/apache/brpc/issues/2502#issuecomment-1911533588","issue_url":"https://api.github.com/repos/apache/brpc/issues/2502","id":1911533588,"node_id":"IC_kwDOBhmkcs5x77AU","user":{"login":"ike47","id":156296108,"node_id":"U_kgDOCVDjrA","avatar_url":"https://avatars.githubusercontent.com/u/156296108?v=4","gravatar_id":"","url":"https://api.github.com/users/ike47","html_url":"https://github.com/ike47","followers_url":"https://api.github.com/users/ike47/followers","following_url":"https://api.github.com/users/ike47/following{/other_user}","gists_url":"https://api.github.com/users/ike47/gists{/gist_id}","starred_url":"https://api.github.com/users/ike47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ike47/subscriptions","organizations_url":"https://api.github.com/users/ike47/orgs","repos_url":"https://api.github.com/users/ike47/repos","events_url":"https://api.github.com/users/ike47/events{/privacy}","received_events_url":"https://api.github.com/users/ike47/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-26T06:06:56Z","updated_at":"2024-01-26T06:06:56Z","author_association":"NONE","body":"> 这看着和brpc没关系吧，更像是业务代码问题，你用的std的线程，它的生命周期应该是你来维护而不是期望brpc来维护，先看看自己的业务代码有没有什么问题吧，是不是在里面分配了内存\r\n\r\n线程代码也已经贴截图了，线程里面是作为客户端发了一次brpc请求，没有申请内存；","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1911533588/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1911536650","html_url":"https://github.com/apache/brpc/issues/2502#issuecomment-1911536650","issue_url":"https://api.github.com/repos/apache/brpc/issues/2502","id":1911536650,"node_id":"IC_kwDOBhmkcs5x77wK","user":{"login":"ike47","id":156296108,"node_id":"U_kgDOCVDjrA","avatar_url":"https://avatars.githubusercontent.com/u/156296108?v=4","gravatar_id":"","url":"https://api.github.com/users/ike47","html_url":"https://github.com/ike47","followers_url":"https://api.github.com/users/ike47/followers","following_url":"https://api.github.com/users/ike47/following{/other_user}","gists_url":"https://api.github.com/users/ike47/gists{/gist_id}","starred_url":"https://api.github.com/users/ike47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ike47/subscriptions","organizations_url":"https://api.github.com/users/ike47/orgs","repos_url":"https://api.github.com/users/ike47/repos","events_url":"https://api.github.com/users/ike47/events{/privacy}","received_events_url":"https://api.github.com/users/ike47/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-26T06:11:10Z","updated_at":"2024-01-26T06:11:10Z","author_association":"NONE","body":"> 可以用heap profiler确认一下哪里有内存泄漏\r\n\r\n好，我试一下，目前观察到随着brpc通讯次数增加有个大约20M左右内存增长，后面就不会增加了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1911536650/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1911545439","html_url":"https://github.com/apache/brpc/issues/2502#issuecomment-1911545439","issue_url":"https://api.github.com/repos/apache/brpc/issues/2502","id":1911545439,"node_id":"IC_kwDOBhmkcs5x795f","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-26T06:21:55Z","updated_at":"2024-01-26T06:21:55Z","author_association":"CONTRIBUTOR","body":"> > 这看着和brpc没关系吧，更像是业务代码问题，你用的std的线程，它的生命周期应该是你来维护而不是期望brpc来维护，先看看自己的业务代码有没有什么问题吧，是不是在里面分配了内存\r\n> \r\n> 线程代码也已经贴截图了，线程里面是作为客户端发了一次brpc请求，没有申请内存；\r\n\r\n线程是你的客户端代码吧，内存增长的是server端么？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1911545439/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1911582255","html_url":"https://github.com/apache/brpc/issues/2502#issuecomment-1911582255","issue_url":"https://api.github.com/repos/apache/brpc/issues/2502","id":1911582255,"node_id":"IC_kwDOBhmkcs5x8G4v","user":{"login":"ike47","id":156296108,"node_id":"U_kgDOCVDjrA","avatar_url":"https://avatars.githubusercontent.com/u/156296108?v=4","gravatar_id":"","url":"https://api.github.com/users/ike47","html_url":"https://github.com/ike47","followers_url":"https://api.github.com/users/ike47/followers","following_url":"https://api.github.com/users/ike47/following{/other_user}","gists_url":"https://api.github.com/users/ike47/gists{/gist_id}","starred_url":"https://api.github.com/users/ike47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ike47/subscriptions","organizations_url":"https://api.github.com/users/ike47/orgs","repos_url":"https://api.github.com/users/ike47/repos","events_url":"https://api.github.com/users/ike47/events{/privacy}","received_events_url":"https://api.github.com/users/ike47/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-26T07:02:35Z","updated_at":"2024-01-26T07:02:35Z","author_association":"NONE","body":"> > > 这看着和brpc没关系吧，更像是业务代码问题，你用的std的线程，它的生命周期应该是你来维护而不是期望brpc来维护，先看看自己的业务代码有没有什么问题吧，是不是在里面分配了内存\r\n> > \r\n> > \r\n> > 线程代码也已经贴截图了，线程里面是作为客户端发了一次brpc请求，没有申请内存；\r\n> \r\n> 线程是你的客户端代码吧，内存增长的是server端么？\r\n\r\n线程代码是服务端代码，模拟服务端作为客户端发送brpc请求给自己。 \r\n是的，服务端内存增长","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1911582255/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1911683282","html_url":"https://github.com/apache/brpc/issues/2502#issuecomment-1911683282","issue_url":"https://api.github.com/repos/apache/brpc/issues/2502","id":1911683282,"node_id":"IC_kwDOBhmkcs5x8fjS","user":{"login":"ike47","id":156296108,"node_id":"U_kgDOCVDjrA","avatar_url":"https://avatars.githubusercontent.com/u/156296108?v=4","gravatar_id":"","url":"https://api.github.com/users/ike47","html_url":"https://github.com/ike47","followers_url":"https://api.github.com/users/ike47/followers","following_url":"https://api.github.com/users/ike47/following{/other_user}","gists_url":"https://api.github.com/users/ike47/gists{/gist_id}","starred_url":"https://api.github.com/users/ike47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ike47/subscriptions","organizations_url":"https://api.github.com/users/ike47/orgs","repos_url":"https://api.github.com/users/ike47/repos","events_url":"https://api.github.com/users/ike47/events{/privacy}","received_events_url":"https://api.github.com/users/ike47/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-26T08:46:51Z","updated_at":"2024-01-26T08:47:08Z","author_association":"NONE","body":"> 可以用heap profiler确认一下哪里有内存泄漏\r\n[brpcheap.zip](https://github.com/apache/brpc/files/14062197/brpcheap.zip)\r\n已经导出，帮忙看一下 @chenBright \r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1911683282/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1911716240","html_url":"https://github.com/apache/brpc/pull/2521#issuecomment-1911716240","issue_url":"https://api.github.com/repos/apache/brpc/issues/2521","id":1911716240,"node_id":"IC_kwDOBhmkcs5x8nmQ","user":{"login":"0x34d","id":36335769,"node_id":"MDQ6VXNlcjM2MzM1NzY5","avatar_url":"https://avatars.githubusercontent.com/u/36335769?v=4","gravatar_id":"","url":"https://api.github.com/users/0x34d","html_url":"https://github.com/0x34d","followers_url":"https://api.github.com/users/0x34d/followers","following_url":"https://api.github.com/users/0x34d/following{/other_user}","gists_url":"https://api.github.com/users/0x34d/gists{/gist_id}","starred_url":"https://api.github.com/users/0x34d/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/0x34d/subscriptions","organizations_url":"https://api.github.com/users/0x34d/orgs","repos_url":"https://api.github.com/users/0x34d/repos","events_url":"https://api.github.com/users/0x34d/events{/privacy}","received_events_url":"https://api.github.com/users/0x34d/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-26T09:12:47Z","updated_at":"2024-01-26T09:12:47Z","author_association":"CONTRIBUTOR","body":"@wwbmmm ping;\r\nCan you check why `Build and Test on Linux / clang-unittest (pull_request)` failed?\r\nAnd thoughts on merging?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1911716240/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1913420043","html_url":"https://github.com/apache/brpc/issues/2489#issuecomment-1913420043","issue_url":"https://api.github.com/repos/apache/brpc/issues/2489","id":1913420043,"node_id":"IC_kwDOBhmkcs5yDHkL","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-28T02:33:49Z","updated_at":"2024-01-28T02:33:49Z","author_association":"CONTRIBUTOR","body":"From gpt：\r\n这段代码使用了GCC的内联汇编。`__asm__ __volatile__` 是 GCC 的内联汇编语句，其中 `__volatile__` 表示编译器在优化时不要移动这段汇编代码的位置，以避免可能的副作用。\r\n\"lock; xaddl %0,%1\" 是 x86 指令，`xaddl` 是原子交换并加的操作，`lock` 是一个前缀，保证了这个指令在多核环境下的原子性。\r\n`\"+r\" (temp), \"+m\" (*ptr)` 是内联汇编的输入/输出操作数部分。\r\n\"+\"表示这个操作数既是输入又是输出，\"r\"表示将`temp`放入一个寄存器中，\"m\"表示`*ptr`是一个内存位置。\r\n在执行`xaddl`指令后，`temp`和`*ptr`的值会互换，然后`*ptr`会增加`temp`的值。所以，`temp`现在保存的是`*ptr`原来的值，而`*ptr`保存的是相加后的值。\r\n至于`AtomicOps_Internalx86CPUFeatures.has_amd_lock_mb_bug`和`lfence`，它们是处理一些特定的CPU bug。`lfence`是一个内存屏障指令，确保某些CPU在执行`lock`指令时不会出现预期之外的行为。\r\n最后，函数返回的是`temp + increment`，即原始的`*ptr`值加上增量。\r\n\r\n`xaddl` 是 x86 汇编语言中的一条指令，它是 \"exchange and add\" 的缩写。这条指令将两个操作数相加，并将结果存储在第二个操作数所指定的位置。同时，它将第二个操作数原来的值存储在第一个操作数所指定的位置。这是一个原子操作，也就是说，在多线程环境中，这个操作是不可中断的。这使得 `xaddl` 指令在实现某些并发算法，如计数器或互斥锁等，时非常有用。\r\n`xaddl` 指令的工作原理可以简化为以下几步：\r\n1. 将两个操作数相加。\r\n2. 将结果存储在第二个操作数所指定的位置。\r\n3. 将第二个操作数原来的值存储在第一个操作数所指定的位置。\r\n这个过程是原子的，也就是说，一旦开始就不会被其他线程中断。这就确保了在多线程环境中，不会出现两个线程同时修改同一块内存的情况。\r\n例如，如果我们有一个 `xaddl` 指令如下：\r\n```asm\r\nxaddl %eax, (%ebx)\r\n```\r\n在这个指令执行之后，`%ebx` 所指向的内存位置的值会增加 `%eax` 的值，而 `%eax` 则会得到 `%ebx` 所指向的内存位置原来的值。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1913420043/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1913607626","html_url":"https://github.com/apache/brpc/issues/2471#issuecomment-1913607626","issue_url":"https://api.github.com/repos/apache/brpc/issues/2471","id":1913607626,"node_id":"IC_kwDOBhmkcs5yD1XK","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-28T14:03:47Z","updated_at":"2024-01-28T14:03:47Z","author_association":"CONTRIBUTOR","body":"我觉得可以提个PR，现在这个128也是个经验值","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1913607626/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1913831481","html_url":"https://github.com/apache/brpc/pull/2519#issuecomment-1913831481","issue_url":"https://api.github.com/repos/apache/brpc/issues/2519","id":1913831481,"node_id":"IC_kwDOBhmkcs5yEsA5","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-29T01:54:24Z","updated_at":"2024-01-29T03:18:48Z","author_association":"CONTRIBUTOR","body":"这个是什么地方单测失败了，看不出来呢？显示不出来呢 @wwbmmm ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1913831481/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1913877240","html_url":"https://github.com/apache/brpc/issues/2502#issuecomment-1913877240","issue_url":"https://api.github.com/repos/apache/brpc/issues/2502","id":1913877240,"node_id":"IC_kwDOBhmkcs5yE3L4","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-29T02:58:34Z","updated_at":"2024-01-29T02:58:34Z","author_association":"CONTRIBUTOR","body":"@ike47  按照[文档](https://github.com/apache/brpc/blob/master/docs/cn/heap_profiler.md)指引，直接在内置服务看吧。profile不仅需要profile数据，还需要可行性文件。\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1913877240/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1913902391","html_url":"https://github.com/apache/brpc/issues/2502#issuecomment-1913902391","issue_url":"https://api.github.com/repos/apache/brpc/issues/2502","id":1913902391,"node_id":"IC_kwDOBhmkcs5yE9U3","user":{"login":"ike47","id":156296108,"node_id":"U_kgDOCVDjrA","avatar_url":"https://avatars.githubusercontent.com/u/156296108?v=4","gravatar_id":"","url":"https://api.github.com/users/ike47","html_url":"https://github.com/ike47","followers_url":"https://api.github.com/users/ike47/followers","following_url":"https://api.github.com/users/ike47/following{/other_user}","gists_url":"https://api.github.com/users/ike47/gists{/gist_id}","starred_url":"https://api.github.com/users/ike47/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ike47/subscriptions","organizations_url":"https://api.github.com/users/ike47/orgs","repos_url":"https://api.github.com/users/ike47/repos","events_url":"https://api.github.com/users/ike47/events{/privacy}","received_events_url":"https://api.github.com/users/ike47/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-29T03:31:39Z","updated_at":"2024-01-29T03:31:39Z","author_association":"NONE","body":"[heaptxt.zip](https://github.com/apache/brpc/files/14079310/heaptxt.zip)\r\n@chenBright 我在内置服务里导出成txt了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1913902391/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1913945678","html_url":"https://github.com/apache/brpc/issues/1251#issuecomment-1913945678","issue_url":"https://api.github.com/repos/apache/brpc/issues/1251","id":1913945678,"node_id":"IC_kwDOBhmkcs5yFH5O","user":{"login":"Divyansh200102","id":146909065,"node_id":"U_kgDOCMGniQ","avatar_url":"https://avatars.githubusercontent.com/u/146909065?v=4","gravatar_id":"","url":"https://api.github.com/users/Divyansh200102","html_url":"https://github.com/Divyansh200102","followers_url":"https://api.github.com/users/Divyansh200102/followers","following_url":"https://api.github.com/users/Divyansh200102/following{/other_user}","gists_url":"https://api.github.com/users/Divyansh200102/gists{/gist_id}","starred_url":"https://api.github.com/users/Divyansh200102/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Divyansh200102/subscriptions","organizations_url":"https://api.github.com/users/Divyansh200102/orgs","repos_url":"https://api.github.com/users/Divyansh200102/repos","events_url":"https://api.github.com/users/Divyansh200102/events{/privacy}","received_events_url":"https://api.github.com/users/Divyansh200102/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-29T04:34:57Z","updated_at":"2024-01-29T04:35:16Z","author_association":"CONTRIBUTOR","body":"Is this issue still open? @serverglen I want to try it","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1913945678/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1914024400","html_url":"https://github.com/apache/brpc/issues/2502#issuecomment-1914024400","issue_url":"https://api.github.com/repos/apache/brpc/issues/2502","id":1914024400,"node_id":"IC_kwDOBhmkcs5yFbHQ","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-29T06:09:15Z","updated_at":"2024-01-29T06:09:15Z","author_association":"CONTRIBUTOR","body":"heap看着正常。涨的内存会不会缓存在tcmalloc freelist了？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1914024400/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1914041577","html_url":"https://github.com/apache/brpc/issues/1251#issuecomment-1914041577","issue_url":"https://api.github.com/repos/apache/brpc/issues/1251","id":1914041577,"node_id":"IC_kwDOBhmkcs5yFfTp","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-29T06:25:18Z","updated_at":"2024-01-29T06:25:18Z","author_association":"CONTRIBUTOR","body":"The issue still open. Pull request welcome.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1914041577/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1914864066","html_url":"https://github.com/apache/brpc/issues/1286#issuecomment-1914864066","issue_url":"https://api.github.com/repos/apache/brpc/issues/1286","id":1914864066,"node_id":"IC_kwDOBhmkcs5yIoHC","user":{"login":"ChunelFeng","id":37905059,"node_id":"MDQ6VXNlcjM3OTA1MDU5","avatar_url":"https://avatars.githubusercontent.com/u/37905059?v=4","gravatar_id":"","url":"https://api.github.com/users/ChunelFeng","html_url":"https://github.com/ChunelFeng","followers_url":"https://api.github.com/users/ChunelFeng/followers","following_url":"https://api.github.com/users/ChunelFeng/following{/other_user}","gists_url":"https://api.github.com/users/ChunelFeng/gists{/gist_id}","starred_url":"https://api.github.com/users/ChunelFeng/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ChunelFeng/subscriptions","organizations_url":"https://api.github.com/users/ChunelFeng/orgs","repos_url":"https://api.github.com/users/ChunelFeng/repos","events_url":"https://api.github.com/users/ChunelFeng/events{/privacy}","received_events_url":"https://api.github.com/users/ChunelFeng/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-29T14:56:20Z","updated_at":"2024-01-29T14:56:20Z","author_association":"NONE","body":"mac m1上编译 brpc，执行了，也source过好几次了，也在 zshrc文件里，确认的确写入了\r\n\r\n但编译还是报没有 gnu-getopt \r\n\r\n<img width=\"714\" alt=\"image\" src=\"https://github.com/apache/brpc/assets/37905059/3757c072-0023-4d07-bf9a-b671683b345b\">\r\n\r\n请问，还有没什么可以排查的方案？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1914864066/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1915974214","html_url":"https://github.com/apache/brpc/issues/1286#issuecomment-1915974214","issue_url":"https://api.github.com/repos/apache/brpc/issues/1286","id":1915974214,"node_id":"IC_kwDOBhmkcs5yM3JG","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-30T02:47:03Z","updated_at":"2024-01-30T02:47:03Z","author_association":"CONTRIBUTOR","body":"> mac m1上编译 brpc，执行了，也source过好几次了，也在 zshrc文件里，确认的确写入了\r\n> \r\n> 但编译还是报没有 gnu-getopt\r\n> \r\n> <img alt=\"image\" width=\"714\" src=\"https://private-user-images.githubusercontent.com/37905059/300503192-3757c072-0023-4d07-bf9a-b671683b345b.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDY1ODI4ODcsIm5iZiI6MTcwNjU4MjU4NywicGF0aCI6Ii8zNzkwNTA1OS8zMDA1MDMxOTItMzc1N2MwNzItMDAyMy00ZDA3LWJmOWEtYjY3MTY4M2IzNDViLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDAxMzAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwMTMwVDAyNDMwN1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTY1MjE2NzBiNTk0OTBlYzU4YWRiY2ZlZTdkYTE0MzA1ZDliZjEyN2YwZTNlMjUzYWExNGY0ZjZlYzI0ZDQxMDcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.Y1X14UiUW_GLmTDfbLbtebcS2DFTDAuRWeBrEDqXOms\">\r\n> 请问，还有没什么可以排查的方案？\r\n\r\n爬楼看下吧，重启你的iTerm或者重启电脑","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1915974214/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1916192935","html_url":"https://github.com/apache/brpc/issues/2529#issuecomment-1916192935","issue_url":"https://api.github.com/repos/apache/brpc/issues/2529","id":1916192935,"node_id":"IC_kwDOBhmkcs5yNsin","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-30T06:59:19Z","updated_at":"2024-01-30T06:59:19Z","author_association":"MEMBER","body":"cmake 或 config_brpc.sh 单独试下？看着 glog 状态像是乱的，像是部分开部分关","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1916192935/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918295586","html_url":"https://github.com/apache/brpc/issues/2527#issuecomment-1918295586","issue_url":"https://api.github.com/repos/apache/brpc/issues/2527","id":1918295586,"node_id":"IC_kwDOBhmkcs5yVt4i","user":{"login":"chongg039","id":18239939,"node_id":"MDQ6VXNlcjE4MjM5OTM5","avatar_url":"https://avatars.githubusercontent.com/u/18239939?v=4","gravatar_id":"","url":"https://api.github.com/users/chongg039","html_url":"https://github.com/chongg039","followers_url":"https://api.github.com/users/chongg039/followers","following_url":"https://api.github.com/users/chongg039/following{/other_user}","gists_url":"https://api.github.com/users/chongg039/gists{/gist_id}","starred_url":"https://api.github.com/users/chongg039/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chongg039/subscriptions","organizations_url":"https://api.github.com/users/chongg039/orgs","repos_url":"https://api.github.com/users/chongg039/repos","events_url":"https://api.github.com/users/chongg039/events{/privacy}","received_events_url":"https://api.github.com/users/chongg039/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-31T03:00:11Z","updated_at":"2024-01-31T03:03:27Z","author_association":"NONE","body":"我直接在dynamic partition channel上创建stream，好像Accept不成功，麻烦帮忙看看呢，是不是不能这样用，LB是c_murmurhash \r\n![image](https://github.com/apache/brpc/assets/18239939/b40a0a41-b22f-4e89-be02-4aaaf7d904e2)\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918295586/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918302528","html_url":"https://github.com/apache/brpc/issues/1241#issuecomment-1918302528","issue_url":"https://api.github.com/repos/apache/brpc/issues/1241","id":1918302528,"node_id":"IC_kwDOBhmkcs5yVvlA","user":{"login":"chongg039","id":18239939,"node_id":"MDQ6VXNlcjE4MjM5OTM5","avatar_url":"https://avatars.githubusercontent.com/u/18239939?v=4","gravatar_id":"","url":"https://api.github.com/users/chongg039","html_url":"https://github.com/chongg039","followers_url":"https://api.github.com/users/chongg039/followers","following_url":"https://api.github.com/users/chongg039/following{/other_user}","gists_url":"https://api.github.com/users/chongg039/gists{/gist_id}","starred_url":"https://api.github.com/users/chongg039/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chongg039/subscriptions","organizations_url":"https://api.github.com/users/chongg039/orgs","repos_url":"https://api.github.com/users/chongg039/repos","events_url":"https://api.github.com/users/chongg039/events{/privacy}","received_events_url":"https://api.github.com/users/chongg039/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-31T03:09:09Z","updated_at":"2024-01-31T03:09:09Z","author_association":"NONE","body":"@gydong vx：uestc_gch，求拉谢谢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918302528/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918472538","html_url":"https://github.com/apache/brpc/pull/2462#issuecomment-1918472538","issue_url":"https://api.github.com/repos/apache/brpc/issues/2462","id":1918472538,"node_id":"IC_kwDOBhmkcs5yWZFa","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-31T06:32:22Z","updated_at":"2024-01-31T06:32:22Z","author_association":"CONTRIBUTOR","body":"> 你能看看为什么最后一次检查失败吗 @wwbmmm\r\n\r\n最新master分支已修复，可以更新试试。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918472538/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918473044","html_url":"https://github.com/apache/brpc/pull/2519#issuecomment-1918473044","issue_url":"https://api.github.com/repos/apache/brpc/issues/2519","id":1918473044,"node_id":"IC_kwDOBhmkcs5yWZNU","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-31T06:32:53Z","updated_at":"2024-01-31T06:32:53Z","author_association":"CONTRIBUTOR","body":"> 这个是什么地方单测失败了，看不出来呢？显示不出来呢 @wwbmmm\r\n\r\n最新master分支已修复，可以更新试试","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918473044/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918474351","html_url":"https://github.com/apache/brpc/pull/2521#issuecomment-1918474351","issue_url":"https://api.github.com/repos/apache/brpc/issues/2521","id":1918474351,"node_id":"IC_kwDOBhmkcs5yWZhv","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-31T06:34:10Z","updated_at":"2024-01-31T06:34:10Z","author_association":"CONTRIBUTOR","body":"> @wwbmmm ping; Can you check why `Build and Test on Linux / clang-unittest (pull_request)` failed? And thoughts on merging?\r\n\r\nThe latest master branch has fix this problem. You can try to update.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918474351/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918502241","html_url":"https://github.com/apache/brpc/pull/2525#issuecomment-1918502241","issue_url":"https://api.github.com/repos/apache/brpc/issues/2525","id":1918502241,"node_id":"IC_kwDOBhmkcs5yWgVh","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-31T06:59:55Z","updated_at":"2024-01-31T06:59:55Z","author_association":"CONTRIBUTOR","body":"之前UT有问题。最新master分支已修复，可以更新试试。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918502241/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918575812","html_url":"https://github.com/apache/brpc/pull/2521#issuecomment-1918575812","issue_url":"https://api.github.com/repos/apache/brpc/issues/2521","id":1918575812,"node_id":"IC_kwDOBhmkcs5yWyTE","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-31T07:59:07Z","updated_at":"2024-01-31T07:59:07Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918575812/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918576861","html_url":"https://github.com/apache/brpc/pull/2462#issuecomment-1918576861","issue_url":"https://api.github.com/repos/apache/brpc/issues/2462","id":1918576861,"node_id":"IC_kwDOBhmkcs5yWyjd","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-31T07:59:58Z","updated_at":"2024-01-31T07:59:58Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918576861/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918629444","html_url":"https://github.com/apache/brpc/issues/2527#issuecomment-1918629444","issue_url":"https://api.github.com/repos/apache/brpc/issues/2527","id":1918629444,"node_id":"IC_kwDOBhmkcs5yW_ZE","user":{"login":"chongg039","id":18239939,"node_id":"MDQ6VXNlcjE4MjM5OTM5","avatar_url":"https://avatars.githubusercontent.com/u/18239939?v=4","gravatar_id":"","url":"https://api.github.com/users/chongg039","html_url":"https://github.com/chongg039","followers_url":"https://api.github.com/users/chongg039/followers","following_url":"https://api.github.com/users/chongg039/following{/other_user}","gists_url":"https://api.github.com/users/chongg039/gists{/gist_id}","starred_url":"https://api.github.com/users/chongg039/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chongg039/subscriptions","organizations_url":"https://api.github.com/users/chongg039/orgs","repos_url":"https://api.github.com/users/chongg039/repos","events_url":"https://api.github.com/users/chongg039/events{/privacy}","received_events_url":"https://api.github.com/users/chongg039/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-31T08:35:54Z","updated_at":"2024-01-31T08:37:06Z","author_association":"NONE","body":"实验了一下selective channel和partition channel都会在Accept的时候报错No stream along with this request，对应找不到remote_stream_settings:\r\n![image](https://github.com/apache/brpc/assets/18239939/ba6581eb-a180-40f9-b3fc-4fe5b73d1940)\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918629444/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918634589","html_url":"https://github.com/apache/brpc/issues/2527#issuecomment-1918634589","issue_url":"https://api.github.com/repos/apache/brpc/issues/2527","id":1918634589,"node_id":"IC_kwDOBhmkcs5yXApd","user":{"login":"chongg039","id":18239939,"node_id":"MDQ6VXNlcjE4MjM5OTM5","avatar_url":"https://avatars.githubusercontent.com/u/18239939?v=4","gravatar_id":"","url":"https://api.github.com/users/chongg039","html_url":"https://github.com/chongg039","followers_url":"https://api.github.com/users/chongg039/followers","following_url":"https://api.github.com/users/chongg039/following{/other_user}","gists_url":"https://api.github.com/users/chongg039/gists{/gist_id}","starred_url":"https://api.github.com/users/chongg039/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chongg039/subscriptions","organizations_url":"https://api.github.com/users/chongg039/orgs","repos_url":"https://api.github.com/users/chongg039/repos","events_url":"https://api.github.com/users/chongg039/events{/privacy}","received_events_url":"https://api.github.com/users/chongg039/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-31T08:39:25Z","updated_at":"2024-01-31T08:39:25Z","author_association":"NONE","body":"@jamesge 请教一下大佬，是不是不能这样写，如果需要用到stream的保序，并且允许stream切换下游连接，有没有什么workaround的办法实现","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918634589/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918756823","html_url":"https://github.com/apache/brpc/pull/2462#issuecomment-1918756823","issue_url":"https://api.github.com/repos/apache/brpc/issues/2462","id":1918756823,"node_id":"IC_kwDOBhmkcs5yXefX","user":{"login":"Divyansh200102","id":146909065,"node_id":"U_kgDOCMGniQ","avatar_url":"https://avatars.githubusercontent.com/u/146909065?v=4","gravatar_id":"","url":"https://api.github.com/users/Divyansh200102","html_url":"https://github.com/Divyansh200102","followers_url":"https://api.github.com/users/Divyansh200102/followers","following_url":"https://api.github.com/users/Divyansh200102/following{/other_user}","gists_url":"https://api.github.com/users/Divyansh200102/gists{/gist_id}","starred_url":"https://api.github.com/users/Divyansh200102/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Divyansh200102/subscriptions","organizations_url":"https://api.github.com/users/Divyansh200102/orgs","repos_url":"https://api.github.com/users/Divyansh200102/repos","events_url":"https://api.github.com/users/Divyansh200102/events{/privacy}","received_events_url":"https://api.github.com/users/Divyansh200102/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-01-31T09:51:55Z","updated_at":"2024-01-31T09:51:55Z","author_association":"CONTRIBUTOR","body":"如果您觉得不错，请合并拉取请求@wwbmmm ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1918756823/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1920592824","html_url":"https://github.com/apache/brpc/issues/2527#issuecomment-1920592824","issue_url":"https://api.github.com/repos/apache/brpc/issues/2527","id":1920592824,"node_id":"IC_kwDOBhmkcs5yeeu4","user":{"login":"chongg039","id":18239939,"node_id":"MDQ6VXNlcjE4MjM5OTM5","avatar_url":"https://avatars.githubusercontent.com/u/18239939?v=4","gravatar_id":"","url":"https://api.github.com/users/chongg039","html_url":"https://github.com/chongg039","followers_url":"https://api.github.com/users/chongg039/followers","following_url":"https://api.github.com/users/chongg039/following{/other_user}","gists_url":"https://api.github.com/users/chongg039/gists{/gist_id}","starred_url":"https://api.github.com/users/chongg039/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chongg039/subscriptions","organizations_url":"https://api.github.com/users/chongg039/orgs","repos_url":"https://api.github.com/users/chongg039/repos","events_url":"https://api.github.com/users/chongg039/events{/privacy}","received_events_url":"https://api.github.com/users/chongg039/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-01T06:21:27Z","updated_at":"2024-02-01T06:21:27Z","author_association":"NONE","body":"![image](https://github.com/apache/brpc/assets/18239939/495ff7e1-a514-4d10-8bb1-a934a898d516)\r\n看了下普通的channel也支持负载均衡，写了个简单的FO测试，能够通过stream write的返回值判断连接状态。此时重新握手能够切换到另一个server，应该能满足要求。但还是没仔细看为什么Selective Channel不支持。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1920592824/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1923274012","html_url":"https://github.com/apache/brpc/pull/2156#issuecomment-1923274012","issue_url":"https://api.github.com/repos/apache/brpc/issues/2156","id":1923274012,"node_id":"IC_kwDOBhmkcs5yotUc","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-02T07:58:55Z","updated_at":"2024-02-02T07:58:55Z","author_association":"CONTRIBUTOR","body":"> 加上这个patch后，稳定出现第一种错误，是 socket.cpp 也有类似的问题吗？\r\n\r\n是在哪个平台上出现呢？arm 还是 x86 ？\r\n可以贴下 PoC 代码。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1923274012/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1923616331","html_url":"https://github.com/apache/brpc/pull/2156#issuecomment-1923616331","issue_url":"https://api.github.com/repos/apache/brpc/issues/2156","id":1923616331,"node_id":"IC_kwDOBhmkcs5yqA5L","user":{"login":"zcfh","id":70124382,"node_id":"MDQ6VXNlcjcwMTI0Mzgy","avatar_url":"https://avatars.githubusercontent.com/u/70124382?v=4","gravatar_id":"","url":"https://api.github.com/users/zcfh","html_url":"https://github.com/zcfh","followers_url":"https://api.github.com/users/zcfh/followers","following_url":"https://api.github.com/users/zcfh/following{/other_user}","gists_url":"https://api.github.com/users/zcfh/gists{/gist_id}","starred_url":"https://api.github.com/users/zcfh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zcfh/subscriptions","organizations_url":"https://api.github.com/users/zcfh/orgs","repos_url":"https://api.github.com/users/zcfh/repos","events_url":"https://api.github.com/users/zcfh/events{/privacy}","received_events_url":"https://api.github.com/users/zcfh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-02T11:28:30Z","updated_at":"2024-02-02T11:29:04Z","author_association":"NONE","body":"> > 加上这个patch后，稳定出现第一种错误，是 socket.cpp 也有类似的问题吗？\r\n> \r\n> 是在哪个平台上出现呢？arm 还是 x86 ？ 可以贴下 PoC 代码。\r\n\r\nx86, `(defined(__aarch64__) || defined(__arm64__))`，去掉后不再core在前面提到的两个位置。\r\n\r\ncore在了其他地方，找了下调用栈，有地方是这么用的 `static thread_local Object obj;`。是用了btread的地方，只要用到 thread_local 的都需要做类似的变更吗？\r\n\r\n我之前没用过brpc，如何能够构造一个，问题里提到到示例呢？\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1923616331/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1923713768","html_url":"https://github.com/apache/brpc/pull/2156#issuecomment-1923713768","issue_url":"https://api.github.com/repos/apache/brpc/issues/2156","id":1923713768,"node_id":"IC_kwDOBhmkcs5yqYro","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-02T12:31:35Z","updated_at":"2024-02-02T13:12:33Z","author_association":"CONTRIBUTOR","body":"> > > 加上这个patch后，稳定出现第一种错误，是 socket.cpp 也有类似的问题吗？\r\n> > \r\n> > \r\n> > 是在哪个平台上出现呢？arm 还是 x86 ？ 可以贴下 PoC 代码。\r\n> \r\n> x86, `(defined(__aarch64__) || defined(__arm64__))`，去掉后不再core在前面提到的两个位置。\r\n> \r\n> core在了其他地方，找了下调用栈，有地方是这么用的 `static thread_local Object obj;`。是用了btread的地方，只要用到 thread_local 的都需要做类似的变更吗？\r\n> \r\n> 我之前没用过brpc，如何能够构造一个，问题里提到到示例呢？\r\n\r\n如果使用 thread_local 变量时，前后两次访问该变量的中间阶段发生了 bthread 的切换（由于 `start_urgent` 或者 `butex` 等待，`bthread_usleep` 等操作），那么 `thread_local` 变量就可能不是之前的对象了，这个和 bthread 的设计相关，因为 bthread 运行周期可以被调度到不同的 pthread 上执行，所以前后两次所在的 pthread 上下文已经变化，其 thread_local 变量也就变化了。 具体见：https://brpc.apache.org/docs/bthread/thread-local/#thread-local%E9%97%AE%E9%A2%98\r\n\r\n> 是用了btread的地方，只要用到 thread_local 的都需要做类似的变更吗？\r\n\r\n这个得分情况：如果想要在 bthread 中使用类似 \"thread_local\"  的行为，即无论 bthread 被调度到哪，都获得相同的 thread_local 值，建议使用 `bthread_local` https://brpc.apache.org/zh/docs/server/basics/#bthread-local\r\n\r\n如果代码就是想要获得当前被调度运行的 pthread 线程的 `thread_local` 变量(例如 brpc 中的 `tls_task_group `），那么就建议如果会出现上述导致 bthread 切换的行为，那么建议使用这个宏，避免编译器的优化。\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1923713768/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1924255230","html_url":"https://github.com/apache/brpc/issues/2533#issuecomment-1924255230","issue_url":"https://api.github.com/repos/apache/brpc/issues/2533","id":1924255230,"node_id":"IC_kwDOBhmkcs5ysc3-","user":{"login":"Superskyyy","id":26076517,"node_id":"MDQ6VXNlcjI2MDc2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/26076517?v=4","gravatar_id":"","url":"https://api.github.com/users/Superskyyy","html_url":"https://github.com/Superskyyy","followers_url":"https://api.github.com/users/Superskyyy/followers","following_url":"https://api.github.com/users/Superskyyy/following{/other_user}","gists_url":"https://api.github.com/users/Superskyyy/gists{/gist_id}","starred_url":"https://api.github.com/users/Superskyyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Superskyyy/subscriptions","organizations_url":"https://api.github.com/users/Superskyyy/orgs","repos_url":"https://api.github.com/users/Superskyyy/repos","events_url":"https://api.github.com/users/Superskyyy/events{/privacy}","received_events_url":"https://api.github.com/users/Superskyyy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-02T16:47:39Z","updated_at":"2024-02-02T16:47:39Z","author_association":"MEMBER","body":"@wonderhelios 你好 我们也对性能很感兴趣,请问可以分享出来测试用的代码吗 我这也想跑一下","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1924255230/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1925551196","html_url":"https://github.com/apache/brpc/issues/2533#issuecomment-1925551196","issue_url":"https://api.github.com/repos/apache/brpc/issues/2533","id":1925551196,"node_id":"IC_kwDOBhmkcs5yxZRc","user":{"login":"wonderhelios","id":17374965,"node_id":"MDQ6VXNlcjE3Mzc0OTY1","avatar_url":"https://avatars.githubusercontent.com/u/17374965?v=4","gravatar_id":"","url":"https://api.github.com/users/wonderhelios","html_url":"https://github.com/wonderhelios","followers_url":"https://api.github.com/users/wonderhelios/followers","following_url":"https://api.github.com/users/wonderhelios/following{/other_user}","gists_url":"https://api.github.com/users/wonderhelios/gists{/gist_id}","starred_url":"https://api.github.com/users/wonderhelios/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wonderhelios/subscriptions","organizations_url":"https://api.github.com/users/wonderhelios/orgs","repos_url":"https://api.github.com/users/wonderhelios/repos","events_url":"https://api.github.com/users/wonderhelios/events{/privacy}","received_events_url":"https://api.github.com/users/wonderhelios/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-04T02:04:12Z","updated_at":"2024-02-04T02:04:12Z","author_association":"NONE","body":"> @wonderhelios 你好 我们也对性能很感兴趣,请问可以分享出来测试用的代码吗 我这也想跑一下\r\n\r\nclient是简单的改动了一下brpc提供的rpc_press工具，同步模式，命令在上面给出了，server是直接启的brpc中的echo_server。\r\nrpc_press的改动如下：\r\n \r\n![image](https://github.com/apache/brpc/assets/17374965/19a56279-ea9a-4c32-9b78-2662e4937e60)\r\n![image](https://github.com/apache/brpc/assets/17374965/9c13f409-0046-4f7f-a89b-9df1e7f354c2)\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1925551196/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1925902304","html_url":"https://github.com/apache/brpc/issues/2533#issuecomment-1925902304","issue_url":"https://api.github.com/repos/apache/brpc/issues/2533","id":1925902304,"node_id":"IC_kwDOBhmkcs5yyu_g","user":{"login":"Superskyyy","id":26076517,"node_id":"MDQ6VXNlcjI2MDc2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/26076517?v=4","gravatar_id":"","url":"https://api.github.com/users/Superskyyy","html_url":"https://github.com/Superskyyy","followers_url":"https://api.github.com/users/Superskyyy/followers","following_url":"https://api.github.com/users/Superskyyy/following{/other_user}","gists_url":"https://api.github.com/users/Superskyyy/gists{/gist_id}","starred_url":"https://api.github.com/users/Superskyyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Superskyyy/subscriptions","organizations_url":"https://api.github.com/users/Superskyyy/orgs","repos_url":"https://api.github.com/users/Superskyyy/repos","events_url":"https://api.github.com/users/Superskyyy/events{/privacy}","received_events_url":"https://api.github.com/users/Superskyyy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-04T20:17:25Z","updated_at":"2024-02-04T20:17:25Z","author_association":"MEMBER","body":"> > @wonderhelios 你好 我们也对性能很感兴趣,请问可以分享出来测试用的代码吗 我这也想跑一下\r\n> \r\n> client是简单的改动了一下brpc提供的rpc_press工具，同步模式，命令在上面给出了，server是直接启的brpc中的echo_server。 rpc_press的改动如下：\r\n> \r\n> ![image](https://private-user-images.githubusercontent.com/17374965/302071877-19a56279-ea9a-4c32-9b78-2662e4937e60.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDcwNzgxMTksIm5iZiI6MTcwNzA3NzgxOSwicGF0aCI6Ii8xNzM3NDk2NS8zMDIwNzE4NzctMTlhNTYyNzktZWE5YS00YzMyLTliNzgtMjY2MmU0OTM3ZTYwLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDAyMDQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwMjA0VDIwMTY1OVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTczNjlmYzc5MDUwNWFkMThkNjUxYTQ1ZGE1ZTBjOWVkODZlMDg3MzcwODQ3MTM3YTk1Mjg1MDAxZjg2ZTZlZDcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.hLRGdOWsQ8rXlw1g0gexe8Lmb0dcJO2_b1Xb41wqQfQ) ![image](https://private-user-images.githubusercontent.com/17374965/302071885-9c13f409-0046-4f7f-a89b-9df1e7f354c2.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MDcwNzgxMTksIm5iZiI6MTcwNzA3NzgxOSwicGF0aCI6Ii8xNzM3NDk2NS8zMDIwNzE4ODUtOWMxM2Y0MDktMDA0Ni00ZjdmLWE4OWItOWRmMWU3ZjM1NGMyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDAyMDQlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwMjA0VDIwMTY1OVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTM4ZWQ1MmQ3ZmU2OTRhNWZiNjEzNjg1ZjJkYjRiNTFlZTIzZjVlNGY4N2QzMjY2NTY1OGE1NGI5MmU3ZWMzNTcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.Xgrskwy1ljU8iUvEDAYBoQWjl9j7PViO8Fs97ywAi7s)\r\n\r\n非常感谢！","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1925902304/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1926075788","html_url":"https://github.com/apache/brpc/pull/2519#issuecomment-1926075788","issue_url":"https://api.github.com/repos/apache/brpc/issues/2519","id":1926075788,"node_id":"IC_kwDOBhmkcs5yzZWM","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-05T01:46:59Z","updated_at":"2024-02-05T01:46:59Z","author_association":"CONTRIBUTOR","body":"@wwbmmm 这个PR有时间可以review了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1926075788/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1926165119","html_url":"https://github.com/apache/brpc/pull/2156#issuecomment-1926165119","issue_url":"https://api.github.com/repos/apache/brpc/issues/2156","id":1926165119,"node_id":"IC_kwDOBhmkcs5yzvJ_","user":{"login":"zcfh","id":70124382,"node_id":"MDQ6VXNlcjcwMTI0Mzgy","avatar_url":"https://avatars.githubusercontent.com/u/70124382?v=4","gravatar_id":"","url":"https://api.github.com/users/zcfh","html_url":"https://github.com/zcfh","followers_url":"https://api.github.com/users/zcfh/followers","following_url":"https://api.github.com/users/zcfh/following{/other_user}","gists_url":"https://api.github.com/users/zcfh/gists{/gist_id}","starred_url":"https://api.github.com/users/zcfh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zcfh/subscriptions","organizations_url":"https://api.github.com/users/zcfh/orgs","repos_url":"https://api.github.com/users/zcfh/repos","events_url":"https://api.github.com/users/zcfh/events{/privacy}","received_events_url":"https://api.github.com/users/zcfh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-05T03:22:58Z","updated_at":"2024-02-05T03:48:45Z","author_association":"NONE","body":"感觉还是 thread_local 读写的问题，  请问下除了这个patch外，后面还有其他关于这个问题的修复吗？\r\n目前去掉 `src/bthread/task_group.cpp` 的lto后，可以正常工作。\r\n\r\ntask_runner 循环外的 tls，也加上 BAIDU_GET_VOLATILE_THREAD_LOCAL，后似乎问题不再出现了。\r\n```\r\n void TaskGroup::task_runner(intptr_t skip_remained) {\r\n     // NOTE: tls_task_group is volatile since tasks are moved around\r\n     //       different groups.\r\n-    TaskGroup* g = tls_task_group;\r\n+    TaskGroup* g = BAIDU_GET_VOLATILE_THREAD_LOCAL(tls_task_group);\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1926165119/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1926276260","html_url":"https://github.com/apache/brpc/pull/2156#issuecomment-1926276260","issue_url":"https://api.github.com/repos/apache/brpc/issues/2156","id":1926276260,"node_id":"IC_kwDOBhmkcs5y0KSk","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-05T05:49:33Z","updated_at":"2024-02-05T05:52:23Z","author_association":"CONTRIBUTOR","body":"> 感觉还是 thread_local 读写的问题， 请问下除了这个patch外，后面还有其他关于这个问题的修复吗？ 目前去掉 `src/bthread/task_group.cpp` 的lto后，可以正常工作。\r\n> \r\n> task_runner 循环外的 tls，也加上 BAIDU_GET_VOLATILE_THREAD_LOCAL，后似乎问题不再出现了。\r\n> \r\n> ```\r\n>  void TaskGroup::task_runner(intptr_t skip_remained) {\r\n>      // NOTE: tls_task_group is volatile since tasks are moved around\r\n>      //       different groups.\r\n> -    TaskGroup* g = tls_task_group;\r\n> +    TaskGroup* g = BAIDU_GET_VOLATILE_THREAD_LOCAL(tls_task_group);\r\n> ```\r\n\r\n后续还有3个改动：\r\n\r\n1. 根据编译器是否开启该宏\r\nhttps://github.com/apache/brpc/pull/2248\r\nhttps://github.com/apache/brpc/pull/2324\r\n2. 添加漏掉的需要添加的 访问 tls_task_group 的地方\r\nhttps://github.com/apache/brpc/pull/2262\r\n\r\n怀疑可能更跟 https://github.com/apache/brpc/pull/2262 这个修改有关。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1926276260/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1926332705","html_url":"https://github.com/apache/brpc/pull/2156#issuecomment-1926332705","issue_url":"https://api.github.com/repos/apache/brpc/issues/2156","id":1926332705,"node_id":"IC_kwDOBhmkcs5y0YEh","user":{"login":"zcfh","id":70124382,"node_id":"MDQ6VXNlcjcwMTI0Mzgy","avatar_url":"https://avatars.githubusercontent.com/u/70124382?v=4","gravatar_id":"","url":"https://api.github.com/users/zcfh","html_url":"https://github.com/zcfh","followers_url":"https://api.github.com/users/zcfh/followers","following_url":"https://api.github.com/users/zcfh/following{/other_user}","gists_url":"https://api.github.com/users/zcfh/gists{/gist_id}","starred_url":"https://api.github.com/users/zcfh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zcfh/subscriptions","organizations_url":"https://api.github.com/users/zcfh/orgs","repos_url":"https://api.github.com/users/zcfh/repos","events_url":"https://api.github.com/users/zcfh/events{/privacy}","received_events_url":"https://api.github.com/users/zcfh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-05T06:51:53Z","updated_at":"2024-02-05T06:51:53Z","author_association":"NONE","body":"另外还有一个疑问是，函数 task_runner 和 tls_task_group 不都是在一个编译单元内吗？为什么是开启lto后才会触发这个问题呢。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1926332705/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1926722893","html_url":"https://github.com/apache/brpc/pull/2156#issuecomment-1926722893","issue_url":"https://api.github.com/repos/apache/brpc/issues/2156","id":1926722893,"node_id":"IC_kwDOBhmkcs5y13VN","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-05T11:01:48Z","updated_at":"2024-02-05T11:02:04Z","author_association":"CONTRIBUTOR","body":"> 另外还有一个疑问是，函数 task_runner 和 tls_task_group 不都是在一个编译单元内吗？为什么是开启lto后才会触发这个问题呢。\r\n\r\n不开启 `lto` 也是会有这个问题的，具体跟编译器的类别、版本以及编译参数等有关。具体的话可以通过 llvm-objdump/objdump 工具把可执行的产物 dump 出来，看下 task_runner 函数里面获取 `tls_task_group` 是否符合预期来进行分析。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1926722893/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1931475037","html_url":"https://github.com/apache/brpc/pull/2520#issuecomment-1931475037","issue_url":"https://api.github.com/repos/apache/brpc/issues/2520","id":1931475037,"node_id":"IC_kwDOBhmkcs5zH_hd","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-07T07:58:38Z","updated_at":"2024-02-07T07:58:38Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1931475037/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1931485963","html_url":"https://github.com/apache/brpc/pull/2524#issuecomment-1931485963","issue_url":"https://api.github.com/repos/apache/brpc/issues/2524","id":1931485963,"node_id":"IC_kwDOBhmkcs5zICML","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-07T08:06:49Z","updated_at":"2024-02-07T08:06:49Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1931485963/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1934799033","html_url":"https://github.com/apache/brpc/issues/2475#issuecomment-1934799033","issue_url":"https://api.github.com/repos/apache/brpc/issues/2475","id":1934799033,"node_id":"IC_kwDOBhmkcs5zUrC5","user":{"login":"Superskyyy","id":26076517,"node_id":"MDQ6VXNlcjI2MDc2NTE3","avatar_url":"https://avatars.githubusercontent.com/u/26076517?v=4","gravatar_id":"","url":"https://api.github.com/users/Superskyyy","html_url":"https://github.com/Superskyyy","followers_url":"https://api.github.com/users/Superskyyy/followers","following_url":"https://api.github.com/users/Superskyyy/following{/other_user}","gists_url":"https://api.github.com/users/Superskyyy/gists{/gist_id}","starred_url":"https://api.github.com/users/Superskyyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Superskyyy/subscriptions","organizations_url":"https://api.github.com/users/Superskyyy/orgs","repos_url":"https://api.github.com/users/Superskyyy/repos","events_url":"https://api.github.com/users/Superskyyy/events{/privacy}","received_events_url":"https://api.github.com/users/Superskyyy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-08T19:26:23Z","updated_at":"2024-02-08T19:26:23Z","author_association":"MEMBER","body":"请问问题有解决吗 @binarycopycode ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1934799033/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1935250334","html_url":"https://github.com/apache/brpc/pull/2519#issuecomment-1935250334","issue_url":"https://api.github.com/repos/apache/brpc/issues/2519","id":1935250334,"node_id":"IC_kwDOBhmkcs5zWZOe","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-09T02:36:00Z","updated_at":"2024-02-09T02:36:00Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1935250334/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1942070918","html_url":"https://github.com/apache/brpc/pull/2358#issuecomment-1942070918","issue_url":"https://api.github.com/repos/apache/brpc/issues/2358","id":1942070918,"node_id":"IC_kwDOBhmkcs5zwaaG","user":{"login":"ketor","id":3497139,"node_id":"MDQ6VXNlcjM0OTcxMzk=","avatar_url":"https://avatars.githubusercontent.com/u/3497139?v=4","gravatar_id":"","url":"https://api.github.com/users/ketor","html_url":"https://github.com/ketor","followers_url":"https://api.github.com/users/ketor/followers","following_url":"https://api.github.com/users/ketor/following{/other_user}","gists_url":"https://api.github.com/users/ketor/gists{/gist_id}","starred_url":"https://api.github.com/users/ketor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ketor/subscriptions","organizations_url":"https://api.github.com/users/ketor/orgs","repos_url":"https://api.github.com/users/ketor/repos","events_url":"https://api.github.com/users/ketor/events{/privacy}","received_events_url":"https://api.github.com/users/ketor/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-13T17:34:06Z","updated_at":"2024-02-13T17:34:06Z","author_association":"CONTRIBUTOR","body":"请问这个PR的改动，如果使用了bthread::ExecutionQueue，ExecutionQueue里面的任务如何区分按照哪个tag去调度的呢？ 还是整个ExecutionQueue对应于一个tag呢？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1942070918/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1942746416","html_url":"https://github.com/apache/brpc/pull/2358#issuecomment-1942746416","issue_url":"https://api.github.com/repos/apache/brpc/issues/2358","id":1942746416,"node_id":"IC_kwDOBhmkcs5zy_Uw","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-13T22:30:13Z","updated_at":"2024-02-13T22:30:13Z","author_association":"CONTRIBUTOR","body":"> 请问这个PR的改动，如果使用了bthread::ExecutionQueue，ExecutionQueue里面的任务如何区分按照哪个tag去调度的呢？ 还是整个ExecutionQueue对应于一个tag呢？\r\n\r\n最好还是一个tag启动一个execq比较合适","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1942746416/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1943846669","html_url":"https://github.com/apache/brpc/pull/2358#issuecomment-1943846669","issue_url":"https://api.github.com/repos/apache/brpc/issues/2358","id":1943846669,"node_id":"IC_kwDOBhmkcs5z3L8N","user":{"login":"ketor","id":3497139,"node_id":"MDQ6VXNlcjM0OTcxMzk=","avatar_url":"https://avatars.githubusercontent.com/u/3497139?v=4","gravatar_id":"","url":"https://api.github.com/users/ketor","html_url":"https://github.com/ketor","followers_url":"https://api.github.com/users/ketor/followers","following_url":"https://api.github.com/users/ketor/following{/other_user}","gists_url":"https://api.github.com/users/ketor/gists{/gist_id}","starred_url":"https://api.github.com/users/ketor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ketor/subscriptions","organizations_url":"https://api.github.com/users/ketor/orgs","repos_url":"https://api.github.com/users/ketor/repos","events_url":"https://api.github.com/users/ketor/events{/privacy}","received_events_url":"https://api.github.com/users/ketor/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-14T14:12:03Z","updated_at":"2024-02-14T14:12:03Z","author_association":"CONTRIBUTOR","body":"> > 请问这个PR的改动，如果使用了bthread::ExecutionQueue，ExecutionQueue里面的任务如何区分按照哪个tag去调度的呢？ 还是整个ExecutionQueue对应于一个tag呢？\r\n> \r\n> 最好还是一个tag启动一个execq比较合适\r\n谢谢！\r\n\r\n启动ExecutionQueue的时候，在attr里面指定上tag，就是整个ExecutionQueue都会在这个tag所在的线程池里执行了是么？\r\n另外现在的实现，如果使用了bthread_mutex/cond这些同步原语，跨线程池的时候，这些同步原语的工作是否会有问题呢？ 看了2个PR里的discussion，似乎没有给出明确的答案，所以请教一下。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1943846669/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1945183040","html_url":"https://github.com/apache/brpc/pull/2358#issuecomment-1945183040","issue_url":"https://api.github.com/repos/apache/brpc/issues/2358","id":1945183040,"node_id":"IC_kwDOBhmkcs5z8SNA","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-15T00:45:08Z","updated_at":"2024-02-15T00:45:08Z","author_association":"CONTRIBUTOR","body":"> > > 请问这个PR的改动，如果使用了bthread::ExecutionQueue，ExecutionQueue里面的任务如何区分按照哪个tag去调度的呢？ 还是整个ExecutionQueue对应于一个tag呢？\r\n> > \r\n> > \r\n> > 最好还是一个tag启动一个execq比较合适\r\n> > 谢谢！\r\n> \r\n> 启动ExecutionQueue的时候，在attr里面指定上tag，就是整个ExecutionQueue都会在这个tag所在的线程池里执行了是么？ 另外现在的实现，如果使用了bthread_mutex/cond这些同步原语，跨线程池的时候，这些同步原语的工作是否会有问题呢？ 看了2个PR里的discussion，似乎没有给出明确的答案，所以请教一下。\r\n\r\n1、execq会启动协程，这个协程设置好attribute的tag就可以了\r\n2、跨线程池不要使用bthread原语会有问题，可以使用pthread原语。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1945183040/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1948054327","html_url":"https://github.com/apache/brpc/issues/2538#issuecomment-1948054327","issue_url":"https://api.github.com/repos/apache/brpc/issues/2538","id":1948054327,"node_id":"IC_kwDOBhmkcs50HPM3","user":{"login":"xiedeacc","id":8072296,"node_id":"MDQ6VXNlcjgwNzIyOTY=","avatar_url":"https://avatars.githubusercontent.com/u/8072296?v=4","gravatar_id":"","url":"https://api.github.com/users/xiedeacc","html_url":"https://github.com/xiedeacc","followers_url":"https://api.github.com/users/xiedeacc/followers","following_url":"https://api.github.com/users/xiedeacc/following{/other_user}","gists_url":"https://api.github.com/users/xiedeacc/gists{/gist_id}","starred_url":"https://api.github.com/users/xiedeacc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiedeacc/subscriptions","organizations_url":"https://api.github.com/users/xiedeacc/orgs","repos_url":"https://api.github.com/users/xiedeacc/repos","events_url":"https://api.github.com/users/xiedeacc/events{/privacy}","received_events_url":"https://api.github.com/users/xiedeacc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-16T09:43:00Z","updated_at":"2024-02-16T09:43:01Z","author_association":"NONE","body":"问题已经找到，core在自己代码","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1948054327/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1948762864","html_url":"https://github.com/apache/brpc/pull/2358#issuecomment-1948762864","issue_url":"https://api.github.com/repos/apache/brpc/issues/2358","id":1948762864,"node_id":"IC_kwDOBhmkcs50J8Lw","user":{"login":"ketor","id":3497139,"node_id":"MDQ6VXNlcjM0OTcxMzk=","avatar_url":"https://avatars.githubusercontent.com/u/3497139?v=4","gravatar_id":"","url":"https://api.github.com/users/ketor","html_url":"https://github.com/ketor","followers_url":"https://api.github.com/users/ketor/followers","following_url":"https://api.github.com/users/ketor/following{/other_user}","gists_url":"https://api.github.com/users/ketor/gists{/gist_id}","starred_url":"https://api.github.com/users/ketor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ketor/subscriptions","organizations_url":"https://api.github.com/users/ketor/orgs","repos_url":"https://api.github.com/users/ketor/repos","events_url":"https://api.github.com/users/ketor/events{/privacy}","received_events_url":"https://api.github.com/users/ketor/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-16T16:10:57Z","updated_at":"2024-02-16T16:11:17Z","author_association":"CONTRIBUTOR","body":"感觉ExecutionQueue这个用起来还是有点问题，比如in_place执行的场景，task是在当前bthread执行的，就有可与初始化execq时指定的attr的tag不一致，如果task里面用到了bthread_mutex，就可能存在跨线程池唤醒的问题。\r\n\r\n在我们的项目里面还有一个场景，感觉也有可能有问题，具体如下：\r\n对外服务是一个端口，braft使用的是另一个端口，期望对外服务和braft如果分别使用不同的tag调度。\r\n但是在业务流程中，存在对外服务的service函数中，要执行提交到braft状态机，然后阻塞到bthread_cond上，然后等待raft apply之后的在closure中对bthread_cond进行signal。这个操作就相当于是用bthread_cond实现了异步转同步的调用。\r\n\r\n由于对外服务和braft使用了不同的tag，braft的on_apply调用是在execq中执行，按这个PR前面的讨论，会指定attr的tag为braft使用的tag，那么on_apply执行所使用的bthread就会是braft的tag，在on_apply中调用bthread_cond_signal，就会发生跨线程池使用bthread同步原语的问题了。\r\n\r\n如果是这种场景，根据前面的讨论，应该是不适合让对外服务和braft服务使用不同的tag来调度了。不知道这样的理解是否正确？\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1948762864/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1949464923","html_url":"https://github.com/apache/brpc/pull/2358#issuecomment-1949464923","issue_url":"https://api.github.com/repos/apache/brpc/issues/2358","id":1949464923,"node_id":"IC_kwDOBhmkcs50Mnlb","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-02-16T23:10:22Z","updated_at":"2024-02-16T23:10:22Z","author_association":"CONTRIBUTOR","body":"> 感觉ExecutionQueue这个用起来还是有点问题，比如in_place执行的场景，task是在当前bthread执行的，就有可与初始化execq时指定的attr的tag不一致，如果task里面用到了bthread_mutex，就可能存在跨线程池唤醒的问题。\r\n> \r\n> 在我们的项目里面还有一个场景，感觉也有可能有问题，具体如下： 对外服务是一个端口，braft使用的是另一个端口，期望对外服务和braft如果分别使用不同的tag调度。 但是在业务流程中，存在对外服务的service函数中，要执行提交到braft状态机，然后阻塞到bthread_cond上，然后等待raft apply之后的在closure中对bthread_cond进行signal。这个操作就相当于是用bthread_cond实现了异步转同步的调用。\r\n> \r\n> 由于对外服务和braft使用了不同的tag，braft的on_apply调用是在execq中执行，按这个PR前面的讨论，会指定attr的tag为braft使用的tag，那么on_apply执行所使用的bthread就会是braft的tag，在on_apply中调用bthread_cond_signal，就会发生跨线程池使用bthread同步原语的问题了。\r\n> \r\n> 如果是这种场景，根据前面的讨论，应该是不适合让对外服务和braft服务使用不同的tag来调度了。不知道这样的理解是否正确？\r\n\r\n划分线程池的目的是为了隔离，感觉你对外服务和braft已经在上层通过execq做了隔离，是不是就没必要再使用这个功能了呢？\r\n如果要使用可能要做一些改造，attribute可以按照你的情况制定，但是bthread原语确实不能跨线程池。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1949464923/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]