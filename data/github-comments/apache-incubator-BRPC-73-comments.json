[{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2071849093","html_url":"https://github.com/apache/brpc/pull/2607#issuecomment-2071849093","issue_url":"https://api.github.com/repos/apache/brpc/issues/2607","id":2071849093,"node_id":"IC_kwDOBhmkcs57feiF","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-23T09:32:49Z","updated_at":"2024-04-23T09:32:49Z","author_association":"CONTRIBUTOR","body":"master分支已经修复了ci的问题，可以更新一下PR。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2071849093/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2072326140","html_url":"https://github.com/apache/brpc/pull/2608#issuecomment-2072326140","issue_url":"https://api.github.com/repos/apache/brpc/issues/2608","id":2072326140,"node_id":"IC_kwDOBhmkcs57hS_8","user":{"login":"PeterRK","id":4464013,"node_id":"MDQ6VXNlcjQ0NjQwMTM=","avatar_url":"https://avatars.githubusercontent.com/u/4464013?v=4","gravatar_id":"","url":"https://api.github.com/users/PeterRK","html_url":"https://github.com/PeterRK","followers_url":"https://api.github.com/users/PeterRK/followers","following_url":"https://api.github.com/users/PeterRK/following{/other_user}","gists_url":"https://api.github.com/users/PeterRK/gists{/gist_id}","starred_url":"https://api.github.com/users/PeterRK/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/PeterRK/subscriptions","organizations_url":"https://api.github.com/users/PeterRK/orgs","repos_url":"https://api.github.com/users/PeterRK/repos","events_url":"https://api.github.com/users/PeterRK/events{/privacy}","received_events_url":"https://api.github.com/users/PeterRK/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-23T13:28:19Z","updated_at":"2024-04-23T13:28:19Z","author_association":"NONE","body":"> 提供一个option来支持该特性，是不是合适些？这样就不会影响已有的逻辑了。\r\n\r\n 这应该是一个bug，原来的实现中string、bool、int32、uint32四种类型没有返回错误，int64、uint64、float、double、enum、object则会返回错误。统一都返回错误才是合理的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2072326140/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2074251692","html_url":"https://github.com/apache/brpc/issues/2612#issuecomment-2074251692","issue_url":"https://api.github.com/repos/apache/brpc/issues/2612","id":2074251692,"node_id":"IC_kwDOBhmkcs57opGs","user":{"login":"cmdmspaint","id":50624748,"node_id":"MDQ6VXNlcjUwNjI0NzQ4","avatar_url":"https://avatars.githubusercontent.com/u/50624748?v=4","gravatar_id":"","url":"https://api.github.com/users/cmdmspaint","html_url":"https://github.com/cmdmspaint","followers_url":"https://api.github.com/users/cmdmspaint/followers","following_url":"https://api.github.com/users/cmdmspaint/following{/other_user}","gists_url":"https://api.github.com/users/cmdmspaint/gists{/gist_id}","starred_url":"https://api.github.com/users/cmdmspaint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmdmspaint/subscriptions","organizations_url":"https://api.github.com/users/cmdmspaint/orgs","repos_url":"https://api.github.com/users/cmdmspaint/repos","events_url":"https://api.github.com/users/cmdmspaint/events{/privacy}","received_events_url":"https://api.github.com/users/cmdmspaint/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-24T07:22:02Z","updated_at":"2024-04-24T07:22:02Z","author_association":"NONE","body":"分别在什么场景会使用bigview/smallview","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2074251692/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076252876","html_url":"https://github.com/apache/brpc/issues/2598#issuecomment-2076252876","issue_url":"https://api.github.com/repos/apache/brpc/issues/2598","id":2076252876,"node_id":"IC_kwDOBhmkcs57wRrM","user":{"login":"TousakaRin","id":8801314,"node_id":"MDQ6VXNlcjg4MDEzMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8801314?v=4","gravatar_id":"","url":"https://api.github.com/users/TousakaRin","html_url":"https://github.com/TousakaRin","followers_url":"https://api.github.com/users/TousakaRin/followers","following_url":"https://api.github.com/users/TousakaRin/following{/other_user}","gists_url":"https://api.github.com/users/TousakaRin/gists{/gist_id}","starred_url":"https://api.github.com/users/TousakaRin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TousakaRin/subscriptions","organizations_url":"https://api.github.com/users/TousakaRin/orgs","repos_url":"https://api.github.com/users/TousakaRin/repos","events_url":"https://api.github.com/users/TousakaRin/events{/privacy}","received_events_url":"https://api.github.com/users/TousakaRin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-25T02:42:59Z","updated_at":"2024-04-25T02:42:59Z","author_association":"CONTRIBUTOR","body":"是的，可能会陷入内核，但是即便不发起任何syscall也有可能被内核调度走呀","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076252876/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076269720","html_url":"https://github.com/apache/brpc/issues/2598#issuecomment-2076269720","issue_url":"https://api.github.com/repos/apache/brpc/issues/2598","id":2076269720,"node_id":"IC_kwDOBhmkcs57wVyY","user":{"login":"ilixiaocui","id":15689619,"node_id":"MDQ6VXNlcjE1Njg5NjE5","avatar_url":"https://avatars.githubusercontent.com/u/15689619?v=4","gravatar_id":"","url":"https://api.github.com/users/ilixiaocui","html_url":"https://github.com/ilixiaocui","followers_url":"https://api.github.com/users/ilixiaocui/followers","following_url":"https://api.github.com/users/ilixiaocui/following{/other_user}","gists_url":"https://api.github.com/users/ilixiaocui/gists{/gist_id}","starred_url":"https://api.github.com/users/ilixiaocui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilixiaocui/subscriptions","organizations_url":"https://api.github.com/users/ilixiaocui/orgs","repos_url":"https://api.github.com/users/ilixiaocui/repos","events_url":"https://api.github.com/users/ilixiaocui/events{/privacy}","received_events_url":"https://api.github.com/users/ilixiaocui/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-25T03:08:09Z","updated_at":"2024-04-25T03:26:16Z","author_association":"NONE","body":"> 是的，可能会陷入内核，但是即便不发起任何syscall也有可能被内核调度走呀\r\n\r\n主要是看到[这里](https://brpc.apache.org/zh/docs/blogs/sourcecodes/butex/)的疑问：也就是使用butex也还是有概率会导致pthread被挂起的？但是由于这里的临界区很小，被挂起的概率就小很多？\r\n\r\n<img width=\"1023\" alt=\"image\" src=\"https://github.com/apache/brpc/assets/15689619/5a26b11c-1bbc-4c2d-8265-19e25ce24b22\">\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076269720/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076278455","html_url":"https://github.com/apache/brpc/issues/2612#issuecomment-2076278455","issue_url":"https://api.github.com/repos/apache/brpc/issues/2612","id":2076278455,"node_id":"IC_kwDOBhmkcs57wX63","user":{"login":"TousakaRin","id":8801314,"node_id":"MDQ6VXNlcjg4MDEzMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8801314?v=4","gravatar_id":"","url":"https://api.github.com/users/TousakaRin","html_url":"https://github.com/TousakaRin","followers_url":"https://api.github.com/users/TousakaRin/followers","following_url":"https://api.github.com/users/TousakaRin/following{/other_user}","gists_url":"https://api.github.com/users/TousakaRin/gists{/gist_id}","starred_url":"https://api.github.com/users/TousakaRin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TousakaRin/subscriptions","organizations_url":"https://api.github.com/users/TousakaRin/orgs","repos_url":"https://api.github.com/users/TousakaRin/repos","events_url":"https://api.github.com/users/TousakaRin/events{/privacy}","received_events_url":"https://api.github.com/users/TousakaRin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-25T03:19:47Z","updated_at":"2024-04-25T03:19:47Z","author_association":"CONTRIBUTOR","body":"smallview 是一个SSO，IOBuf创建的时候默认都是smallview，此时它所引用的BlockRef都直接保存在对象内部的数组里（SmallView::refs)，当这个IOBuf所引用的BlockRef超过这个数组大小时，转而从堆上申请一个数组。这么做的原因猜测是因为存在大量直接在栈上创建的，大小很小的IOBuf，使用SSO可以大量减少malloc的调用次数","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076278455/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076282262","html_url":"https://github.com/apache/brpc/issues/2612#issuecomment-2076282262","issue_url":"https://api.github.com/repos/apache/brpc/issues/2612","id":2076282262,"node_id":"IC_kwDOBhmkcs57wY2W","user":{"login":"cmdmspaint","id":50624748,"node_id":"MDQ6VXNlcjUwNjI0NzQ4","avatar_url":"https://avatars.githubusercontent.com/u/50624748?v=4","gravatar_id":"","url":"https://api.github.com/users/cmdmspaint","html_url":"https://github.com/cmdmspaint","followers_url":"https://api.github.com/users/cmdmspaint/followers","following_url":"https://api.github.com/users/cmdmspaint/following{/other_user}","gists_url":"https://api.github.com/users/cmdmspaint/gists{/gist_id}","starred_url":"https://api.github.com/users/cmdmspaint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmdmspaint/subscriptions","organizations_url":"https://api.github.com/users/cmdmspaint/orgs","repos_url":"https://api.github.com/users/cmdmspaint/repos","events_url":"https://api.github.com/users/cmdmspaint/events{/privacy}","received_events_url":"https://api.github.com/users/cmdmspaint/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-25T03:25:51Z","updated_at":"2024-04-25T03:25:51Z","author_association":"NONE","body":"如果要获取iobuf中的data 是否可以通过 iobuf的backing_block_num()获取block数量，然后使用backing_block(index)的方式取出iobuf中的所有用户数据呢\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076282262/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076287310","html_url":"https://github.com/apache/brpc/issues/2612#issuecomment-2076287310","issue_url":"https://api.github.com/repos/apache/brpc/issues/2612","id":2076287310,"node_id":"IC_kwDOBhmkcs57waFO","user":{"login":"TousakaRin","id":8801314,"node_id":"MDQ6VXNlcjg4MDEzMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8801314?v=4","gravatar_id":"","url":"https://api.github.com/users/TousakaRin","html_url":"https://github.com/TousakaRin","followers_url":"https://api.github.com/users/TousakaRin/followers","following_url":"https://api.github.com/users/TousakaRin/following{/other_user}","gists_url":"https://api.github.com/users/TousakaRin/gists{/gist_id}","starred_url":"https://api.github.com/users/TousakaRin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TousakaRin/subscriptions","organizations_url":"https://api.github.com/users/TousakaRin/orgs","repos_url":"https://api.github.com/users/TousakaRin/repos","events_url":"https://api.github.com/users/TousakaRin/events{/privacy}","received_events_url":"https://api.github.com/users/TousakaRin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-25T03:34:28Z","updated_at":"2024-04-25T03:34:28Z","author_association":"CONTRIBUTOR","body":"如果是为了压缩可以参考 brpc/policy/gzip_compress.cpp, 计算crc的话，可以考虑调用IOBuf::copy_to/to_string等接口。直接读取backing_block_num也是可行的，参考IOBuf::copy_to的实现提取数据即可","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076287310/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076292924","html_url":"https://github.com/apache/brpc/issues/2612#issuecomment-2076292924","issue_url":"https://api.github.com/repos/apache/brpc/issues/2612","id":2076292924,"node_id":"IC_kwDOBhmkcs57wbc8","user":{"login":"cmdmspaint","id":50624748,"node_id":"MDQ6VXNlcjUwNjI0NzQ4","avatar_url":"https://avatars.githubusercontent.com/u/50624748?v=4","gravatar_id":"","url":"https://api.github.com/users/cmdmspaint","html_url":"https://github.com/cmdmspaint","followers_url":"https://api.github.com/users/cmdmspaint/followers","following_url":"https://api.github.com/users/cmdmspaint/following{/other_user}","gists_url":"https://api.github.com/users/cmdmspaint/gists{/gist_id}","starred_url":"https://api.github.com/users/cmdmspaint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmdmspaint/subscriptions","organizations_url":"https://api.github.com/users/cmdmspaint/orgs","repos_url":"https://api.github.com/users/cmdmspaint/repos","events_url":"https://api.github.com/users/cmdmspaint/events{/privacy}","received_events_url":"https://api.github.com/users/cmdmspaint/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-25T03:44:17Z","updated_at":"2024-04-25T03:44:17Z","author_association":"NONE","body":"看了一下 IOBuf::copy_to/to_string会调用memcpy,在不想引入这次内存拷贝的前提下，直接读取backing block是不是一个更好的选择","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076292924/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076294306","html_url":"https://github.com/apache/brpc/issues/2598#issuecomment-2076294306","issue_url":"https://api.github.com/repos/apache/brpc/issues/2598","id":2076294306,"node_id":"IC_kwDOBhmkcs57wbyi","user":{"login":"TousakaRin","id":8801314,"node_id":"MDQ6VXNlcjg4MDEzMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8801314?v=4","gravatar_id":"","url":"https://api.github.com/users/TousakaRin","html_url":"https://github.com/TousakaRin","followers_url":"https://api.github.com/users/TousakaRin/followers","following_url":"https://api.github.com/users/TousakaRin/following{/other_user}","gists_url":"https://api.github.com/users/TousakaRin/gists{/gist_id}","starred_url":"https://api.github.com/users/TousakaRin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TousakaRin/subscriptions","organizations_url":"https://api.github.com/users/TousakaRin/orgs","repos_url":"https://api.github.com/users/TousakaRin/repos","events_url":"https://api.github.com/users/TousakaRin/events{/privacy}","received_events_url":"https://api.github.com/users/TousakaRin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-25T03:46:21Z","updated_at":"2024-04-25T03:46:21Z","author_association":"CONTRIBUTOR","body":"这里想表达的是： 如果一个bthread阻塞在butex上，它会被添加到butex的等待队列，不论它将要等待多久，这个pthread在操作完之后都可以立即去继续执行其他bthread，反之如果阻塞在mutex上，这个就需要等待mutex被释放之后才能继续执行其他bthread。前面的case pthread 被阻塞的概率和时长，与这个butex被释放的时间无关。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076294306/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076295995","html_url":"https://github.com/apache/brpc/issues/2612#issuecomment-2076295995","issue_url":"https://api.github.com/repos/apache/brpc/issues/2612","id":2076295995,"node_id":"IC_kwDOBhmkcs57wcM7","user":{"login":"TousakaRin","id":8801314,"node_id":"MDQ6VXNlcjg4MDEzMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8801314?v=4","gravatar_id":"","url":"https://api.github.com/users/TousakaRin","html_url":"https://github.com/TousakaRin","followers_url":"https://api.github.com/users/TousakaRin/followers","following_url":"https://api.github.com/users/TousakaRin/following{/other_user}","gists_url":"https://api.github.com/users/TousakaRin/gists{/gist_id}","starred_url":"https://api.github.com/users/TousakaRin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TousakaRin/subscriptions","organizations_url":"https://api.github.com/users/TousakaRin/orgs","repos_url":"https://api.github.com/users/TousakaRin/repos","events_url":"https://api.github.com/users/TousakaRin/events{/privacy}","received_events_url":"https://api.github.com/users/TousakaRin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-25T03:49:09Z","updated_at":"2024-04-25T03:49:09Z","author_association":"CONTRIBUTOR","body":"嗯，注意计算偏移量即可，建议如果对性能敏感最好做下benchmark","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076295995/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076568387","html_url":"https://github.com/apache/brpc/issues/2598#issuecomment-2076568387","issue_url":"https://api.github.com/repos/apache/brpc/issues/2598","id":2076568387,"node_id":"IC_kwDOBhmkcs57xetD","user":{"login":"ilixiaocui","id":15689619,"node_id":"MDQ6VXNlcjE1Njg5NjE5","avatar_url":"https://avatars.githubusercontent.com/u/15689619?v=4","gravatar_id":"","url":"https://api.github.com/users/ilixiaocui","html_url":"https://github.com/ilixiaocui","followers_url":"https://api.github.com/users/ilixiaocui/followers","following_url":"https://api.github.com/users/ilixiaocui/following{/other_user}","gists_url":"https://api.github.com/users/ilixiaocui/gists{/gist_id}","starred_url":"https://api.github.com/users/ilixiaocui/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ilixiaocui/subscriptions","organizations_url":"https://api.github.com/users/ilixiaocui/orgs","repos_url":"https://api.github.com/users/ilixiaocui/repos","events_url":"https://api.github.com/users/ilixiaocui/events{/privacy}","received_events_url":"https://api.github.com/users/ilixiaocui/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-25T07:41:43Z","updated_at":"2024-04-25T07:41:43Z","author_association":"NONE","body":"> 这里想表达的是： 如果一个bthread阻塞在butex上，它会被添加到butex的等待队列，不论它将要等待多久，这个pthread在操作完之后都可以立即去继续执行其他bthread，反之如果阻塞在mutex上，这个就需要等待mutex被释放之后才能继续执行其他bthread。前面的case pthread 被阻塞的概率和时长，与这个butex被释放的时间无关。\r\n\r\n\r\n了解了 感谢 ~","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2076568387/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2078831495","html_url":"https://github.com/apache/brpc/issues/2617#issuecomment-2078831495","issue_url":"https://api.github.com/repos/apache/brpc/issues/2617","id":2078831495,"node_id":"IC_kwDOBhmkcs576HOH","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-26T07:53:11Z","updated_at":"2024-04-26T07:53:11Z","author_association":"CONTRIBUTOR","body":"不可行吧。\r\n\r\n有些时候，channel是动态创建的，Init之后发起rpc。A->B->C这种场景下，B要等到所有socket建连好才发rpc给C，rpc完成后相应A。这时候第一次调用的耗时会显著增加，甚至会超时吧。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2078831495/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2078952762","html_url":"https://github.com/apache/brpc/issues/2615#issuecomment-2078952762","issue_url":"https://api.github.com/repos/apache/brpc/issues/2615","id":2078952762,"node_id":"IC_kwDOBhmkcs576k06","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-26T08:59:27Z","updated_at":"2024-04-26T08:59:27Z","author_association":"CONTRIBUTOR","body":"> 如何使用set_response_compress_type，参数set_response_compress_type(brpc::CompressTypeZlib);编译不过去\r\n\r\n应该是`COMPRESS_TYPE_ZLIB`吧。\r\nhttps://github.com/apache/brpc/blob/68aff6947c10d92bf44aa585b1913deb91cf8f92/src/brpc/options.proto#L69-L75\r\n\r\n> [max_body_size]怎么设置\r\n\r\n`max_body_size`应该是gflag，通过`./bin --max_body_size=10000`设置。\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2078952762/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2080862340","html_url":"https://github.com/apache/brpc/pull/2551#issuecomment-2080862340","issue_url":"https://api.github.com/repos/apache/brpc/issues/2551","id":2080862340,"node_id":"IC_kwDOBhmkcs58B3CE","user":{"login":"ketor","id":3497139,"node_id":"MDQ6VXNlcjM0OTcxMzk=","avatar_url":"https://avatars.githubusercontent.com/u/3497139?v=4","gravatar_id":"","url":"https://api.github.com/users/ketor","html_url":"https://github.com/ketor","followers_url":"https://api.github.com/users/ketor/followers","following_url":"https://api.github.com/users/ketor/following{/other_user}","gists_url":"https://api.github.com/users/ketor/gists{/gist_id}","starred_url":"https://api.github.com/users/ketor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ketor/subscriptions","organizations_url":"https://api.github.com/users/ketor/orgs","repos_url":"https://api.github.com/users/ketor/repos","events_url":"https://api.github.com/users/ketor/events{/privacy}","received_events_url":"https://api.github.com/users/ketor/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-27T15:06:18Z","updated_at":"2024-04-27T15:06:18Z","author_association":"CONTRIBUTOR","body":"@yanglimingcn \r\n请问这个PR是意味着可以跨tag使用bthread同步原语了吗？ 使用中是否还有需要在注意的问题呢？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2080862340/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081354197","html_url":"https://github.com/apache/brpc/issues/2617#issuecomment-2081354197","issue_url":"https://api.github.com/repos/apache/brpc/issues/2617","id":2081354197,"node_id":"IC_kwDOBhmkcs58DvHV","user":{"login":"yzq-del","id":154497803,"node_id":"U_kgDOCTVzCw","avatar_url":"https://avatars.githubusercontent.com/u/154497803?v=4","gravatar_id":"","url":"https://api.github.com/users/yzq-del","html_url":"https://github.com/yzq-del","followers_url":"https://api.github.com/users/yzq-del/followers","following_url":"https://api.github.com/users/yzq-del/following{/other_user}","gists_url":"https://api.github.com/users/yzq-del/gists{/gist_id}","starred_url":"https://api.github.com/users/yzq-del/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yzq-del/subscriptions","organizations_url":"https://api.github.com/users/yzq-del/orgs","repos_url":"https://api.github.com/users/yzq-del/repos","events_url":"https://api.github.com/users/yzq-del/events{/privacy}","received_events_url":"https://api.github.com/users/yzq-del/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-28T06:30:29Z","updated_at":"2024-04-28T06:34:37Z","author_association":"NONE","body":"> 不可行吧。\r\n> \r\n> 有些时候，channel是动态创建的，Init之后发起rpc。A->B->C这种场景下，B要等到所有socket建连好才发rpc给C，rpc完成后相应A。这时候第一次调用的耗时会显著增加，甚至会超时吧。\r\n\r\n这个也不冲突吧。实现的细节问题，1、做成可选项，使用者自己决定。 2、框架做更细点，连接异步创建，”B要等到所有socket建连好才发rpc给C“这个可以做成”当前有连接成功的，就先用着呗“，且这个说法我有点疑惑，init后马上调用rpc，也需要先创建链接的，他是创建一个链接就马上发，还是等所有链接创建完再发？ ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081354197/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081356767","html_url":"https://github.com/apache/brpc/issues/2617#issuecomment-2081356767","issue_url":"https://api.github.com/repos/apache/brpc/issues/2617","id":2081356767,"node_id":"IC_kwDOBhmkcs58Dvvf","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-28T06:40:30Z","updated_at":"2024-04-28T06:40:30Z","author_association":"CONTRIBUTOR","body":"目前Socket不支持预先建连，不过 #2574 实现了在创建Socket对象的时候建连。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081356767/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081357281","html_url":"https://github.com/apache/brpc/issues/2617#issuecomment-2081357281","issue_url":"https://api.github.com/repos/apache/brpc/issues/2617","id":2081357281,"node_id":"IC_kwDOBhmkcs58Dv3h","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-28T06:43:05Z","updated_at":"2024-04-28T06:43:05Z","author_association":"CONTRIBUTOR","body":"> 这个说法我有点疑惑，init后马上调用rpc，也需要先创建链接的，他是创建一个链接就马上发，还是等所有链接创建完再发？\r\n\r\nhttps://github.com/apache/brpc/blob/master/docs/cn/client.md#%E9%99%84client%E7%AB%AF%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B\r\n\r\n可以看看这个流程图。对于使用名字访问的场景，rpc要等到所有Socket对象（只是创建Socket对象，这个过程很快）创建好才会发出去。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081357281/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081357642","html_url":"https://github.com/apache/brpc/issues/2617#issuecomment-2081357642","issue_url":"https://api.github.com/repos/apache/brpc/issues/2617","id":2081357642,"node_id":"IC_kwDOBhmkcs58Dv9K","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-28T06:44:30Z","updated_at":"2024-04-28T06:44:30Z","author_association":"CONTRIBUTOR","body":"> 做成可选项，使用者自己决定\r\n\r\n嗯，肯定是做成可选项的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081357642/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081509018","html_url":"https://github.com/apache/brpc/pull/2574#issuecomment-2081509018","issue_url":"https://api.github.com/repos/apache/brpc/issues/2574","id":2081509018,"node_id":"IC_kwDOBhmkcs58EU6a","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-28T14:45:00Z","updated_at":"2024-04-28T14:45:00Z","author_association":"CONTRIBUTOR","body":"解决与master的冲突","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081509018/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081779656","html_url":"https://github.com/apache/brpc/pull/2613#issuecomment-2081779656","issue_url":"https://api.github.com/repos/apache/brpc/issues/2613","id":2081779656,"node_id":"IC_kwDOBhmkcs58FW_I","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-29T02:08:03Z","updated_at":"2024-04-29T02:08:03Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081779656/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081780448","html_url":"https://github.com/apache/brpc/pull/2551#issuecomment-2081780448","issue_url":"https://api.github.com/repos/apache/brpc/issues/2551","id":2081780448,"node_id":"IC_kwDOBhmkcs58FXLg","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-29T02:09:10Z","updated_at":"2024-04-29T02:09:10Z","author_association":"CONTRIBUTOR","body":"> @yanglimingcn 请问这个PR是意味着可以跨tag使用bthread同步原语了吗？ 使用中是否还有需要在注意的问题呢？\r\n\r\n是的，使用过程中没有什么要注意的，和原来的语义保持一致。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081780448/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081783191","html_url":"https://github.com/apache/brpc/issues/2619#issuecomment-2081783191","issue_url":"https://api.github.com/repos/apache/brpc/issues/2619","id":2081783191,"node_id":"IC_kwDOBhmkcs58FX2X","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-29T02:14:14Z","updated_at":"2024-04-29T02:14:14Z","author_association":"CONTRIBUTOR","body":"不支持python，也没有计划支持","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2081783191/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2082321731","html_url":"https://github.com/apache/brpc/issues/2624#issuecomment-2082321731","issue_url":"https://api.github.com/repos/apache/brpc/issues/2624","id":2082321731,"node_id":"IC_kwDOBhmkcs58HbVD","user":{"login":"weixinwei","id":47912552,"node_id":"MDQ6VXNlcjQ3OTEyNTUy","avatar_url":"https://avatars.githubusercontent.com/u/47912552?v=4","gravatar_id":"","url":"https://api.github.com/users/weixinwei","html_url":"https://github.com/weixinwei","followers_url":"https://api.github.com/users/weixinwei/followers","following_url":"https://api.github.com/users/weixinwei/following{/other_user}","gists_url":"https://api.github.com/users/weixinwei/gists{/gist_id}","starred_url":"https://api.github.com/users/weixinwei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weixinwei/subscriptions","organizations_url":"https://api.github.com/users/weixinwei/orgs","repos_url":"https://api.github.com/users/weixinwei/repos","events_url":"https://api.github.com/users/weixinwei/events{/privacy}","received_events_url":"https://api.github.com/users/weixinwei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-29T09:58:14Z","updated_at":"2024-04-29T09:58:14Z","author_association":"NONE","body":"gdb修改思路：\r\ncore target，增加m_registers寄存器缓存变量，用来接收set $rsp等的临时寄存器值；\r\n同时实现虚函数prepare_to_store和store_registers的override。当store_registers时，m_registers保存当前set的寄存器值。\r\n同时修改fetch_registers，如果m_registers有效，就从直接从m_registers中返回给上层调用者。\r\n\r\nPatch如下（基于gdb12.1）\r\n```\r\ndiff -uNr gdb-12.1/gdb/corelow.c gdb-new/gdb/corelow.c\r\n--- gdb-12.1/gdb/corelow.c      2024-04-28 14:20:44.560135484 +0800\r\n+++ gdb-new/gdb/corelow.c       2024-04-28 14:33:54.505499546 +0800\r\n@@ -122,6 +122,9 @@\r\n   /* See definition.  */\r\n   void info_proc_mappings (struct gdbarch *gdbarch);\r\n\r\n+  void prepare_to_store (struct regcache *) override {}\r\n+  void store_registers (struct regcache *, int) override;\r\n+\r\n private: /* per-core data */\r\n\r\n   /* The core's section table.  Note that these target sections are\r\n@@ -154,6 +157,18 @@\r\n   /* FIXME: kettenis/20031023: Eventually this field should\r\n      disappear.  */\r\n   struct gdbarch *m_core_gdbarch = NULL;\r\n+\r\n+private:\r\n+  /* register cache for the core file.\r\n+     which is used to fetch&save the registers from the core file.\r\n+     so that we call exec 'set $reg = xxx' in the core file.  */\r\n+\r\n+  /* The register buffers.  */\r\n+  std::unique_ptr<gdb_byte[]> m_registers;\r\n+  /* Register cache status.  */\r\n+  std::unique_ptr<register_status[]> m_register_status;\r\n+  /* current ptid */\r\n+  ptid_t current_ptid = null_ptid;\r\n };\r\n\r\n core_target::core_target ()\r\n@@ -312,6 +327,9 @@\r\n       current_program_space->cbfd.reset (nullptr);\r\n     }\r\n\r\n+  m_registers.reset(nullptr);\r\n+  m_register_status.reset(nullptr);\r\n+\r\n   /* Core targets are heap-allocated (see core_target_open), so here\r\n      we delete ourselves.  */\r\n   delete this;\r\n@@ -739,6 +757,13 @@\r\n       return;\r\n     }\r\n \r\n+  if (m_registers && current_ptid == regcache->ptid ())\r\n+    {\r\n+      memcpy(regcache->m_registers.get(), m_registers.get(), regcache->sizeof_raw_registers);\r\n+      memcpy(regcache->m_register_status.get(), m_register_status.get(), regcache->num_regs);\r\n+      return;\r\n+    }\r\n+\r\n   struct gdbarch *gdbarch = regcache->arch ();\r\n   get_core_registers_cb_data data = { this, regcache };\r\n   gdbarch_iterate_over_regset_sections (gdbarch,\r\n@@ -749,6 +774,25 @@\r\n   for (int i = 0; i < gdbarch_num_regs (regcache->arch ()); i++)\r\n     if (regcache->get_register_status (i) == REG_UNKNOWN)\r\n       regcache->raw_supply (i, NULL);\r\n+\r\n+  if (m_registers == nullptr || current_ptid != regcache->ptid ())\r\n+    {\r\n+      m_registers.reset (new gdb_byte[regcache->sizeof_raw_registers]);\r\n+      m_register_status.reset (new register_status[regcache->num_regs]);\r\n+      current_ptid = regcache->ptid ();\r\n+\r\n+      memcpy(m_registers.get(), regcache->m_registers.get(), regcache->sizeof_raw_registers);\r\n+      memcpy(m_register_status.get(), regcache->m_register_status.get(), regcache->num_regs);\r\n+    }\r\n+}\r\n+\r\n+void\r\n+core_target::store_registers (struct regcache *regcache, int regnum)\r\n+{\r\n+  memcpy(m_registers.get() + regcache->register_offset[regnum],\r\n+         regcache->m_registers.get() + regcache->register_offset[regnum],\r\n+         regcache->sizeof_register[regnum]);\r\n+  m_register_status[regnum] = REG_VALID;\r\n }\r\n\r\n void\r\n diff -uNr gdb-12.1/gdb/regcache.c gdb-new/gdb/regcache.c\r\n--- gdb-12.1/gdb/regcache.c     2022-05-02 02:46:31.000000000 +0800\r\n+++ gdb-new/gdb/regcache.c      2024-04-28 14:31:32.225651588 +0800\r\n@@ -198,6 +198,11 @@\r\n       m_registers.reset (new gdb_byte[m_descr->sizeof_raw_registers]);\r\n       m_register_status.reset\r\n        (new register_status[gdbarch_num_regs (gdbarch)] ());\r\n+\r\n+      sizeof_raw_registers = m_descr->sizeof_raw_registers;\r\n+      num_regs = gdbarch_num_regs (gdbarch);\r\n+      register_offset = m_descr->register_offset;\r\n+      sizeof_register = m_descr->sizeof_register;\r\n     }\r\n }\r\n\r\ndiff -uNr gdb-12.1/gdb/regcache.h gdb-new/gdb/regcache.h\r\n--- gdb-12.1/gdb/regcache.h     2022-03-20 12:59:56.000000000 +0800\r\n+++ gdb-new/gdb/regcache.h      2024-04-28 14:30:54.680636185 +0800\r\n@@ -260,11 +260,19 @@\r\n   struct regcache_descr *m_descr;\r\n\r\n   bool m_has_pseudo;\r\n+\r\n+public:\r\n   /* The register buffers.  */\r\n   std::unique_ptr<gdb_byte[]> m_registers;\r\n   /* Register cache status.  */\r\n   std::unique_ptr<register_status[]> m_register_status;\r\n\r\n+  // used for corelow.c\r\n+  long sizeof_raw_registers;\r\n+  int num_regs;\r\n+  long *register_offset;\r\n+  long *sizeof_register;\r\n+\r\n   friend class regcache;\r\n   friend class detached_regcache;\r\n };\r\n```","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2082321731/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2084788113","html_url":"https://github.com/apache/brpc/issues/2627#issuecomment-2084788113","issue_url":"https://api.github.com/repos/apache/brpc/issues/2627","id":2084788113,"node_id":"IC_kwDOBhmkcs58Q1eR","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-30T09:11:39Z","updated_at":"2024-04-30T09:11:39Z","author_association":"CONTRIBUTOR","body":"@wwbmmm 这块你有啥建议吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2084788113/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2085444920","html_url":"https://github.com/apache/brpc/issues/2627#issuecomment-2085444920","issue_url":"https://api.github.com/repos/apache/brpc/issues/2627","id":2085444920,"node_id":"IC_kwDOBhmkcs58TV04","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-04-30T14:12:55Z","updated_at":"2024-04-30T14:12:55Z","author_association":"CONTRIBUTOR","body":"#2628","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2085444920/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2088213045","html_url":"https://github.com/apache/brpc/issues/1392#issuecomment-2088213045","issue_url":"https://api.github.com/repos/apache/brpc/issues/1392","id":2088213045,"node_id":"IC_kwDOBhmkcs58d5o1","user":{"login":"ChaomingZhangCN","id":72908278,"node_id":"MDQ6VXNlcjcyOTA4Mjc4","avatar_url":"https://avatars.githubusercontent.com/u/72908278?v=4","gravatar_id":"","url":"https://api.github.com/users/ChaomingZhangCN","html_url":"https://github.com/ChaomingZhangCN","followers_url":"https://api.github.com/users/ChaomingZhangCN/followers","following_url":"https://api.github.com/users/ChaomingZhangCN/following{/other_user}","gists_url":"https://api.github.com/users/ChaomingZhangCN/gists{/gist_id}","starred_url":"https://api.github.com/users/ChaomingZhangCN/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ChaomingZhangCN/subscriptions","organizations_url":"https://api.github.com/users/ChaomingZhangCN/orgs","repos_url":"https://api.github.com/users/ChaomingZhangCN/repos","events_url":"https://api.github.com/users/ChaomingZhangCN/events{/privacy}","received_events_url":"https://api.github.com/users/ChaomingZhangCN/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-01T09:36:13Z","updated_at":"2024-05-01T09:36:13Z","author_association":"NONE","body":"有什么进展吗","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2088213045/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2093121074","html_url":"https://github.com/apache/brpc/pull/2551#issuecomment-2093121074","issue_url":"https://api.github.com/repos/apache/brpc/issues/2551","id":2093121074,"node_id":"IC_kwDOBhmkcs58wn4y","user":{"login":"ketor","id":3497139,"node_id":"MDQ6VXNlcjM0OTcxMzk=","avatar_url":"https://avatars.githubusercontent.com/u/3497139?v=4","gravatar_id":"","url":"https://api.github.com/users/ketor","html_url":"https://github.com/ketor","followers_url":"https://api.github.com/users/ketor/followers","following_url":"https://api.github.com/users/ketor/following{/other_user}","gists_url":"https://api.github.com/users/ketor/gists{/gist_id}","starred_url":"https://api.github.com/users/ketor/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ketor/subscriptions","organizations_url":"https://api.github.com/users/ketor/orgs","repos_url":"https://api.github.com/users/ketor/repos","events_url":"https://api.github.com/users/ketor/events{/privacy}","received_events_url":"https://api.github.com/users/ketor/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-03T14:19:43Z","updated_at":"2024-05-03T14:19:43Z","author_association":"CONTRIBUTOR","body":"> > @yanglimingcn 请问这个PR是意味着可以跨tag使用bthread同步原语了吗？ 使用中是否还有需要在注意的问题呢？\r\n> \r\n> 是的，使用过程中没有什么要注意的，和原来的语义保持一致。\r\n\r\n太赞了！ 准备开始使用bthread worker pool的特性了。\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2093121074/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2093886654","html_url":"https://github.com/apache/brpc/pull/2551#issuecomment-2093886654","issue_url":"https://api.github.com/repos/apache/brpc/issues/2551","id":2093886654,"node_id":"IC_kwDOBhmkcs58ziy-","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-03T23:36:46Z","updated_at":"2024-05-03T23:36:46Z","author_association":"CONTRIBUTOR","body":"> > > @yanglimingcn 请问这个PR是意味着可以跨tag使用bthread同步原语了吗？ 使用中是否还有需要在注意的问题呢？\r\n> > \r\n> > \r\n> > 是的，使用过程中没有什么要注意的，和原来的语义保持一致。\r\n> \r\n> 太赞了！ 准备开始使用bthread worker pool的特性了。\r\n\r\n有问题可以随时沟通","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2093886654/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2095059622","html_url":"https://github.com/apache/brpc/issues/927#issuecomment-2095059622","issue_url":"https://api.github.com/repos/apache/brpc/issues/927","id":2095059622,"node_id":"IC_kwDOBhmkcs584BKm","user":{"login":"weixinwei","id":47912552,"node_id":"MDQ6VXNlcjQ3OTEyNTUy","avatar_url":"https://avatars.githubusercontent.com/u/47912552?v=4","gravatar_id":"","url":"https://api.github.com/users/weixinwei","html_url":"https://github.com/weixinwei","followers_url":"https://api.github.com/users/weixinwei/followers","following_url":"https://api.github.com/users/weixinwei/following{/other_user}","gists_url":"https://api.github.com/users/weixinwei/gists{/gist_id}","starred_url":"https://api.github.com/users/weixinwei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/weixinwei/subscriptions","organizations_url":"https://api.github.com/users/weixinwei/orgs","repos_url":"https://api.github.com/users/weixinwei/repos","events_url":"https://api.github.com/users/weixinwei/events{/privacy}","received_events_url":"https://api.github.com/users/weixinwei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-06T01:38:53Z","updated_at":"2024-05-06T01:38:53Z","author_association":"NONE","body":"通过简单修改gdb源码，实现在core文件中完整支持gdb_bthread_stack.py的所有功能\r\nhttps://github.com/apache/brpc/issues/2624","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2095059622/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2095148384","html_url":"https://github.com/apache/brpc/pull/2628#issuecomment-2095148384","issue_url":"https://api.github.com/repos/apache/brpc/issues/2628","id":2095148384,"node_id":"IC_kwDOBhmkcs584W1g","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-06T03:49:41Z","updated_at":"2024-05-06T03:49:41Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2095148384/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097361642","html_url":"https://github.com/apache/brpc/pull/2628#issuecomment-2097361642","issue_url":"https://api.github.com/repos/apache/brpc/issues/2628","id":2097361642,"node_id":"IC_kwDOBhmkcs59AzLq","user":{"login":"MalikHou","id":145674557,"node_id":"U_kgDOCK7RPQ","avatar_url":"https://avatars.githubusercontent.com/u/145674557?v=4","gravatar_id":"","url":"https://api.github.com/users/MalikHou","html_url":"https://github.com/MalikHou","followers_url":"https://api.github.com/users/MalikHou/followers","following_url":"https://api.github.com/users/MalikHou/following{/other_user}","gists_url":"https://api.github.com/users/MalikHou/gists{/gist_id}","starred_url":"https://api.github.com/users/MalikHou/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MalikHou/subscriptions","organizations_url":"https://api.github.com/users/MalikHou/orgs","repos_url":"https://api.github.com/users/MalikHou/repos","events_url":"https://api.github.com/users/MalikHou/events{/privacy}","received_events_url":"https://api.github.com/users/MalikHou/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T03:08:10Z","updated_at":"2024-05-07T03:08:10Z","author_association":"NONE","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097361642/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097698150","html_url":"https://github.com/apache/brpc/issues/2621#issuecomment-2097698150","issue_url":"https://api.github.com/repos/apache/brpc/issues/2621","id":2097698150,"node_id":"IC_kwDOBhmkcs59CFVm","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T08:06:40Z","updated_at":"2024-05-07T08:06:40Z","author_association":"CONTRIBUTOR","body":"问题描述的不是很清晰，建议补充下更为详细的描述，或者举个例子。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097698150/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097727344","html_url":"https://github.com/apache/brpc/issues/2621#issuecomment-2097727344","issue_url":"https://api.github.com/repos/apache/brpc/issues/2621","id":2097727344,"node_id":"IC_kwDOBhmkcs59CMdw","user":{"login":"cmdmspaint","id":50624748,"node_id":"MDQ6VXNlcjUwNjI0NzQ4","avatar_url":"https://avatars.githubusercontent.com/u/50624748?v=4","gravatar_id":"","url":"https://api.github.com/users/cmdmspaint","html_url":"https://github.com/cmdmspaint","followers_url":"https://api.github.com/users/cmdmspaint/followers","following_url":"https://api.github.com/users/cmdmspaint/following{/other_user}","gists_url":"https://api.github.com/users/cmdmspaint/gists{/gist_id}","starred_url":"https://api.github.com/users/cmdmspaint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmdmspaint/subscriptions","organizations_url":"https://api.github.com/users/cmdmspaint/orgs","repos_url":"https://api.github.com/users/cmdmspaint/repos","events_url":"https://api.github.com/users/cmdmspaint/events{/privacy}","received_events_url":"https://api.github.com/users/cmdmspaint/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T08:22:19Z","updated_at":"2024-05-07T08:22:19Z","author_association":"NONE","body":"在实际使用iobuf 的append方法时发现 iobuf的backing_block_num()方法的值 一直只有1个 所以有点好奇什么场景需要多个block的引用","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097727344/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097740039","html_url":"https://github.com/apache/brpc/issues/2582#issuecomment-2097740039","issue_url":"https://api.github.com/repos/apache/brpc/issues/2582","id":2097740039,"node_id":"IC_kwDOBhmkcs59CPkH","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T08:29:17Z","updated_at":"2024-05-07T08:29:17Z","author_association":"CONTRIBUTOR","body":"> > 客户端默认都是0，多个tag，是服务端的配置。可以参考https://github.com/apache/brpc/blob/master/docs/cn/bthread_tagged_task_group.md 这个文档\r\n> \r\n> 这个文档中好像没有写清楚如何设置 tag 中的 worker 数量\r\n\r\n文档已更新，需要先设置好FLAGS_bthread_current_tag，然后再设置FLAGS_bthread_concurrency_by_tag 。也可以调用bthread_setconcurrency_by_tag。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097740039/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097829028","html_url":"https://github.com/apache/brpc/issues/2621#issuecomment-2097829028","issue_url":"https://api.github.com/repos/apache/brpc/issues/2621","id":2097829028,"node_id":"IC_kwDOBhmkcs59ClSk","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T09:15:26Z","updated_at":"2024-05-07T09:15:26Z","author_association":"CONTRIBUTOR","body":"IOBuf引用的block来自TLS，在同一个worker线程上一直append的话，数据长度超过block才会引用另一个block。如果每次append都在不同的worker线程上，应该就会引用多个block了。\r\n\r\n或者，append其他IOBuf（没有引用相同的block），应该也会引用多个block了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097829028/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097843842","html_url":"https://github.com/apache/brpc/issues/2621#issuecomment-2097843842","issue_url":"https://api.github.com/repos/apache/brpc/issues/2621","id":2097843842,"node_id":"IC_kwDOBhmkcs59Co6C","user":{"login":"cmdmspaint","id":50624748,"node_id":"MDQ6VXNlcjUwNjI0NzQ4","avatar_url":"https://avatars.githubusercontent.com/u/50624748?v=4","gravatar_id":"","url":"https://api.github.com/users/cmdmspaint","html_url":"https://github.com/cmdmspaint","followers_url":"https://api.github.com/users/cmdmspaint/followers","following_url":"https://api.github.com/users/cmdmspaint/following{/other_user}","gists_url":"https://api.github.com/users/cmdmspaint/gists{/gist_id}","starred_url":"https://api.github.com/users/cmdmspaint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmdmspaint/subscriptions","organizations_url":"https://api.github.com/users/cmdmspaint/orgs","repos_url":"https://api.github.com/users/cmdmspaint/repos","events_url":"https://api.github.com/users/cmdmspaint/events{/privacy}","received_events_url":"https://api.github.com/users/cmdmspaint/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T09:22:30Z","updated_at":"2024-05-07T09:22:30Z","author_association":"NONE","body":"数据长度超过block才会引用另一个block中，提到的block长度是DEFAULT_BLOCK_SIZE的值吗。我尝试过1k~5M范围的数据，都是引用的一个blockref。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097843842/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097869084","html_url":"https://github.com/apache/brpc/issues/2621#issuecomment-2097869084","issue_url":"https://api.github.com/repos/apache/brpc/issues/2621","id":2097869084,"node_id":"IC_kwDOBhmkcs59CvEc","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T09:34:06Z","updated_at":"2024-05-07T09:34:06Z","author_association":"CONTRIBUTOR","body":"https://github.com/apache/brpc/blob/7a8df4640f6d222ebfed947689ba38004c8552d1/src/butil/iobuf.cpp#L341-L356\r\n实际上容量是DEFAULT_BLOCK_SIZE - sizeof(Block)。\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097869084/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097870604","html_url":"https://github.com/apache/brpc/issues/2621#issuecomment-2097870604","issue_url":"https://api.github.com/repos/apache/brpc/issues/2621","id":2097870604,"node_id":"IC_kwDOBhmkcs59CvcM","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T09:34:55Z","updated_at":"2024-05-07T09:34:55Z","author_association":"CONTRIBUTOR","body":"> 我尝试过1k~5M范围的数据，都是引用的一个blockref。\r\n\r\n不可能吧，Block最大不超过8K。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097870604/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097873927","html_url":"https://github.com/apache/brpc/issues/2621#issuecomment-2097873927","issue_url":"https://api.github.com/repos/apache/brpc/issues/2621","id":2097873927,"node_id":"IC_kwDOBhmkcs59CwQH","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T09:36:35Z","updated_at":"2024-05-07T09:36:35Z","author_association":"CONTRIBUTOR","body":"```c++\r\nbutil::IOBuf buf;\r\nstd::string str(1024 * 8, '1');\r\nbuf.append(str);\r\nLOG(INFO) << buf.backing_block_num();\r\n```\r\n\r\n简单写了一个demo，输出是2。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097873927/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097879607","html_url":"https://github.com/apache/brpc/issues/2621#issuecomment-2097879607","issue_url":"https://api.github.com/repos/apache/brpc/issues/2621","id":2097879607,"node_id":"IC_kwDOBhmkcs59Cxo3","user":{"login":"cmdmspaint","id":50624748,"node_id":"MDQ6VXNlcjUwNjI0NzQ4","avatar_url":"https://avatars.githubusercontent.com/u/50624748?v=4","gravatar_id":"","url":"https://api.github.com/users/cmdmspaint","html_url":"https://github.com/cmdmspaint","followers_url":"https://api.github.com/users/cmdmspaint/followers","following_url":"https://api.github.com/users/cmdmspaint/following{/other_user}","gists_url":"https://api.github.com/users/cmdmspaint/gists{/gist_id}","starred_url":"https://api.github.com/users/cmdmspaint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmdmspaint/subscriptions","organizations_url":"https://api.github.com/users/cmdmspaint/orgs","repos_url":"https://api.github.com/users/cmdmspaint/repos","events_url":"https://api.github.com/users/cmdmspaint/events{/privacy}","received_events_url":"https://api.github.com/users/cmdmspaint/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T09:39:18Z","updated_at":"2024-05-07T09:39:18Z","author_association":"NONE","body":"好的 了解。我具体使用的接口是append_user_data，我尝试一下。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097879607/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097885155","html_url":"https://github.com/apache/brpc/issues/2621#issuecomment-2097885155","issue_url":"https://api.github.com/repos/apache/brpc/issues/2621","id":2097885155,"node_id":"IC_kwDOBhmkcs59Cy_j","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T09:42:02Z","updated_at":"2024-05-07T09:42:02Z","author_association":"CONTRIBUTOR","body":"append_user_data的block的容量是传进来的data大小，取决于调用方。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097885155/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097895971","html_url":"https://github.com/apache/brpc/issues/2621#issuecomment-2097895971","issue_url":"https://api.github.com/repos/apache/brpc/issues/2621","id":2097895971,"node_id":"IC_kwDOBhmkcs59C1oj","user":{"login":"cmdmspaint","id":50624748,"node_id":"MDQ6VXNlcjUwNjI0NzQ4","avatar_url":"https://avatars.githubusercontent.com/u/50624748?v=4","gravatar_id":"","url":"https://api.github.com/users/cmdmspaint","html_url":"https://github.com/cmdmspaint","followers_url":"https://api.github.com/users/cmdmspaint/followers","following_url":"https://api.github.com/users/cmdmspaint/following{/other_user}","gists_url":"https://api.github.com/users/cmdmspaint/gists{/gist_id}","starred_url":"https://api.github.com/users/cmdmspaint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmdmspaint/subscriptions","organizations_url":"https://api.github.com/users/cmdmspaint/orgs","repos_url":"https://api.github.com/users/cmdmspaint/repos","events_url":"https://api.github.com/users/cmdmspaint/events{/privacy}","received_events_url":"https://api.github.com/users/cmdmspaint/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T09:47:44Z","updated_at":"2024-05-07T09:47:44Z","author_association":"NONE","body":"使用append_user_data接口时，会有block达到上限引用其他block的case吗。我理解这种取决于调用方的话，一个worker线程append的时候是用一个block承接所有的data?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097895971/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097917843","html_url":"https://github.com/apache/brpc/issues/2621#issuecomment-2097917843","issue_url":"https://api.github.com/repos/apache/brpc/issues/2621","id":2097917843,"node_id":"IC_kwDOBhmkcs59C6-T","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T09:59:07Z","updated_at":"2024-05-07T09:59:07Z","author_association":"CONTRIBUTOR","body":"> 使用append_user_data接口时，会有block达到上限引用其他block的case吗\r\n\r\n没有\r\n\r\n> 我理解这种取决于调用方的话，一个worker线程append的时候是用一个block承接所有的data?\r\n\r\n是的，append_user_data不会用TLS上的block，只是直接new一个Block对象，接管data这块内存。\r\n\r\nhttps://github.com/apache/brpc/blob/7a8df4640f6d222ebfed947689ba38004c8552d1/src/butil/iobuf.cpp#L1261-L1285","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097917843/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097921573","html_url":"https://github.com/apache/brpc/issues/2621#issuecomment-2097921573","issue_url":"https://api.github.com/repos/apache/brpc/issues/2621","id":2097921573,"node_id":"IC_kwDOBhmkcs59C74l","user":{"login":"cmdmspaint","id":50624748,"node_id":"MDQ6VXNlcjUwNjI0NzQ4","avatar_url":"https://avatars.githubusercontent.com/u/50624748?v=4","gravatar_id":"","url":"https://api.github.com/users/cmdmspaint","html_url":"https://github.com/cmdmspaint","followers_url":"https://api.github.com/users/cmdmspaint/followers","following_url":"https://api.github.com/users/cmdmspaint/following{/other_user}","gists_url":"https://api.github.com/users/cmdmspaint/gists{/gist_id}","starred_url":"https://api.github.com/users/cmdmspaint/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cmdmspaint/subscriptions","organizations_url":"https://api.github.com/users/cmdmspaint/orgs","repos_url":"https://api.github.com/users/cmdmspaint/repos","events_url":"https://api.github.com/users/cmdmspaint/events{/privacy}","received_events_url":"https://api.github.com/users/cmdmspaint/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T10:01:00Z","updated_at":"2024-05-07T10:01:00Z","author_association":"NONE","body":"好的 理解了。感谢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2097921573/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2098199797","html_url":"https://github.com/apache/brpc/pull/2625#issuecomment-2098199797","issue_url":"https://api.github.com/repos/apache/brpc/issues/2625","id":2098199797,"node_id":"IC_kwDOBhmkcs59D_z1","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T11:37:17Z","updated_at":"2024-05-07T11:37:17Z","author_association":"CONTRIBUTOR","body":"有时候希望gflags的validator在第一次加载的时候不执行validator，因为validator里面的一些内容需要在程序起来后才能有效。\r\n这个PR对这种情况如何处理呢？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2098199797/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2098344738","html_url":"https://github.com/apache/brpc/pull/2625#issuecomment-2098344738","issue_url":"https://api.github.com/repos/apache/brpc/issues/2625","id":2098344738,"node_id":"IC_kwDOBhmkcs59EjMi","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T12:56:32Z","updated_at":"2024-05-07T12:56:32Z","author_association":"CONTRIBUTOR","body":"https://github.com/apache/brpc/blob/7a8df4640f6d222ebfed947689ba38004c8552d1/src/brpc/reloadable_flags.h#L27-L29\r\n\r\n从注释能看出，BRPC_VALIDATE_GFLAG的设计的初衷就是期望只在全局作用域调的。\r\n\r\n如果需要在程序起来后起作用的话，自己调GFLAGS_NS::RegisterFlagValidator来注册回调函数就行了吧。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2098344738/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2098743839","html_url":"https://github.com/apache/brpc/pull/2577#issuecomment-2098743839","issue_url":"https://api.github.com/repos/apache/brpc/issues/2577","id":2098743839,"node_id":"IC_kwDOBhmkcs59GEof","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-07T15:35:53Z","updated_at":"2024-05-07T15:35:53Z","author_association":"CONTRIBUTOR","body":"解决与主干的冲突","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2098743839/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2100113923","html_url":"https://github.com/apache/brpc/issues/2636#issuecomment-2100113923","issue_url":"https://api.github.com/repos/apache/brpc/issues/2636","id":2100113923,"node_id":"IC_kwDOBhmkcs59LTID","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-08T09:07:08Z","updated_at":"2024-05-08T09:07:08Z","author_association":"CONTRIBUTOR","body":"是不是可以使用 #2547 notify_on_success特性，在写入成功后，通过id_wait结束rpc？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2100113923/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2100170325","html_url":"https://github.com/apache/brpc/pull/2629#issuecomment-2100170325","issue_url":"https://api.github.com/repos/apache/brpc/issues/2629","id":2100170325,"node_id":"IC_kwDOBhmkcs59Lg5V","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-08T09:35:00Z","updated_at":"2024-05-08T09:35:00Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2100170325/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2100630948","html_url":"https://github.com/apache/brpc/issues/2636#issuecomment-2100630948","issue_url":"https://api.github.com/repos/apache/brpc/issues/2636","id":2100630948,"node_id":"IC_kwDOBhmkcs59NRWk","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-08T13:52:28Z","updated_at":"2024-05-08T13:52:28Z","author_association":"NONE","body":"> 是不是可以使用 #2547 notify_on_success特性，在写入成功后，通过id_wait结束rpc？\r\n\r\n结束rpc并不是关闭socket吧?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2100630948/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2100735629","html_url":"https://github.com/apache/brpc/issues/2636#issuecomment-2100735629","issue_url":"https://api.github.com/repos/apache/brpc/issues/2636","id":2100735629,"node_id":"IC_kwDOBhmkcs59Nq6N","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-08T14:34:18Z","updated_at":"2024-05-08T14:34:18Z","author_association":"CONTRIBUTOR","body":"我理解这种没有响应的请求，在socket写完请求包就可以认为成功了。\r\n\r\n设置notify_on_success后，socket写完请求包，就会调用id_wait的回调函数，这时候error_code是0，表示写入成功，就可以认为rpc调用成功了吧。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2100735629/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2101950246","html_url":"https://github.com/apache/brpc/issues/2636#issuecomment-2101950246","issue_url":"https://api.github.com/repos/apache/brpc/issues/2636","id":2101950246,"node_id":"IC_kwDOBhmkcs59STcm","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-09T05:13:21Z","updated_at":"2024-05-09T05:13:21Z","author_association":"NONE","body":"> 我理解这种没有响应的请求，在socket写完请求包就可以认为成功了。\r\n> \r\n> 设置notify_on_success后，socket写完请求包，就会调用id_wait的回调函数，这时候error_code是0，表示写入成功，就可以认为rpc调用成功了吧。\r\n\r\n对, 写入成功就表示rpc成功了, 调用id_wait回调会关闭对应的socket和fd么","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2101950246/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2102003205","html_url":"https://github.com/apache/brpc/issues/2636#issuecomment-2102003205","issue_url":"https://api.github.com/repos/apache/brpc/issues/2636","id":2102003205,"node_id":"IC_kwDOBhmkcs59SgYF","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-09T06:05:53Z","updated_at":"2024-05-09T06:05:53Z","author_association":"CONTRIBUTOR","body":"设置notify_on_success后，不会","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2102003205/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2102022893","html_url":"https://github.com/apache/brpc/issues/2638#issuecomment-2102022893","issue_url":"https://api.github.com/repos/apache/brpc/issues/2638","id":2102022893,"node_id":"IC_kwDOBhmkcs59SlLt","user":{"login":"jgli","id":3295659,"node_id":"MDQ6VXNlcjMyOTU2NTk=","avatar_url":"https://avatars.githubusercontent.com/u/3295659?v=4","gravatar_id":"","url":"https://api.github.com/users/jgli","html_url":"https://github.com/jgli","followers_url":"https://api.github.com/users/jgli/followers","following_url":"https://api.github.com/users/jgli/following{/other_user}","gists_url":"https://api.github.com/users/jgli/gists{/gist_id}","starred_url":"https://api.github.com/users/jgli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jgli/subscriptions","organizations_url":"https://api.github.com/users/jgli/orgs","repos_url":"https://api.github.com/users/jgli/repos","events_url":"https://api.github.com/users/jgli/events{/privacy}","received_events_url":"https://api.github.com/users/jgli/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-09T06:20:17Z","updated_at":"2024-05-09T06:20:17Z","author_association":"NONE","body":"OS: CentOS Linux release 7.6.1810 (Core), 3.10.0-1160.42.2.el7.x86_64","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2102022893/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2105656066","html_url":"https://github.com/apache/brpc/issues/2640#issuecomment-2105656066","issue_url":"https://api.github.com/repos/apache/brpc/issues/2640","id":2105656066,"node_id":"IC_kwDOBhmkcs59gcMC","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-11T09:44:57Z","updated_at":"2024-05-11T09:54:34Z","author_association":"CONTRIBUTOR","body":"听上去这么修改更合理些，你能否简单改一下验证一下呢？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2105656066/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2106051250","html_url":"https://github.com/apache/brpc/pull/2642#issuecomment-2106051250","issue_url":"https://api.github.com/repos/apache/brpc/issues/2642","id":2106051250,"node_id":"IC_kwDOBhmkcs59h8qy","user":{"login":"Huoke","id":24191613,"node_id":"MDQ6VXNlcjI0MTkxNjEz","avatar_url":"https://avatars.githubusercontent.com/u/24191613?v=4","gravatar_id":"","url":"https://api.github.com/users/Huoke","html_url":"https://github.com/Huoke","followers_url":"https://api.github.com/users/Huoke/followers","following_url":"https://api.github.com/users/Huoke/following{/other_user}","gists_url":"https://api.github.com/users/Huoke/gists{/gist_id}","starred_url":"https://api.github.com/users/Huoke/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huoke/subscriptions","organizations_url":"https://api.github.com/users/Huoke/orgs","repos_url":"https://api.github.com/users/Huoke/repos","events_url":"https://api.github.com/users/Huoke/events{/privacy}","received_events_url":"https://api.github.com/users/Huoke/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-11T22:58:13Z","updated_at":"2024-05-11T22:58:14Z","author_association":"CONTRIBUTOR","body":"Got it, there are MAC_OS conditional judgments on it, what a stupid pull request！","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2106051250/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2106202910","html_url":"https://github.com/apache/brpc/pull/2632#issuecomment-2106202910","issue_url":"https://api.github.com/repos/apache/brpc/issues/2632","id":2106202910,"node_id":"IC_kwDOBhmkcs59ihse","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-12T10:44:02Z","updated_at":"2024-05-12T10:44:02Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2106202910/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2106504847","html_url":"https://github.com/apache/brpc/issues/2640#issuecomment-2106504847","issue_url":"https://api.github.com/repos/apache/brpc/issues/2640","id":2106504847,"node_id":"IC_kwDOBhmkcs59jraP","user":{"login":"zc08291161","id":34310804,"node_id":"MDQ6VXNlcjM0MzEwODA0","avatar_url":"https://avatars.githubusercontent.com/u/34310804?v=4","gravatar_id":"","url":"https://api.github.com/users/zc08291161","html_url":"https://github.com/zc08291161","followers_url":"https://api.github.com/users/zc08291161/followers","following_url":"https://api.github.com/users/zc08291161/following{/other_user}","gists_url":"https://api.github.com/users/zc08291161/gists{/gist_id}","starred_url":"https://api.github.com/users/zc08291161/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zc08291161/subscriptions","organizations_url":"https://api.github.com/users/zc08291161/orgs","repos_url":"https://api.github.com/users/zc08291161/repos","events_url":"https://api.github.com/users/zc08291161/events{/privacy}","received_events_url":"https://api.github.com/users/zc08291161/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-13T02:02:48Z","updated_at":"2024-05-13T02:02:48Z","author_association":"NONE","body":"ok，I will try","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2106504847/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2106722843","html_url":"https://github.com/apache/brpc/issues/2639#issuecomment-2106722843","issue_url":"https://api.github.com/repos/apache/brpc/issues/2639","id":2106722843,"node_id":"IC_kwDOBhmkcs59kgob","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-13T06:06:58Z","updated_at":"2024-05-13T06:06:58Z","author_association":"CONTRIBUTOR","body":"这个统计来自于linux的这个链接 http://man7.org/linux/man-pages/man5/proc.5.html，我们的linux系统都是比较正常的，看看你那边的环境还有啥差异吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2106722843/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2114692348","html_url":"https://github.com/apache/brpc/pull/2560#issuecomment-2114692348","issue_url":"https://api.github.com/repos/apache/brpc/issues/2560","id":2114692348,"node_id":"IC_kwDOBhmkcs5-C6T8","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-16T09:31:20Z","updated_at":"2024-05-16T09:31:20Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2114692348/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2114720346","html_url":"https://github.com/apache/brpc/pull/2644#issuecomment-2114720346","issue_url":"https://api.github.com/repos/apache/brpc/issues/2644","id":2114720346,"node_id":"IC_kwDOBhmkcs5-DBJa","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-16T09:45:38Z","updated_at":"2024-05-16T09:45:38Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2114720346/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2116501224","html_url":"https://github.com/apache/brpc/issues/2638#issuecomment-2116501224","issue_url":"https://api.github.com/repos/apache/brpc/issues/2638","id":2116501224,"node_id":"IC_kwDOBhmkcs5-Jz7o","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-17T02:11:23Z","updated_at":"2024-05-17T02:11:23Z","author_association":"CONTRIBUTOR","body":"能发个栈信息吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2116501224/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2116509398","html_url":"https://github.com/apache/brpc/issues/2623#issuecomment-2116509398","issue_url":"https://api.github.com/repos/apache/brpc/issues/2623","id":2116509398,"node_id":"IC_kwDOBhmkcs5-J17W","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-17T02:21:28Z","updated_at":"2024-05-17T02:21:28Z","author_association":"CONTRIBUTOR","body":"建议使用brpc里面的测试程序，echo_server echo_client试试，便于定位问题。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2116509398/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2116511551","html_url":"https://github.com/apache/brpc/issues/2635#issuecomment-2116511551","issue_url":"https://api.github.com/repos/apache/brpc/issues/2635","id":2116511551,"node_id":"IC_kwDOBhmkcs5-J2c_","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-17T02:23:33Z","updated_at":"2024-05-17T11:51:09Z","author_association":"CONTRIBUTOR","body":"> 第一次需要使用keytbale时构造，并赋值给task_meta.local_storage. keytable，task_meta析构时销毁keytable。\r\n\r\n我理解这是为了尽量复用、减少构造、不加锁。TaskMeta是从ResourcePool分配出来的，在进程运行的时候，不会释放TaskMeta的吧。那么一旦使用了KeyTable，TaskMeta就会绑定一个KeyTable，跟bthread_keytable_pool_t机制是不是有点兼容问题？例如一个TaskMeta已经绑定一个KeyTable，但是bthread_attr_t设置bthread_keytable_pool_t，这时候还需要额外的状态来记录KeyTable的来源用于处理归还逻辑吧。\r\n\r\n是不是用ObjectPool来分配KeyTable就能规避锁的影响，实现还简单？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2116511551/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2116515916","html_url":"https://github.com/apache/brpc/issues/2595#issuecomment-2116515916","issue_url":"https://api.github.com/repos/apache/brpc/issues/2595","id":2116515916,"node_id":"IC_kwDOBhmkcs5-J3hM","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-17T02:26:06Z","updated_at":"2024-05-17T02:26:06Z","author_association":"CONTRIBUTOR","body":"感觉一般不会怎么使用，因为brpc已经提供了进程框架了，你是有什么别的需求吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2116515916/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2116852306","html_url":"https://github.com/apache/brpc/issues/2581#issuecomment-2116852306","issue_url":"https://api.github.com/repos/apache/brpc/issues/2581","id":2116852306,"node_id":"IC_kwDOBhmkcs5-LJpS","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-17T06:34:59Z","updated_at":"2024-05-17T06:34:59Z","author_association":"CONTRIBUTOR","body":"https://github.com/apache/brpc/blob/master/docs/cn/bthread_tagged_task_group.md","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2116852306/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2117150257","html_url":"https://github.com/apache/brpc/issues/2635#issuecomment-2117150257","issue_url":"https://api.github.com/repos/apache/brpc/issues/2635","id":2117150257,"node_id":"IC_kwDOBhmkcs5-MSYx","user":{"login":"MJY-HUST","id":52315061,"node_id":"MDQ6VXNlcjUyMzE1MDYx","avatar_url":"https://avatars.githubusercontent.com/u/52315061?v=4","gravatar_id":"","url":"https://api.github.com/users/MJY-HUST","html_url":"https://github.com/MJY-HUST","followers_url":"https://api.github.com/users/MJY-HUST/followers","following_url":"https://api.github.com/users/MJY-HUST/following{/other_user}","gists_url":"https://api.github.com/users/MJY-HUST/gists{/gist_id}","starred_url":"https://api.github.com/users/MJY-HUST/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MJY-HUST/subscriptions","organizations_url":"https://api.github.com/users/MJY-HUST/orgs","repos_url":"https://api.github.com/users/MJY-HUST/repos","events_url":"https://api.github.com/users/MJY-HUST/events{/privacy}","received_events_url":"https://api.github.com/users/MJY-HUST/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-17T09:36:57Z","updated_at":"2024-05-17T09:36:57Z","author_association":"CONTRIBUTOR","body":"> > 第一次需要使用keytbale时构造，并赋值给task_meta.local_storage. keytable，task_meta析构时销毁keytable。\r\n> \r\n> 我理解这是为了尽量复用、减少构造、不加锁。TaskMeta是从ResourcePool分配出来的，在进程运行的时候，不会释放TaskMeta的吧。那么一旦使用了KeyTable，TaskMeta就会绑定一个KeyTable，跟bthread_keytable_pool_t机制是不是有点兼容？例如一个TaskMeta已经绑定一个KeyTable，但是bthread_attr_t设置bthread_keytable_pool_t，这时候还需要额外的状态来记录KeyTable的来源用于处理归还逻辑吧。\r\n> \r\n> 是不是用ObjectPool来分配KeyTable就能规避锁的影响，实现还简单？\r\n\r\n是的，前面说的逻辑和bthread_keytable_pool_t机制有重合。\r\n感觉把bthread_keytable_pool_t替换为ObjectPool来管理KeyTable比较合适","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2117150257/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2118637427","html_url":"https://github.com/apache/brpc/issues/2084#issuecomment-2118637427","issue_url":"https://api.github.com/repos/apache/brpc/issues/2084","id":2118637427,"node_id":"IC_kwDOBhmkcs5-R9dz","user":{"login":"guoxiangCN","id":30590325,"node_id":"MDQ6VXNlcjMwNTkwMzI1","avatar_url":"https://avatars.githubusercontent.com/u/30590325?v=4","gravatar_id":"","url":"https://api.github.com/users/guoxiangCN","html_url":"https://github.com/guoxiangCN","followers_url":"https://api.github.com/users/guoxiangCN/followers","following_url":"https://api.github.com/users/guoxiangCN/following{/other_user}","gists_url":"https://api.github.com/users/guoxiangCN/gists{/gist_id}","starred_url":"https://api.github.com/users/guoxiangCN/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guoxiangCN/subscriptions","organizations_url":"https://api.github.com/users/guoxiangCN/orgs","repos_url":"https://api.github.com/users/guoxiangCN/repos","events_url":"https://api.github.com/users/guoxiangCN/events{/privacy}","received_events_url":"https://api.github.com/users/guoxiangCN/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-18T04:40:07Z","updated_at":"2024-05-18T04:40:07Z","author_association":"NONE","body":"WSL环境里也有这个问题","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2118637427/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2119047824","html_url":"https://github.com/apache/brpc/pull/2421#issuecomment-2119047824","issue_url":"https://api.github.com/repos/apache/brpc/issues/2421","id":2119047824,"node_id":"IC_kwDOBhmkcs5-ThqQ","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-19T01:00:28Z","updated_at":"2024-05-19T01:00:28Z","author_association":"CONTRIBUTOR","body":"所以，看上去这个问题是brpc单方面解决不了的，需要用户和bRPC框架的共同配合才行，是这么理解吧。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2119047824/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2119135643","html_url":"https://github.com/apache/brpc/pull/2421#issuecomment-2119135643","issue_url":"https://api.github.com/repos/apache/brpc/issues/2421","id":2119135643,"node_id":"IC_kwDOBhmkcs5-T3Gb","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-19T07:34:34Z","updated_at":"2024-05-19T07:34:59Z","author_association":"CONTRIBUTOR","body":"> 是这么理解吧\r\n\r\n是的。如果用户使用 brpc 提供的默认 CMakeLists 来编译安装，但是在项目中又开启了该参数就会引发这个问题，两者要保持。\r\n\r\n我的理解是：既然某些类显示的标注了 CacheLine 对齐，如果编译器支持，那么尽量就是用对齐的分配方式，来达到 CacheLine 对齐所带来的益处。\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2119135643/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2119166722","html_url":"https://github.com/apache/brpc/pull/2421#issuecomment-2119166722","issue_url":"https://api.github.com/repos/apache/brpc/issues/2421","id":2119166722,"node_id":"IC_kwDOBhmkcs5-T-sC","user":{"login":"yanglimingcn","id":7091130,"node_id":"MDQ6VXNlcjcwOTExMzA=","avatar_url":"https://avatars.githubusercontent.com/u/7091130?v=4","gravatar_id":"","url":"https://api.github.com/users/yanglimingcn","html_url":"https://github.com/yanglimingcn","followers_url":"https://api.github.com/users/yanglimingcn/followers","following_url":"https://api.github.com/users/yanglimingcn/following{/other_user}","gists_url":"https://api.github.com/users/yanglimingcn/gists{/gist_id}","starred_url":"https://api.github.com/users/yanglimingcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yanglimingcn/subscriptions","organizations_url":"https://api.github.com/users/yanglimingcn/orgs","repos_url":"https://api.github.com/users/yanglimingcn/repos","events_url":"https://api.github.com/users/yanglimingcn/events{/privacy}","received_events_url":"https://api.github.com/users/yanglimingcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-19T09:23:21Z","updated_at":"2024-05-19T09:23:21Z","author_association":"CONTRIBUTOR","body":"brpc的默认行为和编译器的默认行为保持一致这样是不是不容易产生问题。\r\n一个用户如果对brpc的编译和对自己程序的编译选项不一致，他本身得认识到这个问题。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2119166722/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2119556697","html_url":"https://github.com/apache/brpc/pull/2645#issuecomment-2119556697","issue_url":"https://api.github.com/repos/apache/brpc/issues/2645","id":2119556697,"node_id":"IC_kwDOBhmkcs5-Vd5Z","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-20T02:30:27Z","updated_at":"2024-05-20T02:30:27Z","author_association":"CONTRIBUTOR","body":"object_pool应该没法完全解决 #1449 的问题吧，从object_pool取出来的KeyTable有可能已经有data了，先调用bthread_setspecific函数，旧data还是会泄漏。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2119556697/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2119559198","html_url":"https://github.com/apache/brpc/pull/2645#issuecomment-2119559198","issue_url":"https://api.github.com/repos/apache/brpc/issues/2645","id":2119559198,"node_id":"IC_kwDOBhmkcs5-Vege","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-20T02:34:22Z","updated_at":"2024-05-20T02:34:22Z","author_association":"CONTRIBUTOR","body":"https://github.com/apache/brpc/blob/b601c89aec9042a1f509ddbdad478aa4e3f118fe/src/brpc/server.h#L170-L183\r\nhttps://github.com/apache/brpc/blob/b601c89aec9042a1f509ddbdad478aa4e3f118fe/src/brpc/server.cpp#L888-L914\r\n\r\n应该没法废弃bthread_keytable_pool_t ，因为Server已经用了bthread_keytable_pool_t了，并对外提供了与之相关的设置项。\r\n\r\n改造bthread_keytable_pool_t，将free_keytables由全局改成TLS，这样mutex就可以废弃了。同时修改reserved_thread_local_data语义：每个TLS上预留的data数量。这样可行吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2119559198/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2120363076","html_url":"https://github.com/apache/brpc/pull/2645#issuecomment-2120363076","issue_url":"https://api.github.com/repos/apache/brpc/issues/2645","id":2120363076,"node_id":"IC_kwDOBhmkcs5-YixE","user":{"login":"MJY-HUST","id":52315061,"node_id":"MDQ6VXNlcjUyMzE1MDYx","avatar_url":"https://avatars.githubusercontent.com/u/52315061?v=4","gravatar_id":"","url":"https://api.github.com/users/MJY-HUST","html_url":"https://github.com/MJY-HUST","followers_url":"https://api.github.com/users/MJY-HUST/followers","following_url":"https://api.github.com/users/MJY-HUST/following{/other_user}","gists_url":"https://api.github.com/users/MJY-HUST/gists{/gist_id}","starred_url":"https://api.github.com/users/MJY-HUST/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MJY-HUST/subscriptions","organizations_url":"https://api.github.com/users/MJY-HUST/orgs","repos_url":"https://api.github.com/users/MJY-HUST/repos","events_url":"https://api.github.com/users/MJY-HUST/events{/privacy}","received_events_url":"https://api.github.com/users/MJY-HUST/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-20T12:28:14Z","updated_at":"2024-05-20T12:41:41Z","author_association":"CONTRIBUTOR","body":"> https://github.com/apache/brpc/blob/b601c89aec9042a1f509ddbdad478aa4e3f118fe/src/brpc/server.h#L170-L183\r\n> \r\n> \r\n> https://github.com/apache/brpc/blob/b601c89aec9042a1f509ddbdad478aa4e3f118fe/src/brpc/server.cpp#L888-L914\r\n> \r\n> 应该没法废弃bthread_keytable_pool_t ，因为Server已经用了bthread_keytable_pool_t了，并对外提供了与之相关的设置项。\r\n> \r\n> 改造bthread_keytable_pool_t，将free_keytables由全局改成TLS，这样mutex就可以废弃了。同时修改reserved_thread_local_data语义：每个TLS上预留的data数量。这样可行吗？\r\n\r\n如果使用TLS的话，当server结束调用Join时，通过bthread_keytable_pool_destroy方法需要删除所有线程内保存的TLS free_keytables才行，感觉也不是很方便？\r\n\r\n我的理解，目前的实现是一个server会绑定一个全局的bthread_keytable_pool_t，在server的声明周期内，server和其生成的bthread使用同一个pool，在server结束时会销毁所有创建的KeyTable，通过bthread_keytable_pool_t内的链表；然后会从全局的KeyInfo中删除所有注册的Key。但是使用全局一个链表会存在锁的竞争问题，不知道理解的对不对。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2120363076/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2120990105","html_url":"https://github.com/apache/brpc/pull/2645#issuecomment-2120990105","issue_url":"https://api.github.com/repos/apache/brpc/issues/2645","id":2120990105,"node_id":"IC_kwDOBhmkcs5-a72Z","user":{"login":"MJY-HUST","id":52315061,"node_id":"MDQ6VXNlcjUyMzE1MDYx","avatar_url":"https://avatars.githubusercontent.com/u/52315061?v=4","gravatar_id":"","url":"https://api.github.com/users/MJY-HUST","html_url":"https://github.com/MJY-HUST","followers_url":"https://api.github.com/users/MJY-HUST/followers","following_url":"https://api.github.com/users/MJY-HUST/following{/other_user}","gists_url":"https://api.github.com/users/MJY-HUST/gists{/gist_id}","starred_url":"https://api.github.com/users/MJY-HUST/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MJY-HUST/subscriptions","organizations_url":"https://api.github.com/users/MJY-HUST/orgs","repos_url":"https://api.github.com/users/MJY-HUST/repos","events_url":"https://api.github.com/users/MJY-HUST/events{/privacy}","received_events_url":"https://api.github.com/users/MJY-HUST/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-20T18:34:20Z","updated_at":"2024-05-20T18:34:41Z","author_association":"CONTRIBUTOR","body":"改造bthread_keytable_pool_t ,其中引入一个类似Object_pool的成员，通过在成员内部使用tls变量来避免加互斥锁。然后对bthread_keytable_pool_t 中的锁的使用从互斥锁改为读写锁，来维护destroyed的值。在return_keytable内使用读锁，bthread_keytable_pool_init，bthread_keytable_pool_destroy时加写锁。这样就可以避免在sever未退出时多个线程return_keytable产生的锁的竞争。\r\n不知道这样是否可行","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2120990105/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121602397","html_url":"https://github.com/apache/brpc/pull/2645#issuecomment-2121602397","issue_url":"https://api.github.com/repos/apache/brpc/issues/2645","id":2121602397,"node_id":"IC_kwDOBhmkcs5-dRVd","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-21T02:42:21Z","updated_at":"2024-05-21T03:04:33Z","author_association":"CONTRIBUTOR","body":"> 我的理解，目前的实现是一个server会绑定一个全局的bthread_keytable_pool_t，在server的声明周期内，server和其生成的bthread使用同一个pool，在server结束时会销毁所有创建的KeyTable，通过bthread_keytable_pool_t内的链表；然后会从全局的KeyInfo中删除所有注册的Key。但是使用全局一个链表会存在锁的竞争问题，不知道理解的对不对。\r\n\r\n嗯，我也是这样理解的。不过一般接口实现的瓶颈都是在业务逻辑，所以这个锁的影响应该不大。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121602397/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121630465","html_url":"https://github.com/apache/brpc/pull/2645#issuecomment-2121630465","issue_url":"https://api.github.com/repos/apache/brpc/issues/2645","id":2121630465,"node_id":"IC_kwDOBhmkcs5-dYMB","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-21T03:04:07Z","updated_at":"2024-05-21T03:22:27Z","author_association":"CONTRIBUTOR","body":"> 改造bthread_keytable_pool_t ,其中引入一个类似Object_pool的成员，通过在成员内部使用tls变量来避免加互斥锁。然后对bthread_keytable_pool_t 中的锁的使用从互斥锁改为读写锁，来维护destroyed的值。在return_keytable内使用读锁，bthread_keytable_pool_init，bthread_keytable_pool_destroy时加写锁。这样就可以避免在sever未退出时多个线程return_keytable产生的锁的竞争。 不知道这样是否可行\r\n\r\n之前考虑过在bthread_keytable_pool_t中使用ObjectPool，但是ObjectPool好像不能实现reserved_thread_local_data吧？\r\n\r\ndestroyed应该可以用原子变量，就不用锁了吧。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121630465/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121640057","html_url":"https://github.com/apache/brpc/pull/2645#issuecomment-2121640057","issue_url":"https://api.github.com/repos/apache/brpc/issues/2645","id":2121640057,"node_id":"IC_kwDOBhmkcs5-dah5","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-21T03:16:53Z","updated_at":"2024-05-21T03:16:53Z","author_association":"CONTRIBUTOR","body":"> 如果使用TLS的话，当server结束调用Join时，通过bthread_keytable_pool_destroy方法需要删除所有线程内保存的TLS free_keytables才行，感觉也不是很方便？\r\n\r\n用butil::ThreadLocal应该挺方便的吧。\r\nbthread_keytable_pool_init的时候，new一个butil::ThreadLocal。\r\nbthread_keytable_pool_destroy的时候，delete。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121640057/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121660473","html_url":"https://github.com/apache/brpc/pull/2645#issuecomment-2121660473","issue_url":"https://api.github.com/repos/apache/brpc/issues/2645","id":2121660473,"node_id":"IC_kwDOBhmkcs5-dfg5","user":{"login":"MJY-HUST","id":52315061,"node_id":"MDQ6VXNlcjUyMzE1MDYx","avatar_url":"https://avatars.githubusercontent.com/u/52315061?v=4","gravatar_id":"","url":"https://api.github.com/users/MJY-HUST","html_url":"https://github.com/MJY-HUST","followers_url":"https://api.github.com/users/MJY-HUST/followers","following_url":"https://api.github.com/users/MJY-HUST/following{/other_user}","gists_url":"https://api.github.com/users/MJY-HUST/gists{/gist_id}","starred_url":"https://api.github.com/users/MJY-HUST/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MJY-HUST/subscriptions","organizations_url":"https://api.github.com/users/MJY-HUST/orgs","repos_url":"https://api.github.com/users/MJY-HUST/repos","events_url":"https://api.github.com/users/MJY-HUST/events{/privacy}","received_events_url":"https://api.github.com/users/MJY-HUST/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-21T03:34:37Z","updated_at":"2024-05-21T03:34:37Z","author_association":"CONTRIBUTOR","body":"> > 如果使用TLS的话，当server结束调用Join时，通过bthread_keytable_pool_destroy方法需要删除所有线程内保存的TLS free_keytables才行，感觉也不是很方便？\r\n> \r\n> 用butil::ThreadLocal应该挺方便的吧。 bthread_keytable_pool_init的时候，new一个butil::ThreadLocal。 bthread_keytable_pool_destroy的时候，delete。\r\n\r\n使用butil::ThreadLocal的话,new的object只有当线程结束才会释放，而目前基于bthread_keytable_pool_t的实现是在server Join后即清理释放所有的table，从KeyInfo中移除注册的key信息。如果使用butil::ThreadLocal，可以在delete后，析构所有的keytable吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121660473/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121665236","html_url":"https://github.com/apache/brpc/pull/2645#issuecomment-2121665236","issue_url":"https://api.github.com/repos/apache/brpc/issues/2645","id":2121665236,"node_id":"IC_kwDOBhmkcs5-dgrU","user":{"login":"MJY-HUST","id":52315061,"node_id":"MDQ6VXNlcjUyMzE1MDYx","avatar_url":"https://avatars.githubusercontent.com/u/52315061?v=4","gravatar_id":"","url":"https://api.github.com/users/MJY-HUST","html_url":"https://github.com/MJY-HUST","followers_url":"https://api.github.com/users/MJY-HUST/followers","following_url":"https://api.github.com/users/MJY-HUST/following{/other_user}","gists_url":"https://api.github.com/users/MJY-HUST/gists{/gist_id}","starred_url":"https://api.github.com/users/MJY-HUST/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MJY-HUST/subscriptions","organizations_url":"https://api.github.com/users/MJY-HUST/orgs","repos_url":"https://api.github.com/users/MJY-HUST/repos","events_url":"https://api.github.com/users/MJY-HUST/events{/privacy}","received_events_url":"https://api.github.com/users/MJY-HUST/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-21T03:40:49Z","updated_at":"2024-05-21T03:40:49Z","author_association":"CONTRIBUTOR","body":"> > 改造bthread_keytable_pool_t ,其中引入一个类似Object_pool的成员，通过在成员内部使用tls变量来避免加互斥锁。然后对bthread_keytable_pool_t 中的锁的使用从互斥锁改为读写锁，来维护destroyed的值。在return_keytable内使用读锁，bthread_keytable_pool_init，bthread_keytable_pool_destroy时加写锁。这样就可以避免在sever未退出时多个线程return_keytable产生的锁的竞争。 不知道这样是否可行\r\n> \r\n> 之前考虑过在bthread_keytable_pool_t中使用ObjectPool，但是ObjectPool好像不能实现reserved_thread_local_data吧？\r\n> \r\n> destroyed应该可以用原子变量，就不用锁了吧。\r\n\r\n1. 应该也不能直接使用Object_pool，因为它是一个单例，不能做到sever间的隔离。\r\n2. 我看ResourcePool获取对象的模式是如下图，那么reserve时初始化多个全局的block是否可行。\r\n![image](https://github.com/apache/brpc/assets/52315061/492c9446-b786-4e53-a078-0a7f0bafd039)\r\n3. return_keytable时，加读锁的临界区是判断destroyed + 将对象返回给pool，感觉不能直接使用原子变量","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121665236/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121670376","html_url":"https://github.com/apache/brpc/pull/2645#issuecomment-2121670376","issue_url":"https://api.github.com/repos/apache/brpc/issues/2645","id":2121670376,"node_id":"IC_kwDOBhmkcs5-dh7o","user":{"login":"MJY-HUST","id":52315061,"node_id":"MDQ6VXNlcjUyMzE1MDYx","avatar_url":"https://avatars.githubusercontent.com/u/52315061?v=4","gravatar_id":"","url":"https://api.github.com/users/MJY-HUST","html_url":"https://github.com/MJY-HUST","followers_url":"https://api.github.com/users/MJY-HUST/followers","following_url":"https://api.github.com/users/MJY-HUST/following{/other_user}","gists_url":"https://api.github.com/users/MJY-HUST/gists{/gist_id}","starred_url":"https://api.github.com/users/MJY-HUST/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MJY-HUST/subscriptions","organizations_url":"https://api.github.com/users/MJY-HUST/orgs","repos_url":"https://api.github.com/users/MJY-HUST/repos","events_url":"https://api.github.com/users/MJY-HUST/events{/privacy}","received_events_url":"https://api.github.com/users/MJY-HUST/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-21T03:48:14Z","updated_at":"2024-05-21T03:48:14Z","author_association":"CONTRIBUTOR","body":"> > 我的理解，目前的实现是一个server会绑定一个全局的bthread_keytable_pool_t，在server的声明周期内，server和其生成的bthread使用同一个pool，在server结束时会销毁所有创建的KeyTable，通过bthread_keytable_pool_t内的链表；然后会从全局的KeyInfo中删除所有注册的Key。但是使用全局一个链表会存在锁的竞争问题，不知道理解的对不对。\r\n> \r\n> 嗯，我也是这样理解的。不过一般接口实现的瓶颈都是在业务逻辑，所以这个锁的影响应该不大。\r\n\r\n我们这边的场景是使用brpc server下面接了个rocksdb，当数据全被cache住时，service端的处理时间可能很短，导致瓶颈体现在了锁的竞争上\r\n![image](https://github.com/apache/brpc/assets/52315061/53df9c22-a8b9-43f0-8d2b-c6782f6a638f)\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121670376/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121677162","html_url":"https://github.com/apache/brpc/pull/2645#issuecomment-2121677162","issue_url":"https://api.github.com/repos/apache/brpc/issues/2645","id":2121677162,"node_id":"IC_kwDOBhmkcs5-djlq","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-21T03:57:52Z","updated_at":"2024-05-21T03:57:52Z","author_association":"CONTRIBUTOR","body":"> > > 如果使用TLS的话，当server结束调用Join时，通过bthread_keytable_pool_destroy方法需要删除所有线程内保存的TLS free_keytables才行，感觉也不是很方便？\r\n> > \r\n> > \r\n> > 用butil::ThreadLocal应该挺方便的吧。 bthread_keytable_pool_init的时候，new一个butil::ThreadLocal。 bthread_keytable_pool_destroy的时候，delete。\r\n> \r\n> 使用butil::ThreadLocal的话,new的object只有当线程结束才会释放，而目前基于bthread_keytable_pool_t的实现是在server Join后即清理释放所有的table，从KeyInfo中移除注册的key信息。如果使用butil::ThreadLocal，可以在delete后，析构所有的keytable吗？\r\n\r\nbutil::ThreadLocal析构时，会delete使用过butil::ThreadLocal的每个线程上的local data。应该可以满足需求吧。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121677162/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121703973","html_url":"https://github.com/apache/brpc/pull/2645#issuecomment-2121703973","issue_url":"https://api.github.com/repos/apache/brpc/issues/2645","id":2121703973,"node_id":"IC_kwDOBhmkcs5-dqIl","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-21T04:13:01Z","updated_at":"2024-05-21T04:13:01Z","author_association":"CONTRIBUTOR","body":"> 我看ResourcePool获取对象的模式是如下图，那么reserve时初始化多个全局的block是否可行。\r\n\r\nResourcePool也是单例哦。\r\n\r\n> return_keytable时，加读锁的临界区是判断destroyed + 将对象返回给pool，感觉不能直接使用原子变量\r\n\r\n嗯嗯，return_keytable和bthread_keytable_pool_destroy需要互斥，不能用原子变量。\r\n\r\n无论是ObjectPool还是ResourcePool的实现方式，即使destroyed=1，也是要将KeyTable返回给ObjectPool或者ResourcePool的吧。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121703973/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121738852","html_url":"https://github.com/apache/brpc/pull/2645#issuecomment-2121738852","issue_url":"https://api.github.com/repos/apache/brpc/issues/2645","id":2121738852,"node_id":"IC_kwDOBhmkcs5-dypk","user":{"login":"MJY-HUST","id":52315061,"node_id":"MDQ6VXNlcjUyMzE1MDYx","avatar_url":"https://avatars.githubusercontent.com/u/52315061?v=4","gravatar_id":"","url":"https://api.github.com/users/MJY-HUST","html_url":"https://github.com/MJY-HUST","followers_url":"https://api.github.com/users/MJY-HUST/followers","following_url":"https://api.github.com/users/MJY-HUST/following{/other_user}","gists_url":"https://api.github.com/users/MJY-HUST/gists{/gist_id}","starred_url":"https://api.github.com/users/MJY-HUST/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MJY-HUST/subscriptions","organizations_url":"https://api.github.com/users/MJY-HUST/orgs","repos_url":"https://api.github.com/users/MJY-HUST/repos","events_url":"https://api.github.com/users/MJY-HUST/events{/privacy}","received_events_url":"https://api.github.com/users/MJY-HUST/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-21T04:54:30Z","updated_at":"2024-05-21T04:54:30Z","author_association":"CONTRIBUTOR","body":"> > > > 如果使用TLS的话，当server结束调用Join时，通过bthread_keytable_pool_destroy方法需要删除所有线程内保存的TLS free_keytables才行，感觉也不是很方便？\r\n> > > \r\n> > > \r\n> > > 用butil::ThreadLocal应该挺方便的吧。 bthread_keytable_pool_init的时候，new一个butil::ThreadLocal。 bthread_keytable_pool_destroy的时候，delete。\r\n> > \r\n> > \r\n> > 使用butil::ThreadLocal的话,new的object只有当线程结束才会释放，而目前基于bthread_keytable_pool_t的实现是在server Join后即清理释放所有的table，从KeyInfo中移除注册的key信息。如果使用butil::ThreadLocal，可以在delete后，析构所有的keytable吗？\r\n> \r\n> butil::ThreadLocal析构时，会delete使用过butil::ThreadLocal的每个线程上的local data。应该可以满足需求吧。\r\n\r\n请问一下这块逻辑具体在哪里呢？我没有看到butil::ThreadLocal这个类的定义。是ThreadLocalPointer吗？\r\n当在一个线程上调用delete时，它是如何做到会delete使用过butil::ThreadLocal的每个线程上的local data，我没有看到类似链表或者list来存放所有线程的tls指针","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121738852/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121822911","html_url":"https://github.com/apache/brpc/pull/2645#issuecomment-2121822911","issue_url":"https://api.github.com/repos/apache/brpc/issues/2645","id":2121822911,"node_id":"IC_kwDOBhmkcs5-eHK_","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-21T06:10:47Z","updated_at":"2024-05-21T06:10:47Z","author_association":"CONTRIBUTOR","body":"https://github.com/apache/brpc/blob/b601c89aec9042a1f509ddbdad478aa4e3f118fe/src/butil/thread_key.h#L144-L154","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2121822911/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2123759686","html_url":"https://github.com/apache/brpc/issues/2636#issuecomment-2123759686","issue_url":"https://api.github.com/repos/apache/brpc/issues/2636","id":2123759686,"node_id":"IC_kwDOBhmkcs5-lgBG","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-22T02:34:22Z","updated_at":"2024-05-22T02:34:22Z","author_association":"CONTRIBUTOR","body":"related PR: #2171","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2123759686/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2124024905","html_url":"https://github.com/apache/brpc/issues/2646#issuecomment-2124024905","issue_url":"https://api.github.com/repos/apache/brpc/issues/2646","id":2124024905,"node_id":"IC_kwDOBhmkcs5-mgxJ","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-22T07:05:54Z","updated_at":"2024-05-22T07:05:54Z","author_association":"CONTRIBUTOR","body":"bthread_id_unlock的返回值是什么？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2124024905/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2124152249","html_url":"https://github.com/apache/brpc/issues/2646#issuecomment-2124152249","issue_url":"https://api.github.com/repos/apache/brpc/issues/2646","id":2124152249,"node_id":"IC_kwDOBhmkcs5-m_25","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-22T08:14:32Z","updated_at":"2024-05-22T08:14:32Z","author_association":"NONE","body":"> bthread_id_unlock的返回值是什么？\r\n\r\n22","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2124152249/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2124600518","html_url":"https://github.com/apache/brpc/pull/2156#issuecomment-2124600518","issue_url":"https://api.github.com/repos/apache/brpc/issues/2156","id":2124600518,"node_id":"IC_kwDOBhmkcs5-otTG","user":{"login":"zcfh","id":70124382,"node_id":"MDQ6VXNlcjcwMTI0Mzgy","avatar_url":"https://avatars.githubusercontent.com/u/70124382?v=4","gravatar_id":"","url":"https://api.github.com/users/zcfh","html_url":"https://github.com/zcfh","followers_url":"https://api.github.com/users/zcfh/followers","following_url":"https://api.github.com/users/zcfh/following{/other_user}","gists_url":"https://api.github.com/users/zcfh/gists{/gist_id}","starred_url":"https://api.github.com/users/zcfh/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zcfh/subscriptions","organizations_url":"https://api.github.com/users/zcfh/orgs","repos_url":"https://api.github.com/users/zcfh/repos","events_url":"https://api.github.com/users/zcfh/events{/privacy}","received_events_url":"https://api.github.com/users/zcfh/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-22T11:49:50Z","updated_at":"2024-05-22T11:50:34Z","author_association":"NONE","body":"> 另外还有一个疑问是，函数 task_runner 和 tls_task_group 不都是在一个编译单元内吗？为什么是开启lto后才会触发这个问题呢。\r\n\r\n这个差异找到了（定位不易，踩坑的场景比较特殊，不知道有没有人会遇到）。和clang对tls变量访问的选择有关。如果使用-fPIC编译 + 分布式 thinlto ，clang-16之前都会出现这种行为差异，[具体原因](https://discourse.llvm.org/t/how-to-learn-tls-variable-access-using-register-optimized-decisions/78830/12)。\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2124600518/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2124823943","html_url":"https://github.com/apache/brpc/pull/2620#issuecomment-2124823943","issue_url":"https://api.github.com/repos/apache/brpc/issues/2620","id":2124823943,"node_id":"IC_kwDOBhmkcs5-pj2H","user":{"login":"javeme","id":9625821,"node_id":"MDQ6VXNlcjk2MjU4MjE=","avatar_url":"https://avatars.githubusercontent.com/u/9625821?v=4","gravatar_id":"","url":"https://api.github.com/users/javeme","html_url":"https://github.com/javeme","followers_url":"https://api.github.com/users/javeme/followers","following_url":"https://api.github.com/users/javeme/following{/other_user}","gists_url":"https://api.github.com/users/javeme/gists{/gist_id}","starred_url":"https://api.github.com/users/javeme/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/javeme/subscriptions","organizations_url":"https://api.github.com/users/javeme/orgs","repos_url":"https://api.github.com/users/javeme/repos","events_url":"https://api.github.com/users/javeme/events{/privacy}","received_events_url":"https://api.github.com/users/javeme/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-22T13:37:52Z","updated_at":"2024-05-22T13:37:52Z","author_association":"NONE","body":"Because the usage difference with std::map, FlatMap is unfriendly to use.\r\nI think this PR is a good improvement.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2124823943/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2126065790","html_url":"https://github.com/apache/brpc/issues/2646#issuecomment-2126065790","issue_url":"https://api.github.com/repos/apache/brpc/issues/2646","id":2126065790,"node_id":"IC_kwDOBhmkcs5-uTB-","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-23T02:13:48Z","updated_at":"2024-05-23T02:13:48Z","author_association":"CONTRIBUTOR","body":"发rpc的时候，已经lock bthread_id了，bthread_id_unlock_and_destroy实际是在bthread_id_unlock里被调的，这在设计的时候已经考虑到了。\r\n\r\nbthread_id的使用是不是有改动？或者定位一下这个EINVAL返回值实际是哪里返回的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2126065790/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2126073352","html_url":"https://github.com/apache/brpc/issues/2647#issuecomment-2126073352","issue_url":"https://api.github.com/repos/apache/brpc/issues/2647","id":2126073352,"node_id":"IC_kwDOBhmkcs5-uU4I","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-23T02:24:31Z","updated_at":"2024-05-23T02:24:31Z","author_association":"CONTRIBUTOR","body":"308是server响应的状态码。如果server响应308状态码的话，http rpc就会失败。这块逻辑没有改动过。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2126073352/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2126086597","html_url":"https://github.com/apache/brpc/pull/2645#issuecomment-2126086597","issue_url":"https://api.github.com/repos/apache/brpc/issues/2645","id":2126086597,"node_id":"IC_kwDOBhmkcs5-uYHF","user":{"login":"MJY-HUST","id":52315061,"node_id":"MDQ6VXNlcjUyMzE1MDYx","avatar_url":"https://avatars.githubusercontent.com/u/52315061?v=4","gravatar_id":"","url":"https://api.github.com/users/MJY-HUST","html_url":"https://github.com/MJY-HUST","followers_url":"https://api.github.com/users/MJY-HUST/followers","following_url":"https://api.github.com/users/MJY-HUST/following{/other_user}","gists_url":"https://api.github.com/users/MJY-HUST/gists{/gist_id}","starred_url":"https://api.github.com/users/MJY-HUST/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/MJY-HUST/subscriptions","organizations_url":"https://api.github.com/users/MJY-HUST/orgs","repos_url":"https://api.github.com/users/MJY-HUST/repos","events_url":"https://api.github.com/users/MJY-HUST/events{/privacy}","received_events_url":"https://api.github.com/users/MJY-HUST/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-23T02:43:25Z","updated_at":"2024-05-23T02:43:25Z","author_association":"CONTRIBUTOR","body":"@chenBright hello，我根据讨论修改了实现，可以帮忙看一下么","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2126086597/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2126132016","html_url":"https://github.com/apache/brpc/pull/2620#issuecomment-2126132016","issue_url":"https://api.github.com/repos/apache/brpc/issues/2620","id":2126132016,"node_id":"IC_kwDOBhmkcs5-ujMw","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-23T03:01:38Z","updated_at":"2024-05-23T03:01:38Z","author_association":"CONTRIBUTOR","body":"There are some unknown crash issues. This PR will be opened after these issues are resolved.","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2126132016/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2126628611","html_url":"https://github.com/apache/brpc/issues/2648#issuecomment-2126628611","issue_url":"https://api.github.com/repos/apache/brpc/issues/2648","id":2126628611,"node_id":"IC_kwDOBhmkcs5-wccD","user":{"login":"TousakaRin","id":8801314,"node_id":"MDQ6VXNlcjg4MDEzMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8801314?v=4","gravatar_id":"","url":"https://api.github.com/users/TousakaRin","html_url":"https://github.com/TousakaRin","followers_url":"https://api.github.com/users/TousakaRin/followers","following_url":"https://api.github.com/users/TousakaRin/following{/other_user}","gists_url":"https://api.github.com/users/TousakaRin/gists{/gist_id}","starred_url":"https://api.github.com/users/TousakaRin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TousakaRin/subscriptions","organizations_url":"https://api.github.com/users/TousakaRin/orgs","repos_url":"https://api.github.com/users/TousakaRin/repos","events_url":"https://api.github.com/users/TousakaRin/events{/privacy}","received_events_url":"https://api.github.com/users/TousakaRin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-23T09:17:42Z","updated_at":"2024-05-23T09:17:42Z","author_association":"CONTRIBUTOR","body":"应该是编译器版本或者编译选项导致的，欢迎提个PR给他加上一个virtual destructor","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2126628611/reactions","total_count":1,"+1":0,"-1":0,"laugh":1,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2128574202","html_url":"https://github.com/apache/brpc/pull/2651#issuecomment-2128574202","issue_url":"https://api.github.com/repos/apache/brpc/issues/2651","id":2128574202,"node_id":"IC_kwDOBhmkcs5-33b6","user":{"login":"yozhao","id":2783399,"node_id":"MDQ6VXNlcjI3ODMzOTk=","avatar_url":"https://avatars.githubusercontent.com/u/2783399?v=4","gravatar_id":"","url":"https://api.github.com/users/yozhao","html_url":"https://github.com/yozhao","followers_url":"https://api.github.com/users/yozhao/followers","following_url":"https://api.github.com/users/yozhao/following{/other_user}","gists_url":"https://api.github.com/users/yozhao/gists{/gist_id}","starred_url":"https://api.github.com/users/yozhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yozhao/subscriptions","organizations_url":"https://api.github.com/users/yozhao/orgs","repos_url":"https://api.github.com/users/yozhao/repos","events_url":"https://api.github.com/users/yozhao/events{/privacy}","received_events_url":"https://api.github.com/users/yozhao/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-24T05:41:31Z","updated_at":"2024-05-24T05:41:31Z","author_association":"CONTRIBUTOR","body":"Fix non-virtual-dtor warning or error","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2128574202/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2128873260","html_url":"https://github.com/apache/brpc/pull/2651#issuecomment-2128873260","issue_url":"https://api.github.com/repos/apache/brpc/issues/2651","id":2128873260,"node_id":"IC_kwDOBhmkcs5-5Acs","user":{"login":"yozhao","id":2783399,"node_id":"MDQ6VXNlcjI3ODMzOTk=","avatar_url":"https://avatars.githubusercontent.com/u/2783399?v=4","gravatar_id":"","url":"https://api.github.com/users/yozhao","html_url":"https://github.com/yozhao","followers_url":"https://api.github.com/users/yozhao/followers","following_url":"https://api.github.com/users/yozhao/following{/other_user}","gists_url":"https://api.github.com/users/yozhao/gists{/gist_id}","starred_url":"https://api.github.com/users/yozhao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yozhao/subscriptions","organizations_url":"https://api.github.com/users/yozhao/orgs","repos_url":"https://api.github.com/users/yozhao/repos","events_url":"https://api.github.com/users/yozhao/events{/privacy}","received_events_url":"https://api.github.com/users/yozhao/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-24T08:11:21Z","updated_at":"2024-05-24T08:11:21Z","author_association":"CONTRIBUTOR","body":"嗯 大意了，改过来了。\r\n\r\nlei he ***@***.***> 于2024年5月24日周五 14:16写道：\r\n\r\n> ***@***.**** commented on this pull request.\r\n> ------------------------------\r\n>\r\n> In src/brpc/span.h\r\n> <https://github.com/apache/brpc/pull/2651#discussion_r1612875583>:\r\n>\r\n> > @@ -206,6 +206,7 @@ void AnnotateSpan(const char* fmt, ...);\r\n>\r\n>  class SpanFilter {\r\n>  public:\r\n> +    virtual ~SpanFilter() = 0;\r\n>\r\n> 定义成纯虚函数最后链接会出错吧。。 virtual ~SpanFilter() = default 比较好\r\n>\r\n> —\r\n> Reply to this email directly, view it on GitHub\r\n> <https://github.com/apache/brpc/pull/2651#pullrequestreview-2075880770>,\r\n> or unsubscribe\r\n> <https://github.com/notifications/unsubscribe-auth/AAVHRJ342JMQKAAVVHLD323ZD3LKXAVCNFSM6AAAAABIG43P7GVHI2DSMVQWIX3LMV43YUDVNRWFEZLROVSXG5CSMV3GSZLXHMZDANZVHA4DANZXGA>\r\n> .\r\n> You are receiving this because you authored the thread.Message ID:\r\n> ***@***.***>\r\n>\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2128873260/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2128898253","html_url":"https://github.com/apache/brpc/pull/2171#issuecomment-2128898253","issue_url":"https://api.github.com/repos/apache/brpc/issues/2171","id":2128898253,"node_id":"IC_kwDOBhmkcs5-5GjN","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-24T08:24:43Z","updated_at":"2024-05-24T08:24:43Z","author_association":"NONE","body":"不支持auth?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2128898253/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2128914091","html_url":"https://github.com/apache/brpc/issues/2636#issuecomment-2128914091","issue_url":"https://api.github.com/repos/apache/brpc/issues/2636","id":2128914091,"node_id":"IC_kwDOBhmkcs5-5Kar","user":{"login":"jiangdongzi","id":17529657,"node_id":"MDQ6VXNlcjE3NTI5NjU3","avatar_url":"https://avatars.githubusercontent.com/u/17529657?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangdongzi","html_url":"https://github.com/jiangdongzi","followers_url":"https://api.github.com/users/jiangdongzi/followers","following_url":"https://api.github.com/users/jiangdongzi/following{/other_user}","gists_url":"https://api.github.com/users/jiangdongzi/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangdongzi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangdongzi/subscriptions","organizations_url":"https://api.github.com/users/jiangdongzi/orgs","repos_url":"https://api.github.com/users/jiangdongzi/repos","events_url":"https://api.github.com/users/jiangdongzi/events{/privacy}","received_events_url":"https://api.github.com/users/jiangdongzi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2024-05-24T08:29:02Z","updated_at":"2024-05-24T08:29:02Z","author_association":"NONE","body":"> 设置notify_on_success后，不会\r\n\r\n如果直接返回, 那么回包后controller, request,  response析构了怎么办, 还是说只支持不回包的请求?","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/2128914091/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]