[{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404503530","html_url":"https://github.com/apache/iceberg/issues/6670#issuecomment-1404503530","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6670","id":1404503530,"node_id":"IC_kwDOCW7NX85TtwXq","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T02:52:45Z","updated_at":"2023-01-26T03:09:32Z","author_association":"MEMBER","body":"I did a quick test using PartitionData which passes, no collision in the has code either, (but there is a collision for the structlikewrapper.hashcode) I may have something wrong ...\r\n```java\r\n  @Test\r\n  public void testBug() {\r\n    Types.StructType STRUCT_TYPE =\r\n            Types.StructType.of(\r\n                    Types.NestedField.required(1, \"a\", Types.IntegerType.get()),\r\n                    Types.NestedField.optional(2, \"b\", Types.IntegerType.get()));\r\n\r\n    PartitionData record1 = new PartitionData(STRUCT_TYPE);\r\n    PartitionData record2 = new PartitionData(STRUCT_TYPE);\r\n\r\n    record1.set(0, 20220726);\r\n    record1.set(1, 20220801);\r\n\r\n    record2.set(0, 20220728);\r\n    record2.set(1, 20220719);\r\n\r\n    StructLikeWrapper wrapper = StructLikeWrapper.forType(STRUCT_TYPE);\r\n\r\n    Assert.assertEquals(wrapper.set(record1).hashCode(), wrapper.set(record2).hashCode());\r\n    Assert.assertNotEquals(wrapper.copyFor(record1), wrapper.copyFor(record2));\r\n\r\n    StructLikeMap map = StructLikeMap.create(STRUCT_TYPE);\r\n    map.put(record1, 1);\r\n    map.put(record2, 2);\r\n\r\n    Assert.assertEquals(1, map.get(record1));\r\n    Assert.assertEquals(2, map.get(record2));\r\n  }\r\n  ```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404503530/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404513790","html_url":"https://github.com/apache/iceberg/issues/6670#issuecomment-1404513790","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6670","id":1404513790,"node_id":"IC_kwDOCW7NX85Tty3-","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T03:08:16Z","updated_at":"2023-01-27T00:41:41Z","author_association":"COLLABORATOR","body":"@RussellSpitzer  is right, forget that hashcode is not the only factor for get() in a map.  It should check equals().  let us look further into it.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404513790/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404528549","html_url":"https://github.com/apache/iceberg/issues/6619#issuecomment-1404528549","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6619","id":1404528549,"node_id":"IC_kwDOCW7NX85Tt2el","user":{"login":"anthonysgro","id":64649626,"node_id":"MDQ6VXNlcjY0NjQ5NjI2","avatar_url":"https://avatars.githubusercontent.com/u/64649626?v=4","gravatar_id":"","url":"https://api.github.com/users/anthonysgro","html_url":"https://github.com/anthonysgro","followers_url":"https://api.github.com/users/anthonysgro/followers","following_url":"https://api.github.com/users/anthonysgro/following{/other_user}","gists_url":"https://api.github.com/users/anthonysgro/gists{/gist_id}","starred_url":"https://api.github.com/users/anthonysgro/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anthonysgro/subscriptions","organizations_url":"https://api.github.com/users/anthonysgro/orgs","repos_url":"https://api.github.com/users/anthonysgro/repos","events_url":"https://api.github.com/users/anthonysgro/events{/privacy}","received_events_url":"https://api.github.com/users/anthonysgro/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T03:37:02Z","updated_at":"2023-01-26T03:37:02Z","author_association":"NONE","body":"Yes. So here is specifically how it happens:\r\n\r\nCreating my table:\r\nI create my table through an Athena query\r\n```\r\nCREATE TABLE IF NOT EXISTS db.friends (\r\n    id string,\r\n    name string,\r\n    birthday timestamp\r\n)\r\nLOCATION s3://iceberg-datalake\r\nTBLPROPERTIES (\r\n   'table_type' = 'ICEBERG'\r\n)\r\n```\r\n\r\nWe can insert a couple rows into this table, yada yada.\r\n\r\nThen comes AWS Backup. It is a service that is natively integrated into S3. I went to the AWS Backup console, navigated to **Protected Resources**, and picked my iceberg datalake bucket, and created a recovery point. It takes about an hour or so for it to get backed up. \r\n\r\nOnce a recovery point becomes available, I deleted my entire s3://iceberg-datalake bucket. If I query my iceberg table through Athena, it throws an error (as expected, the data is deleted!). But no worries, I restored the bucket with a click of a button in AWS Backup, and voila, it recreates after a bit of time. I can once again query my iceberg table, as if nothing happened. Perfect.\r\n\r\nHowever, some cases where this doesn't work:\r\nIf I run:\r\n```\r\nDROP TABLE db.friends\r\n```\r\nit deletes the table and the S3 data, as expected. AWS tells me iceberg tables do that, for some reason. But then, if I recreate the table using the above command, and then restore my backup, it throws a strange error, and it can't seem to get back to normal.\r\n\r\nIs there something with a metadata pointer or something if this occurs? I haven't been able to find a way to restore iceberg table data after a DROP TABLE command. I would absolutely be interested in hearing more if this S3 access point integration helps prevent agains this!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404528549/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404588075","html_url":"https://github.com/apache/iceberg/pull/6646#issuecomment-1404588075","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6646","id":1404588075,"node_id":"IC_kwDOCW7NX85TuFAr","user":{"login":"arminnajafi","id":9739243,"node_id":"MDQ6VXNlcjk3MzkyNDM=","avatar_url":"https://avatars.githubusercontent.com/u/9739243?v=4","gravatar_id":"","url":"https://api.github.com/users/arminnajafi","html_url":"https://github.com/arminnajafi","followers_url":"https://api.github.com/users/arminnajafi/followers","following_url":"https://api.github.com/users/arminnajafi/following{/other_user}","gists_url":"https://api.github.com/users/arminnajafi/gists{/gist_id}","starred_url":"https://api.github.com/users/arminnajafi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arminnajafi/subscriptions","organizations_url":"https://api.github.com/users/arminnajafi/orgs","repos_url":"https://api.github.com/users/arminnajafi/repos","events_url":"https://api.github.com/users/arminnajafi/events{/privacy}","received_events_url":"https://api.github.com/users/arminnajafi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T05:50:49Z","updated_at":"2023-01-26T05:50:49Z","author_association":"CONTRIBUTOR","body":"@Fokko @jackye1995 \r\nReady for review","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404588075/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404604496","html_url":"https://github.com/apache/iceberg/pull/6660#issuecomment-1404604496","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6660","id":1404604496,"node_id":"IC_kwDOCW7NX85TuJBQ","user":{"login":"pvary","id":19705742,"node_id":"MDQ6VXNlcjE5NzA1NzQy","avatar_url":"https://avatars.githubusercontent.com/u/19705742?v=4","gravatar_id":"","url":"https://api.github.com/users/pvary","html_url":"https://github.com/pvary","followers_url":"https://api.github.com/users/pvary/followers","following_url":"https://api.github.com/users/pvary/following{/other_user}","gists_url":"https://api.github.com/users/pvary/gists{/gist_id}","starred_url":"https://api.github.com/users/pvary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvary/subscriptions","organizations_url":"https://api.github.com/users/pvary/orgs","repos_url":"https://api.github.com/users/pvary/repos","events_url":"https://api.github.com/users/pvary/events{/privacy}","received_events_url":"https://api.github.com/users/pvary/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T06:21:59Z","updated_at":"2023-01-26T06:21:59Z","author_association":"CONTRIBUTOR","body":"Thanks for the PR @amogh-jahagirdar!\r\nLeft one small question.\r\n\r\nAlso, do we have this feature in FlinkSource?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404604496/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404609798","html_url":"https://github.com/apache/iceberg/issues/6667#issuecomment-1404609798","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6667","id":1404609798,"node_id":"IC_kwDOCW7NX85TuKUG","user":{"login":"pvary","id":19705742,"node_id":"MDQ6VXNlcjE5NzA1NzQy","avatar_url":"https://avatars.githubusercontent.com/u/19705742?v=4","gravatar_id":"","url":"https://api.github.com/users/pvary","html_url":"https://github.com/pvary","followers_url":"https://api.github.com/users/pvary/followers","following_url":"https://api.github.com/users/pvary/following{/other_user}","gists_url":"https://api.github.com/users/pvary/gists{/gist_id}","starred_url":"https://api.github.com/users/pvary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvary/subscriptions","organizations_url":"https://api.github.com/users/pvary/orgs","repos_url":"https://api.github.com/users/pvary/repos","events_url":"https://api.github.com/users/pvary/events{/privacy}","received_events_url":"https://api.github.com/users/pvary/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T06:33:25Z","updated_at":"2023-01-26T06:33:25Z","author_association":"CONTRIBUTOR","body":"Hi @GabeChurch,\r\nSadly I am not too familiar with the Spark configurations, but when #6570 gets in, it might help you with the high frequency concurrent writes.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404609798/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404648315","html_url":"https://github.com/apache/iceberg/pull/6664#issuecomment-1404648315","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6664","id":1404648315,"node_id":"IC_kwDOCW7NX85TuTt7","user":{"login":"nastra","id":271029,"node_id":"MDQ6VXNlcjI3MTAyOQ==","avatar_url":"https://avatars.githubusercontent.com/u/271029?v=4","gravatar_id":"","url":"https://api.github.com/users/nastra","html_url":"https://github.com/nastra","followers_url":"https://api.github.com/users/nastra/followers","following_url":"https://api.github.com/users/nastra/following{/other_user}","gists_url":"https://api.github.com/users/nastra/gists{/gist_id}","starred_url":"https://api.github.com/users/nastra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nastra/subscriptions","organizations_url":"https://api.github.com/users/nastra/orgs","repos_url":"https://api.github.com/users/nastra/repos","events_url":"https://api.github.com/users/nastra/events{/privacy}","received_events_url":"https://api.github.com/users/nastra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T07:40:46Z","updated_at":"2023-01-26T07:40:46Z","author_association":"CONTRIBUTOR","body":"@szehon-ho thanks for the review. I double-checking and we actually don't need to deprecate anything. Making the method in the super class `protected` again fixes the issue, so we should be good with that.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404648315/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404692576","html_url":"https://github.com/apache/iceberg/issues/6475#issuecomment-1404692576","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6475","id":1404692576,"node_id":"IC_kwDOCW7NX85Tuehg","user":{"login":"Fokko","id":1134248,"node_id":"MDQ6VXNlcjExMzQyNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1134248?v=4","gravatar_id":"","url":"https://api.github.com/users/Fokko","html_url":"https://github.com/Fokko","followers_url":"https://api.github.com/users/Fokko/followers","following_url":"https://api.github.com/users/Fokko/following{/other_user}","gists_url":"https://api.github.com/users/Fokko/gists{/gist_id}","starred_url":"https://api.github.com/users/Fokko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Fokko/subscriptions","organizations_url":"https://api.github.com/users/Fokko/orgs","repos_url":"https://api.github.com/users/Fokko/repos","events_url":"https://api.github.com/users/Fokko/events{/privacy}","received_events_url":"https://api.github.com/users/Fokko/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T08:36:27Z","updated_at":"2023-01-26T08:44:17Z","author_association":"CONTRIBUTOR","body":"Looking at the recent improvements by @rdblue \r\n\r\nBefore 887 requests, after the change 203 requests, which is a great improvement, but still more to be done!\r\n\r\nAfter:\r\n```\r\n➜  ~ time python3 /tmp/vo.py\r\npython3 /tmp/vo.py  2.10s user 2.02s system 77% cpu 5.294 total\r\npython3 /tmp/vo.py  2.56s user 1.27s system 68% cpu 5.558 total\r\npython3 /tmp/vo.py  1.96s user 1.94s system 68% cpu 5.729 total\r\n```\r\n\r\nBefore:\r\n```\r\npython3 /tmp/vo.py  2.15s user 1.86s system 64% cpu 6.232 total\r\npython3 /tmp/vo.py  2.61s user 1.53s system 65% cpu 6.315 total\r\npython3 /tmp/vo.py  2.48s user 1.58s system 66% cpu 6.081 total\r\n```\r\n\r\nKeep in mind that I'm testing against a local minio, so when using high-latency object storage such as s3 will make it much worse.\r\n\r\nBefore: https://gist.github.com/Fokko/495dce8234148be74eb312d1af93e694\r\nAfter: https://gist.github.com/Fokko/a0cc4ac4ec6a7701a145a4a3da3a6bc6\r\n\r\nNow we still hit a parquet file a few times:\r\n```\r\n2023-01-26T08:26:46.431 [200 OK] s3.HeadObject 127.0.0.1:9000/warehouse/wh/nyc/taxis/data/tpep_pickup_datetime_day=2022-04-27/00003-4-2a5c755f-ae72-4db7-9a8e-b40a39f067b2-00030.parquet 172.18.0.1        895µs       ↑ 153 B ↓ 0 B\r\n2023-01-26T08:26:46.463 [206 Partial Content] s3.GetObject 127.0.0.1:9000/warehouse/wh/nyc/taxis/data/tpep_pickup_datetime_day=2022-04-27/00003-4-2a5c755f-ae72-4db7-9a8e-b40a39f067b2-00030.parquet 172.18.0.1        7.06ms       ↑ 159 B ↓ 64 KiB\r\n2023-01-26T08:26:46.546 [200 OK] s3.HeadObject 127.0.0.1:9000/warehouse/wh/nyc/taxis/data/tpep_pickup_datetime_day=2022-04-27/00003-4-2a5c755f-ae72-4db7-9a8e-b40a39f067b2-00030.parquet 172.18.0.1        440µs       ↑ 153 B ↓ 0 B\r\n2023-01-26T08:26:46.987 [206 Partial Content] s3.GetObject 127.0.0.1:9000/warehouse/wh/nyc/taxis/data/tpep_pickup_datetime_day=2022-04-27/00003-4-2a5c755f-ae72-4db7-9a8e-b40a39f067b2-00030.parquet 172.18.0.1        4.311ms      ↑ 159 B ↓ 64 KiB\r\n2023-01-26T08:26:47.073 [206 Partial Content] s3.GetObject 127.0.0.1:9000/warehouse/wh/nyc/taxis/data/tpep_pickup_datetime_day=2022-04-27/00003-4-2a5c755f-ae72-4db7-9a8e-b40a39f067b2-00030.parquet 172.18.0.1        6.074ms      ↑ 159 B ↓ 1.9 MiB\r\n```\r\nThe first two requests are fetching the schema and then fetching the actual data.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1404692576/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405009473","html_url":"https://github.com/apache/iceberg/pull/6470#issuecomment-1405009473","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6470","id":1405009473,"node_id":"IC_kwDOCW7NX85Tvr5B","user":{"login":"0xNacho","id":2890475,"node_id":"MDQ6VXNlcjI4OTA0NzU=","avatar_url":"https://avatars.githubusercontent.com/u/2890475?v=4","gravatar_id":"","url":"https://api.github.com/users/0xNacho","html_url":"https://github.com/0xNacho","followers_url":"https://api.github.com/users/0xNacho/followers","following_url":"https://api.github.com/users/0xNacho/following{/other_user}","gists_url":"https://api.github.com/users/0xNacho/gists{/gist_id}","starred_url":"https://api.github.com/users/0xNacho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/0xNacho/subscriptions","organizations_url":"https://api.github.com/users/0xNacho/orgs","repos_url":"https://api.github.com/users/0xNacho/repos","events_url":"https://api.github.com/users/0xNacho/events{/privacy}","received_events_url":"https://api.github.com/users/0xNacho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T13:29:24Z","updated_at":"2023-01-26T13:29:24Z","author_association":"NONE","body":"+1 @peay . I have the same problem!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405009473/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405061598","html_url":"https://github.com/apache/iceberg/pull/6470#issuecomment-1405061598","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6470","id":1405061598,"node_id":"IC_kwDOCW7NX85Tv4ne","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T14:11:45Z","updated_at":"2023-01-26T14:11:45Z","author_association":"MEMBER","body":"Does the streaming write have the ability to set the file format? Or does that only let you use the table default as well?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405061598/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405075260","html_url":"https://github.com/apache/iceberg/pull/6672#issuecomment-1405075260","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6672","id":1405075260,"node_id":"IC_kwDOCW7NX85Tv788","user":{"login":"Fokko","id":1134248,"node_id":"MDQ6VXNlcjExMzQyNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1134248?v=4","gravatar_id":"","url":"https://api.github.com/users/Fokko","html_url":"https://github.com/Fokko","followers_url":"https://api.github.com/users/Fokko/followers","following_url":"https://api.github.com/users/Fokko/following{/other_user}","gists_url":"https://api.github.com/users/Fokko/gists{/gist_id}","starred_url":"https://api.github.com/users/Fokko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Fokko/subscriptions","organizations_url":"https://api.github.com/users/Fokko/orgs","repos_url":"https://api.github.com/users/Fokko/repos","events_url":"https://api.github.com/users/Fokko/events{/privacy}","received_events_url":"https://api.github.com/users/Fokko/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T14:22:23Z","updated_at":"2023-01-26T14:22:23Z","author_association":"CONTRIBUTOR","body":"@snazy Out of curiosity, do you use the open api spec to directly generate code? In Python, we tried to do it as well, but the structure was too complex in the end, and we used the generated code as a start. For example, the types can be both a string (`timestamp`, `fixed[12]`, etc) and a JSON dictionary (`{\"type\": \"map\", ...}`).","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405075260/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405302607","html_url":"https://github.com/apache/iceberg/pull/6661#issuecomment-1405302607","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6661","id":1405302607,"node_id":"IC_kwDOCW7NX85TwzdP","user":{"login":"ajantha-bhat","id":5889404,"node_id":"MDQ6VXNlcjU4ODk0MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/5889404?v=4","gravatar_id":"","url":"https://api.github.com/users/ajantha-bhat","html_url":"https://github.com/ajantha-bhat","followers_url":"https://api.github.com/users/ajantha-bhat/followers","following_url":"https://api.github.com/users/ajantha-bhat/following{/other_user}","gists_url":"https://api.github.com/users/ajantha-bhat/gists{/gist_id}","starred_url":"https://api.github.com/users/ajantha-bhat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajantha-bhat/subscriptions","organizations_url":"https://api.github.com/users/ajantha-bhat/orgs","repos_url":"https://api.github.com/users/ajantha-bhat/repos","events_url":"https://api.github.com/users/ajantha-bhat/events{/privacy}","received_events_url":"https://api.github.com/users/ajantha-bhat/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T16:52:30Z","updated_at":"2023-01-26T16:52:30Z","author_association":"MEMBER","body":"cc: @szehon-ho, @RussellSpitzer, @rdblue, @flyrain    ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405302607/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405308124","html_url":"https://github.com/apache/iceberg/pull/6656#issuecomment-1405308124","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6656","id":1405308124,"node_id":"IC_kwDOCW7NX85Tw0zc","user":{"login":"ajantha-bhat","id":5889404,"node_id":"MDQ6VXNlcjU4ODk0MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/5889404?v=4","gravatar_id":"","url":"https://api.github.com/users/ajantha-bhat","html_url":"https://github.com/ajantha-bhat","followers_url":"https://api.github.com/users/ajantha-bhat/followers","following_url":"https://api.github.com/users/ajantha-bhat/following{/other_user}","gists_url":"https://api.github.com/users/ajantha-bhat/gists{/gist_id}","starred_url":"https://api.github.com/users/ajantha-bhat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajantha-bhat/subscriptions","organizations_url":"https://api.github.com/users/ajantha-bhat/orgs","repos_url":"https://api.github.com/users/ajantha-bhat/repos","events_url":"https://api.github.com/users/ajantha-bhat/events{/privacy}","received_events_url":"https://api.github.com/users/ajantha-bhat/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T16:56:40Z","updated_at":"2023-01-26T16:56:40Z","author_association":"MEMBER","body":"@dimas-b: Thanks for the review. @Fokko: Can you please help in reviewing and merging the PR?   ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405308124/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405377742","html_url":"https://github.com/apache/iceberg/pull/6664#issuecomment-1405377742","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6664","id":1405377742,"node_id":"IC_kwDOCW7NX85TxFzO","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T17:52:01Z","updated_at":"2023-01-26T17:52:01Z","author_association":"COLLABORATOR","body":"Merged, thanks @nastra  and @ajantha-bhat for review","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405377742/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405433121","html_url":"https://github.com/apache/iceberg/pull/6671#issuecomment-1405433121","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6671","id":1405433121,"node_id":"IC_kwDOCW7NX85TxTUh","user":{"login":"wypoon","id":3925490,"node_id":"MDQ6VXNlcjM5MjU0OTA=","avatar_url":"https://avatars.githubusercontent.com/u/3925490?v=4","gravatar_id":"","url":"https://api.github.com/users/wypoon","html_url":"https://github.com/wypoon","followers_url":"https://api.github.com/users/wypoon/followers","following_url":"https://api.github.com/users/wypoon/following{/other_user}","gists_url":"https://api.github.com/users/wypoon/gists{/gist_id}","starred_url":"https://api.github.com/users/wypoon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wypoon/subscriptions","organizations_url":"https://api.github.com/users/wypoon/orgs","repos_url":"https://api.github.com/users/wypoon/repos","events_url":"https://api.github.com/users/wypoon/events{/privacy}","received_events_url":"https://api.github.com/users/wypoon/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T18:35:13Z","updated_at":"2023-01-26T18:35:13Z","author_association":"CONTRIBUTOR","body":"Thanks @nastra and @Fokko.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405433121/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405560496","html_url":"https://github.com/apache/iceberg/issues/6667#issuecomment-1405560496","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6667","id":1405560496,"node_id":"IC_kwDOCW7NX85Txyaw","user":{"login":"GabeChurch","id":31358000,"node_id":"MDQ6VXNlcjMxMzU4MDAw","avatar_url":"https://avatars.githubusercontent.com/u/31358000?v=4","gravatar_id":"","url":"https://api.github.com/users/GabeChurch","html_url":"https://github.com/GabeChurch","followers_url":"https://api.github.com/users/GabeChurch/followers","following_url":"https://api.github.com/users/GabeChurch/following{/other_user}","gists_url":"https://api.github.com/users/GabeChurch/gists{/gist_id}","starred_url":"https://api.github.com/users/GabeChurch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/GabeChurch/subscriptions","organizations_url":"https://api.github.com/users/GabeChurch/orgs","repos_url":"https://api.github.com/users/GabeChurch/repos","events_url":"https://api.github.com/users/GabeChurch/events{/privacy}","received_events_url":"https://api.github.com/users/GabeChurch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T19:57:33Z","updated_at":"2023-01-27T02:55:41Z","author_association":"NONE","body":"Thanks for the quick response @pvary just saw that ticket last night as well! \r\n\r\nI actually created a benchmark in airflow, that runs 30 concurrent Spark jobs with 50 sequential writes (of 400GB) per job to fine tune settings and benchmark iceberg behavior on \"high frequency writes with Spark\". With a single job I am able to achieve 8mins for 50 (separate) sequential writes to the table. \r\n\r\nBased on the initial logs it was somewhat unclear to me that I could control commit retries to and hive locks were not actually the point of failure on commit.\r\n\r\n```[2023-01-24 23:20:39,050] {spark_submit.py:536} INFO - 23/01/24 23:20:39 WARN Tasks: Retrying task after failure: Waiting for lock on table performance_tests.parallel_test2\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - org.apache.iceberg.hive.HiveTableOperations$WaitingForLockException: Waiting for lock on table performance_tests.parallel_test2\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.hive.HiveTableOperations.lambda$acquireLock$10(HiveTableOperations.java:653)\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.util.Tasks$Builder.runTaskWithRetry(Tasks.java:413)\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.util.Tasks$Builder.runSingleThreaded(Tasks.java:219)\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.util.Tasks$Builder.run(Tasks.java:203)\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.hive.HiveTableOperations.acquireLock(HiveTableOperations.java:645)\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.hive.HiveTableOperations.doCommit(HiveTableOperations.java:266)\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.BaseMetastoreTableOperations.commit(BaseMetastoreTableOperations.java:135)\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.SnapshotProducer.lambda$commit$2(SnapshotProducer.java:391)\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.util.Tasks$Builder.runTaskWithRetry(Tasks.java:413)\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.util.Tasks$Builder.runSingleThreaded(Tasks.java:219)\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.util.Tasks$Builder.run(Tasks.java:203)\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.util.Tasks$Builder.run(Tasks.java:196)\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.SnapshotProducer.commit(SnapshotProducer.java:365)\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.spark.source.SparkWrite.commitOperation(SparkWrite.java:215)\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.spark.source.SparkWrite.access$1300(SparkWrite.java:97)\r\n[2023-01-24 23:20:39,051] {spark_submit.py:536} INFO - at org.apache.iceberg.spark.source.SparkWrite$BatchAppend.commit(SparkWrite.java:295)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.V2TableWriteExec.writeWithV2(WriteToDataSourceV2Exec.scala:392)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.V2TableWriteExec.writeWithV2$(WriteToDataSourceV2Exec.scala:353)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.AppendDataExec.writeWithV2(WriteToDataSourceV2Exec.scala:244)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.V2ExistingTableWriteExec.run(WriteToDataSourceV2Exec.scala:332)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.V2ExistingTableWriteExec.run$(WriteToDataSourceV2Exec.scala:331)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.AppendDataExec.run(WriteToDataSourceV2Exec.scala:244)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.V2CommandExec.result$lzycompute(V2CommandExec.scala:43)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.V2CommandExec.result(V2CommandExec.scala:43)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.V2CommandExec.executeCollect(V2CommandExec.scala:49)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.QueryExecution$$anonfun$eagerlyExecuteCommands$1.$anonfun$applyOrElse$1(QueryExecution.scala:98)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$6(SQLExecution.scala:109)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.SQLExecution$.withSQLConfPropagated(SQLExecution.scala:169)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$1(SQLExecution.scala:95)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:779)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.SQLExecution$.withNewExecutionId(SQLExecution.scala:64)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.QueryExecution$$anonfun$eagerlyExecuteCommands$1.applyOrElse(QueryExecution.scala:98)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.QueryExecution$$anonfun$eagerlyExecuteCommands$1.applyOrElse(QueryExecution.scala:94)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$transformDownWithPruning$1(TreeNode.scala:584)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.trees.CurrentOrigin$.withOrigin(TreeNode.scala:176)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.trees.TreeNode.transformDownWithPruning(TreeNode.scala:584)\r\n[2023-01-24 23:20:39,052] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.org$apache$spark$sql$catalyst$plans$logical$AnalysisHelper$$super$transformDownWithPruning(LogicalPlan.scala:30)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper.transformDownWithPruning(AnalysisHelper.scala:267)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper.transformDownWithPruning$(AnalysisHelper.scala:263)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.transformDownWithPruning(LogicalPlan.scala:30)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.transformDownWithPruning(LogicalPlan.scala:30)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.trees.TreeNode.transformDown(TreeNode.scala:560)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.QueryExecution.eagerlyExecuteCommands(QueryExecution.scala:94)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.QueryExecution.commandExecuted$lzycompute(QueryExecution.scala:81)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.QueryExecution.commandExecuted(QueryExecution.scala:79)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.QueryExecution.assertCommandExecuted(QueryExecution.scala:116)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at org.apache.spark.sql.DataFrameWriterV2.runCommand(DataFrameWriterV2.scala:195)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at org.apache.spark.sql.DataFrameWriterV2.append(DataFrameWriterV2.scala:149)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at py4j.Gateway.invoke(Gateway.java:282)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at py4j.commands.CallCommand.execute(CallCommand.java:79)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at py4j.ClientServerConnection.waitForCommands(ClientServerConnection.java:182)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at py4j.ClientServerConnection.run(ClientServerConnection.java:106)\r\n[2023-01-24 23:20:39,053] {spark_submit.py:536} INFO - at java.base/java.lang.Thread.run(Thread.java:829)\r\n[2023-01-24 23:20:44,859] {spark_submit.py:536} INFO - 23/01/24 23:20:44 ERROR AppendDataExec: Data source write support IcebergBatchWrite(table=iceberg.performance_tests.parallel_test2, format=ORC) is aborting.\r\n[2023-01-24 23:20:45,245] {spark_submit.py:536} INFO - 23/01/24 23:20:45 ERROR AppendDataExec: Data source write support IcebergBatchWrite(table=iceberg.performance_tests.parallel_test2, format=ORC) aborted.\r\n[2023-01-24 23:20:45,340] {spark_submit.py:536} INFO - Traceback (most recent call last):\r\n[2023-01-24 23:20:45,341] {spark_submit.py:536} INFO - File \"/tmp/spark-bd465075-431a-4b39-b40e-6aafefde4fd3/write_1hz_sample.py\", line 121, in <module>\r\n[2023-01-24 23:20:45,341] {spark_submit.py:536} INFO - raise e\r\n[2023-01-24 23:20:45,341] {spark_submit.py:536} INFO - File \"/tmp/spark-bd465075-431a-4b39-b40e-6aafefde4fd3/write_1hz_sample.py\", line 96, in <module>\r\n[2023-01-24 23:20:45,341] {spark_submit.py:536} INFO - sample_spark_df.sortWithinPartitions(col('timestamp'), col('group_id')).writeTo(hive_table) \\\r\n[2023-01-24 23:20:45,341] {spark_submit.py:536} INFO - File \"/opt/spark/python/pyspark/sql/readwriter.py\", line 1460, in append\r\n[2023-01-24 23:20:45,341] {spark_submit.py:536} INFO - self._jwriter.append()\r\n[2023-01-24 23:20:45,341] {spark_submit.py:536} INFO - File \"/opt/spark/python/lib/py4j-0.10.9.5-src.zip/py4j/java_gateway.py\", line 1321, in __call__\r\n[2023-01-24 23:20:45,341] {spark_submit.py:536} INFO - File \"/opt/spark/python/pyspark/sql/utils.py\", line 190, in deco\r\n[2023-01-24 23:20:45,341] {spark_submit.py:536} INFO - return f(*a, **kw)\r\n[2023-01-24 23:20:45,341] {spark_submit.py:536} INFO - File \"/opt/spark/python/lib/py4j-0.10.9.5-src.zip/py4j/protocol.py\", line 326, in get_return_value\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - py4j.protocol.Py4JJavaError: An error occurred while calling o100.append.\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - : org.apache.spark.SparkException: Writing job aborted\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.errors.QueryExecutionErrors$.writingJobAbortedError(QueryExecutionErrors.scala:767)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.V2TableWriteExec.writeWithV2(WriteToDataSourceV2Exec.scala:409)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.V2TableWriteExec.writeWithV2$(WriteToDataSourceV2Exec.scala:353)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.AppendDataExec.writeWithV2(WriteToDataSourceV2Exec.scala:244)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.V2ExistingTableWriteExec.run(WriteToDataSourceV2Exec.scala:332)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.V2ExistingTableWriteExec.run$(WriteToDataSourceV2Exec.scala:331)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.AppendDataExec.run(WriteToDataSourceV2Exec.scala:244)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.V2CommandExec.result$lzycompute(V2CommandExec.scala:43)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.V2CommandExec.result(V2CommandExec.scala:43)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.V2CommandExec.executeCollect(V2CommandExec.scala:49)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.QueryExecution$$anonfun$eagerlyExecuteCommands$1.$anonfun$applyOrElse$1(QueryExecution.scala:98)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$6(SQLExecution.scala:109)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.SQLExecution$.withSQLConfPropagated(SQLExecution.scala:169)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$1(SQLExecution.scala:95)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:779)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.SQLExecution$.withNewExecutionId(SQLExecution.scala:64)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.QueryExecution$$anonfun$eagerlyExecuteCommands$1.applyOrElse(QueryExecution.scala:98)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.QueryExecution$$anonfun$eagerlyExecuteCommands$1.applyOrElse(QueryExecution.scala:94)\r\n[2023-01-24 23:20:45,342] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.trees.TreeNode.$anonfun$transformDownWithPruning$1(TreeNode.scala:584)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.trees.CurrentOrigin$.withOrigin(TreeNode.scala:176)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.trees.TreeNode.transformDownWithPruning(TreeNode.scala:584)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.org$apache$spark$sql$catalyst$plans$logical$AnalysisHelper$$super$transformDownWithPruning(LogicalPlan.scala:30)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper.transformDownWithPruning(AnalysisHelper.scala:267)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.plans.logical.AnalysisHelper.transformDownWithPruning$(AnalysisHelper.scala:263)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.transformDownWithPruning(LogicalPlan.scala:30)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.plans.logical.LogicalPlan.transformDownWithPruning(LogicalPlan.scala:30)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at org.apache.spark.sql.catalyst.trees.TreeNode.transformDown(TreeNode.scala:560)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.QueryExecution.eagerlyExecuteCommands(QueryExecution.scala:94)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.QueryExecution.commandExecuted$lzycompute(QueryExecution.scala:81)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.QueryExecution.commandExecuted(QueryExecution.scala:79)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.QueryExecution.assertCommandExecuted(QueryExecution.scala:116)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at org.apache.spark.sql.DataFrameWriterV2.runCommand(DataFrameWriterV2.scala:195)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at org.apache.spark.sql.DataFrameWriterV2.append(DataFrameWriterV2.scala:149)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)\r\n[2023-01-24 23:20:45,343] {spark_submit.py:536} INFO - at py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at py4j.Gateway.invoke(Gateway.java:282)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at py4j.commands.CallCommand.execute(CallCommand.java:79)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at py4j.ClientServerConnection.waitForCommands(ClientServerConnection.java:182)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at py4j.ClientServerConnection.run(ClientServerConnection.java:106)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at java.base/java.lang.Thread.run(Thread.java:829)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - Caused by: org.apache.iceberg.exceptions.CommitFailedException: Base metadata location 's3a://iceberg_tests/orc_parallel_test2/metadata/00998-0dbd9354-f168-414a-9ac3-3281da97fdf7.metadata.json' is not same as the current table metadata location 's3a://iceberg_tests/orc_parallel_test2/metadata/00999-601e7061-e876-45ee-82ab-176bc1b9ade5.metadata.json' for performance_tests.parallel_test2\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at org.apache.iceberg.hive.HiveTableOperations.doCommit(HiveTableOperations.java:294)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at org.apache.iceberg.BaseMetastoreTableOperations.commit(BaseMetastoreTableOperations.java:135)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at org.apache.iceberg.SnapshotProducer.lambda$commit$2(SnapshotProducer.java:391)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at org.apache.iceberg.util.Tasks$Builder.runTaskWithRetry(Tasks.java:413)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at org.apache.iceberg.util.Tasks$Builder.runSingleThreaded(Tasks.java:219)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at org.apache.iceberg.util.Tasks$Builder.run(Tasks.java:203)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at org.apache.iceberg.util.Tasks$Builder.run(Tasks.java:196)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at org.apache.iceberg.SnapshotProducer.commit(SnapshotProducer.java:365)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at org.apache.iceberg.spark.source.SparkWrite.commitOperation(SparkWrite.java:215)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at org.apache.iceberg.spark.source.SparkWrite.access$1300(SparkWrite.java:97)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at org.apache.iceberg.spark.source.SparkWrite$BatchAppend.commit(SparkWrite.java:295)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - at org.apache.spark.sql.execution.datasources.v2.V2TableWriteExec.writeWithV2(WriteToDataSourceV2Exec.scala:392)\r\n[2023-01-24 23:20:45,344] {spark_submit.py:536} INFO - ... 43 more\r\n\r\n```\r\n\r\n\r\nI realized shortly after posting my original question that Hive locks weren't the only issue, but it appears what I saw was actually a combination of metadata changing between writes, locks being released, and commit retries failing after hitting the default failure limit of 4. I will probably make a simple M/R to extend org.apache.iceberg.exceptions.CommitFailedException that includes the number of retries so it is obvious when retry limit is hit -- making it more straightforward to find the quick-fix setting of commit.status-check.num-retries SEE [iceberg configuration](https://iceberg.apache.org/docs/latest/configuration/)\r\n\r\nFor anyone else seeing this or testing, if you have a high frequency write scenario you can increase the commit retries by modifying your existing table via an alter table statement, or including the property in initial create table statement. I personally use dataframe v2 for create and append.\r\n\r\n```python\r\nspark.sql('''\r\nALTER TABLE iceberg.performance_tests.parallel_test2 SET TBLPROPERTIES (\r\n  'commit.retry.num-retries'='200'\r\n)\r\n''').show()\r\n```\r\n\r\nThen make the commit.retry.num-retries change on append (or include it on the create table from the start) if you are using dataframe v2 write api\r\n```python   \r\nsample_spark_df.sortWithinPartitions(col('timestamp'), col('group_id')) \\\r\n                            .writeTo('iceberg.performance_tests.parallel_test2') \\\r\n                            .tableProperty('write.data.path', 's3a://iceberg_tests/orc_parallel_test2') \\\r\n                            .tableProperty('write.format.default', 'orc') \\\r\n                            .tableProperty('write.orc.compression-codec', 'zstd') \\\r\n                            .tableProperty('write.spark.fanout.enabled', 'True') \\\r\n                            .tableProperty('write.target-file-size-bytes', '268435456') \\\r\n                            .tableProperty('commit.retry.num-retries', '200') \\\r\n                            .partitionedBy(days(col('timestamp')), col('group_id')) \\\r\n                            .create()\r\n```                            \r\n\r\nUltimately I was able to ensure success 100% of the time with 30x50 (1500 table-write/commit test) but my insert times per 50 tables did drop from single job (50 sequential writes) from 8mins to roughly 45mins when launching all 30 job attempts in parallel. I would love any additional recommendations on improving high-frequency write performance, but do understand there is a tradeoff required in this respect, to achieve ACID compliance and maintain snapshot-insert order. \r\n\r\nIt does still seem to me that hive locking can be improved significantly and I will closely follow [2547](https://github.com/apache/iceberg/pull/2547)\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405560496/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405646669","html_url":"https://github.com/apache/iceberg/pull/6660#issuecomment-1405646669","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6660","id":1405646669,"node_id":"IC_kwDOCW7NX85TyHdN","user":{"login":"amogh-jahagirdar","id":87500546,"node_id":"MDQ6VXNlcjg3NTAwNTQ2","avatar_url":"https://avatars.githubusercontent.com/u/87500546?v=4","gravatar_id":"","url":"https://api.github.com/users/amogh-jahagirdar","html_url":"https://github.com/amogh-jahagirdar","followers_url":"https://api.github.com/users/amogh-jahagirdar/followers","following_url":"https://api.github.com/users/amogh-jahagirdar/following{/other_user}","gists_url":"https://api.github.com/users/amogh-jahagirdar/gists{/gist_id}","starred_url":"https://api.github.com/users/amogh-jahagirdar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amogh-jahagirdar/subscriptions","organizations_url":"https://api.github.com/users/amogh-jahagirdar/orgs","repos_url":"https://api.github.com/users/amogh-jahagirdar/repos","events_url":"https://api.github.com/users/amogh-jahagirdar/events{/privacy}","received_events_url":"https://api.github.com/users/amogh-jahagirdar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T21:02:24Z","updated_at":"2023-01-26T21:02:24Z","author_association":"CONTRIBUTOR","body":"> Thanks for the PR @amogh-jahagirdar! Left one small question.\r\n> \r\n> Also, do we have this feature in FlinkSource?\r\n\r\nThanks for the review @pvary ! Not yet, but I'm working on a PR for it, will publish when it's ready .","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405646669/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405777734","html_url":"https://github.com/apache/iceberg/issues/6652#issuecomment-1405777734","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6652","id":1405777734,"node_id":"IC_kwDOCW7NX85TyndG","user":{"login":"amogh-jahagirdar","id":87500546,"node_id":"MDQ6VXNlcjg3NTAwNTQ2","avatar_url":"https://avatars.githubusercontent.com/u/87500546?v=4","gravatar_id":"","url":"https://api.github.com/users/amogh-jahagirdar","html_url":"https://github.com/amogh-jahagirdar","followers_url":"https://api.github.com/users/amogh-jahagirdar/followers","following_url":"https://api.github.com/users/amogh-jahagirdar/following{/other_user}","gists_url":"https://api.github.com/users/amogh-jahagirdar/gists{/gist_id}","starred_url":"https://api.github.com/users/amogh-jahagirdar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amogh-jahagirdar/subscriptions","organizations_url":"https://api.github.com/users/amogh-jahagirdar/orgs","repos_url":"https://api.github.com/users/amogh-jahagirdar/repos","events_url":"https://api.github.com/users/amogh-jahagirdar/events{/privacy}","received_events_url":"https://api.github.com/users/amogh-jahagirdar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T22:52:47Z","updated_at":"2023-01-26T22:52:47Z","author_association":"CONTRIBUTOR","body":"Yeah +1 to what @RussellSpitzer mentioned, we've recently added support for writes to branches in Iceberg itself and if I understand your use case correctly that's actually a perfect application of branching. I'm working on a separate page in documentation for branching and tagging, after I publish the initial PR I'll add you @holdenk for review and you can also help confirm if branching would help facilitate your use case? ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405777734/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405779103","html_url":"https://github.com/apache/iceberg/issues/6652#issuecomment-1405779103","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6652","id":1405779103,"node_id":"IC_kwDOCW7NX85Tynyf","user":{"login":"holdenk","id":59893,"node_id":"MDQ6VXNlcjU5ODkz","avatar_url":"https://avatars.githubusercontent.com/u/59893?v=4","gravatar_id":"","url":"https://api.github.com/users/holdenk","html_url":"https://github.com/holdenk","followers_url":"https://api.github.com/users/holdenk/followers","following_url":"https://api.github.com/users/holdenk/following{/other_user}","gists_url":"https://api.github.com/users/holdenk/gists{/gist_id}","starred_url":"https://api.github.com/users/holdenk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/holdenk/subscriptions","organizations_url":"https://api.github.com/users/holdenk/orgs","repos_url":"https://api.github.com/users/holdenk/repos","events_url":"https://api.github.com/users/holdenk/events{/privacy}","received_events_url":"https://api.github.com/users/holdenk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T22:54:32Z","updated_at":"2023-01-26T22:54:32Z","author_association":"CONTRIBUTOR","body":"Awesome thanks @amogh-jahagirdar :) ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405779103/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405811455","html_url":"https://github.com/apache/iceberg/issues/6619#issuecomment-1405811455","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6619","id":1405811455,"node_id":"IC_kwDOCW7NX85Tyvr_","user":{"login":"amogh-jahagirdar","id":87500546,"node_id":"MDQ6VXNlcjg3NTAwNTQ2","avatar_url":"https://avatars.githubusercontent.com/u/87500546?v=4","gravatar_id":"","url":"https://api.github.com/users/amogh-jahagirdar","html_url":"https://github.com/amogh-jahagirdar","followers_url":"https://api.github.com/users/amogh-jahagirdar/followers","following_url":"https://api.github.com/users/amogh-jahagirdar/following{/other_user}","gists_url":"https://api.github.com/users/amogh-jahagirdar/gists{/gist_id}","starred_url":"https://api.github.com/users/amogh-jahagirdar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amogh-jahagirdar/subscriptions","organizations_url":"https://api.github.com/users/amogh-jahagirdar/orgs","repos_url":"https://api.github.com/users/amogh-jahagirdar/repos","events_url":"https://api.github.com/users/amogh-jahagirdar/events{/privacy}","received_events_url":"https://api.github.com/users/amogh-jahagirdar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-26T23:30:36Z","updated_at":"2023-01-26T23:31:24Z","author_association":"CONTRIBUTOR","body":"> Is there something with a metadata pointer or something if this occurs?\r\n\r\nYes, so Athena's integration with Iceberg uses the Glue Catalog. Every write done by Athena on the Iceberg table (in this case your inserts) is optimistically writing out the metadata file and then updating the metadata_location property on the Glue table as part of the commit. \r\n\r\nWhen you drop an Iceberg table in Athena as you observed, Athena does delete the S3 files and drop the glue table (meaning now the pointer to the metadata location is lost). When you re-create the table after restoring the backup, a new glue table is created with a new metadata pointer (effectively an empty table state). \r\n\r\nSo after re-creating the table and restoring your data what you can do is update the metadata_location table property in Glue to point to the latest metadata location prior to dropping the table. After that you should be able to read the data as before. I was able to repro this process in my account, but please let me know if you run into any issues! \r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405811455/reactions","total_count":5,"+1":5,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405841673","html_url":"https://github.com/apache/iceberg/issues/5371#issuecomment-1405841673","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5371","id":1405841673,"node_id":"IC_kwDOCW7NX85Ty3EJ","user":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T00:11:48Z","updated_at":"2023-01-27T00:11:48Z","author_association":"NONE","body":"This issue has been automatically marked as stale because it has been open for 180 days with no activity. It will be closed in next 14 days if no further activity occurs. To permanently prevent this issue from being considered stale, add the label 'not-stale', but commenting on the issue is preferred when possible.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405841673/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405841743","html_url":"https://github.com/apache/iceberg/issues/5216#issuecomment-1405841743","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5216","id":1405841743,"node_id":"IC_kwDOCW7NX85Ty3FP","user":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T00:11:52Z","updated_at":"2023-01-27T00:11:52Z","author_association":"NONE","body":"This issue has been automatically marked as stale because it has been open for 180 days with no activity. It will be closed in next 14 days if no further activity occurs. To permanently prevent this issue from being considered stale, add the label 'not-stale', but commenting on the issue is preferred when possible.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405841743/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405849535","html_url":"https://github.com/apache/iceberg/pull/6673#issuecomment-1405849535","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6673","id":1405849535,"node_id":"IC_kwDOCW7NX85Ty4-_","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T00:21:03Z","updated_at":"2023-01-27T00:21:03Z","author_association":"CONTRIBUTOR","body":"Looks good to me when tests are passing!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405849535/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405863016","html_url":"https://github.com/apache/iceberg/issues/6670#issuecomment-1405863016","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6670","id":1405863016,"node_id":"IC_kwDOCW7NX85Ty8Ro","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T00:38:02Z","updated_at":"2023-01-27T00:41:16Z","author_association":"COLLABORATOR","body":"After a long debugging session with @RussellSpitzer and @dramaticlly , we think hashcode is the first part of the problem.  \r\n\r\nThe rest of the problem is that equals() is broken as well for all keys, and hashcode was the only thing keeping the map working.\r\n\r\n*Analysis*\r\nFile entries are read from ManifestReader, which uses AvroIterable with reuseContainer.  Which means as you advance the iterator, the previous elements get set to the current one.  Ref:  https://github.com/apache/iceberg/blob/1.0.x/core/src/main/java/org/apache/iceberg/ManifestReader.java#L227  So the keys in the StructLikeMap's map become all equal to each other!\r\n\r\nie.\r\nMap (partition=2022728, value = blah),  (partition=2022728, value = blah2),  (partition=2022728, value = blah3), when they all started with different partition values.\r\n\r\nSo in fact, equals() has always been broken in this map for keys.  The only thing keeping the map semi-working was hashcode, because java map first checks hashcode equality before object equality.  And in this case, hashcode finally collided.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405863016/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405863632","html_url":"https://github.com/apache/iceberg/issues/6670#issuecomment-1405863632","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6670","id":1405863632,"node_id":"IC_kwDOCW7NX85Ty8bQ","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T00:38:52Z","updated_at":"2023-01-27T00:40:14Z","author_association":"COLLABORATOR","body":"A test that demonstrates this (a bit longer , that uses ManifestReader/Writer).  It demonstrates that trying to use values read from ManifestReader in a StructLikeMap does not work:\r\n\r\n```\r\n  @Test\r\n  public void testBug() throws IOException {\r\n    Schema schema = new Schema(\r\n            required(1, \"a\", Types.IntegerType.get()), required(2, \"b\", Types.IntegerType.get()));\r\n\r\n    PartitionSpec spec =\r\n        PartitionSpec.builderFor(schema).identity(\"a\").identity(\"b\").build();\r\n\r\n    StructLikeMap map = StructLikeMap.create(spec.partitionType());\r\n\r\n    PartitionData data1 = new PartitionData(spec.partitionType());\r\n    data1.set(0, 20220726);\r\n    data1.set(1, 20220801);\r\n\r\n    PartitionData data2 = new PartitionData(spec.partitionType());\r\n    data2.set(0, 20220728);\r\n    data2.set(1, 20220719);\r\n\r\n    DataFile file1 =\r\n        DataFiles.builder(spec)\r\n            .withPath(\"/path/to/data-1.parquet\")\r\n            .withFileSizeInBytes(10)\r\n            .withPartition(data1)\r\n            .withRecordCount(1)\r\n            .build();\r\n\r\n    DataFile file2 =\r\n        DataFiles.builder(spec)\r\n            .withPath(\"/path/to/data-2.parquet\")\r\n            .withFileSizeInBytes(10)\r\n            .withPartition(data2)\r\n            .withRecordCount(1)\r\n            .build();\r\n\r\n    ManifestFile manifest =\r\n        writeManifestTest(\r\n            1000L,\r\n            spec,\r\n            \"foo.avro\",\r\n            manifestEntry(Status.ADDED, null, file1),\r\n            manifestEntry(Status.ADDED, null, file2));\r\n\r\n    AtomicInteger integer = new AtomicInteger();\r\n    try (ManifestReader<DataFile> reader =\r\n             ManifestFiles.read(manifest, new HadoopFileIO(new Configuration()))) {\r\n      try (CloseableIterable<ManifestEntry<DataFile>> entries = reader.entries()) {\r\n        try (CloseableIterator<ManifestEntry<DataFile>> iterator = entries.iterator()) {\r\n          while (iterator.hasNext()) {\r\n            ManifestEntry<DataFile> next = iterator.next();\r\n            map.computeIfAbsent(next.file().partition(), a -> integer.incrementAndGet());\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    Assert.assertEquals(2, map.get(data2));  // fails, returns 1\r\n    Assert.assertEquals(1, map.get(data1));\r\n  }\r\n\r\n  private <F extends ContentFile<F>> ManifestFile writeManifestTest(\r\n      Long snapshotId, PartitionSpec spec, String fileName, ManifestEntry<?>... entries) throws IOException {\r\n    File manifestFile = temp.newFile(fileName);\r\n    Assert.assertTrue(manifestFile.delete());\r\n    OutputFile outputFile = HadoopOutputFile.fromPath(new Path(manifestFile.getCanonicalPath()), FileSystem.get(new Configuration()));\r\n\r\n    ManifestWriter<F> writer;\r\n    writer =\r\n          (ManifestWriter<F>)\r\n              ManifestFiles.write(1, spec, outputFile, snapshotId);\r\n\r\n    try {\r\n      for (ManifestEntry<?> entry : entries) {\r\n        writer.addEntry((ManifestEntry<F>) entry);\r\n      }\r\n    } finally {\r\n      writer.close();\r\n    }\r\n\r\n    return writer.toManifestFile();\r\n  }\r\n```\r\n\r\nThis emulates what the code does in ResidualEvaluator cache.  An end to end test will still be great though to reproduce this problem.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405863632/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405866433","html_url":"https://github.com/apache/iceberg/issues/6670#issuecomment-1405866433","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6670","id":1405866433,"node_id":"IC_kwDOCW7NX85Ty9HB","user":{"login":"dramaticlly","id":5961173,"node_id":"MDQ6VXNlcjU5NjExNzM=","avatar_url":"https://avatars.githubusercontent.com/u/5961173?v=4","gravatar_id":"","url":"https://api.github.com/users/dramaticlly","html_url":"https://github.com/dramaticlly","followers_url":"https://api.github.com/users/dramaticlly/followers","following_url":"https://api.github.com/users/dramaticlly/following{/other_user}","gists_url":"https://api.github.com/users/dramaticlly/gists{/gist_id}","starred_url":"https://api.github.com/users/dramaticlly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dramaticlly/subscriptions","organizations_url":"https://api.github.com/users/dramaticlly/orgs","repos_url":"https://api.github.com/users/dramaticlly/repos","events_url":"https://api.github.com/users/dramaticlly/events{/privacy}","received_events_url":"https://api.github.com/users/dramaticlly/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T00:42:40Z","updated_at":"2023-01-27T01:17:04Z","author_association":"CONTRIBUTOR","body":"Sharing some screenshots I took during the debug session to help with situation.\r\n\r\nThe object with same equality but different hashcode is basically against java contract\r\n> where object equal to each other shall have the same hashcode but not vice versa\r\n\r\n### Why do we ends up with same equality but different hashcode?\r\nI think as Szehon mentioned above, due to how we reuse container in avroReader, the key in metricsEvaluators is of type `StructLikeWrapper` and it might be holding the reference to partition data when reading instead of actual value, and hashcode of StructLikeWrapper is setup in a way to [purposefully leave hashcode as null](https://github.com/apache/iceberg/blob/master/core/src/main/java/org/apache/iceberg/util/StructLikeWrapper.java#L62-L66) so it can reference the inner struct\r\n\r\n## Equality \r\n<img width=\"968\" alt=\"equality\" src=\"https://user-images.githubusercontent.com/5961173/214981735-7ca3f4ed-48e6-41f2-835c-1649d2afa2bf.png\">\r\n\r\n## Hashcode\r\n<img width=\"903\" alt=\"hashcode\" src=\"https://user-images.githubusercontent.com/5961173/214981768-726e7114-a0d6-44d5-96c7-7a968c277bd9.png\">\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405866433/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405952964","html_url":"https://github.com/apache/iceberg/issues/6670#issuecomment-1405952964","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6670","id":1405952964,"node_id":"IC_kwDOCW7NX85TzSPE","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T02:51:02Z","updated_at":"2023-01-27T02:51:20Z","author_association":"MEMBER","body":"I think i forgot at the time but we want to see x.getKey().hash code although I'm pretty confident they will all be different values.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1405952964/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406133195","html_url":"https://github.com/apache/iceberg/pull/6672#issuecomment-1406133195","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6672","id":1406133195,"node_id":"IC_kwDOCW7NX85Tz-PL","user":{"login":"snazy","id":957468,"node_id":"MDQ6VXNlcjk1NzQ2OA==","avatar_url":"https://avatars.githubusercontent.com/u/957468?v=4","gravatar_id":"","url":"https://api.github.com/users/snazy","html_url":"https://github.com/snazy","followers_url":"https://api.github.com/users/snazy/followers","following_url":"https://api.github.com/users/snazy/following{/other_user}","gists_url":"https://api.github.com/users/snazy/gists{/gist_id}","starred_url":"https://api.github.com/users/snazy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/snazy/subscriptions","organizations_url":"https://api.github.com/users/snazy/orgs","repos_url":"https://api.github.com/users/snazy/repos","events_url":"https://api.github.com/users/snazy/events{/privacy}","received_events_url":"https://api.github.com/users/snazy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T07:46:13Z","updated_at":"2023-01-27T07:46:13Z","author_association":"MEMBER","body":"I think it's useful for two purposes:\r\n1. to have the spec together with the code, to know how the spec for the code look(ed|s) like\r\n2. to be able to generate some code - at least as a starter\r\n\r\nTypes are \"an issue\", yes. Not sure how much it would affect generated code in general  / across all languages. Jackson for example handles a \"generic `JsonNode`\" (which can be \"anything\") perfectly fine - I imagine that it would work similar for a \"generic `j.l.Object`\".","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406133195/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406227312","html_url":"https://github.com/apache/iceberg/pull/6673#issuecomment-1406227312","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6673","id":1406227312,"node_id":"IC_kwDOCW7NX85T0VNw","user":{"login":"Fokko","id":1134248,"node_id":"MDQ6VXNlcjExMzQyNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1134248?v=4","gravatar_id":"","url":"https://api.github.com/users/Fokko","html_url":"https://github.com/Fokko","followers_url":"https://api.github.com/users/Fokko/followers","following_url":"https://api.github.com/users/Fokko/following{/other_user}","gists_url":"https://api.github.com/users/Fokko/gists{/gist_id}","starred_url":"https://api.github.com/users/Fokko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Fokko/subscriptions","organizations_url":"https://api.github.com/users/Fokko/orgs","repos_url":"https://api.github.com/users/Fokko/repos","events_url":"https://api.github.com/users/Fokko/events{/privacy}","received_events_url":"https://api.github.com/users/Fokko/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T09:18:44Z","updated_at":"2023-01-27T09:18:44Z","author_association":"CONTRIBUTOR","body":"@rdblue thanks for the review. This one is blocked by https://github.com/apache/iceberg/pull/6566","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406227312/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406383940","html_url":"https://github.com/apache/iceberg/issues/6675#issuecomment-1406383940","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6675","id":1406383940,"node_id":"IC_kwDOCW7NX85T07dE","user":{"login":"ajantha-bhat","id":5889404,"node_id":"MDQ6VXNlcjU4ODk0MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/5889404?v=4","gravatar_id":"","url":"https://api.github.com/users/ajantha-bhat","html_url":"https://github.com/ajantha-bhat","followers_url":"https://api.github.com/users/ajantha-bhat/followers","following_url":"https://api.github.com/users/ajantha-bhat/following{/other_user}","gists_url":"https://api.github.com/users/ajantha-bhat/gists{/gist_id}","starred_url":"https://api.github.com/users/ajantha-bhat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajantha-bhat/subscriptions","organizations_url":"https://api.github.com/users/ajantha-bhat/orgs","repos_url":"https://api.github.com/users/ajantha-bhat/repos","events_url":"https://api.github.com/users/ajantha-bhat/events{/privacy}","received_events_url":"https://api.github.com/users/ajantha-bhat/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T11:42:54Z","updated_at":"2023-01-27T11:42:54Z","author_association":"MEMBER","body":"Sounds reasonable to me. I will take a look at the PR today. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406383940/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406394129","html_url":"https://github.com/apache/iceberg/pull/6676#issuecomment-1406394129","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6676","id":1406394129,"node_id":"IC_kwDOCW7NX85T098R","user":{"login":"ajantha-bhat","id":5889404,"node_id":"MDQ6VXNlcjU4ODk0MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/5889404?v=4","gravatar_id":"","url":"https://api.github.com/users/ajantha-bhat","html_url":"https://github.com/ajantha-bhat","followers_url":"https://api.github.com/users/ajantha-bhat/followers","following_url":"https://api.github.com/users/ajantha-bhat/following{/other_user}","gists_url":"https://api.github.com/users/ajantha-bhat/gists{/gist_id}","starred_url":"https://api.github.com/users/ajantha-bhat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajantha-bhat/subscriptions","organizations_url":"https://api.github.com/users/ajantha-bhat/orgs","repos_url":"https://api.github.com/users/ajantha-bhat/repos","events_url":"https://api.github.com/users/ajantha-bhat/events{/privacy}","received_events_url":"https://api.github.com/users/ajantha-bhat/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T11:53:40Z","updated_at":"2023-01-27T11:53:40Z","author_association":"MEMBER","body":"cc: @snazy, @dimas-b  ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406394129/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406486421","html_url":"https://github.com/apache/iceberg/pull/6678#issuecomment-1406486421","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6678","id":1406486421,"node_id":"IC_kwDOCW7NX85T1UeV","user":{"login":"ajantha-bhat","id":5889404,"node_id":"MDQ6VXNlcjU4ODk0MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/5889404?v=4","gravatar_id":"","url":"https://api.github.com/users/ajantha-bhat","html_url":"https://github.com/ajantha-bhat","followers_url":"https://api.github.com/users/ajantha-bhat/followers","following_url":"https://api.github.com/users/ajantha-bhat/following{/other_user}","gists_url":"https://api.github.com/users/ajantha-bhat/gists{/gist_id}","starred_url":"https://api.github.com/users/ajantha-bhat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajantha-bhat/subscriptions","organizations_url":"https://api.github.com/users/ajantha-bhat/orgs","repos_url":"https://api.github.com/users/ajantha-bhat/repos","events_url":"https://api.github.com/users/ajantha-bhat/events{/privacy}","received_events_url":"https://api.github.com/users/ajantha-bhat/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T13:06:15Z","updated_at":"2023-01-27T13:06:15Z","author_association":"MEMBER","body":"cc: @nastra, @Fokko  ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406486421/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406510853","html_url":"https://github.com/apache/iceberg/issues/6670#issuecomment-1406510853","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6670","id":1406510853,"node_id":"IC_kwDOCW7NX85T1acF","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T13:28:12Z","updated_at":"2023-01-27T13:28:12Z","author_association":"MEMBER","body":"OK So TLDR from my point of view:\r\n\r\nRe-used Containers causes the file.partition() object to be the same on every invocation of computeIfAbsent\r\nWhen putting the object the hashcode is used internally to determine the bucket the struct goes in\r\nThe partition object is placed in the bucket\r\nThe partition object is then changed by the avro reader for the next manifest entry\r\nThe previously placed object is in the correct bucket, but now has a different value than it originally had\r\nWhen we request an object that is in a bucket that has already been filled we pull out the same object we are checking for\r\n\r\n```\r\n1. Put PartitionData@1(X,Y) into Map\r\n\r\nBucketForXY[PartitionData@1(X, Y)]\r\n\r\n2. Read new value (A,B) and set in PartitionData@1\r\n3. Check for PartitionData@1(A, B) in Map\r\n\r\nif HashCode(A,B) == HashCode(X,Y)\r\n   Return BucketForXY(PartitionData@1(A,B) // Since this is the same in memory Partition Data Object it has the newly read value\r\nelse \r\n   return not found\r\n   ```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406510853/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406595180","html_url":"https://github.com/apache/iceberg/issues/6670#issuecomment-1406595180","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6670","id":1406595180,"node_id":"IC_kwDOCW7NX85T1vBs","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T14:41:49Z","updated_at":"2023-01-27T14:44:38Z","author_association":"MEMBER","body":"Repo using just Spark SQL, two key points\r\n\r\n1. There needs to be a conflict of hashcodes\r\n2. The two files with the conflicting hashcode partitiondata MUST be in the same manifest\r\n3. They must have different behaviors for the delete condition and the \"non delete\" must come first\r\n```java\r\n  @Test\r\n  public void testBug() throws IOException, NoSuchTableException, ParseException {\r\n    String myTable = tableName;\r\n    sql(\"CREATE TABLE %s (log_dateint int, request_dateint int) USING iceberg \"\r\n            + \"PARTITIONED BY (log_dateint, request_dateint)\",\r\n        tableName);\r\n\r\n    Table table = Spark3Util.loadIcebergTable(spark, tableName);\r\n    PartitionData partition_one = new PartitionData(table.spec().partitionType());\r\n    partition_one.set(0, 20220730);\r\n    partition_one.set(1, 20220721);\r\n    PartitionData partition_two = new PartitionData(table.spec().partitionType());\r\n    partition_two.set(0, 20220728);\r\n    partition_two.set(1, 20220803);\r\n\r\n    Assert.assertEquals(\r\n            StructLikeWrapper.forType(table.spec().partitionType()).set(partition_one).hashCode(),\r\n            StructLikeWrapper.forType(table.spec().partitionType()).set(partition_two).hashCode());\r\n\r\n    Dataset<Row> df = spark.createDataset(ImmutableList.of(\r\n                    Tuple2.apply((int) partition_one.get(0), (int) partition_one.get(1)),\r\n                    Tuple2.apply((int) partition_two.get(0), (int) partition_two.get(1))),\r\n            Encoders.tuple(Encoders.INT(), Encoders.INT())).toDF(\"log_dateint\", \"request_dateint\");\r\n\r\n    df.writeTo(tableName).append();\r\n\r\n    Assert.assertEquals(1, sql(\"SELECT * FROM %s WHERE request_dateint == 20220803\", tableName).size());\r\n    Assert.assertEquals(1, sql(\"SELECT * FROM %s WHERE request_dateint == 20220721\", tableName).size());\r\n\r\n    sql(\"DELETE FROM %s WHERE request_dateint == 20220803\", tableName);\r\n    Assert.assertEquals(0, sql(\"SELECT * FROM %s WHERE request_dateint == 20220803\", tableName).size());\r\n    Assert.assertEquals(1, sql(\"SELECT * FROM %s WHERE request_dateint == 20220721\", tableName).size());\r\n    }\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406595180/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406702289","html_url":"https://github.com/apache/iceberg/issues/6679#issuecomment-1406702289","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6679","id":1406702289,"node_id":"IC_kwDOCW7NX85T2JLR","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T16:04:56Z","updated_at":"2023-01-27T16:05:04Z","author_association":"MEMBER","body":"@aokolnychyi + @danielcweeks + @rdblue + @jackye1995 + @szehon-ho \r\n\r\nPlease ping anyone else as well who would have strong opinions about this change as well","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406702289/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406772042","html_url":"https://github.com/apache/iceberg/issues/6670#issuecomment-1406772042","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6670","id":1406772042,"node_id":"IC_kwDOCW7NX85T2aNK","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T16:49:45Z","updated_at":"2023-01-27T16:49:45Z","author_association":"MEMBER","body":"Another high level repo using a String Collision\r\n```java\r\n  @Test\r\n  public void testDeleteWithCollision() {\r\n    Schema schema = new Schema(Types.NestedField.of(0, false, \"x\", Types.StringType.get()));\r\n    PartitionSpec spec = PartitionSpec.builderFor(schema).identity(\"x\").build();\r\n    Table collisionTable =\r\n        TestTables.create(tableDir, \"hashcollision\", schema, spec, formatVersion);\r\n\r\n    PartitionData partitionOne = new PartitionData(spec.partitionType());\r\n    partitionOne.set(0, \"Aa\");\r\n    PartitionData partitionTwo = new PartitionData(spec.partitionType());\r\n    partitionTwo.set(0, \"BB\");\r\n\r\n    Assert.assertEquals(\r\n        StructLikeWrapper.forType(spec.partitionType()).set(partitionOne).hashCode(),\r\n        StructLikeWrapper.forType(spec.partitionType()).set(partitionTwo).hashCode());\r\n\r\n    Metrics metrics = new Metrics(1L, null, null, null, null);\r\n\r\n    DataFile testFileOne =\r\n        DataFiles.builder(spec)\r\n            .withPartition(partitionOne)\r\n            .withPath(\"/g1.parquet\")\r\n            .withFileSizeInBytes(100)\r\n            .withMetrics(metrics)\r\n            .build();\r\n    DataFile testFileTwo =\r\n        DataFiles.builder(spec)\r\n            .withPartition(partitionTwo)\r\n            .withMetrics(metrics)\r\n            .withFileSizeInBytes(100)\r\n            .withPath(\"/g2.parquet\")\r\n            .build();\r\n\r\n    collisionTable.newFastAppend().appendFile(testFileOne).appendFile(testFileTwo).commit();\r\n\r\n    Assert.assertEquals(\r\n        \"We should have two files\",\r\n        2,\r\n        Lists.newArrayList(collisionTable.newScan().planFiles().iterator()).size());\r\n\r\n    collisionTable.newDelete().deleteFromRowFilter(Expressions.equal(\"x\", \"BB\")).commit();\r\n\r\n    Assert.assertEquals(\r\n        \"We should have deleted one of them\",\r\n        1,\r\n        Lists.newArrayList(collisionTable.newScan().planFiles().iterator()).size());\r\n  }\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406772042/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406924909","html_url":"https://github.com/apache/iceberg/issues/6679#issuecomment-1406924909","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6679","id":1406924909,"node_id":"IC_kwDOCW7NX85T2_ht","user":{"login":"dramaticlly","id":5961173,"node_id":"MDQ6VXNlcjU5NjExNzM=","avatar_url":"https://avatars.githubusercontent.com/u/5961173?v=4","gravatar_id":"","url":"https://api.github.com/users/dramaticlly","html_url":"https://github.com/dramaticlly","followers_url":"https://api.github.com/users/dramaticlly/followers","following_url":"https://api.github.com/users/dramaticlly/following{/other_user}","gists_url":"https://api.github.com/users/dramaticlly/gists{/gist_id}","starred_url":"https://api.github.com/users/dramaticlly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dramaticlly/subscriptions","organizations_url":"https://api.github.com/users/dramaticlly/orgs","repos_url":"https://api.github.com/users/dramaticlly/repos","events_url":"https://api.github.com/users/dramaticlly/events{/privacy}","received_events_url":"https://api.github.com/users/dramaticlly/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T18:32:35Z","updated_at":"2023-01-27T18:32:35Z","author_association":"CONTRIBUTOR","body":"Thank you @RussellSpitzer , I understand where this change is coming from but some of the GDPR like deletion on V1 table will benefit from the none write distribution mode (to avoid shuffle if possible). I am aware currently we can configure it via setting the table properties like `write.delete.distribution-mode\t` or `write.update.distribution-mode`, but I am wondering if there's any way we can configure it on per spark job level (also delete is done via SQL only which only makes it harder)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406924909/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406926423","html_url":"https://github.com/apache/iceberg/issues/6679#issuecomment-1406926423","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6679","id":1406926423,"node_id":"IC_kwDOCW7NX85T2_5X","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T18:34:12Z","updated_at":"2023-01-27T18:34:12Z","author_association":"MEMBER","body":"The \"none\" mode in GDPR cases still only helps in case in which the data has already been aligned with the partitioning of the table. This is rarely the case in my experience. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406926423/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406959020","html_url":"https://github.com/apache/iceberg/pull/6680#issuecomment-1406959020","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6680","id":1406959020,"node_id":"IC_kwDOCW7NX85T3H2s","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T19:09:14Z","updated_at":"2023-01-27T19:09:14Z","author_association":"MEMBER","body":"@aokolnychyi + @dramaticlly @szehon-ho ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1406959020/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407070649","html_url":"https://github.com/apache/iceberg/pull/6674#issuecomment-1407070649","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6674","id":1407070649,"node_id":"IC_kwDOCW7NX85T3jG5","user":{"login":"manisin","id":21346391,"node_id":"MDQ6VXNlcjIxMzQ2Mzkx","avatar_url":"https://avatars.githubusercontent.com/u/21346391?v=4","gravatar_id":"","url":"https://api.github.com/users/manisin","html_url":"https://github.com/manisin","followers_url":"https://api.github.com/users/manisin/followers","following_url":"https://api.github.com/users/manisin/following{/other_user}","gists_url":"https://api.github.com/users/manisin/gists{/gist_id}","starred_url":"https://api.github.com/users/manisin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/manisin/subscriptions","organizations_url":"https://api.github.com/users/manisin/orgs","repos_url":"https://api.github.com/users/manisin/repos","events_url":"https://api.github.com/users/manisin/events{/privacy}","received_events_url":"https://api.github.com/users/manisin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T21:01:56Z","updated_at":"2023-01-30T19:50:53Z","author_association":"CONTRIBUTOR","body":"> the changes mostly LGTM, but it's unclear why we're removing tests with special characters.\r\n\r\n\r\nThanks for the review @nastra ! The test with special characters are removed as I also removed the code for custom handling of the special characters. The special characters have be escaped/quoted correctly according to spark/snowflake documentation by the user and they would be passed through the catalog library to snowflake without any modification.\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407070649/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407074738","html_url":"https://github.com/apache/iceberg/issues/6679#issuecomment-1407074738","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6679","id":1407074738,"node_id":"IC_kwDOCW7NX85T3kGy","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T21:06:26Z","updated_at":"2023-01-27T21:06:26Z","author_association":"CONTRIBUTOR","body":"+1 for using range as default. Overall we probably need a dedicated doc section about how to configure those parameters in the Iceberg Spark documentation for people to make informed decisions.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407074738/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407201274","html_url":"https://github.com/apache/iceberg/issues/6679#issuecomment-1407201274","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6679","id":1407201274,"node_id":"IC_kwDOCW7NX85T4C_6","user":{"login":"singhpk234","id":35593236,"node_id":"MDQ6VXNlcjM1NTkzMjM2","avatar_url":"https://avatars.githubusercontent.com/u/35593236?v=4","gravatar_id":"","url":"https://api.github.com/users/singhpk234","html_url":"https://github.com/singhpk234","followers_url":"https://api.github.com/users/singhpk234/followers","following_url":"https://api.github.com/users/singhpk234/following{/other_user}","gists_url":"https://api.github.com/users/singhpk234/gists{/gist_id}","starred_url":"https://api.github.com/users/singhpk234/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/singhpk234/subscriptions","organizations_url":"https://api.github.com/users/singhpk234/orgs","repos_url":"https://api.github.com/users/singhpk234/repos","events_url":"https://api.github.com/users/singhpk234/events{/privacy}","received_events_url":"https://api.github.com/users/singhpk234/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-27T23:57:41Z","updated_at":"2023-01-27T23:57:41Z","author_association":"CONTRIBUTOR","body":"+1 on changing the default from none and having a dedicated doc section for the configuring these. Happy to contribute to this if possible. \r\n\r\n--- \r\n\r\nSide note : I also see `write.merge.distribution-mode` and `write.update.distribution-mode` missing in table props in doc section as well https://iceberg.apache.org/docs/latest/configuration/ ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407201274/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407208022","html_url":"https://github.com/apache/iceberg/issues/5400#issuecomment-1407208022","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5400","id":1407208022,"node_id":"IC_kwDOCW7NX85T4EpW","user":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T00:11:19Z","updated_at":"2023-01-28T00:11:19Z","author_association":"NONE","body":"This issue has been automatically marked as stale because it has been open for 180 days with no activity. It will be closed in next 14 days if no further activity occurs. To permanently prevent this issue from being considered stale, add the label 'not-stale', but commenting on the issue is preferred when possible.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407208022/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407208036","html_url":"https://github.com/apache/iceberg/issues/5397#issuecomment-1407208036","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5397","id":1407208036,"node_id":"IC_kwDOCW7NX85T4Epk","user":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T00:11:21Z","updated_at":"2023-01-28T00:11:21Z","author_association":"NONE","body":"This issue has been automatically marked as stale because it has been open for 180 days with no activity. It will be closed in next 14 days if no further activity occurs. To permanently prevent this issue from being considered stale, add the label 'not-stale', but commenting on the issue is preferred when possible.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407208036/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407208073","html_url":"https://github.com/apache/iceberg/issues/5279#issuecomment-1407208073","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5279","id":1407208073,"node_id":"IC_kwDOCW7NX85T4EqJ","user":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T00:11:26Z","updated_at":"2023-01-28T00:11:26Z","author_association":"NONE","body":"This issue has been closed because it has not received any activity in the last 14 days since being marked as 'stale'","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407208073/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407215004","html_url":"https://github.com/apache/iceberg/pull/6683#issuecomment-1407215004","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6683","id":1407215004,"node_id":"IC_kwDOCW7NX85T4GWc","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T00:22:40Z","updated_at":"2023-01-28T00:22:40Z","author_association":"CONTRIBUTOR","body":"Should we just update this with what is discussed in https://github.com/apache/iceberg/issues/6679 all together?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407215004/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407234861","html_url":"https://github.com/apache/iceberg/issues/6679#issuecomment-1407234861","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6679","id":1407234861,"node_id":"IC_kwDOCW7NX85T4LMt","user":{"login":"dramaticlly","id":5961173,"node_id":"MDQ6VXNlcjU5NjExNzM=","avatar_url":"https://avatars.githubusercontent.com/u/5961173?v=4","gravatar_id":"","url":"https://api.github.com/users/dramaticlly","html_url":"https://github.com/dramaticlly","followers_url":"https://api.github.com/users/dramaticlly/followers","following_url":"https://api.github.com/users/dramaticlly/following{/other_user}","gists_url":"https://api.github.com/users/dramaticlly/gists{/gist_id}","starred_url":"https://api.github.com/users/dramaticlly/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dramaticlly/subscriptions","organizations_url":"https://api.github.com/users/dramaticlly/orgs","repos_url":"https://api.github.com/users/dramaticlly/repos","events_url":"https://api.github.com/users/dramaticlly/events{/privacy}","received_events_url":"https://api.github.com/users/dramaticlly/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T01:03:02Z","updated_at":"2023-01-28T01:03:41Z","author_association":"CONTRIBUTOR","body":"> Side note : I also see `write.merge.distribution-mode` and `write.update.distribution-mode` missing in table props in doc section as well https://iceberg.apache.org/docs/latest/configuration/\r\n\r\nyeah @singhpk234  I noticed that before and had my attempt https://github.com/apache/iceberg/pull/5280 to fix it but need some help on `merge` case to provide better narrative.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407234861/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407246245","html_url":"https://github.com/apache/iceberg/pull/6653#issuecomment-1407246245","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6653","id":1407246245,"node_id":"IC_kwDOCW7NX85T4N-l","user":{"login":"zhangbutao","id":9760681,"node_id":"MDQ6VXNlcjk3NjA2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/9760681?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangbutao","html_url":"https://github.com/zhangbutao","followers_url":"https://api.github.com/users/zhangbutao/followers","following_url":"https://api.github.com/users/zhangbutao/following{/other_user}","gists_url":"https://api.github.com/users/zhangbutao/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangbutao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangbutao/subscriptions","organizations_url":"https://api.github.com/users/zhangbutao/orgs","repos_url":"https://api.github.com/users/zhangbutao/repos","events_url":"https://api.github.com/users/zhangbutao/events{/privacy}","received_events_url":"https://api.github.com/users/zhangbutao/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T01:36:39Z","updated_at":"2023-01-28T01:36:39Z","author_association":"CONTRIBUTOR","body":"I also had a workaround for this issue, see https://github.com/apache/iceberg/pull/6482. Not sure which way is more reasonable.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407246245/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407247517","html_url":"https://github.com/apache/iceberg/pull/6482#issuecomment-1407247517","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6482","id":1407247517,"node_id":"IC_kwDOCW7NX85T4OSd","user":{"login":"zhangbutao","id":9760681,"node_id":"MDQ6VXNlcjk3NjA2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/9760681?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangbutao","html_url":"https://github.com/zhangbutao","followers_url":"https://api.github.com/users/zhangbutao/followers","following_url":"https://api.github.com/users/zhangbutao/following{/other_user}","gists_url":"https://api.github.com/users/zhangbutao/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangbutao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangbutao/subscriptions","organizations_url":"https://api.github.com/users/zhangbutao/orgs","repos_url":"https://api.github.com/users/zhangbutao/repos","events_url":"https://api.github.com/users/zhangbutao/events{/privacy}","received_events_url":"https://api.github.com/users/zhangbutao/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T01:41:04Z","updated_at":"2023-01-28T01:41:04Z","author_association":"CONTRIBUTOR","body":"Sorry for long time to come back. Will address comments as soon as :) @hililiwei ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407247517/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407353080","html_url":"https://github.com/apache/iceberg/pull/6482#issuecomment-1407353080","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6482","id":1407353080,"node_id":"IC_kwDOCW7NX85T4oD4","user":{"login":"zhangbutao","id":9760681,"node_id":"MDQ6VXNlcjk3NjA2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/9760681?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangbutao","html_url":"https://github.com/zhangbutao","followers_url":"https://api.github.com/users/zhangbutao/followers","following_url":"https://api.github.com/users/zhangbutao/following{/other_user}","gists_url":"https://api.github.com/users/zhangbutao/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangbutao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangbutao/subscriptions","organizations_url":"https://api.github.com/users/zhangbutao/orgs","repos_url":"https://api.github.com/users/zhangbutao/repos","events_url":"https://api.github.com/users/zhangbutao/events{/privacy}","received_events_url":"https://api.github.com/users/zhangbutao/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T09:26:28Z","updated_at":"2023-01-28T09:26:28Z","author_association":"CONTRIBUTOR","body":"> Note that this PR is essentially reverting #6220, which I don't think we can do atm. /cc @Fokko\r\n\r\n@rdblue @Fokko @nastra Could you please take a look? I am not sure if this fix will revert https://github.com/apache/iceberg/pull/6220. In addition, another PR https://github.com/apache/iceberg/pull/6653 is aim for same issue. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407353080/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407435198","html_url":"https://github.com/apache/iceberg/issues/5977#issuecomment-1407435198","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5977","id":1407435198,"node_id":"IC_kwDOCW7NX85T48G-","user":{"login":"fireking77","id":16522095,"node_id":"MDQ6VXNlcjE2NTIyMDk1","avatar_url":"https://avatars.githubusercontent.com/u/16522095?v=4","gravatar_id":"","url":"https://api.github.com/users/fireking77","html_url":"https://github.com/fireking77","followers_url":"https://api.github.com/users/fireking77/followers","following_url":"https://api.github.com/users/fireking77/following{/other_user}","gists_url":"https://api.github.com/users/fireking77/gists{/gist_id}","starred_url":"https://api.github.com/users/fireking77/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fireking77/subscriptions","organizations_url":"https://api.github.com/users/fireking77/orgs","repos_url":"https://api.github.com/users/fireking77/repos","events_url":"https://api.github.com/users/fireking77/events{/privacy}","received_events_url":"https://api.github.com/users/fireking77/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T16:38:43Z","updated_at":"2023-01-28T16:38:43Z","author_association":"NONE","body":"Hi Guys!\r\n\r\nI would also curious about this: \r\n Any way to register the bucket UDF with Pyspark? Will the built-in bucket method not work for the same?\r\n\r\n@robinsinghstudios have you figured out something? - are you able to write partitioned table with pyspark?\r\n\r\nThanks in advance,\r\n Darvi\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407435198/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407438732","html_url":"https://github.com/apache/iceberg/issues/5977#issuecomment-1407438732","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5977","id":1407438732,"node_id":"IC_kwDOCW7NX85T48-M","user":{"login":"robinsinghstudios","id":80579763,"node_id":"MDQ6VXNlcjgwNTc5NzYz","avatar_url":"https://avatars.githubusercontent.com/u/80579763?v=4","gravatar_id":"","url":"https://api.github.com/users/robinsinghstudios","html_url":"https://github.com/robinsinghstudios","followers_url":"https://api.github.com/users/robinsinghstudios/followers","following_url":"https://api.github.com/users/robinsinghstudios/following{/other_user}","gists_url":"https://api.github.com/users/robinsinghstudios/gists{/gist_id}","starred_url":"https://api.github.com/users/robinsinghstudios/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robinsinghstudios/subscriptions","organizations_url":"https://api.github.com/users/robinsinghstudios/orgs","repos_url":"https://api.github.com/users/robinsinghstudios/repos","events_url":"https://api.github.com/users/robinsinghstudios/events{/privacy}","received_events_url":"https://api.github.com/users/robinsinghstudios/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T16:51:13Z","updated_at":"2023-01-28T16:51:13Z","author_association":"NONE","body":"Hi @fireking77 , I was able to create bucketed tables by using SparkSQL query without any data. It just works for some reason.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407438732/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407454746","html_url":"https://github.com/apache/iceberg/issues/5977#issuecomment-1407454746","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5977","id":1407454746,"node_id":"IC_kwDOCW7NX85T5A4a","user":{"login":"fireking77","id":16522095,"node_id":"MDQ6VXNlcjE2NTIyMDk1","avatar_url":"https://avatars.githubusercontent.com/u/16522095?v=4","gravatar_id":"","url":"https://api.github.com/users/fireking77","html_url":"https://github.com/fireking77","followers_url":"https://api.github.com/users/fireking77/followers","following_url":"https://api.github.com/users/fireking77/following{/other_user}","gists_url":"https://api.github.com/users/fireking77/gists{/gist_id}","starred_url":"https://api.github.com/users/fireking77/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fireking77/subscriptions","organizations_url":"https://api.github.com/users/fireking77/orgs","repos_url":"https://api.github.com/users/fireking77/repos","events_url":"https://api.github.com/users/fireking77/events{/privacy}","received_events_url":"https://api.github.com/users/fireking77/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T18:10:22Z","updated_at":"2023-01-28T18:11:51Z","author_association":"NONE","body":"@robinsinghstudios that is OK, but were youable to write data into that table with pyspark?\r\nI always get this: \r\ncaused by: java.lang.IllegalStateException: Incoming records violate the writer assumption that records are clustered by spec and by partition within each spec. Either cluster the incoming records or switch to fanout writers.\r\n\r\n\r\n-- and I try to make a order by with those specific UDFs as in the doc, but I cannot access it...\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407454746/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407462492","html_url":"https://github.com/apache/iceberg/issues/5977#issuecomment-1407462492","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5977","id":1407462492,"node_id":"IC_kwDOCW7NX85T5Cxc","user":{"login":"robinsinghstudios","id":80579763,"node_id":"MDQ6VXNlcjgwNTc5NzYz","avatar_url":"https://avatars.githubusercontent.com/u/80579763?v=4","gravatar_id":"","url":"https://api.github.com/users/robinsinghstudios","html_url":"https://github.com/robinsinghstudios","followers_url":"https://api.github.com/users/robinsinghstudios/followers","following_url":"https://api.github.com/users/robinsinghstudios/following{/other_user}","gists_url":"https://api.github.com/users/robinsinghstudios/gists{/gist_id}","starred_url":"https://api.github.com/users/robinsinghstudios/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/robinsinghstudios/subscriptions","organizations_url":"https://api.github.com/users/robinsinghstudios/orgs","repos_url":"https://api.github.com/users/robinsinghstudios/repos","events_url":"https://api.github.com/users/robinsinghstudios/events{/privacy}","received_events_url":"https://api.github.com/users/robinsinghstudios/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T18:50:20Z","updated_at":"2023-01-28T18:50:20Z","author_association":"NONE","body":"@fireking77 Merge statement works with SparkSQL. Had the same issue with append pyspark method.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407462492/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407464402","html_url":"https://github.com/apache/iceberg/pull/6682#issuecomment-1407464402","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6682","id":1407464402,"node_id":"IC_kwDOCW7NX85T5DPS","user":{"login":"amogh-jahagirdar","id":87500546,"node_id":"MDQ6VXNlcjg3NTAwNTQ2","avatar_url":"https://avatars.githubusercontent.com/u/87500546?v=4","gravatar_id":"","url":"https://api.github.com/users/amogh-jahagirdar","html_url":"https://github.com/amogh-jahagirdar","followers_url":"https://api.github.com/users/amogh-jahagirdar/followers","following_url":"https://api.github.com/users/amogh-jahagirdar/following{/other_user}","gists_url":"https://api.github.com/users/amogh-jahagirdar/gists{/gist_id}","starred_url":"https://api.github.com/users/amogh-jahagirdar/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/amogh-jahagirdar/subscriptions","organizations_url":"https://api.github.com/users/amogh-jahagirdar/orgs","repos_url":"https://api.github.com/users/amogh-jahagirdar/repos","events_url":"https://api.github.com/users/amogh-jahagirdar/events{/privacy}","received_events_url":"https://api.github.com/users/amogh-jahagirdar/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T19:01:07Z","updated_at":"2023-01-28T19:01:07Z","author_association":"CONTRIBUTOR","body":"Thanks a ton for closing the loop on this @RussellSpitzer ! Left some comments","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407464402/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407466795","html_url":"https://github.com/apache/iceberg/issues/5977#issuecomment-1407466795","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5977","id":1407466795,"node_id":"IC_kwDOCW7NX85T5D0r","user":{"login":"fireking77","id":16522095,"node_id":"MDQ6VXNlcjE2NTIyMDk1","avatar_url":"https://avatars.githubusercontent.com/u/16522095?v=4","gravatar_id":"","url":"https://api.github.com/users/fireking77","html_url":"https://github.com/fireking77","followers_url":"https://api.github.com/users/fireking77/followers","following_url":"https://api.github.com/users/fireking77/following{/other_user}","gists_url":"https://api.github.com/users/fireking77/gists{/gist_id}","starred_url":"https://api.github.com/users/fireking77/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fireking77/subscriptions","organizations_url":"https://api.github.com/users/fireking77/orgs","repos_url":"https://api.github.com/users/fireking77/repos","events_url":"https://api.github.com/users/fireking77/events{/privacy}","received_events_url":"https://api.github.com/users/fireking77/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T19:12:59Z","updated_at":"2023-01-28T19:12:59Z","author_association":"NONE","body":"@robinsinghstudios Thanks! :D you were right :D\r\nI hope there will be someone fix insert too... ;)\r\nThanks again!\r\n Darvi\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407466795/reactions","total_count":1,"+1":0,"-1":0,"laugh":1,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407477437","html_url":"https://github.com/apache/iceberg/issues/6679#issuecomment-1407477437","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6679","id":1407477437,"node_id":"IC_kwDOCW7NX85T5Ga9","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T20:15:17Z","updated_at":"2023-01-28T20:15:17Z","author_association":"CONTRIBUTOR","body":"+1 for range as default.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407477437/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407483685","html_url":"https://github.com/apache/iceberg/pull/6680#issuecomment-1407483685","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6680","id":1407483685,"node_id":"IC_kwDOCW7NX85T5H8l","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-28T20:40:48Z","updated_at":"2023-01-28T20:42:23Z","author_association":"MEMBER","body":"> Looks correct to me, though we may want to move to `StructLikeMap` that was introduced later.\r\n\r\n`metricsEvaluators` is a struct like map which when `putting` copies the Wrapper but not the internal struct data. Since the underlying object reference is not copied, we have this issue. \r\n\r\nhttps://github.com/apache/iceberg/blob/master/core/src/main/java/org/apache/iceberg/util/StructLikeMap.java#L86\r\n\r\nand then\r\n\r\nhttps://github.com/apache/iceberg/blob/a76724f7ae7ff3722fea3e1145aa0a978c721b45/core/src/main/java/org/apache/iceberg/util/StructLikeWrapper.java#L59 \r\n\r\nSince the \"set\" method just assigns `this.struct = newStruct` we have this issue.\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407483685/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407517940","html_url":"https://github.com/apache/iceberg/issues/5408#issuecomment-1407517940","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5408","id":1407517940,"node_id":"IC_kwDOCW7NX85T5QT0","user":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2023-01-29T00:12:35Z","updated_at":"2023-01-29T00:12:35Z","author_association":"NONE","body":"This issue has been automatically marked as stale because it has been open for 180 days with no activity. It will be closed in next 14 days if no further activity occurs. To permanently prevent this issue from being considered stale, add the label 'not-stale', but commenting on the issue is preferred when possible.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407517940/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407538619","html_url":"https://github.com/apache/iceberg/pull/6571#issuecomment-1407538619","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6571","id":1407538619,"node_id":"IC_kwDOCW7NX85T5VW7","user":{"login":"youngxinler","id":36697727,"node_id":"MDQ6VXNlcjM2Njk3NzI3","avatar_url":"https://avatars.githubusercontent.com/u/36697727?v=4","gravatar_id":"","url":"https://api.github.com/users/youngxinler","html_url":"https://github.com/youngxinler","followers_url":"https://api.github.com/users/youngxinler/followers","following_url":"https://api.github.com/users/youngxinler/following{/other_user}","gists_url":"https://api.github.com/users/youngxinler/gists{/gist_id}","starred_url":"https://api.github.com/users/youngxinler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/youngxinler/subscriptions","organizations_url":"https://api.github.com/users/youngxinler/orgs","repos_url":"https://api.github.com/users/youngxinler/repos","events_url":"https://api.github.com/users/youngxinler/events{/privacy}","received_events_url":"https://api.github.com/users/youngxinler/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-29T02:10:23Z","updated_at":"2023-01-29T02:10:23Z","author_association":"CONTRIBUTOR","body":"@jackye1995 @JonasJ-ap   Can I trouble you if you have time to do a review? ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407538619/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407547988","html_url":"https://github.com/apache/iceberg/pull/6614#issuecomment-1407547988","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6614","id":1407547988,"node_id":"IC_kwDOCW7NX85T5XpU","user":{"login":"xuzhiwen1255","id":105710753,"node_id":"U_kgDOBk0EoQ","avatar_url":"https://avatars.githubusercontent.com/u/105710753?v=4","gravatar_id":"","url":"https://api.github.com/users/xuzhiwen1255","html_url":"https://github.com/xuzhiwen1255","followers_url":"https://api.github.com/users/xuzhiwen1255/followers","following_url":"https://api.github.com/users/xuzhiwen1255/following{/other_user}","gists_url":"https://api.github.com/users/xuzhiwen1255/gists{/gist_id}","starred_url":"https://api.github.com/users/xuzhiwen1255/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xuzhiwen1255/subscriptions","organizations_url":"https://api.github.com/users/xuzhiwen1255/orgs","repos_url":"https://api.github.com/users/xuzhiwen1255/repos","events_url":"https://api.github.com/users/xuzhiwen1255/events{/privacy}","received_events_url":"https://api.github.com/users/xuzhiwen1255/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-29T03:13:13Z","updated_at":"2023-01-29T03:13:13Z","author_association":"CONTRIBUTOR","body":"I'm sorry, I've been spending time with my family recently, so I haven't discussed this issue together.\r\n\r\nI would like to share my opinion.\r\n\r\n> I think that if a catalog is closed, it's reasonable for tables to stop operating as well. The catalog manages its shared resources and if it chooses to share a connection pool with tables then it makes sense for the tables to no longer be able to connect after the pool is closed.\r\n> \r\n> Tables should not own their own connection pools, so some resource needs to manage them and the catalog is a good place to do that.\r\n> \r\n> I think the problem is that the `TableLoader` is taking ownership of the catalog and closing it. That seems incorrect to me.\r\n\r\n+1,I think that after the catalog is closed, the table should be closed as well.\r\n\r\nI think this is a code bug.\r\n\r\nSuppose we use another catalog that is not currently jdbcCatalog, and it passes in some closeable objects, but the same problem still exists when catalog#close is closed.\r\n\r\nTherefore, we need to avoid still using the table loaded by the current catalog after the catalog is closed. This will cause some unexpected situations to occur. In fact, some problems have been exposed now.\r\n\r\n\r\n> I think of a way to circumvent this problem, I wonder if it is feasible\r\npseudocode\r\n```java\r\n// Abstract out a table accessor, through the public accessor to access the table,he manages the life cycle of the tables and catalog.\r\npublic class TableAccessor implements Closeable {\r\n  private final TableLoader tableLoader;\r\n  private Table table;\r\n\r\n  public TableAccessor(TableLoader tableLoader) {\r\n    this.tableLoader = tableLoader;\r\n  }\r\n\r\n  private Table lazyTable() {\r\n    if (table == null) {\r\n      tableLoader.open();\r\n      try (TableLoader loader = tableLoader) {\r\n        this.table = loader.loadTable();\r\n      } catch (IOException e) {\r\n        throw new UncheckedIOException(\"Failed to close table loader\", e);\r\n      }\r\n    }\r\n    return table;\r\n  }\r\n\r\n  @Override\r\n  public void close() throws IOException {\r\n    tableLoader.close();\r\n  }\r\n}\r\n\r\n// ----- icebergSource ---------\r\n  private TableAccessor tableAccessor;\r\n  \r\n  IcebergSource(\r\n      TableLoader tableLoader) {\r\n    this.tableLoader = tableLoader;\r\n// An accessor is created when an icebergSource is built, and subsequent operations or reference retrieval on the table is obtained by the accessor\r\n    tableAccessor = new TableAccessor(tableLoader);\r\n  }\r\n\r\n\r\n  private List<IcebergSourceSplit> planSplitsForBatch(String threadName) {\r\n    ExecutorService workerPool =\r\n        ThreadPools.newWorkerPool(threadName, scanContext.planParallelism());\r\n    try {\r\n      List<IcebergSourceSplit> splits =\r\n          FlinkSplitPlanner.planIcebergSourceSplits(lazyTable(), scanContext, workerPool);\r\n      LOG.info(\r\n          \"Discovered {} splits from table {} during job initialization\",\r\n          splits.size(),\r\n          lazyTable().name());\r\n      return splits;\r\n    } finally {\r\n      workerPool.shutdown();\r\n    // close accessor\r\n      tableAccessor.close();\r\n    }\r\n  }\r\n\r\n```\r\n\r\nFor streaming mode, we pass the accessor directly to the ContinuousSplitPlannerImpl, which closes the accessor.\r\n```java\r\n private TableAccessor tableAccessor;\r\n  public ContinuousSplitPlannerImpl(TableAccessor tableAccessor .......) {\r\n    this.tableAccessor =tableAccessor;\r\n    .....\r\n  }\r\n\r\n  @Override\r\n  public void close() throws IOException {\r\n    if (!isSharedPool) {\r\n      workerPool.shutdown();\r\n    }\r\n    tableAccessor.close();\r\n  }\r\n\r\n\r\n```\r\n\r\nIn this way, we need to access the table through the accessor of a table. tableLoader is maintained by the accessor. When the accessor is closed, we close the tableLoader to ensure that it is closed correctly and that the reference type in the table will not be unavailable because catalog is closed first.\r\n\r\n@stevenzwu  @pvary  @hililiwei  What do you think of this plan.\r\nPlease correct me if I'm wrong.\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407547988/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407548381","html_url":"https://github.com/apache/iceberg/pull/6614#issuecomment-1407548381","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6614","id":1407548381,"node_id":"IC_kwDOCW7NX85T5Xvd","user":{"login":"xuzhiwen1255","id":105710753,"node_id":"U_kgDOBk0EoQ","avatar_url":"https://avatars.githubusercontent.com/u/105710753?v=4","gravatar_id":"","url":"https://api.github.com/users/xuzhiwen1255","html_url":"https://github.com/xuzhiwen1255","followers_url":"https://api.github.com/users/xuzhiwen1255/followers","following_url":"https://api.github.com/users/xuzhiwen1255/following{/other_user}","gists_url":"https://api.github.com/users/xuzhiwen1255/gists{/gist_id}","starred_url":"https://api.github.com/users/xuzhiwen1255/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xuzhiwen1255/subscriptions","organizations_url":"https://api.github.com/users/xuzhiwen1255/orgs","repos_url":"https://api.github.com/users/xuzhiwen1255/repos","events_url":"https://api.github.com/users/xuzhiwen1255/events{/privacy}","received_events_url":"https://api.github.com/users/xuzhiwen1255/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-29T03:14:59Z","updated_at":"2023-01-29T03:14:59Z","author_association":"CONTRIBUTOR","body":"> TableAccessor\r\nThis is my experimental idea, yet to be tested. There may be a better way, but I haven't thought of it yet.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407548381/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407585933","html_url":"https://github.com/apache/iceberg/pull/6470#issuecomment-1407585933","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6470","id":1407585933,"node_id":"IC_kwDOCW7NX85T5g6N","user":{"login":"hililiwei","id":59213263,"node_id":"MDQ6VXNlcjU5MjEzMjYz","avatar_url":"https://avatars.githubusercontent.com/u/59213263?v=4","gravatar_id":"","url":"https://api.github.com/users/hililiwei","html_url":"https://github.com/hililiwei","followers_url":"https://api.github.com/users/hililiwei/followers","following_url":"https://api.github.com/users/hililiwei/following{/other_user}","gists_url":"https://api.github.com/users/hililiwei/gists{/gist_id}","starred_url":"https://api.github.com/users/hililiwei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hililiwei/subscriptions","organizations_url":"https://api.github.com/users/hililiwei/orgs","repos_url":"https://api.github.com/users/hililiwei/repos","events_url":"https://api.github.com/users/hililiwei/events{/privacy}","received_events_url":"https://api.github.com/users/hililiwei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-29T07:25:59Z","updated_at":"2023-01-29T07:25:59Z","author_association":"CONTRIBUTOR","body":"> Does the streaming write have the ability to set the file format? Or does that only let you use the table default as well?\r\n\r\nYes, streaming writes can set file format.\r\n\r\n> Other than that I think we should probably minimize the amount of tests we are adding for this. This is one of the slower test suites and it looks like we have a full test for every strategy, we should be able to confirm this by just rewriting a single file in each test correct?\r\n\r\nTry to reduce the test, PTAL, thx.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407585933/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407592885","html_url":"https://github.com/apache/iceberg/pull/6614#issuecomment-1407592885","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6614","id":1407592885,"node_id":"IC_kwDOCW7NX85T5im1","user":{"login":"hililiwei","id":59213263,"node_id":"MDQ6VXNlcjU5MjEzMjYz","avatar_url":"https://avatars.githubusercontent.com/u/59213263?v=4","gravatar_id":"","url":"https://api.github.com/users/hililiwei","html_url":"https://github.com/hililiwei","followers_url":"https://api.github.com/users/hililiwei/followers","following_url":"https://api.github.com/users/hililiwei/following{/other_user}","gists_url":"https://api.github.com/users/hililiwei/gists{/gist_id}","starred_url":"https://api.github.com/users/hililiwei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hililiwei/subscriptions","organizations_url":"https://api.github.com/users/hililiwei/orgs","repos_url":"https://api.github.com/users/hililiwei/repos","events_url":"https://api.github.com/users/hililiwei/events{/privacy}","received_events_url":"https://api.github.com/users/hililiwei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-29T08:03:35Z","updated_at":"2023-01-29T08:03:35Z","author_association":"CONTRIBUTOR","body":"> That is a good question. It is a bit challenging. The easier model is share nothing across tasks (e.g. no global static conn pools). Let's say each TM as 8 subtask, each task need to open a client (and connection pool) talking to some external system. Each task is responsible for the ownership and lifecycle of the client. This ties the client/conn pool lifecycle to the Flink subtask lifecycle.\r\n\r\n+1 for this. \r\n\r\n> In this way, we need to access the table through the accessor of a table. tableLoader is maintained by the accessor. When the accessor is closed, we close the tableLoader to ensure that it is closed correctly and that the reference type in the table will not be unavailable because catalog is closed first.\r\n\r\nWe should first standardize the behavior. The current approach, in my opinion, is not the best way to solve the problem.\r\n\r\nFrom the above discussion, it seems that we have the following two solutions:\r\n1. Use catalog instead of `TableLoader`.\r\nIt's a big change, but it's more in line with the current behavior of catalog. In addition, all resources are managed by the catalog.\r\n2. Clone a new table.\r\nIn Flip-27, Read-only table does not meet our requirements, so we can try to clone a new table in the table loader. It's independent of catalog. We need to manage it manually.\r\n3. Clone a new `TableLoader`\r\nPass in a cloned TableLoader to the ContinuousSplitPlannerImpl, and add a clone method to TableLoader interface.\r\n\r\nDid I miss anything?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407592885/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407610685","html_url":"https://github.com/apache/iceberg/pull/6440#issuecomment-1407610685","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6440","id":1407610685,"node_id":"IC_kwDOCW7NX85T5m89","user":{"login":"xwmr-max","id":61017037,"node_id":"MDQ6VXNlcjYxMDE3MDM3","avatar_url":"https://avatars.githubusercontent.com/u/61017037?v=4","gravatar_id":"","url":"https://api.github.com/users/xwmr-max","html_url":"https://github.com/xwmr-max","followers_url":"https://api.github.com/users/xwmr-max/followers","following_url":"https://api.github.com/users/xwmr-max/following{/other_user}","gists_url":"https://api.github.com/users/xwmr-max/gists{/gist_id}","starred_url":"https://api.github.com/users/xwmr-max/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xwmr-max/subscriptions","organizations_url":"https://api.github.com/users/xwmr-max/orgs","repos_url":"https://api.github.com/users/xwmr-max/repos","events_url":"https://api.github.com/users/xwmr-max/events{/privacy}","received_events_url":"https://api.github.com/users/xwmr-max/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-29T09:29:38Z","updated_at":"2023-01-29T09:29:38Z","author_association":"CONTRIBUTOR","body":"cc @pvary ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407610685/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407740175","html_url":"https://github.com/apache/iceberg/pull/6614#issuecomment-1407740175","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6614","id":1407740175,"node_id":"IC_kwDOCW7NX85T6GkP","user":{"login":"stevenzwu","id":1545663,"node_id":"MDQ6VXNlcjE1NDU2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1545663?v=4","gravatar_id":"","url":"https://api.github.com/users/stevenzwu","html_url":"https://github.com/stevenzwu","followers_url":"https://api.github.com/users/stevenzwu/followers","following_url":"https://api.github.com/users/stevenzwu/following{/other_user}","gists_url":"https://api.github.com/users/stevenzwu/gists{/gist_id}","starred_url":"https://api.github.com/users/stevenzwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevenzwu/subscriptions","organizations_url":"https://api.github.com/users/stevenzwu/orgs","repos_url":"https://api.github.com/users/stevenzwu/repos","events_url":"https://api.github.com/users/stevenzwu/events{/privacy}","received_events_url":"https://api.github.com/users/stevenzwu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-29T18:44:37Z","updated_at":"2023-01-29T18:44:37Z","author_association":"CONTRIBUTOR","body":"> 2. Clone a new table. In Flip-27, Read-only table does not meet our requirements, so we can try to clone a new table in the table loader. It's independent of catalog. We need to manage it manually.\r\n\r\n@hililiwei, this won't work. as a table may need to access the client pools that is closed by catalog\r\n\r\n> 3. Clone a new TableLoader. Pass in a cloned TableLoader to the ContinuousSplitPlannerImpl, and add a clone method to TableLoader interface.\r\n\r\nthis is a feasible solution for fixing the current problem with TableLoader. And we have to fix the problem for `TableLoader` as we can't just drop it and switch to completely new API or model for compatibility reason.\r\n\r\n> 1. Use catalog instead of TableLoader. It's a big change, but it's more in line with the current behavior of catalog. In addition, all resources are managed by the catalog.\r\n\r\nThis could be the proper long-term solution. we need to think carefully here and make sure the new API makes sense.\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407740175/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407740616","html_url":"https://github.com/apache/iceberg/pull/6614#issuecomment-1407740616","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6614","id":1407740616,"node_id":"IC_kwDOCW7NX85T6GrI","user":{"login":"stevenzwu","id":1545663,"node_id":"MDQ6VXNlcjE1NDU2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1545663?v=4","gravatar_id":"","url":"https://api.github.com/users/stevenzwu","html_url":"https://github.com/stevenzwu","followers_url":"https://api.github.com/users/stevenzwu/followers","following_url":"https://api.github.com/users/stevenzwu/following{/other_user}","gists_url":"https://api.github.com/users/stevenzwu/gists{/gist_id}","starred_url":"https://api.github.com/users/stevenzwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevenzwu/subscriptions","organizations_url":"https://api.github.com/users/stevenzwu/orgs","repos_url":"https://api.github.com/users/stevenzwu/repos","events_url":"https://api.github.com/users/stevenzwu/events{/privacy}","received_events_url":"https://api.github.com/users/stevenzwu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-29T18:46:26Z","updated_at":"2023-01-29T22:40:58Z","author_association":"CONTRIBUTOR","body":"@xuzhiwen1255 regarding your `TableAccessor` proposal, I think it is simpler to just add `TableLoader#clone` so that we maintain the same resource management model where the `TableLoader` object owns the catalog (open and close).","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407740616/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407757922","html_url":"https://github.com/apache/iceberg/issues/5721#issuecomment-1407757922","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5721","id":1407757922,"node_id":"IC_kwDOCW7NX85T6K5i","user":{"login":"fireking77","id":16522095,"node_id":"MDQ6VXNlcjE2NTIyMDk1","avatar_url":"https://avatars.githubusercontent.com/u/16522095?v=4","gravatar_id":"","url":"https://api.github.com/users/fireking77","html_url":"https://github.com/fireking77","followers_url":"https://api.github.com/users/fireking77/followers","following_url":"https://api.github.com/users/fireking77/following{/other_user}","gists_url":"https://api.github.com/users/fireking77/gists{/gist_id}","starred_url":"https://api.github.com/users/fireking77/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fireking77/subscriptions","organizations_url":"https://api.github.com/users/fireking77/orgs","repos_url":"https://api.github.com/users/fireking77/repos","events_url":"https://api.github.com/users/fireking77/events{/privacy}","received_events_url":"https://api.github.com/users/fireking77/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-29T20:06:59Z","updated_at":"2023-01-29T20:07:31Z","author_association":"NONE","body":"I would also curious about this question!\r\n\r\n@mrendi29 did you figure out something to work around this issue?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407757922/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407813631","html_url":"https://github.com/apache/iceberg/issues/5415#issuecomment-1407813631","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5415","id":1407813631,"node_id":"IC_kwDOCW7NX85T6Yf_","user":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2023-01-30T00:10:44Z","updated_at":"2023-01-30T00:10:44Z","author_association":"NONE","body":"This issue has been automatically marked as stale because it has been open for 180 days with no activity. It will be closed in next 14 days if no further activity occurs. To permanently prevent this issue from being considered stale, add the label 'not-stale', but commenting on the issue is preferred when possible.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407813631/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407813649","html_url":"https://github.com/apache/iceberg/issues/5370#issuecomment-1407813649","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5370","id":1407813649,"node_id":"IC_kwDOCW7NX85T6YgR","user":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2023-01-30T00:10:47Z","updated_at":"2023-01-30T00:10:47Z","author_association":"NONE","body":"This issue has been automatically marked as stale because it has been open for 180 days with no activity. It will be closed in next 14 days if no further activity occurs. To permanently prevent this issue from being considered stale, add the label 'not-stale', but commenting on the issue is preferred when possible.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407813649/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407978754","html_url":"https://github.com/apache/iceberg/pull/6175#issuecomment-1407978754","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6175","id":1407978754,"node_id":"IC_kwDOCW7NX85T7A0C","user":{"login":"lirui-apache","id":5210788,"node_id":"MDQ6VXNlcjUyMTA3ODg=","avatar_url":"https://avatars.githubusercontent.com/u/5210788?v=4","gravatar_id":"","url":"https://api.github.com/users/lirui-apache","html_url":"https://github.com/lirui-apache","followers_url":"https://api.github.com/users/lirui-apache/followers","following_url":"https://api.github.com/users/lirui-apache/following{/other_user}","gists_url":"https://api.github.com/users/lirui-apache/gists{/gist_id}","starred_url":"https://api.github.com/users/lirui-apache/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lirui-apache/subscriptions","organizations_url":"https://api.github.com/users/lirui-apache/orgs","repos_url":"https://api.github.com/users/lirui-apache/repos","events_url":"https://api.github.com/users/lirui-apache/events{/privacy}","received_events_url":"https://api.github.com/users/lirui-apache/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-30T04:26:00Z","updated_at":"2023-01-30T04:26:00Z","author_association":"CONTRIBUTOR","body":"@szehon-ho Sorry for the delayed reply. I'll work on a PR for that.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1407978754/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408025601","html_url":"https://github.com/apache/iceberg/issues/6694#issuecomment-1408025601","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6694","id":1408025601,"node_id":"IC_kwDOCW7NX85T7MQB","user":{"login":"zhongyujiang","id":42907416,"node_id":"MDQ6VXNlcjQyOTA3NDE2","avatar_url":"https://avatars.githubusercontent.com/u/42907416?v=4","gravatar_id":"","url":"https://api.github.com/users/zhongyujiang","html_url":"https://github.com/zhongyujiang","followers_url":"https://api.github.com/users/zhongyujiang/followers","following_url":"https://api.github.com/users/zhongyujiang/following{/other_user}","gists_url":"https://api.github.com/users/zhongyujiang/gists{/gist_id}","starred_url":"https://api.github.com/users/zhongyujiang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhongyujiang/subscriptions","organizations_url":"https://api.github.com/users/zhongyujiang/orgs","repos_url":"https://api.github.com/users/zhongyujiang/repos","events_url":"https://api.github.com/users/zhongyujiang/events{/privacy}","received_events_url":"https://api.github.com/users/zhongyujiang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-30T05:33:00Z","updated_at":"2023-01-30T05:33:00Z","author_association":"CONTRIBUTOR","body":"This is because these metrics were truncated, Iceberg's default metrics mode for column metric is `truncate(16)`. This should be fixed by #6313.\r\nI think it doesn't cause correctness problems, but it does cause more pos delete files to be scanned because the filtering is less effective.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408025601/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408027848","html_url":"https://github.com/apache/iceberg/pull/6686#issuecomment-1408027848","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6686","id":1408027848,"node_id":"IC_kwDOCW7NX85T7MzI","user":{"login":"ajantha-bhat","id":5889404,"node_id":"MDQ6VXNlcjU4ODk0MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/5889404?v=4","gravatar_id":"","url":"https://api.github.com/users/ajantha-bhat","html_url":"https://github.com/ajantha-bhat","followers_url":"https://api.github.com/users/ajantha-bhat/followers","following_url":"https://api.github.com/users/ajantha-bhat/following{/other_user}","gists_url":"https://api.github.com/users/ajantha-bhat/gists{/gist_id}","starred_url":"https://api.github.com/users/ajantha-bhat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajantha-bhat/subscriptions","organizations_url":"https://api.github.com/users/ajantha-bhat/orgs","repos_url":"https://api.github.com/users/ajantha-bhat/repos","events_url":"https://api.github.com/users/ajantha-bhat/events{/privacy}","received_events_url":"https://api.github.com/users/ajantha-bhat/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-30T05:37:36Z","updated_at":"2023-01-30T05:38:13Z","author_association":"MEMBER","body":"Seems like newer version of spotless needs java 11 for spotless task\r\n\r\n> > Failed to apply plugin 'com.diffplug.spotless'.\r\n   > Spotless requires JRE 11 or newer, this was 1.8.\r\n     You can upgrade your build JRE and still compile for older targets, see below\r\n     https://docs.gradle.org/current/userguide/building_java_projects.html#sec:java_cross_compilation\r\n     \r\n    ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408027848/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408094225","html_url":"https://github.com/apache/iceberg/pull/6695#issuecomment-1408094225","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6695","id":1408094225,"node_id":"IC_kwDOCW7NX85T7dAR","user":{"login":"ajantha-bhat","id":5889404,"node_id":"MDQ6VXNlcjU4ODk0MDQ=","avatar_url":"https://avatars.githubusercontent.com/u/5889404?v=4","gravatar_id":"","url":"https://api.github.com/users/ajantha-bhat","html_url":"https://github.com/ajantha-bhat","followers_url":"https://api.github.com/users/ajantha-bhat/followers","following_url":"https://api.github.com/users/ajantha-bhat/following{/other_user}","gists_url":"https://api.github.com/users/ajantha-bhat/gists{/gist_id}","starred_url":"https://api.github.com/users/ajantha-bhat/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ajantha-bhat/subscriptions","organizations_url":"https://api.github.com/users/ajantha-bhat/orgs","repos_url":"https://api.github.com/users/ajantha-bhat/repos","events_url":"https://api.github.com/users/ajantha-bhat/events{/privacy}","received_events_url":"https://api.github.com/users/ajantha-bhat/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-30T07:06:25Z","updated_at":"2023-01-30T07:06:25Z","author_association":"MEMBER","body":"cc: @aokolnychyi, @RussellSpitzer, @szehon-ho   ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408094225/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408162400","html_url":"https://github.com/apache/iceberg/issues/6694#issuecomment-1408162400","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6694","id":1408162400,"node_id":"IC_kwDOCW7NX85T7tpg","user":{"login":"kingwind94","id":22868377,"node_id":"MDQ6VXNlcjIyODY4Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/22868377?v=4","gravatar_id":"","url":"https://api.github.com/users/kingwind94","html_url":"https://github.com/kingwind94","followers_url":"https://api.github.com/users/kingwind94/followers","following_url":"https://api.github.com/users/kingwind94/following{/other_user}","gists_url":"https://api.github.com/users/kingwind94/gists{/gist_id}","starred_url":"https://api.github.com/users/kingwind94/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingwind94/subscriptions","organizations_url":"https://api.github.com/users/kingwind94/orgs","repos_url":"https://api.github.com/users/kingwind94/repos","events_url":"https://api.github.com/users/kingwind94/events{/privacy}","received_events_url":"https://api.github.com/users/kingwind94/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-30T08:15:17Z","updated_at":"2023-01-30T08:15:58Z","author_association":"NONE","body":"> This is because these metrics were truncated, Iceberg's default metrics mode for column metric is `truncate(16)`. This should be fixed by #6313. I think it doesn't cause correctness problems, but it does cause more pos delete files to be scanned because the filtering is less effective.\r\n\r\nThx, you are right! I apply #6613 to the flink 1.12 iceberg connector and it also works. The position delete lower_bounds/upper_bounds now keeps full correct path.\r\n\r\nMoreover, this problem wont affect correctness issues, but it will fail the rewrite commit validation. I use flink to write data to iceberg and use spark to rewrite small data files and delete files, the problem is every time flink commit a snapshot it will hinder the  concurrent rewrite operation beacuse of new flink-added position deletes.  But flink's new added position deletes should only appy to the new added data files, not history (rewritting) data files, so this should not hinder the rewrite operation if it works corrctly.\r\nThe reason is that DeleteFileIndex.canContainPosDeletesForFile() compares dataFile.path() with posiotion delete's file_path lower_bounds and upper_bounds, which are truncated previous, and this method would always return true for any new position delete, and then hinder the rewrite operation.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408162400/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408188556","html_url":"https://github.com/apache/iceberg/issues/2221#issuecomment-1408188556","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2221","id":1408188556,"node_id":"IC_kwDOCW7NX85T70CM","user":{"login":"Neuw84","id":5920770,"node_id":"MDQ6VXNlcjU5MjA3NzA=","avatar_url":"https://avatars.githubusercontent.com/u/5920770?v=4","gravatar_id":"","url":"https://api.github.com/users/Neuw84","html_url":"https://github.com/Neuw84","followers_url":"https://api.github.com/users/Neuw84/followers","following_url":"https://api.github.com/users/Neuw84/following{/other_user}","gists_url":"https://api.github.com/users/Neuw84/gists{/gist_id}","starred_url":"https://api.github.com/users/Neuw84/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Neuw84/subscriptions","organizations_url":"https://api.github.com/users/Neuw84/orgs","repos_url":"https://api.github.com/users/Neuw84/repos","events_url":"https://api.github.com/users/Neuw84/events{/privacy}","received_events_url":"https://api.github.com/users/Neuw84/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-30T08:36:09Z","updated_at":"2023-01-30T08:36:09Z","author_association":"CONTRIBUTOR","body":"Hi! \r\n\r\nI have a usecase similar to the ones described (CDC).\r\n\r\nIf we are using latest version of Iceberg (1.1.0) it is safe then to delete specific snapshots using the Table API? Reading the comments seems like there could be some problems with this approach. \r\n\r\nThanks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408188556/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408298187","html_url":"https://github.com/apache/iceberg/pull/6614#issuecomment-1408298187","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6614","id":1408298187,"node_id":"IC_kwDOCW7NX85T8OzL","user":{"login":"xuzhiwen1255","id":105710753,"node_id":"U_kgDOBk0EoQ","avatar_url":"https://avatars.githubusercontent.com/u/105710753?v=4","gravatar_id":"","url":"https://api.github.com/users/xuzhiwen1255","html_url":"https://github.com/xuzhiwen1255","followers_url":"https://api.github.com/users/xuzhiwen1255/followers","following_url":"https://api.github.com/users/xuzhiwen1255/following{/other_user}","gists_url":"https://api.github.com/users/xuzhiwen1255/gists{/gist_id}","starred_url":"https://api.github.com/users/xuzhiwen1255/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xuzhiwen1255/subscriptions","organizations_url":"https://api.github.com/users/xuzhiwen1255/orgs","repos_url":"https://api.github.com/users/xuzhiwen1255/repos","events_url":"https://api.github.com/users/xuzhiwen1255/events{/privacy}","received_events_url":"https://api.github.com/users/xuzhiwen1255/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-30T09:49:26Z","updated_at":"2023-01-30T09:50:14Z","author_association":"CONTRIBUTOR","body":"@stevenzwu @hililiwei I tried to change it, please review it for me, thank you.\r\n``For the sink, he did not operate the table, so I did not change his logic, only modified the logic of the source.``","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408298187/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408391175","html_url":"https://github.com/apache/iceberg/pull/6698#issuecomment-1408391175","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6698","id":1408391175,"node_id":"IC_kwDOCW7NX85T8lgH","user":{"login":"lirui-apache","id":5210788,"node_id":"MDQ6VXNlcjUyMTA3ODg=","avatar_url":"https://avatars.githubusercontent.com/u/5210788?v=4","gravatar_id":"","url":"https://api.github.com/users/lirui-apache","html_url":"https://github.com/lirui-apache","followers_url":"https://api.github.com/users/lirui-apache/followers","following_url":"https://api.github.com/users/lirui-apache/following{/other_user}","gists_url":"https://api.github.com/users/lirui-apache/gists{/gist_id}","starred_url":"https://api.github.com/users/lirui-apache/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lirui-apache/subscriptions","organizations_url":"https://api.github.com/users/lirui-apache/orgs","repos_url":"https://api.github.com/users/lirui-apache/repos","events_url":"https://api.github.com/users/lirui-apache/events{/privacy}","received_events_url":"https://api.github.com/users/lirui-apache/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-30T10:44:33Z","updated_at":"2023-01-30T10:44:33Z","author_association":"CONTRIBUTOR","body":"@szehon-ho @pvary @nastra @flyrain Could you please have a look? Thanks~","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408391175/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408449585","html_url":"https://github.com/apache/iceberg/issues/6694#issuecomment-1408449585","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6694","id":1408449585,"node_id":"IC_kwDOCW7NX85T8zwx","user":{"login":"zhongyujiang","id":42907416,"node_id":"MDQ6VXNlcjQyOTA3NDE2","avatar_url":"https://avatars.githubusercontent.com/u/42907416?v=4","gravatar_id":"","url":"https://api.github.com/users/zhongyujiang","html_url":"https://github.com/zhongyujiang","followers_url":"https://api.github.com/users/zhongyujiang/followers","following_url":"https://api.github.com/users/zhongyujiang/following{/other_user}","gists_url":"https://api.github.com/users/zhongyujiang/gists{/gist_id}","starred_url":"https://api.github.com/users/zhongyujiang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhongyujiang/subscriptions","organizations_url":"https://api.github.com/users/zhongyujiang/orgs","repos_url":"https://api.github.com/users/zhongyujiang/repos","events_url":"https://api.github.com/users/zhongyujiang/events{/privacy}","received_events_url":"https://api.github.com/users/zhongyujiang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-30T11:23:33Z","updated_at":"2023-01-30T11:23:33Z","author_association":"CONTRIBUTOR","body":"> But flink's new added position deletes should only appy to the new added data files, not history (rewritting) data files, so this should not hinder the rewrite operation if it works corrctly.\r\n\r\nUnfortunately, 6313 cannot completely solve this problem. It is not enough to use the upper bound and lower bound of `file_path` to detect whether there is a conflict. Even if metrics are complete, DeleteFileIndex.canContainPosDeletesForFile() still cannot completely filter out unmatched delete files. \r\n\r\nThere is another PR #5760 trying to fix this.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408449585/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408484697","html_url":"https://github.com/apache/iceberg/pull/6660#issuecomment-1408484697","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6660","id":1408484697,"node_id":"IC_kwDOCW7NX85T88VZ","user":{"login":"hililiwei","id":59213263,"node_id":"MDQ6VXNlcjU5MjEzMjYz","avatar_url":"https://avatars.githubusercontent.com/u/59213263?v=4","gravatar_id":"","url":"https://api.github.com/users/hililiwei","html_url":"https://github.com/hililiwei","followers_url":"https://api.github.com/users/hililiwei/followers","following_url":"https://api.github.com/users/hililiwei/following{/other_user}","gists_url":"https://api.github.com/users/hililiwei/gists{/gist_id}","starred_url":"https://api.github.com/users/hililiwei/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hililiwei/subscriptions","organizations_url":"https://api.github.com/users/hililiwei/orgs","repos_url":"https://api.github.com/users/hililiwei/repos","events_url":"https://api.github.com/users/hililiwei/events{/privacy}","received_events_url":"https://api.github.com/users/hililiwei/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-30T11:51:58Z","updated_at":"2023-01-30T11:51:58Z","author_association":"CONTRIBUTOR","body":"> > Thanks for the PR @amogh-jahagirdar! Left one small question.\r\n> > Also, do we have this feature in FlinkSource?\r\n> \r\n> Thanks for the review @pvary ! Not yet, but I'm working on a PR for it, will publish when it's ready .\r\n\r\nA long time ago, I raised a related #5029 to do this, if you can, can you take a look?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408484697/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408917506","html_url":"https://github.com/apache/iceberg/pull/6680#issuecomment-1408917506","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6680","id":1408917506,"node_id":"IC_kwDOCW7NX85T-mAC","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-30T16:15:58Z","updated_at":"2023-01-30T16:15:58Z","author_association":"MEMBER","body":"Merged! Thanks @amogh-jahagirdar , @rdblue , @stevenzwu , @abmo-x , @szehon-ho, @dramaticlly .\r\n\r\nI would also again like to greatly credit Steven and Szehon for their hard work in debugging this issue. Once more, I would like to say Szehon you were right, it was a hashcode collision issue :)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408917506/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":2,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408949576","html_url":"https://github.com/apache/iceberg/pull/6653#issuecomment-1408949576","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6653","id":1408949576,"node_id":"IC_kwDOCW7NX85T-t1I","user":{"login":"deniskuzZ","id":2761528,"node_id":"MDQ6VXNlcjI3NjE1Mjg=","avatar_url":"https://avatars.githubusercontent.com/u/2761528?v=4","gravatar_id":"","url":"https://api.github.com/users/deniskuzZ","html_url":"https://github.com/deniskuzZ","followers_url":"https://api.github.com/users/deniskuzZ/followers","following_url":"https://api.github.com/users/deniskuzZ/following{/other_user}","gists_url":"https://api.github.com/users/deniskuzZ/gists{/gist_id}","starred_url":"https://api.github.com/users/deniskuzZ/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/deniskuzZ/subscriptions","organizations_url":"https://api.github.com/users/deniskuzZ/orgs","repos_url":"https://api.github.com/users/deniskuzZ/repos","events_url":"https://api.github.com/users/deniskuzZ/events{/privacy}","received_events_url":"https://api.github.com/users/deniskuzZ/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-30T16:34:06Z","updated_at":"2023-01-30T16:34:06Z","author_association":"MEMBER","body":"> I also had a workaround for this issue, see #6482. Not sure which way is more reasonable.\r\n\r\nI am ok with either solution, however, noticed a potentially no-go comment in your PR and decided to take the same approach as @Fokko in #6220.\r\nNote this is a blocker for Hive Iceberg 1.1.0 migration.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1408949576/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409461416","html_url":"https://github.com/apache/iceberg/pull/6660#issuecomment-1409461416","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6660","id":1409461416,"node_id":"IC_kwDOCW7NX85UAqyo","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-30T22:30:51Z","updated_at":"2023-01-30T22:30:51Z","author_association":"CONTRIBUTOR","body":"> A long time ago, I raised a related https://github.com/apache/iceberg/pull/5029 to do this, if you can, can you take a look?\r\n\r\nThanks, marking that as a part of the milestone!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409461416/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409553882","html_url":"https://github.com/apache/iceberg/issues/5314#issuecomment-1409553882","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5314","id":1409553882,"node_id":"IC_kwDOCW7NX85UBBXa","user":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T00:12:41Z","updated_at":"2023-01-31T00:12:41Z","author_association":"NONE","body":"This issue has been closed because it has not received any activity in the last 14 days since being marked as 'stale'","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409553882/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409553917","html_url":"https://github.com/apache/iceberg/issues/5293#issuecomment-1409553917","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5293","id":1409553917,"node_id":"IC_kwDOCW7NX85UBBX9","user":{"login":"github-actions[bot]","id":41898282,"node_id":"MDM6Qm90NDE4OTgyODI=","avatar_url":"https://avatars.githubusercontent.com/in/15368?v=4","gravatar_id":"","url":"https://api.github.com/users/github-actions%5Bbot%5D","html_url":"https://github.com/apps/github-actions","followers_url":"https://api.github.com/users/github-actions%5Bbot%5D/followers","following_url":"https://api.github.com/users/github-actions%5Bbot%5D/following{/other_user}","gists_url":"https://api.github.com/users/github-actions%5Bbot%5D/gists{/gist_id}","starred_url":"https://api.github.com/users/github-actions%5Bbot%5D/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/github-actions%5Bbot%5D/subscriptions","organizations_url":"https://api.github.com/users/github-actions%5Bbot%5D/orgs","repos_url":"https://api.github.com/users/github-actions%5Bbot%5D/repos","events_url":"https://api.github.com/users/github-actions%5Bbot%5D/events{/privacy}","received_events_url":"https://api.github.com/users/github-actions%5Bbot%5D/received_events","type":"Bot","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T00:12:43Z","updated_at":"2023-01-31T00:12:43Z","author_association":"NONE","body":"This issue has been closed because it has not received any activity in the last 14 days since being marked as 'stale'","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409553917/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409624924","html_url":"https://github.com/apache/iceberg/issues/5993#issuecomment-1409624924","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5993","id":1409624924,"node_id":"IC_kwDOCW7NX85UBStc","user":{"login":"zhangjiuyang1993","id":23301932,"node_id":"MDQ6VXNlcjIzMzAxOTMy","avatar_url":"https://avatars.githubusercontent.com/u/23301932?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangjiuyang1993","html_url":"https://github.com/zhangjiuyang1993","followers_url":"https://api.github.com/users/zhangjiuyang1993/followers","following_url":"https://api.github.com/users/zhangjiuyang1993/following{/other_user}","gists_url":"https://api.github.com/users/zhangjiuyang1993/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangjiuyang1993/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangjiuyang1993/subscriptions","organizations_url":"https://api.github.com/users/zhangjiuyang1993/orgs","repos_url":"https://api.github.com/users/zhangjiuyang1993/repos","events_url":"https://api.github.com/users/zhangjiuyang1993/events{/privacy}","received_events_url":"https://api.github.com/users/zhangjiuyang1993/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T01:50:54Z","updated_at":"2023-01-31T01:50:54Z","author_association":"NONE","body":"@nastra \r\nAccording to the configuration above, I got the following error：\r\n23/01/31 01:43:58 WARN RESTSessionCatalog: Failed to report metrics to REST endpoint for table nyc.taxis\r\norg.apache.iceberg.exceptions.BadRequestException: Malformed request: No route for request: POST v1/namespaces/nyc/tables/taxis/metrics\r\n\tat org.apache.iceberg.rest.ErrorHandlers$DefaultErrorHandler.accept(ErrorHandlers.java:152)\r\n\tat org.apache.iceberg.rest.ErrorHandlers$DefaultErrorHandler.accept(ErrorHandlers.java:135)\r\n\tat org.apache.iceberg.rest.HTTPClient.throwFailure(HTTPClient.java:150)\r\n\tat org.apache.iceberg.rest.HTTPClient.execute(HTTPClient.java:224)\r\n\tat org.apache.iceberg.rest.HTTPClient.post(HTTPClient.java:269)\r\n\tat org.apache.iceberg.rest.RESTClient.post(RESTClient.java:112)\r\n\tat org.apache.iceberg.rest.RESTSessionCatalog.reportMetrics(RESTSessionCatalog.java:321)\r\n\tat org.apache.iceberg.rest.RESTSessionCatalog.lambda$loadTable$2(RESTSessionCatalog.java:307)\r\n\tat org.apache.iceberg.BaseTableScan.lambda$planFiles$0(BaseTableScan.java:168)\r\n\tat org.apache.iceberg.io.CloseableIterable$3.close(CloseableIterable.java:95)\r\n\tat org.apache.iceberg.spark.source.SparkBatchQueryScan.files(SparkBatchQueryScan.java:125)\r\n\tat org.apache.iceberg.spark.source.SparkBatchQueryScan.tasks(SparkBatchQueryScan.java:138)\r\n\tat org.apache.iceberg.spark.source.SparkScan.toBatch(SparkScan.java:111)\r\n\tat org.apache.spark.sql.execution.datasources.v2.BatchScanExec.batch$lzycompute(BatchScanExec.scala:42)\r\n\tat org.apache.spark.sql.execution.datasources.v2.BatchScanExec.batch(BatchScanExec.scala:42)\r\n\tat org.apache.spark.sql.execution.datasources.v2.BatchScanExec.inputPartitions$lzycompute(BatchScanExec.scala:54)\r\n\tat org.apache.spark.sql.execution.datasources.v2.BatchScanExec.inputPartitions(BatchScanExec.scala:54)\r\n\tat org.apache.spark.sql.execution.datasources.v2.DataSourceV2ScanExecBase.supportsColumnar(DataSourceV2ScanExecBase.scala:142)\r\n\tat org.apache.spark.sql.execution.datasources.v2.DataSourceV2ScanExecBase.supportsColumnar$(DataSourceV2ScanExecBase.scala:141)\r\n\tat org.apache.spark.sql.execution.datasources.v2.BatchScanExec.supportsColumnar(BatchScanExec.scala:36)\r\n\tat org.apache.spark.sql.execution.datasources.v2.DataSourceV2Strategy.apply(DataSourceV2Strategy.scala:143)\r\n\tat org.apache.spark.sql.catalyst.planning.QueryPlanner.$anonfun$plan$1(QueryPlanner.scala:63)\r\n\tat scala.collection.Iterator$$anon$11.nextCur(Iterator.scala:486)\r\n\tat scala.collection.Iterator$$anon$11.hasNext(Iterator.scala:492)\r\n\tat scala.collection.Iterator$$anon$11.hasNext(Iterator.scala:491)\r\n\tat org.apache.spark.sql.catalyst.planning.QueryPlanner.plan(QueryPlanner.scala:93)\r\n\tat org.apache.spark.sql.execution.SparkStrategies.plan(SparkStrategies.scala:69)\r\n\tat org.apache.spark.sql.catalyst.planning.QueryPlanner.$anonfun$plan$3(QueryPlanner.scala:78)\r\n\tat scala.collection.TraversableOnce$folder$1.apply(TraversableOnce.scala:196)\r\n\tat scala.collection.TraversableOnce$folder$1.apply(TraversableOnce.scala:194)\r\n\tat scala.collection.Iterator.foreach(Iterator.scala:943)\r\n\tat scala.collection.Iterator.foreach$(Iterator.scala:943)\r\n\tat scala.collection.AbstractIterator.foreach(Iterator.scala:1431)\r\n\tat scala.collection.TraversableOnce.foldLeft(TraversableOnce.scala:199)\r\n\tat scala.collection.TraversableOnce.foldLeft$(TraversableOnce.scala:192)\r\n\tat scala.collection.AbstractIterator.foldLeft(Iterator.scala:1431)\r\n\tat org.apache.spark.sql.catalyst.planning.QueryPlanner.$anonfun$plan$2(QueryPlanner.scala:75)\r\n\tat scala.collection.Iterator$$anon$11.nextCur(Iterator.scala:486)\r\n\tat scala.collection.Iterator$$anon$11.hasNext(Iterator.scala:492)\r\n\tat org.apache.spark.sql.catalyst.planning.QueryPlanner.plan(QueryPlanner.scala:93)\r\n\tat org.apache.spark.sql.execution.SparkStrategies.plan(SparkStrategies.scala:69)\r\n\tat org.apache.spark.sql.catalyst.planning.QueryPlanner.$anonfun$plan$3(QueryPlanner.scala:78)\r\n\tat scala.collection.TraversableOnce$folder$1.apply(TraversableOnce.scala:196)\r\n\tat scala.collection.TraversableOnce$folder$1.apply(TraversableOnce.scala:194)\r\n\tat scala.collection.Iterator.foreach(Iterator.scala:943)\r\n\tat scala.collection.Iterator.foreach$(Iterator.scala:943)\r\n\tat scala.collection.AbstractIterator.foreach(Iterator.scala:1431)\r\n\tat scala.collection.TraversableOnce.foldLeft(TraversableOnce.scala:199)\r\n\tat scala.collection.TraversableOnce.foldLeft$(TraversableOnce.scala:192)\r\n\tat scala.collection.AbstractIterator.foldLeft(Iterator.scala:1431)\r\n\tat org.apache.spark.sql.catalyst.planning.QueryPlanner.$anonfun$plan$2(QueryPlanner.scala:75)\r\n\tat scala.collection.Iterator$$anon$11.nextCur(Iterator.scala:486)\r\n\tat scala.collection.Iterator$$anon$11.hasNext(Iterator.scala:492)\r\n\tat org.apache.spark.sql.catalyst.planning.QueryPlanner.plan(QueryPlanner.scala:93)\r\n\tat org.apache.spark.sql.execution.SparkStrategies.plan(SparkStrategies.scala:69)\r\n\tat org.apache.spark.sql.execution.QueryExecution$.createSparkPlan(QueryExecution.scala:459)\r\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$sparkPlan$1(QueryExecution.scala:145)\r\n\tat org.apache.spark.sql.catalyst.QueryPlanningTracker.measurePhase(QueryPlanningTracker.scala:111)\r\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$2(QueryExecution.scala:185)\r\n\tat org.apache.spark.sql.execution.QueryExecution$.withInternalError(QueryExecution.scala:510)\r\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$1(QueryExecution.scala:185)\r\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:779)\r\n\tat org.apache.spark.sql.execution.QueryExecution.executePhase(QueryExecution.scala:184)\r\n\tat org.apache.spark.sql.execution.QueryExecution.sparkPlan$lzycompute(QueryExecution.scala:145)\r\n\tat org.apache.spark.sql.execution.QueryExecution.sparkPlan(QueryExecution.scala:138)\r\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$executedPlan$1(QueryExecution.scala:158)\r\n\tat org.apache.spark.sql.catalyst.QueryPlanningTracker.measurePhase(QueryPlanningTracker.scala:111)\r\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$2(QueryExecution.scala:185)\r\n\tat org.apache.spark.sql.execution.QueryExecution$.withInternalError(QueryExecution.scala:510)\r\n\tat org.apache.spark.sql.execution.QueryExecution.$anonfun$executePhase$1(QueryExecution.scala:185)\r\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:779)\r\n\tat org.apache.spark.sql.execution.QueryExecution.executePhase(QueryExecution.scala:184)\r\n\tat org.apache.spark.sql.execution.QueryExecution.executedPlan$lzycompute(QueryExecution.scala:158)\r\n\tat org.apache.spark.sql.execution.QueryExecution.executedPlan(QueryExecution.scala:151)\r\n\tat org.apache.spark.sql.execution.QueryExecution.simpleString(QueryExecution.scala:204)\r\n\tat org.apache.spark.sql.execution.QueryExecution.org$apache$spark$sql$execution$QueryExecution$$explainString(QueryExecution.scala:249)\r\n\tat org.apache.spark.sql.execution.QueryExecution.explainString(QueryExecution.scala:218)\r\n\tat org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$6(SQLExecution.scala:103)\r\n\tat org.apache.spark.sql.execution.SQLExecution$.withSQLConfPropagated(SQLExecution.scala:169)\r\n\tat org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$1(SQLExecution.scala:95)\r\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:779)\r\n\tat org.apache.spark.sql.execution.SQLExecution$.withNewExecutionId(SQLExecution.scala:64)\r\n\tat org.apache.spark.sql.Dataset.withAction(Dataset.scala:3856)\r\n\tat org.apache.spark.sql.Dataset.collectToPython(Dataset.scala:3685)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\r\n\tat py4j.reflection.MethodInvoker.invoke(MethodInvoker.java:244)\r\n\tat py4j.reflection.ReflectionEngine.invoke(ReflectionEngine.java:357)\r\n\tat py4j.Gateway.invoke(Gateway.java:282)\r\n\tat py4j.commands.AbstractCommand.invokeMethod(AbstractCommand.java:132)\r\n\tat py4j.commands.CallCommand.execute(CallCommand.java:79)\r\n\tat py4j.ClientServerConnection.waitForCommands(ClientServerConnection.java:182)\r\n\tat py4j.ClientServerConnection.run(ClientServerConnection.java:106)\r\n\tat java.base/java.lang.Thread.run(Thread.java:829)\r\nHow to solve this problem","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409624924/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409640982","html_url":"https://github.com/apache/iceberg/issues/5993#issuecomment-1409640982","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5993","id":1409640982,"node_id":"IC_kwDOCW7NX85UBWoW","user":{"login":"zhangjiuyang1993","id":23301932,"node_id":"MDQ6VXNlcjIzMzAxOTMy","avatar_url":"https://avatars.githubusercontent.com/u/23301932?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangjiuyang1993","html_url":"https://github.com/zhangjiuyang1993","followers_url":"https://api.github.com/users/zhangjiuyang1993/followers","following_url":"https://api.github.com/users/zhangjiuyang1993/following{/other_user}","gists_url":"https://api.github.com/users/zhangjiuyang1993/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangjiuyang1993/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangjiuyang1993/subscriptions","organizations_url":"https://api.github.com/users/zhangjiuyang1993/orgs","repos_url":"https://api.github.com/users/zhangjiuyang1993/repos","events_url":"https://api.github.com/users/zhangjiuyang1993/events{/privacy}","received_events_url":"https://api.github.com/users/zhangjiuyang1993/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T02:11:38Z","updated_at":"2023-01-31T02:11:38Z","author_association":"NONE","body":"Sorry if wrongly reported as bug.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409640982/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409652067","html_url":"https://github.com/apache/iceberg/issues/6694#issuecomment-1409652067","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6694","id":1409652067,"node_id":"IC_kwDOCW7NX85UBZVj","user":{"login":"kingwind94","id":22868377,"node_id":"MDQ6VXNlcjIyODY4Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/22868377?v=4","gravatar_id":"","url":"https://api.github.com/users/kingwind94","html_url":"https://github.com/kingwind94","followers_url":"https://api.github.com/users/kingwind94/followers","following_url":"https://api.github.com/users/kingwind94/following{/other_user}","gists_url":"https://api.github.com/users/kingwind94/gists{/gist_id}","starred_url":"https://api.github.com/users/kingwind94/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kingwind94/subscriptions","organizations_url":"https://api.github.com/users/kingwind94/orgs","repos_url":"https://api.github.com/users/kingwind94/repos","events_url":"https://api.github.com/users/kingwind94/events{/privacy}","received_events_url":"https://api.github.com/users/kingwind94/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T02:28:48Z","updated_at":"2023-01-31T02:28:48Z","author_association":"NONE","body":"> > But flink's new added position deletes should only appy to the new added data files, not history (rewritting) data files, so this should not hinder the rewrite operation if it works corrctly.\r\n> \r\n> Unfortunately, 6313 cannot completely solve this problem. It is not enough to use the upper bound and lower bound of `file_path` to detect whether there is a conflict. Even if metrics are complete, DeleteFileIndex.canContainPosDeletesForFile() still cannot completely filter out unmatched delete files.\r\n> \r\n> There is another PR #5760 trying to fix this.\r\n\r\nI think the file_path name of data files are ordered as the flink checkpoint num grows. Not sure about that, but the file_path is not randomly named, at least it seems that DeleteFileIndex.canContainPosDeletesForFile() can filter out new-added position deletes for flink-to-iceberg cases. I will keep looking at it.\r\n\r\nAnd thx again, I will check the PR #5760.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409652067/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409839075","html_url":"https://github.com/apache/iceberg/issues/6126#issuecomment-1409839075","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6126","id":1409839075,"node_id":"IC_kwDOCW7NX85UCG_j","user":{"login":"lintingbin","id":5699014,"node_id":"MDQ6VXNlcjU2OTkwMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/5699014?v=4","gravatar_id":"","url":"https://api.github.com/users/lintingbin","html_url":"https://github.com/lintingbin","followers_url":"https://api.github.com/users/lintingbin/followers","following_url":"https://api.github.com/users/lintingbin/following{/other_user}","gists_url":"https://api.github.com/users/lintingbin/gists{/gist_id}","starred_url":"https://api.github.com/users/lintingbin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lintingbin/subscriptions","organizations_url":"https://api.github.com/users/lintingbin/orgs","repos_url":"https://api.github.com/users/lintingbin/repos","events_url":"https://api.github.com/users/lintingbin/events{/privacy}","received_events_url":"https://api.github.com/users/lintingbin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T06:30:54Z","updated_at":"2023-01-31T06:30:54Z","author_association":"CONTRIBUTOR","body":"@szehon-ho I have the same problem, is there any progress update?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409839075/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409842868","html_url":"https://github.com/apache/iceberg/pull/6646#issuecomment-1409842868","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6646","id":1409842868,"node_id":"IC_kwDOCW7NX85UCH60","user":{"login":"arminnajafi","id":9739243,"node_id":"MDQ6VXNlcjk3MzkyNDM=","avatar_url":"https://avatars.githubusercontent.com/u/9739243?v=4","gravatar_id":"","url":"https://api.github.com/users/arminnajafi","html_url":"https://github.com/arminnajafi","followers_url":"https://api.github.com/users/arminnajafi/followers","following_url":"https://api.github.com/users/arminnajafi/following{/other_user}","gists_url":"https://api.github.com/users/arminnajafi/gists{/gist_id}","starred_url":"https://api.github.com/users/arminnajafi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/arminnajafi/subscriptions","organizations_url":"https://api.github.com/users/arminnajafi/orgs","repos_url":"https://api.github.com/users/arminnajafi/repos","events_url":"https://api.github.com/users/arminnajafi/events{/privacy}","received_events_url":"https://api.github.com/users/arminnajafi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T06:36:40Z","updated_at":"2023-01-31T06:36:40Z","author_association":"CONTRIBUTOR","body":"@JonasJ-ap \r\nThanks for reviewing this PR and also your Glue Catalog PR. This work is mostly based on that PR. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409842868/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409921692","html_url":"https://github.com/apache/iceberg/pull/6698#issuecomment-1409921692","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6698","id":1409921692,"node_id":"IC_kwDOCW7NX85UCbKc","user":{"login":"lirui-apache","id":5210788,"node_id":"MDQ6VXNlcjUyMTA3ODg=","avatar_url":"https://avatars.githubusercontent.com/u/5210788?v=4","gravatar_id":"","url":"https://api.github.com/users/lirui-apache","html_url":"https://github.com/lirui-apache","followers_url":"https://api.github.com/users/lirui-apache/followers","following_url":"https://api.github.com/users/lirui-apache/following{/other_user}","gists_url":"https://api.github.com/users/lirui-apache/gists{/gist_id}","starred_url":"https://api.github.com/users/lirui-apache/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lirui-apache/subscriptions","organizations_url":"https://api.github.com/users/lirui-apache/orgs","repos_url":"https://api.github.com/users/lirui-apache/repos","events_url":"https://api.github.com/users/lirui-apache/events{/privacy}","received_events_url":"https://api.github.com/users/lirui-apache/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T07:59:26Z","updated_at":"2023-01-31T07:59:26Z","author_association":"CONTRIBUTOR","body":"@szehon-ho Thanks for reviewing! I've updated the PR","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409921692/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409922846","html_url":"https://github.com/apache/iceberg/pull/6653#issuecomment-1409922846","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6653","id":1409922846,"node_id":"IC_kwDOCW7NX85UCbce","user":{"login":"zhangbutao","id":9760681,"node_id":"MDQ6VXNlcjk3NjA2ODE=","avatar_url":"https://avatars.githubusercontent.com/u/9760681?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangbutao","html_url":"https://github.com/zhangbutao","followers_url":"https://api.github.com/users/zhangbutao/followers","following_url":"https://api.github.com/users/zhangbutao/following{/other_user}","gists_url":"https://api.github.com/users/zhangbutao/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangbutao/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangbutao/subscriptions","organizations_url":"https://api.github.com/users/zhangbutao/orgs","repos_url":"https://api.github.com/users/zhangbutao/repos","events_url":"https://api.github.com/users/zhangbutao/events{/privacy}","received_events_url":"https://api.github.com/users/zhangbutao/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T08:00:35Z","updated_at":"2023-01-31T08:00:35Z","author_association":"CONTRIBUTOR","body":"> I am ok with either solution, however, noticed a potentially no-go comment in your PR and decided to take the same approach as @Fokko in #6220. Note this is a blocker for Hive Iceberg 1.1.0 migration.\r\n\r\nUnderstood. I am ok with either solution too. Hope to fix this as soon as possible to unblock the Hive-iceberg upgrading. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409922846/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409962986","html_url":"https://github.com/apache/iceberg/pull/6705#issuecomment-1409962986","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6705","id":1409962986,"node_id":"IC_kwDOCW7NX85UClPq","user":{"login":"Fokko","id":1134248,"node_id":"MDQ6VXNlcjExMzQyNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1134248?v=4","gravatar_id":"","url":"https://api.github.com/users/Fokko","html_url":"https://github.com/Fokko","followers_url":"https://api.github.com/users/Fokko/followers","following_url":"https://api.github.com/users/Fokko/following{/other_user}","gists_url":"https://api.github.com/users/Fokko/gists{/gist_id}","starred_url":"https://api.github.com/users/Fokko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Fokko/subscriptions","organizations_url":"https://api.github.com/users/Fokko/orgs","repos_url":"https://api.github.com/users/Fokko/repos","events_url":"https://api.github.com/users/Fokko/events{/privacy}","received_events_url":"https://api.github.com/users/Fokko/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T08:36:20Z","updated_at":"2023-01-31T08:36:20Z","author_association":"CONTRIBUTOR","body":"Thanks @amogh-jahagirdar for fixing this, and @jackye1995 for the review 👏🏻 ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409962986/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409963309","html_url":"https://github.com/apache/iceberg/pull/6704#issuecomment-1409963309","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6704","id":1409963309,"node_id":"IC_kwDOCW7NX85UClUt","user":{"login":"Fokko","id":1134248,"node_id":"MDQ6VXNlcjExMzQyNDg=","avatar_url":"https://avatars.githubusercontent.com/u/1134248?v=4","gravatar_id":"","url":"https://api.github.com/users/Fokko","html_url":"https://github.com/Fokko","followers_url":"https://api.github.com/users/Fokko/followers","following_url":"https://api.github.com/users/Fokko/following{/other_user}","gists_url":"https://api.github.com/users/Fokko/gists{/gist_id}","starred_url":"https://api.github.com/users/Fokko/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Fokko/subscriptions","organizations_url":"https://api.github.com/users/Fokko/orgs","repos_url":"https://api.github.com/users/Fokko/repos","events_url":"https://api.github.com/users/Fokko/events{/privacy}","received_events_url":"https://api.github.com/users/Fokko/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T08:36:40Z","updated_at":"2023-01-31T08:36:40Z","author_association":"CONTRIBUTOR","body":"Thanks @amogh-jahagirdar for fixing this, and @jackye1995 and @singhpk234  for the review 👏🏻 ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1409963309/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1410278806","html_url":"https://github.com/apache/iceberg/pull/6554#issuecomment-1410278806","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6554","id":1410278806,"node_id":"IC_kwDOCW7NX85UDyWW","user":{"login":"youngxinler","id":36697727,"node_id":"MDQ6VXNlcjM2Njk3NzI3","avatar_url":"https://avatars.githubusercontent.com/u/36697727?v=4","gravatar_id":"","url":"https://api.github.com/users/youngxinler","html_url":"https://github.com/youngxinler","followers_url":"https://api.github.com/users/youngxinler/followers","following_url":"https://api.github.com/users/youngxinler/following{/other_user}","gists_url":"https://api.github.com/users/youngxinler/gists{/gist_id}","starred_url":"https://api.github.com/users/youngxinler/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/youngxinler/subscriptions","organizations_url":"https://api.github.com/users/youngxinler/orgs","repos_url":"https://api.github.com/users/youngxinler/repos","events_url":"https://api.github.com/users/youngxinler/events{/privacy}","received_events_url":"https://api.github.com/users/youngxinler/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T12:41:58Z","updated_at":"2023-01-31T12:41:58Z","author_association":"CONTRIBUTOR","body":" please take a review if you have time. @RussellSpitzer ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1410278806/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1410476388","html_url":"https://github.com/apache/iceberg/issues/5993#issuecomment-1410476388","issue_url":"https://api.github.com/repos/apache/iceberg/issues/5993","id":1410476388,"node_id":"IC_kwDOCW7NX85UEilk","user":{"login":"nastra","id":271029,"node_id":"MDQ6VXNlcjI3MTAyOQ==","avatar_url":"https://avatars.githubusercontent.com/u/271029?v=4","gravatar_id":"","url":"https://api.github.com/users/nastra","html_url":"https://github.com/nastra","followers_url":"https://api.github.com/users/nastra/followers","following_url":"https://api.github.com/users/nastra/following{/other_user}","gists_url":"https://api.github.com/users/nastra/gists{/gist_id}","starred_url":"https://api.github.com/users/nastra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nastra/subscriptions","organizations_url":"https://api.github.com/users/nastra/orgs","repos_url":"https://api.github.com/users/nastra/repos","events_url":"https://api.github.com/users/nastra/events{/privacy}","received_events_url":"https://api.github.com/users/nastra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T14:39:13Z","updated_at":"2023-01-31T14:39:13Z","author_association":"CONTRIBUTOR","body":"@zhangjiuyang1993 are you using `tabulario/iceberg-rest:0.1.0`? If so, you need to use the latest one with Iceberg 1.1.0 support, which is `tabulario/iceberg-rest:0.2.0`","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1410476388/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1410481495","html_url":"https://github.com/apache/iceberg/issues/6708#issuecomment-1410481495","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6708","id":1410481495,"node_id":"IC_kwDOCW7NX85UEj1X","user":{"login":"nastra","id":271029,"node_id":"MDQ6VXNlcjI3MTAyOQ==","avatar_url":"https://avatars.githubusercontent.com/u/271029?v=4","gravatar_id":"","url":"https://api.github.com/users/nastra","html_url":"https://github.com/nastra","followers_url":"https://api.github.com/users/nastra/followers","following_url":"https://api.github.com/users/nastra/following{/other_user}","gists_url":"https://api.github.com/users/nastra/gists{/gist_id}","starred_url":"https://api.github.com/users/nastra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nastra/subscriptions","organizations_url":"https://api.github.com/users/nastra/orgs","repos_url":"https://api.github.com/users/nastra/repos","events_url":"https://api.github.com/users/nastra/events{/privacy}","received_events_url":"https://api.github.com/users/nastra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T14:41:04Z","updated_at":"2023-01-31T14:41:04Z","author_association":"CONTRIBUTOR","body":"You need to upgrade `tabulario/iceberg-rest:0.1.0` (uses Iceberg 1.0.0) to `tabulario/iceberg-rest:0.2.0` (uses Iceberg 1.1.0). That should fix it.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1410481495/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1410828722","html_url":"https://github.com/apache/iceberg/issues/6711#issuecomment-1410828722","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6711","id":1410828722,"node_id":"IC_kwDOCW7NX85UF4my","user":{"login":"stevenzwu","id":1545663,"node_id":"MDQ6VXNlcjE1NDU2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1545663?v=4","gravatar_id":"","url":"https://api.github.com/users/stevenzwu","html_url":"https://github.com/stevenzwu","followers_url":"https://api.github.com/users/stevenzwu/followers","following_url":"https://api.github.com/users/stevenzwu/following{/other_user}","gists_url":"https://api.github.com/users/stevenzwu/gists{/gist_id}","starred_url":"https://api.github.com/users/stevenzwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevenzwu/subscriptions","organizations_url":"https://api.github.com/users/stevenzwu/orgs","repos_url":"https://api.github.com/users/stevenzwu/repos","events_url":"https://api.github.com/users/stevenzwu/events{/privacy}","received_events_url":"https://api.github.com/users/stevenzwu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T18:00:08Z","updated_at":"2023-01-31T18:00:08Z","author_association":"CONTRIBUTOR","body":"@snazy I thought you need to call `.commitTransaction()` in the end","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1410828722/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1410842372","html_url":"https://github.com/apache/iceberg/issues/6711#issuecomment-1410842372","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6711","id":1410842372,"node_id":"IC_kwDOCW7NX85UF78E","user":{"login":"nastra","id":271029,"node_id":"MDQ6VXNlcjI3MTAyOQ==","avatar_url":"https://avatars.githubusercontent.com/u/271029?v=4","gravatar_id":"","url":"https://api.github.com/users/nastra","html_url":"https://github.com/nastra","followers_url":"https://api.github.com/users/nastra/followers","following_url":"https://api.github.com/users/nastra/following{/other_user}","gists_url":"https://api.github.com/users/nastra/gists{/gist_id}","starred_url":"https://api.github.com/users/nastra/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nastra/subscriptions","organizations_url":"https://api.github.com/users/nastra/orgs","repos_url":"https://api.github.com/users/nastra/repos","events_url":"https://api.github.com/users/nastra/events{/privacy}","received_events_url":"https://api.github.com/users/nastra/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T18:06:16Z","updated_at":"2023-01-31T18:06:16Z","author_association":"CONTRIBUTOR","body":"Indeed this is missing the `commitTransaction() call. The below test passes for me:\r\n```\r\n@Test\r\n  public void testUpdatePropertiesViaTransaction() {\r\n    C catalog = catalog();\r\n\r\n    Table table = catalog.buildTable(TABLE, SCHEMA).create();\r\n\r\n    Transaction transaction = table.newTransaction();\r\n    transaction\r\n        .updateProperties()\r\n        .set(TableProperties.METADATA_DELETE_AFTER_COMMIT_ENABLED, \"true\")\r\n        .set(TableProperties.METADATA_PREVIOUS_VERSIONS_MAX, Integer.toString(23))\r\n        .commit();\r\n\r\n    transaction.commitTransaction();\r\n\r\n    Table loaded = catalog.loadTable(TABLE);\r\n    Assertions.assertThat(loaded.properties())\r\n        .containsEntry(TableProperties.METADATA_DELETE_AFTER_COMMIT_ENABLED, \"true\");\r\n  }\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1410842372/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1410860361","html_url":"https://github.com/apache/iceberg/issues/6711#issuecomment-1410860361","issue_url":"https://api.github.com/repos/apache/iceberg/issues/6711","id":1410860361,"node_id":"IC_kwDOCW7NX85UGAVJ","user":{"login":"snazy","id":957468,"node_id":"MDQ6VXNlcjk1NzQ2OA==","avatar_url":"https://avatars.githubusercontent.com/u/957468?v=4","gravatar_id":"","url":"https://api.github.com/users/snazy","html_url":"https://github.com/snazy","followers_url":"https://api.github.com/users/snazy/followers","following_url":"https://api.github.com/users/snazy/following{/other_user}","gists_url":"https://api.github.com/users/snazy/gists{/gist_id}","starred_url":"https://api.github.com/users/snazy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/snazy/subscriptions","organizations_url":"https://api.github.com/users/snazy/orgs","repos_url":"https://api.github.com/users/snazy/repos","events_url":"https://api.github.com/users/snazy/events{/privacy}","received_events_url":"https://api.github.com/users/snazy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-01-31T18:16:36Z","updated_at":"2023-01-31T18:16:36Z","author_association":"MEMBER","body":"Oh, okay - NVM","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/1410860361/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]