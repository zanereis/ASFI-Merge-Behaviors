[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/443886886","html_url":"https://github.com/apache/couchdb/pull/1790#issuecomment-443886886","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1790","id":443886886,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Mzg4Njg4Ng==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-03T22:01:16Z","updated_at":"2018-12-03T22:01:16Z","author_association":"CONTRIBUTOR","body":"Here is a list of issues which are solved by moving tests into separate module\r\n- https://github.com/eproxus/meck/issues/133#issuecomment-262028993\r\n- https://github.com/eproxus/meck/issues/123#issuecomment-47282605\r\n- https://github.com/eproxus/meck/issues/158#issuecomment-160589223\r\n\r\nI think this could be the  problem https://github.com/eproxus/meck/blob/38b25cc60e0a6d869c6fad0446517ac2f6e3a88a/src/meck_proc.erl#L593 (but I am not sure)\r\n\r\npurge can return false and in this case it need to be called second time see http://erlang.org/doc/man/code.html#purge-1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/443886886/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/443940228","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-443940228","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":443940228,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Mzk0MDIyOA==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-04T01:55:07Z","updated_at":"2018-12-04T01:55:07Z","author_association":"CONTRIBUTOR","body":"I'm not familiar with fauxton: does it use the _config endpoint to configure admin users? If so, it would seem we'd need to expose a new endpoint for `set_cluster_admin_password` functionality. Is that correct, or is there an existing endpoint that might be adaptable?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/443940228/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/443946848","html_url":"https://github.com/apache/couchdb/issues/1704#issuecomment-443946848","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1704","id":443946848,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Mzk0Njg0OA==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-04T02:29:03Z","updated_at":"2018-12-04T02:29:03Z","author_association":"CONTRIBUTOR","body":"My main concern is that the current JS test suite uses HTTP, so adding a dependency on Erlang distribution protocol may make it more difficult to replace the existing suite in those environments. That said, leveraging the BEAM does seem like a more elegant approach.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/443946848/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/443947782","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-443947782","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":443947782,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Mzk0Nzc4Mg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-04T02:34:03Z","updated_at":"2018-12-04T02:34:18Z","author_association":"MEMBER","body":"It uses the cluster setup endpoints, which do correctly set admins remotely, not via the config endpoint. See https://github.com/apache/couchdb/tree/master/src/setup\r\n\r\nThey just don't sync salts.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/443947782/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/443984023","html_url":"https://github.com/apache/couchdb/pull/1782#issuecomment-443984023","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1782","id":443984023,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Mzk4NDAyMw==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-04T06:13:33Z","updated_at":"2018-12-04T06:13:33Z","author_association":"CONTRIBUTOR","body":"This has been incorporated into https://github.com/apache/couchdb/pull/1789","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/443984023/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/443986639","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-443986639","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":443986639,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Mzk4NjYzOQ==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-04T06:27:49Z","updated_at":"2018-12-04T06:27:49Z","author_association":"CONTRIBUTOR","body":"To sync salts, we could modify [this code](https://github.com/apache/couchdb/blob/master/src/couch/src/couch_passwords.erl#L44-L49) something like this:\r\n```diff\r\ndiff --git a/src/couch/src/couch_passwords.erl b/src/couch/src/couch_passwords.erl\r\nindex baf78f5d5..403b057ba 100644\r\n--- a/src/couch/src/couch_passwords.erl\r\n+++ b/src/couch/src/couch_passwords.erl\r\n@@ -41,18 +41,24 @@ hash_admin_password(ClearPassword) when is_binary(ClearPassword) ->\r\n     hash_admin_password(Scheme, ClearPassword).\r\n\r\n hash_admin_password(\"simple\", ClearPassword) -> % deprecated\r\n-    Salt = couch_uuids:random(),\r\n+    Salt = salt(),\r\n     Hash = crypto:hash(sha, <<ClearPassword/binary, Salt/binary>>),\r\n     ?l2b(\"-hashed-\" ++ couch_util:to_hex(Hash) ++ \",\" ++ ?b2l(Salt));\r\n hash_admin_password(\"pbkdf2\", ClearPassword) ->\r\n     Iterations = config:get(\"couch_httpd_auth\", \"iterations\", \"10000\"),\r\n-    Salt = couch_uuids:random(),\r\n+    Salt = salt(),\r\n     DerivedKey = couch_passwords:pbkdf2(couch_util:to_binary(ClearPassword),\r\n                                         Salt ,list_to_integer(Iterations)),\r\n     ?l2b(\"-pbkdf2-\" ++ ?b2l(DerivedKey) ++ \",\"\r\n         ++ ?b2l(Salt) ++ \",\"\r\n         ++ Iterations).\r\n\r\n+salt() ->\r\n+    case config:get(\"couch_httpd_auth\", \"salt\") of\r\n+        undefined -> couch_uuids:random();\r\n+        Salt -> list_to_binary(Salt)\r\n+    end.\r\n+\r\n -spec get_unhashed_admins() -> list().\r\n get_unhashed_admins() ->\r\n     lists:filter(\r\n```\r\n\r\nand then fauton could be modified to obtain a uuid from a node\r\n```\r\n$ curl -u adm:pass http://127.0.0.1:15984/_uuids\r\n{\"uuids\":[\"32528dddde8aac395b7dc6848b000a78\"]}\r\n```\r\nand then set the config option on each node separately via\r\n```\r\n$ curl -u adm:pass http://127.0.0.1:15984/_node/node1@127.0.0.1/_config/couch_httpd_auth/salt -X PUT -d '\"32528dddde8aac395b7dc6848b000a78\"'\r\n```\r\nafter which the way it's currently setting the admin passwords should start yielding the same hashes. I might be worried that having the salt in the config file is a security concern, but then I notice that we already store the salt with each admin user already\r\n```\r\n(node1@127.0.0.1)17> config:get(\"admins\", \"admin\", \"pass\").\r\n\"-pbkdf2-54d94fc58cabe34b3cf6391c71290dd0198e2996,32528dddde8aac395b7dc6848b000a78,10\"\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/443986639/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444000997","html_url":"https://github.com/apache/couchdb/issues/1323#issuecomment-444000997","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1323","id":444000997,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDAwMDk5Nw==","user":{"login":"felix9ia","id":23549191,"node_id":"MDQ6VXNlcjIzNTQ5MTkx","avatar_url":"https://avatars.githubusercontent.com/u/23549191?v=4","gravatar_id":"","url":"https://api.github.com/users/felix9ia","html_url":"https://github.com/felix9ia","followers_url":"https://api.github.com/users/felix9ia/followers","following_url":"https://api.github.com/users/felix9ia/following{/other_user}","gists_url":"https://api.github.com/users/felix9ia/gists{/gist_id}","starred_url":"https://api.github.com/users/felix9ia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felix9ia/subscriptions","organizations_url":"https://api.github.com/users/felix9ia/orgs","repos_url":"https://api.github.com/users/felix9ia/repos","events_url":"https://api.github.com/users/felix9ia/events{/privacy}","received_events_url":"https://api.github.com/users/felix9ia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-04T07:37:49Z","updated_at":"2018-12-04T20:06:48Z","author_association":"NONE","body":"@janl This does not seem to be the way to solve this problem, total_rows is the number of all documents that meet the conditions, the official can give us a demo to handle total_rows, and not chained","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444000997/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444018590","html_url":"https://github.com/apache/couchdb/issues/1323#issuecomment-444018590","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1323","id":444018590,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDAxODU5MA==","user":{"login":"felix9ia","id":23549191,"node_id":"MDQ6VXNlcjIzNTQ5MTkx","avatar_url":"https://avatars.githubusercontent.com/u/23549191?v=4","gravatar_id":"","url":"https://api.github.com/users/felix9ia","html_url":"https://github.com/felix9ia","followers_url":"https://api.github.com/users/felix9ia/followers","following_url":"https://api.github.com/users/felix9ia/following{/other_user}","gists_url":"https://api.github.com/users/felix9ia/gists{/gist_id}","starred_url":"https://api.github.com/users/felix9ia/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/felix9ia/subscriptions","organizations_url":"https://api.github.com/users/felix9ia/orgs","repos_url":"https://api.github.com/users/felix9ia/repos","events_url":"https://api.github.com/users/felix9ia/events{/privacy}","received_events_url":"https://api.github.com/users/felix9ia/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-04T08:46:49Z","updated_at":"2018-12-04T08:46:49Z","author_association":"NONE","body":"I created a view and the result is the total_rows field. Is this correct?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444018590/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444239073","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-444239073","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":444239073,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDIzOTA3Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-04T20:05:54Z","updated_at":"2018-12-04T20:05:54Z","author_association":"MEMBER","body":"@jaydoane But that breaks the entire cluster setup wizard approach, doesn't it?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444239073/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444239312","html_url":"https://github.com/apache/couchdb/issues/1323#issuecomment-444239312","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1323","id":444239312,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDIzOTMxMg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-04T20:06:40Z","updated_at":"2018-12-04T20:06:40Z","author_association":"MEMBER","body":"@felix9ia The question is asking about using `_find`, not views.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444239312/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444243111","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-444243111","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":444243111,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDI0MzExMQ==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-04T20:18:50Z","updated_at":"2018-12-04T20:18:50Z","author_association":"CONTRIBUTOR","body":"@wohali Hmm, I thought it kept the current approach mostly the same, and just added a couple additional requests beforehand to sync the salt on all nodes. In what way do you think it breaks the setup wizard approach? I suppose `salt` could be _added_ to the setup request, but then it would mean we'd need to be careful to apply that before setting any admin users get set. And fauton would still need to either request or generate its own salt so it's the same on all nodes.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444243111/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444246922","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-444246922","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":444246922,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDI0NjkyMg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-04T20:30:54Z","updated_at":"2018-12-04T20:31:38Z","author_association":"MEMBER","body":"@jaydoane setup wizard can be fully run from the CLI. does your workflow work WITHOUT Fauxton and WITHOUT additional API calls? that's the point of the setup wizard.\r\n\r\nSee http://docs.couchdb.org/en/latest/setup/cluster.html#the-cluster-setup-api\r\n\r\nI know for a fact people use this in Chef recipes et. al. and expect it to do all the setup for them.\r\n\r\nThis ticket was specifically to fix *that* API endpoint so it did all the things...","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444246922/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444269090","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-444269090","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":444269090,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDI2OTA5MA==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-04T21:40:24Z","updated_at":"2018-12-04T21:40:24Z","author_association":"CONTRIBUTOR","body":"@wohali ok, got it -- thanks for patiently explaining the requirements. It seems like your initial suggestion of passing the salt in with the `enable_cluster` action, in combination with making the salt configurable in `couch_passwords` could work. Would it be an error if a user passes in both `password_hash` (a current option) and `password_salt`, or do we just give one precedence over the other? Would we require a minimum length or randomness for the salt or just use whatever gets passed in? Can you think of other subtleties?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444269090/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444287626","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-444287626","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":444287626,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDI4NzYyNg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-04T22:42:07Z","updated_at":"2018-12-04T22:42:07Z","author_association":"MEMBER","body":"Ideally I'd like it to set the admin password on the \"coordinator\" node, then re-use that salt on subsequent nodes added to the cluster. This way you'd never have to pass in the salt.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444287626/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444398925","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-444398925","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":444398925,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDM5ODkyNQ==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-05T08:22:59Z","updated_at":"2018-12-06T23:34:58Z","author_association":"CONTRIBUTOR","body":"It seems that we can sync the salt from the coordinator node at the end of setup, because it's only then, after the other nodes have been added, that all nodes will become connected. Similarly, we can sync the admin users from the coordinating node at the same time. It turns out these operations are pretty much independent, and syncing the salt is only really necessary for subsequently added admin users to have the same salt and hashed values (which still seems valuable).\r\n\r\nIn any case, I have a working proof of concept which still needs some error handling before it's worthy of review.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444398925/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444490346","html_url":"https://github.com/apache/couchdb/issues/1792#issuecomment-444490346","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1792","id":444490346,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDQ5MDM0Ng==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-05T13:46:49Z","updated_at":"2018-12-05T13:46:49Z","author_association":"MEMBER","body":"while a timeout is expected if one has to wait for an index to build, CouchDB should not send a bad match error, but something more sensible.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444490346/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444548231","html_url":"https://github.com/apache/couchdb/issues/1791#issuecomment-444548231","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1791","id":444548231,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDU0ODIzMQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-05T16:26:26Z","updated_at":"2018-12-05T16:26:26Z","author_association":"MEMBER","body":"This is expected behaviour today.\r\n\r\nCouchDB must load the entire revision tree into memory, which means loading every single attachment you put on that document each time.\r\n\r\nIf you [compact the database](http://docs.couchdb.org/en/2.3.0/api/database/compact.html#db-compact) then repeat your test, you'll see the memory usage drop, since the revision tree will have been cleaned up.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444548231/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444784364","html_url":"https://github.com/apache/couchdb/issues/1793#issuecomment-444784364","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1793","id":444784364,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDc4NDM2NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-06T08:10:27Z","updated_at":"2018-12-06T08:10:27Z","author_association":"MEMBER","body":"You have an equals sign `=` in your JSON, meaning your request is ill formed.\r\n\r\nTry \r\n```bash\r\ncurl -X POST -H \"Content-Type: application/json\" localhost:5984/_cluster_setup -d '{\"action\":\"enable_single_node\", \"bind_address\":\"0.0.0.0\"}'\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444784364/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444961661","html_url":"https://github.com/apache/couchdb/pull/1794#issuecomment-444961661","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1794","id":444961661,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDk2MTY2MQ==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-06T17:40:15Z","updated_at":"2018-12-06T17:40:15Z","author_association":"CONTRIBUTOR","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444961661/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444973974","html_url":"https://github.com/apache/couchdb/pull/1794#issuecomment-444973974","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1794","id":444973974,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDk3Mzk3NA==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-06T18:15:26Z","updated_at":"2018-12-06T18:15:26Z","author_association":"CONTRIBUTOR","body":"All tests passing for me with `make eunit`. Getting this failure from `make check`\r\n```\r\ntest/javascript/tests/delayed_commits.js\r\n    Error: Failed to execute HTTP request: Failed to connect to 127.0.0.1 port 15984: Connection refused\r\n```\r\nfrom presumably flaky JS test.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444973974/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444974793","html_url":"https://github.com/apache/couchdb/pull/1794#issuecomment-444974793","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1794","id":444974793,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDk3NDc5Mw==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-06T18:17:40Z","updated_at":"2018-12-06T18:17:40Z","author_association":"MEMBER","body":"@jaydoane yep, `delayed_commits` not awesome, see #1704 ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444974793/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444988584","html_url":"https://github.com/apache/couchdb/pull/1795#issuecomment-444988584","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1795","id":444988584,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NDk4ODU4NA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-06T19:01:10Z","updated_at":"2018-12-06T19:01:10Z","author_association":"MEMBER","body":"Seems like it'd be better to move that filter into find_missing_revs in case we ever use it somewhere else in the future.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/444988584/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445002379","html_url":"https://github.com/apache/couchdb/pull/1789#issuecomment-445002379","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1789","id":445002379,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTAwMjM3OQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-06T19:38:34Z","updated_at":"2018-12-06T19:38:34Z","author_association":"CONTRIBUTOR","body":"I didn't finish my review yet. But this is looking great so far.\r\nThere is one aspect of the codebase which I don't like. However it is very easy to fix. \r\nThere are 3 places where we leak implementation detail that the partition separator is \":\". \r\nWould you mind adding following two functions into `couch_partition.erl`:\r\n```\r\n-compile({inline, [\r\n    start_key/1,\r\n    end_key/1\r\n]}).\r\nstart_key(Partition) -> \r\n    <<Partition/binary, \":\">>.\r\n\r\nend_key(Partition) -> \r\n    <<Partition/binary, \";\">>.\r\n```\r\n\r\nThen we can use these functions:\r\n- in [couch_bt_engine:get_partition_info/2](https://github.com/apache/couchdb/pull/1789/files#diff-eaad4742764a0f11879a4bb6da73f47dR305)\r\n- in [couch_mrview_util:apply_all_docs_partition/2](https://github.com/apache/couchdb/pull/1789/files#diff-2bd31f00dcfba780c6c65bc69c256854R729) instead of `PARTITION_START` and `PARTITION_END` macro.\r\n\r\nThe third place I mentioned is in [couch_mrview_updater:partition/1](https://github.com/apache/couchdb/pull/1789/files#diff-0a95c04f539e3b4a470eaa7339123ff5R405). I already have a comment about it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445002379/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445013917","html_url":"https://github.com/apache/couchdb/pull/1789#issuecomment-445013917","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1789","id":445013917,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTAxMzkxNw==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-06T20:13:14Z","updated_at":"2018-12-06T20:13:14Z","author_association":"CONTRIBUTOR","body":"Some tests need styling updates:\r\n```\r\n** (Mix) mix format failed due to --check-formatted.\r\nThe following files were not formatted:\r\n\r\n  * test/partition_view_test.exs\r\n  * test/partition_mango_test.exs\r\n  * test/partition_crud_test.exs\r\n  * test/all_docs_test.exs\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445013917/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445029513","html_url":"https://github.com/apache/couchdb/pull/1797#issuecomment-445029513","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1797","id":445029513,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTAyOTUxMw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-06T21:06:33Z","updated_at":"2018-12-06T21:06:33Z","author_association":"MEMBER","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445029513/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445034323","html_url":"https://github.com/apache/couchdb/pull/1797#issuecomment-445034323","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1797","id":445034323,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTAzNDMyMw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-06T21:23:28Z","updated_at":"2018-12-06T21:23:28Z","author_association":"CONTRIBUTOR","body":"Thank you! This was super annoying. Almost committed it a few times too","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445034323/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445036629","html_url":"https://github.com/apache/couchdb/pull/1779#issuecomment-445036629","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1779","id":445036629,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTAzNjYyOQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-06T21:31:09Z","updated_at":"2018-12-06T21:31:09Z","author_association":"MEMBER","body":"@jaydoane any comments here?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445036629/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445100751","html_url":"https://github.com/apache/couchdb/pull/1794#issuecomment-445100751","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1794","id":445100751,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTEwMDc1MQ==","user":{"login":"jiangphcn","id":18000622,"node_id":"MDQ6VXNlcjE4MDAwNjIy","avatar_url":"https://avatars.githubusercontent.com/u/18000622?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangphcn","html_url":"https://github.com/jiangphcn","followers_url":"https://api.github.com/users/jiangphcn/followers","following_url":"https://api.github.com/users/jiangphcn/following{/other_user}","gists_url":"https://api.github.com/users/jiangphcn/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangphcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangphcn/subscriptions","organizations_url":"https://api.github.com/users/jiangphcn/orgs","repos_url":"https://api.github.com/users/jiangphcn/repos","events_url":"https://api.github.com/users/jiangphcn/events{/privacy}","received_events_url":"https://api.github.com/users/jiangphcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T02:25:11Z","updated_at":"2018-12-07T02:25:11Z","author_association":"CONTRIBUTOR","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445100751/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445125117","html_url":"https://github.com/apache/couchdb/pull/1798#issuecomment-445125117","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1798","id":445125117,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTEyNTExNw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T05:14:09Z","updated_at":"2018-12-07T05:14:09Z","author_association":"CONTRIBUTOR","body":"For behavior undefined issues try checking application dependencies in the .app.src file and also remove explicit `{modules, [...]}` lists as those should be automatically created.\r\n\r\nNow in the case of couch and mem3 it's a tricky one as they would essentially need to depend on each other. Not sure how and if circular dependencies are handled.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445125117/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445181553","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-445181553","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":445181553,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTE4MTU1Mw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T09:57:41Z","updated_at":"2018-12-07T09:57:41Z","author_association":"MEMBER","body":"I had this fixed a while ago in this commit: https://github.com/apache/couchdb-setup/commit/54623ce17e49ee9b5a6b69f0a8314c61b870f866\r\n\r\nThe scenario is first-time setup: the admin us created on the coordinating note, after that, only the password hash which includes the salt, is sent to the other nodes.\r\n\r\nIm not sure how this plays with adding new nodes to existing clusters, but thats so far been out of scope for the setup wizard.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445181553/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445231034","html_url":"https://github.com/apache/couchdb/pull/1789#issuecomment-445231034","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1789","id":445231034,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTIzMTAzNA==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T13:22:04Z","updated_at":"2018-12-07T13:22:04Z","author_association":"CONTRIBUTOR","body":"After updating Makefile to skip elixir-check-formatted I am getting multiple test failures in Elixir test suite. Some of them might not be related:\r\n```\r\nReplicationTest\r\n  * test unauthorized replication cancellation (1038.8ms)\r\n\r\n  1) test unauthorized replication cancellation (ReplicationTest)\r\n     test/replication_test.exs:156\r\n     Expected truthy, got false\r\n     code: assert HTTPotion.Response.success?(resp)\r\n     stacktrace:\r\n       test/replication_test.exs:2: anonymous fn/1 in ReplicationTest.set_user_context/1\r\n       (ex_unit) lib/ex_unit/on_exit_handler.ex:140: ExUnit.OnExitHandler.exec_callback/1\r\n       (ex_unit) lib/ex_unit/on_exit_handler.ex:126: ExUnit.OnExitHandler.on_exit_runner_loop/0\r\n```\r\n\r\n```\r\n  * test non-admin or reader user on source - remote-to-remote (90.7ms)\r\n\r\n  2) test non-admin or reader user on source - remote-to-remote (ReplicationTest)\r\n     test/replication_test.exs:248\r\n     Expected truthy, got false\r\n     code: assert HTTPotion.Response.success?(resp)\r\n     stacktrace:\r\n       test/replication_test.exs:2: ReplicationTest.create_user/1\r\n       test/replication_test.exs:2: ReplicationTest.set_user_context/1\r\n       (elixir) lib/enum.ex:1899: Enum.\"-reduce/3-lists^foldl/2-0-\"/3\r\n       test/replication_test.exs:2: ReplicationTest.__ex_unit_setup_0/1\r\n       test/replication_test.exs:1: ReplicationTest.__ex_unit__/2\r\n```\r\n\r\n```\r\n  * test non-admin user on target - remote-to-local (51.4ms)\r\n\r\n  3) test non-admin user on target - remote-to-local (ReplicationTest)\r\n     test/replication_test.exs:243\r\n     Expected truthy, got false\r\n     code: assert HTTPotion.Response.success?(resp)\r\n     stacktrace:\r\n       test/replication_test.exs:2: ReplicationTest.create_user/1\r\n       test/replication_test.exs:2: ReplicationTest.set_user_context/1\r\n       (elixir) lib/enum.ex:1899: Enum.\"-reduce/3-lists^foldl/2-0-\"/3\r\n       test/replication_test.exs:2: ReplicationTest.__ex_unit_setup_0/1\r\n       test/replication_test.exs:1: ReplicationTest.__ex_unit__/2\r\n```\r\n\r\n```\r\n  * test non-admin user on target - local-to-local (64.0ms)\r\n\r\n  4) test non-admin user on target - local-to-local (ReplicationTest)\r\n     test/replication_test.exs:243\r\n     Expected truthy, got false\r\n     code: assert HTTPotion.Response.success?(resp)\r\n     stacktrace:\r\n       test/replication_test.exs:2: ReplicationTest.create_user/1\r\n       test/replication_test.exs:2: ReplicationTest.set_user_context/1\r\n       (elixir) lib/enum.ex:1899: Enum.\"-reduce/3-lists^foldl/2-0-\"/3\r\n       test/replication_test.exs:2: ReplicationTest.__ex_unit_setup_0/1\r\n       test/replication_test.exs:1: ReplicationTest.__ex_unit__/2\r\n```\r\n\r\n```\r\n\r\n  * test non-admin user on target - local-to-remote (36.3ms)\r\n\r\n  5) test non-admin user on target - local-to-remote (ReplicationTest)\r\n     test/replication_test.exs:243\r\n     Expected truthy, got false\r\n     code: assert HTTPotion.Response.success?(resp)\r\n     stacktrace:\r\n       test/replication_test.exs:2: ReplicationTest.create_user/1\r\n       test/replication_test.exs:2: ReplicationTest.set_user_context/1\r\n       (elixir) lib/enum.ex:1899: Enum.\"-reduce/3-lists^foldl/2-0-\"/3\r\n       test/replication_test.exs:2: ReplicationTest.__ex_unit_setup_0/1\r\n       test/replication_test.exs:1: ReplicationTest.__ex_unit__/2\r\n```\r\n\r\n```\r\n  * test non-admin or reader user on source - local-to-remote (71.0ms)\r\n\r\n  6) test non-admin or reader user on source - local-to-remote (ReplicationTest)\r\n     test/replication_test.exs:248\r\n     Expected truthy, got false\r\n     code: assert HTTPotion.Response.success?(resp)\r\n     stacktrace:\r\n       test/replication_test.exs:2: ReplicationTest.create_user/1\r\n       test/replication_test.exs:2: ReplicationTest.set_user_context/1\r\n       (elixir) lib/enum.ex:1899: Enum.\"-reduce/3-lists^foldl/2-0-\"/3\r\n       test/replication_test.exs:2: ReplicationTest.__ex_unit_setup_0/1\r\n       test/replication_test.exs:1: ReplicationTest.__ex_unit__/2\r\n\r\n```\r\n\r\n```\r\n  * test non-admin or reader user on source - local-to-local (49.4ms)\r\n\r\n  7) test non-admin or reader user on source - local-to-local (ReplicationTest)\r\n     test/replication_test.exs:248\r\n     Expected truthy, got false\r\n     code: assert HTTPotion.Response.success?(resp)\r\n     stacktrace:\r\n       test/replication_test.exs:2: ReplicationTest.create_user/1\r\n       test/replication_test.exs:2: ReplicationTest.set_user_context/1\r\n       (elixir) lib/enum.ex:1899: Enum.\"-reduce/3-lists^foldl/2-0-\"/3\r\n       test/replication_test.exs:2: ReplicationTest.__ex_unit_setup_0/1\r\n       test/replication_test.exs:1: ReplicationTest.__ex_unit__/2\r\n```\r\n\r\n```\r\n  * test non-admin or reader user on source - remote-to-local (192.6ms)\r\n\r\n  8) test non-admin or reader user on source - remote-to-local (ReplicationTest)\r\n     test/replication_test.exs:248\r\n     Expected truthy, got false\r\n     code: assert HTTPotion.Response.success?(resp)\r\n     stacktrace:\r\n       test/replication_test.exs:2: ReplicationTest.create_user/1\r\n       test/replication_test.exs:2: ReplicationTest.set_user_context/1\r\n       (elixir) lib/enum.ex:1899: Enum.\"-reduce/3-lists^foldl/2-0-\"/3\r\n       test/replication_test.exs:2: ReplicationTest.__ex_unit_setup_0/1\r\n       test/replication_test.exs:1: ReplicationTest.__ex_unit__/2\r\n```\r\n\r\n```\r\n  * test non-admin user on target - remote-to-remote (54.9ms)\r\n\r\n  9) test non-admin user on target - remote-to-remote (ReplicationTest)\r\n     test/replication_test.exs:243\r\n     Expected truthy, got false\r\n     code: assert HTTPotion.Response.success?(resp)\r\n     stacktrace:\r\n       test/replication_test.exs:2: ReplicationTest.create_user/1\r\n       test/replication_test.exs:2: ReplicationTest.set_user_context/1\r\n       (elixir) lib/enum.ex:1899: Enum.\"-reduce/3-lists^foldl/2-0-\"/3\r\n       test/replication_test.exs:2: ReplicationTest.__ex_unit_setup_0/1\r\n       test/replication_test.exs:1: ReplicationTest.__ex_unit__/2\r\n```\r\n\r\n```\r\nPartitionCrudTest\r\n  ...\r\n  * test saves attachment with partitioned doc (171.8ms)\r\n\r\n 10) test saves attachment with partitioned doc (PartitionCrudTest)\r\n     test/partition_crud_test.exs:246\r\n     Assertion with == failed\r\n     code:  assert body[\"_attachments\"] == %{\"foo.txt\" => %{\"content_type\" => \"text/plain\", \"digest\" => \"md5-OW2BoZAtMqs1E+fAnLpNBw==\", \"length\" => 31, \"revpos\" => 1, \"stub\" => true}}\r\n     left:  %{\"foo.txt\" => %{\"content_type\" => \"text/plain\", \"length\" => 31, \"revpos\" => 1, \"stub\" => true, \"digest\" => \"md5-wJORG+sY7HTKqCWOnk5tIQ==\"}}\r\n     right: %{\"foo.txt\" => %{\"content_type\" => \"text/plain\", \"length\" => 31, \"revpos\" => 1, \"stub\" => true, \"digest\" => \"md5-OW2BoZAtMqs1E+fAnLpNBw==\"}}\r\n     stacktrace:\r\n       test/partition_crud_test.exs:269: (test)\r\n```\r\n\r\n```\r\nBasicsTest\r\n  ...\r\n  * test PUT error when body not an object (147.4ms)\r\n\r\n 11) test PUT error when body not an object (BasicsTest)\r\n     test/basics_test.exs:243\r\n     Assertion with == failed\r\n     code:  assert resp.status_code() == 400\r\n     left:  500\r\n     right: 400\r\n     stacktrace:\r\n       test/basics_test.exs:246: (test)\r\n```\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445231034/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445311728","html_url":"https://github.com/apache/couchdb/pull/1795#issuecomment-445311728","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1795","id":445311728,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTMxMTcyOA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T17:50:34Z","updated_at":"2018-12-07T17:50:34Z","author_association":"MEMBER","body":"For posterity, @nickva and I tested how this affects internal replication of a shard with 1M docs. Before the change internal replication took 364s vs 331s after this change. So a noticeable speedup in a fairly worst case scenario. Just thought I'd make a note since I was curious how much this might help.\r\n\r\nAlso for posterity, here's the script I used to reset and time replication for anyone that cares. (The db in question was a Q=1 with 1M smallish docs).\r\n\r\n```erlang\r\nf(),\r\nrr(mem3),\r\nTimeStamp = fun() ->\r\n    {_,_,Micro} = Now = os:timestamp(),\r\n    {{Year,Month,Date},{Hour,Minute,Second}} = calendar:now_to_datetime(Now),\r\n    Format = \"~4.10.0B-~2.10.0B-~2.10.0BT~2.10.0B:~2.10.0B:~2.10.0B.~6.10.0BZ\",\r\n    iolist_to_binary(io_lib:format(Format, [Year, Month, Date, Hour, Minute, Second, Micro]))\r\nend,\r\nTimeReplication = fun(DbName) ->\r\n    Source = hd(mem3:local_shards(DbName)),\r\n    Target = hd([\r\n        S || S <- mem3:shards(DbName),\r\n        S#shard.name == Source#shard.name andalso S#shard.node /= node()\r\n    ]),\r\n    #shard{\r\n        name = TgtName,\r\n        node = TgtNode\r\n    } = Target,\r\n    couch_util:with_db(Source#shard.name, fun(Db) ->\r\n        UUID = couch_db:get_uuid(Db),\r\n        {LocalDocId, _} = mem3_rpc:load_checkpoint(TgtNode, TgtName, node(), UUID),\r\n        NewEntry = [\r\n            {<<\"source_node\">>, atom_to_binary(node(), utf8)},\r\n            {<<\"source_uuid\">>, UUID},\r\n            {<<\"source_seq\">>, 0},\r\n            {<<\"timestamp\">>, TimeStamp()}\r\n        ],\r\n        NewBody = mem3_rpc:save_checkpoint(TgtNode, TgtName, LocalDocId, 0, NewEntry, {[]}),\r\n        {ok, _} = couch_db:update_doc(Db, #doc{id = LocalDocId, body = NewBody}, [])\r\n    end),\r\n    Start = os:timestamp(),\r\n    Resp = mem3_rep:go(Source, Target, [{batch_count, all}]),\r\n    Finish = os:timestamp(),\r\n    Diff = timer:now_diff(Finish, Start) / 1000000,\r\n    {Diff, Resp}\r\nend,\r\nTimeReplication(<<\"foo\">>).\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445311728/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445315292","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-445315292","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":445315292,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTMxNTI5Mg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T18:03:15Z","updated_at":"2018-12-07T18:03:15Z","author_association":"MEMBER","body":"@janl I'm afraid this is still a bug.\r\n\r\nIn this example, `couchdb1/` `couchdb2/` and `couchdb3/` are all full installs of CouchDB. Each has been modified to run at ports `{1|2|3}5984/{1|2|3}5986`. Each is running and unconfigured at the start of the test:\r\n\r\n```\r\n$ curl localhost:15984/_node/_local/_config/admins\r\n{}\r\n$ curl localhost:25984/_node/_local/_config/admins\r\n{}\r\n$ curl localhost:35984/_node/_local/_config/admins\r\n{}\r\n```\r\n\r\nOur instructions then tell users [to set an initial admin username and password on each node independently](http://docs.couchdb.org/en/stable/setup/cluster.html#the-cluster-setup-api). In this example, I don't set a password on node 2, but I do on nodes 1 and 3:\r\n\r\n```\r\n$ curl -X POST -H \"Content-Type: application/json\" http://localhost:15984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin\", \"password\":\"password\", \"node_count\":\"3\"}'\r\n{\"ok\":true}\r\n$ grep \"admin =\" couchdb1/etc/local.ini\r\nadmin = -pbkdf2-818168f1162fb7312621227520bae09a41ebe8d6,42c6f5d002106cbd8768419a34f6c1ef,10\r\n$ curl -X POST -H \"Content-Type: application/json\" localhost:35984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"port\":\"35984\", \"username\": \"admin\", \"password\":\"password\", \"node_count\":\"3\"}'\r\n{\"ok\":true}\r\n$ grep \"^admin =\" couchdb3/etc/local.ini\r\nadmin = -pbkdf2-0fe0bc68ab3fdb12e790203fa21e668e31035d26,481f201c37df287ea3221bc6ccd44583,10\r\n```\r\n\r\nNote the different salts - at this point, this is expected.\r\n\r\nNow I proceed to join the nodes into the cluster. Node 2 goes as expected:\r\n\r\n```\r\n$ curl -X POST -H \"Content-Type: application/json\" http://admin:password@localhost:15984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin\", \"password\":\"password\", \"port\": 25984, \"node_count\": \"3\", \"remote_node\": \"127.0.0.1\"}'\r\n{\"ok\":true}\r\n$ curl localhost:25984/_node/_local/_config/admins\r\n{\"error\":\"unauthorized\",\"reason\":\"You are not a server admin.\"}\r\n$ grep \"^admin\" couchdb2/etc/local.ini\r\nadmin = -pbkdf2-818168f1162fb7312621227520bae09a41ebe8d6,42c6f5d002106cbd8768419a34f6c1ef,10\r\n```\r\n\r\nBut node 3 doesn't work:\r\n```\r\n$ curl -X POST -H \"Content-Type: application/json\" http://admin:password@localhost:15984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin\", \"password\":\"password\", \"port\": 35984, \"node_count\": \"3\", \"remote_node\": \"127.0.0.1\"}'\r\n{\"ok\":true}\r\n$ curl localhost:35984/_node/_local/_config/admins\r\n{\"error\":\"unauthorized\",\"reason\":\"You are not a server admin.\"}\r\n$ grep \"^admin\" couchdb3/etc/local.ini\r\nadmin = -pbkdf2-0fe0bc68ab3fdb12e790203fa21e668e31035d26,481f201c37df287ea3221bc6ccd44583,10\r\n```\r\n\r\nOops, I thought, I forgot to include the `remote_current_user/password` and it's incorrectly telling me that everything was fine. I mean, how could it possibly change anything without a valid admin/password for node 3?\r\n\r\nEven specifying the value doesn't change the result:\r\n\r\n```\r\n$ curl -X POST -H \"Content-Type: application/json\" http://admin:password@localhost:15984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin\", \"password\":\"password\", \"port\": 35984, \"node_count\": \"3\", \"remote_node\": \"127.0.0.1\", \"remote_current_user\": \"admin\", \"remote_current_password\": \"password\"}'\r\n{\"ok\":true}\r\n$ curl localhost:35984/_node/_local/_config/admins\r\n{\"error\":\"unauthorized\",\"reason\":\"You are not a server admin.\"}\r\n$ grep \"^admin\" couchdb3/etc/local.ini\r\nadmin = -pbkdf2-0fe0bc68ab3fdb12e790203fa21e668e31035d26,481f201c37df287ea3221bc6ccd44583,10\r\n```\r\n\r\n-----\r\n\r\nOK, I thought, maybe I should start with random logins per node and then create a new, *different* admin user using the setup wizard.\r\n\r\nSame initial config setup: 3 nodes, unconfigured.\r\n\r\n```\r\n$ curl localhost:15984/_node/_local/_config/admins\r\n{}\r\n$ curl localhost:25984/_node/_local/_config/admins\r\n{}\r\n$ curl localhost:35984/_node/_local/_config/admins\r\n{}\r\n```\r\n\r\nSet up a unique admin user per node with the cluster setup API:\r\n\r\n```\r\n$ curl -X POST -H \"Content-Type: application/json\" http://localhost:15984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin1\", \"password\":\"password1\", \"node_count\":\"3\"}'\r\n{\"ok\":true}\r\n$ curl -X POST -H \"Content-Type: application/json\" http://localhost:25984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin2\", \"password\":\"password2\", \"node_count\":\"3\"}'\r\n{\"ok\":true}\r\n$ curl -X POST -H \"Content-Type: application/json\" http://localhost:35984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin3\", \"password\":\"password3\", \"node_count\":\"3\"}'\r\n{\"ok\":true}\r\n$ grep ^admin couchdb1/etc/local.ini\r\nadmin1 = -pbkdf2-68f22a1cdaee4128066489da65ddf0bd5d3b7cf6,f398ebdfb8b31c3765dbe6e3e7b1c088,10\r\n$ grep ^admin couchdb2/etc/local.ini\r\nadmin2 = -pbkdf2-fe9036152614bf8b68fc87ccf87742b073924bdf,048ef75cf6cf1c69c8eb3ed6f6a43d47,10\r\n$ grep ^admin couchdb3/etc/local.ini\r\nadmin3 = -pbkdf2-a558c85a5a1b4597eb2017bfc3ef9aa848e706dc,5f9a033e7d85e8447eb5e37db8e87098,10\r\n$\r\n```\r\n\r\nNow let's try and create a unified `admin1` user across all nodes:\r\n\r\n```\r\n$ curl -X POST -H \"Content-Type: application/json\" http://admin1:password1@localhost:15984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin1\", \"password\":\"password1\", \"port\": 25984, \"node_count\": \"3\", \"remote_node\": \"127.0.0.1\", \"remote_current_user\": \"admin2\", \"remote_current_password\": \"password2\" }'\r\n{\"ok\":true}\r\n$ curl -X POST -H \"Content-Type: application/json\" http://admin1:password1@localhost:15984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin1\", \"password\":\"password1\", \"port\": 35984, \"node_count\": \"3\", \"remote_node\": \"127.0.0.1\", \"remote_current_user\": \"admin3\", \"remote_current_password\": \"password3\" }'\r\n{\"ok\":true}\r\n$\r\n$ grep ^admin couchdb1/etc/local.ini\r\nadmin1 = -pbkdf2-68f22a1cdaee4128066489da65ddf0bd5d3b7cf6,f398ebdfb8b31c3765dbe6e3e7b1c088,10\r\n$ grep ^admin couchdb2/etc/local.ini\r\nadmin2 = -pbkdf2-fe9036152614bf8b68fc87ccf87742b073924bdf,048ef75cf6cf1c69c8eb3ed6f6a43d47,10\r\n$ grep ^admin couchdb3/etc/local.ini\r\nadmin3 = -pbkdf2-a558c85a5a1b4597eb2017bfc3ef9aa848e706dc,5f9a033e7d85e8447eb5e37db8e87098,10\r\n```\r\n\r\nSomething's broken - either our documentation is wrong, the code is wrong, or both.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445315292/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445317199","html_url":"https://github.com/apache/couchdb/pull/1789#issuecomment-445317199","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1789","id":445317199,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTMxNzE5OQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T18:10:13Z","updated_at":"2018-12-07T18:10:13Z","author_association":"MEMBER","body":"@iilyak Those inline calls I believe only apply to the module, I don't think that'll affect anywhere else they're used as external functions? However we could at least hoist the macros into a couch_partitions.hrl for re-use.\r\n\r\nFor the mix format, those should be fixed after one of my recent-ish force pushes. I rebased for something else and forgot to check that after we added Credo.\r\n\r\nI'm looking into the other test failures to see what's going on with those.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445317199/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445318949","html_url":"https://github.com/apache/couchdb/pull/1798#issuecomment-445318949","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1798","id":445318949,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTMxODk0OQ==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T18:16:34Z","updated_at":"2018-12-07T18:16:34Z","author_association":"CONTRIBUTOR","body":"@nickva wrote:\r\n> For behavior undefined issues try checking application dependencies in the .app.src file and also remove explicit {modules, [...]} lists as those should be automatically created.\r\n\r\nI found an explicit `{modules, [...]}` term in numerous couchdb applications' .app.src files, but removing them did not suppress the warnings. Perhaps deleting those would be best left to a separate PR.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445318949/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445332896","html_url":"https://github.com/apache/couchdb/pull/1798#issuecomment-445332896","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1798","id":445332896,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTMzMjg5Ng==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T19:04:33Z","updated_at":"2018-12-07T19:06:18Z","author_association":"CONTRIBUTOR","body":"@jaydoane \r\n\r\nThanks for checking. We'd basically want mem3 compiled before say couch_peruser. I tried removing module from mem3 and moving it before couch and couch_peruser app in rebar config file. That cleared those 3 behavior warning. However because of the circular dependency between mem3 and couch another one popup up as expected:\r\n\r\n```\r\nsrc/mem3/src/mem3_sync_event_listener.erl:14: Warning: behaviour couch_event_listener undefined\r\n```\r\n\r\n```\r\ndiff --git a/rebar.config.script b/rebar.config.script\r\nindex 5f17c29e0..598097459 100644\r\n--- a/rebar.config.script\r\n+++ b/rebar.config.script\r\n@@ -26,6 +26,7 @@ SubDirs = [\r\n     \"src/couch_epi\",\r\n     \"src/couch_log\",\r\n     \"src/chttpd\",\r\n+    \"src/mem3\",\r\n     \"src/couch\",\r\n     \"src/couch_index\",\r\n     \"src/couch_mrview\",\r\n@@ -40,7 +41,6 @@ SubDirs = [\r\n     \"src/fabric\",\r\n     \"src/global_changes\",\r\n     \"src/mango\",\r\n-    \"src/mem3\",\r\n     \"src/rexi\",\r\n     \"src/setup\",\r\n     \"rel\"\r\ndiff --git a/src/mem3/src/mem3.app.src b/src/mem3/src/mem3.app.src\r\nindex 99a9eed88..15efc64ca 100644\r\n--- a/src/mem3/src/mem3.app.src\r\n+++ b/src/mem3/src/mem3.app.src\r\n@@ -13,20 +13,6 @@\r\n {application, mem3, [\r\n     {description, \"CouchDB Cluster Membership\"},\r\n     {vsn, git},\r\n-    {modules, [\r\n-        mem3,\r\n-        mem3_app,\r\n-        mem3_httpd,\r\n-        mem3_nodes,\r\n-        mem3_rep,\r\n-        mem3_shards,\r\n-        mem3_sup,\r\n-        mem3_sync,\r\n-        mem3_sync_event,\r\n-        mem3_sync_nodes,\r\n-        mem3_sync_security,\r\n-        mem3_util\r\n-    ]},\r\n     {mod, {mem3_app, []}},\r\n     {registered, [\r\n         mem3_events,\r\n```\r\n\r\nso we trade 3 warnings for 1. Still a bit better!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445332896/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445342230","html_url":"https://github.com/apache/couchdb/pull/1800#issuecomment-445342230","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1800","id":445342230,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM0MjIzMA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T19:37:19Z","updated_at":"2018-12-07T19:37:19Z","author_association":"MEMBER","body":"Looks good, but `Makefile.win` also needs same updating","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445342230/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445346960","html_url":"https://github.com/apache/couchdb/pull/1800#issuecomment-445346960","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1800","id":445346960,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM0Njk2MA==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T19:54:01Z","updated_at":"2018-12-07T19:54:01Z","author_association":"CONTRIBUTOR","body":"Win doesn't have `sed` so we need to find another solution.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445346960/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445349564","html_url":"https://github.com/apache/couchdb/pull/1800#issuecomment-445349564","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1800","id":445349564,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM0OTU2NA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T20:03:56Z","updated_at":"2018-12-07T20:03:56Z","author_association":"MEMBER","body":"You wouldn't need `sed` if you'd just reuse $(suites) from`javascript` target and run it as\r\n\r\n```\r\nmake elixir suites=test/basics_test.exs\r\nmake elixir suites=\"test/basics_test.exs test/reduce_test.exs\"\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445349564/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445350099","html_url":"https://github.com/apache/couchdb/pull/1796#issuecomment-445350099","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1796","id":445350099,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM1MDA5OQ==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T20:05:57Z","updated_at":"2018-12-07T20:05:57Z","author_association":"MEMBER","body":"@iilyak sorry, it's not clear to me - are you blocking this PR over `retry_until` and `uptime` or just got distracted by something else?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445350099/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445351621","html_url":"https://github.com/apache/couchdb/pull/1779#issuecomment-445351621","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1779","id":445351621,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM1MTYyMQ==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T20:11:52Z","updated_at":"2018-12-07T20:11:52Z","author_association":"CONTRIBUTOR","body":"@wohali yes, this LGTM. I also get the same results:\r\n```\r\n$ make elixir\r\n[ * ] Setup environment ... ok\r\n[ * ] Ensure CouchDB is built ... ok\r\n[ * ] Prepare configuration files ... ok\r\n[ * ] Start node node1 ... ok\r\n[ * ] Start node node2 ... ok\r\n[ * ] Start node node3 ... ok\r\n[ * ] Check node at http://127.0.0.1:15984/ ... ok\r\n[ * ] Check node at http://127.0.0.1:25984/ ... ok\r\n[ * ] Check node at http://127.0.0.1:35984/ ... ok\r\n[ * ] Running cluster setup ... ok\r\n[ * ] Exec command test/elixir/run ... * creating /Users/jay/.mix/archives/hex-0.18.2\r\n\r\n...snip...\r\n\r\nReplicationTest\r\n  * test simple local-to-local replication - local-to-local (2028.3ms)\r\n  * test replication by doc ids - remote-to-local (5530.7ms)\r\n  * test filtered replications - local-to-local (818.6ms)\r\n  * test non-admin or reader user on source - remote-to-remote (490.6ms)\r\n  * test create_target filter option - local-to-local (459.0ms)\r\n  * test filtered replications - remote-to-remote (792.5ms)\r\n  * test continuous replication - local-to-remote (3740.7ms)\r\n  * test continuous replication - local-to-local (3804.8ms)\r\n  * test create_target filter option - remote-to-remote (426.7ms)\r\n  * test validate_doc_update failure replications - local-to-local (540.6ms)\r\n  * test continuous replication - remote-to-local (3866.1ms)\r\n  * test continuous replication - remote-to-remote (4314.0ms)\r\n  * test source database not found with path - COUCHDB-317 (14.4ms)\r\n  * test non-admin user on target - remote-to-remote (502.8ms)\r\n  * test compressed attachment replication - local-to-remote (4740.3ms)\r\n  * test replication by doc ids - local-to-remote (5298.4ms)\r\n  * test filtered replications - remote-to-local (790.5ms)\r\n  * test filtered replications - local-to-remote (943.6ms)\r\n  * test non-admin user on target - local-to-local (554.8ms)\r\n  * test unauthorized replication cancellation (909.7ms)\r\n  * test replication restarts after filter change - COUCHDB-892 - local-to-remote (621.3ms)\r\n  * test source database not found with host (12.7ms)\r\n  * test non-admin user on target - remote-to-local (551.0ms)\r\n  * test simple remote-to-local replication - remote-to-local (2238.7ms)\r\n  * test non-admin or reader user on source - local-to-local (567.7ms)\r\n  * test replicate with since_seq - local-to-remote (468.7ms)\r\n  * test replication by doc ids - local-to-local (5944.3ms)\r\n  * test compressed attachment replication - remote-to-local (2694.6ms)\r\n  * test replicate with since_seq - remote-to-local (414.5ms)\r\n  * test simple remote-to-remote replication - remote-to-remote (2160.1ms)\r\n  * test replication restarts after filter change - COUCHDB-892 - local-to-local (666.9ms)\r\n  * test compressed attachment replication - remote-to-remote (1845.5ms)\r\n  * test replicate with since_seq - local-to-local (876.6ms)\r\n  * test replication restarts after filter change - COUCHDB-892 - remote-to-remote (1023.6ms)\r\n  * test non-admin or reader user on source - local-to-remote (477.0ms)\r\n  * test replication cancellation (1013.6ms)\r\n  * test validate_doc_update failure replications - remote-to-remote (491.6ms)\r\n  * test compressed attachment replication - local-to-local (3002.6ms)\r\n  * test create_target filter option - local-to-remote (398.9ms)\r\n  * test replicate with since_seq - remote-to-remote (563.7ms)\r\n  * test create_target filter option - remote-to-local (577.1ms)\r\n  * test replication by doc ids - remote-to-remote (5639.9ms)\r\n  * test non-admin user on target - local-to-remote (585.1ms)\r\n  * test simple local-to-remote replication - local-to-remote (2060.7ms)\r\n  * test replication restarts after filter change - COUCHDB-892 - remote-to-local (667.0ms)\r\n  * test replicating attachment without conflict - COUCHDB-885 (492.3ms)\r\n  * test validate_doc_update failure replications - local-to-remote (583.6ms)\r\n  * test non-admin or reader user on source - remote-to-local (543.6ms)\r\n  * test source database does not exist (33.3ms)\r\n  * test validate_doc_update failure replications - remote-to-local (481.1ms)\r\n\r\nReduceTest\r\n  * test Reduce pagination (1045.9ms)\r\n  * test Basic reduce functions (892.7ms)\r\n  * test More complex reductions that need to use the combine option (1226.8ms)\r\n  * test More complex array key view row testing (4948.5ms)\r\n\r\nBasicsTest\r\n  * test On restart, a request for creating an already existing db can not override (skipped)\r\n  * test DELETE'ing a non-existent doc should 404 (371.6ms)\r\n  * test Revs info status is good (233.1ms)\r\n  * test PUT doc has a Location header (skipped)\r\n  * test _bulk_docs POST error when body not an object (166.4ms)\r\n  * test oops, the doc id got lost in code nirwana (227.5ms)\r\n  * test Make sure you can do a seq=true option (287.4ms)\r\n  * test Create a document and save it to the database (371.1ms)\r\n  * test Database should be in _all_dbs (299.5ms)\r\n  * test Empty database should have zero docs (381.2ms)\r\n  * test Session contains adm context (1.3ms)\r\n  * test Creating a new DB should return location header (237.4ms)\r\n  * test Simple map functions (724.8ms)\r\n  * test _all_docs POST error when multi-get is not a {'key': [...]} structure (250.0ms)\r\n  * test Check for invalid document members (224.9ms)\r\n  * test Regression test for COUCHDB-954 (skipped)\r\n  * test POST doc with an _id field isn't overwritten by uuid (203.8ms)\r\n  * test Created database has appropriate db info name (223.5ms)\r\n  * test POST doc response has a Location header (209.2ms)\r\n  * test PUT error when body not an object (286.3ms)\r\n  * test Can create several documents (316.9ms)\r\n  * test PUT on existing DB should return 412 instead of 500 (205.6ms)\r\n  * test Creating a new DB with slashes should return Location header (COUCHDB-411) (343.2ms)\r\n  * test Welcome endpoint (1.4ms)\r\n\r\nSecurityValidationTest\r\n  * test Author presence and user security (593.3ms)\r\n  * test Saving document using the wrong credentials (2.7ms)\r\n  * test Non-admin user cannot save a ddoc (229.4ms)\r\n  * test _session API (1.1ms)\r\n  * test Ddoc writes with admin and replication contexts (280.8ms)\r\n  * test Force basic login (1.2ms)\r\n  * test Jerry can save a document normally (312.8ms)\r\n\r\nUUIDsTest\r\n  * test utc_id uuids are correct (13.6ms)\r\n  * test can return single uuid (2.9ms)\r\n  * test cache busting headers are set (1.3ms)\r\n  * test Bad Request error when exceeding max UUID count (1.6ms)\r\n  * test utc_random uuids are roughly random (30.6ms)\r\n  * test sequential uuids are sequential (30.4ms)\r\n  * test no duplicates in 1,000 UUIDs (17.8ms)\r\n  * test Method Not Allowed error on POST (1.7ms)\r\n\r\nViewCollationTest\r\n  * test inclusive_end=false (150.0ms)\r\n  * test descending collation order (8.8ms)\r\n  * test inclusive_end=true (18.1ms)\r\n  * test key query option (124.2ms)\r\n  * test ascending collation order (3.0ms)\r\n\r\nRewriteTest\r\n  * test Test basic rewrites on test_rewrite_suite_db%2Fwith_slashes (677.7ms)\r\n  * test Test basic rewrites on test_rewrite_suite_db (759.4ms)\r\n\r\nAllDocsTest\r\n  * test All Docs tests (546.3ms)\r\n\r\nLotsOfDocsTest\r\n  * test lots of docs with a regular view (1391.7ms)\r\n  * test lots of docs with _all_docs (1013.9ms)\r\n\r\nBulkDocsTest\r\n  * test bulk docs emits conflict error for duplicate doc `_id`s (336.2ms)\r\n  * test bulk docs supplies `id` if not provided in doc (202.3ms)\r\n  * test bulk docs can detect conflicts (357.1ms)\r\n  * test bulk docs raises error for missing `docs` parameter (161.4ms)\r\n  * test bulk docs raises error for invlaid `new_edits` parameter (219.8ms)\r\n  * test bulk docs raises error for invlaid `docs` parameter (136.7ms)\r\n  * test bulk docs raises error for `all_or_nothing` option (297.2ms)\r\n  * test bulk docs can create, update, & delete many docs per request (390.4ms)\r\n  * test bulk docs raises conflict error for combined update & delete (216.7ms)\r\n\r\nConfigTest\r\n  * test Blacklist is functional (14.8ms)\r\n  * test PORT `BUGGED` ?raw tests from config.js (skipped)\r\n  * test Server-side password hashing, and raw updates disabling that (54.4ms)\r\n  * test Keys not in the whitelist may not be modified (12.8ms)\r\n  * test Atoms, binaries, and strings suffice as whitelist sections and keys. (87.7ms)\r\n  * test CouchDB respects configured protocols (skipped)\r\n  * test Non-2-tuples in the whitelist are ignored (8.4ms)\r\n  * test Non-term whitelist values allow further modification of the whitelist (6.4ms)\r\n  * test Settings can be altered with undefined whitelist allowing any change (6.0ms)\r\n  * test Standard config options are present (1.6ms)\r\n  * test Non-list whitelist values allow further modification of the whitelist (5.7ms)\r\n\r\nHelperTest\r\n  * test retry_until times out (7.8ms)\r\n  * test retry_until handles assertions (0.01ms)\r\n  * test retry_until handles boolean conditions (0.01ms)\r\n\r\nRevisionTest\r\n  * test `new_edits: false` prevents bulk updates (COUCHDB-1178) (289.6ms)\r\n  * test multiple updates with same _rev raise conflict errors (342.0ms)\r\n  * test mismatched rev in body and etag returns error (270.6ms)\r\n  * test mismatched rev in body and query string returns error (186.4ms)\r\n\r\nCompactTest\r\n  * test compaction reduces size of deleted docs (1044.8ms)\r\n\r\nCoffeeTest\r\n  * test CoffeeScript basic functionality (833.7ms)\r\n\r\nBatchSaveTest\r\n  * test batch put with identical doc ids (441.2ms)\r\n  * test batch post (725.7ms)\r\n  * test batch put (633.7ms)\r\n\r\n\r\nFinished in 120.8 seconds\r\n135 tests, 0 failures, 5 skipped\r\n\r\nRandomized with seed 351341\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445351621/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445354595","html_url":"https://github.com/apache/couchdb/pull/1800#issuecomment-445354595","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1800","id":445354595,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM1NDU5NQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T20:23:22Z","updated_at":"2018-12-07T20:23:22Z","author_association":"CONTRIBUTOR","body":"@eiri I re-implemented the feature differently. Hopefully it works for win, I don't have access to windows to test it.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445354595/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445354919","html_url":"https://github.com/apache/couchdb/pull/1800#issuecomment-445354919","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1800","id":445354919,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM1NDkxOQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T20:24:34Z","updated_at":"2018-12-07T20:24:34Z","author_association":"CONTRIBUTOR","body":"@eiri: Let me know if I should rename `tests` into `suites` I cannot make up my mind.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445354919/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445360295","html_url":"https://github.com/apache/couchdb/pull/1800#issuecomment-445360295","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1800","id":445360295,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM2MDI5NQ==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T20:45:36Z","updated_at":"2018-12-07T20:45:36Z","author_association":"MEMBER","body":"@iilyak I don't have preferences for opt name, both used in eunit tests. A side note - can you, please, not force-push PRs in review? I've got a merge conflict when pulled your update.\r\n\r\n@wohali Can you please test the Windows part of this PR? The UNIX side works fine.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445360295/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445363413","html_url":"https://github.com/apache/couchdb/pull/1769#issuecomment-445363413","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1769","id":445363413,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM2MzQxMw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T20:58:19Z","updated_at":"2018-12-07T20:58:19Z","author_association":"MEMBER","body":"+1 LGTM","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445363413/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445363778","html_url":"https://github.com/apache/couchdb/pull/1800#issuecomment-445363778","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1800","id":445363778,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM2Mzc3OA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T20:59:48Z","updated_at":"2018-12-07T20:59:48Z","author_association":"MEMBER","body":"@eiri I'm seeing merge conflicts, can you resolve those first please?\r\n\r\n![mwsnap-046](https://user-images.githubusercontent.com/112292/49672437-1a87fe00-fa39-11e8-812f-fe4eead25520.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445363778/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445365288","html_url":"https://github.com/apache/couchdb/pull/1800#issuecomment-445365288","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1800","id":445365288,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM2NTI4OA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T21:05:53Z","updated_at":"2018-12-07T21:05:53Z","author_association":"MEMBER","body":"@wohali this is not my PR. @iilyak can you address this, please?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445365288/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445369525","html_url":"https://github.com/apache/couchdb/issues/1756#issuecomment-445369525","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1756","id":445369525,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM2OTUyNQ==","user":{"login":"dottorblaster","id":20770,"node_id":"MDQ6VXNlcjIwNzcw","avatar_url":"https://avatars.githubusercontent.com/u/20770?v=4","gravatar_id":"","url":"https://api.github.com/users/dottorblaster","html_url":"https://github.com/dottorblaster","followers_url":"https://api.github.com/users/dottorblaster/followers","following_url":"https://api.github.com/users/dottorblaster/following{/other_user}","gists_url":"https://api.github.com/users/dottorblaster/gists{/gist_id}","starred_url":"https://api.github.com/users/dottorblaster/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dottorblaster/subscriptions","organizations_url":"https://api.github.com/users/dottorblaster/orgs","repos_url":"https://api.github.com/users/dottorblaster/repos","events_url":"https://api.github.com/users/dottorblaster/events{/privacy}","received_events_url":"https://api.github.com/users/dottorblaster/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T21:23:01Z","updated_at":"2018-12-07T21:23:01Z","author_association":"MEMBER","body":"@wohali thanks for merging #1769! Now should we close this or we're going further with the discussion?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445369525/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445375649","html_url":"https://github.com/apache/couchdb/issues/1756#issuecomment-445375649","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1756","id":445375649,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM3NTY0OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T21:46:42Z","updated_at":"2018-12-07T21:46:42Z","author_association":"MEMBER","body":"Closed by #1769.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445375649/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445376365","html_url":"https://github.com/apache/couchdb/pull/1770#issuecomment-445376365","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1770","id":445376365,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM3NjM2NQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T21:49:21Z","updated_at":"2018-12-07T21:49:21Z","author_association":"MEMBER","body":"@wenli200133 Please edit the description so it says \"Closes #1384\" so the ticket auto-closes when this merges. Thank you for a great PR!\r\n\r\n@jiangphcn You can go ahead and merge this on @wenli200133 's behalf. Be sure #1384 gets closed.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445376365/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445377340","html_url":"https://github.com/apache/couchdb/issues/1799#issuecomment-445377340","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1799","id":445377340,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM3NzM0MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T21:52:59Z","updated_at":"2018-12-07T21:52:59Z","author_association":"MEMBER","body":"The intent was to restore the same purge functionality that existed in 1.x. 1.x did not require server admin permissions.\r\n\r\nI disagree that this should require server admin permissions. `_compact` is set to server-wide permissions because it can consume valuable server resources in a fashion that affect the performance of all other server operations when triggered. `_purge` does not meet that same criteria.\r\n\r\nI might agree that it should be reserved for *database* admins, but I'd like others to chime in first.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445377340/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445389245","html_url":"https://github.com/apache/couchdb/pull/1800#issuecomment-445389245","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1800","id":445389245,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTM4OTI0NQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-07T22:47:24Z","updated_at":"2018-12-07T22:47:24Z","author_association":"CONTRIBUTOR","body":"@wohali I re-based to fix conflicts\r\n@eiri Had to push force to fix conflicts again. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445389245/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445421120","html_url":"https://github.com/apache/couchdb/pull/1770#issuecomment-445421120","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1770","id":445421120,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTQyMTEyMA==","user":{"login":"jiangphcn","id":18000622,"node_id":"MDQ6VXNlcjE4MDAwNjIy","avatar_url":"https://avatars.githubusercontent.com/u/18000622?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangphcn","html_url":"https://github.com/jiangphcn","followers_url":"https://api.github.com/users/jiangphcn/followers","following_url":"https://api.github.com/users/jiangphcn/following{/other_user}","gists_url":"https://api.github.com/users/jiangphcn/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangphcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangphcn/subscriptions","organizations_url":"https://api.github.com/users/jiangphcn/orgs","repos_url":"https://api.github.com/users/jiangphcn/repos","events_url":"https://api.github.com/users/jiangphcn/events{/privacy}","received_events_url":"https://api.github.com/users/jiangphcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-08T02:05:43Z","updated_at":"2018-12-08T02:05:43Z","author_association":"CONTRIBUTOR","body":"@wohali sure, just rebased and merged this PR. Looks that #1384 is auto-closed.\r\n\r\n@wenli200133 thanks for your great work.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445421120/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445539575","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-445539575","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":445539575,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTUzOTU3NQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-09T13:45:43Z","updated_at":"2018-12-09T13:45:43Z","author_association":"MEMBER","body":"Docs then, the wizard expects to init the admin user on all nodes.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445539575/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445539726","html_url":"https://github.com/apache/couchdb/issues/1799#issuecomment-445539726","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1799","id":445539726,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTUzOTcyNg==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-09T13:47:48Z","updated_at":"2018-12-09T13:47:48Z","author_association":"MEMBER","body":"I think _purge should be member facing. If I can write docs to a db and accidentally post a credit card number, I want a way to take it out again without having to ask an admin.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445539726/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445544490","html_url":"https://github.com/apache/couchdb/issues/1799#issuecomment-445544490","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1799","id":445544490,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTU0NDQ5MA==","user":{"login":"fkaempfer","id":2357885,"node_id":"MDQ6VXNlcjIzNTc4ODU=","avatar_url":"https://avatars.githubusercontent.com/u/2357885?v=4","gravatar_id":"","url":"https://api.github.com/users/fkaempfer","html_url":"https://github.com/fkaempfer","followers_url":"https://api.github.com/users/fkaempfer/followers","following_url":"https://api.github.com/users/fkaempfer/following{/other_user}","gists_url":"https://api.github.com/users/fkaempfer/gists{/gist_id}","starred_url":"https://api.github.com/users/fkaempfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkaempfer/subscriptions","organizations_url":"https://api.github.com/users/fkaempfer/orgs","repos_url":"https://api.github.com/users/fkaempfer/repos","events_url":"https://api.github.com/users/fkaempfer/events{/privacy}","received_events_url":"https://api.github.com/users/fkaempfer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-09T14:57:09Z","updated_at":"2018-12-09T15:16:57Z","author_association":"CONTRIBUTOR","body":"Good points! I did not know about the 1.x legacy and I thought that the missing security was simply an oversight.\r\n\r\nI still think it is important to note that _purge let's you essentially bypass validate_doc_update, because it allows you to delete any document you wish. So, because of this, it might still be a good idea to restrict the endpoint to DB admins. Also the purge is not tracked in _changes, so it might become difficult to tell what was going on in the DB.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445544490/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445564104","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-445564104","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":445564104,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTU2NDEwNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-09T19:26:28Z","updated_at":"2018-12-09T19:26:28Z","author_association":"MEMBER","body":"@janl I want to make sure I understand this correctly. The correct workflow is:\r\n\r\n1) User pre-seeds the exact same admin user on all nodes by hand first with the same salt\r\n2) ???\r\n\r\nMy example shows that even setting the same admin user on all nodes first with different salts doesn't allow the cluster setup wizard to forcibly fix the salt on all nodes.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445564104/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445620034","html_url":"https://github.com/apache/couchdb/issues/1799#issuecomment-445620034","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1799","id":445620034,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTYyMDAzNA==","user":{"login":"jiangphcn","id":18000622,"node_id":"MDQ6VXNlcjE4MDAwNjIy","avatar_url":"https://avatars.githubusercontent.com/u/18000622?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangphcn","html_url":"https://github.com/jiangphcn","followers_url":"https://api.github.com/users/jiangphcn/followers","following_url":"https://api.github.com/users/jiangphcn/following{/other_user}","gists_url":"https://api.github.com/users/jiangphcn/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangphcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangphcn/subscriptions","organizations_url":"https://api.github.com/users/jiangphcn/orgs","repos_url":"https://api.github.com/users/jiangphcn/repos","events_url":"https://api.github.com/users/jiangphcn/events{/privacy}","received_events_url":"https://api.github.com/users/jiangphcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T01:47:34Z","updated_at":"2018-12-10T01:47:34Z","author_association":"CONTRIBUTOR","body":"Given current code base, if there is need only to allow admin to perform _purge, it is feasible to write additional codes to perform additional check to only authorize admin for _purge endpoint. Also it is possible to write audit log to track what was going on in the DB. `handle_req_after_auth/2` in https://github.com/apache/couchdb/blob/master/src/chttpd/src/chttpd.erl#L303 is one starting point which is based on EPI approach.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445620034/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445817766","html_url":"https://github.com/apache/couchdb/issues/1791#issuecomment-445817766","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1791","id":445817766,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTgxNzc2Ng==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T13:38:12Z","updated_at":"2018-12-10T13:38:12Z","author_association":"MEMBER","body":"Ive tried to reproduce this, and while I do see a memory increase, this just looks like Erlang being lazy with Garbage Collection.\r\n\r\nIt might be that you expect by limiting your Docker container to say 100MB ram, that CouchDB will honour that limit (which it wont without extra configuration).\r\n\r\nThis is one of the many reasons why we dont recommend running CouchDB inside of Docker for production setups.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445817766/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445824039","html_url":"https://github.com/apache/couchdb/issues/1791#issuecomment-445824039","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1791","id":445824039,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTgyNDAzOQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T13:58:37Z","updated_at":"2018-12-10T13:58:37Z","author_association":"MEMBER","body":"See http://blog.bugsense.com/post/74179424069/erlang-binary-garbage-collection-a-lovehate for more information.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445824039/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445825011","html_url":"https://github.com/apache/couchdb/issues/1791#issuecomment-445825011","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1791","id":445825011,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTgyNTAxMQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T14:01:29Z","updated_at":"2018-12-10T14:01:29Z","author_association":"MEMBER","body":"One more item, after waiting for quite a while to get 1GB memory usage, I ran this via a `remsh` and got back down to 100MB:\r\n\r\n`lists:map(fun erlang:garbage_collect/1, processes()).`","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445825011/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445901041","html_url":"https://github.com/apache/couchdb/pull/1800#issuecomment-445901041","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1800","id":445901041,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTkwMTA0MQ==","user":{"login":"van-mronov","id":550254,"node_id":"MDQ6VXNlcjU1MDI1NA==","avatar_url":"https://avatars.githubusercontent.com/u/550254?v=4","gravatar_id":"","url":"https://api.github.com/users/van-mronov","html_url":"https://github.com/van-mronov","followers_url":"https://api.github.com/users/van-mronov/followers","following_url":"https://api.github.com/users/van-mronov/following{/other_user}","gists_url":"https://api.github.com/users/van-mronov/gists{/gist_id}","starred_url":"https://api.github.com/users/van-mronov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/van-mronov/subscriptions","organizations_url":"https://api.github.com/users/van-mronov/orgs","repos_url":"https://api.github.com/users/van-mronov/repos","events_url":"https://api.github.com/users/van-mronov/events{/privacy}","received_events_url":"https://api.github.com/users/van-mronov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T17:30:17Z","updated_at":"2018-12-10T17:30:17Z","author_association":"CONTRIBUTOR","body":"Hi all! May I ask something?\r\n\r\n`mix` already provides ability to run only tests marked with some tag. Also, `@moduletag` module attribute adds its value as a tag for all tests  from this module.\r\n\r\nFor example, `test/basics_test.exs` defines `@moduletag :basics`.\r\nSo if you want to run only tests from this module you can do it by `mix test --only basics`.\r\n\r\nDoes current implementation of Makefile support running tests like `make elixir --only basics`?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445901041/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445919194","html_url":"https://github.com/apache/couchdb/pull/1803#issuecomment-445919194","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1803","id":445919194,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTkxOTE5NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T18:24:26Z","updated_at":"2018-12-10T18:24:26Z","author_association":"MEMBER","body":"Hi @jaydoane ,\r\n\r\nThis doesn't fix the problems in #1781.\r\n\r\nPlease read the use cases in https://github.com/apache/couchdb/issues/1781#issuecomment-445315292 and comment (either here or there).\r\n\r\nI am also not sure you want to use the exact same salt for all newly created admins - that would reduce security, unless I'm misunderstanding the patch?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445919194/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445931315","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-445931315","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":445931315,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTkzMTMxNQ==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T19:00:27Z","updated_at":"2018-12-10T19:00:27Z","author_association":"CONTRIBUTOR","body":"It sounds like there's still some uncertainty about how admin passwords should be set, but I can confirm what @wohali observes: the way setup is currently being used (in e.g. dev/run) does not result in admin passwords with the same hash, nor is it possible to have the same salt on all nodes since it is a new random number each time a password gets hashed. I opened https://github.com/apache/couchdb/pull/1803 in an attempt to solve both of these issues without changing the setup API.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445931315/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445952078","html_url":"https://github.com/apache/couchdb/pull/1774#issuecomment-445952078","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1774","id":445952078,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTk1MjA3OA==","user":{"login":"dch","id":284368,"node_id":"MDQ6VXNlcjI4NDM2OA==","avatar_url":"https://avatars.githubusercontent.com/u/284368?v=4","gravatar_id":"","url":"https://api.github.com/users/dch","html_url":"https://github.com/dch","followers_url":"https://api.github.com/users/dch/followers","following_url":"https://api.github.com/users/dch/following{/other_user}","gists_url":"https://api.github.com/users/dch/gists{/gist_id}","starred_url":"https://api.github.com/users/dch/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dch/subscriptions","organizations_url":"https://api.github.com/users/dch/orgs","repos_url":"https://api.github.com/users/dch/repos","events_url":"https://api.github.com/users/dch/events{/privacy}","received_events_url":"https://api.github.com/users/dch/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T20:00:26Z","updated_at":"2018-12-10T20:00:26Z","author_association":"CONTRIBUTOR","body":"On Mon, 10 Dec 2018, at 19:16, Joan Touzet wrote:\n> wohali approved this pull request.\n> \n> Fix the deprecation, then +1.\n> \n> WARNING: If you are planning on introducing haproxy as a mandatory \n> element for testing elixir stuff with a cluster, you need to know that \n> **there is no haproxy on Windows. Period.** You'll need an alternative.\n\n*coughs* and runs away very quickly:\n\nhttps://crlog.wordpress.com/2012/09/29/install-haproxy-on-windows-cygwin-good-for-testing/\n\nIf this really is a requirement, maybe consider an erlangy reverse proxy. https://github.com/heroku/vegur comes to mind, and https://github.com/edwardt/somdune was used in iriscouch days, but probably doesn't have the plumbing you'd need. There are a few  elixir based ones on hex.pm but I haven't ever used them, all of them use cowboy in some form under the hood.\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445952078/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445957407","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-445957407","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":445957407,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTk1NzQwNw==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T20:17:21Z","updated_at":"2018-12-10T20:17:21Z","author_association":"CONTRIBUTOR","body":"Commenting on @wohali's examples:\r\n\r\n> Our instructions then tell users to set an initial admin username and password on each node independently. In this example, I don't set a password on node 2, but I do on nodes 1 and 3:\r\n\r\nThe docs specify that the `enable_cluster` action, using the same admin username and password, must happen on every node in the cluster, so I don't understand why you skipped node 2 here. I definitely would not expect that to work in general.\r\n\r\n> Now I proceed to join the nodes into the cluster. Node 2 goes as expected:\r\n\r\nBut the command you show is\r\n```\r\ncurl -X POST -H \"Content-Type: application/json\" http://admin:password@localhost:15984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin\", \"password\":\"password\", \"port\": 25984, \"node_count\": \"3\", \"remote_node\": \"127.0.0.1\"}'\r\n```\r\nwhich is the same \"enable_cluster\" action as used previously on nodes `couchdb1` and `couchdb3`, and is effectively setting the password on that node. When you write \"join the nodes\", I was expecting the \"add_node\" action, which is responsible for making sure the cookies are the same and starting Erlang distribution, etc.\r\n\r\nFor the second example using different admin users, the docs seem fairly clear to me that it should actually be the same admin user for each node, so I wouldn't expect that to work.\r\n\r\n---\r\n\r\nSo, here's my simple minded summary of how we expect users to set up a cluster:\r\n\r\n1. Each node in turn is sent a request with the `enable_cluster` action using identical admin usernames & passwords:\r\n```\r\ncurl -X POST -H \"Content-Type: application/json\" http://localhost:15984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin\", \"password\":\"password\", \"node_count\":\"3\"}'\r\ncurl -X POST -H \"Content-Type: application/json\" http://localhost:25984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin\", \"password\":\"password\", \"node_count\":\"3\"}'\r\ncurl -X POST -H \"Content-Type: application/json\" http://localhost:35984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin\", \"password\":\"password\", \"node_count\":\"3\"}'\r\n```\r\nAt this point, we expect the salts to differer on all nodes. One thing that's confusing about the docs is that they specify using a username:password in those commands, but that would not work if no admin passwords have been configured in e.g. local.ini. Maybe we should remove those creds from the docs if we're assuming no previously configured admins?\r\n\r\n2. The \"coordinator\" node is sent requests to join with the other nodes in the cluster. In this example, the node listening on 15984 is coordinating:\r\n```\r\ncurl -X POST -H \"Content-Type: application/json\" http://admin:password@localhost:15984/_cluster_setup -d '{\"action\": \"add_node\", \"host\":\"127.0.0.1\", \"port\": 25984, \"username\": \"admin\", \"password\":\"password\"}'\r\ncurl -X POST -H \"Content-Type: application/json\" http://admin:password@localhost:15984/_cluster_setup -d '{\"action\": \"add_node\", \"host\":\"127.0.0.1\", \"port\": 35984, \"username\": \"admin\", \"password\":\"password\"}'\r\n```\r\nNote that we're using the admin creds set in previous \"enable_cluster\" actions\r\n\r\n3. The coordinator node is sent a final request/action to \"finish_cluster\", which basically ensures the system dbs are created.\r\n```\r\ncurl -X POST -H \"Content-Type: application/json\" http://admin:password@lcoalhost:15984/_cluster_setup -d '{\"action\": \"finish_cluster\"}'\r\n```\r\nBy extending the functionality of this request we could sync the admin passwords configured in the \"enable_cluster\" requests. However, if we don't also configure a common salt among nodes, subsequent admin users created with e.g. `rpc:multicall(config, set, [\"admins\", \"my-admin\", \"pass\"]).` will not have the same salt/hashes on all nodes.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445957407/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445970974","html_url":"https://github.com/apache/couchdb/pull/1800#issuecomment-445970974","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1800","id":445970974,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTk3MDk3NA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T21:00:32Z","updated_at":"2018-12-10T21:00:32Z","author_association":"MEMBER","body":"@van-mronov This is what this PR is about. It adds an option `tests` to `make elixir` target that passed further to `mix test`.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445970974/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445972074","html_url":"https://github.com/apache/couchdb/pull/1774#issuecomment-445972074","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1774","id":445972074,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTk3MjA3NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T21:04:03Z","updated_at":"2018-12-10T21:04:03Z","author_association":"MEMBER","body":"+1 to an Erlang-y reverse proxy for testing if necessary.\r\n\r\nI am hoping @iilyak only updated the haproxy section because it needed it for the >3 node stuff, not because it'll actually be necessary in testing. We'll see ;)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445972074/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445977015","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-445977015","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":445977015,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NTk3NzAxNQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T21:18:22Z","updated_at":"2018-12-10T21:18:22Z","author_association":"MEMBER","body":"So there's 2 things you've left unaddressed here that I think need to be explained before I can discuss your response.\r\n\r\n1. Why are we bothering to pass in both a `username/password` and `remote_current_user/password` pair if we require everything to be identical on all nodes? I would have thought that the `username/password` pair is the admin user we are trying to create everywhere, and the `remote_current_user/password` pair is the pre-existing admin user on that remote node we need to use to affect change on that node.\r\n\r\n    1. In an ideal world, assuming these two pairs of data are allowed different, why couldn't the `remote` version be some unique auto-generated set of creds on every node? I'm looking towards CouchDB 3.0 where we intend to completely remove admin party. In this situation, nodes will stand up with an arbitrarily generated admin/password pair, and there is no way (short of pre-seeding your own `local.ini` file) that Couch could possibly know `a priori` what the eventual cluster's admin/password pair would be. **But**, if it printed out its randomly generated u/p on startup (similar to how `dev/run` does it), that info could be gathered by a script or a human and plugged into the cluster wizard on setup. These would be the `remote` credentials, and the primary `username/password` pair passed in via JSON would be the newly created admin user, with the unified salt. (The wizard could then *also* remove the autogenerated u/p credentials, as a bonus feature to be added later.)\r\n\r\n    2. Assuming for whatever reason we don't want to do 1, why are we even bothering to pass in 2 sets of credentials, if the only way this works is if we forcibly manually set the creds on every node to be identical at the start? I notice you've removed the second set of credentials in your example, but that still has confusion with the difference between the two sets of creds - if we're forcing it via the first step, why bother even supporting passing them in?\r\n\r\n2. The situation where a different admin password is set on a node and I forgot to pass in the correct `remote_current_user/password` should have been an error, no? It shouldn't have been able to make *any* change to that remote node. And yet we got back an `{\"ok\":true}`. That's got to be wrong.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/445977015/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446001828","html_url":"https://github.com/apache/couchdb/pull/1800#issuecomment-446001828","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1800","id":446001828,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjAwMTgyOA==","user":{"login":"van-mronov","id":550254,"node_id":"MDQ6VXNlcjU1MDI1NA==","avatar_url":"https://avatars.githubusercontent.com/u/550254?v=4","gravatar_id":"","url":"https://api.github.com/users/van-mronov","html_url":"https://github.com/van-mronov","followers_url":"https://api.github.com/users/van-mronov/followers","following_url":"https://api.github.com/users/van-mronov/following{/other_user}","gists_url":"https://api.github.com/users/van-mronov/gists{/gist_id}","starred_url":"https://api.github.com/users/van-mronov/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/van-mronov/subscriptions","organizations_url":"https://api.github.com/users/van-mronov/orgs","repos_url":"https://api.github.com/users/van-mronov/repos","events_url":"https://api.github.com/users/van-mronov/events{/privacy}","received_events_url":"https://api.github.com/users/van-mronov/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T22:40:25Z","updated_at":"2018-12-10T22:40:25Z","author_association":"CONTRIBUTOR","body":"@eiri yeah, I mean if pass `--only basics` to `tests` option will it pass further as `mix test --only basics`?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446001828/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446005878","html_url":"https://github.com/apache/couchdb/pull/1800#issuecomment-446005878","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1800","id":446005878,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjAwNTg3OA==","user":{"login":"eiri","id":70542,"node_id":"MDQ6VXNlcjcwNTQy","avatar_url":"https://avatars.githubusercontent.com/u/70542?v=4","gravatar_id":"","url":"https://api.github.com/users/eiri","html_url":"https://github.com/eiri","followers_url":"https://api.github.com/users/eiri/followers","following_url":"https://api.github.com/users/eiri/following{/other_user}","gists_url":"https://api.github.com/users/eiri/gists{/gist_id}","starred_url":"https://api.github.com/users/eiri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/eiri/subscriptions","organizations_url":"https://api.github.com/users/eiri/orgs","repos_url":"https://api.github.com/users/eiri/repos","events_url":"https://api.github.com/users/eiri/events{/privacy}","received_events_url":"https://api.github.com/users/eiri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T22:55:36Z","updated_at":"2018-12-10T22:55:36Z","author_association":"MEMBER","body":"I don't know, but by a look at the code I don't see why it wouldn't. Try to check out this branch and just try it?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446005878/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446008527","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-446008527","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":446008527,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjAwODUyNw==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T23:06:04Z","updated_at":"2018-12-10T23:06:04Z","author_association":"CONTRIBUTOR","body":"Taking a step back for a sec, the docs definitely seem confusing on a couple points:\r\n\r\nFirst, they say \"On each node we need to run the following command to set up the node:\"\r\n```\r\ncurl -X POST -H \"Content-Type: application/json\" http://admin:password@127.0.0.1:5984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin\", \"password\":\"password\", \"node_count\":\"3\"}'\r\n```\r\nbut then a few paragraphs later it says: \"To join a node to the cluster, run these commands *for* each node you want to add:\"\r\n```\r\ncurl -X POST -H \"Content-Type: application/json\" http://admin:password@<setup-coordination-node>:5984/_cluster_setup -d '{\"action\": \"enable_cluster\", \"bind_address\":\"0.0.0.0\", \"username\": \"admin\", \"password\":\"password\", \"port\": 5984, \"node_count\": \"3\", \"remote_node\": \"<remote-node-ip>\", \"remote_current_user\": \"<remote-node-username>\", \"remote_current_password\": \"<remote-node-password>\" }'\r\ncurl -X POST -H \"Content-Type: application/json\" http://admin:password@<setup-coordination-node>:5984/_cluster_setup -d '{\"action\": \"add_node\", \"host\":\"<remote-node-ip>\", \"port\": <remote-node-port>, \"username\": \"admin\", \"password\":\"password\"}'\r\n```\r\n\r\nSo, the first paragraph implies each node separately needs \"enable_cluster\" run on it (and also that is how [dev/run currently does it)](https://github.com/apache/couchdb/blob/master/dev/run#L519-L520), while the second implies you can actually make all setup requests via the coordinator node.  However, perhaps the most significant difference between \"direct\" and \"remote\" cluster enabling, is that the latter [uses the password hash](https://github.com/apache/couchdb/blob/master/src/setup/src/setup.erl#L115-L120), which I _finally_ understand is how @janl claims that synced password hashes are already fixed. But since it only works for \"remote\" cluster enabling, is not well documented, and doesn't sync hashes for admin users added subsequent to cluster setup, it could perhaps still use some improvement.\r\n\r\nAnyway, to try to address @wohali's questions:\r\n\r\n> Why are we bothering to pass in both a username/password and remote_current_user/password pair if we require everything to be identical on all nodes? \r\n\r\nIt appears that we're trying to handle a situation where known admin creds may already exist on the nodes. In that case, we'd need to use those creds either in a basic auth header if we're making direct requests, or setting them as `remote_current_user/password` in the case when the [coordinator is making the requests](https://github.com/apache/couchdb/blob/master/src/setup/src/setup.erl#L98-L113). \r\n\r\n> I would have thought that the username/password pair is the admin user we are trying to create everywhere, and the remote_current_user/password pair is the pre-existing admin user on that remote node we need to use to affect change on that node.\r\n\r\nThat is my understanding as well.\r\n\r\n> In an ideal world, assuming these two pairs of data are allowed different, why couldn't the remote version be some unique auto-generated set of creds on every node?\r\n\r\nI think they could.\r\n\r\n> Assuming for whatever reason we don't want to do 1, why are we even bothering to pass in 2 sets of credentials, if the only way this works is if we forcibly manually set the creds on every node to be identical at the start? \r\n\r\nI assume the idea is that the remote creds (and basic auth header for coordinator) are to be used for existing admin user(s), if any, but the \"username\" and \"password\" fields are for a single, new admin user common to all nodes. I think this interpretation is supported by how the \"remote\" enable_cluster uses the [existing admin user's hash](https://github.com/apache/couchdb/blob/master/src/setup/src/setup.erl#L115).\r\n\r\n> I notice you've removed the second set of credentials in your example, but that still has confusion with the difference between the two sets of creds - if we're forcing it via the first step, why bother even supporting passing them in?\r\n\r\nI think I answered that already. Please LMK though if it's not clear.\r\n\r\n> The situation where a different admin password is set on a node and I forgot to pass in the correct remote_current_user/password should have been an error, no? It shouldn't have been able to make any change to that remote node. And yet we got back an {\"ok\":true}. That's got to be wrong.\r\n\r\nAccording to [this](https://github.com/apache/couchdb/blob/master/src/setup/src/setup.erl#L138-L139) we should treat anything other than a 200 as an error. However, you will note that we [only handle one kind of error here](https://github.com/apache/couchdb/blob/master/src/setup/src/setup_httpd.erl#L80-L81) `cluster_enabled`, so I think you're right that this needs better error handling for the situation you describe.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446008527/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446010133","html_url":"https://github.com/apache/couchdb/issues/1334#issuecomment-446010133","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1334","id":446010133,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjAxMDEzMw==","user":{"login":"penzn","id":41971413,"node_id":"MDQ6VXNlcjQxOTcxNDEz","avatar_url":"https://avatars.githubusercontent.com/u/41971413?v=4","gravatar_id":"","url":"https://api.github.com/users/penzn","html_url":"https://github.com/penzn","followers_url":"https://api.github.com/users/penzn/followers","following_url":"https://api.github.com/users/penzn/following{/other_user}","gists_url":"https://api.github.com/users/penzn/gists{/gist_id}","starred_url":"https://api.github.com/users/penzn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/penzn/subscriptions","organizations_url":"https://api.github.com/users/penzn/orgs","repos_url":"https://api.github.com/users/penzn/repos","events_url":"https://api.github.com/users/penzn/events{/privacy}","received_events_url":"https://api.github.com/users/penzn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-10T23:12:11Z","updated_at":"2018-12-10T23:12:11Z","author_association":"NONE","body":"Sorry to bother, I noticed Microsoft/ChakraCore#5857 and could not help but wonder what the status of Chakra-based implementation was and if any help would be accepted.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446010133/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446048946","html_url":"https://github.com/apache/couchdb/issues/1334#issuecomment-446048946","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1334","id":446048946,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjA0ODk0Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-11T02:25:44Z","updated_at":"2018-12-11T02:25:44Z","author_association":"MEMBER","body":"Hi @penzn, we are evaluating our options because of that issue at present - we are unconvinced ChakraCore will be an enduring JS target at this point, without Edge to drive its ongoing development.\r\n\r\nThe existing work is at https://github.com/cloudant-labs/erlang-chakracore","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446048946/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446064979","html_url":"https://github.com/apache/couchdb/pull/1789#issuecomment-446064979","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1789","id":446064979,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjA2NDk3OQ==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-11T04:03:46Z","updated_at":"2018-12-11T04:09:26Z","author_association":"CONTRIBUTOR","body":"After `make clean && git clean -xffd && ./configure --dev && make`, I'm seeing numerous setup failures and a couple test failures running `make eunit apps=chttpd`:\r\n```\r\n=======================================================\r\n  Failed: 2.  Skipped: 0.  Passed: 184.\r\n```\r\ncompared to a successful result when run against the master commit this is based against:\r\n```\r\n=======================================================\r\n  All 233 tests passed.\r\n```\r\nThe two failures are\r\n```\r\nchttpd_view:123: t_check_include_docs_throw_validation_error...*failed*\r\nin function chttpd_view:'-t_check_include_docs_throw_validation_error/0-fun-0-'/0 (src/chttpd_view.erl, line 127)\r\n**error:{assertException,\r\n    [{module,chttpd_view},\r\n     {line,127},\r\n     {expression,\r\n         \"multi_query_view ( Req , db , ddoc , << \\\"v\\\" >> , [ Query ] )\"},\r\n     {pattern,\"{ throw , Throw , [...] }\"},\r\n     {unexpected_exception,\r\n         {error,function_clause,\r\n             [{couch_db,is_clustered,[db],[{file,...},{...}]},\r\n              {fabric_util,validate_args,3,[{...}|...]},\r\n              {lists,map,2,[...]},\r\n              {chttpd_view,multi_query_view,5,...},\r\n              {chttpd_view,\r\n                  '-t_check_include_docs_throw_validation_error/0-fun-0-',...},\r\n              {eunit_test,...},\r\n              {...}|...]}}]}\r\n  output:<<\"\">>\r\n\r\nchttpd_view:132: t_check_user_can_override_individual_query_type...*failed*\r\nin function couch_db:is_clustered/1 (src/couch_db.erl, line 217)\r\n  called as is_clustered(db)\r\n```\r\n\r\nThere's also a failure in mem3:\r\n```\r\nmodule 'mem3_util_test'\r\n  mem3_util_test: hash_test...*failed*\r\nin function mem3_util:hash/1\r\n  called as hash(0)\r\nin call from mem3_util_test:'-hash_test/0-fun-0-'/0 (test/mem3_util_test.erl, line 19)\r\nin call from mem3_util_test:hash_test/0 (test/mem3_util_test.erl, line 19)\r\nin call from mem3_util_test:hash_test/0\r\n**error:undef\r\n  output:<<\"\">>\r\n```\r\nsince `mem3_util:hash` has been removed.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446064979/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446175696","html_url":"https://github.com/apache/couchdb/pull/1774#issuecomment-446175696","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1774","id":446175696,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjE3NTY5Ng==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-11T11:51:08Z","updated_at":"2018-12-11T11:51:08Z","author_association":"CONTRIBUTOR","body":"We are not making haproxy a requirement for testing. We just fixing the configuration for the case when people start cluster with `dev/run --with-haproxy -n 10`.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446175696/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446264526","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-446264526","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":446264526,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjI2NDUyNg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-11T16:22:09Z","updated_at":"2018-12-11T16:22:09Z","author_association":"MEMBER","body":"So we have a few bugs here: \r\n\r\n1. Docs are unclear on what actually works now (and, unfortunately, so am I still)\r\n2. Code isn't handling errors correctly when bad data is passed in\r\n3. There's still at least one situation described above where we're not doing the right thing","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446264526/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446455221","html_url":"https://github.com/apache/couchdb/pull/1800#issuecomment-446455221","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1800","id":446455221,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjQ1NTIyMQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-12T04:09:09Z","updated_at":"2018-12-12T04:09:09Z","author_association":"MEMBER","body":"@iilyak sorry for the delay, I've been getting Jenkins/FreeBSD working again. I'll be able to look at this tomorrow.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446455221/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446662664","html_url":"https://github.com/apache/couchdb/issues/1806#issuecomment-446662664","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1806","id":446662664,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjY2MjY2NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-12T17:00:24Z","updated_at":"2018-12-12T17:00:24Z","author_association":"MEMBER","body":"Hi there,\r\n\r\nUnfortunately, we can't answer this question, and it is not a CouchDB bug itself.\r\n\r\nIf you are looking for general support with using CouchDB, please try one of these other options:\r\n\r\n* The user mailing list. Signup instructions are [here](http://couchdb.apache.org/#mailing-lists)\r\n* The Slack/IRC chat room. Joining instructions are [here](http://couchdb.apache.org/#chat)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446662664/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446723388","html_url":"https://github.com/apache/couchdb/pull/1789#issuecomment-446723388","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1789","id":446723388,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NjcyMzM4OA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-12T19:59:10Z","updated_at":"2018-12-12T19:59:10Z","author_association":"MEMBER","body":"@jaydoane chttpd tests should be fixed now. Am running through checking that everything else works as well.\r\n\r\nFix for the ones you noted was to use `test_util:fake_db/1` instead of the atom `db`.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446723388/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446757348","html_url":"https://github.com/apache/couchdb/pull/1803#issuecomment-446757348","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1803","id":446757348,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Njc1NzM0OA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-12T21:50:33Z","updated_at":"2018-12-12T21:50:33Z","author_association":"MEMBER","body":"@jaydoane do we still want to merge this, even though it only addresses one specific scenario discussed in #1781?\r\n\r\nIf so, please remove the \"Fixes #1781\" from the description, as it isn't a complete solution. I'd also like a +1 from someone more familiar with the code than I before merging.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446757348/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446766814","html_url":"https://github.com/apache/couchdb/pull/1800#issuecomment-446766814","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1800","id":446766814,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Njc2NjgxNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-12T22:23:01Z","updated_at":"2018-12-12T22:23:01Z","author_association":"MEMBER","body":"@iilyak You seem to be failing some `credo` checks:\r\n\r\n```\r\nC:\\relax\\couchdb>make elixir tests=test\\basics_test.exs\r\nResolving Hex dependencies...\r\nDependency resolution completed:\r\nUnchanged:\r\n  bunt 0.2.0\r\n  credo 1.0.0\r\n  httpotion 3.1.0\r\n  ibrowse 4.4.1\r\n  jason 1.1.2\r\n  jiffy 0.15.2\r\nAll dependencies up to date\r\nChecking 21 source files ...\r\n\r\n  Software Design\r\n\r\n [D]  Found a TODO tag in a comment: # TODO: port sever_port tests from\r\n       config.js\r\n       test/config_test.exs:73 #(ConfigTest.delete_config)\r\n [D]  Found a TODO tag in a comment: # TODO: In JS we re-fetch _changes with\r\n       since_seq, is that\r\n       test/replication_test.exs:587 #(ReplicationTest.run_since_seq_repl)\r\n [D]  Found a TODO tag in a comment: # TODO: Parameterize these\r\n       test/replication_test.exs:9 #(ReplicationTest)\r\n [D]  Found a TODO tag in a comment: # TODO: switch this to _local when that's\r\n       landed\r\n       test/config_test.exs:12 #(ConfigTest)\r\n [D]  Found a TODO tag in a comment: # TODO: port remainder of\r\n       security_validation.js suite\r\n       test/security_validation_test.exs:205 #(SecurityValidationTest)\r\n  ...  (5 more, use `-a` to show them)\r\n\r\n  Code Readability\r\n\r\n [R]  Modules should have a @moduledoc tag.\r\n       lib/couch/db_test.ex:1:11 #(Couch.DBTest)\r\n [R]  Modules should have a @moduledoc tag.\r\n       test/support/couch_test_case.ex:1:11 #(CouchTestCase)\r\n\r\nPlease report incorrect results: https://github.com/rrrene/credo/issues\r\n\r\nAnalysis took 8.7 seconds (0.1s to load, 8.5s running checks)\r\n126 mods/funs, found 2 code readability issues, 10 software design suggestions.\r\n\r\nShowing priority issues:     (use `--strict` to show all issues, `--help` for options).\r\nmake: *** [elixir-credo] Error 4\r\n```\r\n\r\n(yes, that is corrupted attempts at unicode in a `CMD.EXE` shell)\r\n\r\nTemporarily removing `elixir-credo` as a dependency for `elixir` from the Makefile for testing:\r\n\r\n```\r\nC:\\relax\\couchdb>make elixir tests=test\\basics_test.exs\r\nThe system cannot find the path specified.\r\nmake: [devclean] Error 3 (ignored)\r\nThe system cannot find the path specified.\r\nmake: [devclean] Error 3 (ignored)\r\nThe system cannot find the path specified.\r\nmake: [devclean] Error 3 (ignored)\r\n[ * ] Setup environment ... ok\r\n[ * ] Ensure CouchDB is built ... ok\r\n[ * ] Prepare configuration files ... ok\r\n[ * ] Start node node1 ... ok\r\n[ * ] Start node node2 ... ok\r\n[ * ] Start node node3 ... ok\r\n[ * ] Check node at http://127.0.0.1:15984/ ... ok\r\n[ * ] Check node at http://127.0.0.1:25984/ ... ok\r\n[ * ] Check node at http://127.0.0.1:35984/ ... ok\r\n[ * ] Running cluster setup ... ok\r\n[ * ] Exec command test\\elixir\\run.cmd test\\basics_test.exs ... * creating c:/Users/wohali/.mix/archives/hex-0.18.2\r\n* creating c:/Users/wohali/.mix/rebar\r\n* creating c:/Users/wohali/.mix/rebar3\r\nResolving Hex dependencies...\r\nDependency resolution completed:\r\nUnchanged:\r\n  bunt 0.2.0\r\n  credo 1.0.0\r\n  httpotion 3.1.0\r\n  ibrowse 4.4.1\r\n  jason 1.1.2\r\n  jiffy 0.15.2\r\nAll dependencies up to date\r\n==> bunt\r\nCompiling 2 files (.ex)\r\nGenerated bunt app\r\n===> Compiling jiffy\r\n==> jason\r\nCompiling 8 files (.ex)\r\nGenerated jason app\r\n==> credo\r\nCompiling 180 files (.ex)\r\nGenerated credo app\r\n===> Compiling ibrowse\r\n==> httpotion\r\nCompiling 1 file (.ex)\r\nGenerated httpotion app\r\n==> foo\r\nCompiling 3 files (.ex)\r\nGenerated foo app\r\nExcluding tags: [pending: true]\r\n\r\n\r\nBasicsTest\r\n  * test oops, the doc id got lost in code nirwana (140.0ms)\r\n  * test Created database has appropriate db info name (235.0ms)\r\n  * test Database should be in _all_dbs (250.0ms)\r\n  * test Make sure you can do a seq=true option (203.0ms)\r\n  * test Session contains adm context (47.0ms)\r\n  * test PUT on existing DB should return 412 instead of 500 (125.0ms)\r\n  * test POST doc with an _id field isn't overwritten by uuid (188.0ms)\r\n  * test PUT error when body not an object (156.0ms)\r\n  * test POST doc response has a Location header (234.0ms)\r\n  * test _all_docs POST error when multi-get is not a {'key': [...]} structure (234.0ms)\r\n  * test Regression test for COUCHDB-954 (excluded)\r\n  * test Welcome endpoint (0.00ms)\r\n  * test Empty database should have zero docs (187.0ms)\r\n  * test Revs info status is good (141.0ms)\r\n  * test Simple map functions (969.0ms)\r\n  * test PUT doc has a Location header (excluded)\r\n  * test Check for invalid document members (219.0ms)\r\n  * test Can create several documents (281.0ms)\r\n  * test Creating a new DB with slashes should return Location header (COUCHDB-411) (235.0ms)\r\n  * test On restart, a request for creating an already existing db can not override (excluded)\r\n  * test Creating a new DB should return location header (156.0ms)\r\n  * test _bulk_docs POST error when body not an object (109.0ms)\r\n  * test Create a document and save it to the database (312.0ms)\r\n  * test DELETE'ing a non-existent doc should 404 (188.0ms)\r\n\r\n\r\nFinished in 5.9 seconds\r\n24 tests, 0 failures, 3 excluded\r\n\r\nRandomized with seed 785000\r\n```\r\n\r\nNext test case (2 files):\r\n```\r\nC:\\relax\\couchdb>make elixir tests=test\\basics_test.exs,test\\config_test.exs\r\n[ * ] Setup environment ... ok\r\n[ * ] Ensure CouchDB is built ... ok\r\n[ * ] Prepare configuration files ... ok\r\n[ * ] Start node node1 ... ok\r\n[ * ] Start node node2 ... ok\r\n[ * ] Start node node3 ... ok\r\n[ * ] Check node at http://127.0.0.1:15984/ ... ok\r\n[ * ] Check node at http://127.0.0.1:25984/ ... ok\r\n[ * ] Check node at http://127.0.0.1:35984/ ... ok\r\n[ * ] Running cluster setup ... ok\r\n[ * ] Exec command test\\elixir\\run.cmd test\\basics_test.exs test\\config_test.exs ... * creating c:/Users/wohali/.mix/archives/hex-0.18.2\r\n* creating c:/Users/wohali/.mix/rebar\r\n* creating c:/Users/wohali/.mix/rebar3\r\nResolving Hex dependencies...\r\nDependency resolution completed:\r\nUnchanged:\r\n  bunt 0.2.0\r\n  credo 1.0.0\r\n  httpotion 3.1.0\r\n  ibrowse 4.4.1\r\n  jason 1.1.2\r\n  jiffy 0.15.2\r\nAll dependencies up to date\r\nExcluding tags: [pending: true]\r\n\r\n\r\nBasicsTest\r\n  * test PUT on existing DB should return 412 instead of 500 (125.0ms)\r\n  * test Simple map functions (547.0ms)\r\n\r\n  1) test Simple map functions (BasicsTest)\r\n     test/basics_test.exs:130\r\n     Assertion with == failed\r\n     code:  assert Couch.get(\"/#{db_name}\").body()[\"doc_count\"] == 6\r\n     left:  5\r\n     right: 6\r\n     stacktrace:\r\n       test/basics_test.exs:144: (test)\r\n\r\n  * test POST doc response has a Location header (219.0ms)\r\n  * test Regression test for COUCHDB-954 (excluded)\r\n  * test Make sure you can do a seq=true option (141.0ms)\r\n  * test Empty database should have zero docs (172.0ms)\r\n  * test POST doc with an _id field isn't overwritten by uuid (188.0ms)\r\n  * test Check for invalid document members (187.0ms)\r\n  * test _bulk_docs POST error when body not an object (187.0ms)\r\n  * test Create a document and save it to the database (141.0ms)\r\n  * test Created database has appropriate db info name (297.0ms)\r\n  * test PUT error when body not an object (125.0ms)\r\n  * test On restart, a request for creating an already existing db can not override (excluded)\r\n  * test oops, the doc id got lost in code nirwana (234.0ms)\r\n  * test DELETE'ing a non-existent doc should 404 (171.0ms)\r\n  * test Creating a new DB with slashes should return Location header (COUCHDB-411) (203.0ms)\r\n  * test Session contains adm context (0.00ms)\r\n  * test Creating a new DB should return location header (265.0ms)\r\n  * test Revs info status is good (141.0ms)\r\n  * test Welcome endpoint (0.00ms)\r\n  * test Can create several documents (188.0ms)\r\n  * test _all_docs POST error when multi-get is not a {'key': [...]} structure (188.0ms)\r\n  * test PUT doc has a Location header (excluded)\r\n  * test Database should be in _all_dbs (172.0ms)\r\n\r\nConfigTest\r\n  * test CouchDB respects configured protocols (excluded)\r\n  * test Standard config options are present (0.00ms)\r\n  * test Settings can be altered with undefined whitelist allowing any change (16.0ms)\r\n  * test Non-term whitelist values allow further modification of the whitelist (94.0ms)\r\n  * test Keys not in the whitelist may not be modified (15.0ms)\r\n  * test Non-list whitelist values allow further modification of the whitelist (16.0ms)\r\n  * test Blacklist is functional (31.0ms)\r\n  * test Atoms, binaries, and strings suffice as whitelist sections and keys. (47.0ms)\r\n  * test PORT `BUGGED` ?raw tests from config.js (excluded)\r\n  * test Non-2-tuples in the whitelist are ignored (16.0ms)\r\n  * test Server-side password hashing, and raw updates disabling that (31.0ms)\r\n\r\n\r\nFinished in 5.5 seconds\r\n35 tests, 1 failure, 5 excluded\r\n\r\nRandomized with seed 568000\r\nmake: *** [elixir] Error 1\r\n```\r\n\r\nOur test cases are known a bit flaky, that's fine, it correctly ran just those 2 files\r\n\r\nFinal test case:\r\n```\r\nC:\\relax\\couchdb>make elixir tests=test\\basics_test.exs:17\r\n[ * ] Setup environment ... ok\r\n[ * ] Ensure CouchDB is built ... ok\r\n[ * ] Prepare configuration files ... ok\r\n[ * ] Start node node1 ... ok\r\n[ * ] Start node node2 ... ok\r\n[ * ] Start node node3 ... ok\r\n[ * ] Check node at http://127.0.0.1:15984/ ... ok\r\n[ * ] Check node at http://127.0.0.1:25984/ ... ok\r\n[ * ] Check node at http://127.0.0.1:35984/ ... ok\r\n[ * ] Running cluster setup ... ok\r\n[ * ] Exec command test\\elixir\\run.cmd test\\basics_test.exs:17 ... * creating c:/Users/wohali/.mix/archives/hex-0.18.2\r\n* creating c:/Users/wohali/.mix/rebar\r\n* creating c:/Users/wohali/.mix/rebar3\r\nResolving Hex dependencies...\r\nDependency resolution completed:\r\nUnchanged:\r\n  bunt 0.2.0\r\n  credo 1.0.0\r\n  httpotion 3.1.0\r\n  ibrowse 4.4.1\r\n  jason 1.1.2\r\n  jiffy 0.15.2\r\nAll dependencies up to date\r\nIncluding tags: [line: \"17\"]\r\nExcluding tags: [:test]\r\n\r\n\r\nBasicsTest\r\n  * test PUT error when body not an object (excluded)\r\n  * test Created database has appropriate db info name (excluded)\r\n  * test Empty database should have zero docs (excluded)\r\n  * test Revs info status is good (excluded)\r\n  * test PUT on existing DB should return 412 instead of 500 (excluded)\r\n  * test Creating a new DB should return location header (excluded)\r\n  * test Regression test for COUCHDB-954 (excluded)\r\n  * test Database should be in _all_dbs (excluded)\r\n  * test Check for invalid document members (excluded)\r\n  * test Make sure you can do a seq=true option (excluded)\r\n  * test Simple map functions (excluded)\r\n  * test Welcome endpoint (62.0ms)\r\n  * test DELETE'ing a non-existent doc should 404 (excluded)\r\n  * test oops, the doc id got lost in code nirwana (excluded)\r\n  * test PUT doc has a Location header (excluded)\r\n  * test Can create several documents (excluded)\r\n  * test On restart, a request for creating an already existing db can not override (excluded)\r\n  * test _bulk_docs POST error when body not an object (excluded)\r\n  * test _all_docs POST error when multi-get is not a {'key': [...]} structure (excluded)\r\n  * test Create a document and save it to the database (excluded)\r\n  * test Creating a new DB with slashes should return Location header (COUCHDB-411) (excluded)\r\n  * test POST doc with an _id field isn't overwritten by uuid (excluded)\r\n  * test Session contains adm context (excluded)\r\n  * test POST doc response has a Location header (excluded)\r\n\r\n\r\nFinished in 0.5 seconds\r\n24 tests, 0 failures, 23 excluded\r\n\r\nRandomized with seed 323000\r\n```\r\n\r\nLooks good, +1 once the credo stuff is fixed! Nice job. And *thank you* for taking into consideration `Makefile.win`!\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446766814/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446778091","html_url":"https://github.com/apache/couchdb/pull/1789#issuecomment-446778091","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1789","id":446778091,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Njc3ODA5MQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-12T23:05:41Z","updated_at":"2018-12-12T23:05:41Z","author_association":"MEMBER","body":"@jaydoane @iilyak All tests both eunit and elixir should be passing now. Apologies for the delay!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446778091/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446784316","html_url":"https://github.com/apache/couchdb/issues/1807#issuecomment-446784316","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1807","id":446784316,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Njc4NDMxNg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-12T23:33:01Z","updated_at":"2018-12-12T23:33:01Z","author_association":"MEMBER","body":"setup cluster of 2, new db foo\r\n\r\n```\r\n$ find couchdb1/data -name foo\\*.couch -exec ls -la {} \\;\r\n-rw-r--r-- 1 joant joant 16577 Dec 12 17:55 couchdb1/data/shards/c0000000-dfffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 4250 Dec 12 17:54 couchdb1/data/shards/a0000000-bfffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 16577 Dec 12 17:55 couchdb1/data/shards/60000000-7fffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 4250 Dec 12 17:54 couchdb1/data/shards/e0000000-ffffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 41153 Dec 12 17:55 couchdb1/data/shards/20000000-3fffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 28865 Dec 12 17:55 couchdb1/data/shards/80000000-9fffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 41153 Dec 12 17:55 couchdb1/data/shards/00000000-1fffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 4250 Dec 12 17:54 couchdb1/data/shards/40000000-5fffffff/foo.1544655283.couch\r\n\r\n$ find couchdb2/data -name foo\\*.couch -exec ls -la {} \\;\r\n-rw-r--r-- 1 joant joant 16577 Dec 12 17:55 couchdb2/data/shards/c0000000-dfffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 4250 Dec 12 17:54 couchdb2/data/shards/a0000000-bfffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 16577 Dec 12 17:55 couchdb2/data/shards/60000000-7fffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 4250 Dec 12 17:54 couchdb2/data/shards/e0000000-ffffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 41153 Dec 12 17:55 couchdb2/data/shards/20000000-3fffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 28865 Dec 12 17:55 couchdb2/data/shards/80000000-9fffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 41153 Dec 12 17:55 couchdb2/data/shards/00000000-1fffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 4250 Dec 12 17:54 couchdb2/data/shards/40000000-5fffffff/foo.1544655283.couch\r\n```\r\n\r\nnow add 3rd node to cluster\r\n\r\n```\r\n$ curl localhost:35984/_all_dbs\r\n[\"foo\"]\r\n$ ls 99-R couchdb3/data\r\ncouchdb3/data:\r\n_dbs.couch  _nodes.couch  _replicator.couch  _users.couch\r\n```\r\n\r\nadd couchdb3 to _dbs/foo:\r\n\r\n```8\r\ncurl -X PUT \"http://localhost:15986/_dbs/foo?rev=1-03614dce08b6c07a87bfe742c1e4efa9\" -d '{\"_id\":\"foo\",\"shard_suffix\":[46,49,53,52,52,54,53,53,50,56,51],\"changelog\":[[\"add\",\"00000000-1fffffff\",\"couchdb1@127.0.0.1\"],[\"add\",\"00000000-1fffffff\",\"couchdb2@127.0.0.1\"],[\"add\",\"20000000-3fffffff\",\"couchdb1@127.0.0.1\"],[\"add\",\"20000000-3fffffff\",\"couchdb2@127.0.0.1\"],[\"add\",\"40000000-5fffffff\",\"couchdb1@127.0.0.1\"],[\"add\",\"40000000-5fffffff\",\"couchdb2@127.0.0.1\"],[\"add\",\"60000000-7fffffff\",\"couchdb1@127.0.0.1\"],[\"add\",\"60000000-7fffffff\",\"couchdb2@127.0.0.1\"],[\"add\",\"80000000-9fffffff\",\"couchdb1@127.0.0.1\"],[\"add\",\"80000000-9fffffff\",\"couchdb2@127.0.0.1\"],[\"add\",\"a0000000-bfffffff\",\"couchdb1@127.0.0.1\"],[\"add\",\"a0000000-bfffffff\",\"couchdb2@127.0.0.1\"],[\"add\",\"c0000000-dfffffff\",\"couchdb1@127.0.0.1\"],[\"add\",\"c0000000-dfffffff\",\"couchdb2@127.0.0.1\"],[\"add\",\"e0000000-ffffffff\",\"couchdb1@127.0.0.1\"],[\"add\",\"e0000000-ffffffff\",\"couchdb2@127.0.0.1\"]],\"by_node\":{\"couchdb1@127.0.0.1\":[\"00000000-1fffffff\",\"20000000-3fffffff\",\"40000000-5fffffff\",\"60000000-7fffffff\",\"80000000-9fffffff\",\"a0000000-bfffffff\",\"c0000000-dfffffff\",\"e0000000-ffffffff\"],\"couchdb2@127.0.0.1\":[\"00000000-1fffffff\",\"20000000-3fffffff\",\"40000000-5fffffff\",\"60000000-7fffffff\",\"80000000-9fffffff\",\"a0000000-bfffffff\",\"c0000000-dfffffff\",\"e0000000-ffffffff\"],\"couchdb3@127.0.0.1\":[\"00000000-1fffffff\",\"20000000-3fffffff\",\"40000000-5fffffff\",\"60000000-7fffffff\",\"80000000-9fffffff\",\"a0000000-bfffffff\",\"c0000000-dfffffff\",\"e0000000-ffffffff\"]},\"by_range\":{\"00000000-1fffffff\":[\"couchdb1@127.0.0.1\",\"couchdb2@127.0.0.1\",\"couchdb3@127.0.0.1\"],\"20000000-3fffffff\":[\"couchdb1@127.0.0.1\",\"couchdb2@127.0.0.1\",\"couchdb3@127.0.0.1\"],\"40000000-5fffffff\":[\"couchdb1@127.0.0.1\",\"couchdb2@127.0.0.1\",\"couchdb3@127.0.0.1\"],\"60000000-7fffffff\":[\"couchdb1@127.0.0.1\",\"couchdb2@127.0.0.1\",\"couchdb3@127.0.0.1\"],\"80000000-9fffffff\":[\"couchdb1@127.0.0.1\",\"couchdb2@127.0.0.1\",\"couchdb3@127.0.0.1\"],\"a0000000-bfffffff\":[\"couchdb1@127.0.0.1\",\"couchdb2@127.0.0.1\",\"couchdb3@127.0.0.1\"],\"c0000000-dfffffff\":[\"couchdb1@127.0.0.1\",\"couchdb2@127.0.0.1\",\"couchdb3@127.0.0.1\"],\"e0000000-ffffffff\":[\"couchdb1@127.0.0.1\",\"couchdb2@127.0.0.1\",\"couchdb3@127.0.0.1\"]}}'\r\n```\r\n\r\nno shards updated yet:\r\n\r\n```\r\n$ find couchdb3/data -name foo\\*.couch -exec ls -la {} \\;\r\n-rw-9r--r-- 1 joant joant 4250 Dec 12 18:08 couchdb3/data/shards/c0000000-dfffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 4250 Dec 12 18:08 couchdb3/data/shards/a0000000-bfffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 4250 Dec 12 18:08 couchdb3/data/shards/60000000-7fffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 4250 Dec 12 18:08 couchdb3/data/shards/e0000000-ffffffff/foo.1544655283.couch\r\n-rw8-r--r-- 1 joant joant 4250 Dec 12 18:08 couchdb3/data/shards/20000000-3fffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 4250 Dec 12 18:08 couchdb3/data/shards/80000000-9fffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 4250 Dec 12 18:08 couchdb3/data/shards/00000000-1fffffff/foo.1544655283.couch\r\n-rw-9r--r-- 1 joant joant 4250 Dec 12 18:08 couchdb3/data/shards/40000000-5fffffff/foo.1544655283.couch\r\n```\r\n\r\nnow try and trigger the shard update with the script. in remsh to couchdb1:\r\n\r\n```erlang9\r\nrr(mem3).\r\nUshards = mem3:ushards(\"foo\").\r\nShardList = [S#shard.name || S <- Ushards].\r\nrr(mem3_shards),\r\nSyncShard = fun(ShardName) ->\r\n    Shards = mem3_shards:for_shard_name(ShardName),\r\n    [rpc:call(S1#shard.node, mem3_sync, push, [S1, S2#shard.node]) || S1 <- Shards, S2 <- Shards, S1 =/= S2]\r\nend.\r\n[ SyncShard(S) || S <- ShardList ].\r\n[[ok,ok,ok,ok,ok,ok],\r\n [ok,ok,ok,ok,ok,ok],\r\n [ok,ok,ok,ok,ok,ok],\r\n [ok,ok,ok,ok,ok,ok],\r\n [ok,ok,ok,ok,ok,ok],\r\n [ok,ok,ok,ok,ok,ok],\r\n [ok,ok,ok,ok,ok,ok],\r\n [ok,ok,ok,ok,ok,ok]]\r\n```\r\n\r\ncheck couchdb3:\r\n\r\n```\r\n$ find couchdb3/data -name foo\\*.couch -exec ls -la {} \\;\r\n-rw-r--r-- 1 joant joant 28865 Dec 12 18:30 couchdb3/data/shards/c0000000-dfffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 4250 Dec 12 18:08 couchdb3/data/shards/a0000000-bfffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 28865 Dec 12 18:30 couchdb3/data/shards/60000000-7fffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 4250 Dec 12 18:08 couchdb3/data/shards/e0000000-ffffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 24769 Dec 12 18:30 couchdb3/data/shards/20000000-3fffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 24769 Dec 12 18:30 couchdb3/data/shards/80000000-9fffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 24769 Dec 12 18:30 couchdb3/data/shards/00000000-1fffffff/foo.1544655283.couch\r\n-rw-r--r-- 1 joant joant 4250 Dec 12 18:08 couchdb3/data/shards/40000000-5fffffff/foo.1544655283.couch\r\n```\r\n\r\n:+1:\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446784316/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446860079","html_url":"https://github.com/apache/couchdb/pull/1798#issuecomment-446860079","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1798","id":446860079,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Njg2MDA3OQ==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-13T06:44:32Z","updated_at":"2018-12-13T06:44:32Z","author_association":"CONTRIBUTOR","body":"During this process, I discovered two test suites that were not being run, but that would require additional work before they can be added to the suite.\r\n\r\n1. [This test name is missing an underscore suffix](https://github.com/apache/couchdb/blob/master/src/couch_mrview/test/couch_mrview_index_changes_tests.erl#L28), which prevents it from being run correctly. However, modifying the name to `changes_index_test_` results in all tests failing, and it seems clear it never worked. Given the reliance on explicit `sleep` calls and the use of undefined functions, it seems like these tests will require some effort to get working robustly.\r\n\r\n2. [This test module](https://github.com/apache/couchdb/blob/master/src/couch_pse_tests/src/cpse_test_purge_seqs.erl) is missing from [this list](https://github.com/apache/couchdb/blob/master/src/couch_pse_tests/src/cpse_util.erl#L22-L33), and thus does not get run. When added, there is a failure:\r\n```\r\n    cpse_gather: make_test_fun (cpse_increment_purge_seq_on_partial_purge)...*failed*\r\nin function cpse_util:save_doc/3\r\n  called as save_doc(<<\"db-18b60b9572e53026d7326183fdc57786\">>,{[{'_id',foo},{vsn,2}]},[replicated_changes])\r\nin call from cpse_test_purge_seqs:cpse_increment_purge_seq_on_partial_purge/1 (src/cpse_test_purge_seqs.erl, line 104)\r\nin call from eunit_test:run_testfun/1 (eunit_test.erl, line 71)\r\nin call from eunit_proc:run_test/1 (eunit_proc.erl, line 510)\r\nin call from eunit_proc:with_timeout/3 (eunit_proc.erl, line 335)\r\nin call from eunit_proc:handle_test/2 (eunit_proc.erl, line 493)\r\nin call from eunit_proc:tests_inorder/3 (eunit_proc.erl, line 435)\r\nin call from eunit_proc:with_timeout/3 (eunit_proc.erl, line 325)\r\n**error:undef\r\n  output:<<\"\">>\r\n```\r\nwhich will need further investigation to fix.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446860079/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446868857","html_url":"https://github.com/apache/couchdb/pull/1789#issuecomment-446868857","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1789","id":446868857,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Njg2ODg1Nw==","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-13T07:28:08Z","updated_at":"2018-12-13T07:28:08Z","author_association":"CONTRIBUTOR","body":"Confirmed that all eunit tests are now passing  ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446868857/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446962338","html_url":"https://github.com/apache/couchdb/issues/1806#issuecomment-446962338","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1806","id":446962338,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0Njk2MjMzOA==","user":{"login":"strelok1010","id":42271054,"node_id":"MDQ6VXNlcjQyMjcxMDU0","avatar_url":"https://avatars.githubusercontent.com/u/42271054?v=4","gravatar_id":"","url":"https://api.github.com/users/strelok1010","html_url":"https://github.com/strelok1010","followers_url":"https://api.github.com/users/strelok1010/followers","following_url":"https://api.github.com/users/strelok1010/following{/other_user}","gists_url":"https://api.github.com/users/strelok1010/gists{/gist_id}","starred_url":"https://api.github.com/users/strelok1010/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/strelok1010/subscriptions","organizations_url":"https://api.github.com/users/strelok1010/orgs","repos_url":"https://api.github.com/users/strelok1010/repos","events_url":"https://api.github.com/users/strelok1010/events{/privacy}","received_events_url":"https://api.github.com/users/strelok1010/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-13T13:08:41Z","updated_at":"2018-12-13T13:08:41Z","author_association":"NONE","body":"Well, now I have a big mistake. Please, can you help me?.\r\nI have removed the old lucene views and created new ones.\r\n```\r\n{\r\n  \"_id\": \"_design/foo\",\r\n  \"_rev\": \"3-17cf9845cb8979104bef460f2eec0fbf\",\r\n  \"fulltext\": {\r\n    \"by_title\": {\r\n      \"index\": \"function(doc) { var ret=new Document(); ret.add(doc.title); return ret }\"\r\n    },\r\n    \"by_filtered\": {\r\n      \"index\": \"function(doc) { var ret=new Document(); ret.add(doc.filtered); return ret }\"\r\n    }\r\n  }\r\n}\r\n```\r\n\r\nWhen I clean the database, there is no problem:\r\n\r\n```\r\ncurl -X POST http://localhost:5985/local/db_urls/_cleanup\r\n{\"ok\": true}\r\n```\r\n\r\nBut when I try to optimize the new views there are big problems:\r\n\r\n```\r\ncurl -X POST http://localhost:5985/local/db_urls/_design/search/by_title/_optimize\r\n{\"reason\":\"no_such_view\",\"code\":400}\r\n```\r\nThe worst part of all is when I try to optimize a lucene view that I have previously deleted:\r\n\r\n```\r\ncurl -X POST http://localhost:5985/local/db_urls/_design/search/filtered/_optimize\r\n{\"ok\": true}\r\n\r\n```\r\nPlease, I beg you to help me.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/446962338/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447024298","html_url":"https://github.com/apache/couchdb/issues/1809#issuecomment-447024298","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1809","id":447024298,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzAyNDI5OA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-13T16:08:04Z","updated_at":"2018-12-13T16:08:04Z","author_association":"MEMBER","body":"As this will be resolved by a documentation patch, moving this to apache/couchdb-documentation.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447024298/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447026563","html_url":"https://github.com/apache/couchdb/issues/1810#issuecomment-447026563","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1810","id":447026563,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzAyNjU2Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-13T16:14:05Z","updated_at":"2018-12-13T16:14:05Z","author_association":"MEMBER","body":"Hi @dianabarsan , thanks for the report.\r\n\r\nThis is definitely not intended - we'll take a closer look. See https://github.com/apache/couchdb/issues/1409 for the history here; we can't directly just revert the change because the other use case will be impacted, so this may take a bit of research to resolve sufficiently.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447026563/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447128199","html_url":"https://github.com/apache/couchdb/issues/1810#issuecomment-447128199","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1810","id":447128199,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzEyODE5OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-13T21:32:40Z","updated_at":"2018-12-13T21:33:17Z","author_association":"MEMBER","body":"http://erlang.org/pipermail/erlang-questions/2011-June/059571.html\r\nhttps://github.com/ninenines/cowboy/issues/3\r\nhttps://github.com/ninenines/cowboy/commit/29e71cf4daec684c13047952a95ec0dc9540aad5\r\n\r\nWe're weighing our options now. Currently hoping improving mochiweb to pass `[{buffer, 8192}]` usefully thru one or another setting in `*.ini` or similar would be enough. The cowboy solution is going to be more reliable in the long run, but is a fairly large retrofit to mochiweb.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447128199/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447152497","html_url":"https://github.com/apache/couchdb/issues/1810#issuecomment-447152497","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1810","id":447152497,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzE1MjQ5Nw==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-13T23:00:54Z","updated_at":"2018-12-14T00:01:54Z","author_association":"CONTRIBUTOR","body":"Hi @dianabarsan,\r\n\r\nThank you for the bug report and excellent analysis.\r\n\r\nYou're absolutely correct, `chttpd.server_option = [{recbuf, undefined}]).` ends up not setting recbuf value, which means Erlang userland buffer gets a default value of 1460 (when recbuf is set so is the userland buffer).\r\n\r\nThis buffer size limit combined with a long-standing bug in Erlang's `{packet, http}` parser ends crashing the socket receive code with an `emsgsize` error.\r\n\r\nIt's not possible to set the buffer size in mochiweb currently, so I will make a PR request to fix that.\r\n\r\nNotice:\r\n\r\n```\r\n30> f(), SockInfo = fun(S) -> inet:getopts(S, [recbuf, buffer]) end, {ok, LS} = gen_tcp:listen(0, [{recbuf, 8192}]), LRes = SockInfo(LS).\r\n{ok,[{recbuf,8192},{buffer,8192}]}\r\n```\r\n\r\n```\r\n31> f(), SockInfo = fun(S) -> inet:getopts(S, [recbuf, buffer]) end, {ok, LS} = gen_tcp:listen(0, []), LRes = SockInfo(LS).\r\n{ok,[{recbuf,131072},{buffer,1460}]}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447152497/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447157236","html_url":"https://github.com/apache/couchdb/issues/1810#issuecomment-447157236","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1810","id":447157236,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzE1NzIzNg==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-13T23:21:36Z","updated_at":"2018-12-13T23:21:36Z","author_association":"CONTRIBUTOR","body":"pull request:\r\n\r\nhttps://github.com/mochi/mochiweb/pull/208","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447157236/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280565717","html_url":"https://github.com/apache/couchdb/issues/4211#issuecomment-1280565717","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4211","id":1280565717,"node_id":"MDEyOklzc3VlQ29tbWVudDEyODA1NjU3MTc=","user":{"login":"mikeymckay","id":12015,"node_id":"MDQ6VXNlcjEyMDE1","avatar_url":"https://avatars.githubusercontent.com/u/12015?v=4","gravatar_id":"","url":"https://api.github.com/users/mikeymckay","html_url":"https://github.com/mikeymckay","followers_url":"https://api.github.com/users/mikeymckay/followers","following_url":"https://api.github.com/users/mikeymckay/following{/other_user}","gists_url":"https://api.github.com/users/mikeymckay/gists{/gist_id}","starred_url":"https://api.github.com/users/mikeymckay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikeymckay/subscriptions","organizations_url":"https://api.github.com/users/mikeymckay/orgs","repos_url":"https://api.github.com/users/mikeymckay/repos","events_url":"https://api.github.com/users/mikeymckay/events{/privacy}","received_events_url":"https://api.github.com/users/mikeymckay/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-14T09:46:40Z","updated_at":"2018-12-14T11:34:16Z","author_association":"CONTRIBUTOR","body":"In my experience, the biggest problem with couchdb on docker or even my laptop is the q and n values in the clustering section of configuration. @janl pointed me in this direction during an IRC debug session and it has helped tremendously. \r\n\r\nThere is some documentation here:\r\nhttp://docs.couchdb.org/en/2.2.0/config/cluster.html\r\n\r\nBut I am still not quite sure how best to setup the q and n values for smaller standalone instances. Here's my simplistic logic (call it cowboy configuration for couchdb), that I would love to have checked/improved:\r\n\r\n1) Keep n (the number of replicas) at 1. This is the default, and the defaults seem to be for \"beefy servers\". We can't go any lower, so 1 it is. Want extra redudancy? - go higher, but I don't know how you would take advantage of this in case a disk died. Seems like it is easier to just replicate data to a backup server.\r\n\r\n2) For maximum efficiency let q (number of shards) equal the number of CPU cores on the device. If it's on your laptop and you don't want couchdb to slow down other stuff, make it a few less. On the other hand, if it's a dedicated couchdb instance I expect that threading means you could actually squeeze a bit more efficiency giving yourself one more q than the number of cores, but that is a guess.\r\n\r\n(I had to do some research to understand what CPU cores means relative to the output of `cat /proc/cpuinfo` . On my laptop I have 8 processors - and each processor entry shows 4 \"cpu cores\". I believe this means the ability to index 8 views in parallel (if there are 8 shards). It doesn't mean 32 as the 8 processors are distributed over the 4 cores. I conservatively went with q=2, the default of 8 seemed to slow things down when I had lots of concurrent replications running. An AWS instance I use for production shows 2 processors and 2 cores. I'm going with q=3 on that one.)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280565717/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447303215","html_url":"https://github.com/apache/couchdb/issues/1810#issuecomment-447303215","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1810","id":447303215,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzMwMzIxNQ==","user":{"login":"dianabarsan","id":35681649,"node_id":"MDQ6VXNlcjM1NjgxNjQ5","avatar_url":"https://avatars.githubusercontent.com/u/35681649?v=4","gravatar_id":"","url":"https://api.github.com/users/dianabarsan","html_url":"https://github.com/dianabarsan","followers_url":"https://api.github.com/users/dianabarsan/followers","following_url":"https://api.github.com/users/dianabarsan/following{/other_user}","gists_url":"https://api.github.com/users/dianabarsan/gists{/gist_id}","starred_url":"https://api.github.com/users/dianabarsan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dianabarsan/subscriptions","organizations_url":"https://api.github.com/users/dianabarsan/orgs","repos_url":"https://api.github.com/users/dianabarsan/repos","events_url":"https://api.github.com/users/dianabarsan/events{/privacy}","received_events_url":"https://api.github.com/users/dianabarsan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-14T11:53:39Z","updated_at":"2018-12-14T11:53:39Z","author_association":"NONE","body":"Hi @wohali , @nickva \r\n\r\nThank you very much for the quick responses and for the additional context! \r\nThe Erlang http packet parser bug was the missing piece in my understanding of why this is happening. \r\n\r\nWe will be updating our configs to set a `recbuf` value for 2.3.0 installs. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447303215/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447355204","html_url":"https://github.com/apache/couchdb/issues/1799#issuecomment-447355204","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1799","id":447355204,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzM1NTIwNA==","user":{"login":"fkaempfer","id":2357885,"node_id":"MDQ6VXNlcjIzNTc4ODU=","avatar_url":"https://avatars.githubusercontent.com/u/2357885?v=4","gravatar_id":"","url":"https://api.github.com/users/fkaempfer","html_url":"https://github.com/fkaempfer","followers_url":"https://api.github.com/users/fkaempfer/followers","following_url":"https://api.github.com/users/fkaempfer/following{/other_user}","gists_url":"https://api.github.com/users/fkaempfer/gists{/gist_id}","starred_url":"https://api.github.com/users/fkaempfer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fkaempfer/subscriptions","organizations_url":"https://api.github.com/users/fkaempfer/orgs","repos_url":"https://api.github.com/users/fkaempfer/repos","events_url":"https://api.github.com/users/fkaempfer/events{/privacy}","received_events_url":"https://api.github.com/users/fkaempfer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-14T15:16:17Z","updated_at":"2018-12-14T15:17:45Z","author_association":"CONTRIBUTOR","body":"@janl @wohali : Do you think that the possibility to bypass VDU with _purge for deleting documents is enough of a reason to restrict it to admins? Normally deletions can be disallowed by throwing an exception in VDU, but with _purge, which is accessible to every member/user, VDU is never called (and that's probably correct as it is not a normal doc update). \r\n\r\nIf you think it's not a problem, I can close the issue. Otherwise I can submit a PR adding a simple check in chttpd_auth_request.erl. \r\n\r\n@jiangphcn I think a log file would not help that much, it can not be as easily consumed as the _changes feed.\r\n\r\nThanks!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447355204/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447388820","html_url":"https://github.com/apache/couchdb/issues/1810#issuecomment-447388820","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1810","id":447388820,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzM4ODgyMA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-14T17:07:28Z","updated_at":"2018-12-14T17:07:28Z","author_association":"MEMBER","body":"@dianabarsan Be advised that this may adversely affect your attachment performance (if you use attachments), see #1409.\r\n\r\nWe are considering a 2.3.1 fix for this bug since it's rather a surprising regression.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447388820/reactions","total_count":2,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":2,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280565723","html_url":"https://github.com/apache/couchdb/issues/4211#issuecomment-1280565723","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4211","id":1280565723,"node_id":"MDEyOklzc3VlQ29tbWVudDEyODA1NjU3MjM=","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-14T17:12:31Z","updated_at":"2018-12-14T17:12:31Z","author_association":"MEMBER","body":"@mikeymckay If you're only running a single server, you are by your very nature `n=1`. If you use the Setup Wizard (either through Fauxton or the cli) and tell it you only have a single node, you will get `n=1`. The preferred deployment scenario for CouchDB 2.x is a minimum of 3 servers and `n=3` for full redundancy. This is far superior to using 2x `n=1` servers and replicating between them as we did in 1.x for many reasons that I'm not going to go into right now.\r\n\r\nAs for `q`, Jan's advice is correct. The default `q=8` value was chosen because servers at the time tended to have 4 cores with 2 threads each. This matches well with multiple spindles, or a single SSD, for performance. (Remember that disk performance also is a critical factor for view building). Finally, if you don't make much use of JS views, or have migrated off onto the higher-performance Mango, you need less CPU, and the sharding will definitely improve your performance.\r\n\r\nAs always, before putting anything into production, **test**.  :)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280565723/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447523089","html_url":"https://github.com/apache/couchdb/pull/1811#issuecomment-447523089","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1811","id":447523089,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzUyMzA4OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-15T01:08:32Z","updated_at":"2018-12-15T01:08:32Z","author_association":"MEMBER","body":"While I was in `mem3_httpd` I noticed the (currently undocumented) `/{db}/_shards` and `/{db}/_shards/{docid}` endpoints.\r\n\r\nWe should document these.\r\n\r\nI dithered briefly over putting this new endpoint at `/{db}/_shards/_sync`. Happy to oblige if others feel strongly.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447523089/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280565728","html_url":"https://github.com/apache/couchdb/issues/4211#issuecomment-1280565728","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4211","id":1280565728,"node_id":"MDEyOklzc3VlQ29tbWVudDEyODA1NjU3Mjg=","user":{"login":"mikeymckay","id":12015,"node_id":"MDQ6VXNlcjEyMDE1","avatar_url":"https://avatars.githubusercontent.com/u/12015?v=4","gravatar_id":"","url":"https://api.github.com/users/mikeymckay","html_url":"https://github.com/mikeymckay","followers_url":"https://api.github.com/users/mikeymckay/followers","following_url":"https://api.github.com/users/mikeymckay/following{/other_user}","gists_url":"https://api.github.com/users/mikeymckay/gists{/gist_id}","starred_url":"https://api.github.com/users/mikeymckay/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mikeymckay/subscriptions","organizations_url":"https://api.github.com/users/mikeymckay/orgs","repos_url":"https://api.github.com/users/mikeymckay/repos","events_url":"https://api.github.com/users/mikeymckay/events{/privacy}","received_events_url":"https://api.github.com/users/mikeymckay/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-15T09:00:12Z","updated_at":"2018-12-15T09:00:12Z","author_association":"CONTRIBUTOR","body":"Thanks @wohali, this is interesting and helpful. There are thousands and thousands of use cases for couchdb and at least as many good configurations per scenario. I have been working with couchdb for almost 10 years, and I still don't have a good sense for an optimal deployment strategy for my sort of projects (10-100 pouchdb clients filter replicating data to/from couchdb a few times per day, with somebody analyzing the resulting data in couchdb a few times per week). Since I started with single server couchdb, and because I haven't seen any data about performance advantages of multiple servers (redundancy is nice, but daily snapshots are usually enough for me), and because orchestrating multiple servers is hard (using docker could simplify this, but I and others have seen poor performance (total lockup of machine) on docker)... I've just been using a single couchdb server even though I am now deploying couchdb 2.3.0.\r\n\r\nSo going back to the title of this issue - what is the ideal configuration for low spec HW? Or rather than saying low spec hardware - what about saying $45/month (arbitrarily chosen) hardware budget? Is a single instance (with the right q value) close enough to ideal? Will performance be substantially different if you get 3 - $15/month servers and set them up as a cluster? Given the availability of low cost ARM servers (on AWS or even Raspberry Pi stacks) are 5 servers better than 1 that's five times as fast? Given Erlang's focus on parallelization (and the idea behind map/reduce in general) I have a hunch that more cheap servers will give more performance per dollar than a single beefier server - but I don't know how much and if it is worth the added complexity. Has anybody tried to benchmark this?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280565728/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447561613","html_url":"https://github.com/apache/couchdb/issues/1799#issuecomment-447561613","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1799","id":447561613,"node_id":"MDEyOklzc3VlQ29tbWVudDQ0NzU2MTYxMw==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2018-12-15T11:28:19Z","updated_at":"2018-12-15T11:28:19Z","author_association":"MEMBER","body":"Good point about the VDU. I somehow assumed those would still be run.\r\n\r\n@jiangphcn do you think this could be retro-fitted?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/447561613/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]