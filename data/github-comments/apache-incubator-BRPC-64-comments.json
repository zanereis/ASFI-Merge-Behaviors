[{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1630350251","html_url":"https://github.com/apache/brpc/issues/2307#issuecomment-1630350251","issue_url":"https://api.github.com/repos/apache/brpc/issues/2307","id":1630350251,"node_id":"IC_kwDOBhmkcs5hLSur","user":{"login":"lyykjen","id":22764583,"node_id":"MDQ6VXNlcjIyNzY0NTgz","avatar_url":"https://avatars.githubusercontent.com/u/22764583?v=4","gravatar_id":"","url":"https://api.github.com/users/lyykjen","html_url":"https://github.com/lyykjen","followers_url":"https://api.github.com/users/lyykjen/followers","following_url":"https://api.github.com/users/lyykjen/following{/other_user}","gists_url":"https://api.github.com/users/lyykjen/gists{/gist_id}","starred_url":"https://api.github.com/users/lyykjen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lyykjen/subscriptions","organizations_url":"https://api.github.com/users/lyykjen/orgs","repos_url":"https://api.github.com/users/lyykjen/repos","events_url":"https://api.github.com/users/lyykjen/events{/privacy}","received_events_url":"https://api.github.com/users/lyykjen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-11T08:06:31Z","updated_at":"2023-07-11T08:06:31Z","author_association":"NONE","body":"使用brpc 1.5.0版本即可解决问题","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1630350251/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1630522392","html_url":"https://github.com/apache/brpc/issues/2313#issuecomment-1630522392","issue_url":"https://api.github.com/repos/apache/brpc/issues/2313","id":1630522392,"node_id":"IC_kwDOBhmkcs5hL8wY","user":{"login":"TousakaRin","id":8801314,"node_id":"MDQ6VXNlcjg4MDEzMTQ=","avatar_url":"https://avatars.githubusercontent.com/u/8801314?v=4","gravatar_id":"","url":"https://api.github.com/users/TousakaRin","html_url":"https://github.com/TousakaRin","followers_url":"https://api.github.com/users/TousakaRin/followers","following_url":"https://api.github.com/users/TousakaRin/following{/other_user}","gists_url":"https://api.github.com/users/TousakaRin/gists{/gist_id}","starred_url":"https://api.github.com/users/TousakaRin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TousakaRin/subscriptions","organizations_url":"https://api.github.com/users/TousakaRin/orgs","repos_url":"https://api.github.com/users/TousakaRin/repos","events_url":"https://api.github.com/users/TousakaRin/events{/privacy}","received_events_url":"https://api.github.com/users/TousakaRin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-11T09:53:57Z","updated_at":"2023-07-11T09:53:57Z","author_association":"CONTRIBUTOR","body":"可以参考这里的FAQ：https://github.com/apache/brpc/blob/master/docs/cn/bthread.md\r\n看起来是在锁内进行rpc导致worker被用光。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1630522392/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1630595854","html_url":"https://github.com/apache/brpc/issues/2313#issuecomment-1630595854","issue_url":"https://api.github.com/repos/apache/brpc/issues/2313","id":1630595854,"node_id":"IC_kwDOBhmkcs5hMOsO","user":{"login":"xiedeacc","id":8072296,"node_id":"MDQ6VXNlcjgwNzIyOTY=","avatar_url":"https://avatars.githubusercontent.com/u/8072296?v=4","gravatar_id":"","url":"https://api.github.com/users/xiedeacc","html_url":"https://github.com/xiedeacc","followers_url":"https://api.github.com/users/xiedeacc/followers","following_url":"https://api.github.com/users/xiedeacc/following{/other_user}","gists_url":"https://api.github.com/users/xiedeacc/gists{/gist_id}","starred_url":"https://api.github.com/users/xiedeacc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiedeacc/subscriptions","organizations_url":"https://api.github.com/users/xiedeacc/orgs","repos_url":"https://api.github.com/users/xiedeacc/repos","events_url":"https://api.github.com/users/xiedeacc/events{/privacy}","received_events_url":"https://api.github.com/users/xiedeacc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-11T10:45:41Z","updated_at":"2023-07-11T10:45:41Z","author_association":"NONE","body":"brpc太多问题了，完全就是个渣渣， 把brpc_thread_num参数设置到几百吧，否则brpc无法解决死锁","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1630595854/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1630642102","html_url":"https://github.com/apache/brpc/issues/2313#issuecomment-1630642102","issue_url":"https://api.github.com/repos/apache/brpc/issues/2313","id":1630642102,"node_id":"IC_kwDOBhmkcs5hMZ-2","user":{"login":"zgaze","id":20501506,"node_id":"MDQ6VXNlcjIwNTAxNTA2","avatar_url":"https://avatars.githubusercontent.com/u/20501506?v=4","gravatar_id":"","url":"https://api.github.com/users/zgaze","html_url":"https://github.com/zgaze","followers_url":"https://api.github.com/users/zgaze/followers","following_url":"https://api.github.com/users/zgaze/following{/other_user}","gists_url":"https://api.github.com/users/zgaze/gists{/gist_id}","starred_url":"https://api.github.com/users/zgaze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zgaze/subscriptions","organizations_url":"https://api.github.com/users/zgaze/orgs","repos_url":"https://api.github.com/users/zgaze/repos","events_url":"https://api.github.com/users/zgaze/events{/privacy}","received_events_url":"https://api.github.com/users/zgaze/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-11T11:20:39Z","updated_at":"2023-07-11T11:20:39Z","author_association":"NONE","body":"> 可以参考这里的FAQ：https://github.com/apache/brpc/blob/master/docs/cn/bthread.md 看起来是在锁内进行rpc导致worker被用光。\r\n\r\n是说 访问下游RPC导致占用了全部pthread，导致io没有worker来处理了吗？ 感觉不太像：\r\n1、访问下游RPC是在tf的线程池里面做的，并且是异步rpc。\r\n2、并且没有发现有线程阻塞在read等api上\r\n\r\n所有的线程都很正常，除了io线程在等待tf返回或者超时。 个人感觉 最大的可能性就是bthread和github.com/google/nsync 有概率冲突。导致wait不能返回。\r\n1、32core机器，33个线程都阻塞在了nsync::nsync_mu_semaphore_p_with_deadline。这应该是32个bthread，按照我对bthread的了解，它应该在阻塞时候让出cpu给其他任务，不会完全阻塞该pthread。 比较大的可能是nsync实现的同步原语，没有能将cpu让出来。 （对两个库都了解不多，算猜测）\r\n2、就算业务代码有问题等，那么io线程里tf等待超时也应该能正常返回，不会一直阻塞在wait超时。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1630642102/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1630695164","html_url":"https://github.com/apache/brpc/issues/2313#issuecomment-1630695164","issue_url":"https://api.github.com/repos/apache/brpc/issues/2313","id":1630695164,"node_id":"IC_kwDOBhmkcs5hMm78","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-11T12:00:10Z","updated_at":"2023-07-12T01:56:47Z","author_association":"CONTRIBUTOR","body":"我理解，（worker上）pthread锁内挂起bthread（rpc、bthread_usleep、butex等）的逻辑是有问题的，会很容易导致死锁。例如这个场景下：\r\n\r\n一个worker线程执行bthread的时候加了pthread锁，然后挂起了。在该bthread释放pthread锁之前，该worker线程继续调度其他bthread（逻辑与前面的bthread一样），加了同一把pthread锁。在同一个pthread中连续加两次会死锁，逐渐地其他worker也加这把pthread锁，最后所有worker就阻塞在pthread锁上了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1630695164/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1631022338","html_url":"https://github.com/apache/brpc/issues/2314#issuecomment-1631022338","issue_url":"https://api.github.com/repos/apache/brpc/issues/2314","id":1631022338,"node_id":"IC_kwDOBhmkcs5hN20C","user":{"login":"lorinlee","id":16054841,"node_id":"MDQ6VXNlcjE2MDU0ODQx","avatar_url":"https://avatars.githubusercontent.com/u/16054841?v=4","gravatar_id":"","url":"https://api.github.com/users/lorinlee","html_url":"https://github.com/lorinlee","followers_url":"https://api.github.com/users/lorinlee/followers","following_url":"https://api.github.com/users/lorinlee/following{/other_user}","gists_url":"https://api.github.com/users/lorinlee/gists{/gist_id}","starred_url":"https://api.github.com/users/lorinlee/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lorinlee/subscriptions","organizations_url":"https://api.github.com/users/lorinlee/orgs","repos_url":"https://api.github.com/users/lorinlee/repos","events_url":"https://api.github.com/users/lorinlee/events{/privacy}","received_events_url":"https://api.github.com/users/lorinlee/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-11T15:18:14Z","updated_at":"2023-07-11T15:18:14Z","author_association":"CONTRIBUTOR","body":"看着是你代码抛异常了。brpc目前可能会在析构函数里调用ProcessHttpRequest，如果抛异常会导致进程abort，可以试下在你的代码的最外面加个try catch看看","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1631022338/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1631772126","html_url":"https://github.com/apache/brpc/issues/2313#issuecomment-1631772126","issue_url":"https://api.github.com/repos/apache/brpc/issues/2313","id":1631772126,"node_id":"IC_kwDOBhmkcs5hQt3e","user":{"login":"zgaze","id":20501506,"node_id":"MDQ6VXNlcjIwNTAxNTA2","avatar_url":"https://avatars.githubusercontent.com/u/20501506?v=4","gravatar_id":"","url":"https://api.github.com/users/zgaze","html_url":"https://github.com/zgaze","followers_url":"https://api.github.com/users/zgaze/followers","following_url":"https://api.github.com/users/zgaze/following{/other_user}","gists_url":"https://api.github.com/users/zgaze/gists{/gist_id}","starred_url":"https://api.github.com/users/zgaze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zgaze/subscriptions","organizations_url":"https://api.github.com/users/zgaze/orgs","repos_url":"https://api.github.com/users/zgaze/repos","events_url":"https://api.github.com/users/zgaze/events{/privacy}","received_events_url":"https://api.github.com/users/zgaze/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-12T02:50:57Z","updated_at":"2023-07-12T02:50:57Z","author_association":"NONE","body":"> 我理解，（worker上）pthread锁内挂起bthread（rpc、bthread_usleep、butex等）的逻辑是有问题的，会很容易导致死锁。例如这个场景下：\r\n> \r\n> 一个worker线程执行bthread的时候加了pthread锁，然后挂起了。在该bthread释放pthread锁之前，该worker线程继续调度其他bthread（逻辑与前面的bthread一样），加了同一把pthread锁。在同一个pthread中连续加两次会死锁，逐渐地其他worker也加这把pthread锁，最后所有worker就阻塞在pthread锁上了。\r\n\r\n那么，总结来说。bthread+pthread线程池是有风险的，只要里面使用了bthread就会导致死锁。 \r\n我能想到的解决方案有：\r\n1、pthread内部只使用pthread，不使用bthread，brpc client也使用pthread的。 那么目前：要做异步的pthread的使用DynamicPartitionChannel 的client，能否**从bthread快速切换到pthread** ？\r\n2、处理请求不使用bthread，而使用pthread。比如：-usercode_in_pthread。 因为等待tf结果算是一个同步操作，那么可能需要比较大的线程池。 \r\n\r\nrpc的回调能否不使用bthread？\r\n\r\n如果有其他更好的解决方案，欢迎补充。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1631772126/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1631788822","html_url":"https://github.com/apache/brpc/issues/2313#issuecomment-1631788822","issue_url":"https://api.github.com/repos/apache/brpc/issues/2313","id":1631788822,"node_id":"IC_kwDOBhmkcs5hQx8W","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-12T03:18:09Z","updated_at":"2023-07-12T03:18:09Z","author_association":"CONTRIBUTOR","body":"嗯，只有在brpc worker线程上才有问题吧。bthread的锁在pthread（非worker）上实际上是futex，应该没这个问题吧。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1631788822/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1631791037","html_url":"https://github.com/apache/brpc/issues/2313#issuecomment-1631791037","issue_url":"https://api.github.com/repos/apache/brpc/issues/2313","id":1631791037,"node_id":"IC_kwDOBhmkcs5hQye9","user":{"login":"chenzhangyi","id":6805583,"node_id":"MDQ6VXNlcjY4MDU1ODM=","avatar_url":"https://avatars.githubusercontent.com/u/6805583?v=4","gravatar_id":"","url":"https://api.github.com/users/chenzhangyi","html_url":"https://github.com/chenzhangyi","followers_url":"https://api.github.com/users/chenzhangyi/followers","following_url":"https://api.github.com/users/chenzhangyi/following{/other_user}","gists_url":"https://api.github.com/users/chenzhangyi/gists{/gist_id}","starred_url":"https://api.github.com/users/chenzhangyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenzhangyi/subscriptions","organizations_url":"https://api.github.com/users/chenzhangyi/orgs","repos_url":"https://api.github.com/users/chenzhangyi/repos","events_url":"https://api.github.com/users/chenzhangyi/events{/privacy}","received_events_url":"https://api.github.com/users/chenzhangyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-12T03:22:00Z","updated_at":"2023-07-12T03:22:56Z","author_association":"MEMBER","body":"这个问题是tensorflow在有自己的线程池(cpu device带来的). 然后在rpc的worker线程内等计算结束，把所有的worker都阻塞住了。这个和是不是跑在bthread关系不大。 对这个问题而言，最简单的是限制下max concurrency。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1631791037/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1631796812","html_url":"https://github.com/apache/brpc/issues/2313#issuecomment-1631796812","issue_url":"https://api.github.com/repos/apache/brpc/issues/2313","id":1631796812,"node_id":"IC_kwDOBhmkcs5hQz5M","user":{"login":"zgaze","id":20501506,"node_id":"MDQ6VXNlcjIwNTAxNTA2","avatar_url":"https://avatars.githubusercontent.com/u/20501506?v=4","gravatar_id":"","url":"https://api.github.com/users/zgaze","html_url":"https://github.com/zgaze","followers_url":"https://api.github.com/users/zgaze/followers","following_url":"https://api.github.com/users/zgaze/following{/other_user}","gists_url":"https://api.github.com/users/zgaze/gists{/gist_id}","starred_url":"https://api.github.com/users/zgaze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zgaze/subscriptions","organizations_url":"https://api.github.com/users/zgaze/orgs","repos_url":"https://api.github.com/users/zgaze/repos","events_url":"https://api.github.com/users/zgaze/events{/privacy}","received_events_url":"https://api.github.com/users/zgaze/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-12T03:32:15Z","updated_at":"2023-07-12T03:46:03Z","author_association":"NONE","body":"> 这个问题是tensorflow在有自己的线程池(cpu device带来的). 然后在rpc的worker线程内等计算结束，把所有的worker都阻塞住了。这个和是不是跑在bthread关系不大。 对这个问题而言，最简单的是限制下max concurrency。\r\n\r\n如果是你说的这个问题，那么1、我只能 实现tf的异步 session run，然后用brpc的异步。 2、或者加pthread数量。3、 或者使用-usercode_in_pthread。\r\n\r\n更建议那种方式呢？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1631796812/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1632067659","html_url":"https://github.com/apache/brpc/issues/2313#issuecomment-1632067659","issue_url":"https://api.github.com/repos/apache/brpc/issues/2313","id":1632067659,"node_id":"IC_kwDOBhmkcs5hR2BL","user":{"login":"gexiaonie","id":9265829,"node_id":"MDQ6VXNlcjkyNjU4Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/9265829?v=4","gravatar_id":"","url":"https://api.github.com/users/gexiaonie","html_url":"https://github.com/gexiaonie","followers_url":"https://api.github.com/users/gexiaonie/followers","following_url":"https://api.github.com/users/gexiaonie/following{/other_user}","gists_url":"https://api.github.com/users/gexiaonie/gists{/gist_id}","starred_url":"https://api.github.com/users/gexiaonie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gexiaonie/subscriptions","organizations_url":"https://api.github.com/users/gexiaonie/orgs","repos_url":"https://api.github.com/users/gexiaonie/repos","events_url":"https://api.github.com/users/gexiaonie/events{/privacy}","received_events_url":"https://api.github.com/users/gexiaonie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-12T08:24:09Z","updated_at":"2023-07-12T08:24:09Z","author_association":"NONE","body":"比较好奇你在TF里面是如何使用brpc的？看你的栈信息使用的DirectSession，DirectSession不是单机本地训练吗？应该不会走rpc呀？还是你们基于DirectSession做了一些特殊逻辑处理？\r\n另外，栈信息看不出brpc相关的东西。可以在gdb里面把所有线程的栈打印出来，命令: taas bt","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1632067659/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1632102012","html_url":"https://github.com/apache/brpc/issues/2313#issuecomment-1632102012","issue_url":"https://api.github.com/repos/apache/brpc/issues/2313","id":1632102012,"node_id":"IC_kwDOBhmkcs5hR-Z8","user":{"login":"zgaze","id":20501506,"node_id":"MDQ6VXNlcjIwNTAxNTA2","avatar_url":"https://avatars.githubusercontent.com/u/20501506?v=4","gravatar_id":"","url":"https://api.github.com/users/zgaze","html_url":"https://github.com/zgaze","followers_url":"https://api.github.com/users/zgaze/followers","following_url":"https://api.github.com/users/zgaze/following{/other_user}","gists_url":"https://api.github.com/users/zgaze/gists{/gist_id}","starred_url":"https://api.github.com/users/zgaze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zgaze/subscriptions","organizations_url":"https://api.github.com/users/zgaze/orgs","repos_url":"https://api.github.com/users/zgaze/repos","events_url":"https://api.github.com/users/zgaze/events{/privacy}","received_events_url":"https://api.github.com/users/zgaze/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-12T08:46:18Z","updated_at":"2023-07-12T08:46:18Z","author_association":"NONE","body":"> 比较好奇你在TF里面是如何使用brpc的？看你的栈信息使用的DirectSession，DirectSession不是单机本地训练吗？应该不会走rpc呀？还是你们基于DirectSession做了一些特殊逻辑处理？ 另外，栈信息看不出brpc相关的东西。可以在gdb里面把所有线程的栈打印出来，命令: taas bt\r\n\r\n是单机的，只是为tf提供一个rpc接口。类似于 tensorflow service。 用户访问http接口，进行单机的tf计算，然后返回结果。\r\n\r\n其他的栈我看了，没有异常。 只有33个线程阻塞在了DirectSession的wait上。此时，图的op里面用brpc调用的下游，因为是异步，但是没有bthread来处理回调，所以应该是堆积在了队列里（猜测，等后续复现，我会用gdb打印出内存内容看）。\r\n\r\n\"在rpc的worker线程内等计算结束，把所有的worker都阻塞住了 \" 这个结论我觉得是正确的。 所以我现在正寻找解决方案。\r\n不知道把\"等计算结束\"改成异步的，是不是能彻底解决这个问题。 \r\n\r\n另外我其实想知道。brpc对这种需要长时间的io的。如果不异步，是不是也会出现把worker线程打满的问题。 比如worker都陷入了同步的read。 ","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1632102012/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1632225108","html_url":"https://github.com/apache/brpc/issues/2313#issuecomment-1632225108","issue_url":"https://api.github.com/repos/apache/brpc/issues/2313","id":1632225108,"node_id":"IC_kwDOBhmkcs5hScdU","user":{"login":"gexiaonie","id":9265829,"node_id":"MDQ6VXNlcjkyNjU4Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/9265829?v=4","gravatar_id":"","url":"https://api.github.com/users/gexiaonie","html_url":"https://github.com/gexiaonie","followers_url":"https://api.github.com/users/gexiaonie/followers","following_url":"https://api.github.com/users/gexiaonie/following{/other_user}","gists_url":"https://api.github.com/users/gexiaonie/gists{/gist_id}","starred_url":"https://api.github.com/users/gexiaonie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gexiaonie/subscriptions","organizations_url":"https://api.github.com/users/gexiaonie/orgs","repos_url":"https://api.github.com/users/gexiaonie/repos","events_url":"https://api.github.com/users/gexiaonie/events{/privacy}","received_events_url":"https://api.github.com/users/gexiaonie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-12T10:08:52Z","updated_at":"2023-07-12T10:14:07Z","author_association":"NONE","body":"> \r\n\r\n你的场景大概是: 本身是一个brpc服务，然后调用tf的，而tf里面有部分op是请求下游的rpc服务？这个场景的核心问题就是DirectSession::Run会使用pthread同步机制，阻塞当前的pthread。导致bthread的worker线程被卡住，bthread无法切换走。qps一高，就有可能导致bthread的线程池全部被占用，但是TF的RPC Op还等着处理，就导致死锁了。感觉可以这样解决: 新建一个pthread线程池，将session::run丢到这个新建的线程池处理（当然使用异步的方式）。这样就不会导致bthread worker线程卡死的问题了。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1632225108/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1632324368","html_url":"https://github.com/apache/brpc/issues/2313#issuecomment-1632324368","issue_url":"https://api.github.com/repos/apache/brpc/issues/2313","id":1632324368,"node_id":"IC_kwDOBhmkcs5hS0sQ","user":{"login":"zgaze","id":20501506,"node_id":"MDQ6VXNlcjIwNTAxNTA2","avatar_url":"https://avatars.githubusercontent.com/u/20501506?v=4","gravatar_id":"","url":"https://api.github.com/users/zgaze","html_url":"https://github.com/zgaze","followers_url":"https://api.github.com/users/zgaze/followers","following_url":"https://api.github.com/users/zgaze/following{/other_user}","gists_url":"https://api.github.com/users/zgaze/gists{/gist_id}","starred_url":"https://api.github.com/users/zgaze/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zgaze/subscriptions","organizations_url":"https://api.github.com/users/zgaze/orgs","repos_url":"https://api.github.com/users/zgaze/repos","events_url":"https://api.github.com/users/zgaze/events{/privacy}","received_events_url":"https://api.github.com/users/zgaze/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-12T11:16:02Z","updated_at":"2023-07-12T11:16:02Z","author_association":"NONE","body":"> > \r\n> \r\n> 你的场景大概是: 本身是一个brpc服务，然后调用tf的，而tf里面有部分op是请求下游的rpc服务？这个场景的核心问题就是DirectSession::Run会使用pthread同步机制，阻塞当前的pthread。导致bthread的worker线程被卡住，bthread无法切换走。qps一高，就有可能导致bthread的线程池全部被占用，但是TF的RPC Op还等着处理，就导致死锁了。感觉可以这样解决: 新建一个pthread线程池，将session::run丢到这个新建的线程池处理（当然使用异步的方式）。这样就不会导致bthread worker线程卡死的问题了。\r\n\r\n非常感谢。 这个思路我之前有，但是不确定能不能解决这个问题。 \r\n这个问题我关闭，感谢几位的热情支持 。另外，我觉得brpc可以提供一个utils类，来支撑这样的场景。感觉还是挺常见的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1632324368/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1632616147","html_url":"https://github.com/apache/brpc/pull/2312#issuecomment-1632616147","issue_url":"https://api.github.com/repos/apache/brpc/issues/2312","id":1632616147,"node_id":"IC_kwDOBhmkcs5hT77T","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-12T14:18:10Z","updated_at":"2023-07-12T14:18:10Z","author_association":"CONTRIBUTOR","body":"https://github.com/apache/brpc-website/pull/153","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1632616147/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1633928238","html_url":"https://github.com/apache/brpc/issues/2315#issuecomment-1633928238","issue_url":"https://api.github.com/repos/apache/brpc/issues/2315","id":1633928238,"node_id":"IC_kwDOBhmkcs5hY8Qu","user":{"login":"fausturs","id":25004087,"node_id":"MDQ6VXNlcjI1MDA0MDg3","avatar_url":"https://avatars.githubusercontent.com/u/25004087?v=4","gravatar_id":"","url":"https://api.github.com/users/fausturs","html_url":"https://github.com/fausturs","followers_url":"https://api.github.com/users/fausturs/followers","following_url":"https://api.github.com/users/fausturs/following{/other_user}","gists_url":"https://api.github.com/users/fausturs/gists{/gist_id}","starred_url":"https://api.github.com/users/fausturs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fausturs/subscriptions","organizations_url":"https://api.github.com/users/fausturs/orgs","repos_url":"https://api.github.com/users/fausturs/repos","events_url":"https://api.github.com/users/fausturs/events{/privacy}","received_events_url":"https://api.github.com/users/fausturs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-13T09:52:53Z","updated_at":"2023-07-13T09:52:53Z","author_association":"NONE","body":"补充一下，我跑的测试代码\r\n\r\n<img width=\"971\" alt=\"image\" src=\"https://github.com/apache/brpc/assets/25004087/843e0d60-5ce3-4fcb-b960-7dea067da82c\">\r\n\r\nbrpc部分，就是随便加点输出信息。\r\n\r\n<img width=\"768\" alt=\"image\" src=\"https://github.com/apache/brpc/assets/25004087/690835c3-45b1-4de9-b419-09e3cb989f91\">\r\n搞一个server，类似这样，在处理request得时候提交两个子任务。\r\n\r\n<img width=\"1030\" alt=\"image\" src=\"https://github.com/apache/brpc/assets/25004087/b4ef9aeb-2693-4a35-afd7-2f69c23259c7\">\r\n一个可能的输出是这样的。\r\n可以看到，在时间轴上，两个线程分别设置了span->_next_client之后，再分别设置了parent->_next_client。这个时候容易知道链表中只有一个节点了（预期是两个）。此时内存泄漏了。\r\n![image](https://github.com/apache/brpc/assets/25004087/dc90a118-dd5f-4942-8e9f-ba2506a4ec07)\r\ncon从rpcz页面中也能看到，client span只有一个了。\r\n\r\n\r\n如果同时写parent->_next_client，则可能写坏内存，导致出core。这个就比较难复现了。\r\n\r\n\r\n\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1633928238/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1633929621","html_url":"https://github.com/apache/brpc/issues/2315#issuecomment-1633929621","issue_url":"https://api.github.com/repos/apache/brpc/issues/2315","id":1633929621,"node_id":"IC_kwDOBhmkcs5hY8mV","user":{"login":"fausturs","id":25004087,"node_id":"MDQ6VXNlcjI1MDA0MDg3","avatar_url":"https://avatars.githubusercontent.com/u/25004087?v=4","gravatar_id":"","url":"https://api.github.com/users/fausturs","html_url":"https://github.com/fausturs","followers_url":"https://api.github.com/users/fausturs/followers","following_url":"https://api.github.com/users/fausturs/following{/other_user}","gists_url":"https://api.github.com/users/fausturs/gists{/gist_id}","starred_url":"https://api.github.com/users/fausturs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fausturs/subscriptions","organizations_url":"https://api.github.com/users/fausturs/orgs","repos_url":"https://api.github.com/users/fausturs/repos","events_url":"https://api.github.com/users/fausturs/events{/privacy}","received_events_url":"https://api.github.com/users/fausturs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-13T09:53:46Z","updated_at":"2023-07-13T09:53:46Z","author_association":"NONE","body":"![image](https://github.com/apache/brpc/assets/25004087/58488732-1335-4021-9153-a54439636d3a)\r\n\r\nrpcz的截图补充","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1633929621/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1634011850","html_url":"https://github.com/apache/brpc/issues/2314#issuecomment-1634011850","issue_url":"https://api.github.com/repos/apache/brpc/issues/2314","id":1634011850,"node_id":"IC_kwDOBhmkcs5hZQrK","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-13T10:47:46Z","updated_at":"2023-07-13T10:47:46Z","author_association":"CONTRIBUTOR","body":"已知问题，这个PR已修复：https://github.com/apache/brpc/pull/2256","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1634011850/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1634122108","html_url":"https://github.com/apache/brpc/issues/2317#issuecomment-1634122108","issue_url":"https://api.github.com/repos/apache/brpc/issues/2317","id":1634122108,"node_id":"IC_kwDOBhmkcs5hZrl8","user":{"login":"qqwangxiaow","id":26954625,"node_id":"MDQ6VXNlcjI2OTU0NjI1","avatar_url":"https://avatars.githubusercontent.com/u/26954625?v=4","gravatar_id":"","url":"https://api.github.com/users/qqwangxiaow","html_url":"https://github.com/qqwangxiaow","followers_url":"https://api.github.com/users/qqwangxiaow/followers","following_url":"https://api.github.com/users/qqwangxiaow/following{/other_user}","gists_url":"https://api.github.com/users/qqwangxiaow/gists{/gist_id}","starred_url":"https://api.github.com/users/qqwangxiaow/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/qqwangxiaow/subscriptions","organizations_url":"https://api.github.com/users/qqwangxiaow/orgs","repos_url":"https://api.github.com/users/qqwangxiaow/repos","events_url":"https://api.github.com/users/qqwangxiaow/events{/privacy}","received_events_url":"https://api.github.com/users/qqwangxiaow/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-13T12:02:48Z","updated_at":"2023-07-13T12:02:48Z","author_association":"CONTRIBUTOR","body":"缺少 sinal_and_wait 这种方法 提前xigou了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1634122108/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1635195788","html_url":"https://github.com/apache/brpc/issues/2314#issuecomment-1635195788","issue_url":"https://api.github.com/repos/apache/brpc/issues/2314","id":1635195788,"node_id":"IC_kwDOBhmkcs5hdxuM","user":{"login":"xiedeacc","id":8072296,"node_id":"MDQ6VXNlcjgwNzIyOTY=","avatar_url":"https://avatars.githubusercontent.com/u/8072296?v=4","gravatar_id":"","url":"https://api.github.com/users/xiedeacc","html_url":"https://github.com/xiedeacc","followers_url":"https://api.github.com/users/xiedeacc/followers","following_url":"https://api.github.com/users/xiedeacc/following{/other_user}","gists_url":"https://api.github.com/users/xiedeacc/gists{/gist_id}","starred_url":"https://api.github.com/users/xiedeacc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiedeacc/subscriptions","organizations_url":"https://api.github.com/users/xiedeacc/orgs","repos_url":"https://api.github.com/users/xiedeacc/repos","events_url":"https://api.github.com/users/xiedeacc/events{/privacy}","received_events_url":"https://api.github.com/users/xiedeacc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-14T02:59:40Z","updated_at":"2023-07-14T02:59:40Z","author_association":"NONE","body":"> 已知问题，这个PR已修复：#2256\r\n\r\n嗯，就是这个问题","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1635195788/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1637000763","html_url":"https://github.com/apache/brpc/pull/2102#issuecomment-1637000763","issue_url":"https://api.github.com/repos/apache/brpc/issues/2102","id":1637000763,"node_id":"IC_kwDOBhmkcs5hkqY7","user":{"login":"leaf-potato","id":49188857,"node_id":"MDQ6VXNlcjQ5MTg4ODU3","avatar_url":"https://avatars.githubusercontent.com/u/49188857?v=4","gravatar_id":"","url":"https://api.github.com/users/leaf-potato","html_url":"https://github.com/leaf-potato","followers_url":"https://api.github.com/users/leaf-potato/followers","following_url":"https://api.github.com/users/leaf-potato/following{/other_user}","gists_url":"https://api.github.com/users/leaf-potato/gists{/gist_id}","starred_url":"https://api.github.com/users/leaf-potato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leaf-potato/subscriptions","organizations_url":"https://api.github.com/users/leaf-potato/orgs","repos_url":"https://api.github.com/users/leaf-potato/repos","events_url":"https://api.github.com/users/leaf-potato/events{/privacy}","received_events_url":"https://api.github.com/users/leaf-potato/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-16T07:03:08Z","updated_at":"2023-07-16T07:03:08Z","author_association":"CONTRIBUTOR","body":"> UT编译失败了：\r\n> brpc_ssl_unittest.cpp:342:66: error: too few arguments to function call, expected 5, have 4\r\n> brpc::SSLOptions(), NULL);\r\n\r\n@wwbmmm  编译失败已解决，同时补充了本次功能的UT和文档","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1637000763/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1637030172","html_url":"https://github.com/apache/brpc/issues/2318#issuecomment-1637030172","issue_url":"https://api.github.com/repos/apache/brpc/issues/2318","id":1637030172,"node_id":"IC_kwDOBhmkcs5hkxkc","user":{"login":"leaf-potato","id":49188857,"node_id":"MDQ6VXNlcjQ5MTg4ODU3","avatar_url":"https://avatars.githubusercontent.com/u/49188857?v=4","gravatar_id":"","url":"https://api.github.com/users/leaf-potato","html_url":"https://github.com/leaf-potato","followers_url":"https://api.github.com/users/leaf-potato/followers","following_url":"https://api.github.com/users/leaf-potato/following{/other_user}","gists_url":"https://api.github.com/users/leaf-potato/gists{/gist_id}","starred_url":"https://api.github.com/users/leaf-potato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leaf-potato/subscriptions","organizations_url":"https://api.github.com/users/leaf-potato/orgs","repos_url":"https://api.github.com/users/leaf-potato/repos","events_url":"https://api.github.com/users/leaf-potato/events{/privacy}","received_events_url":"https://api.github.com/users/leaf-potato/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-16T09:04:21Z","updated_at":"2023-07-16T09:04:21Z","author_association":"CONTRIBUTOR","body":"其他UT也有类似问题 ，brpc_ssl_unittest`运行错误：\r\n```\r\n[==========] Running 5 tests from 1 test case.\r\n[----------] Global test environment set-up.\r\n[----------] 5 tests from SSLTest\r\n[ RUN      ] SSLTest.sanity\r\nW0716 17:00:42.435997 1733130 /home/leaf-potato/Open-Source/brpc/src/brpc/server.cpp:1968] Duplicate certificate hostname=cert1\r\nW0716 17:00:42.436084 1733130 /home/leaf-potato/Open-Source/brpc/src/brpc/server.cpp:1968] Duplicate certificate hostname=cert1\r\nI0716 17:00:42.442796 1733130 /home/leaf-potato/Open-Source/brpc/src/brpc/server.cpp:1127] Server[EchoServiceImpl] is serving on port=8613.\r\nI0716 17:00:42.599956 1733130 /home/leaf-potato/Open-Source/brpc/src/brpc/server.cpp:1130] Check out http://dev-ubuntu:8613 in web browser.\r\nF0716 17:00:42.608247 1733141 /home/leaf-potato/Open-Source/brpc/src/bthread/task_group.cpp:574] Recursively(1) call sched_to(0xaaaad7326d80)\r\nI0716 17:00:42.608291 1733136 /home/leaf-potato/Open-Source/brpc/src/bthread/fd.cpp:330] Use DEL+ADD instead of EPOLLONESHOT+MOD due to kernel bug. Performance will be much lower.\r\nF0716 17:00:42.609952 1733141 /home/leaf-potato/Open-Source/brpc/src/bthread/task_group.cpp:574] Recursively(1) call sched_to(0xaaaad7326d80)\r\nF0716 17:00:42.614055 1733141 /home/leaf-potato/Open-Source/brpc/src/bthread/task_group.cpp:574] Recursively(1) call sched_to(0xaaaad7326d80)\r\nF0716 17:00:42.615524 1733137 /home/leaf-potato/Open-Source/brpc/src/bthread/task_group.cpp:574] Recursively(1) call sched_to(0xaaaad7326780)\r\nF0716 17:00:42.615918 1733140 /home/leaf-potato/Open-Source/brpc/src/bthread/task_group.cpp:574] Recursively(1) call sched_to(0xaaaad7326c00)\r\nF0716 17:00:42.617769 1733135 /home/leaf-potato/Open-Source/brpc/src/bthread/task_group.cpp:574] Recursively(1) call sched_to(0xaaaad7326480)\r\nF0716 17:00:42.618183 1733138 /home/leaf-potato/Open-Source/brpc/src/bthread/task_group.cpp:574] Recursively(1) call sched_to(0xaaaad7326900)\r\nF0716 17:00:42.618773 1733139 /home/leaf-potato/Open-Source/brpc/src/bthread/task_group.cpp:574] Recursively(1) call sched_to(0xaaaad7326a80)\r\nF0716 17:00:42.619078 1733139 /home/leaf-potato/Open-Source/brpc/src/bthread/task_group.cpp:574] Recursively(2) call sched_to(0xaaaad7326a80)\r\n```\r\n\r\n相同的版本使用clang编译后运行没有问题，比较奇怪。不知道跟之前这个https://github.com/apache/brpc/issues/845 问题是否类似","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1637030172/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1637052525","html_url":"https://github.com/apache/brpc/issues/2316#issuecomment-1637052525","issue_url":"https://api.github.com/repos/apache/brpc/issues/2316","id":1637052525,"node_id":"IC_kwDOBhmkcs5hk3Bt","user":{"login":"leaf-potato","id":49188857,"node_id":"MDQ6VXNlcjQ5MTg4ODU3","avatar_url":"https://avatars.githubusercontent.com/u/49188857?v=4","gravatar_id":"","url":"https://api.github.com/users/leaf-potato","html_url":"https://github.com/leaf-potato","followers_url":"https://api.github.com/users/leaf-potato/followers","following_url":"https://api.github.com/users/leaf-potato/following{/other_user}","gists_url":"https://api.github.com/users/leaf-potato/gists{/gist_id}","starred_url":"https://api.github.com/users/leaf-potato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leaf-potato/subscriptions","organizations_url":"https://api.github.com/users/leaf-potato/orgs","repos_url":"https://api.github.com/users/leaf-potato/repos","events_url":"https://api.github.com/users/leaf-potato/events{/privacy}","received_events_url":"https://api.github.com/users/leaf-potato/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-16T10:57:27Z","updated_at":"2023-07-16T10:57:27Z","author_association":"CONTRIBUTOR","body":"server端可能开启了alpn协商，默认处理http协议，不具备协议自动识别能力。\r\n需要SSL扩展进行协商才能通过h2访问，详见https://github.com/apache/brpc/issues/1991 中的nginx例子","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1637052525/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1638025055","html_url":"https://github.com/apache/brpc/issues/2244#issuecomment-1638025055","issue_url":"https://api.github.com/repos/apache/brpc/issues/2244","id":1638025055,"node_id":"IC_kwDOBhmkcs5hokdf","user":{"login":"leaf-potato","id":49188857,"node_id":"MDQ6VXNlcjQ5MTg4ODU3","avatar_url":"https://avatars.githubusercontent.com/u/49188857?v=4","gravatar_id":"","url":"https://api.github.com/users/leaf-potato","html_url":"https://github.com/leaf-potato","followers_url":"https://api.github.com/users/leaf-potato/followers","following_url":"https://api.github.com/users/leaf-potato/following{/other_user}","gists_url":"https://api.github.com/users/leaf-potato/gists{/gist_id}","starred_url":"https://api.github.com/users/leaf-potato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leaf-potato/subscriptions","organizations_url":"https://api.github.com/users/leaf-potato/orgs","repos_url":"https://api.github.com/users/leaf-potato/repos","events_url":"https://api.github.com/users/leaf-potato/events{/privacy}","received_events_url":"https://api.github.com/users/leaf-potato/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-17T12:24:29Z","updated_at":"2023-07-17T12:24:29Z","author_association":"CONTRIBUTOR","body":"> 关闭这个对监控指标会有啥问题吗？ 比如，curl http://xxx:port/vars\r\n\r\n@yanglimingcn bvar的统计值都会失效，参考https://github.com/apache/brpc/issues/1891","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1638025055/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1639188273","html_url":"https://github.com/apache/brpc/issues/2318#issuecomment-1639188273","issue_url":"https://api.github.com/repos/apache/brpc/issues/2318","id":1639188273,"node_id":"IC_kwDOBhmkcs5htAcx","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-18T02:34:01Z","updated_at":"2023-07-18T02:34:01Z","author_association":"CONTRIBUTOR","body":"clang没有问题可能是因为这里走了不同的分支\r\nhttps://github.com/apache/brpc/blob/master/src/butil/thread_local.h#L49\r\n试试改下这里让gcc+aarch64也走上面的分支呢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1639188273/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1641495905","html_url":"https://github.com/apache/brpc/issues/2313#issuecomment-1641495905","issue_url":"https://api.github.com/repos/apache/brpc/issues/2313","id":1641495905,"node_id":"IC_kwDOBhmkcs5h1z1h","user":{"login":"xiedeacc","id":8072296,"node_id":"MDQ6VXNlcjgwNzIyOTY=","avatar_url":"https://avatars.githubusercontent.com/u/8072296?v=4","gravatar_id":"","url":"https://api.github.com/users/xiedeacc","html_url":"https://github.com/xiedeacc","followers_url":"https://api.github.com/users/xiedeacc/followers","following_url":"https://api.github.com/users/xiedeacc/following{/other_user}","gists_url":"https://api.github.com/users/xiedeacc/gists{/gist_id}","starred_url":"https://api.github.com/users/xiedeacc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiedeacc/subscriptions","organizations_url":"https://api.github.com/users/xiedeacc/orgs","repos_url":"https://api.github.com/users/xiedeacc/repos","events_url":"https://api.github.com/users/xiedeacc/events{/privacy}","received_events_url":"https://api.github.com/users/xiedeacc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-19T06:31:46Z","updated_at":"2023-07-19T06:31:46Z","author_association":"NONE","body":"> > > \r\n> > \r\n> > \r\n> > 你的场景大概是: 本身是一个brpc服务，然后调用tf的，而tf里面有部分op是请求下游的rpc服务？这个场景的核心问题就是DirectSession::Run会使用pthread同步机制，阻塞当前的pthread。导致bthread的worker线程被卡住，bthread无法切换走。qps一高，就有可能导致bthread的线程池全部被占用，但是TF的RPC Op还等着处理，就导致死锁了。感觉可以这样解决: 新建一个pthread线程池，将session::run丢到这个新建的线程池处理（当然使用异步的方式）。这样就不会导致bthread worker线程卡死的问题了。\r\n> \r\n> 非常感谢。 这个思路我之前有，但是不确定能不能解决这个问题。 这个问题我关闭，感谢几位的热情支持 。另外，我觉得brpc可以提供一个utils类，来支撑这样的场景。感觉还是挺常见的。\r\n\r\nbrpc本身的调度框架，导致brpc对这个问题无解，只能调高brpc_thread_num这个参数来尽量避免。brpc要想解决这个问题，底层的线程池必须要分组","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1641495905/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1642348122","html_url":"https://github.com/apache/brpc/issues/2310#issuecomment-1642348122","issue_url":"https://api.github.com/repos/apache/brpc/issues/2310","id":1642348122,"node_id":"IC_kwDOBhmkcs5h5D5a","user":{"login":"leaf-potato","id":49188857,"node_id":"MDQ6VXNlcjQ5MTg4ODU3","avatar_url":"https://avatars.githubusercontent.com/u/49188857?v=4","gravatar_id":"","url":"https://api.github.com/users/leaf-potato","html_url":"https://github.com/leaf-potato","followers_url":"https://api.github.com/users/leaf-potato/followers","following_url":"https://api.github.com/users/leaf-potato/following{/other_user}","gists_url":"https://api.github.com/users/leaf-potato/gists{/gist_id}","starred_url":"https://api.github.com/users/leaf-potato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leaf-potato/subscriptions","organizations_url":"https://api.github.com/users/leaf-potato/orgs","repos_url":"https://api.github.com/users/leaf-potato/repos","events_url":"https://api.github.com/users/leaf-potato/events{/privacy}","received_events_url":"https://api.github.com/users/leaf-potato/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-19T15:53:37Z","updated_at":"2023-07-19T15:53:37Z","author_association":"CONTRIBUTOR","body":"不支持，可以参考[new protocol](https://github.com/apache/brpc/blob/master/docs/cn/new_protocol.md)新增协议的支持","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1642348122/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1643005220","html_url":"https://github.com/apache/brpc/pull/2320#issuecomment-1643005220","issue_url":"https://api.github.com/repos/apache/brpc/issues/2320","id":1643005220,"node_id":"IC_kwDOBhmkcs5h7kUk","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-20T02:16:00Z","updated_at":"2023-07-20T02:16:00Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1643005220/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1643058872","html_url":"https://github.com/apache/brpc/issues/2321#issuecomment-1643058872","issue_url":"https://api.github.com/repos/apache/brpc/issues/2321","id":1643058872,"node_id":"IC_kwDOBhmkcs5h7xa4","user":{"login":"Jiaao-Bai","id":60597682,"node_id":"MDQ6VXNlcjYwNTk3Njgy","avatar_url":"https://avatars.githubusercontent.com/u/60597682?v=4","gravatar_id":"","url":"https://api.github.com/users/Jiaao-Bai","html_url":"https://github.com/Jiaao-Bai","followers_url":"https://api.github.com/users/Jiaao-Bai/followers","following_url":"https://api.github.com/users/Jiaao-Bai/following{/other_user}","gists_url":"https://api.github.com/users/Jiaao-Bai/gists{/gist_id}","starred_url":"https://api.github.com/users/Jiaao-Bai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jiaao-Bai/subscriptions","organizations_url":"https://api.github.com/users/Jiaao-Bai/orgs","repos_url":"https://api.github.com/users/Jiaao-Bai/repos","events_url":"https://api.github.com/users/Jiaao-Bai/events{/privacy}","received_events_url":"https://api.github.com/users/Jiaao-Bai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-20T03:42:39Z","updated_at":"2023-07-20T03:42:39Z","author_association":"NONE","body":"@Tuvie 老板求看看，，我想改一下这块，不知道具体成本有多少，不太敢动","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1643058872/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1643431067","html_url":"https://github.com/apache/brpc/issues/2321#issuecomment-1643431067","issue_url":"https://api.github.com/repos/apache/brpc/issues/2321","id":1643431067,"node_id":"IC_kwDOBhmkcs5h9MSb","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-20T07:38:46Z","updated_at":"2023-07-20T07:38:46Z","author_association":"CONTRIBUTOR","body":"之前的场景没有这块需求，所以暂时没在计划中。\r\n如果要改这块，需要启用多个设备对应的ibv_context、ibv_pd等，并且iobuf内存应该在多个设备上同时注册。\r\n具体每个Socket创建的时候，需要根据路由确定其QP从哪个设备创建出来。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1643431067/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1643531105","html_url":"https://github.com/apache/brpc/issues/2259#issuecomment-1643531105","issue_url":"https://api.github.com/repos/apache/brpc/issues/2259","id":1643531105,"node_id":"IC_kwDOBhmkcs5h9kth","user":{"login":"dandyhuang","id":12603054,"node_id":"MDQ6VXNlcjEyNjAzMDU0","avatar_url":"https://avatars.githubusercontent.com/u/12603054?v=4","gravatar_id":"","url":"https://api.github.com/users/dandyhuang","html_url":"https://github.com/dandyhuang","followers_url":"https://api.github.com/users/dandyhuang/followers","following_url":"https://api.github.com/users/dandyhuang/following{/other_user}","gists_url":"https://api.github.com/users/dandyhuang/gists{/gist_id}","starred_url":"https://api.github.com/users/dandyhuang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dandyhuang/subscriptions","organizations_url":"https://api.github.com/users/dandyhuang/orgs","repos_url":"https://api.github.com/users/dandyhuang/repos","events_url":"https://api.github.com/users/dandyhuang/events{/privacy}","received_events_url":"https://api.github.com/users/dandyhuang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-20T08:49:52Z","updated_at":"2023-07-20T08:49:52Z","author_association":"NONE","body":"> DynamicPartitionChannel\r\n\r\n请教一下 ，有什么业务形态会用到DynamicPartitionChannel这个功能呢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1643531105/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1644926044","html_url":"https://github.com/apache/brpc/issues/2321#issuecomment-1644926044","issue_url":"https://api.github.com/repos/apache/brpc/issues/2321","id":1644926044,"node_id":"IC_kwDOBhmkcs5iC5Rc","user":{"login":"Jiaao-Bai","id":60597682,"node_id":"MDQ6VXNlcjYwNTk3Njgy","avatar_url":"https://avatars.githubusercontent.com/u/60597682?v=4","gravatar_id":"","url":"https://api.github.com/users/Jiaao-Bai","html_url":"https://github.com/Jiaao-Bai","followers_url":"https://api.github.com/users/Jiaao-Bai/followers","following_url":"https://api.github.com/users/Jiaao-Bai/following{/other_user}","gists_url":"https://api.github.com/users/Jiaao-Bai/gists{/gist_id}","starred_url":"https://api.github.com/users/Jiaao-Bai/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Jiaao-Bai/subscriptions","organizations_url":"https://api.github.com/users/Jiaao-Bai/orgs","repos_url":"https://api.github.com/users/Jiaao-Bai/repos","events_url":"https://api.github.com/users/Jiaao-Bai/events{/privacy}","received_events_url":"https://api.github.com/users/Jiaao-Bai/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-21T03:13:48Z","updated_at":"2023-07-21T03:13:48Z","author_association":"NONE","body":"感谢老板！","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1644926044/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1646598773","html_url":"https://github.com/apache/brpc/issues/2316#issuecomment-1646598773","issue_url":"https://api.github.com/repos/apache/brpc/issues/2316","id":1646598773,"node_id":"IC_kwDOBhmkcs5iJRp1","user":{"login":"muyilangjun1","id":19385931,"node_id":"MDQ6VXNlcjE5Mzg1OTMx","avatar_url":"https://avatars.githubusercontent.com/u/19385931?v=4","gravatar_id":"","url":"https://api.github.com/users/muyilangjun1","html_url":"https://github.com/muyilangjun1","followers_url":"https://api.github.com/users/muyilangjun1/followers","following_url":"https://api.github.com/users/muyilangjun1/following{/other_user}","gists_url":"https://api.github.com/users/muyilangjun1/gists{/gist_id}","starred_url":"https://api.github.com/users/muyilangjun1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/muyilangjun1/subscriptions","organizations_url":"https://api.github.com/users/muyilangjun1/orgs","repos_url":"https://api.github.com/users/muyilangjun1/repos","events_url":"https://api.github.com/users/muyilangjun1/events{/privacy}","received_events_url":"https://api.github.com/users/muyilangjun1/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-22T14:42:39Z","updated_at":"2023-07-22T14:42:39Z","author_association":"NONE","body":"恩，看了一下#1991issue，是不是意味着需要等框架支持alpn后才支持这样调用？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1646598773/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1646841803","html_url":"https://github.com/apache/brpc/issues/2316#issuecomment-1646841803","issue_url":"https://api.github.com/repos/apache/brpc/issues/2316","id":1646841803,"node_id":"IC_kwDOBhmkcs5iKM_L","user":{"login":"leaf-potato","id":49188857,"node_id":"MDQ6VXNlcjQ5MTg4ODU3","avatar_url":"https://avatars.githubusercontent.com/u/49188857?v=4","gravatar_id":"","url":"https://api.github.com/users/leaf-potato","html_url":"https://github.com/leaf-potato","followers_url":"https://api.github.com/users/leaf-potato/followers","following_url":"https://api.github.com/users/leaf-potato/following{/other_user}","gists_url":"https://api.github.com/users/leaf-potato/gists{/gist_id}","starred_url":"https://api.github.com/users/leaf-potato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leaf-potato/subscriptions","organizations_url":"https://api.github.com/users/leaf-potato/orgs","repos_url":"https://api.github.com/users/leaf-potato/repos","events_url":"https://api.github.com/users/leaf-potato/events{/privacy}","received_events_url":"https://api.github.com/users/leaf-potato/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-23T13:32:22Z","updated_at":"2023-07-23T13:32:22Z","author_association":"CONTRIBUTOR","body":"> 恩，看了一下#1991issue，是不是意味着需要等框架支持alpn后才支持这样调用？\r\n\r\n嗯，是这样的","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1646841803/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1646860425","html_url":"https://github.com/apache/brpc/issues/2318#issuecomment-1646860425","issue_url":"https://api.github.com/repos/apache/brpc/issues/2318","id":1646860425,"node_id":"IC_kwDOBhmkcs5iKRiJ","user":{"login":"leaf-potato","id":49188857,"node_id":"MDQ6VXNlcjQ5MTg4ODU3","avatar_url":"https://avatars.githubusercontent.com/u/49188857?v=4","gravatar_id":"","url":"https://api.github.com/users/leaf-potato","html_url":"https://github.com/leaf-potato","followers_url":"https://api.github.com/users/leaf-potato/followers","following_url":"https://api.github.com/users/leaf-potato/following{/other_user}","gists_url":"https://api.github.com/users/leaf-potato/gists{/gist_id}","starred_url":"https://api.github.com/users/leaf-potato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leaf-potato/subscriptions","organizations_url":"https://api.github.com/users/leaf-potato/orgs","repos_url":"https://api.github.com/users/leaf-potato/repos","events_url":"https://api.github.com/users/leaf-potato/events{/privacy}","received_events_url":"https://api.github.com/users/leaf-potato/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-23T14:48:35Z","updated_at":"2023-07-23T14:48:35Z","author_association":"CONTRIBUTOR","body":"> https://github.com/apache/brpc/blob/master/src/butil/thread_local.h#L49\r\n> 试试改下这里让gcc+aarch64也走上面的分支呢\r\n\r\n改了后单测可以过了，这是啥原因呀？方便讲下嘛","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1646860425/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1646860573","html_url":"https://github.com/apache/brpc/issues/2275#issuecomment-1646860573","issue_url":"https://api.github.com/repos/apache/brpc/issues/2275","id":1646860573,"node_id":"IC_kwDOBhmkcs5iKRkd","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-23T14:49:08Z","updated_at":"2023-07-23T14:49:08Z","author_association":"CONTRIBUTOR","body":"key设置为空的目的是什么？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1646860573/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647322225","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1647322225","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1647322225,"node_id":"IC_kwDOBhmkcs5iMCRx","user":{"login":"372046933","id":1251167,"node_id":"MDQ6VXNlcjEyNTExNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1251167?v=4","gravatar_id":"","url":"https://api.github.com/users/372046933","html_url":"https://github.com/372046933","followers_url":"https://api.github.com/users/372046933/followers","following_url":"https://api.github.com/users/372046933/following{/other_user}","gists_url":"https://api.github.com/users/372046933/gists{/gist_id}","starred_url":"https://api.github.com/users/372046933/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/372046933/subscriptions","organizations_url":"https://api.github.com/users/372046933/orgs","repos_url":"https://api.github.com/users/372046933/repos","events_url":"https://api.github.com/users/372046933/events{/privacy}","received_events_url":"https://api.github.com/users/372046933/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-24T06:56:46Z","updated_at":"2023-07-24T06:56:46Z","author_association":"CONTRIBUTOR","body":"@Tuvie \r\n这个地方的PostRecv在RTR之前，实际不生效。需要放到QP RTR之后吗？\r\nhttps://github.com/apache/brpc/blob/2729272ae5ee69e4c4142d14b7fafbf800944316/src/brpc/rdma/rdma_endpoint.cpp#L1171","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647322225/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647524251","html_url":"https://github.com/apache/brpc/pull/2322#issuecomment-1647524251","issue_url":"https://api.github.com/repos/apache/brpc/issues/2322","id":1647524251,"node_id":"IC_kwDOBhmkcs5iMzmb","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-24T09:13:06Z","updated_at":"2023-07-24T09:13:06Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647524251/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647526508","html_url":"https://github.com/apache/brpc/pull/2323#issuecomment-1647526508","issue_url":"https://api.github.com/repos/apache/brpc/issues/2323","id":1647526508,"node_id":"IC_kwDOBhmkcs5iM0Js","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-24T09:14:31Z","updated_at":"2023-07-24T09:14:31Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647526508/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647535856","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1647535856","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1647535856,"node_id":"IC_kwDOBhmkcs5iM2bw","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-24T09:20:19Z","updated_at":"2023-07-24T09:20:19Z","author_association":"CONTRIBUTOR","body":"RTR是说ready to receive packet，post receive是可以的。你说不生效是测试报错了吗","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647535856/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647573055","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1647573055","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1647573055,"node_id":"IC_kwDOBhmkcs5iM_g_","user":{"login":"372046933","id":1251167,"node_id":"MDQ6VXNlcjEyNTExNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1251167?v=4","gravatar_id":"","url":"https://api.github.com/users/372046933","html_url":"https://github.com/372046933","followers_url":"https://api.github.com/users/372046933/followers","following_url":"https://api.github.com/users/372046933/following{/other_user}","gists_url":"https://api.github.com/users/372046933/gists{/gist_id}","starred_url":"https://api.github.com/users/372046933/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/372046933/subscriptions","organizations_url":"https://api.github.com/users/372046933/orgs","repos_url":"https://api.github.com/users/372046933/repos","events_url":"https://api.github.com/users/372046933/events{/privacy}","received_events_url":"https://api.github.com/users/372046933/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-24T09:43:15Z","updated_at":"2023-07-24T09:43:15Z","author_association":"CONTRIBUTOR","body":"没有报错，就是想问下，实际上这些WR会等到RTR状态再处理的对吧？\r\n\r\n另外想请教下，类似Socket EOF的报错，应该怎么排查呢？我不太清楚这里面的状态机咋维护的。看日志有点像socket状态流转不对。\r\n\r\n```\r\nW0724 15:26:52.624647   564 external/brpc/src/brpc/input_messenger.cpp:240] Close Socket{id=8589935851 fd=1410 addr=10.156.8.30:64506:16619} (0x55b62c9a4400) due to unknown message: \\FF\\7F\\FF\\FF\\FF\\7F\\FF\\FF\\FF\\7F\\FF\\FF\\FF\\7F\\FF\\FF\\FF\\7F\\00\\00\\00\\00\\FF\\FF\\FF\\7F\\FF\\FF\\FF\\7F\\FF\\FF\\FF\\7F\\FF\\FF\\FF\\7F\\FF\\FF\\FF\\7F\\FF\\FF\\FF\\7F\\FF\\FF\\FF\\7F\\FF\\FF\\FF\\7F\\FF\\FF\\FF\\7F\\FF\\FF\\FF\\7F\\FF\\FF...<skipping 7358 bytes>\r\nW0724 15:26:52.624847   564 external/brpc/src/brpc/policy/baidu_rpc_protocol.cpp:265] Fail to write into Socket{id=8589935851 fd=1410 addr=10.156.8.30:64506:16619} (0x55b62c9a4400): Invalid argument\r\nI0724 15:26:52.727919   551 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:559] Start handshake on Socket{id=8589935271 fd=1410 addr=10.156.8.30:26734:16619} (0x0x55b5ed984240)\r\nW0724 15:26:52.727974   551 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:567] Fail to read Hello Message from client:Socket{id=8589935271 fd=1410 addr=10.156.8.30:26734:16619} (0x0x55b5ed984240) 10.156.8.30:26734: Got EOF\r\nI0724 15:26:52.728424   542 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:559] Start handshake on Socket{id=8589937304 fd=1410 addr=10.156.8.30:26736:16619} (0x0x55b62e366000)\r\nI0724 15:26:52.733604   560 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:695] Handshake ends (use rdma) on Socket{id=8589937304 fd=1410 addr=10.156.8.30:26736:16619} (0x0x55b62e366000)\r\n\r\n\r\nI0724 15:20:20.888519  1066 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:559] Start handshake on Socket{id=2490 fd=1339 addr=10.156.0.33:47142:25191} (0x0x5630d760a900)\r\nW0724 15:20:20.888569  1066 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:567] Fail to read Hello Message from client:Socket{id=2490 fd=1339 addr=10.156.0.33:47142:25191} (0x0x5630d760a900) 10.156.0.33:47142: Got EOF\r\nI0724 15:20:25.786496  1085 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:559] Start handshake on Socket{id=2491 fd=1423 addr=10.156.0.33:47152:25191} (0x0x5630d760ab40)\r\nI0724 15:20:25.793311  1090 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:695] Handshake ends (use rdma) on Socket{id=2491 fd=1423 addr=10.156.0.33:47152:25191} (0x0x5630d760ab40)\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647573055/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647580167","html_url":"https://github.com/apache/brpc/issues/2164#issuecomment-1647580167","issue_url":"https://api.github.com/repos/apache/brpc/issues/2164","id":1647580167,"node_id":"IC_kwDOBhmkcs5iNBQH","user":{"login":"lhsoft","id":8412085,"node_id":"MDQ6VXNlcjg0MTIwODU=","avatar_url":"https://avatars.githubusercontent.com/u/8412085?v=4","gravatar_id":"","url":"https://api.github.com/users/lhsoft","html_url":"https://github.com/lhsoft","followers_url":"https://api.github.com/users/lhsoft/followers","following_url":"https://api.github.com/users/lhsoft/following{/other_user}","gists_url":"https://api.github.com/users/lhsoft/gists{/gist_id}","starred_url":"https://api.github.com/users/lhsoft/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lhsoft/subscriptions","organizations_url":"https://api.github.com/users/lhsoft/orgs","repos_url":"https://api.github.com/users/lhsoft/repos","events_url":"https://api.github.com/users/lhsoft/events{/privacy}","received_events_url":"https://api.github.com/users/lhsoft/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-24T09:47:49Z","updated_at":"2023-07-24T09:47:49Z","author_association":"CONTRIBUTOR","body":"看代码注释主要是和bthread间同步的问题，导致不好删除，在没修复bug之前，可以先让asan ignore这个object","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647580167/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647609799","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1647609799","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1647609799,"node_id":"IC_kwDOBhmkcs5iNIfH","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-24T10:06:48Z","updated_at":"2023-07-24T10:06:58Z","author_association":"CONTRIBUTOR","body":"RTR状态之前不会处理的。\r\n你是指上面的问题是发生在连接刚刚创建，是吗？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647609799/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647624873","html_url":"https://github.com/apache/brpc/issues/2259#issuecomment-1647624873","issue_url":"https://api.github.com/repos/apache/brpc/issues/2259","id":1647624873,"node_id":"IC_kwDOBhmkcs5iNMKp","user":{"login":"xiedeacc","id":8072296,"node_id":"MDQ6VXNlcjgwNzIyOTY=","avatar_url":"https://avatars.githubusercontent.com/u/8072296?v=4","gravatar_id":"","url":"https://api.github.com/users/xiedeacc","html_url":"https://github.com/xiedeacc","followers_url":"https://api.github.com/users/xiedeacc/followers","following_url":"https://api.github.com/users/xiedeacc/following{/other_user}","gists_url":"https://api.github.com/users/xiedeacc/gists{/gist_id}","starred_url":"https://api.github.com/users/xiedeacc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiedeacc/subscriptions","organizations_url":"https://api.github.com/users/xiedeacc/orgs","repos_url":"https://api.github.com/users/xiedeacc/repos","events_url":"https://api.github.com/users/xiedeacc/events{/privacy}","received_events_url":"https://api.github.com/users/xiedeacc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-24T10:16:14Z","updated_at":"2023-07-24T10:16:14Z","author_association":"NONE","body":"改完后，死锁概率降低了，但是还是会发生，目前只是把brpc_thread_num改成几百来规避这个死锁，但是brpc看起来是无法解决bthread使用pthread锁导致的死锁问题，brpc这个问题真的太无语了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647624873/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647625173","html_url":"https://github.com/apache/brpc/issues/2259#issuecomment-1647625173","issue_url":"https://api.github.com/repos/apache/brpc/issues/2259","id":1647625173,"node_id":"IC_kwDOBhmkcs5iNMPV","user":{"login":"xiedeacc","id":8072296,"node_id":"MDQ6VXNlcjgwNzIyOTY=","avatar_url":"https://avatars.githubusercontent.com/u/8072296?v=4","gravatar_id":"","url":"https://api.github.com/users/xiedeacc","html_url":"https://github.com/xiedeacc","followers_url":"https://api.github.com/users/xiedeacc/followers","following_url":"https://api.github.com/users/xiedeacc/following{/other_user}","gists_url":"https://api.github.com/users/xiedeacc/gists{/gist_id}","starred_url":"https://api.github.com/users/xiedeacc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xiedeacc/subscriptions","organizations_url":"https://api.github.com/users/xiedeacc/orgs","repos_url":"https://api.github.com/users/xiedeacc/repos","events_url":"https://api.github.com/users/xiedeacc/events{/privacy}","received_events_url":"https://api.github.com/users/xiedeacc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-24T10:16:27Z","updated_at":"2023-07-24T10:16:27Z","author_association":"NONE","body":"> > DynamicPartitionChannel\r\n> \r\n> 请教一下 ，有什么业务形态会用到DynamicPartitionChannel这个功能呢\r\n\r\n多库","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647625173/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647633986","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1647633986","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1647633986,"node_id":"IC_kwDOBhmkcs5iNOZC","user":{"login":"372046933","id":1251167,"node_id":"MDQ6VXNlcjEyNTExNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1251167?v=4","gravatar_id":"","url":"https://api.github.com/users/372046933","html_url":"https://github.com/372046933","followers_url":"https://api.github.com/users/372046933/followers","following_url":"https://api.github.com/users/372046933/following{/other_user}","gists_url":"https://api.github.com/users/372046933/gists{/gist_id}","starred_url":"https://api.github.com/users/372046933/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/372046933/subscriptions","organizations_url":"https://api.github.com/users/372046933/orgs","repos_url":"https://api.github.com/users/372046933/repos","events_url":"https://api.github.com/users/372046933/events{/privacy}","received_events_url":"https://api.github.com/users/372046933/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-24T10:21:49Z","updated_at":"2023-07-24T10:21:49Z","author_association":"CONTRIBUTOR","body":"不是发生在刚刚创建。在通信过程中发生的，会不会是send/recv pair错乱了导致？从我的出现频率看，QPS高了之后比较容易出现","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647633986/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647651938","html_url":"https://github.com/apache/brpc/issues/2164#issuecomment-1647651938","issue_url":"https://api.github.com/repos/apache/brpc/issues/2164","id":1647651938,"node_id":"IC_kwDOBhmkcs5iNSxi","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-24T10:33:21Z","updated_at":"2023-07-24T11:16:14Z","author_association":"CONTRIBUTOR","body":"感谢回复，目前是通过ignore的方式暂时禁止了，因为leak的大小属于可接受范围.\r\n发自我的 iPhone在 2023年7月24日，17:48，huliu ***@***.***> 写道：﻿\r\n看代码注释主要是和bthread间同步的问题，导致不好删除，在没修复bug之前，可以先让asan ignore这个object\r\n\r\n—Reply to this email directly, view it on GitHub, or unsubscribe.You are receiving this because you authored the thread.Message ID: ***@***.***>","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647651938/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647694086","html_url":"https://github.com/apache/brpc/issues/2259#issuecomment-1647694086","issue_url":"https://api.github.com/repos/apache/brpc/issues/2259","id":1647694086,"node_id":"IC_kwDOBhmkcs5iNdEG","user":{"login":"dandyhuang","id":12603054,"node_id":"MDQ6VXNlcjEyNjAzMDU0","avatar_url":"https://avatars.githubusercontent.com/u/12603054?v=4","gravatar_id":"","url":"https://api.github.com/users/dandyhuang","html_url":"https://github.com/dandyhuang","followers_url":"https://api.github.com/users/dandyhuang/followers","following_url":"https://api.github.com/users/dandyhuang/following{/other_user}","gists_url":"https://api.github.com/users/dandyhuang/gists{/gist_id}","starred_url":"https://api.github.com/users/dandyhuang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dandyhuang/subscriptions","organizations_url":"https://api.github.com/users/dandyhuang/orgs","repos_url":"https://api.github.com/users/dandyhuang/repos","events_url":"https://api.github.com/users/dandyhuang/events{/privacy}","received_events_url":"https://api.github.com/users/dandyhuang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-24T11:02:00Z","updated_at":"2023-07-24T11:02:00Z","author_association":"NONE","body":"> DynamicPartitionChannel\r\n\r\n启多个channel呢","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647694086/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647716103","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1647716103","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1647716103,"node_id":"IC_kwDOBhmkcs5iNicH","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-24T11:17:47Z","updated_at":"2023-07-24T11:17:47Z","author_association":"CONTRIBUTOR","body":"上面这个错误，贴下另外一端的日志？10.156.8.30这个","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647716103/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647805266","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1647805266","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1647805266,"node_id":"IC_kwDOBhmkcs5iN4NS","user":{"login":"372046933","id":1251167,"node_id":"MDQ6VXNlcjEyNTExNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1251167?v=4","gravatar_id":"","url":"https://api.github.com/users/372046933","html_url":"https://github.com/372046933","followers_url":"https://api.github.com/users/372046933/followers","following_url":"https://api.github.com/users/372046933/following{/other_user}","gists_url":"https://api.github.com/users/372046933/gists{/gist_id}","starred_url":"https://api.github.com/users/372046933/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/372046933/subscriptions","organizations_url":"https://api.github.com/users/372046933/orgs","repos_url":"https://api.github.com/users/372046933/repos","events_url":"https://api.github.com/users/372046933/events{/privacy}","received_events_url":"https://api.github.com/users/372046933/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-24T12:18:36Z","updated_at":"2023-07-24T12:18:36Z","author_association":"CONTRIBUTOR","body":"客户端发现`Controller->Failed`为true\r\n```c++\r\nLOG(WARNING) << method_name_ << \" RPC failed, \" << cntl.ErrorText()\r\n```\r\n\r\n```c++\r\n2023-07-24 15:26:52.658294: W xxx/yyy.cc:394] StreamSend RPC failed, [E112]Not connected to 10.156.9.20:16619 yet, server_id=47 [R1][E112]Not connected to 10.156.9.20:16619 yet, server_id=47 [R2][E112]Not connected to 10.156.9.20:16619 yet, server_id=47 [R3][E112]Not connected to 10.156.9.20:16619 yet, server_id=47 [R4][E112]Not connected to 10.156.9.20:16619 yet, server_id=47 [R5][E112]Not connected to 10.156.9.20:16619 yet, server_id=47 [R6][E112]Not connected to 10.156.9.20:16619 yet, server_id=47 [R7][E112]Not connected to 10.156.9.20:16619 yet, server_id=47 [R8][E112]Not connected to 10.156.9.20:16619 yet, server_id=47 [R9][E112]Not connected to 10.156.9.20:16619 yet, server_id=47 [R10][E112]Not connected to 10.156.9.20:16619 yet\r\n\r\n...\r\n\r\nW0724 15:26:52.656967  1267 external/brpc/src/brpc/controller.cpp:675] `CanRetryBackoffInPthread()' returns false, skip retry backoff in pthread.\r\nW0724 15:26:52.657038  1267 external/brpc/src/brpc/controller.cpp:675] `CanRetryBackoffInPthread()' returns false, skip retry backoff in pthread.\r\nW0724 15:26:52.657049  1267 external/brpc/src/brpc/controller.cpp:675] `CanRetryBackoffInPthread()' returns false, skip retry backoff in pthread.\r\n\r\n...\r\n\r\n\r\n```","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1647805266/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648110556","html_url":"https://github.com/apache/brpc/pull/1433#issuecomment-1648110556","issue_url":"https://api.github.com/repos/apache/brpc/issues/1433","id":1648110556,"node_id":"IC_kwDOBhmkcs5iPCvc","user":{"login":"yockie","id":2568971,"node_id":"MDQ6VXNlcjI1Njg5NzE=","avatar_url":"https://avatars.githubusercontent.com/u/2568971?v=4","gravatar_id":"","url":"https://api.github.com/users/yockie","html_url":"https://github.com/yockie","followers_url":"https://api.github.com/users/yockie/followers","following_url":"https://api.github.com/users/yockie/following{/other_user}","gists_url":"https://api.github.com/users/yockie/gists{/gist_id}","starred_url":"https://api.github.com/users/yockie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yockie/subscriptions","organizations_url":"https://api.github.com/users/yockie/orgs","repos_url":"https://api.github.com/users/yockie/repos","events_url":"https://api.github.com/users/yockie/events{/privacy}","received_events_url":"https://api.github.com/users/yockie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-24T15:14:18Z","updated_at":"2023-07-24T15:14:18Z","author_association":"CONTRIBUTOR","body":"@guodongxiaren 大佬 这个pr好像没合入？后续是啥进展啊","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648110556/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648842429","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1648842429","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1648842429,"node_id":"IC_kwDOBhmkcs5iR1a9","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T01:46:38Z","updated_at":"2023-07-25T01:46:38Z","author_association":"CONTRIBUTOR","body":"看日志里面，是用到了rpc的stream么？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648842429/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648845483","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1648845483","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1648845483,"node_id":"IC_kwDOBhmkcs5iR2Kr","user":{"login":"372046933","id":1251167,"node_id":"MDQ6VXNlcjEyNTExNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1251167?v=4","gravatar_id":"","url":"https://api.github.com/users/372046933","html_url":"https://github.com/372046933","followers_url":"https://api.github.com/users/372046933/followers","following_url":"https://api.github.com/users/372046933/following{/other_user}","gists_url":"https://api.github.com/users/372046933/gists{/gist_id}","starred_url":"https://api.github.com/users/372046933/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/372046933/subscriptions","organizations_url":"https://api.github.com/users/372046933/orgs","repos_url":"https://api.github.com/users/372046933/repos","events_url":"https://api.github.com/users/372046933/events{/privacy}","received_events_url":"https://api.github.com/users/372046933/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T01:51:26Z","updated_at":"2023-07-25T01:51:26Z","author_association":"CONTRIBUTOR","body":"没有Stream，只是RPC名字包含Stream\r\n```c++\r\nLOG(WARNING) << method_name_ << \" RPC failed, \" ...\r\n```","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648845483/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648858531","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1648858531","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1648858531,"node_id":"IC_kwDOBhmkcs5iR5Wj","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T02:03:54Z","updated_at":"2023-07-25T02:03:54Z","author_association":"CONTRIBUTOR","body":"两边的日志打包发一下看看？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648858531/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648878368","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1648878368","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1648878368,"node_id":"IC_kwDOBhmkcs5iR-Mg","user":{"login":"372046933","id":1251167,"node_id":"MDQ6VXNlcjEyNTExNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1251167?v=4","gravatar_id":"","url":"https://api.github.com/users/372046933","html_url":"https://github.com/372046933","followers_url":"https://api.github.com/users/372046933/followers","following_url":"https://api.github.com/users/372046933/following{/other_user}","gists_url":"https://api.github.com/users/372046933/gists{/gist_id}","starred_url":"https://api.github.com/users/372046933/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/372046933/subscriptions","organizations_url":"https://api.github.com/users/372046933/orgs","repos_url":"https://api.github.com/users/372046933/repos","events_url":"https://api.github.com/users/372046933/events{/privacy}","received_events_url":"https://api.github.com/users/372046933/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T02:15:39Z","updated_at":"2023-07-25T02:15:39Z","author_association":"CONTRIBUTOR","body":"日志不多的。其中有些日志是我在BRPC里面加的\r\n```patch\r\ndiff --git a/src/brpc/rdma/rdma_endpoint.cpp b/src/brpc/rdma/rdma_endpoint.cpp\r\nindex d3a91560..e7e60ff4 100644\r\n--- a/src/brpc/rdma/rdma_endpoint.cpp\r\n+++ b/src/brpc/rdma/rdma_endpoint.cpp\r\n@@ -251,7 +251,9 @@ void RdmaConnect::StartConnect(const Socket* socket,\r\n     }\r\n }\r\n \r\n-void RdmaConnect::StopConnect(Socket* socket) { }\r\n+void RdmaConnect::StopConnect(Socket* socket) {\r\n+    LOG(INFO) << \"RdmaConnect StopConnect called\";\r\n+}\r\n \r\n void RdmaConnect::Run() {\r\n     _done(errno, _data);\r\n@@ -274,6 +276,7 @@ static void TryReadOnTcpDuringRdmaEst(Socket* s) {\r\n                 break;\r\n             }\r\n         } else if (nr == 0) {\r\n+            LOG(INFO) << \"Got socket EOF, \" << *s;\r\n             s->SetEOF();\r\n             return;\r\n         } else {\r\n@@ -330,7 +333,7 @@ void RdmaEndpoint::OnNewDataFromTcp(Socket* m) {\r\n     }\r\n }\r\n \r\n-bool HelloNegotiationValid(HelloMessage& msg) {\r\n+bool HelloNegotiationValid(const HelloMessage& msg) {\r\n     if (msg.hello_ver == g_rdma_hello_version &&\r\n         msg.impl_ver == g_rdma_impl_version &&\r\n         msg.block_size >= MIN_BLOCK_SIZE &&\r\n@@ -360,6 +363,7 @@ int RdmaEndpoint::ReadFromFd(void* data, size_t len) {\r\n                     }\r\n                 }\r\n             } else {\r\n+                PLOG(WARNING) << \"Failed to read\";\r\n                 return -1;\r\n             }\r\n         } else if (nr == 0) {  // Got EOF\r\n@@ -1030,7 +1034,7 @@ int RdmaEndpoint::PostRecv(uint32_t num, bool zerocopy) {\r\n         if (_rq_received == _rq_size) {\r\n             _rq_received = 0;\r\n         }\r\n-    };\r\n+    }\r\n     return 0;\r\n }\r\n \r\n@@ -1168,11 +1172,6 @@ int RdmaEndpoint::BringUpQp(uint16_t lid, ibv_gid gid, uint32_t qp_num) {\r\n         return -1;\r\n     }\r\n \r\n-    if (PostRecv(_rq_size, true) < 0) {\r\n-        PLOG(WARNING) << \"Fail to post recv wr\";\r\n-        return -1;\r\n-    }\r\n-\r\n     attr.qp_state = IBV_QPS_RTR;\r\n     attr.path_mtu = IBV_MTU_1024;  // TODO: support more mtu in future\r\n     attr.ah_attr.grh.dgid = gid;\r\n@@ -1202,6 +1201,11 @@ int RdmaEndpoint::BringUpQp(uint16_t lid, ibv_gid gid, uint32_t qp_num) {\r\n         return -1;\r\n     }\r\n \r\n+    if (PostRecv(_rq_size, true) < 0) {\r\n+        PLOG(WARNING) << \"Fail to post recv wr\";\r\n+        return -1;\r\n+    }\r\n+\r\n     attr.qp_state = IBV_QPS_RTS;\r\n     attr.timeout = TIMEOUT;\r\n     attr.retry_cnt = RETRY_CNT;\r\n@@ -1293,7 +1297,8 @@ void RdmaEndpoint::DeallocateResources() {\r\n static const int MAX_CQ_EVENTS = 128;\r\n \r\n int RdmaEndpoint::GetAndAckEvents() {\r\n-    int events = 0; void* context = NULL;\r\n+    int events = 0;\r\n+    void* context = NULL;\r\n     while (1) {\r\n         if (IbvGetCqEvent(_resource->comp_channel, &_resource->cq, &context) < 0) {\r\n             if (errno != EAGAIN) {\r\n@@ -1354,11 +1359,13 @@ void RdmaEndpoint::PollCq(Socket* m) {\r\n                 // that the event arrives after the poll but before the notify,\r\n                 // we should re-poll the CQ once after the notify to check if\r\n                 // there is an available CQE.\r\n-                if (ibv_req_notify_cq(ep->_resource->cq, 1) < 0) {\r\n+                if (ibv_req_notify_cq(ep->_resource->cq, /*solicited_only=*/1) <\r\n+                    0) {\r\n                     const int saved_errno = errno;\r\n-                    PLOG(WARNING) << \"Fail to arm CQ comp channel: \" << s->description();\r\n+                    PLOG(WARNING)\r\n+                        << \"Fail to arm CQ comp channel: \" << s->description();\r\n                     s->SetFailed(saved_errno, \"Fail to arm cq channel from %s: %s\",\r\n-                            s->description().c_str(), berror(saved_errno));\r\n+                                s->description().c_str(), berror(saved_errno));\r\n                     return;\r\n                 }\r\n                 notified = true;\r\n@@ -1387,7 +1394,8 @@ void RdmaEndpoint::PollCq(Socket* m) {\r\n                 PLOG(WARNING) << \"Fail to handle RDMA completion, error status(\"\r\n                               << wc[i].status << \"): \" << s->description();\r\n                 s->SetFailed(ERDMA, \"RDMA completion error(%d) from %s: %s\",\r\n-                             wc[i].status, s->description().c_str(), berror(ERDMA));\r\n+                             wc[i].status, s->description().c_str(),\r\n+                             berror(ERDMA));\r\n                 continue;\r\n             }\r\n \r\ndiff --git a/src/brpc/socket.cpp b/src/brpc/socket.cpp\r\nindex c49ca083..4ebba8d2 100644\r\n--- a/src/brpc/socket.cpp\r\n+++ b/src/brpc/socket.cpp\r\n@@ -803,6 +803,7 @@ int Socket::WaitAndReset(int32_t expected_nref) {\r\n \r\n #if BRPC_WITH_RDMA\r\n     if (_rdma_ep) {\r\n+        LOG(WARNING) << \"Reset RdmaEndpoint, \" << description();\r\n         _rdma_ep->Reset();\r\n         _rdma_state = RDMA_UNKNOWN;\r\n     }\r\n\r\n```\r\n\r\nserver\r\n```\r\nBRPC 日志：\r\nW0724 21:29:37.355377   978 external/brpc/src/brpc/input_messenger.cpp:247] Close Socket{id=8589934594 fd=297 addr=10.156.8.29:29765:37376} (0x560a5f5cc480): absolutely wrong message\r\n\r\n应用层日志：\r\nW0724 21:29:37.355577   838 ./xxx/yyy/zzz.h:119] Method:[FuncFoo] Fail to get response from shard#0 [E22]Close Socket{id=8589934594 fd=297 addr=10.156.8.29:29765:37376} (0x0x560a5f5cc480): absolutely wrong message\r\n\r\nBRPC 日志\r\nI0724 21:29:37.458484  1004 external/brpc/src/brpc/socket.cpp:2465] Checking Socket{id=8589934594 addr=10.156.8.29:29765} (0x560a5f5cc480)\r\nI0724 21:29:37.458786  1016 external/brpc/src/brpc/socket.cpp:2525] Revived Socket{id=8589934594 addr=10.156.8.29:29765} (0x560a5f5cc480) (Connectable)\r\nI0724 21:29:42.355888   985 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:418] Start handshake on 10.156.0.21:54384\r\nI0724 21:29:42.362131   995 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:543] Handshake ends (use rdma) on Socket{id=8589934594 fd=297 addr=10.156.8.29:29765:54384} (0x0x560a5f5cc480)\r\n\r\n```\r\n\r\nclient\r\n```\r\nI0724 21:29:37.446674  1045 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:279] Got socket EOF, Socket{id=25769805360 fd=300 addr=10.156.0.21:37376:29765} (0x557bf1110480)\r\nI0724 21:29:37.449893  1090 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:560] Start handshake on Socket{id=8589943858 fd=1413 addr=10.156.0.21:54366:29765} (0x0x557ef5f2c000)\r\nW0724 21:29:37.449923  1090 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:568] Fail to read Hello Message from client:Socket{id=8589943858 fd=1413 addr=10.156.0.21:54366:29765} (0x0x557ef5f2c000) 10.156.0.21:54366: Got EOF\r\nI0724 21:29:42.347077  1047 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:560] Start handshake on Socket{id=17179869414 fd=1358 addr=10.156.0.21:54384:29765} (0x0x557bf0b22900)\r\nI0724 21:29:42.353112  1097 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:696] Handshake ends (use rdma) on Socket{id=17179869414 fd=1358 addr=10.156.0.21:54384:29765} (0x0x557bf0b22900)\r\n```","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648878368/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648895312","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1648895312","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1648895312,"node_id":"IC_kwDOBhmkcs5iSCVQ","user":{"login":"372046933","id":1251167,"node_id":"MDQ6VXNlcjEyNTExNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1251167?v=4","gravatar_id":"","url":"https://api.github.com/users/372046933","html_url":"https://github.com/372046933","followers_url":"https://api.github.com/users/372046933/followers","following_url":"https://api.github.com/users/372046933/following{/other_user}","gists_url":"https://api.github.com/users/372046933/gists{/gist_id}","starred_url":"https://api.github.com/users/372046933/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/372046933/subscriptions","organizations_url":"https://api.github.com/users/372046933/orgs","repos_url":"https://api.github.com/users/372046933/repos","events_url":"https://api.github.com/users/372046933/events{/privacy}","received_events_url":"https://api.github.com/users/372046933/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T02:26:07Z","updated_at":"2023-07-25T02:26:07Z","author_association":"CONTRIBUTOR","body":"RDMA handshake只需要一次就可以建立QP了吧？ 看日志在Close Socket后，又发生了一次信息交换。\r\n感觉像是触发了什么BUG。。。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648895312/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648908231","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1648908231","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1648908231,"node_id":"IC_kwDOBhmkcs5iSFfH","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T02:33:43Z","updated_at":"2023-07-25T02:33:43Z","author_association":"CONTRIBUTOR","body":"Close Socket之后要自动重连吧。client没有自动重连的日志吗","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648908231/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648934385","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1648934385","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1648934385,"node_id":"IC_kwDOBhmkcs5iSL3x","user":{"login":"372046933","id":1251167,"node_id":"MDQ6VXNlcjEyNTExNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1251167?v=4","gravatar_id":"","url":"https://api.github.com/users/372046933","html_url":"https://github.com/372046933","followers_url":"https://api.github.com/users/372046933/followers","following_url":"https://api.github.com/users/372046933/following{/other_user}","gists_url":"https://api.github.com/users/372046933/gists{/gist_id}","starred_url":"https://api.github.com/users/372046933/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/372046933/subscriptions","organizations_url":"https://api.github.com/users/372046933/orgs","repos_url":"https://api.github.com/users/372046933/repos","events_url":"https://api.github.com/users/372046933/events{/privacy}","received_events_url":"https://api.github.com/users/372046933/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T02:48:34Z","updated_at":"2023-07-25T02:48:34Z","author_association":"CONTRIBUTOR","body":"这些就是重连日志吧，不过为啥会突然Close Socket呢？这是预期内的行为吗？\r\n```\r\nI0724 21:29:37.458484  1004 external/brpc/src/brpc/socket.cpp:2465] Checking Socket{id=8589934594 addr=10.156.8.29:29765} (0x560a5f5cc480)\r\nI0724 21:29:37.458786  1016 external/brpc/src/brpc/socket.cpp:2525] Revived Socket{id=8589934594 addr=10.156.8.29:29765} (0x560a5f5cc480) (Connectable)\r\nI0724 21:29:42.355888   985 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:418] Start handshake on 10.156.0.21:54384\r\nI0724 21:29:42.362131   995 external/brpc/src/brpc/rdma/rdma_endpoint.cpp:543] Handshake ends (use rdma) on Socket{id=8589934594 fd=297 addr=10.156.8.29:29765:54384} (0x0x560a5f5cc480)\r\n```","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648934385/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648982312","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1648982312","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1648982312,"node_id":"IC_kwDOBhmkcs5iSXko","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T03:16:28Z","updated_at":"2023-07-25T03:16:28Z","author_association":"CONTRIBUTOR","body":"Close Socket的原因是检查到rpc消息格式错误。\r\nClose Socket后触发client做健康检查（Checking Socket），tcp建连成功则认为健康检查通过（Revived Socket）。但是这个健康检查连接会直接close掉。但是server还是会准备rdma握手逻辑（start handshake）因为server不知道这是一个健康检查连接。但是因为client自己close了这个连接，所以server的握手失败（Got EOF）。后面的这个状态是没问题的。\r\n\r\n根本的问题还是在rpc消息格式错误这里。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648982312/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648993790","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1648993790","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1648993790,"node_id":"IC_kwDOBhmkcs5iSaX-","user":{"login":"372046933","id":1251167,"node_id":"MDQ6VXNlcjEyNTExNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1251167?v=4","gravatar_id":"","url":"https://api.github.com/users/372046933","html_url":"https://github.com/372046933","followers_url":"https://api.github.com/users/372046933/followers","following_url":"https://api.github.com/users/372046933/following{/other_user}","gists_url":"https://api.github.com/users/372046933/gists{/gist_id}","starred_url":"https://api.github.com/users/372046933/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/372046933/subscriptions","organizations_url":"https://api.github.com/users/372046933/orgs","repos_url":"https://api.github.com/users/372046933/repos","events_url":"https://api.github.com/users/372046933/events{/privacy}","received_events_url":"https://api.github.com/users/372046933/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T03:23:05Z","updated_at":"2023-07-25T03:23:05Z","author_association":"CONTRIBUTOR","body":"哪里加日志方便排查问题呢？消息格式错误一般是啥原因导致的","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1648993790/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1649054218","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1649054218","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1649054218,"node_id":"IC_kwDOBhmkcs5iSpIK","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T03:57:00Z","updated_at":"2023-07-25T03:58:39Z","author_association":"CONTRIBUTOR","body":"可以按照下方的改动试下把发送方向和接收方向看到的message的内容打印下看看。\r\n不过这个日志量级应该会很大。多rotate一下，看看能不能捕捉到出错。\r\n\r\n\r\n```diff\r\n--- a/src/brpc/rdma/rdma_endpoint.cpp\r\n+++ b/src/brpc/rdma/rdma_endpoint.cpp\r\n@@ -896,6 +896,7 @@ ssize_t RdmaEndpoint::CutFromIOBufList(butil::IOBuf** from, size_t ndata) {\r\n             return -1;\r\n         }\r\n\r\n+        LOG_IF(INFO, FLAGS_rdma_trace_verbose) << _sbuf[_sq_current];\r\n         ++_sq_current;\r\n         if (_sq_current == _sq_size - RESERVED_WR_NUM) {\r\n             _sq_current = 0;\r\n@@ -950,6 +951,7 @@ ssize_t RdmaEndpoint::HandleCompletion(ibv_wc& wc) {\r\n     case IBV_WC_RECV: {  // recv completion\r\n         // Please note that only the first wc.byte_len bytes is valid\r\n         if (wc.byte_len > 0) {\r\n+            LOG_IF(INFO, FLAGS_rdma_trace_verbose) << _rbuf[_rq_received];\r\n             if (wc.byte_len < (uint32_t)FLAGS_rdma_zerocopy_min_size) {\r\n                 zerocopy = false;\r\n             }\r\n```","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1649054218/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1649084175","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1649084175","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1649084175,"node_id":"IC_kwDOBhmkcs5iSwcP","user":{"login":"372046933","id":1251167,"node_id":"MDQ6VXNlcjEyNTExNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1251167?v=4","gravatar_id":"","url":"https://api.github.com/users/372046933","html_url":"https://github.com/372046933","followers_url":"https://api.github.com/users/372046933/followers","following_url":"https://api.github.com/users/372046933/following{/other_user}","gists_url":"https://api.github.com/users/372046933/gists{/gist_id}","starred_url":"https://api.github.com/users/372046933/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/372046933/subscriptions","organizations_url":"https://api.github.com/users/372046933/orgs","repos_url":"https://api.github.com/users/372046933/repos","events_url":"https://api.github.com/users/372046933/events{/privacy}","received_events_url":"https://api.github.com/users/372046933/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T04:14:14Z","updated_at":"2023-07-25T04:14:14Z","author_association":"CONTRIBUTOR","body":"好的，这个日志量可能没法落盘，实在是太大了（日志量是几个GB/s)。有没有从代码层面分析的可能呢？\r\n\r\n另外请教下，当`wc.byte_len < (uint32_t)FLAGS_rdma_zerocopy_min_size`时，`zerocopy`为False。此时`_rbuf_data[_rq_received]`指向的内存是分配过的吗？\r\nhttps://github.com/apache/brpc/blob/92ad8828d49aeee97d88a7492727f2342e292d32/src/brpc/rdma/rdma_endpoint.cpp#L946","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1649084175/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1649157558","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1649157558","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1649157558,"node_id":"IC_kwDOBhmkcs5iTCW2","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T05:42:16Z","updated_at":"2023-07-25T05:42:16Z","author_association":"CONTRIBUTOR","body":"分配过的。\r\n\r\n日志尝试收集一下吧。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1649157558/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1649166083","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1649166083","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1649166083,"node_id":"IC_kwDOBhmkcs5iTEcD","user":{"login":"372046933","id":1251167,"node_id":"MDQ6VXNlcjEyNTExNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1251167?v=4","gravatar_id":"","url":"https://api.github.com/users/372046933","html_url":"https://github.com/372046933","followers_url":"https://api.github.com/users/372046933/followers","following_url":"https://api.github.com/users/372046933/following{/other_user}","gists_url":"https://api.github.com/users/372046933/gists{/gist_id}","starred_url":"https://api.github.com/users/372046933/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/372046933/subscriptions","organizations_url":"https://api.github.com/users/372046933/orgs","repos_url":"https://api.github.com/users/372046933/repos","events_url":"https://api.github.com/users/372046933/events{/privacy}","received_events_url":"https://api.github.com/users/372046933/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T05:53:27Z","updated_at":"2023-07-25T05:53:27Z","author_association":"CONTRIBUTOR","body":"是在哪里分配的可以贴一下吗？\r\n日志没法log这么大，做不了。就算全落下来，一次RPC需要几秒到十几秒，没法复现问题。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1649166083/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1649175829","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1649175829","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1649175829,"node_id":"IC_kwDOBhmkcs5iTG0V","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T06:05:02Z","updated_at":"2023-07-25T06:05:02Z","author_association":"CONTRIBUTOR","body":"PostRecv里面分配的。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1649175829/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1649197740","html_url":"https://github.com/apache/brpc/issues/2318#issuecomment-1649197740","issue_url":"https://api.github.com/repos/apache/brpc/issues/2318","id":1649197740,"node_id":"IC_kwDOBhmkcs5iTMKs","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T06:25:19Z","updated_at":"2023-07-25T06:25:19Z","author_association":"CONTRIBUTOR","body":"应该就是编译器的volatile thread local access这个优化在aarch64下有问题，需要关闭了才能正常执行。","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1649197740/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1649211897","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1649211897","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1649211897,"node_id":"IC_kwDOBhmkcs5iTPn5","user":{"login":"372046933","id":1251167,"node_id":"MDQ6VXNlcjEyNTExNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1251167?v=4","gravatar_id":"","url":"https://api.github.com/users/372046933","html_url":"https://github.com/372046933","followers_url":"https://api.github.com/users/372046933/followers","following_url":"https://api.github.com/users/372046933/following{/other_user}","gists_url":"https://api.github.com/users/372046933/gists{/gist_id}","starred_url":"https://api.github.com/users/372046933/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/372046933/subscriptions","organizations_url":"https://api.github.com/users/372046933/orgs","repos_url":"https://api.github.com/users/372046933/repos","events_url":"https://api.github.com/users/372046933/events{/privacy}","received_events_url":"https://api.github.com/users/372046933/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-25T06:40:48Z","updated_at":"2023-07-25T06:40:48Z","author_association":"CONTRIBUTOR","body":"说的是这里吧，zerocopy为False时，`DoPostRecv`接收的地址传给`ibv_sge.addr`，此时的`_rbuf_data[_rq_received]`在哪里分配并注册MR的呢？\r\nhttps://github.com/apache/brpc/blob/e6881ee35cca2fb56e6761675f7de1461e275dc1/src/brpc/rdma/rdma_endpoint.cpp#L1008-L1024","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1649211897/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1650846721","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1650846721","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1650846721,"node_id":"IC_kwDOBhmkcs5iZewB","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-26T01:44:42Z","updated_at":"2023-07-26T01:44:50Z","author_association":"CONTRIBUTOR","body":"这些用的是内存池里的内存。一开始就注册了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1650846721/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1650877344","html_url":"https://github.com/apache/brpc/pull/2319#issuecomment-1650877344","issue_url":"https://api.github.com/repos/apache/brpc/issues/2319","id":1650877344,"node_id":"IC_kwDOBhmkcs5iZmOg","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-26T02:27:13Z","updated_at":"2023-07-26T02:27:13Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1650877344/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1650880328","html_url":"https://github.com/apache/brpc/pull/2325#issuecomment-1650880328","issue_url":"https://api.github.com/repos/apache/brpc/issues/2325","id":1650880328,"node_id":"IC_kwDOBhmkcs5iZm9I","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-26T02:31:24Z","updated_at":"2023-07-26T02:31:24Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1650880328/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1650890652","html_url":"https://github.com/apache/brpc/pull/2329#issuecomment-1650890652","issue_url":"https://api.github.com/repos/apache/brpc/issues/2329","id":1650890652,"node_id":"IC_kwDOBhmkcs5iZpec","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-26T02:45:42Z","updated_at":"2023-07-26T02:45:42Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1650890652/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1650891350","html_url":"https://github.com/apache/brpc/pull/2328#issuecomment-1650891350","issue_url":"https://api.github.com/repos/apache/brpc/issues/2328","id":1650891350,"node_id":"IC_kwDOBhmkcs5iZppW","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-26T02:46:38Z","updated_at":"2023-07-26T02:46:38Z","author_association":"CONTRIBUTOR","body":"另外，补充一下单测吧","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1650891350/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1650999253","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1650999253","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1650999253,"node_id":"IC_kwDOBhmkcs5iaD_V","user":{"login":"372046933","id":1251167,"node_id":"MDQ6VXNlcjEyNTExNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1251167?v=4","gravatar_id":"","url":"https://api.github.com/users/372046933","html_url":"https://github.com/372046933","followers_url":"https://api.github.com/users/372046933/followers","following_url":"https://api.github.com/users/372046933/following{/other_user}","gists_url":"https://api.github.com/users/372046933/gists{/gist_id}","starred_url":"https://api.github.com/users/372046933/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/372046933/subscriptions","organizations_url":"https://api.github.com/users/372046933/orgs","repos_url":"https://api.github.com/users/372046933/repos","events_url":"https://api.github.com/users/372046933/events{/privacy}","received_events_url":"https://api.github.com/users/372046933/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-26T05:22:50Z","updated_at":"2023-07-26T05:22:50Z","author_association":"CONTRIBUTOR","body":"这个报错也有点奇怪，`ProtocolType`应该是BAIDU_STD才对\r\n\r\nhttps://github.com/apache/brpc/blob/3bc4366b314b55427a2bcd4819d841e0bd8b6fb4/src/brpc/input_messenger.cpp#L115-L122\r\n```\r\nE0726 12:28:46.931434   969 external/brpc/src/brpc/input_messenger.cpp:122] Fail to parse response from 10.156.15.27:17657 by baidu_std at client-side\r\nW0726 12:28:46.931502   969 external/brpc/src/brpc/input_messenger.cpp:247] Close Socket{id=8589934594 fd=1409 addr=10.156.15.27:17657:38500} (0x5628b07bc480): absolutely wrong message\r\n```","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1650999253/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651042014","html_url":"https://github.com/apache/brpc/pull/2329#issuecomment-1651042014","issue_url":"https://api.github.com/repos/apache/brpc/issues/2329","id":1651042014,"node_id":"IC_kwDOBhmkcs5iaObe","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-26T06:14:10Z","updated_at":"2023-07-26T06:14:10Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651042014/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651182216","html_url":"https://github.com/apache/brpc/issues/2164#issuecomment-1651182216","issue_url":"https://api.github.com/repos/apache/brpc/issues/2164","id":1651182216,"node_id":"IC_kwDOBhmkcs5iawqI","user":{"login":"lhsoft","id":8412085,"node_id":"MDQ6VXNlcjg0MTIwODU=","avatar_url":"https://avatars.githubusercontent.com/u/8412085?v=4","gravatar_id":"","url":"https://api.github.com/users/lhsoft","html_url":"https://github.com/lhsoft","followers_url":"https://api.github.com/users/lhsoft/followers","following_url":"https://api.github.com/users/lhsoft/following{/other_user}","gists_url":"https://api.github.com/users/lhsoft/gists{/gist_id}","starred_url":"https://api.github.com/users/lhsoft/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lhsoft/subscriptions","organizations_url":"https://api.github.com/users/lhsoft/orgs","repos_url":"https://api.github.com/users/lhsoft/repos","events_url":"https://api.github.com/users/lhsoft/events{/privacy}","received_events_url":"https://api.github.com/users/lhsoft/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-26T08:02:22Z","updated_at":"2023-07-26T08:02:22Z","author_association":"CONTRIBUTOR","body":"你们是怎么禁止的呢，这个object是private的，我在外部拿不到，只能改brpc代码，要是有不改代码ignore的方式就完美了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651182216/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651211830","html_url":"https://github.com/apache/brpc/issues/2164#issuecomment-1651211830","issue_url":"https://api.github.com/repos/apache/brpc/issues/2164","id":1651211830,"node_id":"IC_kwDOBhmkcs5ia342","user":{"login":"ehds","id":17853449,"node_id":"MDQ6VXNlcjE3ODUzNDQ5","avatar_url":"https://avatars.githubusercontent.com/u/17853449?v=4","gravatar_id":"","url":"https://api.github.com/users/ehds","html_url":"https://github.com/ehds","followers_url":"https://api.github.com/users/ehds/followers","following_url":"https://api.github.com/users/ehds/following{/other_user}","gists_url":"https://api.github.com/users/ehds/gists{/gist_id}","starred_url":"https://api.github.com/users/ehds/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehds/subscriptions","organizations_url":"https://api.github.com/users/ehds/orgs","repos_url":"https://api.github.com/users/ehds/repos","events_url":"https://api.github.com/users/ehds/events{/privacy}","received_events_url":"https://api.github.com/users/ehds/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-26T08:22:31Z","updated_at":"2023-07-26T08:23:16Z","author_association":"CONTRIBUTOR","body":"> \r\n加上这个 LSAN_OPTIONS 启动参数，指定忽略检测 leak 的规则文件：\r\n```\r\nLSAN_OPTIONS=suppressions=ignore.txt\r\n```\r\n\r\n`ignore.txt` 指定忽略 `Server::StartInternal` 这个函数的检测\r\n\r\ncat ignore.txt : \r\n```\r\nleak:Server::StartInternal\r\n```\r\n\r\n更详细的用法参考：https://github.com/google/sanitizers/wiki/AddressSanitizerLeakSanitizer#flags","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651211830/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651246342","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1651246342","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1651246342,"node_id":"IC_kwDOBhmkcs5ibAUG","user":{"login":"372046933","id":1251167,"node_id":"MDQ6VXNlcjEyNTExNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1251167?v=4","gravatar_id":"","url":"https://api.github.com/users/372046933","html_url":"https://github.com/372046933","followers_url":"https://api.github.com/users/372046933/followers","following_url":"https://api.github.com/users/372046933/following{/other_user}","gists_url":"https://api.github.com/users/372046933/gists{/gist_id}","starred_url":"https://api.github.com/users/372046933/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/372046933/subscriptions","organizations_url":"https://api.github.com/users/372046933/orgs","repos_url":"https://api.github.com/users/372046933/repos","events_url":"https://api.github.com/users/372046933/events{/privacy}","received_events_url":"https://api.github.com/users/372046933/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-26T08:43:58Z","updated_at":"2023-07-26T08:43:58Z","author_association":"CONTRIBUTOR","body":"```\r\nI0726 16:25:12.445185  1011 external/brpc/src/brpc/input_messenger.cpp:116] cur_index=1 preferred=1 result.error()=1 result.error_str()=try other protocols\r\nI0726 16:25:12.445248  1011 external/brpc/src/brpc/input_messenger.cpp:116] cur_index=2 preferred=1 result.error()=1 result.error_str()=try other protocols\r\nE0726 16:25:12.445270  1011 external/brpc/src/brpc/input_messenger.cpp:126] Fail to parse response from 10.156.15.16:20493 by baidu_std at client-side\r\nW0726 16:25:12.445318  1011 external/brpc/src/brpc/input_messenger.cpp:251] Close Socket{id=8589934619 fd=1341 addr=10.156.15.16:20493:64774} (0x556c6752fcc0): absolutely wrong message\r\n```\r\n\r\n```patch\r\ndiff --git a/src/brpc/input_messenger.cpp b/src/brpc/input_messenger.cpp\r\nindex 43167d5b..787fc993 100644\r\n--- a/src/brpc/input_messenger.cpp\r\n+++ b/src/brpc/input_messenger.cpp\r\n@@ -113,7 +113,11 @@ ParseResult InputMessenger::CutInputMessage(\r\n             }\r\n \r\n             if (m->CreatedByConnect()) {\r\n-                if((ProtocolType)cur_index == PROTOCOL_BAIDU_STD) {\r\n+                LOG(INFO) << \"cur_index=\" << cur_index\r\n+                          << \" preferred=\" << preferred\r\n+                          << \" result.error()=\" << result.error()\r\n+                          << \" result.error_str()=\" << result.error_str();\r\n+                if ((ProtocolType)cur_index == PROTOCOL_BAIDU_STD) {\r\n                     // baidu_std may fall to streaming_rpc.\r\n                     cur_index = (int)PROTOCOL_STREAMING_RPC;\r\n                     continue;\r\n@@ -332,7 +336,7 @@ void InputMessenger::OnNewMessages(Socket* m) {\r\n     // - If the socket has only one message, the message will be parsed and\r\n     //   processed in this bthread. nova-pbrpc and http works in this way.\r\n     // - If the socket has several messages, all messages will be parsed (\r\n-    //   meaning cutting from butil::IOBuf. serializing from protobuf is part of\r\n+    //   meaning cutting from butil::IOBuf. Deserializing from protobuf is part of\r\n     //   \"process\") in this bthread. All messages except the last one will be\r\n     //   processed in separate bthreads. To minimize the overhead, scheduling\r\n     //   is batched(notice the BTHREAD_NOSIGNAL and bthread_flush).\r\n```","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651246342/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651276706","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1651276706","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1651276706,"node_id":"IC_kwDOBhmkcs5ibHui","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-26T08:59:41Z","updated_at":"2023-07-26T08:59:41Z","author_association":"CONTRIBUTOR","body":"这些都是数据错误的结果，不是原因。至少先尝试出错的时候FATAL core出来吧","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651276706/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651348298","html_url":"https://github.com/apache/brpc/pull/2328#issuecomment-1651348298","issue_url":"https://api.github.com/repos/apache/brpc/issues/2328","id":1651348298,"node_id":"IC_kwDOBhmkcs5ibZNK","user":{"login":"yockie","id":2568971,"node_id":"MDQ6VXNlcjI1Njg5NzE=","avatar_url":"https://avatars.githubusercontent.com/u/2568971?v=4","gravatar_id":"","url":"https://api.github.com/users/yockie","html_url":"https://github.com/yockie","followers_url":"https://api.github.com/users/yockie/followers","following_url":"https://api.github.com/users/yockie/following{/other_user}","gists_url":"https://api.github.com/users/yockie/gists{/gist_id}","starred_url":"https://api.github.com/users/yockie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yockie/subscriptions","organizations_url":"https://api.github.com/users/yockie/orgs","repos_url":"https://api.github.com/users/yockie/repos","events_url":"https://api.github.com/users/yockie/events{/privacy}","received_events_url":"https://api.github.com/users/yockie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-26T09:26:54Z","updated_at":"2023-07-26T09:26:54Z","author_association":"CONTRIBUTOR","body":"> 另外，补充一下单测吧\r\n\r\ndone","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651348298/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651385937","html_url":"https://github.com/apache/brpc/issues/1081#issuecomment-1651385937","issue_url":"https://api.github.com/repos/apache/brpc/issues/1081","id":1651385937,"node_id":"IC_kwDOBhmkcs5ibiZR","user":{"login":"sunhs","id":1916614,"node_id":"MDQ6VXNlcjE5MTY2MTQ=","avatar_url":"https://avatars.githubusercontent.com/u/1916614?v=4","gravatar_id":"","url":"https://api.github.com/users/sunhs","html_url":"https://github.com/sunhs","followers_url":"https://api.github.com/users/sunhs/followers","following_url":"https://api.github.com/users/sunhs/following{/other_user}","gists_url":"https://api.github.com/users/sunhs/gists{/gist_id}","starred_url":"https://api.github.com/users/sunhs/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/sunhs/subscriptions","organizations_url":"https://api.github.com/users/sunhs/orgs","repos_url":"https://api.github.com/users/sunhs/repos","events_url":"https://api.github.com/users/sunhs/events{/privacy}","received_events_url":"https://api.github.com/users/sunhs/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-26T09:42:03Z","updated_at":"2023-07-26T09:42:03Z","author_association":"NONE","body":"你的自定义 retry_policy 里是不是针对 ERPCTIMEDOUT 也重试了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651385937/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651393985","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1651393985","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1651393985,"node_id":"IC_kwDOBhmkcs5ibkXB","user":{"login":"372046933","id":1251167,"node_id":"MDQ6VXNlcjEyNTExNjc=","avatar_url":"https://avatars.githubusercontent.com/u/1251167?v=4","gravatar_id":"","url":"https://api.github.com/users/372046933","html_url":"https://github.com/372046933","followers_url":"https://api.github.com/users/372046933/followers","following_url":"https://api.github.com/users/372046933/following{/other_user}","gists_url":"https://api.github.com/users/372046933/gists{/gist_id}","starred_url":"https://api.github.com/users/372046933/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/372046933/subscriptions","organizations_url":"https://api.github.com/users/372046933/orgs","repos_url":"https://api.github.com/users/372046933/repos","events_url":"https://api.github.com/users/372046933/events{/privacy}","received_events_url":"https://api.github.com/users/372046933/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-26T09:46:44Z","updated_at":"2023-07-26T09:46:44Z","author_association":"CONTRIBUTOR","body":"哪个地方abort呢？ 在应用层出现RPC失败的时候吗？出core了之后，查看那些变量呢？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651393985/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651528024","html_url":"https://github.com/apache/brpc/issues/2265#issuecomment-1651528024","issue_url":"https://api.github.com/repos/apache/brpc/issues/2265","id":1651528024,"node_id":"IC_kwDOBhmkcs5icFFY","user":{"login":"Tuvie","id":5780312,"node_id":"MDQ6VXNlcjU3ODAzMTI=","avatar_url":"https://avatars.githubusercontent.com/u/5780312?v=4","gravatar_id":"","url":"https://api.github.com/users/Tuvie","html_url":"https://github.com/Tuvie","followers_url":"https://api.github.com/users/Tuvie/followers","following_url":"https://api.github.com/users/Tuvie/following{/other_user}","gists_url":"https://api.github.com/users/Tuvie/gists{/gist_id}","starred_url":"https://api.github.com/users/Tuvie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Tuvie/subscriptions","organizations_url":"https://api.github.com/users/Tuvie/orgs","repos_url":"https://api.github.com/users/Tuvie/repos","events_url":"https://api.github.com/users/Tuvie/events{/privacy}","received_events_url":"https://api.github.com/users/Tuvie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-26T10:41:16Z","updated_at":"2023-07-26T10:41:16Z","author_association":"CONTRIBUTOR","body":"就在出现协议错误这里。fatal前也顺便brpc::rdma::DumpMemoryPoolInfo()下。\r\n\r\n另外，也贴下你和rdma相关的所有的flag设置看看。以及程序你的user_data是多大的？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1651528024/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1652817781","html_url":"https://github.com/apache/brpc/pull/2325#issuecomment-1652817781","issue_url":"https://api.github.com/repos/apache/brpc/issues/2325","id":1652817781,"node_id":"IC_kwDOBhmkcs5ig_91","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-27T02:23:03Z","updated_at":"2023-07-27T02:23:03Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1652817781/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1652944255","html_url":"https://github.com/apache/brpc/pull/2329#issuecomment-1652944255","issue_url":"https://api.github.com/repos/apache/brpc/issues/2329","id":1652944255,"node_id":"IC_kwDOBhmkcs5ihe1_","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-27T05:39:25Z","updated_at":"2023-07-27T05:39:25Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1652944255/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1653419109","html_url":"https://github.com/apache/brpc/pull/2102#issuecomment-1653419109","issue_url":"https://api.github.com/repos/apache/brpc/issues/2102","id":1653419109,"node_id":"IC_kwDOBhmkcs5ijSxl","user":{"login":"leaf-potato","id":49188857,"node_id":"MDQ6VXNlcjQ5MTg4ODU3","avatar_url":"https://avatars.githubusercontent.com/u/49188857?v=4","gravatar_id":"","url":"https://api.github.com/users/leaf-potato","html_url":"https://github.com/leaf-potato","followers_url":"https://api.github.com/users/leaf-potato/followers","following_url":"https://api.github.com/users/leaf-potato/following{/other_user}","gists_url":"https://api.github.com/users/leaf-potato/gists{/gist_id}","starred_url":"https://api.github.com/users/leaf-potato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leaf-potato/subscriptions","organizations_url":"https://api.github.com/users/leaf-potato/orgs","repos_url":"https://api.github.com/users/leaf-potato/repos","events_url":"https://api.github.com/users/leaf-potato/events{/privacy}","received_events_url":"https://api.github.com/users/leaf-potato/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-27T11:21:47Z","updated_at":"2023-07-27T11:21:47Z","author_association":"CONTRIBUTOR","body":"@wwbmmm 请问下PR还有需要修改的地儿嘛","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1653419109/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1653754496","html_url":"https://github.com/apache/brpc/pull/2328#issuecomment-1653754496","issue_url":"https://api.github.com/repos/apache/brpc/issues/2328","id":1653754496,"node_id":"IC_kwDOBhmkcs5ikkqA","user":{"login":"yockie","id":2568971,"node_id":"MDQ6VXNlcjI1Njg5NzE=","avatar_url":"https://avatars.githubusercontent.com/u/2568971?v=4","gravatar_id":"","url":"https://api.github.com/users/yockie","html_url":"https://github.com/yockie","followers_url":"https://api.github.com/users/yockie/followers","following_url":"https://api.github.com/users/yockie/following{/other_user}","gists_url":"https://api.github.com/users/yockie/gists{/gist_id}","starred_url":"https://api.github.com/users/yockie/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yockie/subscriptions","organizations_url":"https://api.github.com/users/yockie/orgs","repos_url":"https://api.github.com/users/yockie/repos","events_url":"https://api.github.com/users/yockie/events{/privacy}","received_events_url":"https://api.github.com/users/yockie/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-27T14:37:17Z","updated_at":"2023-07-27T14:37:17Z","author_association":"CONTRIBUTOR","body":"> 另外，补充一下单测吧\r\n\r\n之前单测写的不对，已经修改了，本地跑通了","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1653754496/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1655215397","html_url":"https://github.com/apache/brpc/issues/2331#issuecomment-1655215397","issue_url":"https://api.github.com/repos/apache/brpc/issues/2331","id":1655215397,"node_id":"IC_kwDOBhmkcs5iqJUl","user":{"login":"Huixxi","id":21335093,"node_id":"MDQ6VXNlcjIxMzM1MDkz","avatar_url":"https://avatars.githubusercontent.com/u/21335093?v=4","gravatar_id":"","url":"https://api.github.com/users/Huixxi","html_url":"https://github.com/Huixxi","followers_url":"https://api.github.com/users/Huixxi/followers","following_url":"https://api.github.com/users/Huixxi/following{/other_user}","gists_url":"https://api.github.com/users/Huixxi/gists{/gist_id}","starred_url":"https://api.github.com/users/Huixxi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Huixxi/subscriptions","organizations_url":"https://api.github.com/users/Huixxi/orgs","repos_url":"https://api.github.com/users/Huixxi/repos","events_url":"https://api.github.com/users/Huixxi/events{/privacy}","received_events_url":"https://api.github.com/users/Huixxi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-28T07:51:15Z","updated_at":"2023-07-28T07:51:15Z","author_association":"CONTRIBUTOR","body":"是在什么平台编译的？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1655215397/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1655240875","html_url":"https://github.com/apache/brpc/issues/2331#issuecomment-1655240875","issue_url":"https://api.github.com/repos/apache/brpc/issues/2331","id":1655240875,"node_id":"IC_kwDOBhmkcs5iqPir","user":{"login":"zhyq0520","id":8245175,"node_id":"MDQ6VXNlcjgyNDUxNzU=","avatar_url":"https://avatars.githubusercontent.com/u/8245175?v=4","gravatar_id":"","url":"https://api.github.com/users/zhyq0520","html_url":"https://github.com/zhyq0520","followers_url":"https://api.github.com/users/zhyq0520/followers","following_url":"https://api.github.com/users/zhyq0520/following{/other_user}","gists_url":"https://api.github.com/users/zhyq0520/gists{/gist_id}","starred_url":"https://api.github.com/users/zhyq0520/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhyq0520/subscriptions","organizations_url":"https://api.github.com/users/zhyq0520/orgs","repos_url":"https://api.github.com/users/zhyq0520/repos","events_url":"https://api.github.com/users/zhyq0520/events{/privacy}","received_events_url":"https://api.github.com/users/zhyq0520/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-28T08:08:59Z","updated_at":"2023-07-28T08:08:59Z","author_association":"NONE","body":"> \r\n\r\n解决了，我改了CMakeLists.txt引入的\r\n3q~","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1655240875/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1657112737","html_url":"https://github.com/apache/brpc/issues/2334#issuecomment-1657112737","issue_url":"https://api.github.com/repos/apache/brpc/issues/2334","id":1657112737,"node_id":"IC_kwDOBhmkcs5ixYih","user":{"login":"leaf-potato","id":49188857,"node_id":"MDQ6VXNlcjQ5MTg4ODU3","avatar_url":"https://avatars.githubusercontent.com/u/49188857?v=4","gravatar_id":"","url":"https://api.github.com/users/leaf-potato","html_url":"https://github.com/leaf-potato","followers_url":"https://api.github.com/users/leaf-potato/followers","following_url":"https://api.github.com/users/leaf-potato/following{/other_user}","gists_url":"https://api.github.com/users/leaf-potato/gists{/gist_id}","starred_url":"https://api.github.com/users/leaf-potato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leaf-potato/subscriptions","organizations_url":"https://api.github.com/users/leaf-potato/orgs","repos_url":"https://api.github.com/users/leaf-potato/repos","events_url":"https://api.github.com/users/leaf-potato/events{/privacy}","received_events_url":"https://api.github.com/users/leaf-potato/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-30T11:19:10Z","updated_at":"2023-07-30T11:19:10Z","author_association":"CONTRIBUTOR","body":"通过[代码](https://github.com/apache/brpc/blob/461590640d1c4f0cf4f93c9c39419d7125ad9efa/src/brpc/policy/http_rpc_protocol.cpp#L1481)看应该是没获取h2协议下非grpc情况的content-type：\r\n\r\n![image](https://github.com/apache/brpc/assets/49188857/640d3d08-30b5-4230-8a8b-dba24337482e)\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1657112737/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1657127852","html_url":"https://github.com/apache/brpc/issues/2334#issuecomment-1657127852","issue_url":"https://api.github.com/repos/apache/brpc/issues/2334","id":1657127852,"node_id":"IC_kwDOBhmkcs5ixcOs","user":{"login":"leaf-potato","id":49188857,"node_id":"MDQ6VXNlcjQ5MTg4ODU3","avatar_url":"https://avatars.githubusercontent.com/u/49188857?v=4","gravatar_id":"","url":"https://api.github.com/users/leaf-potato","html_url":"https://github.com/leaf-potato","followers_url":"https://api.github.com/users/leaf-potato/followers","following_url":"https://api.github.com/users/leaf-potato/following{/other_user}","gists_url":"https://api.github.com/users/leaf-potato/gists{/gist_id}","starred_url":"https://api.github.com/users/leaf-potato/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/leaf-potato/subscriptions","organizations_url":"https://api.github.com/users/leaf-potato/orgs","repos_url":"https://api.github.com/users/leaf-potato/repos","events_url":"https://api.github.com/users/leaf-potato/events{/privacy}","received_events_url":"https://api.github.com/users/leaf-potato/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-30T12:30:41Z","updated_at":"2023-07-30T12:30:41Z","author_association":"CONTRIBUTOR","body":"已提PR https://github.com/apache/brpc/pull/2335 修复","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1657127852/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1657593570","html_url":"https://github.com/apache/brpc/pull/2335#issuecomment-1657593570","issue_url":"https://api.github.com/repos/apache/brpc/issues/2335","id":1657593570,"node_id":"IC_kwDOBhmkcs5izN7i","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-07-31T04:59:39Z","updated_at":"2023-07-31T04:59:39Z","author_association":"MEMBER","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1657593570/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1660582257","html_url":"https://github.com/apache/brpc/pull/2337#issuecomment-1660582257","issue_url":"https://api.github.com/repos/apache/brpc/issues/2337","id":1660582257,"node_id":"IC_kwDOBhmkcs5i-nlx","user":{"login":"wasphin","id":1237906,"node_id":"MDQ6VXNlcjEyMzc5MDY=","avatar_url":"https://avatars.githubusercontent.com/u/1237906?v=4","gravatar_id":"","url":"https://api.github.com/users/wasphin","html_url":"https://github.com/wasphin","followers_url":"https://api.github.com/users/wasphin/followers","following_url":"https://api.github.com/users/wasphin/following{/other_user}","gists_url":"https://api.github.com/users/wasphin/gists{/gist_id}","starred_url":"https://api.github.com/users/wasphin/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wasphin/subscriptions","organizations_url":"https://api.github.com/users/wasphin/orgs","repos_url":"https://api.github.com/users/wasphin/repos","events_url":"https://api.github.com/users/wasphin/events{/privacy}","received_events_url":"https://api.github.com/users/wasphin/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-01T15:41:49Z","updated_at":"2023-08-01T15:41:49Z","author_association":"MEMBER","body":"这里更新下 license 说明\r\nhttps://github.com/apache/brpc/blob/461590640d1c4f0cf4f93c9c39419d7125ad9efa/LICENSE#L763\r\n\r\n并修改下 ci 豁免相关文件的检查吧\r\nhttps://github.com/apache/brpc/blob/461590640d1c4f0cf4f93c9c39419d7125ad9efa/.licenserc.yaml#L61\r\n\r\nchromium-base 下 license 文件没有，这里有个 https://chromium.googlesource.com/chromium/src/+/refs/heads/main/LICENSE\r\n但 copyright 年份和我们列的不一样，这个不确定怎么处理下。\r\n","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1660582257/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1661579204","html_url":"https://github.com/apache/brpc/pull/2102#issuecomment-1661579204","issue_url":"https://api.github.com/repos/apache/brpc/issues/2102","id":1661579204,"node_id":"IC_kwDOBhmkcs5jCa_E","user":{"login":"wwbmmm","id":3894631,"node_id":"MDQ6VXNlcjM4OTQ2MzE=","avatar_url":"https://avatars.githubusercontent.com/u/3894631?v=4","gravatar_id":"","url":"https://api.github.com/users/wwbmmm","html_url":"https://github.com/wwbmmm","followers_url":"https://api.github.com/users/wwbmmm/followers","following_url":"https://api.github.com/users/wwbmmm/following{/other_user}","gists_url":"https://api.github.com/users/wwbmmm/gists{/gist_id}","starred_url":"https://api.github.com/users/wwbmmm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wwbmmm/subscriptions","organizations_url":"https://api.github.com/users/wwbmmm/orgs","repos_url":"https://api.github.com/users/wwbmmm/repos","events_url":"https://api.github.com/users/wwbmmm/events{/privacy}","received_events_url":"https://api.github.com/users/wwbmmm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-02T06:31:31Z","updated_at":"2023-08-02T06:31:31Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1661579204/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1661770881","html_url":"https://github.com/apache/brpc/pull/2341#issuecomment-1661770881","issue_url":"https://api.github.com/repos/apache/brpc/issues/2341","id":1661770881,"node_id":"IC_kwDOBhmkcs5jDJyB","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-02T08:41:54Z","updated_at":"2023-08-02T08:41:54Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1661770881/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1661790376","html_url":"https://github.com/apache/brpc/pull/2340#issuecomment-1661790376","issue_url":"https://api.github.com/repos/apache/brpc/issues/2340","id":1661790376,"node_id":"IC_kwDOBhmkcs5jDOio","user":{"login":"serverglen","id":38067377,"node_id":"MDQ6VXNlcjM4MDY3Mzc3","avatar_url":"https://avatars.githubusercontent.com/u/38067377?v=4","gravatar_id":"","url":"https://api.github.com/users/serverglen","html_url":"https://github.com/serverglen","followers_url":"https://api.github.com/users/serverglen/followers","following_url":"https://api.github.com/users/serverglen/following{/other_user}","gists_url":"https://api.github.com/users/serverglen/gists{/gist_id}","starred_url":"https://api.github.com/users/serverglen/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/serverglen/subscriptions","organizations_url":"https://api.github.com/users/serverglen/orgs","repos_url":"https://api.github.com/users/serverglen/repos","events_url":"https://api.github.com/users/serverglen/events{/privacy}","received_events_url":"https://api.github.com/users/serverglen/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-02T08:47:47Z","updated_at":"2023-08-02T08:47:47Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1661790376/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1662084851","html_url":"https://github.com/apache/brpc/pull/2341#issuecomment-1662084851","issue_url":"https://api.github.com/repos/apache/brpc/issues/2341","id":1662084851,"node_id":"IC_kwDOBhmkcs5jEWbz","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-02T12:03:02Z","updated_at":"2023-08-02T12:03:02Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1662084851/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1664932461","html_url":"https://github.com/apache/brpc/pull/2340#issuecomment-1664932461","issue_url":"https://api.github.com/repos/apache/brpc/issues/2340","id":1664932461,"node_id":"IC_kwDOBhmkcs5jPNpt","user":{"login":"heartplus","id":46808880,"node_id":"MDQ6VXNlcjQ2ODA4ODgw","avatar_url":"https://avatars.githubusercontent.com/u/46808880?v=4","gravatar_id":"","url":"https://api.github.com/users/heartplus","html_url":"https://github.com/heartplus","followers_url":"https://api.github.com/users/heartplus/followers","following_url":"https://api.github.com/users/heartplus/following{/other_user}","gists_url":"https://api.github.com/users/heartplus/gists{/gist_id}","starred_url":"https://api.github.com/users/heartplus/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/heartplus/subscriptions","organizations_url":"https://api.github.com/users/heartplus/orgs","repos_url":"https://api.github.com/users/heartplus/repos","events_url":"https://api.github.com/users/heartplus/events{/privacy}","received_events_url":"https://api.github.com/users/heartplus/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-04T03:52:40Z","updated_at":"2023-08-04T03:52:40Z","author_association":"NONE","body":"nobody except RedisRespone.Swap calls RedisReply.Swap, so it is safety to change behaviour of RedisReply.Swap\r\n// i just renamed RedisReply.Swap to RedisReply.Swap2 to check whether compile passed or not","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1664932461/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1665067954","html_url":"https://github.com/apache/brpc/pull/2340#issuecomment-1665067954","issue_url":"https://api.github.com/repos/apache/brpc/issues/2340","id":1665067954,"node_id":"IC_kwDOBhmkcs5jPuuy","user":{"login":"chenBright","id":12249635,"node_id":"MDQ6VXNlcjEyMjQ5NjM1","avatar_url":"https://avatars.githubusercontent.com/u/12249635?v=4","gravatar_id":"","url":"https://api.github.com/users/chenBright","html_url":"https://github.com/chenBright","followers_url":"https://api.github.com/users/chenBright/followers","following_url":"https://api.github.com/users/chenBright/following{/other_user}","gists_url":"https://api.github.com/users/chenBright/gists{/gist_id}","starred_url":"https://api.github.com/users/chenBright/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenBright/subscriptions","organizations_url":"https://api.github.com/users/chenBright/orgs","repos_url":"https://api.github.com/users/chenBright/repos","events_url":"https://api.github.com/users/chenBright/events{/privacy}","received_events_url":"https://api.github.com/users/chenBright/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-04T06:13:27Z","updated_at":"2023-08-04T06:13:27Z","author_association":"CONTRIBUTOR","body":"LGTM","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1665067954/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1666914091","html_url":"https://github.com/apache/brpc/pull/2337#issuecomment-1666914091","issue_url":"https://api.github.com/repos/apache/brpc/issues/2337","id":1666914091,"node_id":"IC_kwDOBhmkcs5jWxcr","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-06T16:35:25Z","updated_at":"2023-08-06T16:35:25Z","author_association":"MEMBER","body":"这个库一定要在brpc层引入么，可以在应用层作为一个third party引入么？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1666914091/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1666915431","html_url":"https://github.com/apache/brpc/issues/2338#issuecomment-1666915431","issue_url":"https://api.github.com/repos/apache/brpc/issues/2338","id":1666915431,"node_id":"IC_kwDOBhmkcs5jWxxn","user":{"login":"zyearn","id":4475779,"node_id":"MDQ6VXNlcjQ0NzU3Nzk=","avatar_url":"https://avatars.githubusercontent.com/u/4475779?v=4","gravatar_id":"","url":"https://api.github.com/users/zyearn","html_url":"https://github.com/zyearn","followers_url":"https://api.github.com/users/zyearn/followers","following_url":"https://api.github.com/users/zyearn/following{/other_user}","gists_url":"https://api.github.com/users/zyearn/gists{/gist_id}","starred_url":"https://api.github.com/users/zyearn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zyearn/subscriptions","organizations_url":"https://api.github.com/users/zyearn/orgs","repos_url":"https://api.github.com/users/zyearn/repos","events_url":"https://api.github.com/users/zyearn/events{/privacy}","received_events_url":"https://api.github.com/users/zyearn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2023-08-06T16:40:43Z","updated_at":"2023-08-06T16:40:43Z","author_association":"MEMBER","body":"@TousakaRin @cdjingit 看看这几个问题有什么想法？","reactions":{"url":"https://api.github.com/repos/apache/brpc/issues/comments/1666915431/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]