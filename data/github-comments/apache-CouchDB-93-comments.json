[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687255497","html_url":"https://github.com/apache/couchdb/pull/3129#issuecomment-687255497","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3129","id":687255497,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NzI1NTQ5Nw==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-04T16:33:03Z","updated_at":"2020-09-04T16:33:03Z","author_association":"MEMBER","body":"thinking I might reference \"transfer encoding\" explicitly, with \"identity\" and \"chunked\" instead of boolean?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687255497/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687256024","html_url":"https://github.com/apache/couchdb/pull/3129#issuecomment-687256024","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3129","id":687256024,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NzI1NjAyNA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-04T16:34:08Z","updated_at":"2020-09-04T16:34:08Z","author_association":"MEMBER","body":"enh, but the point of the change is the delay. not sending the response until we're sure we can send the whole thing, it's not really about the transfer encoding, that's a side-effect (it just seemed silly send a chunked response when I have the whole thing in memory and can calculate the content-length)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687256024/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687260435","html_url":"https://github.com/apache/couchdb/pull/3129#issuecomment-687260435","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3129","id":687260435,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NzI2MDQzNQ==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-04T16:42:16Z","updated_at":"2020-09-04T16:42:16Z","author_association":"MEMBER","body":"buffer_response it is.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687260435/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687552502","html_url":"https://github.com/apache/couchdb/issues/2221#issuecomment-687552502","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2221","id":687552502,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NzU1MjUwMg==","user":{"login":"mqtik","id":42002579,"node_id":"MDQ6VXNlcjQyMDAyNTc5","avatar_url":"https://avatars.githubusercontent.com/u/42002579?v=4","gravatar_id":"","url":"https://api.github.com/users/mqtik","html_url":"https://github.com/mqtik","followers_url":"https://api.github.com/users/mqtik/followers","following_url":"https://api.github.com/users/mqtik/following{/other_user}","gists_url":"https://api.github.com/users/mqtik/gists{/gist_id}","starred_url":"https://api.github.com/users/mqtik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mqtik/subscriptions","organizations_url":"https://api.github.com/users/mqtik/orgs","repos_url":"https://api.github.com/users/mqtik/repos","events_url":"https://api.github.com/users/mqtik/events{/privacy}","received_events_url":"https://api.github.com/users/mqtik/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-05T05:13:40Z","updated_at":"2020-09-05T05:13:40Z","author_association":"NONE","body":"What about nginx?\r\n\r\nI can't seem to make authorization by cookie to work. Can't really say if it's for nginx.\r\n\r\n![image](https://user-images.githubusercontent.com/42002579/92298234-11cda000-ef1d-11ea-92a4-ea9b01102fd0.png)\r\n\r\nIt sets the cookie on POST, and subsequent request are not followed by a cookie header.\r\n\r\nTried to set same_site on local.ini but that broke the auth on Fauxton (started to happen the same that happens on my site). POST works fine, GET doesn't have Cookie on the header.\r\nI had to take the attribute out because I needed to log in again.\r\n\r\nAny help it's greatly appreciated.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687552502/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687554036","html_url":"https://github.com/apache/couchdb/issues/2221#issuecomment-687554036","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2221","id":687554036,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NzU1NDAzNg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-05T05:27:38Z","updated_at":"2020-09-05T05:27:38Z","author_association":"MEMBER","body":"If you are putting CouchDB behind nginx, this isn't a CouchDB bug, but a usage issue.\r\n\r\nPlease open a new discussion [here](https://github.com/apache/couchdb/discussions).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687554036/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687608227","html_url":"https://github.com/apache/couchdb/issues/2221#issuecomment-687608227","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2221","id":687608227,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NzYwODIyNw==","user":{"login":"komorebi-san","id":8327827,"node_id":"MDQ6VXNlcjgzMjc4Mjc=","avatar_url":"https://avatars.githubusercontent.com/u/8327827?v=4","gravatar_id":"","url":"https://api.github.com/users/komorebi-san","html_url":"https://github.com/komorebi-san","followers_url":"https://api.github.com/users/komorebi-san/followers","following_url":"https://api.github.com/users/komorebi-san/following{/other_user}","gists_url":"https://api.github.com/users/komorebi-san/gists{/gist_id}","starred_url":"https://api.github.com/users/komorebi-san/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/komorebi-san/subscriptions","organizations_url":"https://api.github.com/users/komorebi-san/orgs","repos_url":"https://api.github.com/users/komorebi-san/repos","events_url":"https://api.github.com/users/komorebi-san/events{/privacy}","received_events_url":"https://api.github.com/users/komorebi-san/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-05T13:02:39Z","updated_at":"2020-09-05T13:02:39Z","author_association":"NONE","body":"@mqtik What browser are you using? ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687608227/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687639270","html_url":"https://github.com/apache/couchdb/issues/2221#issuecomment-687639270","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2221","id":687639270,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NzYzOTI3MA==","user":{"login":"SinanGabel","id":5586130,"node_id":"MDQ6VXNlcjU1ODYxMzA=","avatar_url":"https://avatars.githubusercontent.com/u/5586130?v=4","gravatar_id":"","url":"https://api.github.com/users/SinanGabel","html_url":"https://github.com/SinanGabel","followers_url":"https://api.github.com/users/SinanGabel/followers","following_url":"https://api.github.com/users/SinanGabel/following{/other_user}","gists_url":"https://api.github.com/users/SinanGabel/gists{/gist_id}","starred_url":"https://api.github.com/users/SinanGabel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SinanGabel/subscriptions","organizations_url":"https://api.github.com/users/SinanGabel/orgs","repos_url":"https://api.github.com/users/SinanGabel/repos","events_url":"https://api.github.com/users/SinanGabel/events{/privacy}","received_events_url":"https://api.github.com/users/SinanGabel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-05T17:28:25Z","updated_at":"2020-09-05T17:28:25Z","author_association":"NONE","body":"This works (solution in first note on page):\n\nhttps://github.com/apache/couchdb/discussions/3012\n\nOn Sat, 5 Sep 2020 at 07:14, Matías <notifications@github.com> wrote:\n\n> What about nginx?\n>\n> I can't seem to make authorization by cookie to work. Can't really say if\n> it's for nginx.\n>\n> [image: image]\n> <https://user-images.githubusercontent.com/42002579/92298234-11cda000-ef1d-11ea-92a4-ea9b01102fd0.png>\n>\n> It sets the cookie on POST, and subsequent request are not followed by a\n> cookie header.\n>\n> Tried to set same_site on local.ini but that broke the auth on Fauxton\n> (started to happen the same that happens on my site). POST works fine, GET\n> doesn't have Cookie on the header.\n> I had to take the attribute out because I needed to log in again.\n>\n> Any help it's greatly appreciated.\n>\n> —\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/apache/couchdb/issues/2221#issuecomment-687552502>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/ABKTZUTA4PWKNP4WD5M4JJTSEHCJVANCNFSM4I5B5FIQ>\n> .\n>\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687639270/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687710564","html_url":"https://github.com/apache/couchdb/issues/2221#issuecomment-687710564","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2221","id":687710564,"node_id":"MDEyOklzc3VlQ29tbWVudDY4NzcxMDU2NA==","user":{"login":"mqtik","id":42002579,"node_id":"MDQ6VXNlcjQyMDAyNTc5","avatar_url":"https://avatars.githubusercontent.com/u/42002579?v=4","gravatar_id":"","url":"https://api.github.com/users/mqtik","html_url":"https://github.com/mqtik","followers_url":"https://api.github.com/users/mqtik/followers","following_url":"https://api.github.com/users/mqtik/following{/other_user}","gists_url":"https://api.github.com/users/mqtik/gists{/gist_id}","starred_url":"https://api.github.com/users/mqtik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mqtik/subscriptions","organizations_url":"https://api.github.com/users/mqtik/orgs","repos_url":"https://api.github.com/users/mqtik/repos","events_url":"https://api.github.com/users/mqtik/events{/privacy}","received_events_url":"https://api.github.com/users/mqtik/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-06T06:39:28Z","updated_at":"2020-09-06T06:39:28Z","author_association":"NONE","body":"Fixed.\r\nTurns out, Cookie must be included when allowing headers on nginx, and also pass headers/requests to couchDB.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/687710564/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688238084","html_url":"https://github.com/apache/couchdb/pull/3130#issuecomment-688238084","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3130","id":688238084,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODIzODA4NA==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-07T10:39:28Z","updated_at":"2020-09-07T10:39:28Z","author_association":"MEMBER","body":"Thank you for the review and merge, @wohali ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688238084/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688280662","html_url":"https://github.com/apache/couchdb/pull/3131#issuecomment-688280662","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3131","id":688280662,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODI4MDY2Mg==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-07T12:03:04Z","updated_at":"2020-09-07T12:21:50Z","author_association":"MEMBER","body":"I’d be happy to bike shed this to make it its own config variable `cookie_secure = bool` and folks who want both can set both, this was the least effort way to propose a change tho :)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688280662/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688307170","html_url":"https://github.com/apache/couchdb/pull/3131#issuecomment-688307170","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3131","id":688307170,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODMwNzE3MA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-07T12:55:17Z","updated_at":"2020-09-07T12:55:17Z","author_association":"MEMBER","body":"hm, the secure flag is added automatically if couchdb is serving a TLS response. If something else is doing TLS (like haproxy) then it should also add the secure flag.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688307170/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688313054","html_url":"https://github.com/apache/couchdb/pull/3131#issuecomment-688313054","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3131","id":688313054,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODMxMzA1NA==","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-07T13:05:36Z","updated_at":"2020-09-07T13:05:36Z","author_association":"MEMBER","body":"I'm -1 on this on principle, but please update the PR if I'm missing something obvious.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688313054/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688332494","html_url":"https://github.com/apache/couchdb/issues/2483#issuecomment-688332494","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2483","id":688332494,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODMzMjQ5NA==","user":{"login":"mqtik","id":42002579,"node_id":"MDQ6VXNlcjQyMDAyNTc5","avatar_url":"https://avatars.githubusercontent.com/u/42002579?v=4","gravatar_id":"","url":"https://api.github.com/users/mqtik","html_url":"https://github.com/mqtik","followers_url":"https://api.github.com/users/mqtik/followers","following_url":"https://api.github.com/users/mqtik/following{/other_user}","gists_url":"https://api.github.com/users/mqtik/gists{/gist_id}","starred_url":"https://api.github.com/users/mqtik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mqtik/subscriptions","organizations_url":"https://api.github.com/users/mqtik/orgs","repos_url":"https://api.github.com/users/mqtik/repos","events_url":"https://api.github.com/users/mqtik/events{/privacy}","received_events_url":"https://api.github.com/users/mqtik/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-07T13:38:34Z","updated_at":"2020-09-07T13:40:11Z","author_association":"NONE","body":"If you want to replicate with invalid credentials (or logged out), you need to set the database as Public (go to Permissions under Fauxton). The error will be gone by then.\r\n\r\nBut you're right. It would be nice if it didn't crash, just throw an 401 Unauthorized","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688332494/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688336111","html_url":"https://github.com/apache/couchdb/issues/1356#issuecomment-688336111","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1356","id":688336111,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODMzNjExMQ==","user":{"login":"mqtik","id":42002579,"node_id":"MDQ6VXNlcjQyMDAyNTc5","avatar_url":"https://avatars.githubusercontent.com/u/42002579?v=4","gravatar_id":"","url":"https://api.github.com/users/mqtik","html_url":"https://github.com/mqtik","followers_url":"https://api.github.com/users/mqtik/followers","following_url":"https://api.github.com/users/mqtik/following{/other_user}","gists_url":"https://api.github.com/users/mqtik/gists{/gist_id}","starred_url":"https://api.github.com/users/mqtik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mqtik/subscriptions","organizations_url":"https://api.github.com/users/mqtik/orgs","repos_url":"https://api.github.com/users/mqtik/repos","events_url":"https://api.github.com/users/mqtik/events{/privacy}","received_events_url":"https://api.github.com/users/mqtik/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-07T13:44:47Z","updated_at":"2020-09-07T13:44:47Z","author_association":"NONE","body":"How many CPU cores each cluster have? And how heavy is this heavy load? ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688336111/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688342120","html_url":"https://github.com/apache/couchdb/pull/3132#issuecomment-688342120","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3132","id":688342120,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODM0MjEyMA==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-07T13:55:32Z","updated_at":"2020-09-07T13:55:32Z","author_association":"MEMBER","body":"+1 (non-binding), content of this change matches the content merged to master for the original PR.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688342120/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688351779","html_url":"https://github.com/apache/couchdb/pull/3131#issuecomment-688351779","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3131","id":688351779,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODM1MTc3OQ==","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-07T14:11:54Z","updated_at":"2020-09-07T14:11:54Z","author_association":"MEMBER","body":"This might still be useful for scenarios where folks are behind proxies where they can’t add the Secure flag to the `Set-Cookie` header dynamically, and if they don’t want to go through the particular fun of setting up TLS with CouchDB itself.\r\n\r\nBut unless we have folks reporting they are in this situation, I’m happy to hold off on this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688351779/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688366929","html_url":"https://github.com/apache/couchdb/pull/3133#issuecomment-688366929","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3133","id":688366929,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODM2NjkyOQ==","user":{"login":"bessbd","id":9086834,"node_id":"MDQ6VXNlcjkwODY4MzQ=","avatar_url":"https://avatars.githubusercontent.com/u/9086834?v=4","gravatar_id":"","url":"https://api.github.com/users/bessbd","html_url":"https://github.com/bessbd","followers_url":"https://api.github.com/users/bessbd/followers","following_url":"https://api.github.com/users/bessbd/following{/other_user}","gists_url":"https://api.github.com/users/bessbd/gists{/gist_id}","starred_url":"https://api.github.com/users/bessbd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/bessbd/subscriptions","organizations_url":"https://api.github.com/users/bessbd/orgs","repos_url":"https://api.github.com/users/bessbd/repos","events_url":"https://api.github.com/users/bessbd/events{/privacy}","received_events_url":"https://api.github.com/users/bessbd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-07T14:38:59Z","updated_at":"2020-09-07T14:38:59Z","author_association":"MEMBER","body":"Thank you for the review and merge, @rnewson !","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688366929/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688465614","html_url":"https://github.com/apache/couchdb/issues/1356#issuecomment-688465614","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1356","id":688465614,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODQ2NTYxNA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-07T18:25:29Z","updated_at":"2020-09-07T18:25:29Z","author_association":"MEMBER","body":"This is from a long time ago, and I no longer have access to the environment. It was also prior to the new rexi timeout options being added.\r\n\r\nI'm going to close this issue for now.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688465614/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688465896","html_url":"https://github.com/apache/couchdb/issues/2483#issuecomment-688465896","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2483","id":688465896,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODQ2NTg5Ng==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-07T18:26:34Z","updated_at":"2020-09-07T18:26:34Z","author_association":"MEMBER","body":"For reference, we consider any `function_clause` in the logs as a bug.\r\n\r\nPull requests welcome.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688465896/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688849471","html_url":"https://github.com/apache/couchdb/pull/3127#issuecomment-688849471","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3127","id":688849471,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODg0OTQ3MQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-08T13:00:00Z","updated_at":"2020-09-08T13:00:00Z","author_association":"CONTRIBUTOR","body":"> I'm not convinced about having the default implementation of batch_module in the same file as couch_views_batch. I initially found it confusing trying to figure out where it starts and where couch_views_batch is. I would prefer we have a couch_batch module similar to couch_rate with the default module and couch_views_batch.\r\n\r\nI agree with Garren. This separation would also hide the `#batch_st{}` record in `couch_views_batch` module.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688849471/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688859591","html_url":"https://github.com/apache/couchdb/pull/3127#issuecomment-688859591","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3127","id":688859591,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODg1OTU5MQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-08T13:17:39Z","updated_at":"2020-09-08T13:17:39Z","author_association":"CONTRIBUTOR","body":"Just wanted to mention that the scope of `couch_rate` was bigger. The idea behind `couch_rate` was to provide a `rate limiter`/`batch size estimator` which can be used anywhere where we have a chance of a transaction failure from FDB and where we can be better off by adjusting transaction size (one possible use case is to unify with https://github.com/apache/couchdb/blob/prototype/fdb-layer/src/couch_replicator/src/couch_replicator_rate_limiter.erl). However since it seems like we are getting [a consensus that we should introduce limits](https://lists.apache.org/thread.html/rac6c90c4ae03dc055c7e8be6eca1c1e173cf2f98d2afe6d018e62d29%40%3Cdev.couchdb.apache.org%3E) we might not need a generic solution and `couch_view` specific one might suffice. \r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688859591/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688869483","html_url":"https://github.com/apache/couchdb/pull/3127#issuecomment-688869483","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3127","id":688869483,"node_id":"MDEyOklzc3VlQ29tbWVudDY4ODg2OTQ4Mw==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-08T13:32:59Z","updated_at":"2020-09-08T13:32:59Z","author_association":"CONTRIBUTOR","body":"In regards to `Move error reporting test to EUnit` commit you've mentioned: \r\n\r\n> This test doesn't fail correctly any longer. Rather than attempting to\r\ncreate a new pathological view case I've just moved it to eunit where we can use meck to throw errors directly.\r\n\r\nThe meck can be used from ExUnit. \r\n```\r\n  defp with_fdb_error(_ctx) do\r\n    :ok = :meck.new(:couch_views_batch, [:passthrough])\r\n    :meck.expect(:couch_views_batch, :start, [], fn() ->\r\n      :erlang.error({:erlfdb_error, 2101})\r\n    end)\r\n    on_exit(fn ->\r\n      :meck.unload()\r\n    end)\r\n  end\r\n\r\ndescribe \"something something\" do\r\n    setup [....,  :with_fdb_error]\r\n    test \"something something\", ctx do\r\n       ...\r\n    end\r\nend\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/688869483/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689002928","html_url":"https://github.com/apache/couchdb/pull/3127#issuecomment-689002928","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3127","id":689002928,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTAwMjkyOA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-08T16:44:23Z","updated_at":"2020-09-08T16:44:23Z","author_association":"MEMBER","body":"@garrensmith I've split the behavior/implementation between `couch_views_batch` (behavior) and `couch_views_batch_impl` (implementation). I don't believe this behavior is nearly abstract enough to cover anything besides couch_views so it doesn't make a lot of sense to me to create a new application to hold a new module that only couch_views will use.\r\n\r\n@iilyak For the scope I agree that this is a lot more narrow. I started by trying to figure out the AIMD/congestion algorithms in both couch_rate and couch_replicator but after thinking awhile I realized that having an AIMD based algorithm isn't appropriate for batch sizes since we want to avoid failing batches as much as possible because every failed batch is wasted time when building a view. I did a number of different approaches to try and measure optimal batch sizes and behaviors. An earlier version of this work actually tried to optimize the rate of indexing within the bounds of transaction sizes. That lead to the realization that just maximizing the work done in a single transaction was most beneficial overall for indexing throughput. That's how it ended up being so simple and narrow in the end.\r\n\r\nFor the meck-via-Elixir, that would have worked if this test were running in the same VM but those tests are run separately against an instance of `dev/run`.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689002928/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689009537","html_url":"https://github.com/apache/couchdb/pull/3127#issuecomment-689009537","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3127","id":689009537,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTAwOTUzNw==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-08T16:56:23Z","updated_at":"2020-09-08T16:56:23Z","author_association":"CONTRIBUTOR","body":"> For the meck-via-Elixir, that would have worked if this test were running in the same VM but those tests are run separately against an instance of dev/run.\r\n\r\nWe have two kinds of Elixir tests\r\n- integration tests which live in test/elixir/test\r\n- unit tests which live in `src/<app>/test/exunit/`\r\n\r\nUnit tests are run on the same VM","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689009537/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689052891","html_url":"https://github.com/apache/couchdb/pull/3127#issuecomment-689052891","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3127","id":689052891,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTA1Mjg5MQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-08T18:20:02Z","updated_at":"2020-09-08T18:20:02Z","author_association":"MEMBER","body":"@nickva I've addressed your three main suggestions. For the metrics I don't have a good answer other than maybe expose the timing logs I've currently somewhat hacked in the views branch. Let me know if you think some sort of combined metric there would be useful and I can add that.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689052891/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689060998","html_url":"https://github.com/apache/couchdb/pull/3127#issuecomment-689060998","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3127","id":689060998,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTA2MDk5OA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-08T18:36:06Z","updated_at":"2020-09-08T18:36:06Z","author_association":"CONTRIBUTOR","body":"@davisp Looks, let's skip the metrics for now, could be a future enhancement\r\n\r\nI am getting a consistent timeout in the `couch_views_indexer_test:39: indexer_test_ (indexed_empty_db)...` test while it passes on prototype/fdb-layer. Looking a bit into that","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689060998/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689074435","html_url":"https://github.com/apache/couchdb/pull/3127#issuecomment-689074435","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3127","id":689074435,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTA3NDQzNQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-08T19:00:49Z","updated_at":"2020-09-08T19:00:49Z","author_association":"MEMBER","body":"@nickva I sometimes have one but it seems to be only occasionally for the first run after compiling and then doesn't happen again. Let me know if you find anything though. Flaky tests are never good.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689074435/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689168583","html_url":"https://github.com/apache/couchdb/pull/3134#issuecomment-689168583","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3134","id":689168583,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTE2ODU4Mw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-08T22:26:14Z","updated_at":"2020-09-08T22:26:14Z","author_association":"MEMBER","body":"@garrensmith Approved once you push Fauxton to npm please: https://www.npmjs.com/package/fauxton . I don't have the rights to do this and I can't find it written down how to do so. (We probably need to document this for the PMC.)\r\n\r\nI have the backport to 3.x already handled in #3122 .\r\n\r\nThanks for the help!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689168583/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689206296","html_url":"https://github.com/apache/couchdb/pull/3127#issuecomment-689206296","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3127","id":689206296,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTIwNjI5Ng==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-09T00:20:44Z","updated_at":"2020-09-09T00:20:44Z","author_association":"CONTRIBUTOR","body":"@davisp Found the issue, couch_views builds are were fast enough to trigger a race condition in couch_jobs monitoring code. The job was completing before the type monitor for couch_views jobs even started.\r\n\r\nMade a PR to fix it:\r\n  https://github.com/apache/couchdb/pull/3135","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689206296/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689335308","html_url":"https://github.com/apache/couchdb/issues/3136#issuecomment-689335308","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3136","id":689335308,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTMzNTMwOA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-09T06:25:49Z","updated_at":"2020-09-09T06:25:49Z","author_association":"MEMBER","body":"You will need to fork CouchDB and maintain your own version with this modification. CouchDB is not going to allow end users to create databases beginning with `_`, sorry.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689335308/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689383537","html_url":"https://github.com/apache/couchdb/pull/3134#issuecomment-689383537","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3134","id":689383537,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTM4MzUzNw==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-09T07:49:38Z","updated_at":"2020-09-09T07:49:38Z","author_association":"MEMBER","body":"I've published it. You need to be logged into npm. Then in the fauxton repo:\r\n\r\n```\r\nnpm publish\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689383537/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689612652","html_url":"https://github.com/apache/couchdb/pull/3135#issuecomment-689612652","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3135","id":689612652,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTYxMjY1Mg==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-09T14:48:46Z","updated_at":"2020-09-09T14:48:46Z","author_association":"MEMBER","body":"I read the code and I'm not seeing the connection between this and flaky tests. You mentioned the other day you thought you'd found a job that finished before a client subscribed for notifications but I'm not seeing the connection here.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689612652/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689628366","html_url":"https://github.com/apache/couchdb/pull/3137#issuecomment-689628366","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3137","id":689628366,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTYyODM2Ng==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-09T15:13:01Z","updated_at":"2020-09-09T15:13:01Z","author_association":"MEMBER","body":"The comparison that's most important is probably against `prototype/fdb-layer` which you can see here:\r\n\r\nhttps://github.com/apache/couchdb/compare/prototype/fdb-layer...prototype/fdb-layer-final-rebase","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689628366/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689629809","html_url":"https://github.com/apache/couchdb/pull/3135#issuecomment-689629809","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3135","id":689629809,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTYyOTgwOQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-09T15:15:10Z","updated_at":"2020-09-09T15:15:10Z","author_association":"CONTRIBUTOR","body":"There is a notification monitor running for each type so that it watches for activity of those jobs and responds to subscriptions. To discover the types of jobs there is a periodic polling of all the types. The notifiers can also be auto-started the first time a subscription for that type comes in. Each type notifiers then starts watching for activity on that type starting with the version that it reads from the init call https://github.com/apache/couchdb/blob/prototype/fdb-layer/src/couch_jobs/src/couch_jobs_notifier.erl#L81\r\n\r\nWhat could happen (in a test mostly), a job subscribes while it is in the pending state still, then quickly finishes. By the time the type notifier is auto-started for that type, there won't be any more updates for that type since the test might have run just one job of that type and then was waiting to finish. So instead of adding more complexity to the notification mechanism, we ensure the notifiers are started when the type timeouts are set.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689629809/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689631994","html_url":"https://github.com/apache/couchdb/pull/3135#issuecomment-689631994","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3135","id":689631994,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTYzMTk5NA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-09T15:18:26Z","updated_at":"2020-09-09T15:18:26Z","author_association":"MEMBER","body":"Cool, makes sense.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689631994/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689735629","html_url":"https://github.com/apache/couchdb/pull/3137#issuecomment-689735629","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3137","id":689735629,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTczNTYyOQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-09T18:22:05Z","updated_at":"2020-09-09T18:22:05Z","author_association":"MEMBER","body":"Turns out a merge is much cleaner:\r\n\r\nhttps://github.com/apache/couchdb/pull/3140","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689735629/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689735840","html_url":"https://github.com/apache/couchdb/pull/3139#issuecomment-689735840","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3139","id":689735840,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTczNTg0MA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-09T18:22:29Z","updated_at":"2020-09-09T18:22:29Z","author_association":"MEMBER","body":"@nickva if I don't put this in 3.1.1 is it crucial? I've already finished the release notes, is why I ask.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689735840/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689735984","html_url":"https://github.com/apache/couchdb/pull/3139#issuecomment-689735984","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3139","id":689735984,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTczNTk4NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-09T18:22:46Z","updated_at":"2020-09-09T18:22:46Z","author_association":"MEMBER","body":"To be clear, still backport this. It just might not make 3.1.1.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689735984/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689737508","html_url":"https://github.com/apache/couchdb/pull/3139#issuecomment-689737508","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3139","id":689737508,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTczNzUwOA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-09T18:25:42Z","updated_at":"2020-09-09T18:25:42Z","author_association":"CONTRIBUTOR","body":"@wohali thanks for taking a look, it's not as critical I think. Users can mitigate the error by simply deleting the malformed document from their _replicator dbs, so let's stick with what we have for 3.1.1 already.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689737508/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689774470","html_url":"https://github.com/apache/couchdb/pull/3141#issuecomment-689774470","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3141","id":689774470,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTc3NDQ3MA==","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-09T19:38:10Z","updated_at":"2020-09-09T19:38:10Z","author_association":"CONTRIBUTOR","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689774470/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689848323","html_url":"https://github.com/apache/couchdb/issues/3136#issuecomment-689848323","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3136","id":689848323,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTg0ODMyMw==","user":{"login":"mqtik","id":42002579,"node_id":"MDQ6VXNlcjQyMDAyNTc5","avatar_url":"https://avatars.githubusercontent.com/u/42002579?v=4","gravatar_id":"","url":"https://api.github.com/users/mqtik","html_url":"https://github.com/mqtik","followers_url":"https://api.github.com/users/mqtik/followers","following_url":"https://api.github.com/users/mqtik/following{/other_user}","gists_url":"https://api.github.com/users/mqtik/gists{/gist_id}","starred_url":"https://api.github.com/users/mqtik/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mqtik/subscriptions","organizations_url":"https://api.github.com/users/mqtik/orgs","repos_url":"https://api.github.com/users/mqtik/repos","events_url":"https://api.github.com/users/mqtik/events{/privacy}","received_events_url":"https://api.github.com/users/mqtik/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-09T22:09:30Z","updated_at":"2020-09-09T22:11:22Z","author_association":"NONE","body":"Oh, well. I'll have to find another way.\r\n\r\nI'm curious @wohali, why not? I know _* databases are special, but why users can't create such databases? \r\n\r\nThanks for your reply.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689848323/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689990501","html_url":"https://github.com/apache/couchdb/issues/3136#issuecomment-689990501","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3136","id":689990501,"node_id":"MDEyOklzc3VlQ29tbWVudDY4OTk5MDUwMQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-10T05:21:23Z","updated_at":"2020-09-10T05:21:23Z","author_association":"MEMBER","body":"They are system reserved databases by convention. The product needs a place for expansion for ecosystem projects where specific functionality is assigned to databases starting with `_`. This includes `_users`, `_replicator`, and `_global_changes` but may expand in the future. It's a convention that dates back to the first versions of CouchDB, so it's unlikely to change. Sorry about that.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/689990501/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/690355622","html_url":"https://github.com/apache/couchdb/pull/3122#issuecomment-690355622","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3122","id":690355622,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MDM1NTYyMg==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-10T15:10:48Z","updated_at":"2020-09-10T15:10:48Z","author_association":"MEMBER","body":"All done, this is ready to go.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/690355622/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/690739310","html_url":"https://github.com/apache/couchdb/pull/3127#issuecomment-690739310","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3127","id":690739310,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MDczOTMxMA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-10T21:22:37Z","updated_at":"2020-09-10T21:22:37Z","author_association":"MEMBER","body":"@nickva I've addressed all of your suggestions. Let me know if you have anything else.\r\n\r\n@iilyak @garrensmith I'm pretty sure I've addressed all of your concerns, let me know if there's anything left to handle.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/690739310/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/690742754","html_url":"https://github.com/apache/couchdb/pull/3127#issuecomment-690742754","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3127","id":690742754,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MDc0Mjc1NA==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-10T21:30:24Z","updated_at":"2020-09-11T14:53:08Z","author_association":"CONTRIBUTOR","body":"@davisp lgtm +1 to merge, also good job adding extra tests!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/690742754/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/690761894","html_url":"https://github.com/apache/couchdb/pull/3147#issuecomment-690761894","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3147","id":690761894,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MDc2MTg5NA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-10T22:17:53Z","updated_at":"2020-09-10T22:17:53Z","author_association":"MEMBER","body":"+1, I will cut an RC2 for this.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/690761894/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/690896823","html_url":"https://github.com/apache/couchdb/pull/3025#issuecomment-690896823","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3025","id":690896823,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MDg5NjgyMw==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-11T06:08:47Z","updated_at":"2020-09-11T06:08:47Z","author_association":"CONTRIBUTOR","body":"Thanks @dottorblaster for the review. \r\nI've added the @moduletag kind to these tests","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/690896823/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/691328718","html_url":"https://github.com/apache/couchdb/pull/3132#issuecomment-691328718","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3132","id":691328718,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MTMyODcxOA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-11T21:54:40Z","updated_at":"2020-09-11T21:54:40Z","author_association":"MEMBER","body":"+1 post-merge for the record (consent given on IRC)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/691328718/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/691340908","html_url":"https://github.com/apache/couchdb/pull/3148#issuecomment-691340908","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3148","id":691340908,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MTM0MDkwOA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-11T22:36:26Z","updated_at":"2020-09-11T22:36:26Z","author_association":"MEMBER","body":"Provisional +1, requesting a formal one after release - changes are ONLY to docs","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/691340908/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/691383987","html_url":"https://github.com/apache/couchdb/issues/3054#issuecomment-691383987","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3054","id":691383987,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MTM4Mzk4Nw==","user":{"login":"brendand","id":586075,"node_id":"MDQ6VXNlcjU4NjA3NQ==","avatar_url":"https://avatars.githubusercontent.com/u/586075?v=4","gravatar_id":"","url":"https://api.github.com/users/brendand","html_url":"https://github.com/brendand","followers_url":"https://api.github.com/users/brendand/followers","following_url":"https://api.github.com/users/brendand/following{/other_user}","gists_url":"https://api.github.com/users/brendand/gists{/gist_id}","starred_url":"https://api.github.com/users/brendand/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/brendand/subscriptions","organizations_url":"https://api.github.com/users/brendand/orgs","repos_url":"https://api.github.com/users/brendand/repos","events_url":"https://api.github.com/users/brendand/events{/privacy}","received_events_url":"https://api.github.com/users/brendand/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-12T02:14:53Z","updated_at":"2020-09-12T02:14:53Z","author_association":"NONE","body":"I have this issue too from my database app (and Safari and other browsers). I can't connect to CouchDB 3.1.0 over SSL using a self-signed (yet trusted) certificate. Neither from iOS, nor from macOS (Catalina and Big Sur).\r\n\r\nHowever, I can connect using curl. I don't know why it's not working in CouchDB 3.1.0, but it does with with CouchDB 2.3.1.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/691383987/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/692149333","html_url":"https://github.com/apache/couchdb/issues/3149#issuecomment-692149333","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3149","id":692149333,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MjE0OTMzMw==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-14T15:54:14Z","updated_at":"2020-09-14T15:54:14Z","author_association":"MEMBER","body":"We've never formally tested libmozjs-68 on aarch64, and have a conservative stance on whitelisting dependencies like this under the \"principle of least surprise.\"\r\n\r\nTo get this changed it would be best to run our test suite multiple times in a loop (`make check`) looking for any segmentation violation crashes of couchjs. If you want you can try overriding that line and running the test a few times, and let us know how it goes.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/692149333/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/692530962","html_url":"https://github.com/apache/couchdb/issues/3149#issuecomment-692530962","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3149","id":692530962,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MjUzMDk2Mg==","user":{"login":"lostnet","id":1422781,"node_id":"MDQ6VXNlcjE0MjI3ODE=","avatar_url":"https://avatars.githubusercontent.com/u/1422781?v=4","gravatar_id":"","url":"https://api.github.com/users/lostnet","html_url":"https://github.com/lostnet","followers_url":"https://api.github.com/users/lostnet/followers","following_url":"https://api.github.com/users/lostnet/following{/other_user}","gists_url":"https://api.github.com/users/lostnet/gists{/gist_id}","starred_url":"https://api.github.com/users/lostnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lostnet/subscriptions","organizations_url":"https://api.github.com/users/lostnet/orgs","repos_url":"https://api.github.com/users/lostnet/repos","events_url":"https://api.github.com/users/lostnet/events{/privacy}","received_events_url":"https://api.github.com/users/lostnet/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-15T07:43:02Z","updated_at":"2020-09-15T07:43:02Z","author_association":"CONTRIBUTOR","body":"Thanks @wohali, so far I've pulled in libcurl and run the make javascript part of the tests a few times. The tests still running there instead of in elixir didn't have any problems, so I'll look at bringing in any other dependencies and getting a full make check running in the next few days.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/692530962/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/692821860","html_url":"https://github.com/apache/couchdb/pull/3127#issuecomment-692821860","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3127","id":692821860,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MjgyMTg2MA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-15T16:16:29Z","updated_at":"2020-09-15T16:16:29Z","author_association":"MEMBER","body":"Updated the max size parameter to include bytes. Will merge when CI comes back green.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/692821860/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/693467378","html_url":"https://github.com/apache/couchdb/issues/3154#issuecomment-693467378","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3154","id":693467378,"node_id":"MDEyOklzc3VlQ29tbWVudDY5MzQ2NzM3OA==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-16T15:04:36Z","updated_at":"2020-09-16T15:04:36Z","author_association":"MEMBER","body":"You will have to install from source. We only officially release packages once Debian/Ubuntu/RedHat/CentOS officially release, not for releases in testing.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/693467378/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/694448784","html_url":"https://github.com/apache/couchdb/issues/3149#issuecomment-694448784","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3149","id":694448784,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NDQ0ODc4NA==","user":{"login":"lostnet","id":1422781,"node_id":"MDQ6VXNlcjE0MjI3ODE=","avatar_url":"https://avatars.githubusercontent.com/u/1422781?v=4","gravatar_id":"","url":"https://api.github.com/users/lostnet","html_url":"https://github.com/lostnet","followers_url":"https://api.github.com/users/lostnet/followers","following_url":"https://api.github.com/users/lostnet/following{/other_user}","gists_url":"https://api.github.com/users/lostnet/gists{/gist_id}","starred_url":"https://api.github.com/users/lostnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lostnet/subscriptions","organizations_url":"https://api.github.com/users/lostnet/orgs","repos_url":"https://api.github.com/users/lostnet/repos","events_url":"https://api.github.com/users/lostnet/events{/privacy}","received_events_url":"https://api.github.com/users/lostnet/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-17T19:26:09Z","updated_at":"2020-09-17T19:26:09Z","author_association":"CONTRIBUTOR","body":"I've created a repo of results from aarch64 and an x86_64 celeron for comparison [here](https://github.com/lostnet/couchdb-nix-debug) A vast majority of the noise in aarch64 tests seem to relate to a timeouts joining the cluster, etc. One involves a view test, but I don't see any SEGVs .or any coredumps occuring.\r\n\r\nI tried unblocking and testing 1.8.5 on nixos/aarch64 but I encounter a SIGSEGV during spidermonkey's own tests due to this [bug](https://bugzilla.mozilla.org/show_bug.cgi?id=1250400) which was fixed in spidermonkey_49 and don't see which 1.8.5 [debian patch](https://sources.debian.org/patches/mozjs/1.8.5-1.0.0+dfsg-6/) would be specific to this. (Perhaps the default debian kernel is not configured with CONFIG_ARM64_VA_BITS=48 as it is on the nixos kernel I am using.)\r\n\r\nThere might be a reason to prefer debian+aarch64+1.8.5 over other spidermonkey versions on debian, but I'm not seeing \r\nmuch reason to think 1.8.5 wont segfault more often than newer versions on anything that didn't incorporate all of debian's patches, kernel settings compiler choices(?) etc.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/694448784/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/694453389","html_url":"https://github.com/apache/couchdb/issues/3149#issuecomment-694453389","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3149","id":694453389,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NDQ1MzM4OQ==","user":{"login":"wohali","id":112292,"node_id":"MDQ6VXNlcjExMjI5Mg==","avatar_url":"https://avatars.githubusercontent.com/u/112292?v=4","gravatar_id":"","url":"https://api.github.com/users/wohali","html_url":"https://github.com/wohali","followers_url":"https://api.github.com/users/wohali/followers","following_url":"https://api.github.com/users/wohali/following{/other_user}","gists_url":"https://api.github.com/users/wohali/gists{/gist_id}","starred_url":"https://api.github.com/users/wohali/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wohali/subscriptions","organizations_url":"https://api.github.com/users/wohali/orgs","repos_url":"https://api.github.com/users/wohali/repos","events_url":"https://api.github.com/users/wohali/events{/privacy}","received_events_url":"https://api.github.com/users/wohali/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-17T19:31:48Z","updated_at":"2020-09-17T19:31:48Z","author_association":"MEMBER","body":"OK. This is coming in too late to adjust what we do for the 3.1.1 release (that's today) but I'll look at blacklisting just SM60 for aarch64 when I'm back from holiday, week of October 5.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/694453389/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/694535091","html_url":"https://github.com/apache/couchdb/issues/3149#issuecomment-694535091","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3149","id":694535091,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NDUzNTA5MQ==","user":{"login":"lostnet","id":1422781,"node_id":"MDQ6VXNlcjE0MjI3ODE=","avatar_url":"https://avatars.githubusercontent.com/u/1422781?v=4","gravatar_id":"","url":"https://api.github.com/users/lostnet","html_url":"https://github.com/lostnet","followers_url":"https://api.github.com/users/lostnet/followers","following_url":"https://api.github.com/users/lostnet/following{/other_user}","gists_url":"https://api.github.com/users/lostnet/gists{/gist_id}","starred_url":"https://api.github.com/users/lostnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lostnet/subscriptions","organizations_url":"https://api.github.com/users/lostnet/orgs","repos_url":"https://api.github.com/users/lostnet/repos","events_url":"https://api.github.com/users/lostnet/events{/privacy}","received_events_url":"https://api.github.com/users/lostnet/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-17T22:33:05Z","updated_at":"2020-09-17T22:33:05Z","author_association":"CONTRIBUTOR","body":"Sounds good, have a nice holiday!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/694535091/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/694551709","html_url":"https://github.com/apache/couchdb/issues/3160#issuecomment-694551709","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3160","id":694551709,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NDU1MTcwOQ==","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-17T23:23:00Z","updated_at":"2020-09-17T23:23:00Z","author_association":"CONTRIBUTOR","body":"I've got a proof of concept implementation separating out the scheduler and dirty scheduler run_queues in [1].\r\n\r\nThat PR uses the relatively new statistic call `statistics(run_queue_lengths)` which was introduced in OTP-18.3. This statistic returns a list of length N + 1 where N is the number of regular schedulers, and +1 is the currently fixed value of the number of dirty CPU schedulers in Erlang. You can see in the PR [1] that I'm using that data to also construct a new stat entry for the dirty CPU queue. We could use the even newer `statistics(run_queue_lengths_all)` statistic which returns a list of N + 2 for the N schedulers and the 2 dirty scheduler queues, however, Erlang does not yet use dirty IO NIFs for file IO, so that value will always be zero, and that function was introduced in OTP-20, and we still kinda sorta maybe tolerate OTP-19. I'm not opposed to requiring OTP-20, but there's not a big rush on this front as we don't use dirty IO schedulers yet.\r\n\r\nBtw, the PR is against 3.x, we'll want to have a separate PR for 4.x, which is why I'm adding the details here in the issue.\r\n\r\n[1] https://github.com/apache/couchdb/pull/3161\r\n[2] https://erlang.org/doc/man/erlang.html#statistics_run_queue_lengths\r\n[3] https://erlang.org/doc/man/erlang.html#statistics_run_queue_lengths_all","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/694551709/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/695003185","html_url":"https://github.com/apache/couchdb/issues/3160#issuecomment-695003185","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3160","id":695003185,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NTAwMzE4NQ==","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-18T17:51:55Z","updated_at":"2020-09-18T17:51:55Z","author_association":"CONTRIBUTOR","body":"I got confirmation in the Erlang bug report [1] that there is in fact a discrepancy between the documentation of `statistics(run_queue)` and the output, however, Rickard Green is of the opinion that it all the CPU run_queues should be aggregated together, which certainly has merits. This morning he merged a change to the maintenance branch updating the documentation to indicate `statistics(run_queue)` does _not_ exclude the dirty CPU queue.\r\n\r\nThat said, I don't think that's appropriate for our use case. I've replied to the ticket demonstrating a scenario where aggregating the normal and dirty CPU queues can obscure the meaning of `statistics(run_queue)`, especially for CouchDB where the scenarios of elevated normal run_queues are fundamentally different than that of an elevated dirty CPU queue (assuming you use a proxy for SSL termination).\r\n\r\nTherefore I remain of the opinion that it's important to separate the regular run_queue values from the dirty cpu run_queue. In the PR I linked above, I've already started going down that path using the `statistics(run_queue_lengths)` value, which is also much more efficient than what we've been doing, as `statistics(run_queue)` performs a lock on all run_queues to read from them, whereas the newer APIs do not lock. So we can switch to the new version that doesn't lock _and_ isolate these two data points as separate metrics.\r\n\r\n\r\n[1] https://bugs.erlang.org/browse/ERL-1355","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/695003185/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/695032560","html_url":"https://github.com/apache/couchdb/pull/3161#issuecomment-695032560","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3161","id":695032560,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NTAzMjU2MA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-18T18:55:21Z","updated_at":"2020-09-18T18:55:21Z","author_association":"MEMBER","body":"Why not do the version that includes the dirty CPU schedulers given that we're doing dirty IO schedulers?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/695032560/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/695085080","html_url":"https://github.com/apache/couchdb/pull/3073#issuecomment-695085080","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3073","id":695085080,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NTA4NTA4MA==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-18T21:03:06Z","updated_at":"2020-09-18T21:03:06Z","author_association":"MEMBER","body":"Closing in favor of #3164 ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/695085080/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/696320444","html_url":"https://github.com/apache/couchdb/pull/3161#issuecomment-696320444","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3161","id":696320444,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NjMyMDQ0NA==","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-21T19:22:47Z","updated_at":"2020-09-21T19:22:47Z","author_association":"CONTRIBUTOR","body":"> Why not do the version that includes the dirty CPU schedulers given that we're doing dirty IO schedulers?\r\n\r\n@davisp I'm assuming you meant the opposite, I'm using the version with dirty CPU schedulers since we're not using IO schedulers.\r\n\r\nMore to the point, I'm using `statistics(run_queue_lengths)` [1], which returns the list or normal scheduler queues followed by a single entry for the dirty CPU queue. This works for our immediate needs and what the PR does. There's also `statistics(run_queue_lengths_all)` [2] which returns the list of normal scheduler queues followed by an entry for the dirty CPU queue and another entry for the IO dirty queue.\r\n\r\nThere isn't any dirty IO in Erlang yet, and we're not using any either, so I didn't include that. I think it does make sense to report the dirty IO queues as Erlang will switch to using them at some point in the future, however, I did not do that in this PR as the `statistics(run_queue_lengths_all)` statistic didn't land until OTP-20, and we still have partial support for OTP-19.\r\nThe `statistics(run_queue_lengths)` statistic landed in OTP-18.3 so we're free to use that. I'm not opposed to using `statistics(run_queue_lengths_all)`, but if we're going to do that I think we should drop support for OTP-19 in the process.\r\n\r\n[1] http://erlang.org/doc/man/erlang.html#statistics_run_queue_lengths\r\n[2] http://erlang.org/doc/man/erlang.html#statistics_run_queue_lengths_all","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/696320444/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/696322179","html_url":"https://github.com/apache/couchdb/pull/3161#issuecomment-696322179","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3161","id":696322179,"node_id":"MDEyOklzc3VlQ29tbWVudDY5NjMyMjE3OQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-21T19:26:00Z","updated_at":"2020-09-21T19:26:00Z","author_association":"MEMBER","body":"That's fair. I didn't realize those two weren't released in the same version. I'm fine leaving it until we've moved our minimum version to 20.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/696322179/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/697759402","html_url":"https://github.com/apache/couchdb/issues/3160#issuecomment-697759402","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3160","id":697759402,"node_id":"MDEyOklzc3VlQ29tbWVudDY5Nzc1OTQwMg==","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-23T17:35:54Z","updated_at":"2020-09-23T17:35:54Z","author_association":"CONTRIBUTOR","body":"Alright, I've got two PRs out for the 3.x line and the main line:\r\n\r\nmain: https://github.com/apache/couchdb/pull/3168\r\n3.x: https://github.com/apache/couchdb/pull/3161","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/697759402/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/697973296","html_url":"https://github.com/apache/couchdb/issues/3160#issuecomment-697973296","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3160","id":697973296,"node_id":"MDEyOklzc3VlQ29tbWVudDY5Nzk3MzI5Ng==","user":{"login":"chewbranca","id":5326,"node_id":"MDQ6VXNlcjUzMjY=","avatar_url":"https://avatars.githubusercontent.com/u/5326?v=4","gravatar_id":"","url":"https://api.github.com/users/chewbranca","html_url":"https://github.com/chewbranca","followers_url":"https://api.github.com/users/chewbranca/followers","following_url":"https://api.github.com/users/chewbranca/following{/other_user}","gists_url":"https://api.github.com/users/chewbranca/gists{/gist_id}","starred_url":"https://api.github.com/users/chewbranca/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chewbranca/subscriptions","organizations_url":"https://api.github.com/users/chewbranca/orgs","repos_url":"https://api.github.com/users/chewbranca/repos","events_url":"https://api.github.com/users/chewbranca/events{/privacy}","received_events_url":"https://api.github.com/users/chewbranca/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-23T21:07:38Z","updated_at":"2020-09-23T21:07:38Z","author_association":"CONTRIBUTOR","body":"I've merged both PRs, and now the CouchDB run_queues statistic represents the same values as before, along with a new statistic for the dirty cpu queue. Closing this out.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/697973296/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698171177","html_url":"https://github.com/apache/couchdb/pull/3162#issuecomment-698171177","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3162","id":698171177,"node_id":"MDEyOklzc3VlQ29tbWVudDY5ODE3MTE3Nw==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-24T07:34:01Z","updated_at":"2020-09-24T07:34:01Z","author_association":"CONTRIBUTOR","body":"Thanks @dottorblaster!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698171177/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698201170","html_url":"https://github.com/apache/couchdb/pull/3173#issuecomment-698201170","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3173","id":698201170,"node_id":"MDEyOklzc3VlQ29tbWVudDY5ODIwMTE3MA==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-24T08:34:02Z","updated_at":"2020-09-24T08:34:02Z","author_association":"CONTRIBUTOR","body":"Thanks!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698201170/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698477906","html_url":"https://github.com/apache/couchdb/pull/3164#issuecomment-698477906","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3164","id":698477906,"node_id":"MDEyOklzc3VlQ29tbWVudDY5ODQ3NzkwNg==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-24T17:19:45Z","updated_at":"2020-09-24T17:19:45Z","author_association":"MEMBER","body":"@garrensmith I've updated things to use a `couch_views_trees` module for all the tree related functions. On using ebtree for the `id_tree` it simplifies things greatly as we don't have to maintain a separate set of encoding/decoding functions.\r\n\r\nI'll run through a 1M doc update again locally and post a link to the scripts and results. Last I checked it was roughly 2-5 times faster than the existing view implementation but I'll double check I've not messed anything up.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698477906/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698534759","html_url":"https://github.com/apache/couchdb/pull/3164#issuecomment-698534759","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3164","id":698534759,"node_id":"MDEyOklzc3VlQ29tbWVudDY5ODUzNDc1OQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-24T19:11:14Z","updated_at":"2020-09-24T19:11:14Z","author_association":"MEMBER","body":"For the reduce error test I'm working on a second PR that re-enables most of the Elixir test suite that now passes. This error is flagged there so we can keep track of it that way.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698534759/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698536935","html_url":"https://github.com/apache/couchdb/pull/3164#issuecomment-698536935","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3164","id":698536935,"node_id":"MDEyOklzc3VlQ29tbWVudDY5ODUzNjkzNQ==","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-24T19:16:06Z","updated_at":"2020-09-24T19:16:06Z","author_association":"CONTRIBUTOR","body":"@davisp that sounds good!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698536935/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698562881","html_url":"https://github.com/apache/couchdb/pull/3164#issuecomment-698562881","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3164","id":698562881,"node_id":"MDEyOklzc3VlQ29tbWVudDY5ODU2Mjg4MQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-24T20:09:14Z","updated_at":"2020-09-24T20:09:14Z","author_association":"MEMBER","body":"For reference, that PR is #3175 but has this PR branch as its base.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698562881/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698579086","html_url":"https://github.com/apache/couchdb/pull/3164#issuecomment-698579086","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3164","id":698579086,"node_id":"MDEyOklzc3VlQ29tbWVudDY5ODU3OTA4Ng==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-24T20:44:51Z","updated_at":"2020-09-24T20:44:51Z","author_association":"MEMBER","body":"These are three replicas building a simple view against 1M randomized documents. Each test is local to my laptop so take that for what its worth.\r\n\r\nmain: 7m40s, 8m40s, 9m8s\r\nfeature-ebtree-views: 8m46s, 9m36s, 8m47s\r\n\r\nI'm fairly surprised to see the main branch looking a bit faster with that first run at 7m40s. When we've run similar tests against FoundationDB clusters that version is significantly slower than the ebtree branch. My best guess at this point is that its due to touching a significantly larger number of fdb key/value pairs since each row is separate.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698579086/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698580665","html_url":"https://github.com/apache/couchdb/pull/3164#issuecomment-698580665","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3164","id":698580665,"node_id":"MDEyOklzc3VlQ29tbWVudDY5ODU4MDY2NQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-24T20:48:32Z","updated_at":"2020-09-24T20:48:32Z","author_association":"MEMBER","body":"Also, the scripts for generating those numbers are here:\r\n\r\nhttps://gist.github.com/davisp/3863ab02fb5def733f1a6991651840f9","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698580665/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698725027","html_url":"https://github.com/apache/couchdb/pull/3164#issuecomment-698725027","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3164","id":698725027,"node_id":"MDEyOklzc3VlQ29tbWVudDY5ODcyNTAyNw==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-25T05:17:36Z","updated_at":"2020-09-25T05:32:59Z","author_association":"MEMBER","body":"I did a quick group_level benchmarking this morning to compare it to the map + ebtree work I built-in #3018. The benchmark builds a view with keys that are a group_level = 3. Group_levels 1 and 2 will group results. \r\n\r\nOne thing to note is that the ebtree in #3018 is a much older version and doesn't caching or the batch updates.\r\n\r\nThe full ebtree builds a lot faster, which is great. And queries for group_level = 1 and group_level = 2 are very similar. But when doing a reduce query for group_level = 3 the full ebtree is noticeably slower.\r\n\r\nExample results for 300K docs:\r\nfull ebtree (this PR):\r\n```\r\nInsert Time  71435.896557 ms\r\nQuerying:\r\nGroup 1 Time 12.577319 ms\r\nResult Length 5\r\nGroup 2 Time 20.666643 ms\r\nResult Length 20\r\nGroup 3 Time 3712.46744 ms\r\nResult Length 300002\r\n```\r\n\r\nMap + ebtree reduce (PR #3018):\r\n```\r\nInsert Time  362359.221368 ms\r\nQuerying:\r\nGroup 1 Time 13.821064 ms\r\nResult Length 5\r\nGroup 2 Time 23.708709 ms\r\nResult Length 20\r\nGroup 3 Time 2672.549299 ms\r\nResult Length 300002\r\n```\r\n\r\nCode for the benchmarking is here https://gist.github.com/garrensmith/9bd090cb00f6b641e58a3c490b2300e7\r\nSame warning as Paul's this is run locally on my machine. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698725027/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698778159","html_url":"https://github.com/apache/couchdb/issues/3176#issuecomment-698778159","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3176","id":698778159,"node_id":"MDEyOklzc3VlQ29tbWVudDY5ODc3ODE1OQ==","user":{"login":"jmichiel","id":194387,"node_id":"MDQ6VXNlcjE5NDM4Nw==","avatar_url":"https://avatars.githubusercontent.com/u/194387?v=4","gravatar_id":"","url":"https://api.github.com/users/jmichiel","html_url":"https://github.com/jmichiel","followers_url":"https://api.github.com/users/jmichiel/followers","following_url":"https://api.github.com/users/jmichiel/following{/other_user}","gists_url":"https://api.github.com/users/jmichiel/gists{/gist_id}","starred_url":"https://api.github.com/users/jmichiel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jmichiel/subscriptions","organizations_url":"https://api.github.com/users/jmichiel/orgs","repos_url":"https://api.github.com/users/jmichiel/repos","events_url":"https://api.github.com/users/jmichiel/events{/privacy}","received_events_url":"https://api.github.com/users/jmichiel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-25T07:44:32Z","updated_at":"2020-09-25T07:47:26Z","author_association":"NONE","body":"And just after posting, I immediately spotted my own stupid mistake the role in the JWT is 'firmwares.viewer' and not 'firmwares:viewer'... (my JWT generation code was still hard-coded at that point). I spent over an hour looking at my code yesterday and couldn't find anything wrong with it...\r\nSorry about that, feel free to delete","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/698778159/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/699381248","html_url":"https://github.com/apache/couchdb/issues/2203#issuecomment-699381248","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2203","id":699381248,"node_id":"MDEyOklzc3VlQ29tbWVudDY5OTM4MTI0OA==","user":{"login":"fangq","id":226913,"node_id":"MDQ6VXNlcjIyNjkxMw==","avatar_url":"https://avatars.githubusercontent.com/u/226913?v=4","gravatar_id":"","url":"https://api.github.com/users/fangq","html_url":"https://github.com/fangq","followers_url":"https://api.github.com/users/fangq/followers","following_url":"https://api.github.com/users/fangq/following{/other_user}","gists_url":"https://api.github.com/users/fangq/gists{/gist_id}","starred_url":"https://api.github.com/users/fangq/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/fangq/subscriptions","organizations_url":"https://api.github.com/users/fangq/orgs","repos_url":"https://api.github.com/users/fangq/repos","events_url":"https://api.github.com/users/fangq/events{/privacy}","received_events_url":"https://api.github.com/users/fangq/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-26T04:28:57Z","updated_at":"2020-09-26T04:28:57Z","author_association":"NONE","body":"I am interested in developing couchdb/nosql databases for storing hierarchical scientific data - for example, imaging data of different binary types, dimensions, with/without compression - I've developed specifications to enable JSON to encode common scientific data structures (http://openjdata.org/, https://github.com/fangq/jdata/blob/master/JData_specification.md#data-annotation-keywords), but to support binary strongly-typed data, I need to use base64 with JSON, which increases the data file size by ~33%.\r\n\r\nTo mitigate this, I extended the UBJSON spec (https://ubjson.org/) to support binary data types, see Binary JData (BJData) spec\r\n\r\nhttps://github.com/fangq/bjdata/blob/master/Binary_JData_Specification.md#type_summary\r\n\r\nBJData is similar MessagePack/CBOR, but much simpler to encode/decode, and is also quasi-human-readable, despite being a binary format. I will be very happy to contribute if there is an interest to support BJData/UBJSON in CouchDB. I currently have a [MATLAB ](https://github.com/fangq/jsonlab)and a Python parser/writer (https://github.com/fangq/pybj, based on py-ubjson, includes both native python code and c-code).\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/699381248/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":1,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/699716401","html_url":"https://github.com/apache/couchdb/issues/2348#issuecomment-699716401","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2348","id":699716401,"node_id":"MDEyOklzc3VlQ29tbWVudDY5OTcxNjQwMQ==","user":{"login":"kierondye-git","id":20525494,"node_id":"MDQ6VXNlcjIwNTI1NDk0","avatar_url":"https://avatars.githubusercontent.com/u/20525494?v=4","gravatar_id":"","url":"https://api.github.com/users/kierondye-git","html_url":"https://github.com/kierondye-git","followers_url":"https://api.github.com/users/kierondye-git/followers","following_url":"https://api.github.com/users/kierondye-git/following{/other_user}","gists_url":"https://api.github.com/users/kierondye-git/gists{/gist_id}","starred_url":"https://api.github.com/users/kierondye-git/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kierondye-git/subscriptions","organizations_url":"https://api.github.com/users/kierondye-git/orgs","repos_url":"https://api.github.com/users/kierondye-git/repos","events_url":"https://api.github.com/users/kierondye-git/events{/privacy}","received_events_url":"https://api.github.com/users/kierondye-git/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-28T00:59:38Z","updated_at":"2020-09-28T00:59:38Z","author_association":"NONE","body":"I know this is 9 months down the line but I thought it would be fair to give an update on this. As a workaround we put code into our deployment pipeline to prevent views being deployed if they had not been changed. Given that PUTting a view document causes the revision to change regardless of whether the rest of the document has we guessed that this changes the hash and causes the re-indexing. We are still having trouble working out what causes major re-indexing to occur but our problems are probably by design. Thanks for your response @davisp and apologies for the slow update.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/699716401/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700147946","html_url":"https://github.com/apache/couchdb/pull/3164#issuecomment-700147946","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3164","id":700147946,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMDE0Nzk0Ng==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-28T16:37:21Z","updated_at":"2020-09-28T16:37:21Z","author_association":"MEMBER","body":"@garrensmith That seems reasonably close. I'd suspect that the difference there is likely the number of times that ebtree-only has to call out to the reduce function to process individual groups. Though 80k rows/sec vs 110k rows/sec is honestly a bit surprising given that we're running the reduce function 300k times roughly.\r\n\r\nAre you concerned about the difference there? It seems not a deal breaker given that the full ebtree PR supports 100% API compatibility for reduce functions rather than just pre-specified group levels.\r\n ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700147946/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700200832","html_url":"https://github.com/apache/couchdb/pull/3164#issuecomment-700200832","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3164","id":700200832,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMDIwMDgzMg==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-28T18:18:11Z","updated_at":"2020-09-28T18:18:11Z","author_association":"MEMBER","body":"Hi Paul,\n\nThat isnt correct. The benchmark is with my branch that uses ebtree for reduce along with the old map index. So it also supports the full reduce api. I found it surprising that it was faster than this PR specially since it uses a much older version of ebtree. I think it would be worth investigating why this work is slower than my PR.\n\n________________________________\nFrom: Paul J. Davis <notifications@github.com>\nSent: Monday, September 28, 2020 6:37:36 PM\nTo: apache/couchdb <couchdb@noreply.github.com>\nCc: garren smith <garren.smith@gmail.com>; Mention <mention@noreply.github.com>\nSubject: Re: [apache/couchdb] Feature ebtree views (#3164)\n\n\n@garrensmith<https://github.com/garrensmith> That seems reasonably close. I'd suspect that the difference there is likely the number of times that ebtree-only has to call out to the reduce function to process individual groups. Though 80k rows/sec vs 110k rows/sec is honestly a bit surprising given that we're running the reduce function 300k times roughly.\n\nAre you concerned about the difference there? It seems not a deal breaker given that the full ebtree PR supports 100% API compatibility for reduce functions rather than just pre-specified group levels.\n\n—\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub<https://github.com/apache/couchdb/pull/3164#issuecomment-700147946>, or unsubscribe<https://github.com/notifications/unsubscribe-auth/AABL2AWHBLMDV55TTBQXRTDSIC3VBANCNFSM4RSQN3FQ>.\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700200832/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700265839","html_url":"https://github.com/apache/couchdb/pull/3164#issuecomment-700265839","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3164","id":700265839,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMDI2NTgzOQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-28T20:32:50Z","updated_at":"2020-09-28T20:32:50Z","author_association":"MEMBER","body":"Oh derps. I was thinking of the pre-computed group levels. Somewhat intriguing. I'll investigate tomorrow and post back.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700265839/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700490939","html_url":"https://github.com/apache/couchdb/pull/3178#issuecomment-700490939","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3178","id":700490939,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMDQ5MDkzOQ==","user":{"login":"dottorblaster","id":20770,"node_id":"MDQ6VXNlcjIwNzcw","avatar_url":"https://avatars.githubusercontent.com/u/20770?v=4","gravatar_id":"","url":"https://api.github.com/users/dottorblaster","html_url":"https://github.com/dottorblaster","followers_url":"https://api.github.com/users/dottorblaster/followers","following_url":"https://api.github.com/users/dottorblaster/following{/other_user}","gists_url":"https://api.github.com/users/dottorblaster/gists{/gist_id}","starred_url":"https://api.github.com/users/dottorblaster/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dottorblaster/subscriptions","organizations_url":"https://api.github.com/users/dottorblaster/orgs","repos_url":"https://api.github.com/users/dottorblaster/repos","events_url":"https://api.github.com/users/dottorblaster/events{/privacy}","received_events_url":"https://api.github.com/users/dottorblaster/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-29T06:55:14Z","updated_at":"2020-09-29T06:55:14Z","author_association":"MEMBER","body":"We already did a bit of categorization with @iilyak, `:cluster` and `:single_node` for example were meant for that purpose 😅 Maybe we need to put up a stronger naming convention?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700490939/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700501397","html_url":"https://github.com/apache/couchdb/pull/3178#issuecomment-700501397","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3178","id":700501397,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMDUwMTM5Nw==","user":{"login":"jiangphcn","id":18000622,"node_id":"MDQ6VXNlcjE4MDAwNjIy","avatar_url":"https://avatars.githubusercontent.com/u/18000622?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangphcn","html_url":"https://github.com/jiangphcn","followers_url":"https://api.github.com/users/jiangphcn/followers","following_url":"https://api.github.com/users/jiangphcn/following{/other_user}","gists_url":"https://api.github.com/users/jiangphcn/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangphcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangphcn/subscriptions","organizations_url":"https://api.github.com/users/jiangphcn/orgs","repos_url":"https://api.github.com/users/jiangphcn/repos","events_url":"https://api.github.com/users/jiangphcn/events{/privacy}","received_events_url":"https://api.github.com/users/jiangphcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-29T07:18:25Z","updated_at":"2020-09-29T07:18:25Z","author_association":"CONTRIBUTOR","body":"The `kind` related tag is still kept. We just want to add new module tags to give fine-grained classification for elixir test cases.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700501397/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700517218","html_url":"https://github.com/apache/couchdb/pull/3174#issuecomment-700517218","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3174","id":700517218,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMDUxNzIxOA==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-29T07:49:44Z","updated_at":"2020-09-29T07:49:44Z","author_association":"CONTRIBUTOR","body":"Thanks!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700517218/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700763385","html_url":"https://github.com/apache/couchdb/pull/3178#issuecomment-700763385","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3178","id":700763385,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMDc2MzM4NQ==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-29T14:57:27Z","updated_at":"2020-09-29T14:57:27Z","author_association":"CONTRIBUTOR","body":"I've noticed that most of the tags in this PR ended up to be unique ones. The only exceptions is `docs` which I bet used somewhere else. This means the granularity level is a single module. I am not sure it useful to do it by module. We can run tests for a single module already. We also can run tests for list of modules as well:\r\n\r\n```\r\nmake elixir tests=test/elixir/test/basics_test.exs,test/elixir/test/replication_test.exs,test/elixir/test/map_test.exs,test/elixir/test/all_docs_test.exs,test/elixir/test/bulk_docs_test.exs\r\n```\r\n\r\nI think the better grouping would be based on the big features of CouchDB we intend to test. Let's say a developer is updating the view engine. In this case he/she would be interested in running all tests for view functionality. Because changes in that area might break related functionality. So I propose to look at tagging using following heuristics (just an idea and subject for discussion):\r\n\r\n- tag which is set on a single module is an exception not a norm\r\n- think about what component (or feature) of CouchDB given module tests to come up with a tag\r\n  - we can use cover information to assist as initially but it could be an overkill\r\n- determine where (in which erlang application) the endpoint we test from given test module is handled and tag after application name (`mango`, `mem3`, `setup`, `deyfus`)\r\n    ```\r\n    find src/ -name '*_httpd_handlers.erl' | xargs grep '_handler(' | grep -v no_match |  cut -d':' -f2\r\n    url_handler(<<\"_membership\">>) -> fun mem3_httpd\r\n    url_handler(<<\"_reshard\">>) -> fun mem3_reshard_httpd\r\n    db_handler(<<\"_shards\">>) -> fun mem3_httpd\r\n    db_handler(<<\"_sync_shards\">>)   -> fun mem3_httpd\r\n    url_handler(<<\"_cluster_setup\">>) -> fun setup_httpd\r\n    db_handler(<<\"_index\">>)        -> fun mango_httpd\r\n    db_handler(<<\"_explain\">>)      -> fun mango_httpd\r\n    db_handler(<<\"_find\">>)         -> fun mango_httpd\r\n    db_handler(<<\"_index\">>)        -> fun mango_httpd\r\n    db_handler(<<\"_explain\">>)      -> fun mango_httpd\r\n    db_handler(<<\"_find\">>)         -> fun mango_httpd\r\n    url_handler(<<\"_search_analyze\">>) -> fun dreyfus_httpd\r\n    db_handler(<<\"_search_cleanup\">>)  -> fun dreyfus_httpd\r\n    design_handler(<<\"_search\">>)      -> fun dreyfus_httpd\r\n    design_handler(<<\"_search_info\">>) -> fun dreyfus_httpd\r\n    ...\r\n    ```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700763385/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700766752","html_url":"https://github.com/apache/couchdb/pull/3178#issuecomment-700766752","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3178","id":700766752,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMDc2Njc1Mg==","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-29T15:02:11Z","updated_at":"2020-09-29T15:02:11Z","author_association":"CONTRIBUTOR","body":"JFYI: It is also possible to run individual tests within the module\r\n\r\n```\r\nmake elixir tests=test/elixir/test/basics_test.exs:155\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700766752/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700982451","html_url":"https://github.com/apache/couchdb/pull/3164#issuecomment-700982451","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3164","id":700982451,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMDk4MjQ1MQ==","user":{"login":"davisp","id":19929,"node_id":"MDQ6VXNlcjE5OTI5","avatar_url":"https://avatars.githubusercontent.com/u/19929?v=4","gravatar_id":"","url":"https://api.github.com/users/davisp","html_url":"https://github.com/davisp","followers_url":"https://api.github.com/users/davisp/followers","following_url":"https://api.github.com/users/davisp/following{/other_user}","gists_url":"https://api.github.com/users/davisp/gists{/gist_id}","starred_url":"https://api.github.com/users/davisp/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/davisp/subscriptions","organizations_url":"https://api.github.com/users/davisp/orgs","repos_url":"https://api.github.com/users/davisp/repos","events_url":"https://api.github.com/users/davisp/events{/privacy}","received_events_url":"https://api.github.com/users/davisp/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-29T20:58:17Z","updated_at":"2020-09-29T20:59:07Z","author_association":"MEMBER","body":"@garrensmith A bit of profiling showed that I was doing a bit of extra work compared to #3018 so there were a few simple optimizations to be made. Namely:\r\n\r\n1. Avoid calculating unused reductions while reading from a reduce view (coincidentally an optimization that exists even in the legacy view engine)\r\n2. Avoid some extra work in couch_query_servers that I re-used instead of duplicating the functionality in this PR.\r\n\r\nFor 1, the #3018 PR achieves this same end by having a separate ebtree instance for each reduce function on the view. For 2, its similar other than the size calculation is done at write time.\r\n\r\n![Screen Shot 2020-09-29 at 3 18 02 PM](https://user-images.githubusercontent.com/19929/94612436-b7e49f80-0268-11eb-97e1-549b8b5ec80b.png)\r\n\r\nUpdated numbers generated locally. I ported the Node.js script to Python [1] and removed deleting the database part. I then ran it four times. Once to generate the index, and then three times to gather numbers after everything was warmed up in cache to try and get an equal footing for each replica.\r\n\r\nThere's still about 200ms difference between the two implementations. However, based on profiling both implementations it would appear that a good chunk of that is due to #3018 performing significantly fewer invocations of collation which is a bug in a previous version of ebtree that has since been fixed [2]. I also went fixed the lack of JSON collation in #3018 [3] and that appears to have made it faster.\r\n\r\nI'm fairly confident I've covered the differences given the similar algorithmic properties of the implementations. Let me know if you're OK merging this now.\r\n\r\n[1] https://gist.github.com/davisp/48303dcd877b31632fb75055d6758129\r\n[2] https://github.com/apache/couchdb/commit/f8fdf9721e2ac932022065bc075301641568d67c\r\n[3] https://github.com/cloudant/couchdb/compare/fdb-btree-reduce...apache:fdb-btree-reduce-davisp","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/700982451/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/701205975","html_url":"https://github.com/apache/couchdb/pull/3164#issuecomment-701205975","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3164","id":701205975,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMTIwNTk3NQ==","user":{"login":"garrensmith","id":179458,"node_id":"MDQ6VXNlcjE3OTQ1OA==","avatar_url":"https://avatars.githubusercontent.com/u/179458?v=4","gravatar_id":"","url":"https://api.github.com/users/garrensmith","html_url":"https://github.com/garrensmith","followers_url":"https://api.github.com/users/garrensmith/followers","following_url":"https://api.github.com/users/garrensmith/following{/other_user}","gists_url":"https://api.github.com/users/garrensmith/gists{/gist_id}","starred_url":"https://api.github.com/users/garrensmith/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/garrensmith/subscriptions","organizations_url":"https://api.github.com/users/garrensmith/orgs","repos_url":"https://api.github.com/users/garrensmith/repos","events_url":"https://api.github.com/users/garrensmith/events{/privacy}","received_events_url":"https://api.github.com/users/garrensmith/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-30T07:13:23Z","updated_at":"2020-09-30T07:13:23Z","author_association":"MEMBER","body":"Nice work. Thanks for checking that. I’m away until next week so I can’t give a final review until then. I can’t remember if anyone else has approved this or not. If they have then go ahead and merge.\n\n________________________________\nFrom: Paul J. Davis <notifications@github.com>\nSent: Tuesday, September 29, 2020 10:58:32 PM\nTo: apache/couchdb <couchdb@noreply.github.com>\nCc: garren smith <garren.smith@gmail.com>; Mention <mention@noreply.github.com>\nSubject: Re: [apache/couchdb] Feature ebtree views (#3164)\n\n\n@garrensmith<https://github.com/garrensmith> A bit of profiling showed that I was doing a bit of extra work compared to #3018<https://github.com/apache/couchdb/pull/3018> so there were a few simple optimizations to be made. Namely:\n\n  1.  Avoid calculating unused reductions while reading from a reduce view (coincidentally an optimization that exists even in the legacy view engine\n  2.  Avoid some extra work in couch_query_servers that I re-used instead of duplicating the functionality of this PR.\n\nFor 1, the #3018<https://github.com/apache/couchdb/pull/3018> PR achieves this same end by having a separate ebtree instance for each reduce function on the view. For 2, its similar other than the size calculation is done on at write time.\n\n[Screen Shot 2020-09-29 at 3 18 02 PM]<https://user-images.githubusercontent.com/19929/94612436-b7e49f80-0268-11eb-97e1-549b8b5ec80b.png>\n\nUpdated numbers generated locally. I ported the Node.js script to Python [1] and removed deleting the database part. I then ran it four times. Once to generate the index, and then three times to gather numbers after everything was warmed up in cache to try and get an equal footing for each replica.\n\nThere's still about 200ms difference between the two implementations. However, based on profiling both implementations it would appear that a good chunk of that is due to #3018<https://github.com/apache/couchdb/pull/3018> performing significantly fewer invocations of collation which is a bug in a previous version of ebtree that has since been fixed [2]. I also went fixed the lack of JSON collation in #3018<https://github.com/apache/couchdb/pull/3018> [3] and that appears to have made it faster.\n\nI'm fairly confident I've covered the differences given the similar algorithmic properties of the implementations. Let me know if you're OK merging this now.\n\n[1] https://gist.github.com/davisp/48303dcd877b31632fb75055d6758129\n[2] f8fdf97<https://github.com/apache/couchdb/commit/f8fdf9721e2ac932022065bc075301641568d67c>\n[3] cloudant/couchdb@fdb-btree-reduce...apache:fdb-btree-reduce-davisp<https://github.com/cloudant/couchdb/compare/fdb-btree-reduce...apache:fdb-btree-reduce-davisp>\n\n—\nYou are receiving this because you were mentioned.\nReply to this email directly, view it on GitHub<https://github.com/apache/couchdb/pull/3164#issuecomment-700982451>, or unsubscribe<https://github.com/notifications/unsubscribe-auth/AABL2AREMBWCDZ7B4AFEHSLSIJC7RANCNFSM4RSQN3FQ>.\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/701205975/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/701391468","html_url":"https://github.com/apache/couchdb/issues/3181#issuecomment-701391468","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3181","id":701391468,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMTM5MTQ2OA==","user":{"login":"SinanGabel","id":5586130,"node_id":"MDQ6VXNlcjU1ODYxMzA=","avatar_url":"https://avatars.githubusercontent.com/u/5586130?v=4","gravatar_id":"","url":"https://api.github.com/users/SinanGabel","html_url":"https://github.com/SinanGabel","followers_url":"https://api.github.com/users/SinanGabel/followers","following_url":"https://api.github.com/users/SinanGabel/following{/other_user}","gists_url":"https://api.github.com/users/SinanGabel/gists{/gist_id}","starred_url":"https://api.github.com/users/SinanGabel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SinanGabel/subscriptions","organizations_url":"https://api.github.com/users/SinanGabel/orgs","repos_url":"https://api.github.com/users/SinanGabel/repos","events_url":"https://api.github.com/users/SinanGabel/events{/privacy}","received_events_url":"https://api.github.com/users/SinanGabel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-30T13:29:44Z","updated_at":"2020-09-30T13:29:44Z","author_association":"NONE","body":"It must be \"Secure\" too.\n\nThis you can set via a proxy web server (nginx or another).\n\nFor nginx you can use the below where the first line solves the\nsamsite=none problem:\n\nproxy_cookie_path / \"/; HTTPOnly; Secure\";\n\n    # couchdb\n    location ~ ^/(.*)/_changes {\n        proxy_pass http://couchdb_node;\n        proxy_redirect off;\n        # Transfer-Encoding: chunked\n        proxy_buffering off;\n        proxy_set_header Host $host;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Ssl on;\n    }\n\n    location / {\n        proxy_pass http://couchdb_node;\n        proxy_redirect off;\n        proxy_set_header Host $host;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Ssl on;\n    }\n\n\n\nOn Wed, 30 Sep 2020 at 14:09, grapevineai <notifications@github.com> wrote:\n\n> Description\n>\n> If the configuration [couch_httpd_auth] same_site is set to \"none\", the\n> cookie is not saved in the browser. Sessions become unusable.\n> Steps to Reproduce\n>\n>    - Set [couch_httpd_auth] same_site=none\n>    - Try to login to Fauxton through the /_utils endpoint\n>\n> Expected Behaviour\n>\n> The cookie should be kept in the browser and the sessions should work\n> Your Environment\n>\n>    - CouchDB version used: 3.1.1\n>    - Browser name and version: Chrome 85.0.4183.121\n>    - Operating system and version: OSX\n>\n> Additional Context\n>\n> —\n> You are receiving this because you are subscribed to this thread.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/apache/couchdb/issues/3181>, or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/ABKTZUU2VR6GTYIOSR23BHTSIMNWRANCNFSM4R7AFYXQ>\n> .\n>\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/701391468/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/701438276","html_url":"https://github.com/apache/couchdb/issues/3181#issuecomment-701438276","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3181","id":701438276,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMTQzODI3Ng==","user":{"login":"rileyai-dev","id":28606840,"node_id":"MDQ6VXNlcjI4NjA2ODQw","avatar_url":"https://avatars.githubusercontent.com/u/28606840?v=4","gravatar_id":"","url":"https://api.github.com/users/rileyai-dev","html_url":"https://github.com/rileyai-dev","followers_url":"https://api.github.com/users/rileyai-dev/followers","following_url":"https://api.github.com/users/rileyai-dev/following{/other_user}","gists_url":"https://api.github.com/users/rileyai-dev/gists{/gist_id}","starred_url":"https://api.github.com/users/rileyai-dev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rileyai-dev/subscriptions","organizations_url":"https://api.github.com/users/rileyai-dev/orgs","repos_url":"https://api.github.com/users/rileyai-dev/repos","events_url":"https://api.github.com/users/rileyai-dev/events{/privacy}","received_events_url":"https://api.github.com/users/rileyai-dev/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-30T14:45:27Z","updated_at":"2020-09-30T14:45:27Z","author_association":"NONE","body":"Thanks, I will try that... but shouldn't it work out of the box? If it shouldn't then we should add this information to the doc. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/701438276/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/701450231","html_url":"https://github.com/apache/couchdb/pull/3178#issuecomment-701450231","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3178","id":701450231,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMTQ1MDIzMQ==","user":{"login":"jiangphcn","id":18000622,"node_id":"MDQ6VXNlcjE4MDAwNjIy","avatar_url":"https://avatars.githubusercontent.com/u/18000622?v=4","gravatar_id":"","url":"https://api.github.com/users/jiangphcn","html_url":"https://github.com/jiangphcn","followers_url":"https://api.github.com/users/jiangphcn/followers","following_url":"https://api.github.com/users/jiangphcn/following{/other_user}","gists_url":"https://api.github.com/users/jiangphcn/gists{/gist_id}","starred_url":"https://api.github.com/users/jiangphcn/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jiangphcn/subscriptions","organizations_url":"https://api.github.com/users/jiangphcn/orgs","repos_url":"https://api.github.com/users/jiangphcn/repos","events_url":"https://api.github.com/users/jiangphcn/events{/privacy}","received_events_url":"https://api.github.com/users/jiangphcn/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-09-30T15:04:40Z","updated_at":"2020-09-30T15:04:40Z","author_association":"CONTRIBUTOR","body":"thanks to all of you, @dottorblaster, @jjrodrig and @iilyak. Let me merge for now and we can make further classification later.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/701450231/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702116240","html_url":"https://github.com/apache/couchdb/pull/3179#issuecomment-702116240","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3179","id":702116240,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMjExNjI0MA==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-01T12:57:49Z","updated_at":"2020-10-01T12:57:49Z","author_association":"CONTRIBUTOR","body":"Thanks!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702116240/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702140502","html_url":"https://github.com/apache/couchdb/pull/3180#issuecomment-702140502","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3180","id":702140502,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMjE0MDUwMg==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-01T13:37:00Z","updated_at":"2020-10-01T13:37:00Z","author_association":"CONTRIBUTOR","body":"Thanks @dottorblaster! We're near to switch off the javascript test suite","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702140502/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702332032","html_url":"https://github.com/apache/couchdb/issues/3181#issuecomment-702332032","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3181","id":702332032,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMjMzMjAzMg==","user":{"login":"rileyai-dev","id":28606840,"node_id":"MDQ6VXNlcjI4NjA2ODQw","avatar_url":"https://avatars.githubusercontent.com/u/28606840?v=4","gravatar_id":"","url":"https://api.github.com/users/rileyai-dev","html_url":"https://github.com/rileyai-dev","followers_url":"https://api.github.com/users/rileyai-dev/followers","following_url":"https://api.github.com/users/rileyai-dev/following{/other_user}","gists_url":"https://api.github.com/users/rileyai-dev/gists{/gist_id}","starred_url":"https://api.github.com/users/rileyai-dev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rileyai-dev/subscriptions","organizations_url":"https://api.github.com/users/rileyai-dev/orgs","repos_url":"https://api.github.com/users/rileyai-dev/repos","events_url":"https://api.github.com/users/rileyai-dev/events{/privacy}","received_events_url":"https://api.github.com/users/rileyai-dev/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-01T18:53:55Z","updated_at":"2020-10-01T18:53:55Z","author_association":"NONE","body":"I have tried to add `proxy_cookie_path / \"/; HTTPOnly; Secure\";` to nginx but it doesn't solve the issue.\r\n\r\nCan someone explain to me why \"none\" is not working out of the box while \"strict\" and \"lax\" do? Is it a bug or a is it something we should add to the documentation?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702332032/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702378464","html_url":"https://github.com/apache/couchdb/issues/3181#issuecomment-702378464","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3181","id":702378464,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMjM3ODQ2NA==","user":{"login":"SinanGabel","id":5586130,"node_id":"MDQ6VXNlcjU1ODYxMzA=","avatar_url":"https://avatars.githubusercontent.com/u/5586130?v=4","gravatar_id":"","url":"https://api.github.com/users/SinanGabel","html_url":"https://github.com/SinanGabel","followers_url":"https://api.github.com/users/SinanGabel/followers","following_url":"https://api.github.com/users/SinanGabel/following{/other_user}","gists_url":"https://api.github.com/users/SinanGabel/gists{/gist_id}","starred_url":"https://api.github.com/users/SinanGabel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SinanGabel/subscriptions","organizations_url":"https://api.github.com/users/SinanGabel/orgs","repos_url":"https://api.github.com/users/SinanGabel/repos","events_url":"https://api.github.com/users/SinanGabel/events{/privacy}","received_events_url":"https://api.github.com/users/SinanGabel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-01T20:27:18Z","updated_at":"2020-10-01T20:27:18Z","author_association":"NONE","body":"Set-Cookie: flavor=choco; SameSite=None\n\nIs probably what you have now (exchange [flavor=choco] to what you are\nsetting).\n\nThe single line in the nginx configuration does adds the following in bold\nto the line (if you have set up things correctly):\n\nSet-Cookie: flavor=choco; SameSite=None; *HTTPOnly; **Secure*\n\nHere's what my browser is showing in the Network part.\n[image: image.png]\nHere's one reference:\n\nhttps://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite\n\n\n\nOn Thu, 1 Oct 2020 at 20:54, grapevineai <notifications@github.com> wrote:\n\n> I have tried to add proxy_cookie_path / \"/; HTTPOnly; Secure\"; to nginx\n> but it doesn't solve the issue.\n>\n> Can someone explain to me why \"none\" is not working out of the box while\n> \"strict\" and \"lax\" do? Is it a bug or a is it something we should add to\n> the documentation?\n>\n> —\n> You are receiving this because you commented.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/apache/couchdb/issues/3181#issuecomment-702332032>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/ABKTZUUWHXUIR6HNYO5P3A3SITF5FANCNFSM4R7AFYXQ>\n> .\n>\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702378464/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702380147","html_url":"https://github.com/apache/couchdb/pull/3187#issuecomment-702380147","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3187","id":702380147,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMjM4MDE0Nw==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-01T20:30:25Z","updated_at":"2020-10-01T20:30:25Z","author_association":"CONTRIBUTOR","body":"Thanks!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702380147/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702615445","html_url":"https://github.com/apache/couchdb/issues/3181#issuecomment-702615445","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3181","id":702615445,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMjYxNTQ0NQ==","user":{"login":"rileyai-dev","id":28606840,"node_id":"MDQ6VXNlcjI4NjA2ODQw","avatar_url":"https://avatars.githubusercontent.com/u/28606840?v=4","gravatar_id":"","url":"https://api.github.com/users/rileyai-dev","html_url":"https://github.com/rileyai-dev","followers_url":"https://api.github.com/users/rileyai-dev/followers","following_url":"https://api.github.com/users/rileyai-dev/following{/other_user}","gists_url":"https://api.github.com/users/rileyai-dev/gists{/gist_id}","starred_url":"https://api.github.com/users/rileyai-dev/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rileyai-dev/subscriptions","organizations_url":"https://api.github.com/users/rileyai-dev/orgs","repos_url":"https://api.github.com/users/rileyai-dev/repos","events_url":"https://api.github.com/users/rileyai-dev/events{/privacy}","received_events_url":"https://api.github.com/users/rileyai-dev/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-02T09:07:28Z","updated_at":"2020-10-02T09:07:53Z","author_association":"NONE","body":"@SinanGabel I'm confused... IMHO, CouchDB should automatically handle this! Putting that aside, I still can't make it work. From what you wrote, I understand that the cookie is missing the `HTTPOnly` and `Secure` tags which can be added by nginx.\r\n\r\nIn the case of CouchDB sessions, `flavor=choco` should be replaced by `AuthSession=<KEY>` which I can't do manually. In addition, adding the `proxy_cookie_path` setting to nginx didn't solve the issue. The `_utils` endpoint is still unusable and the sessions don't work!","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702615445/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702645509","html_url":"https://github.com/apache/couchdb/issues/3181#issuecomment-702645509","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3181","id":702645509,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMjY0NTUwOQ==","user":{"login":"SinanGabel","id":5586130,"node_id":"MDQ6VXNlcjU1ODYxMzA=","avatar_url":"https://avatars.githubusercontent.com/u/5586130?v=4","gravatar_id":"","url":"https://api.github.com/users/SinanGabel","html_url":"https://github.com/SinanGabel","followers_url":"https://api.github.com/users/SinanGabel/followers","following_url":"https://api.github.com/users/SinanGabel/following{/other_user}","gists_url":"https://api.github.com/users/SinanGabel/gists{/gist_id}","starred_url":"https://api.github.com/users/SinanGabel/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SinanGabel/subscriptions","organizations_url":"https://api.github.com/users/SinanGabel/orgs","repos_url":"https://api.github.com/users/SinanGabel/repos","events_url":"https://api.github.com/users/SinanGabel/events{/privacy}","received_events_url":"https://api.github.com/users/SinanGabel/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-02T10:11:14Z","updated_at":"2020-10-02T10:11:14Z","author_association":"NONE","body":"You can try with this local.ini configuration for example, just adjust to\nyour needs.\n\n[couchdb]\nsingle_node=true\nmax_dbs_open = 128\n; add a uuid (unique identifier) for this server instance\nuuid = 23a19be4-0497-11eb-bdce-3be6f384d43c\n; is removed in couchdb 4.x. Check _users Permissions (possibly have to update)\n; note that users can still update their password (_admin role not necessary)\nusers_db_security_editable = false\n\n[chttpd]\nrequire_valid_user=true\nbind_address=0.0.0.0\nport=5984\nsocket_options = [{recbuf, 262144}, {sndbuf, 262144}, {nodelay, true}]\nserver_options = [{backlog, 128}, {acceptor_pool_size, 16}]\n\n[httpd]\nserver_options = [{backlog, 128}, {acceptor_pool_size, 16}]\nqsocket_options = [{recbuf, 262144}, {sndbuf, 262144}, {nodelay, true}]\nenable_cors = true\nchanges_timeout = 180000\nx_forwarded_host = X-Forwarded-Host\nx_forwarded_proto = X-Forwarded-Proto\nx_forwarded_ssl = X-Forwarded-Ssl\n\n[log]\nlevel=warning\nwriter = stderr\n\n[couch_httpd_auth]\n; unique secret for this server instance. The secret token is used for\nProxy Authentication and for Cookie Authentication.\nsecret = 3e33c590-0497-11eb-8516-8f112748f76a\nallow_persistent_cookies = true\n; 1 day = 24 * 60 * 60 = 86400 seconds\ntimeout = 86400\nauth_cache_size = 512\nrequire_valid_user=true\nsame_site = None\n\n[cors]\n; See also https://github.com/pouchdb/add-cors-to-couchdb\n; Note: the Fauxton cors settings are slightly different\norigins = *\ncredentials = true\nheaders = accept, authorization, content-type, origin, cookie,\nreferer, x-csrf-token\nmethods = GET, OPTIONS, HEAD, PUT, POST, DELETE, TRACE\nmax_age = 86400\n\n[replicator]\n; adjust this to your situation\n; 3 minutes = 3 * 60 * 1000 = 180000\nconnection_timeout = 180000\nuse_checkpoints = true\nworker_batch_size = 512\n\n[admins]\nadmin = admin_password\n\n\nOn Fri, 2 Oct 2020 at 11:07, grapevineai <notifications@github.com> wrote:\n\n> @SinanGabel <https://github.com/SinanGabel> I'm confused... IMHO, CouchDB\n> should automatically handle this! Putting that aside, I still can't make it\n> work. From what you wrote, I understand that the cookie is missing the\n> HTTPOnly and Secure tags which can be added by nginx.\n>\n> In the case of CouchDB sessions, flavor=choco should be replaced by\n> AuthSession=<KEY> which I can't do manually. In addition, adding the\n> proxy_cookie_path setting to nginx didn't solve the issue. The _utils\n> endpoint is still unusable!\n>\n> —\n> You are receiving this because you were mentioned.\n> Reply to this email directly, view it on GitHub\n> <https://github.com/apache/couchdb/issues/3181#issuecomment-702615445>,\n> or unsubscribe\n> <https://github.com/notifications/unsubscribe-auth/ABKTZUVEASSZSY4OFTGTQLLSIWJ57ANCNFSM4R7AFYXQ>\n> .\n>\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702645509/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702650658","html_url":"https://github.com/apache/couchdb/issues/3181#issuecomment-702650658","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3181","id":702650658,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMjY1MDY1OA==","user":{"login":"willholley","id":97787,"node_id":"MDQ6VXNlcjk3Nzg3","avatar_url":"https://avatars.githubusercontent.com/u/97787?v=4","gravatar_id":"","url":"https://api.github.com/users/willholley","html_url":"https://github.com/willholley","followers_url":"https://api.github.com/users/willholley/followers","following_url":"https://api.github.com/users/willholley/following{/other_user}","gists_url":"https://api.github.com/users/willholley/gists{/gist_id}","starred_url":"https://api.github.com/users/willholley/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/willholley/subscriptions","organizations_url":"https://api.github.com/users/willholley/orgs","repos_url":"https://api.github.com/users/willholley/repos","events_url":"https://api.github.com/users/willholley/events{/privacy}","received_events_url":"https://api.github.com/users/willholley/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-02T10:21:49Z","updated_at":"2020-10-02T10:21:49Z","author_association":"MEMBER","body":"@grapevineai the core problem for you seems to be that using `SameSite=none` requires you to access CouchDB using TLS (HTTPS). CouchDB will set the `Secure` cookie directive automatically if you have configured it to terminate TLS. If you are using a reverse proxy such as nginx to terminate TLS, you need to configure it to set the `Secure` cookie directive on the CouchDB session cookie. If you are not using TLS to connect to CouchDB, then you won't be able to use `SameSite=none`.\r\n\r\n\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/702650658/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/703611510","html_url":"https://github.com/apache/couchdb/pull/3190#issuecomment-703611510","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3190","id":703611510,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMzYxMTUxMA==","user":{"login":"dottorblaster","id":20770,"node_id":"MDQ6VXNlcjIwNzcw","avatar_url":"https://avatars.githubusercontent.com/u/20770?v=4","gravatar_id":"","url":"https://api.github.com/users/dottorblaster","html_url":"https://github.com/dottorblaster","followers_url":"https://api.github.com/users/dottorblaster/followers","following_url":"https://api.github.com/users/dottorblaster/following{/other_user}","gists_url":"https://api.github.com/users/dottorblaster/gists{/gist_id}","starred_url":"https://api.github.com/users/dottorblaster/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dottorblaster/subscriptions","organizations_url":"https://api.github.com/users/dottorblaster/orgs","repos_url":"https://api.github.com/users/dottorblaster/repos","events_url":"https://api.github.com/users/dottorblaster/events{/privacy}","received_events_url":"https://api.github.com/users/dottorblaster/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-05T12:52:30Z","updated_at":"2020-10-05T12:52:30Z","author_association":"MEMBER","body":"Tests are red 🚨 did the modification to `couch.ex` affect some older stuff maybe?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/703611510/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/703645177","html_url":"https://github.com/apache/couchdb/pull/3190#issuecomment-703645177","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3190","id":703645177,"node_id":"MDEyOklzc3VlQ29tbWVudDcwMzY0NTE3Nw==","user":{"login":"jjrodrig","id":1001724,"node_id":"MDQ6VXNlcjEwMDE3MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/1001724?v=4","gravatar_id":"","url":"https://api.github.com/users/jjrodrig","html_url":"https://github.com/jjrodrig","followers_url":"https://api.github.com/users/jjrodrig/followers","following_url":"https://api.github.com/users/jjrodrig/following{/other_user}","gists_url":"https://api.github.com/users/jjrodrig/gists{/gist_id}","starred_url":"https://api.github.com/users/jjrodrig/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjrodrig/subscriptions","organizations_url":"https://api.github.com/users/jjrodrig/orgs","repos_url":"https://api.github.com/users/jjrodrig/repos","events_url":"https://api.github.com/users/jjrodrig/events{/privacy}","received_events_url":"https://api.github.com/users/jjrodrig/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2020-10-05T13:49:46Z","updated_at":"2020-10-05T13:49:46Z","author_association":"CONTRIBUTOR","body":"oops... The problem with this test is that it is using _users database. If I'm not properly cleaning it we can have a side effect... I'll check it.\r\n\r\ncouch.ex changes are not the problem here. It's the execution order.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/703645177/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]