[{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/798536496","html_url":"https://github.com/apache/iceberg/pull/2332#issuecomment-798536496","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2332","id":798536496,"node_id":"MDEyOklzc3VlQ29tbWVudDc5ODUzNjQ5Ng==","user":{"login":"ooraini","id":5780138,"node_id":"MDQ6VXNlcjU3ODAxMzg=","avatar_url":"https://avatars.githubusercontent.com/u/5780138?v=4","gravatar_id":"","url":"https://api.github.com/users/ooraini","html_url":"https://github.com/ooraini","followers_url":"https://api.github.com/users/ooraini/followers","following_url":"https://api.github.com/users/ooraini/following{/other_user}","gists_url":"https://api.github.com/users/ooraini/gists{/gist_id}","starred_url":"https://api.github.com/users/ooraini/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ooraini/subscriptions","organizations_url":"https://api.github.com/users/ooraini/orgs","repos_url":"https://api.github.com/users/ooraini/repos","events_url":"https://api.github.com/users/ooraini/events{/privacy}","received_events_url":"https://api.github.com/users/ooraini/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-13T15:47:52Z","updated_at":"2021-03-13T15:47:52Z","author_association":"NONE","body":"Can someone cancel the CI action, it seems it hanged.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/798536496/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/798797152","html_url":"https://github.com/apache/iceberg/issues/2326#issuecomment-798797152","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2326","id":798797152,"node_id":"MDEyOklzc3VlQ29tbWVudDc5ODc5NzE1Mg==","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-13T22:43:24Z","updated_at":"2021-03-13T22:45:07Z","author_association":"COLLABORATOR","body":"Nice, I think with aggregate pushdown it could potentially open many faster queries in Iceberg overall, given how much metadata we have, if we are ok to answer queries with them.\r\n\r\nI think #2182 is interesting, but it might be true that it's not worth the cost if it adds a ton more time for each commit.\r\n\r\n@aokolnychyi  I gave a try today for doing the equivalent query on the files table, and it's much faster (~minute vs ~10s of minutes).  I even added distinct in the end and it does not add much time.  It's a shame that users first try partitions table and not files table then for listing partitions.  I guess there's not much we can do unless we have the spark view catalog support as mentioned in that PR?\r\n\r\nBy the way, as Russell was pointing to me, I was looking at making an improvement by adding predicate pushdown using ManifestEvaluator to filter out manifest-files, as the Manifest List already has each manifest-file's partition min/max.  If I understand correctly, it requires converting a filter on the \"partition\" table (partition.part_field = x) to a \"partition filter\" (part_field = x).  Now it makes me wonder if this functionality will be compatible with later rewriting partitions table to use view of files table.  I guess it would be, as we should have an equivalent partition filter on files_table as well (partition.part_field = x, which is not there today).\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/798797152/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/798879208","html_url":"https://github.com/apache/iceberg/issues/1413#issuecomment-798879208","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1413","id":798879208,"node_id":"MDEyOklzc3VlQ29tbWVudDc5ODg3OTIwOA==","user":{"login":"ggershinsky","id":12033212,"node_id":"MDQ6VXNlcjEyMDMzMjEy","avatar_url":"https://avatars.githubusercontent.com/u/12033212?v=4","gravatar_id":"","url":"https://api.github.com/users/ggershinsky","html_url":"https://github.com/ggershinsky","followers_url":"https://api.github.com/users/ggershinsky/followers","following_url":"https://api.github.com/users/ggershinsky/following{/other_user}","gists_url":"https://api.github.com/users/ggershinsky/gists{/gist_id}","starred_url":"https://api.github.com/users/ggershinsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ggershinsky/subscriptions","organizations_url":"https://api.github.com/users/ggershinsky/orgs","repos_url":"https://api.github.com/users/ggershinsky/repos","events_url":"https://api.github.com/users/ggershinsky/events{/privacy}","received_events_url":"https://api.github.com/users/ggershinsky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-14T09:56:08Z","updated_at":"2021-03-14T09:56:08Z","author_association":"CONTRIBUTOR","body":"Hi @shangxinli , I guess you are using a custom Parquet integration code. The way Iceberg calls the Parquet APIs today (in the master branch), doesn't allow for transparent activation of Parquet encryption via crypto factories. I had to make some code modifications in both writer and reader parts in order to have Iceberg create/query data tables with encrypted Parquet files.  Details TBD, but I believe they are not very important; this might be split into two phases - a near-term, that integrates the current Iceberg with Parquet encryption (one way or another), and a longer-term, that will depend on the progress of a bigger subject of the future approach to a general Iceberg/Parquet integration.\r\n\r\nAs a side note - all this is about the basic mechanics of the Iceberg/PME calls. There are additional table security questions / challenges, beyond the direct scope of this subject.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/798879208/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799099514","html_url":"https://github.com/apache/iceberg/issues/2308#issuecomment-799099514","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2308","id":799099514,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTA5OTUxNA==","user":{"login":"stevenzwu","id":1545663,"node_id":"MDQ6VXNlcjE1NDU2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1545663?v=4","gravatar_id":"","url":"https://api.github.com/users/stevenzwu","html_url":"https://github.com/stevenzwu","followers_url":"https://api.github.com/users/stevenzwu/followers","following_url":"https://api.github.com/users/stevenzwu/following{/other_user}","gists_url":"https://api.github.com/users/stevenzwu/gists{/gist_id}","starred_url":"https://api.github.com/users/stevenzwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevenzwu/subscriptions","organizations_url":"https://api.github.com/users/stevenzwu/orgs","repos_url":"https://api.github.com/users/stevenzwu/repos","events_url":"https://api.github.com/users/stevenzwu/events{/privacy}","received_events_url":"https://api.github.com/users/stevenzwu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T05:20:35Z","updated_at":"2021-03-15T05:20:35Z","author_association":"CONTRIBUTOR","body":"> At the timestamp t1, the rewrite action commit the txn successfully.\r\n\r\nIs this a typo: t1 -> t4?\r\n\r\nIn this case shouldn't the rewrite action commit fail due to conflict in opportunistic concurrency control?\r\n\r\nIf the rewrite action took longer than the streaming write commit interval, there is a chance that rewrite action can stuck in the conflict-and-retry loop. It have to re-apply all the expensive rewrite computation based on the latest snapshot.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799099514/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799180514","html_url":"https://github.com/apache/iceberg/issues/2308#issuecomment-799180514","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2308","id":799180514,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTE4MDUxNA==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T07:22:05Z","updated_at":"2021-03-15T07:22:05Z","author_association":"MEMBER","body":"> Is this a typo: t1 -> t4?\r\n\r\nYeah,  thanks @stevenzwu.  It's a typo, sorry for that.\r\n\r\n> It have to re-apply all the expensive rewrite computation based on the latest snapshot.\r\n\r\nRe-do the expensive rewrite process is not the solution that people want because if the streaming job is checkpointing for every 1min and the rewrite action take 4min to complete , then there is probability that the expensive rewrite action will be always retrying. \r\n\r\nBesides the expensive resource cost from retrying,  there is a data semantic issue that will confuse people much.  I mean different txn commit order between RewriteFiles and  CDC/Upsert transaction will lead to different data set for the same dataset & operations.  Then people won't trust the truth of iceberg table. \r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799180514/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799207665","html_url":"https://github.com/apache/iceberg/issues/2327#issuecomment-799207665","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2327","id":799207665,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTIwNzY2NQ==","user":{"login":"chinaboyll","id":33946944,"node_id":"MDQ6VXNlcjMzOTQ2OTQ0","avatar_url":"https://avatars.githubusercontent.com/u/33946944?v=4","gravatar_id":"","url":"https://api.github.com/users/chinaboyll","html_url":"https://github.com/chinaboyll","followers_url":"https://api.github.com/users/chinaboyll/followers","following_url":"https://api.github.com/users/chinaboyll/following{/other_user}","gists_url":"https://api.github.com/users/chinaboyll/gists{/gist_id}","starred_url":"https://api.github.com/users/chinaboyll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chinaboyll/subscriptions","organizations_url":"https://api.github.com/users/chinaboyll/orgs","repos_url":"https://api.github.com/users/chinaboyll/repos","events_url":"https://api.github.com/users/chinaboyll/events{/privacy}","received_events_url":"https://api.github.com/users/chinaboyll/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T08:07:45Z","updated_at":"2021-03-15T08:07:45Z","author_association":"NONE","body":"I have the same problemã€‚","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799207665/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799394224","html_url":"https://github.com/apache/iceberg/issues/2308#issuecomment-799394224","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2308","id":799394224,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTM5NDIyNA==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T12:52:07Z","updated_at":"2021-03-15T12:52:07Z","author_association":"MEMBER","body":"I don't think I see the data semantic issue, since the rewrite operation should fail as @stevenzwu has said, because it violates the constraint imposed by the delete.\r\n\r\nI can understand how this is a practical problem if the rewrite can never complete because the row level delete files are being added too quickly, but I don't see how this can cause different data.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799394224/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799470435","html_url":"https://github.com/apache/iceberg/issues/2308#issuecomment-799470435","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2308","id":799470435,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTQ3MDQzNQ==","user":{"login":"stevenzwu","id":1545663,"node_id":"MDQ6VXNlcjE1NDU2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1545663?v=4","gravatar_id":"","url":"https://api.github.com/users/stevenzwu","html_url":"https://github.com/stevenzwu","followers_url":"https://api.github.com/users/stevenzwu/followers","following_url":"https://api.github.com/users/stevenzwu/following{/other_user}","gists_url":"https://api.github.com/users/stevenzwu/gists{/gist_id}","starred_url":"https://api.github.com/users/stevenzwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevenzwu/subscriptions","organizations_url":"https://api.github.com/users/stevenzwu/orgs","repos_url":"https://api.github.com/users/stevenzwu/repos","events_url":"https://api.github.com/users/stevenzwu/events{/privacy}","received_events_url":"https://api.github.com/users/stevenzwu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T14:36:01Z","updated_at":"2021-03-15T20:38:23Z","author_association":"CONTRIBUTOR","body":"If we can avoid the complete re-computation during retry, it might solve the liveliness problem of stuck in conflict-retry loop. Can the rewrite action reuse most/part of computation result from the previous try so that it can shorten the duration in the retry? Only do additional incremental computation on the delta change since last computation.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799470435/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799483504","html_url":"https://github.com/apache/iceberg/pull/2324#issuecomment-799483504","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2324","id":799483504,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTQ4MzUwNA==","user":{"login":"rymurr","id":2022305,"node_id":"MDQ6VXNlcjIwMjIzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/2022305?v=4","gravatar_id":"","url":"https://api.github.com/users/rymurr","html_url":"https://github.com/rymurr","followers_url":"https://api.github.com/users/rymurr/followers","following_url":"https://api.github.com/users/rymurr/following{/other_user}","gists_url":"https://api.github.com/users/rymurr/gists{/gist_id}","starred_url":"https://api.github.com/users/rymurr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rymurr/subscriptions","organizations_url":"https://api.github.com/users/rymurr/orgs","repos_url":"https://api.github.com/users/rymurr/repos","events_url":"https://api.github.com/users/rymurr/events{/privacy}","received_events_url":"https://api.github.com/users/rymurr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T14:53:00Z","updated_at":"2021-03-15T14:53:00Z","author_association":"CONTRIBUTOR","body":"Moving to draft until #2328 is merged","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799483504/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799494598","html_url":"https://github.com/apache/iceberg/pull/2266#issuecomment-799494598","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2266","id":799494598,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTQ5NDU5OA==","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T15:06:39Z","updated_at":"2021-03-15T15:06:39Z","author_association":"COLLABORATOR","body":"@rdblue do you think we can merge and /or take a look?  Thanks","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799494598/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799507074","html_url":"https://github.com/apache/iceberg/pull/2330#issuecomment-799507074","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2330","id":799507074,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTUwNzA3NA==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T15:22:44Z","updated_at":"2021-03-15T15:22:44Z","author_association":"MEMBER","body":"I would just add one more test to verify the location is set correctly in the table properties on read.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799507074/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799507745","html_url":"https://github.com/apache/iceberg/pull/2330#issuecomment-799507745","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2330","id":799507745,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTUwNzc0NQ==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T15:23:32Z","updated_at":"2021-03-15T15:23:32Z","author_association":"MEMBER","body":"> I would just add one more test to verify the location is set correctly in the table properties on read.\r\n\r\nAh I missed it as one of the asserts! LGTM +1","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799507745/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799514404","html_url":"https://github.com/apache/iceberg/pull/2329#issuecomment-799514404","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2329","id":799514404,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTUxNDQwNA==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T15:31:45Z","updated_at":"2021-03-15T15:31:45Z","author_association":"MEMBER","body":"This looks good to me","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799514404/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799531130","html_url":"https://github.com/apache/iceberg/pull/2307#issuecomment-799531130","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2307","id":799531130,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTUzMTEzMA==","user":{"login":"danielcweeks","id":4925077,"node_id":"MDQ6VXNlcjQ5MjUwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4925077?v=4","gravatar_id":"","url":"https://api.github.com/users/danielcweeks","html_url":"https://github.com/danielcweeks","followers_url":"https://api.github.com/users/danielcweeks/followers","following_url":"https://api.github.com/users/danielcweeks/following{/other_user}","gists_url":"https://api.github.com/users/danielcweeks/gists{/gist_id}","starred_url":"https://api.github.com/users/danielcweeks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielcweeks/subscriptions","organizations_url":"https://api.github.com/users/danielcweeks/orgs","repos_url":"https://api.github.com/users/danielcweeks/repos","events_url":"https://api.github.com/users/danielcweeks/events{/privacy}","received_events_url":"https://api.github.com/users/danielcweeks/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T15:53:31Z","updated_at":"2021-03-15T15:53:31Z","author_association":"CONTRIBUTOR","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799531130/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799531623","html_url":"https://github.com/apache/iceberg/pull/2307#issuecomment-799531623","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2307","id":799531623,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTUzMTYyMw==","user":{"login":"rymurr","id":2022305,"node_id":"MDQ6VXNlcjIwMjIzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/2022305?v=4","gravatar_id":"","url":"https://api.github.com/users/rymurr","html_url":"https://github.com/rymurr","followers_url":"https://api.github.com/users/rymurr/followers","following_url":"https://api.github.com/users/rymurr/following{/other_user}","gists_url":"https://api.github.com/users/rymurr/gists{/gist_id}","starred_url":"https://api.github.com/users/rymurr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rymurr/subscriptions","organizations_url":"https://api.github.com/users/rymurr/orgs","repos_url":"https://api.github.com/users/rymurr/repos","events_url":"https://api.github.com/users/rymurr/events{/privacy}","received_events_url":"https://api.github.com/users/rymurr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T15:54:10Z","updated_at":"2021-03-15T15:54:10Z","author_association":"CONTRIBUTOR","body":"Much obliged @danielcweeks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799531623/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799559415","html_url":"https://github.com/apache/iceberg/pull/2266#issuecomment-799559415","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2266","id":799559415,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTU1OTQxNQ==","user":{"login":"TGooch44","id":1591711,"node_id":"MDQ6VXNlcjE1OTE3MTE=","avatar_url":"https://avatars.githubusercontent.com/u/1591711?v=4","gravatar_id":"","url":"https://api.github.com/users/TGooch44","html_url":"https://github.com/TGooch44","followers_url":"https://api.github.com/users/TGooch44/followers","following_url":"https://api.github.com/users/TGooch44/following{/other_user}","gists_url":"https://api.github.com/users/TGooch44/gists{/gist_id}","starred_url":"https://api.github.com/users/TGooch44/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/TGooch44/subscriptions","organizations_url":"https://api.github.com/users/TGooch44/orgs","repos_url":"https://api.github.com/users/TGooch44/repos","events_url":"https://api.github.com/users/TGooch44/events{/privacy}","received_events_url":"https://api.github.com/users/TGooch44/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T16:29:40Z","updated_at":"2021-03-15T16:29:40Z","author_association":"CONTRIBUTOR","body":"Ryan(Blue) is out on family leave right now, maybe @danielcweeks can take a look at merging.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799559415/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799627934","html_url":"https://github.com/apache/iceberg/pull/2330#issuecomment-799627934","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2330","id":799627934,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTYyNzkzNA==","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T18:00:29Z","updated_at":"2021-03-15T18:00:29Z","author_association":"CONTRIBUTOR","body":"Thanks @RussellSpitzer for the review. Hi @aokolnychyi, can you take a look?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799627934/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799643210","html_url":"https://github.com/apache/iceberg/pull/2333#issuecomment-799643210","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2333","id":799643210,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTY0MzIxMA==","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T18:19:48Z","updated_at":"2021-03-15T18:19:48Z","author_association":"CONTRIBUTOR","body":"@RussellSpitzer updated based on all the comments, please take a look when you have time, thanks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799643210/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799710932","html_url":"https://github.com/apache/iceberg/issues/2319#issuecomment-799710932","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2319","id":799710932,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTcxMDkzMg==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T19:58:19Z","updated_at":"2021-03-15T19:58:28Z","author_association":"CONTRIBUTOR","body":"Originally, we only cached tables for a short period of time, since the expectation is that we want to have fresh data if it is available, but have a reasonable window where results don't just change (i.e., while planning a self-join). The problem with this was that tables that were referenced by Spark plans would not get refreshed properly because the table would become an orphaned object and no other operations would call `refresh` after an update.\r\n\r\nThere are a few recent changes that make this less of a problem. First, Spark should now correctly invalidate cached plans, as should the Spark actions in Iceberg. I think that solving the problem the right way changes the trade-off and that we should re-introduce the table expiration.\r\n\r\nDoes that sound reasonable to everyone? @aokolnychyi, @pvary, @edgarRd, @zhangdove?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799710932/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799723563","html_url":"https://github.com/apache/iceberg/issues/1502#issuecomment-799723563","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1502","id":799723563,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTcyMzU2Mw==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T20:19:17Z","updated_at":"2021-03-15T20:19:17Z","author_association":"CONTRIBUTOR","body":"@springle, I think caching the client pool could definitely help. Another thing is that we may need to take a look at the lifecycle of the catalog you're using. They're supposed to be tied to the lifecycle of the Spark session so the pool shouldn't be closed. What version of Iceberg are you using?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799723563/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799740810","html_url":"https://github.com/apache/iceberg/pull/2329#issuecomment-799740810","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2329","id":799740810,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTc0MDgxMA==","user":{"login":"edgarRd","id":266670,"node_id":"MDQ6VXNlcjI2NjY3MA==","avatar_url":"https://avatars.githubusercontent.com/u/266670?v=4","gravatar_id":"","url":"https://api.github.com/users/edgarRd","html_url":"https://github.com/edgarRd","followers_url":"https://api.github.com/users/edgarRd/followers","following_url":"https://api.github.com/users/edgarRd/following{/other_user}","gists_url":"https://api.github.com/users/edgarRd/gists{/gist_id}","starred_url":"https://api.github.com/users/edgarRd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edgarRd/subscriptions","organizations_url":"https://api.github.com/users/edgarRd/orgs","repos_url":"https://api.github.com/users/edgarRd/repos","events_url":"https://api.github.com/users/edgarRd/events{/privacy}","received_events_url":"https://api.github.com/users/edgarRd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T20:47:06Z","updated_at":"2021-03-15T20:49:16Z","author_association":"CONTRIBUTOR","body":"Thanks for working on this. I think this is great to have the stats in the Hive table metadata. \r\n\r\nHowever, I think it'd still be good to implement `InputEstimator` in the `HiveIcebergStorageHandler` to provide the right estimation on the scan using the filter during a join plan. It's a bit tricky in Iceberg since we'd need to compute the split tasks again or cache them. I guess initially computing them again (if we can reuse the code) would be okay to avoid caching  - although it could be slow is it's a very selective scan, in that case maybe we could do a quick stop if too large and use table stats.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799740810/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799796432","html_url":"https://github.com/apache/iceberg/issues/2319#issuecomment-799796432","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2319","id":799796432,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTc5NjQzMg==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T22:26:46Z","updated_at":"2021-03-15T23:19:52Z","author_association":"CONTRIBUTOR","body":"@rdblue, I am afraid the changes done in Spark and whatever we have in our actions invalidate only cached data. I don't think we invalidate plans. For example, if someone creates a view that references a V2 table, Spark won't invalidate it.\r\n\r\nIn our `SparkTable`, we have `refreshEagerly` flag, which is set as true whenever the caching catalog is not used. Using the caching catalog without expiry, ensures the view will always be invalidated whenever there is an operation in the current session. Operations happening in other query engines won't invalidate the Spark view, though.\r\n\r\nIt looks like we should be able to handle this case by moving the caching/invalidation logic to `SparkTable`. Thoughts?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799796432/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799833353","html_url":"https://github.com/apache/iceberg/pull/2331#issuecomment-799833353","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2331","id":799833353,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgzMzM1Mw==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T23:40:00Z","updated_at":"2021-03-15T23:40:00Z","author_association":"CONTRIBUTOR","body":"@pan3793, I agree about the hive dep but I'd like to handle that in a separate PR if possible. Let's keep this one specific to relocating the antlr4 dep.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799833353/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799835092","html_url":"https://github.com/apache/iceberg/pull/2332#issuecomment-799835092","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2332","id":799835092,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTgzNTA5Mg==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-15T23:44:27Z","updated_at":"2021-03-15T23:44:27Z","author_association":"CONTRIBUTOR","body":"The CI actions behave weirdly today. We had to reopen a few PR today to trigger them again.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799835092/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799874698","html_url":"https://github.com/apache/iceberg/pull/2331#issuecomment-799874698","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2331","id":799874698,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTg3NDY5OA==","user":{"login":"pan3793","id":26535726,"node_id":"MDQ6VXNlcjI2NTM1NzI2","avatar_url":"https://avatars.githubusercontent.com/u/26535726?v=4","gravatar_id":"","url":"https://api.github.com/users/pan3793","html_url":"https://github.com/pan3793","followers_url":"https://api.github.com/users/pan3793/followers","following_url":"https://api.github.com/users/pan3793/following{/other_user}","gists_url":"https://api.github.com/users/pan3793/gists{/gist_id}","starred_url":"https://api.github.com/users/pan3793/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pan3793/subscriptions","organizations_url":"https://api.github.com/users/pan3793/orgs","repos_url":"https://api.github.com/users/pan3793/repos","events_url":"https://api.github.com/users/pan3793/events{/privacy}","received_events_url":"https://api.github.com/users/pan3793/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T01:30:46Z","updated_at":"2021-03-16T01:39:35Z","author_association":"MEMBER","body":"@aokolnychyi Reverted, and I will open another PR to remove redundant spark-hive deps\r\n\r\nupdated\r\nsee #2338","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799874698/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799877093","html_url":"https://github.com/apache/iceberg/pull/2331#issuecomment-799877093","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2331","id":799877093,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTg3NzA5Mw==","user":{"login":"pan3793","id":26535726,"node_id":"MDQ6VXNlcjI2NTM1NzI2","avatar_url":"https://avatars.githubusercontent.com/u/26535726?v=4","gravatar_id":"","url":"https://api.github.com/users/pan3793","html_url":"https://github.com/pan3793","followers_url":"https://api.github.com/users/pan3793/followers","following_url":"https://api.github.com/users/pan3793/following{/other_user}","gists_url":"https://api.github.com/users/pan3793/gists{/gist_id}","starred_url":"https://api.github.com/users/pan3793/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pan3793/subscriptions","organizations_url":"https://api.github.com/users/pan3793/orgs","repos_url":"https://api.github.com/users/pan3793/repos","events_url":"https://api.github.com/users/pan3793/events{/privacy}","received_events_url":"https://api.github.com/users/pan3793/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T01:37:18Z","updated_at":"2021-03-16T01:46:53Z","author_association":"MEMBER","body":"jcenter seems not stable","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799877093/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799879218","html_url":"https://github.com/apache/iceberg/pull/2338#issuecomment-799879218","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2338","id":799879218,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTg3OTIxOA==","user":{"login":"pan3793","id":26535726,"node_id":"MDQ6VXNlcjI2NTM1NzI2","avatar_url":"https://avatars.githubusercontent.com/u/26535726?v=4","gravatar_id":"","url":"https://api.github.com/users/pan3793","html_url":"https://github.com/pan3793","followers_url":"https://api.github.com/users/pan3793/followers","following_url":"https://api.github.com/users/pan3793/following{/other_user}","gists_url":"https://api.github.com/users/pan3793/gists{/gist_id}","starred_url":"https://api.github.com/users/pan3793/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pan3793/subscriptions","organizations_url":"https://api.github.com/users/pan3793/orgs","repos_url":"https://api.github.com/users/pan3793/repos","events_url":"https://api.github.com/users/pan3793/events{/privacy}","received_events_url":"https://api.github.com/users/pan3793/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T01:43:54Z","updated_at":"2021-03-16T01:43:54Z","author_association":"MEMBER","body":"jcenter seems not stable","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799879218/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799888928","html_url":"https://github.com/apache/iceberg/pull/2331#issuecomment-799888928","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2331","id":799888928,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTg4ODkyOA==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T02:11:38Z","updated_at":"2021-03-16T02:11:38Z","author_association":"MEMBER","body":"@snazy You published those artifacts right? I thought the 0.4 nessie build passed","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799888928/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799891926","html_url":"https://github.com/apache/iceberg/pull/2331#issuecomment-799891926","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2331","id":799891926,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTg5MTkyNg==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T02:19:41Z","updated_at":"2021-03-16T02:19:41Z","author_association":"CONTRIBUTOR","body":"Triggered the checks again.\r\n\r\ncc @rymurr too for Nessie related failures","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799891926/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799892671","html_url":"https://github.com/apache/iceberg/pull/2331#issuecomment-799892671","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2331","id":799892671,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTg5MjY3MQ==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T02:21:31Z","updated_at":"2021-03-16T02:21:31Z","author_association":"CONTRIBUTOR","body":"I saw similar failures for other artifacts so should not be related to Nessie dep.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799892671/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799920889","html_url":"https://github.com/apache/iceberg/issues/1413#issuecomment-799920889","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1413","id":799920889,"node_id":"MDEyOklzc3VlQ29tbWVudDc5OTkyMDg4OQ==","user":{"login":"shangxinli","id":31421745,"node_id":"MDQ6VXNlcjMxNDIxNzQ1","avatar_url":"https://avatars.githubusercontent.com/u/31421745?v=4","gravatar_id":"","url":"https://api.github.com/users/shangxinli","html_url":"https://github.com/shangxinli","followers_url":"https://api.github.com/users/shangxinli/followers","following_url":"https://api.github.com/users/shangxinli/following{/other_user}","gists_url":"https://api.github.com/users/shangxinli/gists{/gist_id}","starred_url":"https://api.github.com/users/shangxinli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shangxinli/subscriptions","organizations_url":"https://api.github.com/users/shangxinli/orgs","repos_url":"https://api.github.com/users/shangxinli/repos","events_url":"https://api.github.com/users/shangxinli/events{/privacy}","received_events_url":"https://api.github.com/users/shangxinli/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T03:41:41Z","updated_at":"2021-03-16T03:41:41Z","author_association":"CONTRIBUTOR","body":"Sounds good @ggershinsky! Look forward to reviewing your changes! ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/799920889/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800004882","html_url":"https://github.com/apache/iceberg/issues/2335#issuecomment-800004882","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2335","id":800004882,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDAwNDg4Mg==","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T06:55:13Z","updated_at":"2021-03-16T06:55:13Z","author_association":"CONTRIBUTOR","body":"Which Iceberg version did you use? The master branch with Spark 3.1.1 works for me.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800004882/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800021752","html_url":"https://github.com/apache/iceberg/issues/2308#issuecomment-800021752","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2308","id":800021752,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDAyMTc1Mg==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T07:25:06Z","updated_at":"2021-03-16T07:25:06Z","author_association":"MEMBER","body":"@RussellSpitzer  If we just fail the rewrite operation as @stevenzwu said,  Yes it should be no data semantic issue.  The failure  could be acceptable for batch jobs, I mean we could just fail the rewrite operation if someone write few new update/deletes into the base iceberg table, the batch update/deletes job is a rare operation, the probability of conflict between rewrite operation and update operation is small.   \r\n\r\nBut in streaming case, that is a different story.  Because the streaming job is always running and continues to commit the delta changes to iceberg table periodlly ( such as 1 minutes), the probability of conflict between rewrite operation and update operation is very large.  So failing the rewrite operation and re-do the whole expensive job is unacceptable for this case.  I'm trying to propose the solution that we don't have to re-do the rewrite operation,  the simplest way is following the current opportunistic concurrency control,  I mean the rewrite operation could just grab the table lock again and re-commit the generated files to iceberg table with the original sequence number from base snapshot, then the delete files will always effect the rewritten data files.  But it does not work for the position delete files because once we rewrite the data files then all of the row offset are changed, finally the delete files could not  be applied to the rewrite files.  Luckily,  we streaming update/upsert job won't produce any position delete files that delete the old data files,  so that should be OK.\r\n\r\n( btw,  I provided an unit test to demonstrate why the data semantics will be an issue if just try to reuse the files from rewrite operation here https://github.com/apache/iceberg/pull/2303/commits/27e47a95d2761fa36d7724f8eac21b75b91f280c#diff-e573276c8dbbcd32f174f0e778334aeea106c67a19efabfefedf0afa4779a499R155-R218,  the [line](https://github.com/apache/iceberg/pull/2303/commits/27e47a95d2761fa36d7724f8eac21b75b91f280c#diff-e573276c8dbbcd32f174f0e778334aeea106c67a19efabfefedf0afa4779a499R217) will be broken because the rewrite action makes the `<2, B>` visible again.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800021752/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800033927","html_url":"https://github.com/apache/iceberg/issues/1413#issuecomment-800033927","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1413","id":800033927,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDAzMzkyNw==","user":{"login":"ggershinsky","id":12033212,"node_id":"MDQ6VXNlcjEyMDMzMjEy","avatar_url":"https://avatars.githubusercontent.com/u/12033212?v=4","gravatar_id":"","url":"https://api.github.com/users/ggershinsky","html_url":"https://github.com/ggershinsky","followers_url":"https://api.github.com/users/ggershinsky/followers","following_url":"https://api.github.com/users/ggershinsky/following{/other_user}","gists_url":"https://api.github.com/users/ggershinsky/gists{/gist_id}","starred_url":"https://api.github.com/users/ggershinsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ggershinsky/subscriptions","organizations_url":"https://api.github.com/users/ggershinsky/orgs","repos_url":"https://api.github.com/users/ggershinsky/repos","events_url":"https://api.github.com/users/ggershinsky/events{/privacy}","received_events_url":"https://api.github.com/users/ggershinsky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T07:46:09Z","updated_at":"2021-03-16T07:46:09Z","author_association":"CONTRIBUTOR","body":"Cool, I'll send them in a pr (after the parquet-mr-1.12 artifact is released; CI checks won't pass otherwise).","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800033927/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800051880","html_url":"https://github.com/apache/iceberg/pull/2331#issuecomment-800051880","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2331","id":800051880,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDA1MTg4MA==","user":{"login":"snazy","id":957468,"node_id":"MDQ6VXNlcjk1NzQ2OA==","avatar_url":"https://avatars.githubusercontent.com/u/957468?v=4","gravatar_id":"","url":"https://api.github.com/users/snazy","html_url":"https://github.com/snazy","followers_url":"https://api.github.com/users/snazy/followers","following_url":"https://api.github.com/users/snazy/following{/other_user}","gists_url":"https://api.github.com/users/snazy/gists{/gist_id}","starred_url":"https://api.github.com/users/snazy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/snazy/subscriptions","organizations_url":"https://api.github.com/users/snazy/orgs","repos_url":"https://api.github.com/users/snazy/repos","events_url":"https://api.github.com/users/snazy/events{/privacy}","received_events_url":"https://api.github.com/users/snazy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T08:15:11Z","updated_at":"2021-03-16T08:15:11Z","author_association":"MEMBER","body":"Tried it locally after purging all Nessie artifacts from both local Maven repo and Gradle cache and works fine.\r\nAll Nessie artifacts are published.\r\nThe jcenter repo often causes issues - maybe move it to the end in the `buildscript { repositories {}}` block in `build.gradle`?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800051880/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800067022","html_url":"https://github.com/apache/iceberg/pull/2331#issuecomment-800067022","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2331","id":800067022,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDA2NzAyMg==","user":{"login":"pan3793","id":26535726,"node_id":"MDQ6VXNlcjI2NTM1NzI2","avatar_url":"https://avatars.githubusercontent.com/u/26535726?v=4","gravatar_id":"","url":"https://api.github.com/users/pan3793","html_url":"https://github.com/pan3793","followers_url":"https://api.github.com/users/pan3793/followers","following_url":"https://api.github.com/users/pan3793/following{/other_user}","gists_url":"https://api.github.com/users/pan3793/gists{/gist_id}","starred_url":"https://api.github.com/users/pan3793/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pan3793/subscriptions","organizations_url":"https://api.github.com/users/pan3793/orgs","repos_url":"https://api.github.com/users/pan3793/repos","events_url":"https://api.github.com/users/pan3793/events{/privacy}","received_events_url":"https://api.github.com/users/pan3793/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T08:38:56Z","updated_at":"2021-03-16T08:46:22Z","author_association":"MEMBER","body":"And JFrog announces [Into the Sunset on May 1st: Bintray, JCenter, GoCenter, and ChartCenter](https://jfrog.com/blog/into-the-sunset-bintray-jcenter-gocenter-and-chartcenter/), should we migrate to Maven Central? And consider there are some developers in Asia, we'd better make it easy to mirror by ENV VAR or gradle properties.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800067022/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800073737","html_url":"https://github.com/apache/iceberg/issues/2335#issuecomment-800073737","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2335","id":800073737,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDA3MzczNw==","user":{"login":"pan3793","id":26535726,"node_id":"MDQ6VXNlcjI2NTM1NzI2","avatar_url":"https://avatars.githubusercontent.com/u/26535726?v=4","gravatar_id":"","url":"https://api.github.com/users/pan3793","html_url":"https://github.com/pan3793","followers_url":"https://api.github.com/users/pan3793/followers","following_url":"https://api.github.com/users/pan3793/following{/other_user}","gists_url":"https://api.github.com/users/pan3793/gists{/gist_id}","starred_url":"https://api.github.com/users/pan3793/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pan3793/subscriptions","organizations_url":"https://api.github.com/users/pan3793/orgs","repos_url":"https://api.github.com/users/pan3793/repos","events_url":"https://api.github.com/users/pan3793/events{/privacy}","received_events_url":"https://api.github.com/users/pan3793/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T08:50:14Z","updated_at":"2021-03-16T08:50:14Z","author_association":"MEMBER","body":"> Which Iceberg version did you use? The master branch with Spark 3.1.1 works for me.\r\n\r\nI can't compile master code against spark 3.1.1","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800073737/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800122070","html_url":"https://github.com/apache/iceberg/issues/2335#issuecomment-800122070","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2335","id":800122070,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDEyMjA3MA==","user":{"login":"jjtjiang","id":48897688,"node_id":"MDQ6VXNlcjQ4ODk3Njg4","avatar_url":"https://avatars.githubusercontent.com/u/48897688?v=4","gravatar_id":"","url":"https://api.github.com/users/jjtjiang","html_url":"https://github.com/jjtjiang","followers_url":"https://api.github.com/users/jjtjiang/followers","following_url":"https://api.github.com/users/jjtjiang/following{/other_user}","gists_url":"https://api.github.com/users/jjtjiang/gists{/gist_id}","starred_url":"https://api.github.com/users/jjtjiang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jjtjiang/subscriptions","organizations_url":"https://api.github.com/users/jjtjiang/orgs","repos_url":"https://api.github.com/users/jjtjiang/repos","events_url":"https://api.github.com/users/jjtjiang/events{/privacy}","received_events_url":"https://api.github.com/users/jjtjiang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T10:03:04Z","updated_at":"2021-03-16T10:03:04Z","author_association":"NONE","body":"> Which Iceberg version did you use? The master branch with Spark 3.1.1 works for me.\r\n\r\n Iceberg version is 0.11.0 ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800122070/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800147489","html_url":"https://github.com/apache/iceberg/pull/2331#issuecomment-800147489","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2331","id":800147489,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDE0NzQ4OQ==","user":{"login":"rymurr","id":2022305,"node_id":"MDQ6VXNlcjIwMjIzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/2022305?v=4","gravatar_id":"","url":"https://api.github.com/users/rymurr","html_url":"https://github.com/rymurr","followers_url":"https://api.github.com/users/rymurr/followers","following_url":"https://api.github.com/users/rymurr/following{/other_user}","gists_url":"https://api.github.com/users/rymurr/gists{/gist_id}","starred_url":"https://api.github.com/users/rymurr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rymurr/subscriptions","organizations_url":"https://api.github.com/users/rymurr/orgs","repos_url":"https://api.github.com/users/rymurr/repos","events_url":"https://api.github.com/users/rymurr/events{/privacy}","received_events_url":"https://api.github.com/users/rymurr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T10:38:05Z","updated_at":"2021-03-16T10:38:05Z","author_association":"CONTRIBUTOR","body":"The nessie plugin uses the gradle plugin portal which behind the scenes uses JCenter. According to this: https://blog.gradle.org/jcenter-shutdown they will behind the scenes move and not disrupt the plugins. Perhaps the failure was intermittent failure in JCenter?\r\n\r\n```\r\nImpact to Gradle plugins\r\nBehind the scenes, the Gradle Plugin Portal uses JCenter to resolve dependencies of plugins. We will be migrating the Plugin Portal away from JCenter before the final shutdown. Builds will not need to make changes while the Plugin Portal migrates away from JCenter.\r\nResolving existing plugins\r\nExisting plugins will continue to resolve in the same way they do today. No changes should need to be made to your builds.\r\nPublishing new plugins\r\nIf you are publishing your plugin with the com.gradle.publish-plugin, you are not affected. Just double check that your build does not use JCenter directly.\r\nIf you are publishing your plugin to Bintray, you will need to use the com.gradle.publish-plugin plugin to publish new versions of your plugin. The sooner you can do this, the better. We can help if you have questions or problems.\r\nWe will automatically migrate all plugins published to Bintray on March 31, 2021. After that date, we will no longer synchronize plugins published to Bintray. This migration should be transparent to users resolving dependencies.\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800147489/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800173681","html_url":"https://github.com/apache/iceberg/pull/2329#issuecomment-800173681","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2329","id":800173681,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDE3MzY4MQ==","user":{"login":"pvary","id":19705742,"node_id":"MDQ6VXNlcjE5NzA1NzQy","avatar_url":"https://avatars.githubusercontent.com/u/19705742?v=4","gravatar_id":"","url":"https://api.github.com/users/pvary","html_url":"https://github.com/pvary","followers_url":"https://api.github.com/users/pvary/followers","following_url":"https://api.github.com/users/pvary/following{/other_user}","gists_url":"https://api.github.com/users/pvary/gists{/gist_id}","starred_url":"https://api.github.com/users/pvary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvary/subscriptions","organizations_url":"https://api.github.com/users/pvary/orgs","repos_url":"https://api.github.com/users/pvary/repos","events_url":"https://api.github.com/users/pvary/events{/privacy}","received_events_url":"https://api.github.com/users/pvary/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T11:19:28Z","updated_at":"2021-03-16T11:19:28Z","author_association":"CONTRIBUTOR","body":">I think it'd still be good to implement `InputEstimator` in the `HiveIcebergStorageHandler` to provide the right estimation on the scan using the filter during a join plan. It's a bit tricky [..]\r\n\r\nI have checked the Hive code and only `InputEstimatorTestClass` implements the `InputEstimator`.\r\nAlso checked the usages of `Estimation` object. Only `getTotalLength` is used. Once for determining if we can use fetch task instead of spawning an MR/Tez job, and then for generating `ContentSummary.length`. This later one is used several places, so it can be useful but we definitely need specific use-cases to check how much effort should we put into calculating the value\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800173681/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800205267","html_url":"https://github.com/apache/iceberg/pull/2295#issuecomment-800205267","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2295","id":800205267,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDIwNTI2Nw==","user":{"login":"chenjunjiedada","id":3960228,"node_id":"MDQ6VXNlcjM5NjAyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3960228?v=4","gravatar_id":"","url":"https://api.github.com/users/chenjunjiedada","html_url":"https://github.com/chenjunjiedada","followers_url":"https://api.github.com/users/chenjunjiedada/followers","following_url":"https://api.github.com/users/chenjunjiedada/following{/other_user}","gists_url":"https://api.github.com/users/chenjunjiedada/gists{/gist_id}","starred_url":"https://api.github.com/users/chenjunjiedada/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenjunjiedada/subscriptions","organizations_url":"https://api.github.com/users/chenjunjiedada/orgs","repos_url":"https://api.github.com/users/chenjunjiedada/repos","events_url":"https://api.github.com/users/chenjunjiedada/events{/privacy}","received_events_url":"https://api.github.com/users/chenjunjiedada/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T12:08:04Z","updated_at":"2021-03-16T12:08:04Z","author_association":"COLLABORATOR","body":"#2325 should be a better solution.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800205267/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800267841","html_url":"https://github.com/apache/iceberg/pull/2340#issuecomment-800267841","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2340","id":800267841,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDI2Nzg0MQ==","user":{"login":"lcspinter","id":47777102,"node_id":"MDQ6VXNlcjQ3Nzc3MTAy","avatar_url":"https://avatars.githubusercontent.com/u/47777102?v=4","gravatar_id":"","url":"https://api.github.com/users/lcspinter","html_url":"https://github.com/lcspinter","followers_url":"https://api.github.com/users/lcspinter/followers","following_url":"https://api.github.com/users/lcspinter/following{/other_user}","gists_url":"https://api.github.com/users/lcspinter/gists{/gist_id}","starred_url":"https://api.github.com/users/lcspinter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lcspinter/subscriptions","organizations_url":"https://api.github.com/users/lcspinter/orgs","repos_url":"https://api.github.com/users/lcspinter/repos","events_url":"https://api.github.com/users/lcspinter/events{/privacy}","received_events_url":"https://api.github.com/users/lcspinter/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T13:41:46Z","updated_at":"2021-03-16T13:41:46Z","author_association":"CONTRIBUTOR","body":"@marton-bod @pvary Could you please review this PR? Thanks","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800267841/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800389307","html_url":"https://github.com/apache/iceberg/pull/2293#issuecomment-800389307","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2293","id":800389307,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDM4OTMwNw==","user":{"login":"edgarRd","id":266670,"node_id":"MDQ6VXNlcjI2NjY3MA==","avatar_url":"https://avatars.githubusercontent.com/u/266670?v=4","gravatar_id":"","url":"https://api.github.com/users/edgarRd","html_url":"https://github.com/edgarRd","followers_url":"https://api.github.com/users/edgarRd/followers","following_url":"https://api.github.com/users/edgarRd/following{/other_user}","gists_url":"https://api.github.com/users/edgarRd/gists{/gist_id}","starred_url":"https://api.github.com/users/edgarRd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edgarRd/subscriptions","organizations_url":"https://api.github.com/users/edgarRd/orgs","repos_url":"https://api.github.com/users/edgarRd/repos","events_url":"https://api.github.com/users/edgarRd/events{/privacy}","received_events_url":"https://api.github.com/users/edgarRd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T16:00:21Z","updated_at":"2021-03-16T16:00:21Z","author_association":"CONTRIBUTOR","body":"@rdblue @aokolnychyi PTAL when you have a chance, or feel free to redirect to someone else - Thanks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800389307/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800397764","html_url":"https://github.com/apache/iceberg/pull/2338#issuecomment-800397764","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2338","id":800397764,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDM5Nzc2NA==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T16:10:30Z","updated_at":"2021-03-16T16:10:30Z","author_association":"MEMBER","body":"Jceneter is shutting down, @rymurr has a PR #2339  to remove the reference and fix the build.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800397764/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800404992","html_url":"https://github.com/apache/iceberg/pull/2338#issuecomment-800404992","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2338","id":800404992,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDQwNDk5Mg==","user":{"login":"pan3793","id":26535726,"node_id":"MDQ6VXNlcjI2NTM1NzI2","avatar_url":"https://avatars.githubusercontent.com/u/26535726?v=4","gravatar_id":"","url":"https://api.github.com/users/pan3793","html_url":"https://github.com/pan3793","followers_url":"https://api.github.com/users/pan3793/followers","following_url":"https://api.github.com/users/pan3793/following{/other_user}","gists_url":"https://api.github.com/users/pan3793/gists{/gist_id}","starred_url":"https://api.github.com/users/pan3793/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pan3793/subscriptions","organizations_url":"https://api.github.com/users/pan3793/orgs","repos_url":"https://api.github.com/users/pan3793/repos","events_url":"https://api.github.com/users/pan3793/events{/privacy}","received_events_url":"https://api.github.com/users/pan3793/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T16:19:43Z","updated_at":"2021-03-16T16:19:43Z","author_association":"MEMBER","body":"Thanks @RussellSpitzer and @rymurr , once #2339 get merged, I will rebase this PR on master. And I see the latest PR CI passed, is that means JCenter is back to normal now?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800404992/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800418492","html_url":"https://github.com/apache/iceberg/pull/2339#issuecomment-800418492","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2339","id":800418492,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDQxODQ5Mg==","user":{"login":"rymurr","id":2022305,"node_id":"MDQ6VXNlcjIwMjIzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/2022305?v=4","gravatar_id":"","url":"https://api.github.com/users/rymurr","html_url":"https://github.com/rymurr","followers_url":"https://api.github.com/users/rymurr/followers","following_url":"https://api.github.com/users/rymurr/following{/other_user}","gists_url":"https://api.github.com/users/rymurr/gists{/gist_id}","starred_url":"https://api.github.com/users/rymurr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rymurr/subscriptions","organizations_url":"https://api.github.com/users/rymurr/orgs","repos_url":"https://api.github.com/users/rymurr/repos","events_url":"https://api.github.com/users/rymurr/events{/privacy}","received_events_url":"https://api.github.com/users/rymurr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T16:33:31Z","updated_at":"2021-03-16T16:33:31Z","author_association":"CONTRIBUTOR","body":"Thanks @RussellSpitzer for the approval","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800418492/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800421401","html_url":"https://github.com/apache/iceberg/pull/2336#issuecomment-800421401","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2336","id":800421401,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDQyMTQwMQ==","user":{"login":"ooraini","id":5780138,"node_id":"MDQ6VXNlcjU3ODAxMzg=","avatar_url":"https://avatars.githubusercontent.com/u/5780138?v=4","gravatar_id":"","url":"https://api.github.com/users/ooraini","html_url":"https://github.com/ooraini","followers_url":"https://api.github.com/users/ooraini/followers","following_url":"https://api.github.com/users/ooraini/following{/other_user}","gists_url":"https://api.github.com/users/ooraini/gists{/gist_id}","starred_url":"https://api.github.com/users/ooraini/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ooraini/subscriptions","organizations_url":"https://api.github.com/users/ooraini/orgs","repos_url":"https://api.github.com/users/ooraini/repos","events_url":"https://api.github.com/users/ooraini/events{/privacy}","received_events_url":"https://api.github.com/users/ooraini/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T16:37:12Z","updated_at":"2021-03-16T16:37:12Z","author_association":"NONE","body":"I ran the failing test locally and it succeeded, not sure why it's failing. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800421401/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800518598","html_url":"https://github.com/apache/iceberg/issues/2335#issuecomment-800518598","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2335","id":800518598,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDUxODU5OA==","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T18:48:41Z","updated_at":"2021-03-16T19:07:12Z","author_association":"CONTRIBUTOR","body":"I can reproduce the issue with 0.11.0 release @jjtjiang.\r\n0.12.0 will support Spark 3.1 according to the latest community syncup notes, https://docs.google.com/document/d/1YuGhUdukLP5gGiqCbk0A5_Wifqe2CZWgOd3TbhY3UQg/edit?usp=sharing. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800518598/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800548447","html_url":"https://github.com/apache/iceberg/pull/2339#issuecomment-800548447","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2339","id":800548447,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDU0ODQ0Nw==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T19:35:43Z","updated_at":"2021-03-16T19:35:43Z","author_association":"CONTRIBUTOR","body":"Thanks, @rymurr!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800548447/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800548972","html_url":"https://github.com/apache/iceberg/pull/2338#issuecomment-800548972","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2338","id":800548972,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDU0ODk3Mg==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T19:36:32Z","updated_at":"2021-03-16T19:36:32Z","author_association":"CONTRIBUTOR","body":"I trigger the CI jobs again.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800548972/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800593796","html_url":"https://github.com/apache/iceberg/pull/2338#issuecomment-800593796","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2338","id":800593796,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDU5Mzc5Ng==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T20:47:57Z","updated_at":"2021-03-16T20:47:57Z","author_association":"CONTRIBUTOR","body":"Thanks, @pan3793! ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800593796/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800655075","html_url":"https://github.com/apache/iceberg/pull/2331#issuecomment-800655075","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2331","id":800655075,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDY1NTA3NQ==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T22:28:02Z","updated_at":"2021-03-16T22:28:02Z","author_association":"CONTRIBUTOR","body":"Thank you, @pan3793! Thanks to everyone for reviewing!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800655075/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800674083","html_url":"https://github.com/apache/iceberg/pull/2314#issuecomment-800674083","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2314","id":800674083,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDY3NDA4Mw==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T23:14:12Z","updated_at":"2021-03-16T23:14:12Z","author_association":"CONTRIBUTOR","body":"Overall, this looks good to me. It might be a good idea to make the `Result` a class rather than an interface to avoid multiple implementations, but I think that's minor.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800674083/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800674902","html_url":"https://github.com/apache/iceberg/pull/2336#issuecomment-800674902","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2336","id":800674902,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDY3NDkwMg==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T23:16:09Z","updated_at":"2021-03-16T23:16:09Z","author_association":"CONTRIBUTOR","body":"Thanks for working on this, @omaraloraini! Could you run some of the benchmarks to help us understand the performance after this change?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800674902/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800687074","html_url":"https://github.com/apache/iceberg/pull/2336#issuecomment-800687074","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2336","id":800687074,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDY4NzA3NA==","user":{"login":"ooraini","id":5780138,"node_id":"MDQ6VXNlcjU3ODAxMzg=","avatar_url":"https://avatars.githubusercontent.com/u/5780138?v=4","gravatar_id":"","url":"https://api.github.com/users/ooraini","html_url":"https://github.com/ooraini","followers_url":"https://api.github.com/users/ooraini/followers","following_url":"https://api.github.com/users/ooraini/following{/other_user}","gists_url":"https://api.github.com/users/ooraini/gists{/gist_id}","starred_url":"https://api.github.com/users/ooraini/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ooraini/subscriptions","organizations_url":"https://api.github.com/users/ooraini/orgs","repos_url":"https://api.github.com/users/ooraini/repos","events_url":"https://api.github.com/users/ooraini/events{/privacy}","received_events_url":"https://api.github.com/users/ooraini/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-16T23:47:44Z","updated_at":"2021-03-17T00:04:55Z","author_association":"NONE","body":"Hi Ryan, what kind of benchmark fits here? JMH? or should I run one on our jobs(at work)?\r\nI did a profiling run to validate the change, and as far as I can tell it seems it does the right thing.\r\n![before](https://user-images.githubusercontent.com/5780138/111393621-20fe8900-86ca-11eb-8c68-4976478a6cc0.png)\r\n![after](https://user-images.githubusercontent.com/5780138/111393626-23f97980-86ca-11eb-9789-c9830d16291e.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800687074/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800769586","html_url":"https://github.com/apache/iceberg/pull/2010#issuecomment-800769586","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2010","id":800769586,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDc2OTU4Ng==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-17T03:39:21Z","updated_at":"2021-03-17T03:39:21Z","author_association":"MEMBER","body":"Okay,  after reconsidered the primary key uniqueness issues,  it's hard to guarantee the uniqueness in an embedded table format lib,  If both the spark job and flink streaming job are writing the same iceberg table I couldn't think of a good and efficient way to guarantee the uniqueness of primary key.  If we have an online server in front of those data files, then it's will be easy to guarantee the uniqueness because all of the write requests will be send to the same online server and the server could decide how to reject those duplicated write request, while for an iceberg table format it's hard to synchronize between different computation job. \r\n\r\nSo I'm fine to introduce the primary key without enforced uniqueness.  @jackye1995   Did you start this work in your repo ? Should we update this PR based the above discussion ?  ( Sorry about the delay).","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800769586/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800782826","html_url":"https://github.com/apache/iceberg/issues/2308#issuecomment-800782826","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2308","id":800782826,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDc4MjgyNg==","user":{"login":"yyanyy","id":71906210,"node_id":"MDQ6VXNlcjcxOTA2MjEw","avatar_url":"https://avatars.githubusercontent.com/u/71906210?v=4","gravatar_id":"","url":"https://api.github.com/users/yyanyy","html_url":"https://github.com/yyanyy","followers_url":"https://api.github.com/users/yyanyy/followers","following_url":"https://api.github.com/users/yyanyy/following{/other_user}","gists_url":"https://api.github.com/users/yyanyy/gists{/gist_id}","starred_url":"https://api.github.com/users/yyanyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yyanyy/subscriptions","organizations_url":"https://api.github.com/users/yyanyy/orgs","repos_url":"https://api.github.com/users/yyanyy/repos","events_url":"https://api.github.com/users/yyanyy/events{/privacy}","received_events_url":"https://api.github.com/users/yyanyy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-17T04:22:59Z","updated_at":"2021-03-17T04:22:59Z","author_association":"CONTRIBUTOR","body":"My understanding of what @stevenzwu referred to is that, if the operation fails due new RowDelta commits coming in, the rewrite operation could potentially  takes whatever changes introduced in the new RowDelta commits and make them part of the rewrite commit along with the old job output originally produced, so that we don't have to go through the expensive recompute while ensure data correctness? e.g. in your case from the email, it might be something like:\r\n\r\nSeq1:  (RowDelta 1)\r\nINSERT,  <1, A> \r\nINSERT,  <2, B>\r\nDELETE, <1, A>\r\n\r\nSeq2: (RowDelta 2)\r\nDELETE, <2, B>\r\n\r\nSeq3: (Rewrite)\r\nINSERT, <2,B> \r\nDELETE, <2, B>   <--- directly taking from RowDelta 2\r\n\r\nalthough because equality deletes only apply to sequence numbers that are less than itself, we may need to update sequence number of the files introduced from RowDelta commits to ensure they are larger than the rewrite operation's sequence number, which means we will increment sequence numbers for more than 1 in a commit, which might not be ideal.\r\n\r\nI think the approach sounds good to me, with some caveat such as we shouldn't blindly assume no conflicts when we do such rewrite operation, as positional deletes with sequence number greater than the sequence number being used for rewritten will break as you mentioned. A similar hypothetical case is that if the rewrite only works for a given partition, and there is a positional delete that affects multiple partitions with a larger sequence number, or if the rewrite only works against files with sequence number up to N and there's an equality write with sequence number N + 1 then rewrite on the files that are pointed by this positional delete will break. \r\n\r\nIn the meanwhile I think this change does break the current assumption that the file is always written with the same sequence number as the commit/snapshot itself, and it might be possible that people are using file and manifest's sequence number to find out when they are introduced to the table, but now we are breaking this behavior. But I guess it might be fine since there are other more reliable sources like metadata tables that could help with the same information. I wonder if other people have thoughts on assumptions like this that could be break by this change. \r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800782826/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800783133","html_url":"https://github.com/apache/iceberg/pull/2010#issuecomment-800783133","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2010","id":800783133,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDc4MzEzMw==","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-17T04:24:01Z","updated_at":"2021-03-17T04:24:01Z","author_association":"CONTRIBUTOR","body":"thanks for the reply! yup I have a version locally that I am working on, which includes changes similar to this PR without the uniqueness constraint. I will publish it tomorrow or the day after tomorrow.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800783133/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800794216","html_url":"https://github.com/apache/iceberg/pull/2314#issuecomment-800794216","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2314","id":800794216,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDc5NDIxNg==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-17T04:57:30Z","updated_at":"2021-03-17T04:57:30Z","author_association":"CONTRIBUTOR","body":"Thanks everyone for reviewing! There is one open question about converting `Result` interface into a class. It is not directly related to this PR so I merged it to unblock subsequent changes. Let's continue to discuss [here](https://github.com/apache/iceberg/pull/2314#discussion_r592111677).","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800794216/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800824166","html_url":"https://github.com/apache/iceberg/pull/2010#issuecomment-800824166","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2010","id":800824166,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDgyNDE2Ng==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-17T06:11:10Z","updated_at":"2021-03-17T06:11:10Z","author_association":"MEMBER","body":"@jackye1995   Looks great !   Then I will close this PR if you publish it,  will be glad to be a reviewer for your patch, thanks ! ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800824166/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800847413","html_url":"https://github.com/apache/iceberg/issues/2308#issuecomment-800847413","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2308","id":800847413,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDg0NzQxMw==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-17T07:00:49Z","updated_at":"2021-03-17T07:00:49Z","author_association":"MEMBER","body":"> We may need to update sequence number of the files introduced from RowDelta commits to ensure they are larger than the rewrite operation's sequence number. \r\n\r\nI think we are thinking the similar apporach to fix the semantic issue caused by commit order. You are trying to increase the seqNum of delete files that were written in the previous RowDelta when doing the rewrite action commit, I'm trying to commit the rewrite action with the stale seqNum that the table wrote before start the rewrite action. The key point is: Let the RowDelta's equality deletions could be applied to the following Rewriten data files. \r\n\r\nThe second appoach seems to be more simplier because we don't have to find all the delete files that was introduced by the previous RowDelta txn. we could just use the current sequence number as the newly introduced rewrite manifest's sequence number.\r\n\r\nAs I comment before, the equality write path don't introduce any position delete files that will be applied to the old files. So we don't have to fallback to re-do the whole rewrite action if conflicts happen. But for the batch row-level delete job, we will have to fallback to re-do the rewrite action because we have to re-evaluate the row set that are not deleted by the previous position deletion.\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800847413/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800851402","html_url":"https://github.com/apache/iceberg/issues/2308#issuecomment-800851402","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2308","id":800851402,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDg1MTQwMg==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-17T07:08:50Z","updated_at":"2021-03-17T07:08:50Z","author_association":"MEMBER","body":"If we plan to maintain sequence number like that, then the semantic of sequence number will be:  if there are some real update/insert/delete in the table data set then we should increase the sequence number, otherwise we should keep the same sequence number for the rewrite action.  The previous semantic is:  if there is any txn that committed to iceberg table, then the sequence number should be increased.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800851402/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800981805","html_url":"https://github.com/apache/iceberg/pull/2329#issuecomment-800981805","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2329","id":800981805,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMDk4MTgwNQ==","user":{"login":"pvary","id":19705742,"node_id":"MDQ6VXNlcjE5NzA1NzQy","avatar_url":"https://avatars.githubusercontent.com/u/19705742?v=4","gravatar_id":"","url":"https://api.github.com/users/pvary","html_url":"https://github.com/pvary","followers_url":"https://api.github.com/users/pvary/followers","following_url":"https://api.github.com/users/pvary/following{/other_user}","gists_url":"https://api.github.com/users/pvary/gists{/gist_id}","starred_url":"https://api.github.com/users/pvary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvary/subscriptions","organizations_url":"https://api.github.com/users/pvary/orgs","repos_url":"https://api.github.com/users/pvary/repos","events_url":"https://api.github.com/users/pvary/events{/privacy}","received_events_url":"https://api.github.com/users/pvary/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-17T10:45:42Z","updated_at":"2021-03-17T10:45:42Z","author_association":"CONTRIBUTOR","body":"Thanks for the PR @marton-bod!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/800981805/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801116095","html_url":"https://github.com/apache/iceberg/issues/2344#issuecomment-801116095","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2344","id":801116095,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTExNjA5NQ==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-17T14:15:03Z","updated_at":"2021-03-17T14:15:03Z","author_association":"MEMBER","body":"That looks like an actual Spark Class is not missing, are you sure your deployment is setup correctly?\r\n\r\nThe method is introduced here\r\nhttps://github.com/apache/spark/commit/7cfd589868b8430bc79e28e4d547008b222781a5 - Which is in 3.0.0\r\n\r\nhttps://github.com/apache/spark/blob/v3.0.2/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/plans/logical/v2Commands.scala#L356\r\n\r\nSo unless v2Commands's generated classes were not on your classpath I wouldn't expect to see this error. Is it possible you have multiple competing Spark libraries on the classpath?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801116095/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801118492","html_url":"https://github.com/apache/iceberg/issues/2341#issuecomment-801118492","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2341","id":801118492,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTExODQ5Mg==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-17T14:18:15Z","updated_at":"2021-03-17T14:18:15Z","author_association":"MEMBER","body":"Unfortunately, because we use a parser extension, the procedures do not allow arbitrary expressions  to be passed to them. This is why \"now()\" is throwing an error.\r\n\r\nCurrently we support only constants and stringMaps,\r\n\r\nhttps://github.com/apache/iceberg/blob/master/spark3-extensions/src/main/antlr/org.apache.spark.sql.catalyst.parser.extensions/IcebergSqlExtensions.g4#L113-L116","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801118492/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801254786","html_url":"https://github.com/apache/iceberg/issues/104#issuecomment-801254786","issue_url":"https://api.github.com/repos/apache/iceberg/issues/104","id":801254786,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTI1NDc4Ng==","user":{"login":"grantatspothero","id":43971820,"node_id":"MDQ6VXNlcjQzOTcxODIw","avatar_url":"https://avatars.githubusercontent.com/u/43971820?v=4","gravatar_id":"","url":"https://api.github.com/users/grantatspothero","html_url":"https://github.com/grantatspothero","followers_url":"https://api.github.com/users/grantatspothero/followers","following_url":"https://api.github.com/users/grantatspothero/following{/other_user}","gists_url":"https://api.github.com/users/grantatspothero/gists{/gist_id}","starred_url":"https://api.github.com/users/grantatspothero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/grantatspothero/subscriptions","organizations_url":"https://api.github.com/users/grantatspothero/orgs","repos_url":"https://api.github.com/users/grantatspothero/repos","events_url":"https://api.github.com/users/grantatspothero/events{/privacy}","received_events_url":"https://api.github.com/users/grantatspothero/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-17T17:06:46Z","updated_at":"2021-03-17T18:20:03Z","author_association":"CONTRIBUTOR","body":"I'm seeing this as well with iceberg 0.11.0 in trino when trying to query a table:\r\n```\r\n2021-03-17T11:38:29.984-0500\tWARN\tFinalizer\torg.apache.iceberg.hadoop.HadoopStreams\tUnclosed input stream created by:\r\n\torg.apache.iceberg.hadoop.HadoopStreams$HadoopSeekableInputStream.<init>(HadoopStreams.java:80)\r\n\torg.apache.iceberg.hadoop.HadoopStreams.wrap(HadoopStreams.java:55)\r\n\torg.apache.iceberg.hadoop.HadoopInputFile.newStream(HadoopInputFile.java:157)\r\n\tio.trino.plugin.hive.authentication.NoHdfsAuthentication.doAs(NoHdfsAuthentication.java:23)\r\n\tio.trino.plugin.hive.HdfsEnvironment.doAs(HdfsEnvironment.java:96)\r\n\tio.trino.plugin.iceberg.HdfsInputFile.newStream(HdfsInputFile.java:60)\r\n\torg.apache.iceberg.avro.AvroIterable.newFileReader(AvroIterable.java:95)\r\n\torg.apache.iceberg.avro.AvroIterable.getMetadata(AvroIterable.java:66)\r\n\torg.apache.iceberg.ManifestReader.<init>(ManifestReader.java:101)\r\n\torg.apache.iceberg.ManifestFiles.read(ManifestFiles.java:63)\r\n\torg.apache.iceberg.ManifestGroup.lambda$entries$13(ManifestGroup.java:220)\r\n\torg.apache.iceberg.relocated.com.google.common.collect.Iterators$6.transform(Iterators.java:783)\r\n\torg.apache.iceberg.relocated.com.google.common.collect.TransformedIterator.next(TransformedIterator.java:47)\r\n\torg.apache.iceberg.relocated.com.google.common.collect.TransformedIterator.next(TransformedIterator.java:47)\r\n\torg.apache.iceberg.util.ParallelIterable$ParallelIterator.submitNextTask(ParallelIterable.java:114)\r\n\torg.apache.iceberg.util.ParallelIterable$ParallelIterator.checkTasks(ParallelIterable.java:101)\r\n\torg.apache.iceberg.util.ParallelIterable$ParallelIterator.hasNext(ParallelIterable.java:138)\r\n\torg.apache.iceberg.relocated.com.google.common.collect.TransformedIterator.hasNext(TransformedIterator.java:42)\r\n\torg.apache.iceberg.relocated.com.google.common.collect.TransformedIterator.hasNext(TransformedIterator.java:42)\r\n\torg.apache.iceberg.relocated.com.google.common.collect.Iterators$ConcatenatedIterator.getTopMetaIterator(Iterators.java:1309)\r\n\torg.apache.iceberg.relocated.com.google.common.collect.Iterators$ConcatenatedIterator.hasNext(Iterators.java:1325)\r\n\torg.apache.iceberg.io.CloseableIterator$1.hasNext(CloseableIterator.java:48)\r\n\torg.apache.iceberg.util.BinPacking$PackingIterator.next(BinPacking.java:111)\r\n\torg.apache.iceberg.util.BinPacking$PackingIterator.next(BinPacking.java:87)\r\n\torg.apache.iceberg.io.CloseableIterator$1.next(CloseableIterator.java:53)\r\n\torg.apache.iceberg.io.CloseableIterable$3$1.next(CloseableIterable.java:109)\r\n\tjava.base/java.util.Spliterators$IteratorSpliterator.tryAdvance(Spliterators.java:1812)\r\n\tjava.base/java.util.stream.StreamSpliterators$WrappingSpliterator.lambda$initPartialTraversalState$0(StreamSpliterators.java:294)\r\n\tjava.base/java.util.stream.StreamSpliterators$AbstractWrappingSpliterator.fillBuffer(StreamSpliterators.java:206)\r\n\tjava.base/java.util.stream.StreamSpliterators$AbstractWrappingSpliterator.doAdvance(StreamSpliterators.java:161)\r\n\tjava.base/java.util.stream.StreamSpliterators$WrappingSpliterator.tryAdvance(StreamSpliterators.java:300)\r\n\tjava.base/java.util.Spliterators$1Adapter.hasNext(Spliterators.java:681)\r\n\tcom.google.common.collect.Iterators$7.hasNext(Iterators.java:912)\r\n\tio.trino.plugin.iceberg.IcebergSplitSource.getNextBatch(IcebergSplitSource.java:60)\r\n\tio.trino.plugin.base.classloader.ClassLoaderSafeConnectorSplitSource.getNextBatch(ClassLoaderSafeConnectorSplitSource.java:44)\r\n\tio.trino.split.ConnectorAwareSplitSource.getNextBatch(ConnectorAwareSplitSource.java:54)\r\n\tio.trino.split.BufferingSplitSource$GetNextBatch.fetchSplits(BufferingSplitSource.java:113)\r\n\tio.trino.split.BufferingSplitSource$GetNextBatch.fetchNextBatchAsync(BufferingSplitSource.java:94)\r\n\tio.trino.split.BufferingSplitSource.getNextBatch(BufferingSplitSource.java:54)\r\n\tio.trino.execution.scheduler.SourcePartitionedScheduler.schedule(SourcePartitionedScheduler.java:255)\r\n\tio.trino.execution.scheduler.SourcePartitionedScheduler$1.schedule(SourcePartitionedScheduler.java:166)\r\n\tio.trino.execution.scheduler.SqlQueryScheduler.schedule(SqlQueryScheduler.java:550)\r\n\tjava.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)\r\n\tjava.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n\tjava.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n\tjava.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n\tjava.base/java.lang.Thread.run(Thread.java:835)\r\n```\r\n\r\nI think this is the cause of the query failure with a stacktrace like this:\r\n```\r\njava.lang.IndexOutOfBoundsException: undefined\r\n\tat java.base/java.io.BufferedInputStream.read(BufferedInputStream.java:344)\r\n\tat java.base/java.io.DataInputStream.read(DataInputStream.java:149)\r\n\tat java.base/java.io.DataInputStream.read(DataInputStream.java:149)\r\n\tat org.apache.iceberg.hadoop.HadoopStreams$HadoopSeekableInputStream.read(HadoopStreams.java:112)\r\n\tat org.apache.iceberg.avro.AvroIO$AvroInputStreamAdapter.read(AvroIO.java:106)\r\n\tat org.apache.avro.file.DataFileReader.openReader(DataFileReader.java:61)\r\n\tat org.apache.iceberg.avro.AvroIterable.newFileReader(AvroIterable.java:94)\r\n\tat org.apache.iceberg.avro.AvroIterable.getMetadata(AvroIterable.java:66)\r\n\tat org.apache.iceberg.ManifestReader.<init>(ManifestReader.java:101)\r\n\tat org.apache.iceberg.ManifestFiles.read(ManifestFiles.java:63)\r\n\tat org.apache.iceberg.ManifestGroup.lambda$entries$13(ManifestGroup.java:220)\r\n\tat org.apache.iceberg.relocated.com.google.common.collect.Iterators$6.transform(Iterators.java:783)\r\n\tat org.apache.iceberg.relocated.com.google.common.collect.TransformedIterator.next(TransformedIterator.java:47)\r\n\tat org.apache.iceberg.relocated.com.google.common.collect.TransformedIterator.next(TransformedIterator.java:47)\r\n\tat org.apache.iceberg.util.ParallelIterable$ParallelIterator.submitNextTask(ParallelIterable.java:114)\r\n\tat org.apache.iceberg.util.ParallelIterable$ParallelIterator.checkTasks(ParallelIterable.java:101)\r\n\tat org.apache.iceberg.util.ParallelIterable$ParallelIterator.hasNext(ParallelIterable.java:138)\r\n\tat org.apache.iceberg.relocated.com.google.common.collect.TransformedIterator.hasNext(TransformedIterator.java:42)\r\n\tat org.apache.iceberg.relocated.com.google.common.collect.TransformedIterator.hasNext(TransformedIterator.java:42)\r\n\tat org.apache.iceberg.relocated.com.google.common.collect.Iterators$ConcatenatedIterator.getTopMetaIterator(Iterators.java:1309)\r\n\tat org.apache.iceberg.relocated.com.google.common.collect.Iterators$ConcatenatedIterator.hasNext(Iterators.java:1325)\r\n\tat org.apache.iceberg.io.CloseableIterator$1.hasNext(CloseableIterator.java:48)\r\n\tat org.apache.iceberg.util.BinPacking$PackingIterator.next(BinPacking.java:111)\r\n\tat org.apache.iceberg.util.BinPacking$PackingIterator.next(BinPacking.java:87)\r\n\tat org.apache.iceberg.io.CloseableIterator$1.next(CloseableIterator.java:53)\r\n\tat org.apache.iceberg.io.CloseableIterable$3$1.next(CloseableIterable.java:109)\r\n\tat java.base/java.util.Spliterators$IteratorSpliterator.tryAdvance(Spliterators.java:1812)\r\n\tat java.base/java.util.stream.StreamSpliterators$WrappingSpliterator.lambda$initPartialTraversalState$0(StreamSpliterators.java:294)\r\n\tat java.base/java.util.stream.StreamSpliterators$AbstractWrappingSpliterator.fillBuffer(StreamSpliterators.java:206)\r\n\tat java.base/java.util.stream.StreamSpliterators$AbstractWrappingSpliterator.doAdvance(StreamSpliterators.java:161)\r\n\tat java.base/java.util.stream.StreamSpliterators$WrappingSpliterator.tryAdvance(StreamSpliterators.java:300)\r\n\tat java.base/java.util.Spliterators$1Adapter.hasNext(Spliterators.java:681)\r\n\tat com.google.common.collect.Iterators$7.hasNext(Iterators.java:912)\r\n\tat io.trino.plugin.iceberg.IcebergSplitSource.getNextBatch(IcebergSplitSource.java:60)\r\n\tat io.trino.plugin.base.classloader.ClassLoaderSafeConnectorSplitSource.getNextBatch(ClassLoaderSafeConnectorSplitSource.java:44)\r\n\tat io.trino.split.ConnectorAwareSplitSource.getNextBatch(ConnectorAwareSplitSource.java:54)\r\n\tat io.trino.split.BufferingSplitSource$GetNextBatch.fetchSplits(BufferingSplitSource.java:113)\r\n\tat io.trino.split.BufferingSplitSource$GetNextBatch.fetchNextBatchAsync(BufferingSplitSource.java:94)\r\n\tat io.trino.split.BufferingSplitSource.getNextBatch(BufferingSplitSource.java:54)\r\n\tat io.trino.execution.scheduler.SourcePartitionedScheduler.schedule(SourcePartitionedScheduler.java:255)\r\n\tat io.trino.execution.scheduler.SourcePartitionedScheduler$1.schedule(SourcePartitionedScheduler.java:166)\r\n\tat io.trino.execution.scheduler.SqlQueryScheduler.schedule(SqlQueryScheduler.java:550)\r\n\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515)\r\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\r\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\r\n\tat java.base/java.lang.Thread.run(Thread.java:835)\r\n``` \r\n\r\nEDIT:\r\nSometimes the trino query will succeed instead of failing. When that occurs, the warning message still fires. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801254786/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801280334","html_url":"https://github.com/apache/iceberg/issues/2308#issuecomment-801280334","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2308","id":801280334,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTI4MDMzNA==","user":{"login":"stevenzwu","id":1545663,"node_id":"MDQ6VXNlcjE1NDU2NjM=","avatar_url":"https://avatars.githubusercontent.com/u/1545663?v=4","gravatar_id":"","url":"https://api.github.com/users/stevenzwu","html_url":"https://github.com/stevenzwu","followers_url":"https://api.github.com/users/stevenzwu/followers","following_url":"https://api.github.com/users/stevenzwu/following{/other_user}","gists_url":"https://api.github.com/users/stevenzwu/gists{/gist_id}","starred_url":"https://api.github.com/users/stevenzwu/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/stevenzwu/subscriptions","organizations_url":"https://api.github.com/users/stevenzwu/orgs","repos_url":"https://api.github.com/users/stevenzwu/repos","events_url":"https://api.github.com/users/stevenzwu/events{/privacy}","received_events_url":"https://api.github.com/users/stevenzwu/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-17T17:42:29Z","updated_at":"2021-03-17T17:42:29Z","author_association":"CONTRIBUTOR","body":"> If we plan to maintain sequence number like that, then the semantic of sequence number will be: if there are some real update/insert/delete in the table data set then we should increase the sequence number, otherwise we should keep the same sequence number for the rewrite action. \r\n\r\n@openinx can you elaborate on the seqNum behavior in your original example. My understanding is that rewrite action commit have to re-increment the sequence number after the successful delta commit.\r\n\r\n> I'm trying to commit the rewrite action with the stale seqNum that the table wrote before start the rewrite action. \r\n\r\nIs this correct with even with the new proposed seq number behavior?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801280334/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801330831","html_url":"https://github.com/apache/iceberg/issues/2308#issuecomment-801330831","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2308","id":801330831,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTMzMDgzMQ==","user":{"login":"yyanyy","id":71906210,"node_id":"MDQ6VXNlcjcxOTA2MjEw","avatar_url":"https://avatars.githubusercontent.com/u/71906210?v=4","gravatar_id":"","url":"https://api.github.com/users/yyanyy","html_url":"https://github.com/yyanyy","followers_url":"https://api.github.com/users/yyanyy/followers","following_url":"https://api.github.com/users/yyanyy/following{/other_user}","gists_url":"https://api.github.com/users/yyanyy/gists{/gist_id}","starred_url":"https://api.github.com/users/yyanyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yyanyy/subscriptions","organizations_url":"https://api.github.com/users/yyanyy/orgs","repos_url":"https://api.github.com/users/yyanyy/repos","events_url":"https://api.github.com/users/yyanyy/events{/privacy}","received_events_url":"https://api.github.com/users/yyanyy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-17T18:55:36Z","updated_at":"2021-03-17T18:55:36Z","author_association":"CONTRIBUTOR","body":"I think there are two seqNum concepts here: seqNum for the table/commit and seqNum for the file. I think it's a reasonable approach to mark the rewritten files with the old seqNum, but I'm not sure if we necessarily need to use an old sequence number for the commit since they are stored as part of the snapshot, and suddenly have an old seqNum within the snapshot could be confusing even if there's no other implication.\r\n\r\n> the equality write path don't introduce any position delete files that will be applied to the old files. So we don't have to fallback to re-do the whole rewrite action if conflicts happen\r\n\r\nDo we want to skip the check on commit conflicts entirely? I think we always want to do the check but just to not fail the commit unless there's positional deletes even for streaming systems, since it's possible that there could be separate concurrent jobs that do rewrites from equality to positional deletes? \r\n\r\nAnother thing that's worth noting is that there's a meeting about designing secondary index earlier today with the community, and when we discussed about rolling up secondary indexes to partition/global level (anything higher than file level index file), Anton @aokolnychyi brought up a point about using sequence number of the files to determine if a certain index file is current, or outdated. If we implement the change mentioned in this issue's proposal, we couldn't achieve that, since the data file path will be different after rewritten but the sequence number stays the same, and the system that builds index won't know that it has to update the index file which eventually will cause a discrepancy.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801330831/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801461121","html_url":"https://github.com/apache/iceberg/pull/2328#issuecomment-801461121","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2328","id":801461121,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTQ2MTEyMQ==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-17T21:40:08Z","updated_at":"2021-03-17T21:40:08Z","author_association":"MEMBER","body":"@pvary Added in a variable for controlling the number of status check attempts as well as small 1 second timeout before the attempt. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801461121/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801464303","html_url":"https://github.com/apache/iceberg/pull/2328#issuecomment-801464303","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2328","id":801464303,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTQ2NDMwMw==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-17T21:46:53Z","updated_at":"2021-03-17T21:46:53Z","author_association":"MEMBER","body":"Rebased on Master","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801464303/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801576874","html_url":"https://github.com/apache/iceberg/issues/2308#issuecomment-801576874","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2308","id":801576874,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTU3Njg3NA==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-18T02:50:44Z","updated_at":"2021-03-18T02:50:44Z","author_association":"MEMBER","body":"@stevenzwu  I will publish the PR about seqNum changes today, it's a very simple change. \r\n\r\n@yyanyy \r\n> I think it's a reasonable approach to mark the rewritten files with the old seqNum, but I'm not sure if we necessarily need to use an old sequence ....\r\n\r\nYeah,  it will write the manifest/data/delete files with the old seqNum, but the newly created snapshot will use an increased seqNum because we have the validation that seqNum MUST be increasing for snapshots.\r\n\r\n> since it's possible that there could be separate concurrent jobs that do rewrites from equality to positional deletes?\r\n\r\nFor the rewrite action that converting equality to position deletes,  we could still use the same approach, say commit the rewrite txn with old seqNum. Because those newly produced pos-deletes applies to the files that does not change.  The position-delete issue that we discussed before is:   \r\n\r\nSeq1: (RowDelta 1)\r\nINSERT, <1, A>\r\nINSERT, <2, B>\r\nDELETE, <1, A>\r\n\r\nSeq2: (RowDelta 2)\r\nPOS-DELETE, <2, B> <---- here is a position deletion\r\n\r\nSeq3: (Rewrite)\r\nINSERT, <2,B>\r\n\r\nThe committed pos-delete could not mask the newly generated files that committed in later rewrite action. This case we have to retry the whole rewrite process. \r\n\r\n> using sequence number of the files to determine if a certain index file is current, or outdated. \r\n\r\nI am sorry that I was absent from the meeting I promised to attend. I misunderstood it as 1pm Beijing time (The correct time is 12am~1am Beijing actually).   Is possible to combine the snapshot seqNum with file's seqNum to solve this problem ?  Actually,  I did not fully understand this background.\r\n\r\n\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801576874/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801578179","html_url":"https://github.com/apache/iceberg/issues/2341#issuecomment-801578179","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2341","id":801578179,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTU3ODE3OQ==","user":{"login":"hereTac","id":8244097,"node_id":"MDQ6VXNlcjgyNDQwOTc=","avatar_url":"https://avatars.githubusercontent.com/u/8244097?v=4","gravatar_id":"","url":"https://api.github.com/users/hereTac","html_url":"https://github.com/hereTac","followers_url":"https://api.github.com/users/hereTac/followers","following_url":"https://api.github.com/users/hereTac/following{/other_user}","gists_url":"https://api.github.com/users/hereTac/gists{/gist_id}","starred_url":"https://api.github.com/users/hereTac/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/hereTac/subscriptions","organizations_url":"https://api.github.com/users/hereTac/orgs","repos_url":"https://api.github.com/users/hereTac/repos","events_url":"https://api.github.com/users/hereTac/events{/privacy}","received_events_url":"https://api.github.com/users/hereTac/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-18T02:54:43Z","updated_at":"2021-03-18T02:54:43Z","author_association":"NONE","body":"If it is as your description shows, then the document should be wrong, and it will make people use it incorrectly.\r\n\r\n[https://iceberg.apache.org/spark-procedures/#expire_snapshots](url)\r\n\r\ndate_sub(current_date(), 10)","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801578179/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801578675","html_url":"https://github.com/apache/iceberg/issues/2341#issuecomment-801578675","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2341","id":801578675,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTU3ODY3NQ==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-18T02:56:17Z","updated_at":"2021-03-18T02:56:17Z","author_association":"MEMBER","body":"ah that is true, I copied that from our internal branch which allows all expressions because it uses the standard parser ... We should probably figure out a way to allow arbitrary expressions here as well","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801578675/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801594486","html_url":"https://github.com/apache/iceberg/issues/2344#issuecomment-801594486","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2344","id":801594486,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTU5NDQ4Ng==","user":{"login":"chinaboyll","id":33946944,"node_id":"MDQ6VXNlcjMzOTQ2OTQ0","avatar_url":"https://avatars.githubusercontent.com/u/33946944?v=4","gravatar_id":"","url":"https://api.github.com/users/chinaboyll","html_url":"https://github.com/chinaboyll","followers_url":"https://api.github.com/users/chinaboyll/followers","following_url":"https://api.github.com/users/chinaboyll/following{/other_user}","gists_url":"https://api.github.com/users/chinaboyll/gists{/gist_id}","starred_url":"https://api.github.com/users/chinaboyll/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chinaboyll/subscriptions","organizations_url":"https://api.github.com/users/chinaboyll/orgs","repos_url":"https://api.github.com/users/chinaboyll/repos","events_url":"https://api.github.com/users/chinaboyll/events{/privacy}","received_events_url":"https://api.github.com/users/chinaboyll/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-18T03:35:37Z","updated_at":"2021-03-18T03:35:37Z","author_association":"NONE","body":"> That looks like an actual Spark Class is not missing, are you sure your deployment is setup correctly?\r\n> \r\n> The method is introduced here\r\n> [apache/spark@7cfd589](https://github.com/apache/spark/commit/7cfd589868b8430bc79e28e4d547008b222781a5) - Which is in 3.0.0\r\n> \r\n> https://github.com/apache/spark/blob/v3.0.2/sql/catalyst/src/main/scala/org/apache/spark/sql/catalyst/plans/logical/v2Commands.scala#L356\r\n> \r\n> So unless v2Commands's generated classes were not on your classpath I wouldn't expect to see this error. Is it possible you have multiple competing Spark libraries on the classpath?\r\n\r\ni don't think Spark libraries is  conflictï¼Œand demo is from http://iceberg.apache.org/spark-writes/#merge-into\r\n\r\nI have already run : use zdm to V2 , and i can use insert/overwrite, but merge and call is error.\r\n\r\nI thought SQL Extensions was wrong,It didn't load successfully, but i look yarn-ui-application-Environment- Spark Properties-spark.sql.extensions is org.apache.iceberg.spark.extensions.IcebergSparkSessionExtensionsã€‚it's load successfullyã€‚\r\n\r\né˜¿è¥¿å§~\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801594486/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801666233","html_url":"https://github.com/apache/iceberg/pull/2075#issuecomment-801666233","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2075","id":801666233,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTY2NjIzMw==","user":{"login":"dixingxing0","id":1303530,"node_id":"MDQ6VXNlcjEzMDM1MzA=","avatar_url":"https://avatars.githubusercontent.com/u/1303530?v=4","gravatar_id":"","url":"https://api.github.com/users/dixingxing0","html_url":"https://github.com/dixingxing0","followers_url":"https://api.github.com/users/dixingxing0/followers","following_url":"https://api.github.com/users/dixingxing0/following{/other_user}","gists_url":"https://api.github.com/users/dixingxing0/gists{/gist_id}","starred_url":"https://api.github.com/users/dixingxing0/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dixingxing0/subscriptions","organizations_url":"https://api.github.com/users/dixingxing0/orgs","repos_url":"https://api.github.com/users/dixingxing0/repos","events_url":"https://api.github.com/users/dixingxing0/events{/privacy}","received_events_url":"https://api.github.com/users/dixingxing0/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-18T06:27:02Z","updated_at":"2021-03-18T06:27:02Z","author_association":"CONTRIBUTOR","body":"@rdblue I see you've start marking issues in the 0.11.1 milestone, i think maybe this issue should be added.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801666233/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801681050","html_url":"https://github.com/apache/iceberg/pull/2328#issuecomment-801681050","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2328","id":801681050,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTY4MTA1MA==","user":{"login":"pvary","id":19705742,"node_id":"MDQ6VXNlcjE5NzA1NzQy","avatar_url":"https://avatars.githubusercontent.com/u/19705742?v=4","gravatar_id":"","url":"https://api.github.com/users/pvary","html_url":"https://github.com/pvary","followers_url":"https://api.github.com/users/pvary/followers","following_url":"https://api.github.com/users/pvary/following{/other_user}","gists_url":"https://api.github.com/users/pvary/gists{/gist_id}","starred_url":"https://api.github.com/users/pvary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvary/subscriptions","organizations_url":"https://api.github.com/users/pvary/orgs","repos_url":"https://api.github.com/users/pvary/repos","events_url":"https://api.github.com/users/pvary/events{/privacy}","received_events_url":"https://api.github.com/users/pvary/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-18T06:58:11Z","updated_at":"2021-03-18T06:58:11Z","author_association":"CONTRIBUTOR","body":"> @pvary Added in a variable for controlling the number of status check attempts as well as small 1 second timeout before the attempt.\r\n\r\nThanks @RussellSpitzer! Checked the relevant parts. Left a few nits. Do not have strong feeligs there, so just feel free to disagree.\r\n\r\nIs there any open items remaining?\r\n\r\nThanks, Peter ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801681050/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801683748","html_url":"https://github.com/apache/iceberg/pull/2075#issuecomment-801683748","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2075","id":801683748,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTY4Mzc0OA==","user":{"login":"pvary","id":19705742,"node_id":"MDQ6VXNlcjE5NzA1NzQy","avatar_url":"https://avatars.githubusercontent.com/u/19705742?v=4","gravatar_id":"","url":"https://api.github.com/users/pvary","html_url":"https://github.com/pvary","followers_url":"https://api.github.com/users/pvary/followers","following_url":"https://api.github.com/users/pvary/following{/other_user}","gists_url":"https://api.github.com/users/pvary/gists{/gist_id}","starred_url":"https://api.github.com/users/pvary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvary/subscriptions","organizations_url":"https://api.github.com/users/pvary/orgs","repos_url":"https://api.github.com/users/pvary/repos","events_url":"https://api.github.com/users/pvary/events{/privacy}","received_events_url":"https://api.github.com/users/pvary/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-18T07:02:48Z","updated_at":"2021-03-18T07:02:48Z","author_association":"CONTRIBUTOR","body":"> @rdblue I see you've start marking issues in the 0.11.1 milestone, i think maybe this issue should be added.\r\n\r\nAs this is a fix with a small risk, added it it to the 0.11.1 milestone.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801683748/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801706823","html_url":"https://github.com/apache/iceberg/issues/2347#issuecomment-801706823","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2347","id":801706823,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTcwNjgyMw==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-18T07:46:09Z","updated_at":"2021-03-18T07:46:09Z","author_association":"MEMBER","body":"For `IntegerType`,  we'd better to use the `typeId` to accomplish the assertion like:\r\n\r\n```java\r\n    assertEquals(IntegerType.typeId(),  IntegerType.typeId());\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801706823/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801760918","html_url":"https://github.com/apache/iceberg/pull/1918#issuecomment-801760918","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1918","id":801760918,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTc2MDkxOA==","user":{"login":"andersonm-ibm","id":63074550,"node_id":"MDQ6VXNlcjYzMDc0NTUw","avatar_url":"https://avatars.githubusercontent.com/u/63074550?v=4","gravatar_id":"","url":"https://api.github.com/users/andersonm-ibm","html_url":"https://github.com/andersonm-ibm","followers_url":"https://api.github.com/users/andersonm-ibm/followers","following_url":"https://api.github.com/users/andersonm-ibm/following{/other_user}","gists_url":"https://api.github.com/users/andersonm-ibm/gists{/gist_id}","starred_url":"https://api.github.com/users/andersonm-ibm/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/andersonm-ibm/subscriptions","organizations_url":"https://api.github.com/users/andersonm-ibm/orgs","repos_url":"https://api.github.com/users/andersonm-ibm/repos","events_url":"https://api.github.com/users/andersonm-ibm/events{/privacy}","received_events_url":"https://api.github.com/users/andersonm-ibm/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-18T09:15:38Z","updated_at":"2021-03-18T09:15:38Z","author_association":"NONE","body":"Hi @ggershinsky. I agree with you. I  think starting with a top-down design is a great idea and we would be happy to participate in the design and in the discussions around it.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801760918/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801816896","html_url":"https://github.com/apache/iceberg/pull/2350#issuecomment-801816896","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2350","id":801816896,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMTgxNjg5Ng==","user":{"login":"lcspinter","id":47777102,"node_id":"MDQ6VXNlcjQ3Nzc3MTAy","avatar_url":"https://avatars.githubusercontent.com/u/47777102?v=4","gravatar_id":"","url":"https://api.github.com/users/lcspinter","html_url":"https://github.com/lcspinter","followers_url":"https://api.github.com/users/lcspinter/followers","following_url":"https://api.github.com/users/lcspinter/following{/other_user}","gists_url":"https://api.github.com/users/lcspinter/gists{/gist_id}","starred_url":"https://api.github.com/users/lcspinter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lcspinter/subscriptions","organizations_url":"https://api.github.com/users/lcspinter/orgs","repos_url":"https://api.github.com/users/lcspinter/repos","events_url":"https://api.github.com/users/lcspinter/events{/privacy}","received_events_url":"https://api.github.com/users/lcspinter/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-18T10:40:24Z","updated_at":"2021-03-18T10:40:24Z","author_association":"CONTRIBUTOR","body":"@pvary @dixingxing0 Could you please review this PR? Thank you.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/801816896/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802049922","html_url":"https://github.com/apache/iceberg/pull/1918#issuecomment-802049922","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1918","id":802049922,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMjA0OTkyMg==","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-18T16:04:30Z","updated_at":"2021-03-18T16:04:30Z","author_association":"CONTRIBUTOR","body":"@ggershinsky @andersonm-ibm \r\n\r\nI am in the process of exploring integration with Parquet and ORC column encryption to come up with a design that we can leverage format native encryption as much as possible while using the existing API and Iceberg architecture. There were also some good ideas for this during the secondary index discussion that I will incorporate here.\r\n\r\nI am not sure if you were in the last sync meeting last week, as I said there, I am writing a design for this and will publish during the this weekend (was caught up with work and got delayed). I will send an email to dev list and update this PR when that is ready.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802049922/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802098090","html_url":"https://github.com/apache/iceberg/pull/1918#issuecomment-802098090","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1918","id":802098090,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMjA5ODA5MA==","user":{"login":"shangxinli","id":31421745,"node_id":"MDQ6VXNlcjMxNDIxNzQ1","avatar_url":"https://avatars.githubusercontent.com/u/31421745?v=4","gravatar_id":"","url":"https://api.github.com/users/shangxinli","html_url":"https://github.com/shangxinli","followers_url":"https://api.github.com/users/shangxinli/followers","following_url":"https://api.github.com/users/shangxinli/following{/other_user}","gists_url":"https://api.github.com/users/shangxinli/gists{/gist_id}","starred_url":"https://api.github.com/users/shangxinli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shangxinli/subscriptions","organizations_url":"https://api.github.com/users/shangxinli/orgs","repos_url":"https://api.github.com/users/shangxinli/repos","events_url":"https://api.github.com/users/shangxinli/events{/privacy}","received_events_url":"https://api.github.com/users/shangxinli/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-18T16:41:30Z","updated_at":"2021-03-18T16:41:30Z","author_association":"CONTRIBUTOR","body":"@ggershinsky @andersonm-ibm @jackye1995 \r\nGreat effort for designing encryption in Iceberg! I agree we should have a laying design and reuse as much as possible as both ORC and Parquet(1.12 is about to release) have column encryption.  Look forward to reviewing the design. \r\n\r\nThere was also some discussion between ORC and Parquet communities on unifiying the table properties in Hive https://issues.apache.org/jira/browse/HIVE-21848. \r\n\r\n \r\n ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802098090/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802146369","html_url":"https://github.com/apache/iceberg/pull/1918#issuecomment-802146369","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1918","id":802146369,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMjE0NjM2OQ==","user":{"login":"ggershinsky","id":12033212,"node_id":"MDQ6VXNlcjEyMDMzMjEy","avatar_url":"https://avatars.githubusercontent.com/u/12033212?v=4","gravatar_id":"","url":"https://api.github.com/users/ggershinsky","html_url":"https://github.com/ggershinsky","followers_url":"https://api.github.com/users/ggershinsky/followers","following_url":"https://api.github.com/users/ggershinsky/following{/other_user}","gists_url":"https://api.github.com/users/ggershinsky/gists{/gist_id}","starred_url":"https://api.github.com/users/ggershinsky/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ggershinsky/subscriptions","organizations_url":"https://api.github.com/users/ggershinsky/orgs","repos_url":"https://api.github.com/users/ggershinsky/repos","events_url":"https://api.github.com/users/ggershinsky/events{/privacy}","received_events_url":"https://api.github.com/users/ggershinsky/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-18T17:28:39Z","updated_at":"2021-03-18T17:28:39Z","author_association":"CONTRIBUTOR","body":"Cool, sounds good! \r\n@jackye1995 I too look forward to reviewing the design doc; planning this stuff top-down is the right thing to do. Btw, no need to rush it, we'll wait.\r\n@shangxinli I agree it will be good to leverage the common column encryption configuration format we've defined in that jira.\r\n@andersonm-ibm Glad you're joining this effort.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802146369/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802395326","html_url":"https://github.com/apache/iceberg/issues/1654#issuecomment-802395326","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1654","id":802395326,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMjM5NTMyNg==","user":{"login":"grantatspothero","id":43971820,"node_id":"MDQ6VXNlcjQzOTcxODIw","avatar_url":"https://avatars.githubusercontent.com/u/43971820?v=4","gravatar_id":"","url":"https://api.github.com/users/grantatspothero","html_url":"https://github.com/grantatspothero","followers_url":"https://api.github.com/users/grantatspothero/followers","following_url":"https://api.github.com/users/grantatspothero/following{/other_user}","gists_url":"https://api.github.com/users/grantatspothero/gists{/gist_id}","starred_url":"https://api.github.com/users/grantatspothero/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/grantatspothero/subscriptions","organizations_url":"https://api.github.com/users/grantatspothero/orgs","repos_url":"https://api.github.com/users/grantatspothero/repos","events_url":"https://api.github.com/users/grantatspothero/events{/privacy}","received_events_url":"https://api.github.com/users/grantatspothero/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-18T23:52:20Z","updated_at":"2021-03-18T23:52:20Z","author_association":"CONTRIBUTOR","body":"Confirmed this issue is still a problem and causes iceberg task planning to hang forever. \r\n\r\nUpgrading to avro 1.10.1 resolves the hanging problem, but as @mickjermsurawong-stripe mentioned there might be other side effects of upgrading that require testing.\r\n\r\nThis bug also affects trino's iceberg plugin:\r\nhttps://github.com/trinodb/trino/blame/master/plugin/trino-iceberg/pom.xml#L135-L145\r\n\r\nThey exclude the avro dep to pin to a specific version, but the version they pin to is 1.9.2:\r\nhttps://github.com/trinodb/trino/blob/master/pom.xml#L1305-L1309","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802395326/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802571890","html_url":"https://github.com/apache/iceberg/issues/2302#issuecomment-802571890","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2302","id":802571890,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMjU3MTg5MA==","user":{"login":"NageshB82","id":80257736,"node_id":"MDQ6VXNlcjgwMjU3NzM2","avatar_url":"https://avatars.githubusercontent.com/u/80257736?v=4","gravatar_id":"","url":"https://api.github.com/users/NageshB82","html_url":"https://github.com/NageshB82","followers_url":"https://api.github.com/users/NageshB82/followers","following_url":"https://api.github.com/users/NageshB82/following{/other_user}","gists_url":"https://api.github.com/users/NageshB82/gists{/gist_id}","starred_url":"https://api.github.com/users/NageshB82/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/NageshB82/subscriptions","organizations_url":"https://api.github.com/users/NageshB82/orgs","repos_url":"https://api.github.com/users/NageshB82/repos","events_url":"https://api.github.com/users/NageshB82/events{/privacy}","received_events_url":"https://api.github.com/users/NageshB82/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-19T05:38:25Z","updated_at":"2021-03-19T05:38:25Z","author_association":"NONE","body":"@RussellSpitzer Did you get a chance to look at it ?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802571890/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802593485","html_url":"https://github.com/apache/iceberg/issues/2351#issuecomment-802593485","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2351","id":802593485,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMjU5MzQ4NQ==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-19T06:35:18Z","updated_at":"2021-03-19T06:35:18Z","author_association":"MEMBER","body":"@yyanyy @jackye1995 Did you encounter the similar issue ? ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802593485/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802829643","html_url":"https://github.com/apache/iceberg/issues/2302#issuecomment-802829643","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2302","id":802829643,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMjgyOTY0Mw==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-19T13:23:41Z","updated_at":"2021-03-19T13:23:41Z","author_association":"MEMBER","body":"I have some thoughts but we still really need more info, if you have a chance could you capture the Spark UI for the job? In particular the stage in which the table is read? My main guess is the actually time spent is related to something like such as scheduling delay or some other Spark level thing. It really doesn't make any sense that it would be reading the files if changing the compression has no effect. I've seen the difference between snappy and gzip be 2x. Also the size of your data is so small it should be practically instantaneous.\n\n\nSo I would request to see the stage/job UI and possibly the table creation statement.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802829643/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802901170","html_url":"https://github.com/apache/iceberg/pull/2266#issuecomment-802901170","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2266","id":802901170,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMjkwMTE3MA==","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-19T15:06:51Z","updated_at":"2021-03-19T15:06:51Z","author_association":"COLLABORATOR","body":"Thanks for letting me know, @TGooch44 ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/802901170/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803044204","html_url":"https://github.com/apache/iceberg/pull/1100#issuecomment-803044204","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1100","id":803044204,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMzA0NDIwNA==","user":{"login":"xinbinhuang","id":27927454,"node_id":"MDQ6VXNlcjI3OTI3NDU0","avatar_url":"https://avatars.githubusercontent.com/u/27927454?v=4","gravatar_id":"","url":"https://api.github.com/users/xinbinhuang","html_url":"https://github.com/xinbinhuang","followers_url":"https://api.github.com/users/xinbinhuang/followers","following_url":"https://api.github.com/users/xinbinhuang/following{/other_user}","gists_url":"https://api.github.com/users/xinbinhuang/gists{/gist_id}","starred_url":"https://api.github.com/users/xinbinhuang/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xinbinhuang/subscriptions","organizations_url":"https://api.github.com/users/xinbinhuang/orgs","repos_url":"https://api.github.com/users/xinbinhuang/repos","events_url":"https://api.github.com/users/xinbinhuang/events{/privacy}","received_events_url":"https://api.github.com/users/xinbinhuang/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-19T18:56:00Z","updated_at":"2021-03-19T18:56:00Z","author_association":"CONTRIBUTOR","body":"Would love to see this merged in! Any updates on this?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803044204/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803112543","html_url":"https://github.com/apache/iceberg/pull/2328#issuecomment-803112543","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2328","id":803112543,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMzExMjU0Mw==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-19T20:39:01Z","updated_at":"2021-03-19T20:39:01Z","author_association":"CONTRIBUTOR","body":"This PR has been open for a while and we had quite some eyes on it. I don't see any open points that must be addressed in this commit. We have an open thread [here](https://github.com/apache/iceberg/pull/2328#discussion_r592944422) but I consider that as a follow-up item.\r\n\r\nPlease let me know if I missed anything.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803112543/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803115995","html_url":"https://github.com/apache/iceberg/issues/2351#issuecomment-803115995","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2351","id":803115995,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMzExNTk5NQ==","user":{"login":"yyanyy","id":71906210,"node_id":"MDQ6VXNlcjcxOTA2MjEw","avatar_url":"https://avatars.githubusercontent.com/u/71906210?v=4","gravatar_id":"","url":"https://api.github.com/users/yyanyy","html_url":"https://github.com/yyanyy","followers_url":"https://api.github.com/users/yyanyy/followers","following_url":"https://api.github.com/users/yyanyy/following{/other_user}","gists_url":"https://api.github.com/users/yyanyy/gists{/gist_id}","starred_url":"https://api.github.com/users/yyanyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yyanyy/subscriptions","organizations_url":"https://api.github.com/users/yyanyy/orgs","repos_url":"https://api.github.com/users/yyanyy/repos","events_url":"https://api.github.com/users/yyanyy/events{/privacy}","received_events_url":"https://api.github.com/users/yyanyy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-19T20:46:21Z","updated_at":"2021-03-19T22:00:24Z","author_association":"CONTRIBUTOR","body":"I don't think I have, but we have our internal implementation so our experiences wouldn't be the same. @jackye1995 did you encounter this before? \r\n\r\nI think this performance problem could be associated with other factors as well; how is the data/table look like, did you try the same query in sparksql or other engines? Is this a customized trino server, since I think trino 351 only has Iceberg 0.9?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803115995/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803125217","html_url":"https://github.com/apache/iceberg/issues/2348#issuecomment-803125217","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2348","id":803125217,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMzEyNTIxNw==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-19T20:53:48Z","updated_at":"2021-03-19T20:53:48Z","author_association":"CONTRIBUTOR","body":"I am afraid this will be hard to achieve as we need to be able to parse all expressions in our extension parser.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803125217/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803126081","html_url":"https://github.com/apache/iceberg/issues/2348#issuecomment-803126081","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2348","id":803126081,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMzEyNjA4MQ==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-19T20:55:42Z","updated_at":"2021-03-19T20:55:42Z","author_association":"MEMBER","body":"Something I considered would be if we just copied the Spark grammer, and then \"import it\", then our parser would get all the Spark things from that and we could still fail back to the delegate when we don't succeed. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803126081/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803133965","html_url":"https://github.com/apache/iceberg/issues/2348#issuecomment-803133965","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2348","id":803133965,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMzEzMzk2NQ==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-19T21:07:03Z","updated_at":"2021-03-19T21:07:03Z","author_association":"CONTRIBUTOR","body":"How would we handle changes in the Spark grammar from version to version?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803133965/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803154483","html_url":"https://github.com/apache/iceberg/issues/2348#issuecomment-803154483","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2348","id":803154483,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMzE1NDQ4Mw==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-19T21:51:50Z","updated_at":"2021-03-19T21:51:50Z","author_association":"MEMBER","body":"I think the only conflicts are when the Spark Grammar invalidates something that was previously allowed, because otherwise we just accept .. maybe I'm missing something there ... extensions could be built to be spark version specific ?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803154483/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803154665","html_url":"https://github.com/apache/iceberg/issues/2351#issuecomment-803154665","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2351","id":803154665,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMzE1NDY2NQ==","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-19T21:52:15Z","updated_at":"2021-03-19T21:52:15Z","author_association":"CONTRIBUTOR","body":"I think this is too little information, there are many conditions of the cluster that can cause this in rare situations, could you at least rerun the query many times and see if it can be reproduced?\r\n\r\nAlso could you also describe information around the table itself, its partition scheme, size, etc.?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803154665/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803158638","html_url":"https://github.com/apache/iceberg/pull/2328#issuecomment-803158638","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2328","id":803158638,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMzE1ODYzOA==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-19T22:00:42Z","updated_at":"2021-03-19T22:00:42Z","author_association":"CONTRIBUTOR","body":"If the operation is marked idempotent, then we can suppress the UnknownCommitStateException. That's the only thing I think we need to add right away in master.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803158638/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803159564","html_url":"https://github.com/apache/iceberg/pull/2328#issuecomment-803159564","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2328","id":803159564,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMzE1OTU2NA==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-19T22:02:41Z","updated_at":"2021-03-19T22:02:41Z","author_association":"MEMBER","body":"@rdblue You mean just fail with the root exception? Because we still want the job to be marked as failed even if it's idempotent. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803159564/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803188481","html_url":"https://github.com/apache/iceberg/pull/2353#issuecomment-803188481","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2353","id":803188481,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMzE4ODQ4MQ==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-19T23:25:07Z","updated_at":"2021-03-19T23:25:07Z","author_association":"CONTRIBUTOR","body":"cc @RussellSpitzer @rdblue @shardulm94 @rymurr @flyrain @karuppayya ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803188481/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803247112","html_url":"https://github.com/apache/iceberg/pull/2216#issuecomment-803247112","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2216","id":803247112,"node_id":"MDEyOklzc3VlQ29tbWVudDgwMzI0NzExMg==","user":{"login":"chenjunjiedada","id":3960228,"node_id":"MDQ6VXNlcjM5NjAyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3960228?v=4","gravatar_id":"","url":"https://api.github.com/users/chenjunjiedada","html_url":"https://github.com/chenjunjiedada","followers_url":"https://api.github.com/users/chenjunjiedada/followers","following_url":"https://api.github.com/users/chenjunjiedada/following{/other_user}","gists_url":"https://api.github.com/users/chenjunjiedada/gists{/gist_id}","starred_url":"https://api.github.com/users/chenjunjiedada/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenjunjiedada/subscriptions","organizations_url":"https://api.github.com/users/chenjunjiedada/orgs","repos_url":"https://api.github.com/users/chenjunjiedada/repos","events_url":"https://api.github.com/users/chenjunjiedada/events{/privacy}","received_events_url":"https://api.github.com/users/chenjunjiedada/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-03-20T04:34:50Z","updated_at":"2021-03-20T04:34:50Z","author_association":"COLLABORATOR","body":"@yyanyy Thanks a lot for your review! I Will update ASAP.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/803247112/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]