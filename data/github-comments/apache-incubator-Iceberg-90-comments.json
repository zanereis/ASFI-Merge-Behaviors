[{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828395638","html_url":"https://github.com/apache/iceberg/pull/2286#issuecomment-828395638","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2286","id":828395638,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODM5NTYzOA==","user":{"login":"rymurr","id":2022305,"node_id":"MDQ6VXNlcjIwMjIzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/2022305?v=4","gravatar_id":"","url":"https://api.github.com/users/rymurr","html_url":"https://github.com/rymurr","followers_url":"https://api.github.com/users/rymurr/followers","following_url":"https://api.github.com/users/rymurr/following{/other_user}","gists_url":"https://api.github.com/users/rymurr/gists{/gist_id}","starred_url":"https://api.github.com/users/rymurr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rymurr/subscriptions","organizations_url":"https://api.github.com/users/rymurr/orgs","repos_url":"https://api.github.com/users/rymurr/repos","events_url":"https://api.github.com/users/rymurr/events{/privacy}","received_events_url":"https://api.github.com/users/rymurr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T11:59:03Z","updated_at":"2021-04-28T11:59:03Z","author_association":"CONTRIBUTOR","body":"Awesome, thanks @mayursrivastava I will take one quick pass but I think its good to go! Thanks for your patience!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828395638/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828412403","html_url":"https://github.com/apache/iceberg/pull/2538#issuecomment-828412403","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2538","id":828412403,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODQxMjQwMw==","user":{"login":"chenjunjiedada","id":3960228,"node_id":"MDQ6VXNlcjM5NjAyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3960228?v=4","gravatar_id":"","url":"https://api.github.com/users/chenjunjiedada","html_url":"https://github.com/chenjunjiedada","followers_url":"https://api.github.com/users/chenjunjiedada/followers","following_url":"https://api.github.com/users/chenjunjiedada/following{/other_user}","gists_url":"https://api.github.com/users/chenjunjiedada/gists{/gist_id}","starred_url":"https://api.github.com/users/chenjunjiedada/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenjunjiedada/subscriptions","organizations_url":"https://api.github.com/users/chenjunjiedada/orgs","repos_url":"https://api.github.com/users/chenjunjiedada/repos","events_url":"https://api.github.com/users/chenjunjiedada/events{/privacy}","received_events_url":"https://api.github.com/users/chenjunjiedada/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T12:26:24Z","updated_at":"2021-04-28T12:26:24Z","author_association":"COLLABORATOR","body":"This is a separate part from https://github.com/apache/iceberg/pull/2372. cc @openinx @rdblue @aokolnychyi @RussellSpitzer @yyanyy ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828412403/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828427343","html_url":"https://github.com/apache/iceberg/pull/2538#issuecomment-828427343","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2538","id":828427343,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODQyNzM0Mw==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T12:48:27Z","updated_at":"2021-04-28T12:48:27Z","author_association":"MEMBER","body":"To be clear, this PR is to enable reading of data while optionally marking rows as deleted rather than actually filtering them out so the delete information can be used in other utilities to rewrite delete files into more compact forms?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828427343/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828449508","html_url":"https://github.com/apache/iceberg/pull/2538#issuecomment-828449508","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2538","id":828449508,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODQ0OTUwOA==","user":{"login":"chenjunjiedada","id":3960228,"node_id":"MDQ6VXNlcjM5NjAyMjg=","avatar_url":"https://avatars.githubusercontent.com/u/3960228?v=4","gravatar_id":"","url":"https://api.github.com/users/chenjunjiedada","html_url":"https://github.com/chenjunjiedada","followers_url":"https://api.github.com/users/chenjunjiedada/followers","following_url":"https://api.github.com/users/chenjunjiedada/following{/other_user}","gists_url":"https://api.github.com/users/chenjunjiedada/gists{/gist_id}","starred_url":"https://api.github.com/users/chenjunjiedada/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chenjunjiedada/subscriptions","organizations_url":"https://api.github.com/users/chenjunjiedada/orgs","repos_url":"https://api.github.com/users/chenjunjiedada/repos","events_url":"https://api.github.com/users/chenjunjiedada/events{/privacy}","received_events_url":"https://api.github.com/users/chenjunjiedada/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T13:20:04Z","updated_at":"2021-04-28T13:20:04Z","author_association":"COLLABORATOR","body":"@RussellSpitzer you are right! With a delete marker column, we can also simplify the current filtering logic a bit.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828449508/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828572473","html_url":"https://github.com/apache/iceberg/pull/2539#issuecomment-828572473","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2539","id":828572473,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODU3MjQ3Mw==","user":{"login":"danielcweeks","id":4925077,"node_id":"MDQ6VXNlcjQ5MjUwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4925077?v=4","gravatar_id":"","url":"https://api.github.com/users/danielcweeks","html_url":"https://github.com/danielcweeks","followers_url":"https://api.github.com/users/danielcweeks/followers","following_url":"https://api.github.com/users/danielcweeks/following{/other_user}","gists_url":"https://api.github.com/users/danielcweeks/gists{/gist_id}","starred_url":"https://api.github.com/users/danielcweeks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielcweeks/subscriptions","organizations_url":"https://api.github.com/users/danielcweeks/orgs","repos_url":"https://api.github.com/users/danielcweeks/repos","events_url":"https://api.github.com/users/danielcweeks/events{/privacy}","received_events_url":"https://api.github.com/users/danielcweeks/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T15:57:50Z","updated_at":"2021-04-28T15:57:50Z","author_association":"CONTRIBUTOR","body":"Hey, @edgarRd, if I remember correctly, the reason it is currently package is that the `S3URI` implementation covers most common S3 identifiers, but not all (there was some prior discussion about the complexity of this and lack of a good utility with the aws sdkv2 implementation).\r\n\r\nI'm thinking at this point that maybe we shouldn't expose the S3URI, but rather push the S3URI reference down into the `BaseS3File` so that we don't expose it at the `S3FileIO` level.\r\n\r\nDoes that make sense and would that address your use case?\r\n\r\nThanks,\r\nDan\r\n\r\n ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828572473/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828582634","html_url":"https://github.com/apache/iceberg/pull/2539#issuecomment-828582634","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2539","id":828582634,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODU4MjYzNA==","user":{"login":"edgarRd","id":266670,"node_id":"MDQ6VXNlcjI2NjY3MA==","avatar_url":"https://avatars.githubusercontent.com/u/266670?v=4","gravatar_id":"","url":"https://api.github.com/users/edgarRd","html_url":"https://github.com/edgarRd","followers_url":"https://api.github.com/users/edgarRd/followers","following_url":"https://api.github.com/users/edgarRd/following{/other_user}","gists_url":"https://api.github.com/users/edgarRd/gists{/gist_id}","starred_url":"https://api.github.com/users/edgarRd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edgarRd/subscriptions","organizations_url":"https://api.github.com/users/edgarRd/orgs","repos_url":"https://api.github.com/users/edgarRd/repos","events_url":"https://api.github.com/users/edgarRd/events{/privacy}","received_events_url":"https://api.github.com/users/edgarRd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T16:10:49Z","updated_at":"2021-04-28T16:10:49Z","author_association":"CONTRIBUTOR","body":"Hey, @danielcweeks - thanks for the quick reply. Yeah, I think that makes sense. I can update this PR with that change pushing `S3URI` down to `BaseS3File` and removing the direct reference from the constructors in `S3InputFile` and `S3OuputFile`.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828582634/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828640027","html_url":"https://github.com/apache/iceberg/pull/2539#issuecomment-828640027","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2539","id":828640027,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODY0MDAyNw==","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T17:29:05Z","updated_at":"2021-04-28T17:29:05Z","author_association":"CONTRIBUTOR","body":"Could you describe more about why you need them public to build a custom `FileIO`? I don't see a use case why `S3InputFile` and `S3OutputFile` should be directly referenced in any place outside the package itself, and `S3URI` is just a implementation detail for it.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828640027/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828642229","html_url":"https://github.com/apache/iceberg/issues/2535#issuecomment-828642229","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2535","id":828642229,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODY0MjIyOQ==","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T17:32:16Z","updated_at":"2021-04-28T17:32:16Z","author_association":"CONTRIBUTOR","body":"Yeah I do have a plan to add that documentation, was waiting for that catalog loading work to be done. Let me do it now.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828642229/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828663523","html_url":"https://github.com/apache/iceberg/pull/2539#issuecomment-828663523","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2539","id":828663523,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODY2MzUyMw==","user":{"login":"edgarRd","id":266670,"node_id":"MDQ6VXNlcjI2NjY3MA==","avatar_url":"https://avatars.githubusercontent.com/u/266670?v=4","gravatar_id":"","url":"https://api.github.com/users/edgarRd","html_url":"https://github.com/edgarRd","followers_url":"https://api.github.com/users/edgarRd/followers","following_url":"https://api.github.com/users/edgarRd/following{/other_user}","gists_url":"https://api.github.com/users/edgarRd/gists{/gist_id}","starred_url":"https://api.github.com/users/edgarRd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edgarRd/subscriptions","organizations_url":"https://api.github.com/users/edgarRd/orgs","repos_url":"https://api.github.com/users/edgarRd/repos","events_url":"https://api.github.com/users/edgarRd/events{/privacy}","received_events_url":"https://api.github.com/users/edgarRd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T18:01:57Z","updated_at":"2021-04-28T18:01:57Z","author_association":"CONTRIBUTOR","body":"@jackye1995 We have an internal implementation of a `FileIO` based on S3, `S3OutputFile` and `S3InputFile` are public so seems like they are already part of a public API, which helps since they are generic enough to handle other S3 use cases we have internally.\r\nI think the solution proposed by @danielcweeks works for most of the use cases given that `S3InputFile` and `S3OutputFile` are public by removing non-public arguments from the constructors.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828663523/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828671748","html_url":"https://github.com/apache/iceberg/pull/2539#issuecomment-828671748","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2539","id":828671748,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODY3MTc0OA==","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T18:13:44Z","updated_at":"2021-04-28T18:13:44Z","author_association":"CONTRIBUTOR","body":"I see, thanks for the explanation.\r\n\r\nI would suggest that we should continue to keep constructor package protected, and expose a public static method like \r\n\r\n```java\r\nS3InputFile.fromLocation(String location, S3Client client, AwsProperties awsProperties) {\r\n ...\r\n}\r\n```\r\n\r\nSo that the method signatures between `S3InputFile` and `HadoopInputFile` are consistent. The same applies for `S3OutputFile` versus `HadoopOutputFile`.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828671748/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828675842","html_url":"https://github.com/apache/iceberg/pull/2539#issuecomment-828675842","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2539","id":828675842,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODY3NTg0Mg==","user":{"login":"edgarRd","id":266670,"node_id":"MDQ6VXNlcjI2NjY3MA==","avatar_url":"https://avatars.githubusercontent.com/u/266670?v=4","gravatar_id":"","url":"https://api.github.com/users/edgarRd","html_url":"https://github.com/edgarRd","followers_url":"https://api.github.com/users/edgarRd/followers","following_url":"https://api.github.com/users/edgarRd/following{/other_user}","gists_url":"https://api.github.com/users/edgarRd/gists{/gist_id}","starred_url":"https://api.github.com/users/edgarRd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edgarRd/subscriptions","organizations_url":"https://api.github.com/users/edgarRd/orgs","repos_url":"https://api.github.com/users/edgarRd/repos","events_url":"https://api.github.com/users/edgarRd/events{/privacy}","received_events_url":"https://api.github.com/users/edgarRd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T18:19:36Z","updated_at":"2021-04-28T21:26:50Z","author_association":"CONTRIBUTOR","body":"> I would suggest that we should continue to keep constructor package protected, and expose a public static method like\r\n> \r\n> ```java\r\n> S3InputFile.fromLocation(String location, S3Client client, AwsProperties awsProperties) {\r\n>  ...\r\n> }\r\n> ```\r\n> \r\n> So that the method signatures between `S3InputFile` and `HadoopInputFile` are consistent. The same applies for `S3OutputFile` versus `HadoopOutputFile`.\r\n\r\nYeah, I thought about this - creating the static methods instead - but wanted to minimize the changes made. I do agree as well that it would be better to have consistency across methods on S3 vs Hadoop on Input/Output files.\r\n\r\nThanks for the input, I'll make the changes accordingly.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828675842/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828701983","html_url":"https://github.com/apache/iceberg/pull/2496#issuecomment-828701983","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2496","id":828701983,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODcwMTk4Mw==","user":{"login":"shenodaguirguis","id":45050883,"node_id":"MDQ6VXNlcjQ1MDUwODgz","avatar_url":"https://avatars.githubusercontent.com/u/45050883?v=4","gravatar_id":"","url":"https://api.github.com/users/shenodaguirguis","html_url":"https://github.com/shenodaguirguis","followers_url":"https://api.github.com/users/shenodaguirguis/followers","following_url":"https://api.github.com/users/shenodaguirguis/following{/other_user}","gists_url":"https://api.github.com/users/shenodaguirguis/gists{/gist_id}","starred_url":"https://api.github.com/users/shenodaguirguis/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/shenodaguirguis/subscriptions","organizations_url":"https://api.github.com/users/shenodaguirguis/orgs","repos_url":"https://api.github.com/users/shenodaguirguis/repos","events_url":"https://api.github.com/users/shenodaguirguis/events{/privacy}","received_events_url":"https://api.github.com/users/shenodaguirguis/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T18:57:04Z","updated_at":"2021-04-28T18:57:26Z","author_association":"NONE","body":"> I agree w/ @RussellSpitzer on complex types. How would a deeply nested structure look w/ default types?\r\n> I can definitely see the value in default values but I am having a hard time figuring out all the downstream effects: \r\n> how does Spark handle these, how do they work in the Arrow based vectorised readers etc. Some more context \r\n> on the effects on other systems would be useful for me to understand this change better.\r\n\r\nthanks for the question @rymurr . I see your concern. In this change, we are adding default values as optional, such that different readers don't have to worry handling it. I plan to handle default values in Spark's avro, orc and parquet readers. We can tackle them one by one. I don't foresee any potential complications except may be for the ser/deser of complex types.\r\n\r\nFor spark avro reader, which I will start with, here is how to handle default values:\r\n1. Converting Avro Schema to Iceberg Types takes place in AvroSchemaUtil::convert(Schema) which takes in an avro.Schema and uses the SchemaToType avro schema visitor to perform the conversion. To copy over the default value, we need to modify SchemaToType::record() method to handle the case when the field has default value and use the new NestedFiled API for defaultValue.\r\n2. BuildAvroProjection.record() changes: this is the mapping of the read schema code path. Here we need to add handling for cases when the field has a default value and construct the read avro schema correctly with default values.\r\n3. Reader side changes: since we constructed the read avro schema correctly with default values in BuildAvroProjection.record() in the previous step, avro libraries will handle filling any field with default value, if the field is not manifested\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828701983/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828708739","html_url":"https://github.com/apache/iceberg/issues/2540#issuecomment-828708739","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2540","id":828708739,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODcwODczOQ==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T19:07:55Z","updated_at":"2021-04-28T19:07:55Z","author_association":"MEMBER","body":"@raptond + @marton-bod Wdyt?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828708739/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828743787","html_url":"https://github.com/apache/iceberg/issues/2540#issuecomment-828743787","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2540","id":828743787,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODc0Mzc4Nw==","user":{"login":"marton-bod","id":19599214,"node_id":"MDQ6VXNlcjE5NTk5MjE0","avatar_url":"https://avatars.githubusercontent.com/u/19599214?v=4","gravatar_id":"","url":"https://api.github.com/users/marton-bod","html_url":"https://github.com/marton-bod","followers_url":"https://api.github.com/users/marton-bod/followers","following_url":"https://api.github.com/users/marton-bod/following{/other_user}","gists_url":"https://api.github.com/users/marton-bod/gists{/gist_id}","starred_url":"https://api.github.com/users/marton-bod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marton-bod/subscriptions","organizations_url":"https://api.github.com/users/marton-bod/orgs","repos_url":"https://api.github.com/users/marton-bod/repos","events_url":"https://api.github.com/users/marton-bod/events{/privacy}","received_events_url":"https://api.github.com/users/marton-bod/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T20:08:59Z","updated_at":"2021-04-28T20:08:59Z","author_association":"COLLABORATOR","body":"@RussellSpitzer From the Hive side we haven't noticed this issue as much, but I think this makes a lot of sense. Did you mean adding a JVM level lock per table? We should only be blocking threads which would like to commit to the same table simultaneously, not to any Iceberg table in general (since the HMS locks are also on the table level). I'm happy to take a crack at it tomorrow, but also happy to review if anyone else fancies working on this.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828743787/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828761375","html_url":"https://github.com/apache/iceberg/issues/2540#issuecomment-828761375","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2540","id":828761375,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODc2MTM3NQ==","user":{"login":"pvary","id":19705742,"node_id":"MDQ6VXNlcjE5NzA1NzQy","avatar_url":"https://avatars.githubusercontent.com/u/19705742?v=4","gravatar_id":"","url":"https://api.github.com/users/pvary","html_url":"https://github.com/pvary","followers_url":"https://api.github.com/users/pvary/followers","following_url":"https://api.github.com/users/pvary/following{/other_user}","gists_url":"https://api.github.com/users/pvary/gists{/gist_id}","starred_url":"https://api.github.com/users/pvary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvary/subscriptions","organizations_url":"https://api.github.com/users/pvary/orgs","repos_url":"https://api.github.com/users/pvary/repos","events_url":"https://api.github.com/users/pvary/events{/privacy}","received_events_url":"https://api.github.com/users/pvary/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T20:38:01Z","updated_at":"2021-04-28T20:38:01Z","author_association":"CONTRIBUTOR","body":"HMS locks are fair. If we have multiple HS2 instances doing the commits then we lose this fairness. We can use fair locks inside a JVM, but cross JVM fairness would be lost. We either share the HMS lock between threads then we risk starving the threads on another JVM, or we release the HMS lock, in this case the commits will happen in a Round Robin fashion between the JVMs.\r\n\r\nAlso for MR, or TezAM side commits are running in separate JVMs, so JVM level locks does not help there (and does not hurt that much) \r\n\r\n@RussellSpitzer: If you can patch your HMS, you might want to try out this two patches:\r\n- https://issues.apache.org/jira/browse/HIVE-22906\r\n- https://issues.apache.org/jira/browse/HIVE-22888","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828761375/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828777965","html_url":"https://github.com/apache/iceberg/issues/2540#issuecomment-828777965","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2540","id":828777965,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODc3Nzk2NQ==","user":{"login":"raptond","id":30231978,"node_id":"MDQ6VXNlcjMwMjMxOTc4","avatar_url":"https://avatars.githubusercontent.com/u/30231978?v=4","gravatar_id":"","url":"https://api.github.com/users/raptond","html_url":"https://github.com/raptond","followers_url":"https://api.github.com/users/raptond/followers","following_url":"https://api.github.com/users/raptond/following{/other_user}","gists_url":"https://api.github.com/users/raptond/gists{/gist_id}","starred_url":"https://api.github.com/users/raptond/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raptond/subscriptions","organizations_url":"https://api.github.com/users/raptond/orgs","repos_url":"https://api.github.com/users/raptond/repos","events_url":"https://api.github.com/users/raptond/events{/privacy}","received_events_url":"https://api.github.com/users/raptond/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T21:02:19Z","updated_at":"2021-04-28T21:02:19Z","author_association":"CONTRIBUTOR","body":"The problem we face internally with several customers is, after a while, the Iceberg table cannot be added any more data. When I say \"any more data\", I mean, data files are created, snapshot is created but the commit can never be successful. At this point, a manual intervention of clearing the locks for the given iceberg table is required.\r\n\r\nSome cases that we investigated had \r\n1. several jobs \r\n2. and within each job, several threads\r\n\r\ntrying to commit to the same Iceberg table. \r\n\r\n> We should only be blocking threads which would like to commit to the same table simultaneously, not to any Iceberg table in general (since the HMS locks are also on the table level).\r\n👍 to this. \r\n\r\n>  we release the HMS lock, in this case the commits will happen in a Round Robin fashion between the JVMs.\r\n👍 to this too.\r\n\r\nThe `share-the-hms-lock-within-JVM-for-a-single-iceberg-table` proposed by @RussellSpitzer would save the situation (2) very effectively. IMHO with additional considerations like, [a] release the HMS lock as soon as the last thread returned the lock back and [b] releasing it by time for fair usage even if more threads are in the queue waiting for the lock. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828777965/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828779435","html_url":"https://github.com/apache/iceberg/issues/2540#issuecomment-828779435","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2540","id":828779435,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODc3OTQzNQ==","user":{"login":"raptond","id":30231978,"node_id":"MDQ6VXNlcjMwMjMxOTc4","avatar_url":"https://avatars.githubusercontent.com/u/30231978?v=4","gravatar_id":"","url":"https://api.github.com/users/raptond","html_url":"https://github.com/raptond","followers_url":"https://api.github.com/users/raptond/followers","following_url":"https://api.github.com/users/raptond/following{/other_user}","gists_url":"https://api.github.com/users/raptond/gists{/gist_id}","starred_url":"https://api.github.com/users/raptond/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raptond/subscriptions","organizations_url":"https://api.github.com/users/raptond/orgs","repos_url":"https://api.github.com/users/raptond/repos","events_url":"https://api.github.com/users/raptond/events{/privacy}","received_events_url":"https://api.github.com/users/raptond/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T21:05:01Z","updated_at":"2021-04-28T21:05:01Z","author_association":"CONTRIBUTOR","body":"Want to also call out - for issue (1), we will need to find a way to clear up the expired locks which are still blocking the lock chain. \r\n\r\nIn this problem space of (1), I believe https://github.com/apache/iceberg/pull/2263 would solve a majority of cases, leaving just the `driver-crashing-after-acquiring-the-lock` cases. May be a case for HMS cleanup service. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828779435/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828781745","html_url":"https://github.com/apache/iceberg/issues/2540#issuecomment-828781745","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2540","id":828781745,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODc4MTc0NQ==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T21:09:06Z","updated_at":"2021-04-28T21:09:06Z","author_association":"MEMBER","body":"@pvary I wish we could :) But we have tons of users with their own HMS code and I don't think it would be trivial for us to get them all on the same page.\r\n\r\n@marton-bod That's exactly what I was thinking about. I wanted to make sure there wasn't anything I was missing that would have this be slower or cause side effects that everyone trying to acquire the lock at once might have.\r\n\r\nBasically one JVM never allows more than one thread to run doCommit() for the same table at the same time.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828781745/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828785994","html_url":"https://github.com/apache/iceberg/issues/2541#issuecomment-828785994","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2541","id":828785994,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODc4NTk5NA==","user":{"login":"marton-bod","id":19599214,"node_id":"MDQ6VXNlcjE5NTk5MjE0","avatar_url":"https://avatars.githubusercontent.com/u/19599214?v=4","gravatar_id":"","url":"https://api.github.com/users/marton-bod","html_url":"https://github.com/marton-bod","followers_url":"https://api.github.com/users/marton-bod/followers","following_url":"https://api.github.com/users/marton-bod/following{/other_user}","gists_url":"https://api.github.com/users/marton-bod/gists{/gist_id}","starred_url":"https://api.github.com/users/marton-bod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marton-bod/subscriptions","organizations_url":"https://api.github.com/users/marton-bod/orgs","repos_url":"https://api.github.com/users/marton-bod/repos","events_url":"https://api.github.com/users/marton-bod/events{/privacy}","received_events_url":"https://api.github.com/users/marton-bod/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T21:17:06Z","updated_at":"2021-04-28T21:17:06Z","author_association":"COLLABORATOR","body":"@tprelle Hive writes using Tez are currently unsupported and may contain several problems. Our current [hive docs](https://github.com/apache/iceberg/blob/master/site/docs/hive.md#hive-query-engines) mention support for both mr and tez, but it's misleading because that's currently only for hive reads, not writes - we'll make changes to make that clearer.\r\n\r\nWhich version of Hive are you using? In the meantime, can you switch to mr engine and rerun your queries and see if the issue persists?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828785994/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828791623","html_url":"https://github.com/apache/iceberg/issues/2540#issuecomment-828791623","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2540","id":828791623,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODc5MTYyMw==","user":{"login":"pvary","id":19705742,"node_id":"MDQ6VXNlcjE5NzA1NzQy","avatar_url":"https://avatars.githubusercontent.com/u/19705742?v=4","gravatar_id":"","url":"https://api.github.com/users/pvary","html_url":"https://github.com/pvary","followers_url":"https://api.github.com/users/pvary/followers","following_url":"https://api.github.com/users/pvary/following{/other_user}","gists_url":"https://api.github.com/users/pvary/gists{/gist_id}","starred_url":"https://api.github.com/users/pvary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvary/subscriptions","organizations_url":"https://api.github.com/users/pvary/orgs","repos_url":"https://api.github.com/users/pvary/repos","events_url":"https://api.github.com/users/pvary/events{/privacy}","received_events_url":"https://api.github.com/users/pvary/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T21:27:55Z","updated_at":"2021-04-28T21:27:55Z","author_association":"CONTRIBUTOR","body":"> Want to also call out - for issue (1), we will need to find a way to clear up the expired locks which are still blocking the lock chain.\r\n> \r\n> In this problem space of (1), I believe #2263 would solve a majority of cases, leaving just the `driver-crashing-after-acquiring-the-lock` cases. May be a case for HMS cleanup service.\r\n\r\nI think you could use the https://github.com/apache/hive/blob/rel/release-3.1.2/standalone-metastore/src/main/java/org/apache/hadoop/hive/metastore/txn/AcidHouseKeeperService.java\r\n\r\nThis is an existing service in HMS to remove stale locks. \r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828791623/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828793923","html_url":"https://github.com/apache/iceberg/pull/2521#issuecomment-828793923","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2521","id":828793923,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODc5MzkyMw==","user":{"login":"yyanyy","id":71906210,"node_id":"MDQ6VXNlcjcxOTA2MjEw","avatar_url":"https://avatars.githubusercontent.com/u/71906210?v=4","gravatar_id":"","url":"https://api.github.com/users/yyanyy","html_url":"https://github.com/yyanyy","followers_url":"https://api.github.com/users/yyanyy/followers","following_url":"https://api.github.com/users/yyanyy/following{/other_user}","gists_url":"https://api.github.com/users/yyanyy/gists{/gist_id}","starred_url":"https://api.github.com/users/yyanyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yyanyy/subscriptions","organizations_url":"https://api.github.com/users/yyanyy/orgs","repos_url":"https://api.github.com/users/yyanyy/repos","events_url":"https://api.github.com/users/yyanyy/events{/privacy}","received_events_url":"https://api.github.com/users/yyanyy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T21:32:34Z","updated_at":"2021-04-28T21:45:16Z","author_association":"CONTRIBUTOR","body":"> I was wondering about the other NPE in #2495, i was hoping that would have been caught by some backwards compatibility tests. I also have no problem with doing more testing and such in another pr\r\n\r\nI think the hard part is that this specific change (and some other spec changes) is adding a field regardless of table versions, and to ensure backward compatibility which means to test on a table before this logic is introduced, we need to have a fine grain control of creating these metadata files to mimic the old behavior when creating the table, so that we can drop things introduced in the new logic. And this basically means to create the table from scratch. \r\n - Tests like `TestManifestListVersions` covers part of that but it only test the basic interaction, no the end to end table operation exists in such tests that could catch problem in `ManifestFileUtil` which is used during table commit. \r\n - Some tests extending `TableTestBase` in core package try to test backward compatibility by running tests with table v1 and v2 format, but again they won't capture logic introduced in all versions of the spec. \r\n\r\nI think a way of achieving it could be to add resource files (including data file and all metadata files all the way to the json file) with all optional/later introduced fields missing, and these resource files could be readily readable as an existing table (instead of creating tables via code as those tests currently do). And then we let tests that extend `TableTestBase` to interact with this table. I've created an issue to track this: #2542\r\n\r\n---\r\nI'm merging in this change to unblock bug fixes, but please feel free to continue the discussion here/in #2542 or ping me directly on slack. Thank you again @chenjunjiedada @RussellSpitzer @jackye1995 for the review and quick response! And thanks Jack for creating the issue!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828793923/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828798539","html_url":"https://github.com/apache/iceberg/issues/2540#issuecomment-828798539","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2540","id":828798539,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODc5ODUzOQ==","user":{"login":"raptond","id":30231978,"node_id":"MDQ6VXNlcjMwMjMxOTc4","avatar_url":"https://avatars.githubusercontent.com/u/30231978?v=4","gravatar_id":"","url":"https://api.github.com/users/raptond","html_url":"https://github.com/raptond","followers_url":"https://api.github.com/users/raptond/followers","following_url":"https://api.github.com/users/raptond/following{/other_user}","gists_url":"https://api.github.com/users/raptond/gists{/gist_id}","starred_url":"https://api.github.com/users/raptond/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/raptond/subscriptions","organizations_url":"https://api.github.com/users/raptond/orgs","repos_url":"https://api.github.com/users/raptond/repos","events_url":"https://api.github.com/users/raptond/events{/privacy}","received_events_url":"https://api.github.com/users/raptond/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T21:41:05Z","updated_at":"2021-04-28T21:41:05Z","author_association":"CONTRIBUTOR","body":"Thanks @pvary. I didn't realize we need this flag to turn it on - `hive.compactor.initiator.on`.\r\nThis should take care of the stale locks.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828798539/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828807127","html_url":"https://github.com/apache/iceberg/pull/2543#issuecomment-828807127","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2543","id":828807127,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODgwNzEyNw==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T21:56:49Z","updated_at":"2021-04-28T21:56:49Z","author_association":"MEMBER","body":"Fixes #2530","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828807127/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828839921","html_url":"https://github.com/apache/iceberg/pull/2520#issuecomment-828839921","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2520","id":828839921,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODgzOTkyMQ==","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-28T23:15:02Z","updated_at":"2021-04-28T23:15:02Z","author_association":"CONTRIBUTOR","body":"The change from OutputFile to EncryptedOutputFile looks weird to me as well. Logic is OK to me though. Just brainstorming ideas. \r\nOption 1. We can rename EncryptedOutputFile something else, like GenericOutputFile, which doesn’t confuse people from name perspective. \r\nOption 2. Have a new interface(e.g. GenericOutputFile) inherited by both EncryptedOutputFile and Output file. The interface can be empty. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828839921/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828901103","html_url":"https://github.com/apache/iceberg/pull/2465#issuecomment-828901103","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2465","id":828901103,"node_id":"MDEyOklzc3VlQ29tbWVudDgyODkwMTEwMw==","user":{"login":"yyanyy","id":71906210,"node_id":"MDQ6VXNlcjcxOTA2MjEw","avatar_url":"https://avatars.githubusercontent.com/u/71906210?v=4","gravatar_id":"","url":"https://api.github.com/users/yyanyy","html_url":"https://github.com/yyanyy","followers_url":"https://api.github.com/users/yyanyy/followers","following_url":"https://api.github.com/users/yyanyy/following{/other_user}","gists_url":"https://api.github.com/users/yyanyy/gists{/gist_id}","starred_url":"https://api.github.com/users/yyanyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yyanyy/subscriptions","organizations_url":"https://api.github.com/users/yyanyy/orgs","repos_url":"https://api.github.com/users/yyanyy/repos","events_url":"https://api.github.com/users/yyanyy/events{/privacy}","received_events_url":"https://api.github.com/users/yyanyy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T02:30:18Z","updated_at":"2021-04-29T02:30:18Z","author_association":"CONTRIBUTOR","body":"LGTM overall, just want to bring the below comment (that's not really related to the focus of this PR itself) I had originally [here](https://github.com/apache/iceberg/pull/2465#discussion_r616222010) to people's attention and make sure we are all aligned, since this PR does change the behavior of what we preserve in metadata fields. If we do go with the current approach, I'll raise a separate PR to mention the usage of schema ID and the caveat in spec. \r\n\r\nAlso @pvary since hive module uses schema `toJson` indicated in the comment below. \r\n\r\n> Basically I think there are a lot of places where this method is called for serialization/deserialization of the schema as well as preserve the schema to some file metadata, and at that point sometimes schema object is already transformed/projected so it is no longer an existing schema of the table, and thus shouldn't have schema ID. Since schema ID is in theory only useful when retrieved directly from table metadata to get the right schema version for time travel, I think it's better to not explicitly write a schema Id except for writing to table metadata file, to avoid persisting an incorrect version.\r\n> ... \r\n>Thanks for the response @rdblue ! Just want to mention an additional case: in addition to the possibility of writing incorrect ID for a table schema, writing id here also makes us persisting id for things not related to the table schema itself, e.g. [manifest list](https://github.com/apache/iceberg/blob/master/core/src/main/java/org/apache/iceberg/ManifestListWriter.java#L94-L98) and [delete files](https://github.com/apache/iceberg/blob/master/parquet/src/main/java/org/apache/iceberg/parquet/Parquet.java#L387-L414). But if we are fine with writing incorrect ID, we probably will be fine with writing ID for non-schema structs as well...\r\n> \r\n> I guess essentially we are choosing between 1) simpler code with potential confusing IDs and 2) code complexities (due to avoid writing incorrect/unuseful IDs); I personally would prefer the latter but I don't strongly oppose the former if we think it's easier to reason about in code. Also we might want to involve people from Hive as part of this discussion since they are using this method as well to preserve the schema ([example](https://github.com/apache/iceberg/blob/master/mr/src/main/java/org/apache/iceberg/mr/hive/HiveIcebergMetaHook.java#L119))\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/828901103/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829117889","html_url":"https://github.com/apache/iceberg/pull/2465#issuecomment-829117889","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2465","id":829117889,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTExNzg4OQ==","user":{"login":"pvary","id":19705742,"node_id":"MDQ6VXNlcjE5NzA1NzQy","avatar_url":"https://avatars.githubusercontent.com/u/19705742?v=4","gravatar_id":"","url":"https://api.github.com/users/pvary","html_url":"https://github.com/pvary","followers_url":"https://api.github.com/users/pvary/followers","following_url":"https://api.github.com/users/pvary/following{/other_user}","gists_url":"https://api.github.com/users/pvary/gists{/gist_id}","starred_url":"https://api.github.com/users/pvary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvary/subscriptions","organizations_url":"https://api.github.com/users/pvary/orgs","repos_url":"https://api.github.com/users/pvary/repos","events_url":"https://api.github.com/users/pvary/events{/privacy}","received_events_url":"https://api.github.com/users/pvary/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T10:28:33Z","updated_at":"2021-04-29T10:28:33Z","author_association":"CONTRIBUTOR","body":"> Also @pvary since hive module uses schema `toJson` indicated in the comment below.\r\n\r\nThanks @yyanyy for the notification.\r\n\r\nChecked the Hive related codepaths and I do not see any issue with the new Id which are not covered by the tests.\r\nWe do not persist the schema json. We use the `toJson` to serialize the schema during the create table call, which should be ok I think.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829117889/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829176570","html_url":"https://github.com/apache/iceberg/pull/2286#issuecomment-829176570","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2286","id":829176570,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTE3NjU3MA==","user":{"login":"mayursrivastava","id":8659624,"node_id":"MDQ6VXNlcjg2NTk2MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8659624?v=4","gravatar_id":"","url":"https://api.github.com/users/mayursrivastava","html_url":"https://github.com/mayursrivastava","followers_url":"https://api.github.com/users/mayursrivastava/followers","following_url":"https://api.github.com/users/mayursrivastava/following{/other_user}","gists_url":"https://api.github.com/users/mayursrivastava/gists{/gist_id}","starred_url":"https://api.github.com/users/mayursrivastava/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayursrivastava/subscriptions","organizations_url":"https://api.github.com/users/mayursrivastava/orgs","repos_url":"https://api.github.com/users/mayursrivastava/repos","events_url":"https://api.github.com/users/mayursrivastava/events{/privacy}","received_events_url":"https://api.github.com/users/mayursrivastava/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T12:00:55Z","updated_at":"2021-04-29T12:00:55Z","author_association":"CONTRIBUTOR","body":"Thanks @rymurr for your time to look into this. I have a question: how will this pr get merged?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829176570/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829218210","html_url":"https://github.com/apache/iceberg/pull/2286#issuecomment-829218210","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2286","id":829218210,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTIxODIxMA==","user":{"login":"rymurr","id":2022305,"node_id":"MDQ6VXNlcjIwMjIzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/2022305?v=4","gravatar_id":"","url":"https://api.github.com/users/rymurr","html_url":"https://github.com/rymurr","followers_url":"https://api.github.com/users/rymurr/followers","following_url":"https://api.github.com/users/rymurr/following{/other_user}","gists_url":"https://api.github.com/users/rymurr/gists{/gist_id}","starred_url":"https://api.github.com/users/rymurr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rymurr/subscriptions","organizations_url":"https://api.github.com/users/rymurr/orgs","repos_url":"https://api.github.com/users/rymurr/repos","events_url":"https://api.github.com/users/rymurr/events{/privacy}","received_events_url":"https://api.github.com/users/rymurr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T13:01:29Z","updated_at":"2021-04-29T13:01:29Z","author_association":"CONTRIBUTOR","body":"> Thanks @rymurr for your time to look into this. I have a question: how will this pr get merged?\r\n\r\nI will merge it today. Just wanted to give a few hours to see if anyone else wants to chime in","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829218210/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829227389","html_url":"https://github.com/apache/iceberg/issues/2541#issuecomment-829227389","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2541","id":829227389,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTIyNzM4OQ==","user":{"login":"tprelle","id":59021490,"node_id":"MDQ6VXNlcjU5MDIxNDkw","avatar_url":"https://avatars.githubusercontent.com/u/59021490?v=4","gravatar_id":"","url":"https://api.github.com/users/tprelle","html_url":"https://github.com/tprelle","followers_url":"https://api.github.com/users/tprelle/followers","following_url":"https://api.github.com/users/tprelle/following{/other_user}","gists_url":"https://api.github.com/users/tprelle/gists{/gist_id}","starred_url":"https://api.github.com/users/tprelle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tprelle/subscriptions","organizations_url":"https://api.github.com/users/tprelle/orgs","repos_url":"https://api.github.com/users/tprelle/repos","events_url":"https://api.github.com/users/tprelle/events{/privacy}","received_events_url":"https://api.github.com/users/tprelle/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T13:14:03Z","updated_at":"2021-04-29T13:14:03Z","author_association":"CONTRIBUTOR","body":"Hi @marton-bod,\r\nOk i was just want to test if the patch or hive and tez was working.\r\nIt's a custom hive 3.1 version based on HDP 3.1.5 that we have multiple patches for different issue and tez 0.10 with https://issues.apache.org/jira/browse/TEZ-4248 and https://issues.apache.org/jira/browse/TEZ-4264. So no MR. \r\nI will check if i found where are the issue and how to fix it. \r\nI was just checking if i missing a Tez or Hive patch but i think it's maybe iceberg output commiter","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829227389/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829234203","html_url":"https://github.com/apache/iceberg/pull/2544#issuecomment-829234203","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2544","id":829234203,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTIzNDIwMw==","user":{"login":"pvary","id":19705742,"node_id":"MDQ6VXNlcjE5NzA1NzQy","avatar_url":"https://avatars.githubusercontent.com/u/19705742?v=4","gravatar_id":"","url":"https://api.github.com/users/pvary","html_url":"https://github.com/pvary","followers_url":"https://api.github.com/users/pvary/followers","following_url":"https://api.github.com/users/pvary/following{/other_user}","gists_url":"https://api.github.com/users/pvary/gists{/gist_id}","starred_url":"https://api.github.com/users/pvary/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/pvary/subscriptions","organizations_url":"https://api.github.com/users/pvary/orgs","repos_url":"https://api.github.com/users/pvary/repos","events_url":"https://api.github.com/users/pvary/events{/privacy}","received_events_url":"https://api.github.com/users/pvary/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T13:23:24Z","updated_at":"2021-04-29T13:23:24Z","author_association":"CONTRIBUTOR","body":"@jackye1995: Big thanks for picking this up! It was on our TODO list, but we kept deprioritizing it.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829234203/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829237496","html_url":"https://github.com/apache/iceberg/issues/2532#issuecomment-829237496","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2532","id":829237496,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTIzNzQ5Ng==","user":{"login":"taherk77","id":29517740,"node_id":"MDQ6VXNlcjI5NTE3NzQw","avatar_url":"https://avatars.githubusercontent.com/u/29517740?v=4","gravatar_id":"","url":"https://api.github.com/users/taherk77","html_url":"https://github.com/taherk77","followers_url":"https://api.github.com/users/taherk77/followers","following_url":"https://api.github.com/users/taherk77/following{/other_user}","gists_url":"https://api.github.com/users/taherk77/gists{/gist_id}","starred_url":"https://api.github.com/users/taherk77/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/taherk77/subscriptions","organizations_url":"https://api.github.com/users/taherk77/orgs","repos_url":"https://api.github.com/users/taherk77/repos","events_url":"https://api.github.com/users/taherk77/events{/privacy}","received_events_url":"https://api.github.com/users/taherk77/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T13:27:53Z","updated_at":"2021-04-29T13:27:53Z","author_association":"NONE","body":"I would like to work on this issue. Can someone please guide a little and give more context?\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829237496/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829275611","html_url":"https://github.com/apache/iceberg/issues/2532#issuecomment-829275611","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2532","id":829275611,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTI3NTYxMQ==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T14:16:28Z","updated_at":"2021-04-29T14:16:28Z","author_association":"MEMBER","body":"@taherk77 That would be awesome!\r\n\r\nhttps://github.com/apache/iceberg/issues/2542#issue-870411640 Here are @yyanyy 's notes on the problem. Basically we want to make sure that whether you have a v1 table or a v2 table, the metadata table code reads correctly. Our previous tests cover converting manifests but don't make sure that manifests from both versions can be accessed by the same metadata table code.\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829275611/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829310031","html_url":"https://github.com/apache/iceberg/issues/2541#issuecomment-829310031","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2541","id":829310031,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTMxMDAzMQ==","user":{"login":"tprelle","id":59021490,"node_id":"MDQ6VXNlcjU5MDIxNDkw","avatar_url":"https://avatars.githubusercontent.com/u/59021490?v=4","gravatar_id":"","url":"https://api.github.com/users/tprelle","html_url":"https://github.com/tprelle","followers_url":"https://api.github.com/users/tprelle/followers","following_url":"https://api.github.com/users/tprelle/following{/other_user}","gists_url":"https://api.github.com/users/tprelle/gists{/gist_id}","starred_url":"https://api.github.com/users/tprelle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tprelle/subscriptions","organizations_url":"https://api.github.com/users/tprelle/orgs","repos_url":"https://api.github.com/users/tprelle/repos","events_url":"https://api.github.com/users/tprelle/events{/privacy}","received_events_url":"https://api.github.com/users/tprelle/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T14:58:46Z","updated_at":"2021-04-29T14:58:46Z","author_association":"CONTRIBUTOR","body":"It's maybe comming of my version of hive because in theory the code look good\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829310031/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829319321","html_url":"https://github.com/apache/iceberg/issues/2541#issuecomment-829319321","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2541","id":829319321,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTMxOTMyMQ==","user":{"login":"marton-bod","id":19599214,"node_id":"MDQ6VXNlcjE5NTk5MjE0","avatar_url":"https://avatars.githubusercontent.com/u/19599214?v=4","gravatar_id":"","url":"https://api.github.com/users/marton-bod","html_url":"https://github.com/marton-bod","followers_url":"https://api.github.com/users/marton-bod/followers","following_url":"https://api.github.com/users/marton-bod/following{/other_user}","gists_url":"https://api.github.com/users/marton-bod/gists{/gist_id}","starred_url":"https://api.github.com/users/marton-bod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marton-bod/subscriptions","organizations_url":"https://api.github.com/users/marton-bod/orgs","repos_url":"https://api.github.com/users/marton-bod/repos","events_url":"https://api.github.com/users/marton-bod/events{/privacy}","received_events_url":"https://api.github.com/users/marton-bod/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T15:10:12Z","updated_at":"2021-04-29T15:10:12Z","author_association":"COLLABORATOR","body":"Hi @tprelle, Most likely the issue you observed is because in Hive 3.1, task commits for Tez are not yet implemented. It was recently added as a feature: https://issues.apache.org/jira/browse/HIVE-24629, but not yet released. So quite simply, while the `commitTask` logic is there in the `HiveIcebergOutputCommitter`, it's not actually invoked by Hive or Tez at any point. Although it's no consolation for you, this is not a problem for MR, where the invocation is in place.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829319321/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829413551","html_url":"https://github.com/apache/iceberg/pull/2539#issuecomment-829413551","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2539","id":829413551,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTQxMzU1MQ==","user":{"login":"danielcweeks","id":4925077,"node_id":"MDQ6VXNlcjQ5MjUwNzc=","avatar_url":"https://avatars.githubusercontent.com/u/4925077?v=4","gravatar_id":"","url":"https://api.github.com/users/danielcweeks","html_url":"https://github.com/danielcweeks","followers_url":"https://api.github.com/users/danielcweeks/followers","following_url":"https://api.github.com/users/danielcweeks/following{/other_user}","gists_url":"https://api.github.com/users/danielcweeks/gists{/gist_id}","starred_url":"https://api.github.com/users/danielcweeks/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/danielcweeks/subscriptions","organizations_url":"https://api.github.com/users/danielcweeks/orgs","repos_url":"https://api.github.com/users/danielcweeks/repos","events_url":"https://api.github.com/users/danielcweeks/events{/privacy}","received_events_url":"https://api.github.com/users/danielcweeks/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T16:39:21Z","updated_at":"2021-04-29T16:39:21Z","author_association":"CONTRIBUTOR","body":"+1 LGTM. Thanks @edgarRd and @jackye1995 ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829413551/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829465334","html_url":"https://github.com/apache/iceberg/pull/2286#issuecomment-829465334","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2286","id":829465334,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTQ2NTMzNA==","user":{"login":"mayursrivastava","id":8659624,"node_id":"MDQ6VXNlcjg2NTk2MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8659624?v=4","gravatar_id":"","url":"https://api.github.com/users/mayursrivastava","html_url":"https://github.com/mayursrivastava","followers_url":"https://api.github.com/users/mayursrivastava/followers","following_url":"https://api.github.com/users/mayursrivastava/following{/other_user}","gists_url":"https://api.github.com/users/mayursrivastava/gists{/gist_id}","starred_url":"https://api.github.com/users/mayursrivastava/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayursrivastava/subscriptions","organizations_url":"https://api.github.com/users/mayursrivastava/orgs","repos_url":"https://api.github.com/users/mayursrivastava/repos","events_url":"https://api.github.com/users/mayursrivastava/events{/privacy}","received_events_url":"https://api.github.com/users/mayursrivastava/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T17:50:17Z","updated_at":"2021-04-29T17:50:17Z","author_association":"CONTRIBUTOR","body":"Thank you @rymurr ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829465334/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829471521","html_url":"https://github.com/apache/iceberg/pull/2286#issuecomment-829471521","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2286","id":829471521,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTQ3MTUyMQ==","user":{"login":"rymurr","id":2022305,"node_id":"MDQ6VXNlcjIwMjIzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/2022305?v=4","gravatar_id":"","url":"https://api.github.com/users/rymurr","html_url":"https://github.com/rymurr","followers_url":"https://api.github.com/users/rymurr/followers","following_url":"https://api.github.com/users/rymurr/following{/other_user}","gists_url":"https://api.github.com/users/rymurr/gists{/gist_id}","starred_url":"https://api.github.com/users/rymurr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rymurr/subscriptions","organizations_url":"https://api.github.com/users/rymurr/orgs","repos_url":"https://api.github.com/users/rymurr/repos","events_url":"https://api.github.com/users/rymurr/events{/privacy}","received_events_url":"https://api.github.com/users/rymurr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T17:59:06Z","updated_at":"2021-04-29T17:59:06Z","author_association":"CONTRIBUTOR","body":"no prob @mayursrivastava ! Thanks again for the contribution!\r\n\r\nI noticed that the build failed after the merge. Could you just double check that it was transient and unrelated to your change?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829471521/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829474850","html_url":"https://github.com/apache/iceberg/pull/2286#issuecomment-829474850","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2286","id":829474850,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTQ3NDg1MA==","user":{"login":"mayursrivastava","id":8659624,"node_id":"MDQ6VXNlcjg2NTk2MjQ=","avatar_url":"https://avatars.githubusercontent.com/u/8659624?v=4","gravatar_id":"","url":"https://api.github.com/users/mayursrivastava","html_url":"https://github.com/mayursrivastava","followers_url":"https://api.github.com/users/mayursrivastava/followers","following_url":"https://api.github.com/users/mayursrivastava/following{/other_user}","gists_url":"https://api.github.com/users/mayursrivastava/gists{/gist_id}","starred_url":"https://api.github.com/users/mayursrivastava/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/mayursrivastava/subscriptions","organizations_url":"https://api.github.com/users/mayursrivastava/orgs","repos_url":"https://api.github.com/users/mayursrivastava/repos","events_url":"https://api.github.com/users/mayursrivastava/events{/privacy}","received_events_url":"https://api.github.com/users/mayursrivastava/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T18:04:17Z","updated_at":"2021-04-29T18:04:17Z","author_association":"CONTRIBUTOR","body":"@rymurr could you point me to the error? I can't find the failure. (btw, I cloned locally from master and the build was passing).","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829474850/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829475652","html_url":"https://github.com/apache/iceberg/issues/2541#issuecomment-829475652","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2541","id":829475652,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTQ3NTY1Mg==","user":{"login":"tprelle","id":59021490,"node_id":"MDQ6VXNlcjU5MDIxNDkw","avatar_url":"https://avatars.githubusercontent.com/u/59021490?v=4","gravatar_id":"","url":"https://api.github.com/users/tprelle","html_url":"https://github.com/tprelle","followers_url":"https://api.github.com/users/tprelle/followers","following_url":"https://api.github.com/users/tprelle/following{/other_user}","gists_url":"https://api.github.com/users/tprelle/gists{/gist_id}","starred_url":"https://api.github.com/users/tprelle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tprelle/subscriptions","organizations_url":"https://api.github.com/users/tprelle/orgs","repos_url":"https://api.github.com/users/tprelle/repos","events_url":"https://api.github.com/users/tprelle/events{/privacy}","received_events_url":"https://api.github.com/users/tprelle/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T18:05:35Z","updated_at":"2021-04-29T18:05:35Z","author_association":"CONTRIBUTOR","body":"Hi i already fix this by merge Hive-24629 but i think i found a lead.\r\nI have a log _CommitTask found no writer for specific table: _table_, attemptID: attempt_16196747818930_9685_r_000000_3_ do no yet why.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829475652/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829477556","html_url":"https://github.com/apache/iceberg/pull/2539#issuecomment-829477556","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2539","id":829477556,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTQ3NzU1Ng==","user":{"login":"edgarRd","id":266670,"node_id":"MDQ6VXNlcjI2NjY3MA==","avatar_url":"https://avatars.githubusercontent.com/u/266670?v=4","gravatar_id":"","url":"https://api.github.com/users/edgarRd","html_url":"https://github.com/edgarRd","followers_url":"https://api.github.com/users/edgarRd/followers","following_url":"https://api.github.com/users/edgarRd/following{/other_user}","gists_url":"https://api.github.com/users/edgarRd/gists{/gist_id}","starred_url":"https://api.github.com/users/edgarRd/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/edgarRd/subscriptions","organizations_url":"https://api.github.com/users/edgarRd/orgs","repos_url":"https://api.github.com/users/edgarRd/repos","events_url":"https://api.github.com/users/edgarRd/events{/privacy}","received_events_url":"https://api.github.com/users/edgarRd/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T18:08:47Z","updated_at":"2021-04-29T18:08:47Z","author_association":"CONTRIBUTOR","body":"Thanks for the reviews, folks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829477556/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829511260","html_url":"https://github.com/apache/iceberg/pull/2286#issuecomment-829511260","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2286","id":829511260,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTUxMTI2MA==","user":{"login":"rymurr","id":2022305,"node_id":"MDQ6VXNlcjIwMjIzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/2022305?v=4","gravatar_id":"","url":"https://api.github.com/users/rymurr","html_url":"https://github.com/rymurr","followers_url":"https://api.github.com/users/rymurr/followers","following_url":"https://api.github.com/users/rymurr/following{/other_user}","gists_url":"https://api.github.com/users/rymurr/gists{/gist_id}","starred_url":"https://api.github.com/users/rymurr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rymurr/subscriptions","organizations_url":"https://api.github.com/users/rymurr/orgs","repos_url":"https://api.github.com/users/rymurr/repos","events_url":"https://api.github.com/users/rymurr/events{/privacy}","received_events_url":"https://api.github.com/users/rymurr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T19:02:03Z","updated_at":"2021-04-29T19:02:03Z","author_association":"CONTRIBUTOR","body":"yeah, it looks like it was a flaky build. The build is passing this time so was prob just a flaky test in another module.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829511260/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829522385","html_url":"https://github.com/apache/iceberg/issues/2541#issuecomment-829522385","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2541","id":829522385,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTUyMjM4NQ==","user":{"login":"tprelle","id":59021490,"node_id":"MDQ6VXNlcjU5MDIxNDkw","avatar_url":"https://avatars.githubusercontent.com/u/59021490?v=4","gravatar_id":"","url":"https://api.github.com/users/tprelle","html_url":"https://github.com/tprelle","followers_url":"https://api.github.com/users/tprelle/followers","following_url":"https://api.github.com/users/tprelle/following{/other_user}","gists_url":"https://api.github.com/users/tprelle/gists{/gist_id}","starred_url":"https://api.github.com/users/tprelle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tprelle/subscriptions","organizations_url":"https://api.github.com/users/tprelle/orgs","repos_url":"https://api.github.com/users/tprelle/repos","events_url":"https://api.github.com/users/tprelle/events{/privacy}","received_events_url":"https://api.github.com/users/tprelle/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T19:20:12Z","updated_at":"2021-04-29T19:20:12Z","author_association":"CONTRIBUTOR","body":"I think it's more comming for my hive or and tez version than from iceberg it's seems that the taskAttemptID creating the writer in HiveIcebergRecordWriter are not the same as the one in the output commiter so the lookup it's not working ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829522385/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829525786","html_url":"https://github.com/apache/iceberg/issues/2541#issuecomment-829525786","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2541","id":829525786,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTUyNTc4Ng==","user":{"login":"marton-bod","id":19599214,"node_id":"MDQ6VXNlcjE5NTk5MjE0","avatar_url":"https://avatars.githubusercontent.com/u/19599214?v=4","gravatar_id":"","url":"https://api.github.com/users/marton-bod","html_url":"https://github.com/marton-bod","followers_url":"https://api.github.com/users/marton-bod/followers","following_url":"https://api.github.com/users/marton-bod/following{/other_user}","gists_url":"https://api.github.com/users/marton-bod/gists{/gist_id}","starred_url":"https://api.github.com/users/marton-bod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marton-bod/subscriptions","organizations_url":"https://api.github.com/users/marton-bod/orgs","repos_url":"https://api.github.com/users/marton-bod/repos","events_url":"https://api.github.com/users/marton-bod/events{/privacy}","received_events_url":"https://api.github.com/users/marton-bod/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T19:25:46Z","updated_at":"2021-04-29T19:25:46Z","author_association":"COLLABORATOR","body":"Yeah, there are some unreleased Tez patches that are also necessary to make it work, such as https://issues.apache.org/jira/browse/TEZ-4264, which helps append the missing vertex id to the job id in the committer. But there might be other missing pieces too. The bottom line is that Tez writes are unsupported at the moment and are fully expected to not work, but of course, feel free to keep tinkering and please let us know if you have more questions. Thanks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829525786/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829539609","html_url":"https://github.com/apache/iceberg/issues/2541#issuecomment-829539609","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2541","id":829539609,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTUzOTYwOQ==","user":{"login":"tprelle","id":59021490,"node_id":"MDQ6VXNlcjU5MDIxNDkw","avatar_url":"https://avatars.githubusercontent.com/u/59021490?v=4","gravatar_id":"","url":"https://api.github.com/users/tprelle","html_url":"https://github.com/tprelle","followers_url":"https://api.github.com/users/tprelle/followers","following_url":"https://api.github.com/users/tprelle/following{/other_user}","gists_url":"https://api.github.com/users/tprelle/gists{/gist_id}","starred_url":"https://api.github.com/users/tprelle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tprelle/subscriptions","organizations_url":"https://api.github.com/users/tprelle/orgs","repos_url":"https://api.github.com/users/tprelle/repos","events_url":"https://api.github.com/users/tprelle/events{/privacy}","received_events_url":"https://api.github.com/users/tprelle/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T19:45:59Z","updated_at":"2021-04-29T19:45:59Z","author_association":"CONTRIBUTOR","body":"@marton-bod i may miss this PR https://github.com/apache/hive/pull/2161 on my hive.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829539609/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829573091","html_url":"https://github.com/apache/iceberg/pull/2544#issuecomment-829573091","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2544","id":829573091,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTU3MzA5MQ==","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T20:27:23Z","updated_at":"2021-04-29T20:27:53Z","author_association":"CONTRIBUTOR","body":"@pvary @marton-bod @lcspinter thanks for the review, I updated based on the comments.\r\n\r\nFor `iceberg.mr.catalog`, I know it can still be used to indicate a default catalog type to be `hive` or `no catalog`, but I think it's probably better to not mention it at all in the documentation, and I also marked it as deprecated in javadoc. Please let me know if this approach sounds good.\r\n\r\nFor the Hadoop catalog table case, I have combined it with the custom catalog table case in `CREATE EXTERNAL TABLE`, by using the hadoop example for custom type, so that people use the same way to create those external tables. Hopefully this is clearer and have less confusion when reading.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829573091/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829599578","html_url":"https://github.com/apache/iceberg/issues/2545#issuecomment-829599578","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2545","id":829599578,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTU5OTU3OA==","user":{"login":"marton-bod","id":19599214,"node_id":"MDQ6VXNlcjE5NTk5MjE0","avatar_url":"https://avatars.githubusercontent.com/u/19599214?v=4","gravatar_id":"","url":"https://api.github.com/users/marton-bod","html_url":"https://github.com/marton-bod","followers_url":"https://api.github.com/users/marton-bod/followers","following_url":"https://api.github.com/users/marton-bod/following{/other_user}","gists_url":"https://api.github.com/users/marton-bod/gists{/gist_id}","starred_url":"https://api.github.com/users/marton-bod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marton-bod/subscriptions","organizations_url":"https://api.github.com/users/marton-bod/orgs","repos_url":"https://api.github.com/users/marton-bod/repos","events_url":"https://api.github.com/users/marton-bod/events{/privacy}","received_events_url":"https://api.github.com/users/marton-bod/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T21:12:08Z","updated_at":"2021-04-29T21:12:08Z","author_association":"COLLABORATOR","body":"+1 - I've had similar thoughts as well just the other day, would be happy to reduce/eliminate these warnings on the mr/hive side. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829599578/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829609056","html_url":"https://github.com/apache/iceberg/pull/2501#issuecomment-829609056","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2501","id":829609056,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTYwOTA1Ng==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T21:29:54Z","updated_at":"2021-04-29T21:29:54Z","author_association":"MEMBER","body":"Went through all the comments I could. Made changes were asked, if anyone any additional feedback please let me know. I'd like to post a PR with the Spark Action and Bin-pack implementation asap.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829609056/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829642791","html_url":"https://github.com/apache/iceberg/pull/2509#issuecomment-829642791","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2509","id":829642791,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTY0Mjc5MQ==","user":{"login":"yyanyy","id":71906210,"node_id":"MDQ6VXNlcjcxOTA2MjEw","avatar_url":"https://avatars.githubusercontent.com/u/71906210?v=4","gravatar_id":"","url":"https://api.github.com/users/yyanyy","html_url":"https://github.com/yyanyy","followers_url":"https://api.github.com/users/yyanyy/followers","following_url":"https://api.github.com/users/yyanyy/following{/other_user}","gists_url":"https://api.github.com/users/yyanyy/gists{/gist_id}","starred_url":"https://api.github.com/users/yyanyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yyanyy/subscriptions","organizations_url":"https://api.github.com/users/yyanyy/orgs","repos_url":"https://api.github.com/users/yyanyy/repos","events_url":"https://api.github.com/users/yyanyy/events{/privacy}","received_events_url":"https://api.github.com/users/yyanyy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-29T22:44:22Z","updated_at":"2021-04-29T22:44:22Z","author_association":"CONTRIBUTOR","body":"I guess we can close this one now?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829642791/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829706460","html_url":"https://github.com/apache/iceberg/pull/2543#issuecomment-829706460","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2543","id":829706460,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTcwNjQ2MA==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-30T00:03:32Z","updated_at":"2021-04-30T00:03:32Z","author_association":"MEMBER","body":"> LGTM, though I'm not a spark expert; some minor questions. Do we know if this only impact spark3 but not 2?\r\n\r\nYep the patch to add support for these literals only exists in Spark3\r\nhttps://issues.apache.org/jira/browse/SPARK-26902","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829706460/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829728213","html_url":"https://github.com/apache/iceberg/issues/2490#issuecomment-829728213","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2490","id":829728213,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTcyODIxMw==","user":{"login":"yyanyy","id":71906210,"node_id":"MDQ6VXNlcjcxOTA2MjEw","avatar_url":"https://avatars.githubusercontent.com/u/71906210?v=4","gravatar_id":"","url":"https://api.github.com/users/yyanyy","html_url":"https://github.com/yyanyy","followers_url":"https://api.github.com/users/yyanyy/followers","following_url":"https://api.github.com/users/yyanyy/following{/other_user}","gists_url":"https://api.github.com/users/yyanyy/gists{/gist_id}","starred_url":"https://api.github.com/users/yyanyy/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/yyanyy/subscriptions","organizations_url":"https://api.github.com/users/yyanyy/orgs","repos_url":"https://api.github.com/users/yyanyy/repos","events_url":"https://api.github.com/users/yyanyy/events{/privacy}","received_events_url":"https://api.github.com/users/yyanyy/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-30T01:08:26Z","updated_at":"2021-04-30T01:08:26Z","author_association":"CONTRIBUTOR","body":"I think currently sort order support is only implemented on API level, but no engine integration is completed yet; I think the situation doesn't change much from the email thread here, in case you need more information: https://lists.apache.org/thread.html/r4d41a78b722af230738e597203d42e524f5f09738fcf041ba78f613a%40%3Cdev.iceberg.apache.org%3E","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829728213/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829729588","html_url":"https://github.com/apache/iceberg/pull/2512#issuecomment-829729588","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2512","id":829729588,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTcyOTU4OA==","user":{"login":"wypoon","id":3925490,"node_id":"MDQ6VXNlcjM5MjU0OTA=","avatar_url":"https://avatars.githubusercontent.com/u/3925490?v=4","gravatar_id":"","url":"https://api.github.com/users/wypoon","html_url":"https://github.com/wypoon","followers_url":"https://api.github.com/users/wypoon/followers","following_url":"https://api.github.com/users/wypoon/following{/other_user}","gists_url":"https://api.github.com/users/wypoon/gists{/gist_id}","starred_url":"https://api.github.com/users/wypoon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wypoon/subscriptions","organizations_url":"https://api.github.com/users/wypoon/orgs","repos_url":"https://api.github.com/users/wypoon/repos","events_url":"https://api.github.com/users/wypoon/events{/privacy}","received_events_url":"https://api.github.com/users/wypoon/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-30T01:12:29Z","updated_at":"2021-04-30T01:12:29Z","author_association":"CONTRIBUTOR","body":"CI is green.\r\nBuilding spark3 and spark3-extensions against both 3.0 and 3.1 ensures that the code can compile against both. spark3-runtime can be built against either, up to the user; it builds against 3.0 by default. I think this is a good compromise.\r\nIn principle, we can also build against 3.0 and run (test) against 3.1, but I think this approach is a good tradeoff and would rather not add one more combination to the CI.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829729588/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":1,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829863003","html_url":"https://github.com/apache/iceberg/issues/2488#issuecomment-829863003","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2488","id":829863003,"node_id":"MDEyOklzc3VlQ29tbWVudDgyOTg2MzAwMw==","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-30T06:06:52Z","updated_at":"2021-04-30T06:06:52Z","author_association":"CONTRIBUTOR","body":"+1 for the approach. Make sense to me if Spark build-in session catalog doesn't support Iceberg \"Hadoop\" type catalog.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/829863003/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830264629","html_url":"https://github.com/apache/iceberg/pull/2501#issuecomment-830264629","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2501","id":830264629,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDI2NDYyOQ==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-30T17:58:46Z","updated_at":"2021-04-30T17:58:46Z","author_association":"MEMBER","body":"@yyanyy The Chunk info was going to a conatiner class used for indentifying a chunk within the baseaction class, I just choose to define it here as well so that we can include it in the result set rather than making two different container classes.\r\n\r\nSo an implementation will have something like\r\n```\r\nCreate Groups\r\nSort Groups \r\nTasks.run(groups) \r\n{\r\n   Create Info Class\r\n   Log details based on info\r\n   Perform Rewrite\r\n   Add Info,Result to resultMap\r\n}\r\n```\r\nAt least this is my thought processes","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830264629/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830265714","html_url":"https://github.com/apache/iceberg/pull/2501#issuecomment-830265714","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2501","id":830265714,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDI2NTcxNA==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-30T18:00:41Z","updated_at":"2021-04-30T18:00:41Z","author_association":"MEMBER","body":"One thing i'm thinking about with all these indexes is that we can present results like\r\n\r\n| GlobalIndex | Partition | PartitionIndex | Files Added | Files Rewritten | ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830265714/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830265872","html_url":"https://github.com/apache/iceberg/pull/2512#issuecomment-830265872","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2512","id":830265872,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDI2NTg3Mg==","user":{"login":"wypoon","id":3925490,"node_id":"MDQ6VXNlcjM5MjU0OTA=","avatar_url":"https://avatars.githubusercontent.com/u/3925490?v=4","gravatar_id":"","url":"https://api.github.com/users/wypoon","html_url":"https://github.com/wypoon","followers_url":"https://api.github.com/users/wypoon/followers","following_url":"https://api.github.com/users/wypoon/following{/other_user}","gists_url":"https://api.github.com/users/wypoon/gists{/gist_id}","starred_url":"https://api.github.com/users/wypoon/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/wypoon/subscriptions","organizations_url":"https://api.github.com/users/wypoon/orgs","repos_url":"https://api.github.com/users/wypoon/repos","events_url":"https://api.github.com/users/wypoon/events{/privacy}","received_events_url":"https://api.github.com/users/wypoon/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-30T18:00:59Z","updated_at":"2021-04-30T18:00:59Z","author_association":"CONTRIBUTOR","body":"@RussellSpitzer when you get the time, could you please review? Thanks!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830265872/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830269254","html_url":"https://github.com/apache/iceberg/pull/2512#issuecomment-830269254","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2512","id":830269254,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDI2OTI1NA==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-04-30T18:06:46Z","updated_at":"2021-04-30T18:06:46Z","author_association":"MEMBER","body":"I will definitely take a look soon.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830269254/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830675833","html_url":"https://github.com/apache/iceberg/issues/2527#issuecomment-830675833","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2527","id":830675833,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDY3NTgzMw==","user":{"login":"cccs-jc","id":56140112,"node_id":"MDQ6VXNlcjU2MTQwMTEy","avatar_url":"https://avatars.githubusercontent.com/u/56140112?v=4","gravatar_id":"","url":"https://api.github.com/users/cccs-jc","html_url":"https://github.com/cccs-jc","followers_url":"https://api.github.com/users/cccs-jc/followers","following_url":"https://api.github.com/users/cccs-jc/following{/other_user}","gists_url":"https://api.github.com/users/cccs-jc/gists{/gist_id}","starred_url":"https://api.github.com/users/cccs-jc/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/cccs-jc/subscriptions","organizations_url":"https://api.github.com/users/cccs-jc/orgs","repos_url":"https://api.github.com/users/cccs-jc/repos","events_url":"https://api.github.com/users/cccs-jc/events{/privacy}","received_events_url":"https://api.github.com/users/cccs-jc/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-01T18:36:02Z","updated_at":"2021-05-01T18:37:02Z","author_association":"CONTRIBUTOR","body":"@RussellSpitzer  \r\nI created a mock fact table and a mock dimension table using a traditional Hive catalog. I was able to activate the dynamic partition pruning optimization. It's quite easy to identify in the spark UI. The query runs very fast then dpp is used.\r\n\r\nI then used the same mock data generator functions to create tables using iceberg. I partition the fact table in the same was as with traditional Hive. I run the exact same join however spark uses a sort-merge-join instead of the dynamic partition pruning optimization. It does not even use a Broadcast Join which surprised me.\r\n\r\nI can reproduce the issue quite easily. What information would be useful to put in this issue?\r\n\r\n\r\n ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830675833/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830870113","html_url":"https://github.com/apache/iceberg/pull/2465#issuecomment-830870113","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2465","id":830870113,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDg3MDExMw==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-02T20:52:37Z","updated_at":"2021-05-02T20:52:37Z","author_association":"CONTRIBUTOR","body":"Overall this looks correct to me. I think it would be nice to replace the `Set` with `Collection` in the `UpdateSchema` API, but that can be done later. Thanks for building this, @jackye1995!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830870113/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830870448","html_url":"https://github.com/apache/iceberg/pull/2352#issuecomment-830870448","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2352","id":830870448,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDg3MDQ0OA==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-02T20:54:57Z","updated_at":"2021-05-02T20:54:57Z","author_association":"CONTRIBUTOR","body":"@rzhang10, this isn't safe to commit because it will cause more columns than intended to be projected when reading files. I'm -1 for committing this. I think we can find a solution to the underlying problem, but for the reason I stated above I don't think that this is the fix.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830870448/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830874139","html_url":"https://github.com/apache/iceberg/pull/2544#issuecomment-830874139","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2544","id":830874139,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDg3NDEzOQ==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-02T21:22:11Z","updated_at":"2021-05-02T21:22:11Z","author_association":"CONTRIBUTOR","body":"Nice work, @jackye1995! Thanks for working on the docs like this!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830874139/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830910908","html_url":"https://github.com/apache/iceberg/pull/2523#issuecomment-830910908","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2523","id":830910908,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDkxMDkwOA==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-02T22:01:30Z","updated_at":"2021-05-02T22:01:30Z","author_association":"CONTRIBUTOR","body":"Nice work. Thanks @wypoon!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830910908/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830916422","html_url":"https://github.com/apache/iceberg/pull/2454#issuecomment-830916422","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2454","id":830916422,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDkxNjQyMg==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-02T22:24:25Z","updated_at":"2021-05-02T22:24:25Z","author_association":"CONTRIBUTOR","body":"I'm marking this for inclusion in the 0.12.0 release. We should fix this, but I think we need to update how this PR does it.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830916422/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830916808","html_url":"https://github.com/apache/iceberg/pull/2427#issuecomment-830916808","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2427","id":830916808,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDkxNjgwOA==","user":{"login":"rdblue","id":87915,"node_id":"MDQ6VXNlcjg3OTE1","avatar_url":"https://avatars.githubusercontent.com/u/87915?v=4","gravatar_id":"","url":"https://api.github.com/users/rdblue","html_url":"https://github.com/rdblue","followers_url":"https://api.github.com/users/rdblue/followers","following_url":"https://api.github.com/users/rdblue/following{/other_user}","gists_url":"https://api.github.com/users/rdblue/gists{/gist_id}","starred_url":"https://api.github.com/users/rdblue/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rdblue/subscriptions","organizations_url":"https://api.github.com/users/rdblue/orgs","repos_url":"https://api.github.com/users/rdblue/repos","events_url":"https://api.github.com/users/rdblue/events{/privacy}","received_events_url":"https://api.github.com/users/rdblue/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-02T22:27:28Z","updated_at":"2021-05-02T22:27:28Z","author_association":"CONTRIBUTOR","body":"@aokolnychyi, I didn't realize this was outstanding. Can you update it to fix the conflicts?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830916808/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830979274","html_url":"https://github.com/apache/iceberg/pull/2454#issuecomment-830979274","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2454","id":830979274,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMDk3OTI3NA==","user":{"login":"jun-he","id":12246263,"node_id":"MDQ6VXNlcjEyMjQ2MjYz","avatar_url":"https://avatars.githubusercontent.com/u/12246263?v=4","gravatar_id":"","url":"https://api.github.com/users/jun-he","html_url":"https://github.com/jun-he","followers_url":"https://api.github.com/users/jun-he/followers","following_url":"https://api.github.com/users/jun-he/following{/other_user}","gists_url":"https://api.github.com/users/jun-he/gists{/gist_id}","starred_url":"https://api.github.com/users/jun-he/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jun-he/subscriptions","organizations_url":"https://api.github.com/users/jun-he/orgs","repos_url":"https://api.github.com/users/jun-he/repos","events_url":"https://api.github.com/users/jun-he/events{/privacy}","received_events_url":"https://api.github.com/users/jun-he/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-03T01:19:10Z","updated_at":"2021-05-03T01:19:10Z","author_association":"COLLABORATOR","body":"@rdblue @jackye1995 Thanks for the review and I will update the PR accordingly.\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/830979274/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831000821","html_url":"https://github.com/apache/iceberg/pull/2512#issuecomment-831000821","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2512","id":831000821,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMTAwMDgyMQ==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-03T03:24:07Z","updated_at":"2021-05-03T03:24:07Z","author_association":"MEMBER","body":"I think I would prefer 2 test configurations like I suggested before. That way we run the suite against both spark versions with the same compiled code. I can try throwing together an example if we get some of the Compaction stuff done this week.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831000821/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831152389","html_url":"https://github.com/apache/iceberg/pull/2550#issuecomment-831152389","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2550","id":831152389,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMTE1MjM4OQ==","user":{"login":"lcspinter","id":47777102,"node_id":"MDQ6VXNlcjQ3Nzc3MTAy","avatar_url":"https://avatars.githubusercontent.com/u/47777102?v=4","gravatar_id":"","url":"https://api.github.com/users/lcspinter","html_url":"https://github.com/lcspinter","followers_url":"https://api.github.com/users/lcspinter/followers","following_url":"https://api.github.com/users/lcspinter/following{/other_user}","gists_url":"https://api.github.com/users/lcspinter/gists{/gist_id}","starred_url":"https://api.github.com/users/lcspinter/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lcspinter/subscriptions","organizations_url":"https://api.github.com/users/lcspinter/orgs","repos_url":"https://api.github.com/users/lcspinter/repos","events_url":"https://api.github.com/users/lcspinter/events{/privacy}","received_events_url":"https://api.github.com/users/lcspinter/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-03T09:51:50Z","updated_at":"2021-05-03T09:51:50Z","author_association":"CONTRIBUTOR","body":"@boroknagyz @marton-bod @pvary Could you please review this PR? Thanks","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831152389/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831564394","html_url":"https://github.com/apache/iceberg/issues/644#issuecomment-831564394","issue_url":"https://api.github.com/repos/apache/iceberg/issues/644","id":831564394,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMTU2NDM5NA==","user":{"login":"jzhuge","id":1883812,"node_id":"MDQ6VXNlcjE4ODM4MTI=","avatar_url":"https://avatars.githubusercontent.com/u/1883812?v=4","gravatar_id":"","url":"https://api.github.com/users/jzhuge","html_url":"https://github.com/jzhuge","followers_url":"https://api.github.com/users/jzhuge/followers","following_url":"https://api.github.com/users/jzhuge/following{/other_user}","gists_url":"https://api.github.com/users/jzhuge/gists{/gist_id}","starred_url":"https://api.github.com/users/jzhuge/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jzhuge/subscriptions","organizations_url":"https://api.github.com/users/jzhuge/orgs","repos_url":"https://api.github.com/users/jzhuge/repos","events_url":"https://api.github.com/users/jzhuge/events{/privacy}","received_events_url":"https://api.github.com/users/jzhuge/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-03T22:04:57Z","updated_at":"2021-05-03T22:04:57Z","author_association":"MEMBER","body":"Great! The first step is to get ViewCatalog API into Spark.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831564394/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831611181","html_url":"https://github.com/apache/iceberg/pull/2552#issuecomment-831611181","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2552","id":831611181,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMTYxMTE4MQ==","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-04T00:11:20Z","updated_at":"2021-05-04T00:11:20Z","author_association":"CONTRIBUTOR","body":"Can you take a look? @rdblue @aokolnychyi @RussellSpitzer @karuppayya @kbendick ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831611181/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831616239","html_url":"https://github.com/apache/iceberg/issues/2311#issuecomment-831616239","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2311","id":831616239,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMTYxNjIzOQ==","user":{"login":"flyrain","id":1322359,"node_id":"MDQ6VXNlcjEzMjIzNTk=","avatar_url":"https://avatars.githubusercontent.com/u/1322359?v=4","gravatar_id":"","url":"https://api.github.com/users/flyrain","html_url":"https://github.com/flyrain","followers_url":"https://api.github.com/users/flyrain/followers","following_url":"https://api.github.com/users/flyrain/following{/other_user}","gists_url":"https://api.github.com/users/flyrain/gists{/gist_id}","starred_url":"https://api.github.com/users/flyrain/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/flyrain/subscriptions","organizations_url":"https://api.github.com/users/flyrain/orgs","repos_url":"https://api.github.com/users/flyrain/repos","events_url":"https://api.github.com/users/flyrain/events{/privacy}","received_events_url":"https://api.github.com/users/flyrain/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-04T00:26:17Z","updated_at":"2021-05-04T00:30:42Z","author_association":"CONTRIBUTOR","body":"Currently, partition related ops like `Alter table add partition` and `Show partitions` fail due to Hive doesn't think an Iceberg table is partitioned even though it is, since the table partition metadata is in file sytem, NOT in HMS. We may resolved the issue in Spark 3.1.\r\nSpark 3.1 introduces interface SupportsPartitionManagement. We can let SparkTable extends it so that partition related ops can be supported for Iceberg table. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831616239/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831684741","html_url":"https://github.com/apache/iceberg/issues/1804#issuecomment-831684741","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1804","id":831684741,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMTY4NDc0MQ==","user":{"login":"rajendrapa1","id":25480536,"node_id":"MDQ6VXNlcjI1NDgwNTM2","avatar_url":"https://avatars.githubusercontent.com/u/25480536?v=4","gravatar_id":"","url":"https://api.github.com/users/rajendrapa1","html_url":"https://github.com/rajendrapa1","followers_url":"https://api.github.com/users/rajendrapa1/followers","following_url":"https://api.github.com/users/rajendrapa1/following{/other_user}","gists_url":"https://api.github.com/users/rajendrapa1/gists{/gist_id}","starred_url":"https://api.github.com/users/rajendrapa1/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rajendrapa1/subscriptions","organizations_url":"https://api.github.com/users/rajendrapa1/orgs","repos_url":"https://api.github.com/users/rajendrapa1/repos","events_url":"https://api.github.com/users/rajendrapa1/events{/privacy}","received_events_url":"https://api.github.com/users/rajendrapa1/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-04T05:05:19Z","updated_at":"2021-05-04T05:05:19Z","author_association":"NONE","body":"Hi\r\nEven I am having the same issue. ASF needs apache email. The gitter lobby does not seem to be active, so I am really clueless on how to get help.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831684741/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831857009","html_url":"https://github.com/apache/iceberg/issues/2541#issuecomment-831857009","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2541","id":831857009,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMTg1NzAwOQ==","user":{"login":"tprelle","id":59021490,"node_id":"MDQ6VXNlcjU5MDIxNDkw","avatar_url":"https://avatars.githubusercontent.com/u/59021490?v=4","gravatar_id":"","url":"https://api.github.com/users/tprelle","html_url":"https://github.com/tprelle","followers_url":"https://api.github.com/users/tprelle/followers","following_url":"https://api.github.com/users/tprelle/following{/other_user}","gists_url":"https://api.github.com/users/tprelle/gists{/gist_id}","starred_url":"https://api.github.com/users/tprelle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tprelle/subscriptions","organizations_url":"https://api.github.com/users/tprelle/orgs","repos_url":"https://api.github.com/users/tprelle/repos","events_url":"https://api.github.com/users/tprelle/events{/privacy}","received_events_url":"https://api.github.com/users/tprelle/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-04T11:02:30Z","updated_at":"2021-05-04T11:02:30Z","author_association":"CONTRIBUTOR","body":"Hi @marton-bod,\r\nI found my issue it's coming from hive not from iceberg.\r\nFor map only job, i need to put hive.compute.splits.in.am=false in order to have the right number in getNumMapTasks.\r\nI do not know if it's comming from my version of hive than is derivated from HDP version so not directly from Apache version.\r\nBut with this, and others Tez and Hive patches it's working.\r\nThanks for the help","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831857009/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831859693","html_url":"https://github.com/apache/iceberg/issues/2541#issuecomment-831859693","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2541","id":831859693,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMTg1OTY5Mw==","user":{"login":"marton-bod","id":19599214,"node_id":"MDQ6VXNlcjE5NTk5MjE0","avatar_url":"https://avatars.githubusercontent.com/u/19599214?v=4","gravatar_id":"","url":"https://api.github.com/users/marton-bod","html_url":"https://github.com/marton-bod","followers_url":"https://api.github.com/users/marton-bod/followers","following_url":"https://api.github.com/users/marton-bod/following{/other_user}","gists_url":"https://api.github.com/users/marton-bod/gists{/gist_id}","starred_url":"https://api.github.com/users/marton-bod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marton-bod/subscriptions","organizations_url":"https://api.github.com/users/marton-bod/orgs","repos_url":"https://api.github.com/users/marton-bod/repos","events_url":"https://api.github.com/users/marton-bod/events{/privacy}","received_events_url":"https://api.github.com/users/marton-bod/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-04T11:07:03Z","updated_at":"2021-05-04T11:07:03Z","author_association":"COLLABORATOR","body":"Thanks for the feedback @tprelle! Glad you managed to make it work :)\r\nCan I ask which iceberg-related patches you ended up applying on top of your vanilla Hive 3.1 installation, which made Tez writes work eventually?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831859693/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831888173","html_url":"https://github.com/apache/iceberg/issues/2541#issuecomment-831888173","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2541","id":831888173,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMTg4ODE3Mw==","user":{"login":"tprelle","id":59021490,"node_id":"MDQ6VXNlcjU5MDIxNDkw","avatar_url":"https://avatars.githubusercontent.com/u/59021490?v=4","gravatar_id":"","url":"https://api.github.com/users/tprelle","html_url":"https://github.com/tprelle","followers_url":"https://api.github.com/users/tprelle/followers","following_url":"https://api.github.com/users/tprelle/following{/other_user}","gists_url":"https://api.github.com/users/tprelle/gists{/gist_id}","starred_url":"https://api.github.com/users/tprelle/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tprelle/subscriptions","organizations_url":"https://api.github.com/users/tprelle/orgs","repos_url":"https://api.github.com/users/tprelle/repos","events_url":"https://api.github.com/users/tprelle/events{/privacy}","received_events_url":"https://api.github.com/users/tprelle/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-04T12:01:53Z","updated_at":"2021-05-04T12:22:29Z","author_association":"CONTRIBUTOR","body":"@marton-bod  sure : \r\nFor tez from apache 0.10.0 tag i add \r\n-  https://issues.apache.org/jira/projects/TEZ/issues/TEZ-4238 \r\n- https://issues.apache.org/jira/projects/TEZ/issues/TEZ-4264\r\n\r\nFor hive it was a bit complex from HDP 3.1.5-2-4 versions i add :\r\n - https://issues.apache.org/jira/browse/HIVE-23190 for be able to go to tez 0.10\r\n - https://issues.apache.org/jira/browse/HIVE-24629 for output committer classe\r\n - https://issues.apache.org/jira/browse/HIVE-24207 because i need that hive tez processor fill jobconf https://github.com/apache/hive/blob/master/ql/src/java/org/apache/hadoop/hive/ql/exec/tez/TezProcessor.java#L202 for TEZ_VERTEX_ID_HIVE in order to make TaskAttemptWrapper work https://github.com/apache/iceberg/blob/master/mr/src/main/java/org/apache/iceberg/mr/hive/TezUtil.java#L95\r\n \r\nWith this version i add still an issue : with this line https://github.com/apache/iceberg/blob/master/mr/src/main/java/org/apache/iceberg/mr/hive/HiveIcebergOutputCommitter.java#L382\r\nBecause conf.getNumReduceTasks() and conf.getNumMapTasks() was never setup by Hive.\r\nI found a way (but i do not know if it's the correct one or it's because of HDP fork) to fix.\r\n\r\n- For  ReduceWork plan, i add at this line\r\n\r\n https://github.com/apache/hive/blob/branch-3.1/ql/src/java/org/apache/hadoop/hive/ql/exec/tez/DagUtils.java#L800\r\n`    conf.setNumReduceTasks(reduceWork.isAutoReduceParallelism() ?\r\n            reduceWork.getMaxReduceTasks() :\r\n            reduceWork.getNumReduceTasks());`\r\n\r\n- For MergeJoinWork i add at this line https://github.com/apache/hive/blob/branch-3.1/ql/src/java/org/apache/hadoop/hive/ql/exec/tez/DagUtils.java#L596 `conf.setNumMapTasks(mapWorkList.size() + 1);`\r\n\r\n- For MapWork, i was able only in one condition, if hive.compute.splits.in.am=false by adding at  https://github.com/apache/hive/blob/branch-3.1/ql/src/java/org/apache/hadoop/hive/ql/exec/tez/DagUtils.java#L716 `conf.setNumMapTasks(numTasks);`\r\nBut with hive.compute.splits.in.am=false vectorisation it's not longer working because row ids a not longer projected.\r\n\r\nI need to set me up an hive from latest 3.1 version in order to be able to test.\r\nI take as example Apache code as Cloudera deside to remove from internet Hortonworks github but it's seems it's almost the same code from apache branch 3.1","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831888173/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831891034","html_url":"https://github.com/apache/iceberg/issues/2541#issuecomment-831891034","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2541","id":831891034,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMTg5MTAzNA==","user":{"login":"marton-bod","id":19599214,"node_id":"MDQ6VXNlcjE5NTk5MjE0","avatar_url":"https://avatars.githubusercontent.com/u/19599214?v=4","gravatar_id":"","url":"https://api.github.com/users/marton-bod","html_url":"https://github.com/marton-bod","followers_url":"https://api.github.com/users/marton-bod/followers","following_url":"https://api.github.com/users/marton-bod/following{/other_user}","gists_url":"https://api.github.com/users/marton-bod/gists{/gist_id}","starred_url":"https://api.github.com/users/marton-bod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marton-bod/subscriptions","organizations_url":"https://api.github.com/users/marton-bod/orgs","repos_url":"https://api.github.com/users/marton-bod/repos","events_url":"https://api.github.com/users/marton-bod/events{/privacy}","received_events_url":"https://api.github.com/users/marton-bod/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-04T12:06:46Z","updated_at":"2021-05-04T12:06:46Z","author_association":"COLLABORATOR","body":"I see, thanks a lot for the detailed description!","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831891034/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831914713","html_url":"https://github.com/apache/iceberg/issues/1804#issuecomment-831914713","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1804","id":831914713,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMTkxNDcxMw==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-04T12:47:45Z","updated_at":"2021-05-04T12:47:45Z","author_association":"MEMBER","body":"If you send me you email I can add you, it does not need to be asf\n\nSent from my iPhone\n\n> On May 4, 2021, at 12:05 AM, Rajendra Patki ***@***.***> wrote:\n> \n> ﻿\n> Hi\n> Even I am having the same issue. ASF needs apache email. The gitter lobby does not seem to be active, so I am really clueless on how to get help.\n> \n> —\n> You are receiving this because you commented.\n> Reply to this email directly, view it on GitHub, or unsubscribe.\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/831914713/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/832279226","html_url":"https://github.com/apache/iceberg/pull/2552#issuecomment-832279226","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2552","id":832279226,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMjI3OTIyNg==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-04T22:01:44Z","updated_at":"2021-05-04T22:01:44Z","author_association":"MEMBER","body":"I think this is a good fix to the NPE. But I do want to make sure we warn folks that an eventually consistent Catalog can break the history of an Iceberg table. This would only be acceptable for a catalog which guaranteed consistent reads during the lock phase. \r\n\r\nMy thinking is basically\r\n\r\n```\r\nConsistent - Read Your Writes  Catalog = Best\r\nEventually Consistent Reads - Consistent when locking/committing = Adequate but not great\r\nEventually consistent during lock/commit = Will cause lost writes, non-linearizable histories and weirdness. \r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/832279226/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/832463326","html_url":"https://github.com/apache/iceberg/pull/2544#issuecomment-832463326","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2544","id":832463326,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMjQ2MzMyNg==","user":{"login":"jackye1995","id":29823233,"node_id":"MDQ6VXNlcjI5ODIzMjMz","avatar_url":"https://avatars.githubusercontent.com/u/29823233?v=4","gravatar_id":"","url":"https://api.github.com/users/jackye1995","html_url":"https://github.com/jackye1995","followers_url":"https://api.github.com/users/jackye1995/followers","following_url":"https://api.github.com/users/jackye1995/following{/other_user}","gists_url":"https://api.github.com/users/jackye1995/gists{/gist_id}","starred_url":"https://api.github.com/users/jackye1995/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jackye1995/subscriptions","organizations_url":"https://api.github.com/users/jackye1995/orgs","repos_url":"https://api.github.com/users/jackye1995/repos","events_url":"https://api.github.com/users/jackye1995/events{/privacy}","received_events_url":"https://api.github.com/users/jackye1995/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-05T07:06:25Z","updated_at":"2021-05-05T07:06:25Z","author_association":"CONTRIBUTOR","body":"@pvary @marton-bod addressed all the comments, please let me know if there are anything other concerns, thanks.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/832463326/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/832537640","html_url":"https://github.com/apache/iceberg/pull/2240#issuecomment-832537640","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2240","id":832537640,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMjUzNzY0MA==","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-05T09:10:42Z","updated_at":"2021-05-05T09:16:14Z","author_association":"COLLABORATOR","body":"Rebased, and as discussed, make method MetricsConfig.fromTable(table), and propagate the table arg up the various writer stacks.  This was helped by changes of #2362 (table propagation to Spark) and #2499 (SparkAppenderFactory builder using table).  \r\n\r\nThis last change in particular aligns the other AppenderFactories (Flink/Generic) to also be constructed with tables, like SparkAppenderFactory.  Most of the other changes are test changes to accomodate this change of arguments to AppenderFactories to use Tables.\r\n\r\nThe actual logic changes remain, are described in the earlier comments (if config does not specify explicitly a metric mode for sorted columns and default mode is None/Counts, then promote these column metric modes to Truncate(16))","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/832537640/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/832541067","html_url":"https://github.com/apache/iceberg/pull/2240#issuecomment-832541067","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2240","id":832541067,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMjU0MTA2Nw==","user":{"login":"szehon-ho","id":20555759,"node_id":"MDQ6VXNlcjIwNTU1NzU5","avatar_url":"https://avatars.githubusercontent.com/u/20555759?v=4","gravatar_id":"","url":"https://api.github.com/users/szehon-ho","html_url":"https://github.com/szehon-ho","followers_url":"https://api.github.com/users/szehon-ho/followers","following_url":"https://api.github.com/users/szehon-ho/following{/other_user}","gists_url":"https://api.github.com/users/szehon-ho/gists{/gist_id}","starred_url":"https://api.github.com/users/szehon-ho/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/szehon-ho/subscriptions","organizations_url":"https://api.github.com/users/szehon-ho/orgs","repos_url":"https://api.github.com/users/szehon-ho/repos","events_url":"https://api.github.com/users/szehon-ho/events{/privacy}","received_events_url":"https://api.github.com/users/szehon-ho/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-05T09:16:20Z","updated_at":"2021-05-05T09:16:20Z","author_association":"COLLABORATOR","body":"@aokolnychyi @RussellSpitzer  @karuppayya @flyrain @openinx for feedback, thank you ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/832541067/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/832999203","html_url":"https://github.com/apache/iceberg/issues/2553#issuecomment-832999203","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2553","id":832999203,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMjk5OTIwMw==","user":{"login":"thesquelched","id":838700,"node_id":"MDQ6VXNlcjgzODcwMA==","avatar_url":"https://avatars.githubusercontent.com/u/838700?v=4","gravatar_id":"","url":"https://api.github.com/users/thesquelched","html_url":"https://github.com/thesquelched","followers_url":"https://api.github.com/users/thesquelched/followers","following_url":"https://api.github.com/users/thesquelched/following{/other_user}","gists_url":"https://api.github.com/users/thesquelched/gists{/gist_id}","starred_url":"https://api.github.com/users/thesquelched/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/thesquelched/subscriptions","organizations_url":"https://api.github.com/users/thesquelched/orgs","repos_url":"https://api.github.com/users/thesquelched/repos","events_url":"https://api.github.com/users/thesquelched/events{/privacy}","received_events_url":"https://api.github.com/users/thesquelched/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-05T20:51:49Z","updated_at":"2021-05-05T20:51:49Z","author_association":"NONE","body":"Note that this happens regardless of whether metrics for this column are set to `none` or not.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/832999203/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833009883","html_url":"https://github.com/apache/iceberg/issues/1617#issuecomment-833009883","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1617","id":833009883,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzAwOTg4Mw==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-05T21:11:02Z","updated_at":"2021-05-05T21:11:02Z","author_association":"CONTRIBUTOR","body":"@flyrain, could you take a look at what can be done here?\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833009883/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833012392","html_url":"https://github.com/apache/iceberg/issues/2554#issuecomment-833012392","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2554","id":833012392,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzAxMjM5Mg==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-05T21:15:35Z","updated_at":"2021-05-05T21:15:35Z","author_association":"MEMBER","body":"@marton-bod + @pvary Just in case you had some thoughts","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833012392/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833013835","html_url":"https://github.com/apache/iceberg/issues/2446#issuecomment-833013835","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2446","id":833013835,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzAxMzgzNQ==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-05T21:18:11Z","updated_at":"2021-05-05T21:18:11Z","author_association":"CONTRIBUTOR","body":"Sorry, missed the last messages. Any tips on how to do that, @rymurr?\r\n\r\ncc @rdblue ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833013835/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833015694","html_url":"https://github.com/apache/iceberg/issues/2481#issuecomment-833015694","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2481","id":833015694,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzAxNTY5NA==","user":{"login":"aokolnychyi","id":6235869,"node_id":"MDQ6VXNlcjYyMzU4Njk=","avatar_url":"https://avatars.githubusercontent.com/u/6235869?v=4","gravatar_id":"","url":"https://api.github.com/users/aokolnychyi","html_url":"https://github.com/aokolnychyi","followers_url":"https://api.github.com/users/aokolnychyi/followers","following_url":"https://api.github.com/users/aokolnychyi/following{/other_user}","gists_url":"https://api.github.com/users/aokolnychyi/gists{/gist_id}","starred_url":"https://api.github.com/users/aokolnychyi/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/aokolnychyi/subscriptions","organizations_url":"https://api.github.com/users/aokolnychyi/orgs","repos_url":"https://api.github.com/users/aokolnychyi/repos","events_url":"https://api.github.com/users/aokolnychyi/events{/privacy}","received_events_url":"https://api.github.com/users/aokolnychyi/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-05T21:21:26Z","updated_at":"2021-05-05T21:21:26Z","author_association":"CONTRIBUTOR","body":"I remember @rdblue @danielcweeks @Parth-Brahmbhatt mentioning similar attempts and that there were some issues but I don't recall any details. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833015694/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833114366","html_url":"https://github.com/apache/iceberg/issues/644#issuecomment-833114366","issue_url":"https://api.github.com/repos/apache/iceberg/issues/644","id":833114366,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzExNDM2Ng==","user":{"login":"SreeramGarlapati","id":11813428,"node_id":"MDQ6VXNlcjExODEzNDI4","avatar_url":"https://avatars.githubusercontent.com/u/11813428?v=4","gravatar_id":"","url":"https://api.github.com/users/SreeramGarlapati","html_url":"https://github.com/SreeramGarlapati","followers_url":"https://api.github.com/users/SreeramGarlapati/followers","following_url":"https://api.github.com/users/SreeramGarlapati/following{/other_user}","gists_url":"https://api.github.com/users/SreeramGarlapati/gists{/gist_id}","starred_url":"https://api.github.com/users/SreeramGarlapati/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/SreeramGarlapati/subscriptions","organizations_url":"https://api.github.com/users/SreeramGarlapati/orgs","repos_url":"https://api.github.com/users/SreeramGarlapati/repos","events_url":"https://api.github.com/users/SreeramGarlapati/events{/privacy}","received_events_url":"https://api.github.com/users/SreeramGarlapati/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-05T23:33:02Z","updated_at":"2021-05-05T23:33:02Z","author_association":"COLLABORATOR","body":"@jzhuge - we are interested & am happy to help too. ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833114366/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833195912","html_url":"https://github.com/apache/iceberg/pull/2548#issuecomment-833195912","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2548","id":833195912,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzE5NTkxMg==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T03:23:56Z","updated_at":"2021-05-06T03:23:56Z","author_association":"MEMBER","body":"Got this merged, thanks @jackye1995 for contributing !","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833195912/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833212912","html_url":"https://github.com/apache/iceberg/issues/2555#issuecomment-833212912","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2555","id":833212912,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzIxMjkxMg==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T04:21:08Z","updated_at":"2021-05-06T04:21:08Z","author_association":"MEMBER","body":"Snapshot does not currently work with Iceberg tables, it is only for Hive and File Based tables in Spark at the moment. There are Issues for making it compatible with Iceberg tables as well","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833212912/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833225097","html_url":"https://github.com/apache/iceberg/issues/2555#issuecomment-833225097","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2555","id":833225097,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzIyNTA5Nw==","user":{"login":"coolderli","id":38486782,"node_id":"MDQ6VXNlcjM4NDg2Nzgy","avatar_url":"https://avatars.githubusercontent.com/u/38486782?v=4","gravatar_id":"","url":"https://api.github.com/users/coolderli","html_url":"https://github.com/coolderli","followers_url":"https://api.github.com/users/coolderli/followers","following_url":"https://api.github.com/users/coolderli/following{/other_user}","gists_url":"https://api.github.com/users/coolderli/gists{/gist_id}","starred_url":"https://api.github.com/users/coolderli/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/coolderli/subscriptions","organizations_url":"https://api.github.com/users/coolderli/orgs","repos_url":"https://api.github.com/users/coolderli/repos","events_url":"https://api.github.com/users/coolderli/events{/privacy}","received_events_url":"https://api.github.com/users/coolderli/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T05:00:14Z","updated_at":"2021-05-06T05:00:14Z","author_association":"CONTRIBUTOR","body":"@RussellSpitzer  Thanks a lot.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833225097/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833238321","html_url":"https://github.com/apache/iceberg/pull/2552#issuecomment-833238321","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2552","id":833238321,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzIzODMyMQ==","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T05:33:22Z","updated_at":"2021-05-06T05:33:22Z","author_association":"CONTRIBUTOR","body":"> I think this is a good fix to the NPE. But I do want to make sure we warn folks that an eventually consistent Catalog can break the history of an Iceberg table. This would only be acceptable for a catalog which guaranteed consistent reads during the lock phase.\r\n> \r\n> My thinking is basically\r\n> \r\n> ```\r\n> Consistent - Read Your Writes  Catalog = Best\r\n> Eventually Consistent Reads - Consistent when locking/committing = Adequate but not great\r\n> Eventually consistent during lock/commit = Will cause lost writes, non-linearizable histories and weirdness. \r\n> ```\r\n\r\nIs this something that could come up with the DynamoDB based lock? I agree this is a good fix to the NPE, but I have personally had weird edge cases with other software that uses a DynamoDB table as a lock (such as terraform). Ideally testing handles this and the DynamoDB / Glue catalog doesn't suffer from these issues. Possibly I need to review the DynamoDB table lock again, but felt it might be worth noting as I've had weird issues with terraform table locks and consistency issues.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833238321/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833243630","html_url":"https://github.com/apache/iceberg/pull/2547#issuecomment-833243630","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2547","id":833243630,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzI0MzYzMA==","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T05:46:28Z","updated_at":"2021-05-06T05:46:28Z","author_association":"CONTRIBUTOR","body":"Thanks for making this update. Should we add the new config `iceberg.hive.table-level-lock-evict-ms` to the docs? Unless a user knows about the concurrent threads issue, this particular config option might be kind of confusing. I'm simply thinking out loud and would be ok with following up with a small docs update in a later PR and/or accepting for the moment that this is likely a more advanced config that most users won't need to update.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833243630/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833249902","html_url":"https://github.com/apache/iceberg/issues/2555#issuecomment-833249902","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2555","id":833249902,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzI0OTkwMg==","user":{"login":"RussellSpitzer","id":413025,"node_id":"MDQ6VXNlcjQxMzAyNQ==","avatar_url":"https://avatars.githubusercontent.com/u/413025?v=4","gravatar_id":"","url":"https://api.github.com/users/RussellSpitzer","html_url":"https://github.com/RussellSpitzer","followers_url":"https://api.github.com/users/RussellSpitzer/followers","following_url":"https://api.github.com/users/RussellSpitzer/following{/other_user}","gists_url":"https://api.github.com/users/RussellSpitzer/gists{/gist_id}","starred_url":"https://api.github.com/users/RussellSpitzer/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/RussellSpitzer/subscriptions","organizations_url":"https://api.github.com/users/RussellSpitzer/orgs","repos_url":"https://api.github.com/users/RussellSpitzer/repos","events_url":"https://api.github.com/users/RussellSpitzer/events{/privacy}","received_events_url":"https://api.github.com/users/RussellSpitzer/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T06:00:35Z","updated_at":"2021-05-06T06:00:35Z","author_association":"MEMBER","body":"#2481","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833249902/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833273584","html_url":"https://github.com/apache/iceberg/issues/2557#issuecomment-833273584","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2557","id":833273584,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzI3MzU4NA==","user":{"login":"kbendick","id":9833362,"node_id":"MDQ6VXNlcjk4MzMzNjI=","avatar_url":"https://avatars.githubusercontent.com/u/9833362?v=4","gravatar_id":"","url":"https://api.github.com/users/kbendick","html_url":"https://github.com/kbendick","followers_url":"https://api.github.com/users/kbendick/followers","following_url":"https://api.github.com/users/kbendick/following{/other_user}","gists_url":"https://api.github.com/users/kbendick/gists{/gist_id}","starred_url":"https://api.github.com/users/kbendick/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kbendick/subscriptions","organizations_url":"https://api.github.com/users/kbendick/orgs","repos_url":"https://api.github.com/users/kbendick/repos","events_url":"https://api.github.com/users/kbendick/events{/privacy}","received_events_url":"https://api.github.com/users/kbendick/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T06:49:35Z","updated_at":"2021-05-06T06:49:55Z","author_association":"CONTRIBUTOR","body":"For reference, the spark tests only have two spark logs or so for each one.\r\n\r\n```\r\n> Task :iceberg-spark3:test\r\n[Thread-7] INFO org.apache.spark.util.ShutdownHookManager - Shutdown hook called\r\n[Thread-7] INFO org.apache.spark.util.ShutdownHookManager - Deleting directory /private/var/folders/p7/pjs_74qn64x7x4w5201ctck00000gn/T/spark-6badeb97-ea2a-432a-b53b-31616481347a\r\n```\r\n\r\n```\r\n> Task :iceberg-spark3-runtime:integrationTest\r\nWARNING: An illegal reflective access operation has occurred\r\nWARNING: Illegal reflective access by com.google.common.base.internal.Finalizer (file:/Users/kbendickson/.gradle/caches/modules-2/files-2.1/com.google.guava/guava/16.0.1/5fa98cd1a63c99a44dd8d3b77e4762b066a5d0c5/guava-16.0.1.jar) to field java.lang.Thread.inheritableThreadLocals\r\nWARNING: Please consider reporting this to the maintainers of com.google.common.base.internal.Finalizer\r\nWARNING: Use --illegal-access=warn to enable warnings of further illegal reflective access operations\r\nWARNING: All illegal access operations will be denied in a future release\r\n[Thread-7] INFO org.apache.spark.util.ShutdownHookManager - Shutdown hook called\r\n[Thread-7] INFO org.apache.spark.util.ShutdownHookManager - Deleting directory /private/var/folders/p7/pjs_74qn64x7x4w5201ctck00000gn/T/spark-6bcb11d7-a0d8-4737-9dec-b0e8983a4d99\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833273584/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833294271","html_url":"https://github.com/apache/iceberg/issues/2557#issuecomment-833294271","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2557","id":833294271,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzI5NDI3MQ==","user":{"login":"rymurr","id":2022305,"node_id":"MDQ6VXNlcjIwMjIzMDU=","avatar_url":"https://avatars.githubusercontent.com/u/2022305?v=4","gravatar_id":"","url":"https://api.github.com/users/rymurr","html_url":"https://github.com/rymurr","followers_url":"https://api.github.com/users/rymurr/followers","following_url":"https://api.github.com/users/rymurr/following{/other_user}","gists_url":"https://api.github.com/users/rymurr/gists{/gist_id}","starred_url":"https://api.github.com/users/rymurr/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rymurr/subscriptions","organizations_url":"https://api.github.com/users/rymurr/orgs","repos_url":"https://api.github.com/users/rymurr/repos","events_url":"https://api.github.com/users/rymurr/events{/privacy}","received_events_url":"https://api.github.com/users/rymurr/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T07:23:12Z","updated_at":"2021-05-06T07:23:12Z","author_association":"CONTRIBUTOR","body":"Cc @snazy ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833294271/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833348940","html_url":"https://github.com/apache/iceberg/issues/2558#issuecomment-833348940","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2558","id":833348940,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzM0ODk0MA==","user":{"login":"zhangjun0x01","id":25563794,"node_id":"MDQ6VXNlcjI1NTYzNzk0","avatar_url":"https://avatars.githubusercontent.com/u/25563794?v=4","gravatar_id":"","url":"https://api.github.com/users/zhangjun0x01","html_url":"https://github.com/zhangjun0x01","followers_url":"https://api.github.com/users/zhangjun0x01/followers","following_url":"https://api.github.com/users/zhangjun0x01/following{/other_user}","gists_url":"https://api.github.com/users/zhangjun0x01/gists{/gist_id}","starred_url":"https://api.github.com/users/zhangjun0x01/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/zhangjun0x01/subscriptions","organizations_url":"https://api.github.com/users/zhangjun0x01/orgs","repos_url":"https://api.github.com/users/zhangjun0x01/repos","events_url":"https://api.github.com/users/zhangjun0x01/events{/privacy}","received_events_url":"https://api.github.com/users/zhangjun0x01/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T08:44:35Z","updated_at":"2021-05-06T08:44:35Z","author_association":"CONTRIBUTOR","body":"@stevenzwu  @openinx ","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833348940/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833449999","html_url":"https://github.com/apache/iceberg/issues/2554#issuecomment-833449999","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2554","id":833449999,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzQ0OTk5OQ==","user":{"login":"marton-bod","id":19599214,"node_id":"MDQ6VXNlcjE5NTk5MjE0","avatar_url":"https://avatars.githubusercontent.com/u/19599214?v=4","gravatar_id":"","url":"https://api.github.com/users/marton-bod","html_url":"https://github.com/marton-bod","followers_url":"https://api.github.com/users/marton-bod/followers","following_url":"https://api.github.com/users/marton-bod/following{/other_user}","gists_url":"https://api.github.com/users/marton-bod/gists{/gist_id}","starred_url":"https://api.github.com/users/marton-bod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marton-bod/subscriptions","organizations_url":"https://api.github.com/users/marton-bod/orgs","repos_url":"https://api.github.com/users/marton-bod/repos","events_url":"https://api.github.com/users/marton-bod/events{/privacy}","received_events_url":"https://api.github.com/users/marton-bod/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T11:29:34Z","updated_at":"2021-05-06T11:29:34Z","author_association":"COLLABORATOR","body":"This is a good point, and I think we can and should guard against that. The table currently becomes undroppable only because we try to load the Iceberg table prior to dropping the HMS table. We do this because Hive2 and Hive3 do not clean up the metadata folder completely so we need to cache the io to perform the deletion later. \r\n\r\nWhat we can do instead is try to load the Iceberg table as it is, but if it fails, just log a warning message that the table was unloadable for whatever reason, but otherwise proceed with the HMS table drop. This might leave some undeleted metadata files behind but it's still much better than leaving the table undroppable.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833449999/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833464487","html_url":"https://github.com/apache/iceberg/issues/2558#issuecomment-833464487","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2558","id":833464487,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzQ2NDQ4Nw==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T11:56:29Z","updated_at":"2021-05-06T11:56:29Z","author_association":"MEMBER","body":"I did few tests to verify whether the iceberg-flink-runtime jar (compiled in flink 1.12 ) could work in flink 1.13,  sounds like the only one issue is [CatalogDescriptorValidator](https://github.com/apache/iceberg/blob/master/flink/src/main/java/org/apache/iceberg/flink/FlinkCatalogFactory.java#L31),  it's an `Internal` API but has been removed in flink 1.13.   I think we could remove the usage about `Internal` API then we could make this jar work in both flink 1.12 and flink 1.13, don't have to upgrade this version to flink 1.13.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833464487/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833465883","html_url":"https://github.com/apache/iceberg/issues/2558#issuecomment-833465883","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2558","id":833465883,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzQ2NTg4Mw==","user":{"login":"openinx","id":5028729,"node_id":"MDQ6VXNlcjUwMjg3Mjk=","avatar_url":"https://avatars.githubusercontent.com/u/5028729?v=4","gravatar_id":"","url":"https://api.github.com/users/openinx","html_url":"https://github.com/openinx","followers_url":"https://api.github.com/users/openinx/followers","following_url":"https://api.github.com/users/openinx/following{/other_user}","gists_url":"https://api.github.com/users/openinx/gists{/gist_id}","starred_url":"https://api.github.com/users/openinx/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/openinx/subscriptions","organizations_url":"https://api.github.com/users/openinx/orgs","repos_url":"https://api.github.com/users/openinx/repos","events_url":"https://api.github.com/users/openinx/events{/privacy}","received_events_url":"https://api.github.com/users/openinx/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T11:59:15Z","updated_at":"2021-05-06T11:59:15Z","author_association":"MEMBER","body":"Attached the build error message here: \r\n\r\n```\r\n> Task :iceberg-flink:compileJava\r\n/Users/openinx/software/apache-iceberg/flink/src/main/java/org/apache/iceberg/flink/FlinkCatalogFactory.java:31: error: cannot find symbol\r\nimport org.apache.flink.table.descriptors.CatalogDescriptorValidator;\r\n                                         ^\r\n  symbol:   class CatalogDescriptorValidator\r\n  location: package org.apache.flink.table.descriptors\r\n/Users/openinx/software/apache-iceberg/flink/src/main/java/org/apache/iceberg/flink/FlinkCatalogFactory.java:105: error: cannot find symbol\r\n    context.put(CatalogDescriptorValidator.CATALOG_TYPE, \"iceberg\");\r\n                ^\r\n  symbol:   variable CatalogDescriptorValidator\r\n  location: class FlinkCatalogFactory\r\n/Users/openinx/software/apache-iceberg/flink/src/main/java/org/apache/iceberg/flink/FlinkCatalogFactory.java:106: error: cannot find symbol\r\n    context.put(CatalogDescriptorValidator.CATALOG_PROPERTY_VERSION, \"1\");\r\n                ^\r\n  symbol:   variable CatalogDescriptorValidator\r\n  location: class FlinkCatalogFactory\r\n```","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833465883/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833546353","html_url":"https://github.com/apache/iceberg/pull/2547#issuecomment-833546353","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2547","id":833546353,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzU0NjM1Mw==","user":{"login":"marton-bod","id":19599214,"node_id":"MDQ6VXNlcjE5NTk5MjE0","avatar_url":"https://avatars.githubusercontent.com/u/19599214?v=4","gravatar_id":"","url":"https://api.github.com/users/marton-bod","html_url":"https://github.com/marton-bod","followers_url":"https://api.github.com/users/marton-bod/followers","following_url":"https://api.github.com/users/marton-bod/following{/other_user}","gists_url":"https://api.github.com/users/marton-bod/gists{/gist_id}","starred_url":"https://api.github.com/users/marton-bod/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/marton-bod/subscriptions","organizations_url":"https://api.github.com/users/marton-bod/orgs","repos_url":"https://api.github.com/users/marton-bod/repos","events_url":"https://api.github.com/users/marton-bod/events{/privacy}","received_events_url":"https://api.github.com/users/marton-bod/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T13:59:16Z","updated_at":"2021-05-06T13:59:16Z","author_association":"COLLABORATOR","body":"Thanks @kbendick for reviewing. I also think we probably don't want to include this in the docs in order to avoid overloading users with internally-used configs they'll most likely never need to tune. Tuning this parameter should be very rare and 99% of users would not care about it, I expect. For the remainder of users, they will probably dig into the code anyway and find this flag quite soon after a bit of search, but just my 2 cents.","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833546353/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833595041","html_url":"https://github.com/apache/iceberg/issues/2533#issuecomment-833595041","issue_url":"https://api.github.com/repos/apache/iceberg/issues/2533","id":833595041,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzU5NTA0MQ==","user":{"login":"Reo-LEI","id":17312872,"node_id":"MDQ6VXNlcjE3MzEyODcy","avatar_url":"https://avatars.githubusercontent.com/u/17312872?v=4","gravatar_id":"","url":"https://api.github.com/users/Reo-LEI","html_url":"https://github.com/Reo-LEI","followers_url":"https://api.github.com/users/Reo-LEI/followers","following_url":"https://api.github.com/users/Reo-LEI/following{/other_user}","gists_url":"https://api.github.com/users/Reo-LEI/gists{/gist_id}","starred_url":"https://api.github.com/users/Reo-LEI/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/Reo-LEI/subscriptions","organizations_url":"https://api.github.com/users/Reo-LEI/orgs","repos_url":"https://api.github.com/users/Reo-LEI/repos","events_url":"https://api.github.com/users/Reo-LEI/events{/privacy}","received_events_url":"https://api.github.com/users/Reo-LEI/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T15:02:51Z","updated_at":"2021-05-06T15:02:51Z","author_association":"CONTRIBUTOR","body":"I was encounter the same error when I use MERGE INTO clause. And I found if the target table not match any data, the IllegalArgumentException will be throw.\r\n\r\nFor example, I have some log in source table, and I need to aggregate logs into events and write to destination table.\r\n\r\nsrc(user_logs) table:\r\n|log_time|log_type|user_name|\r\n|---|---|---|\r\n|2021-05-06 12:01:00|heartbeat|Bob\r\n|2021-05-06 12:03:00|heartbeat|Bob\r\n|2021-05-06 12:05:00|heartbeat|Bob\r\n|2021-05-06 12:05:00|login|John\r\n|2021-05-06 12:05:30|heartbeat|John\r\n|2021-05-06 12:06:00|heartbeat|John\r\n|2021-05-06 12:06:30|logout|John\r\n\r\ndst(user_events) table:\r\n|start_time|end_time|user_name|\r\n|---|---|---|\r\n|2021-05-06 12:01:00|2021-05-06 12:03:00|Bob|\r\n\r\n\r\nIf I execute the following SQL, the error will happend.\r\n```\r\nMERGE INTO iceberg.iceberg_db.user_events AS dst\r\nUSING(\r\n    SELECT MIN(log_time) AS start_time,\r\n           MAX(log_time) AS end_time,\r\n           user_name\r\n    FROM iceberg.iceberg_db.user_logs\r\n    WHERE log_time >= '2021-05-06 12:05:00'\r\n      AND log_time < '2021-05-06 12:10:00'\r\n    GROUP BY user_name\r\n) AS src\r\nON  src.user_name = dst.user_name\r\nAND src.start_time = dst.end_time\r\nWHEN MATCHED THEN UPDATE SET dst.end_time = src.end_time\r\nWHEN NOT MATCHED THEN INSERT *;\r\n```\r\nAnd the stack as follow:\r\n```\r\njava.lang.IllegalArgumentException: Can't zip RDDs with unequal numbers of partitions: List(1, 0)\r\n\tat org.apache.spark.rdd.ZippedPartitionsBaseRDD.getPartitions(ZippedPartitionsRDD.scala:58)\r\n\tat org.apache.spark.rdd.RDD.$anonfun$partitions$2(RDD.scala:276)\r\n\tat scala.Option.getOrElse(Option.scala:189)\r\n\tat org.apache.spark.rdd.RDD.partitions(RDD.scala:272)\r\n\tat org.apache.spark.rdd.MapPartitionsRDD.getPartitions(MapPartitionsRDD.scala:49)\r\n\tat org.apache.spark.rdd.RDD.$anonfun$partitions$2(RDD.scala:276)\r\n\tat scala.Option.getOrElse(Option.scala:189)\r\n\tat org.apache.spark.rdd.RDD.partitions(RDD.scala:272)\r\n\tat org.apache.spark.sql.execution.datasources.v2.V2TableWriteExec.writeWithV2(WriteToDataSourceV2Exec.scala:366)\r\n\tat org.apache.spark.sql.execution.datasources.v2.V2TableWriteExec.writeWithV2$(WriteToDataSourceV2Exec.scala:361)\r\n\tat org.apache.spark.sql.execution.datasources.v2.ReplaceDataExec.writeWithV2(ReplaceDataExec.scala:26)\r\n\tat org.apache.spark.sql.execution.datasources.v2.ReplaceDataExec.run(ReplaceDataExec.scala:34)\r\n\tat org.apache.spark.sql.execution.datasources.v2.V2CommandExec.result$lzycompute(V2CommandExec.scala:39)\r\n\tat org.apache.spark.sql.execution.datasources.v2.V2CommandExec.result(V2CommandExec.scala:39)\r\n\tat org.apache.spark.sql.execution.datasources.v2.V2CommandExec.executeCollect(V2CommandExec.scala:45)\r\n\tat org.apache.spark.sql.Dataset.$anonfun$logicalPlan$1(Dataset.scala:229)\r\n\tat org.apache.spark.sql.Dataset.$anonfun$withAction$1(Dataset.scala:3618)\r\n\tat org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$5(SQLExecution.scala:100)\r\n\tat org.apache.spark.sql.execution.SQLExecution$.withSQLConfPropagated(SQLExecution.scala:160)\r\n\tat org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$1(SQLExecution.scala:87)\r\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:764)\r\n\tat org.apache.spark.sql.execution.SQLExecution$.withNewExecutionId(SQLExecution.scala:64)\r\n\tat org.apache.spark.sql.Dataset.withAction(Dataset.scala:3616)\r\n\tat org.apache.spark.sql.Dataset.<init>(Dataset.scala:229)\r\n\tat org.apache.spark.sql.Dataset$.$anonfun$ofRows$2(Dataset.scala:100)\r\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:764)\r\n\tat org.apache.spark.sql.Dataset$.ofRows(Dataset.scala:97)\r\n\tat org.apache.spark.sql.SparkSession.$anonfun$sql$1(SparkSession.scala:607)\r\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:764)\r\n\tat org.apache.spark.sql.SparkSession.sql(SparkSession.scala:602)\r\n\tat org.apache.spark.sql.SQLContext.sql(SQLContext.scala:650)\r\n\tat org.apache.spark.sql.hive.thriftserver.SparkSQLDriver.run(SparkSQLDriver.scala:63)\r\n\tat org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver.processCmd(SparkSQLCLIDriver.scala:377)\r\n\tat org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver.$anonfun$processLine$1(SparkSQLCLIDriver.scala:496)\r\n\tat org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver.$anonfun$processLine$1$adapted(SparkSQLCLIDriver.scala:490)\r\n\tat scala.collection.Iterator.foreach(Iterator.scala:941)\r\n\tat scala.collection.Iterator.foreach$(Iterator.scala:941)\r\n\tat scala.collection.AbstractIterator.foreach(Iterator.scala:1429)\r\n\tat scala.collection.IterableLike.foreach(IterableLike.scala:74)\r\n\tat scala.collection.IterableLike.foreach$(IterableLike.scala:73)\r\n\tat scala.collection.AbstractIterable.foreach(Iterable.scala:56)\r\n\tat org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver.processLine(SparkSQLCLIDriver.scala:490)\r\n\tat org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver$.main(SparkSQLCLIDriver.scala:282)\r\n\tat org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver.main(SparkSQLCLIDriver.scala)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.apache.spark.deploy.JavaMainApplication.start(SparkApplication.scala:52)\r\n\tat org.apache.spark.deploy.SparkSubmit.org$apache$spark$deploy$SparkSubmit$$runMain(SparkSubmit.scala:928)\r\n\tat org.apache.spark.deploy.SparkSubmit.doRunMain$1(SparkSubmit.scala:180)\r\n\tat org.apache.spark.deploy.SparkSubmit.submit(SparkSubmit.scala:203)\r\n\tat org.apache.spark.deploy.SparkSubmit.doSubmit(SparkSubmit.scala:90)\r\n\tat org.apache.spark.deploy.SparkSubmit$$anon$2.doSubmit(SparkSubmit.scala:1007)\r\n\tat org.apache.spark.deploy.SparkSubmit$.main(SparkSubmit.scala:1016)\r\n\tat org.apache.spark.deploy.SparkSubmit.main(SparkSubmit.scala)\r\njava.lang.IllegalArgumentException: Can't zip RDDs with unequal numbers of partitions: List(1, 0)\r\n\tat org.apache.spark.rdd.ZippedPartitionsBaseRDD.getPartitions(ZippedPartitionsRDD.scala:58)\r\n\tat org.apache.spark.rdd.RDD.$anonfun$partitions$2(RDD.scala:276)\r\n\tat scala.Option.getOrElse(Option.scala:189)\r\n\tat org.apache.spark.rdd.RDD.partitions(RDD.scala:272)\r\n\tat org.apache.spark.rdd.MapPartitionsRDD.getPartitions(MapPartitionsRDD.scala:49)\r\n\tat org.apache.spark.rdd.RDD.$anonfun$partitions$2(RDD.scala:276)\r\n\tat scala.Option.getOrElse(Option.scala:189)\r\n\tat org.apache.spark.rdd.RDD.partitions(RDD.scala:272)\r\n\tat org.apache.spark.sql.execution.datasources.v2.V2TableWriteExec.writeWithV2(WriteToDataSourceV2Exec.scala:366)\r\n\tat org.apache.spark.sql.execution.datasources.v2.V2TableWriteExec.writeWithV2$(WriteToDataSourceV2Exec.scala:361)\r\n\tat org.apache.spark.sql.execution.datasources.v2.ReplaceDataExec.writeWithV2(ReplaceDataExec.scala:26)\r\n\tat org.apache.spark.sql.execution.datasources.v2.ReplaceDataExec.run(ReplaceDataExec.scala:34)\r\n\tat org.apache.spark.sql.execution.datasources.v2.V2CommandExec.result$lzycompute(V2CommandExec.scala:39)\r\n\tat org.apache.spark.sql.execution.datasources.v2.V2CommandExec.result(V2CommandExec.scala:39)\r\n\tat org.apache.spark.sql.execution.datasources.v2.V2CommandExec.executeCollect(V2CommandExec.scala:45)\r\n\tat org.apache.spark.sql.Dataset.$anonfun$logicalPlan$1(Dataset.scala:229)\r\n\tat org.apache.spark.sql.Dataset.$anonfun$withAction$1(Dataset.scala:3618)\r\n\tat org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$5(SQLExecution.scala:100)\r\n\tat org.apache.spark.sql.execution.SQLExecution$.withSQLConfPropagated(SQLExecution.scala:160)\r\n\tat org.apache.spark.sql.execution.SQLExecution$.$anonfun$withNewExecutionId$1(SQLExecution.scala:87)\r\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:764)\r\n\tat org.apache.spark.sql.execution.SQLExecution$.withNewExecutionId(SQLExecution.scala:64)\r\n\tat org.apache.spark.sql.Dataset.withAction(Dataset.scala:3616)\r\n\tat org.apache.spark.sql.Dataset.<init>(Dataset.scala:229)\r\n\tat org.apache.spark.sql.Dataset$.$anonfun$ofRows$2(Dataset.scala:100)\r\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:764)\r\n\tat org.apache.spark.sql.Dataset$.ofRows(Dataset.scala:97)\r\n\tat org.apache.spark.sql.SparkSession.$anonfun$sql$1(SparkSession.scala:607)\r\n\tat org.apache.spark.sql.SparkSession.withActive(SparkSession.scala:764)\r\n\tat org.apache.spark.sql.SparkSession.sql(SparkSession.scala:602)\r\n\tat org.apache.spark.sql.SQLContext.sql(SQLContext.scala:650)\r\n\tat org.apache.spark.sql.hive.thriftserver.SparkSQLDriver.run(SparkSQLDriver.scala:63)\r\n\tat org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver.processCmd(SparkSQLCLIDriver.scala:377)\r\n\tat org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver.$anonfun$processLine$1(SparkSQLCLIDriver.scala:496)\r\n\tat org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver.$anonfun$processLine$1$adapted(SparkSQLCLIDriver.scala:490)\r\n\tat scala.collection.Iterator.foreach(Iterator.scala:941)\r\n\tat scala.collection.Iterator.foreach$(Iterator.scala:941)\r\n\tat scala.collection.AbstractIterator.foreach(Iterator.scala:1429)\r\n\tat scala.collection.IterableLike.foreach(IterableLike.scala:74)\r\n\tat scala.collection.IterableLike.foreach$(IterableLike.scala:73)\r\n\tat scala.collection.AbstractIterable.foreach(Iterable.scala:56)\r\n\tat org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver.processLine(SparkSQLCLIDriver.scala:490)\r\n\tat org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver$.main(SparkSQLCLIDriver.scala:282)\r\n\tat org.apache.spark.sql.hive.thriftserver.SparkSQLCLIDriver.main(SparkSQLCLIDriver.scala)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\r\n\tat sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\r\n\tat sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\r\n\tat java.lang.reflect.Method.invoke(Method.java:498)\r\n\tat org.apache.spark.deploy.JavaMainApplication.start(SparkApplication.scala:52)\r\n\tat org.apache.spark.deploy.SparkSubmit.org$apache$spark$deploy$SparkSubmit$$runMain(SparkSubmit.scala:928)\r\n\tat org.apache.spark.deploy.SparkSubmit.doRunMain$1(SparkSubmit.scala:180)\r\n\tat org.apache.spark.deploy.SparkSubmit.submit(SparkSubmit.scala:203)\r\n\tat org.apache.spark.deploy.SparkSubmit.doSubmit(SparkSubmit.scala:90)\r\n\tat org.apache.spark.deploy.SparkSubmit$$anon$2.doSubmit(SparkSubmit.scala:1007)\r\n\tat org.apache.spark.deploy.SparkSubmit$.main(SparkSubmit.scala:1016)\r\n\tat org.apache.spark.deploy.SparkSubmit.main(SparkSubmit.scala)\r\n```\r\n\r\nBut if I change the log_time range to (2021-05-06 12:03:00, 2021-05-06 12:10:00), the SQL will be success.\r\n\r\n \r\nI guest it's because dst table contain `user_name = 'Bob'` AND `end_time = '2021-05-06 12:03:00'` record, that is match the `src.user_name = dst.user_name AND src.start_time = dst.end_time` condition and make dst table is not empty.\r\n\r\n\r\nMy env is spark == 3.0.2 and Iceberg == master. We can reproduce this by execute the sql as below:\r\n\r\n```\r\nCREATE TABLE iceberg.iceberg_db.user_logs (\r\n    log_time STRING,\r\n    log_type STRING,\r\n    user_name STRING\r\n) USING iceberg\r\nTBLPROPERTIES (engine.hive.enabled='true');\r\n\r\nINSERT INTO iceberg.iceberg_db.user_logs\r\nVALUES ('2021-05-06 12:01:00', 'heartbeat', 'Bob'),\r\n       ('2021-05-06 12:03:00', 'heartbeat', 'Bob'),\r\n       ('2021-05-06 12:05:00', 'heartbeat', 'Bob'),\r\n       ('2021-05-06 12:05:00', 'login', 'John'),\r\n       ('2021-05-06 12:05:30', 'heartbeat', 'John'),\r\n       ('2021-05-06 12:06:00', 'heartbeat', 'John'),\r\n       ('2021-05-06 12:06:30', 'logout', 'John');\r\n\r\n\r\nCREATE TABLE iceberg.iceberg_db.user_events (\r\n    start_time STRING,\r\n    end_time STRING,\r\n    user_name STRING\r\n) USING iceberg\r\nTBLPROPERTIES (engine.hive.enabled='true');\r\n\r\nINSERT INTO iceberg.iceberg_db.user_events\r\nVALUES ('2021-05-06 12:01:00', '2021-05-06 12:03:00', 'Bob');\r\n\r\n\r\nMERGE INTO iceberg.iceberg_db.user_events AS dst\r\nUSING(\r\n    SELECT MIN(log_time) AS start_time,\r\n           MAX(log_time) AS end_time,\r\n           user_name\r\n    FROM iceberg.iceberg_db.user_logs\r\n    WHERE log_time >= '2021-05-06 12:05:00'\r\n      AND log_time < '2021-05-06 12:10:00'\r\n    GROUP BY user_name\r\n) AS src\r\nON  src.user_name = dst.user_name\r\nAND src.start_time = dst.end_time\r\nWHEN MATCHED THEN UPDATE SET dst.end_time = src.end_time\r\nWHEN NOT MATCHED THEN INSERT *;\r\n\r\n\r\nMERGE INTO iceberg.iceberg_db.user_events AS dst\r\nUSING(\r\n    SELECT MIN(log_time) AS start_time,\r\n           MAX(log_time) AS end_time,\r\n           user_name\r\n    FROM iceberg.iceberg_db.user_logs\r\n    WHERE log_time >= '2021-05-06 12:03:00'\r\n      AND log_time < '2021-05-06 12:10:00'\r\n    GROUP BY user_name\r\n) AS src\r\nON  src.user_name = dst.user_name\r\nAND src.start_time = dst.end_time\r\nWHEN MATCHED THEN UPDATE SET dst.end_time = src.end_time\r\nWHEN NOT MATCHED THEN INSERT *;\r\n```\r\n\r\nExperiment result：\r\n![image](https://user-images.githubusercontent.com/17312872/117320598-f9a08d00-aebe-11eb-8099-402de5d5c8e8.png)\r\n![image](https://user-images.githubusercontent.com/17312872/117320668-09b86c80-aebf-11eb-9f83-18e48573561d.png)\r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833595041/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833688123","html_url":"https://github.com/apache/iceberg/issues/1617#issuecomment-833688123","issue_url":"https://api.github.com/repos/apache/iceberg/issues/1617","id":833688123,"node_id":"MDEyOklzc3VlQ29tbWVudDgzMzY4ODEyMw==","user":{"login":"anuragmantri","id":13743212,"node_id":"MDQ6VXNlcjEzNzQzMjEy","avatar_url":"https://avatars.githubusercontent.com/u/13743212?v=4","gravatar_id":"","url":"https://api.github.com/users/anuragmantri","html_url":"https://github.com/anuragmantri","followers_url":"https://api.github.com/users/anuragmantri/followers","following_url":"https://api.github.com/users/anuragmantri/following{/other_user}","gists_url":"https://api.github.com/users/anuragmantri/gists{/gist_id}","starred_url":"https://api.github.com/users/anuragmantri/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/anuragmantri/subscriptions","organizations_url":"https://api.github.com/users/anuragmantri/orgs","repos_url":"https://api.github.com/users/anuragmantri/repos","events_url":"https://api.github.com/users/anuragmantri/events{/privacy}","received_events_url":"https://api.github.com/users/anuragmantri/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-05-06T17:00:04Z","updated_at":"2021-05-06T17:00:04Z","author_association":"CONTRIBUTOR","body":"@flyrain, in my latest comment to Ryan's comment in the [design doc](https://docs.google.com/document/d/1RDEjJAVEXg1csRzyzTuM634L88vvI0iDHNQQK3kOVR0/edit#), I proposed starting with \"supporting relative paths in metadata\" which does not need changes to the spec. We can then look at refactoring the fields of metadata.json file. This will make it easier to implement and review the change. What are your thoughts?","reactions":{"url":"https://api.github.com/repos/apache/iceberg/issues/comments/833688123/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]