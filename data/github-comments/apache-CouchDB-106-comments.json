[{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/991310386","html_url":"https://github.com/apache/couchdb/issues/3821#issuecomment-991310386","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3821","id":991310386,"node_id":"IC_kwDOAAMmUc47FjIy","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-10T21:34:21Z","updated_at":"2021-12-10T21:34:21Z","author_association":"CONTRIBUTOR","body":"Since we merged the fix, closing the issue. \r\n\r\nAs a work-around until the next release, try to use Erlang 23+ if possible.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/991310386/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/992012171","html_url":"https://github.com/apache/couchdb/issues/1600#issuecomment-992012171","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1600","id":992012171,"node_id":"IC_kwDOAAMmUc47IOeL","user":{"login":"style95","id":3447251,"node_id":"MDQ6VXNlcjM0NDcyNTE=","avatar_url":"https://avatars.githubusercontent.com/u/3447251?v=4","gravatar_id":"","url":"https://api.github.com/users/style95","html_url":"https://github.com/style95","followers_url":"https://api.github.com/users/style95/followers","following_url":"https://api.github.com/users/style95/following{/other_user}","gists_url":"https://api.github.com/users/style95/gists{/gist_id}","starred_url":"https://api.github.com/users/style95/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/style95/subscriptions","organizations_url":"https://api.github.com/users/style95/orgs","repos_url":"https://api.github.com/users/style95/repos","events_url":"https://api.github.com/users/style95/events{/privacy}","received_events_url":"https://api.github.com/users/style95/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-13T00:52:01Z","updated_at":"2021-12-13T00:52:01Z","author_association":"MEMBER","body":"@nickva Thank you for sharing.\r\nI am using CouchDB v2.3.1, considering upgrading it to 3.2.1.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/992012171/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/992159224","html_url":"https://github.com/apache/couchdb/issues/3871#issuecomment-992159224","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3871","id":992159224,"node_id":"IC_kwDOAAMmUc47IyX4","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-13T06:48:18Z","updated_at":"2021-12-13T06:48:51Z","author_association":"CONTRIBUTOR","body":"@lostnet thanks for noticing.\r\n\r\nI debated just copy pasting from `rebar` and modifying it to install `rebar3` and `erlfmt`, but since I don't have a working windows dev setup to verify it, and don't know ps1, I opted to create a separate enhancement issue for it: https://github.com/apache/couchdb/issues/3873 for the time being. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/992159224/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/992159682","html_url":"https://github.com/apache/couchdb/issues/3871#issuecomment-992159682","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3871","id":992159682,"node_id":"IC_kwDOAAMmUc47IyfC","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-13T06:49:14Z","updated_at":"2021-12-13T06:49:14Z","author_association":"CONTRIBUTOR","body":"The fix to make sure we run erlfmt https://github.com/apache/couchdb/pull/3872","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/992159682/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/992681291","html_url":"https://github.com/apache/couchdb/issues/3871#issuecomment-992681291","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3871","id":992681291,"node_id":"IC_kwDOAAMmUc47Kx1L","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-13T17:02:18Z","updated_at":"2021-12-13T17:02:18Z","author_association":"CONTRIBUTOR","body":"The fix for the 3.x CI erlfmt was merged. Closing the issue. Made a separate issue about erlfmt in windows","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/992681291/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/995307096","html_url":"https://github.com/apache/couchdb/pull/3766#issuecomment-995307096","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3766","id":995307096,"node_id":"IC_kwDOAAMmUc47Uy5Y","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-15T23:52:15Z","updated_at":"2021-12-15T23:52:15Z","author_association":"CONTRIBUTOR","body":"@noahshaw11  to help with formatting I had tried to reformat your PR with erlfmt. The result is in the branch  https://github.com/apache/couchdb/commits/pr-3766\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/995307096/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/996357382","html_url":"https://github.com/apache/couchdb/issues/3154#issuecomment-996357382","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3154","id":996357382,"node_id":"IC_kwDOAAMmUc47YzUG","user":{"login":"gerrycocco","id":4722852,"node_id":"MDQ6VXNlcjQ3MjI4NTI=","avatar_url":"https://avatars.githubusercontent.com/u/4722852?v=4","gravatar_id":"","url":"https://api.github.com/users/gerrycocco","html_url":"https://github.com/gerrycocco","followers_url":"https://api.github.com/users/gerrycocco/followers","following_url":"https://api.github.com/users/gerrycocco/following{/other_user}","gists_url":"https://api.github.com/users/gerrycocco/gists{/gist_id}","starred_url":"https://api.github.com/users/gerrycocco/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/gerrycocco/subscriptions","organizations_url":"https://api.github.com/users/gerrycocco/orgs","repos_url":"https://api.github.com/users/gerrycocco/repos","events_url":"https://api.github.com/users/gerrycocco/events{/privacy}","received_events_url":"https://api.github.com/users/gerrycocco/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-17T01:36:48Z","updated_at":"2021-12-17T01:36:48Z","author_association":"NONE","body":"Hi.  Since Debian Bullseye's release date was 2021-08-14, can you comment on the availability of an official release package?  Thank you.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/996357382/reactions","total_count":2,"+1":2,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/996817691","html_url":"https://github.com/apache/couchdb/issues/3874#issuecomment-996817691","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3874","id":996817691,"node_id":"IC_kwDOAAMmUc47ajsb","user":{"login":"lostnet","id":1422781,"node_id":"MDQ6VXNlcjE0MjI3ODE=","avatar_url":"https://avatars.githubusercontent.com/u/1422781?v=4","gravatar_id":"","url":"https://api.github.com/users/lostnet","html_url":"https://github.com/lostnet","followers_url":"https://api.github.com/users/lostnet/followers","following_url":"https://api.github.com/users/lostnet/following{/other_user}","gists_url":"https://api.github.com/users/lostnet/gists{/gist_id}","starred_url":"https://api.github.com/users/lostnet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/lostnet/subscriptions","organizations_url":"https://api.github.com/users/lostnet/orgs","repos_url":"https://api.github.com/users/lostnet/repos","events_url":"https://api.github.com/users/lostnet/events{/privacy}","received_events_url":"https://api.github.com/users/lostnet/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-17T15:36:53Z","updated_at":"2021-12-17T15:36:53Z","author_association":"CONTRIBUTOR","body":"Looks like yocto is being updated: https://github.com/meta-erlang/meta-erlang/issues/140\r\n\r\nI think configure might be missing that this is aarch64 and SM60 since it is a cross compile? But if SM60 isn't specially patched for aarch64 on yocto it would be better if it were using at least 68, preferably 78. https://github.com/apache/couchdb/issues/3149","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/996817691/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/996978119","html_url":"https://github.com/apache/couchdb/pull/3880#issuecomment-996978119","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3880","id":996978119,"node_id":"IC_kwDOAAMmUc47bK3H","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-17T19:22:02Z","updated_at":"2021-12-17T19:22:02Z","author_association":"CONTRIBUTOR","body":"To double-check if the compiler options work, try running \r\n\r\n```\r\nmake clean && ERL_COMPILER_OPTIONS='[no_line_info,deterministic,no_debug_info]' make\r\n```\r\n\r\nCapture module info from some module (something like `couch_db:module_info(compile).` perhaps) then run `make clean && make` and see if the changes took effect.  With `no_debug_info` there should be almost no extra info shown.\r\n\r\nAlso don't forget to update the `Makefile{.win}` files since reference `ERL_OPTS` there as well.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/996978119/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/996988868","html_url":"https://github.com/apache/couchdb/pull/3880#issuecomment-996988868","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3880","id":996988868,"node_id":"IC_kwDOAAMmUc47bNfE","user":{"login":"noahshaw11","id":47468872,"node_id":"MDQ6VXNlcjQ3NDY4ODcy","avatar_url":"https://avatars.githubusercontent.com/u/47468872?v=4","gravatar_id":"","url":"https://api.github.com/users/noahshaw11","html_url":"https://github.com/noahshaw11","followers_url":"https://api.github.com/users/noahshaw11/followers","following_url":"https://api.github.com/users/noahshaw11/following{/other_user}","gists_url":"https://api.github.com/users/noahshaw11/gists{/gist_id}","starred_url":"https://api.github.com/users/noahshaw11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahshaw11/subscriptions","organizations_url":"https://api.github.com/users/noahshaw11/orgs","repos_url":"https://api.github.com/users/noahshaw11/repos","events_url":"https://api.github.com/users/noahshaw11/events{/privacy}","received_events_url":"https://api.github.com/users/noahshaw11/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-17T19:41:38Z","updated_at":"2021-12-17T19:41:38Z","author_association":"CONTRIBUTOR","body":"> To double-check if the compiler options work, try running\r\n> \r\n> ```\r\n> make clean && ERL_COMPILER_OPTIONS='[no_line_info,deterministic,no_debug_info]' make\r\n> ```\r\n> \r\n> Capture module info from some module (something like `couch_db:module_info(compile).` perhaps) then run `make clean && make` and see if the changes took effect. With `no_debug_info` there should be almost no extra info shown.\r\n> \r\n> Also don't forget to update the `Makefile{.win}` files since reference `ERL_OPTS` there as well.\r\n\r\nThe compiler options are taking effect.\r\n\r\nWith compiler options:\r\n```\r\n(node1@127.0.0.1)1> couch_db:module_info(compile).\r\n[{version,\"7.6.7\"}]\r\n```\r\n\r\nWithout compiler options:\r\n```\r\n(node1@127.0.0.1)1> couch_db:module_info(compile).\r\n[{version,\"7.6.7\"},\r\n {options,[debug_info,\r\n           {d,'COUCHDB_VERSION',\"3.2.1-48bfdcf\"},\r\n           {d,'COUCHDB_GIT_SHA',\"48bfdcf\"},\r\n           {d,'COUCHDB_SPIDERMONKEY_VERSION',\"1.8.5\"},\r\n           {i,\"../\"},\r\n           {d,'WITH_PROPER'},\r\n           {i,\"include\"}]},\r\n {source,\"/Users/ncshaw/src/couchdb/src/couch/src/couch_db.erl\"}]\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/996988868/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/999773712","html_url":"https://github.com/apache/couchdb/pull/3881#issuecomment-999773712","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3881","id":999773712,"node_id":"IC_kwDOAAMmUc47l1YQ","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-22T18:15:32Z","updated_at":"2021-12-22T18:15:32Z","author_association":"CONTRIBUTOR","body":"jenkins requires `erlfmt` check to pass before it'll build. I think we added this enforcement recently:\r\n\r\nhttps://github.com/apache/couchdb/commit/b78ccf18cb4ed6e183ed0bf4e5cbe40d7a7dc493","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/999773712/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1000425054","html_url":"https://github.com/apache/couchdb/pull/3881#issuecomment-1000425054","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3881","id":1000425054,"node_id":"IC_kwDOAAMmUc47oUZe","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-23T16:59:05Z","updated_at":"2021-12-23T16:59:05Z","author_association":"CONTRIBUTOR","body":"+1","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1000425054/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1003087534","html_url":"https://github.com/apache/couchdb/issues/3816#issuecomment-1003087534","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3816","id":1003087534,"node_id":"IC_kwDOAAMmUc47yeau","user":{"login":"noahmehl","id":263452,"node_id":"MDQ6VXNlcjI2MzQ1Mg==","avatar_url":"https://avatars.githubusercontent.com/u/263452?v=4","gravatar_id":"","url":"https://api.github.com/users/noahmehl","html_url":"https://github.com/noahmehl","followers_url":"https://api.github.com/users/noahmehl/followers","following_url":"https://api.github.com/users/noahmehl/following{/other_user}","gists_url":"https://api.github.com/users/noahmehl/gists{/gist_id}","starred_url":"https://api.github.com/users/noahmehl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahmehl/subscriptions","organizations_url":"https://api.github.com/users/noahmehl/orgs","repos_url":"https://api.github.com/users/noahmehl/repos","events_url":"https://api.github.com/users/noahmehl/events{/privacy}","received_events_url":"https://api.github.com/users/noahmehl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2021-12-30T15:58:12Z","updated_at":"2021-12-30T15:58:12Z","author_association":"NONE","body":"Should this be moved to https://github.com/apache/couchdb-fauxton ?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1003087534/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1005458451","html_url":"https://github.com/apache/couchdb/issues/1579#issuecomment-1005458451","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1579","id":1005458451,"node_id":"IC_kwDOAAMmUc477hQT","user":{"login":"guanfeix","id":34960209,"node_id":"MDQ6VXNlcjM0OTYwMjA5","avatar_url":"https://avatars.githubusercontent.com/u/34960209?v=4","gravatar_id":"","url":"https://api.github.com/users/guanfeix","html_url":"https://github.com/guanfeix","followers_url":"https://api.github.com/users/guanfeix/followers","following_url":"https://api.github.com/users/guanfeix/following{/other_user}","gists_url":"https://api.github.com/users/guanfeix/gists{/gist_id}","starred_url":"https://api.github.com/users/guanfeix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guanfeix/subscriptions","organizations_url":"https://api.github.com/users/guanfeix/orgs","repos_url":"https://api.github.com/users/guanfeix/repos","events_url":"https://api.github.com/users/guanfeix/events{/privacy}","received_events_url":"https://api.github.com/users/guanfeix/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-05T07:56:31Z","updated_at":"2022-01-05T07:56:31Z","author_association":"NONE","body":"> The auto-compactor has been replaced completely. Closing the issue as it's probably not relevant any longer. Please feel free to re-open if the issue is still present on 3.x releases.\r\n\r\nI just run into the same issue in couchdb 2.3.1 which config auto compaction.But never  trigger that we can see below \r\n![图片](https://user-images.githubusercontent.com/34960209/148180186-1d1eaaaf-3650-4615-9a4b-40256502c763.png)\r\nthis is my config \r\n![图片](https://user-images.githubusercontent.com/34960209/148180477-144d6c05-3208-42ab-a128-d81e013d8312.png)\r\nit will in effect when i trigger manually by \r\ncurl -H \"Content-Type: application/json\" -X POST http://localhost:5984/my_db/_compact\r\nhow can i solve it, in couchdb 1.6.1 it also no effect by configuration below.i know that because  some db will grow to GB even thought only small counts of samll doc(which update frequently)\r\n![图片](https://user-images.githubusercontent.com/34960209/148180810-00717c44-4354-4d29-a409-a0482b973542.png)\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1005458451/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1005850742","html_url":"https://github.com/apache/couchdb/issues/1579#issuecomment-1005850742","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1579","id":1005850742,"node_id":"IC_kwDOAAMmUc479BB2","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-05T15:57:05Z","updated_at":"2022-01-05T15:57:05Z","author_association":"CONTRIBUTOR","body":"Try to lower the fragmentation threshold. Also increase the debug level and monitor the logs to see if something crashes.\r\n\r\nOverall, 2.x and 1.6.x have been surpassed by 3.x so see if you could upgrade.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1005850742/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1006449846","html_url":"https://github.com/apache/couchdb/issues/1579#issuecomment-1006449846","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1579","id":1006449846,"node_id":"IC_kwDOAAMmUc47_TS2","user":{"login":"guanfeix","id":34960209,"node_id":"MDQ6VXNlcjM0OTYwMjA5","avatar_url":"https://avatars.githubusercontent.com/u/34960209?v=4","gravatar_id":"","url":"https://api.github.com/users/guanfeix","html_url":"https://github.com/guanfeix","followers_url":"https://api.github.com/users/guanfeix/followers","following_url":"https://api.github.com/users/guanfeix/following{/other_user}","gists_url":"https://api.github.com/users/guanfeix/gists{/gist_id}","starred_url":"https://api.github.com/users/guanfeix/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/guanfeix/subscriptions","organizations_url":"https://api.github.com/users/guanfeix/orgs","repos_url":"https://api.github.com/users/guanfeix/repos","events_url":"https://api.github.com/users/guanfeix/events{/privacy}","received_events_url":"https://api.github.com/users/guanfeix/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-06T10:23:57Z","updated_at":"2022-01-06T10:23:57Z","author_association":"NONE","body":"> Try to lower the fragmentation threshold. Also increase the debug level and monitor the logs to see if something crashes.\r\n> \r\n> Overall, 2.x and 1.6.x have been surpassed by 3.x so see if you could upgrade.\r\n\r\nI want to upgrade to 3.x,but because of force authentication in 3.x which will result in too much changes in our original application code.And sowe choose 2.3.1.before find a  proper solution for authentication ,we don't take it as consideration.\r\nAlso i just run into view Compaction and Views cleanup seems not work for 2.3.1\r\ncurl -H \"Content-Type: application/json\" -X POST http://localhost:5984/dbname/_view_cleanup\r\ncurl -H \"Content-Type: application/json\" -X POST http://localhost:5984/dbname/_compact/designname\r\n![图片](https://user-images.githubusercontent.com/34960209/148359003-839f7182-2f0b-4855-aed2-57af5c30717f.png)\r\nIn the last, i see compation seems only happens when shards file bigger than min_file_size by compation log. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1006449846/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1009289045","html_url":"https://github.com/apache/couchdb/pull/3795#issuecomment-1009289045","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3795","id":1009289045,"node_id":"IC_kwDOAAMmUc48KIdV","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-10T19:54:18Z","updated_at":"2022-01-10T19:54:18Z","author_association":"CONTRIBUTOR","body":"closing this as the right approach requires a fairly large refactoring. Will use a different PR.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1009289045/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1009616621","html_url":"https://github.com/apache/couchdb/issues/3887#issuecomment-1009616621","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3887","id":1009616621,"node_id":"IC_kwDOAAMmUc48LYbt","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-11T05:39:23Z","updated_at":"2022-01-11T05:39:23Z","author_association":"CONTRIBUTOR","body":"This looks like a bug with url parsing. Specifically, it looks like it's in the _session (cookie) auth plugin in replicator. \r\n\r\nIf you're willing to try an experiment, see if disabling the session auth plugin would make it behave differently.  Try this config setting:\r\n\r\n```ini\r\n[replicator]\r\nauth_plugins = couch_replicator_auth_noop\r\n```\r\n\r\nThis bypasses the session plugin and switches to sending basic auth credentials with every request. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1009616621/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1009834825","html_url":"https://github.com/apache/couchdb/pull/1253#issuecomment-1009834825","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1253","id":1009834825,"node_id":"IC_kwDOAAMmUc48MNtJ","user":{"login":"saurabhprasadsah","id":42804047,"node_id":"MDQ6VXNlcjQyODA0MDQ3","avatar_url":"https://avatars.githubusercontent.com/u/42804047?v=4","gravatar_id":"","url":"https://api.github.com/users/saurabhprasadsah","html_url":"https://github.com/saurabhprasadsah","followers_url":"https://api.github.com/users/saurabhprasadsah/followers","following_url":"https://api.github.com/users/saurabhprasadsah/following{/other_user}","gists_url":"https://api.github.com/users/saurabhprasadsah/gists{/gist_id}","starred_url":"https://api.github.com/users/saurabhprasadsah/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/saurabhprasadsah/subscriptions","organizations_url":"https://api.github.com/users/saurabhprasadsah/orgs","repos_url":"https://api.github.com/users/saurabhprasadsah/repos","events_url":"https://api.github.com/users/saurabhprasadsah/events{/privacy}","received_events_url":"https://api.github.com/users/saurabhprasadsah/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-11T10:41:51Z","updated_at":"2022-01-11T10:41:51Z","author_association":"NONE","body":"this is very stale.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1009834825/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1009896718","html_url":"https://github.com/apache/couchdb/issues/3887#issuecomment-1009896718","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3887","id":1009896718,"node_id":"IC_kwDOAAMmUc48Mc0O","user":{"login":"JakeHillion","id":5712856,"node_id":"MDQ6VXNlcjU3MTI4NTY=","avatar_url":"https://avatars.githubusercontent.com/u/5712856?v=4","gravatar_id":"","url":"https://api.github.com/users/JakeHillion","html_url":"https://github.com/JakeHillion","followers_url":"https://api.github.com/users/JakeHillion/followers","following_url":"https://api.github.com/users/JakeHillion/following{/other_user}","gists_url":"https://api.github.com/users/JakeHillion/gists{/gist_id}","starred_url":"https://api.github.com/users/JakeHillion/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/JakeHillion/subscriptions","organizations_url":"https://api.github.com/users/JakeHillion/orgs","repos_url":"https://api.github.com/users/JakeHillion/repos","events_url":"https://api.github.com/users/JakeHillion/events{/privacy}","received_events_url":"https://api.github.com/users/JakeHillion/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-11T12:01:28Z","updated_at":"2022-01-11T12:01:28Z","author_association":"NONE","body":"Happy to try extra tests now I've got the machines setup.\r\n\r\n## My Environment\r\n\r\nAdded to each machine:\r\n\r\n```\r\ncat > /opt/couchdb/etc/local.d/20-replicator.ini\r\n[replicator]\r\nauth_plugins = couch_replicator_auth_noop\r\n```\r\n\r\nOtherwise same as initial post.\r\n\r\n## Replicate Endpoint\r\n\r\n- `curl -X POST -H 'Content-Type: application/json' 'http://[fd19:ca4f:1891:0:5d59:4c52:1d67:4f85]:5984/_replicate' -d '{\"source\":\"http://[fd19:ca4f:1891:0:c77d:21c3:80b1:47d5]:5984/a\",\"target\":\"http://[fd19:ca4f:1891:0:5d59:4c52:1d67:4f85]:5984/b\"}'`\r\n  - `{\"error\":\"nxdomain\",\"reason\":\"could not resolve http://[fd19:ca4f:1891:0:c77d:21c3:80b1:47d5]:5984/a/\"}`\r\n\r\n## Fauxton\r\n\r\nConfigured in the UI as above.\r\n\r\nLogs:\r\n- `[notice] 2022-01-11T11:58:34.347861Z couchdb@127.0.0.1 <0.3873.0> -------- Retrying GET request to http://[fd19:ca4f:1891:0:c77d:21c3:80b1:47d5]:5984/a/ in 4.0 seconds due to error {conn_failed,{error,nxdomain}}`\r\n- `[error] 2022-01-11T11:58:34.348737Z couchdb@127.0.0.1 <0.3873.0> -------- Replicator, request GET to \"http://[fd19:ca4f:1891:0:c77d:21c3:80b1:47d5]:5984/a/\" failed due to error {error,{conn_failed,{error,nxdomain}}}`\r\n- `[error] 2022-01-11T11:58:34.349091Z couchdb@127.0.0.1 <0.3873.0> -------- exit:{nxdomain,<<\"could not resolve http://[fd19:ca4f:1891:0:c77d:21c3:80b1:47d5]:5984/a/\">>}: Replication 0d172815abcfddb7ae70200408d7f6b8 failed to start \"http://[fd19:ca4f:1891:0:c77d:21c3:80b1:47d5]:5984/a/\" -> \"http://[fd19:ca4f:1891:0:5d59:4c52:1d67:4f85]:5984/b/\" doc <<\"shards/00000000-7fffffff/_replicator.1641770003\">>:<<\"16c76a702836504eee392149ab000b38\">> stack:[{couch_replicator_api_wrap,db_open,3,[{file,\"src/couch_replicator_api_wrap.erl\"},{line,120}]},{couch_replicator_scheduler_job,init_state,1,[{file,\"src/couch_replicator_scheduler_job.erl\"},{line,571}]}]`\r\n\r\n## Summary\r\n\r\nThis seems to align the two methods of replication. Whereas before they were getting different errors, they're now the same, but I'm still experiencing problems in my testing.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1009896718/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1011405127","html_url":"https://github.com/apache/couchdb/pull/3890#issuecomment-1011405127","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3890","id":1011405127,"node_id":"IC_kwDOAAMmUc48SNFH","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T20:03:05Z","updated_at":"2022-01-12T20:03:05Z","author_association":"CONTRIBUTOR","body":"It would be interesting to see how it could plausibly get into that state. It looks like the entry process exited `normal` and we handled it in `handle_info` at `ddoc_cache_lru:handle_info/2(line:219)`. We [found](https://github.com/apache/couchdb/blob/3.x/src/ddoc_cache/src/ddoc_cache_lru.erl#L215) the Pid in the `Pids` table but the key, which we assumed would be present wasn't there.\r\n\r\nIt could be a race condition somehow or multiple entries (Pids) point to the same key?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1011405127/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1011418175","html_url":"https://github.com/apache/couchdb/pull/3889#issuecomment-1011418175","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3889","id":1011418175,"node_id":"IC_kwDOAAMmUc48SQQ_","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T20:20:13Z","updated_at":"2022-01-12T20:20:13Z","author_association":"CONTRIBUTOR","body":"As per [ML discussion](https://lists.apache.org/thread/4jg3o3ld6mfqnc4hcc28sslhmhxfy7kf) with @lostnet on the ML I think we should switch to [ucol_getVersion()](https://unicode-org.github.io/icu-docs/apidoc/dev/icu4c/ucol_8h.html#a0f98dd01ba7a64069ade6f0fda13528d). We'll expose it from C along with the UCA and ICU versions.\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1011418175/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1011475181","html_url":"https://github.com/apache/couchdb/pull/3892#issuecomment-1011475181","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3892","id":1011475181,"node_id":"IC_kwDOAAMmUc48SeLt","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-12T21:37:27Z","updated_at":"2022-01-12T21:37:27Z","author_association":"MEMBER","body":"Yes, thanks Nick, I'm working on uploading a new CI platform image with those Erlang versions now.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1011475181/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1012122342","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-1012122342","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":1012122342,"node_id":"IC_kwDOAAMmUc48U8Lm","user":{"login":"chladic","id":26329455,"node_id":"MDQ6VXNlcjI2MzI5NDU1","avatar_url":"https://avatars.githubusercontent.com/u/26329455?v=4","gravatar_id":"","url":"https://api.github.com/users/chladic","html_url":"https://github.com/chladic","followers_url":"https://api.github.com/users/chladic/followers","following_url":"https://api.github.com/users/chladic/following{/other_user}","gists_url":"https://api.github.com/users/chladic/gists{/gist_id}","starred_url":"https://api.github.com/users/chladic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chladic/subscriptions","organizations_url":"https://api.github.com/users/chladic/orgs","repos_url":"https://api.github.com/users/chladic/repos","events_url":"https://api.github.com/users/chladic/events{/privacy}","received_events_url":"https://api.github.com/users/chladic/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-13T13:10:18Z","updated_at":"2022-01-13T13:10:18Z","author_association":"NONE","body":"Im very confused with docs, tried to set up cluster few times and it does not work as its described. When I dont set admin user in local.ini, my couchDB server does not even start, so I cant start configuring it via API.\r\n\r\nI followed @jaydoane manual for setting 3 node couchdb1/2/3 and when I do at the end:\r\n```\r\ncurl -X POST -H \"Content-Type: application/json\" http://couchdb1:5984/_cluster_setup -d '{\"action\": \"finish_cluster\" }'\r\n{\"ok\":true}\r\ncurl http://couchdb1:5984/_cluster_setup\r\n{\"state\":\"single_node_enabled\"}\r\n```\r\n\r\nCluster looks like its working, but _cluster_setup endpoint is telling me its single_node, not cluster. Is there some magic trick for getting result: \"cluster_finished\"","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1012122342/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1012261942","html_url":"https://github.com/apache/couchdb/issues/1781#issuecomment-1012261942","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1781","id":1012261942,"node_id":"IC_kwDOAAMmUc48VeQ2","user":{"login":"chladic","id":26329455,"node_id":"MDQ6VXNlcjI2MzI5NDU1","avatar_url":"https://avatars.githubusercontent.com/u/26329455?v=4","gravatar_id":"","url":"https://api.github.com/users/chladic","html_url":"https://github.com/chladic","followers_url":"https://api.github.com/users/chladic/followers","following_url":"https://api.github.com/users/chladic/following{/other_user}","gists_url":"https://api.github.com/users/chladic/gists{/gist_id}","starred_url":"https://api.github.com/users/chladic/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/chladic/subscriptions","organizations_url":"https://api.github.com/users/chladic/orgs","repos_url":"https://api.github.com/users/chladic/repos","events_url":"https://api.github.com/users/chladic/events{/privacy}","received_events_url":"https://api.github.com/users/chladic/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-13T15:49:08Z","updated_at":"2022-01-13T15:49:08Z","author_association":"NONE","body":"I finally found the reason.\r\nIn Debian default installation there is a file:\r\n```\r\ncat etc/default.d/5-single-node.ini\r\n\r\n# Package-introduced single node file\r\n[cluster]\r\nn = 1\r\n```\r\n\r\nAfter removing this file, I get `_cluster_setup` correctly to `cluster_finished`","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1012261942/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1012533209","html_url":"https://github.com/apache/couchdb/issues/3887#issuecomment-1012533209","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3887","id":1012533209,"node_id":"IC_kwDOAAMmUc48WgfZ","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-13T21:33:56Z","updated_at":"2022-01-13T21:33:56Z","author_association":"CONTRIBUTOR","body":"@JakeHillion thank you for checking.\r\n\r\n`nxdomain` is the error from failing to resolve the host with DNS. In this case it's an IP already just in the IPv6 format. So this looks like a bug.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1012533209/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1012564436","html_url":"https://github.com/apache/couchdb/pull/3895#issuecomment-1012564436","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3895","id":1012564436,"node_id":"IC_kwDOAAMmUc48WoHU","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-13T22:23:05Z","updated_at":"2022-01-13T22:23:05Z","author_association":"MEMBER","body":"I like the direction that this is headed. I was probably too aggressive on upgrading to Elixir v1.13.2 (released today!) in the Erlang 22/23/24 images -- the `credo` static analysis tool is not yet compatible with the 1.13 series at all. Will try 1.12 locally and see how that goes.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1012564436/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1012659553","html_url":"https://github.com/apache/couchdb/pull/3895#issuecomment-1012659553","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3895","id":1012659553,"node_id":"IC_kwDOAAMmUc48W_Vh","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-14T01:11:37Z","updated_at":"2022-01-14T01:11:37Z","author_association":"MEMBER","body":"OK, dropping back to Elixir 1.12 helped out. I will file a PR for `couchdb-ci` with the changes I made over there. Technically credo says full Elixir 1.12 compatibility landed in v1.5.6 so I guess I'll bump that one as well, but I think this is ready for a review if anyone wants to take a look.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1012659553/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1013465606","html_url":"https://github.com/apache/couchdb/issues/3897#issuecomment-1013465606","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3897","id":1013465606,"node_id":"IC_kwDOAAMmUc48aEIG","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-14T20:51:52Z","updated_at":"2022-01-14T20:51:52Z","author_association":"CONTRIBUTOR","body":"One idea is to revive the `instance_start_time` and make it return something other than \"0\" again. Perhaps generate a random one, and save it in the shard doc. Maybe, just re-use the shard suffix unix time suffix which we already save in the shard doc?\r\n\r\nIndividual shards already have an `instance_start_time`, so we could also pick highest/lowest from the list of shards in the db. With multiple shards in 3.x on various nodes, this because a bit tricky. Cache them perhaps to avoid frequent fabric calls with a busy replication endpoint.\r\n\r\nBut this would allow us to re-use the the `checkpoint_commit_failure` check in the replicator:\r\n\r\nhttps://github.com/apache/couchdb/blob/3.x/src/couch_replicator/src/couch_replicator_scheduler_job.erl#L847-L861\r\n\r\nAnother idea is to start returning a `uuid` in the db info endpoint (and possibly) like we do in main https://github.com/apache/couchdb/commit/19ae50815ca1016719f94a2757e08757b37fb949 (With an associated ML discussion https://lists.apache.org/thread/fjqg4m72xdo568136sdtnhodz2tzrvkl). Then, either return that alongside instance_start_time field in `_ensure_full_commit` response (or truncate it to the right size to make the old 64 bit instance start time, if want to be strict). Here we have the same issue with shards. We'd store it in the cached shard doc, or somehow pick up one of the uuids from the existing shards (say highest?).\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1013465606/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1013707894","html_url":"https://github.com/apache/couchdb/pull/3900#issuecomment-1013707894","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3900","id":1013707894,"node_id":"IC_kwDOAAMmUc48a_R2","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-15T16:08:03Z","updated_at":"2022-01-15T16:08:03Z","author_association":"MEMBER","body":"Will close this PR for now while I work on the tests for the Full Platform Build changes in the `jenkins-*` branch. Using an open PR just doubles the work that Jenkins needs to do since it runs the PR suite as well, which is wasteful since I'm not actually making any changes on that front.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1013707894/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015289616","html_url":"https://github.com/apache/couchdb/pull/3901#issuecomment-1015289616","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3901","id":1015289616,"node_id":"IC_kwDOAAMmUc48hBcQ","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-18T10:47:12Z","updated_at":"2022-01-18T10:47:12Z","author_association":"MEMBER","body":"lgtm overall, I just have a question about a thing that I’m not too familiar with: since you are updating a record, do we have to worry about mixed clusters running one vs the other? — I would assume not since shards are node local mostly, but there might some edge case?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015289616/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015439933","html_url":"https://github.com/apache/couchdb/pull/3901#issuecomment-1015439933","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3901","id":1015439933,"node_id":"IC_kwDOAAMmUc48hmI9","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-18T14:01:29Z","updated_at":"2022-01-18T14:01:29Z","author_association":"MEMBER","body":"I don't think shard records are transmitted between nodes but it's a good question. @nickva thoughts?\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015439933/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015500266","html_url":"https://github.com/apache/couchdb/issues/3054#issuecomment-1015500266","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3054","id":1015500266,"node_id":"IC_kwDOAAMmUc48h03q","user":{"login":"burotica49","id":82665881,"node_id":"MDQ6VXNlcjgyNjY1ODgx","avatar_url":"https://avatars.githubusercontent.com/u/82665881?v=4","gravatar_id":"","url":"https://api.github.com/users/burotica49","html_url":"https://github.com/burotica49","followers_url":"https://api.github.com/users/burotica49/followers","following_url":"https://api.github.com/users/burotica49/following{/other_user}","gists_url":"https://api.github.com/users/burotica49/gists{/gist_id}","starred_url":"https://api.github.com/users/burotica49/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/burotica49/subscriptions","organizations_url":"https://api.github.com/users/burotica49/orgs","repos_url":"https://api.github.com/users/burotica49/repos","events_url":"https://api.github.com/users/burotica49/events{/privacy}","received_events_url":"https://api.github.com/users/burotica49/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-18T15:03:45Z","updated_at":"2022-01-18T15:03:45Z","author_association":"NONE","body":"Hello,\r\n\r\nI have the same problem with pouchDB authentification, couchDB 3.2.1 authentication and VueJS.\r\nEverything works fine except on Safari and iOS, cookies are not accepted.\r\n\r\nIn couchdb local.ini configuration, i add:\r\n\r\n[couch_httpd_auth]\r\nsame_site = None\r\n\r\nthis.remote.login returns me the correct information, but this.remote.getsession returns me an empty userCtx.\r\n\r\nI tested with Axios, when I query the getsession the first time it works and the second time userCtx empty.\r\n\r\n\r\n\r\nBest regard","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015500266/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015673213","html_url":"https://github.com/apache/couchdb/pull/3903#issuecomment-1015673213","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3903","id":1015673213,"node_id":"IC_kwDOAAMmUc48ifF9","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-18T18:01:45Z","updated_at":"2022-01-18T19:45:57Z","author_association":"MEMBER","body":"A couple of bits that still need work:\r\n\r\n- [x] The `failFast` configuration in the scripted parallel pipeline does not appear to be working. I'm actually ambivalent about whether this is something we want; I think there's value in running the other parallel branches to completion to get a better sense of whether a failure is a flake or something more permanent. But I ported it over from declarative to maintain parity for now.\r\n- [x] More significantly, the try-catch error reporting is swallowing build failures, e.g. see [this pipeline run](https://ci-couchdb.apache.org/blue/organizations/jenkins/jenkins-cm1%2FFullPlatformMatrix/detail/jenkins-dynamic-matrix/38/pipeline/193), where EUnit failed on Ubuntu 20.04 but the overall stage was marked as a success. This is a blocker to merge.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015673213/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015677349","html_url":"https://github.com/apache/couchdb/pull/3903#issuecomment-1015677349","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3903","id":1015677349,"node_id":"IC_kwDOAAMmUc48igGl","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-18T18:06:51Z","updated_at":"2022-01-18T18:06:51Z","author_association":"MEMBER","body":"Actually, the overall build _was_ marked as a failure, because the `archiveArtifacts` step in each branch identified that the build was not successful and then the Publish step failed:\r\n\r\n> [2022-01-18T17:45:46.919Z] Skipped archiving because build is not successful\r\n\r\nNevertheless, this part needs to be better.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015677349/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015777494","html_url":"https://github.com/apache/couchdb/pull/3903#issuecomment-1015777494","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3903","id":1015777494,"node_id":"IC_kwDOAAMmUc48i4jW","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-18T19:47:37Z","updated_at":"2022-01-18T19:47:37Z","author_association":"MEMBER","body":"I believe I fixed the stage-level error reporting now, and in doing so found that the `failFast` configuration also started working properly. That said, I flipped the switch to disable that by default. Happy to hear a counter-argument.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015777494/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015779495","html_url":"https://github.com/apache/couchdb/pull/3903#issuecomment-1015779495","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3903","id":1015779495,"node_id":"IC_kwDOAAMmUc48i5Cn","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-18T19:50:11Z","updated_at":"2022-01-18T19:50:11Z","author_association":"MEMBER","body":"(As an aside it seems that when I did that force-push we kicked off *3* PR builds, two for the same commit. So we might need to look into the build triggers for that other pipeline at some point).","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015779495/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015801468","html_url":"https://github.com/apache/couchdb/pull/3903#issuecomment-1015801468","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3903","id":1015801468,"node_id":"IC_kwDOAAMmUc48i-Z8","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-18T20:19:29Z","updated_at":"2022-01-18T20:19:29Z","author_association":"CONTRIBUTOR","body":"Regarding erlfmt we could backport the parallel check improvement from there:\r\n\r\nhttps://github.com/apache/couchdb/commit/6e87e43fae23647b281ede250ad9f1a68a8f1cde#diff-34d012f6b27b250f7c0d5071089a4fc7e4c8451df19ac6908d95a3ff3eae58c1R38-R54\r\n\r\nInstead of sequentially  going through each file in python we pass elrmt a glob pattern for each app.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015801468/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015836835","html_url":"https://github.com/apache/couchdb/pull/3903#issuecomment-1015836835","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3903","id":1015836835,"node_id":"IC_kwDOAAMmUc48jHCj","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-18T21:10:44Z","updated_at":"2022-01-18T21:10:44Z","author_association":"MEMBER","body":"Perfect @nickva that's the sort of thing I had in mind. I had already noticed that `erlfmt` on 3.x was significantly faster but missed your specific improvements.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015836835/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":1,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015863139","html_url":"https://github.com/apache/couchdb/pull/3901#issuecomment-1015863139","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3901","id":1015863139,"node_id":"IC_kwDOAAMmUc48jNdj","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-18T21:46:13Z","updated_at":"2022-01-18T21:46:13Z","author_association":"CONTRIBUTOR","body":"I couldn't find any place where we pass the `#shard` record record to the workers. I looked in fabric and mem3_rep mainly. The typical pattern is we spawn the workers based on the local shard map in [submit_jobs](https://github.com/apache/couchdb/blob/3.x/src/fabric/src/fabric_util.erl#L63-L70) but don't pass the actual shard records. But it's not a 100% guarantee, I just skimmed through. \r\n\r\nHowever, I had noticed that the suffix is already part of the shard name and is a tad redundant: \r\n```\r\n mem3:shards(<<\"db1\">>).\r\n\r\n[#shard{name = <<\"shards/00000000-7fffffff/db1.1642540491\">>,\r\n        node = 'node1@127.0.0.1',dbname = <<\"db1\">>,\r\n        range = [0,2147483647],\r\n        ref = undefined,suffix = <<\".1642540491\">>,\r\n        opts = [{props,[]}]},\r\n        ...\r\n```\r\n\r\nAnd there is a function which returns the suffix in mem3. Perhaps we could use to get the suffix:\r\n\r\n```\r\n mem3:shard_suffix(<<\"db1\">>).\r\n\".1642540491\"\r\n```\r\n\r\nWe call when building an etag in chttpd_db and a few places already.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015863139/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015913245","html_url":"https://github.com/apache/couchdb/pull/3901#issuecomment-1015913245","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3901","id":1015913245,"node_id":"IC_kwDOAAMmUc48jZsd","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-18T23:06:43Z","updated_at":"2022-01-18T23:10:25Z","author_association":"CONTRIBUTOR","body":"Verified by re-creating the replication target. The logs look a bit messy got a few of these in a row:\r\n\r\n```\r\n[error] 2022-01-18T22:59:19.818867Z node1@127.0.0.1 <0.9133.0> -------- CRASH REPORT Process  (<0.9133.0>) with 1 neighbors exited with reason:\r\n{checkpoint_commit_failure,<<\"Target database out of sync. Try to increase max_dbs_open at the target's server.\">>} at gen_server:decode_msg/9(l\r\nine:475) <= proc_lib:init_p_do_apply/3(line:226); initial_call: {couch_replicator_worker,init,['Argument__1']}, ancestors: [<0.9039.0>,couch_rep\r\nlicator_scheduler_sup,couch_replicator_sup,...], message_queue_len: 0, links: [<0.9134.0>], dictionary: [{last_stats_report,{1642,546729,944177}\r\n}], trap_exit: true, status: running, heap_size: 1598, stack_size: 28, reductions: 8883\r\n```\r\n\r\nOtherwise it works as intended. All the docs were re-replicated to the new target instance.\r\n\r\n\r\nNoticed a failure for get_dbs_info in the CI and locally as well for _dbs_info endpoint.\r\n\r\n```\r\nhttp $DB/_dbs_info\r\nHTTP/1.1 500 Internal Server Error\r\n\r\n\r\n{\r\n    \"error\": \"badmatch\",\r\n    \"reason\": \"_dbs\",\r\n    \"ref\": 4194149092\r\n}\r\n\r\n```\r\n\r\n\r\nEdit: probably something to do with this https://github.com/apache/couchdb/blob/3.x/src/mem3/src/mem3.erl#L125-L149","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015913245/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015976737","html_url":"https://github.com/apache/couchdb/issues/3904#issuecomment-1015976737","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3904","id":1015976737,"node_id":"IC_kwDOAAMmUc48jpMh","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-19T01:01:15Z","updated_at":"2022-01-19T01:05:58Z","author_association":"MEMBER","body":"Are you referring to server config settings, the kind that you see in the `_config` interface? The key to making those persistent is to map `/opt/couchdb/etc/local.d` in each pod to a persistent volume. We noted this as an enhancement in apache/couchdb-helm#7 quite a while back but never introduced the Helm chart settings to make it simple. If that's in fact what you're looking for, can you chime in over there with some detail? If not, feel free to reopen this one to clarify.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1015976737/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1016772942","html_url":"https://github.com/apache/couchdb/pull/3906#issuecomment-1016772942","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3906","id":1016772942,"node_id":"IC_kwDOAAMmUc48mrlO","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-19T18:58:44Z","updated_at":"2022-01-19T18:58:44Z","author_association":"MEMBER","body":"Thanks @nickva , I actually already fixed those Elixir errors in 040f03bc69272a0cc5f5322684fd4e70b68a067e as part of #3903 so I can probably just wait for a review on that one and then rebase.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1016772942/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1017039988","html_url":"https://github.com/apache/couchdb/pull/3905#issuecomment-1017039988","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3905","id":1017039988,"node_id":"IC_kwDOAAMmUc48nsx0","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-20T01:54:21Z","updated_at":"2022-01-20T01:54:21Z","author_association":"MEMBER","body":"Went ahead and cherry-picked from #3903 to get this moving.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1017039988/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1017066037","html_url":"https://github.com/apache/couchdb/pull/3903#issuecomment-1017066037","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3903","id":1017066037,"node_id":"IC_kwDOAAMmUc48nzI1","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-20T02:46:22Z","updated_at":"2022-01-20T02:46:22Z","author_association":"MEMBER","body":"Thanks Nick, just rebasing to remove the commit that I already applied in the other PR and will merge once CI is clean.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1017066037/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1017951930","html_url":"https://github.com/apache/couchdb/pull/3908#issuecomment-1017951930","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3908","id":1017951930,"node_id":"IC_kwDOAAMmUc48rLa6","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-20T21:40:30Z","updated_at":"2022-01-20T21:40:30Z","author_association":"CONTRIBUTOR","body":"Test with:\r\n\r\n```\r\n% make eunit apps=fabric suites=fabric_doc_update\r\n======================== EUnit ========================\r\nmodule 'fabric_doc_update'\r\n  fabric_doc_update: fun.doc_update1...[0.009 s] ok\r\n  fabric_doc_update: fun.doc_update2...ok\r\n  fabric_doc_update: fun.doc_update3...ok\r\n  [done in 0.018 s]\r\n=======================================================\r\n  All 3 tests passed.\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1017951930/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1018105787","html_url":"https://github.com/apache/couchdb/pull/3813#issuecomment-1018105787","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3813","id":1018105787,"node_id":"IC_kwDOAAMmUc48rw-7","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-21T02:26:06Z","updated_at":"2022-01-21T02:26:06Z","author_association":"MEMBER","body":"Heh, ironically I just _removed_ `exunit` from the CI checks in my refactored Jenkinsfile (which splits out the `check` targets to get better insight into execution times and progress) because I noticed it wasn't included in the 3.x Makefile. I'll re-added.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1018105787/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1018659332","html_url":"https://github.com/apache/couchdb/pull/3909#issuecomment-1018659332","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3909","id":1018659332,"node_id":"IC_kwDOAAMmUc48t4IE","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-21T16:21:56Z","updated_at":"2022-01-21T19:43:16Z","author_association":"CONTRIBUTOR","body":"We should be specific that this affects the `new_edits:false` _and_ VDU pass corner case, and explicitly check that other replies are all `noreply`, meaning VDU passed or VDU might have failed but we just didn't extended the revision tree so it returned a pass.\r\n\r\nIn other words, we'd assert that there is at least one forbidden error (and all the rest of forbidden should match) and all the other responses are `noreply`.\r\n\r\nAnother thing to check is if the replicator knows how to handle 202 responses from `new_edits:false` _bulk_docs requests. It looks like previously we might have never returned 202 response due to:\r\n\r\nhttps://github.com/apache/couchdb/blob/3.x/src/fabric/src/fabric_doc_update.erl#L149-L150\r\n\r\n```erlang\r\ncase [Reply || {ok, Reply} <- Replies]\r\n    [] ->\r\n```\r\n\r\nSo there is a high chance replicator would not expect it and consider it an error.\r\n\r\nEven if our (CouchDB) replicator would work, there is a chance PouchDB or other implementations might break.  So I would lean towards staying with returning a 201 for this mode. What do you think?\r\n\r\nEDIT:\r\n\r\nIt looks like replicator would break on a 202 response to _bulk_docs:\r\n\r\nhttps://github.com/apache/couchdb/blob/3.x/src/couch_replicator/src/couch_replicator_api_wrap.erl#L456-L465\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1018659332/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1018932697","html_url":"https://github.com/apache/couchdb/pull/3889#issuecomment-1018932697","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3889","id":1018932697,"node_id":"IC_kwDOAAMmUc48u63Z","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-21T23:12:56Z","updated_at":"2022-01-21T23:12:56Z","author_association":"CONTRIBUTOR","body":"Added view upgrade tests for 2.x/3.2.1 views. Kudos to @eiri for setting up the view upgrade test logic already during the 2.x  -> 3.x view upgrades.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1018932697/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1020357122","html_url":"https://github.com/apache/couchdb/issues/3897#issuecomment-1020357122","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3897","id":1020357122,"node_id":"IC_kwDOAAMmUc480WoC","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-24T17:30:31Z","updated_at":"2022-01-24T17:30:31Z","author_association":"CONTRIBUTOR","body":"The solution #3901 fixes the issues.\r\n\r\nWe can investigate if adding a `uuid` to db shards in the future, but closing the issue as fixed for now.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1020357122/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1020539556","html_url":"https://github.com/apache/couchdb/pull/3909#issuecomment-1020539556","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3909","id":1020539556,"node_id":"IC_kwDOAAMmUc481DKk","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-24T20:57:33Z","updated_at":"2022-01-24T20:59:27Z","author_association":"CONTRIBUTOR","body":"> In other words, we'd assert that there is at least one forbidden error (and all the rest of forbidden should match) and all the other responses are noreply.\r\n\r\n@nickva I'm trying to figure out in what situations where we wouldn't want to forbid the document even if the replies were not `noreply`. \r\n\r\n```\r\n[{_, {forbidden, _}, Reply2, Reply3]\r\n```\r\nReply2, and Reply3 can override forbidden only if they are equal to successful  `Reply1 = {ok, Doc1}`, `Reply2 = {ok, Doc2}`. That doesn't seem like it can happen because a successful update implies an update to the revision tree, and the VDU would prevent it.\r\n\r\nI can't think of any other scenarios where and Reply2 and Reply3 should override `forbidden`. My view is that checking for `noreply` for the other responses is too restrictive.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1020539556/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1020646304","html_url":"https://github.com/apache/couchdb/pull/3909#issuecomment-1020646304","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3909","id":1020646304,"node_id":"IC_kwDOAAMmUc481dOg","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-24T23:16:13Z","updated_at":"2022-01-24T23:16:13Z","author_association":"CONTRIBUTOR","body":"> I'm trying to figure out in what situations where we wouldn't want to forbid the document even if the replies were not `noreply`.\r\n> \r\n\r\nI was thinking of the case if we had some other errors - node crashed, other unspecified errors, etc. and we wouldn't want to ignore those in favor of a `forbidden`. Unless perhaps we're explicit and can say two node crashes and one forbidden should resolve to forbidden, but not if they are arbitrary errors?\r\n\r\n> `[{_, {forbidden, _}, Reply2, Reply3]`\r\n> Reply2, and Reply3 can override forbidden only if they are equal to successful Reply1 = {ok, Doc1}, Reply2 = {ok, Doc2}. That doesn't seem like it can happen because a successful update implies an update to the revision tree, and the VDU would prevent it.\r\n\r\nFor regular doc updates when revision trees don't match, we'd probably get conflicts for some and forbidden for other responses.  It could be that the VDU is out of sync on the nodes as well. So I agree it's a bit unusual if we see a `[forbidden, {ok, _}, {ok, _}]` but then why not pick the `{ok, _}` response and ignore the forbidden? To be on the safe side, we should probably crash or highlight that as an odd mismatch.  I think the current quorum logic currently would return a success if there are 2 successes at least? (I haven't verified it yet).  What about `[forbidden, forbidden, {ok, _}]`, this is where we get the mismatch error and a 500 I think, and I think we should still get it. Ideally we'd probably want to inspect the revision tree to see which node saw a more recent revision tree (if it can even be determined), then we'd trust the node with the most recent revision doc and VDU revision, but that maybe a harder thing to do.\r\n\r\nBecause it's a bit hard to decide what to do in case of `new_edits:true` when we get those mismatches, I think we should instead of focus on the `new_edits:false` only, and restrict the PR to that. Because there, we have the corner case that `noreply` would be returned when the VDU [is not run because when revision tree is not extended](https://github.com/apache/couchdb/blob/3.x/src/couch/src/couch_db.erl#L1239-L1242). In that case I could see returning `forbidden` for the doc when we have either`[forbidden, noreply, noreply]` or `[forbidden, forbidden, noreply]`.\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1020646304/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1021405191","html_url":"https://github.com/apache/couchdb/pull/3889#issuecomment-1021405191","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3889","id":1021405191,"node_id":"IC_kwDOAAMmUc484WgH","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-25T16:59:22Z","updated_at":"2022-02-07T11:34:37Z","author_association":"CONTRIBUTOR","body":"We are returning the collator version in the  `http $COUCH/_node/*/_versions`.\r\n\r\nThanks to @lostnet for the idea\r\n\r\n```json\r\n{\r\n    \"collation_driver\": {\r\n        \"collation_algorithm_version\": \"9\",\r\n        \"collator_version\": \"153.72\",\r\n        \"library_version\": \"59.1\",\r\n        \"name\": \"libicu\"\r\n    },\r\n    \"erlang_version\": \"23.3.4.10\",\r\n    \"javascript_engine\": {\r\n        \"name\": \"spidermonkey\",\r\n        \"version\": \"1.8.5\"\r\n    }\r\n}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1021405191/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1021665360","html_url":"https://github.com/apache/couchdb/pull/3912#issuecomment-1021665360","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3912","id":1021665360,"node_id":"IC_kwDOAAMmUc485WBQ","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-25T22:23:11Z","updated_at":"2022-01-25T22:35:36Z","author_association":"CONTRIBUTOR","body":"Pretty neat feature! IIUC, these new virtual fields will usually lead to a full key range scan because the answer derived by from the jq query will be what the user wants.\r\n\r\nEx: \"Give me all docs where foo does not contain 1,2, or 3.\":\r\n```\r\n{\"foo\" : {\"$nin\": [1, 2, 3]}\r\n```\r\n\r\nCurrently, we don't use an index for this query, so we'll scan `_all_docs` and then run the filter.\r\n\r\nNow with this new feature, you can have a precompiled jq query that filters all `foo` fields that don't have 1,2,3:\r\n```\r\n  { \"foo_words\": { \"$jq\": \".foo | <some expression to get all all values not in [1,2,3]> | .[]\" } }\r\n```\r\n```\r\nDoc1\r\n{\"foo\": \"1\"}\r\nDoc2\r\n{\"foo\": \"4\"}\r\nDoc3\r\n{\"foo\": \"5\"}\r\n```\r\nThe table with the new feature would look like:\r\n\r\n```\r\nfoo_words, 4\r\nfoo_words, 5\r\n```\r\n\r\nFrom the original query, the user wants 4,5 back. So the query would `{\"foo_words\" : {\"$gt\" : null}}`\r\n\r\nI'm thinking this would be more common than the user having a precompiled jq, filtering the results and then running another query on top of that. Perhaps we can think of just doing the full key range scan (from the emitted keys) for them to make things simpler?  Basically have something like `{\"foo_words\" : \"$results\"}`. \r\n\r\n\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1021665360/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1021859622","html_url":"https://github.com/apache/couchdb/pull/3914#issuecomment-1021859622","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3914","id":1021859622,"node_id":"IC_kwDOAAMmUc486Fcm","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-26T04:54:16Z","updated_at":"2022-01-26T04:54:16Z","author_association":"MEMBER","body":"Hah, looks like the build system expects a `bin` directory to exist, but I just removed all the version-controlled files from that directory. Will see if it makes sense to `mkdir -p` there.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1021859622/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1022576378","html_url":"https://github.com/apache/couchdb/pull/3889#issuecomment-1022576378","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3889","id":1022576378,"node_id":"IC_kwDOAAMmUc4880b6","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-26T20:29:43Z","updated_at":"2022-02-07T11:35:14Z","author_association":"CONTRIBUTOR","body":"Hmm, I guess with emitting the collator versions in `_design/*/_info` and `_node/*/_versions` the format is a bit inconsistent.\r\n\r\n```\r\n\"collator_version\": \"153.72\"\r\n```\r\n\r\nvs\r\n\r\n```\r\n\"collator_versions\": [[153, 72, 0, 0]]\r\n```\r\n\r\nThinking of using the shorter binary version in the `\"collator_versions\"` output as well, just so it looks consistent.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1022576378/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1022643789","html_url":"https://github.com/apache/couchdb/pull/3889#issuecomment-1022643789","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3889","id":1022643789,"node_id":"IC_kwDOAAMmUc489E5N","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-26T22:02:57Z","updated_at":"2022-02-07T11:36:51Z","author_association":"CONTRIBUTOR","body":"This should look a bit more consistent:\r\n\r\n```\r\n% http $COUCH/db/_design/ddoc/_info\r\n\r\n{\r\n    \"name\": \"ddoc\",\r\n    \"view_index\": {\r\n        \"collator_versions\": [\r\n            \"153.72\"\r\n        ],\r\n        \"compact_running\": false,\r\n        \"language\": \"javascript\",\r\n        \"purge_seq\": 0,\r\n        \"signature\": \"81ddc822bee0c1e8a25c96c221e4b671\",\r\n        \"sizes\": {\r\n            \"active\": 0,\r\n            \"external\": 4,\r\n            \"file\": 4261\r\n        },\r\n        \"update_seq\": 1,\r\n        \"updater_running\": false,\r\n        \"updates_pending\": {\r\n            \"minimum\": 0,\r\n            \"preferred\": 0,\r\n            \"total\": 0\r\n        },\r\n        \"waiting_clients\": 0,\r\n        \"waiting_commit\": false\r\n    }\r\n}\r\n\r\n % http $COUCH/_node/_local/_versions\r\n{\r\n    \"collation_driver\": {\r\n        \"collation_algorithm_version\": \"9\",\r\n        \"collator_version\": \"153.72\",\r\n        \"library_version\": \"59.1\",\r\n        \"name\": \"libicu\"\r\n    },\r\n    \"erlang_version\": \"23.3.4.10\",\r\n    \"javascript_engine\": {\r\n        \"name\": \"spidermonkey\",\r\n        \"version\": \"1.8.5\"\r\n    }\r\n}\r\n```","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1022643789/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1023804432","html_url":"https://github.com/apache/couchdb/pull/3909#issuecomment-1023804432","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3909","id":1023804432,"node_id":"IC_kwDOAAMmUc49BgQQ","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-28T01:38:43Z","updated_at":"2022-01-28T01:38:43Z","author_association":"CONTRIBUTOR","body":"I've updated the code to reflect some of the suggestions.\r\n\r\n```\r\n[noreply, forbidden, noreply] -> forbidden, but return 201 for overall bulk_docs\r\n[forbidden, noreply, forbidden] -> forbidden, but return 201 for overall bulk_docs\r\n[{ok, Doc1}, forbidden, {ok, Doc2}] -> {ok, {ok, Doc1}, {ok, Doc2}} - success\r\n[forbidden, {ok, Doc1}, forbidden] -> {error, {mismatched_errors, Replies}}\r\n[forbidden, some_other_error, forbidden] -> {error, {mismatched_errors, Replies}}\r\n[error_a, error_b, forbidden] -> {error, {mismatched_errors, Replies}}\r\n```\r\n\r\n`[noreply, noreply,  forbidden]` -> This one is tricky because and I don't have an answer for this. Right now it would be a success because quorum rules would it let slide through by the order of the `noreply`. In order to check for the possibility of a forbidden, we would have to wait for all nodes to respond for every request before making a decision. I think that's going to make things really non performant. Hypothetically, let's say we  7 nodes and one node extends the revision tree and is the most up to date and the other 6 for some reason are behind and the revision tree is not extended for all of them. I think we should leave the quorum rules here in place. ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1023804432/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1024994678","html_url":"https://github.com/apache/couchdb/pull/3890#issuecomment-1024994678","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3890","id":1024994678,"node_id":"IC_kwDOAAMmUc49GC12","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-29T22:01:17Z","updated_at":"2022-01-29T22:01:17Z","author_association":"CONTRIBUTOR","body":"Looks like [someone else found this alarming](https://github.com/apache/couchdb/discussions/3919) too.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1024994678/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1025051464","html_url":"https://github.com/apache/couchdb/pull/3914#issuecomment-1025051464","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3914","id":1025051464,"node_id":"IC_kwDOAAMmUc49GQtI","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-30T02:10:19Z","updated_at":"2022-01-30T02:10:19Z","author_association":"MEMBER","body":"Good thought on the .keep file, I added that for now. I feel like there's still some duplication and overlap between the `bin/`, `build-aux/` and `support/`, but not going to try to resolve that here so taking the most conservative approach.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1025051464/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1025057429","html_url":"https://github.com/apache/couchdb/issues/3911#issuecomment-1025057429","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3911","id":1025057429,"node_id":"IC_kwDOAAMmUc49GSKV","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-30T03:05:30Z","updated_at":"2022-01-30T03:05:30Z","author_association":"MEMBER","body":"I recall that back in the 1.x release series we did have full support for ETags in views. The clustering system we introduced in 2.0 complicated efforts to calculate an efficient ETag, and I think we maybe never really resurrected it. I'm honestly not sure off the top of my head what parts of that code path are still functioning. Are we generating an ETag but ignoring any If-None-Match?\r\n\r\nI'd be comfortable with the idea of merging the DB sequences for each of the shard replicas that contributed to the view response as the ETag. If a client supplied that ETag in an If-None-Match header we could implement a reasonably efficient check to see if any of shards have advanced their sequence.\r\n\r\nIn contrast to document and attachment ETags it would be a net loss to include an If-None-Match on every request to a DB with a high update rate, but if you've got a deployment with a low / infrequent update rate the authoritative caching would still be a nice win.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1025057429/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1025933896","html_url":"https://github.com/apache/couchdb/pull/3909#issuecomment-1025933896","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3909","id":1025933896,"node_id":"IC_kwDOAAMmUc49JoJI","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-31T15:58:48Z","updated_at":"2022-01-31T15:58:48Z","author_association":"CONTRIBUTOR","body":">  I think we should leave the quorum rules here in place.\r\n\r\nAgree. Yeah, the way the quorum works `[noreply, noreply, forbidden]` would return `noreply` unless we wait for all the replies.  Ideally we if we got extra information from workers (the shape of the rev tree and whether VDU ran or skipped, the VDU revision perhaps) we could make better decision but that's a larger change.\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1025933896/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590002","html_url":"https://github.com/apache/couchdb/issues/4221#issuecomment-1280590002","issue_url":"https://api.github.com/repos/apache/couchdb/issues/4221","id":1280590002,"node_id":"IC_kwDOAAMmUc5MVECy","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-31T19:01:40Z","updated_at":"2022-01-31T19:01:40Z","author_association":"CONTRIBUTOR","body":"Hi,\r\n\r\ni have installed the binary in macOS 10.13. So maybe it is only a typo? @janl ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1280590002/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1026108733","html_url":"https://github.com/apache/couchdb/issues/3820#issuecomment-1026108733","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3820","id":1026108733,"node_id":"IC_kwDOAAMmUc49KS09","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-01-31T19:04:18Z","updated_at":"2022-01-31T19:04:18Z","author_association":"CONTRIBUTOR","body":"Hi,\r\n\r\ni can confirm this behavior. Seems to be hard-coded in the mac ui...","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1026108733/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1027784832","html_url":"https://github.com/apache/couchdb/issues/1853#issuecomment-1027784832","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1853","id":1027784832,"node_id":"IC_kwDOAAMmUc49QsCA","user":{"login":"ChiragMoradiya","id":2399621,"node_id":"MDQ6VXNlcjIzOTk2MjE=","avatar_url":"https://avatars.githubusercontent.com/u/2399621?v=4","gravatar_id":"","url":"https://api.github.com/users/ChiragMoradiya","html_url":"https://github.com/ChiragMoradiya","followers_url":"https://api.github.com/users/ChiragMoradiya/followers","following_url":"https://api.github.com/users/ChiragMoradiya/following{/other_user}","gists_url":"https://api.github.com/users/ChiragMoradiya/gists{/gist_id}","starred_url":"https://api.github.com/users/ChiragMoradiya/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ChiragMoradiya/subscriptions","organizations_url":"https://api.github.com/users/ChiragMoradiya/orgs","repos_url":"https://api.github.com/users/ChiragMoradiya/repos","events_url":"https://api.github.com/users/ChiragMoradiya/events{/privacy}","received_events_url":"https://api.github.com/users/ChiragMoradiya/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-02T10:19:58Z","updated_at":"2022-02-02T10:19:58Z","author_association":"NONE","body":"We also encountered this issue. Any plan to be fixed in near future? Alternatively, we are building query using `$or` operator which properly uses index.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1027784832/reactions","total_count":1,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":1},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1028864642","html_url":"https://github.com/apache/couchdb/issues/3911#issuecomment-1028864642","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3911","id":1028864642,"node_id":"IC_kwDOAAMmUc49UzqC","user":{"login":"adnaanbheda","id":25040547,"node_id":"MDQ6VXNlcjI1MDQwNTQ3","avatar_url":"https://avatars.githubusercontent.com/u/25040547?v=4","gravatar_id":"","url":"https://api.github.com/users/adnaanbheda","html_url":"https://github.com/adnaanbheda","followers_url":"https://api.github.com/users/adnaanbheda/followers","following_url":"https://api.github.com/users/adnaanbheda/following{/other_user}","gists_url":"https://api.github.com/users/adnaanbheda/gists{/gist_id}","starred_url":"https://api.github.com/users/adnaanbheda/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/adnaanbheda/subscriptions","organizations_url":"https://api.github.com/users/adnaanbheda/orgs","repos_url":"https://api.github.com/users/adnaanbheda/repos","events_url":"https://api.github.com/users/adnaanbheda/events{/privacy}","received_events_url":"https://api.github.com/users/adnaanbheda/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-03T10:57:18Z","updated_at":"2022-02-03T10:57:39Z","author_association":"NONE","body":"I experimented a bit but with no avail, never received back any ETags.\r\nYeah, I think the mechanisms already exist in the codebase that can enable this sort of caching, just need to enable them I guess.\r\nIt's a nice win if you have a large view that pulls a lot of data (MBs), a simple ETag check can save lots of network time and the expense of such checks is presumably very low, the net-loss is therefore minimal even if we added the `If-None-Match` header to every request.\r\n\r\nCan you describe how would one go about fixing this ?\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1028864642/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1029559631","html_url":"https://github.com/apache/couchdb/issues/3911#issuecomment-1029559631","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3911","id":1029559631,"node_id":"IC_kwDOAAMmUc49XdVP","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-04T01:34:51Z","updated_at":"2022-02-04T01:34:51Z","author_association":"MEMBER","body":"Here's a sketch. It's unfortunately kind of scattered all over the codebase, but I would look to do something like this on the `3.x` branch:\r\n\r\n1. Check for the presence of an `If-Match` header containing a DB sequence on the incoming request in `chttpd_view`\r\n2. Pass that sequence into `fabric:query_view/7` if it's present\r\n3. Inside `query_view` call `fabric:changes/4` passing in the sequence from the header with limit=1 and see if any rows are returned.\r\n4. If no rows are returned, invoke the `Callback` function with a new message like `cache_hit` instead of dropping down into the `fabric_view_map` or `fabric_view_reduce` coordinators.\r\n5. Chase down all the callback functions in the `chttpd` app (possibly just `couch_mrview_http:view_cb/2`) to add a clause to handle `cache_hit` and return 304 when that happens. \r\n\r\nStep 3 is really the key extra bit of logic that validates the freshness of the ETag. Of course we also have to generate the ETag inside `fabric_view_map` / `fabric_view_reduce` and send it with every respoonse. Here I'd be looking for something like\r\n\r\n1. Inside the `fabric_view` stack, make it so that `update_seq = true` is the only mode of operation, which will ensure that `couch_mrview:make_meta/3` always includes the update sequence in the view metadata sent from each shard. We should verify that the sequence here is really the sequence of the view index and not the database. I'm pretty sure that's the case.\r\n2. Update all the callback functions (again, maybe just `couch_mrview_http:view_cb/2` ?) to extract the `update_seq` from the `{meta, Meta}` message and report it in the ETag header. This will require a small bit of refactoring as the code currently blindly starts a response with no extra response headers.\r\n\r\nThe work to do this on `main` is going to be fairly similar but not so simple as a `cherry-pick`.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1029559631/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1030651938","html_url":"https://github.com/apache/couchdb/issues/3924#issuecomment-1030651938","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3924","id":1030651938,"node_id":"IC_kwDOAAMmUc49boAi","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-05T16:12:14Z","updated_at":"2022-02-05T16:12:14Z","author_association":"CONTRIBUTOR","body":"Thanks for reaching out, @vkuznet \r\n\r\n`echo` adds a newline at the end so the encoded stream is not what we expect usually.\r\n\r\nIn general ,`echo` and `base64` command line combination are not best way to encode data because of that reason\r\n\r\npython could work here or any other language which has a base64 encoder:\r\n\r\n```\r\nIn [1]: import base64                                                        \r\n\r\nIn [2]: s = \"admin:admin\"                                                    \r\n\r\nIn [3]: base64.b64encode(s.encode(\"utf-8\")).decode(\"utf-8\")                  \r\nOut[3]: 'YWRtaW46YWRtaW4='\r\n```\r\n\r\nNotice that the encoded string is different than:\r\n\r\n```\r\necho \"admin:admin\" | base64\r\nYWRtaW46YWRtaW4K\r\n```\r\n\r\nOne way to handle it in the shell is to pass `-n` to echo so it doesn't include the newline in the stream:\r\n```\r\necho -n \"admin:admin\" | base64\r\nYWRtaW46YWRtaW4=\r\n```\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1030651938/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1030652496","html_url":"https://github.com/apache/couchdb/issues/3924#issuecomment-1030652496","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3924","id":1030652496,"node_id":"IC_kwDOAAMmUc49boJQ","user":{"login":"vkuznet","id":125138,"node_id":"MDQ6VXNlcjEyNTEzOA==","avatar_url":"https://avatars.githubusercontent.com/u/125138?v=4","gravatar_id":"","url":"https://api.github.com/users/vkuznet","html_url":"https://github.com/vkuznet","followers_url":"https://api.github.com/users/vkuznet/followers","following_url":"https://api.github.com/users/vkuznet/following{/other_user}","gists_url":"https://api.github.com/users/vkuznet/gists{/gist_id}","starred_url":"https://api.github.com/users/vkuznet/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vkuznet/subscriptions","organizations_url":"https://api.github.com/users/vkuznet/orgs","repos_url":"https://api.github.com/users/vkuznet/repos","events_url":"https://api.github.com/users/vkuznet/events{/privacy}","received_events_url":"https://api.github.com/users/vkuznet/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-05T16:15:56Z","updated_at":"2022-02-05T16:15:56Z","author_association":"NONE","body":"ahh, ok, that's very useful to know, closing the issue then.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1030652496/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1030719904","html_url":"https://github.com/apache/couchdb/issues/1020#issuecomment-1030719904","issue_url":"https://api.github.com/repos/apache/couchdb/issues/1020","id":1030719904,"node_id":"IC_kwDOAAMmUc49b4mg","user":{"login":"xpagesbeast","id":3502651,"node_id":"MDQ6VXNlcjM1MDI2NTE=","avatar_url":"https://avatars.githubusercontent.com/u/3502651?v=4","gravatar_id":"","url":"https://api.github.com/users/xpagesbeast","html_url":"https://github.com/xpagesbeast","followers_url":"https://api.github.com/users/xpagesbeast/followers","following_url":"https://api.github.com/users/xpagesbeast/following{/other_user}","gists_url":"https://api.github.com/users/xpagesbeast/gists{/gist_id}","starred_url":"https://api.github.com/users/xpagesbeast/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/xpagesbeast/subscriptions","organizations_url":"https://api.github.com/users/xpagesbeast/orgs","repos_url":"https://api.github.com/users/xpagesbeast/repos","events_url":"https://api.github.com/users/xpagesbeast/events{/privacy}","received_events_url":"https://api.github.com/users/xpagesbeast/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-06T00:23:47Z","updated_at":"2022-02-06T00:26:34Z","author_association":"NONE","body":"I installed couchDB with Homebrew\r\nThen started couchDB\r\nExperienced the error with not having a Admin user setup.\r\n\r\n`vi /usr/local/Cellar/couchdb/3.2.0/etc/local.ini`\r\n\r\n```\r\n[admins]\r\nadmin = mysecretpassword\r\n```\r\n\r\nThen tried couchDB using the terminal again, and it started.\r\nI found the path by search Hombrew \r\n` % brew list couchDB | grep ini    `         \r\n \r\nI was then able to log into the web ui, put this in browser\r\n`http://127.0.0.1:5984/_utils/#`","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1030719904/reactions","total_count":3,"+1":3,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1032249362","html_url":"https://github.com/apache/couchdb/pull/3909#issuecomment-1032249362","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3909","id":1032249362,"node_id":"IC_kwDOAAMmUc49huAS","user":{"login":"tonysun83","id":6991573,"node_id":"MDQ6VXNlcjY5OTE1NzM=","avatar_url":"https://avatars.githubusercontent.com/u/6991573?v=4","gravatar_id":"","url":"https://api.github.com/users/tonysun83","html_url":"https://github.com/tonysun83","followers_url":"https://api.github.com/users/tonysun83/followers","following_url":"https://api.github.com/users/tonysun83/following{/other_user}","gists_url":"https://api.github.com/users/tonysun83/gists{/gist_id}","starred_url":"https://api.github.com/users/tonysun83/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/tonysun83/subscriptions","organizations_url":"https://api.github.com/users/tonysun83/orgs","repos_url":"https://api.github.com/users/tonysun83/repos","events_url":"https://api.github.com/users/tonysun83/events{/privacy}","received_events_url":"https://api.github.com/users/tonysun83/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-08T06:14:08Z","updated_at":"2022-02-08T06:14:08Z","author_association":"CONTRIBUTOR","body":"@nickva finished the final touches","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1032249362/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1032895939","html_url":"https://github.com/apache/couchdb/pull/3909#issuecomment-1032895939","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3909","id":1032895939,"node_id":"IC_kwDOAAMmUc49kL3D","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-08T17:51:34Z","updated_at":"2022-02-08T17:51:34Z","author_association":"CONTRIBUTOR","body":"@tonysun83 looks pretty good, try erlfmt-format and a rebase, so the CI will run","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1032895939/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1033999763","html_url":"https://github.com/apache/couchdb/issues/3826#issuecomment-1033999763","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3826","id":1033999763,"node_id":"IC_kwDOAAMmUc49oZWT","user":{"login":"big-r81","id":9985963,"node_id":"MDQ6VXNlcjk5ODU5NjM=","avatar_url":"https://avatars.githubusercontent.com/u/9985963?v=4","gravatar_id":"","url":"https://api.github.com/users/big-r81","html_url":"https://github.com/big-r81","followers_url":"https://api.github.com/users/big-r81/followers","following_url":"https://api.github.com/users/big-r81/following{/other_user}","gists_url":"https://api.github.com/users/big-r81/gists{/gist_id}","starred_url":"https://api.github.com/users/big-r81/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/big-r81/subscriptions","organizations_url":"https://api.github.com/users/big-r81/orgs","repos_url":"https://api.github.com/users/big-r81/repos","events_url":"https://api.github.com/users/big-r81/events{/privacy}","received_events_url":"https://api.github.com/users/big-r81/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-09T17:14:18Z","updated_at":"2022-02-09T17:14:18Z","author_association":"CONTRIBUTOR","body":"Hi,\r\n\r\ncan you give an example dataset, for which both queries gives different results?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1033999763/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1035016750","html_url":"https://github.com/apache/couchdb/pull/3189#issuecomment-1035016750","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3189","id":1035016750,"node_id":"IC_kwDOAAMmUc49sRou","user":{"login":"dottorblaster","id":20770,"node_id":"MDQ6VXNlcjIwNzcw","avatar_url":"https://avatars.githubusercontent.com/u/20770?v=4","gravatar_id":"","url":"https://api.github.com/users/dottorblaster","html_url":"https://github.com/dottorblaster","followers_url":"https://api.github.com/users/dottorblaster/followers","following_url":"https://api.github.com/users/dottorblaster/following{/other_user}","gists_url":"https://api.github.com/users/dottorblaster/gists{/gist_id}","starred_url":"https://api.github.com/users/dottorblaster/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dottorblaster/subscriptions","organizations_url":"https://api.github.com/users/dottorblaster/orgs","repos_url":"https://api.github.com/users/dottorblaster/repos","events_url":"https://api.github.com/users/dottorblaster/events{/privacy}","received_events_url":"https://api.github.com/users/dottorblaster/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-10T14:55:48Z","updated_at":"2022-02-10T14:55:48Z","author_association":"MEMBER","body":"Well, this effort didn't lead to anything so I'm honestly closing this :sweat_smile: ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1035016750/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1035925008","html_url":"https://github.com/apache/couchdb/pull/3860#issuecomment-1035925008","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3860","id":1035925008,"node_id":"IC_kwDOAAMmUc49vvYQ","user":{"login":"jaydoane","id":51209,"node_id":"MDQ6VXNlcjUxMjA5","avatar_url":"https://avatars.githubusercontent.com/u/51209?v=4","gravatar_id":"","url":"https://api.github.com/users/jaydoane","html_url":"https://github.com/jaydoane","followers_url":"https://api.github.com/users/jaydoane/followers","following_url":"https://api.github.com/users/jaydoane/following{/other_user}","gists_url":"https://api.github.com/users/jaydoane/gists{/gist_id}","starred_url":"https://api.github.com/users/jaydoane/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jaydoane/subscriptions","organizations_url":"https://api.github.com/users/jaydoane/orgs","repos_url":"https://api.github.com/users/jaydoane/repos","events_url":"https://api.github.com/users/jaydoane/events{/privacy}","received_events_url":"https://api.github.com/users/jaydoane/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-11T06:49:55Z","updated_at":"2022-02-11T06:49:55Z","author_association":"CONTRIBUTOR","body":"@rnewson I notice that you have checked\r\n```\r\nAny new configurable parameters are documented in rel/overlay/etc/default.ini\r\n```\r\nBut I'm not seeing any changes to default.ini in this PR, nor do I see any new `config:get` calls.\r\n\r\nAre there any new configuration parameters for this feature?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1035925008/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1036576606","html_url":"https://github.com/apache/couchdb/pull/3889#issuecomment-1036576606","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3889","id":1036576606,"node_id":"IC_kwDOAAMmUc49yOde","user":{"login":"iilyak","id":9804420,"node_id":"MDQ6VXNlcjk4MDQ0MjA=","avatar_url":"https://avatars.githubusercontent.com/u/9804420?v=4","gravatar_id":"","url":"https://api.github.com/users/iilyak","html_url":"https://github.com/iilyak","followers_url":"https://api.github.com/users/iilyak/followers","following_url":"https://api.github.com/users/iilyak/following{/other_user}","gists_url":"https://api.github.com/users/iilyak/gists{/gist_id}","starred_url":"https://api.github.com/users/iilyak/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/iilyak/subscriptions","organizations_url":"https://api.github.com/users/iilyak/orgs","repos_url":"https://api.github.com/users/iilyak/repos","events_url":"https://api.github.com/users/iilyak/events{/privacy}","received_events_url":"https://api.github.com/users/iilyak/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-11T20:05:07Z","updated_at":"2022-02-11T20:05:07Z","author_association":"CONTRIBUTOR","body":"Great job !!! 🎉 ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1036576606/reactions","total_count":2,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":1,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1043344577","html_url":"https://github.com/apache/couchdb/pull/3766#issuecomment-1043344577","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3766","id":1043344577,"node_id":"IC_kwDOAAMmUc4-MCzB","user":{"login":"noahshaw11","id":47468872,"node_id":"MDQ6VXNlcjQ3NDY4ODcy","avatar_url":"https://avatars.githubusercontent.com/u/47468872?v=4","gravatar_id":"","url":"https://api.github.com/users/noahshaw11","html_url":"https://github.com/noahshaw11","followers_url":"https://api.github.com/users/noahshaw11/followers","following_url":"https://api.github.com/users/noahshaw11/following{/other_user}","gists_url":"https://api.github.com/users/noahshaw11/gists{/gist_id}","starred_url":"https://api.github.com/users/noahshaw11/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/noahshaw11/subscriptions","organizations_url":"https://api.github.com/users/noahshaw11/orgs","repos_url":"https://api.github.com/users/noahshaw11/repos","events_url":"https://api.github.com/users/noahshaw11/events{/privacy}","received_events_url":"https://api.github.com/users/noahshaw11/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-17T19:37:23Z","updated_at":"2022-02-17T19:41:29Z","author_association":"CONTRIBUTOR","body":"Logs of `should_persist_queue` test:\r\n```\r\n[notice] 2022-02-17T19:26:51.507665Z nonode@nohost <0.1666.0> -------- smoosh_channel Persisting \"ratio_dbs\" state, Active: [], Starting: [], Waiting: {priority_queue,\"ratio_dbs\",#{<<\"eunit-test-db-29f9313a853943a7e2ada21daa7d3b14\">> => {1850636.0843373493,{-576460747195516000,-576460752303423477}}},{1,{{1850636.0843373493,{-576460747195516000,-576460752303423477}},{<<\"eunit-test-db-29f9313a853943a7e2ada21daa7d3b14\">>,1850636.0843373493},nil,nil}}}\r\n[notice] 2022-02-17T19:26:51.512522Z nonode@nohost <0.1712.0> -------- smoosh_priority_queue Successfully restored state file /Users/ncshaw/src/couchdb/tmp/data/ratio_dbs.waiting\r\n[notice] 2022-02-17T19:26:51.512628Z nonode@nohost <0.1712.0> -------- ~~ Q0: {priority_queue,\"ratio_dbs\",#{<<\"eunit-test-db-29f9313a853943a7e2ada21daa7d3b14\">> => {1850636.0843373493,{-576460747195516000,-576460752303423477}}},{1,{1850636.0843373493,{<<\"eunit-test-db-29f9313a853943a7e2ada21daa7d3b14\">>,{-576460747195516000,-576460752303423477}},nil,nil}}}\r\n[info] 2022-02-17T19:26:51.513289Z nonode@nohost <0.44.0> -------- Application smoosh exited with reason: stopped\r\n[info] 2022-02-17T19:26:51.513355Z nonode@nohost <0.44.0> -------- Application smoosh exited with reason: stopped\r\n[info] 2022-02-17T19:26:51.513385Z nonode@nohost <0.44.0> -------- Application smoosh exited with reason: stopped\r\n[info] 2022-02-17T19:26:51.513408Z nonode@nohost <0.44.0> -------- Application smoosh exited with reason: stopped\r\n[info] 2022-02-17T19:26:51.513444Z nonode@nohost <0.44.0> -------- Application smoosh exited with reason: stopped\r\n[notice] 2022-02-17T19:26:51.513884Z nonode@nohost <0.1712.0> -------- smoosh_priority_queue Successfully restored state file /Users/ncshaw/src/couchdb/tmp/data/ratio_dbs.waiting\r\n[notice] 2022-02-17T19:26:51.513998Z nonode@nohost <0.1712.0> -------- ~~ Q1: {priority_queue,\"ratio_dbs\",#{<<\"eunit-test-db-29f9313a853943a7e2ada21daa7d3b14\">> => {1850636.0843373493,{-576460747195516000,-576460752303423477}}},{1,{1850636.0843373493,{<<\"eunit-test-db-29f9313a853943a7e2ada21daa7d3b14\">>,{-576460747195516000,-576460752303423477}},nil,nil}}}\r\n.\r\n.\r\n.\r\n[notice] 2022-02-17T19:26:51.516256Z nonode@nohost <0.1727.0> -------- ratio_dbs: Starting compaction for eunit-test-db-29f9313a853943a7e2ada21daa7d3b14 (priority {-576460747195516000,-576460752303423477})\r\n[info] 2022-02-17T19:26:51.516284Z nonode@nohost <0.1709.0> -------- Starting compaction for db \"eunit-test-db-29f9313a853943a7e2ada21daa7d3b14\" at 1\r\n[notice] 2022-02-17T19:26:51.516309Z nonode@nohost <0.1727.0> -------- smoosh_channel Persisting \"ratio_dbs\" state, Active: [], Starting: [{#Ref<0.981995199.3249012738.71442>,<<\"eunit-test-db-29f9313a853943a7e2ada21daa7d3b14\">>}], Waiting: {priority_queue,\"ratio_dbs\",#{},{0,nil}}\r\n```\r\nThe priority queue was successfully restored on smoosh restart and the compaction job was started.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1043344577/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1044454660","html_url":"https://github.com/apache/couchdb/pull/3933#issuecomment-1044454660","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3933","id":1044454660,"node_id":"IC_kwDOAAMmUc4-QR0E","user":{"login":"rnewson","id":47223,"node_id":"MDQ6VXNlcjQ3MjIz","avatar_url":"https://avatars.githubusercontent.com/u/47223?v=4","gravatar_id":"","url":"https://api.github.com/users/rnewson","html_url":"https://github.com/rnewson","followers_url":"https://api.github.com/users/rnewson/followers","following_url":"https://api.github.com/users/rnewson/following{/other_user}","gists_url":"https://api.github.com/users/rnewson/gists{/gist_id}","starred_url":"https://api.github.com/users/rnewson/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/rnewson/subscriptions","organizations_url":"https://api.github.com/users/rnewson/orgs","repos_url":"https://api.github.com/users/rnewson/repos","events_url":"https://api.github.com/users/rnewson/events{/privacy}","received_events_url":"https://api.github.com/users/rnewson/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-18T12:35:23Z","updated_at":"2022-02-18T12:35:23Z","author_association":"MEMBER","body":"not a refactor :P","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1044454660/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1044518745","html_url":"https://github.com/apache/couchdb/pull/3932#issuecomment-1044518745","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3932","id":1044518745,"node_id":"IC_kwDOAAMmUc4-QhdZ","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-18T13:20:26Z","updated_at":"2022-02-18T13:20:26Z","author_association":"MEMBER","body":"Thanks! I've been wanting to do something like this ever since I refactored those CI config files and found myself littering them with `--spidermonkey-version` flags everywhere. How do you feel about still allowing the use of `--spidermonkey-version`, and just using the autodetected version as a default if the user doesn't specify one?\r\n\r\nIt seems we have an unrelated problem with Jenkins today, we'll investigate that separately.\r\n\r\nAlso, Trento? That takes me back. I spent a few weeks at ECT when I was a graduate student years ago. Lovely place :) ","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1044518745/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1045047015","html_url":"https://github.com/apache/couchdb/pull/3932#issuecomment-1045047015","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3932","id":1045047015,"node_id":"IC_kwDOAAMmUc4-Sibn","user":{"login":"frapa","id":1306195,"node_id":"MDQ6VXNlcjEzMDYxOTU=","avatar_url":"https://avatars.githubusercontent.com/u/1306195?v=4","gravatar_id":"","url":"https://api.github.com/users/frapa","html_url":"https://github.com/frapa","followers_url":"https://api.github.com/users/frapa/followers","following_url":"https://api.github.com/users/frapa/following{/other_user}","gists_url":"https://api.github.com/users/frapa/gists{/gist_id}","starred_url":"https://api.github.com/users/frapa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/frapa/subscriptions","organizations_url":"https://api.github.com/users/frapa/orgs","repos_url":"https://api.github.com/users/frapa/repos","events_url":"https://api.github.com/users/frapa/events{/privacy}","received_events_url":"https://api.github.com/users/frapa/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-18T19:16:57Z","updated_at":"2022-02-18T19:19:43Z","author_association":"NONE","body":"@kocolosk If you prefer keeping the options and using this as default, it's fine for me. In that case, should the CI script still be updated? I'll wait for more instructions and update the PR.\r\n\r\nHow can I find out if the CI works again?\r\n\r\n> Also, Trento? That takes me back. I spent a few weeks at ECT when I was a graduate student years ago. Lovely place :)\r\n\r\nCool! I come from very close to Trento, it's a really nice place. Looking forward to move back one day :-)","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1045047015/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1045141616","html_url":"https://github.com/apache/couchdb/pull/3932#issuecomment-1045141616","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3932","id":1045141616,"node_id":"IC_kwDOAAMmUc4-S5hw","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-18T20:32:20Z","updated_at":"2022-02-18T20:32:20Z","author_association":"MEMBER","body":"CI is upgraded and back online courtesy of @nickva . I just re-submitted the job for this PR, but in order to test changes to `Jenkinsfile.full` I'll need to publish your changes in a specially-named branch in our repo. I can do that once we're confident about the changes here.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1045141616/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1045146430","html_url":"https://github.com/apache/couchdb/pull/3932#issuecomment-1045146430","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3932","id":1045146430,"node_id":"IC_kwDOAAMmUc4-S6s-","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-18T20:36:01Z","updated_at":"2022-02-18T20:36:01Z","author_association":"MEMBER","body":"> In that case, should the CI script still be updated?\r\n\r\nYes, I like what you did there.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1045146430/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1046040380","html_url":"https://github.com/apache/couchdb/pull/3932#issuecomment-1046040380","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3932","id":1046040380,"node_id":"IC_kwDOAAMmUc4-WU88","user":{"login":"frapa","id":1306195,"node_id":"MDQ6VXNlcjEzMDYxOTU=","avatar_url":"https://avatars.githubusercontent.com/u/1306195?v=4","gravatar_id":"","url":"https://api.github.com/users/frapa","html_url":"https://github.com/frapa","followers_url":"https://api.github.com/users/frapa/followers","following_url":"https://api.github.com/users/frapa/following{/other_user}","gists_url":"https://api.github.com/users/frapa/gists{/gist_id}","starred_url":"https://api.github.com/users/frapa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/frapa/subscriptions","organizations_url":"https://api.github.com/users/frapa/orgs","repos_url":"https://api.github.com/users/frapa/repos","events_url":"https://api.github.com/users/frapa/events{/privacy}","received_events_url":"https://api.github.com/users/frapa/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-19T15:13:44Z","updated_at":"2022-02-19T15:13:44Z","author_association":"NONE","body":"@kocolosk I reintroduced the `--spidermonkey-version`, added a check for empty `SM_VSN` and removed the environment block. Let me know if can do anything else.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1046040380/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1047150726","html_url":"https://github.com/apache/couchdb/issues/2701#issuecomment-1047150726","issue_url":"https://api.github.com/repos/apache/couchdb/issues/2701","id":1047150726,"node_id":"IC_kwDOAAMmUc4-akCG","user":{"login":"vectorselector","id":4980940,"node_id":"MDQ6VXNlcjQ5ODA5NDA=","avatar_url":"https://avatars.githubusercontent.com/u/4980940?v=4","gravatar_id":"","url":"https://api.github.com/users/vectorselector","html_url":"https://github.com/vectorselector","followers_url":"https://api.github.com/users/vectorselector/followers","following_url":"https://api.github.com/users/vectorselector/following{/other_user}","gists_url":"https://api.github.com/users/vectorselector/gists{/gist_id}","starred_url":"https://api.github.com/users/vectorselector/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/vectorselector/subscriptions","organizations_url":"https://api.github.com/users/vectorselector/orgs","repos_url":"https://api.github.com/users/vectorselector/repos","events_url":"https://api.github.com/users/vectorselector/events{/privacy}","received_events_url":"https://api.github.com/users/vectorselector/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-21T18:49:59Z","updated_at":"2022-02-22T09:20:09Z","author_association":"NONE","body":"Assuming we don't want to manually turn this off all the time:\r\n1) is there a setting to not have this default admin role added to each database?\r\n2) what is the correct way to form a connection string per user and password? (what are we actually SUPPOSED to be doing, even on localhost?)\r\n\r\nEDIT:\r\nconnection string is in the docs @wohali referenced.  oops haha sorry...\r\nHOST=\"http://admin:password@127.0.0.1:5984\"\r\n\r\n\r\nbasically: I would propose a \"Coming from CouchDB 2.x?\" upgrade summary, and this needs to be in there front and center.\r\nwhile the different pieces are in the existing docs, it's easy to miss a detail. Someone wonders why their app suddenly can't connect to the DB and it's a distro package upgrade version 2.x to 3.x and aren't perhaps even aware of what the issue is.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1047150726/reactions","total_count":1,"+1":0,"-1":0,"laugh":1,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048141179","html_url":"https://github.com/apache/couchdb/pull/3932#issuecomment-1048141179","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3932","id":1048141179,"node_id":"IC_kwDOAAMmUc4-eV17","user":{"login":"frapa","id":1306195,"node_id":"MDQ6VXNlcjEzMDYxOTU=","avatar_url":"https://avatars.githubusercontent.com/u/1306195?v=4","gravatar_id":"","url":"https://api.github.com/users/frapa","html_url":"https://github.com/frapa","followers_url":"https://api.github.com/users/frapa/followers","following_url":"https://api.github.com/users/frapa/following{/other_user}","gists_url":"https://api.github.com/users/frapa/gists{/gist_id}","starred_url":"https://api.github.com/users/frapa/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/frapa/subscriptions","organizations_url":"https://api.github.com/users/frapa/orgs","repos_url":"https://api.github.com/users/frapa/repos","events_url":"https://api.github.com/users/frapa/events{/privacy}","received_events_url":"https://api.github.com/users/frapa/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-22T19:32:38Z","updated_at":"2022-02-22T19:32:38Z","author_association":"NONE","body":"@kocolosk Any news on this PR?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048141179/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048396413","html_url":"https://github.com/apache/couchdb/pull/3932#issuecomment-1048396413","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3932","id":1048396413,"node_id":"IC_kwDOAAMmUc4-fUJ9","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T02:28:23Z","updated_at":"2022-02-23T02:28:23Z","author_association":"MEMBER","body":"@frapa I think this is looking good modulo a small typo or two in the error message. I pushed it to a specially-named `jenkins-`branch so we can test your changes to `Jenkinsfile.full` in CI:\r\n\r\nhttps://ci-couchdb.apache.org/blue/organizations/jenkins/jenkins-cm1%2FFullPlatformMatrix/detail/jenkins-frapa-autodetect_spidermonkey_version/1/pipeline\r\n\r\nAssuming all goes well there we can fix the typo and merge.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048396413/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048424706","html_url":"https://github.com/apache/couchdb/pull/3932#issuecomment-1048424706","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3932","id":1048424706,"node_id":"IC_kwDOAAMmUc4-fbEC","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T03:47:19Z","updated_at":"2022-02-23T03:47:19Z","author_association":"MEMBER","body":"Looks like this fails on macOS and FreeBSD. FreeBSD doesn't have the `-p` option to `ldconfig`, while macOS doesn't use it at all.\r\n\r\nI'd be OK to make the `ldconfig` dance conditional on discovering Linux as the underlying platform if you want to go that route, otherwise maybe you can figure out a way to support this discovery for the other Unix-like systems?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048424706/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048747905","html_url":"https://github.com/apache/couchdb/issues/3939#issuecomment-1048747905","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3939","id":1048747905,"node_id":"IC_kwDOAAMmUc4-gp-B","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T12:48:14Z","updated_at":"2022-02-23T12:48:14Z","author_association":"MEMBER","body":"That's quite the report, thanks! When you say\r\n\r\n> These events happen over two requests, both are PUT /db/doc for the same doc ID and revision\r\n\r\nare you referring to the base revision against which the update is being applied? If so, isn't this bit surprising?\r\n\r\n> In request 2, the first message that FABRIC receives is an ok from node B.\r\n\r\nWithout pulling up all the code modules I would have guessed that node B would reject request 2 as an edit conflict. Or were you running with `new_edits=false` here?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048747905/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048750693","html_url":"https://github.com/apache/couchdb/issues/3939#issuecomment-1048750693","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3939","id":1048750693,"node_id":"IC_kwDOAAMmUc4-gqpl","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T12:51:53Z","updated_at":"2022-02-23T12:51:53Z","author_association":"MEMBER","body":"> are you referring to the base revision against which the update is being applied? If so, isn't this bit surprising?\r\n\r\nthis is a function of the client app, where these two requests can happen concurrently from two different clients hitting the same exact coordinating node. A round-robin request assignment would make this occurring _a lot_ less likely.\r\n\r\n> Or were you running with new_edits=false here?\r\n\r\nSecond para: \r\n\r\n> This issue was observed on replication requests with new_edits=false and part\r\nof the code path for this request differentiates between replicated_changes\r\nand interactive_edit. However we don't believe this problem is specific to\r\nreplication requests.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048750693/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048761683","html_url":"https://github.com/apache/couchdb/issues/3939#issuecomment-1048761683","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3939","id":1048761683,"node_id":"IC_kwDOAAMmUc4-gtVT","user":{"login":"jcoglan","id":9265,"node_id":"MDQ6VXNlcjkyNjU=","avatar_url":"https://avatars.githubusercontent.com/u/9265?v=4","gravatar_id":"","url":"https://api.github.com/users/jcoglan","html_url":"https://github.com/jcoglan","followers_url":"https://api.github.com/users/jcoglan/followers","following_url":"https://api.github.com/users/jcoglan/following{/other_user}","gists_url":"https://api.github.com/users/jcoglan/gists{/gist_id}","starred_url":"https://api.github.com/users/jcoglan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jcoglan/subscriptions","organizations_url":"https://api.github.com/users/jcoglan/orgs","repos_url":"https://api.github.com/users/jcoglan/repos","events_url":"https://api.github.com/users/jcoglan/events{/privacy}","received_events_url":"https://api.github.com/users/jcoglan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T13:05:28Z","updated_at":"2022-02-23T13:05:28Z","author_association":"CONTRIBUTOR","body":"> are you referring to the base revision against which the update is being applied?\r\n\r\nNo, this is a replication request, so I mean that both are for the same document ID, and contain the same `_revisions` value. i.e. both requests are uploading the same version of the document.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048761683/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048773500","html_url":"https://github.com/apache/couchdb/issues/3939#issuecomment-1048773500","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3939","id":1048773500,"node_id":"IC_kwDOAAMmUc4-gwN8","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T13:19:11Z","updated_at":"2022-02-23T13:19:11Z","author_association":"MEMBER","body":"Ah, thanks! Then the `ok` response from node B makes more sense, but I can see where we'd still run into the same issue of the `PARSER` waiting around for a receiver that was never spawned in the interactive case as well.\r\n\r\nI guess the expedient fix here might for the `FABRIC` process to kill off the `PARSER` when it knows that a response has been received from every worker?\r\n\r\nI agree that this attachment buffering system is overly complex and poorly designed (speaking as one of the designers). It'd be a pretty interesting project to design a greenfield replacement application and then figure out how to integrate that into CouchDB.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048773500/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048792212","html_url":"https://github.com/apache/couchdb/issues/3939#issuecomment-1048792212","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3939","id":1048792212,"node_id":"IC_kwDOAAMmUc4-g0yU","user":{"login":"janl","id":11321,"node_id":"MDQ6VXNlcjExMzIx","avatar_url":"https://avatars.githubusercontent.com/u/11321?v=4","gravatar_id":"","url":"https://api.github.com/users/janl","html_url":"https://github.com/janl","followers_url":"https://api.github.com/users/janl/followers","following_url":"https://api.github.com/users/janl/following{/other_user}","gists_url":"https://api.github.com/users/janl/gists{/gist_id}","starred_url":"https://api.github.com/users/janl/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/janl/subscriptions","organizations_url":"https://api.github.com/users/janl/orgs","repos_url":"https://api.github.com/users/janl/repos","events_url":"https://api.github.com/users/janl/events{/privacy}","received_events_url":"https://api.github.com/users/janl/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T13:39:15Z","updated_at":"2022-02-23T13:39:15Z","author_association":"MEMBER","body":"@kocolosk I wouldn’t want to introduce a layering violation here, but could another option be for the receiving node to send a `no_bytes_will_ever_be_requested` message to PARSER so it can decrement the workers it waits for?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048792212/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048870372","html_url":"https://github.com/apache/couchdb/issues/3939#issuecomment-1048870372","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3939","id":1048870372,"node_id":"IC_kwDOAAMmUc4-hH3k","user":{"login":"nickva","id":211822,"node_id":"MDQ6VXNlcjIxMTgyMg==","avatar_url":"https://avatars.githubusercontent.com/u/211822?v=4","gravatar_id":"","url":"https://api.github.com/users/nickva","html_url":"https://github.com/nickva","followers_url":"https://api.github.com/users/nickva/followers","following_url":"https://api.github.com/users/nickva/following{/other_user}","gists_url":"https://api.github.com/users/nickva/gists{/gist_id}","starred_url":"https://api.github.com/users/nickva/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/nickva/subscriptions","organizations_url":"https://api.github.com/users/nickva/orgs","repos_url":"https://api.github.com/users/nickva/repos","events_url":"https://api.github.com/users/nickva/events{/privacy}","received_events_url":"https://api.github.com/users/nickva/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T14:57:01Z","updated_at":"2022-02-23T14:57:01Z","author_association":"CONTRIBUTOR","body":"> send a `no_bytes_will_ever_be_requested` message to PARSER so it can decrement the workers it waits for?\r\n\r\n@janl Yeah, I wonder if that would work. And we'd explicitly check for `new_edits=false` case only.\r\n\r\n@kocolosk what do you think, would that work? In the interactive case I'd think we'd get back a conflict, or would we have the exact same problem.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048870372/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048934037","html_url":"https://github.com/apache/couchdb/issues/3939#issuecomment-1048934037","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3939","id":1048934037,"node_id":"IC_kwDOAAMmUc4-hXaV","user":{"login":"jcoglan","id":9265,"node_id":"MDQ6VXNlcjkyNjU=","avatar_url":"https://avatars.githubusercontent.com/u/9265?v=4","gravatar_id":"","url":"https://api.github.com/users/jcoglan","html_url":"https://github.com/jcoglan","followers_url":"https://api.github.com/users/jcoglan/followers","following_url":"https://api.github.com/users/jcoglan/following{/other_user}","gists_url":"https://api.github.com/users/jcoglan/gists{/gist_id}","starred_url":"https://api.github.com/users/jcoglan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jcoglan/subscriptions","organizations_url":"https://api.github.com/users/jcoglan/orgs","repos_url":"https://api.github.com/users/jcoglan/repos","events_url":"https://api.github.com/users/jcoglan/events{/privacy}","received_events_url":"https://api.github.com/users/jcoglan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T15:57:37Z","updated_at":"2022-02-23T15:58:38Z","author_association":"CONTRIBUTOR","body":"@kocolosk This has prompted me to rethink how this would work for normal (`new_edits != false`) writes. For replication writes, both requests can succeed b/c replication writes can add revs anywhere in the tree; if the revs already exist, no problem.\r\n\r\nFor normal writes, one of these concurrent requests _must_ fail, or you have a causality violation. Let's refer to the writer procs on `B`, `C` and `D` for requests 1 and 2 as `B1`, `C1`, `D1` and `B2`, `C2`, `D2`. In our example above, `B1` succeeds first, before request 2 begins. This means `B2` _must_ fail, because the `rev` param in these identical requests is no longer a leaf in node B's copy of the DB.\r\n\r\nThe rest of the processes `C1`, `D1`, `C2`, `D2` are still ongoing and there's nothing forcing them to finish in any particular order. It should be the case that if `C1` succeeds, then `C2` fails and vice versa, same for the `D` writers. This in turn should mean that only one request achieves quorum, but it _could_ be request 2, even if this is unlikely in general.\r\n\r\nSo this still should not result in a consistency violation, but it's worth seeing if there's any way this allows both requests to succeed.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048934037/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048944382","html_url":"https://github.com/apache/couchdb/issues/3939#issuecomment-1048944382","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3939","id":1048944382,"node_id":"IC_kwDOAAMmUc4-hZ7-","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T16:07:16Z","updated_at":"2022-02-23T16:07:16Z","author_association":"MEMBER","body":"Yes, that's correct @jcoglan. The question I've been mulling over for the past few minutes is whether an interactive edit conflict is detected by `PARSER`, or whether we have the same issue there because the attachment writers are never spawned. Should be pretty straightforward to test; in the worst case _any_ `multipart/related` request that results in an edit conflict would hit the timeout, no data race required. But I was hoping to track down that logic in the codebase itself, and as you're well aware that's a challenging exercise for this bit of functionality.\r\n\r\nI'm OK with the suggestion for the `FABRIC` coordinator process to inform the `PARSER` that a writer won't be requesting data. I'm still curious to understand what happens in the case of an interactive edit conflict.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048944382/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048949348","html_url":"https://github.com/apache/couchdb/issues/3939#issuecomment-1048949348","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3939","id":1048949348,"node_id":"IC_kwDOAAMmUc4-hbJk","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T16:12:05Z","updated_at":"2022-02-23T16:12:05Z","author_association":"MEMBER","body":"Oh, and as to the consistency violation -- I strongly suspect we're immune, because the ultimate source of truth for whether the update is committed is in the normal `couch_db_updater` logic, where we've run all manner of tests stressing the correctness of the system under concurrent load. We could have plenty of cases where `C1` and `C2` are both writing attachment data to disk concurrently, but in the end the revision tree for a particular shard copy will only commit the update from one of them in interactive mode.\r\n\r\n","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048949348/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048967722","html_url":"https://github.com/apache/couchdb/issues/3939#issuecomment-1048967722","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3939","id":1048967722,"node_id":"IC_kwDOAAMmUc4-hfoq","user":{"login":"jcoglan","id":9265,"node_id":"MDQ6VXNlcjkyNjU=","avatar_url":"https://avatars.githubusercontent.com/u/9265?v=4","gravatar_id":"","url":"https://api.github.com/users/jcoglan","html_url":"https://github.com/jcoglan","followers_url":"https://api.github.com/users/jcoglan/followers","following_url":"https://api.github.com/users/jcoglan/following{/other_user}","gists_url":"https://api.github.com/users/jcoglan/gists{/gist_id}","starred_url":"https://api.github.com/users/jcoglan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jcoglan/subscriptions","organizations_url":"https://api.github.com/users/jcoglan/orgs","repos_url":"https://api.github.com/users/jcoglan/repos","events_url":"https://api.github.com/users/jcoglan/events{/privacy}","received_events_url":"https://api.github.com/users/jcoglan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T16:28:21Z","updated_at":"2022-02-23T16:28:21Z","author_association":"CONTRIBUTOR","body":"> The question I've been mulling over for the past few minutes is whether an interactive edit conflict is detected by PARSER, or whether we have the same issue there because the attachment writers are never spawned\r\n\r\nThe thing to check for here would be that if request 2 gets one failing response from a backend, b/c that backend already accepted request 1, but it goes on to receive `ok` from the other two backends, will it respond quickly? Or will it hit the same timeout because the backend that rejected the write is not requesting the attachment data?","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048967722/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048969592","html_url":"https://github.com/apache/couchdb/issues/3939#issuecomment-1048969592","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3939","id":1048969592,"node_id":"IC_kwDOAAMmUc4-hgF4","user":{"login":"jcoglan","id":9265,"node_id":"MDQ6VXNlcjkyNjU=","avatar_url":"https://avatars.githubusercontent.com/u/9265?v=4","gravatar_id":"","url":"https://api.github.com/users/jcoglan","html_url":"https://github.com/jcoglan","followers_url":"https://api.github.com/users/jcoglan/followers","following_url":"https://api.github.com/users/jcoglan/following{/other_user}","gists_url":"https://api.github.com/users/jcoglan/gists{/gist_id}","starred_url":"https://api.github.com/users/jcoglan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/jcoglan/subscriptions","organizations_url":"https://api.github.com/users/jcoglan/orgs","repos_url":"https://api.github.com/users/jcoglan/repos","events_url":"https://api.github.com/users/jcoglan/events{/privacy}","received_events_url":"https://api.github.com/users/jcoglan/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T16:30:09Z","updated_at":"2022-02-23T16:30:09Z","author_association":"CONTRIBUTOR","body":"This probably depends on at what point the backend decides to reject the write, and whether it does this before or after fetching the attachment bodies. If it does it _before_, it needs to signal to the parser that it's not going to send `get_bytes`.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1048969592/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1049016840","html_url":"https://github.com/apache/couchdb/issues/3939#issuecomment-1049016840","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3939","id":1049016840,"node_id":"IC_kwDOAAMmUc4-hroI","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T17:16:44Z","updated_at":"2022-02-23T17:16:44Z","author_association":"MEMBER","body":"It turns out that the backend does reject the write before fetching the attachment bodies, but `fabric:update_doc` will throw the edit conflict, which means the handler in `chttpd_db` skips the `WaitFun()` and instead calls `abort_multipart_stream`, which causes the parser to consume and discard all the remaining attachment data on the wire.\r\n\r\nSo, that covers the interactive case. I still suspect that the `new_edits=false` case does not require this concurrent data race in order to trigger the timeout. It would be enough to submit the same request twice in a row; as far as I can tell at the moment the second request should hit the `WaitFun()` timeout.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1049016840/reactions","total_count":1,"+1":1,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null},{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1049102965","html_url":"https://github.com/apache/couchdb/issues/3939#issuecomment-1049102965","issue_url":"https://api.github.com/repos/apache/couchdb/issues/3939","id":1049102965,"node_id":"IC_kwDOAAMmUc4-iAp1","user":{"login":"kocolosk","id":16679,"node_id":"MDQ6VXNlcjE2Njc5","avatar_url":"https://avatars.githubusercontent.com/u/16679?v=4","gravatar_id":"","url":"https://api.github.com/users/kocolosk","html_url":"https://github.com/kocolosk","followers_url":"https://api.github.com/users/kocolosk/followers","following_url":"https://api.github.com/users/kocolosk/following{/other_user}","gists_url":"https://api.github.com/users/kocolosk/gists{/gist_id}","starred_url":"https://api.github.com/users/kocolosk/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/kocolosk/subscriptions","organizations_url":"https://api.github.com/users/kocolosk/orgs","repos_url":"https://api.github.com/users/kocolosk/repos","events_url":"https://api.github.com/users/kocolosk/events{/privacy}","received_events_url":"https://api.github.com/users/kocolosk/received_events","type":"User","user_view_type":"public","site_admin":false},"created_at":"2022-02-23T18:51:56Z","updated_at":"2022-02-23T18:51:56Z","author_association":"MEMBER","body":"I tried adding an integration test for this in e85e34359 but it doesn't do quite what you'd expect. I tried writing a doc with attachments and then saving that same revision again using `new_edits=false`. The client does receive a rapid response to **both** requests, but (I think) the attachment bytes are never consumed off of the wire and so the _next_ request on the connection from a different part of the test suite hangs. The second `new_edits=false` multipart request never shows up in the logs because the test suite times out first and destroys the DB.\r\n\r\nPerhaps this is also what you were observing in production?\r\n\r\nAt any rate, I added the test in part to demonstrate that the data race with the quorum logic might be a red herring. _Anytime_ a `multipart/related` request with `new_edits=false` is made with a revision that already exists in the database the server does not properly clean up the connection.","reactions":{"url":"https://api.github.com/repos/apache/couchdb/issues/comments/1049102965/reactions","total_count":0,"+1":0,"-1":0,"laugh":0,"hooray":0,"confused":0,"heart":0,"rocket":0,"eyes":0},"performed_via_github_app":null}]